var JSZip=function(data,options){this.files={},this.root="",data&&this.load(data,options)};JSZip.signature={LOCAL_FILE_HEADER:"PK",CENTRAL_FILE_HEADER:"PK",CENTRAL_DIRECTORY_END:"PK",ZIP64_CENTRAL_DIRECTORY_LOCATOR:"PK",ZIP64_CENTRAL_DIRECTORY_END:"PK",DATA_DESCRIPTOR:"PK\b"},JSZip.defaults={base64:!1,binary:!1,dir:!1,date:null},JSZip.prototype=function(){var ZipObject=function(name,data,options){this.name=name,this.data=data,this.options=options};ZipObject.prototype={asText:function(){var result=this.data;return null===result||"undefined"==typeof result?"":(this.options.base64&&(result=JSZipBase64.decode(result)),this.options.binary&&(result=JSZip.prototype.utf8decode(result)),result)},asBinary:function(){var result=this.data;return null===result||"undefined"==typeof result?"":(this.options.base64&&(result=JSZipBase64.decode(result)),this.options.binary||(result=JSZip.prototype.utf8encode(result)),result)},asUint8Array:function(){return JSZip.utils.string2Uint8Array(this.asBinary())},asArrayBuffer:function(){return JSZip.utils.string2Uint8Array(this.asBinary()).buffer}};var decToHex=function(dec,bytes){var i,hex="";for(i=0;bytes>i;i++)hex+=String.fromCharCode(255&dec),dec>>>=8;return hex},extend=function(){var i,attr,result={};for(i=0;i<arguments.length;i++)for(attr in arguments[i])arguments[i].hasOwnProperty(attr)&&"undefined"==typeof result[attr]&&(result[attr]=arguments[i][attr]);return result},prepareFileAttrs=function(o){return o=o||{},o.base64===!0&&null==o.binary&&(o.binary=!0),o=extend(o,JSZip.defaults),o.date=o.date||new Date,o},fileAdd=function(name,data,o){var parent=parentFolder(name);if(parent&&folderAdd.call(this,parent),o=prepareFileAttrs(o),o.dir||null===data||"undefined"==typeof data)o.base64=!1,o.binary=!1,data=null;else if(JSZip.support.uint8array&&data instanceof Uint8Array)o.base64=!1,o.binary=!0,data=JSZip.utils.uint8Array2String(data);else if(JSZip.support.arraybuffer&&data instanceof ArrayBuffer){o.base64=!1,o.binary=!0;var bufferView=new Uint8Array(data);data=JSZip.utils.uint8Array2String(bufferView)}else o.binary&&!o.base64&&(o.optimizedBinaryString!==!0&&(data=JSZip.utils.string2binary(data)),delete o.optimizedBinaryString);return this.files[name]=new ZipObject(name,data,o)},parentFolder=function(path){"/"==path.slice(-1)&&(path=path.substring(0,path.length-1));var lastSlash=path.lastIndexOf("/");return lastSlash>0?path.substring(0,lastSlash):""},folderAdd=function(name){if("/"!=name.slice(-1)&&(name+="/"),!this.files[name]){var parent=parentFolder(name);parent&&folderAdd.call(this,parent),fileAdd.call(this,name,null,{dir:!0})}return this.files[name]},prepareLocalHeaderData=function(file,utfEncodedFileName,compressionType){var dosTime,dosDate,useUTF8=utfEncodedFileName!==file.name,data=file.asBinary(),o=file.options;dosTime=o.date.getHours(),dosTime<<=6,dosTime|=o.date.getMinutes(),dosTime<<=5,dosTime|=o.date.getSeconds()/2,dosDate=o.date.getFullYear()-1980,dosDate<<=4,dosDate|=o.date.getMonth()+1,dosDate<<=5,dosDate|=o.date.getDate();var hasData=null!==data&&0!==data.length,compression=JSZip.compressions[compressionType],compressedData=hasData?compression.compress(data):"",header="";return header+="\n\x00",header+=useUTF8?"\x00\b":"\x00\x00",header+=hasData?compression.magic:JSZip.compressions.STORE.magic,header+=decToHex(dosTime,2),header+=decToHex(dosDate,2),header+=hasData?decToHex(this.crc32(data),4):"\x00\x00\x00\x00",header+=hasData?decToHex(compressedData.length,4):"\x00\x00\x00\x00",header+=hasData?decToHex(data.length,4):"\x00\x00\x00\x00",header+=decToHex(utfEncodedFileName.length,2),header+="\x00\x00",{header:header,compressedData:compressedData}};return{load:function(){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(search){var filename,relativePath,file,fileClone,result=[];for(filename in this.files)this.files.hasOwnProperty(filename)&&(file=this.files[filename],fileClone=new ZipObject(file.name,file.data,extend(file.options)),relativePath=filename.slice(this.root.length,filename.length),filename.slice(0,this.root.length)===this.root&&search(relativePath,fileClone)&&result.push(fileClone));return result},file:function(name,data,o){if(1===arguments.length){if(name instanceof RegExp){var regexp=name;return this.filter(function(relativePath,file){return!file.options.dir&&regexp.test(relativePath)})}return this.filter(function(relativePath,file){return!file.options.dir&&relativePath===name})[0]||null}return name=this.root+name,fileAdd.call(this,name,data,o),this},folder:function(arg){if(!arg)return this;if(arg instanceof RegExp)return this.filter(function(relativePath,file){return file.options.dir&&arg.test(relativePath)});var name=this.root+arg,newFolder=folderAdd.call(this,name),ret=this.clone();return ret.root=newFolder.name,ret},remove:function(name){name=this.root+name;var file=this.files[name];if(file||("/"!=name.slice(-1)&&(name+="/"),file=this.files[name]),file)if(file.options.dir)for(var kids=this.filter(function(relativePath,file){return file.name.slice(0,name.length)===name}),i=0;i<kids.length;i++)delete this.files[kids[i].name];else delete this.files[name];return this},generate:function(options){options=extend(options||{},{base64:!0,compression:"STORE",type:"base64"});var compression=options.compression.toUpperCase(),directory=[],files=[],fileOffset=0;if(!JSZip.compressions[compression])throw compression+" is not a valid compression method !";for(var name in this.files)if(this.files.hasOwnProperty(name)){var file=this.files[name],utfEncodedFileName=this.utf8encode(file.name),fileRecord="",dirRecord="",data=prepareLocalHeaderData.call(this,file,utfEncodedFileName,compression);fileRecord=JSZip.signature.LOCAL_FILE_HEADER+data.header+utfEncodedFileName+data.compressedData,dirRecord=JSZip.signature.CENTRAL_FILE_HEADER+"\x00"+data.header+"\x00\x00\x00\x00\x00\x00"+(this.files[name].options.dir===!0?"\x00\x00\x00":"\x00\x00\x00\x00")+decToHex(fileOffset,4)+utfEncodedFileName,fileOffset+=fileRecord.length,files.push(fileRecord),directory.push(dirRecord)}var fileData=files.join(""),dirData=directory.join(""),dirEnd="";dirEnd=JSZip.signature.CENTRAL_DIRECTORY_END+"\x00\x00\x00\x00"+decToHex(files.length,2)+decToHex(files.length,2)+decToHex(dirData.length,4)+decToHex(fileData.length,4)+"\x00\x00";var zip=fileData+dirData+dirEnd;switch(options.type.toLowerCase()){case"uint8array":return JSZip.utils.string2Uint8Array(zip);case"arraybuffer":return JSZip.utils.string2Uint8Array(zip).buffer;case"blob":return JSZip.utils.string2Blob(zip);case"base64":return options.base64?JSZipBase64.encode(zip):zip;default:return zip}},crc32:function(str,crc){if(""===str||"undefined"==typeof str)return 0;var table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"==typeof crc&&(crc=0);var x=0,y=0;crc=-1^crc;for(var i=0,iTop=str.length;iTop>i;i++)y=255&(crc^str.charCodeAt(i)),x=table[y],crc=crc>>>8^x;return-1^crc},clone:function(){var newObj=new JSZip;for(var i in this)"function"!=typeof this[i]&&(newObj[i]=this[i]);return newObj},utf8encode:function(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utftext+=String.fromCharCode(c):c>127&&2048>c?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext},utf8decode:function(utftext){for(var string="",i=0,c=0,c2=0,c3=0;i<utftext.length;)c=utftext.charCodeAt(i),128>c?(string+=String.fromCharCode(c),i++):c>191&&224>c?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}}}(),JSZip.compressions={STORE:{magic:"\x00\x00",compress:function(content){return content},uncompress:function(content){return content}}},JSZip.support={arraybuffer:function(){return"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array}(),uint8array:function(){return"undefined"!=typeof Uint8Array}(),blob:function(){if("undefined"==typeof ArrayBuffer)return!1;var buffer=new ArrayBuffer(0);try{return 0===new Blob([buffer],{type:"application/zip"}).size}catch(e){}try{var builder=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return builder.append(buffer),0===builder.getBlob("application/zip").size}catch(e){}return!1}()},JSZip.utils={string2binary:function(str){for(var result="",i=0;i<str.length;i++)result+=String.fromCharCode(255&str.charCodeAt(i));return result},string2Uint8Array:function(str){if(!JSZip.support.uint8array)throw new Error("Uint8Array is not supported by this browser");for(var buffer=new ArrayBuffer(str.length),bufferView=new Uint8Array(buffer),i=0;i<str.length;i++)bufferView[i]=str.charCodeAt(i);return bufferView},uint8Array2String:function(array){if(!JSZip.support.uint8array)throw new Error("Uint8Array is not supported by this browser");for(var result="",i=0;i<array.length;i++)result+=String.fromCharCode(array[i]);return result},string2Blob:function(str){if(!JSZip.support.blob)throw new Error("Blob is not supported by this browser");var buffer=JSZip.utils.string2Uint8Array(str).buffer;try{return new Blob([buffer],{type:"application/zip"})}catch(e){}try{var builder=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return builder.append(buffer),builder.getBlob("application/zip")}catch(e){}throw new Error("Bug : can't construct the Blob.")}};var JSZipBase64=function(){var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(input){for(var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;i<input.length;)chr1=input.charCodeAt(i++),chr2=input.charCodeAt(i++),chr3=input.charCodeAt(i++),enc1=chr1>>2,enc2=(3&chr1)<<4|chr2>>4,enc3=(15&chr2)<<2|chr3>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4);return output},decode:function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)enc1=_keyStr.indexOf(input.charAt(i++)),enc2=_keyStr.indexOf(input.charAt(i++)),enc3=_keyStr.indexOf(input.charAt(i++)),enc4=_keyStr.indexOf(input.charAt(i++)),chr1=enc1<<2|enc2>>4,chr2=(15&enc2)<<4|enc3>>2,chr3=(3&enc3)<<6|enc4,output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output}}}();if(!JSZip)throw"JSZip not defined";if(function(){var zip_WSIZE=32768,zip_STORED_BLOCK=0,zip_STATIC_TREES=1,zip_DYN_TREES=2,zip_DEFAULT_LEVEL=6,zip_FULL_SEARCH=!0,zip_INBUFSIZ=32768,zip_INBUF_EXTRA=64,zip_OUTBUFSIZ=8192,zip_window_size=2*zip_WSIZE,zip_MIN_MATCH=3,zip_MAX_MATCH=258,zip_BITS=16,zip_LIT_BUFSIZE=8192,zip_HASH_BITS=13;zip_LIT_BUFSIZE>zip_INBUFSIZ&&alert("error: zip_INBUFSIZ is too small"),zip_WSIZE<<1>1<<zip_BITS&&alert("error: zip_WSIZE is too large"),zip_HASH_BITS>zip_BITS-1&&alert("error: zip_HASH_BITS is too large"),(8>zip_HASH_BITS||258!=zip_MAX_MATCH)&&alert("error: Code too clever");var zip_free_queue,zip_qhead,zip_qtail,zip_initflag,zip_outcnt,zip_outoff,zip_complete,zip_window,zip_d_buf,zip_l_buf,zip_prev,zip_bi_buf,zip_bi_valid,zip_block_start,zip_ins_h,zip_hash_head,zip_prev_match,zip_match_available,zip_match_length,zip_prev_length,zip_strstart,zip_match_start,zip_eofile,zip_lookahead,zip_max_chain_length,zip_max_lazy_match,zip_compr_level,zip_good_match,zip_nice_match,zip_dyn_ltree,zip_dyn_dtree,zip_static_ltree,zip_static_dtree,zip_bl_tree,zip_l_desc,zip_d_desc,zip_bl_desc,zip_bl_count,zip_heap,zip_heap_len,zip_heap_max,zip_depth,zip_length_code,zip_dist_code,zip_base_length,zip_base_dist,zip_flag_buf,zip_last_lit,zip_last_dist,zip_last_flags,zip_flags,zip_flag_bit,zip_opt_len,zip_static_len,zip_deflate_data,zip_deflate_pos,zip_DIST_BUFSIZE=zip_LIT_BUFSIZE,zip_HASH_SIZE=1<<zip_HASH_BITS,zip_HASH_MASK=zip_HASH_SIZE-1,zip_WMASK=zip_WSIZE-1,zip_NIL=0,zip_TOO_FAR=4096,zip_MIN_LOOKAHEAD=zip_MAX_MATCH+zip_MIN_MATCH+1,zip_MAX_DIST=zip_WSIZE-zip_MIN_LOOKAHEAD,zip_SMALLEST=1,zip_MAX_BITS=15,zip_MAX_BL_BITS=7,zip_LENGTH_CODES=29,zip_LITERALS=256,zip_END_BLOCK=256,zip_L_CODES=zip_LITERALS+1+zip_LENGTH_CODES,zip_D_CODES=30,zip_BL_CODES=19,zip_REP_3_6=16,zip_REPZ_3_10=17,zip_REPZ_11_138=18,zip_HEAP_SIZE=2*zip_L_CODES+1,zip_H_SHIFT=parseInt((zip_HASH_BITS+zip_MIN_MATCH-1)/zip_MIN_MATCH),zip_outbuf=null,zip_DeflateCT=function(){this.fc=0,this.dl=0},zip_DeflateTreeDesc=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},zip_DeflateConfiguration=function(a,b,c,d){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d},zip_DeflateBuffer=function(){this.next=null,this.len=0,this.ptr=new Array(zip_OUTBUFSIZ),this.off=0},zip_extra_lbits=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),zip_extra_dbits=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),zip_extra_blbits=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),zip_bl_order=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),zip_configuration_table=new Array(new zip_DeflateConfiguration(0,0,0,0),new zip_DeflateConfiguration(4,4,8,4),new zip_DeflateConfiguration(4,5,16,8),new zip_DeflateConfiguration(4,6,32,32),new zip_DeflateConfiguration(4,4,16,16),new zip_DeflateConfiguration(8,16,32,32),new zip_DeflateConfiguration(8,16,128,128),new zip_DeflateConfiguration(8,32,128,256),new zip_DeflateConfiguration(32,128,258,1024),new zip_DeflateConfiguration(32,258,258,4096)),zip_deflate_start=function(level){var i;if(level?1>level?level=1:level>9&&(level=9):level=zip_DEFAULT_LEVEL,zip_compr_level=level,zip_initflag=!1,zip_eofile=!1,null==zip_outbuf){for(zip_free_queue=zip_qhead=zip_qtail=null,zip_outbuf=new Array(zip_OUTBUFSIZ),zip_window=new Array(zip_window_size),zip_d_buf=new Array(zip_DIST_BUFSIZE),zip_l_buf=new Array(zip_INBUFSIZ+zip_INBUF_EXTRA),zip_prev=new Array(1<<zip_BITS),zip_dyn_ltree=new Array(zip_HEAP_SIZE),i=0;zip_HEAP_SIZE>i;i++)zip_dyn_ltree[i]=new zip_DeflateCT;for(zip_dyn_dtree=new Array(2*zip_D_CODES+1),i=0;2*zip_D_CODES+1>i;i++)zip_dyn_dtree[i]=new zip_DeflateCT;for(zip_static_ltree=new Array(zip_L_CODES+2),i=0;zip_L_CODES+2>i;i++)zip_static_ltree[i]=new zip_DeflateCT;for(zip_static_dtree=new Array(zip_D_CODES),i=0;zip_D_CODES>i;i++)zip_static_dtree[i]=new zip_DeflateCT;for(zip_bl_tree=new Array(2*zip_BL_CODES+1),i=0;2*zip_BL_CODES+1>i;i++)zip_bl_tree[i]=new zip_DeflateCT;zip_l_desc=new zip_DeflateTreeDesc,zip_d_desc=new zip_DeflateTreeDesc,zip_bl_desc=new zip_DeflateTreeDesc,zip_bl_count=new Array(zip_MAX_BITS+1),zip_heap=new Array(2*zip_L_CODES+1),zip_depth=new Array(2*zip_L_CODES+1),zip_length_code=new Array(zip_MAX_MATCH-zip_MIN_MATCH+1),zip_dist_code=new Array(512),zip_base_length=new Array(zip_LENGTH_CODES),zip_base_dist=new Array(zip_D_CODES),zip_flag_buf=new Array(parseInt(zip_LIT_BUFSIZE/8))}},zip_reuse_queue=function(p){p.next=zip_free_queue,zip_free_queue=p},zip_new_queue=function(){var p;return null!=zip_free_queue?(p=zip_free_queue,zip_free_queue=zip_free_queue.next):p=new zip_DeflateBuffer,p.next=null,p.len=p.off=0,p},zip_head1=function(i){return zip_prev[zip_WSIZE+i]},zip_head2=function(i,val){return zip_prev[zip_WSIZE+i]=val},zip_put_byte=function(c){zip_outbuf[zip_outoff+zip_outcnt++]=c,zip_outoff+zip_outcnt==zip_OUTBUFSIZ&&zip_qoutbuf()},zip_put_short=function(w){w&=65535,zip_OUTBUFSIZ-2>zip_outoff+zip_outcnt?(zip_outbuf[zip_outoff+zip_outcnt++]=255&w,zip_outbuf[zip_outoff+zip_outcnt++]=w>>>8):(zip_put_byte(255&w),zip_put_byte(w>>>8))},zip_INSERT_STRING=function(){zip_ins_h=(zip_ins_h<<zip_H_SHIFT^255&zip_window[zip_strstart+zip_MIN_MATCH-1])&zip_HASH_MASK,zip_hash_head=zip_head1(zip_ins_h),zip_prev[zip_strstart&zip_WMASK]=zip_hash_head,zip_head2(zip_ins_h,zip_strstart)},zip_SEND_CODE=function(c,tree){zip_send_bits(tree[c].fc,tree[c].dl)},zip_D_CODE=function(dist){return 255&(256>dist?zip_dist_code[dist]:zip_dist_code[256+(dist>>7)])},zip_SMALLER=function(tree,n,m){return tree[n].fc<tree[m].fc||tree[n].fc==tree[m].fc&&zip_depth[n]<=zip_depth[m]},zip_read_buff=function(buff,offset,n){var i;for(i=0;n>i&&zip_deflate_pos<zip_deflate_data.length;i++)buff[offset+i]=255&zip_deflate_data.charCodeAt(zip_deflate_pos++);return i},zip_lm_init=function(){var j;for(j=0;zip_HASH_SIZE>j;j++)zip_prev[zip_WSIZE+j]=0;if(zip_max_lazy_match=zip_configuration_table[zip_compr_level].max_lazy,zip_good_match=zip_configuration_table[zip_compr_level].good_length,zip_FULL_SEARCH||(zip_nice_match=zip_configuration_table[zip_compr_level].nice_length),zip_max_chain_length=zip_configuration_table[zip_compr_level].max_chain,zip_strstart=0,zip_block_start=0,zip_lookahead=zip_read_buff(zip_window,0,2*zip_WSIZE),0>=zip_lookahead)return zip_eofile=!0,void(zip_lookahead=0);for(zip_eofile=!1;zip_MIN_LOOKAHEAD>zip_lookahead&&!zip_eofile;)zip_fill_window();for(zip_ins_h=0,j=0;zip_MIN_MATCH-1>j;j++)zip_ins_h=(zip_ins_h<<zip_H_SHIFT^255&zip_window[j])&zip_HASH_MASK},zip_longest_match=function(cur_match){var matchp,len,chain_length=zip_max_chain_length,scanp=zip_strstart,best_len=zip_prev_length,limit=zip_strstart>zip_MAX_DIST?zip_strstart-zip_MAX_DIST:zip_NIL,strendp=zip_strstart+zip_MAX_MATCH,scan_end1=zip_window[scanp+best_len-1],scan_end=zip_window[scanp+best_len];zip_prev_length>=zip_good_match&&(chain_length>>=2);do if(matchp=cur_match,zip_window[matchp+best_len]==scan_end&&zip_window[matchp+best_len-1]==scan_end1&&zip_window[matchp]==zip_window[scanp]&&zip_window[++matchp]==zip_window[scanp+1]){scanp+=2,matchp++;do;while(zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&zip_window[++scanp]==zip_window[++matchp]&&strendp>scanp);if(len=zip_MAX_MATCH-(strendp-scanp),scanp=strendp-zip_MAX_MATCH,len>best_len){if(zip_match_start=cur_match,best_len=len,zip_FULL_SEARCH){if(len>=zip_MAX_MATCH)break}else if(len>=zip_nice_match)break;scan_end1=zip_window[scanp+best_len-1],scan_end=zip_window[scanp+best_len]}}while((cur_match=zip_prev[cur_match&zip_WMASK])>limit&&0!=--chain_length);return best_len},zip_fill_window=function(){var n,m,more=zip_window_size-zip_lookahead-zip_strstart;if(-1==more)more--;else if(zip_strstart>=zip_WSIZE+zip_MAX_DIST){for(n=0;zip_WSIZE>n;n++)zip_window[n]=zip_window[n+zip_WSIZE];for(zip_match_start-=zip_WSIZE,zip_strstart-=zip_WSIZE,zip_block_start-=zip_WSIZE,n=0;zip_HASH_SIZE>n;n++)m=zip_head1(n),zip_head2(n,m>=zip_WSIZE?m-zip_WSIZE:zip_NIL);for(n=0;zip_WSIZE>n;n++)m=zip_prev[n],zip_prev[n]=m>=zip_WSIZE?m-zip_WSIZE:zip_NIL;more+=zip_WSIZE}zip_eofile||(n=zip_read_buff(zip_window,zip_strstart+zip_lookahead,more),0>=n?zip_eofile=!0:zip_lookahead+=n)},zip_deflate_fast=function(){for(;0!=zip_lookahead&&null==zip_qhead;){var flush;if(zip_INSERT_STRING(),zip_hash_head!=zip_NIL&&zip_MAX_DIST>=zip_strstart-zip_hash_head&&(zip_match_length=zip_longest_match(zip_hash_head),zip_match_length>zip_lookahead&&(zip_match_length=zip_lookahead)),zip_match_length>=zip_MIN_MATCH)if(flush=zip_ct_tally(zip_strstart-zip_match_start,zip_match_length-zip_MIN_MATCH),zip_lookahead-=zip_match_length,zip_max_lazy_match>=zip_match_length){zip_match_length--;do zip_strstart++,zip_INSERT_STRING();while(0!=--zip_match_length);zip_strstart++}else zip_strstart+=zip_match_length,zip_match_length=0,zip_ins_h=255&zip_window[zip_strstart],zip_ins_h=(zip_ins_h<<zip_H_SHIFT^255&zip_window[zip_strstart+1])&zip_HASH_MASK;else flush=zip_ct_tally(0,255&zip_window[zip_strstart]),zip_lookahead--,zip_strstart++;for(flush&&(zip_flush_block(0),zip_block_start=zip_strstart);zip_MIN_LOOKAHEAD>zip_lookahead&&!zip_eofile;)zip_fill_window()}},zip_deflate_better=function(){for(;0!=zip_lookahead&&null==zip_qhead;){if(zip_INSERT_STRING(),zip_prev_length=zip_match_length,zip_prev_match=zip_match_start,zip_match_length=zip_MIN_MATCH-1,zip_hash_head!=zip_NIL&&zip_max_lazy_match>zip_prev_length&&zip_MAX_DIST>=zip_strstart-zip_hash_head&&(zip_match_length=zip_longest_match(zip_hash_head),zip_match_length>zip_lookahead&&(zip_match_length=zip_lookahead),zip_match_length==zip_MIN_MATCH&&zip_strstart-zip_match_start>zip_TOO_FAR&&zip_match_length--),zip_prev_length>=zip_MIN_MATCH&&zip_prev_length>=zip_match_length){var flush;flush=zip_ct_tally(zip_strstart-1-zip_prev_match,zip_prev_length-zip_MIN_MATCH),zip_lookahead-=zip_prev_length-1,zip_prev_length-=2;do zip_strstart++,zip_INSERT_STRING();while(0!=--zip_prev_length);zip_match_available=0,zip_match_length=zip_MIN_MATCH-1,zip_strstart++,flush&&(zip_flush_block(0),zip_block_start=zip_strstart)}else 0!=zip_match_available?(zip_ct_tally(0,255&zip_window[zip_strstart-1])&&(zip_flush_block(0),zip_block_start=zip_strstart),zip_strstart++,zip_lookahead--):(zip_match_available=1,zip_strstart++,zip_lookahead--);for(;zip_MIN_LOOKAHEAD>zip_lookahead&&!zip_eofile;)zip_fill_window()}},zip_init_deflate=function(){zip_eofile||(zip_bi_buf=0,zip_bi_valid=0,zip_ct_init(),zip_lm_init(),zip_qhead=null,zip_outcnt=0,zip_outoff=0,3>=zip_compr_level?(zip_prev_length=zip_MIN_MATCH-1,zip_match_length=0):(zip_match_length=zip_MIN_MATCH-1,zip_match_available=0),zip_complete=!1)},zip_deflate_internal=function(buff,off,buff_size){var n;return zip_initflag||(zip_init_deflate(),zip_initflag=!0,0!=zip_lookahead)?(n=zip_qcopy(buff,off,buff_size))==buff_size?buff_size:zip_complete?n:(3>=zip_compr_level?zip_deflate_fast():zip_deflate_better(),0==zip_lookahead&&(0!=zip_match_available&&zip_ct_tally(0,255&zip_window[zip_strstart-1]),zip_flush_block(1),zip_complete=!0),n+zip_qcopy(buff,n+off,buff_size-n)):(zip_complete=!0,0)},zip_qcopy=function(buff,off,buff_size){var n,i,j;for(n=0;null!=zip_qhead&&buff_size>n;){for(i=buff_size-n,i>zip_qhead.len&&(i=zip_qhead.len),j=0;i>j;j++)buff[off+n+j]=zip_qhead.ptr[zip_qhead.off+j];if(zip_qhead.off+=i,zip_qhead.len-=i,n+=i,0==zip_qhead.len){var p;p=zip_qhead,zip_qhead=zip_qhead.next,zip_reuse_queue(p)}}if(n==buff_size)return n;if(zip_outcnt>zip_outoff){for(i=buff_size-n,i>zip_outcnt-zip_outoff&&(i=zip_outcnt-zip_outoff),j=0;i>j;j++)buff[off+n+j]=zip_outbuf[zip_outoff+j];zip_outoff+=i,n+=i,zip_outcnt==zip_outoff&&(zip_outcnt=zip_outoff=0)}return n},zip_ct_init=function(){var n,bits,length,code,dist;if(0==zip_static_dtree[0].dl){for(zip_l_desc.dyn_tree=zip_dyn_ltree,zip_l_desc.static_tree=zip_static_ltree,zip_l_desc.extra_bits=zip_extra_lbits,zip_l_desc.extra_base=zip_LITERALS+1,zip_l_desc.elems=zip_L_CODES,zip_l_desc.max_length=zip_MAX_BITS,zip_l_desc.max_code=0,zip_d_desc.dyn_tree=zip_dyn_dtree,zip_d_desc.static_tree=zip_static_dtree,zip_d_desc.extra_bits=zip_extra_dbits,zip_d_desc.extra_base=0,zip_d_desc.elems=zip_D_CODES,zip_d_desc.max_length=zip_MAX_BITS,zip_d_desc.max_code=0,zip_bl_desc.dyn_tree=zip_bl_tree,zip_bl_desc.static_tree=null,zip_bl_desc.extra_bits=zip_extra_blbits,zip_bl_desc.extra_base=0,zip_bl_desc.elems=zip_BL_CODES,zip_bl_desc.max_length=zip_MAX_BL_BITS,zip_bl_desc.max_code=0,length=0,code=0;zip_LENGTH_CODES-1>code;code++)for(zip_base_length[code]=length,n=0;n<1<<zip_extra_lbits[code];n++)zip_length_code[length++]=code;for(zip_length_code[length-1]=code,dist=0,code=0;16>code;code++)for(zip_base_dist[code]=dist,n=0;n<1<<zip_extra_dbits[code];n++)zip_dist_code[dist++]=code;for(dist>>=7;zip_D_CODES>code;code++)for(zip_base_dist[code]=dist<<7,n=0;n<1<<zip_extra_dbits[code]-7;n++)zip_dist_code[256+dist++]=code;for(bits=0;zip_MAX_BITS>=bits;bits++)zip_bl_count[bits]=0;for(n=0;143>=n;)zip_static_ltree[n++].dl=8,zip_bl_count[8]++;for(;255>=n;)zip_static_ltree[n++].dl=9,zip_bl_count[9]++;for(;279>=n;)zip_static_ltree[n++].dl=7,zip_bl_count[7]++;for(;287>=n;)zip_static_ltree[n++].dl=8,zip_bl_count[8]++;for(zip_gen_codes(zip_static_ltree,zip_L_CODES+1),n=0;zip_D_CODES>n;n++)zip_static_dtree[n].dl=5,zip_static_dtree[n].fc=zip_bi_reverse(n,5);zip_init_block()}},zip_init_block=function(){var n;for(n=0;zip_L_CODES>n;n++)zip_dyn_ltree[n].fc=0;for(n=0;zip_D_CODES>n;n++)zip_dyn_dtree[n].fc=0;for(n=0;zip_BL_CODES>n;n++)zip_bl_tree[n].fc=0;zip_dyn_ltree[zip_END_BLOCK].fc=1,zip_opt_len=zip_static_len=0,zip_last_lit=zip_last_dist=zip_last_flags=0,zip_flags=0,zip_flag_bit=1},zip_pqdownheap=function(tree,k){for(var v=zip_heap[k],j=k<<1;zip_heap_len>=j&&(zip_heap_len>j&&zip_SMALLER(tree,zip_heap[j+1],zip_heap[j])&&j++,!zip_SMALLER(tree,v,zip_heap[j]));)zip_heap[k]=zip_heap[j],k=j,j<<=1;zip_heap[k]=v},zip_gen_bitlen=function(desc){var h,n,m,bits,xbits,f,tree=desc.dyn_tree,extra=desc.extra_bits,base=desc.extra_base,max_code=desc.max_code,max_length=desc.max_length,stree=desc.static_tree,overflow=0;for(bits=0;zip_MAX_BITS>=bits;bits++)zip_bl_count[bits]=0;for(tree[zip_heap[zip_heap_max]].dl=0,h=zip_heap_max+1;zip_HEAP_SIZE>h;h++)n=zip_heap[h],bits=tree[tree[n].dl].dl+1,bits>max_length&&(bits=max_length,overflow++),tree[n].dl=bits,n>max_code||(zip_bl_count[bits]++,xbits=0,n>=base&&(xbits=extra[n-base]),f=tree[n].fc,zip_opt_len+=f*(bits+xbits),null!=stree&&(zip_static_len+=f*(stree[n].dl+xbits)));if(0!=overflow){do{for(bits=max_length-1;0==zip_bl_count[bits];)bits--;zip_bl_count[bits]--,zip_bl_count[bits+1]+=2,zip_bl_count[max_length]--,overflow-=2}while(overflow>0);for(bits=max_length;0!=bits;bits--)for(n=zip_bl_count[bits];0!=n;)m=zip_heap[--h],m>max_code||(tree[m].dl!=bits&&(zip_opt_len+=(bits-tree[m].dl)*tree[m].fc,tree[m].fc=bits),n--)}},zip_gen_codes=function(tree,max_code){var bits,n,next_code=new Array(zip_MAX_BITS+1),code=0;for(bits=1;zip_MAX_BITS>=bits;bits++)code=code+zip_bl_count[bits-1]<<1,next_code[bits]=code;for(n=0;max_code>=n;n++){var len=tree[n].dl;0!=len&&(tree[n].fc=zip_bi_reverse(next_code[len]++,len))}},zip_build_tree=function(desc){var n,m,tree=desc.dyn_tree,stree=desc.static_tree,elems=desc.elems,max_code=-1,node=elems;for(zip_heap_len=0,zip_heap_max=zip_HEAP_SIZE,n=0;elems>n;n++)0!=tree[n].fc?(zip_heap[++zip_heap_len]=max_code=n,zip_depth[n]=0):tree[n].dl=0;for(;2>zip_heap_len;){var xnew=zip_heap[++zip_heap_len]=2>max_code?++max_code:0;tree[xnew].fc=1,zip_depth[xnew]=0,zip_opt_len--,null!=stree&&(zip_static_len-=stree[xnew].dl)}for(desc.max_code=max_code,n=zip_heap_len>>1;n>=1;n--)zip_pqdownheap(tree,n);do n=zip_heap[zip_SMALLEST],zip_heap[zip_SMALLEST]=zip_heap[zip_heap_len--],zip_pqdownheap(tree,zip_SMALLEST),m=zip_heap[zip_SMALLEST],zip_heap[--zip_heap_max]=n,zip_heap[--zip_heap_max]=m,tree[node].fc=tree[n].fc+tree[m].fc,zip_depth[node]=zip_depth[n]>zip_depth[m]+1?zip_depth[n]:zip_depth[m]+1,tree[n].dl=tree[m].dl=node,zip_heap[zip_SMALLEST]=node++,zip_pqdownheap(tree,zip_SMALLEST);while(zip_heap_len>=2);zip_heap[--zip_heap_max]=zip_heap[zip_SMALLEST],zip_gen_bitlen(desc),zip_gen_codes(tree,max_code)},zip_scan_tree=function(tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[0].dl,count=0,max_count=7,min_count=4;for(0==nextlen&&(max_count=138,min_count=3),tree[max_code+1].dl=65535,n=0;max_code>=n;n++)curlen=nextlen,nextlen=tree[n+1].dl,++count<max_count&&curlen==nextlen||(min_count>count?zip_bl_tree[curlen].fc+=count:0!=curlen?(curlen!=prevlen&&zip_bl_tree[curlen].fc++,zip_bl_tree[zip_REP_3_6].fc++):10>=count?zip_bl_tree[zip_REPZ_3_10].fc++:zip_bl_tree[zip_REPZ_11_138].fc++,count=0,prevlen=curlen,0==nextlen?(max_count=138,min_count=3):curlen==nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4))},zip_send_tree=function(tree,max_code){var n,curlen,prevlen=-1,nextlen=tree[0].dl,count=0,max_count=7,min_count=4;for(0==nextlen&&(max_count=138,min_count=3),n=0;max_code>=n;n++)if(curlen=nextlen,nextlen=tree[n+1].dl,!(++count<max_count&&curlen==nextlen)){if(min_count>count){do zip_SEND_CODE(curlen,zip_bl_tree);while(0!=--count)}else 0!=curlen?(curlen!=prevlen&&(zip_SEND_CODE(curlen,zip_bl_tree),count--),zip_SEND_CODE(zip_REP_3_6,zip_bl_tree),zip_send_bits(count-3,2)):10>=count?(zip_SEND_CODE(zip_REPZ_3_10,zip_bl_tree),zip_send_bits(count-3,3)):(zip_SEND_CODE(zip_REPZ_11_138,zip_bl_tree),zip_send_bits(count-11,7));count=0,prevlen=curlen,0==nextlen?(max_count=138,min_count=3):curlen==nextlen?(max_count=6,min_count=3):(max_count=7,min_count=4)}},zip_build_bl_tree=function(){var max_blindex;for(zip_scan_tree(zip_dyn_ltree,zip_l_desc.max_code),zip_scan_tree(zip_dyn_dtree,zip_d_desc.max_code),zip_build_tree(zip_bl_desc),max_blindex=zip_BL_CODES-1;max_blindex>=3&&0==zip_bl_tree[zip_bl_order[max_blindex]].dl;max_blindex--);return zip_opt_len+=3*(max_blindex+1)+5+5+4,max_blindex},zip_send_all_trees=function(lcodes,dcodes,blcodes){var rank;for(zip_send_bits(lcodes-257,5),zip_send_bits(dcodes-1,5),zip_send_bits(blcodes-4,4),rank=0;blcodes>rank;rank++)zip_send_bits(zip_bl_tree[zip_bl_order[rank]].dl,3);zip_send_tree(zip_dyn_ltree,lcodes-1),zip_send_tree(zip_dyn_dtree,dcodes-1)},zip_flush_block=function(eof){var opt_lenb,static_lenb,max_blindex,stored_len;if(stored_len=zip_strstart-zip_block_start,zip_flag_buf[zip_last_flags]=zip_flags,zip_build_tree(zip_l_desc),zip_build_tree(zip_d_desc),max_blindex=zip_build_bl_tree(),opt_lenb=zip_opt_len+3+7>>3,static_lenb=zip_static_len+3+7>>3,opt_lenb>=static_lenb&&(opt_lenb=static_lenb),opt_lenb>=stored_len+4&&zip_block_start>=0){var i;
for(zip_send_bits((zip_STORED_BLOCK<<1)+eof,3),zip_bi_windup(),zip_put_short(stored_len),zip_put_short(~stored_len),i=0;stored_len>i;i++)zip_put_byte(zip_window[zip_block_start+i])}else static_lenb==opt_lenb?(zip_send_bits((zip_STATIC_TREES<<1)+eof,3),zip_compress_block(zip_static_ltree,zip_static_dtree)):(zip_send_bits((zip_DYN_TREES<<1)+eof,3),zip_send_all_trees(zip_l_desc.max_code+1,zip_d_desc.max_code+1,max_blindex+1),zip_compress_block(zip_dyn_ltree,zip_dyn_dtree));zip_init_block(),0!=eof&&zip_bi_windup()},zip_ct_tally=function(dist,lc){if(zip_l_buf[zip_last_lit++]=lc,0==dist?zip_dyn_ltree[lc].fc++:(dist--,zip_dyn_ltree[zip_length_code[lc]+zip_LITERALS+1].fc++,zip_dyn_dtree[zip_D_CODE(dist)].fc++,zip_d_buf[zip_last_dist++]=dist,zip_flags|=zip_flag_bit),zip_flag_bit<<=1,0==(7&zip_last_lit)&&(zip_flag_buf[zip_last_flags++]=zip_flags,zip_flags=0,zip_flag_bit=1),zip_compr_level>2&&0==(4095&zip_last_lit)){var dcode,out_length=8*zip_last_lit,in_length=zip_strstart-zip_block_start;for(dcode=0;zip_D_CODES>dcode;dcode++)out_length+=zip_dyn_dtree[dcode].fc*(5+zip_extra_dbits[dcode]);if(out_length>>=3,zip_last_dist<parseInt(zip_last_lit/2)&&out_length<parseInt(in_length/2))return!0}return zip_last_lit==zip_LIT_BUFSIZE-1||zip_last_dist==zip_DIST_BUFSIZE},zip_compress_block=function(ltree,dtree){var dist,lc,code,extra,lx=0,dx=0,fx=0,flag=0;if(0!=zip_last_lit)do 0==(7&lx)&&(flag=zip_flag_buf[fx++]),lc=255&zip_l_buf[lx++],0==(1&flag)?zip_SEND_CODE(lc,ltree):(code=zip_length_code[lc],zip_SEND_CODE(code+zip_LITERALS+1,ltree),extra=zip_extra_lbits[code],0!=extra&&(lc-=zip_base_length[code],zip_send_bits(lc,extra)),dist=zip_d_buf[dx++],code=zip_D_CODE(dist),zip_SEND_CODE(code,dtree),extra=zip_extra_dbits[code],0!=extra&&(dist-=zip_base_dist[code],zip_send_bits(dist,extra))),flag>>=1;while(zip_last_lit>lx);zip_SEND_CODE(zip_END_BLOCK,ltree)},zip_Buf_size=16,zip_send_bits=function(value,length){zip_bi_valid>zip_Buf_size-length?(zip_bi_buf|=value<<zip_bi_valid,zip_put_short(zip_bi_buf),zip_bi_buf=value>>zip_Buf_size-zip_bi_valid,zip_bi_valid+=length-zip_Buf_size):(zip_bi_buf|=value<<zip_bi_valid,zip_bi_valid+=length)},zip_bi_reverse=function(code,len){var res=0;do res|=1&code,code>>=1,res<<=1;while(--len>0);return res>>1},zip_bi_windup=function(){zip_bi_valid>8?zip_put_short(zip_bi_buf):zip_bi_valid>0&&zip_put_byte(zip_bi_buf),zip_bi_buf=0,zip_bi_valid=0},zip_qoutbuf=function(){if(0!=zip_outcnt){var q,i;for(q=zip_new_queue(),null==zip_qhead?zip_qhead=zip_qtail=q:zip_qtail=zip_qtail.next=q,q.len=zip_outcnt-zip_outoff,i=0;i<q.len;i++)q.ptr[i]=zip_outbuf[zip_outoff+i];zip_outcnt=zip_outoff=0}},zip_deflate=function(str,level){var i,j;zip_deflate_data=str,zip_deflate_pos=0,"undefined"==typeof level&&(level=zip_DEFAULT_LEVEL),zip_deflate_start(level);for(var buff=new Array(1024),aout=[];(i=zip_deflate_internal(buff,0,buff.length))>0;){var cbuf=new Array(i);for(j=0;i>j;j++)cbuf[j]=String.fromCharCode(buff[j]);aout[aout.length]=cbuf.join("")}return zip_deflate_data=null,aout.join("")};JSZip.compressions.DEFLATE?JSZip.compressions.DEFLATE.compress=zip_deflate:JSZip.compressions.DEFLATE={magic:"\b\x00",compress:zip_deflate}}(),!JSZip)throw"JSZip not defined";!function(){function zip_HuftList(){this.next=null,this.list=null}function zip_HuftNode(){this.e=0,this.b=0,this.n=0,this.t=null}function zip_HuftBuild(b,n,s,d,e,mm){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var a,el,f,g,h,i,j,k,p,pidx,q,w,xp,y,z,o,tail,c=new Array(this.BMAX+1),lx=new Array(this.BMAX+1),r=new zip_HuftNode,u=new Array(this.BMAX),v=new Array(this.N_MAX),x=new Array(this.BMAX+1);for(tail=this.root=null,i=0;i<c.length;i++)c[i]=0;for(i=0;i<lx.length;i++)lx[i]=0;for(i=0;i<u.length;i++)u[i]=null;for(i=0;i<v.length;i++)v[i]=0;for(i=0;i<x.length;i++)x[i]=0;el=n>256?b[256]:this.BMAX,p=b,pidx=0,i=n;do c[p[pidx]]++,pidx++;while(--i>0);if(c[0]==n)return this.root=null,this.m=0,void(this.status=0);for(j=1;j<=this.BMAX&&0==c[j];j++);for(k=j,j>mm&&(mm=j),i=this.BMAX;0!=i&&0==c[i];i--);for(g=i,mm>i&&(mm=i),y=1<<j;i>j;j++,y<<=1)if((y-=c[j])<0)return this.status=2,void(this.m=mm);if((y-=c[i])<0)return this.status=2,void(this.m=mm);for(c[i]+=y,x[1]=j=0,p=c,pidx=1,xp=2;--i>0;)x[xp++]=j+=p[pidx++];p=b,pidx=0,i=0;do 0!=(j=p[pidx++])&&(v[x[j]++]=i);while(++i<n);for(n=x[g],x[0]=i=0,p=v,pidx=0,h=-1,w=lx[0]=0,q=null,z=0;g>=k;k++)for(a=c[k];a-->0;){for(;k>w+lx[1+h];){if(w+=lx[1+h],h++,z=(z=g-w)>mm?mm:z,(f=1<<(j=k-w))>a+1)for(f-=a+1,xp=k;++j<z&&!((f<<=1)<=c[++xp]);)f-=c[xp];for(w+j>el&&el>w&&(j=el-w),z=1<<j,lx[1+h]=j,q=new Array(z),o=0;z>o;o++)q[o]=new zip_HuftNode;tail=null==tail?this.root=new zip_HuftList:tail.next=new zip_HuftList,tail.next=null,tail.list=q,u[h]=q,h>0&&(x[h]=i,r.b=lx[h],r.e=16+j,r.t=q,j=(i&(1<<w)-1)>>w-lx[h],u[h-1][j].e=r.e,u[h-1][j].b=r.b,u[h-1][j].n=r.n,u[h-1][j].t=r.t)}for(r.b=k-w,pidx>=n?r.e=99:p[pidx]<s?(r.e=p[pidx]<256?16:15,r.n=p[pidx++]):(r.e=e[p[pidx]-s],r.n=d[p[pidx++]-s]),f=1<<k-w,j=i>>w;z>j;j+=f)q[j].e=r.e,q[j].b=r.b,q[j].n=r.n,q[j].t=r.t;for(j=1<<k-1;0!=(i&j);j>>=1)i^=j;for(i^=j;(i&(1<<w)-1)!=x[h];)w-=lx[h],h--}this.m=lx[1],this.status=0!=y&&1!=g?1:0}function zip_GET_BYTE(){return zip_inflate_data.length==zip_inflate_pos?-1:255&zip_inflate_data.charCodeAt(zip_inflate_pos++)}function zip_NEEDBITS(n){for(;n>zip_bit_len;)zip_bit_buf|=zip_GET_BYTE()<<zip_bit_len,zip_bit_len+=8}function zip_GETBITS(n){return zip_bit_buf&zip_MASK_BITS[n]}function zip_DUMPBITS(n){zip_bit_buf>>=n,zip_bit_len-=n}function zip_inflate_codes(buff,off,size){var e,t,n;if(0==size)return 0;for(n=0;;){for(zip_NEEDBITS(zip_bl),t=zip_tl.list[zip_GETBITS(zip_bl)],e=t.e;e>16;){if(99==e)return-1;zip_DUMPBITS(t.b),e-=16,zip_NEEDBITS(e),t=t.t[zip_GETBITS(e)],e=t.e}if(zip_DUMPBITS(t.b),16!=e){if(15==e)break;for(zip_NEEDBITS(e),zip_copy_leng=t.n+zip_GETBITS(e),zip_DUMPBITS(e),zip_NEEDBITS(zip_bd),t=zip_td.list[zip_GETBITS(zip_bd)],e=t.e;e>16;){if(99==e)return-1;zip_DUMPBITS(t.b),e-=16,zip_NEEDBITS(e),t=t.t[zip_GETBITS(e)],e=t.e}for(zip_DUMPBITS(t.b),zip_NEEDBITS(e),zip_copy_dist=zip_wp-t.n-zip_GETBITS(e),zip_DUMPBITS(e);zip_copy_leng>0&&size>n;)zip_copy_leng--,zip_copy_dist&=zip_WSIZE-1,zip_wp&=zip_WSIZE-1,buff[off+n++]=zip_slide[zip_wp++]=zip_slide[zip_copy_dist++];if(n==size)return size}else if(zip_wp&=zip_WSIZE-1,buff[off+n++]=zip_slide[zip_wp++]=t.n,n==size)return size}return zip_method=-1,n}function zip_inflate_stored(buff,off,size){var n;if(n=7&zip_bit_len,zip_DUMPBITS(n),zip_NEEDBITS(16),n=zip_GETBITS(16),zip_DUMPBITS(16),zip_NEEDBITS(16),n!=(65535&~zip_bit_buf))return-1;for(zip_DUMPBITS(16),zip_copy_leng=n,n=0;zip_copy_leng>0&&size>n;)zip_copy_leng--,zip_wp&=zip_WSIZE-1,zip_NEEDBITS(8),buff[off+n++]=zip_slide[zip_wp++]=zip_GETBITS(8),zip_DUMPBITS(8);return 0==zip_copy_leng&&(zip_method=-1),n}function zip_inflate_fixed(buff,off,size){if(null==zip_fixed_tl){var i,h,l=new Array(288);for(i=0;144>i;i++)l[i]=8;for(;256>i;i++)l[i]=9;for(;280>i;i++)l[i]=7;for(;288>i;i++)l[i]=8;if(zip_fixed_bl=7,h=new zip_HuftBuild(l,288,257,zip_cplens,zip_cplext,zip_fixed_bl),0!=h.status)return alert("HufBuild error: "+h.status),-1;for(zip_fixed_tl=h.root,zip_fixed_bl=h.m,i=0;30>i;i++)l[i]=5;if(zip_fixed_bd=5,h=new zip_HuftBuild(l,30,0,zip_cpdist,zip_cpdext,zip_fixed_bd),h.status>1)return zip_fixed_tl=null,alert("HufBuild error: "+h.status),-1;zip_fixed_td=h.root,zip_fixed_bd=h.m}return zip_tl=zip_fixed_tl,zip_td=zip_fixed_td,zip_bl=zip_fixed_bl,zip_bd=zip_fixed_bd,zip_inflate_codes(buff,off,size)}function zip_inflate_dynamic(buff,off,size){var i,j,l,n,t,nb,nl,nd,h,ll=new Array(316);for(i=0;i<ll.length;i++)ll[i]=0;if(zip_NEEDBITS(5),nl=257+zip_GETBITS(5),zip_DUMPBITS(5),zip_NEEDBITS(5),nd=1+zip_GETBITS(5),zip_DUMPBITS(5),zip_NEEDBITS(4),nb=4+zip_GETBITS(4),zip_DUMPBITS(4),nl>286||nd>30)return-1;for(j=0;nb>j;j++)zip_NEEDBITS(3),ll[zip_border[j]]=zip_GETBITS(3),zip_DUMPBITS(3);for(;19>j;j++)ll[zip_border[j]]=0;if(zip_bl=7,h=new zip_HuftBuild(ll,19,19,null,null,zip_bl),0!=h.status)return-1;for(zip_tl=h.root,zip_bl=h.m,n=nl+nd,i=l=0;n>i;)if(zip_NEEDBITS(zip_bl),t=zip_tl.list[zip_GETBITS(zip_bl)],j=t.b,zip_DUMPBITS(j),j=t.n,16>j)ll[i++]=l=j;else if(16==j){if(zip_NEEDBITS(2),j=3+zip_GETBITS(2),zip_DUMPBITS(2),i+j>n)return-1;for(;j-->0;)ll[i++]=l}else if(17==j){if(zip_NEEDBITS(3),j=3+zip_GETBITS(3),zip_DUMPBITS(3),i+j>n)return-1;for(;j-->0;)ll[i++]=0;l=0}else{if(zip_NEEDBITS(7),j=11+zip_GETBITS(7),zip_DUMPBITS(7),i+j>n)return-1;for(;j-->0;)ll[i++]=0;l=0}if(zip_bl=zip_lbits,h=new zip_HuftBuild(ll,nl,257,zip_cplens,zip_cplext,zip_bl),0==zip_bl&&(h.status=1),0!=h.status)return 1==h.status,-1;for(zip_tl=h.root,zip_bl=h.m,i=0;nd>i;i++)ll[i]=ll[i+nl];return zip_bd=zip_dbits,h=new zip_HuftBuild(ll,nd,0,zip_cpdist,zip_cpdext,zip_bd),zip_td=h.root,zip_bd=h.m,0==zip_bd&&nl>257?-1:(1==h.status,0!=h.status?-1:zip_inflate_codes(buff,off,size))}function zip_inflate_start(){null==zip_slide&&(zip_slide=new Array(2*zip_WSIZE)),zip_wp=0,zip_bit_buf=0,zip_bit_len=0,zip_method=-1,zip_eof=!1,zip_copy_leng=zip_copy_dist=0,zip_tl=null}function zip_inflate_internal(buff,off,size){var n,i;for(n=0;size>n;){if(zip_eof&&-1==zip_method)return n;if(zip_copy_leng>0){if(zip_method!=zip_STORED_BLOCK)for(;zip_copy_leng>0&&size>n;)zip_copy_leng--,zip_copy_dist&=zip_WSIZE-1,zip_wp&=zip_WSIZE-1,buff[off+n++]=zip_slide[zip_wp++]=zip_slide[zip_copy_dist++];else{for(;zip_copy_leng>0&&size>n;)zip_copy_leng--,zip_wp&=zip_WSIZE-1,zip_NEEDBITS(8),buff[off+n++]=zip_slide[zip_wp++]=zip_GETBITS(8),zip_DUMPBITS(8);0==zip_copy_leng&&(zip_method=-1)}if(n==size)return n}if(-1==zip_method){if(zip_eof)break;zip_NEEDBITS(1),0!=zip_GETBITS(1)&&(zip_eof=!0),zip_DUMPBITS(1),zip_NEEDBITS(2),zip_method=zip_GETBITS(2),zip_DUMPBITS(2),zip_tl=null,zip_copy_leng=0}switch(zip_method){case 0:i=zip_inflate_stored(buff,off+n,size-n);break;case 1:i=null!=zip_tl?zip_inflate_codes(buff,off+n,size-n):zip_inflate_fixed(buff,off+n,size-n);break;case 2:i=null!=zip_tl?zip_inflate_codes(buff,off+n,size-n):zip_inflate_dynamic(buff,off+n,size-n);break;default:i=-1}if(-1==i)return zip_eof?0:-1;n+=i}return n}function zip_inflate(str){var out,buff,i,j;for(zip_inflate_start(),zip_inflate_data=str,zip_inflate_pos=0,buff=new Array(1024),out="";(i=zip_inflate_internal(buff,0,buff.length))>0;)for(j=0;i>j;j++)out+=String.fromCharCode(buff[j]);return zip_inflate_data=null,out}var zip_fixed_bd,zip_slide,zip_wp,zip_fixed_td,zip_fixed_bl,zip_bit_buf,zip_bit_len,zip_method,zip_eof,zip_copy_leng,zip_copy_dist,zip_tl,zip_td,zip_bl,zip_bd,zip_inflate_data,zip_inflate_pos,zip_WSIZE=32768,zip_STORED_BLOCK=0,zip_lbits=9,zip_dbits=6,zip_fixed_tl=null,zip_MASK_BITS=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),zip_cplens=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),zip_cplext=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),zip_cpdist=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),zip_cpdext=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),zip_border=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);JSZip.compressions.DEFLATE?JSZip.compressions.DEFLATE.uncompress=zip_inflate:JSZip.compressions.DEFLATE={magic:"\b\x00",uncompress:zip_inflate}}(),function(){function StreamReader(stream){if(this.stream="",JSZip.support.uint8array&&stream instanceof Uint8Array)this.stream=JSZip.utils.uint8Array2String(stream);else if(JSZip.support.arraybuffer&&stream instanceof ArrayBuffer){var bufferView=new Uint8Array(stream);this.stream=JSZip.utils.uint8Array2String(bufferView)}else this.stream=JSZip.utils.string2binary(stream);this.index=0}function ZipEntry(options,loadOptions){this.options=options,this.loadOptions=loadOptions}function ZipEntries(data,loadOptions){this.files=[],this.loadOptions=loadOptions,data&&this.load(data)}var MAX_VALUE_16BITS=65535,MAX_VALUE_32BITS=-1,pretty=function(str){var code,i,res="";for(i=0;i<(str||"").length;i++)code=str.charCodeAt(i),res+="\\x"+(16>code?"0":"")+code.toString(16).toUpperCase();return res},findCompression=function(compressionMethod){for(var method in JSZip.compressions)if(JSZip.compressions.hasOwnProperty(method)&&JSZip.compressions[method].magic===compressionMethod)return JSZip.compressions[method];return null};StreamReader.prototype={checkOffset:function(offset){this.checkIndex(this.index+offset)},checkIndex:function(newIndex){if(this.stream.length<newIndex||0>newIndex)throw new Error("End of stream reached (stream length = "+this.stream.length+", asked index = "+newIndex+"). Corrupted zip ?")},setIndex:function(newIndex){this.checkIndex(newIndex),this.index=newIndex},skip:function(n){this.setIndex(this.index+n)},byteAt:function(i){return this.stream.charCodeAt(i)},readInt:function(size){var i,result=0;for(this.checkOffset(size),i=this.index+size-1;i>=this.index;i--)result=(result<<8)+this.byteAt(i);return this.index+=size,result},readString:function(size){this.checkOffset(size);var result=this.stream.slice(this.index,this.index+size);return this.index+=size,result},readDate:function(){var dostime=this.readInt(4);return new Date((dostime>>25&127)+1980,(dostime>>21&15)-1,dostime>>16&31,dostime>>11&31,dostime>>5&63,(31&dostime)<<1)}},ZipEntry.prototype={isEncrypted:function(){return 1===(1&this.bitFlag)},useUTF8:function(){return 2048===(2048&this.bitFlag)},readLocalPart:function(reader){var compression,localExtraFieldsLength;if(reader.skip(22),this.fileNameLength=reader.readInt(2),localExtraFieldsLength=reader.readInt(2),this.fileName=reader.readString(this.fileNameLength),reader.skip(localExtraFieldsLength),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(this.compressedFileData=reader.readString(this.compressedSize),compression=findCompression(this.compressionMethod),null===compression)throw new Error("Corrupted zip : compression "+pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.uncompressedFileData=compression.uncompress(this.compressedFileData),this.uncompressedFileData.length!==this.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch");if(this.loadOptions.checkCRC32&&JSZip.prototype.crc32(this.uncompressedFileData)!==this.crc32)throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(reader){if(this.versionMadeBy=reader.readString(2),this.versionNeeded=reader.readInt(2),this.bitFlag=reader.readInt(2),this.compressionMethod=reader.readString(2),this.date=reader.readDate(),this.crc32=reader.readInt(4),this.compressedSize=reader.readInt(4),this.uncompressedSize=reader.readInt(4),this.fileNameLength=reader.readInt(2),this.extraFieldsLength=reader.readInt(2),this.fileCommentLength=reader.readInt(2),this.diskNumberStart=reader.readInt(2),this.internalFileAttributes=reader.readInt(2),this.externalFileAttributes=reader.readInt(4),this.localHeaderOffset=reader.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=reader.readString(this.fileNameLength),this.readExtraFields(reader),this.parseZIP64ExtraField(reader),this.fileComment=reader.readString(this.fileCommentLength),this.dir=16&this.externalFileAttributes?!0:!1},parseZIP64ExtraField:function(){if(this.extraFields[1]){var extraReader=new StreamReader(this.extraFields[1].value);this.uncompressedSize===MAX_VALUE_32BITS&&(this.uncompressedSize=extraReader.readInt(8)),this.compressedSize===MAX_VALUE_32BITS&&(this.compressedSize=extraReader.readInt(8)),this.localHeaderOffset===MAX_VALUE_32BITS&&(this.localHeaderOffset=extraReader.readInt(8)),this.diskNumberStart===MAX_VALUE_32BITS&&(this.diskNumberStart=extraReader.readInt(4))}},readExtraFields:function(reader){var extraFieldId,extraFieldLength,extraFieldValue,start=reader.index;for(this.extraFields=this.extraFields||{};reader.index<start+this.extraFieldsLength;)extraFieldId=reader.readInt(2),extraFieldLength=reader.readInt(2),extraFieldValue=reader.readString(extraFieldLength),this.extraFields[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}},handleUTF8:function(){this.useUTF8()&&(this.fileName=JSZip.prototype.utf8decode(this.fileName),this.fileComment=JSZip.prototype.utf8decode(this.fileComment))}},ZipEntries.prototype={checkSignature:function(expectedSignature){var signature=this.reader.readString(4);if(signature!==expectedSignature)throw new Error("Corrupted zip or bug : unexpected signature ("+pretty(signature)+", expected "+pretty(expectedSignature)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var extraFieldId,extraFieldLength,extraFieldValue,extraDataSize=this.zip64EndOfCentralSize-44,index=0;extraDataSize>index;)extraFieldId=this.reader.readInt(2),extraFieldLength=this.reader.readInt(4),extraFieldValue=this.reader.readString(extraFieldLength),this.zip64ExtensibleData[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var i,file;for(i=0;i<this.files.length;i++)file=this.files[i],this.reader.setIndex(file.localHeaderOffset),this.checkSignature(JSZip.signature.LOCAL_FILE_HEADER),file.readLocalPart(this.reader),file.handleUTF8()},readCentralDir:function(){var file;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===JSZip.signature.CENTRAL_FILE_HEADER;)file=new ZipEntry({zip64:this.zip64},this.loadOptions),file.readCentralPart(this.reader),this.files.push(file)},readEndOfCentral:function(){var offset=this.reader.stream.lastIndexOf(JSZip.signature.CENTRAL_DIRECTORY_END);if(-1===offset)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(offset),this.checkSignature(JSZip.signature.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===MAX_VALUE_16BITS||this.diskWithCentralDirStart===MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===MAX_VALUE_16BITS||this.centralDirRecords===MAX_VALUE_16BITS||this.centralDirSize===MAX_VALUE_32BITS||this.centralDirOffset===MAX_VALUE_32BITS){if(this.zip64=!0,offset=this.reader.stream.lastIndexOf(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_LOCATOR),-1===offset)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(offset),this.checkSignature(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(JSZip.signature.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},load:function(data){this.reader=new StreamReader(data),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},JSZip.prototype.load=function(data,options){var files,zipEntries,i,input;for(options=options||{},options.base64&&(data=JSZipBase64.decode(data)),zipEntries=new ZipEntries(data,options),files=zipEntries.files,i=0;i<files.length;i++)input=files[i],this.file(input.fileName,input.uncompressedFileData,{binary:!0,optimizedBinaryString:!0,date:input.date,dir:input.dir});return this}}(),!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.mammoth=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){(function(Buffer){function openZip(options){return options.arrayBuffer?openArrayBuffer(options.arrayBuffer):q.reject(new Error("Could not find file in options"))}function openArrayBuffer(arrayBuffer){function exists(name){return null!==zipFile.file(name)}function read(name,encoding){var array=zipFile.file(name).asUint8Array(),buffer=new Buffer(array);return promises.when(encoding?buffer.toString(encoding):buffer)}var zipFile=new JSZip(arrayBuffer);return{exists:exists,read:read}}var promises=_dereq_("../lib/promises");exports.openZip=openZip}).call(this,_dereq_("buffer").Buffer)},{"../lib/promises":15,buffer:60}],2:[function(_dereq_,module,exports){function paragraph(styleName){return new Matcher("paragraph",styleName)}function run(styleName){return new Matcher("run",styleName)}function Matcher(elementType,styleName){this._elementType=elementType,this._styleName=styleName}function isList(element,levelIndex,isOrdered){return element.numbering&&element.numbering.level==levelIndex&&element.numbering.isOrdered==isOrdered}exports.paragraph=paragraph,exports.run=run,Matcher.prototype.matches=function(element){return element.type===this._elementType&&(void 0===this._styleName||element.styleName===this._styleName)&&(void 0===this._listIndex||isList(element,this._listIndex,this._listIsOrdered))},Matcher.prototype.orderedList=function(levelIndex){return this.list({isOrdered:!0,levelIndex:levelIndex})},Matcher.prototype.unorderedList=function(levelIndex){return this.list({isOrdered:!1,levelIndex:levelIndex})},Matcher.prototype.list=function(options){return this._listIndex=options.levelIndex,this._listIsOrdered=options.isOrdered,this}},{}],3:[function(_dereq_,module,exports){function DocumentConverter(options){function convertToHtml(document){var messages=[],html=new HtmlGenerator;return promises.nfcall(elementToHtml,document,html,messages).then(function(){return html.closeAll(),new results.Result(html.asString(),messages)})}function convertElements(elements,html,messages,callback){async.eachSeries(elements,function(element,callback){return elementToHtml(element,html,messages,callback)},callback)}function elementToHtml(element,html,messages,callback){var handler=elementConverters[element.type];handler?handler(element,html,messages,callback):callback()}function convertParagraph(element,html,messages,callback){html.satisfyPath(styleForParagraph(element,messages)),setImmediate(function(){convertElements(element.children,html,messages,callback)})}function styleForParagraph(element,messages){var style=findStyle(element);return style?style.to:(element.styleName&&messages.push(results.warning("Unrecognised paragraph style: "+element.styleName)),defaultParagraphStyle)}function convertRun(run,html,messages,callback){var runHtml=new HtmlGenerator;if(run.styleName){var style=findStyle(run);style?runHtml.satisfyPath(style.to):messages.push(results.warning("Unrecognised run style: "+run.styleName))}run.isBold&&runHtml.open(htmlPaths.element("strong")),run.isItalic&&runHtml.open(htmlPaths.element("em")),convertElements(run.children,runHtml,messages,function(err){err?callback(err):(runHtml.closeAll(),html.append(runHtml),callback())})}function findStyle(element){for(var i=0;i<styleMap.length;i++)if(styleMap[i].from.matches(element))return styleMap[i]}function defaultConvertImage(element,html,messages,callback){element.read("base64").then(function(imageBuffer){var src="data:"+element.contentType+";base64,"+imageBuffer,attributes={src:src};element.altText&&(attributes.alt=element.altText),html.selfClosing(htmlPaths.element("img",attributes)),callback()}).fail(callback)}options=options||{};var defaultParagraphStyle=htmlPaths.topLevelElement("p"),styleMap=options.styleMap||[],elementConverters={document:function(document,html,messages,callback){convertElements(document.children,html,messages,callback)},paragraph:convertParagraph,run:convertRun,text:function(element,html,messages,callback){html.text(element.value),callback()},tab:function(element,html,messages,callback){html.text("	"),callback()},hyperlink:function(element,html,messages,callback){html.open(htmlPaths.element("a",{href:element.href})),convertElements(element.children,html,messages,function(err){err?callback(err):(html.close(),callback())})},image:options.convertImage||defaultConvertImage};return{convertToHtml:convertToHtml}}var promises=_dereq_("./promises"),async=_dereq_("async"),htmlPaths=_dereq_("./html-paths"),HtmlGenerator=_dereq_("./html-generator").HtmlGenerator,results=_dereq_("./results");if(exports.DocumentConverter=DocumentConverter,"undefined"==typeof setImmediate)var setImmediate=function(callback){setTimeout(callback,0)}},{"./html-generator":11,"./html-paths":12,"./promises":15,"./results":16,async:19}],4:[function(_dereq_,module,exports){function Document(children){return{type:"document",children:children}}function Paragraph(children,properties){return properties=properties||{},{type:"paragraph",children:children,styleName:properties.styleName||null,numbering:properties.numbering||null,alignment:properties.alignment||null}}function Run(children,properties){return properties=properties||{},{type:"run",children:children,styleName:properties.styleName||null,isBold:properties.isBold,isItalic:properties.isItalic}}function Text(value){return{type:"text",value:value}}function Tab(){return{type:"tab"}}function Hyperlink(children,options){return{type:"hyperlink",children:children,href:options.href}}function Image(options){return{type:"image",read:options.readImage,altText:options.altText,contentType:options.contentType}}exports.Document=Document,exports.Paragraph=Paragraph,exports.Run=Run,exports.Text=Text,exports.Tab=Tab,exports.Hyperlink=Hyperlink,exports.Image=Image},{}],5:[function(_dereq_,module,exports){function readContentTypesFromXml(xml){var extensionDefaults={},overrides={};return xml.root.children.forEach(function(child){if("content-types:Default"===child.name&&(extensionDefaults[child.attributes.Extension]=child.attributes.ContentType),"content-types:Override"===child.name){var name=child.attributes.PartName;"/"===name.charAt(0)&&(name=name.substring(1)),overrides[name]=child.attributes.ContentType}}),{findContentType:function(path){var overrideContentType=overrides[path];if(overrideContentType)return overrideContentType;var pathParts=path.split("."),extension=pathParts[pathParts.length-1];return extensionDefaults[extension]}}}exports.readContentTypesFromXml=readContentTypesFromXml,exports.defaultContentTypes={findContentType:function(){return null}}},{}],6:[function(_dereq_,module,exports){function DocumentXmlReader(relationships,contentTypes,docxFile,numbering){function convertXmlToDocument(documentXml){var body=documentXml.root.first("w:body"),result=readXmlElements(body.children).map(function(children){return new documents.Document(children)});return result.document=result.value,result}function readXmlElements(elements){var results=elements.map(readXmlElement);return Result.combine(results)}function readXmlElement(element){if("element"===element.type){var handler=xmlElementReaders[element.name];if(handler)return handler(element);if(!Object.prototype.hasOwnProperty.call(ignoreElements,element.name))return new Result([],[warning("An unrecognised element was ignored: "+element.name)])}return new Result([])}function readChildElements(element){return readXmlElements(element.children)}function readDrawingElement(element){var blips=element.getElementsByTagName("a:graphic").getElementsByTagName("a:graphicData").getElementsByTagName("pic:pic").getElementsByTagName("pic:blipFill").getElementsByTagName("a:blip"),results=blips.map(function(blip){var relationshipId=blip.attributes["r:embed"],imagePath=joinZipPath("word",relationships[relationshipId].target),readImage=docxFile.read.bind(docxFile,imagePath),altText=element.first("wp:docPr").attributes.descr,image=documents.Image({readImage:readImage,altText:altText,contentType:contentTypes.findContentType(imagePath)});return new Result(image)});return Result.combine(results)}var xmlElementReaders={"w:p":function(element){return readXmlElements(element.children).map(function(children){var properties=_.find(children,isParagraphProperties);return new documents.Paragraph(children.filter(negate(isParagraphProperties)),properties)})},"w:pPr":function(element){var properties={type:"paragraphProperties"},styleElement=element.first("w:pStyle");styleElement&&(properties.styleName=styleElement.attributes["w:val"]);var alignElement=element.first("w:jc");alignElement&&(properties.alignment=alignElement.attributes["w:val"]);var numberingPropertiesElement=element.first("w:numPr");if(numberingPropertiesElement){var levelElement=numberingPropertiesElement.first("w:ilvl"),level=levelElement.attributes["w:val"],numId=numberingPropertiesElement.first("w:numId").attributes["w:val"];properties.numbering=numbering.findLevel(numId,level)}return new Result(properties)},"w:r":function(element){return readXmlElements(element.children).map(function(children){var properties=_.find(children,isRunProperties);return new documents.Run(children.filter(negate(isRunProperties)),properties)})},"w:rPr":function(element){var properties={type:"runProperties"},styleElement=element.first("w:rStyle");return styleElement&&(properties.styleName=styleElement.attributes["w:val"]),properties.isBold=!!element.first("w:b"),properties.isItalic=!!element.first("w:i"),new Result(properties)},"w:t":function(element){return new Result(new documents.Text(element.children[0].value))},"w:tab":function(){return new Result(new documents.Tab)},"w:hyperlink":function(element){var relationshipId=element.attributes["r:id"];return readXmlElements(element.children).map(function(children){if(relationshipId){var href=relationships[relationshipId].target;return new documents.Hyperlink(children,{href:href})}return children})},"w:ins":readChildElements,"w:smartTag":readChildElements,"w:drawing":readChildElements,"wp:inline":readDrawingElement,"wp:anchor":readDrawingElement};return{convertXmlToDocument:convertXmlToDocument,readXmlElement:readXmlElement}}function isParagraphProperties(element){return"paragraphProperties"===element.type}function isRunProperties(element){return"runProperties"===element.type}function negate(predicate){return function(value){return!predicate(value)}}function joinZipPath(first,second){return first+"/"+second}exports.DocumentXmlReader=DocumentXmlReader;var _=_dereq_("underscore"),documents=(_dereq_("../promises"),_dereq_("../documents")),Result=_dereq_("../results").Result,warning=_dereq_("../results").warning,ignoreElements={"w:bookmarkStart":!0,"w:bookmarkEnd":!0,"w:sectPr":!0,"w:proofErr":!0,"w:lastRenderedPageBreak":!0,"w:commentRangeStart":!0,"w:commentRangeEnd":!0,"w:commentReference":!0,"w:del":!0}},{"../documents":4,"../promises":15,"../results":16,underscore:91}],7:[function(_dereq_,module,exports){function read(options){var docxFile=unzip.openZip(options);return promises.when(docxFile).then(function(docxFile){return promises.all([readRelationshipsFromZipFile(docxFile),readContentTypesFromZipFile(docxFile),readNumberingFromZipFile(docxFile),readXmlFromZipFile(docxFile,"word/document.xml")]).spread(function(relationships,contentTypes,numbering,documentXml){var reader=new DocumentXmlReader(relationships,contentTypes,docxFile,numbering);
return reader.convertXmlToDocument(documentXml)})})}function xmlFileReader(options){return function(zipFile){return readXmlFromZipFile(zipFile,options.filename).then(function(element){return element?options.readElement(element):options.defaultValue})}}exports.read=read;var promises=_dereq_("../promises"),unzip=_dereq_("../unzip"),readXmlFromZipFile=_dereq_("./office-xml-reader").readXmlFromZipFile,DocumentXmlReader=(_dereq_("../documents"),_dereq_("./document-xml-reader").DocumentXmlReader),relationshipsReader=_dereq_("./relationships-reader"),contentTypesReader=_dereq_("./content-types-reader"),numberingXml=_dereq_("./numbering-xml"),readContentTypesFromZipFile=xmlFileReader({filename:"[Content_Types].xml",readElement:contentTypesReader.readContentTypesFromXml,defaultValue:contentTypesReader.defaultContentTypes}),readRelationshipsFromZipFile=xmlFileReader({filename:"word/_rels/document.xml.rels",readElement:relationshipsReader.readRelationships,defaultValue:{}}),readNumberingFromZipFile=xmlFileReader({filename:"word/numbering.xml",readElement:numberingXml.readNumberingXml,defaultValue:numberingXml.defaultNumbering})},{"../documents":4,"../promises":15,"../unzip":1,"./content-types-reader":5,"./document-xml-reader":6,"./numbering-xml":8,"./office-xml-reader":9,"./relationships-reader":10}],8:[function(_dereq_,module,exports){function Numbering(nums){return{findLevel:function(numId,level){var num=nums[numId];return num?num[level]:null}}}function readNumberingXml(xml){var abstractNums=readAbstractNums(xml),nums=readNums(xml,abstractNums);return new Numbering(nums)}function readAbstractNums(xml){var abstractNums={};return xml.root.getElementsByTagName("w:abstractNum").forEach(function(element){var id=element.attributes["w:abstractNumId"];abstractNums[id]=readAbstractNum(element)}),abstractNums}function readAbstractNum(element){var levels={};return element.getElementsByTagName("w:lvl").forEach(function(levelElement){var levelIndex=levelElement.attributes["w:ilvl"],numFmt=levelElement.first("w:numFmt").attributes["w:val"];levels[levelIndex]={isOrdered:"bullet"!==numFmt,level:levelIndex}}),levels}function readNums(xml,abstractNums){var nums={};return xml.root.getElementsByTagName("w:num").forEach(function(element){var id=element.attributes["w:numId"],abstractNumId=element.first("w:abstractNumId").attributes["w:val"];nums[id]=abstractNums[abstractNumId]}),nums}exports.readNumberingXml=readNumberingXml,exports.Numbering=Numbering,exports.defaultNumbering=new Numbering({})},{}],9:[function(_dereq_,module,exports){function read(xmlString){return xmlreader.read(xmlString,xmlNamespaceMap)}function readXmlFromZipFile(docxFile,path){return docxFile.exists(path)?docxFile.read(path,"utf-8").then(read):promises.resolve(null)}var promises=_dereq_("../promises"),xmlreader=_dereq_("../xmlreader");exports.readXmlFromZipFile=readXmlFromZipFile;var xmlNamespaceMap={"http://schemas.openxmlformats.org/wordprocessingml/2006/main":"w","http://schemas.openxmlformats.org/officeDocument/2006/relationships":"r","http://schemas.openxmlformats.org/drawingml/2006/wordprocessingDrawing":"wp","http://schemas.openxmlformats.org/drawingml/2006/main":"a","http://schemas.openxmlformats.org/drawingml/2006/picture":"pic","http://schemas.openxmlformats.org/package/2006/content-types":"content-types"}},{"../promises":15,"../xmlreader":18}],10:[function(_dereq_,module,exports){function readRelationships(relationshipsXml){var relationships={};return relationshipsXml.root.children.forEach(function(child){"{http://schemas.openxmlformats.org/package/2006/relationships}:Relationship"===child.name&&(relationships[child.attributes.Id]={target:child.attributes.Target})}),relationships}exports.readRelationships=readRelationships},{}],11:[function(_dereq_,module,exports){function HtmlGenerator(){function text(value){value.length>0&&(writeAll(),fragments.push(escapeHtml(value)))}function asString(){return fragments.join("")}function append(otherHtmlGenerator){otherHtmlGenerator._fragments.length>0&&writeAll(),otherHtmlGenerator._fragments.forEach(function(fragment){fragments.push(fragment)})}function satisfyPath(style){for(var firstFreshPartIndex=findIndex(style,function(part){return part.fresh}),partIndex=0;firstFreshPartIndex>partIndex&&stylePartMatchesStackElement(style[partIndex],stack[partIndex]);)partIndex++;for(;stack.length>partIndex;)close();for(;partIndex<style.length;partIndex++)open(style[partIndex])}function stylePartMatchesStackElement(stylePart,stackElement){return stackElement&&stylePart.matchesElement(stackElement)}function open(htmlPathElement){var stackElement=Object.create(htmlPathElement);stackElement.written=!1,stack.push(stackElement)}function close(){var element=stack.pop();element.written&&fragments.push(util.format("</%s>",element.tagName))}function closeAll(){for(;stack.length>0;)close()}function writeAll(){stack.filter(function(element){return!element.written}).forEach(writeElement)}function writeElement(element){element.written=!0;var attributeString=generateAttributeString(element.attributes);fragments.push(util.format("<%s%s>",element.tagName,attributeString))}function selfClosing(element){var attributeString=generateAttributeString(element.attributes);fragments.push(util.format("<%s%s />",element.tagName,attributeString))}function generateAttributeString(attributes){return _.map(attributes,function(value,key){return util.format(' %s="%s"',key,escapeHtml(value))}).join("")}var stack=[],fragments=[];return{satisfyPath:satisfyPath,text:text,open:open,close:close,closeAll:closeAll,asString:asString,append:append,selfClosing:selfClosing,_fragments:fragments}}function escapeHtml(value){return value.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function findIndex(array,predicate){for(var i=0;i<array.length;i++)if(predicate(array[i]))return i;return-1}var util=_dereq_("util"),_=_dereq_("underscore");exports.HtmlGenerator=HtmlGenerator},{underscore:91,util:75}],12:[function(_dereq_,module,exports){function topLevelElement(tagName,attributes){return elements([element(tagName,attributes,{fresh:!0})])}function elements(elementStyles){return elementStyles.map(function(elementStyle){return _.isString(elementStyle)?element(elementStyle):elementStyle})}function element(tagName,attributes,options){return options=options||{},new Element(tagName,attributes,options)}function Element(tagName,attributes,options){var tagNames={};_.isArray(tagName)?(tagName.forEach(function(tagName){tagNames[tagName]=!0}),tagName=tagName[0]):tagNames[tagName]=!0,this.tagName=tagName,this.tagNames=tagNames,this.attributes=attributes||{},this.fresh=options.fresh}var _=_dereq_("underscore");exports.topLevelElement=topLevelElement,exports.elements=elements,exports.element=element,Element.prototype.matchesElement=function(element){return this.tagNames[element.tagName]&&_.isEqual(this.attributes||{},element.attributes||{})}},{underscore:91}],13:[function(_dereq_,module,exports){function convertToHtml(input,options){var fullOptions=readOptions(options);return docxReader.read(input).then(function(documentResult){return documentResult.map(fullOptions.transformDocument)}).then(function(documentResult){return convertDocumentToHtml(documentResult,fullOptions)})}function convertDocumentToHtml(documentResult,options){var documentConverter=new DocumentConverter(options);return documentResult.flatMapThen(function(document){return documentConverter.convertToHtml(document)})}var docxReader=_dereq_("./docx/docx-reader"),DocumentConverter=_dereq_("./document-to-html").DocumentConverter,styleMapping=_dereq_("./style-reader").readStyle,readOptions=_dereq_("./options-reader").readOptions;exports.convertToHtml=convertToHtml,exports.styleMapping=styleMapping},{"./document-to-html":3,"./docx/docx-reader":7,"./options-reader":14,"./style-reader":17}],14:[function(_dereq_,module,exports){function readOptions(options){options=options||{};var fullOptions={};return _.extend(fullOptions,standardOptions,options),fullOptions.styleMap=readStyleMap(options).concat(fullOptions.includeDefaultStyleMap?standardOptions.styleMap:[]),fullOptions}function readStyleMap(options){var customStyleMap=readCustomStyleMap(options.styleMap);return customStyleMap}function readCustomStyleMap(styleMap){return styleMap?_.isString(styleMap)?styleMap.split("\n").map(function(line){return style(line.trim())}):styleMap:[]}function identity(value){return value}exports.readOptions=readOptions;var _=_dereq_("underscore"),style=_dereq_("./style-reader").readStyle,standardOptions=exports._standardOptions={styleMap:[style("p.Heading1 => h1:fresh"),style("p.Heading2 => h2:fresh"),style("p.Heading3 => h3:fresh"),style("p.Heading4 => h4:fresh"),style("p:unordered-list(1) => ul > li:fresh"),style("p:unordered-list(2) => ul|ol > li > ul > li:fresh"),style("p:unordered-list(3) => ul|ol > li > ul|ol > li > ul > li:fresh"),style("p:unordered-list(4) => ul|ol > li > ul|ol > li > ul|ol > li > ul > li:fresh"),style("p:unordered-list(5) => ul|ol > li > ul|ol > li > ul|ol > li > ul|ol > li > ul > li:fresh"),style("p:ordered-list(1) => ol > li:fresh"),style("p:ordered-list(2) => ul|ol > li > ol > li:fresh"),style("p:ordered-list(3) => ul|ol > li > ul|ol > li > ol > li:fresh"),style("p:ordered-list(4) => ul|ol > li > ul|ol > li > ul|ol > li > ol > li:fresh"),style("p:ordered-list(5) => ul|ol > li > ul|ol > li > ul|ol > li > ul|ol > li > ol > li:fresh")],transformDocument:identity,includeDefaultStyleMap:!0}},{"./style-reader":17,underscore:91}],15:[function(_dereq_,module,exports){{var bluebird=_dereq_("bluebird/js/main/promise")();_dereq_("underscore")}exports.defer=bluebird.defer,exports.when=bluebird.resolve,exports.resolve=bluebird.resolve,exports.all=bluebird.all,exports.nfcall=function(func){var args=Array.prototype.slice.call(arguments,1),promisedFunc=bluebird.promisify(func);return promisedFunc.apply(null,args)},bluebird.prototype.fail=bluebird.prototype.caught},{"bluebird/js/main/promise":37,underscore:91}],16:[function(_dereq_,module,exports){function Result(value,messages){this.value=value,this.messages=messages||[]}function warning(message){return{type:"warning",message:message}}function combineMessages(results){var messages=[];return _.flatten(_.pluck(results,"messages"),!0).forEach(function(message){containsMessage(messages,message)||messages.push(message)}),messages}function containsMessage(messages,message){return void 0!==_.find(messages,isSameMessage.bind(null,message))}function isSameMessage(first,second){return first.type===second.type&&first.message===second.message}var _=_dereq_("underscore");exports.Result=Result,exports.warning=warning,Result.prototype.map=function(func){return new Result(func(this.value),this.messages)},Result.prototype.flatMapThen=function(func){var that=this;return func(this.value).then(function(otherResult){return new Result(otherResult.value,combineMessages([that,otherResult]))})},Result.combine=function(results){var values=_.flatten(_.pluck(results,"value")),messages=combineMessages(results);return new Result(values,messages)}},{underscore:91}],17:[function(_dereq_,module,exports){function readStyle(string){return parseString(styleRule(),string)}function styleRule(){return lop.rules.sequence(lop.rules.sequence.capture(documentMatcherRule()),lop.rules.tokenOfType("whitespace"),lop.rules.tokenOfType("arrow"),lop.rules.tokenOfType("whitespace"),lop.rules.sequence.capture(htmlPathRule())).map(function(documentMatcher,htmlPath){return{from:documentMatcher,to:htmlPath}})}function readDocumentMatcher(string){return parseString(documentMatcherRule(),string)}function documentMatcherRule(){var sequence=lop.rules.sequence,identifierToConstant=function(identifier,constant){return lop.rules.then(lop.rules.token("identifier",identifier),function(){return constant})},paragraphRule=identifierToConstant("p",documentMatchers.paragraph),runRule=identifierToConstant("r",documentMatchers.run),elementTypeRule=lop.rules.firstOf("p or r",paragraphRule,runRule),listTypeRule=lop.rules.firstOf("list type",identifierToConstant("ordered-list",{isOrdered:!0}),identifierToConstant("unordered-list",{isOrdered:!1})),listRule=sequence(lop.rules.tokenOfType("colon"),sequence.capture(listTypeRule),sequence.cut(),lop.rules.tokenOfType("open-paren"),sequence.capture(integerRule),lop.rules.tokenOfType("close-paren")).map(function(listType,levelNumber){return function(matcher){return matcher.list({isOrdered:listType.isOrdered,levelIndex:levelNumber-1})}}),optionalListRule=lop.rules.then(lop.rules.optional(listRule),function(option){return option.valueOrElse(function(){return function(matcher){return matcher}})});return sequence(sequence.capture(elementTypeRule),sequence.capture(lop.rules.optional(classRule)),sequence.capture(optionalListRule)).map(function(createMatcher,styleName,applyList){return applyList(createMatcher(styleName.valueOrElse()))})}function readHtmlPath(string){return parseString(htmlPathRule(),string)}function htmlPathRule(){var capture=lop.rules.sequence.capture,whitespaceRule=lop.rules.tokenOfType("whitespace"),freshRule=lop.rules.then(lop.rules.optional(lop.rules.sequence(lop.rules.tokenOfType("colon"),lop.rules.token("identifier","fresh"))),function(option){return option.map(function(){return!0}).valueOrElse(!1)}),tagNamesRule=lop.rules.oneOrMoreWithSeparator(identifierRule,lop.rules.tokenOfType("choice")),styleElementRule=lop.rules.sequence(capture(tagNamesRule),capture(lop.rules.zeroOrMore(classRule)),capture(freshRule)).map(function(tagName,classNames,fresh){var attributes={},options={};return classNames.length>0&&(attributes["class"]=classNames.join(" ")),fresh&&(options.fresh=!0),htmlPaths.element(tagName,attributes,options)});return lop.rules.then(lop.rules.zeroOrMoreWithSeparator(styleElementRule,lop.rules.sequence(whitespaceRule,lop.rules.tokenOfType("gt"),whitespaceRule)),htmlPaths.elements)}function parseString(rule,string){var tokens=tokenise(string),parser=lop.Parser(),parseResult=parser.parseTokens(rule,tokens);if(!parseResult.isSuccess())throw new Error("Failed to parse: "+describeFailure(parseResult));return parseResult.value()}function describeFailure(parseResult){function describeError(error){return error.describe()}return parseResult.errors().map(describeError).join("\n")}function tokenise(string){var tokeniser=new RegexTokeniser([{name:"identifier",regex:/([a-zA-Z][a-zA-Z0-9\-]*)/},{name:"dot",regex:/\./},{name:"colon",regex:/:/},{name:"gt",regex:/>/},{name:"whitespace",regex:/\s+/},{name:"arrow",regex:/=>/},{name:"open-paren",regex:/\(/},{name:"close-paren",regex:/\)/},{name:"integer",regex:/([0-9]+)/},{name:"choice",regex:/\|/}]);return tokeniser.tokenise(string)}var lop=_dereq_("lop"),RegexTokeniser=lop.RegexTokeniser,documentMatchers=_dereq_("./document-matchers"),htmlPaths=_dereq_("./html-paths");exports.readHtmlPath=readHtmlPath,exports.readDocumentMatcher=readDocumentMatcher,exports.readStyle=readStyle;var identifierRule=lop.rules.tokenOfType("identifier"),integerRule=lop.rules.tokenOfType("integer"),classRule=lop.rules.sequence(lop.rules.tokenOfType("dot"),lop.rules.sequence.capture(identifierRule)).head()},{"./document-matchers":2,"./html-paths":12,lop:77}],18:[function(_dereq_,module,exports){function read(xmlString,namespaceMap){function mapName(node){if(node.uri){var prefix,mappedPrefix=namespaceMap[node.uri];return prefix=mappedPrefix?mappedPrefix:"{"+node.uri+"}",prefix+":"+node.local}return node.local}namespaceMap=namespaceMap||{};var finished=!1,parser=sax.parser(!0,{xmlns:!0,position:!1}),rootElement={children:[]},currentElement=rootElement,stack=[],deferred=promises.defer();return parser.onopentag=function(node){var attributes=mapObject(node.attributes,function(attribute){return attribute.value},mapName),element=new Element(mapName(node),attributes);currentElement.children.push(element),stack.push(currentElement),currentElement=element},parser.onclosetag=function(){currentElement=stack.pop()},parser.ontext=function(text){currentElement!==rootElement&&currentElement.children.push({type:"text",value:text})},parser.onend=function(){finished||(finished=!0,deferred.resolve({root:rootElement.children[0]}))},parser.onerror=function(error){finished||(finished=!0,deferred.reject(error))},parser.write(xmlString).close(),deferred.promise}function mapObject(input,valueFunc,keyFunc){return _.reduce(input,function(result,value,key){var mappedKey=keyFunc.call(null,value,key,input);return result[mappedKey]=valueFunc.call(null,value,key,input),result},{})}function Element(name,attributes,children){this.type="element",this.name=name,this.attributes=attributes||{},this.children=children||[]}function toElementList(array){return _.extend(array,elementListPrototype)}var promises=_dereq_("./promises"),sax=_dereq_("sax"),_=_dereq_("underscore");exports.read=read,exports.Element=Element,Element.prototype.first=function(name){return _.find(this.children,function(child){return child.name==name})},Element.prototype.getElementsByTagName=function(name){var elements=_.filter(this.children,function(child){return child.name==name});return toElementList(elements)};var elementListPrototype={getElementsByTagName:function(name){return toElementList(_.flatten(this.map(function(element){return element.getElementsByTagName(name)},!0)))}}},{"./promises":15,sax:90,underscore:91}],19:[function(_dereq_,module){(function(process){!function(){function only_once(fn){var called=!1;return function(){if(called)throw new Error("Callback was already called.");called=!0,fn.apply(root,arguments)}}var root,previous_async,async={};root=this,null!=root&&(previous_async=root.async),async.noConflict=function(){return root.async=previous_async,async};var _each=function(arr,iterator){if(arr.forEach)return arr.forEach(iterator);for(var i=0;i<arr.length;i+=1)iterator(arr[i],i,arr)},_map=function(arr,iterator){if(arr.map)return arr.map(iterator);var results=[];return _each(arr,function(x,i,a){results.push(iterator(x,i,a))}),results},_reduce=function(arr,iterator,memo){return arr.reduce?arr.reduce(iterator,memo):(_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)}),memo)},_keys=function(obj){if(Object.keys)return Object.keys(obj);var keys=[];for(var k in obj)obj.hasOwnProperty(k)&&keys.push(k);return keys};"undefined"!=typeof process&&process.nextTick?(async.nextTick=process.nextTick,async.setImmediate="undefined"!=typeof setImmediate?function(fn){setImmediate(fn)}:async.nextTick):"function"==typeof setImmediate?(async.nextTick=function(fn){setImmediate(fn)},async.setImmediate=async.nextTick):(async.nextTick=function(fn){setTimeout(fn,0)},async.setImmediate=async.nextTick),async.each=function(arr,iterator,callback){if(callback=callback||function(){},!arr.length)return callback();var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length&&callback(null))}))})},async.forEach=async.each,async.eachSeries=function(arr,iterator,callback){if(callback=callback||function(){},!arr.length)return callback();var completed=0,iterate=function(){iterator(arr[completed],function(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length?callback(null):iterate())})};iterate()},async.forEachSeries=async.eachSeries,async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])},async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){if(callback=callback||function(){},!arr.length||0>=limit)return callback();var completed=0,started=0,running=0;!function replenish(){if(completed>=arr.length)return callback();for(;limit>running&&started<arr.length;)started+=1,running+=1,iterator(arr[started-1],function(err){err?(callback(err),callback=function(){}):(completed+=1,running-=1,completed>=arr.length?callback():replenish())})}()}},doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}},doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}},doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}},_asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v,callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap),async.mapSeries=doSeries(_asyncMap),async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v,callback(err)})},function(err){callback(err,memo)})},async.inject=async.reduce,async.foldl=async.reduce,async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)},async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(v){v&&results.push(x),callback()})},function(){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter),async.filterSeries=doSeries(_filter),async.select=async.filter,async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(v){v||results.push(x),callback()})},function(){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject),async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){result?(main_callback(x),main_callback=function(){}):callback()})},function(){main_callback()})};async.detect=doParallel(_detect),async.detectSeries=doSeries(_detect),async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){v&&(main_callback(!0),main_callback=function(){}),callback()})},function(){main_callback(!1)})},async.any=async.some,async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){v||(main_callback(!1),main_callback=function(){}),callback()})},function(){main_callback(!0)})},async.all=async.every,async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){err?callback(err):callback(null,{value:x,criteria:criteria})})},function(err,results){if(err)return callback(err);var fn=function(left,right){var a=left.criteria,b=right.criteria;return b>a?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))})},async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length)return callback(null);var results={},listeners=[],addListener=function(fn){listeners.unshift(fn)},removeListener=function(fn){for(var i=0;i<listeners.length;i+=1)if(listeners[i]===fn)return void listeners.splice(i,1)},taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){_keys(results).length===keys.length&&(callback(null,results),callback=function(){})}),_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k],taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1&&(args=args[0]),err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]}),safeResults[k]=args,callback(err,safeResults),callback=function(){}}else results[k]=args,async.setImmediate(taskComplete)},requires=task.slice(0,Math.abs(task.length-1))||[],ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},!0)&&!results.hasOwnProperty(k)};if(ready())task[task.length-1](taskCallback,results);else{var listener=function(){ready()&&(removeListener(listener),task[task.length-1](taskCallback,results))};addListener(listener)}})},async.waterfall=function(tasks,callback){if(callback=callback||function(){},tasks.constructor!==Array){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length)return callback();var wrapIterator=function(iterator){return function(err){if(err)callback.apply(null,arguments),callback=function(){};else{var args=Array.prototype.slice.call(arguments,1),next=iterator.next();args.push(next?wrapIterator(next):callback),async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){if(callback=callback||function(){},tasks.constructor===Array)eachfn.map(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)},async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)},async.series=function(tasks,callback){if(callback=callback||function(){},tasks.constructor===Array)async.mapSeries(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}},async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){return tasks.length&&tasks[index].apply(null,arguments),fn.next()};return fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null},fn};return makeCallback(0)},async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]),cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat),async.concatSeries=doSeries(_concat),async.whilst=function(test,iterator,callback){test()?iterator(function(err){return err?callback(err):void async.whilst(test,iterator,callback)}):callback()},async.doWhilst=function(iterator,test,callback){iterator(function(err){return err?callback(err):void(test()?async.doWhilst(iterator,test,callback):callback())})},async.until=function(test,iterator,callback){test()?callback():iterator(function(err){return err?callback(err):void async.until(test,iterator,callback)})},async.doUntil=function(iterator,test,callback){iterator(function(err){return err?callback(err):void(test()?callback():async.doUntil(iterator,test,callback))})},async.queue=function(worker,concurrency){function _insert(q,data,pos,callback){data.constructor!==Array&&(data=[data]),_each(data,function(task){var item={data:task,callback:"function"==typeof callback?callback:null};pos?q.tasks.unshift(item):q.tasks.push(item),q.saturated&&q.tasks.length===concurrency&&q.saturated(),async.setImmediate(q.process)})}void 0===concurrency&&(concurrency=1);var workers=0,q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,!1,callback)},unshift:function(data,callback){_insert(q,data,!0,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();q.empty&&0===q.tasks.length&&q.empty(),workers+=1;var next=function(){workers-=1,task.callback&&task.callback.apply(task,arguments),q.drain&&q.tasks.length+workers===0&&q.drain(),q.process()},cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers}};return q},async.cargo=function(worker,payload){var working=!1,tasks=[],cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){data.constructor!==Array&&(data=[data]),_each(data,function(task){tasks.push({data:task,callback:"function"==typeof callback?callback:null}),cargo.saturated&&tasks.length===payload&&cargo.saturated()}),async.setImmediate(cargo.process)},process:function process(){if(!working){if(0===tasks.length)return void(cargo.drain&&cargo.drain());var ts="number"==typeof payload?tasks.splice(0,payload):tasks.splice(0),ds=_map(ts,function(task){return task.data});cargo.empty&&cargo.empty(),working=!0,worker(ds,function(){working=!1;var args=arguments;_each(ts,function(data){data.callback&&data.callback.apply(null,args)}),process()})}},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(err?console.error&&console.error(err):console[name]&&_each(args,function(x){console[name](x)}))}]))}};async.log=_console_fn("log"),async.dir=_console_fn("dir"),async.memoize=function(fn,hasher){var memo={},queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments),callback=args.pop(),key=hasher.apply(null,args);key in memo?callback.apply(null,memo[key]):key in queues?queues[key].push(callback):(queues[key]=[callback],fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;l>i;i++)q[i].apply(null,arguments)}])))};return memoized.memo=memo,memoized.unmemoized=fn,memoized},async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}},async.times=function(count,iterator,callback){for(var counter=[],i=0;count>i;i++)counter.push(i);return async.map(counter,iterator,callback)},async.timesSeries=function(count,iterator,callback){for(var counter=[],i=0;count>i;i++)counter.push(i);return async.mapSeries(counter,iterator,callback)},async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0],nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};var _applyEach=function(eachfn,fns){var go=function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}return go};async.applyEach=doParallel(_applyEach),async.applyEachSeries=doSeries(_applyEach),async.forever=function(fn,callback){function next(err){if(err){if(callback)return callback(err);throw err}fn(next)}next()},"undefined"!=typeof define&&define.amd?define([],function(){return async}):"undefined"!=typeof module&&module.exports?module.exports=async:root.async=async}()}).call(this,_dereq_("/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))
},{"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65}],20:[function(_dereq_,module){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray){function Promise$_Any(promises,useBound,caller){var ret=Promise$_CreatePromiseArray(promises,SomePromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0),promise=ret.promise();return promise.isRejected()?promise:(ret.setHowMany(1),ret.setUnwrap(),ret.init(),promise)}var SomePromiseArray=_dereq_("./some_promise_array.js")(PromiseArray);Promise.any=function(promises){return Promise$_Any(promises,!1,Promise.any)},Promise.prototype.any=function(){return Promise$_Any(this,!0,this.any)}}},{"./some_promise_array.js":52}],21:[function(_dereq_,module){"use strict";function Async(){this._isTickUsed=!1,this._length=0,this._lateBuffer=new Queue,this._functionBuffer=new Queue(75e3);var self=this;this.consumeFunctionBuffer=function(){self._consumeFunctionBuffer()}}var schedule=_dereq_("./schedule.js"),Queue=_dereq_("./queue.js"),errorObj=_dereq_("./util.js").errorObj,tryCatch1=_dereq_("./util.js").tryCatch1,process=_dereq_("./global.js").process;Async.prototype.haveItemsQueued=function(){return this._length>0},Async.prototype.invokeLater=function(fn,receiver,arg){void 0===process||null==process.domain||fn.domain||(fn=process.domain.bind(fn)),this._lateBuffer.push(fn,receiver,arg),this._queueTick()},Async.prototype.invoke=function(fn,receiver,arg){void 0===process||null==process.domain||fn.domain||(fn=process.domain.bind(fn));var functionBuffer=this._functionBuffer;functionBuffer.push(fn,receiver,arg),this._length=functionBuffer.length(),this._queueTick()},Async.prototype._consumeFunctionBuffer=function(){for(var functionBuffer=this._functionBuffer;functionBuffer.length()>0;){var fn=functionBuffer.shift(),receiver=functionBuffer.shift(),arg=functionBuffer.shift();fn.call(receiver,arg)}this._reset(),this._consumeLateBuffer()},Async.prototype._consumeLateBuffer=function(){for(var buffer=this._lateBuffer;buffer.length()>0;){var fn=buffer.shift(),receiver=buffer.shift(),arg=buffer.shift(),res=tryCatch1(fn,receiver,arg);if(res===errorObj){if(this._queueTick(),null==fn.domain)throw res.e;fn.domain.emit("error",res.e)}}},Async.prototype._queueTick=function(){this._isTickUsed||(schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},Async.prototype._reset=function(){this._isTickUsed=!1,this._length=0},module.exports=new Async},{"./global.js":33,"./queue.js":45,"./schedule.js":48,"./util.js":56}],22:[function(_dereq_,module){"use strict";module.exports=function(Promise){function Promise$getter(obj){var prop="string"==typeof this?this:""+this;return obj[prop]}Promise.prototype.call=function(propertyName){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];return this._then(function(obj){return obj[propertyName].apply(obj,args)},void 0,void 0,void 0,void 0,this.call)},Promise.prototype.get=function(propertyName){return this._then(Promise$getter,void 0,void 0,propertyName,void 0,this.get)}}},{}],23:[function(_dereq_,module){"use strict";module.exports=function(Promise,INTERNAL){var errors=_dereq_("./errors.js"),async=_dereq_("./async.js"),CancellationError=errors.CancellationError,SYNC_TOKEN={};Promise.prototype._cancel=function(){if(!this.isCancellable())return this;var parent;if(void 0!==(parent=this._cancellationParent))return void parent.cancel(SYNC_TOKEN);var err=new CancellationError;this._attachExtraTrace(err),this._rejectUnchecked(err)},Promise.prototype.cancel=function(token){return this.isCancellable()?token===SYNC_TOKEN?(this._cancel(),this):(async.invokeLater(this._cancel,this,void 0),this):this},Promise.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},Promise.prototype.uncancellable=function(){var ret=new Promise(INTERNAL);return ret._setTrace(this.uncancellable,this),ret._follow(this),ret._unsetCancellable(),this._isBound()&&ret._setBoundTo(this._boundTo),ret},Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,void 0,void 0,this.fork);return ret._setCancellable(),ret._cancellationParent=void 0,ret}}},{"./async.js":21,"./errors.js":27}],24:[function(_dereq_,module){"use strict";module.exports=function(){function formatNonError(obj){var str;if("function"==typeof obj)str="[function "+(obj.name||"anonymous")+"]";else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str))try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}0===str.length&&(str="(empty array)")}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;return str.length<maxChars?str:str.substr(0,maxChars-3)+"..."}function CapturedTrace(ignoreUntil,isTopLevel){this.captureStackTrace(ignoreUntil,isTopLevel)}var inherits=_dereq_("./util.js").inherits,defineProperty=_dereq_("./es5.js").defineProperty,rignore=new RegExp("\\b(?:[\\w.]*Promise(?:Array|Spawn)?\\$_\\w+|tryCatch(?:1|2|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),rtraceline=null,formatStack=null,areNamesMangled=!1;inherits(CapturedTrace,Error),CapturedTrace.prototype.captureStackTrace=function(ignoreUntil,isTopLevel){captureStackTrace(this,ignoreUntil,isTopLevel)},CapturedTrace.possiblyUnhandledRejection=function(reason){if("object"==typeof console){var message;if("object"==typeof reason||"function"==typeof reason){var stack=reason.stack;message="Possibly unhandled "+formatStack(stack,reason)}else message="Possibly unhandled "+String(reason);"function"==typeof console.error||"object"==typeof console.error?console.error(message):("function"==typeof console.log||"object"==typeof console.error)&&console.log(message)}},areNamesMangled="CapturedTrace$captureStackTrace"!==CapturedTrace.prototype.captureStackTrace.name,CapturedTrace.combine=function(current,prev){for(var curLast=current.length-1,i=prev.length-1;i>=0;--i){var line=prev[i];if(current[curLast]!==line)break;current.pop(),curLast--}current.push("From previous event:");for(var lines=current.concat(prev),ret=[],i=0,len=lines.length;len>i;++i)rignore.test(lines[i])||i>0&&!rtraceline.test(lines[i])&&"From previous event:"!==lines[i]||ret.push(lines[i]);return ret},CapturedTrace.isSupported=function(){return"function"==typeof captureStackTrace};var captureStackTrace=function stackDetection(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){rtraceline=/^\s*at\s*/,formatStack=function(stack,error){return"string"==typeof stack?stack:void 0!==error.name&&void 0!==error.message?error.name+". "+error.message:formatNonError(error)};var captureStackTrace=Error.captureStackTrace;return function(receiver,ignoreUntil){captureStackTrace(receiver,ignoreUntil)}}var err=new Error;if(!areNamesMangled&&"string"==typeof err.stack&&"function"==typeof"".startsWith&&err.stack.startsWith("stackDetection@")&&"stackDetection"===stackDetection.name){defineProperty(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),rtraceline=/@/;var rline=/[@\n]/;return formatStack=function(stack,error){return"string"==typeof stack?error.name+". "+error.message+"\n"+stack:void 0!==error.name&&void 0!==error.message?error.name+". "+error.message:formatNonError(error)},function(o,fn){var i,name=fn.name,stack=(new Error).stack,split=stack.split(rline),len=split.length;for(i=0;len>i&&split[i]!==name;i+=2);split=split.slice(i+2),len=split.length-2;var ret="";for(i=0;len>i;i+=2)ret+=split[i],ret+="@",ret+=split[i+1],ret+="\n";o.stack=ret}}return formatStack=function(stack,error){return"string"==typeof stack?stack:"object"!=typeof error&&"function"!=typeof error||void 0===error.name||void 0===error.message?formatNonError(error):error.name+". "+error.message},null}();return CapturedTrace}},{"./es5.js":29,"./util.js":56}],25:[function(_dereq_,module){"use strict";module.exports=function(NEXT_FILTER){function CatchFilter(instances,callback,promise){this._instances=instances,this._callback=callback,this._promise=promise}function CatchFilter$_safePredicate(predicate,e){var safeObject={},retfilter=tryCatch1(predicate,safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);return safeKeys.length?(errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function"),errorObj):retfilter}var util=_dereq_("./util.js"),errors=_dereq_("./errors.js"),tryCatch1=util.tryCatch1,errorObj=util.errorObj,keys=_dereq_("./es5.js").keys;return CatchFilter.prototype.doFilter=function(e){for(var cb=this._callback,promise=this._promise,boundTo=promise._isBound()?promise._boundTo:void 0,i=0,len=this._instances.length;len>i;++i){var item=this._instances[i],itemIsErrorType=item===Error||null!=item&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch1(cb,boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}if("function"==typeof item&&!itemIsErrorType){var shouldHandle=CatchFilter$_safePredicate(item,e);if(shouldHandle===errorObj){var trace=errors.canAttach(errorObj.e)?errorObj.e:new Error(errorObj.e+"");this._promise._attachExtraTrace(trace),e=errorObj.e;break}if(shouldHandle){var ret=tryCatch1(cb,boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}}}return NEXT_FILTER.e=e,NEXT_FILTER},CatchFilter}},{"./errors.js":27,"./es5.js":29,"./util.js":56}],26:[function(_dereq_,module){"use strict";var util=_dereq_("./util.js"),isPrimitive=util.isPrimitive,wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;module.exports=function(Promise){var returner=function(){return this},thrower=function(){throw this},wrapper=function(value,action){return 1===action?function(){throw value}:2===action?function(){return value}:void 0};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){return wrapsPrimitiveReceiver&&isPrimitive(value)?this._then(wrapper(value,2),void 0,void 0,void 0,void 0,this.thenReturn):this._then(returner,void 0,void 0,value,void 0,this.thenReturn)},Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){return wrapsPrimitiveReceiver&&isPrimitive(reason)?this._then(wrapper(reason,1),void 0,void 0,void 0,void 0,this.thenThrow):this._then(thrower,void 0,void 0,reason,void 0,this.thenThrow)}}},{"./util.js":56}],27:[function(_dereq_,module){"use strict";function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isAsync",!0)}catch(ignore){}}function originatesFromRejection(e){return null==e?!1:e instanceof RejectionError||e.isAsync===!0}function isError(obj){return obj instanceof Error}function canAttach(obj){return isError(obj)}function subError(nameProperty,defaultMessage){function SubError(message){return this instanceof SubError?(this.message="string"==typeof message?message:defaultMessage,this.name=nameProperty,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new SubError(message)}return inherits(SubError,Error),SubError}function RejectionError(message){this.name="RejectionError",this.message=message,this.cause=message,this.isAsync=!0,message instanceof Error?(this.message=message.message,this.stack=message.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var global=_dereq_("./global.js"),Objectfreeze=_dereq_("./es5.js").freeze,util=_dereq_("./util.js"),inherits=util.inherits,notEnumerableProp=util.notEnumerableProp,Error=global.Error,TypeError=global.TypeError;"function"!=typeof TypeError&&(TypeError=subError("TypeError","type error"));var RangeError=global.RangeError;"function"!=typeof RangeError&&(RangeError=subError("RangeError","range error"));var CancellationError=subError("CancellationError","cancellation error"),TimeoutError=subError("TimeoutError","timeout error");inherits(RejectionError,Error);var key="__BluebirdErrorTypes__",errorTypes=global[key];errorTypes||(errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,RejectionError:RejectionError}),notEnumerableProp(global,key,errorTypes)),module.exports={Error:Error,TypeError:TypeError,RangeError:RangeError,CancellationError:errorTypes.CancellationError,RejectionError:errorTypes.RejectionError,TimeoutError:errorTypes.TimeoutError,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,canAttach:canAttach}},{"./es5.js":29,"./global.js":33,"./util.js":56}],28:[function(_dereq_,module){"use strict";module.exports=function(Promise){function apiRejection(msg){var error=new TypeError(msg),ret=Promise.rejected(error),parent=ret._peekContext();return null!=parent&&parent._attachExtraTrace(error),ret}var TypeError=_dereq_("./errors.js").TypeError;return apiRejection}},{"./errors.js":27}],29:[function(_dereq_,module){function ObjectKeys(o){var ret=[];for(var key in o)has.call(o,key)&&ret.push(key);return ret}function ObjectDefineProperty(o,key,desc){return o[key]=desc.value,o}function ObjectFreeze(obj){return obj}function ObjectGetPrototypeOf(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}}function ArrayIsArray(obj){try{return"[object Array]"===str.call(obj)}catch(e){return!1}}var isES5=function(){"use strict";return void 0===this}();if(isES5)module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5};else{var has={}.hasOwnProperty,str={}.toString,proto={}.constructor.prototype;module.exports={isArray:ArrayIsArray,keys:ObjectKeys,defineProperty:ObjectDefineProperty,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5}}},{}],30:[function(_dereq_,module){"use strict";module.exports=function(Promise){function Promise$_filter(booleans){for(var values=this._settledValue,len=values.length,ret=new Array(len),j=0,i=0;len>i;++i)booleans[i]&&(ret[j++]=values[i]);return ret.length=j,ret}var ref=(_dereq_("./util.js").isArray,{ref:null});Promise.filter=function(promises,fn){return Promise.map(promises,fn,ref)._then(Promise$_filter,void 0,void 0,ref.ref,void 0,Promise.filter)},Promise.prototype.filter=function(fn){return this.map(fn,ref)._then(Promise$_filter,void 0,void 0,ref.ref,void 0,this.filter)}}},{"./util.js":56}],31:[function(_dereq_,module){"use strict";module.exports=function(Promise,NEXT_FILTER){function returnThis(){return this}function throwThis(){throw this}function makeReturner(r){return function(){return r}}function makeThrower(r){return function(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var useConstantFunction=wrapsPrimitiveReceiver&&isPrimitive(reasonOrValue);return isFulfilled?ret._then(useConstantFunction?returnThis:makeReturner(reasonOrValue),thrower,void 0,reasonOrValue,void 0,promisedFinally):ret._then(useConstantFunction?throwThis:makeThrower(reasonOrValue),thrower,void 0,reasonOrValue,void 0,promisedFinally)}function finallyHandler(reasonOrValue){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundTo):handler();if(void 0!==ret){var maybePromise=Promise._cast(ret,finallyHandler,void 0);if(maybePromise instanceof Promise)return promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}return promise.isRejected()?(NEXT_FILTER.e=reasonOrValue,NEXT_FILTER):reasonOrValue}function tapHandler(value){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundTo,value):handler(value);if(void 0!==ret){var maybePromise=Promise._cast(ret,tapHandler,void 0);if(maybePromise instanceof Promise)return promisedFinally(maybePromise,value,!0)}return value}var util=_dereq_("./util.js"),wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver,isPrimitive=util.isPrimitive,thrower=util.thrower;Promise.prototype._passThroughHandler=function(handler,isFinally,caller){if("function"!=typeof handler)return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:void 0,void 0,promiseAndHandler,void 0,caller)},Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,!0,this.lastly)},Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,!1,this.tap)}}},{"./util.js":56}],32:[function(_dereq_,module){"use strict";module.exports=function(Promise,apiRejection,INTERNAL){var PromiseSpawn=_dereq_("./promise_spawn.js")(Promise,INTERNAL),errors=_dereq_("./errors.js"),TypeError=errors.TypeError,deprecated=_dereq_("./util.js").deprecated;Promise.coroutine=function(generatorFunction){if("function"!=typeof generatorFunction)throw new TypeError("generatorFunction must be a function");var PromiseSpawn$=PromiseSpawn;return function anonymous(){var generator=generatorFunction.apply(this,arguments),spawn=new PromiseSpawn$(void 0,void 0,anonymous);return spawn._generator=generator,spawn._next(void 0),spawn.promise()}},Promise.coroutine.addYieldHandler=PromiseSpawn.addYieldHandler,Promise.spawn=function(generatorFunction){if(deprecated("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof generatorFunction)return apiRejection("generatorFunction must be a function");var spawn=new PromiseSpawn(generatorFunction,this,Promise.spawn),ret=spawn.promise();return spawn._run(Promise.spawn),ret}}},{"./errors.js":27,"./promise_spawn.js":41,"./util.js":56}],33:[function(_dereq_,module){(function(process,global){"use strict";module.exports=function(){return"undefined"!=typeof this?this:"undefined"!=typeof process&&"undefined"!=typeof global&&"string"==typeof process.execPath?global:"undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName?void 0!==window.wrappedJSObject?window.wrappedJSObject:window:void 0}()}).call(this,_dereq_("/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65}],34:[function(_dereq_,module){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection){function Promise$_mapper(values){var fn=this,receiver=void 0;"function"!=typeof fn&&(receiver=fn.receiver,fn=fn.fn);var shouldDefer=!1,ret=new Array(values.length);if(void 0===receiver)for(var i=0,len=values.length;len>i;++i){var value=fn(values[i],i,len);if(!shouldDefer){var maybePromise=Promise._cast(value,Promise$_mapper,void 0);if(maybePromise instanceof Promise){if(maybePromise.isFulfilled()){ret[i]=maybePromise._settledValue;continue}shouldDefer=!0,value=maybePromise}}ret[i]=value}else for(var i=0,len=values.length;len>i;++i){var value=fn.call(receiver,values[i],i,len);if(!shouldDefer){var maybePromise=Promise._cast(value,Promise$_mapper,void 0);if(maybePromise instanceof Promise){if(maybePromise.isFulfilled()){ret[i]=maybePromise._settledValue;continue}shouldDefer=!0,value=maybePromise}}ret[i]=value}return shouldDefer?Promise$_CreatePromiseArray(ret,PromiseArray,Promise$_mapper,void 0).promise():ret}function Promise$_Map(promises,fn,useBound,caller,ref){if("function"!=typeof fn)return apiRejection("fn must be a function");useBound===!0&&promises._isBound()&&(fn={fn:fn,receiver:promises._boundTo});var ret=Promise$_CreatePromiseArray(promises,PromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0).promise();return void 0!==ref&&(ref.ref=ret),ret._then(Promise$_mapper,void 0,void 0,fn,void 0,caller)}Promise.prototype.map=function(fn,ref){return Promise$_Map(this,fn,!0,this.map,ref)},Promise.map=function(promises,fn,ref){return Promise$_Map(promises,fn,!1,Promise.map,ref)}}},{}],35:[function(_dereq_,module){"use strict";module.exports=function(Promise){function thrower(r){throw r}function Promise$_successAdapter(val,receiver){var nodeback=this,ret=tryCatch2(nodeback,receiver,null,val);ret===errorObj&&async.invokeLater(thrower,void 0,ret.e)}function Promise$_errorAdapter(reason,receiver){var nodeback=this,ret=tryCatch1(nodeback,receiver,reason);ret===errorObj&&async.invokeLater(thrower,void 0,ret.e)}var util=_dereq_("./util.js"),async=_dereq_("./async.js"),tryCatch2=util.tryCatch2,tryCatch1=util.tryCatch1,errorObj=util.errorObj;Promise.prototype.nodeify=function(nodeback){return"function"==typeof nodeback?void this._then(Promise$_successAdapter,Promise$_errorAdapter,void 0,nodeback,this._isBound()?this._boundTo:null,this.nodeify):this}}},{"./async.js":21,"./util.js":56}],36:[function(_dereq_,module){"use strict";module.exports=function(Promise,isPromiseArrayProxy){var util=_dereq_("./util.js"),async=_dereq_("./async.js"),errors=_dereq_("./errors.js"),tryCatch1=util.tryCatch1,errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(void 0,void 0,handler,void 0,void 0,this.progressed)},Promise.prototype._progress=function(progressValue){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(progressValue)},Promise.prototype._progressHandlerAt=function(index){return 0===index?this._progressHandler0:this[index+2-5]},Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value,handler=progression.handler,promise=progression.promise,receiver=progression.receiver;this._pushContext();var ret=tryCatch1(handler,receiver,progressValue);if(this._popContext(),ret===errorObj){if(null!=ret.e&&"StopProgressPropagation"!==ret.e.name){var trace=errors.canAttach(ret.e)?ret.e:new Error(ret.e+"");promise._attachExtraTrace(trace),promise._progress(ret.e)}}else Promise.is(ret)?ret._then(promise._progress,null,null,promise,void 0,this._progress):promise._progress(ret)},Promise.prototype._progressUnchecked=function(progressValue){if(this.isPending())for(var len=this._length(),i=0;len>i;i+=5){var handler=this._progressHandlerAt(i),promise=this._promiseAt(i);if(Promise.is(promise))"function"==typeof handler?async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue}):async.invoke(promise._progress,promise,progressValue);else{var receiver=this._receiverAt(i);"function"==typeof handler?handler.call(receiver,progressValue,promise):Promise.is(receiver)&&receiver._isProxied()?receiver._progressUnchecked(progressValue):isPromiseArrayProxy(receiver,promise)&&receiver._promiseProgressed(progressValue,promise)}}}}},{"./async.js":21,"./errors.js":27,"./util.js":56}],37:[function(_dereq_,module){(function(process){"use strict";module.exports=function(){function isPromise(obj){return void 0===obj?!1:obj instanceof Promise}function isPromiseArrayProxy(receiver,promiseSlotValue){return receiver instanceof PromiseArray?promiseSlotValue>=0:!1}function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("the promise constructor requires a resolver function");if(this.constructor!==Promise)throw new TypeError("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,resolver!==INTERNAL&&this._resolveFromResolver(resolver)}function Promise$_all(promises,useBound,caller){return Promise$_CreatePromiseArray(promises,PromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0).promise()}function Promise$_CreatePromiseArray(promises,PromiseArrayConstructor,caller,boundTo){var list=null;return isArray(promises)?list=promises:(list=Promise._cast(promises,caller,void 0),list!==promises?list._setBoundTo(boundTo):isPromise(list)||(list=null)),null!==list?new PromiseArrayConstructor(list,"function"==typeof caller?caller:Promise$_CreatePromiseArray,boundTo):{promise:function(){return apiRejection("expecting an array, a promise or a thenable")}}}var global=_dereq_("./global.js"),util=_dereq_("./util.js"),async=_dereq_("./async.js"),errors=_dereq_("./errors.js"),INTERNAL=function(){},APPLY={},NEXT_FILTER={e:null},PromiseArray=_dereq_("./promise_array.js")(Promise,INTERNAL),CapturedTrace=_dereq_("./captured_trace.js")(),CatchFilter=_dereq_("./catch_filter.js")(NEXT_FILTER),PromiseResolver=_dereq_("./promise_resolver.js"),isArray=util.isArray,errorObj=util.errorObj,tryCatch1=util.tryCatch1,tryCatch2=util.tryCatch2,tryCatchApply=util.tryCatchApply,RangeError=errors.RangeError,TypeError=errors.TypeError,CancellationError=errors.CancellationError,TimeoutError=errors.TimeoutError,RejectionError=errors.RejectionError,originatesFromRejection=errors.originatesFromRejection,markAsOriginatingFromRejection=errors.markAsOriginatingFromRejection,canAttach=errors.canAttach,thrower=util.thrower,apiRejection=_dereq_("./errors_api_rejection")(Promise),makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain")};Promise.prototype.bind=function(thisArg){var ret=new Promise(INTERNAL);return debugging&&ret._setTrace(this.bind,this),ret._follow(this),ret._setBoundTo(thisArg),this._cancellable()&&(ret._setCancellable(),ret._cancellationParent=this),ret},Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var i,catchInstances=new Array(len-1),j=0;for(i=0;len-1>i;++i){var item=arguments[i];if("function"!=typeof item){var catchFilterTypeError=new TypeError("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(catchFilterTypeError),void async.invoke(this._reject,this,catchFilterTypeError)}catchInstances[j++]=item}catchInstances.length=j,fn=arguments[i],this._resetTrace(this.caught);var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(void 0,catchFilter.doFilter,void 0,catchFilter,void 0,this.caught)}return this._then(void 0,fn,void 0,void 0,void 0,this.caught)},Promise.prototype.then=function(didFulfill,didReject,didProgress){return this._then(didFulfill,didReject,didProgress,void 0,void 0,this.then)},Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,void 0,void 0,this.done);promise._setIsFinal()},Promise.prototype.spread=function(didFulfill,didReject){return this._then(didFulfill,didReject,void 0,APPLY,void 0,this.spread)},Promise.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},Promise.prototype.isRejected=function(){return(134217728&this._bitField)>0},Promise.prototype.isPending=function(){return!this.isResolved()},Promise.prototype.isResolved=function(){return(402653184&this._bitField)>0},Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},Promise.prototype.toJSON=function(){var ret={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ret.fulfillmentValue=this._settledValue,ret.isFulfilled=!0):this.isRejected()&&(ret.rejectionReason=this._settledValue,ret.isRejected=!0),ret},Promise.prototype.all=function(){return Promise$_all(this,!0,this.all)},Promise.is=isPromise,Promise.all=function(promises){return Promise$_all(promises,!1,Promise.all)},Promise.join=function(){for(var $_len=arguments.length,args=new Array($_len),$_i=0;$_len>$_i;++$_i)args[$_i]=arguments[$_i];return Promise$_CreatePromiseArray(args,PromiseArray,Promise.join,void 0).promise()},Promise.resolve=Promise.fulfilled=function(value,caller){var ret=new Promise(INTERNAL);return debugging&&ret._setTrace("function"==typeof caller?caller:Promise.resolve,void 0),ret._tryFollow(value)?ret:(ret._cleanValues(),ret._setFulfilled(),ret._settledValue=value,ret)},Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);if(debugging&&ret._setTrace(Promise.reject,void 0),markAsOriginatingFromRejection(reason),ret._cleanValues(),ret._setRejected(),ret._settledValue=reason,!canAttach(reason)){var trace=new Error(reason+"");ret._setCarriedStackTrace(trace)}return ret._ensurePossibleRejectionHandled(),ret},Promise.prototype.error=function(fn){return this.caught(originatesFromRejection,fn)},Promise.prototype._resolveFromSyncValue=function(value,caller){if(value===errorObj)this._cleanValues(),this._setRejected(),this._settledValue=value.e,this._ensurePossibleRejectionHandled();else{var maybePromise=Promise._cast(value,caller,void 0);maybePromise instanceof Promise?this._follow(maybePromise):(this._cleanValues(),this._setFulfilled(),this._settledValue=value)}},Promise.method=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function");return function Promise$_method(){var value;switch(arguments.length){case 0:value=tryCatch1(fn,this,void 0);break;case 1:value=tryCatch1(fn,this,arguments[0]);break;case 2:value=tryCatch2(fn,this,arguments[0],arguments[1]);break;default:for(var $_len=arguments.length,args=new Array($_len),$_i=0;$_len>$_i;++$_i)args[$_i]=arguments[$_i];value=tryCatchApply(fn,args,this)}var ret=new Promise(INTERNAL);return debugging&&ret._setTrace(Promise$_method,void 0),ret._resolveFromSyncValue(value,Promise$_method),ret}},Promise.attempt=Promise["try"]=function(fn,args,ctx){if("function"!=typeof fn)return apiRejection("fn must be a function");var value=isArray(args)?tryCatchApply(fn,args,ctx):tryCatch1(fn,ctx,args),ret=new Promise(INTERNAL);return debugging&&ret._setTrace(Promise.attempt,void 0),ret._resolveFromSyncValue(value,Promise.attempt),ret},Promise.defer=Promise.pending=function(caller){var promise=new Promise(INTERNAL);return debugging&&promise._setTrace("function"==typeof caller?caller:Promise.defer,void 0),new PromiseResolver(promise)},Promise.bind=function(thisArg){var ret=new Promise(INTERNAL);return debugging&&ret._setTrace(Promise.bind,void 0),ret._setFulfilled(),ret._setBoundTo(thisArg),ret},Promise.cast=function(obj,caller){"function"!=typeof caller&&(caller=Promise.cast);var ret=Promise._cast(obj,caller,void 0);return ret instanceof Promise?ret:Promise.resolve(ret,caller)},Promise.onPossiblyUnhandledRejection=function(fn){CapturedTrace.possiblyUnhandledRejection="function"==typeof fn?fn:void 0};var debugging=!1||!("undefined"==typeof process||"string"!=typeof process.execPath||"object"!=typeof process.env||!process.env.BLUEBIRD_DEBUG&&"development"!==process.env.NODE_ENV);Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===!1)throw new Error("cannot enable long stack traces after promises have been created");debugging=CapturedTrace.isSupported()},Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported()},Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=1048570&&(index=0,this._setLength(0)),0===index)this._promise0=promiseSlotValue,this._receiver0=receiver;else{var i=index-5;this[i+3]=promiseSlotValue,this[i+4]=receiver,this[i+0]=this[i+1]=this[i+2]=void 0}this._setLength(index+5)},Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index)},Promise.prototype._proxyPromise=function(promise){promise._setProxied(),this._setProxyHandlers(promise,-1)},Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData,caller){var haveInternalData=void 0!==internalData,ret=haveInternalData?internalData:new Promise(INTERNAL);if(debugging&&!haveInternalData){var haveSameContext=this._peekContext()===this._traceParent;ret._traceParent=haveSameContext?this._traceParent:this,ret._setTrace("function"==typeof caller?caller:this._then,this)}!haveInternalData&&this._isBound()&&ret._setBoundTo(this._boundTo);var callbackIndex=this._addCallbacks(didFulfill,didReject,didProgress,ret,receiver);
return!haveInternalData&&this._cancellable()&&(ret._setCancellable(),ret._cancellationParent=this),this.isResolved()&&async.invoke(this._queueSettleAt,this,callbackIndex),ret},Promise.prototype._length=function(){return 1048575&this._bitField},Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},Promise.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},Promise.prototype._setLength=function(len){this._bitField=-1048576&this._bitField|1048575&len},Promise.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},Promise.prototype._setRejected=function(){this._bitField=134217728|this._bitField},Promise.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},Promise.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},Promise.prototype._isFinal=function(){return(33554432&this._bitField)>0},Promise.prototype._cancellable=function(){return(67108864&this._bitField)>0},Promise.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},Promise.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField},Promise.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=capturedTrace},Promise.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},Promise.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},Promise.prototype._receiverAt=function(index){var ret;return ret=0===index?this._receiver0:this[index+4-5],this._isBound()&&void 0===ret?this._boundTo:ret},Promise.prototype._promiseAt=function(index){return 0===index?this._promise0:this[index+3-5]},Promise.prototype._fulfillmentHandlerAt=function(index){return 0===index?this._fulfillmentHandler0:this[index+0-5]},Promise.prototype._rejectionHandlerAt=function(index){return 0===index?this._rejectionHandler0:this[index+1-5]},Promise.prototype._unsetAt=function(index){0===index?(this._rejectionHandler0=this._progressHandler0=this._promise0=this._receiver0=void 0,this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0)):this[index-5+0]=this[index-5+1]=this[index-5+2]=this[index-5+3]=this[index-5+4]=void 0},Promise.prototype._resolveFromResolver=function(resolver){function Promise$_resolver(val){promise._tryFollow(val)||promise._fulfill(val)}function Promise$_rejecter(val){var trace=canAttach(val)?val:new Error(val+"");promise._attachExtraTrace(trace),markAsOriginatingFromRejection(val),promise._reject(val,trace===val?void 0:trace)}var promise=this,localDebugging=debugging;localDebugging&&(this._setTrace(this._resolveFromResolver,void 0),this._pushContext());var r=tryCatch2(resolver,void 0,Promise$_resolver,Promise$_rejecter);if(localDebugging&&this._popContext(),void 0!==r&&r===errorObj){var e=r.e,trace=canAttach(e)?e:new Error(e+"");promise._reject(e,trace)}},Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver){var index=this._length();if(index>=1048570&&(index=0,this._setLength(0)),0===index)this._promise0=promise,void 0!==receiver&&(this._receiver0=receiver),"function"!=typeof fulfill||this._isCarryingStackTrace()||(this._fulfillmentHandler0=fulfill),"function"==typeof reject&&(this._rejectionHandler0=reject),"function"==typeof progress&&(this._progressHandler0=progress);else{var i=index-5;this[i+3]=promise,this[i+4]=receiver,this[i+0]="function"==typeof fulfill?fulfill:void 0,this[i+1]="function"==typeof reject?reject:void 0,this[i+2]="function"==typeof progress?progress:void 0}return this._setLength(index+5),index},Promise.prototype._setBoundTo=function(obj){void 0!==obj?(this._bitField=8388608|this._bitField,this._boundTo=obj):this._bitField=-8388609&this._bitField},Promise.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},Promise.prototype._spreadSlowCase=function(targetFn,promise,values,boundTo){var promiseForAll=Promise$_CreatePromiseArray(values,PromiseArray,this._spreadSlowCase,boundTo).promise()._then(function(){return targetFn.apply(boundTo,arguments)},void 0,void 0,APPLY,void 0,this._spreadSlowCase);promise._follow(promiseForAll)},Promise.prototype._callSpread=function(handler,promise,value,localDebugging){var boundTo=this._isBound()?this._boundTo:void 0;if(isArray(value))for(var caller=this._settlePromiseFromHandler,i=0,len=value.length;len>i;++i)if(isPromise(Promise._cast(value[i],caller,void 0)))return void this._spreadSlowCase(handler,promise,value,boundTo);return localDebugging&&promise._pushContext(),tryCatchApply(handler,value,boundTo)},Promise.prototype._callHandler=function(handler,receiver,promise,value,localDebugging){var x;return receiver!==APPLY||this.isRejected()?(localDebugging&&promise._pushContext(),x=tryCatch1(handler,receiver,value)):x=this._callSpread(handler,promise,value,localDebugging),localDebugging&&promise._popContext(),x},Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(!isPromise(promise))return void handler.call(receiver,value,promise);var localDebugging=debugging,x=this._callHandler(handler,receiver,promise,value,localDebugging);if(!promise._isFollowing())if(x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e,trace=canAttach(err)?err:new Error(err+"");x!==NEXT_FILTER&&promise._attachExtraTrace(trace),promise._rejectUnchecked(err,trace)}else{var castValue=Promise._cast(x,localDebugging?this._settlePromiseFromHandler:void 0,promise);if(isPromise(castValue)){if(castValue.isRejected()&&!castValue._isCarryingStackTrace()&&!canAttach(castValue._settledValue)){var trace=new Error(castValue._settledValue+"");promise._attachExtraTrace(trace),castValue._setCarriedStackTrace(trace)}promise._follow(castValue),castValue._cancellable()&&(promise._cancellationParent=castValue,promise._setCancellable())}else promise._fulfillUnchecked(x)}},Promise.prototype._follow=function(promise){this._setFollowing(),promise.isPending()?(promise._cancellable()&&(this._cancellationParent=promise,this._setCancellable()),promise._proxyPromise(this)):promise.isFulfilled()?this._fulfillUnchecked(promise._settledValue):this._rejectUnchecked(promise._settledValue,promise._getCarriedStackTrace()),promise._isRejectionUnhandled()&&promise._unsetRejectionIsUnhandled(),debugging&&null==promise._traceParent&&(promise._traceParent=this)},Promise.prototype._tryFollow=function(value){if(this._isFollowingOrFulfilledOrRejected()||value===this)return!1;var maybePromise=Promise._cast(value,this._tryFollow,void 0);return isPromise(maybePromise)?(this._follow(maybePromise),!0):!1},Promise.prototype._resetTrace=function(caller){if(debugging){var context=this._peekContext(),isTopLevel=void 0===context;this._trace=new CapturedTrace("function"==typeof caller?caller:this._resetTrace,isTopLevel)}},Promise.prototype._setTrace=function(caller,parent){if(debugging){var context=this._peekContext();this._traceParent=context;var isTopLevel=void 0===context;this._trace=void 0!==parent&&parent._traceParent===context?parent._trace:new CapturedTrace("function"==typeof caller?caller:this._setTrace,isTopLevel)}return this},Promise.prototype._attachExtraTrace=function(error){if(debugging){var promise=this,stack=error.stack;stack="string"==typeof stack?stack.split("\n"):[];for(var headerLineCount=1;null!=promise&&null!=promise._trace;)stack=CapturedTrace.combine(stack,promise._trace.stack.split("\n")),promise=promise._traceParent;var max=Error.stackTraceLimit+headerLineCount,len=stack.length;len>max&&(stack.length=max),error.stack=stack.length<=headerLineCount?"(No stack trace)":stack.join("\n")}},Promise.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},Promise.prototype._fulfill=function(value){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(value)},Promise.prototype._reject=function(reason,carriedStackTrace){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(reason,carriedStackTrace)},Promise.prototype._settlePromiseAt=function(index){var handler=this.isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index),value=this._settledValue,receiver=this._receiverAt(index),promise=this._promiseAt(index);if("function"==typeof handler)this._settlePromiseFromHandler(handler,receiver,value,promise);else{var done=!1,isFulfilled=this.isFulfilled();void 0!==receiver&&(receiver instanceof Promise&&receiver._isProxied()?(receiver._unsetProxied(),isFulfilled?receiver._fulfillUnchecked(value):receiver._rejectUnchecked(value,this._getCarriedStackTrace()),done=!0):isPromiseArrayProxy(receiver,promise)&&(isFulfilled?receiver._promiseFulfilled(value,promise):receiver._promiseRejected(value,promise),done=!0)),done||(isFulfilled?promise._fulfill(value):promise._reject(value,this._getCarriedStackTrace()))}index>=256&&this._queueGC()},Promise.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},Promise.prototype._setProxied=function(){this._bitField=4194304|this._bitField},Promise.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},Promise.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},Promise.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},Promise.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},Promise.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),async.invokeLater(this._gc,this,void 0))},Promise.prototype._gc=function(){var len=this._length();this._unsetAt(0);for(var i=0;len>i;i++)delete this[i];this._setLength(0),this._unsetGcQueued()},Promise.prototype._queueSettleAt=function(index){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),async.invoke(this._settlePromiseAt,this,index)},Promise.prototype._fulfillUnchecked=function(value){if(this.isPending()){if(value===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=value;var len=this._length();len>0&&async.invoke(this._fulfillPromises,this,len)}},Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=canAttach(reason)?reason:new Error(reason+"");this._rejectUnchecked(reason,trace===reason?void 0:trace)},Promise.prototype._rejectUnchecked=function(reason,trace){if(this.isPending()){if(reason===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err)}if(this._cleanValues(),this._setRejected(),this._settledValue=reason,this._isFinal())return void async.invokeLater(thrower,void 0,void 0===trace?reason:trace);var len=this._length();void 0!==trace&&this._setCarriedStackTrace(trace),len>0?async.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},Promise.prototype._rejectPromises=function(){for(var len=this._length(),i=0;len>i;i+=5)this._settlePromiseAt(i);this._unsetCarriedStackTrace()},Promise.prototype._fulfillPromises=function(len){len=this._length();for(var i=0;len>i;i+=5)this._settlePromiseAt(i)},Promise.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==CapturedTrace.possiblyUnhandledRejection&&async.invokeLater(this._notifyUnhandledRejection,this,void 0)},Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._settledValue,trace=this._getCarriedStackTrace();this._unsetRejectionIsUnhandled(),void 0!==trace&&(this._unsetCarriedStackTrace(),reason=trace),"function"==typeof CapturedTrace.possiblyUnhandledRejection&&CapturedTrace.possiblyUnhandledRejection(reason,this)}};var contextStack=[];Promise.prototype._peekContext=function(){var lastIndex=contextStack.length-1;return lastIndex>=0?contextStack[lastIndex]:void 0},Promise.prototype._pushContext=function(){debugging&&contextStack.push(this)},Promise.prototype._popContext=function(){debugging&&contextStack.pop()};var old=global.Promise;return Promise.noConflict=function(){return global.Promise===Promise&&(global.Promise=old),Promise},CapturedTrace.isSupported()||(Promise.longStackTraces=function(){},debugging=!1),Promise._makeSelfResolutionError=makeSelfResolutionError,_dereq_("./finally.js")(Promise,NEXT_FILTER),_dereq_("./direct_resolve.js")(Promise),_dereq_("./thenables.js")(Promise,INTERNAL),Promise.RangeError=RangeError,Promise.CancellationError=CancellationError,Promise.TimeoutError=TimeoutError,Promise.TypeError=TypeError,Promise.RejectionError=RejectionError,util.toFastProperties(Promise),util.toFastProperties(Promise.prototype),_dereq_("./timers.js")(Promise,INTERNAL),_dereq_("./synchronous_inspection.js")(Promise),_dereq_("./any.js")(Promise,Promise$_CreatePromiseArray,PromiseArray),_dereq_("./race.js")(Promise,INTERNAL),_dereq_("./call_get.js")(Promise),_dereq_("./filter.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection),_dereq_("./generators.js")(Promise,apiRejection,INTERNAL),_dereq_("./map.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection),_dereq_("./nodeify.js")(Promise),_dereq_("./promisify.js")(Promise,INTERNAL),_dereq_("./props.js")(Promise,PromiseArray),_dereq_("./reduce.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection,INTERNAL),_dereq_("./settle.js")(Promise,Promise$_CreatePromiseArray,PromiseArray),_dereq_("./some.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection),_dereq_("./progress.js")(Promise,isPromiseArrayProxy),_dereq_("./cancel.js")(Promise,INTERNAL),Promise.prototype=Promise.prototype,Promise}}).call(this,_dereq_("/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./any.js":20,"./async.js":21,"./call_get.js":22,"./cancel.js":23,"./captured_trace.js":24,"./catch_filter.js":25,"./direct_resolve.js":26,"./errors.js":27,"./errors_api_rejection":28,"./filter.js":30,"./finally.js":31,"./generators.js":32,"./global.js":33,"./map.js":34,"./nodeify.js":35,"./progress.js":36,"./promise_array.js":38,"./promise_resolver.js":40,"./promisify.js":42,"./props.js":44,"./race.js":46,"./reduce.js":47,"./settle.js":49,"./some.js":51,"./synchronous_inspection.js":53,"./thenables.js":54,"./timers.js":55,"./util.js":56,"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65}],38:[function(_dereq_,module){"use strict";module.exports=function(Promise,INTERNAL){function toResolutionValue(val){switch(val){case-1:return void 0;case-2:return[];case-3:return{}}}function PromiseArray(values,caller,boundTo){var promise=this._promise=new Promise(INTERNAL),parent=void 0;Promise.is(values)&&(parent=values,values._cancellable()&&(promise._setCancellable(),promise._cancellationParent=values),values._isBound()&&promise._setBoundTo(boundTo)),promise._setTrace(caller,parent),this._values=values,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var canAttach=_dereq_("./errors.js").canAttach,util=_dereq_("./util.js"),async=_dereq_("./async.js"),hasOwn={}.hasOwnProperty,isArray=util.isArray;return PromiseArray.PropertiesPromiseArray=function(){},PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function(_,resolveValueIfEmpty){var values=this._values;if(Promise.is(values)){if(!values.isFulfilled())return values.isPending()?void values._then(this._init,this._reject,void 0,this,resolveValueIfEmpty,this.constructor):void this._reject(values._settledValue);if(values=values._settledValue,!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(err)}this._values=values}if(0===values.length)return void this._resolve(toResolutionValue(resolveValueIfEmpty));var newValues,len=values.length,newLen=len;newValues=this instanceof PromiseArray.PropertiesPromiseArray?this._values:new Array(len);for(var isDirectScanNeeded=!1,i=0;len>i;++i){var promise=values[i];if(void 0!==promise||hasOwn.call(values,i)){var maybePromise=Promise._cast(promise,void 0,void 0);maybePromise instanceof Promise?maybePromise.isPending()?maybePromise._proxyPromiseArray(this,i):(maybePromise._unsetRejectionIsUnhandled(),isDirectScanNeeded=!0):isDirectScanNeeded=!0,newValues[i]=maybePromise}else newLen--}if(0===newLen)return void this._resolve(-2===resolveValueIfEmpty?newValues:toResolutionValue(resolveValueIfEmpty));if(this._values=newValues,this._length=newLen,isDirectScanNeeded){var scanMethod=newLen===len?this._scanDirectValues:this._scanDirectValuesHoled;async.invoke(scanMethod,this,len)}},PromiseArray.prototype._settlePromiseAt=function(index){var value=this._values[index];Promise.is(value)?value.isFulfilled()?this._promiseFulfilled(value._settledValue,index):value.isRejected()&&this._promiseRejected(value._settledValue,index):this._promiseFulfilled(value,index)},PromiseArray.prototype._scanDirectValuesHoled=function(len){for(var i=0;len>i&&!this._isResolved();++i)hasOwn.call(this._values,i)&&this._settlePromiseAt(i)},PromiseArray.prototype._scanDirectValues=function(len){for(var i=0;len>i&&!this._isResolved();++i)this._settlePromiseAt(i)},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(value){this._values=null,this._promise._fulfill(value)},PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null;var trace=canAttach(reason)?reason:new Error(reason+"");this._promise._attachExtraTrace(trace),this._promise._reject(reason,trace)},PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._isResolved()||this._promise._progress({index:index,value:progressValue})},PromiseArray.prototype._promiseFulfilled=function(value,index){if(!this._isResolved()){this._values[index]=value;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)}},PromiseArray.prototype._promiseRejected=function(reason){this._isResolved()||(this._totalResolved++,this._reject(reason))},PromiseArray}},{"./async.js":21,"./errors.js":27,"./util.js":56}],39:[function(_dereq_,module){"use strict";function PromiseInspection(promise){void 0!==promise?(this._bitField=promise._bitField,this._settledValue=promise.isResolved()?promise._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}var TypeError=_dereq_("./errors.js").TypeError;PromiseInspection.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},PromiseInspection.prototype.isRejected=function(){return(134217728&this._bitField)>0},PromiseInspection.prototype.isPending=function(){return 0===(402653184&this._bitField)},PromiseInspection.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},PromiseInspection.prototype.error=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},module.exports=PromiseInspection},{"./errors.js":27}],40:[function(_dereq_,module){"use strict";function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsRejectionError(obj){var ret;return ret=isUntypedError(obj)?new RejectionError(obj):obj,errors.markAsOriginatingFromRejection(ret),ret}function nodebackForPromise(promise){function PromiseResolver$_callback(err,value){if(null!==promise){if(err){var wrapped=wrapAsRejectionError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped),promise._reject(wrapped)}else if(arguments.length>2){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];promise._fulfill(args)}else promise._fulfill(value);promise=null}}return PromiseResolver$_callback}var PromiseResolver,util=_dereq_("./util.js"),maybeWrapAsError=util.maybeWrapAsError,errors=_dereq_("./errors.js"),TimeoutError=errors.TimeoutError,RejectionError=errors.RejectionError,async=_dereq_("./async.js"),haveGetters=util.haveGetters,es5=_dereq_("./es5.js");if(PromiseResolver=haveGetters?function(promise){this.promise=promise}:function(promise){this.promise=promise,this.asCallback=nodebackForPromise(promise),this.callback=this.asCallback},haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop),es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise,PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]"},PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){var promise=this.promise;promise._tryFollow(value)||async.invoke(promise._fulfill,promise,value)},PromiseResolver.prototype.reject=function(reason){var promise=this.promise;errors.markAsOriginatingFromRejection(reason);var trace=errors.canAttach(reason)?reason:new Error(reason+"");promise._attachExtraTrace(trace),async.invoke(promise._reject,promise,reason),trace!==reason&&async.invoke(this._setCarriedStackTrace,this,trace)},PromiseResolver.prototype.progress=function(value){async.invoke(this.promise._progress,this.promise,value)},PromiseResolver.prototype.cancel=function(){async.invoke(this.promise.cancel,this.promise,void 0)},PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"))},PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved()},PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON()},PromiseResolver.prototype._setCarriedStackTrace=function(trace){this.promise.isRejected()&&this.promise._setCarriedStackTrace(trace)},module.exports=PromiseResolver},{"./async.js":21,"./errors.js":27,"./es5.js":29,"./util.js":56}],41:[function(_dereq_,module){"use strict";module.exports=function(Promise,INTERNAL){function promiseFromYieldHandler(value){for(var _yieldHandlers=yieldHandlers,_errorObj=errorObj,_Promise=Promise,len=_yieldHandlers.length,i=0;len>i;++i){var result=tryCatch1(_yieldHandlers[i],void 0,value);if(result===_errorObj)return _Promise.reject(_errorObj.e);var maybePromise=_Promise._cast(result,promiseFromYieldHandler,void 0);if(maybePromise instanceof _Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,caller){var promise=this._promise=new Promise(INTERNAL);promise._setTrace(caller,void 0),this._generatorFunction=generatorFunction,this._receiver=receiver,this._generator=void 0}var errors=_dereq_("./errors.js"),TypeError=errors.TypeError,util=_dereq_("./util.js"),isArray=util.isArray,errorObj=util.errorObj,tryCatch1=util.tryCatch1,yieldHandlers=[];return PromiseSpawn.prototype.promise=function(){return this._promise},PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},PromiseSpawn.prototype._continue=function PromiseSpawn$_continue(result){if(result===errorObj){this._generator=void 0;var trace=errors.canAttach(result.e)?result.e:new Error(result.e+"");return this._promise._attachExtraTrace(trace),void this._promise._reject(result.e,trace)}var value=result.value;if(result.done===!0)this._generator=void 0,this._promise._tryFollow(value)||this._promise._fulfill(value);else{var maybePromise=Promise._cast(value,PromiseSpawn$_continue,void 0);if(!(maybePromise instanceof Promise)&&(maybePromise=isArray(maybePromise)?Promise.all(maybePromise):promiseFromYieldHandler(maybePromise),null===maybePromise))return void this._throw(new TypeError("A value was yielded that could not be treated as a promise"));maybePromise._then(this._next,this._throw,void 0,this,null,void 0)}},PromiseSpawn.prototype._throw=function(reason){errors.canAttach(reason)&&this._promise._attachExtraTrace(reason),this._continue(tryCatch1(this._generator["throw"],this._generator,reason))},PromiseSpawn.prototype._next=function(value){this._continue(tryCatch1(this._generator.next,this._generator,value))},PromiseSpawn.addYieldHandler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function");yieldHandlers.push(fn)},PromiseSpawn}},{"./errors.js":27,"./util.js":56}],42:[function(_dereq_,module){"use strict";module.exports=function(Promise,INTERNAL){function isPromisified(fn){return fn.__isPromisified__===!0}function switchCaseArgumentOrder(likelyArgumentCount){for(var ret=[likelyArgumentCount],min=Math.max(0,likelyArgumentCount-1-5),i=likelyArgumentCount-1;i>=min;--i)i!==likelyArgumentCount&&ret.push(i);for(var i=likelyArgumentCount+1;5>=i;++i)ret.push(i);return ret}function parameterDeclaration(parameterCount){for(var ret=new Array(parameterCount),i=0;i<ret.length;++i)ret[i]="_arg"+i;return ret.join(", ")}function parameterCount(fn){return"number"==typeof fn.length?Math.max(Math.min(fn.length,1024),0):0}function propertyAccess(id){var rident=/^[a-z$_][a-z$_0-9]*$/i;return rident.test(id)?"."+id:"['"+id.replace(/(['\\])/g,"\\$1")+"']"}function makeNodePromisifiedEval(callback,receiver,originalName,fn){function generateCallForArgumentCount(count){for(var args=new Array(count),i=0,len=args.length;len>i;++i)args[i]="arguments["+i+"]";var comma=count>0?",":"";return"string"==typeof callback&&receiver===THIS?"this"+propertyAccess(callback)+"("+args.join(",")+comma+" fn);break;":(void 0===receiver?"callback("+args.join(",")+comma+" fn);":"callback.call("+(receiver===THIS?"this":"receiver")+", "+args.join(",")+comma+" fn);")+"break;"}function generateArgumentSwitchCase(){for(var ret="",i=0;i<argumentOrder.length;++i)ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i]);return ret+="default: var args = new Array(len + 1);var i = 0;for (var i = 0; i < len; ++i) {    args[i] = arguments[i];}args[i] = fn;"+("string"==typeof callback?"this"+propertyAccess(callback)+".apply(":"callback.apply(")+(receiver===THIS?"this":"receiver")+", args); break;"}var newParameterCount=Math.max(0,parameterCount(fn)-1),argumentOrder=switchCaseArgumentOrder(newParameterCount),callbackName="string"==typeof originalName?originalName+"Async":"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","var ret = function "+callbackName+"("+parameterDeclaration(newParameterCount)+') {"use strict";var len = arguments.length;var promise = new Promise(INTERNAL);promise._setTrace('+callbackName+", void 0);var fn = nodebackForPromise(promise);try {switch(len) {"+generateArgumentSwitchCase()+"}}catch(e){ var wrapped = maybeWrapAsError(e);promise._attachExtraTrace(wrapped);promise._reject(wrapped);}return promise;}; ret.__isPromisified__ = true; return ret;")(Promise,callback,receiver,withAppended,maybeWrapAsError,nodebackForPromise,INTERNAL)}function makeNodePromisifiedClosure(callback,receiver){function promisified(){var _receiver=receiver;receiver===THIS&&(_receiver=this),"string"==typeof callback&&(callback=_receiver[callback]);var promise=new Promise(INTERNAL);promise._setTrace(promisified,void 0);var fn=nodebackForPromise(promise);try{callback.apply(_receiver,withAppended(arguments,fn))}catch(e){var wrapped=maybeWrapAsError(e);promise._attachExtraTrace(wrapped),promise._reject(wrapped)}return promise}return promisified.__isPromisified__=!0,promisified}function _promisify(callback,receiver,isAll){if(isAll){for(var methods=inheritedMethods(callback),i=0,len=methods.length;len>i;i+=2){var key=methods[i],fn=methods[i+1],originalKey=key+"__beforePromisified__",promisifiedKey=key+"Async";notEnumerableProp(callback,originalKey,fn),callback[promisifiedKey]=makeNodePromisified(originalKey,THIS,key,fn)}return util.toFastProperties(callback),callback}return makeNodePromisified(callback,receiver,void 0,callback)}var THIS={},util=_dereq_("./util.js"),es5=_dereq_("./es5.js"),nodebackForPromise=_dereq_("./promise_resolver.js")._nodebackForPromise,withAppended=util.withAppended,maybeWrapAsError=util.maybeWrapAsError,canEvaluate=util.canEvaluate,notEnumerableProp=util.notEnumerableProp,deprecated=util.deprecated,roriginal=new RegExp("__beforePromisified__$"),hasProp={}.hasOwnProperty,inheritedMethods=function(){if(es5.isES5){var create=Object.create,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;return function(cur){for(var original=cur,ret=[],visitedKeys=create(null);null!==cur;){for(var keys=es5.keys(cur),i=0,len=keys.length;len>i;++i){var key=keys[i];if(!(visitedKeys[key]||roriginal.test(key)||hasProp.call(original,key+"__beforePromisified__"))){visitedKeys[key]=!0;var desc=getOwnPropertyDescriptor(cur,key);null==desc||"function"!=typeof desc.value||isPromisified(desc.value)||ret.push(key,desc.value)}}cur=es5.getPrototypeOf(cur)}return ret}}return function(obj){var ret=[];for(var key in obj)if(!roriginal.test(key)&&!hasProp.call(obj,key+"__beforePromisified__")){var fn=obj[key];"function"!=typeof fn||isPromisified(fn)||ret.push(key,fn)}return ret}}(),makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;Promise.promisify=function(fn,receiver){if("object"==typeof fn&&null!==fn)return deprecated("Promise.promisify for promisifying entire objects is deprecated. Use Promise.promisifyAll instead."),_promisify(fn,receiver,!0);if("function"!=typeof fn)throw new TypeError("fn must be a function");return isPromisified(fn)?fn:_promisify(fn,arguments.length<2?THIS:receiver,!1)},Promise.promisifyAll=function(target){if("function"!=typeof target&&"object"!=typeof target)throw new TypeError("the target of promisifyAll must be an object or a function");return _promisify(target,void 0,!0)}}},{"./es5.js":29,"./promise_resolver.js":40,"./util.js":56}],43:[function(_dereq_,module){"use strict";module.exports=function(Promise,PromiseArray){function PropertiesPromiseArray(obj,caller,boundTo){for(var keys=es5.keys(obj),values=new Array(keys.length),i=0,len=values.length;len>i;++i)values[i]=obj[keys[i]];if(this.constructor$(values,caller,boundTo),!this._isResolved())for(var i=0,len=keys.length;len>i;++i)values.push(keys[i])}var util=_dereq_("./util.js"),inherits=util.inherits,es5=_dereq_("./es5.js");return inherits(PropertiesPromiseArray,PromiseArray),PropertiesPromiseArray.prototype._init=function(){this._init$(void 0,-3)},PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){if(!this._isResolved()){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){for(var val={},keyOffset=this.length(),i=0,len=this.length();len>i;++i)val[this._values[i+keyOffset]]=this._values[i];this._resolve(val)}}},PropertiesPromiseArray.prototype._promiseProgressed=function(value,index){this._isResolved()||this._promise._progress({key:this._values[index+this.length()],value:value})},PromiseArray.PropertiesPromiseArray=PropertiesPromiseArray,PropertiesPromiseArray}},{"./es5.js":29,"./util.js":56}],44:[function(_dereq_,module){"use strict";module.exports=function(Promise,PromiseArray){function Promise$_Props(promises,useBound,caller){var ret,castValue=Promise._cast(promises,caller,void 0);return isObject(castValue)?(Promise.is(castValue)?ret=castValue._then(Promise.props,void 0,void 0,void 0,void 0,caller):(ret=new PropertiesPromiseArray(castValue,caller,useBound===!0&&castValue._isBound()?castValue._boundTo:void 0).promise(),useBound=!1),useBound===!0&&castValue._isBound()&&ret._setBoundTo(castValue._boundTo),ret):apiRejection("cannot await properties of a non-object")
}var PropertiesPromiseArray=_dereq_("./properties_promise_array.js")(Promise,PromiseArray),util=_dereq_("./util.js"),apiRejection=_dereq_("./errors_api_rejection")(Promise),isObject=util.isObject;Promise.prototype.props=function(){return Promise$_Props(this,!0,this.props)},Promise.props=function(promises){return Promise$_Props(promises,!1,Promise.props)}}},{"./errors_api_rejection":28,"./properties_promise_array.js":43,"./util.js":56}],45:[function(_dereq_,module){"use strict";function arrayCopy(src,srcIndex,dst,dstIndex,len){for(var j=0;len>j;++j)dst[j+dstIndex]=src[j+srcIndex]}function pow2AtLeast(n){return n>>>=0,n-=1,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n+1}function getCapacity(capacity){return"number"!=typeof capacity?16:pow2AtLeast(Math.min(Math.max(16,capacity),1073741824))}function Queue(capacity){this._capacity=getCapacity(capacity),this._length=0,this._front=0,this._makeCapacity()}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size},Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg,this._length=length+1},Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length))return this._pushOne(fn),this._pushOne(receiver),void this._pushOne(arg);var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn,this[j+1&wrapMask]=receiver,this[j+2&wrapMask]=arg,this._length=length},Queue.prototype.shift=function(){var front=this._front,ret=this[front];return this[front]=void 0,this._front=front+1&this._capacity-1,this._length--,ret},Queue.prototype.length=function(){return this._length},Queue.prototype._makeCapacity=function(){for(var len=this._capacity,i=0;len>i;++i)this[i]=void 0},Queue.prototype._checkCapacity=function(size){this._capacity<size&&this._resizeTo(this._capacity<<3)},Queue.prototype._resizeTo=function(capacity){var oldFront=this._front,oldCapacity=this._capacity,oldQueue=new Array(oldCapacity),length=this.length();if(arrayCopy(this,0,oldQueue,0,oldCapacity),this._capacity=capacity,this._makeCapacity(),this._front=0,oldCapacity>=oldFront+length)arrayCopy(oldQueue,oldFront,this,0,length);else{var lengthBeforeWrapping=length-(oldFront+length&oldCapacity-1);arrayCopy(oldQueue,oldFront,this,0,lengthBeforeWrapping),arrayCopy(oldQueue,0,this,lengthBeforeWrapping,length-lengthBeforeWrapping)}},module.exports=Queue},{}],46:[function(_dereq_,module){"use strict";module.exports=function(Promise,INTERNAL){function Promise$_Race(promises,caller,parent){var maybePromise=Promise._cast(promises,caller,void 0);if(Promise.is(maybePromise))return raceLater(maybePromise);if(!isArray(promises))return apiRejection("expecting an array, a promise or a thenable");var ret=new Promise(INTERNAL);ret._setTrace(caller,parent),void 0!==parent&&(parent._isBound()&&ret._setBoundTo(parent._boundTo),parent._cancellable()&&(ret._setCancellable(),ret._cancellationParent=parent));for(var fulfill=ret._fulfill,reject=ret._reject,i=0,len=promises.length;len>i;++i){var val=promises[i];(void 0!==val||hasOwn.call(promises,i))&&Promise.cast(val)._then(fulfill,reject,void 0,ret,null,caller)}return ret}var apiRejection=_dereq_("./errors_api_rejection.js")(Promise),isArray=_dereq_("./util.js").isArray,raceLater=function(promise){return promise.then(function Promise$_lateRacer(array){return Promise$_Race(array,Promise$_lateRacer,promise)})},hasOwn={}.hasOwnProperty;Promise.race=function(promises){return Promise$_Race(promises,Promise.race,void 0)},Promise.prototype.race=function(){return Promise$_Race(this,this.race,void 0)}}},{"./errors_api_rejection.js":28,"./util.js":56}],47:[function(_dereq_,module){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection,INTERNAL){function Reduction(callback,index,accum,items,receiver){this.promise=new Promise(INTERNAL),this.index=index,this.length=items.length,this.items=items,this.callback=callback,this.receiver=receiver,this.accum=accum}function Promise$_reducer(fulfilleds,initialValue){var fn=this,receiver=void 0;"function"!=typeof fn&&(receiver=fn.receiver,fn=fn.fn);var len=fulfilleds.length,accum=void 0,startIndex=0;void 0!==initialValue?(accum=initialValue,startIndex=0):(startIndex=1,len>0&&(accum=fulfilleds[0]));var i=startIndex;if(i>=len)return accum;var reduction=new Reduction(fn,i,accum,fulfilleds,receiver);return reduction.iterate(),reduction.promise}function Promise$_unpackReducer(fulfilleds){var fn=this.fn,initialValue=this.initialValue;return Promise$_reducer.call(fn,fulfilleds,initialValue)}function Promise$_slowReduce(promises,fn,initialValue,useBound,caller){return initialValue._then(function callee(initialValue){return Promise$_Reduce(promises,fn,initialValue,useBound,callee)},void 0,void 0,void 0,void 0,caller)}function Promise$_Reduce(promises,fn,initialValue,useBound,caller){if("function"!=typeof fn)return apiRejection("fn must be a function");if(useBound===!0&&promises._isBound()&&(fn={fn:fn,receiver:promises._boundTo}),void 0!==initialValue){if(Promise.is(initialValue)){if(!initialValue.isFulfilled())return Promise$_slowReduce(promises,fn,initialValue,useBound,caller);initialValue=initialValue._settledValue}return Promise$_CreatePromiseArray(promises,PromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0).promise()._then(Promise$_unpackReducer,void 0,void 0,{fn:fn,initialValue:initialValue},void 0,Promise.reduce)}return Promise$_CreatePromiseArray(promises,PromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0).promise()._then(Promise$_reducer,void 0,void 0,fn,void 0,caller)}Reduction.prototype.reject=function(e){this.promise._reject(e)},Reduction.prototype.fulfill=function(value,index){this.accum=value,this.index=index+1,this.iterate()},Reduction.prototype.iterate=function(){for(var i=this.index,len=this.length,items=this.items,result=this.accum,receiver=this.receiver,callback=this.callback,iterate=this.iterate;len>i;++i)if(result=Promise._cast(callback.call(receiver,result,items[i],i,len),iterate,void 0),result instanceof Promise)return void result._then(this.fulfill,this.reject,void 0,this,i,iterate);this.promise._fulfill(result)},Promise.reduce=function(promises,fn,initialValue){return Promise$_Reduce(promises,fn,initialValue,!1,Promise.reduce)},Promise.prototype.reduce=function(fn,initialValue){return Promise$_Reduce(this,fn,initialValue,!0,this.reduce)}}},{}],48:[function(_dereq_,module){(function(process){"use strict";var schedule,global=_dereq_("./global.js");if("undefined"!=typeof process&&null!==process&&"function"==typeof process.cwd&&"function"==typeof process.nextTick&&"string"==typeof process.version)schedule=function(fn){process.nextTick(fn)};else if("function"!=typeof global.MutationObserver&&"function"!=typeof global.WebkitMutationObserver&&"function"!=typeof global.WebKitMutationObserver||"undefined"==typeof document||"function"!=typeof document.createElement)if("function"==typeof global.postMessage&&"function"!=typeof global.importScripts&&"function"==typeof global.addEventListener&&"function"==typeof global.removeEventListener){var MESSAGE_KEY="bluebird_message_key_"+Math.random();schedule=function(){function Promise$_Scheduler(e){if(e.source===global&&e.data===MESSAGE_KEY){var fn=queuedFn;queuedFn=void 0,fn()}}var queuedFn=void 0;return global.addEventListener("message",Promise$_Scheduler,!1),function(fn){queuedFn=fn,global.postMessage(MESSAGE_KEY,"*")}}()}else schedule="function"==typeof global.MessageChannel?function(){var queuedFn=void 0,channel=new global.MessageChannel;return channel.port1.onmessage=function(){var fn=queuedFn;queuedFn=void 0,fn()},function(fn){queuedFn=fn,channel.port2.postMessage(null)}}():global.setTimeout?function(fn){setTimeout(fn,4)}:function(fn){fn()};else schedule=function(){var MutationObserver=global.MutationObserver||global.WebkitMutationObserver||global.WebKitMutationObserver,div=document.createElement("div"),queuedFn=void 0,observer=new MutationObserver(function(){var fn=queuedFn;queuedFn=void 0,fn()});return observer.observe(div,{attributes:!0}),function(fn){queuedFn=fn,div.setAttribute("class","foo")}}();module.exports=schedule}).call(this,_dereq_("/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./global.js":33,"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65}],49:[function(_dereq_,module){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray){function Promise$_Settle(promises,useBound,caller){return Promise$_CreatePromiseArray(promises,SettledPromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0).promise()}var SettledPromiseArray=_dereq_("./settled_promise_array.js")(Promise,PromiseArray);Promise.settle=function(promises){return Promise$_Settle(promises,!1,Promise.settle)},Promise.prototype.settle=function(){return Promise$_Settle(this,!0,this.settle)}}},{"./settled_promise_array.js":50}],50:[function(_dereq_,module){"use strict";module.exports=function(Promise,PromiseArray){function SettledPromiseArray(values,caller,boundTo){this.constructor$(values,caller,boundTo)}var PromiseInspection=_dereq_("./promise_inspection.js"),util=_dereq_("./util.js"),inherits=util.inherits;return inherits(SettledPromiseArray,PromiseArray),SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},SettledPromiseArray.prototype._promiseFulfilled=function(value,index){if(!this._isResolved()){var ret=new PromiseInspection;ret._bitField=268435456,ret._settledValue=value,this._promiseResolved(index,ret)}},SettledPromiseArray.prototype._promiseRejected=function(reason,index){if(!this._isResolved()){var ret=new PromiseInspection;ret._bitField=134217728,ret._settledValue=reason,this._promiseResolved(index,ret)}},SettledPromiseArray}},{"./promise_inspection.js":39,"./util.js":56}],51:[function(_dereq_,module){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection){function Promise$_Some(promises,howMany,useBound,caller){if((0|howMany)!==howMany||0>howMany)return apiRejection("expecting a positive integer");var ret=Promise$_CreatePromiseArray(promises,SomePromiseArray,caller,useBound===!0&&promises._isBound()?promises._boundTo:void 0),promise=ret.promise();return promise.isRejected()?promise:(ret.setHowMany(howMany),ret.init(),promise)}var SomePromiseArray=_dereq_("./some_promise_array.js")(PromiseArray);Promise.some=function(promises,howMany){return Promise$_Some(promises,howMany,!1,Promise.some)},Promise.prototype.some=function(count){return Promise$_Some(this,count,!0,this.some)}}},{"./some_promise_array.js":52}],52:[function(_dereq_,module){"use strict";module.exports=function(PromiseArray){function SomePromiseArray(values,caller,boundTo){this.constructor$(values,caller,boundTo),this._howMany=0,this._unwrap=!1,this._initialized=!1}var util=_dereq_("./util.js"),RangeError=_dereq_("./errors.js").RangeError,inherits=util.inherits,isArray=util.isArray;return inherits(SomePromiseArray,PromiseArray),SomePromiseArray.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-2);var isArrayResolved=isArray(this._values);if(this._holes=isArrayResolved?this._values.length-this.length():0,!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()){var message="(Promise.some) input array contains less than "+this._howMany+" promises";this._reject(new RangeError(message))}}},SomePromiseArray.prototype.init=function(){this._initialized=!0,this._init()},SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=!0},SomePromiseArray.prototype.howMany=function(){return this._howMany},SomePromiseArray.prototype.setHowMany=function(count){this._isResolved()||(this._howMany=count)},SomePromiseArray.prototype._promiseFulfilled=function(value){this._isResolved()||(this._addFulfilled(value),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},SomePromiseArray.prototype._promiseRejected=function(reason){this._isResolved()||(this._addRejected(reason),this.howMany()>this._canPossiblyFulfill()&&this._reject(this._values.length===this.length()?[]:this._values.slice(this.length()+this._holes)))},SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved},SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()-this._holes},SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)},SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value},SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},SomePromiseArray}},{"./errors.js":27,"./util.js":56}],53:[function(_dereq_,module){"use strict";module.exports=function(Promise){var PromiseInspection=_dereq_("./promise_inspection.js");Promise.prototype.inspect=function(){return new PromiseInspection(this)}}},{"./promise_inspection.js":39}],54:[function(_dereq_,module){"use strict";module.exports=function(Promise,INTERNAL){function getThen(obj){try{return obj.then}catch(e){return errorObj.e=e,errorObj}}function Promise$_Cast(obj,caller,originalPromise){if(isObject(obj)){if(obj instanceof Promise)return obj;if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);return ret._setTrace(caller,void 0),obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null,void 0),ret._setFollowing(),ret}var then=getThen(obj);if(then===errorObj)return caller="function"==typeof caller?caller:Promise$_Cast,void 0!==originalPromise&&canAttach(then.e)&&originalPromise._attachExtraTrace(then.e),Promise.reject(then.e,caller);if("function"==typeof then)return caller="function"==typeof caller?caller:Promise$_Cast,Promise$_doThenable(obj,then,caller,originalPromise)}return obj}function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function Promise$_doThenable(x,then,caller,originalPromise){function Promise$_resolveFromThenable(y){if(!called){if(called=!0,x===y){var e=Promise._makeSelfResolutionError();return void 0!==originalPromise&&originalPromise._attachExtraTrace(e),void resolver.promise._reject(e,void 0)}resolver.resolve(y)}}function Promise$_rejectFromThenable(r){if(!called){called=!0;var trace=canAttach(r)?r:new Error(r+"");void 0!==originalPromise&&originalPromise._attachExtraTrace(trace),resolver.promise._reject(r,trace)}}function Promise$_progressFromThenable(v){if(!called){var promise=resolver.promise;"function"==typeof promise._progress&&promise._progress(v)}}var resolver=Promise.defer(caller),called=!1;try{then.call(x,Promise$_resolveFromThenable,Promise$_rejectFromThenable,Promise$_progressFromThenable)}catch(e){if(!called){called=!0;var trace=canAttach(e)?e:new Error(e+"");void 0!==originalPromise&&originalPromise._attachExtraTrace(trace),resolver.promise._reject(e,trace)}}return resolver.promise}var util=_dereq_("./util.js"),canAttach=_dereq_("./errors.js").canAttach,errorObj=util.errorObj,isObject=util.isObject,hasProp={}.hasOwnProperty;Promise._cast=Promise$_Cast}},{"./errors.js":27,"./util.js":56}],55:[function(_dereq_,module){"use strict";var global=_dereq_("./global.js"),setTimeout=function(fn,time){for(var $_len=arguments.length,args=new Array($_len-2),$_i=2;$_len>$_i;++$_i)args[$_i-2]=arguments[$_i];global.setTimeout(function(){fn.apply(void 0,args)},time)},pass={};global.setTimeout(function(_){_===pass&&(setTimeout=global.setTimeout)},1,pass),module.exports=function(Promise,INTERNAL){var errors=(_dereq_("./util.js"),_dereq_("./errors.js")),TimeoutError=(_dereq_("./errors_api_rejection")(Promise),Promise.TimeoutError),afterTimeout=function(promise,message,ms){if(promise.isPending()){"string"!=typeof message&&(message="operation timed out after "+ms+" ms");var err=new TimeoutError(message);errors.markAsOriginatingFromRejection(err),promise._attachExtraTrace(err),promise._rejectUnchecked(err)}},afterDelay=function(value,promise){promise._fulfill(value)};Promise.delay=function(value,ms,caller){void 0===ms&&(ms=value,value=void 0),ms=+ms,"function"!=typeof caller&&(caller=Promise.delay);var maybePromise=Promise._cast(value,caller,void 0),promise=new Promise(INTERNAL);return Promise.is(maybePromise)?(maybePromise._isBound()&&promise._setBoundTo(maybePromise._boundTo),maybePromise._cancellable()&&(promise._setCancellable(),promise._cancellationParent=maybePromise),promise._setTrace(caller,maybePromise),promise._follow(maybePromise),promise.then(function(value){return Promise.delay(value,ms)})):(promise._setTrace(caller,void 0),setTimeout(afterDelay,ms,value,promise),promise)},Promise.prototype.delay=function(ms){return Promise.delay(this,ms,this.delay)},Promise.prototype.timeout=function(ms,message){ms=+ms;var ret=new Promise(INTERNAL);return ret._setTrace(this.timeout,this),this._isBound()&&ret._setBoundTo(this._boundTo),this._cancellable()&&(ret._setCancellable(),ret._cancellationParent=this),ret._follow(this),setTimeout(afterTimeout,ms,ret,message,ms),ret}}},{"./errors.js":27,"./errors_api_rejection":28,"./global.js":33,"./util.js":56}],56:[function(_dereq_,module,exports){"use strict";function deprecated(msg){"undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("Bluebird: "+msg)}function tryCatch1(fn,receiver,arg){try{return fn.call(receiver,arg)}catch(e){return errorObj.e=e,errorObj}}function tryCatch2(fn,receiver,arg,arg2){try{return fn.call(receiver,arg,arg2)}catch(e){return errorObj.e=e,errorObj}}function tryCatchApply(fn,args,receiver){try{return fn.apply(receiver,args)}catch(e){return errorObj.e=e,errorObj}}function asString(val){return"string"==typeof val?val:""+val}function isPrimitive(val){return null==val||val===!0||val===!1||"string"==typeof val||"number"==typeof val}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){return isPrimitive(maybeError)?new Error(asString(maybeError)):maybeError}function withAppended(target,appendee){var i,len=target.length,ret=new Array(len+1);for(i=0;len>i;++i)ret[i]=target[i];return ret[i]=appendee,ret}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(obj,name,descriptor),obj}function thrower(r){throw r}function toFastProperties(obj){function f(){}return f.prototype=obj,f}var global=_dereq_("./global.js"),es5=_dereq_("./es5.js"),haveGetters=function(){try{var o={};return es5.defineProperty(o,"f",{get:function(){return 3}}),3===o.f}catch(e){return!1}}(),canEvaluate=function(){return"undefined"!=typeof window&&null!==window&&"undefined"!=typeof window.document&&"undefined"!=typeof navigator&&null!==navigator&&"string"==typeof navigator.appName&&window===global?!1:!0}(),errorObj={e:{}},inherits=function(Child,Parent){function T(){this.constructor=Child,this.constructor$=Parent;for(var propertyName in Parent.prototype)hasProp.call(Parent.prototype,propertyName)&&"$"!==propertyName.charAt(propertyName.length-1)&&(this[propertyName+"$"]=Parent.prototype[propertyName])}var hasProp={}.hasOwnProperty;return T.prototype=Parent.prototype,Child.prototype=new T,Child.prototype},wrapsPrimitiveReceiver=function(){return"string"!==this}.call("string"),ret={thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,deprecated:deprecated,errorObj:errorObj,tryCatch1:tryCatch1,tryCatch2:tryCatch2,tryCatchApply:tryCatchApply,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties};module.exports=ret},{"./es5.js":29,"./global.js":33}],57:[function(_dereq_,module){function replacer(key,value){return util.isUndefined(value)?""+value:!util.isNumber(value)||!isNaN(value)&&isFinite(value)?util.isFunction(value)||util.isRegExp(value)?value.toString():value:value.toString()}function truncate(s,n){return util.isString(s)?s.length<n?s:s.slice(0,n):s}function getMessage(self){return truncate(JSON.stringify(self.actual,replacer),128)+" "+self.operator+" "+truncate(JSON.stringify(self.expected,replacer),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected){if(actual===expected)return!0;if(util.isBuffer(actual)&&util.isBuffer(expected)){if(actual.length!=expected.length)return!1;for(var i=0;i<actual.length;i++)if(actual[i]!==expected[i])return!1;return!0}return util.isDate(actual)&&util.isDate(expected)?actual.getTime()===expected.getTime():util.isRegExp(actual)&&util.isRegExp(expected)?actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase:util.isObject(actual)||util.isObject(expected)?objEquiv(actual,expected):actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function objEquiv(a,b){if(util.isNullOrUndefined(a)||util.isNullOrUndefined(b))return!1;if(a.prototype!==b.prototype)return!1;if(isArguments(a))return isArguments(b)?(a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b)):!1;try{var key,i,ka=objectKeys(a),kb=objectKeys(b)}catch(e){return!1}if(ka.length!=kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!=kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key]))return!1;return!0}function expectedException(actual,expected){return actual&&expected?"[object RegExp]"==Object.prototype.toString.call(expected)?expected.test(actual):actual instanceof expected?!0:expected.call({},actual)===!0?!0:!1:!1}function _throws(shouldThrow,block,expected,message){var actual;util.isString(expected)&&(message=expected,expected=null);try{block()}catch(e){actual=e}if(message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message),!shouldThrow&&expectedException(actual,expected)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}var util=_dereq_("util/"),pSlice=Array.prototype.slice,hasOwn=Object.prototype.hasOwnProperty,assert=module.exports=ok;assert.AssertionError=function(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=stackStartFunction.name,idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert.throws=function(){_throws.apply(this,[!0].concat(pSlice.call(arguments)))},assert.doesNotThrow=function(){_throws.apply(this,[!1].concat(pSlice.call(arguments)))},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}},{"util/":59}],58:[function(_dereq_,module){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],59:[function(_dereq_,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str){return str}function arrayToHash(array){var hash={};return array.forEach(function(val){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)output.push(hasOwnProperty(value,String(i))?formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0):"");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)
}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=_dereq_("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=_dereq_("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,_dereq_("/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":58,"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65,inherits:64}],60:[function(_dereq_,module,exports){function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;if("base64"===encoding&&"string"===type)for(subject=stringtrim(subject);subject.length%4!==0;)subject+="=";var length;if("number"===type)length=coerce(subject);else if("string"===type)length=Buffer.byteLength(subject,encoding);else{if("object"!==type)throw new Error("First argument needs to be a number, array or string.");length=coerce(subject.length)}var buf;Buffer._useTypedArrays?buf=augment(new Uint8Array(length)):(buf=this,buf.length=length,buf._isBuffer=!0);var i;if(Buffer._useTypedArrays&&"function"==typeof Uint8Array&&subject instanceof Uint8Array)buf._set(subject);else if(isArrayish(subject))for(i=0;length>i;i++)buf[i]=Buffer.isBuffer(subject)?subject.readUInt8(i):subject[i];else if("string"===type)buf.write(subject,0,encoding);else if("number"===type&&!Buffer._useTypedArrays&&!noZero)for(i=0;length>i;i++)buf[i]=0;return buf}function _hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;assert(strLen%2===0,"Invalid hex string"),length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var byte=parseInt(string.substr(2*i,2),16);assert(!isNaN(byte),"Invalid hex string"),buf[offset+i]=byte}return Buffer._charsWritten=2*i,i}function _utf8Write(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function _asciiWrite(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function _binaryWrite(buf,string,offset,length){return _asciiWrite(buf,string,offset,length)}function _base64Write(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function _utf16leWrite(buf,string,offset,length){var charsWritten=Buffer._charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}function _base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function _utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function _asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function _binarySlice(buf,start,end){return _asciiSlice(buf,start,end)}function _hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function _utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function _readUInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(val=buf[offset],len>offset+1&&(val|=buf[offset+1]<<8)):(val=buf[offset]<<8,len>offset+1&&(val|=buf[offset+1])),val}}function _readUInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(len>offset+2&&(val=buf[offset+2]<<16),len>offset+1&&(val|=buf[offset+1]<<8),val|=buf[offset],len>offset+3&&(val+=buf[offset+3]<<24>>>0)):(len>offset+1&&(val=buf[offset+1]<<16),len>offset+2&&(val|=buf[offset+2]<<8),len>offset+3&&(val|=buf[offset+3]),val+=buf[offset]<<24>>>0),val}}function _readInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=_readUInt16(buf,offset,littleEndian,!0),neg=32768&val;return neg?-1*(65535-val+1):val}}function _readInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=_readUInt32(buf,offset,littleEndian,!0),neg=2147483648&val;return neg?-1*(4294967295-val+1):val}}function _readFloat(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+3<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,23,4)}function _readDouble(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+7<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,52,8)}function _writeUInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"trying to write beyond buffer length"),verifuint(value,65535));var len=buf.length;if(!(offset>=len))for(var i=0,j=Math.min(len-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function _writeUInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"trying to write beyond buffer length"),verifuint(value,4294967295));var len=buf.length;if(!(offset>=len))for(var i=0,j=Math.min(len-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function _writeInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to write beyond buffer length"),verifsint(value,32767,-32768));var len=buf.length;offset>=len||(value>=0?_writeUInt16(buf,value,offset,littleEndian,noAssert):_writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert))}function _writeInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifsint(value,2147483647,-2147483648));var len=buf.length;offset>=len||(value>=0?_writeUInt32(buf,value,offset,littleEndian,noAssert):_writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert))}function _writeFloat(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38));var len=buf.length;offset>=len||ieee754.write(buf,value,offset,littleEndian,23,4)}function _writeDouble(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+7<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308));var len=buf.length;offset>=len||ieee754.write(buf,value,offset,littleEndian,52,8)}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function augment(arr){return arr._isBuffer=!0,arr._get=arr.get,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr}function clamp(index,len,defaultValue){return"number"!=typeof index?defaultValue:(index=~~index,index>=len?len:index>=0?index:(index+=len,index>=0?index:0))}function coerce(length){return length=~~Math.ceil(+length),0>length?0:length}function isArray(subject){return(Array.isArray||function(subject){return"[object Array]"===Object.prototype.toString.call(subject)})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&"object"==typeof subject&&"number"==typeof subject.length}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(str){for(var byteArray=[],i=0;i<str.length;i++){var b=str.charCodeAt(i);if(127>=b)byteArray.push(str.charCodeAt(i));else{var start=i;b>=55296&&57343>=b&&i++;for(var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%"),j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str){for(var c,hi,lo,byteArray=[],i=0;i<str.length;i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert("number"==typeof value,"cannot write a non-number as a number"),assert(value>=0,"specified a negative value for writing an unsigned value"),assert(max>=value,"value is larger than maximum value for type"),assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value"),assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192,Buffer._useTypedArrays=function(){if("function"!=typeof Uint8Array||"function"!=typeof ArrayBuffer)return!1;try{var arr=new Uint8Array(0);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray}catch(e){return!1}}(),Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.isBuffer=function(b){return!(null===b||void 0===b||!b._isBuffer)},Buffer.byteLength=function(str,encoding){var ret;switch(str+="",encoding||"utf8"){case"hex":ret=str.length/2;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"ascii":case"binary":case"raw":ret=str.length;break;case"base64":ret=base64ToBytes(str).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=2*str.length;break;default:throw new Error("Unknown encoding")}return ret},Buffer.concat=function(list,totalLength){if(assert(isArray(list),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if("number"!=typeof totalLength)for(totalLength=0,i=0;i<list.length;i++)totalLength+=list[i].length;var buf=new Buffer(totalLength),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset))isFinite(length)||(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=length,length=swap}offset=Number(offset)||0;var remaining=this.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining,encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=_hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=_utf8Write(this,string,offset,length);break;case"ascii":ret=_asciiWrite(this,string,offset,length);break;case"binary":ret=_binaryWrite(this,string,offset,length);break;case"base64":ret=_base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=_utf16leWrite(this,string,offset,length);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toString=function(encoding,start,end){var self=this;if(encoding=String(encoding||"utf8").toLowerCase(),start=Number(start)||0,end=void 0!==end?Number(end):end=self.length,end===start)return"";var ret;switch(encoding){case"hex":ret=_hexSlice(self,start,end);break;case"utf8":case"utf-8":ret=_utf8Slice(self,start,end);break;case"ascii":ret=_asciiSlice(self,start,end);break;case"binary":ret=_binarySlice(self,start,end);break;case"base64":ret=_base64Slice(self,start,end);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=_utf16leSlice(self,start,end);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(start||(start=0),end||0===end||(end=this.length),target_start||(target_start=0),end!==start&&0!==target.length&&0!==source.length){assert(end>=start,"sourceEnd < sourceStart"),assert(target_start>=0&&target_start<target.length,"targetStart out of bounds"),assert(start>=0&&start<source.length,"sourceStart out of bounds"),assert(end>=0&&end<=source.length,"sourceEnd out of bounds"),end>this.length&&(end=this.length),target.length-target_start<end-start&&(end=target.length-target_start+start);for(var i=0;end-start>i;i++)target[i+target_start]=this[i+start]}},Buffer.prototype.slice=function(start,end){var len=this.length;if(start=clamp(start,len,0),end=clamp(end,len,len),Buffer._useTypedArrays)return augment(this.subarray(start,end));for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0,!0),i=0;sliceLen>i;i++)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),offset>=this.length?void 0:this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return _readUInt16(this,offset,!0,noAssert)},Buffer.prototype.readUInt16BE=function(offset,noAssert){return _readUInt16(this,offset,!1,noAssert)},Buffer.prototype.readUInt32LE=function(offset,noAssert){return _readUInt32(this,offset,!0,noAssert)},Buffer.prototype.readUInt32BE=function(offset,noAssert){return _readUInt32(this,offset,!1,noAssert)},Buffer.prototype.readInt8=function(offset,noAssert){if(noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),!(offset>=this.length)){var neg=128&this[offset];return neg?-1*(255-this[offset]+1):this[offset]}},Buffer.prototype.readInt16LE=function(offset,noAssert){return _readInt16(this,offset,!0,noAssert)},Buffer.prototype.readInt16BE=function(offset,noAssert){return _readInt16(this,offset,!1,noAssert)},Buffer.prototype.readInt32LE=function(offset,noAssert){return _readInt32(this,offset,!0,noAssert)},Buffer.prototype.readInt32BE=function(offset,noAssert){return _readInt32(this,offset,!1,noAssert)},Buffer.prototype.readFloatLE=function(offset,noAssert){return _readFloat(this,offset,!0,noAssert)},Buffer.prototype.readFloatBE=function(offset,noAssert){return _readFloat(this,offset,!1,noAssert)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return _readDouble(this,offset,!0,noAssert)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return _readDouble(this,offset,!1,noAssert)},Buffer.prototype.writeUInt8=function(value,offset,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"trying to write beyond buffer length"),verifuint(value,255)),offset>=this.length||(this[offset]=value)},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){_writeUInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){_writeUInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){_writeUInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){_writeUInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt8=function(value,offset,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to write beyond buffer length"),verifsint(value,127,-128)),offset>=this.length||(value>=0?this.writeUInt8(value,offset,noAssert):this.writeUInt8(255+value+1,offset,noAssert))},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){_writeInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){_writeInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){_writeInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){_writeInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){_writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){_writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){_writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){_writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),"string"==typeof value&&(value=value.charCodeAt(0)),assert("number"==typeof value&&!isNaN(value),"value is not a number"),assert(end>=start,"end < start"),end!==start&&0!==this.length){assert(start>=0&&start<this.length,"start out of bounds"),assert(end>=0&&end<=this.length,"end out of bounds");for(var i=start;end>i;i++)this[i]=value}},Buffer.prototype.inspect=function(){for(var out=[],len=this.length,i=0;len>i;i++)if(out[i]=toHex(this[i]),i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}return"<Buffer "+out.join(" ")+">"},Buffer.prototype.toArrayBuffer=function(){if("function"==typeof Uint8Array){if(Buffer._useTypedArrays)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype},{"base64-js":61,ieee754:62}],61:[function(_dereq_,module){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS=("0".charCodeAt(0),"+".charCodeAt(0)),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);module.exports.toByteArray=b64ToByteArray,module.exports.fromByteArray=uint8ToBase64}()},{}],62:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||1/0===value?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],63:[function(_dereq_,module){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length))throw er=arguments[1],er instanceof Error?er:TypeError('Uncaught, unspecified "error" event.');if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],64:[function(_dereq_,module){module.exports="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],65:[function(_dereq_,module){var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};if(canPost){var queue=[];
return window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}}return function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")}},{}],66:[function(_dereq_,module){function Duplex(options){return this instanceof Duplex?(Readable.call(this,options),Writable.call(this,options),options&&options.readable===!1&&(this.readable=!1),options&&options.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,options&&options.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",onend)):new Duplex(options)}function onend(){if(!this.allowHalfOpen&&!this._writableState.ended){var self=this;setImmediate(function(){self.end()})}}module.exports=Duplex;var inherits=_dereq_("inherits"),setImmediate=_dereq_("process/browser.js").nextTick,Readable=_dereq_("./readable.js"),Writable=_dereq_("./writable.js");inherits(Duplex,Readable),Duplex.prototype.write=Writable.prototype.write,Duplex.prototype.end=Writable.prototype.end,Duplex.prototype._write=Writable.prototype._write},{"./readable.js":70,"./writable.js":72,inherits:64,"process/browser.js":68}],67:[function(_dereq_,module){function Stream(){EE.call(this)}module.exports=Stream;var EE=_dereq_("events").EventEmitter,inherits=_dereq_("inherits");inherits(Stream,EE),Stream.Readable=_dereq_("./readable.js"),Stream.Writable=_dereq_("./writable.js"),Stream.Duplex=_dereq_("./duplex.js"),Stream.Transform=_dereq_("./transform.js"),Stream.PassThrough=_dereq_("./passthrough.js"),Stream.Stream=Stream,Stream.prototype.pipe=function(dest,options){function ondata(chunk){dest.writable&&!1===dest.write(chunk)&&source.pause&&source.pause()}function ondrain(){source.readable&&source.resume&&source.resume()}function onend(){didOnEnd||(didOnEnd=!0,dest.end())}function onclose(){didOnEnd||(didOnEnd=!0,"function"==typeof dest.destroy&&dest.destroy())}function onerror(er){if(cleanup(),0===EE.listenerCount(this,"error"))throw er}function cleanup(){source.removeListener("data",ondata),dest.removeListener("drain",ondrain),source.removeListener("end",onend),source.removeListener("close",onclose),source.removeListener("error",onerror),dest.removeListener("error",onerror),source.removeListener("end",cleanup),source.removeListener("close",cleanup),dest.removeListener("close",cleanup)}var source=this;source.on("data",ondata),dest.on("drain",ondrain),dest._isStdio||options&&options.end===!1||(source.on("end",onend),source.on("close",onclose));var didOnEnd=!1;return source.on("error",onerror),dest.on("error",onerror),source.on("end",cleanup),source.on("close",cleanup),dest.on("close",cleanup),dest.emit("pipe",source),dest}},{"./duplex.js":66,"./passthrough.js":69,"./readable.js":70,"./transform.js":71,"./writable.js":72,events:63,inherits:64}],68:[function(_dereq_,module){module.exports=_dereq_(65)},{}],69:[function(_dereq_,module){function PassThrough(options){return this instanceof PassThrough?void Transform.call(this,options):new PassThrough(options)}module.exports=PassThrough;var Transform=_dereq_("./transform.js"),inherits=_dereq_("inherits");inherits(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./transform.js":71,inherits:64}],70:[function(_dereq_,module){(function(process){function ReadableState(options){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||0===hwm?hwm:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!options.objectMode,this.defaultEncoding=options.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=_dereq_("string_decoder").StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){return this instanceof Readable?(this._readableState=new ReadableState(options,this),this.readable=!0,void Stream.call(this)):new Readable(options)}function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er)stream.emit("error",er);else if(null===chunk||void 0===chunk)state.reading=!1,state.ended||onEofChunk(stream,state);else if(state.objectMode||chunk&&chunk.length>0)if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else!state.decoder||addToFront||encoding||(chunk=state.decoder.write(chunk)),state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):(state.reading=!1,state.buffer.push(chunk)),state.needReadable&&emitReadable(stream),maybeReadMore(stream,state);else addToFront||(state.reading=!1);return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||0===state.length)}function roundUpToNextPowerOf2(n){if(n>=MAX_HWM)n=MAX_HWM;else{n--;for(var p=1;32>p;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){return 0===state.length&&state.ended?0:state.objectMode?0===n?0:1:isNaN(n)||null===n?state.flowing&&state.buffer.length?state.buffer[0].length:state.length:0>=n?0:(n>state.highWaterMark&&(state.highWaterMark=roundUpToNextPowerOf2(n)),n>state.length?state.ended?state.length:(state.needReadable=!0,0):n)}function chunkInvalid(state,chunk){var er=null;return Buffer.isBuffer(chunk)||"string"==typeof chunk||null===chunk||void 0===chunk||state.objectMode||er||(er=new TypeError("Invalid non-string/buffer chunk")),er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,state.length>0?emitReadable(stream):endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(state.emittedReadable=!0,state.sync?setImmediate(function(){emitReadable_(stream)}):emitReadable_(stream))}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,setImmediate(function(){maybeReadMore_(stream,state)}))}function maybeReadMore_(stream,state){for(var len=state.length;!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark&&(stream.read(0),len!==state.length);)len=state.length;state.readingMore=!1}function pipeOnDrain(src){return function(){var state=src._readableState;state.awaitDrain--,0===state.awaitDrain&&flow(src)}}function flow(src){function write(dest){var written=dest.write(chunk);!1===written&&state.awaitDrain++}var chunk,state=src._readableState;for(state.awaitDrain=0;state.pipesCount&&null!==(chunk=src.read());)if(1===state.pipesCount?write(state.pipes,0,null):forEach(state.pipes,write),src.emit("data",chunk),state.awaitDrain>0)return;return 0===state.pipesCount?(state.flowing=!1,void(EE.listenerCount(src,"data")>0&&emitDataEvents(src))):void(state.ranOut=!0)}function pipeOnReadable(){this._readableState.ranOut&&(this._readableState.ranOut=!1,flow(this))}function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing)throw new Error("Cannot switch to old mode now.");var paused=startPaused||!1,readable=!1;stream.readable=!0,stream.pipe=Stream.prototype.pipe,stream.on=stream.addListener=Stream.prototype.on,stream.on("readable",function(){readable=!0;for(var c;!paused&&null!==(c=stream.read());)stream.emit("data",c);null===c&&(readable=!1,stream._readableState.needReadable=!0)}),stream.pause=function(){paused=!0,this.emit("pause")},stream.resume=function(){paused=!1,readable?setImmediate(function(){stream.emit("readable")}):this.read(0),this.emit("resume")},stream.emit("readable")}function fromList(n,state){var ret,list=state.buffer,length=state.length,stringMode=!!state.decoder,objectMode=!!state.objectMode;if(0===list.length)return null;if(0===length)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length)ret=stringMode?list.join(""):Buffer.concat(list,length),list.length=0;else if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n),list[0]=buf.slice(n)}else if(n===list[0].length)ret=list.shift();else{ret=stringMode?"":new Buffer(n);for(var c=0,i=0,l=list.length;l>i&&n>c;i++){var buf=list[0],cpy=Math.min(n-c,buf.length);stringMode?ret+=buf.slice(0,cpy):buf.copy(ret,c,0,cpy),cpy<buf.length?list[0]=buf.slice(cpy):list.shift(),c+=cpy}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");!state.endEmitted&&state.calledRead&&(state.ended=!0,setImmediate(function(){state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit("end"))}))}function forEach(xs,f){for(var i=0,l=xs.length;l>i;i++)f(xs[i],i)}function indexOf(xs,x){for(var i=0,l=xs.length;l>i;i++)if(xs[i]===x)return i;return-1}module.exports=Readable,Readable.ReadableState=ReadableState;var StringDecoder,EE=_dereq_("events").EventEmitter,Stream=_dereq_("./index.js"),Buffer=_dereq_("buffer").Buffer,setImmediate=_dereq_("process/browser.js").nextTick,inherits=_dereq_("inherits");inherits(Readable,Stream),Readable.prototype.push=function(chunk,encoding){var state=this._readableState;return"string"!=typeof chunk||state.objectMode||(encoding=encoding||state.defaultEncoding,encoding!==state.encoding&&(chunk=new Buffer(chunk,encoding),encoding="")),readableAddChunk(this,state,chunk,encoding,!1)},Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",!0)},Readable.prototype.setEncoding=function(enc){StringDecoder||(StringDecoder=_dereq_("string_decoder").StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=enc};var MAX_HWM=8388608;Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=!0;var nOrig=n;if(("number"!=typeof n||n>0)&&(state.emittedReadable=!1),0===n&&state.needReadable&&(state.length>=state.highWaterMark||state.ended))return emitReadable(this),null;if(n=howMuchToRead(n,state),0===n&&state.ended)return 0===state.length&&endReadable(this),null;var doRead=state.needReadable;state.length-n<=state.highWaterMark&&(doRead=!0),(state.ended||state.reading)&&(doRead=!1),doRead&&(state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1),doRead&&!state.reading&&(n=howMuchToRead(nOrig,state));var ret;return ret=n>0?fromList(n,state):null,null===ret&&(state.needReadable=!0,n=0),state.length-=n,0!==state.length||state.ended||(state.needReadable=!0),state.ended&&!state.endEmitted&&0===state.length&&endReadable(this),ret},Readable.prototype._read=function(){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(dest,pipeOpts){function onunpipe(readable){readable===src&&cleanup()}function onend(){dest.end()}function cleanup(){dest.removeListener("close",onclose),dest.removeListener("finish",onfinish),dest.removeListener("drain",ondrain),dest.removeListener("error",onerror),dest.removeListener("unpipe",onunpipe),src.removeListener("end",onend),src.removeListener("end",cleanup),(!dest._writableState||dest._writableState.needDrain)&&ondrain()}function onerror(er){unpipe(),0===errListeners&&0===EE.listenerCount(dest,"error")&&dest.emit("error",er)}function onclose(){dest.removeListener("finish",onfinish),unpipe()}function onfinish(){dest.removeListener("close",onclose),unpipe()}function unpipe(){src.unpipe(dest)}var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==!1)&&dest!==process.stdout&&dest!==process.stderr,endFn=doEnd?onend:cleanup;state.endEmitted?setImmediate(endFn):src.once("end",endFn),dest.on("unpipe",onunpipe);var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var errListeners=EE.listenerCount(dest,"error");return dest.once("error",onerror),dest.once("close",onclose),dest.once("finish",onfinish),dest.emit("pipe",src),state.flowing||(this.on("readable",pipeOnReadable),state.flowing=!0,setImmediate(function(){flow(src)})),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState;if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,this.removeListener("readable",pipeOnReadable),state.flowing=!1,dest&&dest.emit("unpipe",this),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,this.removeListener("readable",pipeOnReadable),state.flowing=!1;for(var i=0;len>i;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);return-1===i?this:(state.pipes.splice(i,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit("unpipe",this),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if("data"!==ev||this._readableState.flowing||emitDataEvents(this),"readable"===ev&&this.readable){var state=this._readableState;state.readableListening||(state.readableListening=!0,state.emittedReadable=!1,state.needReadable=!0,state.reading?state.length&&emitReadable(this,state):this.read(0))}return res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){emitDataEvents(this),this.read(0),this.emit("resume")},Readable.prototype.pause=function(){emitDataEvents(this,!0),this.emit("pause")},Readable.prototype.wrap=function(stream){var state=this._readableState,paused=!1,self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&self.push(chunk)}self.push(null)}),stream.on("data",function(chunk){if(state.decoder&&(chunk=state.decoder.write(chunk)),chunk&&(state.objectMode||chunk.length)){var ret=self.push(chunk);ret||(paused=!0,stream.pause())}});for(var i in stream)"function"==typeof stream[i]&&"undefined"==typeof this[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));var events=["error","close","destroy","pause","resume"];return forEach(events,function(ev){stream.on(ev,function(x){return self.emit.apply(self,ev,x)})}),self._read=function(){paused&&(paused=!1,stream.resume())},self},Readable._fromList=fromList}).call(this,_dereq_("/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./index.js":67,"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65,buffer:60,events:63,inherits:64,"process/browser.js":68,string_decoder:73}],71:[function(_dereq_,module){function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=!1;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null,ts.writecb=null,null!==data&&void 0!==data&&stream.push(data),cb&&cb(er);var rs=stream._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&stream._read(rs.highWaterMark)}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var stream=(this._transformState=new TransformState(options,this),this);this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(er){done(stream,er)}):done(stream)})}function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState,ts=(stream._readableState,stream._transformState);if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}module.exports=Transform;var Duplex=_dereq_("./duplex.js"),inherits=_dereq_("inherits");inherits(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(){throw new Error("not implemented")},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(){var ts=this._transformState;ts.writechunk&&ts.writecb&&!ts.transforming?(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)):ts.needTransform=!0}},{"./duplex.js":66,inherits:64}],72:[function(_dereq_,module){function WriteReq(chunk,encoding,cb){this.chunk=chunk,this.encoding=encoding,this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||0===hwm?hwm:16384,this.objectMode=!!options.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var noDecode=options.decodeStrings===!1;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){onwrite(stream,er)},this.writecb=null,this.writelen=0,this.buffer=[]}function Writable(options){return this instanceof Writable||this instanceof Stream.Duplex?(this._writableState=new WritableState(options,this),this.writable=!0,void Stream.call(this)):new Writable(options)}function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er),setImmediate(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=!0;if(!Buffer.isBuffer(chunk)&&"string"!=typeof chunk&&null!==chunk&&void 0!==chunk&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er),setImmediate(function(){cb(er)}),valid=!1}return valid}function decodeChunk(state,chunk,encoding){return state.objectMode||state.decodeStrings===!1||"string"!=typeof chunk||(chunk=new Buffer(chunk,encoding)),chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;return state.needDrain=!ret,state.writing?state.buffer.push(new WriteReq(chunk,encoding,cb)):doWrite(stream,state,len,chunk,encoding,cb),ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,stream._write(chunk,encoding,state.onwrite),state.sync=!1}function onwriteError(stream,state,sync,er,cb){sync?setImmediate(function(){cb(er)}):cb(er),stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}function onwrite(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if(onwriteStateUpdate(state),er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);finished||state.bufferProcessing||!state.buffer.length||clearBuffer(stream,state),sync?setImmediate(function(){afterWrite(stream,state,finished,cb)}):afterWrite(stream,state,finished,cb)}}function afterWrite(stream,state,finished,cb){finished||onwriteDrain(stream,state),cb(),finished&&finishMaybe(stream,state)}function onwriteDrain(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit("drain"))}function clearBuffer(stream,state){state.bufferProcessing=!0;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c],chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback,len=state.objectMode?1:chunk.length;if(doWrite(stream,state,len,chunk,encoding,cb),state.writing){c++;break}}state.bufferProcessing=!1,c<state.buffer.length?state.buffer=state.buffer.slice(c):state.buffer.length=0}function needFinish(stream,state){return state.ending&&0===state.length&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);return need&&(state.finished=!0,stream.emit("finish")),need}function endWritable(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?setImmediate(cb):stream.once("finish",cb)),state.ended=!0}module.exports=Writable,Writable.WritableState=WritableState;var isUint8Array="undefined"!=typeof Uint8Array?function(x){return x instanceof Uint8Array}:function(x){return x&&x.constructor&&"Uint8Array"===x.constructor.name},isArrayBuffer="undefined"!=typeof ArrayBuffer?function(x){return x instanceof ArrayBuffer}:function(x){return x&&x.constructor&&"ArrayBuffer"===x.constructor.name},inherits=_dereq_("inherits"),Stream=_dereq_("./index.js"),setImmediate=_dereq_("process/browser.js").nextTick,Buffer=_dereq_("buffer").Buffer;inherits(Writable,Stream),Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState,ret=!1;return"function"==typeof encoding&&(cb=encoding,encoding=null),!Buffer.isBuffer(chunk)&&isUint8Array(chunk)&&(chunk=new Buffer(chunk)),isArrayBuffer(chunk)&&"undefined"!=typeof Uint8Array&&(chunk=new Buffer(new Uint8Array(chunk))),Buffer.isBuffer(chunk)?encoding="buffer":encoding||(encoding=state.defaultEncoding),"function"!=typeof cb&&(cb=function(){}),state.ended?writeAfterEnd(this,state,cb):validChunk(this,state,chunk,cb)&&(ret=writeOrBuffer(this,state,chunk,encoding,cb)),ret},Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))},Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;"function"==typeof chunk?(cb=chunk,chunk=null,encoding=null):"function"==typeof encoding&&(cb=encoding,encoding=null),"undefined"!=typeof chunk&&null!==chunk&&this.write(chunk,encoding),state.ending||state.finished||endWritable(this,state,cb)}},{"./index.js":67,buffer:60,inherits:64,"process/browser.js":68}],73:[function(_dereq_,module,exports){function assertEncoding(encoding){if(encoding&&!Buffer.isEncoding(encoding))throw new Error("Unknown encoding: "+encoding)}function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){var incomplete=this.charReceived=buffer.length%2;return this.charLength=incomplete?2:0,incomplete}function base64DetectIncompleteChar(buffer){var incomplete=this.charReceived=buffer.length%3;return this.charLength=incomplete?3:0,incomplete}var Buffer=_dereq_("buffer").Buffer,StringDecoder=exports.StringDecoder=function(encoding){switch(this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(encoding),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0};StringDecoder.prototype.write=function(buffer){for(var charStr="",offset=0;this.charLength;){var i=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;if(buffer.copy(this.charBuffer,this.charReceived,offset,i),this.charReceived+=i-offset,offset=i,this.charReceived<this.charLength)return"";charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(!(charCode>=55296&&56319>=charCode)){if(this.charReceived=this.charLength=0,i==buffer.length)return charStr;buffer=buffer.slice(i,buffer.length);break}this.charLength+=this.surrogateSize,charStr=""}var lenIncomplete=this.detectIncompleteChar(buffer),end=buffer.length;this.charLength&&(buffer.copy(this.charBuffer,0,buffer.length-lenIncomplete,end),this.charReceived=lenIncomplete,end-=lenIncomplete),charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1,charCode=charStr.charCodeAt(end);if(charCode>=55296&&56319>=charCode){var size=this.surrogateSize;return this.charLength+=size,this.charReceived+=size,this.charBuffer.copy(this.charBuffer,size,0,size),this.charBuffer.write(charStr.charAt(charStr.length-1),this.encoding),charStr.substring(0,end)}return charStr},StringDecoder.prototype.detectIncompleteChar=function(buffer){for(var i=buffer.length>=3?3:buffer.length;i>0;i--){var c=buffer[buffer.length-i];if(1==i&&c>>5==6){this.charLength=2;break}if(2>=i&&c>>4==14){this.charLength=3;break}if(3>=i&&c>>3==30){this.charLength=4;break}}return i},StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length&&(res=this.write(buffer)),this.charReceived){var cr=this.charReceived,buf=this.charBuffer,enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res}},{buffer:60}],74:[function(_dereq_,module){module.exports=_dereq_(58)},{}],75:[function(_dereq_,module){module.exports=_dereq_(59)},{"./support/isBuffer":74,"/home/mick/Programming/current/mammoth/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":65,inherits:64}],76:[function(_dereq_,module,exports){var util=_dereq_("util"),assert=_dereq_("assert"),_=_dereq_("underscore"),inspect=function(value){return util.inspect(value,!1,null)};exports.assertThat=function(value,matcher){var result=matcher.matchesWithDescription(value),message="Expected "+matcher.describeSelf()+"\nbut "+result.description;assert.ok(result.matches,message)},exports.is=function(value){return value&&value._isDuckMatcher?value:equalTo(value)};var equalTo=exports.equalTo=function(matchValue){return new Matcher({matches:function(value){return _.isEqual(value,matchValue)},describeMismatch:function(value){return"was "+inspect(value)},describeSelf:function(){return inspect(matchValue)}})};exports.isObject=function(object){var matchers=valuesToMatchers(object);return new Matcher({matchesWithDescription:function(value){var expectedKeys=ownKeys(object),hasPropertiesResult=exports.hasProperties(matchers).matchesWithDescription(value),unexpectedPropertyMismatches=ownKeys(value).filter(function(key){return-1===expectedKeys.indexOf(key)}).map(function(key){return'unexpected property: "'+key+'"'}),mismatchDescriptions=(hasPropertiesResult.matches?[]:[hasPropertiesResult.description]).concat(unexpectedPropertyMismatches);return 0===mismatchDescriptions.length?{matches:!0}:{matches:!1,description:mismatchDescriptions.join("\n")}},describeSelf:function(){return formatObjectOfMatchers(matchers)}})},exports.hasProperties=function(object){var matchers=valuesToMatchers(object);return new Matcher({matchesWithDescription:function(value){var expectedKeys=ownKeys(object);expectedKeys.sort(function(first,second){return second>first?-1:first>second?1:0});var propertyResults=expectedKeys.map(function(key){var propertyMatcher=matchers[key];if(objectHasOwnProperty(value,key)){if(propertyMatcher.matches(value[key]))return{matches:!0};var description='value of property "'+key+"\" didn't match:\n    "+indent(propertyMatcher.describeMismatch(value[key]),1)+"\n    expected "+indent(propertyMatcher.describeSelf(),1);return{matches:!1,description:description}}return{matches:!1,description:util.format('missing property: "%s"',key)}});return combineMatchResults(propertyResults)},describeSelf:function(){return"object with properties "+formatObjectOfMatchers(matchers)}})},exports.isArray=function(expectedArray){var elementMatchers=expectedArray.map(exports.is);return new Matcher({matchesWithDescription:function(value){if(value.length!==elementMatchers.length)return{matches:!1,description:"was of length "+value.length};var elementResults=_.zip(elementMatchers,value).map(function(values,index){var expectedMatcher=values[0],actual=values[1];if(expectedMatcher.matches(actual))return{matches:!0};var description="element at index "+index+" didn't match:\n    "+indent(expectedMatcher.describeMismatch(actual),1)+"\n    expected "+indent(expectedMatcher.describeSelf(),1);return{matches:!1,description:description}});return combineMatchResults(elementResults)},describeSelf:function(){return util.format("[%s]",_.invoke(elementMatchers,"describeSelf").join(", "))}})};var Matcher=function(matcher){this._matcher=matcher,this._isDuckMatcher=!0};Matcher.prototype.matches=function(value){return this._matcher.matchesWithDescription?this._matcher.matchesWithDescription(value).matches:this._matcher.matches(value)},Matcher.prototype.describeMismatch=function(value){return this._matcher.matchesWithDescription?this._matcher.matchesWithDescription(value).description:this._matcher.describeMismatch(value)},Matcher.prototype.matchesWithDescription=function(value){var isMatch=this.matches(value);return{matches:isMatch,description:isMatch?"":this.describeMismatch(value)}},Matcher.prototype.describeSelf=function(){return this._matcher.describeSelf()};var combineMatchResults=function(results){var mismatches=results.filter(function(result){return!result.matches});return combineMismatchs(mismatches)},combineMismatchs=function(mismatches){if(0===mismatches.length)return{matches:!0};var mismatchDescriptions=mismatches.map(function(mismatch){return mismatch.description});return{matches:!1,description:mismatchDescriptions.join("\n")}},ownKeys=function(obj){var keys=[];for(var key in obj)objectHasOwnProperty(obj,key)&&keys.push(key);return keys},objectHasOwnProperty=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},objectMap=function(obj,func){var matchers={};return _.forEach(obj,function(value,key){_.has(obj,key)&&(matchers[key]=func(value,key))}),matchers},valuesToMatchers=function(obj){return objectMap(obj,exports.is)},formatObject=function(obj){return 0===_.size(obj)?"{}":util.format("{%s\n}",formatProperties(obj))},formatProperties=function(obj){var properties=_.map(obj,function(value,key){return{key:key,value:value}}),sortedProperties=_.sortBy(properties,function(property){return property.key});return"\n    "+sortedProperties.map(function(property){return indent(property.key+": "+property.value,1)}).join(",\n    ")},formatObjectOfMatchers=function(matchers){return formatObject(objectMap(matchers,function(matcher){return matcher.describeSelf()}))},indent=function(str,indentationLevel){var indentation=_.range(indentationLevel).map(function(){return"    "}).join("");return str.replace(/\n/g,"\n"+indentation)};exports.any=new Matcher({matchesWithDescription:function(){return{matches:!0}},describeSelf:function(){return"<any>"}})},{assert:57,underscore:91,util:75}],77:[function(_dereq_,module,exports){exports.Parser=_dereq_("./lib/parser").Parser,exports.rules=_dereq_("./lib/rules"),exports.testing=_dereq_("./lib/testing"),exports.errors=_dereq_("./lib/errors"),exports.results=_dereq_("./lib/parsing-results"),exports.StringSource=_dereq_("./lib/StringSource"),exports.Token=_dereq_("./lib/Token"),exports.bottomUp=_dereq_("./lib/bottom-up"),exports.RegexTokeniser=_dereq_("./lib/regex-tokeniser").RegexTokeniser,exports.rule=function(ruleBuilder){var rule;
return function(input){return rule||(rule=ruleBuilder()),rule(input)}}},{"./lib/StringSource":78,"./lib/Token":79,"./lib/bottom-up":81,"./lib/errors":82,"./lib/parser":84,"./lib/parsing-results":85,"./lib/regex-tokeniser":86,"./lib/rules":87,"./lib/testing":88}],78:[function(_dereq_,module){var util=_dereq_("util"),StringSourceRange=(module.exports=function(string,description){var self={asString:function(){return string},range:function(startIndex,endIndex){return new StringSourceRange(string,description,startIndex,endIndex)}};return self},function(string,description,startIndex,endIndex){this._string=string,this._description=description,this._startIndex=startIndex,this._endIndex=endIndex});StringSourceRange.prototype.to=function(otherRange){return new StringSourceRange(this._string,this._description,this._startIndex,otherRange._endIndex)},StringSourceRange.prototype.describe=function(){for(var self=this,index=0,nextNewLine=function(){return self._string.indexOf("\n",index)},lineNumber=1;-1!==nextNewLine()&&nextNewLine()<this._startIndex;)index=nextNewLine()+1,lineNumber+=1;var characterNumber=this._startIndex-index+1,description=this._description?this._description+"\n":"";return util.format("%sLine number: %s\nCharacter number: %s",description,lineNumber,characterNumber)}},{util:75}],79:[function(_dereq_,module){module.exports=function(name,value,source){this.name=name,this.value=value,source&&(this.source=source)}},{}],80:[function(_dereq_,module){var TokenIterator=module.exports=function(tokens,startIndex){this._tokens=tokens,this._startIndex=startIndex||0};TokenIterator.prototype.head=function(){return this._tokens[this._startIndex]},TokenIterator.prototype.tail=function(){return new TokenIterator(this._tokens,this._startIndex+1)},TokenIterator.prototype.toArray=function(){return this._tokens.slice(this._startIndex)},TokenIterator.prototype.end=function(){return this._tokens[this._tokens.length-1]},TokenIterator.prototype.to=function(end){var start=this.head().source,endToken=end.head()||end.end();return start.to(endToken.source)}},{}],81:[function(_dereq_,module,exports){function InfixRules(infixRules){function untilExclusive(name){return new InfixRules(infixRules.slice(0,ruleNames().indexOf(name)))}function untilInclusive(name){return new InfixRules(infixRules.slice(0,ruleNames().indexOf(name)+1))}function ruleNames(){return infixRules.map(function(rule){return rule.name})}function apply(leftResult){for(var currentResult,source;;){if(currentResult=applyToTokens(leftResult.remaining()),!currentResult.isSuccess())return currentResult.isFailure()?leftResult:currentResult;source=leftResult.source().to(currentResult.source()),leftResult=results.success(currentResult.value()(leftResult.value(),source),currentResult.remaining(),source)}}function applyToTokens(tokens){return rules.firstOf("infix",infixRules.map(function(infix){return infix.rule}))(tokens)}return{apply:apply,untilExclusive:untilExclusive,untilInclusive:untilInclusive}}var rules=_dereq_("./rules"),results=_dereq_("./parsing-results");exports.parser=function(name,prefixRules,infixRuleBuilders){function createInfixRule(infixRuleBuilder){return{name:infixRuleBuilder.name,rule:lazyRule(infixRuleBuilder.ruleBuilder.bind(null,self))}}function rule(){return createRule(infixRules)}function leftAssociative(name){return createRule(infixRules.untilExclusive(name))}function rightAssociative(name){return createRule(infixRules.untilInclusive(name))}function createRule(infixRules){return apply.bind(null,infixRules)}function apply(infixRules,tokens){var leftResult=prefixRule(tokens);return leftResult.isSuccess()?infixRules.apply(leftResult):leftResult}var self={rule:rule,leftAssociative:leftAssociative,rightAssociative:rightAssociative},infixRules=new InfixRules(infixRuleBuilders.map(createInfixRule)),prefixRule=rules.firstOf(name,prefixRules);return self},exports.infix=function(name,ruleBuilder){function map(func){return exports.infix(name,function(parser){var rule=ruleBuilder(parser);return function(tokens){var result=rule(tokens);return result.map(function(right){return function(left,source){return func(left,right,source)}})}})}return{name:name,ruleBuilder:ruleBuilder,map:map}};var lazyRule=function(ruleBuilder){var rule;return function(input){return rule||(rule=ruleBuilder()),rule(input)}}},{"./parsing-results":85,"./rules":87}],82:[function(_dereq_,module,exports){exports.error=function(options){return new Error(options)};var Error=function(options){this._expected=options.expected,this._actual=options.actual,this._location=options.location};Error.prototype.describe=function(){var locationDescription=this._location?this._location.describe()+":\n":"";return locationDescription+"Expected "+this._expected+"\nbut got "+this._actual}},{}],83:[function(_dereq_,module,exports){var LazyIterator=(exports.fromArray=function(array){var index=0,hasNext=function(){return index<array.length};return new LazyIterator({hasNext:hasNext,next:function(){if(hasNext())return array[index++];throw new Error("No more elements")}})},function(iterator){this._iterator=iterator});LazyIterator.prototype.map=function(func){var iterator=this._iterator;return new LazyIterator({hasNext:function(){return iterator.hasNext()},next:function(){return func(iterator.next())}})},LazyIterator.prototype.filter=function(condition){var next,iterator=this._iterator,moved=!1,hasNext=!1,moveIfNecessary=function(){if(!moved)for(moved=!0,hasNext=!1;iterator.hasNext()&&!hasNext;)next=iterator.next(),hasNext=condition(next)};return new LazyIterator({hasNext:function(){return moveIfNecessary(),hasNext},next:function(){moveIfNecessary();var toReturn=next;return moved=!1,toReturn}})},LazyIterator.prototype.first=function(){var iterator=this._iterator;return this._iterator.hasNext()?iterator.next():null},LazyIterator.prototype.toArray=function(){for(var result=[];this._iterator.hasNext();)result.push(this._iterator.next());return result}},{}],84:[function(_dereq_,module,exports){var TokenIterator=_dereq_("./TokenIterator");exports.Parser=function(){var parseTokens=function(parser,tokens){return parser(new TokenIterator(tokens))};return{parseTokens:parseTokens}}},{"./TokenIterator":80}],85:[function(_dereq_,module){module.exports={failure:function(errors,remaining){if(errors.length<1)throw new Error("Failure must have errors");return new Result({status:"failure",remaining:remaining,errors:errors})},error:function(errors,remaining){if(errors.length<1)throw new Error("Failure must have errors");return new Result({status:"error",remaining:remaining,errors:errors})},success:function(value,remaining,source){return new Result({status:"success",value:value,source:source,remaining:remaining,errors:[]})},cut:function(remaining){return new Result({status:"cut",remaining:remaining,errors:[]})}};var Result=function(options){this._value=options.value,this._status=options.status,this._hasValue=void 0!==options.value,this._remaining=options.remaining,this._source=options.source,this._errors=options.errors};Result.prototype.map=function(func){return this._hasValue?new Result({value:func(this._value,this._source),status:this._status,remaining:this._remaining,source:this._source,errors:this._errors}):this},Result.prototype.changeRemaining=function(remaining){return new Result({value:this._value,status:this._status,remaining:remaining,source:this._source,errors:this._errors})},Result.prototype.isSuccess=function(){return"success"===this._status||"cut"===this._status},Result.prototype.isFailure=function(){return"failure"===this._status},Result.prototype.isError=function(){return"error"===this._status},Result.prototype.isCut=function(){return"cut"===this._status},Result.prototype.value=function(){return this._value},Result.prototype.remaining=function(){return this._remaining},Result.prototype.source=function(){return this._source},Result.prototype.errors=function(){return this._errors}},{}],86:[function(_dereq_,module,exports){function RegexTokeniser(rules){function tokenise(input,description){for(var source=new StringSource(input,description),index=0,tokens=[];index<input.length;){var nextToken=readNextToken(input,index,source);index+=nextToken.value.length,tokens.push(nextToken)}return tokens.push(endToken(input,source)),tokens}function readNextToken(string,startIndex,source){for(var i=0;i<rules.length;i++){var regex=rules[i].regex;regex.lastIndex=startIndex;var result=regex.exec(string);if(result&&result.index===startIndex&&result[0].length){var value=result[0];return new Token(rules[i].name,value,source.range(startIndex,startIndex+value.length))}}return new Token("unrecognisedCharacter",string.substring(startIndex,startIndex+1),source.range(startIndex,startIndex+1))}function endToken(input,source){return new Token("end",null,source.range(input.length,input.length))}return rules=rules.map(function(rule){return{name:rule.name,regex:new RegExp(rule.regex.source,"g")}}),{tokenise:tokenise}}var Token=_dereq_("./Token"),StringSource=_dereq_("./StringSource");exports.RegexTokeniser=RegexTokeniser},{"./StringSource":78,"./Token":79}],87:[function(_dereq_,module,exports){function noOpRule(input){return results.success(null,input)}function describeTokenMismatch(input,expected){var error,token=input.head();return error=errors.error(token?{expected:expected,actual:describeToken(token),location:token.source}:{expected:expected,actual:"end of tokens"}),results.failure([error],input)}var _=_dereq_("underscore"),options=_dereq_("option"),results=_dereq_("./parsing-results"),errors=_dereq_("./errors"),lazyIterators=_dereq_("./lazy-iterators");exports.token=function(tokenType,value){var matchValue=void 0!==value;return function(input){var token=input.head();if(!token||token.name!==tokenType||matchValue&&token.value!==value){var expected=describeToken({name:tokenType,value:value});return describeTokenMismatch(input,expected)}return results.success(token.value,input.tail(),token.source)}},exports.tokenOfType=function(tokenType){return exports.token(tokenType)},exports.firstOf=function(name,parsers){return _.isArray(parsers)||(parsers=Array.prototype.slice.call(arguments,1)),function(input){return lazyIterators.fromArray(parsers).map(function(parser){return parser(input)}).filter(function(result){return result.isSuccess()||result.isError()}).first()||describeTokenMismatch(input,name)}},exports.then=function(parser,func){return function(input){var result=parser(input);return result.map||console.log(result),result.map(func)}},exports.sequence=function(){function isCapturedRule(subRule){return subRule.isCaptured}var parsers=Array.prototype.slice.call(arguments,0),rule=function(input){var result=_.foldl(parsers,function(memo,parser){var result=memo.result,hasCut=memo.hasCut;if(!result.isSuccess())return{result:result,hasCut:hasCut};var subResult=parser(result.remaining());if(subResult.isCut())return{result:result,hasCut:!0};if(subResult.isSuccess()){var values;values=parser.isCaptured?result.value().withValue(parser,subResult.value()):result.value();var remaining=subResult.remaining(),source=input.to(remaining);return{result:results.success(values,remaining,source),hasCut:hasCut}}return hasCut?{result:results.error(subResult.errors(),subResult.remaining()),hasCut:hasCut}:{result:subResult,hasCut:hasCut}},{result:results.success(new SequenceValues,input),hasCut:!1}).result,source=input.to(result.remaining());return result.map(function(values){return values.withValue(exports.sequence.source,source)})};return rule.head=function(){var firstCapture=_.find(parsers,isCapturedRule);return exports.then(rule,exports.sequence.extract(firstCapture))},rule.map=function(func){return exports.then(rule,function(result){return func.apply(this,result.toArray())})},rule};var SequenceValues=function(values,valuesArray){this._values=values||{},this._valuesArray=valuesArray||[]};SequenceValues.prototype.withValue=function(rule,value){if(rule.captureName&&rule.captureName in this._values)throw new Error('Cannot add second value for capture "'+rule.captureName+'"');var newValues=_.clone(this._values);newValues[rule.captureName]=value;var newValuesArray=this._valuesArray.concat([value]);return new SequenceValues(newValues,newValuesArray)},SequenceValues.prototype.get=function(rule){if(rule.captureName in this._values)return this._values[rule.captureName];throw new Error('No value for capture "'+rule.captureName+'"')},SequenceValues.prototype.toArray=function(){return this._valuesArray},exports.sequence.capture=function(rule,name){var captureRule=function(){return rule.apply(this,arguments)};return captureRule.captureName=name,captureRule.isCaptured=!0,captureRule},exports.sequence.extract=function(rule){return function(result){return result.get(rule)}},exports.sequence.applyValues=function(func){var rules=Array.prototype.slice.call(arguments,1);return function(result){var values=rules.map(function(rule){return result.get(rule)});return func.apply(this,values)}},exports.sequence.source={captureName:"☃source☃"},exports.sequence.cut=function(){return function(input){return results.cut(input)}},exports.optional=function(rule){return function(input){var result=rule(input);return result.isSuccess()?result.map(options.some):result.isFailure()?results.success(options.none,input):result}},exports.zeroOrMoreWithSeparator=function(rule,separator){return repeatedWithSeparator(rule,separator,!1)},exports.oneOrMoreWithSeparator=function(rule,separator){return repeatedWithSeparator(rule,separator,!0)};var zeroOrMore=exports.zeroOrMore=function(rule){return function(input){for(var result,values=[];(result=rule(input))&&result.isSuccess();)input=result.remaining(),values.push(result.value());return result.isError()?result:results.success(values,input)}};exports.oneOrMore=function(rule){return exports.oneOrMoreWithSeparator(rule,noOpRule)};var repeatedWithSeparator=function(rule,separator,isOneOrMore){return function(input){var result=rule(input);if(result.isSuccess()){var mainRule=exports.sequence.capture(rule,"main"),remainingRule=zeroOrMore(exports.then(exports.sequence(separator,mainRule),exports.sequence.extract(mainRule))),remainingResult=remainingRule(result.remaining());return results.success([result.value()].concat(remainingResult.value()),remainingResult.remaining())}return isOneOrMore||result.isError()?result:results.success([],input)}};exports.leftAssociative=function(leftRule,rightRule,func){var rights;rights=func?[{func:func,rule:rightRule}]:rightRule,rights=rights.map(function(right){return exports.then(right.rule,function(rightValue){return function(leftValue,source){return right.func(leftValue,rightValue,source)}})});var repeatedRule=exports.firstOf.apply(null,["rules"].concat(rights));return function(input){var start=input,leftResult=leftRule(input);if(!leftResult.isSuccess())return leftResult;for(var repeatedResult=repeatedRule(leftResult.remaining());repeatedResult.isSuccess();){var remaining=repeatedResult.remaining(),source=start.to(repeatedResult.remaining()),right=repeatedResult.value();leftResult=results.success(right(leftResult.value(),source),remaining,source),repeatedResult=repeatedRule(leftResult.remaining())}return repeatedResult.isError()?repeatedResult:leftResult}},exports.leftAssociative.firstOf=function(){return Array.prototype.slice.call(arguments,0)},exports.nonConsuming=function(rule){return function(input){return rule(input).changeRemaining(input)}};var describeToken=function(token){return token.value?token.name+' "'+token.value+'"':token.name}},{"./errors":82,"./lazy-iterators":83,"./parsing-results":85,option:89,underscore:91}],88:[function(_dereq_,module,exports){var duck=(_dereq_("underscore"),_dereq_("duck")),Token=_dereq_("./Token"),assertIsSuccess=exports.assertIsSuccess=function(test,result,options){test.ok(result.isSuccess(),result.errors().map(function(error){return error.describe()}).join("\n\n")),options=options||{},options.remaining||(options.remaining=[new Token("end",null)]),assertResultExtras(test,result,options)},assertIsFailure=(exports.assertIsSuccessWithValue=function(test,result,value,source){assertIsSuccess(test,result,{value:value,source:source})},exports.assertIsFailure=function(test,result,options){test.deepEqual(result.isSuccess(),!1),assertResultExtras(test,result,options)}),assertRemaining=exports.assertRemaining=function(test,result,expectedRemaining){var actualRemaining=result.remaining().toArray();assertThat(test,actualRemaining,duck.isArray(expectedRemaining.map(duck.hasProperties)))},assertErrors=exports.assertErrors=function(test,result,expectedErrors){test.deepEqual(result.errors(),expectedErrors)},assertResultExtras=(exports.assertIsFailureWithRemaining=function(test,result,expectedRemaining){assertIsFailure(test,result),assertRemaining(test,result,expectedRemaining)},exports.assertIsError=function(test,result,options){test.ok(result.isError()),assertResultExtras(test,result,options)},function(test,result,options){options=options||{},options.remaining&&assertRemaining(test,result,options.remaining),options.errors&&assertErrors(test,result,options.errors),options.source&&test.deepEqual(result.source(),options.source),options.value&&assertThat(test,result.value(),duck.is(options.value))}),assertThat=function(test,value,matcher){var message="Expected "+matcher.describeSelf()+"\nbut "+matcher.describeMismatch(value);test.ok(matcher.matches(value),message)}},{"./Token":79,duck:76,underscore:91}],89:[function(_dereq_,module,exports){function callOrReturn(value){return"function"==typeof value?value():value}exports.none=Object.create({map:function(){return exports.none},toArray:function(){return[]},orElse:callOrReturn,valueOrElse:callOrReturn}),exports.some=function(value){return new Some(value)};var Some=function(value){this._value=value};Some.prototype.map=function(func){return new Some(func(this._value))},Some.prototype.toArray=function(){return[this._value]},Some.prototype.orElse=function(){return this},Some.prototype.valueOrElse=function(){return this._value},exports.isOption=function(value){return value===exports.none||value instanceof Some}},{}],90:[function(_dereq_,module,exports){(function(Buffer){!function(sax){function SAXParser(strict,opt){if(!(this instanceof SAXParser))return new SAXParser(strict,opt);var parser=this;clearBuffers(parser),parser.q=parser.c="",parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH,parser.opt=opt||{},parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags,parser.looseCase=parser.opt.lowercase?"toLowerCase":"toUpperCase",parser.tags=[],parser.closed=parser.closedRoot=parser.sawRoot=!1,parser.tag=parser.error=null,parser.strict=!!strict,parser.noscript=!(!strict&&!parser.opt.noscript),parser.state=S.BEGIN,parser.ENTITIES=Object.create(sax.ENTITIES),parser.attribList=[],parser.opt.xmlns&&(parser.ns=Object.create(rootNS)),parser.trackPosition=parser.opt.position!==!1,parser.trackPosition&&(parser.position=parser.line=parser.column=0),emit(parser,"onready")}function checkBufferLength(parser){for(var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10),maxActual=0,i=0,l=buffers.length;l>i;i++){var len=parser[buffers[i]].length;if(len>maxAllowed)switch(buffers[i]){case"textNode":closeText(parser);break;case"cdata":emitNode(parser,"oncdata",parser.cdata),parser.cdata="";break;case"script":emitNode(parser,"onscript",parser.script),parser.script="";break;default:error(parser,"Max buffer length exceeded: "+buffers[i])}maxActual=Math.max(maxActual,len)}parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH-maxActual+parser.position}function clearBuffers(parser){for(var i=0,l=buffers.length;l>i;i++)parser[buffers[i]]=""}function flushBuffers(parser){closeText(parser),""!==parser.cdata&&(emitNode(parser,"oncdata",parser.cdata),parser.cdata=""),""!==parser.script&&(emitNode(parser,"onscript",parser.script),parser.script="")}function createStream(strict,opt){return new SAXStream(strict,opt)}function SAXStream(strict,opt){if(!(this instanceof SAXStream))return new SAXStream(strict,opt);Stream.apply(this),this._parser=new SAXParser(strict,opt),this.writable=!0,this.readable=!0;var me=this;this._parser.onend=function(){me.emit("end")},this._parser.onerror=function(er){me.emit("error",er),me._parser.error=null},this._decoder=null,streamWraps.forEach(function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev]},set:function(h){return h?void me.on(ev,h):(me.removeAllListeners(ev),me._parser["on"+ev]=h)},enumerable:!0,configurable:!1})})}function charClass(str){return str.split("").reduce(function(s,c){return s[c]=!0,s},{})}function isRegExp(c){return"[object RegExp]"===Object.prototype.toString.call(c)}function is(charclass,c){return isRegExp(charclass)?!!c.match(charclass):charclass[c]}function not(charclass,c){return!is(charclass,c)}function emit(parser,event,data){parser[event]&&parser[event](data)}function emitNode(parser,nodeType,data){parser.textNode&&closeText(parser),emit(parser,nodeType,data)}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode),parser.textNode&&emit(parser,"ontext",parser.textNode),parser.textNode=""}function textopts(opt,text){return opt.trim&&(text=text.trim()),opt.normalize&&(text=text.replace(/\s+/g," ")),text}function error(parser,er){return closeText(parser),parser.trackPosition&&(er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c),er=new Error(er),parser.error=er,emit(parser,"onerror",er),parser}function end(parser){return parser.closedRoot||strictFail(parser,"Unclosed root tag"),parser.state!==S.BEGIN&&parser.state!==S.TEXT&&error(parser,"Unexpected end"),closeText(parser),parser.c="",parser.closed=!0,emit(parser,"onend"),SAXParser.call(parser,parser.strict,parser.opt),parser}function strictFail(parser,message){if("object"!=typeof parser||!(parser instanceof SAXParser))throw new Error("bad call to strictFail");parser.strict&&error(parser,message)}function newTag(parser){parser.strict||(parser.tagName=parser.tagName[parser.looseCase]());var parent=parser.tags[parser.tags.length-1]||parser,tag=parser.tag={name:parser.tagName,attributes:{}};parser.opt.xmlns&&(tag.ns=parent.ns),parser.attribList.length=0}function qname(name,attribute){var i=name.indexOf(":"),qualName=0>i?["",name]:name.split(":"),prefix=qualName[0],local=qualName[1];return attribute&&"xmlns"===name&&(prefix="xmlns",local=""),{prefix:prefix,local:local}}function attrib(parser){if(parser.strict||(parser.attribName=parser.attribName[parser.looseCase]()),-1!==parser.attribList.indexOf(parser.attribName)||parser.tag.attributes.hasOwnProperty(parser.attribName))return parser.attribName=parser.attribValue="";if(parser.opt.xmlns){var qn=qname(parser.attribName,!0),prefix=qn.prefix,local=qn.local;if("xmlns"===prefix)if("xml"===local&&parser.attribValue!==XML_NAMESPACE)strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\nActual: "+parser.attribValue);else if("xmlns"===local&&parser.attribValue!==XMLNS_NAMESPACE)strictFail(parser,"xmlns: prefix must be bound to "+XMLNS_NAMESPACE+"\nActual: "+parser.attribValue);else{var tag=parser.tag,parent=parser.tags[parser.tags.length-1]||parser;tag.ns===parent.ns&&(tag.ns=Object.create(parent.ns)),tag.ns[local]=parser.attribValue}parser.attribList.push([parser.attribName,parser.attribValue])}else parser.tag.attributes[parser.attribName]=parser.attribValue,emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue});parser.attribName=parser.attribValue=""}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag,qn=qname(parser.tagName);tag.prefix=qn.prefix,tag.local=qn.local,tag.uri=tag.ns[qn.prefix]||"",tag.prefix&&!tag.uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName)),tag.uri=qn.prefix);var parent=parser.tags[parser.tags.length-1]||parser;tag.ns&&parent.ns!==tag.ns&&Object.keys(tag.ns).forEach(function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]})});for(var i=0,l=parser.attribList.length;l>i;i++){var nv=parser.attribList[i],name=nv[0],value=nv[1],qualName=qname(name,!0),prefix=qualName.prefix,local=qualName.local,uri=""==prefix?"":tag.ns[prefix]||"",a={name:name,value:value,prefix:prefix,local:local,uri:uri};prefix&&"xmlns"!=prefix&&!uri&&(strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix)),a.uri=prefix),parser.tag.attributes[name]=a,emitNode(parser,"onattribute",a)}parser.attribList.length=0}parser.tag.isSelfClosing=!!selfClosing,parser.sawRoot=!0,parser.tags.push(parser.tag),emitNode(parser,"onopentag",parser.tag),selfClosing||(parser.state=parser.noscript||"script"!==parser.tagName.toLowerCase()?S.TEXT:S.SCRIPT,parser.tag=null,parser.tagName=""),parser.attribName=parser.attribValue="",parser.attribList.length=0}function closeTag(parser){if(!parser.tagName)return strictFail(parser,"Weird empty close tag."),parser.textNode+="</>",void(parser.state=S.TEXT);if(parser.script){if("script"!==parser.tagName)return parser.script+="</"+parser.tagName+">",parser.tagName="",void(parser.state=S.SCRIPT);emitNode(parser,"onscript",parser.script),parser.script=""}var t=parser.tags.length,tagName=parser.tagName;parser.strict||(tagName=tagName[parser.looseCase]());for(var closeTo=tagName;t--;){var close=parser.tags[t];if(close.name===closeTo)break;strictFail(parser,"Unexpected close tag")}if(0>t)return strictFail(parser,"Unmatched closing tag: "+parser.tagName),parser.textNode+="</"+parser.tagName+">",void(parser.state=S.TEXT);parser.tagName=tagName;for(var s=parser.tags.length;s-->t;){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name,emitNode(parser,"onclosetag",parser.tagName);var x={};for(var i in tag.ns)x[i]=tag.ns[i];var parent=parser.tags[parser.tags.length-1]||parser;parser.opt.xmlns&&tag.ns!==parent.ns&&Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n})})}0===t&&(parser.closedRoot=!0),parser.tagName=parser.attribValue=parser.attribName="",parser.attribList.length=0,parser.state=S.TEXT}function parseEntity(parser){var num,entity=parser.entity,entityLC=entity.toLowerCase(),numStr="";return parser.ENTITIES[entity]?parser.ENTITIES[entity]:parser.ENTITIES[entityLC]?parser.ENTITIES[entityLC]:(entity=entityLC,"#"===entity.charAt(0)&&("x"===entity.charAt(1)?(entity=entity.slice(2),num=parseInt(entity,16),numStr=num.toString(16)):(entity=entity.slice(1),num=parseInt(entity,10),numStr=num.toString(10))),entity=entity.replace(/^0+/,""),numStr.toLowerCase()!==entity?(strictFail(parser,"Invalid character entity"),"&"+parser.entity+";"):String.fromCharCode(num))}function write(chunk){var parser=this;if(this.error)throw this.error;if(parser.closed)return error(parser,"Cannot write after close. Assign an onready handler.");if(null===chunk)return end(parser);for(var i=0,c="";parser.c=c=chunk.charAt(i++);)switch(parser.trackPosition&&(parser.position++,"\n"===c?(parser.line++,parser.column=0):parser.column++),parser.state){case S.BEGIN:"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):not(whitespace,c)&&(strictFail(parser,"Non-whitespace before first tag."),parser.textNode=c,parser.state=S.TEXT);continue;case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){for(var starti=i-1;c&&"<"!==c&&"&"!==c;)c=chunk.charAt(i++),c&&parser.trackPosition&&(parser.position++,"\n"===c?(parser.line++,parser.column=0):parser.column++);parser.textNode+=chunk.substring(starti,i-1)}"<"===c?(parser.state=S.OPEN_WAKA,parser.startTagPosition=parser.position):(!not(whitespace,c)||parser.sawRoot&&!parser.closedRoot||strictFail(parser,"Text data outside of root node."),"&"===c?parser.state=S.TEXT_ENTITY:parser.textNode+=c);continue;case S.SCRIPT:"<"===c?parser.state=S.SCRIPT_ENDING:parser.script+=c;continue;case S.SCRIPT_ENDING:"/"===c?parser.state=S.CLOSE_TAG:(parser.script+="<"+c,parser.state=S.SCRIPT);continue;case S.OPEN_WAKA:if("!"===c)parser.state=S.SGML_DECL,parser.sgmlDecl="";else if(is(whitespace,c));else if(is(nameStart,c))parser.state=S.OPEN_TAG,parser.tagName=c;else if("/"===c)parser.state=S.CLOSE_TAG,parser.tagName="";else if("?"===c)parser.state=S.PROC_INST,parser.procInstName=parser.procInstBody="";else{if(strictFail(parser,"Unencoded <"),parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition;c=new Array(pad).join(" ")+c}parser.textNode+="<"+c,parser.state=S.TEXT}continue;case S.SGML_DECL:(parser.sgmlDecl+c).toUpperCase()===CDATA?(emitNode(parser,"onopencdata"),parser.state=S.CDATA,parser.sgmlDecl="",parser.cdata=""):parser.sgmlDecl+c==="--"?(parser.state=S.COMMENT,parser.comment="",parser.sgmlDecl=""):(parser.sgmlDecl+c).toUpperCase()===DOCTYPE?(parser.state=S.DOCTYPE,(parser.doctype||parser.sawRoot)&&strictFail(parser,"Inappropriately located doctype declaration"),parser.doctype="",parser.sgmlDecl=""):">"===c?(emitNode(parser,"onsgmldeclaration",parser.sgmlDecl),parser.sgmlDecl="",parser.state=S.TEXT):is(quote,c)?(parser.state=S.SGML_DECL_QUOTED,parser.sgmlDecl+=c):parser.sgmlDecl+=c;continue;case S.SGML_DECL_QUOTED:c===parser.q&&(parser.state=S.SGML_DECL,parser.q=""),parser.sgmlDecl+=c;continue;case S.DOCTYPE:">"===c?(parser.state=S.TEXT,emitNode(parser,"ondoctype",parser.doctype),parser.doctype=!0):(parser.doctype+=c,"["===c?parser.state=S.DOCTYPE_DTD:is(quote,c)&&(parser.state=S.DOCTYPE_QUOTED,parser.q=c));continue;case S.DOCTYPE_QUOTED:parser.doctype+=c,c===parser.q&&(parser.q="",parser.state=S.DOCTYPE);continue;case S.DOCTYPE_DTD:parser.doctype+=c,"]"===c?parser.state=S.DOCTYPE:is(quote,c)&&(parser.state=S.DOCTYPE_DTD_QUOTED,parser.q=c);continue;case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c,c===parser.q&&(parser.state=S.DOCTYPE_DTD,parser.q="");continue;case S.COMMENT:"-"===c?parser.state=S.COMMENT_ENDING:parser.comment+=c;continue;case S.COMMENT_ENDING:"-"===c?(parser.state=S.COMMENT_ENDED,parser.comment=textopts(parser.opt,parser.comment),parser.comment&&emitNode(parser,"oncomment",parser.comment),parser.comment=""):(parser.comment+="-"+c,parser.state=S.COMMENT);continue;case S.COMMENT_ENDED:">"!==c?(strictFail(parser,"Malformed comment"),parser.comment+="--"+c,parser.state=S.COMMENT):parser.state=S.TEXT;continue;case S.CDATA:"]"===c?parser.state=S.CDATA_ENDING:parser.cdata+=c;continue;case S.CDATA_ENDING:"]"===c?parser.state=S.CDATA_ENDING_2:(parser.cdata+="]"+c,parser.state=S.CDATA);continue;case S.CDATA_ENDING_2:">"===c?(parser.cdata&&emitNode(parser,"oncdata",parser.cdata),emitNode(parser,"onclosecdata"),parser.cdata="",parser.state=S.TEXT):"]"===c?parser.cdata+="]":(parser.cdata+="]]"+c,parser.state=S.CDATA);continue;case S.PROC_INST:"?"===c?parser.state=S.PROC_INST_ENDING:is(whitespace,c)?parser.state=S.PROC_INST_BODY:parser.procInstName+=c;continue;case S.PROC_INST_BODY:if(!parser.procInstBody&&is(whitespace,c))continue;"?"===c?parser.state=S.PROC_INST_ENDING:parser.procInstBody+=c;continue;case S.PROC_INST_ENDING:">"===c?(emitNode(parser,"onprocessinginstruction",{name:parser.procInstName,body:parser.procInstBody}),parser.procInstName=parser.procInstBody="",parser.state=S.TEXT):(parser.procInstBody+="?"+c,parser.state=S.PROC_INST_BODY);continue;case S.OPEN_TAG:is(nameBody,c)?parser.tagName+=c:(newTag(parser),">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:(not(whitespace,c)&&strictFail(parser,"Invalid character in tag name"),parser.state=S.ATTRIB));continue;case S.OPEN_TAG_SLASH:">"===c?(openTag(parser,!0),closeTag(parser)):(strictFail(parser,"Forward-slash in opening tag not followed by >"),parser.state=S.ATTRIB);continue;case S.ATTRIB:if(is(whitespace,c))continue;">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(parser.attribName=c,parser.attribValue="",parser.state=S.ATTRIB_NAME):strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME:"="===c?parser.state=S.ATTRIB_VALUE:">"===c?(strictFail(parser,"Attribute without value"),parser.attribValue=parser.attribName,attrib(parser),openTag(parser)):is(whitespace,c)?parser.state=S.ATTRIB_NAME_SAW_WHITE:is(nameBody,c)?parser.attribName+=c:strictFail(parser,"Invalid attribute name");
continue;case S.ATTRIB_NAME_SAW_WHITE:if("="===c)parser.state=S.ATTRIB_VALUE;else{if(is(whitespace,c))continue;strictFail(parser,"Attribute without value"),parser.tag.attributes[parser.attribName]="",parser.attribValue="",emitNode(parser,"onattribute",{name:parser.attribName,value:""}),parser.attribName="",">"===c?openTag(parser):is(nameStart,c)?(parser.attribName=c,parser.state=S.ATTRIB_NAME):(strictFail(parser,"Invalid attribute name"),parser.state=S.ATTRIB)}continue;case S.ATTRIB_VALUE:if(is(whitespace,c))continue;is(quote,c)?(parser.q=c,parser.state=S.ATTRIB_VALUE_QUOTED):(strictFail(parser,"Unquoted attribute value"),parser.state=S.ATTRIB_VALUE_UNQUOTED,parser.attribValue=c);continue;case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){"&"===c?parser.state=S.ATTRIB_VALUE_ENTITY_Q:parser.attribValue+=c;continue}attrib(parser),parser.q="",parser.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:is(whitespace,c)?parser.state=S.ATTRIB:">"===c?openTag(parser):"/"===c?parser.state=S.OPEN_TAG_SLASH:is(nameStart,c)?(strictFail(parser,"No whitespace between attributes"),parser.attribName=c,parser.attribValue="",parser.state=S.ATTRIB_NAME):strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){"&"===c?parser.state=S.ATTRIB_VALUE_ENTITY_U:parser.attribValue+=c;continue}attrib(parser),">"===c?openTag(parser):parser.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(parser.tagName)">"===c?closeTag(parser):is(nameBody,c)?parser.tagName+=c:parser.script?(parser.script+="</"+parser.tagName,parser.tagName="",parser.state=S.SCRIPT):(not(whitespace,c)&&strictFail(parser,"Invalid tagname in closing tag"),parser.state=S.CLOSE_TAG_SAW_WHITE);else{if(is(whitespace,c))continue;not(nameStart,c)?parser.script?(parser.script+="</"+c,parser.state=S.SCRIPT):strictFail(parser,"Invalid tagname in closing tag."):parser.tagName=c}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c))continue;">"===c?closeTag(parser):strictFail(parser,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:switch(parser.state){case S.TEXT_ENTITY:var returnState=S.TEXT,buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:var returnState=S.ATTRIB_VALUE_QUOTED,buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:var returnState=S.ATTRIB_VALUE_UNQUOTED,buffer="attribValue"}";"===c?(parser[buffer]+=parseEntity(parser),parser.entity="",parser.state=returnState):is(entity,c)?parser.entity+=c:(strictFail(parser,"Invalid character entity"),parser[buffer]+="&"+parser.entity+c,parser.entity="",parser.state=returnState);continue;default:throw new Error(parser,"Unknown state: "+parser.state)}return parser.position>=parser.bufferCheckPosition&&checkBufferLength(parser),parser}sax.parser=function(strict,opt){return new SAXParser(strict,opt)},sax.SAXParser=SAXParser,sax.SAXStream=SAXStream,sax.createStream=createStream,sax.MAX_BUFFER_LENGTH=65536;var buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(o){function f(){this.__proto__=o}return f.prototype=o,new f}),Object.getPrototypeOf||(Object.getPrototypeOf=function(o){return o.__proto__}),Object.keys||(Object.keys=function(o){var a=[];for(var i in o)o.hasOwnProperty(i)&&a.push(i);return a}),SAXParser.prototype={end:function(){end(this)},write:write,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){flushBuffers(this)}};try{var Stream=_dereq_("stream").Stream}catch(ex){var Stream=function(){}}var streamWraps=sax.EVENTS.filter(function(ev){return"error"!==ev&&"end"!==ev});SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}}),SAXStream.prototype.write=function(data){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(data)){if(!this._decoder){var SD=_dereq_("string_decoder").StringDecoder;this._decoder=new SD("utf8")}data=this._decoder.write(data)}return this._parser.write(data.toString()),this.emit("data",data),!0},SAXStream.prototype.end=function(chunk){return chunk&&chunk.length&&this.write(chunk),this._parser.end(),!0},SAXStream.prototype.on=function(ev,handler){var me=this;return me._parser["on"+ev]||-1===streamWraps.indexOf(ev)||(me._parser["on"+ev]=function(){var args=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev),me.emit.apply(me,args)}),Stream.prototype.on.call(me,ev,handler)};var whitespace="\r\n	 ",number="0124356789",letter="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",quote="'\"",entity=number+letter+"#",attribEnd=whitespace+">",CDATA="[CDATA[",DOCTYPE="DOCTYPE",XML_NAMESPACE="http://www.w3.org/XML/1998/namespace",XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/",rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE};whitespace=charClass(whitespace),number=charClass(number),letter=charClass(letter);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;quote=charClass(quote),entity=charClass(entity),attribEnd=charClass(attribEnd);var S=0;sax.STATE={BEGIN:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++},sax.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key],s="number"==typeof e?String.fromCharCode(e):e;sax.ENTITIES[key]=s});for(var S in sax.STATE)sax.STATE[sax.STATE[S]]=S;S=sax.STATE}("undefined"==typeof exports?sax={}:exports)}).call(this,_dereq_("buffer").Buffer)},{buffer:60,stream:67,string_decoder:73}],91:[function(_dereq_,module,exports){(function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.4.4";var each=_.each=_.forEach=function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list)}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,iterator,context){var result;return any(obj,function(value,index,list){return iterator.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,iterator,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)}),results)},_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list)},context)},_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(iterator,context):(each(obj,function(value,index,list){return(result=result&&iterator.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(iterator,context):(each(obj,function(value,index,list){return result||(result=iterator.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,function(value){return value[key]})},_.where=function(obj,attrs,first){return _.isEmpty(attrs)?first?null:[]:_[first?"find":"filter"](obj,function(value){for(var key in attrs)if(attrs[key]!==value[key])return!1;return!0})},_.findWhere=function(obj,attrs){return _.where(obj,attrs,!0)},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-1/0;var result={computed:-1/0,value:-1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed})}),result.value},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return 1/0;var result={computed:1/0,value:1/0};return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed})}),result.value},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value]}};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index<right.index?-1:1}),"value")};var group=function(obj,value,context,behavior){var result={},iterator=lookupIterator(value||_.identity);return each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result};_.groupBy=function(obj,value,context){return group(obj,value,context,function(result,key,value){(_.has(result,key)?result[key]:result[key]=[]).push(value)})},_.countBy=function(obj,value,context){return group(obj,value,context,function(result,key){_.has(result,key)||(result[key]=0),result[key]++})},_.sortedIndex=function(array,obj,iterator,context){iterator=null==iterator?_.identity:lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return each(input,function(value){_.isArray(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(concat.apply(ArrayProto,arguments))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var args=slice.call(arguments),length=_.max(_.pluck(args,"length")),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(args,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,l=list.length;l>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,l=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,l+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;l>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var len=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(len);len>idx;)range[idx++]=start,start+=step;return range},_.bind=function(func,context){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(context,args.concat(slice.call(arguments)))}},_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)))}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);return 0===funcs.length&&(funcs=_.functions(obj)),each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait){var context,args,timeout,result,previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date,remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&(result=func.apply(context,args)),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return function(){var args=[func];return push.apply(args,arguments),wrapper.apply(this,args)}},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return 0>=times?func():function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&(keys[keys.length]=key);return keys},_.values=function(obj){var values=[];for(var key in obj)_.has(obj,key)&&values.push(obj[key]);return values},_.pairs=function(obj){var pairs=[];for(var key in obj)_.has(obj,key)&&pairs.push([key,obj[key]]);return pairs},_.invert=function(obj){var result={};for(var key in obj)_.has(obj,key)&&(result[obj[key]]=key);return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)null==obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor))return!1;for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.times=function(n,iterator,context){for(var accum=Array(n),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return null;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}]},{},[13])(13)});