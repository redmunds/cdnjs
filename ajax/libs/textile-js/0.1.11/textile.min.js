(function(){"use strict";function e(e,t){for(var n in t)e[n]=t[n];return e}function t(e){var t=null,n=e+"",a=0;return{save:function(){t=a},load:function(){a=t,e=n.slice(a)},advance:function(t){return a+="string"==typeof t?t.length:t,e=n.slice(a)},lookbehind:function(e){return e=null==e?1:e,n.slice(a-e,a)},startsWith:function(t){return e.substring(0,t.length)===t},valueOf:function(){return e},toString:function(){return e}}}function n(e){var t=v(e)?e:[];return{add:function(e){if("string"==typeof e&&"string"==typeof t[t.length-1])t[t.length-1]+=e;else if(v(e)){var n=e.filter(function(e){return void 0!==e});t.push(n)}else e&&t.push(e);return this},merge:function(e){for(var t=0,n=e.length;t<n;t++)this.add(e[t]);return this},linebreak:function(){t.length&&this.add("\n")},get:function(){return t}}}function a(e,t){if(e){var n,a={};for(n in e)!(n in e)||t&&n in t||(a[n]=e[n]);return a}}function c(e){for(var t,n={};t=F.exec(e);)n[t[1]]="string"==typeof t[2]?t[2].replace(/^(["'])(.*)\1$/,"$2"):null,e=e.slice(t[0].length);return n}function r(e,n){var a,r,i=[],l=i,s=[],p=n?function(e){return e in n}:function(){return!0};e="string"==typeof e?t(e):e;do if((a=C.exec(e))&&p("!"))e.advance(a[0]),i.push(["!",a[1]]);else if((a=D.exec(e))&&p(a[1])){r=a[1];a[2];if(s.length)for(var o=s.length-1;o>=0;o--){var u=s[o];if(u[0]===r){s.splice(o),i=s[s.length-1]||l;break}}e.advance(a[0])}else if((a=W.exec(e))&&p(a[1])){e.advance(a[0]),r=a[1];var d=a[3]||a[1]in oe,f=a[4],h=[r];a[2]&&h.push(c(a[2])),d?(i.push(h),f&&i.push(f)):(f&&h.push(f),s.push(h),i.push(h),i=h)}else a=/([^<]+|[^\0])/.exec(e),a&&i.push(a[0]),e.advance(a?a[0].length||1:1);while(e.valueOf());return l}function i(e,t,n){if(e+="",e&&"notextile"!==t){var a,c={},r={style:c},i=e,l="table"===t||"td"===t||x.test(t),s="img"===t,p=!l&&!s&&"a"!==t,o=s?ne:te;do if(a=ie.exec(i))a[1].split(";").forEach(function(e){var t=e.match(le);t&&(c[t[1]]=t[2])}),i=i.slice(a[0].length);else if(a=se.exec(i))r.lang=a[1],i=i.slice(a[0].length);else if(a=X.exec(i)){var u=i.slice(a[0].length);if(!u&&p||n&&(" "===u[0]||n===u.slice(0,n.length))){a=null;continue}var d=a[1].split("#");d[0]&&(r.class=d[0]),d[1]&&(r.id=d[1]),i=u}else{if(l){if(a=Y.exec(i)){c["padding-left"]=a[1].length+"em",i=i.slice(a[0].length);continue}if(a=ee.exec(i)){c["padding-right"]=a[1].length+"em",i=i.slice(a[0].length);continue}}if((s||l)&&(a=o.exec(i))){var f=ue[a[1]];s?r.align=f:c["text-align"]=f,i=i.slice(a[0].length)}else if("td"!==t&&"tr"!==t||!(a=ae.exec(i))){if("td"===t){if(a=ce.exec(i)){r.colspan=a[1],i=i.slice(a[0].length);continue}if(a=re.exec(i)){r.rowspan=a[1],i=i.slice(a[0].length);continue}}}else c["vertical-align"]=de[a[1]],i=i.slice(a[0].length)}while(a);var h=[];for(var g in c)h.push(g+":"+c[g]);return h.length?r.style=h.join(";"):delete r.style,i==e?void 0:[e.length-i.length,r]}}function l(e){return"string"!=typeof e?e:e.replace(/([^\-]|^)->/,"$1&#8594;").replace(B,"$1&#215;$2").replace(/([^.]?)\.{3}/g,"$1&#8230;").replace(G,"$1&#8212;$2").replace(/( )-( )/g,"$1&#8211;$2").replace(I,"$1&#8482;").replace(J,"$1&#174;").replace(K,"$1&#169;").replace(P,"$1&#8243;").replace(U,"$1&#8221;").replace(/"/g,"&#8220;").replace(Q,"$1&#8242;").replace(N,"$1&#8217;$2").replace(V,"$1&#8217;").replace(/'/g,"&#8216;")}function s(e,n){e=t(e.replace(/(^|\n)[\t ]+/,"$1"));for(var a,c,r=function(e){for(var t="\n";e--;)t+="\t";return t},l=[];a=w.exec(e);){var s=["li"],p=i(a[2],"li");p&&(a[2]=a[2].slice(p[0]),p=p[1]);for(var u,d,f,h=a[1].length,g="#"===a[1].substr(-1)?"ol":"ul",v=(l.length===h,null);l.length<h;)u=[g,r(l.length+1),v=["li"]],d=l[l.length-1],d&&(d.li.push(r(l.length)),d.li.push(u)),l.push({ul:u,li:v});for(;l.length>h;)f=l.pop(),f.ul.push(r(l.length));d=l[l.length-1],v||(d.ul.push(r(l.length),s),d.li=s),p&&d.li.push(p),Array.prototype.push.apply(d.li,o(a[2].trim(),n)),e.advance(a[0])}for(;l.length;)c=l.pop(),c.ul.push(r(l.length));return c.ul}function p(e,n){e=t(e.trim());var a,c,r,l,s,p=["table"];for((s=k.exec(e))&&(e.advance(s[0]),r=i(s[2],"table"),r&&p.push(r[1]));s=A.exec(e);){a=["tr"],s[1]&&(r=i(s[1],"tr"))&&a.push(r[1]),p.push("\n\t",a),c=t(s[2]);do{c.save();var u=c.startsWith("_"),d=[u?"th":"td"];if(u&&c.advance(1),r=i(c,"td"),r&&(c.advance(r[0]),d.push(r[1])),r||u){var f=/^\.\s*/.exec(c);f?c.advance(f[0]):(d=["td"],c.load())}var h=/^(==.*?==|[^\|])*/.exec(c);d=d.concat(o(h[0],n)),a.push("\n\t\t",d),l="|"===c.valueOf().charAt(h[0].length),c.advance(h[0].length+1)}while(l);a.push("\n\t"),e.advance(s[0])}return p.push("\n"),p}function o(e,a){e=t(e);var r,s,p=n();do if(e.save(),e.startsWith("\n"))e.advance(1),a.breaks&&p.add(["br"]),p.add("\n");else if(r=/^==(.*?)==/.exec(e))e.advance(r[0]),p.add(r[1]);else{var u=e.lookbehind(1),d=!u||/^[\s>.,"'?!;:()]$/.test(u);if((r=j.exec(e))&&(d||r[1])){e.advance(r[0]);var f=r[2],g=r[1],v=pe[f],m="code"===v;(s=!m&&i(e,v,f))&&(e.advance(s[0]),s=s[1]);var x,b;if("["===g)x="^(.*?)",b="(?:])";else if("{"===g)x="^(.*?)",b="(?:})";else{var $=h.escape(f.charAt(0));x=m?"^(\\S+|\\S+.*?\\S)":"^([^\\s"+$+"]+|[^\\s"+$+"].*?\\S("+$+"*))",b="(?=$|[\\s.,\"'!?;:()«»„“”‚‘’])"}var _=h.compile(x+"("+h.escape(f)+")"+b);if((r=_.exec(e))&&r[1]){e.advance(r[0]),m?p.add([v,r[1]]):p.add([v,s].concat(o(r[1],a)));continue}e.load()}if((r=z.exec(e))||(r=O.exec(e))){e.advance(r[0]),s=r[1]&&i(r[1],"img");var y=s?s[1]:{src:""},w=["img",y];y.src=r[2],y.alt=r[3]?y.title=r[3]:"",r[4]&&(w=["a",{href:r[4]},w]),p.add(w)}else if(r=C.exec(e))e.advance(r[0]),p.add(["!",r[1]]);else{if(r=W.exec(e)){e.advance(r[0]);var S=r[1],k=r[3]||r[1]in oe,A=[S],E=r[4];if(r[2]&&A.push(c(r[2])),k){p.add(A).add(E);continue}var q=h.compile("^(.*?)(</"+S+"\\s*>)","s");if(r=q.exec(e)){if(e.advance(r[0]),"code"===S)A.push(E,r[1]);else{if("notextile"===S){p.merge(o(r[1],a));continue}A=A.concat(o(r[1],a))}p.add(A);continue}e.load()}if(r=H.exec(e))e.advance(r[0]),p.add(["sup",{class:"footnote",id:"fnr"+r[1]},["a",{href:"#fn"+r[1]},r[1]]]);else if(r=M.exec(e)){e.advance(r[0]);var L=["span",{class:"caps"},r[1]];r[2]&&(L=["acronym",{title:r[2]},L]),p.add(L)}else if(d&&(r=T.exec(e))||(r=Z.exec(e))){e.advance(r[0].length);var D=r[1].match(R),F=D?r[1].slice(0,r[1].length-D[0].length):r[1];(s=i(F,"a"))?(F=F.slice(s[0]),s=s[1]):s={},D&&!F&&(F=D[0],D=""),s.href=r[2],D&&(s.title=D[1]),p.add(["a",s].concat(o(F.replace(/^(\.?\s*)/,""),a)))}else r=/([a-zA-Z0-9,.':]+|\s+|[^\0])/.exec(e),r&&p.add(r[0]),e.advance(r?r[0].length||1:1)}}while(e.valueOf());return p.get().map(l)}function u(e,l){var f,g=n(),v=function(e,t,n,a){t=t||"p";var c=[];return e.split(/\n\n+/).forEach(function(e,r){"p"===t&&/^\s/.test(e)?(e=e.replace(/\n[\t ]/g," ").trim(),c=c.concat(o(e,l))):(a&&r&&c.push(a),c.push(n?[t,n].concat(o(e,l)):[t].concat(o(e,l))))}),c},x={};for(e=t(e.replace(/^( *\n)+/,""));e.valueOf();)if(e.save(),f=E.exec(e))e.advance(f[0]),x[f[1]]=f[2];else{if(g.linebreak(),f=m.exec(e)){e.advance(f[0]);var w=f[0],k=i(e,w);if(k&&(e.advance(k[0]),k=k[1]),f=/^\.(\.?)(?:\s|(?=:))/.exec(e)){var A=!!f[1];if(f=(A?$:b).exec(e.advance(f[0])),e.advance(f[0]),"bq"===w){var j=f[1];(f=/^:(\S+)\s+/.exec(j))&&(k||(k={}),k.cite=f[1],j=j.slice(f[0].length)),g.add(["blockquote",k,"\n"].concat(v(j,"p",a(k,{cite:1,id:1}),"\n")).concat(["\n"]))}else if("bc"===w){var z=k?a(k,{id:1}):null;g.add(["pre",k,z?["code",z,f[1]]:["code",f[1]]])}else if("notextile"===w)g.merge(r(f[1]));else if("###"===w);else if("pre"===w)g.add(["pre",k,f[1]]);else if(q.test(w)){var O=w.replace(/\D+/g,"");k||(k={}),k.class=(k.class?k.class+" ":"")+"footnote",k.id="fn"+O,g.add(["p",k,["a",{href:"#fnr"+O},["sup",O]]," "].concat(o(f[1],l)))}else g.merge(v(f[1],w,k,"\n"));continue}e.load()}if(f=C.exec(e))e.advance(f[0]+(/(?:\s*\n+)+/.exec(e)||[])[0]),g.add(["!",f[1]]);else{if(f=L.exec(e)){var M=f[1],T=f[3]||M in oe,Z=f[4];if(M in fe){e.advance(f[0]);var R=[M];if(f[2]&&R.push(c(f[2])),T){g.add(R);continue}var H=h.compile("^(.*?)(\\s*)(</"+M+"\\s*>)(\\s*)","s");if(f=H.exec(e)){e.advance(f[0]),"pre"===M?(R.push(Z),R=R.concat(r(f[1].replace(/\n+$/,""),{code:1})),f[2]&&R.push(f[2]),g.add(R)):"notextile"===M?(R=r(f[1].trim()),g.merge(R)):"script"===M||"noscript"===M?(R.push(Z+f[1]),g.add(R)):(/\n/.test(Z)&&R.push("\n"),R=/\n/.test(f[1])?R.concat(u(f[1],l)):R.concat(o(f[1].replace(/^ +/,""),l)),/\n/.test(f[2])&&R.push("\n"),g.add(R));continue}}e.load()}(f=_.exec(e))?(e.advance(f[0]),g.add(["hr"])):(f=y.exec(e))?(e.advance(f[0]),g.add(s(f[0],l))):(f=S.exec(e))?(e.advance(f[0]),g.add(p(f[1],l))):(f=b.exec(e),g.merge(v(f[1],"p",void 0,"\n")),e.advance(f[0]))}}return g.get().map(d,x)}function d(e){if(v(e)){if("a"===e[0]){var t=e[1];"object"==typeof t&&"href"in t&&t.href in this&&(t.href=this[t.href])}for(var n=1,a=e.length;n<a;n++)v(e[n])&&d.call(this,e[n])}return e}function f(t,n){return n=e(e({},f.defaults),n||{}),u(t,n).map(g.toHTML).join("")}var h={_cache:{},pattern:{punct:"[!-/:-@\\[\\\\\\]-`{-~]",space:"\\s"},escape:function(e){return e.replace(/[\-\[\]\{\}\(\)\*\+\?\.\,\\\^\$\|\#\s]/g,"\\$&")},collapse:function(e){return e.replace(/(?:#.*?(?:\n|$))/g,"").replace(/\s+/g,"")},expand_patterns:function(e){return e.replace(/\[\:\s*(\w+)\s*\:\]/g,function(e,t){return t in h.pattern?h.expand_patterns(h.pattern[t]):t})},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},compile:function(e,t){h.isRegExp(e)&&(1===arguments.length&&(t=(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")),e=e.source);var n=e+(t||"");if(n in h._cache)return h._cache[n];var a=h.expand_patterns(e);return t&&/x/.test(t)&&(a=h.collapse(a)),t&&/s/.test(t)&&(a=a.replace(/([^\\])\./g,"$1[^\\0]")),t=(t||"").replace(/[^gim]/g,""),h._cache[n]=new RegExp(a,t)}},g={escape:function(e,t){return e.replace(/&(?!(#\d{2,}|#x[\da-fA-F]{2,}|[a-zA-Z][a-zA-Z1-4]{1,6});)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,t?"&quot;":'"').replace(/'/g,t?"&#39;":"'")},toHTML:function(e){if(e=e.concat(),"string"==typeof e)return g.escape(e);var t,n=e.shift(),a={},c=[],r="";for(e.length&&"object"==typeof e[0]&&!v(e[0])&&(a=e.shift());e.length;)c.push(g.toHTML(e.shift()));for(t in a)r+=null==a[t]?" "+t:" "+t+'="'+g.escape(a[t],!0)+'"';return"!"==n?"<!--"+c.join("")+"-->":"img"===n||"br"===n||"hr"===n||"input"===n?"<"+n+r+" />":"<"+n+r+">"+c.join("")+"</"+n+">"}},v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};h.pattern.blocks="(?:b[qc]|div|notextile|pre|h[1-6]|fn\\d+|p|###)",h.pattern.pba_class="\\([^\\)]+\\)",h.pattern.pba_style="\\{[^\\}]+\\}",h.pattern.pba_lang="\\[[^\\[\\]]+\\]",h.pattern.pba_align="(?:<>|<|>|=)",h.pattern.pba_pad="[\\(\\)]+",h.pattern.pba_attr="(?:[:pba_class:]|[:pba_style:]|[:pba_lang:]|[:pba_align:]|[:pba_pad:])*",h.pattern.url_punct="[.,«»″‹›!?]",h.pattern.html_id="[a-zA-Z][a-zA-Z\\d:]*",h.pattern.html_attr="(?:\"[^\"]+\"|'[^']+'|[^>\\s]+)",h.pattern.tx_urlch='[\\w"$\\-_.+!*\'(),";\\/?:@=&%#{}|\\\\^~\\[\\]`]',h.pattern.tx_cite=":((?:[^\\s()]|\\([^\\s()]+\\)|[()])+?)(?=[!-\\.:-@\\[\\\\\\]-`{-~]+(?:$|\\s)|$|\\s)",h.pattern.ucaps="A-ZÀ-ÖØ-ÞĀĂĄĆĈĊČĎĐĒĔĖĘĚĜĞĠĢĤĦĨĪĬĮİĲĴĶĹĻĽĿŁŃŅŇŊŌŎŐŒŔŖŘŚŜŞŠŢŤŦŨŪŬŮŰŲŴŶŸŹŻŽƁƂƄƆƇƉ-ƋƎ-ƑƓƔƖ-ƘƜƝƟƠƢƤƦƧƩƬƮƯƱ-ƳƵƷƸƼǄǇǊǍǏǑǓǕǗǙǛǞǠǢǤǦǨǪǬǮǱǴǶ-ǸǺǼǾȀȂȄȆȈȊȌȎȐȒȔȖȘȚȜȞȠȢȤȦȨȪȬȮȰȲȺȻȽȾɁɃ-ɆɈɊɌɎḀḂḄḆḈḊḌḎḐḒḔḖḘḚḜḞḠḢḤḦḨḪḬḮḰḲḴḶḸḺḼḾṀṂṄṆṈṊṌṎṐṒṔṖṘṚṜṞṠṢṤṦṨṪṬṮṰṲṴṶṸṺṼṾẀẂẄẆẈẊẌẎẐẒẔẞẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼẾỀỂỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪỬỮỰỲỴỶỸỺỼỾⱠⱢ-ⱤⱧⱩⱫⱭ-ⱰⱲⱵⱾⱿꜢꜤꜦꜨꜪꜬꜮꜲꜴꜶꜸꜺꜼꜾꝀꝂꝄꝆꝈꝊꝌꝎꝐꝒꝔꝖꝘꝚꝜꝞꝠꝢꝤꝦꝨꝪꝬꝮꝹꝻꝽꝾꞀꞂꞄꞆꞋꞍꞐꞒꞠꞢꞤꞦꞨꞪ";var m=h.compile(/^([:blocks:])/),x=h.compile(/^[:blocks:]$/),b=h.compile(/^(.*?)($|\n(?:\s*\n|$)+)/,"s"),$=h.compile(/^(.*?)($|\n+(?=[:blocks:][:pba_attr:]\.))/,"s"),_=/^(\-\-\-+|\*\*\*+|___+)(\n\s+|$)/,y=h.compile(/^((?:[\t ]*[\#\*]+[:pba_attr:] .+?(?:\n|$))+)(\s*\n)?/),w=/^([\#\*]+)(.+?)(\n|$)/,S=h.compile(/^((?:table[:pba_attr:]\.\n)?(?:(?:[:pba_attr:]\.[^\n\S]*)?\|.*?\|[^\n\S]*(?:\n|$))+)([^\n\S]*\n)?/,"s"),k=/^table(_?)([^\n]+)\.\s?\n/,A=h.compile(/^([:pba_attr:]\.[^\n\S]*)?\|(.*?)\|[^\n\S]*(\n|$)/,"s"),j=/^([\[\{]?)(__?|\*\*?|\?\?|[\-\+\^~@%])/,z=(h.compile(/^.+?(?=[\\<!\[_\*`]|\n|$)/,"s"),h.compile(/^!(?!\s)([:pba_attr:](?:\.[^\n\S]|\.(?:[^\.\/]))?)([^!\s]+?) ?(?:\(((?:[^\(\)]+|\([^\(\)]+\))+)\))?!(?::([^\s]+?(?=[!-\.:-@\[\\\]-`{-~](?:$|\s)|\s|$)))?/)),O=h.compile(/^\[!(?!\s)([:pba_attr:](?:\.[^\n\S]|\.(?:[^\.\/]))?)([^!\s]+?) ?(?:\(((?:[^\(\)]+|\([^\(\)]+\))+)\))?!(?::([^\s]+?(?=[!-\.:-@\[\\\]-`{-~](?:$|\s)|\s|$)))?\]/),M=h.compile(/^((?!TM\)|tm\))[[:ucaps:]](?:[[:ucaps:]\d]{1,}(?=\()|[[:ucaps:]\d]{2,}))(?:\((.*?)\))?(?=\W|$)/),T=h.compile(/^"(?!\s)((?:[^\n"]|"(?![\s:])[^\n"]+"(?!:))+)"[:tx_cite:]/),Z=/^\["([^\n]+?)":((?:\[[a-z0-9]*\]|[^\]])+)\]/,E=h.compile(/^\[([^\]]+)\]((?:https?:\/\/|\/)\S+)(?:\s*\n|$)/),R=/\s*\(((?:\([^\(\)]*\)|[^\(\)])+)\)$/,q=/^fn\d+$/,H=/^\[(\d+)\]/,L=h.compile(/^\s*<([:html_id:](?::[a-zA-Z\d]+)*)((?:\s[^=\s\/]+(?:\s*=\s*[:html_attr:])?)+)?\s*(\/?)>(\n*)/),W=h.compile(/^<([:html_id:])((?:\s[^=\s\/]+(?:\s*=\s*[:html_attr:])?)+)?\s*(\/?)>(\n*)/),C=h.compile(/^<!--(.+?)-->/,"s"),D=h.compile(/^<\/([:html_id:])([^>]*)>/),F=h.compile(/^\s*([^=\s]+)(?:\s*=\s*("[^"]+"|'[^']+'|[^>\s]+))?/),B=/([\d\.,]+['"]? ?)x( ?)(?=[\d\.,]['"]?)/g,G=/(^|[\s\w])--([\s\w]|$)/g,I=/(\b ?|\s|^)(?:\((?:TM|tm)\)|\[(?:TM|tm)\])/g,J=/(\b ?|\s|^)(?:\(R\)|\[R\])/gi,K=/(\b ?|\s|^)(?:\(C\)|\[C\])/gi,N=/(\w)\'(\w)/g,P=h.compile(/(\d*[\.,]?\d+)"(?=\s|$|[:punct:])/g),Q=h.compile(/(\d*[\.,]?\d+)'(?=\s|$|[:punct:])/g),U=h.compile(/([^\s\[\(])"(?=$|\s|[:punct:])/g),V=h.compile(/([^\s\[\(])'(?=$|\s|[:punct:])/g),X=/^\(([^\(\)\n]+)\)/,Y=/^([\(]+)/,ee=/^([\)]+)/,te=/^(<>|<|>|=)/,ne=/^(<|>|=)/,ae=/^(~|\^|\-)/,ce=/^\\(\d+)/,re=/^\/(\d+)/,ie=/^\{([^\}]*)\}/,le=/^\s*([^:\s]+)\s*:\s*(.+)\s*$/,se=/^\[([^\[\]]+)\]/,pe={"*":"strong","**":"b","??":"cite",_:"em",__:"i","-":"del","%":"span","+":"ins","~":"sub","^":"sup","@":"code"},oe={br:1,hr:1,img:1,link:1,meta:1,wbr:1,area:1,param:1,input:1,option:1,base:1},ue={"<":"left","=":"center",">":"right","<>":"justify"},de={"~":"bottom","^":"top","-":"middle"},fe={p:0,hr:0,ul:1,ol:0,li:0,div:1,pre:0,object:1,script:0,noscript:0,blockquote:1,notextile:1};f.defaults={breaks:!0},f.setOptions=f.setoptions=function(t){return e(f.defaults,t),this},f.parse=f.convert=f,f.html_parser=r,f.jsonml=function(t,n){return n=e(e({},f.defaults),n||{}),["html"].concat(u(t,n))},f.serialize=g.toHTML,"undefined"!=typeof module&&module.exports?module.exports=f:this.textile=f}).call(function(){return this||("undefined"!=typeof window?window:global)}());
//# sourceMappingURL=textile.min.js.map