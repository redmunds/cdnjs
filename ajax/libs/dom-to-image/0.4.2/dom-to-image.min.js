/*! dom-to-image 24-09-2015 */
!function(a){"use strict";function b(a,b){v.asArray(a).forEach(function(c){b.setProperty(c,a.getPropertyValue(c),a.getPropertyPriority(c))})}function c(a,c){a.cssText?c.cssText=a.cssText:b(a,c)}function d(b){var d=a.window.getComputedStyle(b.source);return c(d,b.target.style),b}function e(a){var b=a.getPropertyValue("content");return a.cssText+" content: "+b+";"}function f(a){function b(b){return b+": "+a.getPropertyValue(b)+(a.getPropertyPriority(b)?" !important":"")}return v.asArray(a).map(b).join("; ")+";"}function g(b,c,d){var g="."+b+":"+c,h=d.cssText?e(d):f(d);return a.document.createTextNode(g+"{"+h+"}")}function h(b,c){var d=a.window.getComputedStyle(b.source,c),e=d.getPropertyValue("content");if(""===e||"none"===e)return b;var f=v.uid();b.target.className=b.target.className+" "+f;var h=a.document.createElement("style");return h.appendChild(g(f,c,d)),b.target.appendChild(h),b}function i(a){return[":before",":after"].forEach(function(b){h(a,b)}),a}function j(a){return a instanceof SVGElement&&a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a}function k(a,b){return b instanceof Element?Promise.resolve({source:a,target:b}).then(d).then(i).then(function(a){return a.target}).then(j):b}function l(a,b,c){var d=Promise.resolve();return b.forEach(function(b){d=d.then(function(){return n(b,c)}).then(function(b){b&&a.appendChild(b)})}),d}function m(a,b,c){var d=a.childNodes;return 0===d.length?Promise.resolve(b):l(b,v.asArray(d),c).then(function(){return b})}function n(a,b){return b&&!b(a)?Promise.resolve():Promise.resolve().then(function(){return a.cloneNode(!1)}).then(function(c){return m(a,c,b)}).then(function(b){return k(a,b)})}function o(a,b,c){return Promise.resolve(a).then(function(a){return a.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(a)}).then(v.escapeXhtml).then(function(a){return'<foreignObject x="0" y="0" width="100%" height="100%">'+a+"</foreignObject>"}).then(function(a){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+b+'" height="'+c+'">'+a+"</svg>"}).then(function(a){return"data:image/svg+xml;charset=utf-8,"+a})}function p(a){return y.inlineAll(a).then(function(){return a})}function q(a){return x.resolveAll().then(function(b){var c=document.createElement("style");return a.appendChild(c),c.appendChild(document.createTextNode(b)),a})}function r(a,b){return s(a,b).then(v.delay(100)).then(function(b){var c=document.createElement("canvas");return c.width=a.scrollWidth,c.height=a.scrollHeight,c.getContext("2d").drawImage(b,0,0),c})}function s(a,b){return b=b||{},Promise.resolve(a).then(function(a){return n(a,b.filter)}).then(q).then(p).then(function(b){return o(b,a.scrollWidth,a.scrollHeight)}).then(v.makeImage)}function t(a,b){return r(a,b).then(function(a){return a.toDataURL()})}function u(a,b){return r(a,b).then(v.canvasToBlob)}var v=function(){function b(a){var b=/\.([^\./]*?)$/g.exec(a);return b?b[1]:""}function c(a){var c=b(a).toLowerCase();return p[c]||""}function d(a){return-1!==a.search(/^(data:)/)}function e(a){return new Promise(function(b){for(var c=window.atob(a.toDataURL().split(",")[1]),d=c.length,e=new Uint8Array(d),f=0;d>f;f++)e[f]=c.charCodeAt(f);b(new Blob([e],{type:"image/png"}))})}function f(a){return a.toBlob?new Promise(function(b){a.toBlob(b)}):e(a)}function g(b,c){var d=a.document.implementation.createHTMLDocument(),e=d.createElement("base");d.head.appendChild(e);var f=d.createElement("a");return d.body.appendChild(f),e.href=c,f.href=b,f.href}function h(a){return new Promise(function(b,c){var d=new Image;d.onload=function(){b(d)},d.onerror=c,d.src=a})}function i(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4===d.readyState){if(200!==d.status)return void c(new Error("Cannot fetch resource "+a+", status: "+this.status));var e=new FileReader;e.onloadend=function(){var a=e.result.split(/,/)[1];b(a)},e.readAsDataURL(d.response)}},d.ontimeout=function(){c(new Error("Timeout of 30000ms occured while fetching resource: "+a))},d.responseType="blob",d.timeout=o,d.open("GET",a,!0),d.send()})}function j(a,b){return"data:"+b+";base64,"+a}function k(a){return a.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function l(a){return function(b){return new Promise(function(c){setTimeout(function(){c(b)},a)})}}function m(a){for(var b=[],c=a.length,d=0;c>d;d++)b.push(a[d]);return b}function n(a){return a.replace(/#/g,"%23")}const o=3e4,p={woff:"application/x-font-woff",woff2:"application/x-font-woff2",truetype:"application/x-font-ttf",ttf:"application/x-font-ttf",opentype:"application/x-font-otf","embedded-opentype":"application/x-font-otf",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};var q=function(){function a(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}function b(){return"u"+a()+c++}var c=0;return{next:b}}();return{escape:k,parseExtension:b,mimeType:c,dataAsUrl:j,isDataUrl:d,canvasToBlob:f,resolveUrl:g,getAndEncode:i,uid:q.next,delay:l,asArray:m,escapeXhtml:n,makeImage:h}}(),w=function(){function a(a){return new RegExp("(url\\(['\"]?)("+v.escape(a)+")(['\"]?\\))","g")}function b(a){return!c(a)}function c(a){return-1!==a.search(g)}function d(a){for(var b,c=[];null!==(b=g.exec(a));)c.push(b[1]);return c.filter(function(a){return!v.isDataUrl(a)})}function e(b,c,d,e){return Promise.resolve(c).then(function(a){return d?v.resolveUrl(a,d):a}).then(e||v.getAndEncode).then(function(a){return v.dataAsUrl(a,v.mimeType(c))}).then(function(d){return b.replace(a(c),"$1"+d+"$3")})}function f(a,c,f){return b(a)?Promise.resolve(a):Promise.resolve(a).then(d).then(function(b){var d=Promise.resolve(a);return b.forEach(function(a){d=d.then(function(b){return e(b,a,c,f)})}),d})}const g=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:f,shouldProcess:c,impl:{readUrls:d,inline:e}}}(),x=function(){function a(a){return a.filter(function(a){return a.type===CSSRule.FONT_FACE_RULE}).filter(function(a){return w.shouldProcess(a.style.getPropertyValue("src"))})}function b(a){var b=[];return a.forEach(function(a){v.asArray(a.cssRules).forEach(b.push.bind(b))}),b}function c(){return Promise.resolve(v.asArray(document.styleSheets)).then(b).then(a).then(function(a){return a.map(d)})}function d(a){return{resolve:function(){var b=(a.parentStyleSheet||{}).href;return w.inlineAll(a.cssText,b)},src:function(){return a.style.getPropertyValue("src")}}}function e(){return c(document).then(function(a){return Promise.all(a.map(function(a){return a.resolve()}))}).then(function(a){return a.join("\n")})}return{resolveAll:e,impl:{readAll:c}}}(),y=function(){function a(a){function b(b){return v.isDataUrl(a.src)?Promise.resolve():Promise.resolve(a.src).then(b||v.getAndEncode).then(function(b){return v.dataAsUrl(b,v.mimeType(a.src))}).then(function(b){return new Promise(function(c,d){a.onload=c,a.onerror=d,a.src=b})})}return{inline:b}}function b(a){var b=a.style.getPropertyValue("background");return b?w.inlineAll(b).then(function(b){a.style.setProperty("background",b,a.style.getPropertyPriority("background"))}).then(function(){return a}):Promise.resolve(a)}function c(d){return d instanceof Element?b(d).then(function(){return d instanceof HTMLImageElement?a(d).inline():Promise.all(v.asArray(d.childNodes).map(function(a){return c(a)}))}):Promise.resolve(d)}return{inlineAll:c,impl:{newImage:a}}}();a.domtoimage={toImage:s,toDataUrl:t,toBlob:u,impl:{fontFaces:x,images:y,util:v,inliner:w}}}(this);