!function($,window,undefined){"use strict";function append_args(e){this.data("args.phery",$.extend(!0,e,this.data("args.phery")))}function set_args(e){this.data("args.phery",$.extend(!0,{},e))}function string_callbacks(e){switch(e){case!0:str_is_function=function(e){return!(!e||"function"!=typeof e.toString)&&(e=e.toString(),!(!/^[\s;]*function\(/im.test(e)||!/\};?$/m.test(e)))},String.prototype.apply=function(e){if(!str_is_function(this))return!1;var t,r,n=this.toString(),a=call_cache.length,o=null;for(t=0;t<a;t++)if(call_cache[t].str===n){o=call_cache[t].fn;break}if("function"!=typeof o){var i=n.match(/function\s*\(([^\)]*)\)/im)[1],l=n.slice(n.indexOf("{")+1,n.lastIndexOf("}"));if(!l)return!1;o=new Function(i,l),call_cache.push({str:n,fn:o}),a=call_cache.length}r=Array.prototype.slice.call(arguments,1),"undefined"!=typeof r[0]&&r[0].constructor===Array&&(r=r[0]);try{return o.apply(e,r)}catch(e){}return null},String.prototype.call=function(e){return this.apply(e,Array.prototype.slice.call(arguments,1))},$.isFunction=function(e){return"function"===$.type(e)||str_is_function(e)};break;case!1:str_is_function=function(){return!1},"function"==typeof String.prototype.call&&delete String.prototype.call,"function"==typeof String.prototype.apply&&delete String.prototype.apply,$.isFunction=old_isFunction}}function debug(e,t){options.debug.enable&&"undefined"!=typeof console&&"undefined"!=typeof console.dir&&"undefined"!=typeof options.debug.display[t]&&options.debug.display[t]===!0&&console.dir(e)}function do_cursor(e){options.cursor&&(e?$body_html.css("cursor",e):$body_html.css("cursor",$original_cursor))}function triggerAndReturn(e,t,r,n){n=n||null;var a,o=$.Event(t);return n&&(o.target=n),e.triggerHandler(o,r),a=o.result!==!1,debug(["event triggered",{name:t,"event result":a,element:e,data:r}],"events"),a}function triggerPheryEvent(e,t,r,n){return r=r||[],n=n||!1,n?(triggerAndReturn(callbacks,t,r,e),options.enable.per_element.events&&triggerAndReturn(e,"phery:"+t,r),!0):triggerAndReturn(callbacks,t,r,e)!==!1&&(!options.enable.per_element.events||triggerAndReturn(e,"phery:"+t,r))}function countProperties(e){var t=0;if("object"==typeof e)for(var r in e)e.hasOwnProperty(r)&&++t;else"undefined"!=typeof e.length&&(t=e.length);return t}function clean_up(e){e.data("temp.phery")&&(e.off(),e.removeProp(),$.removeData(e),e.remove())}function form_submit(e){return!(e.data("confirm.phery")&&!confirm(e.data("confirm.phery")))&&(e.find('input[name="phery[remote]"]').remove(),ajax_call.call(e))}function ajax_call(){if(triggerPheryEvent(this,"before")===!1)return clean_up(this),!1;var e,t,r={"X-Requested-With":"XMLHttpRequest","X-Phery":1},n=this,a=n.attr("action")||n.attr("href")||n.data("target.phery")||options.default_href||window.location.href,o=n.data("type.phery")||"json",i=n.attr("id")||null,l={phery:{}};if(n.data("args.phery"))try{"object"==typeof n.data("args.phery")?l.args=$.extend(!0,{},n.data("args.phery")):l.args=n.data("args.phery")}catch(e){triggerPheryEvent(n,"exception",[phery.log(e)])}else if(n.is("input")&&n.attr("name")){var s={};n.is('[type="checkbox"],[type="radio"]')?s[n.attr("name")]={checked:n.prop("checked")?1:0,value:n.val()}:s[n.attr("name")]=n.val(),l.args=$.extend(!0,{},s)}if(n.is("form"))try{l.args=$.extend(!0,{},l.args,n.serializeForm(n.data("submit.phery")?n.data("submit.phery"):{}))}catch(e){triggerPheryEvent(n,"exception",[phery.log(e)])}n.is("select")&&(n.attr("multiple")?n.attr("name")?(l.args=$.extend(!0,{},l.args),l.args[n.attr("name")]=$.extend({},n.find("option").filter(":selected").map(function(){return $(this).val()}).get())):l.args=$.extend(!0,{},n.find("option").filter(":selected").map(function(){return $(this).val()}).get()):n.attr("name")?(l.args=$.extend(!0,{},l.args),l.args[n.attr("name")]=n.val()):l.args=n.val()),i&&(l.phery.submit_id=i),n.data("view.phery")?l.phery.view="#"+n.attr("id"):n.data("remote.phery")&&(l.phery.remote=n.data("remote.phery"));var c={};triggerPheryEvent(n,"params",c,!0),l.phery=$.extend(c,l.phery),e=new Date,debug(["remote call",{data:l,timestamp:e.getTime(),time:e.toLocaleString()}],"remote"),e=e.getTime();var u={url:a.indexOf("_=")===-1?a+(a.indexOf("?")>-1?"&":"?")+"_="+e:a.replace(/\_\=(\d+)/,"_="+e),data:l,dataType:o,type:"POST",el:n,global:!1,try_count:0,retry_limit:options.ajax.retries,cache:!1,processData:!0,headers:r,beforeSend:function(e,t){return do_cursor("wait"),triggerPheryEvent(this.el,"beforeSend",[e,t])!==!1}},p=function(e,t,r){return this.retry_limit&&"timeout"===t&&(this.try_count++,this.try_count<=this.retry_limit)?(this.dataType="text "+o,this.url=this.url.indexOf("_try_count=")===-1?this.url+"&_try_count="+this.try_count:this.url.replace(/_try_count=(\d+)/,"_try_count="+this.try_count),this.url=this.url.replace(/_=(\d+)/,"_="+(new Date).getTime()),d(this),!1):(do_cursor(!1),triggerPheryEvent(this.el,"fail",[e,t,r])===!1?(clean_up(this.el),!1):(clean_up(this.el),!0))},f=function(e,t,r){return triggerPheryEvent(this.el,"done",[e,t,r])!==!1&&(processRequest.call(this.el,e),!0)},h=function(e,t,r){return!(4!==r.readyState&&this.try_count&&this.try_count<=this.retry_limit)&&(do_cursor(!1),triggerPheryEvent(this.el,"always",[r])===!1?(clean_up(this.el),!1):(clean_up(this.el),!0))},d=function(e){var t=$.ajax(e);return t.done(f).always(h).fail(p),t};return t=d(u)}function set_events(){$(document).off(".phery"),$(document).on(options.delegate.confirm+".phery","[data-confirm]:not(form)",function(e){confirm($(this).data("confirm.phery"))?e.preventDefault():e.stopImmediatePropagation()}).on(options.delegate.form+".phery","form[data-remote]",function(e){var t=$(this);return form_submit(t),!1}).on(options.delegate.tags+".phery","[data-remote]:not(form,select)",function(e){var t=$(this);ajax_call.call(t),t.is('input[type="text"],input[type="checkbox"],input[type="radio"],input[type="image"]')||e.preventDefault()}).on(options.delegate.select+".phery","select[data-remote]:not([multiple])",function(e){ajax_call.call($(this))}).on(options.delegate.select_multiple+".phery","select[data-remote][multiple]",function(e){ajax_call.call($(this))})}function processRequest(data){if(!this.data("remote.phery")&&!this.data("view.phery"))return void triggerPheryEvent(this,"after",[]);var $jq,x,i,argv,argc,func_name,$this=this,is_selector,funct,_data,_argv;if(data&&countProperties(data))for(x in data)if(is_selector=x.toString().search(/^[0-9]+$/)===-1)if(data[x].length){if($jq=$("window"===x.toLowerCase()?window:"document"===x.toLowerCase()?document:x),$jq.size())for(i in data[x]){argv=data[x][i].a;try{if(func_name=argv.shift(),"function"!=typeof $jq[func_name])throw'no function "'+func_name+'" found in jQuery object';$jq="undefined"!=typeof argv[0]&&argv[0].constructor===Array?$jq[func_name].apply($jq,argv[0]||null):argv.constructor===Array?$jq[func_name].apply($jq,argv||null):$jq[func_name].call($jq,argv||null)}catch(e){triggerPheryEvent($this,"exception",[phery.log(e,argv)])}}}else triggerPheryEvent($this,"exception",[phery.log("no commands to issue, 0 length")]);else switch(argc=data[x].a.length,argv=data[x].a,Number(data[x].c)){case 1:"undefined"!=typeof argv[0]&&"string"==typeof argv[0]?alert(argv[0]):triggerPheryEvent($this,"exception",[phery.log("missing message for alert()",argv)]);break;case 2:try{if(funct=argv.shift(),"function"!=typeof window[funct])throw'no global function "'+funct+'" found';window[funct].apply(null,argv[0]||[])}catch(e){triggerPheryEvent($this,"exception",[phery.log(e,argv)])}break;case 3:try{eval("(function(){ "+argv[0]+"})();")}catch(e){triggerPheryEvent($this,"exception",[phery.log(e,argv[0])])}break;case 4:try{triggerPheryEvent($this,"json",[$.parseJSON(argv[0])])}catch(e){triggerPheryEvent($this,"exception",[phery.log(e,argv[0])])}break;case 5:_data=$this.data("view.phery"),_argv=$.extend(!0,{},{url:$this.data("target")},argv[1]),"function"==typeof _data.beforeHtml&&_data.beforeHtml.call($this,_argv),"function"!=typeof _data.render?$this.html("").html(argv[0]):_data.render.call($this,argv[0],_argv),"function"==typeof _data.afterHtml&&_data.afterHtml.call($this,_argv);break;case 6:try{if("undefined"!=typeof console&&"undefined"!=typeof console.log)for(var l=0;l<argc;l++)console.log(argv[l])}catch(e){triggerPheryEvent($this,"exception",[phery.log(e,argv[0])])}break;case 7:if(argc>1){_argv=[argv.shift()];do _argv.push(argv.shift());while(argv.length);triggerPheryEvent($this,"exception",_argv)}else triggerPheryEvent($this,"exception",[argv[0]]);break;default:triggerPheryEvent($this,"exception",[phery.log('invalid command "'+data[x].c+'" issued')])}triggerPheryEvent(this,"after",[])}function _apply(e,t){t=t||!1;for(var r in e)if("object"==typeof e[r]){if(_apply(e[r],t)===!1)return!1}else switch(debug(["config",{name:r,value:e[r]}],"config"),r){case"php_string_callbacks":(e[r]!==options.enable.php_string_callbacks||t)&&string_callbacks(options.enable.php_string_callbacks);break;case"confirm":case"form":case"select_multiple":case"select":case"tags":if(e[r]!==options.delegate[r]||t)return set_events(),!1}return!0}function refresh_changes(e,t){var r=$.extend(!0,{},options);if("undefined"==typeof t)for(var n in e)dot_notation_option(n,options,e[n]);else dot_notation_option(e,options,t);_apply(r)}var str_is_function,call_cache=[],old_isFunction=$.isFunction,old_sync_libraries={backbone:null,datatables:null},phery=window.phery=window.phery||{},options={},defaults={cursor:!0,default_href:!1,ajax:{retries:0},enable:{log:!1,log_history:!1,php_string_callbacks:!1,per_element:{events:!0,options:!1}},debug:{enable:!1,display:{events:!0,remote:!0,config:!0}},delegate:{confirm:"click",form:"submit",select_multiple:"blur",select:"change",tags:"click"}},_callbacks={before:function(){return!0},beforeSend:function(){return!0},params:function(){return!0},always:function(){return!0},fail:function(){return!0},done:function(){return!0},after:function(){return!0},exception:function(){return!0},json:function(){return!0}},callbacks=$("<div/>"),_log=[],$original_cursor,$body_html,$container=null,dot_notation_option=function(e,t,r){if(e.indexOf(".")!==-1){var n=e.split(".");if(n&&n[0]&&"undefined"!=typeof t[n[0]])return dot_notation_option(n.slice(1).join("."),t[n[0]],r)}else if("undefined"!=typeof t[e])return"undefined"!=typeof r?(t[e]=r,t):t[e];return null};options=$.extend(!0,{},defaults,options),$(function(){$body_html=$("body,html"),$original_cursor=$body_html.css("cursor"),_apply(options,!0)}),phery.config=function(e,t){return"object"==typeof e&&e.constructor===Object?(refresh_changes(e),phery):"string"==typeof e&&"undefined"!=typeof t?(refresh_changes(e,t),phery):"string"==typeof e&&"undefined"==typeof t?e in options?options[e]:dot_notation_option(e,options):0===arguments.length?$.extend(!0,{},options):phery},phery.reset_to_defaults=function(){return options=$.extend(!0,{},defaults),_apply(options,!0),phery},phery.log=function(){var e=Array.prototype.slice.call(arguments);return e.length?(options.enable.log&&(options.enable.log_history&&_log.push(e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&("object"==typeof console.log?console.log(e):console.log.apply(console,e))),e.join("\n")):options.enable.log_history?_log:[]},phery.remote=function(e,t,r,n){if(this===phery&&!e)return phery.log('first argument "function_name" on phery.remote() must be specified when calling directly'),phery;if(n=n||!0,this!==phery)return ajax_call.call(this);var a=$("<a/>");return a.data({"remote.phery":e}),n&&a.data("temp.phery",!0),"undefined"!=typeof t&&null!==t&&a.phery("set_args",t),"undefined"!=typeof r&&a.attr(r),n||a.extend({remote:ajax_call}),n?ajax_call.call(a):a},phery.on=function(e,t){if("object"==typeof e)for(var r in e)phery.on(r,e[r]);else"string"==typeof e&&"function"==typeof t&&e in _callbacks&&(debug(["phery.on",{event:e,callback:t}],"events"),callbacks.bind(e+".phery",t));return phery},phery.off=function(e){return debug(["phery.off",{event:e}],"events"),callbacks.off(e+".phery"),phery};var _containers={};phery.view=function(e){if("string"==typeof e&&("#"!==e[0]&&(e="#"+e),"undefined"!=typeof _containers[e]))return{data:_containers[e].data("view.phery"),container:_containers[e],remote:function(t){t&&_containers[e].data("target",t),ajax_call.call(_containers[e])}};if("object"==typeof e&&$.isEmptyObject(e))return debug(["phery.view needs config"],"config"),phery;var t,r,n,a;$(document).off("click.view");for(t in e)if(n=$(t),1===n.size()){if(r=t.replace(/[#\.\s]/g,""),e[t]===!1){n.off(".phery.view"),$(document).off("click.view."+r),debug(["phery.view uninstalled and events unbound",n],"config");continue}a="string"==typeof e[t].selector&&/(^|\s)a($|\s|\.)/i.test(e[t].selector)?t+" "+e[t].selector:'a[href]:not(.no-phery,[target],[data-remote],[href*=":"],[rel~="nofollow"])',a=a+',a[href][rel="'+t+'"]',n.data("view.phery",$.extend(!0,{},e[t],{selector:a})),_containers[t]=n,$(document).on("click.view."+r,a,{container:n},function(e){var t=$(this),r=t.attr("href"),n=e.data.container.data("view.phery");if(2==e.which||e.metaKey)return!0;if("undefined"!=typeof n.exclude)for(var a=0;a<n.exclude.length;a++)switch(typeof n.exclude[a]){case"string":if(r.indexOf(n.exclude[a])!==-1)return!0;break;case"object":if(n.exclude[a].test(r))return!0;break;case"function":if(n.exclude[a].call(e.data.container,r,t)===!0)return!0}return debug(["phery.view link clicked, loading content",e.data.container,t.attr("href")],"events"),e.data.container.data("target",t.attr("href")),ajax_call.call(e.data.container,!0),e.stopPropagation(),e.preventDefault(),!1});for(var o in e[t])e[t].hasOwnProperty(o)&&"undefined"!=typeof _callbacks[o]&&n.on("phery:"+o+".phery.view",e[t][o]);debug(["phery.view installed",n],"config")}else debug(["phery.view container",n,"isnt unique or does not exist"],"config");return phery},$.fn.extend({reset:function(){return this.each(function(){$(this).is("form")&&this.reset()})},phery:function(e,t){var r=this,n={exception:function(e,t){return triggerPheryEvent(r,"exception",[e,t]),r.phery()},remote:function(){return r.is("form")?form_submit(r):ajax_call.call(r)},append_args:function(){return append_args.apply(r,arguments),r.phery()},set_args:function(){return set_args.apply(r,arguments),r.phery()},get_args:function(){return this.data("args.phery")},remove:function(){r.data("temp.phery",!0),clean_up(r)}};return e&&e in n?n[e].apply(r,Array.prototype.slice.call(arguments,1)):n},serializeForm:function(opt){opt=$.extend({},opt),"undefined"!=typeof opt.disabled&&null!==opt.disabled||(opt.disabled=!1),"undefined"!=typeof opt.all&&null!==opt.all||(opt.all=!1),"undefined"!=typeof opt.empty&&null!==opt.empty||(opt.empty=!0);var $form=$(this),result={},formValues=$form.find("input,textarea,select,keygen").filter(function(){var e=!0;return opt.disabled||(e=!this.disabled),e&&$.trim(this.name)}).map(function(){var e,t,r=$(this),n=null;return r.is('[type="radio"]')||r.is('[type="checkbox"]')?r.is('[type="radio"]')?(e=$form.find('[type="radio"][name="'+this.name+'"]'),e.filter("[checked]").size()&&(n=e.filter("[checked]").val())):r.prop("checked")&&(n=r.val()):r.is("select")?(t=r.find("option").filter(":selected"),n=r.prop("multiple")?t.map(function(){return this.value||this.innerHTML}).get():t.val()):n=r.val(),{name:this.name||null,value:n}}).get();if(formValues){var i,value,name,res,$matches,len,j,x,fields,_count=0,last_name,strpath,create_obj=function(e,t,r){var n=fields.shift();if(n)"undefined"!=typeof t[n]&&t[n]||(t[n]=e?[]:{}),r.push("['"+n+"']"),create_obj(e,t[n],r);else if("string"==typeof n){var a=(_count++).toString();r.push("['"+a+"']"),"undefined"!=typeof t[a]&&t[a]||(t[a]={}),create_obj(e,t[a],r)}};for(i=0;i<formValues.length;i++){if(name=formValues[i].name,value=formValues[i].value,opt.all)null===value&&(value="");else if(null===value)continue;if((""!==value||opt.empty)&&name){for($matches=name.split(/\[/),len=$matches.length,j=1;j<len;j++)$matches[j]=$matches[j].replace(/\]/g,"");for(fields=[],strpath=[],j=0;j<len;j++)($matches[j]||j<len-1)&&fields.push($matches[j].replace("'",""));if(""===$matches[len-1])if($matches[0]!==last_name&&(last_name=$matches[0],_count=0),create_obj(!0,result,strpath),eval("res=result"+strpath.join("")+";"),value.constructor===Array)for(x=0;x<value.length;x++)res.push(value[x]);else res.push(value);else create_obj(!1,result,strpath),eval("result"+strpath.join("")+"=value;")}}}return result}})}(jQuery,window);