(function(window,factory){"use strict";if(typeof define==="function"&&typeof define["amd"]!=="undefined"){define("phery",["jquery"],function(jQuery){return factory(window,jQuery)})}else{window.phery=factory(window,window.jQuery||window.$)}})(this,function(window,$,undefined){"use strict";var functions={},vars={},$document=$(window.document),$window=$(window),structural_html={HTML:1,BODY:1,DIV:1,BLOCKQUOTE:1,BR:1,HR:1,HEAD:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,P:1,HEADER:1,FOOTER:1,NAV:1,SECTION:1,ASIDE:1,ARTICLE:1,HGROUP:1,FIGURE:1},phery=function(){return function(){return phery}}();vars.locked_config=false;vars.inline_load=true;vars.special_match=/\{([#~\+\-=!])[\d]+\}/;vars.$version=$().jquery;vars.has_formdata="FormData"in window;vars.has_file=vars.has_formdata&&"File"in window;vars.FormData=vars.has_formdata?FormData:null;vars.subscribed=[];vars.call_cache=[];phery.version="2.7.2";functions.hop=function(obj,i){return Object.prototype.hasOwnProperty.call(obj,i)};functions.is_subscribed=function(func_name,do_new,element){if(!element){return false}var i,len,topic=null;do_new=do_new===undefined?true:!!do_new;for(i=0,len=vars.subscribed.length;i<len;i++){if(vars.subscribed[i].topic===func_name&&vars.subscribed[i].element.is(element)){return vars.subscribed[i]}}if(do_new===true){var cb=$.Callbacks();topic={callback:cb,pub:function(args){args=args||[];topic.callback.fireWith(element,args);return topic},sub:function(fn){topic.callback.add(fn);return topic},unsub:function(fn){topic.callback.remove(fn);return topic},element:element,topic:func_name};vars.subscribed.push(topic);return topic}return false};functions.assign_object=function(obj,keyPath,value,create,force,as_obj,force_append){if(!keyPath||!keyPath.length){return false}if($.type(keyPath)!=="array"){if($.type(keyPath)==="number"||$.type(keyPath)==="string"){keyPath=[keyPath]}else{return false}}var lastKeyIndex=keyPath.length-1,key;create=create===undefined?true:create;force=force===undefined?false:force;as_obj=as_obj===undefined?false:as_obj;force_append=force_append===undefined?false:force_append;if(value!==undefined&&as_obj){as_obj=false}for(var i=0;i<lastKeyIndex;i++){key=keyPath[i];if(key in obj){obj=obj[key]}else{if(!create){return false}obj[key]={};obj=obj[key]}}if(typeof obj[keyPath[lastKeyIndex]]!=="undefined"&&value!==undefined){if($.type(obj[keyPath[lastKeyIndex]])==="array"&&!force&&!force_append){if($.type(value)==="array"){Array.prototype.push.apply(obj[keyPath[lastKeyIndex]],value)}else{obj[keyPath[lastKeyIndex]].push(value)}}else{if(force_append){obj[keyPath[lastKeyIndex]]=Array.prototype.concat.call(obj[keyPath[lastKeyIndex]],value)}else{obj[keyPath[lastKeyIndex]]=value}}}else{if(value!==undefined){obj[keyPath[lastKeyIndex]]=value}}return as_obj?obj[keyPath[lastKeyIndex]]:[obj,keyPath[lastKeyIndex]]};functions.obj_to_str=function(obj,prefix,result){result=typeof result==="object"?result:{};var prop,value,name;for(prop in obj){if(functions.hop(obj,prop)){value=obj[prop];name=prefix?prefix+"["+prop+"]":prop;if(typeof value!=="object"||vars.has_file&&value instanceof window["File"]){result[name]=value}else{functions.obj_to_str(value,name,result)}}}return result};functions.files_to_array=function(input){var result=[];if(vars.has_file){if(input instanceof window.File){result.push(input)}else if(input instanceof window.FileList&&input.length){result.push(input[0])}else if(input.files instanceof window.FileList&&input.files.length){if(input.files.length>1){for(var i=0;i<input.files.length;i++){result.push(input.files[i])}}else{result.push(input.files[0])}}}return result};functions.to_formdata=function(obj){obj=$.type(obj)==="object"?functions.obj_to_str(obj):obj;var fd=new vars.FormData,x;for(x in obj){if(functions.hop(obj,x)){fd.append(x,obj[x])}}return fd};functions.per_data=function(this_data,args){var type=$.type(this_data),arg_type=$.type(args),x,i;switch(type){case"array":switch(arg_type){case"array":Array.prototype.push.apply(this_data,args);break;case"object":case"string":case"null":case"boolean":case"number":this_data.push(args);break}break;case"object":switch(arg_type){case"object":this_data=$.extend(this_data,args);break;case"array":i=0;for(x=0;x<args.length;x++){while(typeof this_data[i]!=="undefined"){i++}this_data[i]=args[x]}break;case"number":case"string":case"null":case"boolean":i=0;while(typeof this_data[i]!=="undefined"){i++}this_data[i]=args;break}break;case"string":case"number":case"null":case"boolean":this_data=Array.prototype.concat.call(this_data,args);break;case"undefined":if(arg_type==="object"||args==null){this_data=args}else{this_data=Array.prototype.concat.call(args)}break}return this_data};functions.filter_prop=function(type){return function(){return $(this).prop(type)}};functions.form_element=function($this){var radios,opts,name=$this.prop("name")||null,value=null,type=$this.prop("tagName").toLowerCase();if($this.is('[type="radio"]')||$this.is('[type="checkbox"]')){if($this.is('[type="radio"]')){radios=$this.prop("form")?$($this.prop("form")).find('[type="radio"][name="'+$this.prop("name")+'"]'):$('[type="radio"][name="'+$this.prop("name")+'"]');if(radios.filter(functions.filter_prop("checked")).length){value=radios.filter(functions.filter_prop("checked")).val()}}else if($this.prop("checked")){value=$this.is("[value]")?$this.val():true}}else if($this.is("select")){opts=$this.find("option").filter(functions.filter_prop("selected"));if($this.prop("multiple")){value=opts.map(function(){return this.value||this.innerHTML}).get()}else{value=opts.val()}name=name||""}else if($this.is('[type="file"]')){if(vars.has_file){if(name){name=name.replace("[]","")}value=functions.files_to_array($this[0]);type="file"}else{name=null}}else{value=$this.val()}return{name:name,value:value,type:type}};functions.append_args=function(args){var this_data,x;if(typeof args[0]!=="undefined"&&args[0].constructor===Array){args=args[0]}for(x in args){if(functions.hop(args,x)){this_data=this.phery("data","args");this.phery("data","args",functions.per_data(this_data,args[x]))}}};functions.set_args=function(args){if($.type(args)!=="function"){this.phery("data","args",functions.per_data(undefined,args[0]))}};functions.compare_array=function(x,y){if(x===y){return true}if(x.length!==y.length){return false}for(var i=0;i<x.length;i++){if(x[i]!==y[i]){return false}}return true};functions.str_is_function=function(str,process){if(!str||typeof str["toString"]!=="function"){return false}str=str.toString();var is_it=str.search(/^[\s;]*function\(/im)!==-1&&str.search(/\};?$/m);if(is_it&&process){var cache_len=vars.call_cache.length,fn=null,now=(new Date).getTime(),i;for(i=0;i<cache_len;i++){if(vars.call_cache[i].str===str){fn=vars.call_cache[i].fn;vars.call_cache[i]["lu"]=now;break}}for(i=cache_len-1;i>=0;i--){if(vars.call_cache[i]["lu"]+6e4<now){vars.call_cache.splice(i,1)}}if(typeof fn!=="function"){var f_args=str.match(/function\s*\(([^\)]*)\)/im)[1],f_body=str.slice(str.indexOf("{")+1,str.lastIndexOf("}"));if(!f_body){return false}fn=new Function(f_args,f_body);vars.call_cache.push({str:str,fn:fn,lu:now})}return fn}return is_it};vars.defaults={cursor:true,default_href:false,ajax:{retries:0,timeout:0},enable:{log:false,autolock:false,log_history:false,per_element:{events:true},clickable_structure:false,only:false},inline:{enabled:false,once:true},debug:{enable:false,display:{events:true,remote:true,config:true}},delegate:{confirm:["click"],form:["submit"],select_multiple:["blur"],select:["change"],tags:["click"]}};var options={},callbacks=$("<div></div>"),_log=[],$original_cursor,$body_html=null;vars._callbacks={before:function(){return true},beforeSend:function(){return true},params:function(){return true},always:function(){return true},fail:function(){return true},progress:function(){return true},done:function(){return true},after:function(){return true},exception:function(){return true},json:function(){return true}};function debug(data,type){if(options.debug.enable){if(typeof console!=="undefined"&&typeof console["dir"]==="function"){if(typeof options.debug.display[type]!=="undefined"&&options.debug.display[type]===true){console.dir(data)}}}}function do_cursor(cursor){if(options.cursor){if($body_html===null){$body_html=$("body,html");$original_cursor=$body_html.css("cursor")}if(!cursor){$body_html.css("cursor",$original_cursor)}else{$body_html.css("cursor",cursor)}}}functions.trigger_and_return=function(el,name,data,context,bubble){context=context||null;var event=$.Event(name);event["$target"]=el instanceof $?el:$(el);if(context){event["target"]=context instanceof $?context[0]:context;event["$target"]=context instanceof $?context:$(context)}data=$.type(data)==="array"?data:[data];if(bubble){el.trigger(event,data)}else{el.each(function(){$.event.trigger(event,data,this,true)})}debug(["event triggered",{name:name,"event result":event.result,element:el,data:data}],"events");return event};functions.trigger_phery_event=function(el,event_name,data,triggerData){data=data||[];triggerData=triggerData===undefined?false:triggerData;var res;if(triggerData){res=functions.trigger_and_return(callbacks,event_name,data,el);if(el&&options.enable.per_element.events){functions.trigger_and_return(el,"phery:"+event_name,data,null,true)}if(res.result===undefined){res.result=true}}else{res=functions.trigger_and_return(callbacks,event_name,data,el);if(res.result===false&&res.isImmediatePropagationStopped()){return res}if(res.result===undefined){res.result=true}if(el&&options.enable.per_element.events){res.result=res.result&&functions.trigger_and_return(el,"phery:"+event_name,data,null,true).result}}return res};functions.count_properties=function(obj){var count=0;if(typeof obj==="object"){for(var prop in obj){if(functions.hop(obj,prop)){++count}}}else{if(typeof obj["length"]!=="undefined"){count=obj.length}}return count};function clean_up(el){if(el.phery("data","temp")){el.off();$.removeData(el[0]);el.remove();el=null}}functions.form_submit=function($this){var _confirm=$this.phery("data","confirm");if(_confirm){if(!confirm(_confirm)){return false}}return functions.ajax_call.call($this)};functions.ajax_call=function(args,element){var dispatch_event,event_result;if(this.phery("data","proxy")instanceof $){dispatch_event=this.phery("data","proxy")}else if(element){dispatch_event=element}else{dispatch_event=this}event_result=functions.trigger_phery_event(dispatch_event,"before");if(event_result.result===false){if(!event_result.isImmediatePropagationStopped()){functions.trigger_phery_event(dispatch_event,"always",[null])}clean_up(this);return false}if(!this.phery("data","remote")&&!this.phery("data","view")){functions.trigger_phery_event(dispatch_event,"exception",[phery.log("Current element have no remote data information")]);functions.trigger_phery_event(dispatch_event,"always",[null]);clean_up(this);return false}var _headers={"X-Requested-With":"XMLHttpRequest","X-Phery":1},el=element||this,self=this,tmp,url=self.attr("action")||self.attr("href")||self.phery("data","target")||el.attr("action")||el.attr("href")||el.phery("data","target")||options.default_href||window.location.href,type=self.phery("data","type")||el.phery("data","type")||"json",method=self.attr("method")||el.attr("method")||el.phery("data","method")||"GET",submit_id=el.attr("id")||el.parent().attr("id")||null,requested,cache=!!self.phery("data","cache")||!!el.phery("data","cache")||false,ajax,has_file,i,files={},$token,data={args:undefined,phery:{method:method}};if((!!el.phery("data","only")||options.enable.only===true)&&el.phery("inprogress")){return false}el.phery("data","inprogress",true);if(($token=$("head meta#csrf-token")).length){data.phery.csrf=$token.prop("content")}if(el.phery("data","args")){try{data["args"]=functions.per_data({},el.phery("data","args"))}catch(exception){functions.trigger_phery_event(dispatch_event,"exception",[phery.log(exception)])}}if(args){data["args"]=functions.per_data(data["args"],args)}if(el.is("form")){try{tmp=el.serializeForm(el.phery("data","submit")?$.extend({},el.phery("data","submit"),{files_apart:true}):{files_apart:true});data["args"]=functions.per_data(data["args"],tmp.inputs);$.extend(files,tmp.files)}catch(exception){functions.trigger_phery_event(dispatch_event,"exception",[phery.log(exception)])}}if(el.is('textarea,input[type!="file"]')){tmp=el.serializeForm();data["args"]=functions.per_data(data["args"],tmp)}if(el.is('input[type="file"]')&&vars.has_file){tmp=el.serializeForm();$.extend(files,tmp)}if(el.is("select")){var select=functions.form_element(el);if(!select["name"]){data["args"]=functions.per_data(data["args"],select["value"])}else{var tosend={};tosend[select["name"]]=select["value"];data["args"]=functions.per_data(data["args"],tosend)}}if(el.phery("data","related")){try{var _related=el.phery("data","related"),related=$(),split,_selector;switch(typeof _related){case"string":if(_related.indexOf(",")>-1){split=_related.split(",");for(i=0;i<split.length;i++){_selector=el.find(split[i]);if(!_selector.length){_selector=$(split[i])}if(_selector.length){related=related.add(_selector)}}}else{_selector=el.find(_related);if(!_selector.length){_selector=$(_related)}if(_selector.length){related=related.add(_selector)}}break;case"object":related=_related;break;default:related=false}if(related!==false){if(related.length){var tmprelated={},count=0;related.each(function(){var $this=$(this);if($this.is("form")){tmp=$this.serializeForm({files_apart:true});tmprelated=functions.per_data(tmprelated,tmp.inputs);$.extend(files,tmp.files)}else if($this.is('input[type="checkbox"]')&&$this.attr("name")&&$this.attr("name").indexOf("[")>0&&$this.attr("name").indexOf("]")>0){var name=$this.serializeForm();for(var i in name){if(tmprelated[i]===undefined){tmprelated[i]=[]}tmprelated[i]=functions.per_data(tmprelated[i],name[i])}}else if($this.attr("name")){tmprelated[$this.attr("name")]=$this.val()}else if($this.attr("id")){tmprelated[$this.attr("id")]=$this.val()}else{tmprelated[count++]=$this.val()}});data["args"]=functions.per_data(data["args"],tmprelated)}else{functions.trigger_phery_event(dispatch_event,"exception",[phery.log("related selector found no elements",el.phery("data","related"))])}}}catch(exception){functions.trigger_phery_event(dispatch_event,"exception",[phery.log(exception,"invalid data-phery-related info")])}}if(submit_id){data["phery"]["submit_id"]=submit_id}if(el.phery("data","view")){data["phery"]["view"]="#"+el.attr("id")}else if(self.phery("data","remote")||el.phery("data","remote")){data["phery"]["remote"]=self.phery("data","remote")||el.phery("data","remote")}var _tmp={};functions.trigger_phery_event(dispatch_event,"params",_tmp,true);data["phery"]=$.extend(_tmp,data["phery"]);requested=new Date;debug(["remote call",{data:data,timestamp:requested.getTime(),time:requested.toLocaleString()}],"remote");requested=requested.getTime();has_file=functions.count_properties(files)>0;var opt={url:cache?url:url.indexOf("_=")===-1?(url.indexOf("#")!==-1?url.substr(0,url.indexOf("#")):url)+(url.indexOf("?")>-1?"&":"?")+"_="+requested:url.replace(/_=(\d+)/,"_="+requested),data:has_file?functions.to_formdata($.extend(files,data)):data,contentType:has_file?false:"application/x-www-form-urlencoded",processData:!has_file,dataType:type,type:"POST",el:self,global:false,try_count:0,timeout:options.ajax.timeout,retry_limit:options.ajax.retries,cache:cache,headers:_headers,xhr:function(){var xhr=$.ajaxSettings.xhr();if(typeof xhr["upload"]!=="undefined"){xhr["upload"].onprogress=function(progress){functions.trigger_phery_event(dispatch_event,"progress",[progress])}}return xhr},beforeSend:function(xhr,settings){do_cursor("wait");var res=functions.trigger_phery_event(dispatch_event,"beforeSend",[xhr,settings]);if(res.result===false){xhr.abort()}return res.result!==false}};var _fail=function(xhr,status,error){if(this.retry_limit>0&&status==="timeout"){this.try_count++;if(this.try_count<=this.retry_limit){functions.trigger_phery_event(dispatch_event,"before");this.dataType="text "+type;this.url=this.url.indexOf("_try_count=")===-1?this.url+"&_try_count="+this.try_count:this.url.replace(/_try_count=(\d+)/,"_try_count="+this.try_count);if(!cache){this.url=this.url.replace(/_=(\d+)/,"_="+(new Date).getTime())}ajax=set_ajax_opts(this);return false}}do_cursor(false);el.phery("data","inprogress",false);if(functions.trigger_phery_event(dispatch_event,"fail",[xhr,status,error]).result===false){clean_up(this.el);return false}clean_up(this.el);return true},_done=function(data,text,xhr){if(functions.trigger_phery_event(dispatch_event,"done",[data,text,xhr]).result===false){return false}functions.process_request.call(dispatch_event,data,dispatch_event!==self);return true},_always=function(data,text,xhr){if(text==="timeout"&&data.readyState!==4&&this.try_count>0&&this.try_count<=this.retry_limit){functions.trigger_phery_event(dispatch_event,"always",[data]);return false}do_cursor(false);if(text!=="timeout"){el.phery("data","inprogress",false)}if(functions.trigger_phery_event(dispatch_event,"always",[text==="timeout"?data:xhr]).result===false){clean_up(this.el);return false}clean_up(this.el);return true};var set_ajax_opts=function(opt){var _ajax=$.ajax(opt);_ajax.done(_done).always(_always).fail(_fail);return _ajax};ajax=set_ajax_opts(opt);return ajax};function set_events(){$document.off(".phery");$document.on(options.delegate.confirm.join(".phery,")+".phery",":phery-confirm:not(form)",function(e){if(!confirm($(this).phery("data","confirm"))){e.stopImmediatePropagation()}else{e.preventDefault()}});$document.on(options.delegate.form.join(".phery,")+".phery","form:phery-remote",function(){var $this=$(this);functions.form_submit($this);return false});$document.on(options.delegate.tags.join(".phery,")+".phery",":phery-remote:not(form,select)",function(e){var $this=$(this);if(!options.enable.clickable_structure){if(typeof structural_html[this.tagName]==="number"&&!$this.phery("data","clickable")){return false}}functions.ajax_call.call($this);if(!$this.is('input[type="text"],input[type="checkbox"],input[type="radio"],input[type="image"]')){e.preventDefault()}return true});$document.on(options.delegate.select.join(".phery,")+".phery","select:phery-remote:not([multiple])",function(e){functions.ajax_call.call($(e.currentTarget))});$document.on(options.delegate.select_multiple.join(".phery,")+".phery","select:phery-remote[multiple]",function(e){functions.ajax_call.call($(e.currentTarget))})}functions.convertible=function($element,data,force_current){var self=this,special,selector,cmd;self.$current=null;self.$last=null;self.skip=false;self.stack=[];self.phery=$element.phery();force_current=force_current===undefined?false:force_current;self.set_selector=function(current){self.$last=self.$current;self.$current=current;self.stack.push(current)};self.restore_selector=function(){if(self.$last!==null){self.$current=self.$last;self.$last=self.$current}};self.convert_special=function(obj,depth){var func;if(depth===undefined){depth=5}depth--;if(depth<0){return obj}if($.isPlainObject(obj)||$.type(obj)==="array"){if("PF"in obj){if(func=functions.str_is_function(obj["PF"],true)){obj["PF"]=null;delete obj["PF"];obj=func;func=null}else{if(func===false){debug(["PheryFunction passed is invalid",obj["PF"]],"events")}obj["PF"]=null;delete obj["PF"]}}else if("PR"in obj){func=new functions.convertible($element,obj["PR"]);delete obj["PR"];obj=func.$current;func.destroy();func=null}else{for(var i in obj){if(functions.hop(obj,i)){obj[i]=self.convert_special(obj[i],depth)}}}}return obj};self.selector=function(){var func,Obj;if(special==="="||special==="!"){if(!cmd){return}func=cmd["a"][0];if($.type(func)==="function"){self.skip=true;if(special==="="&&func.call(self.$last||self.$current||$element)){self.restore_selector();self.skip=false}else if(special==="!"&&!func.call(self.$last||self.$current||$element)){self.restore_selector();self.skip=false}}else if($.type(func)==="boolean"){self.skip=true;if(special==="="&&func){self.restore_selector();self.skip=false}else if(special==="!"&&!func){self.restore_selector();self.skip=false}}else if($.type(func)==="object"||$.type(func)==="string"){try{self.skip=true;if(special==="="){if(func instanceof $&&func.length){self.skip=false;self.restore_selector()}else if($(func).length){self.skip=false;self.restore_selector()}}else if(special==="!"){if(func instanceof $&&!func.length){self.skip=false;self.restore_selector()}else if(!$(func).length){self.skip=false;self.restore_selector()}}}catch(exception){self.trigger([phery.log(exception)])}}}else if(special==="+"){if(!cmd){return}if(typeof cmd["a"][1]==="string"&&cmd["a"][1].match(vars.special_match)){Obj={};Obj[cmd["a"][1]]=[];func=new functions.convertible($element,Obj)}else{func=null}Obj=functions.assign_object(func!==null&&func.$current!==null?func.$current:window,cmd["c"],undefined,false,false,true);if(Obj){self.set_selector(cmd["a"][0]?new Obj:Obj)}else{self.trigger([phery.log("failed access to object","window."+cmd["c"].join("."))])}if(func instanceof functions.convertible){func.destroy()}func=null}else if(special==="~"){self.set_selector($element)}else if(special==="-"){self.set_selector(phery.remote.apply(phery,cmd["a"]))}else if(special==="#"){self.set_selector($)}else if(selector.toLowerCase()==="window"){self.set_selector($window)}else if(selector.toLowerCase()==="document"){self.set_selector($document)}else if(typeof selector==="string"){self.set_selector($(selector))}};self.trigger=function(data,event){event=event||"exception";functions.trigger_phery_event($element,event,data)};self.process_parameters=function(){if(cmd&&typeof cmd["a"]!=="undefined"){for(var i in cmd["a"]){if(functions.hop(cmd["a"],i)){cmd["a"][i]=self.convert_special(cmd["a"][i])}}}};self.command=function(){var argc,argv,command,tmp,view,pass,args;if(!cmd){return}argc=cmd["a"].length;argv=cmd["a"];command=Number(cmd["c"]);switch(command){case 1:if(typeof argv[0]!=="undefined"){alert(argv[0].toString())}else{self.trigger([phery.log("missing message for alert()",argv)])}break;case 2:try{tmp=functions.assign_object(window,argv[0],undefined,false);if(tmp!==false&&typeof tmp[0][tmp[1]]==="function"){tmp[0][tmp[1]].apply(tmp[0],argv[1]||[])}else{throw'no function "'+tmp.join(".")+'" found'}}catch(exception){self.trigger([phery.log(exception,argv)])}break;case 3:try{eval("(function(){ "+argv[0]+" })();")}catch(exception){self.trigger([phery.log(exception,argv[0])])}break;case 4:try{self.trigger([$.parseJSON(argv[0])],"json")}catch(exception){self.trigger([phery.log(exception,argv[0])])}break;case 5:view=self.phery.data("view");args=$.extend(true,{},{url:self.phery.data("target")},argv[1]);tmp=self.phery.data("passdata");if(tmp){pass=tmp;$.removeData($element[0],"phery-passdata")}else{pass={}}if(typeof view["beforeHtml"]==="function"){view["beforeHtml"].call($element,args,pass)}if(typeof view["render"]!=="function"){$element.html("").html(argv[0])}else{view["render"].call($element,argv[0],args,pass)}if(typeof view["afterHtml"]==="function"){view["afterHtml"].call($element,args,pass)}break;case 6:try{if(typeof console!=="undefined"&&typeof console["log"]!=="undefined"){for(var l=0;l<argc;l++){console.log(argv[l][0])}}}catch(exception){self.trigger([phery.log(exception,argv[0])])}break;case 7:if(argc>1){args=Array.prototype.concat.call(argv);self.trigger(args);args=null}else{self.trigger([argv[0]])}break;case 8:if(argc===2){if(argv[1]){try{self.phery.data("inprogress",false);phery.view(argv[1]).navigate_to(argv[0])}catch(e){self.trigger([phery.log('phery view "'+argv[1]+'" not found')])}}else{window.location.assign(argv[0])}}break;case 9:tmp=functions.assign_object(window,argv[0],undefined,argc===2,true);if(tmp&&tmp.length>0){if(argc===2){pass=new functions.convertible($element,argv[1][0],true);tmp[0][tmp[1]]=pass.$current;pass.destroy();pass=null}else if(argc===1){delete tmp[0][tmp[1]]}}else{self.trigger([phery.log("object path not found in window."+argv[0].join("."))])}tmp=null;break;case 10:var head=$("head"),file=null,i;switch(argv[0]){case"j":for(i in argv[1]){if(functions.hop(argv[1],i)){file=$("<script></script>",{type:"text/javascript",src:argv[1][i],id:i});if(!head.find("script#"+i).length){head[0].appendChild(file[0])}else{if(argv[2]){head.find("script#"+i).replaceWith(file)}}}}break;case"c":for(i in argv[1]){if(functions.hop(argv[1],i)){file=$("<link/>",{type:"text/css",rel:"stylesheet",href:argv[1][i],id:i});if(!head.find("link#"+i).length){head[0].appendChild(file[0])}else{if(argv[2]){head.find("link#"+i).replaceWith(file)}}file=null}}break}head=null;break;case 11:break;case 12:try{if(argc===3){phery.broadcast(argv[0],argv[1][0])}else if(argc===2){self.phery.publish(argv[0],argv[1][0])}}catch(e){self.trigger([phery.log("invalid pub/sub operation")])}break;case 13:var meta=$("head meta#csrf-token");if(meta.length){meta.replaceWith(argv[0])}else{$("head").append(argv[0])}break;default:self.trigger([phery.log('invalid command "'+cmd["c"]+'" issued')]);break}};self.select=function(){special=selector.match(vars.special_match);if(special!==null){special=special[1]}if(special||selector.charAt(0)==="<"||selector.search(/^[0-9]+$/)===-1){if(special==="!"||special==="="||special==="+"||special==="-"){cmd=data[selector][0];self.process_parameters()}self.selector();for(var i in data[selector]){if(functions.hop(data[selector],i)){if(data[selector][i]===cmd){continue}if(self.skip){self.skip=false;continue}cmd=data[selector][i];self.process_parameters();try{if(typeof self.$current[cmd["c"]]==="function"){self.set_selector(self.$current[cmd["c"]].apply(self.$current,cmd["a"]))}else{throw'no function "'+cmd["c"]+'" found in object'}}catch(exception){self.trigger([phery.log(exception)])}}}}else{cmd=data[selector];self.process_parameters();self.command()}};self.destroy=function(){self.stack=self.$current=self.$last=self.phery=data=cmd=null};if(force_current){self.set_selector(self.convert_special(data))}else if($.isPlainObject(data)){for(selector in data){if(functions.hop(data,selector)){if(self.skip){self.skip=false;continue}self.select()}}}};functions.process_request=function(data,proxied){if(!this.phery("data","remote")&&!this.phery("data","view")&&!proxied){functions.trigger_phery_event(this,"after",[null]);return}var $jq=new functions.convertible(this,data);functions.trigger_phery_event(this,"after",[$jq.$current]);$jq.destroy();$jq=null};functions.dot_notation_option=function(val,step,set){if(val.indexOf(".")!==-1){var initial=val.split(".");if(initial&&initial[0]&&typeof step[initial[0]]!=="undefined"){return functions.dot_notation_option(initial.slice(1).join("."),step[initial[0]],set)}}else if(typeof step[val]!=="undefined"){if(typeof set!=="undefined"){if(step[val].constructor===Array&&typeof set==="string"){step[val].push(set)}else{step[val]=set}return step}else{return step[val]}}return null};function _apply(original,force,group){force=force||false;for(var x in original){if(functions.hop(original,x)){if(typeof original[x]==="object"&&original[x].constructor!==Array){if(_apply(original[x],force,x)===false){return false}}else{debug(["config",{group:group,name:x,value:original[x]}],"config");switch(group){case"inline":switch(x){case"enabled":break;case"once":vars.inline_load=true;break}break;case"delegate":switch(x){case"confirm":case"form":case"select_multiple":case"select":case"tags":if(!functions.compare_array(original[x],options.delegate[x])||force){set_events();return false}break}break}}}}return true}function refresh_changes(key,value){var original=$.extend(true,{},options);if(vars.locked_config){return}if(value===undefined){for(var x in key){if(functions.hop(key,x)){functions.dot_notation_option(x,options,key[x])}}}else{functions.dot_notation_option(key,options,value)}_apply(original)}options=$.extend(true,{},vars.defaults,options);$window.on({load:function(){if(options.enable.autolock){vars.locked_config=true}if(options.inline.enabled&&options.inline.once){vars.inline_load=false}}});phery.config=function(key,value){if(typeof key==="object"&&key.constructor===Object){refresh_changes(key);return phery}else if(typeof key==="string"&&value!==undefined){refresh_changes(key,value);return phery}else if(typeof key==="string"&&value===undefined){if(key in options){return options[key]}return functions.dot_notation_option(key,options)}else if(arguments.length===0){return $.extend(true,{},options)}return phery};phery.lock_config=function(){vars.locked_config=true;return phery};phery.reset_to_defaults=function(){options=$.extend(true,{},vars.defaults);_apply(options,true);return phery};phery.log=function(){var args=Array.prototype.slice.call(arguments);if(args.length){if(options.enable.log){if(options.enable.log_history){_log.push(args)}if(typeof console!=="undefined"&&typeof console["log"]!=="undefined"){if(typeof console["log"]==="object"){console.log(args)}else{console.log.apply(console,args)}}}return args.join("\n")}else{if(options.enable.log_history){return _log}}return[]};phery.broadcast=function(name,args){var i,len,sub;for(i=0,len=vars.subscribed.length;i<len;i++){sub=vars.subscribed[i];if(sub.topic===name){sub.pub(args)}}return phery};phery.subscribe=function(func_name,subs,args,attr){var remote=phery.remote(func_name,args,attr,false);remote.phery("subscribe",subs);return remote};phery.timer=function(element,interval){var stop=false,handler=null,_interval=interval,timeout=function(){if(element.constructor===Array){var arr=$.makeArray(element);phery.remotes(arr).done(function(){if(stop===false){handler=setTimeout(timeout,_interval)}})}else{var promise=functions.ajax_call.call(element);if(promise){promise.always(function(){if(stop===false){handler=setTimeout(timeout,_interval)}})}}};if(interval!==undefined){timeout()}return{start:function(interval){if(interval!==undefined){stop=false;_interval=interval;clearTimeout(handler);timeout()}return this},stop:function(){stop=true;clearTimeout(handler);return this}}};phery.remote=function(function_name,args,attr,direct_call){if(!this){return false}if(this===phery&&!function_name){phery.log('first argument "function_name" on phery.remote() must be specified when calling directly');return false}if(direct_call!==false){direct_call=true}if(this!==phery){return functions.ajax_call.call(this)}var $a=$("<a></a>"),apply=[args],is_temp=false;$a.phery("data","remote",function_name);if(direct_call===true){if(attr!==undefined){if(typeof attr["temp"]!=="undefined"){$a.phery("data","temp",true);is_temp=true}else if(typeof attr["proxy"]==="undefined"&&typeof attr["el"]==="undefined"){$a.phery("data","temp",true);is_temp=true}}else{$a.phery("data","temp",true);is_temp=true}}if(attr!==undefined&&$.isPlainObject(attr)){if(typeof attr["proxy"]!=="undefined"){if(attr["proxy"]instanceof $){attr["proxy"]=attr["proxy"]}else if($.type(attr["proxy"])==="string"){var jq=$(attr["proxy"]);if(jq.length){attr["proxy"]=jq}else{delete attr["proxy"]}}else{delete attr["proxy"]}}if(typeof attr["el"]!=="undefined"){if(attr["el"]instanceof $){apply.push(attr["el"])}delete attr["el"]}for(var i in attr){if(functions.hop(attr,i)){if("target method type proxy cache".indexOf(i.toLowerCase())!==-1){$a.phery("data",i,attr[i])}else{$a.attr(attr)}}}}if(is_temp===false&&args){$a.phery("set_args",args)}return direct_call?functions.ajax_call.apply($a,apply):$a};phery.element=function(remote,attrs){attrs=attrs||null;return phery.remote(remote,null,attrs,false)};phery.json=function(remote,args,cb){var el=phery.remote(remote,null,{temp:true},false);el.on("phery:json",function(event,data){return cb(data)});if(args!==undefined&&args!==null){el.phery("remote",args)}else{el.phery("remote")}return el};phery.remotes=function(array){var $d=$.Deferred(),promises=[],count=0,next=function(){var current=array instanceof $?array.eq(count++):array.shift();if(current&&current.length){var promise=array instanceof $?phery.remote.apply(current):phery.remote.apply(phery,current);if(promise instanceof $.Deferred){promises.push(promise);$d.notifyWith(current,promise);promise.always(next)}else{next();
}}else{$d.resolve(promises)}};if($.type(array)==="array"&&array.length){for(var i=0;i<array.length;i++){if($.type(array[i])==="array"){if(array[i].length>3){array[i]=array[i].slice(0,3)}}else{array.splice(i,1)}}}else if(!(array instanceof $)){$d.resolve([]);return $d.promise()}next();return $d.promise()};phery.on=function(event,cb){if(typeof event==="object"){if($.isPlainObject(event)){for(var x in event){if(functions.hop(event,x)){phery.on(x,event[x])}}}}else if(typeof event==="string"&&typeof cb==="function"){if(event in vars._callbacks){debug(["phery.on",{event:event,callback:cb}],"events");callbacks.on(event+".phery",cb)}}return phery};phery.off=function(event){debug(["phery.off",{event:event}],"events");callbacks.off(event+".phery");return phery};phery.load=function(str,element){if(options.inline.enabled){if(!vars.inline_load){return phery}if(!element){element=$("<a></a>");element.phery("data","temp",true)}if($.type(str)==="string"&&element instanceof $){functions.process_request.call(element,$.parseJSON(str),true)}}return phery};vars._containers={};functions.excluded_url=function(href,urls){if(href==="#"){return true}for(var x=0;x<urls.length;x++){switch(typeof urls[x]){case"string":if(href.indexOf(urls[x])!==-1){return true}break;case"object":if(href.search(urls[x])!==-1){return true}break;case"function":if(urls[x].call(null,href)===true){return true}}}return false};functions.phery_view=function(config){this.container=config;this.data=$.extend({},this.container.phery("data","view"));this.is_excluded_url=function(url){var excludes=this.container.phery("data","view")["exclude"]||false;if(excludes&&url){return functions.excluded_url(url,excludes)}return false};this.navigate_to=function(url,args,passdata){if(url){this.container.phery("data","target",url)}var ajax;if(passdata!==undefined){this.container.phery("data","passdata",passdata)}if(args!==undefined&&args!==null){ajax=functions.ajax_call.call(this.container,args)}else{ajax=functions.ajax_call.call(this.container)}return ajax}};phery.view=function(config){if(typeof config==="string"){if(typeof vars._containers[config]!=="undefined"){return vars._containers[config]}else{return phery}}if(typeof config==="object"&&$.isEmptyObject(config)){debug(["phery.view needs config"],"config");return phery}if(!$.isPlainObject(config)){debug(["phery.view needs a plain object"],"config");return phery}var _container,_bound,$container,selector,event=function(e){var $this=$(this),href=$this.attr("href");if(e.which===2||e.metaKey){return true}if(e.data.is_excluded_url(href)){return true}debug(["phery.view link clicked, loading content",e.data.container,$this.attr("href")],"events");e.data.navigate_to($this.attr("href"));e.stopPropagation();e.preventDefault();return false};$document.off("click.view");for(_container in config){if(functions.hop(config,_container)){$container=$(_container);if($container.length===1){_bound=_container.replace(/[#\.\s>:,~=\+\-_\*]/g,"");if(config[_container]===false){$container.off(".pheryview");$document.off("click.view."+_bound);debug(["phery.view uninstalled and events unbound",$container],"config");continue}if(typeof config[_container]["selector"]==="string"&&config[_container]["selector"].search(/(^|\s)a($|\s|\.)/i)!==-1){selector=_container+" "+config[_container]["selector"]}else{selector='a[href]:not(.no-phery,[target],[data-phery-remote],[href*=":"],[rel~="nofollow"])'}selector=selector+',a[href][rel="'+_container+'"]';for(var _x in config[_container]){if(functions.hop(config[_container],_x)&&typeof _x==="string"&&typeof vars._callbacks[_x]!=="undefined"){$container.on("phery:"+_x+".pheryview",config[_container][_x]);delete config[_container][_x]}}$container.phery("data","view",$.extend(true,{},config[_container],{selector:selector}));vars._containers[_container]=new functions.phery_view($container);$document.on("click.view."+_bound,selector,vars._containers[_container],event);debug(["phery.view installed",$container],"config")}else{debug(["phery.view container",$container,"isnt unique or does not exist"],"config")}}}return phery};functions.reset=function(){return this.each(function(){if($(this).is("form")){this.reset()}})};functions.phery=function(name){var $this=this,_out=function(){return{publish:function(name,args){return $this.each(function(){var $this=$(this),subs;subs=functions.is_subscribed(name,false,$this);if(subs!==false){subs.pub(args)}})},subscribe:function(obj,remove){return $this.each(function(){var v,$this=$(this),sub;for(v in obj){if(functions.hop(obj,v)){sub=functions.is_subscribed(v,true,$this);if(sub!==false){if(remove===true){sub.unsub(obj[v])}else{sub.sub(obj[v])}}}}})},exception:function(msg,data){return $this.each(function(){var $this=$(this);functions.trigger_phery_event($this,"exception",[msg,data])})},data:function(name,data){var i;if(data!==undefined){$this.data("phery-"+name,data);return $this}else if(name!==undefined){if($.isPlainObject(name)){for(i in name){if(functions.hop(name,i)){$this.data("phery-"+i,name[i])}}return $this}return $this.data("phery-"+name)}data=$.extend({},$this.data());for(i in data){if(functions.hop(data,i)&&!/^phery/.test(i)){delete data[i]}}return data},proxy:function(jq){return $this.each(function(){var $_this=$(this);if(jq instanceof $){if(jq.length){$_this.phery("data","proxy",jq)}}else if($.type(jq)==="string"){try{jq=$(jq);if(jq.length){$_this.phery("data","proxy",jq)}}catch(exc){}}else{$.removeData(this,"phery-proxy")}})},remote:function(args){return $this.each(function(){var $this=$(this);if($this.is(":phery-remote")){if($this.is("form")){functions.form_submit($this)}else{functions.ajax_call.call($this,args)}}})},one:function(args){if($this.is(":phery-remote")){if($this.is("form")){return functions.form_submit($this)}else{return functions.ajax_call.call($this,args)}}},append_args:function(){var args=Array.prototype.slice.call(arguments);if(args.length){$this.each(function(){var $this=$(this);functions.append_args.apply($this,[args])})}return _out},set_args:function(args){$this.each(function(){var $this=$(this);functions.set_args.call($this,[args])});return _out},get_args:function(){return _out.data("args")},remove:function(){$this.each(function(){var $this=$(this);$this.phery("data","temp",true);clean_up($this)})},make:function(func,args){if($.type(func)==="string"){return $this.each(function(){var $this=$(this);$this.attr("data-phery-remote",func).phery("data",{remote:func,inprogress:false});if(args!==undefined){functions.set_args.call($this,[args])}})}return $this},inprogress:function(){return!!_out.data("inprogress")},unmake:function(unbind){return $this.each(function(){var $this=$(this);if(unbind){$this.off(".phery")}$.removeData(this,"remote");$this.removeAttr("data-phery-remote").removeAttr("data-phery-args").removeAttr("data-phery-confirm")})}}}();if(name&&$.isPlainObject(name)){var last;for(var x in name){if(functions.hop(name,x)&&x in _out){last=_out[x].apply($this,name[x])}}return last}else if(name&&name in _out){return _out[name].apply($this,Array.prototype.slice.call(arguments,1))}return _out};functions.serializeForm=function(opt){opt=$.extend({disabled:false,all:false,empty:true,files_apart:false},opt||{});var $form=$(this),result=opt["files_apart"]?{inputs:{},files:{}}:{},map=function(){var $this=$(this);if(!vars.has_file&&$this.is('input[type="file"]')){return null}return functions.form_element($this)},formValues=$form.is("form")?$form.find("input,textarea,select").filter(function(){var ret=true;if(!opt["disabled"]){ret=!this.disabled}return ret&&$.trim(this.name)!==""}).map(map).get():$form.is("select,textarea,input")?[functions.form_element($form)]:[];if(formValues.length){var i,value,name,$matches,len,offset,j,type,fields;for(i=0;i<formValues.length;i++){name=formValues[i].name;value=formValues[i].value;type=formValues[i].type;if(!opt["all"]){if(value===null){continue}}else{if(value===null){value=""}}if(value===""&&!opt["empty"]){continue}if(type==="file"&&value.length===0){continue}if(!name){continue}$matches=name.split(/\[/);len=$matches.length;for(j=1;j<len;j++){$matches[j]=$matches[j].replace(/\]/g,"")}fields=[];for(j=0;j<len;j++){if($matches[j]||j<len-1){fields.push($matches[j].replace(/['"]+/g,""))}}if($matches[len-1]===""){offset=functions.assign_object(opt["files_apart"]?type==="file"?result["files"]:result["inputs"]:result,fields,[],true,false,false);if($.type(value)==="array"){Array.prototype.push.apply(offset[0][offset[1]],value)}else{offset[0][offset[1]].push(value)}}else{functions.assign_object(opt["files_apart"]?type==="file"?result["files"]:result["inputs"]:result,fields,value,true,false,false,type==="file")}}}return result};$.extend($.expr[":"],{"phery-remote":function(el){return typeof(el instanceof $?el.phery("data","remote"):$(el).phery("data","remote"))==="string"},"phery-confirm":function(el){return typeof(el instanceof $?el.phery("data","confirm"):$(el).phery("data","confirm"))==="string"},"phery-view":function(el){return!!(el instanceof $?el.phery("data","view"):$(el).phery("data","view"))}});$.fn.reset=functions.reset;$.fn.phery=functions.phery;$.fn.serializeForm=functions.serializeForm;if($.inArray(window.location.host,["127.0.0.1","::1","localhost"])>-1){phery.vars=vars;phery.functions=functions}if(!("vars"in phery)&&!("functions"in phery)){if(typeof Object["freeze"]==="function"){Object.freeze(phery)}}_apply(options,true);return phery});