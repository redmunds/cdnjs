!function(e,t){"use strict";"function"==typeof define&&"undefined"!=typeof define.amd?define("phery",["jquery"],function(n){return t(e,n)}):e.phery=t(e,e.jQuery||e.$)}(this,function(window,$,undefined){"use strict";function debug(e,t){options.debug.enable&&"undefined"!=typeof console&&"function"==typeof console.dir&&"undefined"!=typeof options.debug.display[t]&&options.debug.display[t]===!0&&console.dir(e)}function do_cursor(e){options.cursor&&(null===$body_html&&($body_html=$("body,html"),$original_cursor=$body_html.css("cursor")),e?$body_html.css("cursor",e):$body_html.css("cursor",$original_cursor))}function clean_up(e){e.phery("data","temp")&&(e.off(),$.removeData(e[0]),e.remove(),e=null)}function set_events(){$document.off(".phery"),$document.on(options.delegate.confirm.join(".phery,")+".phery",":phery-confirm:not(form)",function(e){confirm($(this).phery("data","confirm"))?e.preventDefault():e.stopImmediatePropagation()}),$document.on(options.delegate.form.join(".phery,")+".phery","form:phery-remote",function(){var e=$(this);return functions.form_submit(e),!1}),$document.on(options.delegate.tags.join(".phery,")+".phery",":phery-remote:not(form,select)",function(e){var t=$(this);return!(!options.enable.clickable_structure&&"number"==typeof structural_html[this.tagName]&&!t.phery("data","clickable"))&&(functions.ajax_call.call(t),t.is('input[type="text"],input[type="checkbox"],input[type="radio"],input[type="image"]')||e.preventDefault(),!0)}),$document.on(options.delegate.select.join(".phery,")+".phery","select:phery-remote:not([multiple])",function(e){functions.ajax_call.call($(e.currentTarget))}),$document.on(options.delegate.select_multiple.join(".phery,")+".phery","select:phery-remote[multiple]",function(e){functions.ajax_call.call($(e.currentTarget))})}function _apply(e,t,n){t=t||!1;for(var r in e)if(functions.hop(e,r))if("object"==typeof e[r]&&e[r].constructor!==Array){if(_apply(e[r],t,r)===!1)return!1}else switch(debug(["config",{group:n,name:r,value:e[r]}],"config"),n){case"inline":switch(r){case"enabled":break;case"once":vars.inline_load=!0}break;case"delegate":switch(r){case"confirm":case"form":case"select_multiple":case"select":case"tags":if(!functions.compare_array(e[r],options.delegate[r])||t)return set_events(),!1}}return!0}function refresh_changes(e,t){var n=$.extend(!0,{},options);if(!vars.locked_config){if(t===undefined)for(var r in e)functions.hop(e,r)&&functions.dot_notation_option(r,options,e[r]);else functions.dot_notation_option(e,options,t);_apply(n)}}var functions={},vars={},$document=$(window.document),$window=$(window),structural_html={HTML:1,BODY:1,DIV:1,BLOCKQUOTE:1,BR:1,HR:1,HEAD:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,P:1,HEADER:1,FOOTER:1,NAV:1,SECTION:1,ASIDE:1,ARTICLE:1,HGROUP:1,FIGURE:1},phery=function(){return function(){return phery}}();vars.locked_config=!1,vars.inline_load=!0,vars.special_match=/\{([#~\+\-=!])[\d]+\}/,vars.$version=$().jquery,vars.has_formdata="FormData"in window,vars.has_file=vars.has_formdata&&"File"in window,vars.FormData=vars.has_formdata?FormData:null,vars.subscribed=[],vars.call_cache=[],phery.version="2.5.1",functions.hop=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},functions.is_subscribed=function(e,t,n){if(!n)return!1;var r,i,a=null;for(t=t===undefined||!!t,r=0,i=vars.subscribed.length;r<i;r++)if(vars.subscribed[r].topic===e&&vars.subscribed[r].element.is(n))return vars.subscribed[r];if(t===!0){var o=$.Callbacks();return a={callback:o,pub:function(e){return e=e||[],a.callback.fireWith(n,e),a},sub:function(e){return a.callback.add(e),a},unsub:function(e){return a.callback.remove(e),a},element:n,topic:e},vars.subscribed.push(a),a}return!1},functions.assign_object=function(e,t,n,r,i,a,o){if(!t||!t.length)return!1;if("array"!==$.type(t)){if("number"!==$.type(t)&&"string"!==$.type(t))return!1;t=[t]}var s,c=t.length-1;r=r===undefined||r,i=i!==undefined&&i,a=a!==undefined&&a,o=o!==undefined&&o,n!==undefined&&a&&(a=!1);for(var l=0;l<c;l++)if(s=t[l],s in e)e=e[s];else{if(!r)return!1;e[s]={},e=e[s]}return"undefined"!=typeof e[t[c]]&&n!==undefined?"array"!==$.type(e[t[c]])||i||o?o?e[t[c]]=e[t[c]].concat(n):e[t[c]]=n:"array"===$.type(n)?e[t[c]].concat(n):e[t[c]].push(n):n!==undefined&&(e[t[c]]=n),a?e[t[c]]:[e,t[c]]},functions.obj_to_str=function(e,t,n){n="object"==typeof n?n:{};var r,i,a;for(r in e)functions.hop(e,r)&&(i=e[r],a=t?t+"["+r+"]":r,"object"!=typeof i||vars.has_file&&i instanceof window.File?n[a]=i:functions.obj_to_str(i,a,n));return n},functions.files_to_array=function(e){var t=[];if(vars.has_file)if(e instanceof window.File)t.push(e);else if(e instanceof window.FileList&&e.length)t.push(e[0]);else if(e.files instanceof window.FileList&&e.files.length)if(e.files.length>1)for(var n=0;n<e.files.length;n++)t.push(e.files[n]);else t.push(e.files[0]);return t},functions.to_formdata=function(e){e="object"===$.type(e)?functions.obj_to_str(e):e;var t,n=new vars.FormData;for(t in e)functions.hop(e,t)&&n.append(t,e[t]);return n},functions.per_data=function(e,t){var n,r,i=$.type(e),a=$.type(t);switch(i){case"array":switch(a){case"array":e.concat(t);break;case"object":case"string":case"null":case"boolean":case"number":e.push(t)}break;case"object":switch(a){case"object":e=$.extend(e,t);break;case"array":for(r=0,n=0;n<t.length;n++){for(;"undefined"!=typeof e[r];)r++;e[r]=t[n]}break;case"number":case"string":case"null":case"boolean":for(r=0;"undefined"!=typeof e[r];)r++;e[r]=t}break;case"string":case"number":case"null":case"boolean":e=[].concat(e,t);break;case"undefined":e="object"===a||null==t?t:Array.prototype.concat.call(t)}return e},functions.filter_prop=function(e){return function(){return $(this).prop(e)}},functions.form_element=function(e){var t,n,r=e.prop("name")||null,i=null,a=e.prop("tagName").toLowerCase();return e.is('[type="radio"]')||e.is('[type="checkbox"]')?e.is('[type="radio"]')?(t=e.prop("form")?$(e.prop("form")).find('[type="radio"][name="'+e.prop("name")+'"]'):$('[type="radio"][name="'+e.prop("name")+'"]'),t.filter(functions.filter_prop("checked")).length&&(i=t.filter(functions.filter_prop("checked")).val())):e.prop("checked")&&(i=!e.is("[value]")||e.val()):e.is("select")?(n=e.find("option").filter(functions.filter_prop("selected")),i=e.prop("multiple")?n.map(function(){return this.value||this.innerHTML}).get():n.val(),r=r||""):e.is('[type="file"]')?vars.has_file?(r&&(r=r.replace("[]","")),i=functions.files_to_array(e[0]),a="file"):r=null:i=e.val(),{name:r,value:i,type:a}},functions.append_args=function(e){var t,n;"undefined"!=typeof e[0]&&e[0].constructor===Array&&(e=e[0]);for(n in e)functions.hop(e,n)&&(t=this.phery("data","args"),this.phery("data","args",functions.per_data(t,e[n])))},functions.set_args=function(e){"function"!==$.type(e)&&this.phery("data","args",functions.per_data(undefined,e[0]))},functions.compare_array=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},functions.str_is_function=function(e,t){if(!e||"function"!=typeof e.toString)return!1;e=e.toString();var n=e.search(/^[\s;]*function\(/im)!==-1&&e.search(/\};?$/m);if(n&&t){var r,i=vars.call_cache.length,a=null,o=(new Date).getTime();for(r=0;r<i;r++)if(vars.call_cache[r].str===e){a=vars.call_cache[r].fn,vars.call_cache[r].lu=o;break}for(r=i-1;r>=0;r--)vars.call_cache[r].lu+6e4<o&&vars.call_cache.splice(r,1);if("function"!=typeof a){var s=e.match(/function\s*\(([^\)]*)\)/im)[1],c=e.slice(e.indexOf("{")+1,e.lastIndexOf("}"));if(!c)return!1;a=new Function(s,c),vars.call_cache.push({str:e,fn:a,lu:o})}return a}return n},vars.defaults={cursor:!0,default_href:!1,ajax:{retries:0},enable:{log:!1,autolock:!1,log_history:!1,per_element:{events:!0},clickable_structure:!1,only:!1},inline:{enabled:!1,once:!0},debug:{enable:!1,display:{events:!0,remote:!0,config:!0}},delegate:{confirm:["click"],form:["submit"],select_multiple:["blur"],select:["change"],tags:["click"]}};var options={},callbacks=$("<div></div>"),_log=[],$original_cursor,$body_html=null;return vars._callbacks={before:function(){return!0},beforeSend:function(){return!0},params:function(){return!0},always:function(){return!0},fail:function(){return!0},progress:function(){return!0},done:function(){return!0},after:function(){return!0},exception:function(){return!0},json:function(){return!0}},functions.trigger_and_return=function(e,t,n,r,i){r=r||null;var a=$.Event(t);return a.$target=e instanceof $?e:$(e),r&&(a.target=r instanceof $?r[0]:r,a.$target=r instanceof $?r:$(r)),n="array"===$.type(n)?n:[n],i?e.trigger(a,n):e.each(function(){$.event.trigger(a,n,this,!0)}),debug(["event triggered",{name:t,"event result":a.result,element:e,data:n}],"events"),a},functions.trigger_phery_event=function(e,t,n,r){n=n||[],r=r!==undefined&&r;var i;if(r)i=functions.trigger_and_return(callbacks,t,n,e),e&&options.enable.per_element.events&&functions.trigger_and_return(e,"phery:"+t,n,null,!0),i.result===undefined&&(i.result=!0);else{if(i=functions.trigger_and_return(callbacks,t,n,e),i.result===!1&&i.isImmediatePropagationStopped())return i;i.result===undefined&&(i.result=!0),e&&options.enable.per_element.events&&(i.result=i.result&&functions.trigger_and_return(e,"phery:"+t,n,null,!0).result)}return i},functions.count_properties=function(e){var t=0;if("object"==typeof e)for(var n in e)functions.hop(e,n)&&++t;else"undefined"!=typeof e.length&&(t=e.length);return t},functions.form_submit=function(e){var t=e.phery("data","confirm");return!(t&&!confirm(t))&&functions.ajax_call.call(e)},functions.ajax_call=function(e,t){var n,r;if(n=this.phery("data","proxy")instanceof $?this.phery("data","proxy"):t?t:this,r=functions.trigger_phery_event(n,"before"),r.result===!1)return r.isImmediatePropagationStopped()||functions.trigger_phery_event(n,"always",[null]),clean_up(this),!1;if(!this.phery("data","remote")&&!this.phery("data","view"))return functions.trigger_phery_event(n,"exception",[phery.log("Current element have no remote data information")]),functions.trigger_phery_event(n,"always",[null]),clean_up(this),!1;var i,a,o,s,c,l,f={"X-Requested-With":"XMLHttpRequest","X-Phery":1},u=t||this,p=this,d=p.attr("action")||p.attr("href")||p.phery("data","target")||u.attr("action")||u.attr("href")||u.phery("data","target")||options.default_href||window.location.href,h=p.phery("data","type")||u.phery("data","type")||"json",y=p.attr("method")||u.attr("method")||u.phery("data","method")||"GET",g=u.attr("id")||u.parent().attr("id")||null,m=!!p.phery("data","cache")||!!u.phery("data","cache")||!1,v={},_={args:undefined,phery:{method:y}};if((u.phery("data","only")||options.enable.only===!0)&&u.phery("inprogress"))return!1;if(u.phery("data","inprogress",!0),(l=$("head meta#csrf-token")).length&&(_.phery.csrf=l.prop("content")),u.phery("data","args"))try{_.args=functions.per_data({},u.phery("data","args"))}catch(e){functions.trigger_phery_event(n,"exception",[phery.log(e)])}if(e&&(_.args=functions.per_data(_.args,e)),u.is("form"))try{i=u.serializeForm(u.phery("data","submit")?$.extend({},u.phery("data","submit"),{files_apart:!0}):{files_apart:!0}),_.args=functions.per_data(_.args,i.inputs),$.extend(v,i.files)}catch(e){functions.trigger_phery_event(n,"exception",[phery.log(e)])}if(u.is('textarea,input[type!="file"]')&&(i=u.serializeForm(),_.args=functions.per_data(_.args,i)),u.is('input[type="file"]')&&vars.has_file&&(i=u.serializeForm(),$.extend(v,i)),u.is("select")){var b=functions.form_element(u);if(b.name){var w={};w[b.name]=b.value,_.args=functions.per_data(_.args,w)}else _.args=functions.per_data(_.args,b.value)}if(u.phery("data","related"))try{var k,x,j=u.phery("data","related"),O=$();switch(typeof j){case"string":if(j.indexOf(",")>-1)for(k=j.split(","),c=0;c<k.length;c++)x=u.find(k[c]),x.length||(x=$(k[c])),x.length&&(O=O.add(x));else x=u.find(j),x.length||(x=$(j)),x.length&&(O=O.add(x));break;case"object":O=j;break;default:O=!1}if(O!==!1)if(O.length){var F={},P=0;O.each(function(){var e=$(this);e.is("form")?(i=e.serializeForm({files_apart:!0}),F=functions.per_data(F,i.inputs),$.extend(v,i.files)):e.attr("name")?F[e.attr("name")]=e.val():e.attr("id")?F[e.attr("id")]=e.val():F[P++]=e.val()}),_.args=functions.per_data(_.args,F)}else functions.trigger_phery_event(n,"exception",[phery.log("related selector found no elements",u.phery("data","related"))])}catch(e){functions.trigger_phery_event(n,"exception",[phery.log(e,"invalid data-phery-related info")])}g&&(_.phery.submit_id=g),u.phery("data","view")?_.phery.view="#"+u.attr("id"):(p.phery("data","remote")||u.phery("data","remote"))&&(_.phery.remote=p.phery("data","remote")||u.phery("data","remote"));var D={};functions.trigger_phery_event(n,"params",D,!0),_.phery=$.extend(D,_.phery),a=new Date,debug(["remote call",{data:_,timestamp:a.getTime(),time:a.toLocaleString()}],"remote"),a=a.getTime(),s=functions.count_properties(v)>0;var T={url:m?d:d.indexOf("_=")===-1?(d.indexOf("#")!==-1?d.substr(0,d.indexOf("#")):d)+(d.indexOf("?")>-1?"&":"?")+"_="+a:d.replace(/_=(\d+)/,"_="+a),data:s?functions.to_formdata($.extend(v,_)):_,contentType:!s&&"application/x-www-form-urlencoded",processData:!s,dataType:h,type:"POST",el:p,global:!1,try_count:0,retry_limit:options.ajax.retries,cache:m,headers:f,xhr:function(){var e=$.ajaxSettings.xhr();return"undefined"!=typeof e.upload&&(e.upload.onprogress=function(e){functions.trigger_phery_event(n,"progress",[e])}),e},beforeSend:function(e,t){do_cursor("wait");var r=functions.trigger_phery_event(n,"beforeSend",[e,t]);return r.result===!1&&e.abort(),r.result!==!1}},A=function(e,t,r){return this.retry_limit>0&&"timeout"===t&&(this.try_count++,this.try_count<=this.retry_limit)?(functions.trigger_phery_event(n,"before"),this.dataType="text "+h,this.url=this.url.indexOf("_try_count=")===-1?this.url+"&_try_count="+this.try_count:this.url.replace(/_try_count=(\d+)/,"_try_count="+this.try_count),m||(this.url=this.url.replace(/_=(\d+)/,"_="+(new Date).getTime())),o=E(this),!1):(do_cursor(!1),u.phery("data","inprogress",!1),functions.trigger_phery_event(n,"fail",[e,t,r]).result===!1?(clean_up(this.el),!1):(clean_up(this.el),!0))},H=function(e,t,r){return functions.trigger_phery_event(n,"done",[e,t,r]).result!==!1&&(functions.process_request.call(n,e,n!==p),!0)},S=function(e,t,r){return"timeout"===t&&4!==e.readyState&&this.try_count>0&&this.try_count<=this.retry_limit?(functions.trigger_phery_event(n,"always",[e]),!1):(do_cursor(!1),"timeout"!==t&&u.phery("data","inprogress",!1),functions.trigger_phery_event(n,"always",["timeout"===t?e:r]).result===!1?(clean_up(this.el),!1):(clean_up(this.el),!0))},E=function(e){var t=$.ajax(e);return t.done(H).always(S).fail(A),t};return o=E(T)},functions.convertible=function($element,data,force_current){var self=this,special,selector,cmd;if(self.$current=null,self.$last=null,self.skip=!1,self.stack=[],self.phery=$element.phery(),force_current=force_current!==undefined&&force_current,self.set_selector=function(e){self.$last=self.$current,self.$current=e,self.stack.push(e)},self.restore_selector=function(){null!==self.$last&&(self.$current=self.$last,self.$last=self.$current)},self.convert_special=function(e,t){var n;if(t===undefined&&(t=5),t--,t<0)return e;if($.isPlainObject(e)||"array"===$.type(e))if("PF"in e)(n=functions.str_is_function(e.PF,!0))?(e.PF=null,delete e.PF,e=n,n=null):(n===!1&&debug(["PheryFunction passed is invalid",e.PF],"events"),e.PF=null,delete e.PF);else if("PR"in e)n=new functions.convertible($element,e.PR),delete e.PR,e=n.$current,n.destroy(),n=null;else for(var r in e)functions.hop(e,r)&&(e[r]=self.convert_special(e[r],t));return e},self.selector=function(){var e,t;if("="===special||"!"===special){if(!cmd)return;if(e=cmd.a[0],"function"===$.type(e))self.skip=!0,"="===special&&e.call(self.$last||self.$current||$element)?(self.restore_selector(),self.skip=!1):"!"!==special||e.call(self.$last||self.$current||$element)||(self.restore_selector(),self.skip=!1);else if("boolean"===$.type(e))self.skip=!0,"="===special&&e?(self.restore_selector(),self.skip=!1):"!"!==special||e||(self.restore_selector(),self.skip=!1);else if("object"===$.type(e)||"string"===$.type(e))try{self.skip=!0,"="===special?e instanceof $&&e.length?(self.skip=!1,self.restore_selector()):$(e).length&&(self.skip=!1,self.restore_selector()):"!"===special&&(e instanceof $&&!e.length?(self.skip=!1,self.restore_selector()):$(e).length||(self.skip=!1,self.restore_selector()))}catch(e){self.trigger([phery.log(e)])}}else if("+"===special){if(!cmd)return;"string"==typeof cmd.a[1]&&cmd.a[1].match(vars.special_match)?(t={},t[cmd.a[1]]=[],e=new functions.convertible($element,t)):e=null,t=functions.assign_object(null!==e&&null!==e.$current?e.$current:window,cmd.c,undefined,!1,!1,!0),t?self.set_selector(cmd.a[0]?new t:t):self.trigger([phery.log("failed access to object","window."+cmd.c.join("."))]),e instanceof functions.convertible&&e.destroy(),e=null}else"~"===special?self.set_selector($element):"-"===special?self.set_selector(phery.remote.apply(phery,cmd.a)):"#"===special?self.set_selector($):"window"===selector.toLowerCase()?self.set_selector($window):"document"===selector.toLowerCase()?self.set_selector($document):"string"==typeof selector&&self.set_selector($(selector))},self.trigger=function(e,t){t=t||"exception",functions.trigger_phery_event($element,t,e)},self.process_parameters=function(){if(cmd&&"undefined"!=typeof cmd.a)for(var e in cmd.a)functions.hop(cmd.a,e)&&(cmd.a[e]=self.convert_special(cmd.a[e]))},self.command=function(){var argc,argv,command,tmp,view,pass,args;if(cmd)switch(argc=cmd.a.length,argv=cmd.a,command=Number(cmd.c)){case 1:"undefined"!=typeof argv[0]?alert(argv[0].toString()):self.trigger([phery.log("missing message for alert()",argv)]);break;case 2:try{if(tmp=functions.assign_object(window,argv[0],undefined,!1),tmp===!1||"function"!=typeof tmp[0][tmp[1]])throw'no function "'+tmp.join(".")+'" found';tmp[0][tmp[1]].apply(null,argv[1]||[])}catch(e){self.trigger([phery.log(e,argv)])}break;case 3:try{eval("(function(){ "+argv[0]+" })();")}catch(e){self.trigger([phery.log(e,argv[0])])}break;case 4:try{self.trigger([$.parseJSON(argv[0])],"json")}catch(e){self.trigger([phery.log(e,argv[0])])}break;case 5:view=self.phery.data("view"),args=$.extend(!0,{},{url:self.phery.data("target")},argv[1]),tmp=self.phery.data("passdata"),tmp?(pass=tmp,$.removeData($element[0],"phery-passdata")):pass={},"function"==typeof view.beforeHtml&&view.beforeHtml.call($element,args,pass),"function"!=typeof view.render?$element.html("").html(argv[0]):view.render.call($element,argv[0],args,pass),"function"==typeof view.afterHtml&&view.afterHtml.call($element,args,pass);break;case 6:try{if("undefined"!=typeof console&&"undefined"!=typeof console.log)for(var l=0;l<argc;l++)console.log(argv[l][0])}catch(e){self.trigger([phery.log(e,argv[0])])}break;case 7:argc>1?(args=[].concat(argv),self.trigger(args),args=null):self.trigger([argv[0]]);break;case 8:if(2===argc)if(argv[1])try{self.phery.data("inprogress",!1),phery.view(argv[1]).navigate_to(argv[0])}catch(e){self.trigger([phery.log('phery view "'+argv[1]+'" not found')])}else window.location.assign(argv[0]);break;case 9:tmp=functions.assign_object(window,argv[0],undefined,2===argc,!0),tmp&&tmp.length>0?2===argc?(pass=new functions.convertible($element,argv[1][0],!0),tmp[0][tmp[1]]=pass.$current,pass.destroy(),pass=null):1===argc&&delete tmp[0][tmp[1]]:self.trigger([phery.log("object path not found in window."+argv[0].join("."))]),tmp=null;break;case 10:var head=$("head"),file=null,i;switch(argv[0]){case"j":for(i in argv[1])functions.hop(argv[1],i)&&(file=$("<script></script>",{type:"text/javascript",src:argv[1][i],id:i}),head.find("script#"+i).length?argv[2]&&head.find("script#"+i).replaceWith(file):head[0].appendChild(file[0]));break;case"c":for(i in argv[1])functions.hop(argv[1],i)&&(file=$("<link/>",{type:"text/css",rel:"stylesheet",href:argv[1][i],id:i}),head.find("link#"+i).length?argv[2]&&head.find("link#"+i).replaceWith(file):head[0].appendChild(file[0]),file=null)}head=null;break;case 11:break;case 12:try{3===argc?phery.broadcast(argv[0],argv[1][0]):2===argc&&self.phery.publish(argv[0],argv[1][0])}catch(e){self.trigger([phery.log("invalid pub/sub operation")])}break;default:self.trigger([phery.log('invalid command "'+cmd.c+'" issued')])}},self.select=function(){if(special=selector.match(vars.special_match),null!==special&&(special=special[1]),special||"<"===selector.charAt(0)||selector.search(/^[0-9]+$/)===-1){"!"!==special&&"="!==special&&"+"!==special||(cmd=data[selector][0],self.process_parameters()),self.selector();for(var e in data[selector])if(functions.hop(data[selector],e)){if(data[selector][e]===cmd)continue;if(self.skip){self.skip=!1;continue}cmd=data[selector][e],self.process_parameters();try{if("function"!=typeof self.$current[cmd.c])throw'no function "'+cmd.c+'" found in object';self.set_selector(self.$current[cmd.c].apply(self.$current,cmd.a))}catch(e){self.trigger([phery.log(e)])}}}else cmd=data[selector],self.process_parameters(),self.command()},self.destroy=function(){self.stack=self.$current=self.$last=self.phery=data=cmd=null},force_current)self.set_selector(self.convert_special(data));else if($.isPlainObject(data))for(selector in data)if(functions.hop(data,selector)){if(self.skip){self.skip=!1;continue}self.select()}},functions.process_request=function(e,t){if(!this.phery("data","remote")&&!this.phery("data","view")&&!t)return void functions.trigger_phery_event(this,"after",[null]);var n=new functions.convertible(this,e);functions.trigger_phery_event(this,"after",[n.$current]),n.destroy(),n=null},functions.dot_notation_option=function(e,t,n){if(e.indexOf(".")!==-1){var r=e.split(".");if(r&&r[0]&&"undefined"!=typeof t[r[0]])return functions.dot_notation_option(r.slice(1).join("."),t[r[0]],n)}else if("undefined"!=typeof t[e])return"undefined"!=typeof n?(t[e].constructor===Array&&"string"==typeof n?t[e].push(n):t[e]=n,t):t[e];return null},options=$.extend(!0,{},vars.defaults,options),$window.on({load:function(){options.enable.autolock&&(vars.locked_config=!0),options.inline.enabled&&options.inline.once&&(vars.inline_load=!1)}}),phery.config=function(e,t){return"object"==typeof e&&e.constructor===Object?(refresh_changes(e),phery):"string"==typeof e&&t!==undefined?(refresh_changes(e,t),phery):"string"==typeof e&&t===undefined?e in options?options[e]:functions.dot_notation_option(e,options):0===arguments.length?$.extend(!0,{},options):phery},phery.lock_config=function(){return vars.locked_config=!0,phery},phery.reset_to_defaults=function(){return options=$.extend(!0,{},vars.defaults),_apply(options,!0),phery},phery.log=function(){var e=Array.prototype.slice.call(arguments);return e.length?(options.enable.log&&(options.enable.log_history&&_log.push(e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&("object"==typeof console.log?console.log(e):console.log.apply(console,e))),e.join("\n")):options.enable.log_history?_log:[]},phery.broadcast=function(e,t){var n,r,i;for(n=0,r=vars.subscribed.length;n<r;n++)i=vars.subscribed[n],i.topic===e&&i.pub(t);return phery},phery.subscribe=function(e,t,n,r){var i=phery.remote(e,n,r,!1);return i.phery("subscribe",t),i},phery.timer=function(e,t){var n=!1,r=null,i=t,a=function(){if(e.constructor===Array){var t=$.makeArray(e);phery.remotes(t).done(function(){n===!1&&(r=setTimeout(a,i))})}else{var o=functions.ajax_call.call(e);o&&o.always(function(){n===!1&&(r=setTimeout(a,i))})}};return t!==undefined&&a(),{start:function(e){return e!==undefined&&(n=!1,i=e,clearTimeout(r),a()),this},stop:function(){return n=!0,clearTimeout(r),this}}},phery.remote=function(e,t,n,r){if(!this)return!1;if(this===phery&&!e)return phery.log('first argument "function_name" on phery.remote() must be specified when calling directly'),!1;if(r!==!1&&(r=!0),this!==phery)return functions.ajax_call.call(this);var i=$("<a></a>"),a=[t],o=!1;if(i.phery("data","remote",e),r===!0&&(n!==undefined?"undefined"!=typeof n.temp?(i.phery("data","temp",!0),o=!0):"undefined"==typeof n.proxy&&"undefined"==typeof n.el&&(i.phery("data","temp",!0),o=!0):(i.phery("data","temp",!0),o=!0)),n!==undefined&&$.isPlainObject(n)){if("undefined"!=typeof n.proxy)if(n.proxy instanceof $)n.proxy=n.proxy;else if("string"===$.type(n.proxy)){var s=$(n.proxy);s.length?n.proxy=s:delete n.proxy}else delete n.proxy;"undefined"!=typeof n.el&&(n.el instanceof $&&a.push(n.el),delete n.el);for(var c in n)functions.hop(n,c)&&("target method type proxy cache".indexOf(c.toLowerCase())!==-1?i.phery("data",c,n[c]):i.attr(n))}return o===!1&&t&&i.phery("set_args",t),r?functions.ajax_call.apply(i,a):i},phery.json=function(e,t,n){var r=phery.remote(e,null,{temp:!0},!1);return r.on("phery:json",function(e,t){return n(t)}),t!==undefined&&null!==t?r.phery("remote",t):r.phery("remote"),r},phery.remotes=function(e){var t=$.Deferred(),n=[],r=0,i=function(){var a=e instanceof $?e.eq(r++):e.shift();if(a&&a.length){var o=e instanceof $?phery.remote.apply(a):phery.remote.apply(phery,a);o instanceof $.Deferred?(n.push(o),t.notifyWith(a,o),o.always(i)):i()}else t.resolve(n)};if("array"===$.type(e)&&e.length)for(var a=0;a<e.length;a++)"array"===$.type(e[a])?e[a].length>3&&(e[a]=e[a].slice(0,3)):e.splice(a,1);else if(!(e instanceof $))return t.resolve([]),t.promise();return i(),t.promise()},phery.on=function(e,t){if("object"==typeof e){if($.isPlainObject(e))for(var n in e)functions.hop(e,n)&&phery.on(n,e[n])}else"string"==typeof e&&"function"==typeof t&&e in vars._callbacks&&(debug(["phery.on",{event:e,callback:t}],"events"),callbacks.on(e+".phery",t));return phery},phery.off=function(e){return debug(["phery.off",{event:e}],"events"),callbacks.off(e+".phery"),phery},phery.load=function(e,t){if(options.inline.enabled){if(!vars.inline_load)return phery;t||(t=$("<a></a>"),t.phery("data","temp",!0)),"string"===$.type(e)&&t instanceof $&&functions.process_request.call(t,$.parseJSON(e),!0)}return phery},vars._containers={},functions.excluded_url=function(e,t){if("#"===e)return!0;for(var n=0;n<t.length;n++)switch(typeof t[n]){case"string":if(e.indexOf(t[n])!==-1)return!0;break;case"object":if(e.search(t[n])!==-1)return!0;break;case"function":if(t[n].call(null,e)===!0)return!0}return!1},functions.phery_view=function(e){this.container=e,this.data=$.extend({},this.container.phery("data","view")),this.is_excluded_url=function(e){var t=this.container.phery("data","view").exclude||!1;return!(!t||!e)&&functions.excluded_url(e,t)},this.navigate_to=function(e,t,n){e&&this.container.phery("data","target",e);var r;return n!==undefined&&this.container.phery("data","passdata",n),r=t!==undefined&&null!==t?functions.ajax_call.call(this.container,t):functions.ajax_call.call(this.container)}},phery.view=function(e){if("string"==typeof e)return"undefined"!=typeof vars._containers[e]?vars._containers[e]:phery;if("object"==typeof e&&$.isEmptyObject(e))return debug(["phery.view needs config"],"config"),phery;if(!$.isPlainObject(e))return debug(["phery.view needs a plain object"],"config"),phery;var t,n,r,i,a=function(e){var t=$(this),n=t.attr("href");return!(2!==e.which&&!e.metaKey)||(!!e.data.is_excluded_url(n)||(debug(["phery.view link clicked, loading content",e.data.container,t.attr("href")],"events"),e.data.navigate_to(t.attr("href")),e.stopPropagation(),e.preventDefault(),!1))};$document.off("click.view");for(t in e)if(functions.hop(e,t))if(r=$(t),1===r.length){if(n=t.replace(/[#\.\s>:,~=\+\-_\*]/g,""),e[t]===!1){r.off(".pheryview"),$document.off("click.view."+n),debug(["phery.view uninstalled and events unbound",r],"config");continue}i="string"==typeof e[t].selector&&e[t].selector.search(/(^|\s)a($|\s|\.)/i)!==-1?t+" "+e[t].selector:'a[href]:not(.no-phery,[target],[data-phery-remote],[href*=":"],[rel~="nofollow"])',i=i+',a[href][rel="'+t+'"]';for(var o in e[t])functions.hop(e[t],o)&&"string"==typeof o&&"undefined"!=typeof vars._callbacks[o]&&(r.on("phery:"+o+".pheryview",e[t][o]),delete e[t][o]);r.phery("data","view",$.extend(!0,{},e[t],{selector:i})),vars._containers[t]=new functions.phery_view(r),$document.on("click.view."+n,i,vars._containers[t],a),debug(["phery.view installed",r],"config")}else debug(["phery.view container",r,"isnt unique or does not exist"],"config");return phery},functions.reset=function(){return this.each(function(){$(this).is("form")&&this.reset()})},functions.phery=function(e){var t=this,n=function(){return{publish:function(e,n){return t.each(function(){var t,r=$(this);t=functions.is_subscribed(e,!1,r),t!==!1&&t.pub(n)})},subscribe:function(e,n){return t.each(function(){var t,r,i=$(this);for(t in e)functions.hop(e,t)&&(r=functions.is_subscribed(t,!0,i),r!==!1&&(n===!0?r.unsub(e[t]):r.sub(e[t])))})},exception:function(e,n){return t.each(function(){var t=$(this);functions.trigger_phery_event(t,"exception",[e,n])})},data:function(e,n){var r;if(n!==undefined)return t.data("phery-"+e,n),t;if(e!==undefined){if($.isPlainObject(e)){for(r in e)functions.hop(e,r)&&t.data("phery-"+r,e[r]);return t}return t.data("phery-"+e)}n=$.extend({},t.data());for(r in n)functions.hop(n,r)&&!/^phery/.test(r)&&delete n[r];return n},proxy:function(e){return t.each(function(){var t=$(this);if(e instanceof $)e.length&&t.phery("data","proxy",e);else if("string"===$.type(e))try{e=$(e),e.length&&t.phery("data","proxy",e)}catch(e){}else $.removeData(this,"phery-proxy")})},remote:function(e){return t.each(function(){var t=$(this);t.is(":phery-remote")&&(t.is("form")?functions.form_submit(t):functions.ajax_call.call(t,e))})},append_args:function(){var e=Array.prototype.slice.call(arguments);return e.length&&t.each(function(){var t=$(this);functions.append_args.apply(t,[e])}),n},set_args:function(e){return t.each(function(){var t=$(this);functions.set_args.call(t,[e])}),n},get_args:function(){return n.data("args")},remove:function(){t.each(function(){var e=$(this);e.phery("data","temp",!0),clean_up(e)})},make:function(e,n){return"string"===$.type(e)?t.each(function(){var t=$(this);t.attr("data-phery-remote",e).phery("data",{remote:e,inprogress:!1}),n!==undefined&&functions.set_args.call(t,[n])}):t},inprogress:function(){return!!n.data("inprogress")},unmake:function(e){return t.each(function(){var t=$(this);e&&t.off(".phery"),$.removeData(this,"remote"),t.removeAttr("data-phery-remote").removeAttr("data-phery-args").removeAttr("data-phery-confirm")})}}}();if(e&&$.isPlainObject(e)){var r;for(var i in e)functions.hop(e,i)&&i in n&&(r=n[i].apply(t,e[i]));return r}return e&&e in n?n[e].apply(t,Array.prototype.slice.call(arguments,1)):n},functions.serializeForm=function(e){e=$.extend({disabled:!1,all:!1,empty:!0,files_apart:!1},e||{});var t=$(this),n=e.files_apart?{inputs:{},files:{}}:{},r=function(){var e=$(this);return!vars.has_file&&e.is('input[type="file"]')?null:functions.form_element(e)},i=t.is("form")?t.find("input,textarea,select").filter(function(){var t=!0;return e.disabled||(t=!this.disabled),t&&""!==$.trim(this.name)}).map(r).get():t.is("select,textarea,input")?[functions.form_element(t)]:[];if(i.length){var a,o,s,c,l,f,u,p,d;for(a=0;a<i.length;a++){if(s=i[a].name,o=i[a].value,p=i[a].type,e.all)null===o&&(o="");else if(null===o)continue;if((""!==o||e.empty)&&("file"!==p||0!==o.length)&&s){for(c=s.split(/\[/),l=c.length,u=1;u<l;u++)c[u]=c[u].replace(/\]/g,"");for(d=[],u=0;u<l;u++)(c[u]||u<l-1)&&d.push(c[u].replace(/['"]+/g,""));""===c[l-1]?(f=functions.assign_object(e.files_apart?"file"===p?n.files:n.inputs:n,d,[],!0,!1,!1),"array"===$.type(o)?f[0][f[1]].concat(o):f[0][f[1]].push(o)):functions.assign_object(e.files_apart?"file"===p?n.files:n.inputs:n,d,o,!0,!1,!1,"file"===p)}}}return n},$.extend($.expr[":"],{"phery-remote":function(e){return"string"==typeof(e instanceof $?e.phery("data","remote"):$(e).phery("data","remote"))},"phery-confirm":function(e){return"string"==typeof(e instanceof $?e.phery("data","confirm"):$(e).phery("data","confirm"))},"phery-view":function(e){return!!(e instanceof $?e.phery("data","view"):$(e).phery("data","view"))}}),$.fn.reset=functions.reset,$.fn.phery=functions.phery,
$.fn.serializeForm=functions.serializeForm,$.inArray(window.location.host,["127.0.0.1","::1","localhost"])>-1&&(phery.vars=vars,phery.functions=functions),"vars"in phery||"functions"in phery||"function"==typeof Object.freeze&&Object.freeze(phery),_apply(options,!0),phery});