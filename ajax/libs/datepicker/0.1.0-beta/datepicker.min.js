/*! datepicker v0.1.0 | (c) 2014 Fengyuan Chen */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery)}(function(a){"use strict";var b=a(window),c=a(document),d=function(b,c){c=a.isPlainObject(c)?c:{},this.$element=a(b),this.defaults=a.extend({},d.defaults,this.$element.data(),c),this.init(),console.log(this)};d.prototype={construstor:d,init:function(){var b=this.defaults.trigger;this.$trigger=b?a(b):this.$element,this.$picker=a(this.defaults.template),this.$years=this.$picker.find("*[data-type='years picker']"),this.$months=this.$picker.find("*[data-type='months picker']"),this.$days=this.$picker.find("*[data-type='days picker']"),this.$picker.appendTo("body"),this.place(),this.hide(),this.format=d.fn.parseFormat(this.defaults.dateFormat),this.fillWeek(),this.enable()},enable:function(){this.enabled||(this.$element.is("input")&&(this.$element.on("keyup",a.proxy(this.update,this)),this.defaults.trigger||this.$element.on("focus",a.proxy(this.show,this))),this.$trigger.on("click",a.proxy(this.show,this)),this.$picker.on({click:a.proxy(this.click,this),mousedown:a.proxy(this.mousedown,this)}),this.update(),this.enabled=!0)},disable:function(){this.enabled&&(this.$element.is("input")&&(this.$element.off("keyup",this.update),this.defaults.trigger||this.$element.off("focus",this.show)),this.$trigger.off("click",this.show),this.$picker.off({click:this.click,mousedown:this.mousedown}),this.hide(),this.enabled=!1)},showView:function(a){var b=this.format;if(b.year||b.month||b.day)switch(a){case 2:this.$months.hide(),this.$days.hide(),b.year?(this.fillYears(),this.$years.show()):this.showView(0);break;case 1:this.$years.hide(),this.$days.hide(),b.month?(this.fillMonths(),this.$months.show()):this.showView(2);break;default:this.$years.hide(),this.$months.hide(),b.day?(this.fillDays(),this.$days.show()):this.showView(1)}},hideView:function(){this.defaults.autoClose&&this.hide()},place:function(){var a=this.$trigger.offset(),b=this.$trigger.outerHeight();this.$picker.css({top:a.top+b,left:a.left})},show:function(){this.enabled&&(this.$picker.show(),b.on("resize",a.proxy(this.place,this)),c.on("mousedown",a.proxy(this.hide,this)),this.place(),this.showView(this.defaults.viewStart))},hide:function(){this.$picker.hide(),b.off("resize",this.place),c.off("mousedown",this.hide)},mousedown:function(a){a.stopPropagation(),a.preventDefault()},update:function(){var a=this.$element.is("input")?this.$element.prop("value"):this.$element.text();this.date=d.fn.parseDate(a,this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate(),0,0,0,0),this.fillAll()},output:function(){var a=d.fn.formatDate(this.date,this.format);this.$element.is("input")?this.$element.prop("value",a):this.$element.text(a)},template:function(b){var c={text:"",type:"",selected:!1,disabled:!1};return a.extend(c,b),["<"+this.defaults.itemTag+" ",c.selected?'class="'+this.defaults.activeClass+'"':c.disabled?'class="'+this.defaults.disableClass+'"':"",c.type?' data-type="'+c.type+'"':"",">",c.text,"</"+this.defaults.itemTag+">"].join("")},fillAll:function(){this.fillYears(),this.fillMonths(),this.fillDays()},fillYears:function(){var a,b,c="",d=[],e=this.defaults.yearSuffix||"",f=this.date.getFullYear(),g=this.viewDate.getFullYear();for(c=g-5+e+" - "+(g+6)+e,b=-5;7>b;b++)a=g+b===f,d.push(this.template({text:g+b,type:a?"year active":"year",selected:a,disabled:-5===b||6===b}));this.$picker.find("*[data-type='years current']").html(c),this.$picker.find("*[data-type='years']").empty().html(d.join(""))},fillMonths:function(){var a,b,c="",d=[],e=this.defaults.monthsShort,f=this.date.getFullYear(),g=this.date.getMonth(),h=this.viewDate.getFullYear();for(c=h.toString()+this.defaults.yearSuffix||"",b=0;12>b;b++)a=h===f&&b===g,d.push(this.template({text:e[b],type:a?"month active":"month",selected:a}));this.$picker.find("*[data-type='year current']").html(c),this.$picker.find("*[data-type='months']").empty().html(d.join(""))},fillWeek:function(){var b,c=[],d=this.defaults.daysMin,e=parseInt(this.defaults.weekStart,10)%7;for(d=a.merge(d.slice(e),d.slice(0,e)),b=0;7>b;b++)c.push(this.template({text:d[b]}));this.$picker.find("*[data-type='week']").empty().html(c.join(""))},fillDays:function(){var b,c,e,f,g,h,i="",j=[],k=[],l=[],m=[],n=this.defaults.monthsShort,o=this.defaults.yearSuffix||"",p=this.date.getFullYear(),q=this.date.getMonth(),r=this.date.getDate(),s=this.viewDate.getFullYear(),t=this.viewDate.getMonth(),u=parseInt(this.defaults.weekStart,10)%7;for(i=this.defaults.showMonthAfterYear?s+o+" "+n[t]:n[t]+" "+s+o,e=0===t?d.fn.getDaysInMonth(s-1,11):d.fn.getDaysInMonth(s,t-1),g=1;e>=g;g++)k.push(this.template({text:g,type:"day prev",disabled:!0}));for(f=new Date(s,t,1,0,0,0,0),h=(7+(f.getDay()-u))%7,h=h>0?h:7,k=k.slice(e-h),e=11===t?d.fn.getDaysInMonth(s+1,0):d.fn.getDaysInMonth(s,t+1),g=1;e>=g;g++)m.push(this.template({text:g,type:"day next",disabled:!0}));for(e=d.fn.getDaysInMonth(s,t),f=new Date(s,t,e,0,0,0,0),h=(7-(f.getDay()+1-u))%7,h=h>=42-(k.length+e)?h:h+7,m=m.slice(0,h),g=1;e>=g;g++)b=s===p&&t===q&&g===r,c=this.defaults.isDisabled(new Date(s,t,g)),l.push(this.template({text:g,type:c?"day disable":b?"day active":"day",selected:b,disabled:c}));a.merge(j,k),a.merge(j,l),a.merge(j,m),this.$picker.find("*[data-type='month current']").html(i),this.$picker.find("*[data-type='days']").empty().html(j.join(""))},click:function(b){var c,d,e=a(b.target),f=this.viewDate.getFullYear(),g=this.viewDate.getMonth(),h=this.viewDate.getDate(),i=/^\d{2,4}$/,j=!1;if(console.log(b.target),b.stopPropagation(),b.preventDefault(),0!==e.length)switch(d=e.data().type){case"years prev":case"years next":f="years prev"===d?f-10:f+10,c=e.text(),j=i.test(c),j&&(f=parseInt(c,10),this.date=new Date(f,g,Math.min(h,28),0,0,0,0)),this.viewDate=new Date(f,g,Math.min(h,28),0,0,0,0),this.fillYears(),j&&(this.showView(1),this.output());break;case"year prev":case"year next":f="year prev"===d?f-1:f+1,this.viewDate=new Date(f,g,Math.min(h,28),0,0,0,0),this.fillMonths();break;case"year current":this.format.year&&this.showView(2);break;case"year active":this.format.month?this.showView(1):this.hideView();break;case"year":f=parseInt(e.text(),10),this.date=new Date(f,g,Math.min(h,28),0,0,0,0),this.viewDate=new Date(f,g,Math.min(h,28),0,0,0,0),this.format.month?this.showView(1):this.hideView(),this.output();break;case"month prev":case"month next":g="month prev"===d?g-1:"month next"===d?g+1:g,this.viewDate=new Date(f,g,Math.min(h,28),0,0,0,0),this.fillDays();break;case"month current":this.format.month&&this.showView(1);break;case"month active":this.format.day?this.showView(0):this.hideView();break;case"month":g=e.parent().children().index(e),this.date=new Date(f,g,Math.min(h,28),0,0,0,0),this.viewDate=new Date(f,g,Math.min(h,28),0,0,0,0),this.format.day?this.showView(0):this.hideView(),this.output();break;case"day prev":case"day next":case"day":g="day prev"===d?g-1:"day next"===d?g+1:g,h=parseInt(e.text(),10),this.date=new Date(f,g,h,0,0,0,0),this.viewDate=new Date(f,g,h,0,0,0,0),this.fillDays(),"day"===d&&this.hideView(),this.output();break;case"day disable":case"day active":this.hideView()}}},d.fn={isLeapYear:function(a){return a%4===0&&a%100!==0||a%400===0},getDaysInMonth:function(a,b){return[31,this.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},parseFormat:function(a){var b,c,d=a.match(/[.\/\-\s].*?/),e=a.split(/\W+/);if(!d||!e||0===e.length)throw new Error("Invalid date format.");for(a={separator:d[0],parts:e},c=0,b=e.length;b>c;c++)switch(e[c]){case"dd":case"d":a.day=!0;break;case"mm":case"m":a.month=!0;break;case"yyyy":case"yy":a.year=!0}return a},parseDate:function(a,b){var c,d,e,f,g,h,i;if(c="string"==typeof a?a.split(b.separator):[],d=b.parts.length,a=new Date,e=a.getFullYear(),f=a.getDate(),g=a.getMonth(),c.length===d)for(i=0;d>i;i++)switch(h=parseInt(c[i],10)||1,b.parts[i]){case"dd":case"d":f=h;break;case"mm":case"m":g=h-1;break;case"yy":e=2e3+h;break;case"yyyy":e=h}return new Date(e,g,f,0,0,0,0)},formatDate:function(a,b){var c,d={d:a.getDate(),m:a.getMonth()+1,yy:a.getFullYear().toString().substring(2),yyyy:a.getFullYear()},e=[],f=b.parts.length;for(d.dd=(d.d<10?"0":"")+d.d,d.mm=(d.m<10?"0":"")+d.m,c=0;f>c;c++)e.push(d[b.parts[c]]);return e.join(b.separator)}},d.defaults={autoClose:!1,dateFormat:"mm/dd/yyyy",viewStart:0,weekStart:0,showMonthAfterYear:!1,yearSuffix:"",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],itemTag:"li",activeClass:"datepicker-selected",disableClass:"datepicker-disabled",isDisabled:function(){return!1},template:['<div class="datepicker-container" data-type="datepicker">','<div class="datepicker-arrow"></div>','<div class="datepicker-content">','<div class="content-years" data-type="years picker">','<ul class="datepicker-title">','<li class="datepicker-prev" data-type="years prev">&lsaquo;</li>','<li class="col-5" data-type="years current"></li>','<li class="datepicker-next" data-type="years next">&rsaquo;</li>',"</ul>",'<ul class="datepicker-years" data-type="years"></ul>',"</div>",'<div class="content-months" data-type="months picker">','<ul class="datepicker-title">','<li class="datepicker-prev" data-type="year prev">&lsaquo;</li>','<li class="col-5" data-type="year current"></li>','<li class="datepicker-next" data-type="year next">&rsaquo;</li>',"</ul>",'<ul class="datepicker-months" data-type="months"></ul>',"</div>",'<div class="content-days" data-type="days picker">','<ul class="datepicker-title">','<li class="datepicker-prev" data-type="month prev">&lsaquo;</li>','<li class="col-5" data-type="month current"></li>','<li class="datepicker-next" data-type="month next">&rsaquo;</li>',"</ul>",'<ul class="datepicker-week" data-type="week"></ul>','<ul class="datepicker-days" data-type="days"></ul>',"</div>","</div>","</div>"].join("")},d.setDefaults=function(a){var b;for(b in a)a.hasOwnProperty(b)&&"undefined"!=typeof d.defaults[b]&&(d.defaults[b]=a[b])},a.fn.datepicker=function(b){return this.each(function(){var c=a(this),e=c.data("datepicker");e||(e=new d(this,b),c.data("datepicker",e)),"string"==typeof b&&a.isFunction(e[b])&&e[b]()})},a.fn.datepicker.Constructor=d,a.fn.datepicker.setDefaults=function(a){d.setDefaults(a)},a(function(){a("*[datepicker").datepicker()})});