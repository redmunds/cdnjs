{"version":3,"file":"ractive-legacy.runtime.min.js","sources":["ractive-legacy.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.9.0-edge\n\tFri Nov 04 2016 00:49:58 GMT-0400 (EDT) - commit 908d1cada802ea17ba785c0a8221d9f91c635805\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  ((function() { var current = global.Ractive; var next = factory(); next.noConflict = function() { global.Ractive = current; return next; }; return global.Ractive = next; })());\n}(this, function () { 'use strict';\n\n  var defaults = {\n  \t// render placement:\n  \tel:                     void 0,\n  \tappend:\t\t\t\t    false,\n\n  \t// template:\n  \ttemplate:               null,\n\n  \t// parse:\n  \tdelimiters:             [ '{{', '}}' ],\n  \ttripleDelimiters:       [ '{{{', '}}}' ],\n  \tstaticDelimiters:       [ '[[', ']]' ],\n  \tstaticTripleDelimiters: [ '[[[', ']]]' ],\n  \tcsp: \t\t\t\t\ttrue,\n  \tinterpolate:            false,\n  \tpreserveWhitespace:     false,\n  \tsanitize:               false,\n  \tstripComments:          true,\n  \tcontextLines:           0,\n\n  \t// data & binding:\n  \tdata:                   {},\n  \tcomputed:               {},\n  \tsyncComputedChildren:   false,\n  \tmagic:                  false,\n  \tmodifyArrays:           false,\n  \tadapt:                  [],\n  \tisolated:               false,\n  \ttwoway:                 true,\n  \tlazy:                   false,\n\n  \t// transitions:\n  \tnoIntro:                false,\n  \ttransitionsEnabled:     true,\n  \tcomplete:               void 0,\n\n  \t// css:\n  \tcss:                    null,\n  \tnoCssTransform:         false\n  };\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n\n  var easing = {\n  \tlinear: function ( pos ) { return pos; },\n  \teaseIn: function ( pos ) { return Math.pow( pos, 3 ); },\n  \teaseOut: function ( pos ) { return ( Math.pow( ( pos - 1 ), 3 ) + 1 ); },\n  \teaseInOut: function ( pos ) {\n  \t\tif ( ( pos /= 0.5 ) < 1 ) { return ( 0.5 * Math.pow( pos, 3 ) ); }\n  \t\treturn ( 0.5 * ( Math.pow( ( pos - 2 ), 3 ) + 2 ) );\n  \t}\n  };\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = ( typeof navigator !== 'undefined' && /jsDom/.test( navigator.appName ) );\n  var hasConsole = ( typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function' );\n\n  var magicSupported;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch ( e ) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ?\n  \tdoc.implementation.hasFeature( 'http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1' ) :\n  \tfalse;\n\n  var vendors = [ 'o', 'ms', 'moz', 'webkit' ];\n\n  function noop () {}\n\n  var exportedShims;\n\n  if ( !win ) {\n  \texportedShims = null;\n  } else {\n  \texportedShims = {};\n\n  \t// Shims for older browsers\n\n  \tif ( !Date.now ) {\n  \t\tDate.now = function () { return +new Date(); };\n  \t}\n\n  \tif ( !String.prototype.trim ) {\n  \t\tString.prototype.trim = function () {\n  \t\t\treturn this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  \t\t};\n  \t}\n\n  \t// Polyfill for Object.create\n  \tif ( !Object.create ) {\n  \t\tObject.create = (function () {\n  \t\t\tvar Temp = function () {};\n  \t\t\treturn function ( prototype, properties ) {\n  \t\t\t\tif ( typeof prototype !== 'object' ) {\n  \t\t\t\t\tthrow new TypeError( 'Prototype must be an object' );\n  \t\t\t\t}\n  \t\t\t\tTemp.prototype = prototype;\n  \t\t\t\tvar result = new Temp();\n  \t\t\t\tdefineProperties( result, properties );\n  \t\t\t\tTemp.prototype = null;\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t})();\n  \t}\n\n  \t// Polyfill Object.defineProperty\n  \tif ( !Object.defineProperty ) {\n  \t\tObject.defineProperty = defineProperty;\n  \t}\n\n  \tif ( !Object.freeze ) {\n  \t\tObject.freeze = function () { 'LOL'; };\n  \t}\n\n  \t// Polyfill for Object.keys\n  \t// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys\n  \tif ( !Object.keys ) {\n  \t\tObject.keys = (function () {\n  \t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n  \t\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\n  \t\t\t\tdontEnums = [\n  \t\t\t\t\t'toString',\n  \t\t\t\t\t'toLocaleString',\n  \t\t\t\t\t'valueOf',\n  \t\t\t\t\t'hasOwnProperty',\n  \t\t\t\t\t'isPrototypeOf',\n  \t\t\t\t\t'propertyIsEnumerable',\n  \t\t\t\t\t'constructor'\n  \t\t\t\t],\n  \t\t\t\tdontEnumsLength = dontEnums.length;\n\n  \t\t\treturn function ( obj ) {\n  \t\t\t\tif ( typeof obj !== 'object' && typeof obj !== 'function' || obj === null ) {\n  \t\t\t\t\tthrow new TypeError( 'Object.keys called on non-object' );\n  \t\t\t\t}\n\n  \t\t\t\tvar result = [];\n\n  \t\t\t\tfor ( var prop in obj ) {\n  \t\t\t\t\tif ( hasOwnProperty.call( obj, prop ) ){\n  \t\t\t\t\t\tresult.push( prop );\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif ( hasDontEnumBug ) {\n  \t\t\t\t\tfor ( var i=0; i < dontEnumsLength; i++ ) {\n  \t\t\t\t\t\tif ( hasOwnProperty.call( obj, dontEnums[i] ) ){\n  \t\t\t\t\t\t\tresult.push( dontEnums[i] );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t}());\n  \t}\n\n  \t// TODO: use defineProperty to make these non-enumerable\n\n  \t// Array extras\n  \tif ( !Array.prototype.indexOf ) {\n  \t\tArray.prototype.indexOf = function ( needle, i ) {\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar len;\n\n  \t\t\tif ( i === undefined ) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tif ( i < 0 ) {\n  \t\t\t\ti+= this.length;\n  \t\t\t}\n\n  \t\t\tif ( i < 0 ) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tfor ( len = this$1.length; i<len; i++ ) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) && this$1[i] === needle ) {\n  \t\t\t\t\treturn i;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn -1;\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.forEach ) {\n  \t\tArray.prototype.forEach = function ( callback, context ) {\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar i, len;\n\n  \t\t\tfor ( i=0, len=this$1.length; i<len; i+=1 ) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) ) {\n  \t\t\t\t\tcallback.call( context, this$1[i], i, this$1 );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.map ) {\n  \t\tArray.prototype.map = function ( mapper, context ) {\n  \t\t\tvar array = this, i, len, mapped = [], isActuallyString;\n\n  \t\t\t// incredibly, if you do something like\n  \t\t\t// Array.prototype.map.call( someString, iterator )\n  \t\t\t// then `this` will become an instance of String in IE8.\n  \t\t\t// And in IE8, you then can't do string[i]. Facepalm.\n  \t\t\tif ( array instanceof String ) {\n  \t\t\t\tarray = array.toString();\n  \t\t\t\tisActuallyString = true;\n  \t\t\t}\n\n  \t\t\tfor ( i=0, len=array.length; i<len; i+=1 ) {\n  \t\t\t\tif ( array.hasOwnProperty( i ) || isActuallyString ) {\n  \t\t\t\t\tmapped[i] = mapper.call( context, array[i], i, array );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn mapped;\n  \t\t};\n  \t}\n\n  \tif ( typeof Array.prototype.reduce !== 'function' ) {\n  \t\tArray.prototype.reduce = function(callback, opt_initialValue){\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar i, value, len, valueIsSet;\n\n  \t\t\tif ('function' !== typeof callback) {\n  \t\t\t\tthrow new TypeError(callback + ' is not a function');\n  \t\t\t}\n\n  \t\t\tlen = this.length;\n  \t\t\tvalueIsSet = false;\n\n  \t\t\tif ( arguments.length > 1 ) {\n  \t\t\t\tvalue = opt_initialValue;\n  \t\t\t\tvalueIsSet = true;\n  \t\t\t}\n\n  \t\t\tfor ( i = 0; i < len; i += 1) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) ) {\n  \t\t\t\t\tif ( valueIsSet ) {\n  \t\t\t\t\t\tvalue = callback(value, this$1[i], i, this$1);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvalue = this$1[i];\n  \t\t\t\t\tvalueIsSet = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( !valueIsSet ) {\n  \t\t\t\tthrow new TypeError( 'Reduce of empty array with no initial value' );\n  \t\t\t}\n\n  \t\t\treturn value;\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.filter ) {\n  \t\tArray.prototype.filter = function ( filter, context ) {\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar i, len, filtered = [];\n\n  \t\t\tfor ( i=0, len=this$1.length; i<len; i+=1 ) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) && filter.call( context, this$1[i], i, this$1 ) ) {\n  \t\t\t\t\tfiltered[ filtered.length ] = this$1[i];\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn filtered;\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.every ) {\n  \t\tArray.prototype.every = function ( iterator, context ) {\n  \t\t\tvar t, len, i;\n\n  \t\t\tif ( this == null ) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tt = Object( this );\n  \t\t\tlen = t.length >>> 0;\n\n  \t\t\tif ( typeof iterator !== 'function' ) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\t\tif ( i in t && !iterator.call( context, t[i], i, t) ) {\n  \t\t\t\t\treturn false;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn true;\n  \t\t};\n  \t}\n\n  \tif ( typeof Function.prototype.bind !== 'function' ) {\n  \t\tFunction.prototype.bind = function ( context ) {\n  \t\t\tvar args, fn, Empty, bound, slice = [].slice;\n\n  \t\t\tif ( typeof this !== 'function' ) {\n  \t\t\t\tthrow new TypeError( 'Function.prototype.bind called on non-function' );\n  \t\t\t}\n\n  \t\t\targs = slice.call( arguments, 1 );\n  \t\t\tfn = this;\n  \t\t\tEmpty = function () {};\n\n  \t\t\tbound = function () {\n  \t\t\t\tvar ctx = this instanceof Empty && context ? this : context;\n  \t\t\t\treturn fn.apply( ctx, args.concat( slice.call( arguments ) ) );\n  \t\t\t};\n\n  \t\t\tEmpty.prototype = this.prototype;\n  \t\t\tbound.prototype = new Empty();\n\n  \t\t\treturn bound;\n  \t\t};\n  \t}\n\n  \t// https://gist.github.com/Rich-Harris/6010282 via https://gist.github.com/jonathantneal/2869388\n  \t// addEventListener polyfill IE6+\n  \tif ( !win.addEventListener ) {\n  \t\t((function(win, doc) {\n  \t\t\tvar Event, addEventListener, removeEventListener, head, style, origCreateElement;\n\n  \t\t\t// because sometimes inquiring minds want to know\n  \t\t\twin.appearsToBeIELessEqual8 = true;\n\n  \t\t\tEvent = function ( e, element ) {\n  \t\t\t\tvar property, instance = this;\n\n  \t\t\t\tfor ( property in e ) {\n  \t\t\t\t\tinstance[ property ] = e[ property ];\n  \t\t\t\t}\n\n  \t\t\t\tinstance.currentTarget =  element;\n  \t\t\t\tinstance.target = e.srcElement || element;\n  \t\t\t\tinstance.timeStamp = +new Date();\n\n  \t\t\t\tinstance.preventDefault = function () {\n  \t\t\t\t\te.returnValue = false;\n  \t\t\t\t};\n\n  \t\t\t\tinstance.stopPropagation = function () {\n  \t\t\t\t\te.cancelBubble = true;\n  \t\t\t\t};\n  \t\t\t};\n\n  \t\t\taddEventListener = function ( type, listener ) {\n  \t\t\t\tvar element = this, listeners, i;\n\n  \t\t\t\tlisteners = element.listeners || ( element.listeners = [] );\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\tlisteners[i] = [ listener, function (e) {\n  \t\t\t\t\tlistener.call( element, new Event( e, element ) );\n  \t\t\t\t}];\n\n  \t\t\t\telement.attachEvent( 'on' + type, listeners[i][1] );\n  \t\t\t};\n\n  \t\t\tremoveEventListener = function ( type, listener ) {\n  \t\t\t\tvar element = this, listeners, i;\n\n  \t\t\t\tif ( !element.listeners ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tlisteners = element.listeners;\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tif (listeners[i][0] === listener) {\n  \t\t\t\t\t\telement.detachEvent( 'on' + type, listeners[i][1] );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\twin.addEventListener = doc.addEventListener = addEventListener;\n  \t\t\twin.removeEventListener = doc.removeEventListener = removeEventListener;\n\n  \t\t\tif ( 'Element' in win ) {\n  \t\t\t\twin.Element.prototype.addEventListener = addEventListener;\n  \t\t\t\twin.Element.prototype.removeEventListener = removeEventListener;\n  \t\t\t} else {\n  \t\t\t\t// First, intercept any calls to document.createElement - this is necessary\n  \t\t\t\t// because the CSS hack (see below) doesn't come into play until after a\n  \t\t\t\t// node is added to the DOM, which is too late for a lot of Ractive setup work\n  \t\t\t\torigCreateElement = doc.createElement;\n\n  \t\t\t\tdoc.createElement = function ( tagName ) {\n  \t\t\t\t\tvar el = origCreateElement( tagName );\n  \t\t\t\t\tel.addEventListener = addEventListener;\n  \t\t\t\t\tel.removeEventListener = removeEventListener;\n  \t\t\t\t\treturn el;\n  \t\t\t\t};\n\n  \t\t\t\t// Then, mop up any additional elements that weren't created via\n  \t\t\t\t// document.createElement (i.e. with innerHTML).\n  \t\t\t\thead = doc.getElementsByTagName('head')[0];\n  \t\t\t\tstyle = doc.createElement('style');\n\n  \t\t\t\thead.insertBefore( style, head.firstChild );\n\n  \t\t\t\t//style.styleSheet.cssText = '*{-ms-event-prototype:expression(!this.addEventListener&&(this.addEventListener=addEventListener)&&(this.removeEventListener=removeEventListener))}';\n  \t\t\t}\n  \t\t})( win, doc ));\n  \t}\n\n  \t// The getComputedStyle polyfill interacts badly with jQuery, so we don't attach\n  \t// it to window. Instead, we export it for other modules to use as needed\n\n  \t// https://github.com/jonathantneal/Polyfills-for-IE8/blob/master/getComputedStyle.js\n  \tif ( !win.getComputedStyle ) {\n  \t\texportedShims.getComputedStyle = (function () {\n  \t\t\tvar borderSizes = {};\n\n  \t\t\tfunction getPixelSize ( element, style, property, fontSize ) {\n  \t\t\t\tvar sizeWithSuffix = style[property];\n  \t\t\t\tvar size = parseFloat(sizeWithSuffix);\n  \t\t\t\tvar suffix = sizeWithSuffix.split(/\\d/)[0];\n\n  \t\t\t\tif ( isNaN( size ) ) {\n  \t\t\t\t\tif ( /^thin|medium|thick$/.test( sizeWithSuffix ) ) {\n  \t\t\t\t\t\tsize = getBorderPixelSize( sizeWithSuffix );\n  \t\t\t\t\t\tsuffix = '';\n  \t\t\t\t\t}\n\n  \t\t\t\t\telse {\n  \t\t\t\t\t\t// TODO...\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tfontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;\n  \t\t\t\tvar rootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;\n\n  \t\t\t\treturn (suffix == 'em') ? size * fontSize : (suffix == 'in') ? size * 96 : (suffix == 'pt') ? size * 96 / 72 : (suffix == '%') ? size / 100 * rootSize : size;\n  \t\t\t}\n\n  \t\t\tfunction getBorderPixelSize ( size ) {\n  \t\t\t\tvar div, bcr;\n\n  \t\t\t\t// `thin`, `medium` and `thick` vary between browsers. (Don't ever use them.)\n  \t\t\t\tif ( !borderSizes[ size ] ) {\n  \t\t\t\t\tdiv = doc.createElement( 'div' );\n  \t\t\t\t\tdiv.style.display = 'block';\n  \t\t\t\t\tdiv.style.position = 'fixed';\n  \t\t\t\t\tdiv.style.width = div.style.height = '0';\n  \t\t\t\t\tdiv.style.borderRight = size + ' solid black';\n\n  \t\t\t\t\tdoc.getElementsByTagName( 'body' )[0].appendChild( div );\n  \t\t\t\t\tbcr = div.getBoundingClientRect();\n\n  \t\t\t\t\tborderSizes[ size ] = bcr.right - bcr.left;\n  \t\t\t\t}\n\n  \t\t\t\treturn borderSizes[ size ];\n  \t\t\t}\n\n  \t\t\tfunction setShortStyleProperty(style, property) {\n  \t\t\t\tvar borderSuffix = property == 'border' ? 'Width' : '';\n  \t\t\t\tvar t = \"\" + property + \"Top\" + borderSuffix;\n  \t\t\t\tvar r = \"\" + property + \"Right\" + borderSuffix;\n  \t\t\t\tvar b = \"\" + property + \"Bottom\" + borderSuffix;\n  \t\t\t\tvar l = \"\" + property + \"Left\" + borderSuffix;\n\n  \t\t\t\tstyle[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]]\n  \t\t\t\t: style[t] == style[b] && style[l] == style[r] ? [style[t], style[r]]\n  \t\t\t\t: style[l] == style[r] ? [style[t], style[r], style[b]]\n  \t\t\t\t: [style[t], style[r], style[b], style[l]]).join(' ');\n  \t\t\t}\n\n  \t\t\tvar normalProps = {\n  \t\t\t\tfontWeight: 400,\n  \t\t\t\tlineHeight: 1.2, // actually varies depending on font-family, but is generally close enough...\n  \t\t\t\tletterSpacing: 0\n  \t\t\t};\n\n  \t\t\tfunction CSSStyleDeclaration(element) {\n  \t\t\t\tvar currentStyle, style, fontSize, property;\n\n  \t\t\t\tcurrentStyle = element.currentStyle;\n  \t\t\t\tstyle = this;\n  \t\t\t\tfontSize = getPixelSize(element, currentStyle, 'fontSize', null);\n\n  \t\t\t\t// TODO tidy this up, test it, send PR to jonathantneal!\n  \t\t\t\tfor (property in currentStyle) {\n  \t\t\t\t\tif ( currentStyle[property] === 'normal' && normalProps.hasOwnProperty( property ) ) {\n  \t\t\t\t\t\tstyle[ property ] = normalProps[ property ];\n  \t\t\t\t\t} else if ( /width|height|margin.|padding.|border.+W/.test(property) ) {\n  \t\t\t\t\t\tif ( currentStyle[ property ] === 'auto' ) {\n  \t\t\t\t\t\t\tif ( /^width|height/.test( property ) ) {\n  \t\t\t\t\t\t\t\t// just use clientWidth/clientHeight...\n  \t\t\t\t\t\t\t\tstyle[ property ] = ( property === 'width' ? element.clientWidth : element.clientHeight ) + 'px';\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\telse if ( /(?:padding)?Top|Bottom$/.test( property ) ) {\n  \t\t\t\t\t\t\t\tstyle[ property ] = '0px';\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\telse {\n  \t\t\t\t\t\t\tstyle[ property ] = getPixelSize(element, currentStyle, property, fontSize) + 'px';\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (property === 'styleFloat') {\n  \t\t\t\t\t\tstyle.float = currentStyle[property];\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tstyle[property] = currentStyle[property];\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tsetShortStyleProperty(style, 'margin');\n  \t\t\t\tsetShortStyleProperty(style, 'padding');\n  \t\t\t\tsetShortStyleProperty(style, 'border');\n\n  \t\t\t\tstyle.fontSize = fontSize + 'px';\n\n  \t\t\t\treturn style;\n  \t\t\t}\n\n  \t\t\tCSSStyleDeclaration.prototype = {\n  \t\t\t\tconstructor: CSSStyleDeclaration,\n  \t\t\t\tgetPropertyPriority: noop,\n  \t\t\t\tgetPropertyValue: function ( prop ) {\n  \t\t\t\t\treturn this[prop] || '';\n  \t\t\t\t},\n  \t\t\t\titem: noop,\n  \t\t\t\tremoveProperty: noop,\n  \t\t\t\tsetProperty: noop,\n  \t\t\t\tgetPropertyCSSValue: noop\n  \t\t\t};\n\n  \t\t\tfunction getComputedStyle(element) {\n  \t\t\t\treturn new CSSStyleDeclaration(element);\n  \t\t\t}\n\n  \t\t\treturn getComputedStyle;\n  \t\t}());\n  \t}\n  }\n\n  var legacy = exportedShims;\n\n  var html   = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1    = 'http://www.w3.org/2000/svg';\n  var xlink  = 'http://www.w3.org/1999/xlink';\n  var xml    = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns  = 'http://www.w3.org/2000/xmlns';\n\n  var namespaces = { html: html, mathml: mathml, svg: svg$1, xlink: xlink, xml: xml, xmlns: xmlns };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i;\n  var j;\n  var makeFunction;\n  // Test for SVG support\n  if ( !svg ) {\n  \tcreateElement = function ( type, ns, extend ) {\n  \t\tif ( ns && ns !== html ) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ?\n  \t\t\tdoc.createElement( type, extend ) :\n  \t\t\tdoc.createElement( type );\n  \t};\n  } else {\n  \tcreateElement = function ( type, ns, extend ) {\n  \t\tif ( !ns || ns === html ) {\n  \t\t\treturn extend ?\n  \t\t\t\tdoc.createElement( type, extend ) :\n  \t\t\t\tdoc.createElement( type );\n  \t\t}\n\n  \t\treturn extend ?\n  \t\t\tdoc.createElementNS( ns, type, extend ) :\n  \t\t\tdoc.createElementNS( ns, type );\n  \t};\n  }\n\n  function createDocumentFragment () {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement ( input ) {\n  \tvar output;\n\n  \tif ( !input || typeof input === 'boolean' ) { return; }\n\n  \tif ( !win || !doc || !input ) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif ( input.nodeType ) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif ( typeof input === 'string' ) {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById( input );\n\n  \t\t// then as selector, if possible\n  \t\tif ( !output && doc.querySelector ) {\n  \t\t\toutput = doc.querySelector( input );\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif ( output && output.nodeType ) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif ( input[0] && input[0].nodeType ) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if ( !isClient ) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement( 'div' );\n  \tmethodNames = [ 'matches', 'matchesSelector' ];\n\n  \tmakeFunction = function ( methodName ) {\n  \t\treturn function ( node, selector ) {\n  \t\t\treturn node[ methodName ]( selector );\n  \t\t};\n  \t};\n\n  \ti = methodNames.length;\n\n  \twhile ( i-- && !matches ) {\n  \t\tunprefixed = methodNames[i];\n\n  \t\tif ( div[ unprefixed ] ) {\n  \t\t\tmatches = makeFunction( unprefixed );\n  \t\t} else {\n  \t\t\tj = vendors.length;\n  \t\t\twhile ( j-- ) {\n  \t\t\t\tprefixed = vendors[i] + unprefixed.substr( 0, 1 ).toUpperCase() + unprefixed.substring( 1 );\n\n  \t\t\t\tif ( div[ prefixed ] ) {\n  \t\t\t\t\tmatches = makeFunction( prefixed );\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif ( !matches ) {\n  \t\tmatches = function ( node, selector ) {\n  \t\t\tvar nodes, parentNode, i;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif ( !parentNode ) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild( node );\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll( selector );\n\n  \t\t\ti = nodes.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( nodes[i] === node ) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode ( node ) {\n  \tif ( node && typeof node.parentNode !== 'unknown' && node.parentNode ) {\n  \t\tnode.parentNode.removeChild( node );\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue ( value ) {\n  \treturn ( value == null || !value.toString ) ? '' : '' + value;\n  }\n\n  function safeAttributeString ( string ) {\n  \treturn safeToStringValue( string )\n  \t\t.replace( /&/g, '&amp;' )\n  \t\t.replace( /\"/g, '&quot;' )\n  \t\t.replace( /'/g, '&#39;' );\n  }\n\n  var camel = /(-.)/g;\n  function camelize ( string ) {\n  \treturn string.replace( camel, function ( s ) { return s.charAt( 1 ).toUpperCase(); } );\n  }\n\n  var decamel = /[A-Z]/g;\n  function decamelize ( string ) {\n  \treturn string.replace( decamel, function ( s ) { return (\"-\" + (s.toLowerCase())); } );\n  }\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { get: function() {}, set: function() {} });\n\n  \tif ( doc ) {\n  \t\tObject.defineProperty( createElement( 'div' ), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch ( err ) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function ( obj, prop, desc ) {\n  \t\tif ( desc.get ) obj[ prop ] = desc.get();\n  \t\telse obj[ prop ] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch ( err ) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif ( doc ) {\n  \t\tObject.defineProperties( createElement( 'div' ), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch ( err ) {\n  \tdefineProperties = function ( obj, props ) {\n  \t\tvar prop;\n\n  \t\tfor ( prop in props ) {\n  \t\t\tif ( props.hasOwnProperty( prop ) ) {\n  \t\t\t\tdefineProperty( obj, prop, props[ prop ] );\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create( null );\n\n  \tcreate = Object.create;\n  } catch ( err ) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function ( proto, props ) {\n  \t\t\tvar obj;\n\n  \t\t\tif ( proto === null ) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif ( props ) {\n  \t\t\t\tObject.defineProperties( obj, props );\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t}());\n  }\n\n  function extendObj ( target ) {\n  \tvar sources = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];\n\n  \tvar prop;\n\n  \tsources.forEach( function ( source ) {\n  \t\tfor ( prop in source ) {\n  \t\t\tif ( hasOwn.call( source, prop ) ) {\n  \t\t\t\ttarget[ prop ] = source[ prop ];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  function fillGaps ( target ) {\n  \tvar sources = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];\n\n  \tsources.forEach( function ( s ) {\n  \t\tfor ( var key in s ) {\n  \t\t\tif ( hasOwn.call( s, key ) && !( key in target ) ) {\n  \t\t\t\ttarget[ key ] = s[ key ];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n  function isArray ( thing ) {\n  \treturn toString.call( thing ) === '[object Array]';\n  }\n\n  function isEqual ( a, b ) {\n  \tif ( a === null && b === null ) {\n  \t\treturn true;\n  \t}\n\n  \tif ( typeof a === 'object' || typeof b === 'object' ) {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n  function isNumeric ( thing ) {\n  \treturn !isNaN( parseFloat( thing ) ) && isFinite( thing );\n  }\n\n  function isObject ( thing ) {\n  \treturn ( thing && toString.call( thing ) === '[object Object]' );\n  }\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if ( hasConsole ) {\n  \tvar welcomeIntro = [\n  \t\t(\"%cRactive.js %c0.9.0-edge-908d1cada802ea17ba785c0a8221d9f91c635805 %cin debug mode, %cmore...\"),\n  \t\t'color: rgb(114, 157, 52); font-weight: normal;',\n  \t\t'color: rgb(85, 85, 85); font-weight: normal;',\n  \t\t'color: rgb(85, 85, 85); font-weight: normal;',\n  \t\t'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'\n  \t];\n  \tvar welcomeMessage = \"You're running Ractive 0.9.0-edge-908d1cada802ea17ba785c0a8221d9f91c635805 in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n\";\n\n  \twelcome = function () {\n  \t\tif ( Ractive.WELCOME_MESSAGE === false ) {\n  \t\t\twelcome = noop;\n  \t\t\treturn;\n  \t\t}\n  \t\tvar message = 'WELCOME_MESSAGE' in Ractive ? Ractive.WELCOME_MESSAGE : welcomeMessage;\n  \t\tvar hasGroup = !!console.groupCollapsed;\n  \t\tif ( hasGroup ) console.groupCollapsed.apply( console, welcomeIntro );\n  \t\tconsole.log( message );\n  \t\tif ( hasGroup ) {\n  \t\t\tconsole.groupEnd( welcomeIntro );\n  \t\t}\n\n  \t\twelcome = noop;\n  \t};\n\n  \tprintWarning = function ( message, args ) {\n  \t\twelcome();\n\n  \t\t// extract information about the instance this message pertains to, if applicable\n  \t\tif ( typeof args[ args.length - 1 ] === 'object' ) {\n  \t\t\tvar options = args.pop();\n  \t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\tif ( ractive ) {\n  \t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t// it to the message\n  \t\t\t\tvar name;\n  \t\t\t\tif ( ractive.component && ( name = ractive.component.name ) ) {\n  \t\t\t\t\tmessage = \"<\" + name + \"> \" + message;\n  \t\t\t\t}\n\n  \t\t\t\tvar node;\n  \t\t\t\tif ( node = ( options.node || ( ractive.fragment && ractive.fragment.rendered && ractive.find( '*' ) ) ) ) {\n  \t\t\t\t\targs.push( node );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tconsole.warn.apply( console, [ '%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);' ].concat( args ) );\n  \t};\n\n  \tlog = function () {\n  \t\tconsole.log.apply( console, arguments );\n  \t};\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format ( message, args ) {\n  \treturn message.replace( /%s/g, function () { return args.shift(); } );\n  }\n\n  function fatal ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n  \tthrow new Error( message );\n  }\n\n  function logIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\tlog.apply( null, arguments );\n  \t}\n  }\n\n  function warn ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n  \tprintWarning( message, args );\n  }\n\n  function warnOnce ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n\n  \tif ( alreadyWarned[ message ] ) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[ message ] = true;\n  \tprintWarning( message, args );\n  }\n\n  function warnIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\twarn.apply( null, arguments );\n  \t}\n  }\n\n  function warnOnceIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\twarnOnce.apply( null, arguments );\n  \t}\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function ( name, type ) { return (\"Missing \\\"\" + name + \"\\\" \" + type + \" plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#\" + type + \"s\"); };\n\n  function findInViewHierarchy ( registryName, ractive, name ) {\n  \tvar instance = findInstance( registryName, ractive, name );\n  \treturn instance ? instance[ registryName ][ name ] : null;\n  }\n\n  function findInstance ( registryName, ractive, name ) {\n  \twhile ( ractive ) {\n  \t\tif ( name in ractive[ registryName ] ) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif ( ractive.isolated ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function interpolate ( from, to, ractive, type ) {\n  \tif ( from === to ) return null;\n\n  \tif ( type ) {\n  \t\tvar interpol = findInViewHierarchy( 'interpolators', ractive, type );\n  \t\tif ( interpol ) return interpol( from, to ) || null;\n\n  \t\tfatal( missingPlugin( type, 'interpolator' ) );\n  \t}\n\n  \treturn interpolators.number( from, to ) ||\n  \t       interpolators.array( from, to ) ||\n  \t       interpolators.object( from, to ) ||\n  \t       null;\n  }\n\n  function snap ( to ) {\n  \treturn function () { return to; };\n  }\n\n  var interpolators = {\n  \tnumber: function ( from, to ) {\n  \t\tvar delta;\n\n  \t\tif ( !isNumeric( from ) || !isNumeric( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif ( !delta ) {\n  \t\t\treturn function () { return from; };\n  \t\t}\n\n  \t\treturn function ( t ) {\n  \t\t\treturn from + ( t * delta );\n  \t\t};\n  \t},\n\n  \tarray: function ( from, to ) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif ( !isArray( from ) || !isArray( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min( from.length, to.length );\n  \t\twhile ( i-- ) {\n  \t\t\tinterpolators[i] = interpolate( from[i], to[i] );\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor ( i=len; i<from.length; i+=1 ) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor ( i=len; i<to.length; i+=1 ) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function ( t ) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tintermediate[i] = interpolators[i]( t );\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function ( from, to ) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif ( !isObject( from ) || !isObject( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor ( prop in from ) {\n  \t\t\tif ( hasOwn.call( from, prop ) ) {\n  \t\t\t\tif ( hasOwn.call( to, prop ) ) {\n  \t\t\t\t\tproperties.push( prop );\n  \t\t\t\t\tinterpolators[ prop ] = interpolate( from[ prop ], to[ prop ] ) || snap( to[ prop ] );\n  \t\t\t\t}\n\n  \t\t\t\telse {\n  \t\t\t\t\tintermediate[ prop ] = from[ prop ];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor ( prop in to ) {\n  \t\t\tif ( hasOwn.call( to, prop ) && !hasOwn.call( from, prop ) ) {\n  \t\t\t\tintermediate[ prop ] = to[ prop ];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function ( t ) {\n  \t\t\tvar i = len, prop;\n\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[ prop ] = interpolators[ prop ]( t );\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' +\n  \t\t\t'and will likely be removed in a future release. ' +\n  \t\t\t'You can either use the \"oninit\" method which will fire ' +\n  \t\t\t'only once prior to, and regardless of, any eventual ractive ' +\n  \t\t\t'instance being rendered, or if you need to access the ' +\n  \t\t\t'rendered DOM, use \"onrender\" instead. ' +\n  \t\t\t'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = function Hook ( event ) {\n  \tthis.event = event;\n  \tthis.method = 'on' + event;\n  \tthis.deprecate = deprecations[ event ];\n  };\n\n  Hook.prototype.call = function call ( method, ractive, arg ) {\n  \tif ( ractive[ method ] ) {\n  \t\targ ? ractive[ method ]( arg ) : ractive[ method ]();\n  \t\treturn true;\n  \t}\n  };\n\n  Hook.prototype.fire = function fire ( ractive, arg ) {\n  \tthis.call( this.method, ractive, arg );\n\n  \t// handle deprecations\n  \tif ( !ractive[ this.method ] && this.deprecate && this.call( this.deprecate.deprecated, ractive, arg ) ) {\n  \t\tif ( this.deprecate.message ) {\n  \t\t\twarnIfDebug( this.deprecate.message );\n  \t\t} else {\n  \t\t\twarnIfDebug( 'The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement );\n  \t\t}\n  \t}\n\n  \t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \targ ? ractive.fire( this.event, arg ) : ractive.fire( this.event );\n  };\n\n  function addToArray ( array, value ) {\n  \tvar index = array.indexOf( value );\n\n  \tif ( index === -1 ) {\n  \t\tarray.push( value );\n  \t}\n  }\n\n  function arrayContains ( array, value ) {\n  \tfor ( var i = 0, c = array.length; i < c; i++ ) {\n  \t\tif ( array[i] == value ) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch ( a, b ) {\n  \tvar i;\n\n  \tif ( !isArray( a ) || !isArray( b ) ) {\n  \t\treturn false;\n  \t}\n\n  \tif ( a.length !== b.length ) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile ( i-- ) {\n  \t\tif ( a[i] !== b[i] ) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray ( x ) {\n  \tif ( typeof x === 'string' ) {\n  \t\treturn [ x ];\n  \t}\n\n  \tif ( x === undefined ) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem ( array ) {\n  \treturn array[ array.length - 1 ];\n  }\n\n  function removeFromArray ( array, member ) {\n  \tif ( !array ) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf( member );\n\n  \tif ( index !== -1 ) {\n  \t\tarray.splice( index, 1 );\n  \t}\n  }\n\n  function toArray ( arrayLike ) {\n  \tvar array = [], i = arrayLike.length;\n  \twhile ( i-- ) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  function find ( array, fn ) {\n  \tvar len = array.length;\n  \tfor ( var i = 0; i < len; i++ ) {\n  \t\tif ( fn( array[i] ) ) return array[i];\n  \t}\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if ( typeof Promise === 'function' ) {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function ( callback ) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t\trejectedHandlers = [],\n  \t\t\tstate = PENDING,\n\n  \t\t\tresult,\n  \t\t\tdispatchHandlers,\n  \t\t\tmakeResolver,\n  \t\t\tfulfil,\n  \t\t\treject,\n\n  \t\t\tpromise;\n\n  \t\tmakeResolver = function ( newState ) {\n  \t\t\treturn function ( value ) {\n  \t\t\t\tif ( state !== PENDING ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher( ( state === FULFILLED ? fulfilledHandlers : rejectedHandlers ), result );\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait( dispatchHandlers );\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver( FULFILLED );\n  \t\treject = makeResolver( REJECTED );\n\n  \t\ttry {\n  \t\t\tcallback( fulfil, reject );\n  \t\t} catch ( err ) {\n  \t\t\treject( err );\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function ( onFulfilled, onRejected ) {\n  \t\t\t\tvar promise2 = new _Promise( function ( fulfil, reject ) {\n\n  \t\t\t\t\tvar processResolutionHandler = function ( handler, handlers, forward ) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif ( typeof handler === 'function' ) {\n  \t\t\t\t\t\t\thandlers.push( function ( p1result ) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler( p1result );\n  \t\t\t\t\t\t\t\t\tresolve( promise2, x, fulfil, reject );\n  \t\t\t\t\t\t\t\t} catch ( err ) {\n  \t\t\t\t\t\t\t\t\treject( err );\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push( forward );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler( onFulfilled, fulfilledHandlers, fulfil );\n  \t\t\t\t\tprocessResolutionHandler( onRejected, rejectedHandlers, reject );\n\n  \t\t\t\t\tif ( state !== PENDING ) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait( dispatchHandlers );\n  \t\t\t\t\t}\n\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise[ 'catch' ] = function ( onRejected ) {\n  \t\t\treturn this.then( null, onRejected );\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function ( promises ) {\n  \t\treturn new _Promise( function ( fulfil, reject ) {\n  \t\t\tvar result = [], pending, i, processPromise;\n\n  \t\t\tif ( !promises.length ) {\n  \t\t\t\tfulfil( result );\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function ( promise, i ) {\n  \t\t\t\tif ( promise && typeof promise.then === 'function' ) {\n  \t\t\t\t\tpromise.then( function ( value ) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil( result );\n  \t\t\t\t\t}, reject );\n  \t\t\t\t}\n\n  \t\t\t\telse {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil( result );\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tprocessPromise( promises[i], i );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function ( value ) {\n  \t\treturn new _Promise( function ( fulfil ) {\n  \t\t\tfulfil( value );\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function ( reason ) {\n  \t\treturn new _Promise( function ( fulfil, reject ) {\n  \t\t\treject( reason );\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait ( callback ) {\n  \tsetTimeout( callback, 0 );\n  }\n\n  function makeDispatcher ( handlers, result ) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile ( handler = handlers.shift() ) {\n  \t\t\thandler( result );\n  \t\t}\n  \t};\n  }\n\n  function resolve ( promise, x, fulfil, reject ) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif ( x === promise ) {\n  \t\tthrow new TypeError( 'A promise\\'s fulfillment handler cannot return the same promise' );\n  \t}\n\n  \t// 2.3.2\n  \tif ( x instanceof _Promise ) {\n  \t\tx.then( fulfil, reject );\n  \t}\n\n  \t// 2.3.3\n  \telse if ( x && ( typeof x === 'object' || typeof x === 'function' ) ) {\n  \t\ttry {\n  \t\t\tthen = x.then; // 2.3.3.1\n  \t\t} catch ( e ) {\n  \t\t\treject( e ); // 2.3.3.2\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// 2.3.3.3\n  \t\tif ( typeof then === 'function' ) {\n  \t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\tresolvePromise = function ( y ) {\n  \t\t\t\tif ( called ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t\tcalled = true;\n  \t\t\t\tresolve( promise, y, fulfil, reject );\n  \t\t\t};\n\n  \t\t\trejectPromise = function ( r ) {\n  \t\t\t\tif ( called ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t\tcalled = true;\n  \t\t\t\treject( r );\n  \t\t\t};\n\n  \t\t\ttry {\n  \t\t\t\tthen.call( x, resolvePromise, rejectPromise );\n  \t\t\t} catch ( e ) {\n  \t\t\t\tif ( !called ) { // 2.3.3.3.4.1\n  \t\t\t\t\treject( e ); // 2.3.3.3.4.2\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\telse {\n  \t\t\tfulfil( x );\n  \t\t}\n  \t}\n\n  \telse {\n  \t\tfulfil( x );\n  \t}\n  }\n\n  var TransitionManager = function TransitionManager ( callback, parent ) {\n  \tthis.callback = callback;\n  \tthis.parent = parent;\n\n  \tthis.intros = [];\n  \tthis.outros = [];\n\n  \tthis.children = [];\n  \tthis.totalChildren = this.outroChildren = 0;\n\n  \tthis.detachQueue = [];\n  \tthis.outrosComplete = false;\n\n  \tif ( parent ) {\n  \t\tparent.addChild( this );\n  \t}\n  };\n\n  TransitionManager.prototype.add = function add ( transition ) {\n  \tvar list = transition.isIntro ? this.intros : this.outros;\n  \tlist.push( transition );\n  };\n\n  TransitionManager.prototype.addChild = function addChild ( child ) {\n  \tthis.children.push( child );\n\n  \tthis.totalChildren += 1;\n  \tthis.outroChildren += 1;\n  };\n\n  TransitionManager.prototype.decrementOutros = function decrementOutros () {\n  \tthis.outroChildren -= 1;\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.decrementTotal = function decrementTotal () {\n  \tthis.totalChildren -= 1;\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.detachNodes = function detachNodes () {\n  \tthis.detachQueue.forEach( detach );\n  \tthis.children.forEach( _detachNodes );\n  };\n\n  TransitionManager.prototype.ready = function ready () {\n  \tdetachImmediate( this );\n  };\n\n  TransitionManager.prototype.remove = function remove ( transition ) {\n  \tvar list = transition.isIntro ? this.intros : this.outros;\n  \tremoveFromArray( list, transition );\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.start = function start () {\n  \tthis.children.forEach( function ( c ) { return c.start(); } );\n  \tthis.intros.concat( this.outros ).forEach( function ( t ) { return t.start(); } );\n  \tthis.ready = true;\n  \tcheck( this );\n  };\n\n  function detach ( element ) {\n  \telement.detach();\n  }\n\n  function _detachNodes ( tm ) { // _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check ( tm ) {\n  \tif ( !tm.ready || tm.outros.length || tm.outroChildren ) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif ( !tm.outrosComplete ) {\n  \t\ttm.outrosComplete = true;\n\n  \t\tif ( tm.parent && !tm.parent.outrosComplete ) {\n  \t\t\ttm.parent.decrementOutros( tm );\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif ( !tm.intros.length && !tm.totalChildren ) {\n  \t\tif ( typeof tm.callback === 'function' ) {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif ( tm.parent && !tm.notifiedTotal ) {\n  \t\t\ttm.notifiedTotal = true;\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  // check through the detach queue to see if a node is up or downstream from a\n  // transition and if not, go ahead and detach it\n  function detachImmediate ( manager ) {\n  \tvar queue = manager.detachQueue;\n  \tvar outros = collectAllOutros( manager );\n\n  \tvar i = queue.length, j = 0, node, trans;\n  \tstart: while ( i-- ) {\n  \t\tnode = queue[i].node;\n  \t\tj = outros.length;\n  \t\twhile ( j-- ) {\n  \t\t\ttrans = outros[j].element.node;\n  \t\t\t// check to see if the node is, contains, or is contained by the transitioning node\n  \t\t\tif ( trans === node || trans.contains( node ) || node.contains( trans ) ) continue start;\n  \t\t}\n\n  \t\t// no match, we can drop it\n  \t\tqueue[i].detach();\n  \t\tqueue.splice( i, 1 );\n  \t}\n  }\n\n  function collectAllOutros ( manager, list ) {\n  \tif ( !list ) {\n  \t\tlist = [];\n  \t\tvar parent = manager;\n  \t\twhile ( parent.parent ) parent = parent.parent;\n  \t\treturn collectAllOutros( parent, list );\n  \t} else {\n  \t\tvar i = manager.children.length;\n  \t\twhile ( i-- ) {\n  \t\t\tlist = collectAllOutros( manager.children[i], list );\n  \t\t}\n  \t\tlist = list.concat( manager.outros );\n  \t\treturn list;\n  \t}\n  }\n\n  var changeHook = new Hook( 'change' );\n\n  var batch;\n\n  var runloop = {\n  \tstart: function ( instance, returnPromise ) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif ( returnPromise ) {\n  \t\t\tpromise = new Promise$1( function ( f ) { return ( fulfilPromise = f ); } );\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager( fulfilPromise, batch && batch.transitionManager ),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tractives: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n\n  \t\tif ( !batch.previousBatch ) batch.transitionManager.start();\n\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function ( fragment ) {\n  \t\taddToArray( batch.fragments, fragment );\n  \t},\n\n  \t// TODO: come up with a better way to handle fragments that trigger their own update\n  \taddFragmentToRoot: function ( fragment ) {\n  \t\tif ( !batch ) return;\n\n  \t\tvar b = batch;\n  \t\twhile ( b.previousBatch ) {\n  \t\t\tb = b.previousBatch;\n  \t\t}\n\n  \t\taddToArray( b.fragments, fragment );\n  \t},\n\n  \taddInstance: function ( instance ) {\n  \t\tif ( batch ) addToArray( batch.ractives, instance );\n  \t},\n\n  \taddObserver: function ( observer, defer ) {\n  \t\taddToArray( defer ? batch.deferredObservers : batch.immediateObservers, observer );\n  \t},\n\n  \tregisterTransition: function ( transition ) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add( transition );\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function ( thing ) {\n  \t\tbatch.transitionManager.detachQueue.push( thing );\n  \t},\n\n  \tscheduleTask: function ( task, postRender ) {\n  \t\tvar _batch;\n\n  \t\tif ( !batch ) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile ( postRender && _batch.previousBatch ) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push( task );\n  \t\t}\n  \t}\n  };\n\n  function dispatch ( observer ) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges () {\n  \tvar which = batch.immediateObservers;\n  \tbatch.immediateObservers = [];\n  \twhich.forEach( dispatch );\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment;\n\n  \twhich = batch.fragments;\n  \tbatch.fragments = [];\n  \tvar ractives = batch.ractives;\n  \tbatch.ractives = [];\n\n  \twhile ( i-- ) {\n  \t\tfragment = which[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tif ( Object.keys( ractive.viewmodel.changes ).length ) {\n  \t\t\tchangeHook.fire( ractive, ractive.viewmodel.changes );\n  \t\t}\n  \t\tractive.viewmodel.changes = {};\n  \t\tremoveFromArray( ractives, ractive );\n\n  \t\tfragment.update();\n  \t}\n\n  \ti = ractives.length;\n  \twhile ( i-- ) {\n  \t\tvar ractive$1 = ractives[i];\n  \t\tchangeHook.fire( ractive$1, ractive$1.viewmodel.changes );\n  \t\tractive$1.viewmodel.changes = {};\n  \t}\n\n  \tbatch.transitionManager.ready();\n\n  \twhich = batch.deferredObservers;\n  \tbatch.deferredObservers = [];\n  \twhich.forEach( dispatch );\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor ( i = 0; i < tasks.length; i += 1 ) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif ( batch.fragments.length || batch.immediateObservers.length || batch.deferredObservers.length || batch.ractives.length || batch.tasks.length ) return flushChanges();\n  }\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n  var splitPattern = /([^\\\\](?:\\\\\\\\)*)\\./;\n  var escapeKeyPattern = /\\\\|\\./g;\n  var unescapeKeyPattern = /((?:\\\\)+)\\1|\\\\(\\.)/g;\n\n  function escapeKey ( key ) {\n  \tif ( typeof key === 'string' ) {\n  \t\treturn key.replace( escapeKeyPattern, '\\\\$&' );\n  \t}\n\n  \treturn key;\n  }\n\n  function normalise ( ref ) {\n  \treturn ref ? ref.replace( refPattern, '.$1' ) : '';\n  }\n\n  function splitKeypathI ( keypath ) {\n  \tvar result = [],\n  \t\tmatch;\n\n  \tkeypath = normalise( keypath );\n\n  \twhile ( match = splitPattern.exec( keypath ) ) {\n  \t\tvar index = match.index + match[1].length;\n  \t\tresult.push( keypath.substr( 0, index ) );\n  \t\tkeypath = keypath.substr( index + 1 );\n  \t}\n\n  \tresult.push(keypath);\n\n  \treturn result;\n  }\n\n  function unescapeKey ( key ) {\n  \tif ( typeof key === 'string' ) {\n  \t\treturn key.replace( unescapeKeyPattern, '$1$2' );\n  \t}\n\n  \treturn key;\n  }\n\n  function bind ( fn, context ) {\n  \tif ( !/this/.test( fn.toString() ) ) return fn;\n\n  \tvar bound = fn.bind( context );\n  \tfor ( var prop in fn ) bound[ prop ] = fn[ prop ];\n\n  \treturn bound;\n  }\n\n  function set ( ractive, pairs ) {\n  \tvar promise = runloop.start( ractive, true );\n\n  \tvar i = pairs.length;\n  \twhile ( i-- ) {\n  \t\tvar ref = pairs[i], model = ref[0], value = ref[1];\n  \t\tif ( typeof value === 'function' ) value = bind( value, ractive );\n  \t\tmodel.set( value );\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var star = /\\*/;\n  function gather ( ractive, keypath, base ) {\n  \tif ( base === void 0 ) base = ractive.viewmodel;\n\n  \tif ( star.test( keypath ) ) {\n  \t\treturn base.findMatches( splitKeypathI( keypath ) );\n  \t} else {\n  \t\treturn [ base.joinAll( splitKeypathI( keypath ) ) ];\n  \t}\n  }\n\n  function build ( ractive, keypath, value ) {\n  \tvar sets = [];\n\n  \t// set multiple keypaths in one go\n  \tif ( isObject( keypath ) ) {\n  \t\tvar loop = function ( k ) {\n  \t\t\tif ( keypath.hasOwnProperty( k ) ) {\n  \t\t\t\tsets.push.apply( sets, gather( ractive, k ).map( function ( m ) { return [ m, keypath[k] ]; } ) );\n  \t\t\t}\n  \t\t};\n\n  \t\tfor ( var k in keypath ) loop( k );\n\n  \t}\n  \t// set a single keypath\n  \telse {\n  \t\tsets.push.apply( sets, gather( ractive, keypath ).map( function ( m ) { return [ m, value ]; } ) );\n  \t}\n\n  \treturn sets;\n  }\n\n  var errorMessage = 'Cannot add to a non-numeric value';\n\n  function add ( ractive, keypath, d ) {\n  \tif ( typeof keypath !== 'string' || !isNumeric( d ) ) {\n  \t\tthrow new Error( 'Bad arguments' );\n  \t}\n\n  \tvar sets = build( ractive, keypath, d );\n\n  \treturn set( ractive, sets.map( function ( pair ) {\n  \t\tvar model = pair[0], add = pair[1], value = model.get();\n  \t\tif ( !isNumeric( add ) || !isNumeric( value ) ) throw new Error( errorMessage );\n  \t\treturn [ model, value + add ];\n  \t}));\n  }\n\n  function Ractive$add ( keypath, d ) {\n  \treturn add( this, keypath, ( d === undefined ? 1 : +d ) );\n  }\n\n  var noAnimation = Promise$1.resolve();\n  defineProperty( noAnimation, 'stop', { value: noop });\n\n  var linear = easing.linear;\n\n  function getOptions ( options, instance ) {\n  \toptions = options || {};\n\n  \tvar easing;\n  \tif ( options.easing ) {\n  \t\teasing = typeof options.easing === 'function' ?\n  \t\t\toptions.easing :\n  \t\t\tinstance.easing[ options.easing ];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n\n  function protoAnimate ( ractive, model, to, options ) {\n  \toptions = getOptions( options, ractive );\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif ( isEqual( from, to ) ) {\n  \t\toptions.complete( options.to );\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate( from, to, ractive, options.interpolator );\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif ( !interpolator ) {\n  \t\trunloop.start();\n  \t\tmodel.set( to );\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate( from, to, options, interpolator );\n  }\n\n  function Ractive$animate ( keypath, to, options ) {\n  \tif ( typeof keypath === 'object' ) {\n  \t\tvar keys = Object.keys( keypath );\n\n  \t\tthrow new Error( (\"ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  \" + (keys.map( function ( key ) { return (\"'\" + key + \"': \" + (keypath[ key ])); } ).join( '\\n  ' )) + \"\\n}, {...}), do\\n\\n\" + (keys.map( function ( key ) { return (\"ractive.animate('\" + key + \"', \" + (keypath[ key ]) + \", {...});\"); } ).join( '\\n' )) + \"\\n\") );\n  \t}\n\n\n  \treturn protoAnimate( this, this.viewmodel.joinAll( splitKeypathI( keypath ) ), to, options );\n  }\n\n  function updateLiveQueries ( element ) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n  \tvar queries = [], remotes = {};\n  \tvar remote = instance.component && instance.component.target === false;\n  \tvar i;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\ti = liveQueries.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar query = liveQueries[i];\n\n  \t\t\tif ( query.test( node ) ) {\n  \t\t\t\tqueries.push( query );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( !remote && instance.component && instance.component.target === false ) remote = true;\n  \t\tremotes[ instance._guid ] = remote;\n  \t} while ( instance = instance.parent );\n\n  \ti = queries.length;\n  \twhile ( i-- ) {\n  \t\tvar query$1 = queries[i];\n  \t\tif ( query$1.remote || !remotes[ query$1.ractive._guid ] ) {\n  \t\t\tquery$1.add( node );\n  \t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\telement.liveQueries.push( query$1 );\n  \t\t}\n  \t}\n  }\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n  function updateLiveQueries$1 ( component ) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n  \tvar queries = [], remotes = {};\n  \tvar remote = component.target === false;\n  \tvar i;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\ti = liveQueries.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar query = liveQueries[i];\n\n  \t\t\tif ( query.test( component ) ) {\n  \t\t\t\tqueries.push( query );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( !remote && instance.component && instance.component.target === false ) remote = true;\n  \t\tremotes[ instance._guid ] = remote;\n  \t} while ( instance = instance.parent );\n\n  \ti = queries.length;\n  \twhile ( i-- ) {\n  \t\tvar query$1 = queries[i];\n  \t\tif ( query$1.remote || !remotes[ query$1.ractive._guid ] ) {\n  \t\t\tquery$1.add( component.instance );\n  \t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\tcomponent.liveQueries.push( query$1 );\n  \t\t}\n  \t}\n  }\n\n  function findAnchors ( fragment, name ) {\n  \tif ( name === void 0 ) name = null;\n\n  \tvar res = [];\n\n  \tfindAnchorsIn( fragment, name, res );\n\n  \treturn res;\n  }\n\n  function findAnchorsIn ( item, name, result ) {\n  \tif ( item.isAnchor ) {\n  \t\tif ( !name || item.name === name ) {\n  \t\t\tresult.push( item );\n  \t\t}\n  \t} else if ( item.items ) {\n  \t\titem.items.forEach( function ( i ) { return findAnchorsIn( i, name, result ); } );\n  \t} else if ( item.iterations ) {\n  \t\titem.iterations.forEach( function ( i ) { return findAnchorsIn( i, name, result ); } );\n  \t} else if ( item.fragment && !item.component ) {\n  \t\tfindAnchorsIn( item.fragment, name, result );\n  \t}\n  }\n\n  function updateAnchors ( instance, name ) {\n  \tif ( name === void 0 ) name = null;\n\n  \tvar anchors = findAnchors( instance.fragment, name );\n  \tvar idxs = {}, children = instance._children.byName;\n\n  \tanchors.forEach( function ( a ) {\n  \t\tvar name = a.name;\n  \t\tif ( !( name in idxs ) ) idxs[name] = 0;\n  \t\tvar idx = idxs[name];\n  \t\tvar child = ( children[name] || [] )[idx];\n\n  \t\tif ( child && child.lastBound !== a ) {\n  \t\t\tif ( child.lastBound ) child.lastBound.removeChild( child );\n  \t\t\ta.addChild( child );\n  \t\t}\n\n  \t\tidxs[name]++;\n  \t});\n  }\n\n  function unrenderChild ( meta ) {\n  \tif ( meta.instance.fragment.rendered ) {\n  \t\tmeta.shouldDestroy = true;\n  \t\tmeta.instance.unrender();\n  \t}\n  \tmeta.instance.el = null;\n  }\n\n  var attachHook = new Hook( 'attachchild' );\n\n  function attachChild ( child, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tvar children = this._children;\n\n  \tif ( child.parent && child.parent !== this ) throw new Error( (\"Instance \" + (child._guid) + \" is already attached to a different instance \" + (child.parent._guid) + \". Please detach it from the other instance using detachChild first.\") );\n  \telse if ( child.parent ) throw new Error( (\"Instance \" + (child._guid) + \" is already attached to this instance.\") );\n\n  \tvar anchors = this._anchors;\n  \tvar meta = {\n  \t\tinstance: child,\n  \t\tractive: this,\n  \t\tname: options.name || child.constructor.name || 'Ractive',\n  \t\tliveQueries: [],\n  \t\ttarget: options.target || false,\n  \t\tbubble: bubble,\n  \t\tfindNextNode: findNextNode,\n  \t\tremoveFromQuery: removeFromQuery\n  \t};\n  \tmeta.nameOption = options.name;\n\n  \t// child is managing itself\n  \tif ( !meta.target ) {\n  \t\tmeta.parentFragment = this.fragment;\n  \t\tmeta.external = true;\n  \t} else {\n  \t\tvar list;\n  \t\tif ( !( list = children.byName[ meta.target ] ) ) {\n  \t\t\tlist = [];\n  \t\t\tthis.set( (\"@this.children.byName.\" + (meta.target)), list );\n  \t\t}\n  \t\tvar idx = options.prepend ? 0 : options.insertAt || list.length;\n  \t\tlist.splice( idx, 0, meta );\n  \t}\n\n  \tchild.parent = this;\n  \tchild.component = meta;\n  \tchildren.push( meta );\n\n  \tattachHook.fire( child );\n\n  \tvar promise = runloop.start( child, true );\n\n  \tif ( meta.target ) {\n  \t\tunrenderChild( meta );\n  \t\tthis.merge( (\"@this.children.byName.\" + (meta.target)) );\n  \t\tupdateAnchors( this, meta.target );\n  \t} else {\n  \t\tif ( !child.isolated ) child.viewmodel.attached( this.fragment );\n  \t\tif ( child.fragment.rendered ) {\n  \t\t\tchild.findAll( '*' ).forEach( function ( el ) { return updateLiveQueries( el._ractive.proxy ); } );\n  \t\t\tchild.findAllComponents().forEach( function ( cmp ) { return updateLiveQueries$1( cmp.component ); } );\n  \t\t\tupdateLiveQueries$1( meta );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tpromise.ractive = child;\n  \treturn promise.then( function () { return child; } );\n  }\n\n  function bubble () { runloop.addFragment( this.instance.fragment ); }\n\n  function removeFromQuery ( query ) {\n  \tquery.remove( this.instance );\n  \tremoveFromArray( this.liveQueries, query );\n  }\n\n  function findNextNode () {\n  \tif ( this.anchor ) return this.anchor.findNextNode();\n  }\n\n  var detachHook = new Hook( 'detach' );\n\n  function Ractive$detach () {\n  \tif ( this.isDetached ) {\n  \t\treturn this.el;\n  \t}\n\n  \tif ( this.el ) {\n  \t\tremoveFromArray( this.el.__ractive_instances__, this );\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire( this );\n  \treturn this.el;\n  }\n\n  var detachHook$1 = new Hook( 'detachchild' );\n\n  function detachChild ( child ) {\n  \tvar this$1 = this;\n\n  \tvar children = this._children;\n  \tvar meta, index;\n\n  \tvar i = children.length;\n  \twhile ( i-- ) {\n  \t\tif ( children[i].instance === child ) {\n  \t\t\tindex = i;\n  \t\t\tmeta = children[i];\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif ( !meta || child.parent !== this ) throw new Error( (\"Instance \" + (child._guid) + \" is not attached to this instance.\") );\n\n  \tvar promise = runloop.start( child, true );\n\n  \tif ( meta.anchor ) meta.anchor.removeChild( meta );\n  \tif ( !child.isolated ) child.viewmodel.detached();\n\n  \trunloop.end();\n\n  \tchildren.splice( index, 1 );\n  \tif ( meta.target ) {\n  \t\tvar list = children.byName[ meta.target ];\n  \t\tlist.splice( list.indexOf( meta ), 1 );\n  \t\tthis.merge( (\"@this.children.byName.\" + (meta.target)) );\n  \t\tupdateAnchors( this, meta.target );\n  \t}\n  \tchild.parent = null;\n  \tchild.component = null;\n\n  \tdetachHook$1.fire( child );\n\n  \tif ( !meta.target && child.fragment.rendered ) {\n  \t\t// keep live queries up to date\n  \t\tchild.findAll( '*' ).forEach( function ( el ) {\n  \t\t\tel._ractive.proxy.liveQueries.forEach( function ( q ) {\n  \t\t\t\t// remove from non-self queries\n  \t\t\t\tif ( isParent( this$1, q.ractive ) ) el._ractive.proxy.removeFromQuery( q );\n  \t\t\t});\n  \t\t});\n\n  \t\t// keep live component queries up to date\n  \t\tchild.findAllComponents().forEach( function ( cmp ) {\n  \t\t\tcmp.component.liveQueries.forEach( function ( q ) {\n  \t\t\t\tif ( isParent( this$1, q.ractive ) ) cmp.component.removeFromQuery( q );\n  \t\t\t});\n  \t\t});\n\n  \t\tmeta.liveQueries.forEach( function ( q ) { return meta.removeFromQuery( q ); } );\n  \t}\n\n  \tpromise.ractive = child;\n  \treturn promise.then( function () { return child; } );\n  }\n\n  function isParent ( target, check ) {\n  \twhile ( target ) {\n  \t\tif ( target === check ) return true;\n  \t\ttarget = target.parent;\n  \t}\n  }\n\n  function Ractive$find ( selector, options ) {\n  \tvar this$1 = this;\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( !this.el ) throw new Error( (\"Cannot call ractive.find('\" + selector + \"') unless instance is rendered to the DOM\") );\n\n  \tvar node = this.fragment.find( selector, options );\n  \tif ( node ) return node;\n\n  \tif ( options.remote ) {\n  \t\tfor ( var i = 0; i < this$1._children.length; i++ ) {\n  \t\t\tif ( !this$1._children[i].instance.fragment.rendered ) continue;\n  \t\t\tnode = this$1._children[i].instance.find( selector, options );\n  \t\t\tif ( node ) return node;\n  \t\t}\n  \t}\n  }\n\n  function sortByDocumentPosition ( node, otherNode ) {\n  \tif ( node.compareDocumentPosition ) {\n  \t\tvar bitmask = node.compareDocumentPosition( otherNode );\n  \t\treturn ( bitmask & 2 ) ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition( node, otherNode );\n  }\n\n  function sortByItemPosition ( a, b ) {\n  \tvar baseA = a.component || a._ractive.proxy;\n  \tvar baseB = b.component || b._ractive.proxy;\n\n  \t// allow for attached childdren outside the template\n  \tif ( baseA.target === false && baseB.target === false ) return 0;\n  \telse if ( baseA.target === false ) return 1;\n  \telse if ( baseB.target === false ) return -1;\n\n  \tvar ancestryA = getAncestry( baseA );\n  \tvar ancestryB = getAncestry( baseB );\n\n  \tvar oldestA = lastItem( ancestryA );\n  \tvar oldestB = lastItem( ancestryB );\n  \tvar mutualAncestor;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile ( oldestA && ( oldestA === oldestB ) ) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem( ancestryA );\n  \t\toldestB = lastItem( ancestryB );\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif ( fragmentA === fragmentB ) {\n  \t\tvar indexA = fragmentA.items.indexOf( oldestA );\n  \t\tvar indexB = fragmentB.items.indexOf( oldestB );\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn ( indexA - indexB ) || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif ( fragments ) {\n  \t\tvar indexA$1 = fragments.indexOf( fragmentA );\n  \t\tvar indexB$1 = fragments.indexOf( fragmentB );\n\n  \t\treturn ( indexA$1 - indexB$1 ) || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error( 'An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!' );\n  }\n\n  function getParent ( item ) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif ( parentFragment ) return parentFragment.owner;\n\n  \tif ( item.component && ( parentFragment = item.component.parentFragment ) ) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry ( item ) {\n  \tvar ancestry = [ item ];\n  \tvar ancestor = getParent( item );\n\n  \twhile ( ancestor ) {\n  \t\tancestry.push( ancestor );\n  \t\tancestor = getParent( ancestor );\n  \t}\n\n  \treturn ancestry;\n  }\n\n\n  var Query = function Query ( ractive, selector, live, isComponentQuery ) {\n  \tvar this$1 = this;\n\n  \t\tthis.ractive = ractive;\n  \tthis.selector = selector;\n  \tthis.live = live;\n  \tthis.isComponentQuery = isComponentQuery;\n\n  \tthis.refs = 1;\n\n  \tthis.result = [];\n  \tthis.result.cancel = function () { return this$1.cancel(); };\n\n  \tthis.dirty = true;\n  };\n\n  Query.prototype.add = function add ( item ) {\n  \tif ( !~this.result.indexOf( item ) ) {\n  \t\tthis.result.push( item );\n  \t\tthis.makeDirty();\n  \t}\n  };\n\n  Query.prototype.cancel = function cancel () {\n  \tvar this$1 = this;\n\n  \t\tif ( --this.refs ) return;\n\n  \tthis.cancelled = true;\n\n  \tvar liveQueries = this.ractive[ this.isComponentQuery ? '_liveComponentQueries' : '_liveQueries' ];\n\n  \tvar index = liveQueries.indexOf( this );\n\n  \tif ( index !== -1 ) {\n  \t\tliveQueries.splice( index, 1 );\n  \t}\n\n  \tthis.result.forEach( function ( item ) {\n  \t\titem = this$1.isComponentQuery ? item.component : item._ractive.proxy;\n  \t\titem.removeFromQuery( this$1 );\n  \t});\n  };\n\n  Query.prototype.init = function init () {\n  \tthis.dirty = false;\n  };\n\n  Query.prototype.makeDirty = function makeDirty () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n\n  \t\t// Once the DOM has been updated, ensure the query\n  \t\t// is correctly ordered\n  \t\trunloop.scheduleTask( function () { return this$1.update(); } );\n  \t}\n  };\n\n  Query.prototype.remove = function remove ( item ) {\n  \tif ( !this.cancelled ) {\n  \t\tvar index = this.result.indexOf( item );\n  \t\tif ( index !== -1 ) this.result.splice( index, 1 );\n  \t}\n  };\n\n  Query.prototype.update = function update () {\n  \tthis.result.sort( this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition );\n  \tthis.dirty = false;\n  };\n\n  Query.prototype.test = function test ( item ) {\n  \treturn this.isComponentQuery ?\n  \t\t( !this.selector || item.name === this.selector ) :\n  \t\t( item ? matches( item, this.selector ) : null );\n  };\n\n  function Ractive$findAll ( selector, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( !this.el ) throw new Error( (\"Cannot call ractive.findAll('\" + selector + \"', ...) unless instance is rendered to the DOM\") );\n\n  \tvar query = options._query;\n\n  \tif ( !query ) {\n  \t\tvar liveQueries = this._liveQueries;\n\n  \t\t// Shortcut: if we're maintaining a live query with this\n  \t\t// selector, we don't need to traverse the parallel DOM\n  \t\tquery = find( liveQueries, function ( q ) { return q.selector === selector && q.remote === options.remote; } );\n  \t\tif ( query ) {\n  \t\t\tif ( options.live ) query.refs++;\n  \t\t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\t\treturn options.live ? query : query.slice();\n  \t\t}\n\n  \t\tquery = new Query( this, selector, !!options.live, false );\n  \t\toptions._query = query;\n  \t\tquery.remote = options.remote;\n\n  \t\t// Add this to the list of live queries Ractive needs to maintain,\n  \t\t// if applicable\n  \t\tif ( query.live ) {\n  \t\t\tliveQueries.push( query );\n  \t\t}\n  \t}\n\n  \tthis.fragment.findAll( selector, query );\n\n  \tif ( query.remote ) {\n  \t\t// seach non-fragment children\n  \t\tthis._children.forEach( function ( c ) {\n  \t\t\tif ( !c.target && c.instance.fragment && c.instance.fragment.rendered ) {\n  \t\t\t\tc.instance.findAll( selector, options );\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAllComponents ( selector, options ) {\n  \tif ( !options && typeof selector === 'object' ) {\n  \t\toptions = selector;\n  \t\tselector = '';\n  \t}\n\n  \toptions = options || {};\n\n  \tvar query = options._query;\n\n  \tif ( !query ) {\n  \t\tvar liveQueries = this._liveComponentQueries;\n\n  \t\t// Shortcut: if we're maintaining a live query with this\n  \t\t// selector, we don't need to traverse the parallel DOM\n  \t\tquery = find( liveQueries, function ( q ) { return q.selector === selector && q.remote === options.remote; } );\n  \t\tif ( query ) {\n  \t\t\tif ( options.live ) query.refs++;\n  \t\t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\t\treturn ( options.live ) ? query : query.slice();\n  \t\t}\n\n  \t\tquery = new Query( this, selector, !!options.live, true );\n  \t\toptions._query = query;\n  \t\tquery.remote = options.remote;\n\n  \t\t// Add this to the list of live queries Ractive needs to maintain,\n  \t\t// if applicable\n  \t\tif ( query.live ) {\n  \t\t\tliveQueries.push( query );\n  \t\t}\n  \t}\n\n  \tthis.fragment.findAllComponents( selector, query );\n\n  \tif ( query.remote ) {\n  \t\t// search non-fragment children\n  \t\tthis._children.forEach( function ( c ) {\n  \t\t\tif ( !c.target && c.instance.fragment && c.instance.fragment.rendered ) {\n  \t\t\t\tif ( query.test( c ) ) {\n  \t\t\t\t\tquery.add( c.instance );\n  \t\t\t\t\tc.liveQueries.push( query );\n  \t\t\t\t}\n\n  \t\t\t\tc.instance.findAllComponents( selector, options );\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findComponent ( selector, options ) {\n  \tvar this$1 = this;\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( typeof selector === 'object' ) {\n  \t\toptions = selector;\n  \t\tselector = '';\n  \t}\n\n  \tvar child = this.fragment.findComponent( selector, options );\n  \tif ( child ) return child;\n\n  \tif ( options.remote ) {\n  \t\tif ( !selector && this._children.length ) return this._children[0].instance;\n  \t\tfor ( var i = 0; i < this$1._children.length; i++ ) {\n  \t\t\t// skip children that are or should be in an anchor\n  \t\t\tif ( this$1._children[i].target ) continue;\n  \t\t\tif ( this$1._children[i].name === selector ) return this$1._children[i].instance;\n  \t\t\tchild = this$1._children[i].instance.findComponent( selector, options );\n  \t\t\tif ( child ) return child;\n  \t\t}\n  \t}\n  }\n\n  function Ractive$findContainer ( selector ) {\n  \tif ( this.container ) {\n  \t\tif ( this.container.component && this.container.component.name === selector ) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer( selector );\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findParent ( selector ) {\n\n  \tif ( this.parent ) {\n  \t\tif ( this.parent.component && this.parent.component.name === selector ) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent ( selector );\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function enqueue ( ractive, event ) {\n  \tif ( ractive.event ) {\n  \t\tractive._eventQueue.push( ractive.event );\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue ( ractive ) {\n  \tif ( ractive._eventQueue.length ) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n  function getPotentialWildcardMatches ( keypath ) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypathI( keypath );\n  \tif( !( starMap = starMaps[ keys.length ]) ) {\n  \t\tstarMap = getStarMap( keys.length );\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function ( star, i ) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile ( i-- ) {\n  \t\twildcardKeypath = starMap[i].map( mapper ).join( '.' );\n\n  \t\tif ( !result.hasOwnProperty( wildcardKeypath ) ) {\n  \t\t\tresult.push( wildcardKeypath );\n  \t\t\tresult[ wildcardKeypath ] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap ( num ) {\n  \tvar ones = '', max, binary, starMap, mapper, i, j, l, map;\n\n  \tif ( !starMaps[ num ] ) {\n  \t\tstarMap = [];\n\n  \t\twhile ( ones.length < num ) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt( ones, 2 );\n\n  \t\tmapper = function ( digit ) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor ( i = 0; i <= max; i += 1 ) {\n  \t\t\tbinary = i.toString( 2 );\n  \t\t\twhile ( binary.length < num ) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push( mapper( binary[j] ) );\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[ num ] = starMap;\n  \t}\n\n  \treturn starMaps[ num ];\n  }\n\n  var wildcardCache = {};\n\n  function fireEvent ( ractive, eventName, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( !eventName ) { return; }\n\n  \tif ( !options.event ) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames( eventName );\n\n  \treturn fireEventAs( ractive, eventNames, options.event, options.args, true );\n  }\n\n  function getWildcardNames ( eventName ) {\n  \tif ( wildcardCache.hasOwnProperty( eventName ) ) {\n  \t\treturn wildcardCache[ eventName ];\n  \t} else {\n  \t\treturn wildcardCache[ eventName ] = getPotentialWildcardMatches( eventName );\n  \t}\n  }\n\n  function fireEventAs  ( ractive, eventNames, event, args, initialFire ) {\n\n  \tif ( initialFire === void 0 ) initialFire = false;\n\n  \tvar subscribers, i, bubble = true;\n\n  \tenqueue( ractive, event );\n\n  \tfor ( i = eventNames.length; i >= 0; i-- ) {\n  \t\tsubscribers = ractive._subs[ eventNames[ i ] ];\n\n  \t\tif ( subscribers ) {\n  \t\t\tbubble = notifySubscribers( ractive, subscribers, event, args ) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue( ractive );\n\n  \tif ( ractive.parent && bubble ) {\n\n  \t\tif ( initialFire && ractive.component ) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[ eventNames.length-1 ];\n  \t\t\teventNames = getWildcardNames( fullName );\n\n  \t\t\tif( event && !event.component ) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs( ractive.parent, eventNames, event, args );\n  \t}\n\n  \treturn bubble;\n  }\n\n  function notifySubscribers ( ractive, subscribers, event, args ) {\n  \tvar originalEvent = null, stopEvent = false;\n\n  \tif ( event && !event._noArg ) {\n  \t\targs = [ event ].concat( args );\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor ( var i = 0, len = subscribers.length; i < len; i += 1 ) {\n  \t\tif ( !subscribers[ i ].off && subscribers[ i ].apply( ractive, args ) === false ) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif ( event && !event._noArg && stopEvent && ( originalEvent = event.original ) ) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  function Ractive$fire ( eventName ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \treturn fireEvent( this, eventName, { args: args });\n  }\n\n  function badReference ( key ) {\n  \tthrow new Error( (\"An index or key reference (\" + key + \") cannot have child properties\") );\n  }\n\n  function resolveAmbiguousReference ( fragment, ref ) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypathI( ref );\n  \tvar key = keys[0];\n\n  \tvar hasContextChain;\n  \tvar crossedComponentBoundary;\n  \tvar aliases;\n\n  \twhile ( fragment ) {\n  \t\t// repeated fragments\n  \t\tif ( fragment.isIteration ) {\n  \t\t\tif ( key === fragment.parent.keyRef ) {\n  \t\t\t\tif ( keys.length > 1 ) badReference( key );\n  \t\t\t\treturn fragment.context.getKeyModel( fragment.key );\n  \t\t\t}\n\n  \t\t\tif ( key === fragment.parent.indexRef ) {\n  \t\t\t\tif ( keys.length > 1 ) badReference( key );\n  \t\t\t\treturn fragment.context.getKeyModel( fragment.index );\n  \t\t\t}\n  \t\t}\n\n  \t\t// alias node or iteration\n  \t\tif ( ( ( aliases = fragment.aliases ) ) && aliases.hasOwnProperty( key ) ) {\n  \t\t\tvar model = aliases[ key ];\n\n  \t\t\tif ( keys.length === 1 ) return model;\n  \t\t\telse if ( typeof model.joinAll === 'function' ) {\n  \t\t\t\treturn model.joinAll( keys.slice( 1 ) );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( fragment.context ) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif ( !fragment.isRoot || fragment.ractive.component ) hasContextChain = true;\n\n  \t\t\tif ( fragment.context.has( key ) ) {\n  \t\t\t\tif ( crossedComponentBoundary ) {\n  \t\t\t\t\treturn localViewmodel.createLink( key, fragment.context.joinKey( keys.shift() ), key, { implicit: true } ).joinAll( keys );\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll( keys );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( ( fragment.componentParent || ( !fragment.parent && fragment.ractive.component ) ) && !fragment.ractive.isolated ) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent || fragment.ractive.component.parentFragment;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif ( !hasContextChain ) {\n  \t\treturn localViewmodel.joinAll( keys );\n  \t}\n  }\n\n  var stack = [];\n  var captureGroup;\n\n  function startCapturing () {\n  \tstack.push( captureGroup = [] );\n  }\n\n  function stopCapturing () {\n  \tvar dependencies = stack.pop();\n  \tcaptureGroup = stack[ stack.length - 1 ];\n  \treturn dependencies;\n  }\n\n  function capture ( model ) {\n  \tif ( captureGroup ) {\n  \t\tcaptureGroup.push( model );\n  \t}\n  }\n\n  var KeyModel = function KeyModel ( key, parent ) {\n  \tthis.value = key;\n  \tthis.isReadonly = this.isKey = true;\n  \tthis.deps = [];\n  \tthis.links = [];\n  \tthis.parent = parent;\n  };\n\n  KeyModel.prototype.get = function get ( shouldCapture ) {\n  \tif ( shouldCapture ) capture( this );\n  \treturn unescapeKey( this.value );\n  };\n\n  KeyModel.prototype.getKeypath = function getKeypath () {\n  \treturn unescapeKey( this.value );\n  };\n\n  KeyModel.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.deps.length;\n  \twhile ( i-- ) this$1.deps[i].rebinding( next, previous, false );\n\n  \ti = this.links.length;\n  \twhile ( i-- ) this$1.links[i].rebinding( next, previous, false );\n  };\n\n  KeyModel.prototype.register = function register ( dependant ) {\n  \tthis.deps.push( dependant );\n  };\n\n  KeyModel.prototype.registerLink = function registerLink ( link ) {\n  \taddToArray( this.links, link );\n  };\n\n  KeyModel.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.deps, dependant );\n  };\n\n  KeyModel.prototype.unregisterLink = function unregisterLink ( link ) {\n  \tremoveFromArray( this.links, link );\n  };\n\n  function bind$1               ( x ) { x.bind(); }\n  function cancel             ( x ) { x.cancel(); }\n  function handleChange       ( x ) { x.handleChange(); }\n  function mark               ( x ) { x.mark(); }\n  function marked             ( x ) { x.marked(); }\n  function notifiedUpstream   ( x ) { x.notifiedUpstream(); }\n  function render             ( x ) { x.render(); }\n  function teardown           ( x ) { x.teardown(); }\n  function unbind             ( x ) { x.unbind(); }\n  function unrender           ( x ) { x.unrender(); }\n  function unrenderAndDestroy ( x ) { x.unrender( true ); }\n  function update             ( x ) { x.update(); }\n  function toString$1           ( x ) { return x.toString(); }\n  function toEscapedString    ( x ) { return x.toString( true ); }\n\n  var KeypathModel = function KeypathModel ( parent, ractive ) {\n  \tthis.parent = parent;\n  \tthis.ractive = ractive;\n  \tthis.value = ractive ? parent.getKeypath( ractive ) : parent.getKeypath();\n  \tthis.deps = [];\n  \tthis.children = {};\n  \tthis.isReadonly = this.isKeypath = true;\n  };\n\n  KeypathModel.prototype.get = function get ( shouldCapture ) {\n  \tif ( shouldCapture ) capture( this );\n  \treturn this.value;\n  };\n\n  KeypathModel.prototype.getChild = function getChild ( ractive ) {\n  \tif ( !( ractive._guid in this.children ) ) {\n  \t\tvar model = new KeypathModel( this.parent, ractive );\n  \t\tthis.children[ ractive._guid ] = model;\n  \t\tmodel.owner = this;\n  \t}\n  \treturn this.children[ ractive._guid ];\n  };\n\n  KeypathModel.prototype.getKeypath = function getKeypath () {\n  \treturn this.value;\n  };\n\n  KeypathModel.prototype.handleChange = function handleChange$1 () {\n  \tvar this$1 = this;\n\n  \t\tvar keys = Object.keys( this.children );\n  \tvar i = keys.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.children[ keys[i] ].handleChange();\n  \t}\n\n  \tthis.deps.forEach( handleChange );\n  };\n\n  KeypathModel.prototype.rebindChildren = function rebindChildren ( next ) {\n  \tvar this$1 = this;\n\n  \t\tvar keys = Object.keys( this.children );\n  \tvar i = keys.length;\n  \twhile ( i-- ) {\n  \t\tvar child = this$1.children[keys[i]];\n  \t\tchild.value = next.getKeypath( child.ractive );\n  \t\tchild.handleChange();\n  \t}\n  };\n\n  KeypathModel.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar this$1 = this;\n\n  \t\tvar model = next ? next.getKeypathModel( this.ractive ) : undefined;\n\n  \tvar keys = Object.keys( this.children );\n  \tvar i = keys.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.children[ keys[i] ].rebinding( next, previous, false );\n  \t}\n\n  \ti = this.deps.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.deps[i].rebinding( model, this$1, false );\n  \t}\n  };\n\n  KeypathModel.prototype.register = function register ( dep ) {\n  \tthis.deps.push( dep );\n  };\n\n  KeypathModel.prototype.removeChild = function removeChild( model ) {\n  \tif ( model.ractive ) delete this.children[ model.ractive._guid ];\n  };\n\n  KeypathModel.prototype.teardown = function teardown () {\n  \tvar this$1 = this;\n\n  \t\tif ( this.owner ) this.owner.removeChild( this );\n\n  \tvar keys = Object.keys( this.children );\n  \tvar i = keys.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.children[ keys[i] ].teardown();\n  \t}\n  };\n\n  KeypathModel.prototype.unregister = function unregister ( dep ) {\n  \tremoveFromArray( this.deps, dep );\n  \tif ( !this.deps.length ) this.teardown();\n  };\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  var shuffleTasks = { early: [], mark: [] };\n  var registerQueue = { early: [], mark: [] };\n\n  var ModelBase = function ModelBase ( parent ) {\n  \tthis.deps = [];\n\n  \tthis.children = [];\n  \tthis.childByKey = {};\n  \tthis.links = [];\n\n  \tthis.keyModels = {};\n\n  \tthis.unresolved = [];\n  \tthis.unresolvedByKey = {};\n\n  \tthis.bindings = [];\n  \tthis.patternObservers = [];\n\n  \tif ( parent ) {\n  \t\tthis.parent = parent;\n  \t\tthis.root = parent.root;\n  \t}\n  };\n\n  ModelBase.prototype.addUnresolved = function addUnresolved ( key, resolver ) {\n  \tif ( !this.unresolvedByKey[ key ] ) {\n  \t\tthis.unresolved.push( key );\n  \t\tthis.unresolvedByKey[ key ] = [];\n  \t}\n\n  \tthis.unresolvedByKey[ key ].push( resolver );\n  };\n\n  ModelBase.prototype.addShuffleTask = function addShuffleTask ( task, stage ) { if ( stage === void 0 ) stage = 'early';\n\n  \tshuffleTasks[stage].push( task ); };\n  ModelBase.prototype.addShuffleRegister = function addShuffleRegister ( item, stage ) { if ( stage === void 0 ) stage = 'early';\n\n  \tregisterQueue[stage].push({ model: this, item: item }); };\n\n  ModelBase.prototype.clearUnresolveds = function clearUnresolveds ( specificKey ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.unresolved.length;\n\n  \twhile ( i-- ) {\n  \t\tvar key = this$1.unresolved[i];\n\n  \t\tif ( specificKey && key !== specificKey ) continue;\n\n  \t\tvar resolvers = this$1.unresolvedByKey[ key ];\n  \t\tvar hasKey = this$1.has( key );\n\n  \t\tvar j = resolvers.length;\n  \t\twhile ( j-- ) {\n  \t\t\tif ( hasKey ) resolvers[j].attemptResolution();\n  \t\t\tif ( resolvers[j].resolved ) resolvers.splice( j, 1 );\n  \t\t}\n\n  \t\tif ( !resolvers.length ) {\n  \t\t\tthis$1.unresolved.splice( i, 1 );\n  \t\t\tthis$1.unresolvedByKey[ key ] = null;\n  \t\t}\n  \t}\n  };\n\n  ModelBase.prototype.findMatches = function findMatches ( keys ) {\n  \tvar len = keys.length;\n\n  \tvar existingMatches = [ this ];\n  \tvar matches;\n  \tvar i;\n\n  \tvar loop = function (  ) {\n  \t\tvar key = keys[i];\n\n  \t\tif ( key === '*' ) {\n  \t\t\tmatches = [];\n  \t\t\texistingMatches.forEach( function ( model ) {\n  \t\t\t\tmatches.push.apply( matches, model.getValueChildren( model.get() ) );\n  \t\t\t});\n  \t\t} else {\n  \t\t\tmatches = existingMatches.map( function ( model ) { return model.joinKey( key ); } );\n  \t\t}\n\n  \t\texistingMatches = matches;\n  \t};\n\n  \t\tfor ( i = 0; i < len; i += 1 ) loop(  );\n\n  \treturn matches;\n  };\n\n  ModelBase.prototype.getKeyModel = function getKeyModel ( key, skip ) {\n  \tif ( key !== undefined && !skip ) return this.parent.getKeyModel( key, true );\n\n  \tif ( !( key in this.keyModels ) ) this.keyModels[ key ] = new KeyModel( escapeKey( key ), this );\n\n  \treturn this.keyModels[ key ];\n  };\n\n  ModelBase.prototype.getKeypath = function getKeypath ( ractive ) {\n  \tif ( ractive !== this.ractive && this._link ) return this._link.target.getKeypath( ractive );\n\n  \tif ( !this.keypath ) {\n  \t\tthis.keypath = this.parent.isRoot ? this.key : (\"\" + (this.parent.getKeypath( ractive )) + \".\" + (escapeKey( this.key )));\n  \t}\n\n  \treturn this.keypath;\n  };\n\n  ModelBase.prototype.getValueChildren = function getValueChildren ( value ) {\n  \tvar this$1 = this;\n\n  \t\tvar children;\n  \tif ( isArray( value ) ) {\n  \t\tchildren = [];\n  \t\tif ( 'length' in this && this.length !== value.length ) {\n  \t\t\tchildren.push( this.joinKey( 'length' ) );\n  \t\t}\n  \t\tvalue.forEach( function ( m, i ) {\n  \t\t\tchildren.push( this$1.joinKey( i ) );\n  \t\t});\n  \t}\n\n  \telse if ( isObject( value ) || typeof value === 'function' ) {\n  \t\tchildren = Object.keys( value ).map( function ( key ) { return this$1.joinKey( key ); } );\n  \t}\n\n  \telse if ( value != null ) {\n  \t\treturn [];\n  \t}\n\n  \treturn children;\n  };\n\n  ModelBase.prototype.getVirtual = function getVirtual ( shouldCapture ) {\n  \tvar this$1 = this;\n\n  \t\tvar value = this.get( shouldCapture, { virtual: false } );\n  \tif ( isObject( value ) ) {\n  \t\tvar result = isArray( value ) ? [] : {};\n\n  \t\tvar keys = Object.keys( value );\n  \t\tvar i = keys.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar child = this$1.childByKey[ keys[i] ];\n  \t\t\tif ( !child ) result[ keys[i] ] = value[ keys[i] ];\n  \t\t\telse if ( child._link ) result[ keys[i] ] = child._link.getVirtual();\n  \t\t\telse result[ keys[i] ] = child.getVirtual();\n  \t\t}\n\n  \t\ti = this.children.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar child$1 = this$1.children[i];\n  \t\t\tif ( !( child$1.key in result ) && child$1._link ) {\n  \t\t\t\tresult[ child$1.key ] = child$1._link.getVirtual();\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result;\n  \t} else return value;\n  };\n\n  ModelBase.prototype.has = function has ( key ) {\n  \tif ( this._link ) return this._link.has( key );\n\n  \tvar value = this.get();\n  \tif ( !value ) return false;\n\n  \tkey = unescapeKey( key );\n  \tif ( hasProp.call( value, key ) ) return true;\n\n  \t// We climb up the constructor chain to find if one of them contains the key\n  \tvar constructor = value.constructor;\n  \twhile ( constructor !== Function && constructor !== Array && constructor !== Object ) {\n  \t\tif ( hasProp.call( constructor.prototype, key ) ) return true;\n  \t\tconstructor = constructor.constructor;\n  \t}\n\n  \treturn false;\n  };\n\n  ModelBase.prototype.joinAll = function joinAll ( keys, opts ) {\n  \tvar model = this;\n  \tfor ( var i = 0; i < keys.length; i += 1 ) {\n  \t\tif ( opts && opts.lastLink === false && i + 1 === keys.length && model.childByKey[keys[i]] && model.childByKey[keys[i]]._link ) return model.childByKey[keys[i]];\n  \t\tmodel = model.joinKey( keys[i], opts );\n  \t}\n\n  \treturn model;\n  };\n\n  ModelBase.prototype.notifyUpstream = function notifyUpstream () {\n  \tvar parent = this.parent, path = [ this.key ];\n  \twhile ( parent ) {\n  \t\tif ( parent.patternObservers.length ) parent.patternObservers.forEach( function ( o ) { return o.notify( path.slice() ); } );\n  \t\tpath.unshift( parent.key );\n  \t\tparent.links.forEach( notifiedUpstream );\n  \t\tparent.deps.forEach( handleChange );\n  \t\tparent = parent.parent;\n  \t}\n  };\n\n  ModelBase.prototype.rebinding = function rebinding ( next, previous, safe ) {\n  \t// tell the deps to move to the new target\n  \tvar this$1 = this;\n\n  \t\tvar i = this.deps.length;\n  \twhile ( i-- ) {\n  \t\tif ( this$1.deps[i].rebinding ) this$1.deps[i].rebinding( next, previous, safe );\n  \t}\n\n  \ti = this.links.length;\n  \twhile ( i-- ) {\n  \t\tvar link = this$1.links[i];\n  \t\t// only relink the root of the link tree\n  \t\tif ( link.owner._link ) link.relinking( next, true, safe );\n  \t}\n\n  \ti = this.children.length;\n  \twhile ( i-- ) {\n  \t\tvar child = this$1.children[i];\n  \t\tchild.rebinding( next ? next.joinKey( child.key ) : undefined, child, safe );\n  \t}\n\n  \ti = this.unresolved.length;\n  \twhile ( i-- ) {\n  \t\tvar unresolved = this$1.unresolvedByKey[ this$1.unresolved[i] ];\n  \t\tvar c = unresolved.length;\n  \t\twhile ( c-- ) {\n  \t\t\tunresolved[c].rebinding( next, previous );\n  \t\t}\n  \t}\n\n  \tif ( this.keypathModel ) this.keypathModel.rebinding( next, previous, false );\n\n  \ti = this.bindings.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.bindings[i].rebinding( next, previous, safe );\n  \t}\n  };\n\n  ModelBase.prototype.register = function register ( dep ) {\n  \tthis.deps.push( dep );\n  };\n\n  ModelBase.prototype.registerChange = function registerChange ( key, value ) {\n  \tif ( !this.isRoot ) {\n  \t\tthis.root.registerChange( key, value );\n  \t} else {\n  \t\tthis.changes[ key ] = value;\n  \t\trunloop.addInstance( this.root.ractive );\n  \t}\n  };\n\n  ModelBase.prototype.registerLink = function registerLink ( link ) {\n  \taddToArray( this.links, link );\n  };\n\n  ModelBase.prototype.registerPatternObserver = function registerPatternObserver ( observer ) {\n  \tthis.patternObservers.push( observer );\n  \tthis.register( observer );\n  };\n\n  ModelBase.prototype.registerTwowayBinding = function registerTwowayBinding ( binding ) {\n  \tthis.bindings.push( binding );\n  };\n\n  ModelBase.prototype.removeUnresolved = function removeUnresolved ( key, resolver ) {\n  \tvar resolvers = this.unresolvedByKey[ key ];\n\n  \tif ( resolvers ) {\n  \t\tremoveFromArray( resolvers, resolver );\n  \t}\n  };\n\n  ModelBase.prototype.shuffled = function shuffled () {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.children.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.children[i].shuffled();\n  \t}\n  \tif ( this.wrapper ) {\n  \t\tthis.wrapper.teardown();\n  \t\tthis.wrapper = null;\n  \t\tthis.rewrap = true;\n  \t}\n  };\n\n  ModelBase.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.deps, dependant );\n  };\n\n  ModelBase.prototype.unregisterLink = function unregisterLink ( link ) {\n  \tremoveFromArray( this.links, link );\n  };\n\n  ModelBase.prototype.unregisterPatternObserver = function unregisterPatternObserver ( observer ) {\n  \tremoveFromArray( this.patternObservers, observer );\n  \tthis.unregister( observer );\n  };\n\n  ModelBase.prototype.unregisterTwowayBinding = function unregisterTwowayBinding ( binding ) {\n  \tremoveFromArray( this.bindings, binding );\n  };\n\n  ModelBase.prototype.updateFromBindings = function updateFromBindings$1 ( cascade ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.bindings.length;\n  \twhile ( i-- ) {\n  \t\tvar value = this$1.bindings[i].getValue();\n  \t\tif ( value !== this$1.value ) this$1.set( value );\n  \t}\n\n  \t// check for one-way bindings if there are no two-ways\n  \tif ( !this.bindings.length ) {\n  \t\tvar oneway = findBoundValue( this.deps );\n  \t\tif ( oneway && oneway.value !== this.value ) this.set( oneway.value );\n  \t}\n\n  \tif ( cascade ) {\n  \t\tthis.children.forEach( updateFromBindings );\n  \t\tthis.links.forEach( updateFromBindings );\n  \t\tif ( this._link ) this._link.updateFromBindings( cascade );\n  \t}\n  };\n\n  function updateFromBindings ( model ) {\n  \tmodel.updateFromBindings( true );\n  }\n\n  function findBoundValue( list ) {\n  \tvar i = list.length;\n  \twhile ( i-- ) {\n  \t\tif ( list[i].bound ) {\n  \t\t\tvar owner = list[i].owner;\n  \t\t\tif ( owner ) {\n  \t\t\t\tvar value = owner.name === 'checked' ?\n  \t\t\t\t\towner.node.checked :\n  \t\t\t\t\towner.node.value;\n  \t\t\t\treturn { value: value };\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function fireShuffleTasks ( stage ) {\n  \tif ( !stage ) {\n  \t\tfireShuffleTasks( 'early' );\n  \t\tfireShuffleTasks( 'mark' );\n  \t} else {\n  \t\tvar tasks = shuffleTasks[stage];\n  \t\tshuffleTasks[stage] = [];\n  \t\tvar i = tasks.length;\n  \t\twhile ( i-- ) tasks[i]();\n\n  \t\tvar register = registerQueue[stage];\n  \t\tregisterQueue[stage] = [];\n  \t\ti = register.length;\n  \t\twhile ( i-- ) register[i].model.register( register[i].item );\n  \t}\n  }\n\n  KeyModel.prototype.addShuffleTask = ModelBase.prototype.addShuffleTask;\n  KeyModel.prototype.addShuffleRegister = ModelBase.prototype.addShuffleRegister;\n  KeypathModel.prototype.addShuffleTask = ModelBase.prototype.addShuffleTask;\n  KeypathModel.prototype.addShuffleRegister = ModelBase.prototype.addShuffleRegister;\n\n  // this is the dry method of checking to see if a rebind applies to\n  // a particular keypath because in some cases, a dep may be bound\n  // directly to a particular keypath e.g. foo.bars.0.baz and need\n  // to avoid getting kicked to foo.bars.1.baz if foo.bars is unshifted\n  function rebindMatch ( template, next, previous ) {\n  \tvar keypath = template.r || template;\n\n  \t// no valid keypath, go with next\n  \tif ( !keypath || typeof keypath !== 'string' ) return next;\n\n  \t// completely contextual ref, go with next\n  \tif ( keypath === '.' || keypath[0] === '@' || (next || previous).isKey || (next || previous).isKeypath ) return next;\n\n  \tvar parts = keypath.split( '/' );\n  \tvar keys = splitKeypathI( parts[ parts.length - 1 ] );\n\n  \t// check the keypath against the model keypath to see if it matches\n  \tvar model = next || previous;\n  \tvar i = keys.length;\n  \tvar match = true, shuffling = false;\n\n  \twhile ( model && i-- ) {\n  \t\tif ( model.shuffling ) shuffling = true;\n  \t\t// non-strict comparison to account for indices in keypaths\n  \t\tif ( keys[i] != model.key ) match = false;\n  \t\tmodel = model.parent;\n  \t}\n\n  \t// next is undefined, but keypath is shuffling and previous matches\n  \tif ( !next && match && shuffling ) return previous;\n  \t// next is defined, but doesn't match the keypath\n  \telse if ( next && !match && shuffling ) return previous;\n  \telse return next;\n  }\n\n  // temporary placeholder target for detached implicit links\n  var missing = {\n  \tkey: '@missing',\n  \tanimate: noop,\n  \tapplyValue: noop,\n  \tget: noop,\n  \tgetKeypath: function () { return this.key; },\n  \tjoinAll: function () { return this; },\n  \tjoinKey: function () { return this; },\n  \tmark: noop,\n  \tshufle: noop,\n  \tset: noop,\n  \tunregisterLink: noop\n  };\n  missing.parent = missing;\n\n  var LinkModel = (function (ModelBase) {\n  \tfunction LinkModel ( parent, owner, target, key ) {\n  \t\tModelBase.call( this, parent );\n\n  \t\tthis.owner = owner;\n  \t\tthis.target = target;\n  \t\tthis.key = key === undefined ? owner.key : key;\n  \t\tif ( owner.isLink ) this.sourcePath = \"\" + (owner.sourcePath) + \".\" + (this.key);\n\n  \t\ttarget.registerLink( this );\n\n  \t\tthis.isReadonly = parent.isReadonly;\n\n  \t\tthis.isLink = true;\n  \t}\n\n  \tLinkModel.prototype = Object.create( ModelBase && ModelBase.prototype );\n  \tLinkModel.prototype.constructor = LinkModel;\n\n  \tLinkModel.prototype.animate = function animate ( from, to, options, interpolator ) {\n  \t\tthis.target.animate( from, to, options, interpolator );\n  \t};\n\n  \tLinkModel.prototype.applyValue = function applyValue ( value ) {\n  \t\tthis.target.applyValue( value );\n  \t};\n\n  \tLinkModel.prototype.attach = function attach ( fragment ) {\n  \t\tvar model = resolveReference( fragment, this.key );\n  \t\tif ( model ) {\n  \t\t\tthis.relinking( model, true, false );\n  \t\t} else { // if there is no link available, move everything here to real models\n  \t\t\tthis.owner.unlink();\n  \t\t}\n  \t};\n\n  \tLinkModel.prototype.detach = function detach () {\n  \t\tthis.relinking( missing, true, false );\n  \t};\n\n  \tLinkModel.prototype.get = function get ( shouldCapture, opts ) {\n  \t\tif ( shouldCapture ) {\n  \t\t\tcapture( this );\n\n  \t\t\t// may need to tell the target to unwrap\n  \t\t\topts = opts || {};\n  \t\t\topts.unwrap = true;\n  \t\t}\n\n  \t\treturn this.target.get( false, opts );\n  \t};\n\n  \tLinkModel.prototype.getKeypath = function getKeypath ( ractive ) {\n  \t\tif ( ractive && ractive !== this.root.ractive ) return this.target.getKeypath( ractive );\n\n  \t\treturn ModelBase.prototype.getKeypath.call( this, ractive );\n  \t};\n\n  \tLinkModel.prototype.getKeypathModel = function getKeypathModel ( ractive ) {\n  \t\tif ( !this.keypathModel ) this.keypathModel = new KeypathModel( this );\n  \t\tif ( ractive && ractive !== this.root.ractive ) return this.keypathModel.getChild( ractive );\n  \t\treturn this.keypathModel;\n  \t};\n\n  \tLinkModel.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.links.forEach( handleChange );\n  \t\tthis.notifyUpstream();\n  \t};\n\n  \tLinkModel.prototype.isDetached = function isDetached () { return this.virtual && this.target === missing; };\n\n  \tLinkModel.prototype.joinKey = function joinKey ( key ) {\n  \t\t// TODO: handle nested links\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new LinkModel( this, this, this.target.joinKey( key ), key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tLinkModel.prototype.mark = function mark () {\n  \t\tthis.target.mark();\n  \t};\n\n  \tLinkModel.prototype.marked = function marked$1 () {\n  \t\tthis.links.forEach( marked );\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tLinkModel.prototype.notifiedUpstream = function notifiedUpstream$1 () {\n  \t\tthis.links.forEach( notifiedUpstream );\n  \t\tthis.deps.forEach( handleChange );\n  \t};\n\n  \tLinkModel.prototype.relinked = function relinked () {\n  \t\tthis.target.registerLink( this );\n  \t\tthis.children.forEach( function ( c ) { return c.relinked(); } );\n  \t};\n\n  \tLinkModel.prototype.relinking = function relinking ( target, root, safe ) {\n  \t\tvar this$1 = this;\n\n  \t\tif ( root && this.sourcePath ) target = rebindMatch( this.sourcePath, target, this.target );\n  \t\tif ( !target || this.target === target ) return;\n\n  \t\tthis.target.unregisterLink( this );\n  \t\tif ( this.keypathModel ) this.keypathModel.rebindChildren( target );\n\n  \t\tthis.target = target;\n  \t\tthis.children.forEach( function ( c ) {\n  \t\t\tc.relinking( target.joinKey( c.key ), false, safe );\n  \t\t});\n\n  \t\tif ( root ) this.addShuffleTask( function () {\n  \t\t\tthis$1.relinked();\n  \t\t\tif ( !safe ) this$1.notifyUpstream();\n  \t\t});\n  \t};\n\n  \tLinkModel.prototype.set = function set ( value ) {\n  \t\tthis.target.set( value );\n  \t};\n\n  \tLinkModel.prototype.shuffle = function shuffle ( newIndices ) {\n  \t\t// watch for extra shuffles caused by a shuffle in a downstream link\n  \t\tvar this$1 = this;\n\n  \t\tif ( this.shuffling ) return;\n\n  \t\t// let the real model handle firing off shuffles\n  \t\tif ( !this.target.shuffling ) {\n  \t\t\tthis.target.shuffle( newIndices );\n  \t\t} else {\n  \t\t\tthis.shuffling = true;\n\n  \t\t\tvar i = newIndices.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tvar idx = newIndices[ i ];\n  \t\t\t\t// nothing is actually changing, so move in the index and roll on\n  \t\t\t\tif ( i === idx ) {\n  \t\t\t\t\tcontinue;\n  \t\t\t\t}\n\n  \t\t\t\t// rebind the children on i to idx\n  \t\t\t\tif ( i in this$1.childByKey ) this$1.childByKey[ i ].rebinding( !~idx ? undefined : this$1.joinKey( idx ), this$1.childByKey[ i ], true );\n\n  \t\t\t\tif ( !~idx && this$1.keyModels[ i ] ) {\n  \t\t\t\t\tthis$1.keyModels[i].rebinding( undefined, this$1.keyModels[i], false );\n  \t\t\t\t} else if ( ~idx && this$1.keyModels[ i ] ) {\n  \t\t\t\t\tif ( !this$1.keyModels[ idx ] ) this$1.childByKey[ idx ].getKeyModel( idx );\n  \t\t\t\t\tthis$1.keyModels[i].rebinding( this$1.keyModels[ idx ], this$1.keyModels[i], false );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tvar upstream = this.source().length !== this.source().value.length;\n\n  \t\t\tthis.links.forEach( function ( l ) { return l.shuffle( newIndices ); } );\n\n  \t\t\ti = this.deps.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( this$1.deps[i].shuffle ) this$1.deps[i].shuffle( newIndices );\n  \t\t\t}\n\n  \t\t\tthis.marked();\n\n  \t\t\tif ( upstream ) this.notifyUpstream();\n\n  \t\t\tthis.shuffling = false;\n  \t\t}\n\n  \t};\n\n  \tLinkModel.prototype.source = function source () {\n  \t\tif ( this.target.source ) return this.target.source();\n  \t\telse return this.target;\n  \t};\n\n  \tLinkModel.prototype.teardown = function teardown$1 () {\n  \t\tif ( this._link ) this._link.teardown();\n  \t\tthis.children.forEach( teardown );\n  \t};\n\n  \treturn LinkModel;\n  }(ModelBase));\n\n  ModelBase.prototype.link = function link ( model, keypath, options ) {\n  \tvar lnk = this._link || new LinkModel( this.parent, this, model, this.key );\n  \tlnk.implicit = options && options.implicit;\n  \tlnk.sourcePath = keypath;\n  \tif ( this._link ) this._link.relinking( model, true, false );\n  \tthis.rebinding( lnk, this, false );\n  \tfireShuffleTasks();\n\n  \tvar unresolved = !this._link;\n  \tthis._link = lnk;\n  \tif ( unresolved ) this.parent.clearUnresolveds();\n  \tlnk.marked();\n  \treturn lnk;\n  };\n\n  ModelBase.prototype.unlink = function unlink () {\n  \tif ( this._link ) {\n  \t\tvar ln = this._link;\n  \t\tthis._link = undefined;\n  \t\tln.rebinding( this, this._link );\n  \t\tfireShuffleTasks();\n  \t\tln.teardown();\n  \t}\n  };\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if ( !win ) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function(vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif ( win.requestAnimationFrame ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor ( x = 0; x < vendors.length && !win.requestAnimationFrame; ++x ) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x]+'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif ( !win.requestAnimationFrame ) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function(callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max( 0, 16 - (currTime - lastTime ) );\n  \t\t\t\tid = setTimeout( function() { callback(currTime + timeToCall); }, timeToCall );\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n\n  \t}( vendors, 0, win ));\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = ( win && win.performance && typeof win.performance.now === 'function' ) ?\n  \tfunction () { return win.performance.now(); } :\n  \tfunction () { return Date.now(); };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick () {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i;\n  \tvar ticker;\n\n  \tfor ( i = 0; i < tickers.length; i += 1 ) {\n  \t\tticker = tickers[i];\n\n  \t\tif ( !ticker.tick( now ) ) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice( i--, 1 );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif ( tickers.length ) {\n  \t\trAF( tick );\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = function Ticker ( options ) {\n  \tthis.duration = options.duration;\n  \tthis.step = options.step;\n  \tthis.complete = options.complete;\n  \tthis.easing = options.easing;\n\n  \tthis.start = getTime();\n  \tthis.end = this.start + this.duration;\n\n  \tthis.running = true;\n\n  \ttickers.push( this );\n  \tif ( !running ) rAF( tick );\n  };\n\n  Ticker.prototype.tick = function tick$1 ( now ) {\n  \tif ( !this.running ) return false;\n\n  \tif ( now > this.end ) {\n  \t\tif ( this.step ) this.step( 1 );\n  \t\tif ( this.complete ) this.complete( 1 );\n\n  \t\treturn false;\n  \t}\n\n  \tvar elapsed = now - this.start;\n  \tvar eased = this.easing( elapsed / this.duration );\n\n  \tif ( this.step ) this.step( eased );\n\n  \treturn true;\n  };\n\n  Ticker.prototype.stop = function stop () {\n  \tif ( this.abort ) this.abort();\n  \tthis.running = false;\n  };\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath ( obj, prefix ) {\n  \tvar prefixed = {}, key;\n\n  \tif ( !prefix ) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor ( key in obj ) {\n  \t\tif ( obj.hasOwnProperty( key ) ) {\n  \t\t\tprefixed[ prefix + key ] = obj[ key ];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n\n  function getPrefixer ( rootKeypath ) {\n  \tvar rootDot;\n\n  \tif ( !prefixers[ rootKeypath ] ) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[ rootKeypath ] = function ( relativeKeypath, value ) {\n  \t\t\tvar obj;\n\n  \t\t\tif ( typeof relativeKeypath === 'string' ) {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[ rootDot + relativeKeypath ] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif ( typeof relativeKeypath === 'object' ) {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath( relativeKeypath, rootKeypath ) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[ rootKeypath ];\n  }\n\n  var Model = (function (ModelBase) {\n  \tfunction Model ( parent, key ) {\n  \t\tModelBase.call( this, parent );\n\n  \t\tthis.ticker = null;\n\n  \t\tif ( parent ) {\n  \t\t\tthis.key = unescapeKey( key );\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif ( parent.value ) {\n  \t\t\t\tthis.value = parent.value[ this.key ];\n  \t\t\t\tif ( isArray( this.value ) ) this.length = this.value.length;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype = Object.create( ModelBase && ModelBase.prototype );\n  \tModel.prototype.constructor = Model;\n\n  \tModel.prototype.adapt = function adapt () {\n  \t\tvar this$1 = this;\n\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar len = adaptors.length;\n\n  \t\tthis.rewrap = false;\n\n  \t\t// Exit early if no adaptors\n  \t\tif ( len === 0 ) return;\n\n  \t\tvar value = this.wrapper ? ( 'newWrapperValue' in this ? this.newWrapperValue : this.wrapperValue ) : this.value;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\t// tear previous adaptor down if present\n  \t\tif ( this.wrapper ) {\n  \t\t\tvar shouldTeardown = this.wrapperValue === value ? false : !this.wrapper.reset || this.wrapper.reset( value ) === false;\n\n  \t\t\tif ( shouldTeardown ) {\n  \t\t\t\tthis.wrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n\n  \t\t\t\t// don't branch for undefined values\n  \t\t\t\tif ( this.value !== undefined ) {\n  \t\t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch( this.key );\n  \t\t\t\t\tif ( parentValue[ this.key ] !== value ) parentValue[ this.key ] = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tdelete this.newWrapperValue;\n  \t\t\t\tthis.wrapperValue = value;\n  \t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif ( adaptor.filter( value, keypath, ractive ) ) {\n  \t\t\t\tthis$1.wrapper = adaptor.wrap( ractive, value, keypath, getPrefixer( keypath ) );\n  \t\t\t\tthis$1.wrapperValue = value;\n  \t\t\t\tthis$1.wrapper.__model = this$1; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis$1.value = this$1.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.animate = function animate ( from, to, options, interpolator ) {\n  \t\tvar this$1 = this;\n\n  \t\tif ( this.ticker ) this.ticker.stop();\n\n  \t\tvar fulfilPromise;\n  \t\tvar promise = new Promise$1( function ( fulfil ) { return fulfilPromise = fulfil; } );\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function ( t ) {\n  \t\t\t\tvar value = interpolator( t );\n  \t\t\t\tthis$1.applyValue( value );\n  \t\t\t\tif ( options.step ) options.step( t, value );\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\tthis$1.applyValue( to );\n  \t\t\t\tif ( options.complete ) options.complete( to );\n\n  \t\t\t\tthis$1.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue ( value ) {\n  \t\tif ( isEqual( value, this.value ) ) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.registerChange( this.getKeypath(), value );\n\n  \t\tif ( this.parent.wrapper && this.parent.wrapper.set ) {\n  \t\t\tthis.parent.wrapper.set( this.key, value );\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[ this.key ];\n  \t\t\tif ( this.wrapper ) this.newWrapperValue = this.value;\n  \t\t\tthis.adapt();\n  \t\t} else if ( this.wrapper ) {\n  \t\t\tthis.newWrapperValue = value;\n  \t\t\tthis.adapt();\n  \t\t} else {\n  \t\t\tvar parentValue = this.parent.value || this.parent.createBranch( this.key );\n  \t\t\tparentValue[ this.key ] = value;\n\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// keep track of array length\n  \t\tif ( isArray( value ) ) this.length = value.length;\n\n  \t\t// notify dependants\n  \t\tthis.links.forEach( handleChange );\n  \t\tthis.children.forEach( mark );\n  \t\tthis.deps.forEach( handleChange );\n\n  \t\tthis.notifyUpstream();\n\n  \t\tif ( this.key === 'length' && isArray( this.parent.value ) ) this.parent.length = this.parent.value.length;\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch ( key ) {\n  \t\tvar branch = isNumeric( key ) ? [] : {};\n  \t\tthis.set( branch );\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.get = function get ( shouldCapture, opts ) {\n  \t\tif ( this._link ) return this._link.get( shouldCapture, opts );\n  \t\tif ( shouldCapture ) capture( this );\n  \t\t// if capturing, this value needs to be unwrapped because it's for external use\n  \t\tif ( opts && opts.virtual ) return this.getVirtual( false );\n  \t\treturn ( shouldCapture || ( opts && opts.unwrap ) ) && this.wrapper ? this.wrapperValue : this.value;\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel ( ractive ) {\n  \t\tif ( !this.keypathModel ) this.keypathModel = new KeypathModel( this );\n  \t\treturn this.keypathModel;\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey ( key, opts ) {\n  \t\tif ( this._link ) {\n  \t\t\tif ( opts && opts.lastLink !== false && ( key === undefined || key === '' ) ) return this;\n  \t\t\treturn this._link.joinKey( key );\n  \t\t}\n\n  \t\tif ( key === undefined || key === '' ) return this;\n\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new Model( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\tif ( this.childByKey[ key ]._link && ( !opts || opts.lastLink !== false ) ) return this.childByKey[ key ]._link;\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tModel.prototype.mark = function mark$1 () {\n  \t\tif ( this._link ) return this._link.mark();\n\n  \t\tvar value = this.retrieve();\n\n  \t\tif ( !isEqual( value, this.value ) ) {\n  \t\t\tvar old = this.value;\n  \t\t\tthis.value = value;\n\n  \t\t\t// make sure the wrapper stays in sync\n  \t\t\tif ( old !== value || this.rewrap ) {\n  \t\t\t\tif ( this.wrapper ) this.newWrapperValue = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\t\t// keep track of array lengths\n  \t\t\tif ( isArray( value ) ) this.length = value.length;\n\n  \t\t\tthis.children.forEach( mark );\n  \t\t\tthis.links.forEach( marked );\n\n  \t\t\tthis.deps.forEach( handleChange );\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge ( array, comparator ) {\n  \t\tvar oldArray = this.value, newArray = array;\n  \t\tif ( oldArray === newArray ) oldArray = recreateArray( this );\n  \t\tif ( comparator ) {\n  \t\t\toldArray = oldArray.map( comparator );\n  \t\t\tnewArray = newArray.map( comparator );\n  \t\t}\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map( function ( item ) {\n  \t\t\tvar index;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf( item, start );\n\n  \t\t\t\tif ( index === -1 ) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while ( ( usedIndices[ index ] === true ) && start < oldLength );\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif ( index === firstUnusedIndex ) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[ index ] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[ this.key ] = array;\n  \t\tthis.shuffle( newIndices );\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve () {\n  \t\treturn this.parent.value ? this.parent.value[ this.key ] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set ( value ) {\n  \t\tif ( this.ticker ) this.ticker.stop();\n  \t\tthis.applyValue( value );\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle ( newIndices ) {\n  \t\tvar this$1 = this;\n\n  \t\tthis.shuffling = true;\n  \t\tvar i = newIndices.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar idx = newIndices[ i ];\n  \t\t\t// nothing is actually changing, so move in the index and roll on\n  \t\t\tif ( i === idx ) {\n  \t\t\t\tcontinue;\n  \t\t\t}\n\n  \t\t\t// rebind the children on i to idx\n  \t\t\tif ( i in this$1.childByKey ) this$1.childByKey[ i ].rebinding( !~idx ? undefined : this$1.joinKey( idx ), this$1.childByKey[ i ], true );\n\n  \t\t\tif ( !~idx && this$1.keyModels[ i ] ) {\n  \t\t\t\tthis$1.keyModels[i].rebinding( undefined, this$1.keyModels[i], false );\n  \t\t\t} else if ( ~idx && this$1.keyModels[ i ] ) {\n  \t\t\t\tif ( !this$1.keyModels[ idx ] ) this$1.childByKey[ idx ].getKeyModel( idx );\n  \t\t\t\tthis$1.keyModels[i].rebinding( this$1.keyModels[ idx ], this$1.keyModels[i], false );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar upstream = this.length !== this.value.length;\n\n  \t\tthis.links.forEach( function ( l ) { return l.shuffle( newIndices ); } );\n  \t\tfireShuffleTasks( 'early' );\n\n  \t\ti = this.deps.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( this$1.deps[i].shuffle ) this$1.deps[i].shuffle( newIndices );\n  \t\t}\n\n  \t\tthis.mark();\n  \t\tfireShuffleTasks( 'mark' );\n\n  \t\tif ( upstream ) this.notifyUpstream();\n  \t\tthis.shuffling = false;\n  \t};\n\n  \tModel.prototype.teardown = function teardown$1 () {\n  \t\tif ( this._link ) this._link.teardown();\n  \t\tthis.children.forEach( teardown );\n  \t\tif ( this.wrapper ) this.wrapper.teardown();\n  \t\tif ( this.keypathModel ) this.keypathModel.teardown();\n  \t};\n\n  \treturn Model;\n  }(ModelBase));\n\n  function recreateArray( model ) {\n  \tvar array = [];\n\n  \tfor ( var i = 0; i < model.length; i++ ) {\n  \t\tarray[ i ] = (model.childByKey[i] || {}).value;\n  \t}\n\n  \treturn array;\n  }\n\n  var GlobalModel = (function (Model) {\n  \tfunction GlobalModel ( ) {\n  \t\tModel.call( this, null, '@global' );\n  \t\tthis.value = typeof global !== 'undefined' ? global : window;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t}\n\n  \tGlobalModel.prototype = Object.create( Model && Model.prototype );\n  \tGlobalModel.prototype.constructor = GlobalModel;\n\n  \tGlobalModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@global';\n  \t};\n\n  \t// global model doesn't contribute changes events because it has no instance\n  \tGlobalModel.prototype.registerChange = function registerChange () {};\n\n  \treturn GlobalModel;\n  }(Model));\n\n  var GlobalModel$1 = new GlobalModel();\n\n  var keypathExpr = /^@[^\\(]+\\(([^\\)]+)\\)/;\n\n  function resolveReference ( fragment, ref ) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif ( ref === '.' || ref === 'this' ) return context;\n  \tif ( ref.indexOf( '@keypath' ) === 0 ) {\n  \t\tvar match = keypathExpr.exec( ref );\n  \t\tif ( match && match[1] ) {\n  \t\t\tvar model = resolveReference( fragment, match[1] );\n  \t\t\tif ( model ) return model.getKeypathModel();\n  \t\t}\n  \t\treturn context.getKeypathModel();\n  \t}\n  \tif ( ref.indexOf( '@rootpath' ) === 0 ) {\n  \t\t// check to see if this is an empty component root\n  \t\twhile ( context.isRoot && context.ractive.component ) {\n  \t\t\tcontext = context.ractive.component.parentFragment.findContext();\n  \t\t}\n\n  \t\tvar match$1 = keypathExpr.exec( ref );\n  \t\tif ( match$1 && match$1[1] ) {\n  \t\t\tvar model$1 = resolveReference( fragment, match$1[1] );\n  \t\t\tif ( model$1 ) return model$1.getKeypathModel( fragment.ractive.root );\n  \t\t}\n  \t\treturn context.getKeypathModel( fragment.ractive.root );\n  \t}\n  \tif ( ref === '@index' || ref === '@key' ) {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif ( !repeater.isIteration ) return;\n  \t\treturn repeater.context.getKeyModel( repeater[ ref[1] === 'i' ? 'index' : 'key' ] );\n  \t}\n  \tif ( ref === '@this' ) {\n  \t\treturn fragment.ractive.viewmodel.getRactiveModel();\n  \t}\n  \tif ( ref === '@global' ) {\n  \t\treturn GlobalModel$1;\n  \t}\n\n  \t// ancestor references\n  \tif ( ref[0] === '~' ) return fragment.ractive.viewmodel.joinAll( splitKeypathI( ref.slice( 2 ) ) );\n  \tif ( ref[0] === '.' ) {\n  \t\tvar parts = ref.split( '/' );\n\n  \t\twhile ( parts[0] === '.' || parts[0] === '..' ) {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif ( part === '..' ) {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join( '/' );\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif ( ref[0] === '.' ) ref = ref.slice( 1 );\n  \t\treturn context.joinAll( splitKeypathI( ref ) );\n  \t}\n\n  \treturn resolveAmbiguousReference( fragment, ref );\n  }\n\n  function Ractive$get ( keypath, opts ) {\n  \tif ( typeof keypath !== 'string' ) return this.viewmodel.get( true, keypath );\n\n  \tvar keys = splitKeypathI( keypath );\n  \tvar key = keys[0];\n\n  \tvar model;\n\n  \tif ( !this.viewmodel.has( key ) ) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif ( this.component && !this.isolated ) {\n  \t\t\tmodel = resolveReference( this.component.parentFragment, key );\n\n  \t\t\tif ( model ) {\n  \t\t\t\tthis.viewmodel.map( key, model, { implicit: true } );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll( keys );\n  \treturn model.get( true, opts );\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices ( length, methodName, args ) {\n  \tvar spliceArguments, newIndices = [], removeStart, removeEnd, balance, i;\n\n  \tspliceArguments = getSpliceEquivalent( length, methodName, args );\n\n  \tif ( !spliceArguments ) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = ( spliceArguments.length - 2 ) - spliceArguments[1];\n\n  \tremoveStart = Math.min( length, spliceArguments[0] );\n  \tremoveEnd = removeStart + spliceArguments[1];\n  \tnewIndices.startIndex = removeStart;\n\n  \tfor ( i = 0; i < removeStart; i += 1 ) {\n  \t\tnewIndices.push( i );\n  \t}\n\n  \tfor ( ; i < removeEnd; i += 1 ) {\n  \t\tnewIndices.push( -1 );\n  \t}\n\n  \tfor ( ; i < length; i += 1 ) {\n  \t\tnewIndices.push( i + balance );\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif ( balance !== 0 ) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent ( length, methodName, args ) {\n  \tswitch ( methodName ) {\n  \t\tcase 'splice':\n  \t\t\tif ( args[0] !== undefined && args[0] < 0 ) {\n  \t\t\t\targs[0] = length + Math.max( args[0], -length );\n  \t\t\t}\n\n  \t\t\tif ( args[0] === undefined ) args[0] = 0;\n\n  \t\t\twhile ( args.length < 2 ) {\n  \t\t\t\targs.push( length - args[0] );\n  \t\t\t}\n\n  \t\t\tif ( typeof args[1] !== 'number' ) {\n  \t\t\t\targs[1] = length - args[0];\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min( args[1], length - args[0] );\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif ( length ) {\n  \t\t\t\treturn [ length - 1, 1 ];\n  \t\t\t}\n  \t\t\treturn [ 0, 0 ];\n\n  \t\tcase 'push':\n  \t\t\treturn [ length, 0 ].concat( args );\n\n  \t\tcase 'shift':\n  \t\t\treturn [ 0, length ? 1 : 0 ];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [ 0, 0 ].concat( args );\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod ( methodName ) {\n  \tfunction path ( keypath ) {\n  \t\tvar args = [], len = arguments.length - 1;\n  \t\twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \t\treturn model( this.viewmodel.joinAll( splitKeypathI( keypath ) ), args );\n  \t}\n\n  \tfunction model ( mdl, args ) {\n  \t\tvar array = mdl.get();\n\n  \t\tif ( !isArray( array ) ) {\n  \t\t\tif ( array === undefined ) {\n  \t\t\t\tarray = [];\n  \t\t\t\tvar result$1 = arrayProto[ methodName ].apply( array, args );\n  \t\t\t\tvar promise$1 = runloop.start( this, true ).then( function () { return result$1; } );\n  \t\t\t\tmdl.set( array );\n  \t\t\t\trunloop.end();\n  \t\t\t\treturn promise$1;\n  \t\t\t} else {\n  \t\t\t\tthrow new Error( (\"shuffle array method \" + methodName + \" called on non-array at \" + (mdl.getKeypath())) );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices( array.length, methodName, args );\n  \t\tvar result = arrayProto[ methodName ].apply( array, args );\n\n  \t\tvar promise = runloop.start( this, true ).then( function () { return result; } );\n  \t\tpromise.result = result;\n\n  \t\tif ( newIndices ) {\n  \t\t\tmdl.shuffle( newIndices );\n  \t\t} else {\n  \t\t\tmdl.set( result );\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t}\n\n  \treturn { path: path, model: model };\n  }\n\n  var comparators = {};\n\n  function getComparator ( option ) {\n  \tif ( !option ) return null; // use existing arrays\n  \tif ( option === true ) return JSON.stringify;\n  \tif ( typeof option === 'function' ) return option;\n\n  \tif ( typeof option === 'string' ) {\n  \t\treturn comparators[ option ] || ( comparators[ option ] = function ( thing ) { return thing[ option ]; } );\n  \t}\n\n  \tthrow new Error( 'If supplied, options.compare must be a string, function, or `true`' ); // TODO link to docs\n  }\n\n  function merge$1 ( ractive, model, array, options ) {\n  \tvar promise = runloop.start( ractive, true );\n  \tvar value = model.get();\n  \tif ( array === undefined ) array = value;\n\n  \tif ( !isArray( value ) || !isArray( array ) ) {\n  \t\tthrow new Error( 'You cannot merge an array with a non-array' );\n  \t}\n\n  \tvar comparator = getComparator( options && options.compare );\n  \tmodel.merge( array, comparator );\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function thisRactive$merge ( keypath, array, options ) {\n  \treturn merge$1( this, this.viewmodel.joinAll( splitKeypathI( keypath ) ), array, options );\n  }\n\n  var updateHook = new Hook( 'update' );\n\n  function update$2 ( ractive, model ) {\n  \t// if the parent is wrapped, the adaptor will need to be updated before\n  \t// updating on this keypath\n  \tif ( model.parent && model.parent.wrapper ) {\n  \t\tmodel.parent.adapt();\n  \t}\n\n  \tvar promise = runloop.start( ractive, true );\n\n  \tmodel.mark();\n  \tmodel.registerChange( model.getKeypath(), model.get() );\n\n  \tif ( !model.isRoot ) {\n  \t\t// there may be unresolved refs that are now resolvable up the context tree\n  \t\tvar parent = model.parent, key = model.key;\n  \t\twhile ( parent && !parent.isRoot ) {\n  \t\t\tif ( parent.clearUnresolveds ) parent.clearUnresolveds( key );\n  \t\t\tkey = parent.key;\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t}\n\n  \t// notify upstream of changes\n  \tmodel.notifyUpstream();\n\n  \trunloop.end();\n\n  \tupdateHook.fire( ractive, model );\n\n  \treturn promise;\n  }\n\n  function Ractive$update ( keypath ) {\n  \tif ( keypath ) keypath = splitKeypathI( keypath );\n\n  \treturn update$2( this, keypath ? this.viewmodel.joinAll( keypath ) : this.viewmodel );\n  }\n\n  var modelPush = makeArrayMethod( 'push' ).model;\n  var modelPop = makeArrayMethod( 'pop' ).model;\n  var modelShift = makeArrayMethod( 'shift' ).model;\n  var modelUnshift = makeArrayMethod( 'unshift' ).model;\n  var modelSort = makeArrayMethod( 'sort' ).model;\n  var modelSplice = makeArrayMethod( 'splice' ).model;\n  var modelReverse = makeArrayMethod( 'reverse' ).model;\n\n  // TODO: at some point perhaps this could support relative * keypaths?\n  function build$1 ( el, keypath, value ) {\n  \tvar sets = [];\n\n  \t// set multiple keypaths in one go\n  \tif ( isObject( keypath ) ) {\n  \t\tfor ( var k in keypath ) {\n  \t\t\tif ( keypath.hasOwnProperty( k ) ) {\n  \t\t\t\tsets.push( [ findModel( el, k ).model, keypath[k] ] );\n  \t\t\t}\n  \t\t}\n\n  \t}\n  \t// set a single keypath\n  \telse {\n  \t\tsets.push( [ findModel( el, keypath ).model, value ] );\n  \t}\n\n  \treturn sets;\n  }\n\n  // get relative keypaths and values\n  function get ( keypath ) {\n  \tif ( !keypath ) return this._element.parentFragment.findContext().get( true );\n\n  \tvar model = resolveReference( this._element.parentFragment, keypath );\n\n  \treturn model ? model.get( true ) : undefined;\n  }\n\n  function resolve$1 ( path, ractive ) {\n  \tvar ref = findModel( this, path ), model = ref.model, instance = ref.instance;\n  \treturn model ? model.getKeypath( ractive || instance ) : path;\n  }\n\n  function findModel ( el, path ) {\n  \tvar frag = el._element.parentFragment;\n\n  \tif ( typeof path !== 'string' ) {\n  \t\treturn { model: frag.findContext(), instance: path };\n  \t}\n\n  \treturn { model: resolveReference( frag, path ), instance: frag.ractive };\n  }\n\n  // the usual mutation suspects\n  function add$1 ( keypath, value ) {\n  \tif ( value === undefined ) value = 1;\n  \tif ( !isNumeric( value ) ) throw new Error( 'Bad arguments' );\n  \treturn set( this.ractive, build$1( this, keypath, value ).map( function ( pair ) {\n  \t\tvar model = pair[0], val = pair[1], value = model.get();\n  \t\tif ( !isNumeric( val ) || !isNumeric( value ) ) throw new Error( 'Cannot add non-numeric value' );\n  \t\treturn [ model, value + val ];\n  \t}) );\n  }\n\n  function animate ( keypath, value, options ) {\n  \tvar model = findModel( this, keypath ).model;\n  \treturn protoAnimate( this.ractive, model, value, options );\n  }\n\n  function link ( source, dest ) {\n  \tvar there = findModel( this, source ).model, here = findModel( this, dest ).model;\n  \tvar promise = runloop.start( this.ractive, true );\n  \there.link( there, source );\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function merge ( keypath, array, options ) {\n  \treturn merge$1( this.ractive, findModel( this, keypath ).model, array, options );\n  }\n\n  function pop ( keypath ) {\n  \treturn modelPop( findModel( this, keypath ).model, [] );\n  }\n\n  function push ( keypath ) {\n  \tvar values = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) values[ len ] = arguments[ len + 1 ];\n\n  \treturn modelPush( findModel( this, keypath ).model, values );\n  }\n\n  function reverse ( keypath ) {\n  \treturn modelReverse( findModel( this, keypath ).model, [] );\n  }\n\n  function set$1 ( keypath, value ) {\n  \treturn set( this.ractive, build$1( this, keypath, value ) );\n  }\n\n  function shift ( keypath ) {\n  \treturn modelShift( findModel( this, keypath ).model, [] );\n  }\n\n  function splice ( keypath, index, drop ) {\n  \tvar add = [], len = arguments.length - 3;\n  \twhile ( len-- > 0 ) add[ len ] = arguments[ len + 3 ];\n\n  \tadd.unshift( index, drop );\n  \treturn modelSplice( findModel( this, keypath ).model, add );\n  }\n\n  function sort ( keypath ) {\n  \treturn modelSort( findModel( this, keypath ).model, [] );\n  }\n\n  function subtract ( keypath, value ) {\n  \tif ( value === undefined ) value = 1;\n  \tif ( !isNumeric( value ) ) throw new Error( 'Bad arguments' );\n  \treturn set( this.ractive, build$1( this, keypath, value ).map( function ( pair ) {\n  \t\tvar model = pair[0], val = pair[1], value = model.get();\n  \t\tif ( !isNumeric( val ) || !isNumeric( value ) ) throw new Error( 'Cannot add non-numeric value' );\n  \t\treturn [ model, value - val ];\n  \t}) );\n  }\n\n  function toggle ( keypath ) {\n  \tvar ref = findModel( this, keypath ), model = ref.model;\n  \treturn set( this.ractive, [ [ model, !model.get() ] ] );\n  }\n\n  function unlink ( dest ) {\n  \tvar here = findModel( this, dest ).model;\n  \tvar promise = runloop.start( this.ractive, true );\n  \tif ( here.owner && here.owner._link ) here.owner.unlink();\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function unshift ( keypath ) {\n  \tvar add = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) add[ len ] = arguments[ len + 1 ];\n\n  \treturn modelUnshift( findModel( this, keypath ).model, add );\n  }\n\n  function update$1 ( keypath ) {\n  \treturn update$2( this.ractive, findModel( this, keypath ).model );\n  }\n\n  function updateModel ( keypath, cascade ) {\n  \tvar ref = findModel( this, keypath ), model = ref.model;\n  \tvar promise = runloop.start( this.ractive, true );\n  \tmodel.updateFromBindings( cascade );\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  // two-way binding related helpers\n  function isBound () {\n  \tvar ref = getBindingModel( this ), model = ref.model;\n  \treturn !!model;\n  }\n\n  function getBindingPath ( ractive ) {\n  \tvar ref = getBindingModel( this ), model = ref.model, instance = ref.instance;\n  \tif ( model ) return model.getKeypath( ractive || instance );\n  }\n\n  function getBinding () {\n  \tvar ref = getBindingModel( this ), model = ref.model;\n  \tif ( model ) return model.get( true );\n  }\n\n  function getBindingModel ( ctx ) {\n  \tvar el = ctx._element;\n  \treturn { model: el.binding && el.binding.model, instance: el.parentFragment.ractive };\n  }\n\n  function setBinding ( value ) {\n  \tvar ref = getBindingModel( this ), model = ref.model;\n  \treturn set( this.ractive, [ [ model, value ] ] );\n  }\n\n  function addHelpers ( obj, element ) {\n  \tdefineProperties( obj, {\n  \t\t_element: { value: element },\n  \t\tractive: { value: element.parentFragment.ractive },\n  \t\tresolve: { value: resolve$1 },\n  \t\tget: { value: get },\n\n  \t\tadd: { value: add$1 },\n  \t\tanimate: { value: animate },\n  \t\tlink: { value: link },\n  \t\tmerge: { value: merge },\n  \t\tpop: { value: pop },\n  \t\tpush: { value: push },\n  \t\treverse: { value: reverse },\n  \t\tset: { value: set$1 },\n  \t\tshift: { value: shift },\n  \t\tsort: { value: sort },\n  \t\tsplice: { value: splice },\n  \t\tsubtract: { value: subtract },\n  \t\ttoggle: { value: toggle },\n  \t\tunlink: { value: unlink },\n  \t\tunshift: { value: unshift },\n  \t\tupdate: { value: update$1 },\n  \t\tupdateModel: { value: updateModel },\n\n  \t\tisBound: { value: isBound },\n  \t\tgetBindingPath: { value: getBindingPath },\n  \t\tgetBinding: { value: getBinding },\n  \t\tsetBinding: { value: setBinding },\n  \t});\n\n  \treturn obj;\n  }\n\n  var query = doc && doc.querySelector;\n\n  function staticInfo( node ) {\n  \tif ( typeof node === 'string' && query ) {\n  \t\tnode = query.call( document, node );\n  \t}\n\n  \tif ( !node || !node._ractive ) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn addHelpers( {}, storage.proxy );\n  }\n\n  function getNodeInfo( node, options ) {\n  \tif ( typeof node === 'string' ) {\n  \t\tnode = this.find( node, options );\n  \t}\n\n  \treturn staticInfo( node );\n  }\n\n  var insertHook = new Hook( 'insert' );\n\n  function Ractive$insert ( target, anchor ) {\n  \tif ( !this.fragment.rendered ) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error( 'The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.' );\n  \t}\n\n  \ttarget = getElement( target );\n  \tanchor = getElement( anchor ) || null;\n\n  \tif ( !target ) {\n  \t\tthrow new Error( 'You must specify a valid target to insert into' );\n  \t}\n\n  \ttarget.insertBefore( this.detach(), anchor );\n  \tthis.el = target;\n\n  \t( target.__ractive_instances__ || ( target.__ractive_instances__ = [] ) ).push( this );\n  \tthis.isDetached = false;\n\n  \tfireInsertHook( this );\n  }\n\n  function fireInsertHook( ractive ) {\n  \tinsertHook.fire( ractive );\n\n  \tractive.findAllComponents('*').forEach( function ( child ) {\n  \t\tfireInsertHook( child.instance );\n  \t});\n  }\n\n  function link$1( there, here, options ) {\n  \tif ( here === there || (there + '.').indexOf( here + '.' ) === 0 || (here + '.').indexOf( there + '.' ) === 0 ) {\n  \t\tthrow new Error( 'A keypath cannot be linked to itself.' );\n  \t}\n\n  \tvar promise = runloop.start();\n  \tvar model;\n  \tvar target = ( options && options.ractive ) || this;\n\n  \t// may need to allow a mapping to resolve implicitly\n  \tvar sourcePath = splitKeypathI( there );\n  \tif ( !target.viewmodel.has( sourcePath[0] ) && target.component ) {\n  \t\tmodel = resolveReference( target.component.parentFragment, sourcePath[0] );\n  \t\tmodel = model.joinAll( sourcePath.slice( 1 ) );\n  \t}\n\n  \tthis.viewmodel.joinAll( splitKeypathI( here ) ).link( model || target.viewmodel.joinAll( sourcePath ), there );\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var ReferenceResolver = function ReferenceResolver ( fragment, reference, callback ) {\n  \tvar this$1 = this;\n\n  \t\tthis.fragment = fragment;\n  \tthis.reference = normalise( reference );\n  \tthis.callback = callback;\n\n  \tthis.keys = splitKeypathI( reference );\n  \tthis.resolved = false;\n\n  \tthis.contexts = [];\n\n  \t// TODO the consumer should take care of addUnresolved\n  \t// we attach to all the contexts between here and the root\n  \t// - whenever their values change, they can quickly\n  \t// check to see if we can resolve\n  \twhile ( fragment ) {\n  \t\tif ( fragment.context ) {\n  \t\t\tfragment.context.addUnresolved( this$1.keys[0], this$1 );\n  \t\t\tthis$1.contexts.push( fragment.context );\n  \t\t}\n\n  \t\tfragment = fragment.componentParent || fragment.parent;\n  \t}\n  };\n\n  ReferenceResolver.prototype.attemptResolution = function attemptResolution () {\n  \tif ( this.resolved ) return;\n\n  \tvar model = resolveAmbiguousReference( this.fragment, this.reference );\n\n  \tif ( model ) {\n  \t\tthis.resolved = true;\n  \t\tthis.callback( model );\n  \t}\n  };\n\n  ReferenceResolver.prototype.forceResolution = function forceResolution () {\n  \tif ( this.resolved ) return;\n\n  \tvar model = this.fragment.findContext().joinAll( this.keys );\n  \tthis.callback( model );\n  \tthis.resolved = true;\n  };\n\n  ReferenceResolver.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar this$1 = this;\n\n  \t\tif ( previous ) previous.removeUnresolved( this.keys[0], this );\n  \tif ( next ) runloop.scheduleTask( function () { return next.addUnresolved( this$1.keys[0], this$1 ); } );\n  };\n\n  ReferenceResolver.prototype.unbind = function unbind () {\n  \tvar this$1 = this;\n\n  \t\tif ( this.fragment ) removeFromArray( this.fragment.unresolved, this );\n\n  \tif ( this.resolved ) return;\n\n  \tthis.contexts.forEach( function ( c ) { return c.removeUnresolved( this$1.keys[0], this$1 ); } );\n  };\n\n  function observe ( keypath, callback, options ) {\n  \tvar this$1 = this;\n\n  \tvar observers = [];\n  \tvar map;\n\n  \tif ( isObject( keypath ) ) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys( map ).forEach( function ( keypath ) {\n  \t\t\tvar callback = map[ keypath ];\n\n  \t\t\tvar keypaths = keypath.split( ' ' );\n  \t\t\tif ( keypaths.length > 1 ) keypaths = keypaths.filter( function ( k ) { return k; } );\n\n  \t\t\tkeypaths.forEach( function ( keypath ) {\n  \t\t\t\tobservers.push( createObserver( this$1, keypath, callback, options ) );\n  \t\t\t});\n  \t\t});\n  \t}\n\n  \telse {\n  \t\tvar keypaths;\n\n  \t\tif ( typeof keypath === 'function' ) {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [ '' ];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split( ' ' );\n  \t\t}\n\n  \t\tif ( keypaths.length > 1 ) keypaths = keypaths.filter( function ( k ) { return k; } );\n\n  \t\tkeypaths.forEach( function ( keypath ) {\n  \t\t\tobservers.push( createObserver( this$1, keypath, callback, options || {} ) );\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply( this._observers, observers );\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach( function ( observer ) {\n  \t\t\t\tremoveFromArray ( this$1._observers, observer );\n  \t\t\t\tobserver.cancel();\n  \t\t\t} );\n  \t\t}\n  \t};\n  }\n\n  function createObserver ( ractive, keypath, callback, options ) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypathI( keypath );\n  \tvar wildcardIndex = keys.indexOf( '*' );\n  \toptions.keypath = keypath;\n\n  \t// normal keypath - no wildcards\n  \tif ( !~wildcardIndex ) {\n  \t\tvar key = keys[0];\n  \t\tvar model;\n\n  \t\t// if not the root model itself, check if viewmodel has key.\n  \t\tif ( key !== '' && !viewmodel.has( key ) ) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif ( ractive.component && !ractive.isolated ) {\n  \t\t\t\tmodel = resolveReference( ractive.component.parentFragment, key );\n  \t\t\t\tif ( model ) {\n  \t\t\t\t\tviewmodel.map( key, model );\n  \t\t\t\t\tmodel = viewmodel.joinAll( keys );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else {\n  \t\t\tmodel = viewmodel.joinAll( keys );\n  \t\t}\n\n  \t\treturn new Observer( ractive, model, callback, options );\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ?\n  \t\tviewmodel :\n  \t\tviewmodel.joinAll( keys.slice( 0, wildcardIndex ) );\n\n  \treturn new PatternObserver( ractive, baseModel, keys.splice( wildcardIndex ), callback, options );\n  }\n\n  var Observer = function Observer ( ractive, model, callback, options ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = options.context || ractive;\n  \tthis.callback = callback;\n  \tthis.ractive = ractive;\n\n  \tif ( model ) this.resolved( model );\n  \telse {\n  \t\tthis.keypath = options.keypath;\n  \t\tthis.resolver = new ReferenceResolver( ractive.fragment, options.keypath, function ( model ) {\n  \t\t\tthis$1.resolved( model );\n  \t\t});\n  \t}\n\n  \tif ( options.init !== false ) {\n  \t\tthis.dirty = true;\n  \t\tthis.dispatch();\n  \t} else {\n  \t\tthis.oldValue = this.newValue;\n  \t}\n\n  \tthis.defer = options.defer;\n  \tthis.once = options.once;\n  \tthis.strict = options.strict;\n\n  \tthis.dirty = false;\n  };\n\n  Observer.prototype.cancel = function cancel () {\n  \tthis.cancelled = true;\n  \tif ( this.model ) {\n  \t\tthis.model.unregister( this );\n  \t} else {\n  \t\tthis.resolver.unbind();\n  \t}\n  };\n\n  Observer.prototype.dispatch = function dispatch () {\n  \tif ( !this.cancelled ) {\n  \t\tthis.callback.call( this.context, this.newValue, this.oldValue, this.keypath );\n  \t\tthis.oldValue = this.model ? this.model.get() : this.newValue;\n  \t\tthis.dirty = false;\n  \t}\n  };\n\n  Observer.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\tvar newValue = this.model.get();\n  \t\tif ( isEqual( newValue, this.oldValue ) ) return;\n\n  \t\tthis.newValue = newValue;\n\n  \t\tif ( this.strict && this.newValue === this.oldValue ) return;\n\n  \t\trunloop.addObserver( this, this.defer );\n  \t\tthis.dirty = true;\n\n  \t\tif ( this.once ) runloop.scheduleTask( function () { return this$1.cancel(); } );\n  \t}\n  };\n\n  Observer.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar this$1 = this;\n\n  \t\tnext = rebindMatch( this.keypath, next, previous );\n  \t// TODO: set up a resolver if next is undefined?\n  \tif ( next === this.model ) return false;\n\n  \tif ( this.model ) this.model.unregister( this );\n  \tif ( next ) next.addShuffleTask( function () { return this$1.resolved( next ); } );\n  };\n\n  Observer.prototype.resolved = function resolved ( model ) {\n  \tthis.model = model;\n  \tthis.keypath = model.getKeypath( this.ractive );\n\n  \tthis.oldValue = undefined;\n  \tthis.newValue = model.get();\n\n  \tmodel.register( this );\n  };\n\n  var PatternObserver = function PatternObserver ( ractive, baseModel, keys, callback, options ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = options.context || ractive;\n  \tthis.ractive = ractive;\n  \tthis.baseModel = baseModel;\n  \tthis.keys = keys;\n  \tthis.callback = callback;\n\n  \tvar pattern = keys.join( '\\\\.' ).replace( /\\*/g, '(.+)' );\n  \tvar baseKeypath = baseModel.getKeypath( ractive );\n  \tthis.pattern = new RegExp( (\"^\" + (baseKeypath ? baseKeypath + '\\\\.' : '') + \"\" + pattern + \"$\") );\n\n  \tthis.oldValues = {};\n  \tthis.newValues = {};\n\n  \tthis.defer = options.defer;\n  \tthis.once = options.once;\n  \tthis.strict = options.strict;\n\n  \tthis.dirty = false;\n  \tthis.changed = [];\n  \tthis.partial = false;\n\n  \tvar models = baseModel.findMatches( this.keys );\n\n  \tmodels.forEach( function ( model ) {\n  \t\tthis$1.newValues[ model.getKeypath( this$1.ractive ) ] = model.get();\n  \t});\n\n  \tif ( options.init !== false ) {\n  \t\tthis.dispatch();\n  \t} else {\n  \t\tthis.oldValues = this.newValues;\n  \t}\n\n  \tbaseModel.registerPatternObserver( this );\n  };\n\n  PatternObserver.prototype.cancel = function cancel () {\n  \tthis.baseModel.unregisterPatternObserver( this );\n  };\n\n  PatternObserver.prototype.dispatch = function dispatch () {\n  \tvar this$1 = this;\n\n  \t\tObject.keys( this.newValues ).forEach( function ( keypath ) {\n  \t\tif ( this$1.newKeys && !this$1.newKeys[ keypath ] ) return;\n\n  \t\tvar newValue = this$1.newValues[ keypath ];\n  \t\tvar oldValue = this$1.oldValues[ keypath ];\n\n  \t\tif ( this$1.strict && newValue === oldValue ) return;\n  \t\tif ( isEqual( newValue, oldValue ) ) return;\n\n  \t\tvar args = [ newValue, oldValue, keypath ];\n  \t\tif ( keypath ) {\n  \t\t\tvar wildcards = this$1.pattern.exec( keypath );\n  \t\t\tif ( wildcards ) {\n  \t\t\t\targs = args.concat( wildcards.slice( 1 ) );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis$1.callback.apply( this$1.context, args );\n  \t});\n\n  \tif ( this.partial ) {\n  \t\tfor ( var k in this.newValues ) {\n  \t\t\tthis.oldValues[k] = this.newValues[k];\n  \t\t}\n  \t} else {\n  \t\tthis.oldValues = this.newValues;\n  \t}\n\n  \tthis.newKeys = null;\n  \tthis.dirty = false;\n  };\n\n  PatternObserver.prototype.notify = function notify ( key ) {\n  \tthis.changed.push( key );\n  };\n\n  PatternObserver.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !isArray( this.baseModel.value ) ) return;\n\n  \tvar base = this.baseModel.getKeypath( this.ractive );\n  \tvar max = this.baseModel.value.length;\n  \tvar suffix = this.keys.length > 1 ? '.' + this.keys.slice( 1 ).join( '.' ) : '';\n\n  \tthis.newKeys = {};\n  \tfor ( var i = 0; i < newIndices.length; i++ ) {\n  \t\tif ( newIndices[ i ] === -1 || newIndices[ i ] === i ) continue;\n  \t\tthis$1.newKeys[ (\"\" + base + \".\" + i + \"\" + suffix) ] = true;\n  \t}\n\n  \tfor ( var i$1 = newIndices.touchedFrom; i$1 < max; i$1++ ) {\n  \t\tthis$1.newKeys[ (\"\" + base + \".\" + i$1 + \"\" + suffix) ] = true;\n  \t}\n  };\n\n  PatternObserver.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty || this.changed.length ) {\n  \t\tif ( !this.dirty ) this.newValues = {};\n\n  \t\t// handle case where previously extant keypath no longer exists -\n  \t\t// observer should still fire, with undefined as new value\n  \t\t// TODO huh. according to the test suite that's not the case...\n  \t\t// NOTE: I don't think this will work with partial updates\n  \t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t// this.newValues[ keypath ] = undefined;\n  \t\t// });\n\n  \t\tif ( !this.changed.length ) {\n  \t\t\tthis.baseModel.findMatches( this.keys ).forEach( function ( model ) {\n  \t\t\t\tvar keypath = model.getKeypath( this$1.ractive );\n  \t\t\t\tthis$1.newValues[ keypath ] = model.get();\n  \t\t\t});\n  \t\t\tthis.partial = false;\n  \t\t} else {\n  \t\t\tvar count = 0;\n  \t\t\tvar ok = this.baseModel.isRoot ?\n  \t\t\t\tthis.changed.map( function ( keys ) { return keys.map( escapeKey ).join( '.' ); } ) :\n  \t\t\t\tthis.changed.map( function ( keys ) { return this$1.baseModel.getKeypath( this$1.ractive ) + '.' + keys.map( escapeKey ).join( '.' ); } );\n\n  \t\t\tthis.baseModel.findMatches( this.keys ).forEach( function ( model ) {\n  \t\t\t\tvar keypath = model.getKeypath( this$1.ractive );\n  \t\t\t\t// is this model on a changed keypath?\n  \t\t\t\tif ( ok.filter( function ( k ) { return keypath.indexOf( k ) === 0 || k.indexOf( keypath ) === 0; } ).length ) {\n  \t\t\t\t\tcount++;\n  \t\t\t\t\tthis$1.newValues[ keypath ] = model.get();\n  \t\t\t\t}\n  \t\t\t});\n\n  \t\t\t// no valid change triggered, so bail to avoid breakage\n  \t\t\tif ( !count ) return;\n\n  \t\t\tthis.partial = true;\n  \t\t}\n\n  \t\trunloop.addObserver( this, this.defer );\n  \t\tthis.dirty = true;\n  \t\tthis.changed.length = 0;\n\n  \t\tif ( this.once ) this.cancel();\n  \t}\n  };\n\n  function observeList ( keypath, callback, options ) {\n  \tif ( typeof keypath !== 'string' ) {\n  \t\tthrow new Error( 'ractive.observeList() must be passed a string as its first argument' );\n  \t}\n\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar observer = new ListObserver( this, model, callback, options || {} );\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push( observer );\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne () {\n  \treturn -1;\n  }\n\n  var ListObserver = function ListObserver ( context, model, callback, options ) {\n  \tthis.context = context;\n  \tthis.model = model;\n  \tthis.keypath = model.getKeypath();\n  \tthis.callback = callback;\n\n  \tthis.pending = null;\n\n  \tmodel.register( this );\n\n  \tif ( options.init !== false ) {\n  \t\tthis.sliced = [];\n  \t\tthis.shuffle([]);\n  \t\tthis.handleChange();\n  \t} else {\n  \t\tthis.sliced = this.slice();\n  \t}\n  };\n\n  ListObserver.prototype.handleChange = function handleChange () {\n  \tif ( this.pending ) {\n  \t\t// post-shuffle\n  \t\tthis.callback( this.pending );\n  \t\tthis.pending = null;\n  \t}\n\n  \telse {\n  \t\t// entire array changed\n  \t\tthis.shuffle( this.sliced.map( negativeOne ) );\n  \t\tthis.handleChange();\n  \t}\n  };\n\n  ListObserver.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tvar newValue = this.slice();\n\n  \tvar inserted = [];\n  \tvar deleted = [];\n  \tvar start;\n\n  \tvar hadIndex = {};\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\thadIndex[ newIndex ] = true;\n\n  \t\tif ( newIndex !== oldIndex && start === undefined ) {\n  \t\t\tstart = oldIndex;\n  \t\t}\n\n  \t\tif ( newIndex === -1 ) {\n  \t\t\tdeleted.push( this$1.sliced[ oldIndex ] );\n  \t\t}\n  \t});\n\n  \tif ( start === undefined ) start = newIndices.length;\n\n  \tvar len = newValue.length;\n  \tfor ( var i = 0; i < len; i += 1 ) {\n  \t\tif ( !hadIndex[i] ) inserted.push( newValue[i] );\n  \t}\n\n  \tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \tthis.sliced = newValue;\n  };\n\n  ListObserver.prototype.slice = function slice () {\n  \tvar value = this.model.get();\n  \treturn isArray( value ) ? value.slice() : [];\n  };\n\n  var onceOptions = { init: false, once: true };\n\n  function observeOnce ( keypath, callback, options ) {\n  \tif ( isObject( keypath ) || typeof keypath === 'function' ) {\n  \t\toptions = extendObj( callback || {}, onceOptions );\n  \t\treturn this.observe( keypath, options );\n  \t}\n\n  \toptions = extendObj( options || {}, onceOptions );\n  \treturn this.observe( keypath, callback, options );\n  }\n\n  function trim ( str ) { return str.trim(); };\n\n  function notEmptyString ( str ) { return str !== ''; };\n\n  function Ractive$off ( eventName, callback ) {\n  \t// if no arguments specified, remove all callbacks\n  \tvar this$1 = this;\n\n  \tif ( !eventName ) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor ( eventName in this._subs ) {\n  \t\t\tdelete this._subs[ eventName ];\n  \t\t}\n  \t}\n\n  \telse {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split( ' ' ).map( trim ).filter( notEmptyString );\n\n  \t\teventNames.forEach( function ( eventName ) {\n  \t\t\tvar subscribers = this$1._subs[ eventName ];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif ( subscribers ) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif ( callback ) {\n  \t\t\t\t\t// flag this callback as off so that any in-flight firings don't call\n  \t\t\t\t\t// a cancelled handler - this is _slightly_ hacky\n  \t\t\t\t\tcallback.off = true;\n  \t\t\t\t\tvar index = subscribers.indexOf( callback );\n  \t\t\t\t\tif ( index !== -1 ) {\n  \t\t\t\t\t\tsubscribers.splice( index, 1 );\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\tthis$1._subs[ eventName ] = [];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  function Ractive$on ( eventName, callback ) {\n  \t// allow multiple listeners to be bound in one go\n  \tvar this$1 = this;\n\n  \tif ( typeof eventName === 'object' ) {\n  \t\tvar listeners = [];\n  \t\tvar n;\n\n  \t\tfor ( n in eventName ) {\n  \t\t\tif ( eventName.hasOwnProperty( n ) ) {\n  \t\t\t\tlisteners.push( this.on( n, eventName[ n ] ) );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn {\n  \t\t\tcancel: function () {\n  \t\t\t\tvar listener;\n  \t\t\t\twhile ( listener = listeners.pop() ) listener.cancel();\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split( ' ' ).map( trim ).filter( notEmptyString );\n\n  \teventNames.forEach( function ( eventName ) {\n  \t\t( this$1._subs[ eventName ] || ( this$1._subs[ eventName ] = [] ) ).push( callback );\n  \t});\n\n  \treturn {\n  \t\tcancel: function () { return this$1.off( eventName, callback ); }\n  \t};\n  }\n\n  function Ractive$once ( eventName, handler ) {\n  \tvar listener = this.on( eventName, function () {\n  \t\thandler.apply( this, arguments );\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  var pop$1 = makeArrayMethod( 'pop' ).path;\n\n  var push$1 = makeArrayMethod( 'push' ).path;\n\n  var PREFIX = '/* Ractive.js component styles */';\n\n  // Holds current definitions of styles.\n  var styleDefinitions = [];\n\n  // Flag to tell if we need to update the CSS\n  var isDirty = false;\n\n  // These only make sense on the browser. See additional setup below.\n  var styleElement = null;\n  var useCssText = null;\n\n  function addCSS( styleDefinition ) {\n  \tstyleDefinitions.push( styleDefinition );\n  \tisDirty = true;\n  }\n\n  function applyCSS() {\n\n  \t// Apply only seems to make sense when we're in the DOM. Server-side renders\n  \t// can call toCSS to get the updated CSS.\n  \tif ( !doc || !isDirty ) return;\n\n  \tif ( useCssText ) {\n  \t\tstyleElement.styleSheet.cssText = getCSS( null );\n  \t} else {\n  \t\tstyleElement.innerHTML = getCSS( null );\n  \t}\n\n  \tisDirty = false;\n  }\n\n  function getCSS( cssIds ) {\n\n  \tvar filteredStyleDefinitions = cssIds ? styleDefinitions.filter( function ( style ) { return ~cssIds.indexOf( style.id ); } ) : styleDefinitions;\n\n  \treturn filteredStyleDefinitions.reduce( function ( styles, style ) { return (\"\" + styles + \"\\n\\n/* {\" + (style.id) + \"} */\\n\" + (style.styles)); }, PREFIX );\n\n  }\n\n  // If we're on the browser, additional setup needed.\n  if ( doc && ( !styleElement || !styleElement.parentNode ) ) {\n\n  \tstyleElement = doc.createElement( 'style' );\n  \tstyleElement.type = 'text/css';\n\n  \tdoc.getElementsByTagName( 'head' )[ 0 ].appendChild( styleElement );\n\n  \tuseCssText = !!styleElement.styleSheet;\n  }\n\n  var adaptConfigurator = {\n  \textend: function ( Parent, proto, options ) {\n  \t\tproto.adapt = combine( proto.adapt, ensureArray( options.adapt ) );\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine ( a, b ) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( !~c.indexOf( b[i] ) ) {\n  \t\t\tc.push( b[i] );\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*[\\s\\S]*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>~:]))+)((?:::?[^\\s\\+\\>\\~\\(:]+(?:\\([^\\)]+\\))?)*\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var excludePattern = /^(?:@|\\d+%)/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1 ( str ) {\n  \treturn str.trim();\n  }\n\n  function extractString ( unit ) {\n  \treturn unit.str;\n  }\n\n  function transformSelector ( selector, parent ) {\n  \tvar selectorUnits = [];\n  \tvar match;\n\n  \twhile ( match = selectorUnitPattern.exec( selector ) ) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map( extractString );\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile ( i-- ) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push( appended.join( ' ' ), prepended.join( ' ' ) );\n  \t}\n\n  \treturn transformed.join( ', ' );\n  }\n\n  function transformCss ( css, id ) {\n  \tvar dataAttr = \"[data-ractive-css~=\\\"{\" + id + \"}\\\"]\";\n\n  \tvar transformed;\n\n  \tif ( dataRvcGuidPattern.test( css ) ) {\n  \t\ttransformed = css.replace( dataRvcGuidPattern, dataAttr );\n  \t} else {\n  \t\ttransformed = css\n  \t\t.replace( commentsPattern, '' )\n  \t\t.replace( selectorsPattern, function ( match, $1 ) {\n  \t\t\t// don't transform at-rules and keyframe declarations\n  \t\t\tif ( excludePattern.test( $1 ) ) return match;\n\n  \t\t\tvar selectors = $1.split( ',' ).map( trim$1 );\n  \t\t\tvar transformed = selectors\n  \t\t\t\t.map( function ( selector ) { return transformSelector( selector, dataAttr ); } )\n  \t\t\t\t.join( ', ' ) + ' ';\n\n  \t\t\treturn match.replace( $1, transformed );\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  function s4() {\n  \treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n  }\n\n  function uuid() {\n  \treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n  }\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \t// Called when creating a new component definition\n  \textend: function ( Parent, proto, options ) {\n  \t\tif ( !options.css ) return;\n\n  \t\tvar id = uuid();\n  \t\tvar styles = options.noCssTransform ? options.css : transformCss( options.css, id );\n\n  \t\tproto.cssId = id;\n\n  \t\taddCSS( { id: id, styles: styles } );\n\n  \t},\n\n  \t// Called when creating a new component instance\n  \tinit: function ( Parent, target, options ) {\n  \t\tif ( !options.css ) return;\n\n  \t\twarnIfDebug( (\"\\nThe css option is currently not supported on a per-instance basis and will be discarded. Instead, we recommend instantiating from a component definition with a css option.\\n\\nconst Component = Ractive.extend({\\n\\t...\\n\\tcss: '/* your css */',\\n\\t...\\n});\\n\\nconst componentInstance = new Component({ ... })\\n\\t\\t\") );\n  \t}\n\n  };\n\n  function validate ( data ) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif ( data && data.constructor !== Object ) {\n  \t\tif ( typeof data === 'function' ) {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if ( typeof data !== 'object' ) {\n  \t\t\tfatal( (\"data option must be an object or a function, `\" + data + \"` is not valid\") );\n  \t\t} else {\n  \t\t\twarnIfDebug( 'If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged' );\n  \t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function ( Parent, proto, options ) {\n  \t\tvar key;\n  \t\tvar value;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif ( options.data && isObject( options.data ) ) {\n  \t\t\tfor ( key in options.data ) {\n  \t\t\t\tvalue = options.data[ key ];\n\n  \t\t\t\tif ( value && typeof value === 'object' ) {\n  \t\t\t\t\tif ( isObject( value ) || isArray( value ) ) {\n  \t\t\t\t\t\twarnIfDebug( (\"Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }\") );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1( proto.data, options.data );\n  \t},\n\n  \tinit: function ( Parent, ractive, options ) {\n  \t\tvar result = combine$1( Parent.prototype.data, options.data );\n\n  \t\tif ( typeof result === 'function' ) result = result.call( ractive );\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif ( result && result.constructor === Object ) {\n  \t\t\tfor ( var prop in result ) {\n  \t\t\t\tif ( typeof result[ prop ] === 'function' ) result[ prop ] = bind( result[ prop ], ractive );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function ( ractive ) {\n  \t\tvar result = this.init( ractive.constructor, ractive, ractive.viewmodel );\n  \t\tractive.viewmodel.root.set( result );\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1 ( parentValue, childValue ) {\n  \tvalidate( childValue );\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif ( !childValue && !parentIsFn ) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif ( !parentIsFn && !childIsFn ) {\n  \t\treturn fromProperties( childValue, parentValue );\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction( childValue, this ) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction( parentValue, this ) : parentValue;\n\n  \t\treturn fromProperties( child, parent );\n  \t};\n  }\n\n  function callDataFunction ( fn, context ) {\n  \tvar data = fn.call( context );\n\n  \tif ( !data ) return;\n\n  \tif ( typeof data !== 'object' ) {\n  \t\tfatal( 'Data function must return an object' );\n  \t}\n\n  \tif ( data.constructor !== Object ) {\n  \t\twarnOnceIfDebug( 'Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged' );\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties ( primary, secondary ) {\n  \tif ( primary && secondary ) {\n  \t\tfor ( var key in secondary ) {\n  \t\t\tif ( !( key in primary ) ) {\n  \t\t\t\tprimary[ key ] = secondary[ key ];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  var TEMPLATE_VERSION = 4;\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function fromExpression ( body, length ) {\n  \tif ( length === void 0 ) length = 0;\n\n  \tvar args = new Array( length );\n\n  \twhile ( length-- ) {\n  \t\targs[length] = \"_\" + length;\n  \t}\n\n  \t// Functions created directly with new Function() look like this:\n  \t//     function anonymous (_0 /**/) { return _0*2 }\n  \t//\n  \t// With this workaround, we get a little more compact:\n  \t//     function (_0){return _0*2}\n  \treturn new Function( [], (\"return function (\" + (args.join(',')) + \"){return(\" + body + \");};\") )();\n  }\n\n  function fromComputationString ( str, bindTo ) {\n  \tvar hasThis;\n\n  \tvar functionBody = 'return (' + str.replace( pattern, function ( match, keypath ) {\n  \t\thasThis = true;\n  \t\treturn (\"__ractive.get(\\\"\" + keypath + \"\\\")\");\n  \t}) + ');';\n\n  \tif ( hasThis ) functionBody = \"var __ractive = this; \" + functionBody;\n  \tvar fn = new Function( functionBody );\n  \treturn hasThis ? fn.bind( bindTo ) : fn;\n  }\n\n  var functions = create( null );\n\n  function getFunction ( str, i ) {\n  \tif ( functions[ str ] ) return functions[ str ];\n  \treturn functions[ str ] = createFunction( str, i );\n  }\n\n  function addFunctions( template ) {\n  \tif ( !template ) return;\n\n  \tvar exp = template.e;\n\n  \tif ( !exp ) return;\n\n  \tObject.keys( exp ).forEach( function ( str ) {\n  \t\tif ( functions[ str ] ) return;\n  \t\tfunctions[ str ] = exp[ str ];\n  \t});\n  }\n\n  var parse = null;\n\n  var parseOptions = [\n  \t'delimiters',\n  \t'tripleDelimiters',\n  \t'staticDelimiters',\n  \t'staticTripleDelimiters',\n  \t'csp',\n  \t'interpolate',\n  \t'preserveWhitespace',\n  \t'sanitize',\n  \t'stripComments',\n  \t'contextLines'\n  ];\n\n  var TEMPLATE_INSTRUCTIONS = \"Either preparse or use a ractive runtime source that includes the parser. \";\n\n  var COMPUTATION_INSTRUCTIONS = \"Either use:\\n\\n\\tRactive.parse.computedStrings( component.computed )\\n\\nat build time to pre-convert the strings to functions, or use functions instead of strings in computed properties.\";\n\n\n  function throwNoParse ( method, error, instructions ) {\n  \tif ( !method ) {\n  \t\tfatal( (\"Missing Ractive.parse - cannot parse \" + error + \". \" + instructions) );\n  \t}\n  }\n\n  function createFunction ( body, length ) {\n  \tthrowNoParse( fromExpression, 'new expression function', TEMPLATE_INSTRUCTIONS );\n  \treturn fromExpression( body, length );\n  }\n\n  function createFunctionFromString ( str, bindTo ) {\n  \tthrowNoParse( fromComputationString, 'compution string \"${str}\"', COMPUTATION_INSTRUCTIONS );\n  \treturn fromComputationString( str, bindTo );\n  }\n\n  var parser = {\n\n  \tfromId: function ( id, options ) {\n  \t\tif ( !doc ) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Cannot retrieve template #\" + id + \" as Ractive is not running in a browser.\") );\n  \t\t}\n\n  \t\tif ( id ) id = id.replace( /^#/, '' );\n\n  \t\tvar template;\n\n  \t\tif ( !( template = doc.getElementById( id ) )) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Could not find template element with id #\" + id) );\n  \t\t}\n\n  \t\tif ( template.tagName.toUpperCase() !== 'SCRIPT' ) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Template element with id #\" + id + \", must be a <script> element\") );\n  \t\t}\n\n  \t\treturn ( 'textContent' in template ? template.textContent : template.innerHTML );\n\n  \t},\n\n  \tisParsed: function ( template) {\n  \t\treturn !( typeof template === 'string' );\n  \t},\n\n  \tgetParseOptions: function ( ractive ) {\n  \t\t// Could be Ractive or a Component\n  \t\tif ( ractive.defaults ) { ractive = ractive.defaults; }\n\n  \t\treturn parseOptions.reduce( function ( val, key ) {\n  \t\t\tval[ key ] = ractive[ key ];\n  \t\t\treturn val;\n  \t\t}, {});\n  \t},\n\n  \tparse: function ( template, options ) {\n  \t\tthrowNoParse( parse, 'template', TEMPLATE_INSTRUCTIONS );\n  \t\tvar parsed = parse( template, options );\n  \t\taddFunctions( parsed );\n  \t\treturn parsed;\n  \t},\n\n  \tparseFor: function( template, ractive ) {\n  \t\treturn this.parse( template, this.getParseOptions( ractive ) );\n  \t}\n  };\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function ( Parent, proto, options ) {\n  \t\t// only assign if exists\n  \t\tif ( 'template' in options ) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif ( typeof template === 'function' ) {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseTemplate( template, proto );\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function ( Parent, ractive, options ) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif ( typeof template === 'function' ) {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate( ractive, fn );\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseTemplate( template, ractive );\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif ( template.p ) {\n  \t\t\textendPartials( ractive.partials, template.p );\n  \t\t}\n  \t},\n\n  \treset: function ( ractive ) {\n  \t\tvar result = resetValue( ractive );\n\n  \t\tif ( result ) {\n  \t\t\tvar parsed = parseTemplate( result, ractive );\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials( ractive.partials, parsed.p, true );\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue ( ractive ) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif ( !initial || !initial.fn ) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate( ractive, initial.fn );\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif ( result !== initial.result ) {\n  \t\tinitial.result = result;\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate ( ractive, fn ) {\n  \treturn fn.call( ractive, {\n  \t\tfromId: parser.fromId,\n  \t\tisParsed: parser.isParsed,\n  \t\tparse: function ( template, options ) {\n  \t\t\tif ( options === void 0 ) options = parser.getParseOptions( ractive );\n\n  \t\t\treturn parser.parse( template, options );\n  \t\t}\n  \t});\n  }\n\n  function parseTemplate ( template, ractive ) {\n  \tif ( typeof template === 'string' ) {\n  \t\t// parse will validate and add expression functions\n  \t\ttemplate = parseAsString( template, ractive );\n  \t}\n  \telse {\n  \t\t// need to validate and add exp for already parsed template\n  \t\tvalidate$1( template );\n  \t\taddFunctions( template );\n  \t}\n\n  \treturn template;\n  }\n\n  function parseAsString ( template, ractive ) {\n  \t// ID of an element containing the template?\n  \tif ( template[0] === '#' ) {\n  \t\ttemplate = parser.fromId( template );\n  \t}\n\n  \treturn parser.parseFor( template, ractive );\n  }\n\n  function validate$1( template ) {\n\n  \t// Check that the template even exists\n  \tif ( template == undefined ) {\n  \t\tthrow new Error( (\"The template cannot be \" + template + \".\") );\n  \t}\n\n  \t// Check the parsed template has a version at all\n  \telse if ( typeof template.v !== 'number' ) {\n  \t\tthrow new Error( 'The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.' );\n  \t}\n\n  \t// Check we're using the correct version\n  \telse if ( template.v !== TEMPLATE_VERSION ) {\n  \t\tthrow new Error( (\"Mismatched template version (expected \" + TEMPLATE_VERSION + \", got \" + (template.v) + \") Please ensure you are using the latest version of Ractive.js in your build process as well as in your app\") );\n  \t}\n  }\n\n  function extendPartials ( existingPartials, newPartials, overwrite ) {\n  \tif ( !newPartials ) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor ( var key in newPartials ) {\n  \t\tif ( overwrite || !existingPartials.hasOwnProperty( key ) ) {\n  \t\t\texistingPartials[ key ] = newPartials[ key ];\n  \t\t}\n  \t}\n  }\n\n  var registryNames = [\n  \t'adaptors',\n  \t'components',\n  \t'computed',\n  \t'decorators',\n  \t'easing',\n  \t'events',\n  \t'interpolators',\n  \t'partials',\n  \t'transitions'\n  ];\n\n  var Registry = function Registry ( name, useDefaults ) {\n  \tthis.name = name;\n  \tthis.useDefaults = useDefaults;\n  };\n\n  Registry.prototype.extend = function extend ( Parent, proto, options ) {\n  \tthis.configure(\n  \t\tthis.useDefaults ? Parent.defaults : Parent,\n  \t\tthis.useDefaults ? proto : proto.constructor,\n  \t\toptions );\n  };\n\n  Registry.prototype.init = function init () {\n  \t// noop\n  };\n\n  Registry.prototype.configure = function configure ( Parent, target, options ) {\n  \tvar name = this.name;\n  \tvar option = options[ name ];\n\n  \tvar registry = create( Parent[name] );\n\n  \tfor ( var key in option ) {\n  \t\tregistry[ key ] = option[ key ];\n  \t}\n\n  \ttarget[ name ] = registry;\n  };\n\n  Registry.prototype.reset = function reset ( ractive ) {\n  \tvar registry = ractive[ this.name ];\n  \tvar changed = false;\n\n  \tObject.keys( registry ).forEach( function ( key ) {\n  \t\tvar item = registry[ key ];\n  \t\t\t\n  \t\tif ( item._fn ) {\n  \t\t\tif ( item._fn.isOwner ) {\n  \t\t\t\tregistry[key] = item._fn;\n  \t\t\t} else {\n  \t\t\t\tdelete registry[key];\n  \t\t\t}\n  \t\t\tchanged = true;\n  \t\t}\n  \t});\n\n  \treturn changed;\n  };\n\n  var registries = registryNames.map( function ( name ) { return new Registry( name, name === 'computed' ); } );\n\n  function wrap ( parent, name, method ) {\n  \tif ( !/_super/.test( method ) ) return method;\n\n  \tfunction wrapper () {\n  \t\tvar superMethod = getSuperMethod( wrapper._parent, name );\n  \t\tvar hasSuper = '_super' in this;\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply( this, arguments );\n\n  \t\tif ( hasSuper ) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod ( parent, name ) {\n  \tif ( name in parent ) {\n  \t\tvar value = parent[ name ];\n\n  \t\treturn typeof value === 'function' ?\n  \t\t\tvalue :\n  \t\t\tfunction () { return value; };\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage( deprecated, correct, isError ) {\n  \treturn \"options.\" + deprecated + \" has been deprecated in favour of options.\" + correct + \".\"\n  \t\t+ ( isError ? (\" You cannot specify both options, please use options.\" + correct + \".\") : '' );\n  }\n\n  function deprecateOption ( options, deprecatedOption, correct ) {\n  \tif ( deprecatedOption in options ) {\n  \t\tif( !( correct in options ) ) {\n  \t\t\twarnIfDebug( getMessage( deprecatedOption, correct ) );\n  \t\t\toptions[ correct ] = options[ deprecatedOption ];\n  \t\t} else {\n  \t\t\tthrow new Error( getMessage( deprecatedOption, correct, true ) );\n  \t\t}\n  \t}\n  }\n\n  function deprecate ( options ) {\n  \tdeprecateOption( options, 'beforeInit', 'onconstruct' );\n  \tdeprecateOption( options, 'init', 'onrender' );\n  \tdeprecateOption( options, 'complete', 'oncomplete' );\n  \tdeprecateOption( options, 'eventDefinitions', 'events' );\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif ( isArray( options.adaptors ) ) {\n  \t\tdeprecateOption( options, 'adaptors', 'adapt' );\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys( defaults );\n\n  var isStandardKey = makeObj( defaultKeys.filter( function ( key ) { return !custom[ key ]; } ) );\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj( defaultKeys.concat( registries.map( function ( r ) { return r.name; } ) ) );\n\n  var order = [].concat(\n  \tdefaultKeys.filter( function ( key ) { return !registries[ key ] && !custom[ key ]; } ),\n  \tregistries,\n  \t//custom.data,\n  \tcustom.template,\n  \tcustom.css\n  );\n\n  var config = {\n  \textend: function ( Parent, proto, options ) { return configure( 'extend', Parent, proto, options ); },\n\n  \tinit: function ( Parent, ractive, options ) { return configure( 'init', Parent, ractive, options ); },\n\n  \treset: function ( ractive ) {\n  \t\treturn order.filter( function ( c ) {\n  \t\t\treturn c.reset && c.reset( ractive );\n  \t\t}).map( function ( c ) { return c.name; } );\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure ( method, Parent, target, options ) {\n  \tdeprecate( options );\n\n  \tfor ( var key in options ) {\n  \t\tif ( isStandardKey.hasOwnProperty( key ) ) {\n  \t\t\tvar value = options[ key ];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif ( key !== 'el' && typeof value === 'function' ) {\n  \t\t\t\twarnIfDebug( (\"\" + key + \" is a Ractive option that does not expect a function and will be ignored\"),\n  \t\t\t\t\tmethod === 'init' ? target : null );\n  \t\t\t}\n  \t\t\telse {\n  \t\t\t\ttarget[ key ] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// disallow combination of `append` and `enhance`\n  \tif ( options.append && options.enhance ) {\n  \t\tthrow new Error( 'Cannot use append and enhance at the same time' );\n  \t}\n\n  \tregistries.forEach( function ( registry ) {\n  \t\tregistry[ method ]( Parent, target, options );\n  \t});\n\n  \tadaptConfigurator[ method ]( Parent, target, options );\n  \ttemplateConfigurator[ method ]( Parent, target, options );\n  \tcssConfigurator[ method ]( Parent, target, options );\n\n  \textendOtherMethods( Parent.prototype, target, options );\n  }\n\n  function extendOtherMethods ( parent, target, options ) {\n  \tfor ( var key in options ) {\n  \t\tif ( !isBlacklisted[ key ] && options.hasOwnProperty( key ) ) {\n  \t\t\tvar member = options[ key ];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif ( typeof member === 'function' ) {\n  \t\t\t\tmember = wrap( parent, key, member );\n  \t\t\t}\n\n  \t\t\ttarget[ key ] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj ( array ) {\n  \tvar obj = {};\n  \tarray.forEach( function ( x ) { return obj[x] = true; } );\n  \treturn obj;\n  }\n\n  var TEXT              = 1;\n  var INTERPOLATOR      = 2;\n  var TRIPLE            = 3;\n  var SECTION           = 4;\n  var ELEMENT           = 7;\n  var PARTIAL           = 8;\n  var ANCHOR            = 11;\n  var ATTRIBUTE         = 13;\n  var COMPONENT         = 15;\n  var YIELDER           = 16;\n  var DOCTYPE           = 18;\n  var ALIAS             = 19;\n\n  var NUMBER_LITERAL    = 20;\n  var STRING_LITERAL    = 21;\n  var REFERENCE         = 30;\n  var SECTION_IF        = 50;\n  var SECTION_UNLESS    = 51;\n  var SECTION_EACH      = 52;\n  var SECTION_WITH      = 53;\n  var SECTION_IF_WITH   = 54;\n\n  var EVENT             = 70;\n  var DECORATOR         = 71;\n  var TRANSITION        = 72;\n  var BINDING_FLAG      = 73;\n\n  var Item = function Item ( options ) {\n  \tthis.parentFragment = options.parentFragment;\n  \tthis.ractive = options.parentFragment.ractive;\n\n  \tthis.template = options.template;\n  \tthis.index = options.index;\n  \tthis.type = options.template.t;\n\n  \tthis.dirty = false;\n  };\n\n  Item.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.parentFragment.bubble();\n  \t}\n  };\n\n  Item.prototype.destroyed = function destroyed () {\n  \tif ( this.fragment ) this.fragment.destroyed();\n  };\n\n  Item.prototype.find = function find () {\n  \treturn null;\n  };\n\n  Item.prototype.findAll = function findAll () {\n  \t// noop\n  };\n\n  Item.prototype.findComponent = function findComponent () {\n  \treturn null;\n  };\n\n  Item.prototype.findAllComponents = function findAllComponents () {\n  \t// noop;\n  };\n\n  Item.prototype.findNextNode = function findNextNode () {\n  \treturn this.parentFragment.findNextNode( this );\n  };\n\n  Item.prototype.shuffled = function shuffled () {\n  \tif ( this.fragment ) this.fragment.shuffled();\n  };\n\n  Item.prototype.valueOf = function valueOf () {\n  \treturn this.toString();\n  };\n\n  var ContainerItem = (function (Item) {\n  \tfunction ContainerItem ( options ) {\n  \t\tItem.call( this, options );\n  \t}\n\n  \tContainerItem.prototype = Object.create( Item && Item.prototype );\n  \tContainerItem.prototype.constructor = ContainerItem;\n\n  \tContainerItem.prototype.detach = function detach () {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tContainerItem.prototype.find = function find ( selector ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tContainerItem.prototype.findAll = function findAll ( selector, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tContainerItem.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tContainerItem.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tContainerItem.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment && this.fragment.firstNode( skipParent );\n  \t};\n\n  \tContainerItem.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment ? this.fragment.toString( escape ) : '';\n  \t};\n\n  \treturn ContainerItem;\n  }(Item));\n\n  var ComputationChild = (function (Model) {\n  \tfunction ComputationChild ( parent, key ) {\n  \t\tModel.call( this, parent, key );\n\n  \t\tthis.isReadonly = !this.root.ractive.syncComputedChildren;\n  \t\tthis.dirty = true;\n  \t}\n\n  \tComputationChild.prototype = Object.create( Model && Model.prototype );\n  \tComputationChild.prototype.constructor = ComputationChild;\n\n  \tComputationChild.prototype.applyValue = function applyValue ( value ) {\n  \t\tModel.prototype.applyValue.call( this, value );\n\n  \t\tif ( !this.isReadonly ) {\n  \t\t\tvar source = this.parent;\n  \t\t\t// computed models don't have a shuffle method\n  \t\t\twhile ( source && source.shuffle ) {\n  \t\t\t\tsource = source.parent;\n  \t\t\t}\n\n  \t\t\tif ( source ) {\n  \t\t\t\tsource.dependencies.forEach( mark );\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tComputationChild.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tvar parentValue = this.parent.get();\n  \t\t\tthis.value = parentValue ? parentValue[ this.key ] : undefined;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.dirty = true;\n\n  \t\tthis.links.forEach( marked );\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \treturn ComputationChild;\n  }(Model));\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify ( fnBody ) {\n  \tvar lines = fnBody\n  \t\t.replace( /^\\t+/gm, function ( tabs ) { return tabs.split( '\\t' ).join( '  ' ); } )\n  \t\t.split( '\\n' );\n\n  \tvar minIndent = lines.length < 2 ? 0 :\n  \t\tlines.slice( 1 ).reduce( function ( prev, line ) {\n  \t\t\treturn Math.min( prev, /^\\s*/.exec( line )[0].length );\n  \t\t}, Infinity );\n\n  \treturn lines.map( function ( line, i ) {\n  \t\treturn '    ' + ( i ? line.substring( minIndent ) : line );\n  \t}).join( '\\n' );\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack ( stack ) {\n  \tif ( !stack ) return '';\n\n  \tvar lines = stack.split( '\\n' );\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor ( var i = 1; i < len; i += 1 ) {\n  \t\tvar line = lines[i];\n\n  \t\tif ( ~line.indexOf( name ) ) {\n  \t\t\treturn truncated.join( '\\n' );\n  \t\t} else {\n  \t\t\ttruncated.push( line );\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (Model) {\n  \tfunction Computation ( viewmodel, signature, key ) {\n  \t\tModel.call( this, null, null );\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n\n  \t\tthis.key = key; // not actually used, but helps with debugging\n  \t\tthis.isExpression = key && key[0] === '@';\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.dirty = true;\n\n  \t\t// TODO: is there a less hackish way to do this?\n  \t\tthis.shuffle = undefined;\n  \t}\n\n  \tComputation.prototype = Object.create( Model && Model.prototype );\n  \tComputation.prototype.constructor = Computation;\n\n  \tComputation.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.value = this.getValue();\n  \t\t\tif ( this.wrapper ) this.newWrapperValue = this.value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\t// if capturing, this value needs to be unwrapped because it's for external use\n  \t\treturn shouldCapture && this.wrapper ? this.wrapperValue : this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue () {\n  \t\tstartCapturing();\n  \t\tvar result;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call( this.context );\n  \t\t} catch ( err ) {\n  \t\t\twarnIfDebug( (\"Failed to compute \" + (this.getKeypath()) + \": \" + (err.message || err)) );\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif ( hasConsole ) {\n  \t\t\t\tif ( console.groupCollapsed ) console.groupCollapsed( '%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;' );\n  \t\t\t\tvar functionBody = prettify( this.signature.getterString );\n  \t\t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack( err.stack ) : '';\n  \t\t\t\tconsole.error( (\"\" + (err.name) + \": \" + (err.message) + \"\\n\\n\" + functionBody + \"\" + stack) );\n  \t\t\t\tif ( console.groupCollapsed ) console.groupEnd();\n  \t\t\t}\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies( dependencies );\n\n  \t\t// if not the first computation and the value is not the same,\n  \t\t// register the change for change events\n  \t\tif ( 'value' in this && result !== this.value ) {\n  \t\t\tthis.registerChange( this.getKeypath(), result );\n  \t\t}\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.mark = function mark () {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.rebinding = function rebinding ( next, previous ) {\n  \t\t// computations will grab all of their deps again automagically\n  \t\tif ( next !== previous ) this.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set ( value ) {\n  \t\tif ( this.isReadonly ) {\n  \t\t\tthrow new Error( (\"Cannot set read-only computed value '\" + (this.key) + \"'\") );\n  \t\t}\n\n  \t\tthis.signature.setter( value );\n  \t\tthis.mark();\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies ( dependencies ) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar model = this$1.dependencies[i];\n  \t\t\tif ( !~dependencies.indexOf( model ) ) model.unregister( this$1 );\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar model$1 = dependencies[i];\n  \t\t\tif ( !~this$1.dependencies.indexOf( model$1 ) ) model$1.register( this$1 );\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \tComputation.prototype.teardown = function teardown () {\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( this$1.dependencies[i] ) this$1.dependencies[i].unregister( this$1 );\n  \t\t}\n  \t\tif ( this.root.computations[this.key] === this ) delete this.root.computations[this.key];\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \treturn Computation;\n  }(Model));\n\n  var prototype$1 = Computation.prototype;\n  var child = ComputationChild.prototype;\n  prototype$1.handleChange = child.handleChange;\n  prototype$1.joinKey = child.joinKey;\n\n  function createResolver ( proxy, ref, index ) {\n  \tvar resolver = proxy.fragment.resolve( ref, function ( model ) {\n  \t\tremoveFromArray( proxy.resolvers, resolver );\n  \t\tproxy.models[ index ] = model;\n  \t\tproxy.bubble();\n  \t});\n\n  \tproxy.resolvers.push( resolver );\n  }\n\n  var ExpressionProxy = (function (Model) {\n  \tfunction ExpressionProxy ( fragment, template ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.call( this, fragment.ractive.viewmodel, null );\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n  \t\tthis.dirty = true;\n\n  \t\tthis.fn = getFunction( template.s, template.r.length );\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = this.template.r.map( function ( ref, index ) {\n  \t\t\tvar model = resolveReference( this$1.fragment, ref );\n\n  \t\t\tif ( !model ) {\n  \t\t\t\tcreateResolver( this$1, ref, index );\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n  \t\tthis.dependencies = [];\n\n  \t\tthis.shuffle = undefined;\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype = Object.create( Model && Model.prototype );\n  \tExpressionProxy.prototype.constructor = ExpressionProxy;\n\n  \tExpressionProxy.prototype.bubble = function bubble ( actuallyChanged ) {\n  \t\t// refresh the keypath\n  \t\tif ( actuallyChanged === void 0 ) actuallyChanged = true;\n\n  \t\tthis.keypath = undefined;\n\n  \t\tif ( actuallyChanged ) {\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.template ) return '@undefined';\n  \t\tif ( !this.keypath ) {\n  \t\t\tthis.keypath = '@' + this.template.s.replace( /_(\\d+)/g, function ( match, i ) {\n  \t\t\t\tif ( i >= this$1.models.length ) return match;\n\n  \t\t\t\tvar model = this$1.models[i];\n  \t\t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t\t});\n  \t\t}\n\n  \t\treturn this.keypath;\n  \t};\n\n  \tExpressionProxy.prototype.getValue = function getValue () {\n  \t\tvar this$1 = this;\n\n  \t\tstartCapturing();\n  \t\tvar result;\n\n  \t\ttry {\n  \t\t\tvar params = this.models.map( function ( m ) { return m ? m.get( true ) : undefined; } );\n  \t\t\tresult = this.fn.apply( this.fragment.ractive, params );\n  \t\t} catch ( err ) {\n  \t\t\twarnIfDebug( (\"Failed to compute \" + (this.getKeypath()) + \": \" + (err.message || err)) );\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\t// remove missing deps\n  \t\tthis.dependencies.filter( function ( d ) { return !~dependencies.indexOf( d ); } ).forEach( function ( d ) {\n  \t\t\td.unregister( this$1 );\n  \t\t\tremoveFromArray( this$1.dependencies, d );\n  \t\t});\n  \t\t// register new deps\n  \t\tdependencies.filter( function ( d ) { return !~this$1.dependencies.indexOf( d ); } ).forEach( function ( d ) {\n  \t\t\td.register( this$1 );\n  \t\t\tthis$1.dependencies.push( d );\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tExpressionProxy.prototype.rebinding = function rebinding ( next, previous, safe ) {\n  \t\tvar idx = this.models.indexOf( previous );\n\n  \t\tif ( ~idx ) {\n  \t\t\tnext = rebindMatch( this.template.r[idx], next, previous );\n  \t\t\tif ( next !== previous ) {\n  \t\t\t\tprevious.unregister( this );\n  \t\t\t\tthis.models.splice( idx, 1, next );\n  \t\t\t\t// TODO: set up a resolver if there is no next?\n  \t\t\t\tif ( next ) next.addShuffleRegister( this, 'mark' );\n  \t\t\t}\n  \t\t}\n  \t\tthis.bubble( !safe );\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve () {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.teardown = function teardown () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.unbind();\n  \t\tthis.fragment = undefined;\n  \t\tif ( this.dependencies ) this.dependencies.forEach( function ( d ) { return d.unregister( this$1 ); } );\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \tExpressionProxy.prototype.unregister = function unregister( dep ) {\n  \t\tModel.prototype.unregister.call( this, dep );\n  \t\tif ( !this.deps.length ) this.teardown();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind$1 () {\n  \t\tthis.resolvers.forEach( unbind );\n  \t};\n\n  \treturn ExpressionProxy;\n  }(Model));\n\n  var prototype = ExpressionProxy.prototype;\n  var computation = Computation.prototype;\n  prototype.get = computation.get;\n  prototype.handleChange = computation.handleChange;\n  prototype.joinKey = computation.joinKey;\n  prototype.mark = computation.mark;\n\n  var ReferenceExpressionChild = (function (Model) {\n  \tfunction ReferenceExpressionChild ( parent, key ) {\n  \t\tModel.call ( this, parent, key );\n  \t}\n\n  \tReferenceExpressionChild.prototype = Object.create( Model && Model.prototype );\n  \tReferenceExpressionChild.prototype.constructor = ReferenceExpressionChild;\n\n  \tReferenceExpressionChild.prototype.applyValue = function applyValue ( value ) {\n  \t\tif ( isEqual( value, this.value ) ) return;\n\n  \t\tvar parent = this.parent, keys = [ this.key ];\n  \t\twhile ( parent ) {\n  \t\t\tif ( parent.base ) {\n  \t\t\t\tvar target = parent.model.joinAll( keys );\n  \t\t\t\ttarget.applyValue( value );\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tkeys.unshift( parent.key );\n\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t};\n\n  \tReferenceExpressionChild.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ReferenceExpressionChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tReferenceExpressionChild.prototype.retrieve = function retrieve () {\n  \t\tvar parent = this.parent.get();\n  \t\treturn parent && this.key in parent ? parent[ this.key ] : undefined;\n  \t};\n\n  \treturn ReferenceExpressionChild;\n  }(Model));\n\n  var ReferenceExpressionProxy = (function (Model) {\n  \tfunction ReferenceExpressionProxy ( fragment, template ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.call( this, null, null );\n  \t\tthis.dirty = true;\n  \t\tthis.root = fragment.ractive.viewmodel;\n  \t\tthis.template = template;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$2( fragment, template );\n  \t\tvar baseResolver;\n\n  \t\tif ( !this.base ) {\n  \t\t\tbaseResolver = fragment.resolve( template.r, function ( model ) {\n  \t\t\t\tthis$1.base = model;\n  \t\t\t\tthis$1.bubble();\n\n  \t\t\t\tremoveFromArray( this$1.resolvers, baseResolver );\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push( baseResolver );\n  \t\t}\n\n  \t\tvar intermediary = this.intermediary = {\n  \t\t\thandleChange: function () { return this$1.handleChange(); },\n  \t\t\trebinding: function ( next, previous ) {\n  \t\t\t\tif ( previous === this$1.base ) {\n  \t\t\t\t\tnext = rebindMatch( template, next, previous );\n  \t\t\t\t\tif ( next !== this$1.base ) {\n  \t\t\t\t\t\tthis$1.base.unregister( intermediary );\n  \t\t\t\t\t\tthis$1.base = next;\n  \t\t\t\t\t\t// TODO: if there is no next, set up a resolver?\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvar idx = this$1.members.indexOf( previous );\n  \t\t\t\t\tif ( ~idx ) {\n  \t\t\t\t\t\t// only direct references will rebind... expressions handle themselves\n  \t\t\t\t\t\tnext = rebindMatch( template.m[idx].n, next, previous );\n  \t\t\t\t\t\tif ( next !== this$1.members[idx] ) {\n  \t\t\t\t\t\t\tthis$1.members.splice( idx, 1, next );\n  \t\t\t\t\t\t\t// TODO: if there is no next, set up a resolver?\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif ( next !== previous ) previous.unregister( intermediary );\n  \t\t\t\tif ( next ) next.addShuffleTask( function () { return next.register( intermediary ); } );\n\n  \t\t\t\tthis$1.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map( function ( template, i ) {\n  \t\t\tif ( typeof template === 'string' ) {\n  \t\t\t\treturn { get: function () { return template; } };\n  \t\t\t}\n\n  \t\t\tvar model;\n  \t\t\tvar resolver;\n\n  \t\t\tif ( template.t === REFERENCE ) {\n  \t\t\t\tmodel = resolveReference( fragment, template.n );\n\n  \t\t\t\tif ( model ) {\n  \t\t\t\t\tmodel.register( intermediary );\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve( template.n, function ( model ) {\n  \t\t\t\t\t\tthis$1.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register( intermediary );\n  \t\t\t\t\t\tthis$1.handleChange();\n\n  \t\t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy( fragment, template );\n  \t\t\tmodel.register( intermediary );\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype = Object.create( Model && Model.prototype );\n  \tReferenceExpressionProxy.prototype.constructor = ReferenceExpressionProxy;\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble () {\n  \t\tif ( !this.base ) return;\n  \t\tif ( !this.dirty ) this.handleChange();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution () {\n  \t\tthis.resolvers.forEach( function ( resolver ) { return resolver.forceResolution(); } );\n  \t\tthis.dirty = true;\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get ( shouldCapture ) {\n  \t\tvar this$1 = this;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.bubble();\n\n  \t\t\tvar i = this.members.length, resolved = true;\n  \t\t\twhile ( resolved && i-- ) {\n  \t\t\t\tif ( !this$1.members[i] ) resolved = false;\n  \t\t\t}\n\n  \t\t\tif ( this.base && resolved ) {\n  \t\t\t\tvar keys = this.members.map( function ( m ) { return escapeKey( String( m.get() ) ); } );\n  \t\t\t\tvar model = this.base.joinAll( keys );\n\n  \t\t\t\tif ( model !== this.model ) {\n  \t\t\t\t\tif ( this.model ) {\n  \t\t\t\t\t\tthis.model.unregister( this );\n  \t\t\t\t\t\tthis.model.unregisterTwowayBinding( this );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tthis.model = model;\n  \t\t\t\t\tthis.parent = model.parent;\n  \t\t\t\t\tthis.model.register( this );\n  \t\t\t\t\tthis.model.registerTwowayBinding( this );\n\n  \t\t\t\t\tif ( this.keypathModel ) this.keypathModel.handleChange();\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.value = this.model ? this.model.get( shouldCapture ) : undefined;\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.mark();\n  \t\t\treturn this.value;\n  \t\t} else {\n  \t\t\treturn this.model ? this.model.get( shouldCapture ) : undefined;\n  \t\t}\n  \t};\n\n  \t// indirect two-way bindings\n  \tReferenceExpressionProxy.prototype.getValue = function getValue () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.value = this.model ? this.model.get() : undefined;\n\n  \t\tvar i = this.bindings.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar value = this$1.bindings[i].getValue();\n  \t\t\tif ( value !== this$1.value ) return value;\n  \t\t}\n\n  \t\t// check one-way bindings\n  \t\tvar oneway = findBoundValue( this.deps );\n  \t\tif ( oneway ) return oneway.value;\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath () {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.dirty = true;\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ReferenceExpressionChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tReferenceExpressionProxy.prototype.mark = function mark$1 () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.deps.forEach( handleChange );\n  \t\t}\n\n  \t\tthis.links.forEach( marked );\n  \t\tthis.children.forEach( mark );\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve () {\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.rebinding = function rebinding () { }; // NOOP\n\n  \tReferenceExpressionProxy.prototype.set = function set ( value ) {\n  \t\tif ( !this.model ) throw new Error( 'Unresolved reference expression. This should not happen!' );\n  \t\tthis.model.set( value );\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind$1 () {\n  \t\tthis.resolvers.forEach( unbind );\n  \t\tif ( this.model ) {\n  \t\t\tthis.model.unregister( this );\n  \t\t\tthis.model.unregisterTwowayBinding( this );\n  \t\t}\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  }(Model));\n\n  function resolve$2 ( fragment, template ) {\n  \tif ( template.r ) {\n  \t\treturn resolveReference( fragment, template.r );\n  \t}\n\n  \telse if ( template.x ) {\n  \t\treturn new ExpressionProxy( fragment, template.x );\n  \t}\n\n  \telse if ( template.rx ) {\n  \t\treturn new ReferenceExpressionProxy( fragment, template.rx );\n  \t}\n  }\n\n  function resolveAliases( aliases, fragment ) {\n  \tvar resolved = {};\n\n  \tfor ( var i = 0; i < aliases.length; i++ ) {\n  \t\tresolved[ aliases[i].n ] = resolve$2( fragment, aliases[i].x );\n  \t}\n\n  \treturn resolved;\n  }\n\n  var Alias = (function (ContainerItem) {\n  \tfunction Alias ( options ) {\n  \t\tContainerItem.call( this, options );\n\n  \t\tthis.fragment = null;\n  \t}\n\n  \tAlias.prototype = Object.create( ContainerItem && ContainerItem.prototype );\n  \tAlias.prototype.constructor = Alias;\n\n  \tAlias.prototype.bind = function bind () {\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template.f\n  \t\t});\n\n  \t\tthis.fragment.aliases = resolveAliases( this.template.z, this.parentFragment );\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tAlias.prototype.rebinding = function rebinding () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( this.locked ) return;\n  \t\tthis.locked = true;\n  \t\trunloop.scheduleTask( function () {\n  \t\t\tthis$1.locked = false;\n  \t\t\tthis$1.fragment.aliases = resolveAliases( this$1.template.z, this$1.parentFragment );\n  \t\t});\n  \t};\n\n  \tAlias.prototype.render = function render ( target ) {\n  \t\tthis.rendered = true;\n  \t\tif ( this.fragment ) this.fragment.render( target );\n  \t};\n\n  \tAlias.prototype.unbind = function unbind () {\n  \t\tthis.fragment.aliases = {};\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tAlias.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && this.fragment ) this.fragment.unrender( shouldDestroy );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAlias.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Alias;\n  }(ContainerItem));\n\n  function findElement( start, orComponent ) {\n  \tif ( orComponent === void 0 ) orComponent = true;\n\n  \twhile ( start && start.type !== ELEMENT && ( !orComponent || ( start.type !== COMPONENT && start.type !== ANCHOR ) ) ) {\n  \t\tif ( start.owner ) start = start.owner;\n  \t\telse if ( start.component ) start = start.component.parentFragment;\n  \t\telse if ( start.parent ) start = start.parent;\n  \t\telse if ( start.parentFragment ) start = start.parentFragment;\n  \t\telse start = undefined;\n  \t}\n\n  \treturn start;\n  }\n\n  function camelCase ( hyphenatedStr ) {\n  \treturn hyphenatedStr.replace( /-([a-zA-Z])/g, function ( match, $1 ) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var space = /\\s+/;\n  var specials = { 'float': 'cssFloat' };\n  var remove = /\\/\\*(?:[\\s\\S]*?)\\*\\//g;\n  var escape = /url\\(\\s*(['\"])(?:\\\\[\\s\\S]|(?!\\1).)*\\1\\s*\\)|url\\((?:\\\\[\\s\\S]|[^)])*\\)|(['\"])(?:\\\\[\\s\\S]|(?!\\1).)*\\2/gi;\n  var value = /\\0(\\d+)/g;\n\n  function readStyle ( css ) {\n      var values = [];\n\n      if ( typeof css !== 'string' ) return {};\n\n      return css.replace( escape, function ( match ) { return (\"\\u0000\" + (values.push( match ) - 1)); })\n          .replace( remove, '' )\n          .split( ';' )\n          .filter( function ( rule ) { return !!rule.trim(); } )\n          .map( function ( rule ) { return rule.replace( value, function ( match, n ) { return values[ n ]; } ); } )\n          .reduce(function ( rules, rule ) {\n              var i = rule.indexOf(':');\n              var name = camelCase( rule.substr( 0, i ).trim() );\n              rules[ specials[ name ] || name ] = rule.substr( i + 1 ).trim();\n              return rules;\n          }, {});\n  }\n\n  function readClass ( str ) {\n    var list = str.split( space );\n\n    // remove any empty entries\n    var i = list.length;\n    while ( i-- ) {\n      if ( !list[i] ) list.splice( i, 1 );\n    }\n\n    return list;\n  }\n\n  var textTypes = [ undefined, 'text', 'search', 'url', 'email', 'hidden', 'password', 'search', 'reset', 'submit' ];\n\n  function getUpdateDelegate ( attribute ) {\n  \tvar element = attribute.element, name = attribute.name;\n\n  \tif ( name === 'id' ) return updateId;\n\n  \tif ( name === 'value' ) {\n  \t\tif ( attribute.interpolator ) attribute.interpolator.bound = true;\n\n  \t\t// special case - selects\n  \t\tif ( element.name === 'select' && name === 'value' ) {\n  \t\t\treturn element.getAttribute( 'multiple' ) ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif ( element.name === 'textarea' ) return updateStringValue;\n\n  \t\t// special case - contenteditable\n  \t\tif ( element.getAttribute( 'contenteditable' ) != null ) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif ( element.name === 'input' ) {\n  \t\t\tvar type = element.getAttribute( 'type' );\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif ( type === 'file' ) return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif ( type === 'radio' && element.binding && element.binding.attribute.name === 'name' ) return updateRadioValue;\n\n  \t\t\tif ( ~textTypes.indexOf( type ) ) return updateStringValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif ( attribute.isTwoway && name === 'name' ) {\n  \t\tif ( node.type === 'radio' ) return updateRadioName;\n  \t\tif ( node.type === 'checkbox' ) return updateCheckboxName;\n  \t}\n\n  \tif ( name === 'style' ) return updateStyleAttribute;\n\n  \tif ( name.indexOf( 'style-' ) === 0 ) return updateInlineStyle;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif ( name === 'class' && ( !node.namespaceURI || node.namespaceURI === html ) ) return updateClassName;\n\n  \tif ( name.indexOf( 'class-' ) === 0 ) return updateInlineClass;\n\n  \tif ( attribute.isBoolean ) {\n  \t\tvar type$1 = element.getAttribute( 'type' );\n  \t\tif ( attribute.interpolator && name === 'checked' && ( type$1 === 'checkbox' || type$1 === 'radio' ) ) attribute.interpolator.bound = true;\n  \t\treturn updateBoolean;\n  \t}\n\n  \tif ( attribute.namespace && attribute.namespace !== attribute.node.namespaceURI ) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId ( reset ) {\n  \tvar ref = this, node = ref.node;\n  \tvar value = this.getValue();\n\n  \t// remove the mapping to this node if it hasn't already been replaced\n  \tif ( this.ractive.nodes[ node.id ] === node ) delete this.ractive.nodes[ node.id ];\n  \tif ( reset ) return node.removeAttribute( 'id' );\n\n  \tthis.ractive.nodes[ value ] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue ( reset ) {\n  \tvar value = this.getValue();\n\n  \tif ( !isArray( value ) ) value = [ value ];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \tif ( reset ) {\n  \t\twhile ( i-- ) options[i].selected = false;\n  \t} else {\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ?\n  \t\t\t\toption._ractive.value :\n  \t\t\t\toption.value; // options inserted via a triple don't have _ractive\n\n  \t\t\toption.selected = arrayContains( value, optionValue );\n  \t\t}\n  \t}\n  }\n\n  function updateSelectValue ( reset ) {\n  \tvar value = this.getValue();\n\n  \tif ( !this.locked ) { // TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n  \t\tvar wasSelected = false;\n\n  \t\tif ( reset ) {\n  \t\t\twhile ( i-- ) options[i].selected = false;\n  \t\t} else {\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tvar option = options[i];\n  \t\t\t\tvar optionValue = option._ractive ?\n  \t\t\t\t\toption._ractive.value :\n  \t\t\t\t\toption.value; // options inserted via a triple don't have _ractive\n  \t\t\t\tif ( option.disabled && option.selected ) wasSelected = true;\n\n  \t\t\t\tif ( optionValue == value ) { // double equals as we may be comparing numbers with strings\n  \t\t\t\t\toption.selected = true;\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( !wasSelected ) this.node.selectedIndex = -1;\n  \t}\n  }\n\n\n  function updateContentEditableValue ( reset ) {\n  \tvar value = this.getValue();\n\n  \tif ( !this.locked ) {\n  \t\tif ( reset ) this.node.innerHTML = '';\n  \t\telse this.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue ( reset ) {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \tif ( reset ) return node.checked = false;\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute( 'name' );\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif ( wasChecked && !node.checked && this.element.binding && this.element.binding.rendered ) {\n  \t\tthis.element.binding.group.model.set( this.element.binding.group.getValue() );\n  \t}\n  }\n\n  function updateValue ( reset ) {\n  \tif ( !this.locked ) {\n  \t\tif ( reset ) {\n  \t\t\tthis.node.removeAttribute( 'value' );\n  \t\t\tthis.node.value = this.node._ractive.value = null;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute( 'value', value );\n  \t}\n  }\n\n  function updateStringValue ( reset ) {\n  \tif ( !this.locked ) {\n  \t\tif ( reset ) {\n  \t\t\tthis.node._ractive.value = '';\n  \t\t\tthis.node.removeAttribute( 'value' );\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node._ractive.value = value;\n\n  \t\tthis.node.value = safeToStringValue( value );\n  \t\tthis.node.setAttribute( 'value', safeToStringValue( value ) );\n  \t}\n  }\n\n  function updateRadioName ( reset ) {\n  \tif ( reset ) this.node.checked = false;\n  \telse this.node.checked = ( this.getValue() == this.node._ractive.value );\n  }\n\n  function updateCheckboxName ( reset ) {\n  \tvar ref = this, element = ref.element, node = ref.node;\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute( 'value' );\n\n  \tif ( reset ) {\n  \t\t// TODO: WAT?\n  \t}\n\n  \tif ( !isArray( value ) ) {\n  \t\tbinding.isChecked = node.checked = ( value == valueAttribute );\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( valueAttribute == value[i] ) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateStyleAttribute ( reset ) {\n  \tvar props = reset ? {} : readStyle( this.getValue() || '' );\n  \tvar style = this.node.style;\n  \tvar keys = Object.keys( props );\n  \tvar prev = this.previous || [];\n\n  \tvar i = 0;\n  \twhile ( i < keys.length ) {\n  \t\tif ( keys[i] in style ) style[ keys[i] ] = props[ keys[i] ];\n  \t\ti++;\n  \t}\n\n  \t// remove now-missing attrs\n  \ti = prev.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~keys.indexOf( prev[i] ) && prev[i] in style ) style[ prev[i] ] = '';\n  \t}\n\n  \tthis.previous = keys;\n  }\n\n  function updateInlineStyle ( reset ) {\n  \tif ( !this.styleName ) {\n  \t\tthis.styleName = camelize( this.name.substr( 6 ) );\n  \t}\n\n  \tthis.node.style[ this.styleName ] = reset ? '' : this.getValue();\n  }\n\n  function updateClassName ( reset ) {\n  \tvar value = reset ? [] : readClass( safeToStringValue( this.getValue() ) );\n  \tvar attr = readClass( this.node.className );\n  \tvar prev = this.previous || attr.slice( 0 );\n\n  \tvar i = 0;\n  \twhile ( i < value.length ) {\n  \t\tif ( !~attr.indexOf( value[i] ) ) attr.push( value[i] );\n  \t\ti++;\n  \t}\n\n  \t// remove now-missing classes\n  \ti = prev.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~value.indexOf( prev[i] ) ) {\n  \t\t\tvar idx = attr.indexOf( prev[i] );\n  \t\t\tif ( ~idx ) attr.splice( idx, 1 );\n  \t\t}\n  \t}\n\n  \tvar className = attr.join( ' ' );\n\n  \tif ( className !== this.node.className ) {\n  \t\tthis.node.className = className;\n  \t}\n\n  \tthis.previous = value;\n  }\n\n  function updateInlineClass ( reset ) {\n  \tvar name = this.name.substr( 6 );\n  \tvar attr = readClass( this.node.className );\n  \tvar value = reset ? false : this.getValue();\n\n  \tif ( !this.inlineClass ) this.inlineClass = name;\n\n  \tif ( value && !~attr.indexOf( name ) ) attr.push( name );\n  \telse if ( !value && ~attr.indexOf( name ) ) attr.splice( attr.indexOf( name ), 1 );\n\n  \tthis.node.className = attr.join( ' ' );\n  }\n\n  function updateBoolean ( reset ) {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif ( !this.locked ) {\n  \t\tif ( reset ) {\n  \t\t\tif ( this.useProperty ) this.node[ this.propertyName ] = false;\n  \t\t\tthis.node.removeAttribute( this.propertyName );\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( this.useProperty ) {\n  \t\t\tthis.node[ this.propertyName ] = this.getValue();\n  \t\t} else {\n  \t\t\tif ( this.getValue() ) {\n  \t\t\t\tthis.node.setAttribute( this.propertyName, '' );\n  \t\t\t} else {\n  \t\t\t\tthis.node.removeAttribute( this.propertyName );\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function updateAttribute ( reset ) {\n  \tif ( reset ) this.node.removeAttribute( this.name );\n  \telse this.node.setAttribute( this.name, safeToStringValue( this.getString() ) );\n  }\n\n  function updateNamespacedAttribute ( reset ) {\n  \tif ( reset ) this.node.removeAttributeNS( this.namespace, this.name.slice( this.name.indexOf( ':' ) + 1 ) );\n  \telse this.node.setAttributeNS( this.namespace, this.name.slice( this.name.indexOf( ':' ) + 1 ), safeToStringValue( this.getString() ) );\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830\t};\n  var controlCharacters = [ 8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376 ];\n  var entityPattern = new RegExp( '&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys( htmlEntities ).join( '|' ) + '));?', 'g' );\n  var codePointSupport = typeof String.fromCodePoint === 'function';\n  var codeToChar = codePointSupport ? String.fromCodePoint : String.fromCharCode;\n\n  function decodeCharacterReferences ( html ) {\n  \treturn html.replace( entityPattern, function ( match, entity ) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif ( entity[0] !== '#' ) {\n  \t\t\tcode = htmlEntities[ entity ];\n  \t\t} else if ( entity[1] === 'x' ) {\n  \t\t\tcode = parseInt( entity.substring( 2 ), 16 );\n  \t\t} else {\n  \t\t\tcode = parseInt( entity.substring( 1 ), 10 );\n  \t\t}\n\n  \t\tif ( !code ) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn codeToChar( validateCode( code ) );\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n  var invalid = 65533;\n\n  function escapeHtml ( str ) {\n  \treturn str\n  \t\t.replace( amp, '&amp;' )\n  \t\t.replace( lessThan, '&lt;' )\n  \t\t.replace( greaterThan, '&gt;' );\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode ( code ) {\n  \tif ( !code ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif ( code === 10 ) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif ( code < 128 ) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing € signs and so on\n  \tif ( code <= 159 ) {\n  \t\treturn controlCharacters[ code - 128 ];\n  \t}\n\n  \t// basic multilingual plane\n  \tif ( code < 55296 ) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif ( code <= 57343 ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif ( code <= 65535 ) {\n  \t\treturn code;\n  \t} else if ( !codePointSupport ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// supplementary multilingual plane 0x10000 - 0x1ffff\n  \tif ( code >= 65536 && code <= 131071 ) {\n  \t\treturn code;\n  \t}\n\n  \t// supplementary ideographic plane 0x20000 - 0x2ffff\n  \tif ( code >= 131072 && code <= 196607 ) {\n  \t\treturn code;\n  \t}\n\n  \treturn invalid;\n  }\n\n  function lookupNamespace ( node, prefix ) {\n  \tvar qualified = \"xmlns:\" + prefix;\n\n  \twhile ( node ) {\n  \t\tif ( node.hasAttribute && node.hasAttribute( qualified ) ) return node.getAttribute( qualified );\n  \t\tnode = node.parentNode;\n  \t}\n\n  \treturn namespaces[ prefix ];\n  }\n\n  var Attribute = (function (Item) {\n  \tfunction Attribute ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.name = options.template.n;\n  \t\tthis.namespace = null;\n\n  \t\tthis.owner = options.owner || options.parentFragment.owner || options.element || findElement( options.parentFragment );\n  \t\tthis.element = options.element || (this.owner.attributeByName ? this.owner : findElement( options.parentFragment ) );\n  \t\tthis.parentFragment = options.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n\n  \t\tthis.element.attributeByName[ this.name ] = this;\n\n  \t\tif ( !isArray( options.template.f ) ) {\n  \t\t\tthis.value = options.template.f;\n  \t\t\tif ( this.value === 0 ) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template.f\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment &&\n  \t\t\tthis.fragment.items.length === 1 &&\n  \t\t\tthis.fragment.items[0].type === INTERPOLATOR &&\n  \t\t\tthis.fragment.items[0];\n\n  \t\tif ( this.interpolator ) this.interpolator.owner = this;\n  \t}\n\n  \tAttribute.prototype = Object.create( Item && Item.prototype );\n  \tAttribute.prototype.constructor = Attribute;\n\n  \tAttribute.prototype.bind = function bind () {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.parentFragment.bubble();\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.destroyed = function destroyed () {\n  \t\tthis.updateDelegate( true );\n  \t};\n\n  \tAttribute.prototype.getString = function getString () {\n  \t\treturn this.fragment ?\n  \t\t\tthis.fragment.toString() :\n  \t\t\tthis.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n  \tAttribute.prototype.getValue = function getValue () {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test( this.name ) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.render = function render () {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif ( !node.namespaceURI || node.namespaceURI === namespaces.html ) {\n  \t\t\tthis.propertyName = propertyNames[ this.name ] || this.name;\n\n  \t\t\tif ( node[ this.propertyName ] !== undefined ) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif ( booleanAttributes.test( this.name ) || this.isTwoway ) {\n  \t\t\t\tthis.isBoolean = true;\n  \t\t\t}\n\n  \t\t\tif ( this.propertyName === 'value' ) {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( node.namespaceURI ) {\n  \t\t\tvar index = this.name.indexOf( ':' );\n  \t\t\tif ( index !== -1 ) {\n  \t\t\t\tthis.namespace = lookupNamespace( node, this.name.slice( 0, index ) );\n  \t\t\t} else {\n  \t\t\t\tthis.namespace = node.namespaceURI;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate( this );\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString () {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif ( this.name === 'value' && ( this.element.getAttribute( 'contenteditable' ) !== undefined || ( this.element.name === 'select' || this.element.name === 'textarea' ) ) ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case – bound radio `name` attributes\n  \t\tif ( this.name === 'name' && this.element.name === 'input' && this.interpolator && this.element.getAttribute( 'type' ) === 'radio' ) {\n  \t\t\treturn (\"name=\\\"{{\" + (this.interpolator.model.getKeypath()) + \"}}\\\"\");\n  \t\t}\n\n  \t\t// Special case - style and class attributes and directives\n  \t\tif ( this.owner === this.element && ( this.name === 'style' || this.name === 'class' || this.styleName || this.inlineClass ) ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( !this.rendered && this.owner === this.element && ( !this.name.indexOf( 'style-' ) || !this.name.indexOf( 'class-' ) ) ) {\n  \t\t\tif ( !this.name.indexOf( 'style-' ) ) {\n  \t\t\t\tthis.styleName = camelize( this.name.substr( 6 ) );\n  \t\t\t} else {\n  \t\t\t\tthis.inlineClass = this.name.substr( 6 );\n  \t\t\t}\n\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( booleanAttributes.test( this.name ) ) return value ? this.name : '';\n  \t\tif ( value == null ) return '';\n\n  \t\tvar str = safeAttributeString( this.getString() );\n  \t\treturn str ?\n  \t\t\t(\"\" + (this.name) + \"=\\\"\" + str + \"\\\"\") :\n  \t\t\tthis.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind () {\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.unrender = function unrender () {\n  \t\tthis.updateDelegate( true );\n\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAttribute.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t\tif ( this.rendered ) this.updateDelegate();\n  \t\t\tif ( this.isTwoway && !this.locked ) {\n  \t\t\t\tthis.interpolator.twowayBinding.lastVal( true, this.interpolator.model.get() );\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  }(Item));\n\n  var BindingFlag = (function (Item) {\n  \tfunction BindingFlag ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.owner = options.owner || options.parentFragment.owner || findElement( options.parentFragment );\n  \t\tthis.element = this.owner.attributeByName ? this.owner : findElement( options.parentFragment );\n  \t\tthis.flag = options.template.v === 'l' ? 'lazy' : 'twoway';\n\n  \t\tif ( this.element.type === ELEMENT ) {\n  \t\t\tif ( isArray( options.template.f ) ) {\n  \t\t\t\tthis.fragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: options.template.f\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.interpolator = this.fragment &&\n  \t\t\t\t\t\t\t\tthis.fragment.items.length === 1 &&\n  \t\t\t\t\t\t\t\tthis.fragment.items[0].type === INTERPOLATOR &&\n  \t\t\t\t\t\t\t\tthis.fragment.items[0];\n  \t\t}\n  \t}\n\n  \tBindingFlag.prototype = Object.create( Item && Item.prototype );\n  \tBindingFlag.prototype.constructor = BindingFlag;\n\n  \tBindingFlag.prototype.bind = function bind () {\n  \t\tif ( this.fragment ) this.fragment.bind();\n  \t\tset$2( this, this.getValue(), true );\n  \t};\n\n  \tBindingFlag.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tBindingFlag.prototype.getValue = function getValue () {\n  \t\tif ( this.fragment ) return this.fragment.valueOf();\n  \t\telse if ( 'value' in this ) return this.value;\n  \t\telse if ( 'f' in this.template ) return this.template.f;\n  \t\telse return true;\n  \t};\n\n  \tBindingFlag.prototype.render = function render () {\n  \t\tset$2( this, this.getValue(), true );\n  \t};\n\n  \tBindingFlag.prototype.toString = function toString () { return ''; };\n\n  \tBindingFlag.prototype.unbind = function unbind () {\n  \t\tif ( this.fragment ) this.fragment.unbind();\n\n  \t\tdelete this.element[ this.flag ];\n  \t};\n\n  \tBindingFlag.prototype.unrender = function unrender () {\n  \t\tif ( this.element.rendered ) this.element.recreateTwowayBinding();\n  \t};\n\n  \tBindingFlag.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t\tset$2( this, this.getValue(), true );\n  \t\t}\n  \t};\n\n  \treturn BindingFlag;\n  }(Item));\n\n  function set$2 ( flag, value, update ) {\n  \tif ( value === 0 ) {\n  \t\tflag.value = true;\n  \t} else if ( value === 'true' ) {\n  \t\tflag.value = true;\n  \t} else if ( value === 'false' || value === '0' ) {\n  \t\tflag.value = false;\n  \t} else {\n  \t\tflag.value = value;\n  \t}\n\n  \tvar current = flag.element[ flag.flag ];\n  \tflag.element[ flag.flag ] = flag.value;\n  \tif ( update && !flag.element.attributes.binding && current !== flag.value ) {\n  \t\tflag.element.recreateTwowayBinding();\n  \t}\n\n  \treturn flag.value;\n  }\n\n  var div$1 = doc ? createElement( 'div' ) : null;\n\n  var attributes = false;\n  function inAttributes() { return attributes; }\n  function doInAttributes( fn ) {\n  \tattributes = true;\n  \tfn();\n  \tattributes = false;\n  }\n\n  var ConditionalAttribute = (function (Item) {\n  \tfunction ConditionalAttribute ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template\n  \t\t});\n  \t\t// this fragment can't participate in node-y things\n  \t\tthis.fragment.findNextNode = noop;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype = Object.create( Item && Item.prototype );\n  \tConditionalAttribute.prototype.constructor = ConditionalAttribute;\n\n  \tConditionalAttribute.prototype.bind = function bind () {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render () {\n  \t\tthis.node = this.owner.node;\n  \t\tif ( this.node ) {\n  \t\t\tthis.isSvg = this.node.namespaceURI === svg$1;\n  \t\t}\n\n  \t\tattributes = true;\n  \t\tif ( !this.rendered ) this.fragment.render();\n  \t\tattributes = false;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString () {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind () {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender () {\n  \t\tthis.rendered = false;\n  \t\tthis.fragment.unrender();\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update () {\n  \t\tvar this$1 = this;\n\n  \t\tvar str;\n  \t\tvar attrs;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tattributes = true;\n  \t\t\tthis.fragment.update();\n  \t\t\tattributes = false;\n\n  \t\t\tif ( this.rendered && this.node ) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes( str, this.isSvg );\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter( function ( a ) { return notIn( attrs, a ); } ).forEach( function ( a ) {\n  \t\t\t\t\tthis$1.node.removeAttribute( a.name );\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach( function ( a ) {\n  \t\t\t\t\tthis$1.node.setAttribute( a.name, a.value );\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  }(Item));\n\n  function parseAttributes ( str, isSvg ) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \treturn str\n  \t\t? (div$1.innerHTML = \"<\" + tagName + \" \" + str + \"></\" + tagName + \">\") &&\n  \t\t\ttoArray(div$1.childNodes[0].attributes)\n  \t\t: [];\n  }\n\n  function notIn ( haystack, needle ) {\n  \tvar i = haystack.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( haystack[i].name === needle.name ) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function processWrapper ( wrapper, array, methodName, newIndices ) {\n  \tvar __model = wrapper.__model;\n\n  \tif ( newIndices ) {\n  \t\t__model.shuffle( newIndices );\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = [ 'pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift' ];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach( function ( methodName ) {\n  \tvar method = function () {\n  \t\tvar this$1 = this;\n  \t\tvar args = [], len = arguments.length;\n  \t\twhile ( len-- ) args[ len ] = arguments[ len ];\n\n  \t\tvar newIndices = getNewIndices( this.length, methodName, args );\n\n  \t\t// lock any magic array wrappers, so that things don't get fudged\n  \t\tthis._ractive.wrappers.forEach( function ( r ) { if ( r.magic ) r.magic.locked = true; } );\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[ methodName ].apply( this, arguments );\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile ( i-- ) {\n  \t\t\tprocessWrapper( this$1._ractive.wrappers[i], this$1, methodName, newIndices );\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n\n  \t\t// unlock the magic arrays... magic... bah\n  \t\tthis._ractive.wrappers.forEach( function ( r ) { if ( r.magic ) r.magic.locked = false; } );\n\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty( patchedArrayProto, methodName, {\n  \t\tvalue: method,\n  \t\tconfigurable: true\n  \t});\n  });\n\n  var patchArrayMethods;\n  var unpatchArrayMethods;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if ( ({}).__proto__ ) {\n  \t// yes, we can\n  \tpatchArrayMethods = function ( array ) { return array.__proto__ = patchedArrayProto; };\n  \tunpatchArrayMethods = function ( array ) { return array.__proto__ = Array.prototype; };\n  }\n\n  else {\n  \t// no, we can't\n  \tpatchArrayMethods = function ( array ) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty( array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[ methodName ],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function ( array ) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile ( i-- ) {\n  \t\t\tdelete array[ mutatorMethods[i] ];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage$1 = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function ( object ) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray( object ) && ( !object._ractive || !object._ractive.setting );\n  \t},\n  \twrap: function ( ractive, array, keypath ) {\n  \t\treturn new ArrayWrapper( ractive, array, keypath );\n  \t}\n  };\n\n  var ArrayWrapper = function ArrayWrapper ( ractive, array ) {\n  \tthis.root = ractive;\n  \tthis.value = array;\n  \tthis.__model = null; // filled in later\n\n  \t// if this array hasn't already been ractified, ractify it\n  \tif ( !array._ractive ) {\n  \t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\tdefineProperty( array, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\twrappers: [],\n  \t\t\t\tinstances: [],\n  \t\t\t\tsetting: false\n  \t\t\t},\n  \t\t\tconfigurable: true\n  \t\t});\n\n  \t\tpatch( array );\n  \t}\n\n  \t// store the ractive instance, so we can handle transitions later\n  \tif ( !array._ractive.instances[ ractive._guid ] ) {\n  \t\tarray._ractive.instances[ ractive._guid ] = 0;\n  \t\tarray._ractive.instances.push( ractive );\n  \t}\n\n  \tarray._ractive.instances[ ractive._guid ] += 1;\n  \tarray._ractive.wrappers.push( this );\n  };\n\n  ArrayWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  ArrayWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.value === value;\n  };\n\n  ArrayWrapper.prototype.teardown = function teardown () {\n  \tvar array, storage, wrappers, instances, index;\n\n  \tarray = this.value;\n  \tstorage = array._ractive;\n  \twrappers = storage.wrappers;\n  \tinstances = storage.instances;\n\n  \t// if teardown() was invoked because we're clearing the cache as a result of\n  \t// a change that the array itself triggered, we can save ourselves the teardown\n  \t// and immediate setup\n  \tif ( storage.setting ) {\n  \t\treturn false; // so that we don't remove it from cached wrappers\n  \t}\n\n  \tindex = wrappers.indexOf( this );\n  \tif ( index === -1 ) {\n  \t\tthrow new Error( errorMessage$1 );\n  \t}\n\n  \twrappers.splice( index, 1 );\n\n  \t// if nothing else depends on this array, we can revert it to its\n  \t// natural state\n  \tif ( !wrappers.length ) {\n  \t\tdelete array._ractive;\n  \t\tpatch.unpatch( this.value );\n  \t}\n\n  \telse {\n  \t\t// remove ractive instance if possible\n  \t\tinstances[ this.root._guid ] -= 1;\n  \t\tif ( !instances[ this.root._guid ] ) {\n  \t\t\tindex = instances.indexOf( this.root );\n\n  \t\t\tif ( index === -1 ) {\n  \t\t\t\tthrow new Error( errorMessage$1 );\n  \t\t\t}\n\n  \t\t\tinstances.splice( index, 1 );\n  \t\t}\n  \t}\n  };\n\n  var magicAdaptor;\n\n  try {\n  \tObject.defineProperty({}, 'test', { get: function() {}, set: function() {} });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function ( value ) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function ( ractive, value, keypath ) {\n  \t\t\treturn new MagicWrapper( ractive, value, keypath );\n  \t\t}\n  \t};\n  } catch ( err ) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor ( originalDescriptor, ractive, keypath, wrapper ) {\n  \tif ( originalDescriptor.set && originalDescriptor.set.__magic ) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get.call( this );\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif ( setting ) return;\n\n  \t\t\tif ( 'value' in originalDescriptor ) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set.call( this, value );\n  \t\t\t}\n\n  \t\t\tif ( wrapper.locked ) return;\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach( function (ref) {\n  \t\t\t\tvar ractive = ref.ractive;\n  \t\t\t\tvar keypath = ref.keypath;\n\n  \t\t\t\tractive.set( keypath, value );\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert ( descriptor, ractive, keypath ) {\n  \tif ( !descriptor.set || !descriptor.set.__magic ) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile ( i-- ) {\n  \t\tvar dependant = dependants[i];\n  \t\tif ( dependant.ractive === ractive && dependant.keypath === keypath ) {\n  \t\t\tdependants.splice( i, 1 );\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = function MagicWrapper ( ractive, value, keypath ) {\n  \tvar this$1 = this;\n\n  \t\tthis.ractive = ractive;\n  \tthis.value = value;\n  \tthis.keypath = keypath;\n\n  \tthis.originalDescriptors = {};\n\n  \t// wrap all properties with getters\n  \tObject.keys( value ).forEach( function ( key ) {\n  \t\tvar originalDescriptor = Object.getOwnPropertyDescriptor( this$1.value, key );\n  \t\tthis$1.originalDescriptors[ key ] = originalDescriptor;\n\n  \t\tvar childKeypath = keypath ? (\"\" + keypath + \".\" + (escapeKey( key ))) : escapeKey( key );\n\n  \t\tvar descriptor = createOrWrapDescriptor( originalDescriptor, ractive, childKeypath, this$1 );\n\n\n\n  \t\tObject.defineProperty( this$1.value, key, descriptor );\n  \t});\n  };\n\n  MagicWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  MagicWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.value === value;\n  };\n\n  MagicWrapper.prototype.set = function set ( key, value ) {\n  \tthis.value[ key ] = value;\n  };\n\n  MagicWrapper.prototype.teardown = function teardown () {\n  \tvar this$1 = this;\n\n  \t\tObject.keys( this.value ).forEach( function ( key ) {\n  \t\tvar descriptor = Object.getOwnPropertyDescriptor( this$1.value, key );\n  \t\tif ( !descriptor.set || !descriptor.set.__magic ) return;\n\n  \t\trevert( descriptor );\n\n  \t\tif ( descriptor.set.__magic.dependants.length === 1 ) {\n  \t\t\tObject.defineProperty( this$1.value, key, descriptor.set.__magic.originalDescriptor );\n  \t\t}\n  \t});\n  };\n\n  var MagicArrayWrapper = function MagicArrayWrapper ( ractive, array, keypath ) {\n  \tthis.value = array;\n\n  \tthis.magic = true;\n\n  \tthis.magicWrapper = magicAdaptor$1.wrap( ractive, array, keypath );\n  \tthis.arrayWrapper = arrayAdaptor.wrap( ractive, array, keypath );\n  \tthis.arrayWrapper.magic = this.magicWrapper;\n\n  \t// ugh, this really is a terrible hack\n  \tObject.defineProperty( this, '__model', {\n  \t\tget: function () {\n  \t\t\treturn this.arrayWrapper.__model;\n  \t\t},\n  \t\tset: function ( model ) {\n  \t\t\tthis.arrayWrapper.__model = model;\n  \t\t}\n  \t});\n  };\n\n  MagicArrayWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  MagicArrayWrapper.prototype.teardown = function teardown () {\n  \tthis.arrayWrapper.teardown();\n  \tthis.magicWrapper.teardown();\n  };\n\n  MagicArrayWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.arrayWrapper.reset( value ) && this.magicWrapper.reset( value );\n  };\n\n  var magicArrayAdaptor = {\n  \tfilter: function ( object, keypath, ractive ) {\n  \t\treturn magicAdaptor$1.filter( object, keypath, ractive ) && arrayAdaptor.filter( object );\n  \t},\n\n  \twrap: function ( ractive, array, keypath ) {\n  \t\treturn new MagicArrayWrapper( ractive, array, keypath );\n  \t}\n  };\n\n  var RactiveModel = (function (Model) {\n  \tfunction RactiveModel ( ractive ) {\n  \t\tModel.call( this, null, '' );\n  \t\tthis.value = ractive;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.ractive = ractive;\n  \t\tthis.changes = {};\n  \t}\n\n  \tRactiveModel.prototype = Object.create( Model && Model.prototype );\n  \tRactiveModel.prototype.constructor = RactiveModel;\n\n  \tRactiveModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@this';\n  \t};\n\n  \treturn RactiveModel;\n  }(Model));\n\n  var hasProp$1 = Object.prototype.hasOwnProperty;\n\n  var RootModel = (function (Model) {\n  \tfunction RootModel ( options ) {\n  \t\tModel.call( this, null, null );\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype = Object.create( Model && Model.prototype );\n  \tRootModel.prototype.constructor = RootModel;\n\n  \tRootModel.prototype.applyChanges = function applyChanges () {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.attached = function attached ( fragment ) {\n  \t\tattachImplicits( this, fragment );\n  \t};\n\n  \tRootModel.prototype.compute = function compute ( key, signature ) {\n  \t\tvar computation = new Computation( this, signature, key );\n  \t\tthis.computations[ key ] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.createLink = function createLink ( keypath, target, targetPath, options ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar keys = splitKeypathI( keypath );\n\n  \t\tvar model = this;\n  \t\twhile ( keys.length ) {\n  \t\t\tvar key = keys.shift();\n  \t\t\tmodel = this$1.childByKey[ key ] || this$1.joinKey( key );\n  \t\t}\n\n  \t\treturn model.link( target, targetPath, options );\n  \t};\n\n  \tRootModel.prototype.detached = function detached () {\n  \t\tdetachImplicits( this );\n  \t};\n\n  \tRootModel.prototype.get = function get ( shouldCapture, options ) {\n  \t\tvar this$1 = this;\n\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tif ( !options || options.virtual !== false ) {\n  \t\t\tvar result = this.getVirtual();\n  \t\t\tvar keys = Object.keys( this.computations );\n  \t\t\tvar i = keys.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tresult[ keys[i] ] = this$1.computations[ keys[i] ].get();\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t} else {\n  \t\t\treturn this.value;\n  \t\t}\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath () {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.getRactiveModel = function getRactiveModel() {\n  \t\treturn this.ractiveModel || ( this.ractiveModel = new RactiveModel( this.ractive ) );\n  \t};\n\n  \tRootModel.prototype.getValueChildren = function getValueChildren () {\n  \t\tvar children = Model.prototype.getValueChildren.call( this, this.value );\n\n  \t\tthis.children.forEach( function ( child ) {\n  \t\t\tif ( child._link ) {\n  \t\t\t\tvar idx = children.indexOf( child );\n  \t\t\t\tif ( ~idx ) children.splice( idx, 1, child._link );\n  \t\t\t\telse children.push( child._link );\n  \t\t\t}\n  \t\t});\n\n  \t\tfor ( var k in this.computations ) {\n  \t\t\tchildren.push( this.computations[k] );\n  \t\t}\n\n  \t\treturn children;\n  \t};\n\n  \tRootModel.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.deps.forEach( handleChange );\n  \t};\n\n  \tRootModel.prototype.has = function has ( key ) {\n  \t\tvar value = this.value;\n\n  \t\tkey = unescapeKey( key );\n  \t\tif ( key === '@this' || key === '@global' ) return true;\n  \t\tif ( hasProp$1.call( value, key ) ) return true;\n\n  \t\t// mappings/links and computations\n  \t\tif ( key in this.computations || this.childByKey[key] && this.childByKey[key]._link ) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile ( constructor !== Function && constructor !== Array && constructor !== Object ) {\n  \t\t\tif ( hasProp$1.call( constructor.prototype, key ) ) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey ( key, opts ) {\n  \t\tif ( key === '@global' ) return GlobalModel$1;\n  \t\tif ( key === '@this' ) return this.getRactiveModel();\n\n  \t\treturn this.computations.hasOwnProperty( key ) ? this.computations[ key ] :\n  \t\t       Model.prototype.joinKey.call( this, key, opts );\n  \t};\n\n  \t// TODO: this should go away\n  \tRootModel.prototype.map = function map ( localKey, origin, options ) {\n  \t\tvar local = this.joinKey( localKey );\n  \t\tlocal.link( origin, localKey, options );\n  \t};\n\n  \tRootModel.prototype.rebinding = function rebinding () {\n  \t};\n\n  \tRootModel.prototype.set = function set ( value ) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif ( wrapper ) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset( value ) === false;\n\n  \t\t\tif ( shouldTeardown ) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( mark );\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve () {\n  \t\treturn this.wrapper ? this.wrapper.get() : this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \treturn RootModel;\n  }(Model));\n\n  function attachImplicits ( model, fragment ) {\n  \tif ( model._link && model._link.implicit && model._link.isDetached() ) {\n  \t\tmodel.attach( fragment );\n  \t}\n\n  \t// look for unresolveds\n  \tvar i = model.unresolved.length;\n  \twhile ( i-- ) {\n  \t\tvar mdl = resolveReference( fragment, model.unresolved[i] );\n  \t\tif ( mdl ) {\n  \t\t\tmodel.joinKey( mdl.key ).link( mdl, mdl.key, { implicit: true } );\n  \t\t}\n  \t}\n\n  \t// look for virtual children to relink and cascade\n  \tfor ( var k in model.childByKey ) {\n  \t\tif ( k in model.value ) {\n  \t\t\tattachImplicits( model.childByKey[k], fragment );\n  \t\t} else if ( !model.childByKey[k]._link || model.childByKey[k]._link.isDetached() ) {\n  \t\t\tvar mdl$1 = resolveReference( fragment, k );\n  \t\t\tif ( mdl$1 ) {\n  \t\t\t\tmodel.childByKey[k].link( mdl$1, k, { implicit: true } );\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function detachImplicits ( model ) {\n  \tif ( model._link && model._link.implicit ) {\n  \t\tmodel.unlink();\n  \t}\n\n  \tfor ( var k in model.childByKey ) {\n  \t\tdetachImplicits( model.childByKey[k] );\n  \t}\n  }\n\n  function getComputationSignature ( ractive, key, signature ) {\n  \tvar getter;\n  \tvar setter;\n\n  \t// useful for debugging\n  \tvar getterString;\n  \tvar getterUseStack;\n  \tvar setterString;\n\n  \tif ( typeof signature === 'function' ) {\n  \t\tgetter = bind( signature, ractive );\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif ( typeof signature === 'string' ) {\n  \t\tgetter = createFunctionFromString( signature, ractive );\n  \t\tgetterString = signature;\n  \t}\n\n  \tif ( typeof signature === 'object' ) {\n  \t\tif ( typeof signature.get === 'string' ) {\n  \t\t\tgetter = createFunctionFromString( signature.get, ractive );\n  \t\t\tgetterString = signature.get;\n  \t\t} else if ( typeof signature.get === 'function' ) {\n  \t\t\tgetter = bind( signature.get, ractive );\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal( '`%s` computation must have a `get()` method', key );\n  \t\t}\n\n  \t\tif ( typeof signature.set === 'function' ) {\n  \t\t\tsetter = bind( signature.set, ractive );\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook( 'construct' );\n\n  var registryNames$1 = [\n  \t'adaptors',\n  \t'components',\n  \t'decorators',\n  \t'easing',\n  \t'events',\n  \t'interpolators',\n  \t'partials',\n  \t'transitions'\n  ];\n\n  var uid = 0;\n\n  function construct ( ractive, options ) {\n  \tif ( Ractive.DEBUG ) welcome();\n\n  \tinitialiseProperties( ractive );\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire( ractive, options );\n\n  \t// Add registries\n  \tregistryNames$1.forEach( function ( name ) {\n  \t\tractive[ name ] = extendObj( create( ractive.constructor[ name ] || null ), options[ name ] );\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors( ractive, ractive.adapt, options ),\n  \t\tdata: dataConfigurator.init( ractive.constructor, ractive, options ),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extendObj( create( ractive.constructor.prototype.computed ), options.computed );\n\n  \tfor ( var key in computed ) {\n  \t\tvar signature = getComputationSignature( ractive, key, computed[ key ] );\n  \t\tviewmodel.compute( key, signature );\n  \t}\n  }\n\n  function combine$2 ( arrays ) {\n  \tvar res = [];\n  \tvar args = res.concat.apply( res, arrays );\n\n  \tvar i = args.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~res.indexOf( args[i] ) ) {\n  \t\t\tres.unshift( args[i] );\n  \t\t}\n  \t}\n\n  \treturn res;\n  }\n\n  function getAdaptors ( ractive, protoAdapt, options ) {\n  \tprotoAdapt = protoAdapt.map( lookup );\n  \tvar adapt = ensureArray( options.adapt ).map( lookup );\n\n  \tvar builtins = [];\n  \tvar srcs = [ protoAdapt, adapt ];\n  \tif ( ractive.parent && !ractive.isolated ) {\n  \t\tsrcs.push( ractive.parent.viewmodel.adaptors );\n  \t}\n  \tsrcs.push( builtins );\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif ( magic ) {\n  \t\tif ( !magicSupported ) {\n  \t\t\tthrow new Error( 'Getters and setters (magic mode) are not supported in this browser' );\n  \t\t}\n\n  \t\tif ( modifyArrays ) {\n  \t\t\tbuiltins.push( magicArrayAdaptor );\n  \t\t}\n\n  \t\tbuiltins.push( magicAdaptor$1 );\n  \t}\n\n  \tif ( modifyArrays ) {\n  \t\tbuiltins.push( arrayAdaptor );\n  \t}\n\n  \treturn combine$2( srcs );\n\n\n  \tfunction lookup ( adaptor ) {\n  \t\tif ( typeof adaptor === 'string' ) {\n  \t\t\tadaptor = findInViewHierarchy( 'adaptors', ractive, adaptor );\n\n  \t\t\tif ( !adaptor ) {\n  \t\t\t\tfatal( missingPlugin( adaptor, 'adaptor' ) );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties ( ractive ) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create( null );\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \t// external children\n  \tractive._children = [];\n  \tractive._children.byName = {};\n  \tractive.children = ractive._children;\n\n  \tif(!ractive.component){\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  var DOMEvent = function DOMEvent ( name, owner ) {\n  \tif ( name.indexOf( '*' ) !== -1 ) {\n  \t\tfatal( (\"Only component proxy-events may contain \\\"*\\\" wildcards, <\" + (owner.name) + \" on-\" + name + \"=\\\"...\\\"/> is not valid\") );\n  \t}\n\n  \tthis.name = name;\n  \tthis.owner = owner;\n  \tthis.node = null;\n  \tthis.handler = null;\n  };\n\n  DOMEvent.prototype.listen = function listen ( directive ) {\n  \tvar node = this.node = this.owner.node;\n  \tvar name = this.name;\n\n  \tif ( !( (\"on\" + name) in node ) ) {\n  \t\twarnOnce( missingPlugin( name, 'events' ) );\n  \t\t}\n\n  \t\tnode.addEventListener( name, this.handler = function( event ) {\n  \t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false );\n  };\n\n  DOMEvent.prototype.unlisten = function unlisten () {\n  \tthis.node.removeEventListener( this.name, this.handler, false );\n  };\n\n  var CustomEvent = function CustomEvent ( eventPlugin, owner ) {\n  \tthis.eventPlugin = eventPlugin;\n  \tthis.owner = owner;\n  \tthis.handler = null;\n  };\n\n  CustomEvent.prototype.listen = function listen ( directive ) {\n  \tvar node = this.owner.node;\n\n  \tthis.handler = this.eventPlugin( node, function ( event ) {\n  \t\tif ( event === void 0 ) event = {};\n\n  \t\t\tevent.node = event.node || node;\n  \t\tdirective.fire( event );\n  \t});\n  };\n\n  CustomEvent.prototype.unlisten = function unlisten () {\n  \tthis.handler.teardown();\n  };\n\n  var RactiveEvent = function RactiveEvent ( component, name ) {\n  \tthis.component = component;\n  \tthis.name = name;\n  \tthis.handler = null;\n  };\n\n  RactiveEvent.prototype.listen = function listen ( directive ) {\n  \tvar ractive = this.component.instance;\n\n  \tthis.handler = ractive.on( this.name, function () {\n  \t\tvar event;\n\n  \t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\tif ( arguments.length && arguments[0] && arguments[0].node ) {\n  \t\t\tevent = Array.prototype.shift.call( arguments );\n  \t\t\tevent.component = ractive;\n  \t\t}\n\n  \t\tvar args = Array.prototype.slice.call( arguments );\n  \t\tdirective.fire( event, args );\n\n  \t\t// cancel bubbling\n  \t\treturn false;\n  \t});\n  };\n\n  RactiveEvent.prototype.unlisten = function unlisten () {\n  \tthis.handler.cancel();\n  };\n\n  function setupArgsFn ( item, template, fragment, opts ) {\n  \tif ( opts === void 0 ) opts = {};\n\n  \tif ( template && template.f && template.f.s ) {\n  \t\titem.resolvers = [];\n  \t\titem.models = template.f.r.map( function ( ref, i ) {\n  \t\t\tvar resolver, model;\n\n  \t\t\tif ( opts.specialRef && ( model = opts.specialRef( ref, i ) ) ) return model;\n\n  \t\t\tmodel = resolveReference( fragment, ref );\n  \t\t\tif ( !model ) {\n  \t\t\t\tresolver = fragment.resolve( ref, function ( model ) {\n  \t\t\t\t\titem.models[i] = model;\n  \t\t\t\t\tremoveFromArray( item.resolvers, resolver );\n  \t\t\t\t\tmodel.register( item );\n  \t\t\t\t});\n\n  \t\t\t\titem.resolvers.push( resolver );\n  \t\t\t} else model.register( item );\n\n  \t\t\treturn model;\n  \t\t});\n  \t\titem.fn = getFunction( template.f.s, template.f.r.length );\n  \t}\n  }\n\n  function teardownArgsFn ( item, template ) {\n  \tif ( template && template.f && template.f.s ) {\n  \t\tif ( item.resolvers ) item.resolvers.forEach( unbind );\n  \t\titem.resolvers = [];\n\n  \t\tif ( item.models ) item.models.forEach( function ( m ) {\n  \t\t\tif ( m && m.unregister ) m.unregister( item );\n  \t\t});\n  \t\titem.models = null;\n  \t}\n  }\n\n  var specialPattern = /^(event|arguments)(\\..+)?$/;\n  var dollarArgsPattern = /^\\$(\\d+)(\\..+)?$/;\n\n  var EventDirective = function EventDirective ( options ) {\n  \tvar this$1 = this;\n\n  \t\tthis.owner = options.owner || options.parentFragment.owner || findElement( options.parentFragment );\n  \tthis.element = this.owner.attributeByName ? this.owner : findElement( options.parentFragment, true );\n  \tthis.template = options.template;\n  \tthis.parentFragment = options.parentFragment;\n  \tthis.ractive = options.parentFragment.ractive;\n\n  \tthis.events = [];\n\n  \tif ( this.element.type === COMPONENT || this.element.type === ANCHOR ) {\n  \t\tthis.template.n.split( '-' ).forEach( function ( n ) {\n  \t\t\tthis$1.events.push( new RactiveEvent( this$1.element, n ) );\n  \t\t});\n  \t} else {\n  \t\tthis.template.n.split( '-' ).forEach( function ( n ) {\n  \t\t\tvar fn = findInViewHierarchy( 'events', this$1.ractive, n );\n  \t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t// access to node when it is created.\n  \t\t\tthis$1.events.push( fn ? new CustomEvent( fn, this$1.element ) : new DOMEvent( n, this$1.element ) );\n  \t\t});\n  \t}\n\n  \t// method calls\n  \tthis.resolvers = null;\n  \tthis.models = null;\n  };\n\n  EventDirective.prototype.bind = function bind () {\n  \tsetupArgsFn( this, this.template, this.parentFragment, {\n  \t\tspecialRef: function ( ref, i ) {\n  \t\t\tvar specialMatch = specialPattern.exec( ref );\n  \t\t\tif ( specialMatch ) {\n  \t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\treturn {\n  \t\t\t\t\tspecial: specialMatch[1],\n  \t\t\t\t\tkeys: specialMatch[2] ? splitKeypathI( specialMatch[2].substr(1) ) : []\n  \t\t\t\t};\n  \t\t\t}\n\n  \t\t\tvar dollarMatch = dollarArgsPattern.exec( ref );\n  \t\t\tif ( dollarMatch ) {\n  \t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\treturn {\n  \t\t\t\t\tspecial: 'arguments',\n  \t\t\t\t\tkeys: [ dollarMatch[1] - 1 ].concat( dollarMatch[2] ? splitKeypathI( dollarMatch[2].substr( 1 ) ) : [] )\n  \t\t\t\t};\n  \t\t\t}\n  \t\t}\n  \t});\n  \tif ( !this.fn ) this.action = this.template.f;\n  };\n\n  EventDirective.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.owner.bubble();\n  \t}\n  };\n\n  EventDirective.prototype.destroyed = function destroyed () {\n  \tthis.events.forEach( function ( e ) { return e.unlisten(); } );\n  };\n\n  EventDirective.prototype.fire = function fire ( event, passedArgs ) {\n\n  \t// augment event object\n  \tif ( passedArgs === void 0 ) passedArgs = [];\n\n  \t\tif ( event && !event.hasOwnProperty( '_element' ) ) {\n  \t\t   addHelpers( event, this.owner );\n  \t}\n\n  \tif ( this.fn ) {\n  \t\tvar values = [];\n\n  \t\tif ( event ) passedArgs.unshift( event );\n\n  \t\tif ( this.models ) {\n  \t\t\tthis.models.forEach( function ( model ) {\n  \t\t\t\tif ( !model ) return values.push( undefined );\n\n  \t\t\t\tif ( model.special ) {\n  \t\t\t\t\tvar obj = model.special === 'event' ? event : passedArgs;\n  \t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\twhile ( keys.length ) obj = obj[ keys.shift() ];\n  \t\t\t\t\treturn values.push( obj );\n  \t\t\t\t}\n\n  \t\t\t\tif ( model.wrapper ) {\n  \t\t\t\t\treturn values.push( model.wrapperValue );\n  \t\t\t\t}\n\n  \t\t\t\tvalues.push( model.get() );\n  \t\t\t});\n  \t\t}\n\n  \t\t// make event available as `this.event`\n  \t\tvar ractive = this.ractive;\n  \t\tvar oldEvent = ractive.event;\n\n  \t\tractive.event = event;\n  \t\tvar result = this.fn.apply( ractive, values ).pop();\n\n  \t\t// Auto prevent and stop if return is explicitly false\n  \t\tif ( result === false ) {\n  \t\t\tvar original = event ? event.original : undefined;\n  \t\t\tif ( original ) {\n  \t\t\t\toriginal.preventDefault && original.preventDefault();\n  \t\t\t\toriginal.stopPropagation && original.stopPropagation();\n  \t\t\t} else {\n  \t\t\t\twarnOnceIfDebug( (\"handler '\" + (this.template.n) + \"' returned false, but there is no event available to cancel\") );\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.event = oldEvent;\n  \t}\n\n  \telse {\n  \t\tvar args = [];\n  \t\tif ( passedArgs.length ) args = args.concat( passedArgs );\n  \t\tif ( event ) event.name = this.action;\n\n  \t\tfireEvent( this.ractive, this.action, {\n  \t\t\tevent: event,\n  \t\t\targs: args\n  \t\t});\n  \t}\n  };\n\n  EventDirective.prototype.handleChange = function handleChange () {};\n\n  EventDirective.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.models ) return;\n  \tvar idx = this.models.indexOf( previous );\n\n  \tif ( ~idx ) {\n  \t\tthis.models.splice( idx, 1, next );\n  \t\tprevious.unregister( this );\n  \t\tif ( next ) next.addShuffleTask( function () { return next.register( this$1 ); } );\n  \t}\n  };\n\n  EventDirective.prototype.render = function render () {\n  \t// render events after everything else, so they fire after bindings\n  \tvar this$1 = this;\n\n  \t\trunloop.scheduleTask( function () { return this$1.events.forEach( function ( e ) { return e.listen( this$1 ); }, true ); } );\n  };\n\n  EventDirective.prototype.toString = function toString() { return ''; };\n\n  EventDirective.prototype.unbind = function unbind () {\n  \tteardownArgsFn( this, this.template );\n  };\n\n  EventDirective.prototype.unrender = function unrender () {\n  \tthis.events.forEach( function ( e ) { return e.unlisten(); } );\n  };\n\n  EventDirective.prototype.update = function update () {\n  \t// noop\n  };\n\n  function makeDirty ( query ) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook = new Hook( 'teardown' );\n\n  var Component = (function (Item) {\n  \tfunction Component ( options, ComponentConstructor ) {\n  \t\tvar this$1 = this;\n\n  \t\tItem.call( this, options );\n  \t\tthis.isAnchor = this.template.t === ANCHOR;\n  \t\tthis.type = this.isAnchor ? ANCHOR : COMPONENT; // override ELEMENT from super\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif ( !( 'content' in partials ) ) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tif ( this.isAnchor ) {\n  \t\t\tthis.name = options.template.n;\n\n  \t\t\tthis.addChild = addChild;\n  \t\t\tthis.removeChild = removeChild;\n  \t\t} else {\n  \t\t\tvar instance = create( ComponentConstructor.prototype );\n\n  \t\t\tthis.instance = instance;\n  \t\t\tthis.name = options.template.e;\n\n  \t\t\tif ( instance.el ) {\n  \t\t\t\twarnIfDebug( (\"The <\" + (this.name) + \"> component has a default 'el' property; it has been disregarded\") );\n  \t\t\t}\n\n  \t\t\tthis.liveQueries = [];\n\n  \t\t\t// find container\n  \t\t\tvar fragment = options.parentFragment;\n  \t\t\tvar container;\n  \t\t\twhile ( fragment ) {\n  \t\t\t\tif ( fragment.owner.type === YIELDER ) {\n  \t\t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n\n  \t\t\t\tfragment = fragment.parent;\n  \t\t\t}\n\n  \t\t\t// add component-instance-specific properties\n  \t\t\tinstance.parent = this.parentFragment.ractive;\n  \t\t\tinstance.container = container || null;\n  \t\t\tinstance.root = instance.parent.root;\n  \t\t\tinstance.component = this;\n\n  \t\t\tconstruct( this.instance, { partials: partials });\n\n  \t\t\t// for hackability, this could be an open option\n  \t\t\t// for any ractive instance, but for now, just\n  \t\t\t// for components and just for ractive...\n  \t\t\tinstance._inlinePartials = partials;\n  \t\t}\n\n  \t\tthis.attributeByName = {};\n\n  \t\tthis.attributes = [];\n  \t\tvar leftovers = [];\n  \t\t( this.template.m || [] ).forEach( function ( template ) {\n  \t\t\tswitch ( template.t ) {\n  \t\t\t\tcase ATTRIBUTE:\n  \t\t\t\tcase EVENT:\n  \t\t\t\t\tthis$1.attributes.push( createItem({\n  \t\t\t\t\t\towner: this$1,\n  \t\t\t\t\t\tparentFragment: this$1.parentFragment,\n  \t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t}) );\n  \t\t\t\t\tbreak;\n\n  \t\t\t\tcase TRANSITION:\n  \t\t\t\tcase BINDING_FLAG:\n  \t\t\t\tcase DECORATOR:\n  \t\t\t\t\tbreak;\n\n  \t\t\t\tdefault:\n  \t\t\t\t\tleftovers.push( template );\n  \t\t\t\t\tbreak;\n  \t\t\t}\n  \t\t});\n\n  \t\tif ( leftovers.length ) {\n  \t\t\tthis.attributes.push( new ConditionalAttribute({\n  \t\t\t\towner: this,\n  \t\t\t\tparentFragment: this.parentFragment,\n  \t\t\t\ttemplate: leftovers\n  \t\t\t}) );\n  \t\t}\n\n  \t\tthis.eventHandlers = [];\n  \t}\n\n  \tComponent.prototype = Object.create( Item && Item.prototype );\n  \tComponent.prototype.constructor = Component;\n\n  \tComponent.prototype.bind = function bind$1$$ () {\n  \t\tif ( !this.isAnchor ) {\n  \t\t\tthis.attributes.forEach( bind$1 );\n\n  \t\t\tinitialise( this.instance, {\n  \t\t\t\tpartials: this._partials\n  \t\t\t}, {\n  \t\t\t\tcssIds: this.parentFragment.cssIds\n  \t\t\t});\n\n  \t\t\tthis.eventHandlers.forEach( bind$1 );\n\n  \t\t\tthis.bound = true;\n  \t\t}\n  \t};\n\n  \tComponent.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.destroyed = function destroyed () {\n  \t\tif ( !this.isAnchor && this.instance.fragment ) this.instance.fragment.destroyed();\n  \t};\n\n  \tComponent.prototype.detach = function detach () {\n  \t\tif ( this.isAnchor ) {\n  \t\t\tif ( this.instance ) return this.instance.fragment.detach();\n  \t\t\treturn createDocumentFragment()\n  \t\t}\n\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find ( selector, options ) {\n  \t\tif ( this.instance ) return this.instance.fragment.find( selector, options );\n  \t};\n\n  \tComponent.prototype.findAll = function findAll ( selector, query ) {\n  \t\tif ( this.instance ) this.instance.fragment.findAll( selector, query );\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent ( name, options ) {\n  \t\tif ( !name || this.name === name ) return this.instance;\n\n  \t\tif ( this.instance.fragment ) {\n  \t\t\treturn this.instance.fragment.findComponent( name, options );\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.instance && query.test( this ) ) {\n  \t\t\tquery.add( this.instance );\n\n  \t\t\tif ( query.live ) {\n  \t\t\t\tthis.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( this.instance ) this.instance.findAllComponents( name, { _query: query } );\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\tif ( this.instance ) return this.instance.fragment.firstNode( skipParent );\n  \t};\n\n  \tComponent.prototype.removeFromQuery = function removeFromQuery ( query ) {\n  \t\tif ( this.instance ) query.remove( this.instance );\n  \t\tremoveFromArray( this.liveQueries, query );\n  \t};\n\n  \tComponent.prototype.render = function render$1$$ ( target, occupants ) {\n  \t\tif ( this.isAnchor ) {\n  \t\t\tthis.target = target;\n  \t\t\tif ( !checking.length ) {\n  \t\t\t\tchecking.push( this.ractive );\n  \t\t\t\trunloop.scheduleTask( checkAnchors, true );\n  \t\t\t}\n  \t\t} else {\n  \t\t\trender$1( this.instance, target, null, occupants );\n\n  \t\t\tthis.attributes.forEach( render );\n  \t\t\tthis.eventHandlers.forEach( render );\n  \t\t\tupdateLiveQueries$1( this );\n  \t\t}\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.shuffled = function shuffled () {\n  \t\tif ( this.instance ) this.liveQueries.forEach( makeDirty );\n  \t\tItem.prototype.shuffled.call(this);\n  \t};\n\n  \tComponent.prototype.toString = function toString () {\n  \t\tif ( this.instance ) return this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind$1 () {\n  \t\tif ( !this.isAnchor ) {\n  \t\t\tthis.bound = false;\n\n  \t\t\tthis.attributes.forEach( unbind );\n\n  \t\t\tvar instance = this.instance;\n  \t\t\tinstance.viewmodel.teardown();\n  \t\t\tinstance.fragment.unbind();\n  \t\t\tinstance._observers.forEach( cancel );\n\n  \t\t\tif ( instance.fragment.rendered && instance.el.__ractive_instances__ ) {\n  \t\t\t\tremoveFromArray( instance.el.__ractive_instances__, instance );\n  \t\t\t}\n\n  \t\t\tteardownHook.fire( instance );\n  \t\t}\n  \t};\n\n  \tComponent.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \t\tvar this$1 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n\n  \t\tif ( this.isAnchor ) {\n  \t\t\tif ( this.item ) unrenderItem( this, this.item );\n  \t\t\tthis.target = null;\n  \t\t\tif ( !checking.length ) {\n  \t\t\t\tchecking.push( this.ractive );\n  \t\t\t\trunloop.scheduleTask( checkAnchors, true );\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.instance.unrender();\n  \t\t\tthis.instance.el = this.instance.target = null;\n  \t\t\tthis.attributes.forEach( unrender );\n  \t\t\tthis.eventHandlers.forEach( unrender );\n\n  \t\t\tthis.liveQueries.forEach( function ( query ) { return query.remove( this$1.instance ); } );\n  \t\t\tthis.liveQueries = [];\n  \t\t}\n\n  \t\tthis.rendered = false;\n  \t};\n\n  \tComponent.prototype.update = function update$1 () {\n  \t\tthis.dirty = false;\n  \t\tif ( this.instance ) {\n  \t\t\tthis.instance.fragment.update();\n  \t\t\tthis.attributes.forEach( update );\n  \t\t\tthis.eventHandlers.forEach( update );\n  \t\t}\n  \t};\n\n  \treturn Component;\n  }(Item));\n\n  function addChild ( meta ) {\n  \tif ( this.item ) this.removeChild( this.item );\n\n  \tvar child = meta.instance;\n  \tmeta.anchor = this;\n\n  \tmeta.parentFragment = this.parentFragment;\n  \tmeta.name = meta.nameOption || this.name;\n  \tthis.name = meta.name;\n\n\n  \tif ( !child.isolated ) child.viewmodel.attached( this.parentFragment );\n\n  \t// render as necessary\n  \tif ( this.rendered ) {\n  \t\trenderItem( this, meta );\n  \t}\n  }\n\n  function removeChild ( meta ) {\n  \t// unrender as necessary\n  \tif ( this.item === meta ) {\n  \t\tunrenderItem( this, meta );\n  \t\tthis.name = this.template.n;\n  \t}\n  }\n\n  function renderItem ( anchor, meta ) {\n  \tif ( !anchor.rendered ) return;\n\n  \tmeta.shouldDestroy = false;\n  \tmeta.parentFragment = anchor.parentFragment;\n\n  \tanchor.item = meta;\n  \tanchor.instance = meta.instance;\n  \tanchor.liveQueries = meta.liveQueries;\n  \tvar nextNode = anchor.parentFragment.findNextNode( anchor );\n\n  \tif ( meta.instance.fragment.rendered ) {\n  \t\tmeta.instance.unrender();\n  \t}\n\n  \tmeta.partials = meta.instance.partials;\n  \tmeta.instance.partials = extendObj( {}, meta.partials, anchor._partials );\n\n  \tmeta.instance.fragment.unbind();\n  \tmeta.instance.fragment.bind( meta.instance.viewmodel );\n\n  \tanchor.attributes.forEach( bind$1 );\n  \tanchor.eventHandlers.forEach( bind$1 );\n  \tanchor.attributes.forEach( render );\n  \tanchor.eventHandlers.forEach( render );\n\n  \tvar target = anchor.parentFragment.findParentNode();\n  \trender$1( meta.instance, target, target.contains( nextNode ) ? nextNode : null );\n\n  \tif ( meta.lastBound !== anchor ) {\n  \t\tmeta.lastBound = anchor;\n  \t}\n\n  \tupdateLiveQueries$1( meta );\n  }\n\n  function unrenderItem ( anchor, meta ) {\n  \tif ( !anchor.rendered ) return;\n\n  \tmeta.shouldDestroy = true;\n  \tmeta.instance.unrender();\n\n  \tanchor.eventHandlers.forEach( unrender );\n  \tanchor.attributes.forEach( unrender );\n  \tanchor.eventHandlers.forEach( unbind );\n  \tanchor.attributes.forEach( unbind );\n\n  \tmeta.instance.el = meta.instance.anchor = null;\n  \tmeta.parentFragment = null;\n  \tmeta.anchor = null;\n  \tanchor.item = null;\n  \tanchor.instance = null;\n\n  \tmeta.liveQueries.forEach( function ( q ) { return q.remove( meta.instance ); } );\n  \tmeta.liveQueries = [];\n  \tanchor.liveQueries = null;\n  }\n\n  var checking = [];\n  function checkAnchors () {\n  \tvar list = checking;\n  \tchecking = [];\n\n  \tlist.forEach( updateAnchors );\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = function Decorator ( options ) {\n  \tthis.owner = options.owner || options.parentFragment.owner || findElement( options.parentFragment );\n  \tthis.element = this.owner.attributeByName ? this.owner : findElement( options.parentFragment );\n  \tthis.parentFragment = this.owner.parentFragment;\n  \tthis.ractive = this.owner.ractive;\n  \tvar template = this.template = options.template;\n\n  \tthis.name = template.n;\n  \tthis.args = [];\n\n  \tthis.node = null;\n  \tthis.intermediary = null;\n\n  \tthis.element.decorators.push( this );\n  };\n\n  Decorator.prototype.bind = function bind () {\n  \tsetupArgsFn( this, this.template, this.parentFragment );\n  };\n\n  Decorator.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.owner.bubble();\n  \t}\n  };\n\n  Decorator.prototype.destroyed = function destroyed () {\n  \tif ( this.intermediary ) this.intermediary.teardown();\n  };\n\n  Decorator.prototype.handleChange = function handleChange () { this.bubble(); };\n\n  Decorator.prototype.rebinding = function rebinding ( next, previous, safe ) {\n  \tvar idx = this.models.indexOf( previous );\n  \tif ( !~idx ) return;\n\n  \tnext = rebindMatch( this.template.f.r[ idx ], next, previous );\n  \tif ( next === previous ) return;\n\n  \tprevious.unregister( this );\n  \tthis.models.splice( idx, 1, next );\n  \tif ( next ) next.addShuffleRegister( this, 'mark' );\n\n  \tif ( !safe ) this.bubble();\n  };\n\n  Decorator.prototype.render = function render () {\n  \tvar this$1 = this;\n\n  \t\trunloop.scheduleTask( function () {\n  \t\tvar fn = findInViewHierarchy( 'decorators', this$1.ractive, this$1.name );\n\n  \t\tif ( !fn ) {\n  \t\t\twarnOnce( missingPlugin( this$1.name, 'decorator' ) );\n  \t\t\tthis$1.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis$1.node = this$1.element.node;\n\n  \t\tvar args;\n  \t\tif ( this$1.fn ) {\n  \t\t\targs = this$1.models.map( function ( model ) {\n  \t\t\t\tif ( !model ) return undefined;\n\n  \t\t\t\treturn model.get();\n  \t\t\t});\n  \t\t\targs = this$1.fn.apply( this$1.ractive, args );\n  \t\t}\n\n  \t\tthis$1.intermediary = fn.apply( this$1.ractive, [ this$1.node ].concat( args ) );\n\n  \t\tif ( !this$1.intermediary || !this$1.intermediary.teardown ) {\n  \t\t\tthrow new Error( (\"The '\" + (this$1.name) + \"' decorator must return an object with a teardown method\") );\n  \t\t}\n  \t}, true );\n  \tthis.rendered = true;\n  };\n\n  Decorator.prototype.toString = function toString () { return ''; };\n\n  Decorator.prototype.unbind = function unbind () {\n  \tteardownArgsFn( this, this.template );\n  };\n\n  Decorator.prototype.unrender = function unrender ( shouldDestroy ) {\n  \tif ( ( !shouldDestroy || this.element.rendered ) && this.intermediary ) this.intermediary.teardown();\n  \tthis.rendered = false;\n  };\n\n  Decorator.prototype.update = function update () {\n  \tif ( !this.dirty ) return;\n\n  \tthis.dirty = false;\n\n  \tif ( this.intermediary ) {\n  \t\tif ( !this.intermediary.update ) {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t\telse {\n  \t\t\tif ( this.fn ) {\n  \t\t\t\tvar args = this.models.map( function ( model ) {\n  \t\t\t\t\tif ( !model ) return undefined;\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n  \t\t\t\tthis.intermediary.update.apply( this.ractive, this.fn.apply( this.ractive, args ) );\n  \t\t\t}\n  \t\t\telse {\n  \t\t\t\tthis.intermediary.update.apply( this.ractive, this.args );\n  \t\t\t}\n  \t\t}\n  \t}\n  };\n\n  var Doctype = (function (Item) {\n  \tfunction Doctype () {\n  \t\tItem.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype = Object.create( Item && Item.prototype );\n  \tDoctype.prototype.constructor = Doctype;\n\n  \tDoctype.prototype.bind = function bind () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString () {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  }(Item));\n\n  // TODO element.parent currently undefined\n  function findParentForm ( element ) {\n  \twhile ( element = element.parent ) {\n  \t\tif ( element.name === 'form' ) {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity ( description, ractive ) {\n  \twarnOnceIfDebug( (\"The \" + description + \" being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: ractive });\n  }\n\n  var Binding = function Binding ( element, name ) {\n  \tif ( name === void 0 ) name = 'value';\n\n  \t\tthis.element = element;\n  \tthis.ractive = element.ractive;\n  \tthis.attribute = element.attributeByName[ name ];\n\n  \tvar interpolator = this.attribute.interpolator;\n  \tinterpolator.twowayBinding = this;\n\n  \tvar model = interpolator.model;\n\n  \t// not bound?\n  \tif ( !model ) {\n  \t\t// try to force resolution\n  \t\tinterpolator.resolver.forceResolution();\n  \t\tmodel = interpolator.model;\n\n  \t\twarnAboutAmbiguity( (\"'\" + (interpolator.template.r) + \"' reference\"), this.ractive );\n  \t}\n\n  \telse if ( model.isUnresolved ) {\n  \t\t// reference expressions (e.g. foo[bar])\n  \t\tmodel.forceResolution();\n  \t\twarnAboutAmbiguity( 'expression', this.ractive );\n  \t}\n\n  \t// TODO include index/key/keypath refs as read-only\n  \telse if ( model.isReadonly ) {\n  \t\tvar keypath = model.getKeypath().replace( /^@/, '' );\n  \t\t\twarnOnceIfDebug( (\"Cannot use two-way binding on <\" + (element.name) + \"> element: \" + keypath + \" is read-only. To suppress this warning use <\" + (element.name) + \" twoway='false'...>\"), { ractive: this.ractive });\n  \t\treturn false;\n  \t}\n\n  \tthis.attribute.isTwoway = true;\n  \tthis.model = model;\n\n  \t// initialise value, if it's undefined\n  \tvar value = model.get();\n  \tthis.wasUndefined = value === undefined;\n\n  \tif ( value === undefined && this.getInitialValue ) {\n  \t\tvalue = this.getInitialValue();\n  \t\tmodel.set( value );\n  \t}\n\n  \tvar parentForm = findParentForm( element );\n  \tif ( parentForm ) {\n  \t\tthis.resetValue = value;\n  \t\tparentForm.formBindings.push( this );\n  \t}\n  };\n\n  Binding.prototype.bind = function bind () {\n  \tthis.model.registerTwowayBinding( this );\n  };\n\n  Binding.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n  \tif ( this.lastVal() === value ) return;\n\n  \trunloop.start( this.root );\n  \tthis.attribute.locked = true;\n  \tthis.model.set( value );\n  \tthis.lastVal( true, value );\n\n  \t// if the value changes before observers fire, unlock to be updatable cause something weird and potentially freezy is up\n  \tif ( this.model.get() !== value ) this.attribute.locked = false;\n  \telse runloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n\n  \trunloop.end();\n  };\n\n  Binding.prototype.lastVal = function lastVal ( setting, value ) {\n  \tif ( setting ) this.lastValue = value;\n  \telse return this.lastValue;\n  };\n\n  Binding.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.model && this.model === previous ) previous.unregisterTwowayBinding( this );\n  \tif ( next ) {\n  \t\tthis.model = next;\n  \t\trunloop.scheduleTask( function () { return next.registerTwowayBinding( this$1 ); } );\n  \t}\n     };\n\n  Binding.prototype.render = function render () {\n  \tthis.node = this.element.node;\n  \tthis.node._ractive.binding = this;\n  \tthis.rendered = true; // TODO is this used anywhere?\n  };\n\n  Binding.prototype.setFromNode = function setFromNode ( node ) {\n  \tthis.model.set( node.value );\n  };\n\n  Binding.prototype.unbind = function unbind () {\n  \tthis.model.unregisterTwowayBinding( this );\n  };\n\n  Binding.prototype.unrender = function unrender () {\n  \t// noop?\n  };\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n  function handleDomEvent () {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (Binding) {\n  \tfunction CheckboxBinding ( element ) {\n  \t\tBinding.call( this, element, 'checked' );\n  \t}\n\n  \tCheckboxBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tCheckboxBinding.prototype.constructor = CheckboxBinding;\n\n  \tCheckboxBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.node.attachEvent ) {\n  \t\t\tthis.node.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t\tthis.node.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn !!this.element.getAttribute( 'checked' );\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tCheckboxBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.checked );\n  \t};\n\n  \treturn CheckboxBinding;\n  }(Binding));\n\n  function getBindingGroup ( group, model, getValue ) {\n  \tvar hash = \"\" + group + \"-bindingGroup\";\n  \treturn model[hash] || ( model[ hash ] = new BindingGroup( hash, model, getValue ) );\n  }\n\n  var BindingGroup = function BindingGroup ( hash, model, getValue ) {\n  \tvar this$1 = this;\n\n  \t\tthis.model = model;\n  \tthis.hash = hash;\n  \tthis.getValue = function () {\n  \t\tthis$1.value = getValue.call(this$1);\n  \t\treturn this$1.value;\n  \t};\n\n  \tthis.bindings = [];\n  };\n\n  BindingGroup.prototype.add = function add ( binding ) {\n  \tthis.bindings.push( binding );\n  };\n\n  BindingGroup.prototype.bind = function bind () {\n  \tthis.value = this.model.get();\n  \tthis.model.registerTwowayBinding( this );\n  \tthis.bound = true;\n  };\n\n  BindingGroup.prototype.remove = function remove ( binding ) {\n  \tremoveFromArray( this.bindings, binding );\n  \tif ( !this.bindings.length ) {\n  \t\tthis.unbind();\n  \t}\n  };\n\n  BindingGroup.prototype.unbind = function unbind () {\n  \tthis.model.unregisterTwowayBinding( this );\n  \tthis.bound = false;\n  \tdelete this.model[this.hash];\n  };\n\n  var push$2 = [].push;\n\n  function getValue() {\n  \tvar all = this.bindings.filter(function ( b ) { return b.node && b.node.checked; }).map(function ( b ) { return b.element.getAttribute( 'value' ); });\n  \tvar res = [];\n  \tall.forEach(function ( v ) { if ( !arrayContains( res, v ) ) res.push( v ); });\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (Binding) {\n  \tfunction CheckboxNameBinding ( element ) {\n  \t\tBinding.call( this, element, 'name' );\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup( 'checkboxes', this.model, getValue );\n  \t\tthis.group.add( this );\n\n  \t\tif ( this.noInitialValue ) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif ( this.group.noInitialValue && this.element.getAttribute( 'checked' ) ) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute( 'value' );\n\n  \t\t\tif ( !arrayContains( existingValue, bindingValue ) ) {\n  \t\t\t\tpush$2.call( existingValue, bindingValue ); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tCheckboxNameBinding.prototype.constructor = CheckboxNameBinding;\n\n  \tCheckboxNameBinding.prototype.bind = function bind () {\n  \t\tif ( !this.group.bound ) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed () {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue$1 () {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange () {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute( 'value' );\n  \t\tif ( this.isChecked && !arrayContains( this.group.value, value ) ) {\n  \t\t\tthis.group.value.push( value );\n  \t\t} else if ( !this.isChecked && arrayContains( this.group.value, value ) ) {\n  \t\t\tremoveFromArray( this.group.value, value );\n  \t\t}\n  \t\t// make sure super knows there's a change\n  \t\tthis.lastValue = null;\n  \t\tBinding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute( 'value' );\n\n  \t\tif ( isArray( existingValue ) ) {\n  \t\t\tthis.isChecked = arrayContains( existingValue, bindingValue );\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif ( node.attachEvent ) {\n  \t\t\tnode.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.group.bindings.forEach( function ( binding ) { return binding.wasUndefined = true; } );\n\n  \t\tif ( node.checked ) {\n  \t\t\tvar valueSoFar = this.group.getValue();\n  \t\t\tvalueSoFar.push( this.element.getAttribute( 'value' ) );\n\n  \t\t\tthis.group.model.set( valueSoFar );\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind () {\n  \t\tthis.group.remove( this );\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn CheckboxNameBinding;\n  }(Binding));\n\n  var ContentEditableBinding = (function (Binding) {\n  \tfunction ContentEditableBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tContentEditableBinding.prototype.constructor = ContentEditableBinding;\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue () {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n  \t\tnode.addEventListener( 'blur', handleDomEvent, false );\n\n  \t\tif ( !this.ractive.lazy ) {\n  \t\t\tnode.addEventListener( 'input', handleDomEvent, false );\n\n  \t\t\tif ( node.attachEvent ) {\n  \t\t\t\tnode.addEventListener( 'keyup', handleDomEvent, false );\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.innerHTML );\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener( 'blur', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'input', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'keyup', handleDomEvent, false );\n  \t};\n\n  \treturn ContentEditableBinding;\n  }(Binding));\n\n  function handleBlur () {\n  \thandleDomEvent.call( this );\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay ( delay ) {\n  \tvar timeout;\n\n  \treturn function () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( timeout ) clearTimeout( timeout );\n\n  \t\ttimeout = setTimeout( function () {\n  \t\t\tvar binding = this$1._ractive.binding;\n  \t\t\tif ( binding.rendered ) handleDomEvent.call( this$1 );\n  \t\t\ttimeout = null;\n  \t\t}, delay );\n  \t};\n  }\n\n  var GenericBinding = (function (Binding) {\n  \tfunction GenericBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tGenericBinding.prototype.constructor = GenericBinding;\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\tif ( 'lazy' in this.element ) {\n  \t\t\tlazy = this.element.lazy;\n  \t\t}\n\n  \t\tif ( isNumeric( lazy ) ) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay( timeout ) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( !lazy ) {\n  \t\t\tnode.addEventListener( 'input', this.handler, false );\n\n  \t\t\tif ( node.attachEvent ) {\n  \t\t\t\tnode.addEventListener( 'keyup', this.handler, false );\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener( 'blur', handleBlur, false );\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'input', this.handler, false );\n  \t\tnode.removeEventListener( 'keyup', this.handler, false );\n  \t\tnode.removeEventListener( 'blur', handleBlur, false );\n  \t};\n\n  \treturn GenericBinding;\n  }(Binding));\n\n  var FileBinding = (function (GenericBinding) {\n  \tfunction FileBinding () {\n  \t\tGenericBinding.apply(this, arguments);\n  \t}\n\n  \tFileBinding.prototype = Object.create( GenericBinding && GenericBinding.prototype );\n  \tFileBinding.prototype.constructor = FileBinding;\n\n  \tFileBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn undefined;\n  \t};\n\n  \tFileBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.files;\n  \t};\n\n  \tFileBinding.prototype.render = function render () {\n  \t\tthis.element.lazy = false;\n  \t\tGenericBinding.prototype.render.call(this);\n  \t};\n\n  \tFileBinding.prototype.setFromNode = function setFromNode( node ) {\n  \t\tthis.model.set( node.files );\n  \t};\n\n  \treturn FileBinding;\n  }(GenericBinding));\n\n  function getSelectedOptions ( select ) {\n      return select.selectedOptions\n  \t\t? toArray( select.selectedOptions )\n  \t\t: select.options\n  \t\t\t? toArray( select.options ).filter( function ( option ) { return option.selected; } )\n  \t\t\t: [];\n  }\n\n  var MultipleSelectBinding = (function (Binding) {\n  \tfunction MultipleSelectBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tMultipleSelectBinding.prototype.constructor = MultipleSelectBinding;\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate () {\n  \t\tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \t\t\tthis.model.set( value );\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn this.element.options\n  \t\t\t.filter( function ( option ) { return option.getAttribute( 'selected' ); } )\n  \t\t\t.map( function ( option ) { return option.getAttribute( 'value' ); } );\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue () {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor ( var i = 0; i < len; i += 1 ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( option.selected ) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push( optionValue );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange () {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( previousValue === undefined || !arrayContentsMatch( value, previousValue ) ) {\n  \t\t\tBinding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.model.get() === undefined ) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tvar selectedOptions = getSelectedOptions( node );\n  \t\tvar i = selectedOptions.length;\n  \t\tvar result = new Array( i );\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = selectedOptions[i];\n  \t\t\tresult[i] = option._ractive ? option._ractive.value : option.value;\n  \t\t}\n\n  \t\tthis.model.set( result );\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue () {\n  \t\tthrow new Error( 'TODO not implemented yet' );\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel () {\n  \t\tif ( this.attribute.value === undefined || !this.attribute.value.length ) {\n  \t\t\tthis.keypath.set( this.initialValue );\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  }(Binding));\n\n  var NumericBinding = (function (GenericBinding) {\n  \tfunction NumericBinding () {\n  \t\tGenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype = Object.create( GenericBinding && GenericBinding.prototype );\n  \tNumericBinding.prototype.constructor = NumericBinding;\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue () {\n  \t\tvar value = parseFloat( this.node.value );\n  \t\treturn isNaN( value ) ? undefined : value;\n  \t};\n\n  \tNumericBinding.prototype.setFromNode = function setFromNode( node ) {\n  \t\tvar value = parseFloat( node.value );\n  \t\tif ( !isNaN( value ) ) this.model.set( value );\n  \t};\n\n  \treturn NumericBinding;\n  }(GenericBinding));\n\n  var siblings = {};\n\n  function getSiblings ( hash ) {\n  \treturn siblings[ hash ] || ( siblings[ hash ] = [] );\n  }\n\n  var RadioBinding = (function (Binding) {\n  \tfunction RadioBinding ( element ) {\n  \t\tBinding.call( this, element, 'checked' );\n\n  \t\tthis.siblings = getSiblings( this.ractive._guid + this.element.getAttribute( 'name' ) );\n  \t\tthis.siblings.push( this );\n  \t}\n\n  \tRadioBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tRadioBinding.prototype.constructor = RadioBinding;\n\n  \tRadioBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange () {\n  \t\trunloop.start( this.root );\n\n  \t\tthis.siblings.forEach( function ( binding ) {\n  \t\t\tbinding.model.set( binding.getValue() );\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.node.attachEvent ) {\n  \t\t\tthis.node.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.checked );\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind () {\n  \t\tremoveFromArray( this.siblings, this );\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t\tthis.node.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn RadioBinding;\n  }(Binding));\n\n  function getValue$1() {\n  \tvar checked = this.bindings.filter( function ( b ) { return b.node.checked; } );\n  \tif ( checked.length > 0 ) {\n  \t\treturn checked[0].element.getAttribute( 'value' );\n  \t}\n  }\n\n  var RadioNameBinding = (function (Binding) {\n  \tfunction RadioNameBinding ( element ) {\n  \t\tBinding.call( this, element, 'name' );\n\n  \t\tthis.group = getBindingGroup( 'radioname', this.model, getValue$1 );\n  \t\tthis.group.add( this );\n\n  \t\tif ( element.checked ) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tRadioNameBinding.prototype.constructor = RadioNameBinding;\n\n  \tRadioNameBinding.prototype.bind = function bind () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.group.bound ) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () { return this$1.node.name = \"{{\" + (this$1.model.getKeypath()) + \"}}\"; }\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register( this.nameAttributeBinding );\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\tif ( this.element.getAttribute( 'checked' ) ) {\n  \t\t\treturn this.element.getAttribute( 'value' );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue$1 () {\n  \t\treturn this.element.getAttribute( 'value' );\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange () {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif ( this.node.checked ) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\tBinding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.lastVal = function lastVal ( setting, value ) {\n  \t\tif ( setting ) this.group.lastValue = value;\n  \t\telse return this.group.lastValue;\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = \"{{\" + (this.model.getKeypath()) + \"}}\";\n  \t\tnode.checked = this.model.get() == this.element.getAttribute( 'value' );\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( node.attachEvent ) {\n  \t\t\tnode.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tif ( node.checked ) {\n  \t\t\tthis.group.model.set( this.element.getAttribute( 'value' ) );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind () {\n  \t\tthis.group.remove( this );\n\n  \t\tthis.model.getKeypathModel().unregister( this.nameAttributeBinding );\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn RadioNameBinding;\n  }(Binding));\n\n  var SingleSelectBinding = (function (Binding) {\n  \tfunction SingleSelectBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tSingleSelectBinding.prototype.constructor = SingleSelectBinding;\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate () {\n  \t\tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \t\t\tthis.model.set( value );\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\tif ( this.element.getAttribute( 'value' ) !== undefined ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif ( !len ) return;\n\n  \t\tvar value;\n  \t\tvar optionWasSelected;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( option.getAttribute( 'selected' ) ) {\n  \t\t\t\tif ( !option.getAttribute( 'disabled' ) ) {\n  \t\t\t\t\tvalue = option.getAttribute( 'value' );\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif ( !optionWasSelected ) {\n  \t\t\twhile ( ++i < len ) {\n  \t\t\t\tif ( !options[i].getAttribute( 'disabled' ) ) {\n  \t\t\t\t\tvalue = options[i].getAttribute( 'value' );\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue () {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i;\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( options[i].selected && !options[i].disabled ) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \tSingleSelectBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tvar option = getSelectedOptions( node )[0];\n  \t\tthis.model.set( option._ractive ? option._ractive.value : option.value );\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n  \tSingleSelectBinding.prototype.setValue = function setValue ( value ) {\n  \t\tthis.model.set( value );\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \treturn SingleSelectBinding;\n  }(Binding));\n\n  function isBindable ( attribute ) {\n  \treturn attribute &&\n  \t\t   attribute.template.f &&\n  \t       attribute.template.f.length === 1 &&\n  \t       attribute.template.f[0].t === INTERPOLATOR &&\n  \t       !attribute.template.f[0].s;\n  }\n\n  function selectBinding ( element ) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif ( element.getAttribute( 'contenteditable' ) || isBindable( attributes.contenteditable ) ) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable( attributes.value ) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif ( element.name === 'input' ) {\n  \t\tvar type = element.getAttribute( 'type' );\n\n  \t\tif ( type === 'radio' || type === 'checkbox' ) {\n  \t\t\tvar bindName = isBindable( attributes.name );\n  \t\t\tvar bindChecked = isBindable( attributes.checked );\n\n  \t\t\t// for radios we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif ( bindName && bindChecked ) {\n  \t\t\t\tif ( type === 'radio' ) {\n  \t\t\t\t\twarnIfDebug( 'A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t\t} else {\n  \t\t\t\t\t// A checkbox with bindings for both name and checked - see https://github.com/ractivejs/ractive/issues/1749\n  \t\t\t\t\treturn CheckboxBinding;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( bindName ) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif ( bindChecked ) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( type === 'file' && isBindable( attributes.value ) ) {\n  \t\t\treturn FileBinding;\n  \t\t}\n\n  \t\tif ( isBindable( attributes.value ) ) {\n  \t\t\treturn ( type === 'number' || type === 'range' ) ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif ( element.name === 'select' && isBindable( attributes.value ) ) {\n  \t\treturn element.getAttribute( 'multiple' ) ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif ( element.name === 'textarea' && isBindable( attributes.value ) ) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1 ( query ) {\n  \tquery.makeDirty();\n  }\n\n  var endsWithSemi = /;\\s*$/;\n\n  var Element = (function (ContainerItem) {\n  \tfunction Element ( options ) {\n  \t\tvar this$1 = this;\n\n  \t\tContainerItem.call( this, options );\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test( this.name );\n\n  \t\t// find parent element\n  \t\tthis.parent = findElement( this.parentFragment, false );\n\n  \t\tif ( this.parent && this.parent.name === 'option' ) {\n  \t\t\tthrow new Error( (\"An <option> element cannot contain other elements (encountered <\" + (this.name) + \">)\") );\n  \t\t}\n\n  \t\tthis.decorators = [];\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n\n  \t\tthis.attributes = [];\n  \t\tvar leftovers = [];\n  \t\t( this.template.m || [] ).forEach( function ( template ) {\n  \t\t\tswitch ( template.t ) {\n  \t\t\t\tcase ATTRIBUTE:\n  \t\t\t\tcase BINDING_FLAG:\n  \t\t\t\tcase DECORATOR:\n  \t\t\t\tcase EVENT:\n  \t\t\t\tcase TRANSITION:\n  \t\t\t\t\tthis$1.attributes.push( createItem({\n  \t\t\t\t\t\towner: this$1,\n  \t\t\t\t\t\tparentFragment: this$1.parentFragment,\n  \t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t}) );\n  \t\t\t\t\tbreak;\n\n  \t\t\t\tdefault:\n  \t\t\t\t\tleftovers.push( template );\n  \t\t\t\t\tbreak;\n  \t\t\t}\n  \t\t});\n\n  \t\tif ( leftovers.length ) {\n  \t\t\tthis.attributes.push( new ConditionalAttribute({\n  \t\t\t\towner: this,\n  \t\t\t\tparentFragment: this.parentFragment,\n  \t\t\t\ttemplate: leftovers\n  \t\t\t}) );\n  \t\t}\n\n  \t\tvar i = this.attributes.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar attr = this$1.attributes[ i ];\n  \t\t\tif ( attr.name === 'type' ) this$1.attributes.unshift( this$1.attributes.splice( i, 1 )[ 0 ] );\n  \t\t\telse if ( attr.name === 'max' ) this$1.attributes.unshift( this$1.attributes.splice( i, 1 )[ 0 ] );\n  \t\t\telse if ( attr.name === 'min' ) this$1.attributes.unshift( this$1.attributes.splice( i, 1 )[ 0 ] );\n  \t\t\telse if ( attr.name === 'class' ) this$1.attributes.unshift( this$1.attributes.splice( i, 1 )[ 0 ] );\n  \t\t\telse if ( attr.name === 'value' ) {\n  \t\t\t\tthis$1.attributes.push( this$1.attributes.splice( i, 1 )[ 0 ] );\n  \t\t\t}\n  \t\t}\n\n  \t\t// create children\n  \t\tif ( options.template.f && !options.deferContent ) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype = Object.create( ContainerItem && ContainerItem.prototype );\n  \tElement.prototype.constructor = Element;\n\n  \tElement.prototype.bind = function bind$1$$ () {\n  \t\tthis.attributes.binding = true;\n  \t\tthis.attributes.forEach( bind$1 );\n  \t\tthis.attributes.binding = false;\n\n  \t\tif ( this.fragment ) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif ( !this.binding ) this.recreateTwowayBinding();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding () {\n  \t\tvar shouldBind = 'twoway' in this ? this.twoway : this.ractive.twoway;\n\n  \t\tif ( !shouldBind ) return null;\n\n  \t\tvar Binding = selectBinding( this );\n\n  \t\tif ( !Binding ) return null;\n\n  \t\tvar binding = new Binding( this );\n\n  \t\treturn binding && binding.model ?\n  \t\t\tbinding :\n  \t\t\tnull;\n  \t};\n\n  \tElement.prototype.destroyed = function destroyed () {\n  \t\tthis.attributes.forEach( function ( a ) { return a.destroyed(); } );\n  \t\tif ( this.fragment ) this.fragment.destroyed();\n  \t};\n\n  \tElement.prototype.detach = function detach () {\n  \t\t// if this element is no longer rendered, the transitions are complete and the attributes can be torn down\n  \t\tif ( !this.rendered ) this.destroyed();\n\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tElement.prototype.find = function find ( selector, options ) {\n  \t\tif ( matches( this.node, selector ) ) return this.node;\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector, options );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll ( selector, query ) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test( this.node );\n  \t\tif ( matches ) {\n  \t\t\tquery.add( this.node );\n  \t\t\tif ( query.live ) this.liveQueries.push( query );\n  \t\t}\n\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode () {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute ( name ) {\n  \t\tvar attribute = this.attributeByName[ name ];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.recreateTwowayBinding = function recreateTwowayBinding () {\n  \t\tif ( this.binding ) {\n  \t\t\tthis.binding.unbind();\n  \t\t\tthis.binding.unrender();\n  \t\t}\n\n  \t\tif ( this.binding = this.createTwowayBinding() ) {\n  \t\t\tthis.binding.bind();\n  \t\t\tif ( this.rendered ) this.binding.render();\n  \t\t}\n  \t};\n\n  \tElement.prototype.removeFromQuery = function removeFromQuery ( query ) {\n  \t\tquery.remove( this.node );\n  \t\tremoveFromArray( this.liveQueries, query );\n  \t};\n\n  \tElement.prototype.render = function render$1 ( target, occupants ) {\n  \t\t// TODO determine correct namespace\n  \t\tvar this$1 = this;\n\n  \t\tthis.namespace = getNamespace( this );\n\n  \t\tvar node;\n  \t\tvar existing = false;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n;\n  \t\t\twhile ( ( n = occupants.shift() ) ) {\n  \t\t\t\tif ( n.nodeName.toUpperCase() === this$1.template.e.toUpperCase() && n.namespaceURI === this$1.namespace ) {\n  \t\t\t\t\tthis$1.node = node = n;\n  \t\t\t\t\texisting = true;\n  \t\t\t\t\tbreak;\n  \t\t\t\t} else {\n  \t\t\t\t\tdetachNode( n );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( !node ) {\n  \t\t\tnode = createElement( this.template.e, this.namespace, this.getAttribute( 'is' ) );\n  \t\t\tthis.node = node;\n  \t\t}\n\n  \t\tdefineProperty( node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif ( this.parentFragment.cssIds ) {\n  \t\t\tnode.setAttribute( 'data-ractive-css', this.parentFragment.cssIds.map( function ( x ) { return (\"{\" + x + \"}\"); } ).join( ' ' ) );\n  \t\t}\n\n  \t\tif ( existing && this.foundNode ) this.foundNode( node );\n\n  \t\tif ( this.fragment ) {\n  \t\t\tvar children = existing ? toArray( node.childNodes ) : undefined;\n\n  \t\t\tthis.fragment.render( node, children );\n\n  \t\t\t// clean up leftover children\n  \t\t\tif ( children ) {\n  \t\t\t\tchildren.forEach( detachNode );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( existing ) {\n  \t\t\t// store initial values for two-way binding\n  \t\t\tif ( this.binding && this.binding.wasUndefined ) this.binding.setFromNode( node );\n  \t\t\t// remove unused attributes\n  \t\t\tvar i = node.attributes.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tvar name = node.attributes[i].name;\n  \t\t\t\tif ( !( name in this$1.attributeByName ) ) node.removeAttribute( name );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.attributes.forEach( render );\n\n  \t\tif ( this.binding ) this.binding.render();\n\n  \t\tupdateLiveQueries( this );\n\n  \t\tif ( this._introTransition && this.ractive.transitionsEnabled ) {\n  \t\t\tthis._introTransition.isIntro = true;\n  \t\t\trunloop.registerTransition( this._introTransition );\n  \t\t}\n\n  \t\tif ( !existing ) {\n  \t\t\ttarget.appendChild( node );\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.shuffled = function shuffled () {\n  \t\tthis.liveQueries.forEach( makeDirty$1 );\n  \t\tContainerItem.prototype.shuffled.call(this);\n  \t};\n\n  \tElement.prototype.toString = function toString () {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map( stringifyAttribute ).join( '' );\n\n  \t\t// Special case - selected options\n  \t\tif ( this.name === 'option' && this.isSelected() ) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif ( this.name === 'input' && inputIsCheckedRadio( this ) ) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\t// Special case style and class attributes and directives\n  \t\tvar style, cls;\n  \t\tthis.attributes.forEach( function ( attr ) {\n  \t\t\tif ( attr.name === 'class' ) {\n  \t\t\t\tcls = ( cls || '' ) + ( cls ? ' ' : '' ) + safeAttributeString( attr.getString() );\n  \t\t\t} else if ( attr.name === 'style' ) {\n  \t\t\t\tstyle = ( style || '' ) + ( style ? ' ' : '' ) + safeAttributeString( attr.getString() );\n  \t\t\t\tif ( style && !endsWithSemi.test( style ) ) style += ';';\n  \t\t\t} else if ( attr.styleName ) {\n  \t\t\t\tstyle = ( style || '' ) + ( style ? ' ' : '' ) +  \"\" + (decamelize( attr.styleName )) + \": \" + (safeAttributeString( attr.getString() )) + \";\";\n  \t\t\t} else if ( attr.inlineClass && attr.getValue() ) {\n  \t\t\t\tcls = ( cls || '' ) + ( cls ? ' ' : '' ) + attr.inlineClass;\n  \t\t\t}\n  \t\t});\n  \t\t// put classes first, then inline style\n  \t\tif ( style !== undefined ) attrs = ' style' + ( style ? (\"=\\\"\" + style + \"\\\"\") : '' ) + attrs;\n  \t\tif ( cls !== undefined ) attrs = ' class' + (cls ? (\"=\\\"\" + cls + \"\\\"\") : '') + attrs;\n\n  \t\tvar str = \"<\" + tagName + \"\" + attrs + \">\";\n\n  \t\tif ( this.isVoid ) return str;\n\n  \t\t// Special case - textarea\n  \t\tif ( this.name === 'textarea' && this.getAttribute( 'value' ) !== undefined ) {\n  \t\t\tstr += escapeHtml( this.getAttribute( 'value' ) );\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if ( this.getAttribute( 'contenteditable' ) !== undefined ) {\n  \t\t\tstr += ( this.getAttribute( 'value' ) || '' );\n  \t\t}\n\n  \t\tif ( this.fragment ) {\n  \t\t\tstr += this.fragment.toString( !/^(?:script|style)$/i.test( this.template.e ) ); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += \"</\" + tagName + \">\";\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind$1 () {\n  \t\tthis.attributes.forEach( unbind );\n\n  \t\tif ( this.binding ) this.binding.unbind();\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.rendered ) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif ( transition && transition.complete ) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif ( this.name === 'option' ) {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if ( shouldDestroy ) {\n  \t\t\trunloop.detachWhenReady( this );\n  \t\t}\n\n  \t\tif ( this.fragment ) this.fragment.unrender();\n\n  \t\tif ( this.binding ) this.binding.unrender();\n\n  \t\t// outro transition\n  \t\tif ( this._outroTransition && this.ractive.transitionsEnabled ) {\n  \t\t\tthis._outroTransition.isIntro = false;\n  \t\t\trunloop.registerTransition( this._outroTransition );\n  \t\t}\n\n  \t\tthis.liveQueries.forEach( function ( query ) { return query.remove( this$1.node ); } );\n  \t\tthis.liveQueries = [];\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update$1 () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.attributes.forEach( update );\n\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Element;\n  }(ContainerItem));\n\n  function inputIsCheckedRadio ( element ) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute  = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute  = attributes.name;\n\n  \tif ( !typeAttribute || ( typeAttribute.value !== 'radio' ) || !valueAttribute || !nameAttribute.interpolator ) {\n  \t\treturn;\n  \t}\n\n  \tif ( valueAttribute.getValue() === nameAttribute.interpolator.model.get() ) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute ( attribute ) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function getNamespace ( element ) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute( 'xmlns' );\n  \tif ( xmlns ) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif ( element.name === 'svg' ) return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif ( parent ) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif ( parent.name === 'foreignobject' ) return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Form = (function (Element) {\n  \tfunction Form ( options ) {\n  \t\tElement.call( this, options );\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype = Object.create( Element && Element.prototype );\n  \tForm.prototype.constructor = Form;\n\n  \tForm.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.node.addEventListener( 'reset', handleReset, false );\n  \t};\n\n  \tForm.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.node.removeEventListener( 'reset', handleReset, false );\n  \t\tElement.prototype.unrender.call( this, shouldDestroy );\n  \t};\n\n  \treturn Form;\n  }(Element));\n\n  function handleReset () {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach( updateModel$1 );\n  \trunloop.end();\n  }\n\n  function updateModel$1 ( binding ) {\n  \tbinding.model.set( binding.resetValue );\n  }\n\n  var Mustache = (function (Item) {\n  \tfunction Mustache ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tif ( options.owner ) this.parent = options.owner;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype = Object.create( Item && Item.prototype );\n  \tMustache.prototype.constructor = Mustache;\n\n  \tMustache.prototype.bind = function bind () {\n  \t\t// try to find a model for this view\n  \t\tvar this$1 = this;\n\n  \t\tvar model = resolve$2( this.parentFragment, this.template );\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif ( this.isStatic ) {\n  \t\t\tthis.model = { get: function () { return value; } };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( model ) {\n  \t\t\tmodel.register( this );\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve( this.template.r, function ( model ) {\n  \t\t\t\tthis$1.model = model;\n  \t\t\t\tmodel.register( this$1 );\n\n  \t\t\t\tthis$1.handleChange();\n  \t\t\t\tthis$1.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange () {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebinding = function rebinding ( next, previous, safe ) {\n  \t\tnext = rebindMatch( this.template, next, previous );\n  \t\tif ( this['static'] ) return false;\n  \t\tif ( next === this.model ) return false;\n\n  \t\tif ( this.model ) {\n  \t\t\tthis.model.unregister( this );\n  \t\t}\n  \t\tif ( next ) next.addShuffleRegister( this, 'mark' );\n  \t\tthis.model = next;\n  \t\tif ( !safe ) this.handleChange();\n  \t\treturn true;\n  \t};\n\n  \tMustache.prototype.unbind = function unbind () {\n  \t\tif ( !this.isStatic ) {\n  \t\t\tthis.model && this.model.unregister( this );\n  \t\t\tthis.model = undefined;\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  }(Item));\n\n  var MustacheContainer = (function (ContainerItem) {\n  \tfunction MustacheContainer ( options ) {\n  \t\tContainerItem.call( this, options );\n  \t}\n\n  \tMustacheContainer.prototype = Object.create( ContainerItem && ContainerItem.prototype );\n  \tMustacheContainer.prototype.constructor = MustacheContainer;\n\n  \treturn MustacheContainer;\n  }(ContainerItem));;\n  var proto$1 = MustacheContainer.prototype;\n  var mustache = Mustache.prototype;\n  proto$1.bind = mustache.bind;\n  proto$1.handleChange = mustache.handleChange;\n  proto$1.rebinding = mustache.rebinding;\n  proto$1.unbind = mustache.unbind;\n\n  var Interpolator = (function (Mustache) {\n  \tfunction Interpolator () {\n  \t\tMustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype = Object.create( Mustache && Mustache.prototype );\n  \tInterpolator.prototype.constructor = Interpolator;\n\n  \tInterpolator.prototype.bubble = function bubble () {\n  \t\tif ( this.owner ) this.owner.bubble();\n  \t\tMustache.prototype.bubble.call(this);\n  \t};\n\n  \tInterpolator.prototype.detach = function detach () {\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString () {\n  \t\treturn this.model ? safeToStringValue( this.model.get() ) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render ( target, occupants ) {\n  \t\tif ( inAttributes() ) return;\n  \t\tvar value = this.getString();\n\n  \t\tthis.rendered = true;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif ( n && n.nodeType === 3 ) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif ( n.nodeValue !== value ) {\n  \t\t\t\t\tn.nodeValue = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode( value );\n  \t\t\t\tif ( occupants[0] ) {\n  \t\t\t\t\ttarget.insertBefore( n, occupants[0] );\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild( n );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode( value );\n  \t\t\ttarget.appendChild( this.node );\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.toString = function toString ( escape ) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml( string ) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( shouldDestroy ) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf () {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  }(Mustache));\n\n  var Input = (function (Element) {\n  \tfunction Input () {\n  \t\tElement.apply(this, arguments);\n  \t}\n\n  \tInput.prototype = Object.create( Element && Element.prototype );\n  \tInput.prototype.constructor = Input;\n\n  \tInput.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  }(Element));\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function ( message ) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function ( str, options ) {\n  \tvar this$1 = this;\n\n  \tvar items, item, lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split( '\\n' );\n  \tthis.lineEnds = this.lines.map( function ( line ) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0 );\n\n  \t// Custom init logic\n  \tif ( this.init ) this.init( str, options );\n\n  \titems = [];\n\n  \twhile ( ( this$1.pos < this$1.str.length ) && ( item = this$1.read() ) ) {\n  \t\titems.push( item );\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess( items, options ) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function ( converters ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar pos, i, len, item;\n\n  \t\tif ( !converters ) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tthis$1.pos = pos; // reset for each attempt\n\n  \t\t\tif ( item = converters[i]( this$1 ) ) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetContextMessage: function ( pos, message ) {\n  \t\tvar ref = this.getLinePos( pos ), lineNum = ref[0], columnNum = ref[1];\n  \t\tif ( this.options.contextLines === -1 ) {\n  \t\t\treturn [ lineNum, columnNum, (\"\" + message + \" at line \" + lineNum + \" character \" + columnNum) ];\n  \t\t}\n\n  \t\tvar line = this.lines[ lineNum - 1 ];\n\n  \t\tvar contextUp = '';\n  \t\tvar contextDown = '';\n  \t\tif ( this.options.contextLines ) {\n  \t\t\tvar start = lineNum - 1 - this.options.contextLines < 0 ? 0 : lineNum - 1 - this.options.contextLines;\n  \t\t\tcontextUp = this.lines.slice( start, lineNum - 1 - start ).join( '\\n' ).replace( /\\t/g, '  ' );\n  \t\t\tcontextDown = this.lines.slice( lineNum, lineNum + this.options.contextLines ).join( '\\n' ).replace( /\\t/g, '  ' );\n  \t\t\tif ( contextUp ) {\n  \t\t\t\tcontextUp += '\\n';\n  \t\t\t}\n  \t\t\tif ( contextDown ) {\n  \t\t\t\tcontextDown = '\\n' + contextDown;\n  \t\t\t}\n  \t\t}\n\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = contextUp + line.replace( /\\t/g, function ( match, char ) {\n  \t\t\tif ( char < columnNum ) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array( columnNum + numTabs ).join( ' ' ) + '^----' + contextDown;\n\n  \t\treturn [ lineNum, columnNum, (\"\" + message + \" at line \" + lineNum + \" character \" + columnNum + \":\\n\" + annotation) ];\n  \t},\n\n  \tgetLinePos: function ( char ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar lineNum = 0, lineStart = 0, columnNum;\n\n  \t\twhile ( char >= this$1.lineEnds[ lineNum ] ) {\n  \t\t\tlineStart = this$1.lineEnds[ lineNum ];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [ lineNum + 1, columnNum + 1, char ]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function ( message ) {\n  \t\tvar ref = this.getContextMessage( this.pos, message ), lineNum = ref[0], columnNum = ref[1], msg = ref[2];\n\n  \t\tvar error = new ParseError( msg );\n\n  \t\terror.line = lineNum;\n  \t\terror.character = columnNum;\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function ( string ) {\n  \t\tif ( this.str.substr( this.pos, string.length ) === string ) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function ( pattern ) {\n  \t\tvar match;\n\n  \t\tif ( match = pattern.exec( this.remaining() ) ) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern( leadingWhitespace );\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring( this.pos );\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt( this.pos );\n  \t}\n  };\n\n  Parser.extend = function ( proto ) {\n  \tvar Parent = this, Child, key;\n\n  \tChild = function ( str, options ) {\n  \t\tParser.call( this, str, options );\n  \t};\n\n  \tChild.prototype = create( Parent.prototype );\n\n  \tfor ( key in proto ) {\n  \t\tif ( hasOwn.call( proto, key ) ) {\n  \t\t\tChild.prototype[ key ] = proto[ key ];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher ( okQuote ) {\n  \treturn function ( parser ) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next;\n\n  \t\twhile ( !done ) {\n  \t\t\tnext = ( parser.matchPattern( stringMiddlePattern ) || parser.matchPattern( escapeSequencePattern ) ||\n  \t\t\t\tparser.matchString( okQuote ) );\n  \t\t\tif ( next ) {\n  \t\t\t\tif ( next === (\"\\\"\") ) {\n  \t\t\t\t\tliteral += \"\\\\\\\"\";\n  \t\t\t\t} else if ( next === (\"\\\\'\") ) {\n  \t\t\t\t\tliteral += \"'\";\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern( lineContinuationPattern );\n  \t\t\t\tif ( next ) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ( '000' + next.charCodeAt(1).toString(16) ).slice( -4 );\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse( literal );\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher( (\"\\\"\") );\n  var getDoubleQuotedString = makeQuotedStringMatcher( (\"'\") );\n\n  function readStringLiteral ( parser ) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif ( parser.matchString( '\"' ) ) {\n  \t\tstring = getDoubleQuotedString( parser );\n\n  \t\tif ( !parser.matchString( '\"' ) ) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif ( parser.matchString( (\"'\") ) ) {\n  \t\tstring = getSingleQuotedString( parser );\n\n  \t\tif ( !parser.matchString( (\"'\") ) ) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n\n  function readNumberLiteral ( parser ) {\n  \tvar result;\n\n  \tif ( result = parser.matchPattern( numberPattern$1 ) ) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n  function readKey ( parser ) {\n  \tvar token;\n\n  \tif ( token = readStringLiteral( parser ) ) {\n  \t\treturn identifier.test( token.v ) ? token.v : '\"' + token.v.replace( /\"/g, '\\\\\"' ) + '\"';\n  \t}\n\n  \tif ( token = readNumberLiteral( parser ) ) {\n  \t\treturn token.v;\n  \t}\n\n  \tif ( token = parser.matchPattern( name ) ) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials$1 = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp( '^(?:' + Object.keys( specials$1 ).join( '|' ) + ')' );\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function ( str, options ) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function ( result ) {\n  \t\tif ( result.length !== 1 || !onlyWhitespace.test( this.leftover ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [\n  \t\tfunction getPlaceholder ( parser ) {\n  \t\t\tif ( !parser.values ) return null;\n\n  \t\t\tvar placeholder = parser.matchPattern( placeholderAtStartPattern );\n\n  \t\t\tif ( placeholder && ( parser.values.hasOwnProperty( placeholder ) ) ) {\n  \t\t\t\treturn { v: parser.values[ placeholder ] };\n  \t\t\t}\n  \t\t},\n\n  \t\tfunction getSpecial ( parser ) {\n  \t\t\tvar special = parser.matchPattern( specialsPattern );\n  \t\t\tif ( special ) return { v: specials$1[ special ] };\n  \t\t},\n\n  \t\tfunction getNumber ( parser ) {\n  \t\t\tvar number = parser.matchPattern( numberPattern );\n  \t\t\tif ( number ) return { v: +number };\n  \t\t},\n\n  \t\tfunction getString ( parser ) {\n  \t\t\tvar stringLiteral = readStringLiteral( parser );\n  \t\t\tvar values = parser.values;\n\n  \t\t\tif ( stringLiteral && values ) {\n  \t\t\t\treturn {\n  \t\t\t\t\tv: stringLiteral.v.replace( placeholderPattern, function ( match, $1 ) { return ( $1 in values ? values[ $1 ] : $1 ); } )\n  \t\t\t\t};\n  \t\t\t}\n\n  \t\t\treturn stringLiteral;\n  \t\t},\n\n  \t\tfunction getObject ( parser ) {\n  \t\t\tif ( !parser.matchString( '{' ) ) return null;\n\n  \t\t\tvar result = {};\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif ( parser.matchString( '}' ) ) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tvar pair;\n  \t\t\twhile ( pair = getKeyValuePair( parser ) ) {\n  \t\t\t\tresult[ pair.key ] = pair.value;\n\n  \t\t\t\tparser.allowWhitespace();\n\n  \t\t\t\tif ( parser.matchString( '}' ) ) {\n  \t\t\t\t\treturn { v: result };\n  \t\t\t\t}\n\n  \t\t\t\tif ( !parser.matchString( ',' ) ) {\n  \t\t\t\t\treturn null;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn null;\n  \t\t},\n\n  \t\tfunction getArray ( parser ) {\n  \t\t\tif ( !parser.matchString( '[' ) ) return null;\n\n  \t\t\tvar result = [];\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif ( parser.matchString( ']' ) ) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tvar valueToken;\n  \t\t\twhile ( valueToken = parser.read() ) {\n  \t\t\t\tresult.push( valueToken.v );\n\n  \t\t\t\tparser.allowWhitespace();\n\n  \t\t\t\tif ( parser.matchString( ']' ) ) {\n  \t\t\t\t\treturn { v: result };\n  \t\t\t\t}\n\n  \t\t\t\tif ( !parser.matchString( ',' ) ) {\n  \t\t\t\t\treturn null;\n  \t\t\t\t}\n\n  \t\t\t\tparser.allowWhitespace();\n  \t\t\t}\n\n  \t\t\treturn null;\n  \t\t}\n  \t]\n  });\n\n  function getKeyValuePair ( parser ) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey( parser );\n\n  \tif ( !key ) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif ( !parser.matchString( ':' ) ) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif ( !valueToken ) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON ( str, values ) {\n  \tvar parser = new JsonParser( str, { values: values });\n  \treturn parser.result;\n  }\n\n  var Mapping = (function (Item) {\n  \tfunction Mapping ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.name = options.template.n;\n\n  \t\tthis.owner = options.owner || options.parentFragment.owner || options.element || findElement( options.parentFragment );\n  \t\tthis.element = options.element || (this.owner.attributeByName ? this.owner : findElement( options.parentFragment ) );\n  \t\tthis.parentFragment = this.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.fragment = null;\n\n  \t\tthis.element.attributeByName[ this.name ] = this;\n\n  \t\tthis.value = options.template.f;\n  \t}\n\n  \tMapping.prototype = Object.create( Item && Item.prototype );\n  \tMapping.prototype.constructor = Mapping;\n\n  \tMapping.prototype.bind = function bind () {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n\n  \t\tvar template = this.template.f;\n  \t\tvar viewmodel = this.element.instance.viewmodel;\n\n  \t\tif ( template === 0 ) {\n  \t\t\t// empty attributes are `true`\n  \t\t\tviewmodel.joinKey( this.name ).set( true );\n  \t\t}\n\n  \t\telse if ( typeof template === 'string' ) {\n  \t\t\tvar parsed = parseJSON( template );\n  \t\t\tviewmodel.joinKey( this.name ).set( parsed ? parsed.value : template );\n  \t\t}\n\n  \t\telse if ( isArray( template ) ) {\n  \t\t\tcreateMapping( this, true );\n  \t\t}\n  \t};\n\n  \tMapping.prototype.render = function render () {};\n\n  \tMapping.prototype.unbind = function unbind () {\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t\tif ( this.boundFragment ) this.boundFragment.unbind();\n\n  \t\tif ( this.element.bound ) {\n  \t\t\tif ( this.link.target === this.model ) this.link.owner.unlink();\n  \t\t}\n  \t};\n\n  \tMapping.prototype.unrender = function unrender () {};\n\n  \tMapping.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t\tif ( this.boundFragment ) this.boundFragment.update();\n  \t\t\tif ( this.rendered ) this.updateDelegate();\n  \t\t}\n  \t};\n\n  \treturn Mapping;\n  }(Item));\n\n  function createMapping ( item ) {\n  \tvar template = item.template.f;\n  \tvar viewmodel = item.element.instance.viewmodel;\n  \tvar childData = viewmodel.value;\n\n  \tif ( template.length === 1 && template[0].t === INTERPOLATOR ) {\n  \t\titem.model = resolve$2( item.parentFragment, template[0] );\n\n  \t\tif ( !item.model ) {\n  \t\t\twarnOnceIfDebug( (\"The \" + (item.name) + \"='{{\" + (template[0].r) + \"}}' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: item.element.instance }); // TODO add docs page explaining item\n  \t\t\titem.parentFragment.ractive.get( item.name ); // side-effect: create mappings as necessary\n  \t\t\titem.model = item.parentFragment.findContext().joinKey( item.name );\n  \t\t}\n\n  \t\titem.link = viewmodel.createLink( item.name, item.model, template[0].r );\n\n  \t\tif ( item.model.get() === undefined && item.name in childData ) {\n  \t\t\titem.model.set( childData[ item.name ] );\n  \t\t}\n  \t}\n\n  \telse {\n  \t\titem.boundFragment = new Fragment({\n  \t\t\towner: item,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n\n  \t\titem.model = viewmodel.joinKey( item.name );\n  \t\titem.model.set( item.boundFragment.valueOf() );\n\n  \t\t// item is a *bit* of a hack\n  \t\titem.boundFragment.bubble = function () {\n  \t\t\tFragment.prototype.bubble.call( item.boundFragment );\n  \t\t\t// defer this to avoid mucking around model deps if there happens to be an expression involved\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\titem.boundFragment.update();\n  \t\t\t\titem.model.set( item.boundFragment.valueOf() );\n  \t\t\t});\n  \t\t};\n  \t}\n  }\n\n  function findParentSelect ( element ) {\n  \twhile ( element ) {\n  \t\tif ( element.name === 'select' ) return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (Element) {\n  \tfunction Option ( options ) {\n  \t\tvar template = options.template;\n  \t\tif ( !template.a ) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif ( template.a.value === undefined && !( 'disabled' in template.a ) ) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\tElement.call( this, options );\n\n  \t\tthis.select = findParentSelect( this.parent );\n  \t}\n\n  \tOption.prototype = Object.create( Element && Element.prototype );\n  \tOption.prototype.constructor = Option;\n\n  \tOption.prototype.bind = function bind () {\n  \t\tif ( !this.select ) {\n  \t\t\tElement.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif ( selectedAttribute && this.select.getAttribute( 'value' ) !== undefined ) {\n  \t\t\tvar index = this.attributes.indexOf( selectedAttribute );\n  \t\t\tthis.attributes.splice( index, 1 );\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\tElement.prototype.bind.call(this);\n  \t\tthis.select.options.push( this );\n  \t};\n\n  \tOption.prototype.bubble = function bubble () {\n  \t\t// if we're using content as value, may need to update here\n  \t\tvar value = this.getAttribute( 'value' );\n  \t\tif ( this.node && this.node.value !== value ) {\n  \t\t\tthis.node._ractive.value = value;\n  \t\t}\n  \t\tElement.prototype.bubble.call(this);\n  \t};\n\n  \tOption.prototype.getAttribute = function getAttribute ( name ) {\n  \t\tvar attribute = this.attributeByName[ name ];\n  \t\treturn attribute ? attribute.getValue() : name === 'value' && this.fragment ? this.fragment.valueOf() : undefined;\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected () {\n  \t\tvar optionValue = this.getAttribute( 'value' );\n\n  \t\tif ( optionValue === undefined || !this.select ) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute( 'value' );\n\n  \t\tif ( selectValue == optionValue ) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif ( this.select.getAttribute( 'multiple' ) && isArray( selectValue ) ) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( selectValue[i] == optionValue ) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n\n  \t\tif ( !this.attributeByName.value ) {\n  \t\t\tthis.node._ractive.value = this.getAttribute( 'value' );\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind () {\n  \t\tElement.prototype.unbind.call(this);\n\n  \t\tif ( this.select ) {\n  \t\t\tremoveFromArray( this.select.options, this );\n  \t\t}\n  \t};\n\n  \treturn Option;\n  }(Element));\n\n  function getPartialTemplate ( ractive, name, parentFragment ) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry( ractive, name, parentFragment || {} );\n  \tif ( partial ) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser.fromId( name, { noThrow: true } );\n  \tif ( partial ) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser.parseFor( partial, ractive );\n\n  \t\t// register extra partials on the ractive instance if they don't already exist\n  \t\tif ( parsed.p ) fillGaps( ractive.partials, parsed.p );\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[ name ] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry ( ractive, name, parentFragment ) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial( name, parentFragment.owner );\n  \tif ( partial ) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance( 'partials', ractive, name );\n\n  \tif ( !instance ) { return; }\n\n  \tpartial = instance.partials[ name ];\n\n  \t// partial is a function?\n  \tvar fn;\n  \tif ( typeof partial === 'function' ) {\n  \t\tfn = partial.bind( instance );\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call( ractive, parser );\n  \t}\n\n  \tif ( !partial && partial !== '' ) {\n  \t\twarnIfDebug( noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif ( !parser.isParsed( partial ) ) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser.parseFor( partial, instance );\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif ( parsed.p ) {\n  \t\t\twarnIfDebug( 'Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner( instance, name );\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[ name ] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif ( fn ) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner ( ractive, key ) {\n  \treturn ractive.partials.hasOwnProperty( key )\n  \t\t? ractive\n  \t\t: findConstructor( ractive.constructor, key);\n  }\n\n  function findConstructor ( constructor, key ) {\n  \tif ( !constructor ) { return; }\n  \treturn constructor.partials.hasOwnProperty( key )\n  \t\t? constructor\n  \t\t: findConstructor( constructor._Parent, key );\n  }\n\n  function findParentPartial( name, parent ) {\n  \tif ( parent ) {\n  \t\tif ( parent.template && parent.template.p && parent.template.p[name] ) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if ( parent.parentFragment && parent.parentFragment.owner ) {\n  \t\t\treturn findParentPartial( name, parent.parentFragment.owner );\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (MustacheContainer) {\n  \tfunction Partial ( options ) {\n  \t\tMustacheContainer.call( this, options );\n\n  \t\tthis.yielder = options.template.t === YIELDER;\n\n  \t\tif ( this.yielder ) {\n  \t\t\tthis.container = options.parentFragment.ractive;\n  \t\t\tthis.component = this.container.component;\n\n  \t\t\tthis.containerFragment = options.parentFragment;\n  \t\t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t\t// {{yield}} is equivalent to {{yield content}}\n  \t\t\tif ( !options.template.r && !options.template.rx && !options.template.x ) options.template.r = 'content';\n  \t\t}\n  \t}\n\n  \tPartial.prototype = Object.create( MustacheContainer && MustacheContainer.prototype );\n  \tPartial.prototype.constructor = Partial;\n\n  \tPartial.prototype.bind = function bind () {\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate( this.ractive, this.refName, this.parentFragment ) || null : null;\n  \t\tvar templateObj;\n\n  \t\tif ( template ) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate( this.template.r, template );\n  \t\t}\n\n  \t\tif ( !template ) {\n  \t\t\tMustacheContainer.prototype.bind.call(this);\n  \t\t\tif ( this.model && ( templateObj = this.model.get() ) && typeof templateObj === 'object' && ( typeof templateObj.template === 'string' || isArray( templateObj.t ) ) ) {\n  \t\t\t\tif ( templateObj.template ) {\n  \t\t\t\t\tthis.source = templateObj.template;\n  \t\t\t\t\ttemplateObj = parsePartial( this.template.r, templateObj.template, this.ractive );\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.source = templateObj.t;\n  \t\t\t\t}\n  \t\t\t\tthis.setTemplate( this.template.r, templateObj.t );\n  \t\t\t} else if ( ( !this.model || typeof this.model.get() !== 'string' ) && this.refName ) {\n  \t\t\t\tthis.setTemplate( this.refName, template );\n  \t\t\t} else {\n  \t\t\t\tthis.setTemplate( this.model.get() );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar options = {\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t};\n\n  \t\tif ( this.template.c ) {\n  \t\t\toptions.template = [{ t: SECTION, n: SECTION_WITH, f: options.template }]\n  \t\t\tfor ( var k in this.template.c ) {\n  \t\t\t\toptions.template[0][k] = this.template.c[k];\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( this.yielder ) {\n  \t\t\toptions.ractive = this.container.parent;\n  \t\t}\n\n  \t\tthis.fragment = new Fragment(options);\n  \t\tif ( this.template.z ) {\n  \t\t\tthis.fragment.aliases = resolveAliases( this.template.z, this.yielder ? this.containerFragment : this.parentFragment );\n  \t\t}\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tPartial.prototype.bubble = function bubble () {\n  \t\tif ( this.yielder && !this.dirty ) {\n  \t\t\tthis.containerFragment.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t} else {\n  \t\t\tMustacheContainer.prototype.bubble.call(this);\n  \t\t}\n  \t};\n\n  \tPartial.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.yielder ? this.containerFragment.findNextNode( this ) : MustacheContainer.prototype.findNextNode.call(this);\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif ( this.refName ) {\n  \t\t\tthis.partialTemplate = getPartialTemplate( this.ractive, this.refName, this.parentFragment );\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif ( !this.partialTemplate ) {\n  \t\t\tthis.partialTemplate = getPartialTemplate( this.ractive, this.name, this.parentFragment );\n  \t\t}\n\n  \t\tif ( !this.partialTemplate ) {\n  \t\t\twarnOnceIfDebug( (\"Could not find template for partial '\" + (this.name) + \"'\") );\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tif ( this.inAttribute ) {\n  \t\t\tdoInAttributes( function () { return this$1.fragment.resetTemplate( this$1.partialTemplate ); } );\n  \t\t} else {\n  \t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t}\n\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebinding = function rebinding () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( this.locked || !this.template.z ) return;\n  \t\tthis.locked = true;\n  \t\trunloop.scheduleTask( function () {\n  \t\t\tthis$1.locked = false;\n  \t\t\tthis$1.fragment.aliases = resolveAliases( this$1.template.z, this$1.containerFragment );\n  \t\t});\n  \t};\n\n  \tPartial.prototype.render = function render ( target, occupants ) {\n  \t\treturn this.fragment.render( target, occupants );\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate ( name, template ) {\n  \t\tthis.name = name;\n\n  \t\tif ( !template && template !== null ) template = getPartialTemplate( this.ractive, name, this.parentFragment );\n\n  \t\tif ( !template ) {\n  \t\t\twarnOnceIfDebug( (\"Could not find template for partial '\" + name + \"'\") );\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.unbind = function unbind () {\n  \t\tMustacheContainer.prototype.unbind.call(this);\n  \t\tthis.fragment.aliases = {};\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.fragment.unrender( shouldDestroy );\n  \t};\n\n  \tPartial.prototype.update = function update () {\n  \t\tvar template;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tif ( !this.named ) {\n  \t\t\t\tif ( this.model ) {\n  \t\t\t\t\ttemplate = this.model.get();\n  \t\t\t\t}\n\n  \t\t\t\tif ( template && typeof template === 'string' && template !== this.name ) {\n  \t\t\t\t\tthis.setTemplate( template );\n  \t\t\t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t\t\t} else if ( template && typeof template === 'object' && ( typeof template.template === 'string' || isArray( template.t ) ) ) {\n  \t\t\t\t\tif ( template.t !== this.source && template.template !== this.source ) {\n  \t\t\t\t\t\tif ( template.template ) {\n  \t\t\t\t\t\t\tthis.source = template.template;\n  \t\t\t\t\t\t\ttemplate = parsePartial( this.name, template.template, this.ractive );\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tthis.source = template.t;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t\tthis.setTemplate( this.name, template.t );\n  \t\t\t\t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  }(MustacheContainer));\n\n  function parsePartial( name, partial, ractive ) {\n  \tvar parsed;\n\n  \ttry {\n  \t\tparsed = parser.parse( partial, parser.getParseOptions( ractive ) );\n  \t} catch (e) {\n  \t\twarnIfDebug( (\"Could not parse partial from expression '\" + name + \"'\\n\" + (e.message)) );\n  \t}\n\n  \treturn parsed || { t: [] };\n  }\n\n  var RepeatedFragment = function RepeatedFragment ( options ) {\n  \tthis.parent = options.owner.parentFragment;\n\n  \t// bit of a hack, so reference resolution works without another\n  \t// layer of indirection\n  \tthis.parentFragment = this;\n  \tthis.owner = options.owner;\n  \tthis.ractive = this.parent.ractive;\n\n  \t// encapsulated styles should be inherited until they get applied by an element\n  \tthis.cssIds = 'cssIds' in options ? options.cssIds : ( this.parent ? this.parent.cssIds : null );\n\n  \tthis.context = null;\n  \tthis.rendered = false;\n  \tthis.iterations = [];\n\n  \tthis.template = options.template;\n\n  \tthis.indexRef = options.indexRef;\n  \tthis.keyRef = options.keyRef;\n\n  \tthis.pendingNewIndices = null;\n  \tthis.previousIterations = null;\n\n  \t// track array versus object so updates of type rest\n  \tthis.isArray = false;\n  };\n\n  RepeatedFragment.prototype.bind = function bind ( context ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = context;\n  \tvar value = context.get();\n\n  \t// {{#each array}}...\n  \tif ( this.isArray = isArray( value ) ) {\n  \t\t// we can't use map, because of sparse arrays\n  \t\tthis.iterations = [];\n  \t\tvar max = value.length;\n  \t\tfor ( var i = 0; i < max; i += 1 ) {\n  \t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t}\n  \t}\n\n  \t// {{#each object}}...\n  \telse if ( isObject( value ) ) {\n  \t\tthis.isArray = false;\n\n  \t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\tif ( this.indexRef ) {\n  \t\t\tvar refs = this.indexRef.split( ',' );\n  \t\t\tthis.keyRef = refs[0];\n  \t\t\tthis.indexRef = refs[1];\n  \t\t}\n\n  \t\tthis.iterations = Object.keys( value ).map( function ( key, index ) {\n  \t\t\treturn this$1.createIteration( key, index );\n  \t\t});\n  \t}\n\n  \treturn this;\n  };\n\n  RepeatedFragment.prototype.bubble = function bubble () {\n  \tthis.owner.bubble();\n  };\n\n  RepeatedFragment.prototype.createIteration = function createIteration ( key, index ) {\n  \tvar fragment = new Fragment({\n  \t\towner: this,\n  \t\ttemplate: this.template\n  \t});\n\n  \t// TODO this is a bit hacky\n  \tfragment.key = key;\n  \tfragment.index = index;\n  \tfragment.isIteration = true;\n\n  \tvar model = this.context.joinKey( key );\n\n  \t// set up an iteration alias if there is one\n  \tif ( this.owner.template.z ) {\n  \t\tfragment.aliases = {};\n  \t\tfragment.aliases[ this.owner.template.z[0].n ] = model;\n  \t}\n\n  \treturn fragment.bind( model );\n  };\n\n  RepeatedFragment.prototype.destroyed = function destroyed () {\n  \tthis.iterations.forEach( function ( i ) { return i.destroyed(); } );\n  };\n\n  RepeatedFragment.prototype.detach = function detach () {\n  \tvar docFrag = createDocumentFragment();\n  \tthis.iterations.forEach( function ( fragment ) { return docFrag.appendChild( fragment.detach() ); } );\n  \treturn docFrag;\n  };\n\n  RepeatedFragment.prototype.find = function find ( selector, options ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.iterations[i].find( selector, options );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  RepeatedFragment.prototype.findAll = function findAll ( selector, query ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tthis$1.iterations[i].findAll( selector, query );\n  \t}\n  };\n\n  RepeatedFragment.prototype.findComponent = function findComponent ( name, options ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.iterations[i].findComponent( name, options );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  RepeatedFragment.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tthis$1.iterations[i].findAllComponents( name, query );\n  \t}\n  };\n\n  RepeatedFragment.prototype.findNextNode = function findNextNode ( iteration ) {\n  \tvar this$1 = this;\n\n  \t\tif ( iteration.index < this.iterations.length - 1 ) {\n  \t\tfor ( var i = iteration.index + 1; i < this$1.iterations.length; i++ ) {\n  \t\t\tvar node = this$1.iterations[ i ].firstNode( true );\n  \t\t\tif ( node ) return node;\n  \t\t}\n  \t}\n\n  \treturn this.owner.findNextNode();\n  };\n\n  RepeatedFragment.prototype.firstNode = function firstNode ( skipParent ) {\n  \treturn this.iterations[0] ? this.iterations[0].firstNode( skipParent ) : null;\n  };\n\n  RepeatedFragment.prototype.rebinding = function rebinding ( next ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = next;\n  \tthis.iterations.forEach( function ( fragment ) {\n  \t\tvar model = next ? next.joinKey( fragment.key || fragment.index ) : undefined;\n  \t\tfragment.context = model;\n  \t\tif ( this$1.owner.template.z ) {\n  \t\t\tfragment.aliases = {};\n  \t\t\tfragment.aliases[ this$1.owner.template.z[0].n ] = model;\n  \t\t}\n  \t});\n  };\n\n  RepeatedFragment.prototype.render = function render ( target, occupants ) {\n  \t// TODO use docFrag.cloneNode...\n\n  \tif ( this.iterations ) {\n  \t\tthis.iterations.forEach( function ( fragment ) { return fragment.render( target, occupants ); } );\n  \t}\n\n  \tthis.rendered = true;\n  };\n\n  RepeatedFragment.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.pendingNewIndices ) this.previousIterations = this.iterations.slice();\n\n  \tif ( !this.pendingNewIndices ) this.pendingNewIndices = [];\n\n  \tthis.pendingNewIndices.push( newIndices );\n\n  \tvar iterations = [];\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tif ( newIndex === -1 ) return;\n\n  \t\tvar fragment = this$1.iterations[ oldIndex ];\n  \t\titerations[ newIndex ] = fragment;\n\n  \t\tif ( newIndex !== oldIndex && fragment ) fragment.dirty = true;\n  \t});\n\n  \tthis.iterations = iterations;\n\n  \tthis.bubble();\n  };\n\n  RepeatedFragment.prototype.shuffled = function shuffled () {\n  \tthis.iterations.forEach( function ( i ) { return i.shuffled(); } );\n  };\n\n  RepeatedFragment.prototype.toString = function toString$1$$ ( escape ) {\n  \treturn this.iterations ?\n  \t\tthis.iterations.map( escape ? toEscapedString : toString$1 ).join( '' ) :\n  \t\t'';\n  };\n\n  RepeatedFragment.prototype.unbind = function unbind$1 () {\n  \tthis.iterations.forEach( unbind );\n  \treturn this;\n  };\n\n  RepeatedFragment.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \tthis.iterations.forEach( shouldDestroy ? unrenderAndDestroy : unrender );\n  \tif ( this.pendingNewIndices && this.previousIterations ) {\n  \t\tthis.previousIterations.forEach( function ( fragment ) {\n  \t\t\tif ( fragment.rendered ) shouldDestroy ? unrenderAndDestroy( fragment ) : unrender( fragment );\n  \t\t});\n  \t}\n  \tthis.rendered = false;\n  };\n\n  // TODO smart update\n  RepeatedFragment.prototype.update = function update$1 () {\n  \t// skip dirty check, since this is basically just a facade\n\n  \tvar this$1 = this;\n\n  \t\tif ( this.pendingNewIndices ) {\n  \t\tthis.updatePostShuffle();\n  \t\treturn;\n  \t}\n\n  \tif ( this.updating ) return;\n  \tthis.updating = true;\n\n  \tvar value = this.context.get(),\n  \t\t\t  wasArray = this.isArray;\n\n  \tvar toRemove;\n  \tvar oldKeys;\n  \tvar reset = true;\n  \tvar i;\n\n  \tif ( this.isArray = isArray( value ) ) {\n  \t\tif ( wasArray ) {\n  \t\t\treset = false;\n  \t\t\tif ( this.iterations.length > value.length ) {\n  \t\t\t\ttoRemove = this.iterations.splice( value.length );\n  \t\t\t}\n  \t\t}\n  \t} else if ( isObject( value ) && !wasArray ) {\n  \t\treset = false;\n  \t\ttoRemove = [];\n  \t\toldKeys = {};\n  \t\ti = this.iterations.length;\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar fragment$1 = this$1.iterations[i];\n  \t\t\tif ( fragment$1.key in value ) {\n  \t\t\t\toldKeys[ fragment$1.key ] = true;\n  \t\t\t} else {\n  \t\t\t\tthis$1.iterations.splice( i, 1 );\n  \t\t\t\ttoRemove.push( fragment$1 );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( reset ) {\n  \t\ttoRemove = this.iterations;\n  \t\tthis.iterations = [];\n  \t}\n\n  \tif ( toRemove ) {\n  \t\ttoRemove.forEach( function ( fragment ) {\n  \t\t\tfragment.unbind();\n  \t\t\tfragment.unrender( true );\n  \t\t});\n  \t}\n\n  \t// update the remaining ones\n  \tthis.iterations.forEach( update );\n\n  \t// add new iterations\n  \tvar newLength = isArray( value ) ?\n  \t\tvalue.length :\n  \t\tisObject( value ) ?\n  \t\t\tObject.keys( value ).length :\n  \t\t\t0;\n\n  \tvar docFrag;\n  \tvar fragment;\n\n  \tif ( newLength > this.iterations.length ) {\n  \t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\ti = this.iterations.length;\n\n  \t\tif ( isArray( value ) ) {\n  \t\t\twhile ( i < value.length ) {\n  \t\t\t\tfragment = this$1.createIteration( i, i );\n\n  \t\t\t\tthis$1.iterations.push( fragment );\n  \t\t\t\tif ( this$1.rendered ) fragment.render( docFrag );\n\n  \t\t\t\ti += 1;\n  \t\t\t}\n  \t\t}\n\n  \t\telse if ( isObject( value ) ) {\n  \t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\tif ( this.indexRef && !this.keyRef ) {\n  \t\t\t\tvar refs = this.indexRef.split( ',' );\n  \t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\tthis.indexRef = refs[1];\n  \t\t\t}\n\n  \t\t\tObject.keys( value ).forEach( function ( key ) {\n  \t\t\t\tif ( !oldKeys || !( key in oldKeys ) ) {\n  \t\t\t\t\tfragment = this$1.createIteration( key, i );\n\n  \t\t\t\t\tthis$1.iterations.push( fragment );\n  \t\t\t\t\tif ( this$1.rendered ) fragment.render( docFrag );\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tif ( this.rendered ) {\n  \t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\tvar anchor = this.parent.findNextNode( this.owner );\n\n  \t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t}\n  \t}\n\n  \tthis.updating = false;\n  };\n\n  RepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle () {\n  \tvar this$1 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices[ 0 ];\n\n  \t// map first shuffle through\n  \tthis.pendingNewIndices.slice( 1 ).forEach( function ( indices ) {\n  \t\tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\t\tnewIndices[ oldIndex ] = indices[ newIndex ];\n  \t\t});\n  \t});\n\n  \t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t// but it seems to work for now\n  \tvar len = this.context.get().length, oldLen = this.previousIterations.length;\n  \tvar i;\n  \tvar removed = {};\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tvar fragment = this$1.previousIterations[ oldIndex ];\n  \t\tthis$1.previousIterations[ oldIndex ] = null;\n\n  \t\tif ( newIndex === -1 ) {\n  \t\t\tremoved[ oldIndex ] = fragment;\n  \t\t} else if ( fragment.index !== newIndex ) {\n  \t\t\tvar model = this$1.context.joinKey( newIndex );\n  \t\t\tfragment.index = newIndex;\n  \t\t\tfragment.context = model;\n  \t\t\tif ( this$1.owner.template.z ) {\n  \t\t\t\tfragment.aliases = {};\n  \t\t\t\tfragment.aliases[ this$1.owner.template.z[0].n ] = model;\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \t// if the array was spliced outside of ractive, sometimes there are leftover fragments not in the newIndices\n  \tthis.previousIterations.forEach( function ( frag, i ) {\n  \t\tif ( frag ) removed[ i ] = frag;\n  \t});\n\n  \t// create new/move existing iterations\n  \tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \tvar contiguous = 'startIndex' in newIndices;\n  \ti = contiguous ? newIndices.startIndex : 0;\n\n  \tfor ( i; i < len; i++ ) {\n  \t\tvar frag = this$1.iterations[i];\n\n  \t\tif ( frag && contiguous ) {\n  \t\t\t// attach any built-up iterations\n  \t\t\tif ( this$1.rendered ) {\n  \t\t\t\tif ( removed[i] ) docFrag.appendChild( removed[i].detach() );\n  \t\t\t\tif ( docFrag.childNodes.length  ) parentNode.insertBefore( docFrag, frag.firstNode() );\n  \t\t\t}\n  \t\t\tcontinue;\n  \t\t}\n\n  \t\tif ( !frag ) this$1.iterations[i] = this$1.createIteration( i, i );\n\n  \t\tif ( this$1.rendered ) {\n  \t\t\tif ( removed[i] ) docFrag.appendChild( removed[i].detach() );\n\n  \t\t\tif ( frag ) docFrag.appendChild( frag.detach() );\n  \t\t\telse {\n  \t\t\t\tthis$1.iterations[i].render( docFrag );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// append any leftovers\n  \tif ( this.rendered ) {\n  \t\tfor ( i = len; i < oldLen; i++ ) {\n  \t\t\tif ( removed[i] ) docFrag.appendChild( removed[i].detach() );\n  \t\t}\n\n  \t\tif ( docFrag.childNodes.length ) {\n  \t\t\tparentNode.insertBefore( docFrag, this.owner.findNextNode() );\n  \t\t}\n  \t}\n\n  \t// trigger removal on old nodes\n  \tObject.keys( removed ).forEach( function ( k ) { return removed[k].unbind().unrender( true ); } );\n\n  \tthis.iterations.forEach( update );\n\n  \tthis.pendingNewIndices = null;\n\n  \tthis.shuffled();\n  };\n\n  function isEmpty ( value ) {\n  \treturn !value ||\n  \t       ( isArray( value ) && value.length === 0 ) ||\n  \t\t   ( isObject( value ) && Object.keys( value ).length === 0 );\n  }\n\n  function getType ( value, hasIndexRef ) {\n  \tif ( hasIndexRef || isArray( value ) ) return SECTION_EACH;\n  \tif ( isObject( value ) || typeof value === 'function' ) return SECTION_IF_WITH;\n  \tif ( value === undefined ) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (MustacheContainer) {\n  \tfunction Section ( options ) {\n  \t\tMustacheContainer.call( this, options );\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.templateSectionType = this.sectionType;\n  \t\tthis.subordinate = options.template.l === 1;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype = Object.create( MustacheContainer && MustacheContainer.prototype );\n  \tSection.prototype.constructor = Section;\n\n  \tSection.prototype.bind = function bind () {\n  \t\tMustacheContainer.prototype.bind.call(this);\n\n  \t\tif ( this.subordinate ) {\n  \t\t\tthis.sibling = this.parentFragment.items[ this.parentFragment.items.indexOf( this ) - 1 ];\n  \t\t\tthis.sibling.nextSibling = this;\n  \t\t}\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif ( this.model ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.update();\n  \t\t} else if ( this.sectionType && this.sectionType === SECTION_UNLESS && ( !this.sibling || !this.sibling.isTruthy() ) ) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.isTruthy = function isTruthy () {\n  \t\tif ( this.subordinate && this.sibling.isTruthy() ) return true;\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\treturn !!value && ( this.templateSectionType === SECTION_IF_WITH || !isEmpty( value ) );\n  \t};\n\n  \tSection.prototype.rebinding = function rebinding ( next, previous, safe ) {\n  \t\tif ( MustacheContainer.prototype.rebinding.call( this, next, previous, safe ) ) {\n  \t\t\tif ( this.fragment && this.sectionType !== SECTION_IF && this.sectionType !== SECTION_UNLESS ) {\n  \t\t\t\tthis.fragment.rebinding( next, previous );\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render ( target, occupants ) {\n  \t\tthis.rendered = true;\n  \t\tif ( this.fragment ) this.fragment.render( target, occupants );\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle ( newIndices ) {\n  \t\tif ( this.fragment && this.sectionType === SECTION_EACH ) {\n  \t\t\tthis.fragment.shuffle( newIndices );\n  \t\t}\n  \t};\n\n  \tSection.prototype.unbind = function unbind () {\n  \t\tMustacheContainer.prototype.unbind.call(this);\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && this.fragment ) this.fragment.unrender( shouldDestroy );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tSection.prototype.update = function update () {\n  \t\tif ( !this.dirty ) return;\n\n  \t\tif ( this.fragment && this.sectionType !== SECTION_IF && this.sectionType !== SECTION_UNLESS ) {\n  \t\t\tthis.fragment.context = this.model;\n  \t\t}\n\n  \t\tif ( !this.model && this.sectionType !== SECTION_UNLESS ) return;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\tvar siblingFalsey = !this.subordinate || !this.sibling.isTruthy();\n  \t\tvar lastType = this.sectionType;\n\n  \t\t// watch for switching section types\n  \t\tif ( this.sectionType === null || this.templateSectionType === null ) this.sectionType = getType( value, this.template.i );\n  \t\tif ( lastType && lastType !== this.sectionType && this.fragment ) {\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tvar newFragment;\n\n  \t\tvar fragmentShouldExist = this.sectionType === SECTION_EACH || // each always gets a fragment, which may have no iterations\n  \t\t                            this.sectionType === SECTION_WITH || // with (partial context) always gets a fragment\n  \t\t                            ( siblingFalsey && ( this.sectionType === SECTION_UNLESS ? !this.isTruthy() : this.isTruthy() ) ); // if, unless, and if-with depend on siblings and the condition\n\n  \t\tif ( fragmentShouldExist ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\tif ( this.sectionType === SECTION_EACH ) {\n  \t\t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t\t}).bind( this.model );\n  \t\t\t\t} else {\n  \t \t\t\t\t// only with and if-with provide context - if and unless do not\n  \t\t\t\t\tvar context = this.sectionType !== SECTION_IF && this.sectionType !== SECTION_UNLESS ? this.model : null;\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind( context );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else {\n  \t\t\tif ( this.fragment && this.rendered ) {\n  \t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tif ( newFragment ) {\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode( this );\n\n  \t\t\t\tif ( anchor ) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render( docFrag );\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore( docFrag, anchor );\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render( parentNode );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tif ( this.nextSibling ) {\n  \t\t\tthis.nextSibling.dirty = true;\n  \t\t\tthis.nextSibling.update();\n  \t\t}\n  \t};\n\n  \treturn Section;\n  }(MustacheContainer));\n\n  function valueContains ( selectValue, optionValue ) {\n  \tvar i = selectValue.length;\n  \twhile ( i-- ) {\n  \t\tif ( selectValue[i] == optionValue ) return true;\n  \t}\n  }\n\n  var Select = (function (Element) {\n  \tfunction Select ( options ) {\n  \t\tElement.call( this, options );\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype = Object.create( Element && Element.prototype );\n  \tSelect.prototype.constructor = Select;\n\n  \tSelect.prototype.foundNode = function foundNode ( node ) {\n  \t\tif ( this.binding ) {\n  \t\t\tvar selectedOptions = getSelectedOptions( node );\n\n  \t\t\tif ( selectedOptions.length > 0 ) {\n  \t\t\t\tthis.selectedOptions = selectedOptions;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile ( i-- ) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync () {\n  \t\tvar this$1 = this;\n\n  \t\tvar selectNode = this.node;\n\n  \t\tif ( !selectNode ) return;\n\n  \t\tvar options = toArray( selectNode.options );\n\n  \t\tif ( this.selectedOptions ) {\n  \t\t\toptions.forEach( function ( o ) {\n  \t\t\t\tif ( this$1.selectedOptions.indexOf( o ) >= 0 ) o.selected = true;\n  \t\t\t\telse o.selected = false;\n  \t\t\t});\n  \t\t\tthis.binding.setFromNode( selectNode );\n  \t\t\tdelete this.selectedOptions;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar selectValue = this.getAttribute( 'value' );\n  \t\tvar isMultiple = this.getAttribute( 'multiple' );\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif ( selectValue !== undefined ) {\n  \t\t\tvar optionWasSelected;\n\n  \t\t\toptions.forEach( function ( o ) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains( selectValue, optionValue ) : selectValue == optionValue;\n\n  \t\t\t\tif ( shouldSelect ) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif ( !optionWasSelected && !isMultiple ) {\n  \t\t\t\tif ( this.binding ) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if ( this.binding ) {\n  \t\t\tthis.binding.forceUpdate();\n  \t\t}\n  \t};\n\n  \tSelect.prototype.update = function update () {\n  \t\tElement.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  }(Element));\n\n  var Textarea = (function (Input) {\n  \tfunction Textarea( options ) {\n  \t\tvar template = options.template;\n\n  \t\toptions.deferContent = true;\n\n  \t\tInput.call( this, options );\n\n  \t\t// check for single interpolator binding\n  \t\tif ( !this.attributeByName.value ) {\n  \t\t\tif ( template.f && isBindable( { template: template } ) ) {\n  \t\t\t\tthis.attributes.push( createItem( {\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: { t: ATTRIBUTE, f: template.f, n: 'value' },\n  \t\t\t\t\tparentFragment: this.parentFragment\n  \t\t\t\t} ) );\n  \t\t\t} else {\n  \t\t\t\tthis.fragment = new Fragment({ owner: this, cssIds: null, template: template.f });\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tTextarea.prototype = Object.create( Input && Input.prototype );\n  \tTextarea.prototype.constructor = Textarea;\n\n  \tTextarea.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif ( this.rendered && !this.binding && this.fragment ) {\n  \t\t\t\trunloop.scheduleTask( function () {\n  \t\t\t\t\tthis$1.dirty = false;\n  \t\t\t\t\tthis$1.node.value = this$1.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  }(Input));\n\n  var Text = (function (Item) {\n  \tfunction Text ( options ) {\n  \t\tItem.call( this, options );\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype = Object.create( Item && Item.prototype );\n  \tText.prototype.constructor = Text;\n\n  \tText.prototype.bind = function bind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach () {\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tText.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.render = function render ( target, occupants ) {\n  \t\tif ( inAttributes() ) return;\n  \t\tthis.rendered = true;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif ( n && n.nodeType === 3 ) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif ( n.nodeValue !== this.template ) {\n  \t\t\t\t\tn.nodeValue = this.template;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode( this.template );\n  \t\t\t\tif ( occupants[0] ) {\n  \t\t\t\t\ttarget.insertBefore( n, occupants[0] );\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild( n );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode( this.template );\n  \t\t\ttarget.appendChild( this.node );\n  \t\t}\n  \t};\n\n  \tText.prototype.toString = function toString ( escape ) {\n  \t\treturn escape ? escapeHtml( this.template ) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && shouldDestroy ) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf () {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  }(Item));\n\n  var prefix;\n\n  if ( !isClient ) {\n  \tprefix = null;\n  } else {\n  \tvar prefixCache = {};\n  \tvar testStyle = createElement( 'div' ).style;\n\n  \tprefix = function ( prop ) {\n  \t\tprop = camelCase( prop );\n\n  \t\tif ( !prefixCache[ prop ] ) {\n  \t\t\tif ( testStyle[ prop ] !== undefined ) {\n  \t\t\t\tprefixCache[ prop ] = prop;\n  \t\t\t}\n\n  \t\t\telse {\n  \t\t\t\t// test vendors...\n  \t\t\t\tvar capped = prop.charAt( 0 ).toUpperCase() + prop.substring( 1 );\n\n  \t\t\t\tvar i = vendors.length;\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\tif ( testStyle[ vendor + capped ] !== undefined ) {\n  \t\t\t\t\t\tprefixCache[ prop ] = vendor + capped;\n  \t\t\t\t\t\tbreak;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn prefixCache[ prop ];\n  \t};\n  }\n\n  var prefix$1 = prefix;\n\n  var visible;\n  var hidden = 'hidden';\n\n  if ( doc ) {\n  \tvar prefix$2;\n\n  \tif ( hidden in doc ) {\n  \t\tprefix$2 = '';\n  \t} else {\n  \t\tvar i$1 = vendors.length;\n  \t\twhile ( i$1-- ) {\n  \t\t\tvar vendor = vendors[i$1];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif ( hidden in doc ) {\n  \t\t\t\tprefix$2 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( prefix$2 !== undefined ) {\n  \t\tdoc.addEventListener( prefix$2 + 'visibilitychange', onChange );\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ( 'onfocusout' in doc ) {\n  \t\t\tdoc.addEventListener( 'focusout', onHide );\n  \t\t\tdoc.addEventListener( 'focusin', onShow );\n  \t\t}\n\n  \t\telse {\n  \t\t\twin.addEventListener( 'pagehide', onHide );\n  \t\t\twin.addEventListener( 'blur', onHide );\n\n  \t\t\twin.addEventListener( 'pageshow', onShow );\n  \t\t\twin.addEventListener( 'focus', onShow );\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange () {\n  \tvisible = !doc[ hidden ];\n  }\n\n  function onHide () {\n  \tvisible = false;\n  }\n\n  function onShow () {\n  \tvisible = true;\n  }\n\n  var unprefixPattern = new RegExp( '^-(?:' + vendors.join( '|' ) + ')-' );\n\n  function unprefix ( prop ) {\n  \treturn prop.replace( unprefixPattern, '' );\n  }\n\n  var vendorPattern = new RegExp( '^(?:' + vendors.join( '|' ) + ')([A-Z])' );\n\n  function hyphenate ( str ) {\n  \tif ( !str ) return ''; // edge case\n\n  \tif ( vendorPattern.test( str ) ) str = '-' + str;\n\n  \treturn str.replace( /[A-Z]/g, function ( match ) { return '-' + match.toLowerCase(); } );\n  }\n\n  var createTransitions;\n\n  if ( !isClient ) {\n  \tcreateTransitions = null;\n  } else {\n  \tvar testStyle$1 = createElement( 'div' ).style;\n  \tvar linear$1 = function ( x ) { return x; };\n\n  \tvar canUseCssTransitions = {};\n  \tvar cannotUseCssTransitions = {};\n\n  \t// determine some facts about our environment\n  \tvar TRANSITION$1;\n  \tvar TRANSITIONEND;\n  \tvar CSS_TRANSITIONS_ENABLED;\n  \tvar TRANSITION_DURATION;\n  \tvar TRANSITION_PROPERTY;\n  \tvar TRANSITION_TIMING_FUNCTION;\n\n  \tif ( testStyle$1.transition !== undefined ) {\n  \t\tTRANSITION$1 = 'transition';\n  \t\tTRANSITIONEND = 'transitionend';\n  \t\tCSS_TRANSITIONS_ENABLED = true;\n  \t} else if ( testStyle$1.webkitTransition !== undefined ) {\n  \t\tTRANSITION$1 = 'webkitTransition';\n  \t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\tCSS_TRANSITIONS_ENABLED = true;\n  \t} else {\n  \t\tCSS_TRANSITIONS_ENABLED = false;\n  \t}\n\n  \tif ( TRANSITION$1 ) {\n  \t\tTRANSITION_DURATION = TRANSITION$1 + 'Duration';\n  \t\tTRANSITION_PROPERTY = TRANSITION$1 + 'Property';\n  \t\tTRANSITION_TIMING_FUNCTION = TRANSITION$1 + 'TimingFunction';\n  \t}\n\n  \tcreateTransitions = function ( t, to, options, changedProperties, resolve ) {\n\n  \t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t// TODO use a fastdom-style mechanism?\n  \t\tsetTimeout( function () {\n  \t\t\tvar jsTransitionsComplete;\n  \t\t\tvar cssTransitionsComplete;\n  \t\t\tvar cssTimeout;\n\n  \t\t\tfunction transitionDone () { clearTimeout( cssTimeout ); }\n\n  \t\t\tfunction checkComplete () {\n  \t\t\t\tif ( jsTransitionsComplete && cssTransitionsComplete ) {\n  \t\t\t\t\tt.unregisterCompleteHandler( transitionDone );\n  \t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\tt.ractive.fire( t.name + ':end', t.node, t.isIntro );\n  \t\t\t\t\tresolve();\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t// which properties\n  \t\t\tvar hashPrefix = ( t.node.namespaceURI || '' ) + t.node.tagName;\n\n  \t\t\t// need to reset transition properties\n  \t\t\tvar style = t.node.style;\n  \t\t\tvar previous = {\n  \t\t\t\tproperty: style[ TRANSITION_PROPERTY ],\n  \t\t\t\ttiming: style[ TRANSITION_TIMING_FUNCTION ],\n  \t\t\t\tduration: style[ TRANSITION_DURATION ]\n  \t\t\t};\n\n  \t\t\tstyle[ TRANSITION_PROPERTY ] = changedProperties.map( prefix$1 ).map( hyphenate ).join( ',' );\n  \t\t\tstyle[ TRANSITION_TIMING_FUNCTION ] = hyphenate( options.easing || 'linear' );\n  \t\t\tstyle[ TRANSITION_DURATION ] = ( options.duration / 1000 ) + 's';\n\n  \t\t\tfunction transitionEndHandler ( event ) {\n  \t\t\t\tvar index = changedProperties.indexOf( camelCase( unprefix( event.propertyName ) ) );\n\n  \t\t\t\tif ( index !== -1 ) {\n  \t\t\t\t\tchangedProperties.splice( index, 1 );\n  \t\t\t\t}\n\n  \t\t\t\tif ( changedProperties.length ) {\n  \t\t\t\t\t// still transitioning...\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tclearTimeout( cssTimeout );\n  \t\t\t\tcssTransitionsDone();\n  \t\t\t}\n\n  \t\t\tfunction cssTransitionsDone () {\n  \t\t\t\tstyle[ TRANSITION_PROPERTY ] = previous.property;\n  \t\t\t\tstyle[ TRANSITION_TIMING_FUNCTION ] = previous.duration;\n  \t\t\t\tstyle[ TRANSITION_DURATION ] = previous.timing;\n\n  \t\t\t\tt.node.removeEventListener( TRANSITIONEND, transitionEndHandler, false );\n\n  \t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\tcheckComplete();\n  \t\t\t}\n\n  \t\t\tt.node.addEventListener( TRANSITIONEND, transitionEndHandler, false );\n\n  \t\t\t// safety net in case transitionend never fires\n  \t\t\tcssTimeout = setTimeout( function () {\n  \t\t\t\tchangedProperties = [];\n  \t\t\t\tcssTransitionsDone();\n  \t\t\t}, options.duration + ( options.delay || 0 ) + 50 );\n  \t\t\tt.registerCompleteHandler( transitionDone );\n\n  \t\t\tsetTimeout( function () {\n  \t\t\t\tvar i = changedProperties.length;\n  \t\t\t\tvar hash;\n  \t\t\t\tvar originalValue;\n  \t\t\t\tvar index;\n  \t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\tvar prop;\n  \t\t\t\tvar suffix;\n  \t\t\t\tvar interpolator;\n\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\tif ( CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\tstyle[ prefix$1( prop ) ] = to[ prop ];\n\n  \t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\tif ( !canUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle( prop );\n\n  \t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\tcanUseCssTransitions[ hash ] = ( t.getStyle( prop ) != to[ prop ] );\n  \t\t\t\t\t\t\tcannotUseCssTransitions[ hash ] = !canUseCssTransitions[ hash ];\n\n  \t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\tif ( cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t\t\tstyle[ prefix$1( prop ) ] = originalValue;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif ( !CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\tif ( originalValue === undefined ) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle( prop );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\tindex = changedProperties.indexOf( prop );\n  \t\t\t\t\t\tif ( index === -1 ) {\n  \t\t\t\t\t\t\twarnIfDebug( 'Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tchangedProperties.splice( index, 1 );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\tsuffix = /[^\\d]*$/.exec( to[ prop ] )[0];\n  \t\t\t\t\t\tinterpolator = interpolate( parseFloat( originalValue ), parseFloat( to[ prop ] ) ) || ( function () { return to[ prop ]; } );\n\n  \t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\tname: prefix$1( prop ),\n  \t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t});\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// javascript transitions\n  \t\t\t\tif ( propertiesToTransitionInJs.length ) {\n  \t\t\t\t\tvar easing;\n\n  \t\t\t\t\tif ( typeof options.easing === 'string' ) {\n  \t\t\t\t\t\teasing = t.ractive.easing[ options.easing ];\n\n  \t\t\t\t\t\tif ( !easing ) {\n  \t\t\t\t\t\t\twarnOnceIfDebug( missingPlugin( options.easing, 'easing' ) );\n  \t\t\t\t\t\t\teasing = linear$1;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if ( typeof options.easing === 'function' ) {\n  \t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\teasing = linear$1;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\tstep: function ( pos ) {\n  \t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\twhile ( i-- ) {\n  \t\t\t\t\t\t\t\tvar prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\tt.node.style[ prop.name ] = prop.interpolator( pos ) + prop.suffix;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t}\n  \t\t\t\t\t});\n  \t\t\t\t} else {\n  \t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t}\n\n  \t\t\t\tif ( !changedProperties.length ) {\n  \t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\tt.node.removeEventListener( TRANSITIONEND, transitionEndHandler, false );\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n  \t\t\t}, 0 );\n  \t\t}, options.delay || 0 );\n  \t};\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle ( node, style ) {\n  \tif ( style ) {\n  \t\tnode.setAttribute( 'style', style );\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute( 'style' );\n  \t\tnode.removeAttribute( 'style' );\n  \t}\n  }\n\n  var getComputedStyle = win && ( win.getComputedStyle || legacy.getComputedStyle );\n  var resolved = Promise$1.resolve();\n\n  var names = {\n  \tt0: 'intro-outro',\n  \tt1: 'intro',\n  \tt2: 'outro'\n  };\n\n  var Transition = function Transition ( options ) {\n  \tthis.owner = options.owner || options.parentFragment.owner || findElement( options.parentFragment );\n  \tthis.element = this.owner.attributeByName ? this.owner : findElement( options.parentFragment );\n  \tthis.ractive = this.owner.ractive;\n  \tthis.template = options.template;\n  \tthis.parentFragment = options.parentFragment;\n  \tthis.options = options;\n  \tthis.onComplete = [];\n  };\n\n  Transition.prototype.animateStyle = function animateStyle ( style, value, options ) {\n  \tvar this$1 = this;\n\n  \t\tif ( arguments.length === 4 ) {\n  \t\tthrow new Error( 't.animateStyle() returns a promise - use .then() instead of passing a callback' );\n  \t}\n\n  \t// Special case - page isn't visible. Don't animate anything, because\n  \t// that way you'll never get CSS transitionend events\n  \tif ( !visible ) {\n  \t\tthis.setStyle( style, value );\n  \t\treturn resolved;\n  \t}\n\n  \tvar to;\n\n  \tif ( typeof style === 'string' ) {\n  \t\tto = {};\n  \t\tto[ style ] = value;\n  \t} else {\n  \t\tto = style;\n\n  \t\t// shuffle arguments\n  \t\toptions = value;\n  \t}\n\n  \t// As of 0.3.9, transition authors should supply an `option` object with\n  \t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t// callback function that gets called after the animation completes\n\n  \t// TODO remove this check in a future version\n  \tif ( !options ) {\n  \t\twarnOnceIfDebug( 'The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name );\n  \t\toptions = this;\n  \t}\n\n  \treturn new Promise$1( function ( fulfil ) {\n  \t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\tif ( !options.duration ) {\n  \t\t\tthis$1.setStyle( to );\n  \t\t\tfulfil();\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Get a list of the properties we're animating\n  \t\tvar propertyNames = Object.keys( to );\n  \t\tvar changedProperties = [];\n\n  \t\t// Store the current styles\n  \t\tvar computedStyle = getComputedStyle( this$1.owner.node );\n\n  \t\tvar i = propertyNames.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar prop = propertyNames[i];\n  \t\t\tvar current = computedStyle[ prefix$1( prop ) ];\n\n  \t\t\tif ( current === '0px' ) current = 0;\n\n  \t\t\t// we need to know if we're actually changing anything\n  \t\t\tif ( current != to[ prop ] ) { // use != instead of !==, so we can compare strings with numbers\n  \t\t\t\tchangedProperties.push( prop );\n\n  \t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t// e.g. height='auto'\n  \t\t\t\tthis$1.owner.node.style[ prefix$1( prop ) ] = current;\n  \t\t\t}\n  \t\t}\n\n  \t\t// If we're not actually changing anything, the transitionend event\n  \t\t// will never fire! So we complete early\n  \t\tif ( !changedProperties.length ) {\n  \t\t\tfulfil();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tcreateTransitions$1( this$1, to, options, changedProperties, fulfil );\n  \t});\n  };\n\n  Transition.prototype.bind = function bind () {\n  \tvar options = this.options;\n  \tif ( options.template ) {\n  \t\tif ( options.template.v === 't0' || options.template.v == 't1' ) this.element._introTransition = this;\n  \t\tif ( options.template.v === 't0' || options.template.v == 't2' ) this.element._outroTransition = this;\n  \t\tthis.eventName = names[ options.template.v ];\n  \t}\n\n  \tvar ractive = this.owner.ractive;\n\n  \tthis.name = options.name || options.template.n;\n\n  \tif ( options.params ) {\n  \t\tthis.params = options.params;\n  \t}\n\n  \tif ( typeof this.name === 'function' ) {\n  \t\tthis._fn = this.name;\n  \t\tthis.name = this._fn.name;\n  \t} else {\n  \t\tthis._fn = findInViewHierarchy( 'transitions', ractive, this.name );\n  \t}\n\n  \tif ( !this._fn ) {\n  \t\twarnOnceIfDebug( missingPlugin( this.name, 'transition' ), { ractive: ractive });\n  \t}\n\n  \tsetupArgsFn( this, options.template, this.parentFragment );\n  };\n\n  Transition.prototype.destroyed = function destroyed () {};\n\n  Transition.prototype.getStyle = function getStyle ( props ) {\n  \tvar computedStyle = getComputedStyle( this.owner.node );\n\n  \tif ( typeof props === 'string' ) {\n  \t\tvar value = computedStyle[ prefix$1( props ) ];\n  \t\treturn value === '0px' ? 0 : value;\n  \t}\n\n  \tif ( !isArray( props ) ) {\n  \t\tthrow new Error( 'Transition$getStyle must be passed a string, or an array of strings representing CSS properties' );\n  \t}\n\n  \tvar styles = {};\n\n  \tvar i = props.length;\n  \twhile ( i-- ) {\n  \t\tvar prop = props[i];\n  \t\tvar value$1 = computedStyle[ prefix$1( prop ) ];\n\n  \t\tif ( value$1 === '0px' ) value$1 = 0;\n  \t\tstyles[ prop ] = value$1;\n  \t}\n\n  \treturn styles;\n  };\n\n  Transition.prototype.processParams = function processParams ( params, defaults ) {\n  \tif ( typeof params === 'number' ) {\n  \t\tparams = { duration: params };\n  \t}\n\n  \telse if ( typeof params === 'string' ) {\n  \t\tif ( params === 'slow' ) {\n  \t\t\tparams = { duration: 600 };\n  \t\t} else if ( params === 'fast' ) {\n  \t\t\tparams = { duration: 200 };\n  \t\t} else {\n  \t\t\tparams = { duration: 400 };\n  \t\t}\n  \t} else if ( !params ) {\n  \t\tparams = {};\n  \t}\n\n  \treturn extendObj( {}, defaults, params );\n  };\n\n  Transition.prototype.rebinding = function rebinding ( next, previous ) {\n  \tvar idx = this.models.indexOf( previous );\n  \tif ( !~idx ) return;\n\n  \tnext = rebindMatch( this.template.f.r[ idx ], next, previous );\n  \tif ( next === previous ) return;\n\n  \tprevious.unregister( this );\n  \tthis.models.splice( idx, 1, next );\n  \tif ( next ) next.addShuffleRegister( this, 'mark' );\n  };\n\n  Transition.prototype.registerCompleteHandler = function registerCompleteHandler ( fn ) {\n  \taddToArray( this.onComplete, fn );\n  };\n\n  Transition.prototype.render = function render () {};\n\n  Transition.prototype.setStyle = function setStyle ( style, value ) {\n  \tif ( typeof style === 'string' ) {\n  \t\tthis.owner.node.style[ prefix$1( style ) ] = value;\n  \t}\n\n  \telse {\n  \t\tvar prop;\n  \t\tfor ( prop in style ) {\n  \t\t\tif ( style.hasOwnProperty( prop ) ) {\n  \t\t\t\tthis.owner.node.style[ prefix$1( prop ) ] = style[ prop ];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn this;\n  };\n\n  Transition.prototype.start = function start () {\n  \tvar this$1 = this;\n\n  \t\tvar node = this.node = this.element.node;\n  \tvar originalStyle = node.getAttribute( 'style' );\n\n  \tvar completed;\n  \tvar args = this.params;\n\n  \t// create t.complete() - we don't want this on the prototype,\n  \t// because we don't want `this` silliness when passing it as\n  \t// an argument\n  \tthis.complete = function ( noReset ) {\n  \t\tif ( completed ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis$1.onComplete.forEach( function ( fn ) { return fn(); } );\n  \t\tif ( !noReset && this$1.isIntro ) {\n  \t\t\tresetStyle( node, originalStyle);\n  \t\t}\n\n  \t\tthis$1._manager.remove( this$1 );\n\n  \t\tif ( this$1.shouldUnbind ) teardownArgsFn( this$1, this$1.options.template );\n\n  \t\tcompleted = true;\n  \t};\n\n  \t// If the transition function doesn't exist, abort\n  \tif ( !this._fn ) {\n  \t\tthis.complete();\n  \t\treturn;\n  \t}\n\n  \t// get expression args if supplied\n  \tif ( this.fn ) {\n  \t\tvar values = this.models.map( function ( model ) {\n  \t\t\tif ( !model ) return undefined;\n\n  \t\t\treturn model.get();\n  \t\t});\n  \t\targs = this.fn.apply( this.ractive, values );\n  \t}\n\n  \tvar promise = this._fn.apply( this.ractive, [ this ].concat( args ) );\n  \tif ( promise ) promise.then( this.complete );\n  };\n\n  Transition.prototype.toString = function toString () { return ''; };\n\n  Transition.prototype.unbind = function unbind$1 () {\n  \tthis.shouldUnbind = true;\n  };\n\n  Transition.prototype.unregisterCompleteHandler = function unregisterCompleteHandler ( fn ) {\n  \tremoveFromArray( this.onComplete, fn );\n  };\n\n  Transition.prototype.unrender = function unrender () {};\n\n  Transition.prototype.update = function update () {};\n\n  var elementCache = {};\n\n  var ieBug;\n  var ieBlacklist;\n\n  try {\n  \tcreateElement( 'table' ).innerHTML = 'foo';\n  } catch ( err ) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE:  [ '<table class=\"x\">', '</table>' ],\n  \t\tTHEAD:  [ '<table><thead class=\"x\">', '</thead></table>' ],\n  \t\tTBODY:  [ '<table><tbody class=\"x\">', '</tbody></table>' ],\n  \t\tTR:     [ '<table><tr class=\"x\">', '</tr></table>' ],\n  \t\tSELECT: [ '<select class=\"x\">', '</select>' ]\n  \t};\n  }\n\n  function insertHtml ( html, node, docFrag ) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif ( html == null || html === '' ) return nodes;\n\n  \tvar container;\n  \tvar wrapper;\n  \tvar selectedOption;\n\n  \tif ( ieBug && ( wrapper = ieBlacklist[ node.tagName ] ) ) {\n  \t\tcontainer = element( 'DIV' );\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector( '.x' );\n\n  \t\tif ( container.tagName === 'SELECT' ) {\n  \t\t\tselectedOption = container.options[ container.selectedIndex ];\n  \t\t}\n  \t}\n\n  \telse if ( node.namespaceURI === svg$1 ) {\n  \t\tcontainer = element( 'DIV' );\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector( '.x' );\n  \t}\n\n  \telse if ( node.tagName === 'TEXTAREA' ) {\n  \t\tcontainer = createElement( 'div' );\n\n  \t\tif ( typeof container.textContent !== 'undefined' ) {\n  \t\t\tcontainer.textContent = html;\n  \t\t} else {\n  \t\t\tcontainer.innerHTML = html;\n  \t\t}\n  \t}\n\n  \telse {\n  \t\tcontainer = element( node.tagName );\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif ( container.tagName === 'SELECT' ) {\n  \t\t\tselectedOption = container.options[ container.selectedIndex ];\n  \t\t}\n  \t}\n\n  \tvar child;\n  \twhile ( child = container.firstChild ) {\n  \t\tnodes.push( child );\n  \t\tdocFrag.appendChild( child );\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i;\n  \tif ( node.tagName === 'SELECT' ) {\n  \t\ti = nodes.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( nodes[i] !== selectedOption ) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element ( tagName ) {\n  \treturn elementCache[ tagName ] || ( elementCache[ tagName ] = createElement( tagName ) );\n  }\n\n  var Triple = (function (Mustache) {\n  \tfunction Triple ( options ) {\n  \t\tMustache.call( this, options );\n  \t}\n\n  \tTriple.prototype = Object.create( Mustache && Mustache.prototype );\n  \tTriple.prototype.constructor = Triple;\n\n  \tTriple.prototype.detach = function detach () {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach( function ( node ) { return docFrag.appendChild( node ); } );\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find ( selector ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar len = this.nodes.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar node = this$1.nodes[i];\n\n  \t\t\tif ( node.nodeType !== 1 ) continue;\n\n  \t\t\tif ( matches( node, selector ) ) return node;\n\n  \t\t\tvar queryResult = node.querySelector( selector );\n  \t\t\tif ( queryResult ) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll ( selector, query ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar len = this.nodes.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar node = this$1.nodes[i];\n\n  \t\t\tif ( node.nodeType !== 1 ) continue;\n\n  \t\t\tif ( query.test( node ) ) query.add( node );\n\n  \t\t\tvar queryAllResult = node.querySelectorAll( selector );\n  \t\t\tif ( queryAllResult ) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j;\n\n  \t\t\t\tfor ( j = 0; j < numNodes; j += 1 ) {\n  \t\t\t\t\tquery.add( queryAllResult[j] );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent () {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode () {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render ( target ) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml( html, this.parentFragment.findParentNode(), target );\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString () {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences( '' + this.model.get() ) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender () {\n  \t\tif ( this.nodes ) this.nodes.forEach( function ( node ) { return detachNode( node ); } );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update () {\n  \t\tif ( this.rendered && this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render( docFrag );\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode( this );\n\n  \t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t} else {\n  \t\t\t// make sure to reset the dirty flag even if not rendered\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  }(Mustache));\n\n  // finds the component constructor in the registry or view hierarchy registries\n  function getComponentConstructor ( ractive, name ) {\n  \tvar instance = findInstance( 'components', ractive, name );\n  \tvar Component;\n\n  \tif ( instance ) {\n  \t\tComponent = instance.components[ name ];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif ( !Component._Parent ) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind( instance );\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty( name );\n  \t\t\tComponent = fn();\n\n  \t\t\tif ( !Component ) {\n  \t\t\t\twarnIfDebug( noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif ( typeof Component === 'string' ) {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor( ractive, Component );\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[ name ] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[ ALIAS ] = Alias;\n  constructors[ ANCHOR ] = Component;\n  constructors[ DOCTYPE ] = Doctype;\n  constructors[ INTERPOLATOR ] = Interpolator;\n  constructors[ PARTIAL ] = Partial;\n  constructors[ SECTION ] = Section;\n  constructors[ TRIPLE ] = Triple;\n  constructors[ YIELDER ] = Partial;\n\n  constructors[ ATTRIBUTE ] = Attribute;\n  constructors[ BINDING_FLAG ] = BindingFlag;\n  constructors[ DECORATOR ] = Decorator;\n  constructors[ EVENT ] = EventDirective;\n  constructors[ TRANSITION ] = Transition;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n\n  function createItem ( options ) {\n  \tif ( typeof options.template === 'string' ) {\n  \t\treturn new Text( options );\n  \t}\n\n  \tif ( options.template.t === ELEMENT ) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor( options.parentFragment.ractive, options.template.e );\n  \t\tif ( ComponentConstructor ) {\n  \t\t\treturn new Component( options, ComponentConstructor );\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[ tagName ] || Element;\n  \t\treturn new ElementConstructor( options );\n  \t}\n\n  \tvar Item;\n\n  \t// component mappings are a special case of attribute\n  \tif ( options.template.t === ATTRIBUTE ) {\n  \t\tvar el = options.owner;\n  \t\tif ( !el || ( el.type !== ANCHOR && el.type !== COMPONENT && el.type !== ELEMENT ) ) {\n  \t\t\tel = findElement( options.parentFragment );\n  \t\t}\n  \t\toptions.element = el;\n\n  \t\tItem = el.type === COMPONENT || el.type === ANCHOR ? Mapping : Attribute;\n  \t} else {\n  \t\tItem = constructors[ options.template.t ];\n  \t}\n\n  \tif ( !Item ) throw new Error( (\"Unrecognised item type \" + (options.template.t)) );\n\n  \treturn new Item( options );\n  }\n\n  // TODO all this code needs to die\n  function processItems ( items, values, guid, counter ) {\n  \tif ( counter === void 0 ) counter = 0;\n\n  \treturn items.map( function ( item ) {\n  \t\tif ( item.type === TEXT ) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif ( item.fragment ) {\n  \t\t\tif ( item.fragment.iterations ) {\n  \t\t\t\treturn item.fragment.iterations.map( function ( fragment ) {\n  \t\t\t\t\treturn processItems( fragment.items, values, guid, counter );\n  \t\t\t\t}).join( '' );\n  \t\t\t} else {\n  \t\t\t\treturn processItems( item.fragment.items, values, guid, counter );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = \"\" + guid + \"-\" + (counter++);\n  \t\tvar model = item.model || item.newModel;\n\n  \t\tvalues[ placeholderId ] = model ?\n  \t\t\tmodel.wrapper ?\n  \t\t\t\tmodel.wrapperValue :\n  \t\t\t\tmodel.get() :\n  \t\t\tundefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join( '' );\n  }\n\n  function unrenderAndDestroy$1 ( item ) {\n  \titem.unrender( true );\n  }\n\n  var Fragment = function Fragment ( options ) {\n  \tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \tthis.isRoot = !options.owner.parentFragment;\n  \tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \tthis.ractive = options.ractive || ( this.isRoot ? options.owner : this.parent.ractive );\n\n  \tthis.componentParent = ( this.isRoot && this.ractive.component ) ? this.ractive.component.parentFragment : null;\n\n  \tthis.context = null;\n  \tthis.rendered = false;\n\n  \t// encapsulated styles should be inherited until they get applied by an element\n  \tthis.cssIds = 'cssIds' in options ? options.cssIds : ( this.parent ? this.parent.cssIds : null );\n\n  \tthis.resolvers = [];\n\n  \tthis.dirty = false;\n  \tthis.dirtyValue = true; // used for attribute values\n\n  \tthis.template = options.template || [];\n  \tthis.createItems();\n  };\n\n  Fragment.prototype.bind = function bind$1$$ ( context ) {\n  \tthis.context = context;\n  \tthis.items.forEach( bind$1 );\n  \tthis.bound = true;\n\n  \t// in rare cases, a forced resolution (or similar) will cause the\n  \t// fragment to be dirty before it's even finished binding. In those\n  \t// cases we update immediately\n  \tif ( this.dirty ) this.update();\n\n  \treturn this;\n  };\n\n  Fragment.prototype.bubble = function bubble () {\n  \tthis.dirtyValue = true;\n\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n\n  \t\tif ( this.isRoot ) { // TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\tif ( this.ractive.component ) {\n  \t\t\t\tthis.ractive.component.bubble();\n  \t\t\t} else if ( this.bound ) {\n  \t\t\t\trunloop.addFragment( this );\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.createItems = function createItems () {\n  \t// this is a hot code path\n  \tvar this$1 = this;\n\n  \t\tvar max = this.template.length;\n  \tthis.items = [];\n  \tfor ( var i = 0; i < max; i++ ) {\n  \t\tthis$1.items[i] = createItem({ parentFragment: this$1, template: this$1.template[i], index: i });\n  \t}\n  };\n\n  Fragment.prototype.destroyed = function destroyed () {\n  \tthis.items.forEach( function ( i ) { return i.destroyed(); } );\n  };\n\n  Fragment.prototype.detach = function detach () {\n  \tvar docFrag = createDocumentFragment();\n  \tthis.items.forEach( function ( item ) { return docFrag.appendChild( item.detach() ); } );\n  \treturn docFrag;\n  };\n\n  Fragment.prototype.find = function find ( selector, options ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.items.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.items[i].find( selector, options );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  Fragment.prototype.findAll = function findAll ( selector, query ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.items ) {\n  \t\tvar len = this.items.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar item = this$1.items[i];\n\n  \t\t\tif ( item.findAll ) {\n  \t\t\t\titem.findAll( selector, query );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn query;\n  };\n\n  Fragment.prototype.findComponent = function findComponent ( name, options ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.items.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.items[i].findComponent( name, options );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  Fragment.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.items ) {\n  \t\tvar len = this.items.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar item = this$1.items[i];\n\n  \t\t\tif ( item.findAllComponents ) {\n  \t\t\t\titem.findAllComponents( name, query );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn query;\n  };\n\n  Fragment.prototype.findContext = function findContext () {\n  \tvar fragment = this;\n  \twhile ( fragment && !fragment.context ) fragment = fragment.parent;\n  \tif ( !fragment ) return this.ractive.viewmodel;\n  \telse return fragment.context;\n  };\n\n  Fragment.prototype.findNextNode = function findNextNode ( item ) {\n  \t// search for the next node going forward\n  \tvar this$1 = this;\n\n  \t\tif ( item ) {\n  \t\tfor ( var i = item.index + 1; i < this$1.items.length; i++ ) {\n  \t\t\tif ( !this$1.items[ i ] ) continue;\n\n  \t\t\tvar node = this$1.items[ i ].firstNode( true );\n  \t\t\tif ( node ) return node;\n  \t\t}\n  \t}\n\n  \t// if this is the root fragment, and there are no more items,\n  \t// it means we're at the end...\n  \tif ( this.isRoot ) {\n  \t\tif ( this.ractive.component ) {\n  \t\t\treturn this.ractive.component.parentFragment.findNextNode( this.ractive.component );\n  \t\t}\n\n  \t\t// TODO possible edge case with other content\n  \t\t// appended to this.ractive.el?\n  \t\treturn null;\n  \t}\n\n  \tif ( this.parent ) return this.owner.findNextNode( this ); // the argument is in case the parent is a RepeatedFragment\n  };\n\n  Fragment.prototype.findParentNode = function findParentNode () {\n  \tvar fragment = this;\n\n  \tdo {\n  \t\tif ( fragment.owner.type === ELEMENT ) {\n  \t\t\treturn fragment.owner.node;\n  \t\t}\n\n  \t\tif ( fragment.isRoot && !fragment.ractive.component ) { // TODO encapsulate check\n  \t\t\treturn fragment.ractive.el;\n  \t\t}\n\n  \t\tif ( fragment.owner.type === YIELDER ) {\n  \t\t\tfragment = fragment.owner.containerFragment;\n  \t\t} else {\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t}\n  \t} while ( fragment );\n\n  \tthrow new Error( 'Could not find parent node' ); // TODO link to issue tracker\n  };\n\n  Fragment.prototype.findRepeatingFragment = function findRepeatingFragment () {\n  \tvar fragment = this;\n  \t// TODO better check than fragment.parent.iterations\n  \twhile ( ( fragment.parent || fragment.componentParent ) && !fragment.isIteration ) {\n  \t\tfragment = fragment.parent || fragment.componentParent;\n  \t}\n\n  \treturn fragment;\n  };\n\n  Fragment.prototype.firstNode = function firstNode ( skipParent ) {\n  \tvar this$1 = this;\n\n  \t\tvar node;\n  \tfor ( var i = 0; i < this$1.items.length; i++ ) {\n  \t\tnode = this$1.items[i].firstNode( true );\n\n  \t\tif ( node ) {\n  \t\t\treturn node;\n  \t\t}\n  \t}\n\n  \tif ( skipParent ) return null;\n\n  \treturn this.parent.findNextNode( this.owner );\n  };\n\n  Fragment.prototype.rebinding = function rebinding ( next ) {\n  \tthis.context = next;\n  };\n\n  Fragment.prototype.render = function render ( target, occupants ) {\n  \tif ( this.rendered ) throw new Error( 'Fragment is already rendered!' );\n  \tthis.rendered = true;\n\n  \tthis.items.forEach( function ( item ) { return item.render( target, occupants ); } );\n  };\n\n  Fragment.prototype.resetTemplate = function resetTemplate ( template ) {\n  \tvar wasBound = this.bound;\n  \tvar wasRendered = this.rendered;\n\n  \t// TODO ensure transitions are disabled globally during reset\n\n  \tif ( wasBound ) {\n  \t\tif ( wasRendered ) this.unrender( true );\n  \t\tthis.unbind();\n  \t}\n\n  \tthis.template = template;\n  \tthis.createItems();\n\n  \tif ( wasBound ) {\n  \t\tthis.bind( this.context );\n\n  \t\tif ( wasRendered ) {\n  \t\t\tvar parentNode = this.findParentNode();\n  \t\t\tvar anchor = this.findNextNode();\n\n  \t\t\tif ( anchor ) {\n  \t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\tthis.render( docFrag );\n  \t\t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t\t} else {\n  \t\t\t\tthis.render( parentNode );\n  \t\t\t}\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.resolve = function resolve ( template, callback ) {\n  \tif ( !this.context && this.parent.resolve ) {\n  \t\treturn this.parent.resolve( template, callback );\n  \t}\n\n  \tvar resolver = new ReferenceResolver( this, template, callback );\n  \tthis.resolvers.push( resolver );\n\n  \treturn resolver; // so we can e.g. force resolution\n  };\n\n  Fragment.prototype.shuffled = function shuffled () {\n  \tthis.items.forEach( function ( i ) { return i.shuffled(); } );\n  };\n\n  Fragment.prototype.toHtml = function toHtml () {\n  \treturn this.toString();\n  };\n\n  Fragment.prototype.toString = function toString$1$$ ( escape ) {\n  \treturn this.items.map( escape ? toEscapedString : toString$1 ).join( '' );\n  };\n\n  Fragment.prototype.unbind = function unbind$1 () {\n  \tthis.items.forEach( unbind );\n  \tthis.bound = false;\n\n  \treturn this;\n  };\n\n  Fragment.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \tthis.items.forEach( shouldDestroy ? unrenderAndDestroy$1 : unrender );\n  \tthis.rendered = false;\n  };\n\n  Fragment.prototype.update = function update$1 () {\n  \tif ( this.dirty ) {\n  \t\tif ( !this.updating ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.updating = true;\n  \t\t\tthis.items.forEach( update );\n  \t\t\tthis.updating = false;\n  \t\t} else if ( this.isRoot ) {\n  \t\t\trunloop.addFragmentToRoot( this );\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.valueOf = function valueOf () {\n  \tif ( this.items.length === 1 ) {\n  \t\treturn this.items[0].valueOf();\n  \t}\n\n  \tif ( this.dirtyValue ) {\n  \t\tvar values = {};\n  \t\tvar source = processItems( this.items, values, this.ractive._guid );\n  \t\tvar parsed = parseJSON( source, values );\n\n  \t\tthis.value = parsed ?\n  \t\t\tparsed.value :\n  \t\t\tthis.toString();\n\n  \t\tthis.dirtyValue = false;\n  \t}\n\n  \treturn this.value;\n  };\n\n  function getChildQueue ( queue, ractive ) {\n  \treturn queue[ ractive._guid ] || ( queue[ ractive._guid ] = [] );\n  }\n\n  function fire ( hookQueue, ractive ) {\n  \tvar childQueue = getChildQueue( hookQueue.queue, ractive );\n\n  \thookQueue.hook.fire( ractive );\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile ( childQueue.length ) {\n  \t\tfire( hookQueue, childQueue.shift() );\n  \t}\n\n  \tdelete hookQueue.queue[ ractive._guid ];\n  }\n\n  var HookQueue = function HookQueue ( event ) {\n  \tthis.hook = new Hook( event );\n  \tthis.inProcess = {};\n  \tthis.queue = {};\n  };\n\n  HookQueue.prototype.begin = function begin ( ractive ) {\n  \tthis.inProcess[ ractive._guid ] = true;\n  };\n\n  HookQueue.prototype.end = function end ( ractive ) {\n  \tvar parent = ractive.parent;\n\n  \t// If this is *isn't* a child of a component that's in process,\n  \t// it should call methods or fire at this point\n  \tif ( !parent || !this.inProcess[ parent._guid ] ) {\n  \t\tfire( this, ractive );\n  \t}\n  \t// elsewise, handoff to parent to fire when ready\n  \telse {\n  \t\tgetChildQueue( this.queue, parent ).push( ractive );\n  \t}\n\n  \tdelete this.inProcess[ ractive._guid ];\n  };\n\n  var configHook = new Hook( 'config' );\n  var initHook = new HookQueue( 'init' );\n\n  function initialise ( ractive, userOptions, options ) {\n  \tObject.keys( ractive.viewmodel.computations ).forEach( function ( key ) {\n  \t\tvar computation = ractive.viewmodel.computations[ key ];\n\n  \t\tif ( ractive.viewmodel.value.hasOwnProperty( key ) ) {\n  \t\t\tcomputation.set( ractive.viewmodel.value[ key ] );\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init( ractive.constructor, ractive, userOptions );\n\n  \tconfigHook.fire( ractive );\n  \tinitHook.begin( ractive );\n\n  \tvar fragment = ractive.fragment = createFragment( ractive, options );\n  \tif ( fragment ) fragment.bind( ractive.viewmodel );\n\n  \tinitHook.end( ractive );\n\n  \tif ( fragment ) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement( ractive.el || ractive.target );\n  \t\tif ( el ) {\n  \t\t\tvar promise = ractive.render( el, ractive.append );\n\n  \t\t\tif ( Ractive.DEBUG_PROMISES ) {\n  \t\t\t\tpromise['catch']( function ( err ) {\n  \t\t\t\t\twarnOnceIfDebug( 'Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;' );\n  \t\t\t\t\twarnIfDebug( 'An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\tlogIfDebug( err );\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function createFragment ( ractive, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( ractive.template ) {\n  \t\tvar cssIds;\n\n  \t\tif ( options.cssIds || ractive.cssId ) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif ( ractive.cssId ) {\n  \t\t\t\tcssIds.push( ractive.cssId );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds\n  \t\t});\n  \t}\n  }\n\n  var renderHook = new Hook( 'render' );\n  var completeHook = new Hook( 'complete' );\n\n  function render$1 ( ractive, target, anchor, occupants ) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif ( ractive.noIntro ) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start( ractive, true );\n  \trunloop.scheduleTask( function () { return renderHook.fire( ractive ); }, true );\n\n  \tif ( ractive.fragment.rendered ) {\n  \t\tthrow new Error( 'You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first' );\n  \t}\n\n  \tif ( ractive.destroyed ) {\n  \t\tractive.destroyed = false;\n  \t\tractive.fragment = createFragment( ractive ).bind( ractive.viewmodel );\n  \t}\n\n  \tanchor = getElement( anchor ) || ractive.anchor;\n\n  \tractive.el = ractive.target = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif ( ractive.cssId ) applyCSS();\n\n  \tif ( target ) {\n  \t\t( target.__ractive_instances__ || ( target.__ractive_instances__ = [] ) ).push( ractive );\n\n  \t\tif ( anchor ) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render( docFrag );\n  \t\t\ttarget.insertBefore( docFrag, anchor );\n  \t\t} else {\n  \t\t\tractive.fragment.render( target, occupants );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then( function () { return completeHook.fire( ractive ); } );\n  }\n\n  function Ractive$render ( target, anchor ) {\n  \tif ( this.torndown ) {\n  \t\twarnIfDebug( 'ractive.render() was called on a Ractive instance that was already torn down' );\n  \t\treturn Promise.resolve();\n  \t}\n\n  \ttarget = getElement( target ) || this.el;\n\n  \tif ( !this.append && target ) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif ( others ) others.forEach( teardown );\n\n  \t\t// make sure we are the only occupants\n  \t\tif ( !this.enhance ) {\n  \t\t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t\t}\n  \t}\n\n  \tvar occupants = this.enhance ? toArray( target.childNodes ) : null;\n  \tvar promise = render$1( this, target, anchor, occupants );\n\n  \tif ( occupants ) {\n  \t\twhile ( occupants.length ) target.removeChild( occupants.pop() );\n  \t}\n\n  \treturn promise;\n  }\n\n  var shouldRerender = [ 'template', 'partials', 'components', 'decorators', 'events' ];\n\n  var completeHook$1 = new Hook( 'complete' );\n  var resetHook = new Hook( 'reset' );\n  var renderHook$1 = new Hook( 'render' );\n  var unrenderHook = new Hook( 'unrender' );\n\n  function Ractive$reset ( data ) {\n  \tdata = data || {};\n\n  \tif ( typeof data !== 'object' ) {\n  \t\tthrow new Error( 'The reset method takes either no arguments, or an object containing new data' );\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init( this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start( this, true );\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif ( wrapper && wrapper.reset ) {\n  \t\tif ( wrapper.reset( data ) === false ) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set( data );\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set( data );\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset( this );\n  \tvar rerender;\n\n  \tvar i = changes.length;\n  \twhile ( i-- ) {\n  \t\tif ( shouldRerender.indexOf( changes[i] ) > -1 ) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif ( rerender ) {\n  \t\tunrenderHook.fire( this );\n  \t\tthis.fragment.resetTemplate( this.template );\n  \t\trenderHook$1.fire( this );\n  \t\tcompleteHook$1.fire( this );\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire( this, data );\n\n  \treturn promise;\n  }\n\n  function collect( source, name, attr, dest ) {\n  \tsource.forEach( function ( item ) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif ( item.type === PARTIAL && ( item.refName ===  name || item.name === name ) ) {\n  \t\t\titem.inAttribute = attr;\n  \t\t\tdest.push( item );\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif ( item.fragment ) {\n  \t\t\tcollect( item.fragment.iterations || item.fragment.items, name, attr, dest );\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if ( isArray( item.items ) ) {\n  \t\t\tcollect( item.items, name, attr, dest );\n  \t\t}\n\n  \t\t// or if it is a component, step in and process its items\n  \t\telse if ( item.type === COMPONENT && item.instance ) {\n  \t\t\t// ...unless the partial is shadowed\n  \t\t\tif ( item.instance.partials[ name ] ) return;\n  \t\t\tcollect( item.instance.fragment.items, name, attr, dest );\n  \t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif ( item.type === ELEMENT ) {\n  \t\t\tif ( isArray( item.attributes ) ) {\n  \t\t\t\tcollect( item.attributes, name, true, dest );\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate ( partial ) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial ( name, partial ) {\n  \tvar collection = [];\n  \tcollect( this.fragment.items, name, false, collection );\n\n  \tvar promise = runloop.start( this, true );\n\n  \tthis.partials[ name ] = partial;\n  \tcollection.forEach( forceResetTemplate );\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate ( template ) {\n  \ttemplateConfigurator.init( null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif ( component ) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif ( component ) component.shouldDestroy = false;\n\n  \tvar promise = runloop.start();\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind().unrender( true );\n\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n\n  \tvar docFrag = createDocumentFragment();\n  \tthis.fragment.bind( this.viewmodel ).render( docFrag );\n\n  \t// if this is a component, its el may not be valid, so find a\n  \t// target based on the component container\n  \tif ( component && !component.external ) {\n  \t\tthis.fragment.findParentNode().insertBefore( docFrag, component.findNextNode() );\n  \t} else {\n  \t\tthis.el.insertBefore( docFrag, this.anchor );\n  \t}\n\n  \trunloop.end();\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise;\n  }\n\n  var reverse$1 = makeArrayMethod( 'reverse' ).path;\n\n  function Ractive$set ( keypath, value ) {\n  \tvar ractive = this;\n\n  \treturn set( ractive, build( ractive, keypath, value ) );\n  }\n\n  var shift$1 = makeArrayMethod( 'shift' ).path;\n\n  var sort$1 = makeArrayMethod( 'sort' ).path;\n\n  var splice$1 = makeArrayMethod( 'splice' ).path;\n\n  function Ractive$subtract ( keypath, d ) {\n  \treturn add( this, keypath, ( d === undefined ? -1 : -d ) );\n  }\n\n  var teardownHook$1 = new Hook( 'teardown' );\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown () {\n  \tif ( this.torndown ) {\n  \t\twarnIfDebug( 'ractive.teardown() was called on a Ractive instance that was already torn down' );\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tthis.torndown = true;\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach( cancel );\n\n  \tif ( this.fragment.rendered && this.el.__ractive_instances__ ) {\n  \t\tremoveFromArray( this.el.__ractive_instances__, this );\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = ( this.fragment.rendered ? this.unrender() : Promise$1.resolve() );\n\n  \tteardownHook$1.fire( this );\n\n  \treturn promise;\n  }\n\n  function Ractive$toggle ( keypath ) {\n  \tif ( typeof keypath !== 'string' ) {\n  \t\tthrow new TypeError( badArguments );\n  \t}\n\n  \treturn set( this, gather( this, keypath ).map( function ( m ) { return [ m, !m.get() ]; } ) );\n  }\n\n  function Ractive$toCSS() {\n  \tvar cssIds = [ this.cssId ].concat( this.findAllComponents().map( function ( c ) { return c.cssId; } ) );\n  \tvar uniqueCssIds = Object.keys(cssIds.reduce( function ( ids, id ) { return (ids[id] = true, ids); }, {}));\n  \treturn getCSS( uniqueCssIds );\n  }\n\n  function Ractive$toHTML () {\n  \treturn this.fragment.toString( true );\n  }\n\n  function toText () {\n  \treturn this.fragment.toString( false );\n  }\n\n  function Ractive$transition ( name, node, params ) {\n\n  \tif ( node instanceof HTMLElement ) {\n  \t\t// good to go\n  \t}\n  \telse if ( isObject( node ) ) {\n  \t\t// omitted, use event node\n  \t\tparams = node;\n  \t}\n\n  \t// if we allow query selector, then it won't work\n  \t// simple params like \"fast\"\n\n  \t// else if ( typeof node === 'string' ) {\n  \t// \t// query selector\n  \t// \tnode = this.find( node )\n  \t// }\n\n  \tnode = node || this.event.node;\n\n  \tif ( !node || !node._ractive ) {\n  \t\tfatal( (\"No node was supplied for transition \" + name) );\n  \t}\n\n  \tparams = params || {};\n  \tvar owner = node._ractive.proxy;\n  \tvar transition = new Transition({ owner: owner, parentFragment: owner.parentFragment, name: name, params: params });\n  \ttransition.bind();\n\n  \tvar promise = runloop.start( this, true );\n  \trunloop.registerTransition( transition );\n  \trunloop.end();\n\n  \tpromise.then( function () { return transition.unbind(); } );\n  \treturn promise;\n  }\n\n  function unlink$1( here ) {\n  \tvar promise = runloop.start();\n  \tthis.viewmodel.joinAll( splitKeypathI( here ), { lastLink: false } ).unlink();\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var unrenderHook$1 = new Hook( 'unrender' );\n\n  function Ractive$unrender () {\n  \tif ( !this.fragment.rendered ) {\n  \t\twarnIfDebug( 'ractive.unrender() was called on a Ractive instance that was not rendered' );\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start( this, true );\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || ( this.component.anchor || {} ).shouldDestroy || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender( shouldDestroy );\n  \tif ( shouldDestroy ) this.destroyed = true;\n\n  \tremoveFromArray( this.el.__ractive_instances__, this );\n\n  \tunrenderHook$1.fire( this );\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var unshift$1 = makeArrayMethod( 'unshift' ).path;\n\n  function Ractive$updateModel ( keypath, cascade ) {\n  \tvar promise = runloop.start( this, true );\n\n  \tif ( !keypath ) {\n  \t\tthis.viewmodel.updateFromBindings( true );\n  \t} else {\n  \t\tthis.viewmodel.joinAll( splitKeypathI( keypath ) ).updateFromBindings( cascade !== false );\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var proto = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tattachChild: attachChild,\n  \tdetach: Ractive$detach,\n  \tdetachChild: detachChild,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tgetNodeInfo: getNodeInfo,\n  \tinsert: Ractive$insert,\n  \tlink: link$1,\n  \tmerge: thisRactive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop$1,\n  \tpush: push$1,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse$1,\n  \tset: Ractive$set,\n  \tshift: shift$1,\n  \tsort: sort$1,\n  \tsplice: splice$1,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoCSS: Ractive$toCSS,\n  \ttoCss: Ractive$toCSS,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \ttoText: toText,\n  \ttransition: Ractive$transition,\n  \tunlink: unlink$1,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift$1,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function wrap$1 ( method, superMethod, force ) {\n\n  \tif ( force || needsSuper( method, superMethod ) )  {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ( '_super' in this ), _super = this._super, result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply( this, arguments );\n\n  \t\t\tif ( hasSuper ) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t}\n\n  \telse {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper ( method, superMethod ) {\n  \treturn typeof superMethod === 'function' && /_super/.test( method );\n  }\n\n  function unwrap ( Child ) {\n  \tvar options = {};\n\n  \twhile ( Child ) {\n  \t\taddRegistries( Child, options );\n  \t\taddOtherOptions( Child, options );\n\n  \t\tif ( Child._Parent !== Ractive ) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries ( Child, options ) {\n  \tregistries.forEach( function ( r ) {\n  \t\taddRegistry(\n  \t\t\tr.useDefaults ? Child.prototype : Child,\n  \t\t\toptions, r.name );\n  \t});\n  }\n\n  function addRegistry ( target, options, name ) {\n  \tvar registry, keys = Object.keys( target[ name ] );\n\n  \tif ( !keys.length ) { return; }\n\n  \tif ( !( registry = options[ name ] ) ) {\n  \t\tregistry = options[ name ] = {};\n  \t}\n\n  \tkeys\n  \t\t.filter( function ( key ) { return !( key in registry ); } )\n  \t\t.forEach( function ( key ) { return registry[ key ] = target[ name ][ key ]; } );\n  }\n\n  function addOtherOptions ( Child, options ) {\n  \tObject.keys( Child.prototype ).forEach( function ( key ) {\n  \t\tif ( key === 'computed' ) { return; }\n\n  \t\tvar value = Child.prototype[ key ];\n\n  \t\tif ( !( key in options ) ) {\n  \t\t\toptions[ key ] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if ( typeof options[ key ] === 'function'\n  \t\t\t\t&& typeof value === 'function'\n  \t\t\t\t&& options[ key ]._method ) {\n\n  \t\t\tvar result, needsSuper = value._method;\n\n  \t\t\tif ( needsSuper ) { value = value._method; }\n\n  \t\t\t// rewrap bound directly to parent fn\n  \t\t\tresult = wrap$1( options[ key ]._method, value );\n\n  \t\t\tif ( needsSuper ) { result._method = result; }\n\n  \t\t\toptions[ key ] = result;\n  \t\t}\n  \t});\n  }\n\n  function extend () {\n  \tvar options = [], len = arguments.length;\n  \twhile ( len-- ) options[ len ] = arguments[ len ];\n\n  \tif( !options.length ) {\n  \t\treturn extendOne( this );\n  \t} else {\n  \t\treturn options.reduce( extendOne, this );\n  \t}\n  }\n\n  function extendOne ( Parent, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif ( options.prototype instanceof Ractive ) {\n  \t\toptions = unwrap( options );\n  \t}\n\n  \tChild = function ( options ) {\n  \t\tif ( !( this instanceof Child ) ) return new Child( options );\n\n  \t\tconstruct( this, options || {} );\n  \t\tinitialise( this, options || {}, {} );\n  \t};\n\n  \tproto = create( Parent.prototype );\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties( Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend( Parent, proto, options );\n\n  \tdataConfigurator.extend( Parent, proto, options );\n\n  \tif ( options.computed ) {\n  \t\tproto.computed = extendObj( create( Parent.prototype.computed ), options.computed );\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  function joinKeys () {\n  \tvar keys = [], len = arguments.length;\n  \twhile ( len-- ) keys[ len ] = arguments[ len ];\n\n  \treturn keys.map( escapeKey ).join( '.' );\n  }\n\n  function splitKeypath ( keypath ) {\n  \treturn splitKeypathI( keypath ).map( unescapeKey );\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (\n  \ttypeof Date.now !== FUNCTION                 ||\n  \ttypeof String.prototype.trim !== FUNCTION    ||\n  \ttypeof Object.keys !== FUNCTION              ||\n  \ttypeof Array.prototype.indexOf !== FUNCTION  ||\n  \ttypeof Array.prototype.forEach !== FUNCTION  ||\n  \ttypeof Array.prototype.map !== FUNCTION      ||\n  \ttypeof Array.prototype.filter !== FUNCTION   ||\n  \t( win && typeof win.addEventListener !== FUNCTION )\n  ) {\n  \tthrow new Error( 'It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.' );\n  }\n\n  function Ractive ( options ) {\n  \tif ( !( this instanceof Ractive ) ) return new Ractive( options );\n\n  \tconstruct( this, options || {} );\n  \tinitialise( this, options || {}, {} );\n  }\n\n  extendObj( Ractive.prototype, proto, defaults );\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties( Ractive, {\n\n  \t// debug flag\n  \tDEBUG:          { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend:         { value: extend },\n  \tescapeKey:      { value: escapeKey },\n  \tgetNodeInfo:    { value: staticInfo },\n  \tjoinKeys:       { value: joinKeys },\n  \tparse:          { value: parse },\n  \tsplitKeypath:   { value: splitKeypath },\n  \tunescapeKey:    { value: unescapeKey },\n  \tgetCSS:         { value: getCSS },\n\n  \t// namespaced constructors\n  \tPromise:        { value: Promise$1 },\n\n  \t// support\n  \tenhance:        { writable: true, value: false },\n  \tsvg:            { value: svg },\n  \tmagic:          { value: magicSupported },\n\n  \t// version\n  \tVERSION:        { value: '0.9.0-edge-908d1cada802ea17ba785c0a8221d9f91c635805' },\n\n  \t// plugins\n  \tadaptors:       { writable: true, value: {} },\n  \tcomponents:     { writable: true, value: {} },\n  \tdecorators:     { writable: true, value: {} },\n  \teasing:         { writable: true, value: easing },\n  \tevents:         { writable: true, value: {} },\n  \tinterpolators:  { writable: true, value: interpolators },\n  \tpartials:       { writable: true, value: {} },\n  \ttransitions:    { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["toggle","Ractive$toggle","toCSS","Ractive$toCSS","toCss","toHTML","Ractive$toHTML","toHtml","toText","transition","Ractive$transition","unlink","unlink$1","unrender","Ractive$unrender","unshift","unshift$1","update","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","prototype","trim","Object","keys","Array","indexOf","forEach","map","filter","win","addEventListener","Error","extendObj","Ractive","proto","defaults","constructor","defineProperties","DEBUG","writable","value","DEBUG_PROMISES","extend","escapeKey","getNodeInfo","staticInfo","joinKeys","parse","splitKeypath","unescapeKey","getCSS","Promise","Promise$1","enhance","svg","magic","magicSupported","VERSION","adaptors","components","decorators","easing","events","interpolators","partials","transitions","Child","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","Parser$1","Parser","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","numberPattern$1","name","identifier","specials$1","true","false","null","undefined","specialsPattern","RegExp","join","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","init","str","options","this","values","allowWhitespace","postProcess","result","length","test","leftover","v","converters","parser","placeholder","matchPattern","hasOwnProperty","special","number","stringLiteral","readStringLiteral","replace","match","$1","matchString","pair","getKeyValuePair","key","valueToken","read","push","Mapping","Item","call","template","n","owner","parentFragment","element","findElement","attributeByName","ractive","fragment","f","create","bind","viewmodel","instance","joinKey","set","parsed","parseJSON","isArray","createMapping","render","unbind","boundFragment","bound","link","target","model","dirty","rendered","updateDelegate","Option","Element","a","select","findParentSelect","parent","selectedAttribute","selected","getAttribute","index","attributes","splice","bubble","node","_ractive","attribute","getValue","valueOf","isSelected","optionValue","selectValue","i","occupants","removeFromArray","Partial","MustacheContainer","yielder","t","YIELDER","container","component","containerFragment","r","rx","x","refName","templateObj","getPartialTemplate","named","setTemplate","get","source","parsePartial","partialTemplate","c","SECTION","SECTION_WITH","k","Fragment","z","aliases","resolveAliases","findNextNode","forceResetTemplate","this$1","warnOnceIfDebug","inAttribute","doInAttributes","resetTemplate","rebinding","locked","runloop","scheduleTask","shouldDestroy","RepeatedFragment","cssIds","context","iterations","indexRef","keyRef","pendingNewIndices","previousIterations","max","createIteration","isObject","refs","split","isIteration","destroyed","detach","docFrag","createDocumentFragment","appendChild","find","selector","len","found","findAll","query","findComponent","findAllComponents","iteration","firstNode","skipParent","next","shuffle","newIndices","slice","newIndex","oldIndex","shuffled","toString","escape","toEscapedString","toString$1","unrenderAndDestroy","updatePostShuffle","updating","toRemove","oldKeys","wasArray","reset","fragment$1","newLength","parentNode","findParentNode","anchor","insertBefore","indices","oldLen","removed","frag","contiguous","startIndex","childNodes","prefix","Section","sectionType","templateSectionType","subordinate","l","sibling","items","nextSibling","SECTION_UNLESS","isTruthy","isRoot","SECTION_IF_WITH","isEmpty","previous","safe","SECTION_IF","SECTION_EACH","siblingFalsey","lastType","getType","newFragment","fragmentShouldExist","Select","foundNode","binding","selectedOptions","getSelectedOptions","sync","defaultSelected","selectNode","toArray","o","setFromNode","isMultiple","optionWasSelected","shouldSelect","valueContains","forceUpdate","Textarea","Input","deferContent","isBindable","createItem","ATTRIBUTE","Text","type","TEXT","detachNode","inAttributes","nodeType","shift","nodeValue","doc","createTextNode","escapeHtml","isClient","prefixCache","testStyle","createElement","style","prop","camelCase","capped","charAt","toUpperCase","substring","vendors","vendor","visible","prefix$1","hidden","prefix$2","i$1","onChange","onHide","onShow","createTransitions","unprefixPattern","vendorPattern","TRANSITION$1","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","testStyle$1","linear$1","canUseCssTransitions","cannotUseCssTransitions","webkitTransition","to","changedProperties","resolve","setTimeout","transitionDone","clearTimeout","cssTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","unregisterCompleteHandler","fire","isIntro","transitionEndHandler","event","unprefix","propertyName","cssTransitionsDone","property","duration","timing","removeEventListener","hashPrefix","namespaceURI","tagName","hyphenate","delay","registerCompleteHandler","hash","originalValue","suffix","interpolator","propertiesToTransitionInJs","getStyle","warnIfDebug","exec","interpolate","parseFloat","missingPlugin","Ticker","step","pos","complete","createTransitions$1","getComputedStyle","legacy","resolved","names","t0","t1","t2","Transition","onComplete","animateStyle","arguments","setStyle","fulfil","propertyNames","computedStyle","current","_introTransition","_outroTransition","eventName","params","_fn","findInViewHierarchy","setupArgsFn","props","styles","value$1","processParams","idx","models","rebindMatch","unregister","addShuffleRegister","fn","addToArray","start","completed","originalStyle","args","noReset","resetStyle","_manager","remove","shouldUnbind","teardownArgsFn","apply","promise","concat","then","ieBug","ieBlacklist","elementCache","innerHTML","err","TABLE","THEAD","TBODY","TR","SELECT","Triple","Mustache","nodes","matches","queryResult","querySelector","add","queryAllResult","querySelectorAll","j","numNodes","html","insertHtml","decodeCharacterReferences","constructors","ALIAS","Alias","ANCHOR","Component","DOCTYPE","Doctype","INTERPOLATOR","Interpolator","PARTIAL","TRIPLE","Attribute","BINDING_FLAG","BindingFlag","DECORATOR","Decorator","EVENT","EventDirective","TRANSITION","specialElements","doctype","form","Form","input","option","textarea","componentParent","resolvers","dirtyValue","createItems","bind$1","addFragment","item","findContext","ELEMENT","el","findRepeatingFragment","wasBound","wasRendered","callback","resolver","ReferenceResolver","unrenderAndDestroy$1","addFragmentToRoot","processItems","_guid","HookQueue","hook","Hook","inProcess","queue","begin","end","getChildQueue","configHook","initHook","renderHook","completeHook","shouldRerender","completeHook$1","resetHook","renderHook$1","unrenderHook","reverse$1","makeArrayMethod","path","shift$1","sort$1","splice$1","teardownHook$1","unrenderHook$1","Ractive$add","animate","Ractive$animate","attachChild","Ractive$detach","detachChild","Ractive$find","Ractive$findAll","Ractive$findAllComponents","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","Ractive$fire","Ractive$get","insert","Ractive$insert","link$1","merge","thisRactive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","once","Ractive$once","pop","pop$1","push$1","Ractive$render","Ractive$reset","resetPartial","Ractive$resetTemplate","reverse","Ractive$set","sort","subtract","Ractive$subtract","teardown","Ractive$teardown","warnOnce","handler","directive","original","DOMEvent","unlisten","CustomEvent","eventPlugin","listen","RactiveEvent","cancel","specialPattern","dollarArgsPattern","COMPONENT","specialRef","ref","specialMatch","splitKeypathI","substr","dollarMatch","action","e","passedArgs","addHelpers","obj","wrapper","wrapperValue","oldEvent","preventDefault","stopPropagation","fireEvent","handleChange","addShuffleTask","register","teardownHook","ComponentConstructor","isAnchor","p","content","_partials","addChild","removeChild","liveQueries","root","construct","_inlinePartials","leftovers","m","ConditionalAttribute","eventHandlers","initialise","live","_query","removeFromQuery","checking","checkAnchors","render$1","updateLiveQueries$1","makeDirty","_observers","__ractive_instances__","unrenderItem","missingDecorator","noop","intermediary","Binding","twowayBinding","isUnresolved","forceResolution","warnAboutAmbiguity","isReadonly","keypath","getKeypath","isTwoway","wasUndefined","getInitialValue","parentForm","findParentForm","resetValue","formBindings","registerTwowayBinding","lastVal","setting","lastValue","unregisterTwowayBinding","CheckboxBinding","handleDomEvent","attachEvent","checked","BindingGroup","bindings","push$2","CheckboxNameBinding","checkboxName","group","getBindingGroup","noInitialValue","existingValue","bindingValue","arrayContains","changed","wasChecked","isChecked","valueSoFar","ContentEditableBinding","lazy","GenericBinding","timeout","isNumeric","handleDelay","handleBlur","FileBinding","files","MultipleSelectBinding","selectedValues","previousValue","arrayContentsMatch","setValue","initialValue","NumericBinding","isNaN","siblings","RadioBinding","getSiblings","RadioNameBinding","getValue$1","nameAttributeBinding","getKeypathModel","SingleSelectBinding","disabled","endsWithSemi","ContainerItem","toLowerCase","isVoid","voidElementNames","attr","recreateTwowayBinding","createTwowayBinding","shouldBind","twoway","selectBinding","namespace","getNamespace","existing","nodeName","defineProperty","proxy","setAttribute","children","removeAttribute","updateLiveQueries","transitionsEnabled","registerTransition","makeDirty$1","attrs","stringifyAttribute","inputIsCheckedRadio","cls","safeAttributeString","getString","styleName","decamelize","inlineClass","detachWhenReady","handleReset","isStatic","s","resolve$2","proto$1","mustache","ParseError","safeToStringValue","string","data","defaultValue","leadingWhitespace","message","stack","lineStart","lines","lineEnds","line","lineEnd","remaining","getContextMessage","getLinePos","lineNum","columnNum","contextLines","contextUp","contextDown","numTabs","annotation","char","error","msg","character","shortMessage","pattern","nextChar","Parent","hasOwn","pending","sliced","negativeOne","ListObserver","newValue","inserted","deleted","hadIndex","onceOptions","PREFIX","styleDefinitions","isDirty","styleElement","useCssText","getElementsByTagName","styleSheet","adaptConfigurator","adapt","combine","ensureArray","selectorsPattern","commentsPattern","selectorUnitPattern","excludePattern","dataRvcGuidPattern","cssConfigurator","css","id","uuid","noCssTransform","transformCss","cssId","addCSS","dataConfigurator","combine$1","TEMPLATE_VERSION","functions","parseOptions","TEMPLATE_INSTRUCTIONS","COMPUTATION_INSTRUCTIONS","fromId","noThrow","getElementById","textContent","isParsed","getParseOptions","reduce","val","throwNoParse","addFunctions","parseFor","templateConfigurator","parseTemplate","getDynamicTemplate","_config","extendPartials","registryNames","Registry","useDefaults","configure","registry","isOwner","registries","custom","defaultKeys","isStandardKey","makeObj","isBlacklisted","order","config","NUMBER_LITERAL","STRING_LITERAL","REFERENCE","ComputationChild","Model","syncComputedChildren","applyValue","dependencies","mark","shouldCapture","capture","parentValue","links","marked","deps","clearUnresolveds","childByKey","child","Computation","signature","isExpression","setter","computationContext","newWrapperValue","startCapturing","getter","hasConsole","console","groupCollapsed","functionBody","prettify","getterString","getterUseStack","truncateStack","groupEnd","stopCapturing","setDependencies","registerChange","model$1","computations","prototype$1","ExpressionProxy","getFunction","resolveReference","createResolver","actuallyChanged","d","retrieve","dep","computation","ReferenceExpressionChild","isEqual","base","joinAll","ReferenceExpressionProxy","baseResolver","members","keypathModel","oneway","findBoundValue","space","specials","float","textTypes","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","booleanAttributes","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","codePointSupport","fromCodePoint","codeToChar","fromCharCode","lessThan","greaterThan","invalid","namespaces","useProperty","isBoolean","lookupNamespace","getUpdateDelegate","camelize","flag","set$2","div$1","isSvg","svg$1","parseAttributes","notIn","mutatorMethods","patchedArrayProto","methodName","method","getNewIndices","wrappers","processWrapper","configurable","patchArrayMethods","unpatchArrayMethods","__proto__","array","unpatch","patch","errorMessage$1","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","magicAdaptor$1","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","RactiveModel","changes","hasProp$1","RootModel","applyChanges","_changeHash","flush","attached","attachImplicits","compute","createLink","targetPath","detached","detachImplicits","virtual","getVirtual","getRactiveModel","ractiveModel","getValueChildren","_link","has","Function","opts","GlobalModel$1","localKey","origin","local","shouldTeardown","constructHook","registryNames$1","uid","fatal","fontSize","getPixelSize","currentStyle","normalProps","clientWidth","clientHeight","setShortStyleProperty","CSSStyleDeclaration","borderSizes","fontWeight","lineHeight","letterSpacing","getPropertyPriority","getPropertyValue","removeProperty","setProperty","getPropertyCSSValue","exportedShims","div","methodNames","unprefixed","prefixed","makeFunction","mathml","xlink","xml","xmlns","ns","createElementNS","cloneNode","camel","decamel","desc","F","log","printWarning","welcome","alreadyWarned","welcomeIntro","welcomeMessage","WELCOME_MESSAGE","hasGroup","warn","badArguments","noRegistryFunctionReturn","from","intermediate","Math","min","properties","snap","deprecations","deprecated","replacement","deprecate","arg","_Promise","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","handlers","forward","p1result","all","promises","processPromise","reason","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","outrosComplete","list","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","detachImmediate","batch","changeHook","returnPromise","fulfilPromise","previousBatch","transitionManager","fragments","tasks","immediateObservers","deferredObservers","ractives","flushChanges","b","addInstance","addObserver","observer","defer","thing","task","postRender","_batch","refPattern","splitPattern","escapeKeyPattern","unescapeKeyPattern","star","errorMessage","noAnimation","linear","attachHook","detachHook","detachHook$1","Query","isComponentQuery","cancelled","sortByItemPosition","sortByDocumentPosition","captureGroup","starMaps","wildcardCache","KeyModel","isKey","dependant","registerLink","unregisterLink","KeypathModel","isKeypath","getChild","rebindChildren","hasProp","shuffleTasks","early","registerQueue","ModelBase","keyModels","unresolved","unresolvedByKey","patternObservers","addUnresolved","stage","specificKey","hasKey","attemptResolution","findMatches","existingMatches","loop","getKeyModel","skip","child$1","lastLink","notifyUpstream","notify","notifiedUpstream","relinking","registerPatternObserver","removeUnresolved","rewrap","unregisterPatternObserver","updateFromBindings","cascade","missing","shufle","LinkModel","isLink","sourcePath","attach","unwrap","isDetached","relinked","shuffling","upstream","lnk","implicit","fireShuffleTasks","ln","requestAnimationFrame","lastTime","currTime","timeToCall","rAF","getTime","performance","tickers","running","tick","elapsed","eased","stop","abort","prefixers","ticker","createBranch","adaptor","getPrefixer","branch","old","comparator","oldArray","newArray","recreateArray","oldLength","usedIndices","firstUnusedIndex","GlobalModel","global","window","keypathExpr","arrayProto","comparators","updateHook","modelPush","modelPop","modelShift","modelUnshift","modelSort","modelSplice","modelReverse","insertHook","reference","normalise","contexts","resolveAmbiguousReference","Observer","dispatch","oldValue","strict","PatternObserver","baseModel","baseKeypath","oldValues","newValues","partial","newKeys","wildcards","touchedFrom","count","ok","tabs","minIndent","prev","Infinity","truncated","orComponent","hyphenatedStr","readStyle","rule","rules","readClass","updateId","updateMultipleSelectValue","updateSelectValue","updateStringValue","updateContentEditableValue","updateRadioValue","updateValue","updateRadioName","updateCheckboxName","updateStyleAttribute","updateInlineStyle","updateClassName","updateInlineClass","type$1","updateBoolean","updateNamespacedAttribute","updateAttribute","wasSelected","selectedIndex","valueAttribute","className","removeAttributeNS","setAttributeNS","entity","code","parseInt","validateCode","qualified","hasAttribute","haystack","needle","enumerable","mdl","mdl$1","getComputationSignature","setterString","createFunctionFromString","initialiseProperties","getAdaptors","computed","combine$2","arrays","res","protoAdapt","lookup","builtins","srcs","isolated","modifyArrays","_subs","_eventQueue","_liveQueries","_liveComponentQueries","_children","byName","meta","nameOption","renderItem","nextNode","contains","lastBound","q","updateAnchors","description","bindName","bindChecked","typeAttribute","nameAttribute","updateModel$1","okQuote","literal","done","charCodeAt","JSON","readNumberLiteral","readKey","token","childData","getPartialFromRegistry","fillGaps","findParentPartial","findInstance","findOwner","findConstructor","_Parent","hasIndexRef","selectedOption","firstChild","getComponentConstructor","ElementConstructor","guid","counter","placeholderId","newModel","hookQueue","childQueue","userOptions","createFragment","getElement","append","logIfDebug","noIntro","applyCSS","torndown","others","rerender","collect","dest","collection","external","build","TypeError","gather","uniqueCssIds","ids","HTMLElement","here","wrap$1","superMethod","force","needsSuper","hasSuper","_super","addRegistries","addOtherOptions","addRegistry","_method","extendOne","delimiters","tripleDelimiters","staticDelimiters","staticTripleDelimiters","csp","preserveWhitespace","sanitize","stripComments","easeIn","pow","easeOut","easeInOut","document","navigator","appName","implementation","hasFeature","Temp","freeze","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","mapper","isActuallyString","mapped","opt_initialValue","valueIsSet","filtered","every","iterator","Empty","ctx","Event","head","origCreateElement","appearsToBeIELessEqual8","currentTarget","srcElement","timeStamp","returnValue","cancelBubble","listener","listeners","detachEvent","sizeWithSuffix","size","getBorderPixelSize","parentElement","rootSize","bcr","display","position","width","height","borderRight","getBoundingClientRect","right","left","borderSuffix","factory","exports","module","define","amd","noConflict","output","sources","isFinite","format","registryName","interpol","lastItem","member","arrayLike","called","resolvePromise","rejectPromise","y","tm","notifiedTotal","manager","trans","collectAllOutros","which","ractive$1","pairs","sets","getOptions","protoAnimate","queries","remotes","remote","query$1","findAnchors","findAnchorsIn","anchors","idxs","unrenderChild","_anchors","prepend","insertAt","cmp","isParent","otherNode","compareDocumentPosition","bitmask","baseA","baseB","mutualAncestor","ancestryA","getAncestry","ancestryB","oldestA","oldestB","fragmentA","fragmentB","indexA","indexB","indexA$1","indexB$1","getParent","ancestry","ancestor","enqueue","dequeue","getPotentialWildcardMatches","starMap","wildcardKeypath","getStarMap","num","binary","ones","digit","_noArg","eventNames","getWildcardNames","fireEventAs","initialFire","subscribers","notifySubscribers","fullName","originalEvent","stopEvent","badReference","hasContextChain","crossedComponentBoundary","localViewmodel","parts","prefixKeypath","rootKeypath","rootDot","relativeKeypath","match$1","repeater","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","result$1","promise$1","getComparator","stringify","merge$1","compare","update$2","build$1","findModel","_element","resolve$1","add$1","there","set$1","drop","update$1","isBound","getBindingModel","getBindingPath","getBinding","setBinding","fireInsertHook","observers","keypaths","createObserver","wildcardIndex","notEmptyString","styleDefinition","cssText","filteredStyleDefinitions","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","s4","floor","random","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fromExpression","body","fromComputationString","bindTo","hasThis","createFunction","exp","instructions","initial","parseAsString","validate$1","existingPartials","newPartials","overwrite","getSuperMethod","_parent","oldSuper","getMessage","correct","isError","deprecateOption","deprecatedOption","extendOtherMethods","fnBody"],"mappings":"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AKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,SAAU,IAA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"}