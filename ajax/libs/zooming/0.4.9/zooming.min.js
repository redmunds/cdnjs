/**
 * zooming - Image zoom with pure JavaScript.
 * @version v0.4.9
 * @link https://github.com/kingdido999/zooming
 * @license MIT
 */

+function(){function e(e,n,o){t(n);var i=e.style,r={};for(var a in n)o&&(r[a]=i[a]||""),i[a]=n[a];return r}function n(){var e={},n=["webkitTransition","transition","mozTransition"],t=["webkitTransform","transform","mozTransform"],o={transition:"transitionend",mozTransition:"transitionend",webkitTransition:"webkitTransitionEnd"};return n.some(function(n){if(void 0!==x.style[n])return e.transition=n,e.transEnd=o[n],!0}),t.some(function(n){if(void 0!==x.style[n])return e.transform=n,!0}),e}function t(e){var n;e.transition&&(n=e.transition,delete e.transition,e[O]=n),e.transform&&(n=e.transform,delete e.transform,e[R]=n)}function o(){var e=y.width/2,n=y.height/2,t={x:y.left+e,y:y.top+n},o={x:window.innerWidth/2,y:window.innerHeight/2},i={x:o.x-e,y:o.y-n},r=i.x/e,a=i.y/n;p={x:o.x-t.x,y:o.y-t.y},g=A.scaleBase+Math.min(r,a);var s="translate3d("+p.x+"px,"+p.y+"px, 0) scale("+g+")";return s}function i(){var e=window.pageYOffset||(document.documentElement||w.parentNode||w).scrollTop;null===z&&(z=e);var n=z-e;Math.abs(n)>=A.scrollThreshold&&(z=null,I.close())}function r(e){var n=e.key||e.code;"Escape"!==n&&27!==e.keyCode||I.close()}function a(e){e.preventDefault(),E=setTimeout(function(){k=!0,I.grab(e.clientX,e.clientY,!0)},G)}function s(e){k&&I.grab(e.clientX,e.clientY)}function l(){clearTimeout(E),k=!1,I.release()}function u(e){e.preventDefault(),E=setTimeout(function(){k=!0;var n=e.touches[0];I.grab(n.clientX,n.clientY,!0)},G)}function c(e){if(k){var n=e.touches[0];I.grab(n.clientX,n.clientY)}}function d(){clearTimeout(E),k=!1,C?I.release():I.close()}var f,m,v,b,p,g,h,y,E,L="WebkitAppearance"in document.documentElement.style?"-webkit-":"",w=document.body,x=document.createElement("div"),T=!1,B=!1,k=!1,C=!1,G=200,z=null,A={defaultZoomable:'img[data-action="zoom"]',enableGrab:!0,transitionDuration:".4s",transitionTimingFunction:"cubic-bezier(.4,0,0,1)",bgColor:"#fff",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,onOpen:null,onClose:null,onGrab:null,onRelease:null,onBeforeOpen:null,onBeforeClose:null,onBeforeGrab:null,onBeforeRelease:null},D=n(),O=D.transition,R=D.transform,F=R.replace(/(.*)Transform/,"-$1-transform"),Y=D.transEnd,I={config:function(n){if(!n)return A;for(var t in n)A[t]=n[t];return e(x,{backgroundColor:A.bgColor,transition:"opacity "+A.transitionDuration+" "+A.transitionTimingFunction}),this},open:function(n,t){if(!(T||B||C)&&(f="string"==typeof n?document.querySelector(n):n,"IMG"===f.tagName)){A.onBeforeOpen&&A.onBeforeOpen(f),T=!0,B=!0,m=f.parentNode;var p=new Image;return p.onload=function(){y=f.getBoundingClientRect(),f.hasAttribute("data-original")&&(h=f.getAttribute("src"),e(f,{width:y.width+"px",height:y.height+"px"}),f.setAttribute("src",f.getAttribute("data-original"))),f.offsetWidth,b={position:"relative",zIndex:999,cursor:L+(A.enableGrab?"grab":"zoom-out"),transition:F+" "+A.transitionDuration+" "+A.transitionTimingFunction,transform:o()},v=e(f,b,!0)},p.src=f.getAttribute("src"),m.appendChild(x),setTimeout(function(){x.style.opacity=A.bgOpacity},30),document.addEventListener("scroll",i),document.addEventListener("keydown",r),f.addEventListener(Y,function e(){f.removeEventListener(Y,e),A.enableGrab&&(f.addEventListener("mousedown",a),f.addEventListener("mousemove",s),f.addEventListener("mouseup",l),f.addEventListener("touchstart",u),f.addEventListener("touchmove",c),f.addEventListener("touchend",d)),B=!1,t=t||A.onOpen,t&&t(f)}),this}},close:function(n){if(T&&!B&&!C)return B=!0,A.onBeforeClose&&A.onBeforeClose(f),x.style.opacity=0,f.style.transform="",document.removeEventListener("scroll",i),document.removeEventListener("keydown",r),f.addEventListener(Y,function t(){f.removeEventListener(Y,t),A.enableGrab&&(f.removeEventListener("mousedown",a),f.removeEventListener("mousemove",s),f.removeEventListener("mouseup",l),f.removeEventListener("touchstart",u),f.removeEventListener("touchmove",c),f.removeEventListener("touchend",d)),e(f,v),m.removeChild(x),T=!1,B=!1,C=!1,f.hasAttribute("data-original")&&f.setAttribute("src",h),n="function"==typeof n?n:A.onClose,n&&n(f)}),this},grab:function(n,t,o,i){if(T&&!B){C=!0,A.onBeforeGrab&&A.onBeforeGrab(f);var r=n-window.innerWidth/2,a=t-window.innerHeight/2,s=f.style.transform,l=s.replace(/translate3d\(.*?\)/i,"translate3d("+(p.x+r)+"px,"+(p.y+a)+"px, 0)").replace(/scale\([0-9|\.]*\)/i,"scale("+(g+A.scaleExtra)+")");e(f,{cursor:L+"grabbing",transition:F+" "+(o?A.transitionDuration+" "+A.transitionTimingFunction:"ease"),transform:l}),f.addEventListener(Y,function e(){f.removeEventListener(Y,e),i=i||A.onGrab,i&&i(f)})}},release:function(n){if(T&&!B&&C)return A.onBeforeRelease&&A.onBeforeRelease(f),e(f,b),f.addEventListener(Y,function e(){f.removeEventListener(Y,e),C=!1,n="function"==typeof n?n:A.onRelease,n&&n(f)}),this},listen:function(e){if("string"==typeof e){for(var n=document.querySelectorAll(e),t=n.length;t--;)this.listen(n[t]);return this}return e.style.cursor=L+"zoom-in",e.addEventListener("click",function(n){n.preventDefault(),T?I.close():I.open(e)}),this}};e(x,{zIndex:998,background:A.bgColor,position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity "+A.transitionDuration+" "+A.transitionTimingFunction}),x.addEventListener("click",I.close),document.addEventListener("DOMContentLoaded",I.listen(A.defaultZoomable)),"object"==typeof exports?module.exports=I:"function"==typeof define&&define.amd?define(function(){return I}):this.Zooming=I}();