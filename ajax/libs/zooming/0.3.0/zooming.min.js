/**
 * zooming - Image zoom with pure JavaScript.
 * @version v0.3.0
 * @link https://github.com/kingdido999/zooming
 * @license MIT
 */

+function(){function t(t,n,o){e(n);var i=t.style,r={};for(var a in n)o&&(r[a]=i[a]||""),i[a]=n[a];return r}function n(){var t={},n=["webkitTransition","transition","mozTransition"],e=["webkitTransform","transform","mozTransform"],o={transition:"transitionend",mozTransition:"transitionend",webkitTransition:"webkitTransitionEnd"};return n.some(function(n){if(void 0!==f.style[n])return t.transition=n,t.transEnd=o[n],!0}),e.some(function(n){if(void 0!==f.style[n])return t.transform=n,!0}),t}function e(t){var n;t.transition&&(n=t.transition,delete t.transition,t[y]=n),t.transform&&(n=t.transform,delete t.transform,t[v]=n)}function o(t){var n={x:window.innerWidth/2,y:window.innerHeight/2},e=t.width/2,o=t.height/2,i={x:t.left+e,y:t.top+o},r={x:n.x-i.x,y:n.y-i.y},a={x:n.x-e,y:n.y-o},s=a.x/e,c=a.y/o,l=g.scaleBase+Math.min(s,c);return"translate("+r.x+"px,"+r.y+"px) scale("+l+","+l+")"}function i(){var t=window.pageYOffset||(document.documentElement||u.parentNode||u).scrollTop;null===p&&(p=t);var n=p-t;Math.abs(n)>=g.scrollThreshold&&(p=null,w.close())}var r,a,s,c,l="WebkitAppearance"in document.documentElement.style?"-webkit-":"",u=document.body,f=document.createElement("div"),d=!1,m=!1,p=null,g={transitionDuration:".4s",transitionTimingFunction:"cubic-bezier(.4,0,0,1)",bgColor:"#fff",bgOpacity:1,scaleBase:1,scrollThreshold:40,onOpen:null,onClose:null,onBeforeClose:null,onBeforeOpen:null},h=n(),y=h.transition,v=h.transform,b=v.replace(/(.*)Transform/,"-$1-transform"),x=h.transEnd;t(f,{zIndex:998,background:g.bgColor,position:"fixed",top:0,left:0,right:0,bottom:0,filter:"alpha(opacity=0)",opacity:0,transition:"opacity "+g.transitionDuration});var w={config:function(n){if(!n)return g;for(var e in n)g[e]=n[e];return t(f,{backgroundColor:g.bgColor,transition:"opacity "+g.transitionDuration+" "+g.transitionTimingFunction}),this},open:function(n,e){if(!d&&!m&&(r="string"==typeof n?document.querySelector(n):n,"IMG"===r.tagName)){g.onBeforeOpen&&g.onBeforeOpen(r),d=!0,m=!0,a=r.parentNode;var u=new Image;return u.onload=function(){var n=r.getBoundingClientRect();r.hasAttribute("data-original")&&(c=r.getAttribute("src"),t(r,{width:n.width+"px",height:n.height+"px"}),r.setAttribute("src",r.getAttribute("data-original"))),r.offsetWidth,s=t(r,{position:"relative",zIndex:999,cursor:l+"zoom-out",transition:b+" "+g.transitionDuration+" "+g.transitionTimingFunction,transform:o(n)},!0)},u.src=r.getAttribute("src"),a.appendChild(f),window.setTimeout(function(){t(f,{filter:"alpha(opacity=100)",opacity:g.bgOpacity})},30),document.addEventListener("scroll",i),r.addEventListener(x,function t(){r.removeEventListener(x,t),m=!1,e=e||g.onOpen,e&&e(r)}),this}},close:function(n){if(d&&!m)return m=!0,g.onBeforeClose&&g.onBeforeClose(r),t(f,{filter:"alpha(opacity=0)",opacity:0}),t(r,{transform:""}),document.removeEventListener("scroll",i),r.addEventListener(x,function e(){r.removeEventListener(x,e),t(r,s),a.removeChild(f),d=!1,m=!1,r.hasAttribute("data-original")&&r.setAttribute("src",c),n="function"==typeof n?n:g.onClose,n&&n(r)}),this},listen:function n(e){if("string"!=typeof e)return t(e,{cursor:l+"zoom-in"}),e.addEventListener("click",function(t){t.stopPropagation(),d?w.close():w.open(e)}),this;for(var o=document.querySelectorAll(e),i=o.length;i--;)n(o[i])}};f.addEventListener("click",w.close),document.addEventListener("DOMContentLoaded",w.listen('img[data-action="zoom"]')),"object"==typeof exports?module.exports=w:"function"==typeof define&&define.amd?define(function(){return w}):this.Zooming=w}();