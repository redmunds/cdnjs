/**
 * zooming - Image zoom with pure JavaScript.
 * @version v0.4.2
 * @link https://github.com/kingdido999/zooming
 * @license MIT
 */

+function(){function e(e,n,o){t(n);var i=e.style,r={};for(var s in n)o&&(r[s]=i[s]||""),i[s]=n[s];return r}function n(){var e={},n=["webkitTransition","transition","mozTransition"],t=["webkitTransform","transform","mozTransform"],o={transition:"transitionend",mozTransition:"transitionend",webkitTransition:"webkitTransitionEnd"};return n.some(function(n){if(void 0!==x.style[n])return e.transition=n,e.transEnd=o[n],!0}),t.some(function(n){if(void 0!==x.style[n])return e.transform=n,!0}),e}function t(e){var n;e.transition&&(n=e.transition,delete e.transition,e[D]=n),e.transform&&(n=e.transform,delete e.transform,e[G]=n)}function o(){var e=y.width/2,n=y.height/2,t={x:y.left+e,y:y.top+n},o={x:window.innerWidth/2,y:window.innerHeight/2},i={x:o.x-e,y:o.y-n},r=i.x/e,s=i.y/n;h={x:o.x-t.x,y:o.y-t.y},g=O.scaleBase+Math.min(r,s);var a="translate("+h.x+"px,"+h.y+"px) scale("+g+")";return a}function i(){var e=window.pageYOffset||(document.documentElement||w.parentNode||w).scrollTop;null===A&&(A=e);var n=A-e;Math.abs(n)>=O.scrollThreshold&&(A=null,F.close())}function r(e){var n=e.key||e.code;"Escape"!==n&&27!==e.keyCode||F.close()}function s(e){e.preventDefault(),E=setTimeout(function(){k=!0,F.grab(e.clientX,e.clientY)},200)}function a(e){k&&F.grab(e.clientX,e.clientY)}function c(){clearTimeout(E),k=!1,F.release()}function u(e){e.preventDefault(),E=setTimeout(function(){k=!0;var n=e.touches[0];F.grab(n.clientX,n.clientY)},200)}function l(e){if(k){var n=e.touches[0];F.grab(n.clientX,n.clientY)}}function d(){clearTimeout(E),k=!1,F.release(),F.close()}var f,m,v,p,g,h,b,y,E,L="WebkitAppearance"in document.documentElement.style?"-webkit-":"",w=document.body,x=document.createElement("div"),T=!1,B=!1,k=!1,C=!1,A=null,O={transitionDuration:".4s",transitionTimingFunction:"cubic-bezier(.4,0,0,1)",bgColor:"#fff",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,onOpen:null,onClose:null,onGrab:null,onRelease:null,onBeforeOpen:null,onBeforeClose:null,onBeforeGrab:null,onBeforeRelease:null},z=n(),D=z.transition,G=z.transform,R=G.replace(/(.*)Transform/,"-$1-transform"),Y=z.transEnd,F={config:function(n){if(!n)return O;for(var t in n)O[t]=n[t];return e(x,{backgroundColor:O.bgColor,transition:"opacity "+O.transitionDuration+" "+O.transitionTimingFunction}),this},open:function(n,t){if(!(T||B||C)&&(f="string"==typeof n?document.querySelector(n):n,"IMG"===f.tagName)){O.onBeforeOpen&&O.onBeforeOpen(f),T=!0,B=!0,m=f.parentNode;var g=new Image;return g.onload=function(){y=f.getBoundingClientRect(),f.hasAttribute("data-original")&&(b=f.getAttribute("src"),e(f,{width:y.width+"px",height:y.height+"px"}),f.setAttribute("src",f.getAttribute("data-original"))),f.offsetWidth,p={position:"relative",zIndex:999,cursor:L+"grab",transition:R+" "+O.transitionDuration+" "+O.transitionTimingFunction,transform:o()},v=e(f,p,!0)},g.src=f.getAttribute("src"),m.appendChild(x),setTimeout(function(){x.style.opacity=O.bgOpacity},30),document.addEventListener("scroll",i),document.addEventListener("keydown",r),f.addEventListener(Y,function e(){f.removeEventListener(Y,e),f.addEventListener("mousedown",s),f.addEventListener("mousemove",a),f.addEventListener("mouseup",c),f.addEventListener("touchstart",u),f.addEventListener("touchmove",l),f.addEventListener("touchend",d),B=!1,t=t||O.onOpen,t&&t(f)}),this}},close:function(n){if(T&&!B&&!C)return B=!0,O.onBeforeClose&&O.onBeforeClose(f),x.style.opacity=0,f.style.transform="",document.removeEventListener("scroll",i),document.removeEventListener("keydown",r),f.addEventListener(Y,function t(){f.removeEventListener(Y,t),f.removeEventListener("mousedown",s),f.removeEventListener("mousemove",a),f.removeEventListener("mouseup",c),f.removeEventListener("touchstart",u),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",d),e(f,v),m.removeChild(x),T=!1,B=!1,C=!1,f.hasAttribute("data-original")&&f.setAttribute("src",b),n="function"==typeof n?n:O.onClose,n&&n(f)}),this},grab:function(n,t,o){if(T&&!B){C=!0,O.onBeforeGrab&&O.onBeforeGrab(f);var i=n-window.innerWidth/2,r=t-window.innerHeight/2,s=f.style.transform,a=s.replace(/translate\(.*?\)/i,"translate("+(h.x+i)+"px,"+(h.y+r)+"px) ").replace(/scale\([0-9|\.]*\)/i,"scale("+(g+O.scaleExtra)+")");e(f,{cursor:L+"grabbing",transition:R+" .1s",transform:a}),f.addEventListener(Y,function e(){f.removeEventListener(Y,e),o=o||O.onGrab,o&&o(f)})}},release:function(n){if(T&&!B&&C)return O.onBeforeRelease&&O.onBeforeRelease(f),e(f,p),f.addEventListener(Y,function e(){f.removeEventListener(Y,e),C=!1,n="function"==typeof n?n:O.onRelease,n&&n(f)}),this},listen:function(e){if("string"==typeof e){for(var n=document.querySelectorAll(e),t=n.length;t--;)this.listen(n[t]);return this}return e.style.cursor=L+"zoom-in",e.addEventListener("click",function(n){n.preventDefault(),T?F.close():F.open(e)}),this}};e(x,{zIndex:998,background:O.bgColor,position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity "+O.transitionDuration+" "+O.transitionTimingFunction}),x.addEventListener("click",F.close),document.addEventListener("DOMContentLoaded",F.listen('img[data-action="zoom"]')),"object"==typeof exports?module.exports=F:"function"==typeof define&&define.amd?define(function(){return F}):this.Zooming=F}();