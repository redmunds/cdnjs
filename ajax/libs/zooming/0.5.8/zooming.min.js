!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Zooming=n()}(this,function(){"use strict";function e(e,n,t){return M(e,n,t)}function n(){Y=x.getBoundingClientRect(),x.hasAttribute("data-original")&&(R=x.getAttribute("src"),e(x,{width:Y.width+"px",height:Y.height+"px"}),x.setAttribute("src",x.getAttribute("data-original"))),x.offsetWidth,D={position:"relative",zIndex:999,cursor:""+m+(b.enableGrab?"grab":"zoom-out"),transition:X+"\n      "+b.transitionDuration+"\n      "+b.transitionTimingFunction,transform:t()},A=e(x,D,!0)}function t(){var e=Y.width/2,n=Y.height/2,t={x:Y.left+e,y:Y.top+n},o={x:window.innerWidth/2,y:window.innerHeight/2},r={x:o.x-e,y:o.y-n},i=r.x/e,a=r.y/n;return O={x:o.x-t.x,y:o.y-t.y},P=b.scaleBase+Math.min(i,a),"translate("+O.x+"px, "+O.y+"px) scale("+P+")"}function o(e){e.addEventListener("mousedown",l),e.addEventListener("mousemove",u),e.addEventListener("mouseup",c),e.addEventListener("touchstart",d),e.addEventListener("touchmove",f),e.addEventListener("touchend",v)}function r(e){e.removeEventListener("mousedown",l),e.removeEventListener("mousemove",u),e.removeEventListener("mouseup",c),e.removeEventListener("touchstart",d),e.removeEventListener("touchmove",f),e.removeEventListener("touchend",v)}function i(e,n){for(var t=e.length,o=e.length,r=0,i=0,a=e[0].clientX,s=e[0].clientY,l=e[0].clientX,u=e[0].clientY;o--;){var c=e[o],d=c.clientX,f=c.clientY;r+=d,i+=f,0!==t&&(d<a?a=d:d>l&&(l=d),f<s?s=f:f>u&&(u=f))}if(t>1){var v=l-a,m=u-s;v>m?b.scaleExtra=v/window.innerWidth*g:b.scaleExtra=m/window.innerHeight*g}n(r/e.length,i/e.length)}function a(){var e=window.pageYOffset||(document.documentElement||L.parentNode||L).scrollTop;null===z&&(z=e);var n=z-e;Math.abs(n)>=b.scrollThreshold&&(z=null,N.close())}function s(e){var n=e.key||e.code;"Escape"!==n&&27!==e.keyCode||N.close()}function l(e){e.preventDefault(),F=setTimeout(function(){k=!0,N.grab(e.clientX,e.clientY,!0)},p)}function u(e){k&&N.grab(e.clientX,e.clientY)}function c(){clearTimeout(F),k=!1,N.release()}function d(e){e.preventDefault(),F=setTimeout(function(){k=!0,i(e.touches,function(e,n){return N.grab(e,n,!0)})},p)}function f(e){k&&i(e.touches,function(e,n){return N.grab(e,n)})}function v(e){0===e.targetTouches.length&&(clearTimeout(F),k=!1,b.scaleExtra=H,G?N.release():N.close())}var m="WebkitAppearance"in document.documentElement.style?"-webkit-":"",p=200,g=2,b={defaultZoomable:'img[data-action="zoom"]',enableGrab:!0,transitionDuration:".4s",transitionTimingFunction:"cubic-bezier(.4,0,0,1)",bgColor:"#fff",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,onOpen:null,onClose:null,onGrab:null,onRelease:null,onBeforeOpen:null,onBeforeClose:null,onBeforeGrab:null,onBeforeRelease:null},h=function(e){var n={},t=["webkitTransition","transition","mozTransition"],o=["webkitTransform","transform","mozTransform"],r={transition:"transitionend",mozTransition:"transitionend",webkitTransition:"webkitTransitionEnd"};return t.some(function(t){if(void 0!==e.style[t])return n.transitionProp=t,n.transEndEvent=r[t],!0}),o.some(function(t){if(void 0!==e.style[t])return n.transformProp=t,n.transformCssProp=t.replace(/(.*)Transform/,"-$1-transform"),!0}),n},E=function(e,n){return function(t,o,r){var i=void 0;o.transition&&(i=o.transition,delete o.transition,o[e]=i),o.transform&&(i=o.transform,delete o.transform,o[n]=i);var a=t.style,s={};for(var l in o)r&&(s[l]=a[l]||""),a[l]=o[l];return s}},y=void 0,L=document.body,w=document.createElement("div"),x=void 0,T=void 0,C=!1,B=!1,k=!1,G=!1,z=null,A=void 0,D=void 0,O=void 0,P=void 0,R=void 0,Y=void 0,F=void 0,W=h(w),X=W.transformCssProp,I=W.transEndEvent,M=E(W.transitionProp,W.transformProp),H=b.scaleExtra,N={listen:function(e){if("string"==typeof e){for(var n=document.querySelectorAll(e),t=n.length;t--;)N.listen(n[t]);return y}return e.style.cursor=m+"zoom-in",e.addEventListener("click",function(n){n.preventDefault(),C?N.close():N.open(e)}),y},config:function(n){if(!n)return b;for(var t in n)b[t]=n[t];return e(w,{backgroundColor:b.bgColor,transition:"opacity\n        "+b.transitionDuration+"\n        "+b.transitionTimingFunction}),y},open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.onOpen;if(!(C||B||G)&&(x="string"==typeof e?document.querySelector(e):e,"IMG"===x.tagName)){b.onBeforeOpen&&b.onBeforeOpen(x),C=!0,B=!0,T=x.parentNode;var r=new Image;return r.onload=n(),r.src=x.getAttribute("src"),T.appendChild(w),setTimeout(function(){return w.style.opacity=b.bgOpacity},30),document.addEventListener("scroll",a),document.addEventListener("keydown",s),x.addEventListener(I,function e(){x.removeEventListener(I,e),b.enableGrab&&o(x),B=!1,t&&t(x)}),y}},close:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.onClose;if(C&&!B&&!G)return B=!0,b.onBeforeClose&&b.onBeforeClose(x),w.style.opacity=0,x.style.transform="",document.removeEventListener("scroll",a),document.removeEventListener("keydown",s),x.addEventListener(I,function t(){x.removeEventListener(I,t),b.enableGrab&&r(x),C=!1,B=!1,G=!1,e(x,A),T.removeChild(w),x.hasAttribute("data-original")&&x.setAttribute("src",R),n&&n(x)}),y},grab:function(n,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b.onGrab;if(C&&!B){G=!0,b.onBeforeGrab&&b.onBeforeGrab(x);var i=window.innerWidth/2-n,a=window.innerHeight/2-t,s=x.style.transform.replace(/translate\(.*?\)/i,"translate("+(O.x+i)+"px, "+(O.y+a)+"px)").replace(/scale\([0-9|\.]*\)/i,"scale("+(P+b.scaleExtra)+")");e(x,{cursor:"move",transition:X+" "+(o?b.transitionDuration+" "+b.transitionTimingFunction:"ease"),transform:s}),x.addEventListener(I,function e(){x.removeEventListener(I,e),r&&r(x)})}},release:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.onRelease;if(C&&!B&&G)return b.onBeforeRelease&&b.onBeforeRelease(x),e(x,D),x.addEventListener(I,function e(){x.removeEventListener(I,e),G=!1,n&&n(x)}),y}};return e(w,{zIndex:998,background:b.bgColor,position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0,transition:"opacity\n    "+b.transitionDuration+"\n    "+b.transitionTimingFunction}),w.addEventListener("click",N.close),document.addEventListener("DOMContentLoaded",N.listen(b.defaultZoomable)),N});