/**
 * zooming - Image zooming with pure JavaScript.
 * @version v0.1.0
 * @link https://github.com/kingdido999/zooming
 * @license MIT
 */

+function(){"use strict";function t(){this._scaleBase=1,this._target=null,this._body=document.body,this._lastScrollPosition=null,this._scrollThreshold=40,this._handleClick=this._handleClick.bind(this),this._handleKeyDown=this._handleKeyDown.bind(this),this._handleScroll=this._handleScroll.bind(this)}function i(t){this._scaleBase=1,this._image=t,this._src=t.getAttribute("src"),this._dataOriginal=t.getAttribute("data-original"),this._overlay=null,this._styles={width:"",height:"",transform:""},this._body=document.body,this._handleTransitionEnd=this._handleTransitionEnd.bind(this),this._zoomOriginal=this._zoomOriginal.bind(this)}function s(t,i){for(var s in i)t.style[s]=i[s]}t.prototype={init:function(){this._body.addEventListener("click",this._handleClick)},_zoom:function(t){this._target||(this._target=new i(t),this._target.zoomIn(),document.addEventListener("keydown",this._handleKeyDown),document.addEventListener("scroll",this._handleScroll))},_close:function(){this._target&&(this._target.zoomOut(),this._target=null,document.removeEventListener("keydown",this._handleKeyDown),document.removeEventListener("scroll",this._handleScroll))},_handleClick:function(t){var i=t.target;if(i&&("IMG"!==i.tagName&&this._close(),i.hasAttribute("data-action")))switch(i.getAttribute("data-action")){case"zoom":this._zoom(i);break;case"close":this._close()}},_handleKeyDown:function(t){27===t.keyCode&&this._close()},_handleScroll:function(){var t=window.pageYOffset||(document.documentElement||this._body.parentNode||this._body).scrollTop;null===this._lastScrollPosition&&(this._lastScrollPosition=t);var i=this._lastScrollPosition-t;Math.abs(i)>=this._scrollThreshold&&(this._lastScrollPosition=null,this._close())}},i.prototype={zoomIn:function(){var t=new Image;t.onload=function(){if(this._dataOriginal){this._styles.width=this._image.style.width,this._styles.height=this._image.style.height;var t=this._image.getBoundingClientRect();s(this._image,{width:t.width+"px",height:t.height+"px"}),this._image.setAttribute("src",this._dataOriginal)}this._calculateZoom(),this._zoomOriginal()}.bind(this),t.src=this._src},_calculateZoom:function(){var t=this._image.getBoundingClientRect(),i={x:window.innerWidth/2,y:window.innerHeight/2},s=t.width/2,e=t.height/2,n={x:t.left+s,y:t.top+e},o={x:i.x-n.x,y:i.y-n.y},a={x:i.x-s,y:i.y-e},h=a.x/s,l=a.y/e,r=this._scaleBase+Math.min(h,l);this._styles.transform="translate("+o.x+"px,"+o.y+"px) scale("+r+","+r+")"},_zoomOriginal:function(){this._image.offsetWidth,this._image.classList.add("image-zoom-img"),this._image.addEventListener("transitionend",this._handleTransitionEnd),this._overlay=document.createElement("div"),this._overlay.classList.add("image-zoom-overlay"),this._body.appendChild(this._overlay),window.setTimeout(function(){s(this._overlay,{filter:"alpha(opacity=100)",opacity:1})}.bind(this),30),this._transform()},zoomOut:function(){this._image.addEventListener("transitionend",this._handleTransitionEnd),s(this._overlay,{filter:"alpha(opacity=0)",opacity:0}),this._styles.transform="",this._transform()},_transform:function(){s(this._image,{"-webkit-transform":this._styles.transform,"-ms-transform":this._styles.transform,transform:this._styles.transform})},_handleTransitionEnd:function(t){switch(this._image.getAttribute("data-action")){case"close":this._dataOriginal&&(s(this._image,{width:this._styles.width,height:this._styles.height}),this._image.setAttribute("src",this._src)),this._body.removeChild(this._overlay),this._image.classList.remove("image-zoom-img"),this._image.setAttribute("data-action","zoom");break;case"zoom":this._image.setAttribute("data-action","close")}this._image.removeEventListener("transitionend",this._handleTransitionEnd)}},document.addEventListener("DOMContentLoaded",function(){(new t).init()})}();