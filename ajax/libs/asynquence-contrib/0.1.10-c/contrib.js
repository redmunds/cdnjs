/*! asynquence-contrib
    v0.1.10-c (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(n,e){"undefined"!=typeof module&&module.exports?module.exports=e(require(n)):"function"==typeof define&&define.amd?define([n],e):e(n)}(this.ASQ||"asynquence",function(n){"use strict";var e=Array.prototype.slice,t=Object.create(null);return n.extend("all",function(n){return n.gate}),n.extend("any",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments);return r.then(function(r){function a(){var n;o===u.length&&(n=[],l?(u.forEach(function(e,t){n.push(c["s"+t])}),r.apply(t,n)):(u.forEach(function(e,t){n.push(s["s"+t])}),r.fail.apply(t,n)))}var l=!1,o=0,c={},s={},i=n.apply(t,e.call(arguments,1));u=u.map(function(u,i){return function(p){var f=e.call(arguments);f[0]=function(){l=!0,o++,c["s"+i]=arguments.length>1?n.messages.apply(t,arguments):arguments[0],a()},f[0].fail=function(){o++,s["s"+i]=arguments.length>1?n.messages.apply(t,arguments):arguments[0],a()},f[0].abort=function(){l||(p.abort(),r.abort())},u.apply(t,f)}}),i.gate.apply(t,u)}),r}}),n.extend("errfcb",function(n){return function(){var r={then:function(n){return r.then_cb=n,r},or:function(n){return r.or_cb=n,r},__ASQ__:!0,next:!0};return n.seq(r),function(n){n?r.or_cb(n):r.then_cb.apply(t,e.call(arguments,1))}}}),n.extend("first",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments);return r.then(function(r){var a=0,l={},o=!1,c=n.apply(t,e.call(arguments,1));u=u.map(function(s,i){return function(p){var f=e.call(arguments);f[0]=function(){o||(o=!0,a++,r(arguments.length>1?n.messages.apply(t,arguments):arguments[0]),c.abort())},f[0].fail=function(){var e=[];a++,l["s"+i]=arguments.length>1?n.messages.apply(t,arguments):arguments[0],o||a!==u.length||(u.forEach(function(n,t){e.push(l["s"+t])}),r.fail.apply(t,e))},f[0].abort=function(){o||(p.abort(),r.abort())},s.apply(t,f)}}),c.gate.apply(t,u)}),r}}),function(){var e;n.iterable=function(){function t(n){return"undefined"!=typeof setImmediate?setImmediate(n):setTimeout(n,0)}function r(){var n;if(g=null,q.length>0)for(;_.length>0;){n=_.shift();try{n.apply(h,q)}catch(e){checkBranding(e)?q=q.concat(e):(q.push(e),e.stack&&q.push(e.stack)),0===_.length&&console.error.apply(console,q)}}}function a(){return v||b||0===arguments.length?f:(d.push.apply(d,arguments),f)}function u(){return b||0===arguments.length?f:(_.push.apply(_,arguments),g||(g=t(r)),f)}function l(){return b||0===arguments.length?f:(m.call(arguments).forEach(function(n){a(n).or(n.fail)}),f)}function o(){if(v||b||0===d.length)return d.length>0&&c("Sequence cannot be iterated"),{done:!0};try{return{value:d.shift().apply(h,arguments)}}catch(e){return n.isMessageWrapper(e)?c.apply(h,e):e.stack?c(e,e.stack):c(e),{}}}function c(){return v||b?f:(q.push.apply(q,arguments),v=!0,g||(g=t(r)),f)}function s(){v||b||(b=!0,clearTimeout(g),g=null,d.length=0,_.length=0,q.length=0)}function i(){var t;return e={val_queue:d.slice(0),or_queue:_.slice(0)},t=n.iterable(),e=null,t}function p(n){return Object.defineProperty(n,y,{enumerable:!1,value:!0}),n}var f,g,m=Array.prototype.slice,y="__ASQ__",h=Object.create(null),v=!1,b=!1,d=[],_=[],q=[];return f=p({val:a,then:a,or:u,pipe:l,next:o,"throw":c,abort:s,duplicate:i}),f["object"==typeof Symbol&&null!=Symbol&&Symbol.iterator||"@@iterator"]=function(){return f},e&&(d=e.val_queue.slice(0),_=e.or_queue.slice(0)),f.val.apply(h,arguments),f}}(),n.extend("last",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments);return r.then(function(r){function a(){var n;o===u.length&&(n=[],l?r(c):(u.forEach(function(e,t){n.push(s["s"+t])}),r.fail.apply(t,n)))}var l=!1,o=0,c={},s={},i=n.apply(t,e.call(arguments,1));u=u.map(function(u,i){return function(p){var f=e.call(arguments);f[0]=function(){l=!0,o++,c=arguments.length>1?n.messages.apply(t,arguments):arguments[0],a()},f[0].fail=function(){o++,s["s"+i]=arguments.length>1?n.messages.apply(t,arguments):arguments[0],a()},f[0].abort=function(){l||(p.abort(),r.abort())},u.apply(t,f)}}),i.gate.apply(t,u)}),r}}),n.extend("map",function(r,a){return function(u,l){return a("seq_error")||a("seq_aborted")?r:(r.seq(function(){var r,a=e.call(arguments);return l||(l=a.shift()),u||(u=a.shift()),"function"==typeof u&&Array.isArray(l)&&(r=u,u=l,l=r),n.apply(t,a).gate.apply(t,u.map(function(n){return function(){l.apply(t,[n].concat(e.call(arguments)))}}))}).val(function(){return e.call(arguments)}),r)}}),n.extend("none",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments);return r.then(function(r){function a(){var n;o===u.length&&(n=[],l?(u.forEach(function(e,t){n.push(c["s"+t])}),r.fail.apply(t,n)):(u.forEach(function(e,t){n.push(s["s"+t])}),r.apply(t,n)))}var l=!1,o=0,c={},s={},i=n.apply(t,e.call(arguments,1));u=u.map(function(u,i){return function(p){var f=e.call(arguments);f[0]=function(){l=!0,o++,c["s"+i]=arguments.length>1?n.messages.apply(t,arguments):arguments[0],a()},f[0].fail=function(){o++,s["s"+i]=arguments.length>1?n.messages.apply(t,arguments):arguments[0],a()},f[0].abort=function(){l||(p.abort(),r.abort())},u.apply(t,f)}}),i.gate.apply(t,u)}),r}}),n.react=function(e){function t(){var n=r.duplicate();return n.unpause.apply(a,arguments),n}var r,a=(Array.prototype.slice,Object.create(null));return n(function(){e(t)}),r=n().duplicate()},n.extend("runner",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments);return r.then(function(r){var a,l,o,c=e.call(arguments,1);u=u.map(function(e){var u=e;return"function"==typeof e&&e.constructor&&"GeneratorFunction"===e.constructor.name?(u=e.apply(t,c),c=[]):n.isSequence(e)&&"next"in e||(a=c.slice(),c=[],u=n.iterable().val(function(){return e.apply(t,a)})),n.isSequence(u)&&u.or(function(){r.fail.apply(t,arguments)}),u}),function s(){l=u.shift();try{o=l.next.apply(l,c)}catch(a){return r.fail(a)}n.isSequence(o.value)||(o.value=null!==o.value&&("object"==typeof o.value||"function"==typeof o.value)&&"then"in o.value?n().promise(o.value):n.apply(t,"undefined"!=typeof o.value?[o.value]:[])),o.value.val(function(){arguments.length>0&&(c=e.call(arguments)),o.done||u.push(l),u.length>0?s():r.apply(t,c)}).or(function(){l.throw.apply(t,arguments)})}()}),r}}),n.extend("try",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments).map(function(r){return function(a){var u=e.call(arguments),l=n.apply(t,u.slice(1));l.then(function(){r.apply(t,arguments)}).val(function(){a.apply(t,arguments)}).or(function(){var e=n.messages.apply(t,arguments);a({"catch":e.length>1?e:e[0]})})}});return r.then.apply(t,u),r}}),n.extend("until",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=e.call(arguments).map(function(r){return function a(u){var l=e.call(arguments),o=n.apply(t,l.slice(1));o.then(function(){var n=e.call(arguments);n[0].break=function(){u.fail.apply(t,arguments),o.abort()},r.apply(t,n)}).val(function(){u.apply(t,arguments)}).or(function(){a.apply(t,l)})}});return r.then.apply(t,u),r}}),n.extend("waterfall",function(r,a){return function(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var u=n.messages();return e.call(arguments).forEach(function(e){r.then(e).val(function(){var e=n.messages.apply(t,arguments);return u.push(e.length>1?e:e[0]),u})}),r}}),{}});
