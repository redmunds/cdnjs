/*! asynquence-contrib
    v0.1.0-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(n,t){"undefined"!=typeof module&&module.exports?module.exports=t(require(n)):"function"==typeof define&&define.amd?define([n],t):t(n)}(this.ASQ||"asynquence",function(n){"use strict";var t=Array.prototype.slice,e=Object.create(null);return n.extend("all",function(n){return n.gate}),n.extend("any",function(a,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return a;var u=t.call(arguments);return a.then(function(a){function r(){var n;s===u.length&&(n=[],l?(u.forEach(function(t,e){n.push(o["s"+e])}),a.apply(e,n)):(u.forEach(function(t,e){n.push(c["s"+e])}),a.fail.apply(e,n)))}var l=!1,s=0,o={},c={},p=n.apply(e,t.call(arguments,1));u=u.map(function(u,p){return function(i){var f=t.call(arguments);f[0]=function(){l=!0,s++,o["s"+p]=arguments.length>1?n.messages.apply(e,arguments):arguments[0],r()},f[0].fail=function(){s++,c["s"+p]=arguments.length>1?n.messages.apply(e,arguments):arguments[0],r()},f[0].abort=function(){l||(i.abort(),a.abort())},u.apply(e,f)}}),p.gate.apply(e,u)}),a}}),n.extend("first",function(a,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return a;var u=t.call(arguments);return a.then(function(a){var r=0,l={},s=!1,o=n.apply(e,t.call(arguments,1));u=u.map(function(c,p){return function(i){var f=t.call(arguments);f[0]=function(){s||(s=!0,r++,a(arguments.length>1?n.messages.apply(e,arguments):arguments[0]),o.abort())},f[0].fail=function(){var t=[];r++,l["s"+p]=arguments.length>1?n.messages.apply(e,arguments):arguments[0],s||r!==u.length||(u.forEach(function(n,e){t.push(l["s"+e])}),a.fail.apply(e,t))},f[0].abort=function(){s||(i.abort(),a.abort())},c.apply(e,f)}}),o.gate.apply(e,u)}),a}}),n.iterable=function(){function t(n){return"undefined"!=typeof setImmediate?setImmediate(n):setTimeout(n,0)}function e(){var n;for(p=null;y.length>0;){n=y.shift();try{n.apply(f,v)}catch(t){checkBranding(t)?v=v.concat(t):(v.push(t),t.stack&&v.push(t.stack)),0===y.length&&console.error.apply(console,v)}}}function a(){return g||m||0===arguments.length?c:(h.push.apply(h,arguments),c)}function r(){return m||0===arguments.length?c:(y.push.apply(y,arguments),c)}function u(){var t={value:void 0,done:!0};if(g||m)return l("Sequence cannot be iterated"),t;if(h.length>0){try{t.value=h.shift().apply(f,arguments)}catch(e){n.isMessageWrapper(e)?l.apply(f,e):e.stack?l(e,e.stack):l(e)}t.done=0===h.length}return t}function l(){return g||m?c:(v.push.apply(v,arguments),g=!0,p||(p=t(e)),c)}function s(){g||m||(m=!0,clearTimeout(p),p=null,h.length=0,y.length=0,v.length=0)}function o(n){return Object.defineProperty(n,i,{enumerable:!1,value:!0}),n}var c,p,i=(Array.prototype.slice,"__ASQ__"),f=Object.create(null),g=!1,m=!1,h=[],y=[],v=[];return c=o({val:a,then:a,or:r,next:u,"throw":l,abort:s}),c.val.apply(f,arguments),c},n.extend("last",function(a,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return a;var u=t.call(arguments);return a.then(function(a){function r(){var n;s===u.length&&(n=[],l?a(o):(u.forEach(function(t,e){n.push(c["s"+e])}),a.fail.apply(e,n)))}var l=!1,s=0,o={},c={},p=n.apply(e,t.call(arguments,1));u=u.map(function(u,p){return function(i){var f=t.call(arguments);f[0]=function(){l=!0,s++,o=arguments.length>1?n.messages.apply(e,arguments):arguments[0],r()},f[0].fail=function(){s++,c["s"+p]=arguments.length>1?n.messages.apply(e,arguments):arguments[0],r()},f[0].abort=function(){l||(i.abort(),a.abort())},u.apply(e,f)}}),p.gate.apply(e,u)}),a}}),n.extend("none",function(a,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return a;var u=t.call(arguments);return a.then(function(a){function r(){var n;s===u.length&&(n=[],l?(u.forEach(function(t,e){n.push(o["s"+e])}),a.fail.apply(e,n)):(u.forEach(function(t,e){n.push(c["s"+e])}),a.apply(e,n)))}var l=!1,s=0,o={},c={},p=n.apply(e,t.call(arguments,1));u=u.map(function(u,p){return function(i){var f=t.call(arguments);f[0]=function(){l=!0,s++,o["s"+p]=arguments.length>1?n.messages.apply(e,arguments):arguments[0],r()},f[0].fail=function(){s++,c["s"+p]=arguments.length>1?n.messages.apply(e,arguments):arguments[0],r()},f[0].abort=function(){l||(i.abort(),a.abort())},u.apply(e,f)}}),p.gate.apply(e,u)}),a}}),n.extend("try",function(a,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return a;var u=t.call(arguments).map(function(a){return function(r){var u=t.call(arguments),l=n.apply(e,u.slice(1));l.then(function(){a.apply(e,arguments)}).val(function(){r.apply(e,arguments)}).or(function(){var t=n.messages.apply(e,arguments);r({"catch":t.length>1?t:t[0]})})}});return a.then.apply(e,u),a}}),n.extend("until",function(a,r){return function(){if(r("seq_error")||r("seq_aborted")||0===arguments.length)return a;var u=t.call(arguments).map(function(a){return function r(u){var l=t.call(arguments),s=n.apply(e,l.slice(1));s.then(function(){var n=t.call(arguments);n[0].break=function(){u.fail.apply(e,arguments),s.abort()},a.apply(e,n)}).val(function(){u.apply(e,arguments)}).or(function(){r.apply(e,l)})}});return a.then.apply(e,u),a}}),{}});
