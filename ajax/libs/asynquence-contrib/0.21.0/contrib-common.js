/*! asynquence-contrib
    v0.21.0 (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function UMD(e,t){"undefined"!=typeof module&&module.exports?(module.exports=function $$inject$dependency(e){if("string"==typeof e)try{e=require(e)}catch(n){return $$inject$dependency}return t(e)},"string"==typeof e&&(module.exports=module.exports(require("path").join("..",e)))):"function"==typeof define&&define.amd?define([e],t):t(e)}(this.ASQ||"asynquence",function DEF(e){"use strict";function isPromise(t){var n=typeof t;return null!==t&&("object"==n||"function"==n)&&!e.isSequence(t)&&"function"==typeof t.then}var t=Array.prototype.slice,n=Object.create(null),r="__ASQ__",a=e.__schedule,u=e.__tapSequence;return e.extend("after",function $$extend(e,r){return function $$after(r){var a=arguments.length>1?t.call(arguments,1):void 0;return r=+r||0,e.then(function $$then(e){var u=a||t.call(arguments,1);setTimeout(function $$set$timeout(){e.apply(n,u)},r)}),e}}),e.after=function $$after(){return e().after.apply(n,arguments)},function IIFE(){var u;e.iterable=function $$iterable(){function throwSequenceErrors(){throw 1===$.length?$[0]:$}function notifyErrors(){var e;if(o=null,l)for(0!==f.length||c||(c=!0,throwSequenceErrors());f.length>0;){c=!0,e=f.shift();try{e.apply(n,$)}catch(t){checkBranding(t)?$=$.concat(t):$.push(t),0===f.length&&throwSequenceErrors()}}}function val(){if(l||s||0===arguments.length)return i;var e=t.call(arguments).map(function mapper(e){return"function"!=typeof e?function $$val(){return e}:e});return p.push.apply(p,e),i}function or(){return s||0===arguments.length?i:(f.push.apply(f,arguments),o||(o=a(notifyErrors)),i)}function pipe(){return s||0===arguments.length?i:(t.call(arguments).forEach(function $$each(e){val(e).or(e.fail)}),i)}function next(){if(l||s||0===p.length)return p.length>0&&$throw$("Sequence cannot be iterated"),{done:!0};try{return{value:p.shift().apply(n,arguments)}}catch(t){return e.isMessageWrapper(t)?$throw$.apply(n,t):$throw$(t),{}}}function $throw$(){return l||s?i:($.push.apply($,arguments),l=!0,o||(o=a(notifyErrors)),i)}function $return$(e){return(l||s)&&(e=void 0),abort(),{done:!0,value:e}}function abort(){l||s||(s=!0,clearTimeout(o),o=null,p.length=f.length=$.length=0)}function duplicate(){var t;return u={val_queue:p.slice(),or_queue:f.slice()},t=e.iterable(),u=null,t}function defer(){return f.push(function $$ignored(){}),i}function brandIt(e){return Object.defineProperty(e,r,{enumerable:!1,value:!0}),e}var i,o,l=!1,c=!1,s=!1,p=[],f=[],$=[];return i=brandIt({val:val,then:val,or:or,pipe:pipe,next:next,"throw":$throw$,"return":$return$,abort:abort,duplicate:duplicate,defer:defer}),i["function"==typeof Symbol&&Symbol.iterator||"@@iterator"]=function $$iter(){return i},u&&(p=u.val_queue.slice(0),f=u.or_queue.slice(0)),i.val.apply(n,arguments),i}}(),e.extend("race",function $$extend(r,a){return function $$race(){if(a("seq_error")||a("seq_aborted")||0===arguments.length)return r;var i=t.call(arguments).map(function $$map(t){var n;return e.isSequence(t)?(n={seq:t},u(n),function $$fn(e){n.seq.pipe(e)}):t});return r.then(function $$then(e){var r=t.call(arguments);i.forEach(function $$each(e){e.apply(n,r)})}),r}}),e.extend("runner",function $$extend(r,u){return function $$runner(){if(u("seq_error")||u("seq_aborted")||0===arguments.length)return r;var i=t.call(arguments);return r.then(function $$then(r){function wrap(t){return"function"==typeof t?(t=t.call(n,s),isPromise(t)&&(t=e.iterable(t))):t=e.isSequence(t)&&"next"in t?t.duplicate():e.iterable(t),e.isSequence(t)&&t.or(function $$or(){r.fail.apply(n,arguments)}),t}function addWrapped(){c.push.apply(c,t.call(arguments).map(wrap))}function iterateOrQuit(t,u){c.length>0?u?t():a(t):("undefined"!=typeof p?e.isMessageWrapper(p)||(p=[p]):p=[],r.apply(n,p))}var o,l,c=i,s={messages:t.call(arguments,1),add:addWrapped},p=s;c=c.map(wrap),function iterate(){o=c.shift();try{l=e.isMessageWrapper(p)&&e.isSequence(o)?o.next.apply(o,p):o.next(p)}catch(t){return r.fail(t)}if(!u("seq_aborted"))if(l.value===s)l.done||c.push(o),p=s,iterateOrQuit(iterate,!1);else{if(!e.isSequence(l.value))if(isPromise(l.value))l.value=e().promise(l.value);else if("function"==typeof l.value){var a=l.value;l.value=e(function $$ASQ(e){a(e.errfcb)})}else e.isMessageWrapper(l.value)?l.value=e.apply(n,l.value.length>0?l.value:e.messages(void 0)):"undefined"!=typeof l.value?l.value=e(l.value):l.value=e();l.value.val(function $$val(){u("seq_aborted")||(arguments.length>0&&(p=arguments.length>1?e.messages.apply(n,arguments):arguments[0]),l.done||(p===s?c.push(o):c.unshift(o)),iterateOrQuit(iterate,!0))}).or(function $$or(){if(!u("seq_aborted"))try{o["throw"].apply(o,arguments)}catch(e){r.fail(e)}})}}()}),r}}),e.extend("toPromise",function $$extend(r,a){return function $$to$promise(){return new Promise(function $$executor(a,u){r.val(function $$val(){var r=t.call(arguments);return a.call(n,r.length>1?r:r[0]),e.messages.apply(n,r)}).or(function $$or(){var e=t.call(arguments);u.call(n,e.length>1?e:e[0])})})}}),e.wrap=function $$wrap(r,a){function checkThis(e,t){return!e||"undefined"!=typeof window&&e===window||"undefined"!=typeof global&&e===global?t:e}var u,i,o,l;if(a=a&&"object"==typeof a?a:{},a.errfcb&&a.splitcb||a.errfcb&&a.simplecb||a.splitcb&&a.simplecb||"errfcb"in a&&!a.errfcb&&!a.splitcb&&!a.simplecb||a.params_first&&a.params_last)throw Error("Invalid options");return l=a["this"]&&"object"==typeof a["this"]?a["this"]:n,u=a.errfcb||!(a.splitcb||a.simplecb),i=!!a.params_first||!a.params_last&&!("params_first"in a||a.params_first)||"params_last"in a&&!a.params_first&&!a.params_last,o=i?"push":"unshift",a.gen?function $$wrapped$gen(){return e.apply(n,arguments).runner(r)}:u?function $$wrapped$errfcb(){var n=t.call(arguments),a=checkThis(this,l);return e(function $$asq(e){n[o](e.errfcb),r.apply(a,n)})}:a.splitcb?function $$wrapped$splitcb(){var n=t.call(arguments),a=checkThis(this,l);return e(function $$asq(e){n[o](e,e.fail),r.apply(a,n)})}:a.simplecb?function $$wrapped$simplecb(){var n=t.call(arguments),a=checkThis(this,l);return e(function $$asq(e){n[o](e),r.apply(a,n)})}:void 0},e});
