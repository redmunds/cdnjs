(function(E,p){function u(a,b){function c(){}c.prototype=a;var d=new c,e;for(e in b)d[e]=b[e];b.toString!==Object.prototype.toString&&(d.toString=b.toString);return d}function d(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=D++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}var l=function(){this.bufferList=new k;this.playingSounds=new k;
this.types=new k;this.types.set("mp3","audio/mpeg");this.types.set("ogg","audio/ogg");this.types.set("wav","audio/wav");this.types.set("aac","audio/aac");this.types.set("m4a","audio/x-m4a")};l.prototype={checkWebAudioAPISupport:function(){return null!=e.field(window,"AudioContext")?(l.AudioContextClass=e.field(window,"AudioContext"),!0):null!=e.field(window,"webkitAudioContext")?(l.AudioContextClass=e.field(window,"webkitAudioContext"),!0):!1},unlockAudio:function(){if(null!=this.audioContext){var a=
this.audioContext.createBuffer(1,1,c.preferredSampleRate),b=this.audioContext.createBufferSource();b.buffer=a;b.connect(this.audioContext.destination);null!=e.field(b,"start")?b.start(0):b.noteOn(0);null!=b.onended?b.onended=d(this,this._unlockCallback):n.delay(d(this,this._unlockCallback),1)}},_unlockCallback:function(){null!=c.__touchUnlockCallback&&c.__touchUnlockCallback();c.dom.ontouchend=null},createAudioContext:function(){if(null==this.audioContext)try{null!=l.AudioContextClass&&(this.audioContext=
y.createInstance(l.AudioContextClass,[]))}catch(a){a instanceof h&&(a=a.val),this.audioContext=null}return this.audioContext},destroy:function(){null!=this.audioContext&&null!=this.audioContext.close&&""!=this.audioContext.close&&this.audioContext.close();this.types=this.playingSounds=this.bufferList=this.audioContext=null}};var m=function(a,b){null!=a&&""!=a&&null!=c.audioManager&&(this.isSpriteSound=!1,this.url=a,this._muted=this._isPlaying=this._isLoaded=!1,null==b&&(b={}),b.autoplay=null!=b.autoplay?
b.autoplay:c.defaults.autoplay,b.webaudio=null!=b.webaudio?b.webaudio:c.defaults.webaudio,b.preload=null!=b.preload?b.preload:c.defaults.preload,b.loop=null!=b.loop?b.loop:c.defaults.loop,b.volume=null!=b.volume&&0<=b.volume&&1>=b.volume?b.volume:c.defaults.volume,b.onload=null!=b.onload?b.onload:c.defaults.onload,b.onend=null!=b.onend?b.onend:c.defaults.onend,b.onerror=null!=b.onerror?b.onerror:c.defaults.onerror,this._options=b)},f=function(a,b){b=b.split("u").join("");this.r=new RegExp(a,b)};f.prototype=
{match:function(a){this.r.global&&(this.r.lastIndex=0);this.r.m=this.r.exec(a);this.r.s=a;return null!=this.r.m},matched:function(a){if(null!=this.r.m&&0<=a&&a<this.r.m.length)return this.r.m[a];throw new h("EReg::matched");}};var v=function(){},q=function(a,b){m.call(this,a,b);this._snd=c.dom.createElement("audio");this._addSource(a);this._options.preload&&this.load()};q.__interfaces__=[v];q.__super__=m;q.prototype=u(m.prototype,{load:function(a){var b=this;this._isLoaded||(this._snd.autoplay=this._options.autoplay,
this._snd.loop=this._options.loop,this._snd.volume=this._options.volume,null!=a&&(this._options.onload=a),this._snd.preload=this._options.preload?"auto":"metadata",null!=this._options.onload&&(this._isLoaded=!0,this._snd.onloadeddata=function(){b._options.onload(b)}),this._snd.onplaying=function(){b._isPlaying=!0},this._snd.onended=function(){b._isPlaying=!1;if(null!=b._options.onend)b._options.onend(b)},null!=this._options.onerror&&(this._snd.onerror=function(){b._options.onerror(b)}),this._snd.load());
return this},_addSource:function(a){this._src=c.dom.createElement("source");this._src.src=a;var b=this._getExt(a);null!=c.audioManager.types.get(b)&&(a=this._getExt(a),this._src.type=c.audioManager.types.get(a));this._snd.appendChild(this._src);return this._src},_getExt:function(a){return a.split(".").pop()},setVolume:function(a){this._isLoaded&&0<=a&&1>=a&&(this._snd.volume=a,this._options.volume=a)},getVolume:function(){return this._options.volume},mute:function(a){this._isLoaded&&(this._snd.muted=
a,g.isiOS()&&(a&&this.isPlaying()?(this._muted=!0,this._snd.pause()):this._muted&&(this._muted=!1,this._snd.play())))},play:function(a,b){var c=this;if(!this._isLoaded||null==this._snd||this._muted)return this;this.isSpriteSound&&null!=b&&(this._snd.currentTime=b.start,null!=this._tmr&&this._tmr.stop(),this._tmr=n.delay(function(){null!=b.loop&&b.loop?c.play(a,b):c.stop()},Math.ceil(1E3*b.duration)));this._isPlaying||this._snd.play();return this},isPlaying:function(){return this._isPlaying},loop:function(a){this._isLoaded&&
null!=this._snd&&(this._snd.loop=a)},stop:function(){this._isLoaded&&null!=this._snd&&(this._snd.pause(),this._snd.currentTime=0,this._isPlaying=!1)},pause:function(){this._isLoaded&&null!=this._snd&&(this._snd.pause(),this._isPlaying=!1)},onEnd:function(a){this._options.onend=a;return this},onLoad:function(a){this._options.onload=a;return this},onError:function(a){this._options.onerror=a;return this},destroy:function(){null!=this._snd&&(this._snd.pause(),this._snd.removeChild(this._src),this._snd=
this._src=null);this._isPlaying=!1}});var w=function(){};w.cca=function(a,b){var c=a.charCodeAt(b);return c!=c?void 0:c};var e=function(){};e.field=function(a,b){try{return a[b]}catch(c){return c instanceof h&&(c=c.val),null}};var z=function(){};z.parseInt=function(a){var b=parseInt(a,10);0!=b||120!=w.cca(a,1)&&88!=w.cca(a,1)||(b=parseInt(a));return isNaN(b)?null:b};var y=function(){};y.createInstance=function(a,b){switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],
b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6]);case 8:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);default:throw new h("Too many arguments");}};var c=p.Waud=function(){};c.init=function(a){null==c.__audioElement&&(null==a&&(a=window.document),c.dom=a,c.__audioElement=c.dom.createElement("audio"),null==
c.audioManager&&(c.audioManager=new l),c.isWebAudioSupported=c.audioManager.checkWebAudioAPISupport(),c.isHTML5AudioSupported=null!=e.field(window,"Audio"),c.isWebAudioSupported&&(c.audioContext=c.audioManager.createAudioContext()),c.sounds=new k)};c.autoMute=function(){c._focusManager=new r;c._focusManager.focus=function(){if(!c.isMuted&&null!=c.sounds)for(var a=c.sounds.iterator();a.hasNext();)a.next().mute(!1)};c._focusManager.blur=function(){if(null!=c.sounds)for(var a=c.sounds.iterator();a.hasNext();)a.next().mute(!0)}};
c.enableTouchUnlock=function(a){c.__touchUnlockCallback=a;c.dom.ontouchend=(x=c.audioManager,d(x,x.unlockAudio))};c.mute=function(a){null==a&&(a=!0);c.isMuted=a;if(null!=c.sounds)for(var b=c.sounds.iterator();b.hasNext();)b.next().mute(a)};c.stop=function(){if(null!=c.sounds)for(var a=c.sounds.iterator();a.hasNext();)a.next().stop()};c.getFormatSupportString=function(){var a="OGG: "+c.__audioElement.canPlayType('audio/ogg; codecs="vorbis"'),a=a+(", WAV: "+c.__audioElement.canPlayType('audio/wav; codecs="1"')),
a=a+(", MP3: "+c.__audioElement.canPlayType("audio/mpeg;")),a=a+(", AAC: "+c.__audioElement.canPlayType("audio/aac;"));return a+=", M4A: "+c.__audioElement.canPlayType("audio/x-m4a;")};c.isSupported=function(){if(null==c.isWebAudioSupported||null==c.isHTML5AudioSupported)c.isWebAudioSupported=c.audioManager.checkWebAudioAPISupport(),c.isHTML5AudioSupported=null!=e.field(window,"Audio");return c.isWebAudioSupported||c.isHTML5AudioSupported};c.isOGGSupported=function(){var a=c.__audioElement.canPlayType('audio/ogg; codecs="vorbis"');
return c.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)};c.isWAVSupported=function(){var a=c.__audioElement.canPlayType('audio/wav; codecs="1"');return c.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)};c.isMP3Supported=function(){var a=c.__audioElement.canPlayType("audio/mpeg;");return c.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)};c.isAACSupported=function(){var a=c.__audioElement.canPlayType("audio/aac;");return c.isHTML5AudioSupported&&null!=a&&("probably"==
a||"maybe"==a)};c.isM4ASupported=function(){var a=c.__audioElement.canPlayType("audio/x-m4a;");return c.isHTML5AudioSupported&&null!=a&&("probably"==a||"maybe"==a)};c.destroy=function(){if(null!=c.sounds)for(var a=c.sounds.iterator();a.hasNext();)a.next().destroy();c.sounds=null;null!=c.audioManager&&c.audioManager.destroy();c.audioManager=null;c.audioContext=null;c.__audioElement=null;null!=c._focusManager&&(c._focusManager.clearEvents(),c._focusManager.blur=null,c._focusManager.focus=null)};var r=
p.WaudFocusManager=function(){var a=this;this._currentState=this._visibilityChange=this._hidden="";null!=e.field(window.document,"hidden")?(this._hidden="hidden",this._visibilityChange="visibilitychange"):null!=e.field(window.document,"mozHidden")?(this._hidden="mozHidden",this._visibilityChange="mozvisibilitychange"):null!=e.field(window.document,"msHidden")?(this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):null!=e.field(window.document,"webkitHidden")&&(this._hidden="webkitHidden",
this._visibilityChange="webkitvisibilitychange");null!=e.field(window,"addEventListener")?(window.addEventListener("focus",d(this,this._focus)),window.addEventListener("blur",d(this,this._blur)),window.addEventListener("pageshow",d(this,this._focus)),window.addEventListener("pagehide",d(this,this._blur)),document.addEventListener(this._visibilityChange,d(this,this._handleVisibilityChange))):null!=e.field(window,"attachEvent")?(window.attachEvent("onfocus",d(this,this._focus)),window.attachEvent("onblur",
d(this,this._blur)),window.attachEvent("pageshow",d(this,this._focus)),window.attachEvent("pagehide",d(this,this._blur)),document.attachEvent(this._visibilityChange,d(this,this._handleVisibilityChange))):window.onload=function(){window.onfocus=d(a,a._focus);window.onblur=d(a,a._blur);window.onpageshow=d(a,a._focus);window.onpagehide=d(a,a._blur)}};r.prototype={_handleVisibilityChange:function(){null!=e.field(window.document,this._hidden)&&e.field(window.document,this._hidden)&&null!=this.blur?this.blur():
null!=this.focus&&this.focus()},_focus:function(){"focus"!=this._currentState&&null!=this.focus&&this.focus();this._currentState="focus"},_blur:function(){"blur"!=this._currentState&&null!=this.blur&&this.blur();this._currentState="blur"},clearEvents:function(){null!=e.field(window,"removeEventListener")?(window.removeEventListener("focus",d(this,this._focus)),window.removeEventListener("blur",d(this,this._blur)),window.removeEventListener("pageshow",d(this,this._focus)),window.removeEventListener("pagehide",
d(this,this._blur)),window.removeEventListener(this._visibilityChange,d(this,this._handleVisibilityChange))):null!=e.field(window,"removeEvent")?(window.removeEvent("onfocus",d(this,this._focus)),window.removeEvent("onblur",d(this,this._blur)),window.removeEvent("pageshow",d(this,this._focus)),window.removeEvent("pagehide",d(this,this._blur)),window.removeEvent(this._visibilityChange,d(this,this._handleVisibilityChange))):(window.onfocus=null,window.onblur=null,window.onpageshow=null,window.onpagehide=
null)}};var A=p.WaudSound=function(a,b){null!=c.audioManager&&(this._options=b,0<a.indexOf(".json")?(this.isSpriteSound=!0,this._loadSpriteJson(a)):(this.isSpriteSound=!1,this._init(a)),c.sounds.set(a,this))};A.__interfaces__=[v];A.prototype={_loadSpriteJson:function(a){var b=this,c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET",a,!0);c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(b._spriteData=JSON.parse(c.response),b._init(b._spriteData.src))};c.send(null)},
_init:function(a){this.url=a;if(c.isWebAudioSupported&&c.useWebAudio&&(null==this._options||null==this._options.webaudio||this._options.webaudio))this._snd=new t(a,this._options);else if(c.isHTML5AudioSupported)this._snd=new q(a,this._options);else return;this._snd.isSpriteSound=this.isSpriteSound},setVolume:function(a){null!=this._snd&&this._snd.setVolume(a)},getVolume:function(){return null==this._snd?0:this._snd.getVolume()},mute:function(a){null!=this._snd&&this._snd.mute(a)},load:function(a){if(null==
this._snd)return null;this._snd.load(a);return this},play:function(a,b){if(null==this._snd)return null;if(null!=a)for(var c=0,d=this._spriteData.sprite;c<d.length;){var e=d[c];++c;if(e.name==a){b=e;break}}this._snd.play(a,b);return this},isPlaying:function(){return null==this._snd?!1:this._snd.isPlaying()},loop:function(a){null!=this._snd&&this._snd.loop(a)},stop:function(){null!=this._snd&&this._snd.stop()},pause:function(){null!=this._snd&&this._snd.pause()},onEnd:function(a){if(null==this._snd)return null;
this._snd.onEnd(a);return this},onLoad:function(a){if(null==this._snd)return null;this._snd.onLoad(a);return this},onError:function(a){if(null==this._snd)return null;this._snd.onError(a);return this},destroy:function(){null!=this._snd&&(this._snd.destroy(),this._snd=null)}};var g=p.WaudUtils=function(){};g.isAndroid=function(a){null==a&&(a=window.navigator.userAgent);return(new f("Android","i")).match(a)};g.isiOS=function(a){null==a&&(a=window.navigator.userAgent);return(new f("(iPad|iPhone|iPod)",
"i")).match(a)};g.isWindowsPhone=function(a){null==a&&(a=window.navigator.userAgent);return(new f("(IEMobile|Windows Phone)","i")).match(a)};g.isFirefox=function(a){null==a&&(a=window.navigator.userAgent);return(new f("Firefox","i")).match(a)};g.isOpera=function(a){null==a&&(a=window.navigator.userAgent);return(new f("Opera","i")).match(a)||null!=e.field(window,"opera")};g.isChrome=function(a){null==a&&(a=window.navigator.userAgent);return(new f("Chrome","i")).match(a)};g.isSafari=function(a){null==
a&&(a=window.navigator.userAgent);return(new f("Safari","i")).match(a)};g.isMobile=function(a){null==a&&(a=window.navigator.userAgent);return(new f("(iPad|iPhone|iPod|Android|webOS|BlackBerry|Windows Phone|IEMobile)","i")).match(a)};g.getiOSVersion=function(a){null==a&&(a=window.navigator.userAgent);var b=new f("[0-9_]+?[0-9_]+?[0-9_]+","i"),c=[];if(b.match(a)){a=b.matched(0).split("_");b=[];for(c=0;c<a.length;){var d=a[c];++c;b.push(z.parseInt(d))}c=b}return c};var t=function(a,b){m.call(this,a,
b);this._pauseTime=this._playStartTime=0;this._manager=c.audioManager;this._options.preload&&this.load()};t.__interfaces__=[v];t.__super__=m;t.prototype=u(m.prototype,{_onSoundLoaded:function(a){this._manager.audioContext.decodeAudioData(a.target.response,d(this,this._decodeSuccess),d(this,this._error))},_decodeSuccess:function(a){if(null==a){if(null!=this._options.onerror)this._options.onerror(this)}else{this._manager.bufferList.set(this.url,a);this._isLoaded=!0;if(null!=this._options.onload)this._options.onload(this);
this._options.autoplay&&this.play()}},_error:function(){if(null!=this._options.onerror)this._options.onerror(this)},_makeSource:function(a){var b=this._manager.audioContext.createBufferSource();b.buffer=a;this._gainNode=null!=this._manager.audioContext.createGain?this._manager.audioContext.createGain():this._manager.audioContext.createGainNode();b.connect(this._gainNode);this._gainNode.connect(this._manager.audioContext.destination);return b},load:function(a){if(!this._isLoaded){var b=new XMLHttpRequest;
b.open("GET",this.url,!0);b.responseType="arraybuffer";b.onload=d(this,this._onSoundLoaded);b.onerror=d(this,this._error);b.send();null!=a&&(this._options.onload=a)}return this},play:function(a,b){var c=this;if(!this._isLoaded||this._muted)return this;this._isPlaying&&this.destroy();var d=0,f=-1;this.isSpriteSound&&null!=b&&(d=b.start+this._pauseTime,f=b.duration);var g=this._manager.bufferList.get(this.url);null!=g&&(this._snd=this._makeSource(g),0<=d&&-1<f?null!=e.field(this._snd,"start")?this._snd.start(0,
d,f):this._snd.noteGrainOn(0,d,f):(this._snd.loop=this._options.loop,null!=e.field(this._snd,"start")?this._snd.start(0,this._pauseTime):this._snd.noteGrainOn(0,this._pauseTime)),this._playStartTime=this._manager.audioContext.currentTime,this._isPlaying=!0,this._snd.onended=function(){if(0==c._pauseTime&&(c.isSpriteSound&&null!=b&&b.loop&&0<=d&&-1<f&&c.play(a,b),c._isPlaying=!1,null!=c._options.onend))c._options.onend(c)},null==this._manager.playingSounds.get(this.url)&&this._manager.playingSounds.set(this.url,
this._snd));return this},isPlaying:function(){return this._isPlaying},loop:function(a){null!=this._snd&&this._isLoaded&&(this._snd.loop=a)},setVolume:function(a){null!=this._gainNode&&this._isLoaded&&(this._options.volume=a,this._gainNode.gain.value=this._options.volume)},getVolume:function(){return this._options.volume},mute:function(a){this._muted=a;null!=this._gainNode&&this._isLoaded&&(this._gainNode.gain.value=a?0:this._options.volume)},stop:function(){this._pauseTime=0;null!=this._snd&&this._isLoaded&&
this._isPlaying&&(this._isPlaying=!1,null!=e.field(this._snd,"stop")?this._snd.stop(0):this._snd.noteOff(0))},pause:function(){this.stop();this._pauseTime+=this._manager.audioContext.currentTime-this._playStartTime},onEnd:function(a){this._options.onend=a;return this},onLoad:function(a){this._options.onload=a;return this},onError:function(a){this._options.onerror=a;return this},destroy:function(){null!=this._snd&&(this._isPlaying&&(null!=e.field(this._snd,"stop")?this._snd.stop(0):this._snd.noteOff(0)),
this._snd.disconnect(),this._snd=null);null!=this._gainNode&&(this._gainNode.disconnect(),this._gainNode=null);this._isPlaying=!1}});var n=function(a){var b=this;this.id=setInterval(function(){b.run()},a)};n.delay=function(a,b){var c=new n(b);c.run=function(){c.stop();a()};return c};n.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){}};var B=function(a,b){this.map=a;this.keys=b;this.index=0;this.count=b.length};B.prototype={hasNext:function(){return this.index<
this.count},next:function(){return this.map.get(this.keys[this.index++])}};var k=function(){this.h={}};k.__interfaces__=[function(){}];k.prototype={set:function(a,b){null!=C[a]?this.setReserved(a,b):this.h[a]=b},get:function(a){return null!=C[a]?this.getReserved(a):this.h[a]},setReserved:function(a,b){null==this.rh&&(this.rh={});this.rh["$"+a]=b},getReserved:function(a){return null==this.rh?null:this.rh["$"+a]},arrayKeys:function(){var a=[],b;for(b in this.h)this.h.hasOwnProperty(b)&&a.push(b);if(null!=
this.rh)for(b in this.rh)36==b.charCodeAt(0)&&a.push(b.substr(1));return a},iterator:function(){return new B(this,this.arrayKeys())}};var h=function(a){Error.call(this);this.val=a;this.message=String(a);Error.captureStackTrace&&Error.captureStackTrace(this,h)};h.__super__=Error;h.prototype=u(Error.prototype,{});var x,D=0,C={};c.useWebAudio=!0;c.defaults={autoplay:!1,loop:!1,preload:!0,webaudio:!0,volume:1};c.preferredSampleRate=44100;c.isMuted=!1;r.FOCUS_STATE="focus";r.BLUR_STATE="blur"})("undefined"!=
typeof console?console:{log:function(){}},"undefined"!=typeof window?window:exports);
