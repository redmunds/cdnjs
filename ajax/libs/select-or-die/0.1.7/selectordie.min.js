/* ===========================================================
 *
 *  Name:          selectordie.min.js
 *  Updated:       2014-10-09
 *  Version:       0.1.7
 *  Created by:    Per V @ Vst.mn
 *  What?:         Minified version the Select or Die JS
 *
 *  Copyright (c) 2014 Per Vestman
 *  Dual licensed under the MIT and GPL licenses.
 *
 *  Beards, Rock & Loud Guns | Cogs 'n Kegs
 *
 * =========================================================== */

!function(a){"use strict";a.fn.selectOrDie=function(b){var f,g,c={customID:null,customClass:"",placeholder:null,prefix:null,cycle:!1,stripEmpty:!1,links:!1,linksExternal:!1,size:0,tabIndex:0,onChange:a.noop},d={},e=!1,h={initSoD:function(b){return d=a.extend({},c,b),this.each(function(){if(a(this).parent().hasClass("sod_select"))console.log("Select or Die: It looks like the SoD already exists");else{var t,u,v,b=a(this),c=d.customID?d.customID:b.data("custom-id")?b.data("custom-id"):d.customID,e=d.customClass?d.customClass:b.data("custom-class")?b.data("custom-class"):d.customClass,f=d.prefix?d.prefix:b.data("prefix")?b.data("prefix"):d.prefix,g=d.placeholder?d.placeholder:b.data("placeholder")?b.data("placeholder"):d.placeholder,i=d.cycle||b.data("cycle")?!0:d.cycle,j=d.links||b.data("links")?!0:d.links,k=d.linksExternal||b.data("links-external")?!0:d.linksExternal,l=d.size?d.size:b.data("size")?b.data("size"):d.size,m=d.tabIndex?d.tabIndex:b.data("tabindex")?b.data("tabindex"):b.attr("tabindex")?b.attr("tabindex"):d.tabIndex,n=d.stripEmpty||b.data("strip-empty")?!0:d.stripEmpty,o=b.prop("title")?b.prop("title"):null,p=b.is(":disabled")?" disabled":"",q="",r="",s=0;f&&(q='<span class="sod_prefix">'+f+"</span> "),r+=g&&!f?'<span class="sod_label sod_placeholder">'+g+"</span>":'<span class="sod_label">'+q+"</span>",t=a("<span/>",{id:c,"class":"sod_select "+e+p,title:o,tabindex:m,html:r,"data-cycle":i,"data-links":j,"data-links-external":k,"data-placeholder":g,"data-prefix":f,"data-filter":""}).insertAfter(this),h.isTouch()&&t.addClass("touch"),u=a("<span/>",{"class":"sod_list_wrapper"}).appendTo(t),v=a("<span/>",{"class":"sod_list"}).appendTo(u),a("option, optgroup",b).each(function(){var b=a(this);n&&!a.trim(b.text())?b.remove():h.populateSoD(b,v,t)}),l&&(u.show(),a(".sod_option:lt("+l+")",v).each(function(){s+=a(this).outerHeight()}),u.removeAttr("style"),v.css({"max-height":s})),b.appendTo(t),t.on("focusin",h.focusSod).on("click",h.triggerSod).on("click",".sod_option",h.optionClick).on("mousemove",".sod_option",h.optionHover).on("keydown",h.keyboardUse),b.on("change",h.selectChange),a(document).on("click","label[for='"+b.attr("id")+"']",function(a){a.preventDefault(),t.focus()})}})},populateSoD:function(b,c,d){var e=d.data("placeholder"),f=d.data("prefix"),g=b.parent(),h=b.text(),i=b.val(),j=b.data("custom-id")?b.data("custom-id"):null,k=b.data("custom-class")?b.data("custom-class"):"",l=b.is(":disabled")?" disabled ":"",m=b.is(":selected")?" selected active ":"",n=b.data("link")?" link ":"",o=b.data("link-external")?" linkexternal":"";b.is("option")?(a("<span/>",{"class":"sod_option "+k+l+m+n+o,id:j,title:h,html:h,"data-value":i}).appendTo(c),(m&&!e||m&&f)&&d.find(".sod_label").append(h),m&&e&&!f?d.data("label",e):m&&d.data("label",h),g.is("optgroup")&&(c.find(".sod_option:last").addClass("groupchild"),g.is(":disabled")&&c.find(".sod_option:last").addClass("disabled"))):a("<span/>",{"class":"sod_option optgroup "+l,title:b.prop("label"),html:b.prop("label"),"data-label":b.prop("label")}).appendTo(c)},focusSod:function(b){if(!a(b.target).hasClass("sod_label")&&!a(b.target).hasClass("sod_option")){var c=a(this),d=a(".sod_select.focus").not(c);c.hasClass("disabled")?h.blurSod(c):(h.blurSod(d),c.addClass("focus"),a("html").one("click",function(){h.blurSod(c)}))}},triggerSod:function(b){b.stopPropagation();var c=a(this),d=c.find(".sod_list"),e=c.data("placeholder"),f=c.find(".selected");c.hasClass("disabled")||c.hasClass("open")||c.hasClass("touch")?(clearTimeout(g),c.removeClass("open")):(c.addClass("open"),a(".sod_select").not(this).removeClass("open focus"),e&&!c.data("prefix")&&c.find(".sod_label").addClass("sod_placeholder").html(e),h.listScroll(d,f),h.checkViewport(c,d))},keyboardUse:function(b){var l,m,n,c=a(this),d=c.find(".sod_list"),g=c.find(".sod_option"),i=c.find(".sod_label"),j=c.data("cycle"),k=g.filter(".active");return b.which>36&&b.which<41?(37===b.which||38===b.which?(m=k.prevAll(":not('.disabled, .optgroup')").first(),n=g.not(".disabled, .optgroup").last()):(39===b.which||40===b.which)&&(m=k.nextAll(":not('.disabled, .optgroup')").first(),n=g.not(".disabled, .optgroup").first()),!m.hasClass("sod_option")&&j&&(m=n),(m.hasClass("sod_option")||j)&&(k.removeClass("active"),m.addClass("active"),i.get(0).lastChild.nodeValue=m.text(),h.listScroll(d,m),c.hasClass("open")||(e=!0)),!1):(13===b.which||32===b.which&&c.hasClass("open")&&(" "===c.data("filter")[0]||""===c.data("filter"))?(b.preventDefault(),k.click()):32!==b.which||c.hasClass("open")||" "!==c.data("filter")[0]&&""!==c.data("filter")?27===b.which&&h.blurSod(c):(b.preventDefault(),e=!1,c.click()),0!==b.which&&(clearTimeout(f),c.data("filter",c.data("filter")+String.fromCharCode(b.which)),l=g.filter(function(){return 0===a(this).text().toLowerCase().indexOf(c.data("filter").toLowerCase())}).not(".disabled, .optgroup").first(),l.length&&(k.removeClass("active"),l.addClass("active"),h.listScroll(d,l),i.get(0).lastChild.nodeValue=l.text(),c.hasClass("open")||(e=!0)),f=setTimeout(function(){c.data("filter","")},500)),void 0)},optionHover:function(){var b=a(this);b.hasClass("disabled")||b.hasClass("optgroup")||b.siblings().removeClass("active").end().addClass("active")},optionClick:function(b){b.stopPropagation();var c=a(this),d=c.closest(".sod_select"),e=c.hasClass("disabled"),f=c.hasClass("optgroup"),h=d.find(".sod_option:not('.optgroup')").index(this);d.hasClass("touch")||(e||f||(d.find(".selected, .sod_placeholder").removeClass("selected sod_placeholder"),c.addClass("selected"),d.find("select option")[h].selected=!0,d.find("select").change()),clearTimeout(g),d.removeClass("open"))},selectChange:function(){var b=a(this),c=b.find(":selected"),e=c.text(),f=b.closest(".sod_select");f.find(".sod_label").get(0).lastChild.nodeValue=e,f.data("label",e),d.onChange.call(this),!f.data("links")&&!c.data("link")||c.data("link-external")?(f.data("links-external")||c.data("link-external"))&&window.open(c.val(),"_blank"):window.location.href=c.val()},blurSod:function(b){if(a("body").find(b).length){var c=b.data("label"),d=b.find(".active"),f=b.find(".selected");clearTimeout(g),e&&!d.hasClass("selected")?d.click():d.hasClass("selected")||(b.find(".sod_label").get(0).lastChild.nodeValue=c,d.removeClass("active"),f.addClass("active")),e=!1,b.removeClass("open focus"),b.blur()}},checkViewport:function(b,c){var d=b[0].getBoundingClientRect(),e=c.outerHeight();d.bottom+e+10>a(window).height()&&d.top-e>10?b.addClass("above"):b.removeClass("above"),g=setTimeout(function(){h.checkViewport(b,c)},200)},listScroll:function(a,b){var c=a[0].getBoundingClientRect(),d=b[0].getBoundingClientRect();c.top>d.top?a.scrollTop(a.scrollTop()-c.top+d.top):c.bottom<d.bottom&&a.scrollTop(a.scrollTop()-c.bottom+d.bottom)},isTouch:function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}},i={destroy:function(){return this.each(function(){var b=a(this),c=b.parent();c.hasClass("sod_select")?(b.off("change"),c.find("span").remove(),b.unwrap()):console.log("Select or Die: There's no SoD to destroy")})},update:function(){return this.each(function(){var b=a(this),c=b.parent(),d=c.find(".sod_list:first");c.hasClass("sod_select")?(d.empty(),c.find(".sod_label").get(0).lastChild.nodeValue="",b.is(":disabled")&&c.addClass("disabled"),a("option, optgroup",b).each(function(){h.populateSoD(a(this),d,c)})):console.log("Select or Die: There's no SoD to update")})},disable:function(b){return this.each(function(){var c=a(this),d=c.parent();d.hasClass("sod_select")?"undefined"!=typeof b?(d.find(".sod_list:first .sod_option[data-value='"+b+"']").addClass("disabled"),d.find(".sod_list:first .sod_option[data-label='"+b+"']").nextUntil(":not(.groupchild)").addClass("disabled"),a("option[value='"+b+"'], optgroup[label='"+b+"']",this).prop("disabled",!0)):d.hasClass("sod_select")&&(d.addClass("disabled"),c.prop("disabled",!0)):console.log("Select or Die: There's no SoD to disable")})},enable:function(b){return this.each(function(){var c=a(this),d=c.parent();d.hasClass("sod_select")?"undefined"!=typeof b?(d.find(".sod_list:first .sod_option[data-value='"+b+"']").removeClass("disabled"),d.find(".sod_list:first .sod_option[data-label='"+b+"']").nextUntil(":not(.groupchild)").removeClass("disabled"),a("option[value='"+b+"'], optgroup[label='"+b+"']",this).prop("disabled",!1)):d.hasClass("sod_select")&&(d.removeClass("disabled"),c.prop("disabled",!1)):console.log("Select or Die: There's no SoD to enable")})}};return i[b]?i[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error('Select or Die: Oh no! No such method "'+b+'" for the SoD instance'),void 0):h.initSoD.apply(this,arguments)}}(jQuery);