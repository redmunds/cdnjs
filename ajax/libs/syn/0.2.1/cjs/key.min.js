var syn=require("./synthetic.js");require("./typeable.js"),require("./browsers.js");var h=syn.helpers,formElExp=/input|textarea/i,supportsSelection=function(e){var t;try{t=void 0!==e.selectionStart}catch(n){t=!1}return t},getSelection=function(e){var t,n,s;if(supportsSelection(e))return document.activeElement&&document.activeElement!==e&&e.selectionStart===e.selectionEnd&&0===e.selectionStart?{start:e.value.length,end:e.value.length}:{start:e.selectionStart,end:e.selectionEnd};try{if("input"===e.nodeName.toLowerCase())return t=h.getWindow(e).document.selection.createRange(),n=e.createTextRange(),n.setEndPoint("EndToStart",t),s=n.text.length,{start:s,end:s+t.text.length};t=h.getWindow(e).document.selection.createRange(),n=t.duplicate();var r=t.duplicate(),i=t.duplicate();r.collapse(),i.collapse(!1),r.moveStart("character",-1),i.moveStart("character",-1),n.moveToElementText(e),n.setEndPoint("EndToEnd",t),s=n.text.length-t.text.length;var a=n.text.length;return 0!==s&&""===r.text&&(s+=2),0!==a&&""===i.text&&(a+=2),{start:s,end:a}}catch(c){var o=formElExp.test(e.nodeName)?"value":"textContent";return{start:e[o].length,end:e[o].length}}},getFocusable=function(e){for(var t=h.getWindow(e).document,n=[],s=t.getElementsByTagName("*"),r=s.length,i=0;r>i;i++)syn.isFocusable(s[i])&&s[i]!==t.documentElement&&n.push(s[i]);return n},textProperty=function(){var e=document.createElement("span");return null!=e.textContent?"textContent":"innerText"}(),getText=function(e){return formElExp.test(e.nodeName)?e.value:e[textProperty]},setText=function(e,t){formElExp.test(e.nodeName)?e.value=t:e[textProperty]=t};h.extend(syn,{keycodes:{"\b":8,"	":9,"\r":13,shift:16,ctrl:17,alt:18,"pause-break":19,caps:20,escape:27,"num-lock":144,"scroll-lock":145,print:44,"page-up":33,"page-down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46," ":32,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,subtract:109,decimal:110,divide:111,";":186,"=":187,",":188,dash:189,"-":189,period:190,".":190,"forward-slash":191,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,"left window key":91,"right window key":92,"select key":93,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},selectText:function(e,t,n){if(supportsSelection(e))n?(e.selectionStart=t,e.selectionEnd=n):(syn.__tryFocus(e),e.setSelectionRange(t,t));else if(e.createTextRange){var s=e.createTextRange();s.moveStart("character",t),n=n||t,s.moveEnd("character",n-e.value.length),s.select()}},getText:function(e){if(syn.typeable.test(e)){var t=getSelection(e);return e.value.substring(t.start,t.end)}var n=syn.helpers.getWindow(e);return n.getSelection?n.getSelection().toString():n.document.getSelection?n.document.getSelection().toString():n.document.selection.createRange().text},getSelection:getSelection}),h.extend(syn.key,{data:function(e){if(syn.key.browser[e])return syn.key.browser[e];for(var t in syn.key.kinds)if(h.inArray(e,syn.key.kinds[t])>-1)return syn.key.browser[t];return syn.key.browser.character},isSpecial:function(e){for(var t=syn.key.kinds.special,n=0;n<t.length;n++)if(syn.keycodes[t[n]]===e)return t[n]},options:function(e,t){var n=syn.key.data(e);if(!n[t])return null;var s=n[t][0],r=n[t][1],i={};return"key"===r?i.keyCode=syn.keycodes[e]:"char"===r?i.keyCode=e.charCodeAt(0):i.keyCode=r,"char"===s?i.charCode=e.charCodeAt(0):null!==s&&(i.charCode=s),i.keyCode?i.which=i.keyCode:i.which=i.charCode,i},kinds:{special:["shift","ctrl","alt","caps"],specialChars:["\b"],navigation:["page-up","page-down","end","home","left","up","right","down","insert","delete"],"function":["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12"]},getDefault:function(e){if(syn.key.defaults[e])return syn.key.defaults[e];for(var t in syn.key.kinds)if(h.inArray(e,syn.key.kinds[t])>-1&&syn.key.defaults[t])return syn.key.defaults[t];return syn.key.defaults.character},defaults:{character:function(e,t,n,s,r){if(/num\d+/.test(n)&&(n=n.match(/\d+/)[0]),s||!syn.support.keyCharacters&&syn.typeable.test(this)){var i=getText(this),a=i.substr(0,r.start),c=i.substr(r.end),o=n;setText(this,a+o+c);var y="\n"===o&&syn.support.textareaCarriage?2:o.length;syn.selectText(this,a.length+y)}},c:function(e,t,n,s,r){syn.key.ctrlKey?syn.key.clipboard=syn.getText(this):syn.key.defaults.character.apply(this,arguments)},v:function(e,t,n,s,r){syn.key.ctrlKey?syn.key.defaults.character.call(this,e,t,syn.key.clipboard,!0,r):syn.key.defaults.character.apply(this,arguments)},a:function(e,t,n,s,r){syn.key.ctrlKey?syn.selectText(this,0,getText(this).length):syn.key.defaults.character.apply(this,arguments)},home:function(){syn.onParents(this,function(e){return e.scrollHeight!==e.clientHeight?(e.scrollTop=0,!1):void 0})},end:function(){syn.onParents(this,function(e){return e.scrollHeight!==e.clientHeight?(e.scrollTop=e.scrollHeight,!1):void 0})},"page-down":function(){syn.onParents(this,function(e){if(e.scrollHeight!==e.clientHeight){var t=e.clientHeight;return e.scrollTop+=t,!1}})},"page-up":function(){syn.onParents(this,function(e){if(e.scrollHeight!==e.clientHeight){var t=e.clientHeight;return e.scrollTop-=t,!1}})},"\b":function(e,t,n,s,r){if(!syn.support.backspaceWorks&&syn.typeable.test(this)){var i=getText(this),a=i.substr(0,r.start),c=i.substr(r.end);r.start===r.end&&r.start>0?(setText(this,a.substring(0,a.length-1)+c),syn.selectText(this,r.start-1)):(setText(this,a+c),syn.selectText(this,r.start))}},"delete":function(e,t,n,s,r){if(!syn.support.backspaceWorks&&syn.typeable.test(this)){var i=getText(this),a=i.substr(0,r.start),c=i.substr(r.end);r.start===r.end&&r.start<=getText(this).length-1?setText(this,a+c.substring(1)):setText(this,a+c),syn.selectText(this,r.start)}},"\r":function(e,t,n,s,r){var i=this.nodeName.toLowerCase();if("input"===i&&syn.trigger(this,"change",{}),!syn.support.keypressSubmits&&"input"===i){var a=syn.closest(this,"form");a&&syn.trigger(a,"submit",{})}syn.support.keyCharacters||"textarea"!==i||syn.key.defaults.character.call(this,e,t,"\n",void 0,r),syn.support.keypressOnAnchorClicks||"a"!==i||syn.trigger(this,"click",{})},"	":function(e,t){for(var n,s,r=getFocusable(this),i=null,a=0,c=[];a<r.length;a++)c.push([r[a],a]);var o=function(e,t){var n=e[0],s=t[0],r=syn.tabIndex(n)||0,i=syn.tabIndex(s)||0;return r===i?e[1]-t[1]:0===r?1:0===i?-1:r-i};for(c.sort(o),a=0;a<c.length;a++)n=c[a][0],this===n&&(syn.key.shiftKey?(i=c[a-1][0],i||(i=c[r.length-1][0])):(i=c[a+1][0],i||(i=c[0][0])));return i?syn.__tryFocus(i):i=s,i},left:function(e,t,n,s,r){syn.typeable.test(this)&&(syn.key.shiftKey?syn.selectText(this,0===r.start?0:r.start-1,r.end):syn.selectText(this,0===r.start?0:r.start-1))},right:function(e,t,n,s,r){syn.typeable.test(this)&&(syn.key.shiftKey?syn.selectText(this,r.start,r.end+1>getText(this).length?getText(this).length:r.end+1):syn.selectText(this,r.end+1>getText(this).length?getText(this).length:r.end+1))},up:function(){/select/i.test(this.nodeName)&&(this.selectedIndex=this.selectedIndex?this.selectedIndex-1:0)},down:function(){/select/i.test(this.nodeName)&&(syn.changeOnBlur(this,"selectedIndex",this.selectedIndex),this.selectedIndex=this.selectedIndex+1)},shift:function(){return null},ctrl:function(){return null}}}),h.extend(syn.create,{keydown:{setup:function(e,t,n){-1!==h.inArray(t,syn.key.kinds.special)&&(syn.key[t+"Key"]=n)}},keypress:{setup:function(e,t,n){syn.support.keyCharacters&&!syn.support.keysOnNotFocused&&syn.__tryFocus(n)}},keyup:{setup:function(e,t,n){-1!==h.inArray(t,syn.key.kinds.special)&&(syn.key[t+"Key"]=null)}},key:{options:function(e,t,n){return t="object"!=typeof t?{character:t}:t,t=h.extend({},t),t.character&&(h.extend(t,syn.key.options(t.character,e)),delete t.character),t=h.extend({ctrlKey:!!syn.key.ctrlKey,altKey:!!syn.key.altKey,shiftKey:!!syn.key.shiftKey,metaKey:!!syn.key.metaKey},t)},event:function(e,t,n){var s,r=h.getWindow(n).document||document;if(r.createEvent){try{s=r.createEvent("KeyEvents"),s.initKeyEvent(e,!0,!0,window,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.keyCode,t.charCode)}catch(i){s=h.createBasicStandardEvent(e,t,r)}return s.synthetic=!0,s}try{s=h.createEventObject.apply(this,arguments),h.extend(s,t)}catch(i){}return s}}});var convert={enter:"\r",backspace:"\b",tab:"	",space:" "};h.extend(syn.init.prototype,{_key:function(e,t,n){if(/-up$/.test(t)&&-1!==h.inArray(t.replace("-up",""),syn.key.kinds.special))return syn.trigger(e,"keyup",t.replace("-up","")),n(!0,e);var s,r=h.getWindow(e).document.activeElement,i=syn.typeable.test(e)&&getSelection(e),a=convert[t]||t,c=syn.trigger(e,"keydown",a),o=syn.key.getDefault,y=syn.key.browser.prevent,l=syn.key.options(a,"keypress");return c?l?(r!==h.getWindow(e).document.activeElement&&(e=h.getWindow(e).document.activeElement),c=syn.trigger(e,"keypress",l),c&&(s=o(a).call(e,l,h.getWindow(e),a,void 0,i))):s=o(a).call(e,l,h.getWindow(e),a,void 0,i):l&&-1===h.inArray("keypress",y.keydown)&&(r!==h.getWindow(e).document.activeElement&&(e=h.getWindow(e).document.activeElement),syn.trigger(e,"keypress",l)),s&&s.nodeName&&(e=s),null!==s?syn.schedule(function(){syn.support.oninput&&syn.trigger(e,"input",syn.key.options(a,"input")),syn.trigger(e,"keyup",syn.key.options(a,"keyup")),n(c,e)},1):n(c,e),e},_type:function(e,t,n){var s=(t+"").match(/(\[[^\]]+\])|([^\[])/g),r=this,i=function(t,a){var c=s.shift();return c?(a=a||e,c.length>1&&(c=c.substr(1,c.length-2)),void r._key(a,c,i)):void n(t,a)};i()}});
//# sourceMappingURL=key.min.js.map