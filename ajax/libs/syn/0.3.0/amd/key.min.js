define(function(e,t,n){var r=e("./synthetic");e("./typeable"),e("./browsers");var s=r.helpers,i=/input|textarea/i,a=function(e){var t;try{t=void 0!==e.selectionStart}catch(n){t=!1}return t},c=function(e){var t,n,r;if(a(e))return document.activeElement&&document.activeElement!==e&&e.selectionStart===e.selectionEnd&&0===e.selectionStart?{start:e.value.length,end:e.value.length}:{start:e.selectionStart,end:e.selectionEnd};try{if("input"===e.nodeName.toLowerCase())return t=s.getWindow(e).document.selection.createRange(),n=e.createTextRange(),n.setEndPoint("EndToStart",t),r=n.text.length,{start:r,end:r+t.text.length};t=s.getWindow(e).document.selection.createRange(),n=t.duplicate();var c=t.duplicate(),o=t.duplicate();c.collapse(),o.collapse(!1),c.moveStart("character",-1),o.moveStart("character",-1),n.moveToElementText(e),n.setEndPoint("EndToEnd",t),r=n.text.length-t.text.length;var l=n.text.length;return 0!==r&&""===c.text&&(r+=2),0!==l&&""===o.text&&(l+=2),{start:r,end:l}}catch(u){var d=i.test(e.nodeName)?"value":"textContent";return{start:e[d].length,end:e[d].length}}},o=function(e){for(var t=s.getWindow(e).document,n=[],i=t.getElementsByTagName("*"),a=i.length,c=0;a>c;c++)r.isFocusable(i[c])&&i[c]!==t.documentElement&&n.push(i[c]);return n},l=function(){var e=document.createElement("span");return null!=e.textContent?"textContent":"innerText"}(),u=function(e){return i.test(e.nodeName)?e.value:e[l]},d=function(e,t){i.test(e.nodeName)?e.value=t:e[l]=t};s.extend(r,{keycodes:{"\b":8,"	":9,"\r":13,shift:16,ctrl:17,alt:18,"pause-break":19,caps:20,escape:27,"num-lock":144,"scroll-lock":145,print:44,"page-up":33,"page-down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46," ":32,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,subtract:109,decimal:110,divide:111,";":186,"=":187,",":188,dash:189,"-":189,period:190,".":190,"forward-slash":191,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222,"left window key":91,"right window key":92,"select key":93,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},selectText:function(e,t,n){if(a(e))n?(e.selectionStart=t,e.selectionEnd=n):(r.__tryFocus(e),e.setSelectionRange(t,t));else if(e.createTextRange){var s=e.createTextRange();s.moveStart("character",t),n=n||t,s.moveEnd("character",n-e.value.length),s.select()}},getText:function(e){if(r.typeable.test(e)){var t=c(e);return e.value.substring(t.start,t.end)}var n=r.helpers.getWindow(e);return n.getSelection?n.getSelection().toString():n.document.getSelection?n.document.getSelection().toString():n.document.selection.createRange().text},getSelection:c}),s.extend(r.key,{data:function(e){if(r.key.browser[e])return r.key.browser[e];for(var t in r.key.kinds)if(s.inArray(e,r.key.kinds[t])>-1)return r.key.browser[t];return r.key.browser.character},isSpecial:function(e){for(var t=r.key.kinds.special,n=0;n<t.length;n++)if(r.keycodes[t[n]]===e)return t[n]},options:function(e,t){var n=r.key.data(e);if(!n[t])return null;var s=n[t][0],i=n[t][1],a={};return"key"===i?a.keyCode=r.keycodes[e]:"char"===i?a.keyCode=e.charCodeAt(0):a.keyCode=i,"char"===s?a.charCode=e.charCodeAt(0):null!==s&&(a.charCode=s),a.keyCode?a.which=a.keyCode:a.which=a.charCode,a},kinds:{special:["shift","ctrl","alt","caps"],specialChars:["\b"],navigation:["page-up","page-down","end","home","left","up","right","down","insert","delete"],"function":["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12"]},getDefault:function(e){if(r.key.defaults[e])return r.key.defaults[e];for(var t in r.key.kinds)if(s.inArray(e,r.key.kinds[t])>-1&&r.key.defaults[t])return r.key.defaults[t];return r.key.defaults.character},defaults:{character:function(e,t,n,s,i){if(/num\d+/.test(n)&&(n=n.match(/\d+/)[0]),s||!r.support.keyCharacters&&r.typeable.test(this)){var a=u(this),c=a.substr(0,i.start),o=a.substr(i.end),l=n;d(this,c+l+o);var h="\n"===l&&r.support.textareaCarriage?2:l.length;r.selectText(this,c.length+h)}},c:function(e,t,n,s,i){r.key.ctrlKey?r.key.clipboard=r.getText(this):r.key.defaults.character.apply(this,arguments)},v:function(e,t,n,s,i){r.key.ctrlKey?r.key.defaults.character.call(this,e,t,r.key.clipboard,!0,i):r.key.defaults.character.apply(this,arguments)},a:function(e,t,n,s,i){r.key.ctrlKey?r.selectText(this,0,u(this).length):r.key.defaults.character.apply(this,arguments)},home:function(){r.onParents(this,function(e){return e.scrollHeight!==e.clientHeight?(e.scrollTop=0,!1):void 0})},end:function(){r.onParents(this,function(e){return e.scrollHeight!==e.clientHeight?(e.scrollTop=e.scrollHeight,!1):void 0})},"page-down":function(){r.onParents(this,function(e){if(e.scrollHeight!==e.clientHeight){var t=e.clientHeight;return e.scrollTop+=t,!1}})},"page-up":function(){r.onParents(this,function(e){if(e.scrollHeight!==e.clientHeight){var t=e.clientHeight;return e.scrollTop-=t,!1}})},"\b":function(e,t,n,s,i){if(!r.support.backspaceWorks&&r.typeable.test(this)){var a=u(this),c=a.substr(0,i.start),o=a.substr(i.end);i.start===i.end&&i.start>0?(d(this,c.substring(0,c.length-1)+o),r.selectText(this,i.start-1)):(d(this,c+o),r.selectText(this,i.start))}},"delete":function(e,t,n,s,i){if(!r.support.backspaceWorks&&r.typeable.test(this)){var a=u(this),c=a.substr(0,i.start),o=a.substr(i.end);i.start===i.end&&i.start<=u(this).length-1?d(this,c+o.substring(1)):d(this,c+o),r.selectText(this,i.start)}},"\r":function(e,t,n,s,i){var a=this.nodeName.toLowerCase();if("input"===a&&r.trigger(this,"change",{}),!r.support.keypressSubmits&&"input"===a){var c=r.closest(this,"form");c&&r.trigger(c,"submit",{})}r.support.keyCharacters||"textarea"!==a||r.key.defaults.character.call(this,e,t,"\n",void 0,i),r.support.keypressOnAnchorClicks||"a"!==a||r.trigger(this,"click",{})},"	":function(e,t){for(var n,s,i=o(this),a=null,c=0,l=[];c<i.length;c++)l.push([i[c],c]);var u=function(e,t){var n=e[0],s=t[0],i=r.tabIndex(n)||0,a=r.tabIndex(s)||0;return i===a?e[1]-t[1]:0===i?1:0===a?-1:i-a};for(l.sort(u),c=0;c<l.length;c++)n=l[c][0],this===n&&(r.key.shiftKey?(a=l[c-1][0],a||(a=l[i.length-1][0])):(a=l[c+1][0],a||(a=l[0][0])));return a?r.__tryFocus(a):a=s,a},left:function(e,t,n,s,i){r.typeable.test(this)&&(r.key.shiftKey?r.selectText(this,0===i.start?0:i.start-1,i.end):r.selectText(this,0===i.start?0:i.start-1))},right:function(e,t,n,s,i){r.typeable.test(this)&&(r.key.shiftKey?r.selectText(this,i.start,i.end+1>u(this).length?u(this).length:i.end+1):r.selectText(this,i.end+1>u(this).length?u(this).length:i.end+1))},up:function(){/select/i.test(this.nodeName)&&(this.selectedIndex=this.selectedIndex?this.selectedIndex-1:0)},down:function(){/select/i.test(this.nodeName)&&(r.changeOnBlur(this,"selectedIndex",this.selectedIndex),this.selectedIndex=this.selectedIndex+1)},shift:function(){return null},ctrl:function(){return null}}}),s.extend(r.create,{keydown:{setup:function(e,t,n){-1!==s.inArray(t,r.key.kinds.special)&&(r.key[t+"Key"]=n)}},keypress:{setup:function(e,t,n){r.support.keyCharacters&&!r.support.keysOnNotFocused&&r.__tryFocus(n)}},keyup:{setup:function(e,t,n){-1!==s.inArray(t,r.key.kinds.special)&&(r.key[t+"Key"]=null)}},key:{options:function(e,t,n){return t="object"!=typeof t?{character:t}:t,t=s.extend({},t),t.character&&(s.extend(t,r.key.options(t.character,e)),delete t.character),t=s.extend({ctrlKey:!!r.key.ctrlKey,altKey:!!r.key.altKey,shiftKey:!!r.key.shiftKey,metaKey:!!r.key.metaKey},t)},event:function(e,t,n){var r,i=s.getWindow(n).document||document;if(i.createEvent){try{r=i.createEvent("KeyEvents"),r.initKeyEvent(e,!0,!0,window,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,t.keyCode,t.charCode)}catch(a){r=s.createBasicStandardEvent(e,t,i)}return r.synthetic=!0,r}try{r=s.createEventObject.apply(this,arguments),s.extend(r,t)}catch(a){}return r}}});var h={enter:"\r",backspace:"\b",tab:"	",space:" "};s.extend(r.init.prototype,{_key:function(e,t,n){if(/-up$/.test(t)&&-1!==s.inArray(t.replace("-up",""),r.key.kinds.special))return r.trigger(e,"keyup",t.replace("-up","")),n(!0,e);var i,a=s.getWindow(e).document.activeElement,o=r.typeable.test(e)&&c(e),l=h[t]||t,u=r.trigger(e,"keydown",l),d=r.key.getDefault,y=r.key.browser.prevent,f=r.key.options(l,"keypress");return u?f?(a!==s.getWindow(e).document.activeElement&&(e=s.getWindow(e).document.activeElement),u=r.trigger(e,"keypress",f),u&&(i=d(l).call(e,f,s.getWindow(e),l,void 0,o))):i=d(l).call(e,f,s.getWindow(e),l,void 0,o):f&&-1===s.inArray("keypress",y.keydown)&&(a!==s.getWindow(e).document.activeElement&&(e=s.getWindow(e).document.activeElement),r.trigger(e,"keypress",f)),i&&i.nodeName&&(e=i),null!==i?r.schedule(function(){r.support.oninput&&r.trigger(e,"input",r.key.options(l,"input")),r.trigger(e,"keyup",r.key.options(l,"keyup")),n(u,e)},1):n(u,e),e},_type:function(e,t,n){var r=(t+"").match(/(\[[^\]]+\])|([^\[])/g),s=this,i=function(t,a){var c=r.shift();return c?(a=a||e,c.length>1&&(c=c.substr(1,c.length-2)),void s._key(a,c,i)):void n(t,a)};i()}})});
//# sourceMappingURL=key.min.js.map