function extend(e,t){for(key in t)e[key]=t[key];return e}function typeof2(e){return Array.isArray(e)?"array":typeof e}function wrapTheWrapper(e){return Proxy?Proxy.createFunction({getOwnPropertyDescriptor:function(e){},enumerate:function(){return[]},delete:function(){return!1},fix:function(){},set:function(e,t,n){},get:function(t,n){return e(n)}},e):extend(e,{get:function(){e("get").call(e,arguments)},put:function(){e("put").call(e,arguments)},post:function(){e("post").call(e,arguments)},delete:function(){e("delete").call(e,arguments)}})}function makeWrapper(e,t,n,r){return wrapTheWrapper(function(){var o=[].splice.call(arguments,0),a=typeof2(o[o.length-1]);if("undefined"===a)return e.url(n,r);if("function"===a){var i=o.pop(),u=o.pop(),p=o.pop()||{},s=n.pop();return e.request({method:s,path:n,query:r,headers:p,data:u,args:o},t,i)}var c="object"===a?e.combine(r,o.pop()):r,h=o.length?e.join(n,o):n;return makeWrapper(e,t,h,c)})}function Site(e){this.base=e.url,"/"!==this.base.slice(-1)&&(this.base+="/"),e.user&&(this.basicAuth=e.user+":"+(e.password||""))}function Transport(){}var Proxy=require("node-proxy");Site.prototype.combine=function(e,t){return extend(extend({},e),t)},Site.prototype.join=function(e,t){return e.concat(t)},Site.prototype.url=function(e,t){var n=e.map(function(e){return e.join?e.join("/"):encodeURIComponent(e)}).join("/"),r=Object.keys(t).map(function(e){var n=t[e];return"$"===e[0]&&(e=e.slice(1),"$"!==e[0]&&(n=JSON.stringify(n))),(n&&n.map?n:[n]).map(function(t){return encodeURIComponent(e)+(null!==t?"="+encodeURIComponent(t):"")}).join("&")}).join("&");return this.base+n+(r?"?"+r:"")},Site.prototype.request=function(e,t,n){var r=JSON.stringify(e.data),o={responseType:"text",method:e.method,url:this.url(e.path,e.query),headers:{}};extend(o.headers,{"Content-Type":"application/json",Accept:"application/json"}),extend(o.headers,e.headers),o.basicAuth=this.basicAuth,t.send(o,r,function(e,t,r){if(null===e)return n(t);var o,a;try{a=JSON.parse(r)}catch(e){o=e,a=r}return"2"!==e.toFixed()[0]&&(o=Error("Bad status code from server: "+e)),n(o,a)})},Transport.normalize=function(e){var t={};return Object.keys(e).forEach(function(n){var r=n.split("-").map(function(e){return e[0].toUpperCase()+e.slice(1).toLowerCase()}).join("-");t[r]=e[n]}),t};var url=require("url"),https=require("https"),http=require("http");Transport.prototype.send=function(e,t,n){var r=url.parse(e.url),o="http:"!==r.protocol,a={host:r.hostname,port:r.port,method:e.method.toUpperCase(),path:r.pathname+(r.search||""),headers:{}};r.auth&&(a.headers.Authorization="Basic "+new Buffer(r.auth).toString("base64")),e.basicAuth&&(a.headers.Authorization="Basic "+new Buffer(e.basicAuth).toString("base64")),extend(a.headers,Transport.normalize(e.headers)),(t&&"GET"===a.method||"HEAD"===a.method)&&(console.warn("Ignoring data passed to GET or HEAD request."),t=null),"string"==typeof t&&(t=new Buffer(t,"utf8"),a.headers["Content-Type"]="text/plain;charset=UTF-8"),a=(o?https:http).request(a),t?(a.setHeader("Content-Length",t.length),a.write(t)):a.setHeader("Content-Length",0),a.end(),a.on("error",function(e){n(null,e)}),a.on("response",function(t){var r=new Buffer(0);t.on("data",function(e){var t=r;r=new Buffer(t.length+e.length),t.copy(r),e.copy(r,t.length)}),t.on("end",function(){"text"===e.responseType&&(r=r.toString("utf8")),n(t.statusCode,Transport.normalize(t.headers),r)})})},exports.api=function(e){return makeWrapper(new Site(e),new Transport,[],{})};
//# sourceMappingURL=fermata.min.js.map