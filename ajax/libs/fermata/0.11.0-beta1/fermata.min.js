var Proxy=function(){if("Proxy"in this)return this.Proxy}(),fermata={plugins:{}};if(fermata.registerPlugin=function(e,t){fermata.plugins[e]=t,fermata[e]=function(){var t={base:"",path:[""],query:{}},n=[e].concat([].slice.call(arguments)),r=fermata._makeTransport.call(t,"_base").using.apply(null,n);return fermata._makeNativeURL(r,t)},fermata._useExports&&(exports[e]=fermata[e])},fermata._makeTransport=function(e,t){var n=this,r=fermata.plugins[e].apply(n,t);return r.using=function(){var e=arguments[0];return arguments[0]=r,fermata._makeTransport.call(n,e,arguments)},r},fermata._makeNativeURL=function(e,t){return fermata._wrapTheWrapper(function(){var n=[].slice.call(arguments),r=fermata._typeof2(n[n.length-1]);if("undefined"===r)return fermata._stringForURL(t);if("function"===r){var a=n.pop(),o=n.pop(),s=fermata._normalize(n.pop()||{}),i=n.pop()||{},u=t.path.pop().toUpperCase();return"DEL"===u&&(u="DELETE"),"string"==typeof i&&(console&&console.warn&&console.warn("Using deprecated API: use an options object to set `{responseType:'"+i+"'}` instead of passing raw string."),i={responseType:i}),e({base:t.base,method:u,path:t.path,query:t.query,options:i,headers:s,data:o},a)}var f="object"===r?fermata._extend({},t.query,n.pop()):t.query,p=n.length?t.path.concat(n):t.path;return fermata._makeNativeURL(e,{base:t.base,path:p,query:f})})},fermata._wrapTheWrapper=function(e){return fermata._nodeProxy?fermata._nodeProxy.createFunction({getOwnPropertyDescriptor:function(e){},enumerate:function(){return[]},delete:function(){return!1},fix:function(){},set:function(e,t,n){},get:function(t,n){return e(n)}},e):Proxy&&Proxy.createFunction?Proxy.createFunction({getOwnPropertyDescriptor:function(e){},getPropertyDescriptor:function(e){},getPropertyNames:function(){return[]},enumerate:function(){return[]},defineProperty:function(){return!1},delete:function(){return!1},fix:function(){},get:function(t,n){return e(n)}},e):Proxy?new Proxy(e,{get:function(t,n){return e(n)}}):fermata._extend(e,{get:function(){return e("get").apply(null,arguments)},put:function(){return e("put").apply(null,arguments)},post:function(){return e("post").apply(null,arguments)},delete:function(){return e("delete").apply(null,arguments)},del:function(){return e("del").apply(null,arguments)}})},fermata._nodeTransport=function(e,t){var n=fermata._stringForURL(e),r=require("url").parse(n),a={};e.options.responseType||(e.options.responseType="text"),r.auth&&("either/or"!==require("url").parse("http//either%2for@example").auth&&(r.auth=decodeURIComponent(r.auth)),a.Authorization="Basic "+new Buffer(r.auth).toString("base64")),fermata._extend(a,e.headers),e.data&&"GET"===e.method||"HEAD"===e.method?(console&&console.warn&&console.warn("Ignoring data passed to GET or HEAD request."),e.data=null):"string"==typeof e.data&&(e.data=new Buffer(e.data,"utf8"),a["Content-Type"]||(a["Content-Type"]="text/plain;charset=UTF-8"));var o="https:"===r.protocol?require("https"):require("http"),s=fermata._extend({},e.options.node,{host:r.hostname,port:r.port,method:e.method,path:r.pathname+(r.search||""),headers:a,agent:e.options.node&&e.options.node.agent||o.globalAgent}),i=o.request(s);return fermata._isStream(e.data)?e.data.pipe(i):e.data?(i.setHeader("Content-Length",e.data.length),i.end(e.data)):(i.setHeader("Content-Length",0),i.end()),i.on("error",function(e){t(e,null)}),"stream"===e.options.responseType?i.on("response",function(e){t(null,{status:e.statusCode,headers:fermata._normalize(e.headers),data:e})}):i.on("response",function(n){function r(r){var s=Buffer.concat(a,o);"text"===e.options.responseType&&(s=s.toString("utf8")),t(r||null,{status:n.statusCode,headers:fermata._normalize(n.headers),data:s})}var a=[],o=0;n.on("data",function(e){a.push(e),o+=e.length}),n.on("end",r),n.on("close",function(){r(new Error("Connection dropped."))})}),i},fermata._xhrTransport=function(e,t){var n=new XMLHttpRequest,r=fermata._stringForURL(e),a=e.options.xhr||{};return n.open(e.method,r,!0),n.responseType=e.options.responseType||"text",Object.keys(a).forEach(function(e){n[e]=a[e]}),Object.keys(e.headers).forEach(function(t){n.setRequestHeader(t,e.headers[t])}),n.send(e.data),n.onreadystatechange=function(){if(this.readyState===(n.DONE||4))if(this.status){var e={};this.getAllResponseHeaders().split("\r\n").forEach(function(t){t&&(t=t.split(": "),e[t[0]]=t.slice(1).join(": "))}),t(null,{status:this.status,headers:fermata._normalize(e),data:this.response||this.responseText})}else t(Error("XHR request failed"),null)},n},fermata._stringForURL=function(e){var t=e.path.map(function(e){return e.join?e.join("/"):encodeURIComponent(e)}).join("/"),n=fermata._flatten(e.query).map(function(e){return encodeURIComponent(e[0])+(null!==e[1]?"="+encodeURIComponent(e[1]):"")}).join("&");return e.base+t+(n?"?"+n:"")},fermata._flatten=function(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n];"$"===n[0]&&(n=n.slice(1),"$"!==n[0]&&(r=JSON.stringify(r))),[].concat(r).forEach(function(e){t.push([n,e])})}),t},fermata._unflatten=function(e){var t={};return e.forEach(function(e){var n=e[0],r=e[1];t[n]={}.hasOwnProperty.call(t,n)?[].concat(t[n],r):r}),t},fermata._normalize=function(e){var t={};return Object.keys(e).forEach(function(n){var r=n.split("-").map(function(e){return e&&e[0].toUpperCase()+e.slice(1).toLowerCase()}).join("-");t[r]=e[n]}),t},fermata._extend=Object.assign?Object.assign:function(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){t&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e},fermata._typeof2=function(e){return Array.isArray(e)?"array":typeof e},"undefined"!=typeof exports&&(fermata._useExports=!0,exports.registerPlugin=fermata.registerPlugin,exports.plugins=fermata.plugins,!Proxy))try{fermata._nodeProxy=require("node-proxy")}catch(e){}"undefined"==typeof window&&fermata.registerPlugin("oauth",require("./plugins/oauth").init(fermata)),"object"==typeof process&&"object"==typeof process.versions&&"http_parser"in process.versions?fermata._transport=fermata._nodeTransport:fermata._transport=fermata._xhrTransport,fermata.registerPlugin("_base",function(){return function(e,t){return fermata._transport(e,t)}}),fermata.registerPlugin("raw",function(e,t){return fermata._extend(this,t),e}),fermata.registerPlugin("statusCheck",function(e){return function(t,n){return e(t,function(e,t){e||"2"===t.status.toFixed(0)[0]||(e=Error("Bad status code from server: "+t.status),e.status=t.status),n(e,t)})}}),fermata._nodeMultipartEncode=function(e){function t(e){var t=a,n=e instanceof Buffer?e:new Buffer(""+e);a=new Buffer(t.length+n.length+2),t.copy(a),n.copy(a,t.length),a.write("\r\n",a.length-2)}function n(e){return'"'+e.replace(/"|"/g,"%22").replace(/\r\n|\r|\n/g," ")+'"'}var r=""+Math.round(1e16*Math.random())+Math.round(1e16*Math.random());this.headers["Content-Type"]&&(this.headers["Content-Type"]+="; boundary="+r);var a=new Buffer(0);return fermata._flatten(e).forEach(function(e){if(t("--"+r),{}.hasOwnProperty.call(e[1],"data")){var a=e[1];t("Content-Disposition: form-data; name="+n(e[0])+"; filename="+n(a.name||"blob")),t("Content-Type: "+(a.type||"application/octet-stream")),t(""),t(a.data)}else t("Content-Disposition: form-data; name="+n(e[0])),t(""),t(e[1])}),t("--"+r+"--"),a},fermata._xhrMultipartEncode=function(e){var t=new FormData;return fermata._flatten(e).forEach(function(e){t.append(e[0],e[1])}),t},fermata._isStream=function(e){return fermata._transport===fermata._nodeTransport&&e instanceof require("stream").Readable},fermata.registerPlugin("autoConvert",function(e,t){var n={"text/plain":[function(e){return""+e},function(e){return""+e}],"application/json":[JSON.stringify,JSON.parse],"application/x-www-form-urlencoded":[function(e){return fermata._flatten(e).map(function(e){return encodeURIComponent(e[0]).replace(/%20/g,"+")+"="+encodeURIComponent(e[1]).replace(/%20/g,"+")}).join("&")},function(e){return fermata._unflatten(e.toString().split("&").map(function(e){return e.split("=").map(function(e){return decodeURIComponent(e.replace(/\+/g," "))})}))}],"multipart/form-data":[fermata._transport===fermata._xhrTransport?fermata._xhrMultipartEncode:fermata._nodeMultipartEncode,null]};return function(r,a){t&&("GET"!==r.method&&"HEAD"!==r.method&&(r.headers["Content-Type"]||(r.headers["Content-Type"]=t)),r.headers.Accept||(r.headers.Accept=t));var o=r.headers["Content-Type"],s=(n[o]||[])[0];return s&&!fermata._isStream(r.data)&&(r.data=r.data&&s.call(r,r.data)),e(r,function(e,t){var o=r.headers.Accept,s=t&&t.headers["Content-Type"],i=(n[o]||n[s]||[])[1],u=t&&t.data,f=t&&fermata._extend({"X-Status-Code":t.status},t.headers);if(t&&204===t.status)u=null;else if("stream"===r.options.responseType);else if(i)try{u=i.call(t,u)}catch(t){e||(e=t)}a(e,u,f)})}}),fermata.registerPlugin("json",function(e,t){return this.base=t,e.using("statusCheck").using("autoConvert","application/json")}),fermata.registerPlugin("api",function(e,t){var n=t.url.replace(/\/$/,"");return t.user&&(n=n.replace(/\/\/(\w)/,"//"+t.user+":PASSWORD@$1")),console&&console.warn&&console.warn('Using deprecated API: please initialize with `fermata.json("'+n+'")` instead. This plugin will be disabled soon!'),this.base=n,e.using("statusCheck").using("autoConvert","application/json")});
//# sourceMappingURL=fermata.min.js.map