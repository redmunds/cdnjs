function extend(t,e){for(key in e)t[key]=e[key];return t}function fermatable(t){var e={inspect:!0,constructor:!0};return Proxy.createFunction({getOwnPropertyDescriptor:function(e){var r=Object.getOwnPropertyDescriptor(t,e);return r&&(r.configurable=!0),r},enumerate:function(){return[]},delete:function(){return!1},fix:function(){},get:function(r,n){return e[n]?t[n]:t(n)},set:function(r,n,i){e[n]?t[n]=i:t(n)(i)}},t)}function makeWrapper(t,e,r){return fermatable(function(){if(0===arguments.length)return t.url(e,r);if(1===arguments.length&&"function"==typeof arguments[0])return startRequest(t,e,r,arguments[0],"GET",{},null);if(1===arguments.length&&"object"==typeof arguments[0]){var n=extend(extend({},r),arguments[0]);return makeWrapper(t,e,n)}if(2===arguments.length&&"function"==typeof arguments[1])return startRequest(t,e,r,arguments[1],"PUT",{},arguments[0]);if("function"!=typeof arguments[0]){var i;i=arguments[1]?""+arguments[0]:encodeURIComponent(arguments[0]);var s=e.concat(i);return makeWrapper(t,s,r)}})}function startRequest(t,e,r,n,i,s,a){process.nextTick(function(){t.request(i,a,e,r,n,s)});var o;return o=fermatable(function(){return"object"==typeof arguments[0]?(extend(s,arguments[0]),o):"string"==typeof arguments[0]?(i=arguments[0],function(t){a=t}):void 0})}function Site(t){if(extend(this,t),this.base_path&&this.base_path.join&&(this.base_path=this.base_path.join("/")),this.base_url){if(this.url_parts=url.parse(this.base_url,!0),this.url_parts.auth){var e="Basic "+new Buffer(this.url_parts.auth).toString("base64");this.default_headers||(this.default_headers={}),extend(this.default_headers,{Authorization:e})}this.url_parts.query&&(this.default_query||(this.default_query={}),extend(this.default_query,this.url_parts.query)),this.url_parts.pathname&&(this.base_path=path.join(this.url_parts.pathname,this.base_path))}this.base_path=path.resolve("/",this.base_path)}var Proxy=require("node-proxy"),path=require("path"),url=require("url"),qs=require("querystring"),https=require("https"),http=require("http"),counter=0;Site.prototype._url=function(t,e){t.join&&(t=t.join("/")),t=path.resolve("/",t);var e=extend(extend({},this.default_query),arguments[1]);return Object.keys(e).forEach(function(t){if("$"===t[0]){var r=t.slice(1);"$"!==t[1]?e[r]=JSON.stringify(e[t]):e[r]=e[t],delete e[t]}}),e=qs.stringify(e),e&&(e="?"+e),path.join(this.base_path,t)+e},Site.prototype.url=function(){return arguments.length?url.format({protocol:this.url_parts.protocol,hostname:this.url_parts.hostname,port:this.url_parts.port,pathname:this._url(arguments[0],arguments[1])}):makeWrapper(this,[],{})},Site.prototype.stringify=JSON.stringify,Site.prototype.parse=JSON.parse,Site.prototype.request=function(t,e,r,n,i,s){t=t.toUpperCase(),s=extend(extend({"Content-Type":"application/json",Accept:"application/json"},this.default_headers),s);var a="http:"!=this.url_parts.protocol,o=(a?https:http).request({host:this.url_parts.hostname,port:this.url_parts.port,method:t,path:this._url(r,n),headers:s});if(e){var u=this.stringify(e);o.setHeader("Content-Length",Buffer.byteLength(u)),o.write(u)}else o.setHeader("Content-Length",0);o.end();var p=this.parse;o.on("error",function(){i(0,null,"Connection error")}),o.on("response",function(t){t.setEncoding("utf8");var e="";t.on("data",function(t){e+=t}),t.on("end",function(){var r;try{r=p(e)}catch(t){r=null}i(t.statusCode,r,e)})})},exports.Site=Site;
//# sourceMappingURL=fermata.min.js.map