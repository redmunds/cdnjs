"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),cPlayer=function(){function i(t){var e=this;_classCallCheck(this,i);var s={element:document.getElementById("cplayer"),list:[],mdicon:!0},n=this;if(void 0!==Object.assign)this.options=Object.assign({},s,t);else{for(var o in s)this.options[o]=s[o];for(var a in t)this.options[a]=t[a]}if(this.options.mdicon!==!1){var r=document.createElement("link");r.rel="stylesheet","string"==typeof this.options.mdicon?r.href=this.options.mdicon:r.href="https://cdn.bootcss.com/material-design-icons/2.2.3/iconfont/material-icons.css",document.head.appendChild(r)}var l=function(i,t){return void 0!==t?t.getElementsByClassName(i)[0]:e.options.element.getElementsByClassName(i)[0]},c=function(i){return e.options.element.getElementsByTagName(i)[0]};this.now=0,this.dragging={contain:!1,target:void 0},this.options.element.innerHTML='\n    <c-player>\n        <div class="lyric invisible">\n            <lyric-body>\n            </lyric-body>\n        </div>\n        <div class="controls">\n            <div class="c-left">\n                <div class="music-description">\n                    <div class="image">\n                        <img class="meta-bak" src="" alt="">\n                    </div>\n                    <div class="music-meta">\n                        <span class="music-name"></span>\n                        <span class="music-artist"></span>\n                    </div>\n                </div>\n                <a class="play-icon"><i class="material-icons">play_arrow</i></a>\n            </div>\n            <div class="c-center">\n                <div class="time">\n                    <div class="time-body">\n                        <div class="time-line"></div>\n                        <div class="time-point"></div>\n                    </div>\n                </div>\n            </div>\n            <div class="c-right">\n                <div class="volume">\n                    <div class="volume-button">\n                        <a class="volume-power">\n                            <i class="material-icons">volume_up</i>\n                        </a>\n                    </div>\n                    <div class="volume-body">\n                        <div class="volume-line"></div>\n                        <div class="volume-point"></div>\n                    </div>\n                </div>\n                <div class="list-button">\n                    <a class="list-power">\n                        <i class="material-icons">playlist_play</i>\n                    </a>\n                </div>\n                <div class="lyric-button">\n                    <a class="lyric-power">\n                        <i class="material-icons">note</i>\n                    </a>\n                </div>\n            </div>\n        </div>\n\n        <div class="list invisible">\n            <list-body>\n            </list-body>\n        </div>\n    </c-player>',this.__LIST__={lyric:l("lyric"),lyricBody:c("lyric-body"),toggle:l("play-icon"),img:l("meta-bak"),name:l("music-name"),artist:l("music-artist"),time:l("time"),timeLine:l("time-line"),timePoint:l("time-point"),lyricPower:l("lyric-power"),volumePower:l("volume-power"),volumeLine:l("volume-line"),volumePoint:l("volume-point"),listPower:l("list-power"),list:l("list"),listBody:c("list-body")},this.__LIST__.toggleIcon=l("material-icons",this.__LIST__.toggle),this.__LIST__.volumeIcon=l("material-icons",this.__LIST__.volumePower),this.music=new Audio,this.toggle(),n.__LIST__.toggle.addEventListener("click",function(){n.isPaused()?n.play():n.pause()}),n.__LIST__.lyricPower.addEventListener("click",function(){n.hasLyric(n.now)&&n.__LIST__.lyric.classList.contains("invisible")?n.showLyric():n.hasLyric(n.now)&&!n.__LIST__.lyric.classList.contains("invisible")&&n.hideLyric()}),n.__LIST__.listPower.addEventListener("click",function(){n.hasList()&&n.__LIST__.list.classList.contains("invisible")?n.showList():n.hasLyric()&&!n.__LIST__.list.classList.contains("invisible")&&n.hideList()}),n.__LIST__.volumePower.addEventListener("click",function(){n.isMuted()?n.music.muted=!1:n.volume(0)}),n.music.addEventListener("volumechange",function(){n.volume()}),n.music.addEventListener("timeupdate",function(){n.updateTime(),n.hasLyric(n.now)&&n.slideLyric(n.music.currentTime)}),n.music.addEventListener("canplaythrough",function(){}),n.music.addEventListener("pause",function(){n.__LIST__.toggleIcon.innerHTML="play_arrow"}),n.music.addEventListener("play",function(){n.__LIST__.toggleIcon.innerHTML="pause"}),n.music.addEventListener("ended",function(){e.__LIST__.lyricBody.style.transform="",n.__LIST__.toggleIcon.innerHTML="play_arrow",e.hasList()&&e.now!==e.options.list.length-1?e.next():e.options.list[e.now].loop===!0&&(e.updateTime(0),e.play())}),this.options.element.addEventListener("mousedown",function(i){return e.dragPercentage(i)}),this.options.element.addEventListener("mousemove",function(i){return e.dragPercentage(i)}),this.options.element.addEventListener("mouseup",function(i){return e.dragPercentage(i)}),this.volume(),this.refreshList()}return _createClass(i,[{key:"dragPercentage",value:function(i){switch(i.type){case"mousedown":if(i.target===this.__LIST__.timePoint&&i.target===this.__LIST__.volumePoint)return;this.dragging.contain=!0,this.dragging.target=i.target;break;case"mousemove":if(this.dragging.contain===!1)return;if(this.dragging.target.parentNode.classList.contains("volume-body")?this.__LIST__.volumeLine.style.width=(i.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth*100+"%":this.dragging.target.parentNode.classList.contains("time-body")&&(this.__LIST__.timeLine.style.width=(i.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth*100+"%"),this.dragging.target.parentNode.classList.contains("volume-body")){var t=(i.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;t=t>1?1:t,t=t<0?0:t,this.music.volume=t}break;case"mouseup":if(this.dragging.contain===!1)return;if(this.dragging.target.parentNode.classList.contains("volume-body")){var e=(i.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;e=e>1?1:e,e=e<0?0:e,this.music.volume=e}else if(this.dragging.target.parentNode.classList.contains("time-body")){var s=(i.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;s=s>1?1:s,s=s<0?0:s,this.music.currentTime=s*this.music.duration}this.dragging.contain=!1,this.dragging.target=void 0}}},{key:"volume",value:function(){var i=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];return void 0===i?(this.__LIST__.volumeLine.style.width=100*this.music.volume+"%",this.isMuted()||(this.__LIST__.volumeIcon.innerHTML="volume_up"),this.isMuted()?0:this.music.volume):void(0===i?(this.music.muted=!0,this.__LIST__.volumeIcon.innerHTML="volume_mute"):(this.music.volume=i,this.__LIST__.volumeIcon.innerHTML="volume_up"))}},{key:"isMuted",value:function(){return this.music.muted}},{key:"play",value:function(){if(this.music.seeking!==!0)return this.music.play().then(function(){console.log("It starts playing......")})["catch"](function(i){console.warn(i),console.log("Maybe The problem is that the music hasn't been loaded,you can send a Loading Request again by using `sth.load()` there.")}),this.now}},{key:"pause",value:function(){if(this.music.seeking!==!0)return this.music.pause(),this.now}},{key:"last",value:function(){0!==this.now&&(this.now--,this.toggle(),this.play())}},{key:"next",value:function(){this.now!==this.options.list.length-1&&(this.now++,this.toggle(),this.play())}},{key:"to",value:function(i){this.now=i,this.toggle(),this.play()}},{key:"toggle",value:function(){var i=arguments.length<=0||void 0===arguments[0]?this.now:arguments[0],t=this.options.list[i],e=this.__LIST__,s=[t.image,t.name,t.artist,t.url];e.img.src=s[0],e.name.innerHTML=s[1],e.artist.innerHTML=s[2],this.music.src=s[3],this.refreshLyric(),this.hasLyric(this.now)||this.hideLyric(),this.__LIST__.lyricBody.style.transform=""}},{key:"isPaused",value:function(){return this.music.paused}},{key:"hasLyric",value:function(){var i=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return void 0!==this.options.list[i].lyric}},{key:"showLyric",value:function(){return this.hasLyric(this.now)&&this.__LIST__.lyric.classList.remove("invisible"),this.__LIST__.list.classList.contains("invisible")||this.hideList(),this}},{key:"hideLyric",value:function(){return this.__LIST__.lyric.classList.add("invisible"),this}},{key:"hasList",value:function(){return this.options.list.length>1}},{key:"showList",value:function(){return this.__LIST__.list.classList.remove("invisible"),this.__LIST__.lyric.classList.contains("invisible")||this.hideLyric(),this}},{key:"hideList",value:function(){return this.__LIST__.list.classList.add("invisible"),this}},{key:"refreshList",value:function(){var i=this,t=this.options.list,e=this.__LIST__.listBody;e.innerHTML="";for(var s=function(s){var n=document.createElement("div");n.innerHTML='<span class="music-name">'+t[s].name+'</span><span class="music-artist">'+t[s].artist+"</span>",n=e.appendChild(n),n.addEventListener("click",function(){i.to(s)})},n=0;n<=t.length-1;n++)s(n)}},{key:"add",value:function(i){var t=this,e=this.options.list.push(i),s=document.createElement("div");s.innerHTML='<span class="music-name">'+i.name+'</span><span class="music-artist">'+i.artist+"</span>",s=this.__LIST__.listBody.appendChild(s),s.addEventListener("click",function(){t.to(e-1)})}},{key:"lyric",value:function(){var i=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];if(void 0===i){if(this.hasLyric(this.now))return this.options.list[this.now].lyric}else this.options.list[this.now].lyric=i,this.refreshLyric()}},{key:"refreshLyric",value:function(){if(this.__LIST__.lyricBody.innerHTML="",this.hasLyric(this.now)){var i=this.options.list[this.now].lyric;i=i.split("\n");var t=[],e=!0,s=!1,n=void 0;try{for(var o,a=i[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var r=o.value;if("string"!=typeof r)break;for(var l=r.split(/\[|\]\[|\]/gi),c=0;c<l.length-1;c++)if(""!==l[c]||c===l.length-1){if(l[c].match(/\d{1,}\:\d{1,}/gi)){var d=l[c].split(/\:|\./gi);switch(d.length){case 2:l[c]=60*parseInt(d[0])+parseInt(d[1]);break;case 3:l[c]=60*parseInt(d[0])+parseInt(d[1])+parseFloat("0."+d[2]);break;default:throw new Error("Time not be Found!")}}}else l.splice(c,1),c--;t.push(l)}}catch(h){s=!0,n=h}finally{try{!e&&a["return"]&&a["return"]()}finally{if(s)throw n}}for(var u=[],_=t.length-1;_>=0;_--)if(t[_].length>2)for(var v=t[_].length-1;v>=0;v--)v!==t[_].length-1&&u.push({time:t[_][v],content:t[_][t[_].length-1]});else u.push({time:t[_][0],content:t[_][1]});u.sort(function(i,t){return i.time-t.time}),this.__LYRIC__=u;for(var m=0;m<=u.length-1;m++){var g=document.createElement("lrc");g.innerHTML=u[m].content,this.__LIST__.lyricBody.appendChild(g)}}}},{key:"updateTime",value:function(){var i=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];return void 0!==i&&(this.music.currentTime=parseInt(i)),this.dragging.contain===!1&&(this.__LIST__.timeLine.style.width=this.music.currentTime/this.music.duration*100+"%"),this.music.currentTime}},{key:"slideLyric",value:function(i){if(!this.__LIST__.lyric.classList.contains("invisible"))for(var t=this.__LYRIC__.length-1;t>=0;t--)(void 0!==this.__LYRIC__[t+1]&&this.__LYRIC__[t].time<i&&this.__LYRIC__[t+1].time>i||void 0===this.__LYRIC__[t+1]&&this.__LYRIC__[t].time<i)&&(null!==this.__LIST__.lyricBody.querySelector(".now")&&this.__LIST__.lyricBody.querySelector(".now")!==this.__LIST__.lyricBody.childNodes[t+1]&&this.__LIST__.lyricBody.querySelector(".now").classList.toggle("now"),this.__LIST__.lyricBody.childNodes[t].classList.toggle("now"),this.__LIST__.lyricBody.style.transform="translateY(-"+parseInt(this.__LIST__.lyricBody.childNodes[t].offsetTop-this.__LIST__.lyric.offsetTop-.4*this.__LIST__.lyric.clientHeight)+"px)")}}]),i}();