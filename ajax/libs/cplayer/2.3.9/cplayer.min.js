"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),cPlayer=function(){function e(t){var i=this;_classCallCheck(this,e);var s={play:[],pause:[],volumechange:[],timeupdate:[],canplaythrough:[],ended:[],toggle:[],previous:[],next:[],changeList:[],changeLyric:[],slideList:[],slideLyric:[],clickLyricPower:[],clickListPower:[],clickVolumePower:[]};this.emitter=new cEmitter(s),this.on=function(e,t){return i.emitter.on(e,t)};var n={element:document.getElementById("cplayer"),list:[]};void 0!==Object.assign&&(this.options=Object.assign({},n,t)),this.SVG={playArrow:"M16 10v28l22-14z",pause:"M12 38h8V10h-8v28zm16-28v28h8V10h-8z",playlistPlay:"M26 6H-8v4h34V6zm0-8H-8v4h34v-4zM-8 18h26v-4H-8v4zm30-4v12l10-6-10-6z",note:"M44 20L32 8H8c-2.2 0-4 1.8-4 4v24.02C4 38.22 5.8 40 8 40l32-.02c2.2 0 4-1.78 4-3.98V20zm-14-9l11 11H30V11z",volumeUp:"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z",volumeMute:"M14 18v12h8l10 10V8L22 18h-8z",volumeOff:"M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13c2.75-.63 5.26-1.89 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z",volumeDown:"M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"},function(){for(var e=0,t=Object.keys(i.SVG),s=t.length;e<s;e++){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");"playlistPlay"===t[e]?(n.setAttribute("viewBox","-12 -12 48 48"),n.setAttribute("enable-background","new -12 -12 48 48")):n.setAttribute("viewBox","0 0 48 48"),n="playlistPlay"===t[e]?'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="-12 -12 48 48" enable-background="new -12 -12 48 48"><path d="'+i.SVG[t[e]]+'"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 48 48"><path d="'+i.SVG[t[e]]+'"/></svg>',i.SVG[t[e]]=n}}(),this.CBASE=new cBase,this.now=0,this.dragging={contain:!1,target:void 0},function(){var e=document.createElement("c-player"),t=document.createElement("div");t.classList.add("lyric"),t.classList.add("invisible");var s=document.createElement("lyric-body");t.appendChild(s);var n=document.createElement("div");n.classList.add("controls");var a=document.createElement("div");a.classList.add("c-left");var r=document.createElement("div");r.classList.add("music-description");var o=document.createElement("div");o.classList.add("image");var l=document.createElement("img");l.classList.add("meta-bak"),o.appendChild(l);var c=document.createElement("div");c.classList.add("music-meta");var d=document.createElement("div"),h=document.createElement("span");h.classList.add("music-name");var u=document.createElement("span");u.classList.add("music-artist"),d.appendChild(h),d.appendChild(u),c.appendChild(d),r.appendChild(o),r.appendChild(c);var m=document.createElement("a");m.classList.add("play-icon"),i.CBASE.replaceInner(m,i.SVG.playArrow),a.appendChild(r),a.appendChild(m);var v=document.createElement("div");v.classList.add("c-center");var g=document.createElement("div");g.classList.add("time");var p=document.createElement("div");p.classList.add("time-body");var _=document.createElement("div");_.classList.add("time-line");var y=document.createElement("div");y.classList.add("time-point"),p.appendChild(_),p.appendChild(y),g.appendChild(p),v.appendChild(g);var L=document.createElement("div");L.classList.add("c-right");var f=document.createElement("div");f.classList.add("volume");var w=document.createElement("div");w.classList.add("volume-button");var C=document.createElement("a");C.classList.add("volume-power"),i.CBASE.replaceInner(C,i.SVG.volumeOff),w.appendChild(C);var E=document.createElement("div");E.classList.add("volume-body");var S=document.createElement("div");S.classList.add("volume-line");var B=document.createElement("div");B.classList.add("volume-point"),E.appendChild(S),E.appendChild(B),f.appendChild(w),f.appendChild(E);var T=document.createElement("div");T.classList.add("list-button");var I=document.createElement("a");I.classList.add("list-power"),i.CBASE.replaceInner(I,i.SVG.playlistPlay),T.appendChild(I);var b=document.createElement("div");b.classList.add("lyric-button");var k=document.createElement("a");k.classList.add("lyric-power"),i.CBASE.replaceInner(k,i.SVG.note),b.appendChild(k),L.appendChild(f),L.appendChild(T),L.appendChild(b),n.appendChild(a),n.appendChild(v),n.appendChild(L);var A=document.createElement("div");A.classList.add("list"),A.classList.add("invisible");var P=document.createElement("list-body");A.appendChild(P),e.appendChild(t),e.appendChild(n),e.appendChild(A),i.options.element.appendChild(e)}(),this.CBASE.root=this.options.element.getElementsByTagName("c-player"),this.CBASE.root=this.CBASE.root[this.CBASE.root.length-1],this.__LIST__={lyric:this.CBASE.getByClass("lyric"),lyricBody:this.CBASE.getByTagName("lyric-body"),toggle:this.CBASE.getByClass("play-icon"),img:this.CBASE.getByClass("meta-bak"),name:this.CBASE.getByClass("music-name"),artist:this.CBASE.getByClass("music-artist"),time:this.CBASE.getByClass("time"),timeLine:this.CBASE.getByClass("time-line"),timePoint:this.CBASE.getByClass("time-point"),lyricPower:this.CBASE.getByClass("lyric-power"),volumePower:this.CBASE.getByClass("volume-power"),volumeLine:this.CBASE.getByClass("volume-line"),volumePoint:this.CBASE.getByClass("volume-point"),listPower:this.CBASE.getByClass("list-power"),list:this.CBASE.getByClass("list"),listBody:this.CBASE.getByTagName("list-body")},this.__LIST__.toggleIcon=this.CBASE.getByTagName("svg",this.__LIST__.toggle),this.__LIST__.volumeIcon=this.CBASE.getByTagName("svg",this.__LIST__.volumePower),this.music=document.createElement("audio"),this.music.autoplay=!!this.options.autoplay,this.emitter.on("toggle",function(){i.isPaused()?i.play():i.pause()}).on("clickLyricPower",function(){i.hasLyric(i.now)&&i.__LIST__.lyric.classList.contains("invisible")?i.showLyric():i.hasLyric(i.now)&&!i.__LIST__.lyric.classList.contains("invisible")&&i.hideLyric()}).on("clickListPower",function(){i.hasList()&&i.__LIST__.list.classList.contains("invisible")?i.showList():i.hasLyric()&&!i.__LIST__.list.classList.contains("invisible")&&i.hideList()}).on("clickVolumePower",function(){i.isMuted()?i.music.muted=!1:i.volume(0)}).on("timeupdate",function(){i.hasLyric(i.now)&&i.slideLyric(i.music.currentTime)}).on("volumechange",function(){i.volume()}).on("pause",function(){i.CBASE.replaceInner(i.__LIST__.toggle,i.SVG.playArrow)}).on("play",function(){i.CBASE.replaceInner(i.__LIST__.toggle,i.SVG.pause),i.__LIST__.toggleIcon=i.CBASE.getByTagName("svg",i.__LIST__.toggle)}).on("ended",function(){i.CBASE.style(i.__LIST__.lyricBody,"transform",""),i.options.list[i.now].loop===!0?(i.updateTime(0),i.play()):i.hasList()&&i.now!==i.options.list.length-1&&i.next()}),this.options.list[0]&&this.toggle(),this.__LIST__.toggle.addEventListener("click",function(){return i.emitter.emit("toggle")}),this.__LIST__.lyricPower.addEventListener("click",function(){return i.emitter.emit("clickLyricPower")}),this.__LIST__.listPower.addEventListener("click",function(){return i.emitter.emit("clickListPower")}),this.__LIST__.volumePower.addEventListener("click",function(){return i.emitter.emit("clickVolumePower")}),this.music.addEventListener("volumechange",function(e){return i.emitter.emit("volumechange",e)}),this.music.addEventListener("timeupdate",function(e){return i.emitter.emit("timeupdate",e)}),this.music.addEventListener("canplaythrough",function(){return i.emitter.emit("canplaythrough")}),this.music.addEventListener("pause",function(){return i.emitter.emit("pause")}),this.music.addEventListener("play",function(){return i.emitter.emit("play")}),this.music.addEventListener("ended",function(){return i.emitter.emit("ended")}),this.options.element.addEventListener("mousedown",function(e){return i.dragPercentage(e)}),this.options.element.addEventListener("mousemove",function(e){return i.dragPercentage(e)}),this.options.element.addEventListener("mouseup",function(e){return i.dragPercentage(e)}),(this.music.onplay=void 0)&&Object.defineProperty(music,"paused",{set:function(e){(e=!0)?this.emitter.emit("pause"):this.emitter.emit("play")}}),this.volume(),this.refreshList()}return _createClass(e,[{key:"dragPercentage",value:function(e){switch(e.type){case"mousedown":if(e.target===this.__LIST__.timePoint&&e.target===this.__LIST__.volumePoint)return;this.dragging.contain=!0,this.dragging.target=e.target;break;case"mousemove":if(this.dragging.contain===!1)return;if(this.dragging.target.parentNode.classList.contains("volume-body")?this.__LIST__.volumeLine.style.width=(e.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth*100+"%":this.dragging.target.parentNode.classList.contains("time-body")&&(this.__LIST__.timeLine.style.width=(e.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth*100+"%"),this.dragging.target.parentNode.classList.contains("volume-body")){var t=(e.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;t=t>1?1:t,t=t<0?0:t,this.music.volume=t}break;case"mouseup":if(this.dragging.contain===!1)return;if(this.dragging.target.parentNode.classList.contains("volume-body")){var i=(e.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;i=i>1?1:i,i=i<0?0:i,this.music.volume=i}else if(this.dragging.target.parentNode.classList.contains("time-body")){var s=(e.clientX-this.dragging.target.parentNode.offsetLeft)/this.dragging.target.parentNode.offsetWidth;s=s>1?1:s,s=s<0?0:s,this.updateTime(s*this.music.duration)}this.dragging.contain=!1,this.dragging.target=void 0}}},{key:"volume",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=function(){0===e.music.volume||e.isMuted()?(e.CBASE.replaceInner(e.__LIST__.volumePower,e.SVG.volumeOff),e.__LIST__.volumeIcon=e.CBASE.getByTagName("svg",e.__LIST__.volumePower)):e.music.volume>0&&e.music.volume<=.5?(e.CBASE.replaceInner(e.__LIST__.volumePower,e.SVG.volumeDown),e.__LIST__.volumeIcon=e.CBASE.getByTagName("svg",e.__LIST__.volumePower)):e.music.volume>.5&&e.music.volume<=1?(e.CBASE.replaceInner(e.__LIST__.volumePower,e.SVG.volumeUp),e.__LIST__.volumeIcon=e.CBASE.getByTagName("svg",e.__LIST__.volumePower)):console.log("Unexcepted Volume:"+e.music.volume)};return void 0===t?(this.__LIST__.volumeLine.style.width=100*this.music.volume+"%",i(),this.isMuted()?0:this.music.volume):void(0===t?(this.music.muted=!0,i()):(this.music.volume=t,i()))}},{key:"isMuted",value:function(){return this.music.muted}},{key:"play",value:function(){var e=this;return this.interval=setInterval(function(){e.dragging.contain===!1&&(e.__LIST__.timeLine.style.width=e.music.currentTime/e.music.duration*100+"%")},500),this.music.seeking===!0?this:(this.music.play(),this)}},{key:"pause",value:function(){if(this.music.seeking!==!0)return clearInterval(this.interval),this.music.pause(),this}},{key:"previous",value:function(){if(this.emitter.emit("previous"),0!==this.now)return this.now--,this.toggle().play(),this}},{key:"next",value:function(){if(this.emitter.emit("next"),this.now!==this.options.list.length-1)return this.now++,this.toggle().play(),this}},{key:"to",value:function(e){return this.now=e,this.toggle(),this.play(),this}},{key:"toggle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.now;this.emitter.emit("toggle");var t=this.options.list[e],i=this.__LIST__;this.music.pause();var s=[t.image,t.name,t.artist,t.url];return i.img.src=s[0],i.name.innerHTML=s[1],i.artist.innerHTML=s[2],this.music.src=s[3],this.refreshLyric(),this.hasLyric(this.now)||this.hideLyric(),this.CBASE.style(this.__LIST__.lyricBody,"transform",""),this}},{key:"isPaused",value:function(e){return void 0!==e&&e(),this.music.paused}},{key:"hasLyric",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1];return void 0!==t&&t(),void 0!=this.options.list[e].lyric}},{key:"showLyric",value:function(){return this.emitter.emit("slideLyric",!0),this.hasLyric(this.now)&&this.__LIST__.lyric.classList.remove("invisible"),this.__LIST__.list.classList.contains("invisible")||this.hideList(),this}},{key:"hideLyric",value:function(){return this.emitter.emit("slideLyric",!1),this.__LIST__.lyric.classList.add("invisible"),this}},{key:"hasList",value:function(e){return void 0!==e&&e(),this.options.list.length>1}},{key:"showList",value:function(e){return this.emitter.emit("slideList",!0),this.__LIST__.list.classList.remove("invisible"),this.__LIST__.lyric.classList.contains("invisible")||this.hideLyric(),void 0!==e&&e(),this}},{key:"hideList",value:function(e){return this.emitter.emit("slideList",!1),this.__LIST__.list.classList.add("invisible"),void 0!==e&&e(),this}},{key:"refreshList",value:function(e){var t=this;this.emitter.emit("changeList");var i=this.options.list,s=this.__LIST__.listBody;s.innerHTML="";for(var n=function(e){var n=document.createElement("div");n.innerHTML='<span class="music-name">'+i[e].name+'</span><span class="music-artist">'+i[e].artist+"</span>",n=s.appendChild(n),n.addEventListener("click",function(){t.to(e)})},a=0;a<=i.length-1;a++)n(a);void 0!==e&&e()}},{key:"add",value:function(e,t){var i=this,s=this.options.list.push(e),n=document.createElement("div");n.innerHTML='<span class="music-name">'+e.name+'</span><span class="music-artist">'+e.artist+"</span>",n=this.__LIST__.listBody.appendChild(n),n.addEventListener("click",function(){i.to(s-1)}),1===s&&this.toggle(),void 0!==t&&t()}},{key:"lyric",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(void 0===e){if(this.hasLyric(this.now))return this.options.list[this.now].lyric}else this.options.list[this.now].lyric=e,this.refreshLyric();return this}},{key:"refreshLyric",value:function(){if(this.__LIST__.lyricBody.innerHTML="",this.hasLyric(this.now)){var e=this.options.list[this.now].lyric;e=e.split("\n");for(var t=[],i=0,s=e[i];i<e.length&&"string"==typeof s;i++,s=e[i]){for(var n=s.split(/\[|\]\[|\]/gi),a=0;a<n.length-1;a++)if(""===n[a]&&a!==n.length-1||null===n[a].match(/\d{1,}\:\d{1,}/gi))n.splice(a,1),a--;else if(n[a].match(/\d{1,}\:\d{1,}/gi)){var r=n[a].split(/\:|\./gi);switch(r.length){case 2:n[a]=60*parseInt(r[0])+parseInt(r[1]);break;case 3:n[a]=60*parseInt(r[0])+parseInt(r[1])+parseFloat("0."+r[2]);break;default:throw new Error("Time not be Found!")}}t.push(n)}for(var o=[],l=t.length-1;l>=0;l--)if(t[l].length>2)for(var c=t[l].length-1;c>=0;c--)c!==t[l].length-1&&void 0!==t[l][t[l].length-1]&&o.push({time:t[l][c],content:t[l][t[l].length-1]});else void 0!==t[l][1]&&o.push({time:t[l][0],content:t[l][1]});o.sort(function(e,t){return e.time-t.time}),o.now=0,this.__LYRIC__=o;for(var d=0;d<=o.length-1;d++){var h=document.createElement("lrc");h.innerHTML=o[d].content,this.__LIST__.lyricBody.appendChild(h)}this.emitter.emit("changeLyric")}}},{key:"updateTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments[1];void 0!==e&&(this.music.currentTime=e),void 0!==t&&t(this.music.currentTime)}},{key:"slideLyric",value:function(e){if(!this.__LIST__.lyric.classList.contains("invisible"))for(var t=void 0,i=void 0,s=void 0,n=this.__LIST__.lyricBody,a=this.__LIST__.lyricBody.getElementsByTagName("lrc"),r=this.__LYRIC__,o=r.length,l=0;l<o;l++)if(void 0===r[l+1]||r[l].time<e&&r[l+1].time<e||0===r.now&&r[l].time<e&&r[l+1].time>e){if(void 0===r[l+1])break;if(r.now===l){0===r.now&&r[l].time<e&&r[l+1].time>e||r.now++,a[l].classList.contains("now")&&a[l].classList.remove("now"),a[r.now].classList.add("now"),t=n.childNodes[r.now].offsetTop-n.childNodes[0].offsetTop-.5*n.childNodes[r.now].clientHeight,i=.5*this.__LIST__.lyric.clientHeight-n.childNodes[l].clientHeight,s=-(t-i),this.CBASE.style(n,"transform","translateY("+s+"px)");break}}else;}},{key:"length",get:function(){return this.options.list.length},set:function(e){throw new SyntaxError("Read-only Property.")}}]),e}();"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var i=arguments[t];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e});var cEmitter=function(){function e(t){_classCallCheck(this,e),t?this.events=t:this.events=[]}return _createClass(e,[{key:"on",value:function(e,t){if(this.events[e]&&void 0!==this.events[e].push&&"function"==typeof t)this.events[e].push(t);else{if(void 0!==this.events[e]&&void 0!==this.events[e].push)throw new TypeError("Uncaught Unexcepted TypeError.");this.events[e]=[]}return this}},{key:"emit",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];for(var n=0;n<this.events[e].length;n++)this.events[e][n](i);return this}}]),e}(),cBase=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement;_classCallCheck(this,e),this.root=t;for(var i=document.documentElement.style,s=i.length;s>0;s--){if(i[s].indexOf("-webkit-")!==-1){this.browser="webkit";break}if(i[s].indexOf("-moz-")!==-1){this.browser="moz";break}if(i[s].indexOf("-o-")!==-1){this.browser="o";break}if(i[s].indexOf("-ms-")!==-1){this.browser="ms";break}}}return _createClass(e,[{key:"replace",value:function(e,t){t=t.cloneNode(!0),e.parentNode.appendChild(t),e.parentNode.removeChild(e)}},{key:"replaceInner",value:function(e,t){e.innerHTML=t}},{key:"getByClass",value:function(e,t){return void 0!=t?t.getElementsByClassName(e)[0]:this.root.getElementsByClassName(e)[0]}},{key:"getByTagName",value:function(e,t){return void 0!=t?t.getElementsByTagName(e)[0]:this.root.getElementsByTagName(e)[0]}},{key:"rand",value:function(e,t){if(void 0===e||void 0===t)return Math.random();if(e>t)throw new RangeError("the EndNumber must be bigger than the StartNumber");return(t-e)*Math.random()+e}},{key:"style",value:function(e,t,i){e.style[this.browser+t.slice(0,1).toUpperCase()+t.slice(1)]=i,e.style[t]=i}}]),e}();