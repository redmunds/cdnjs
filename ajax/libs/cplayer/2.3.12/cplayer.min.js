"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),cPlayer=function(){function e(t){function i(e){var t=[];t.push(e.target===r.__LIST__.timePoint||e.target===r.__LIST__.volumePoint),t.push(e.target===r.__LIST__.timeLine||e.target===r.__LIST__.volumeLine),t.push(e.target===r.__LIST__.timePoint||e.target===r.__LIST__.volumePoint||e.target===r.__LIST__.timeBody||e.target===r.__LIST__.volumeBody||e.target===r.__LIST__.timeLine||e.target===r.__LIST__.volumeLine),t[2]&&(r.dragging.contain=!0,r.dragging.target=e.target,t[0]&&window.addEventListener("mousemove",function i(e){if(r.dragging.contain!==!1&&t[0]){if(parent=r.dragging.target.parentNode.parentNode,parent.classList&&parent.classList.contains("volume-body")?r.__LIST__.volumeLine.style.width=(e.clientX-parent.offsetLeft)/parent.offsetWidth*100+"%":parent.classList&&parent.classList.contains("time-body")&&(r.__LIST__.timeLine.style.width=(e.clientX-parent.offsetLeft)/parent.offsetWidth*100+"%"),parent.classList.contains("volume-body")){var s=(e.clientX-parent.offsetLeft)/parent.offsetWidth;s=s>1?1:s,s=s<0?0:s,r.music.volume=s}window.addEventListener("mouseup",function n(e){if(r.dragging.contain!==!1){if(t[0])parent=r.dragging.target.parentNode.parentNode;else if(t[1])parent=r.dragging.target.parentNode;else{if(!t[2])throw new Error(JSON.stringify([r.dragging.target,t]));parent=r.dragging.target}if(parent.classList.contains("volume-body")){var s=(e.clientX-parent.offsetLeft)/parent.offsetWidth;s=s>1?1:s,s=s<0?0:s,r.music.volume=s}else if(parent.classList.contains("time-body")){var a=(e.clientX-parent.offsetLeft)/parent.offsetWidth;a=a>1?1:a,a=a<0?0:a,r.updateTime(a*r.music.duration)}r.dragging.contain=!1,r.dragging.target=void 0,window.removeEventListener("mouseup",n),window.removeEventListener("mousemove",i)}})}}),t[0]||window.addEventListener("mouseup",function s(e){if(r.dragging.contain!==!1){if(t[0])parent=r.dragging.target.parentNode.parentNode;else if(t[1])parent=r.dragging.target.parentNode;else{if(!t[2])throw new Error(JSON.stringify([r.dragging.target,t]));parent=r.dragging.target}if(parent.classList.contains("volume-body")){var i=(e.clientX-parent.offsetLeft)/parent.offsetWidth;i=i>1?1:i,i=i<0?0:i,r.music.volume=i}else if(parent.classList.contains("time-body")){var n=(e.clientX-parent.offsetLeft)/parent.offsetWidth;n=n>1?1:n,n=n<0?0:n,r.updateTime(n*r.music.duration)}r.dragging.contain=!1,r.dragging.target=void 0,window.removeEventListener("mouseup",s)}}))}var s=this;_classCallCheck(this,e),this.transLock=!1;var n={play:[],pause:[],volumechange:[],timeupdate:[],canplaythrough:[],ended:[],toggle:[],previous:[],next:[],changeList:[],changeLyric:[],slideList:[],slideLyric:[],clickLyricPower:[],clickListPower:[],clickVolumePower:[]};this.emitter=new cEmitter(n),this.on=function(e,t){return s.emitter.on(e,t)};var a={element:document.getElementById("cplayer"),list:[]};void 0!==Object.assign&&(this.options=Object.assign({},a,t)),this.SVG={playArrow:"M16 10v28l22-14z",pause:"M12 38h8V10h-8v28zm16-28v28h8V10h-8z",playlistPlay:"M26 6H-8v4h34V6zm0-8H-8v4h34v-4zM-8 18h26v-4H-8v4zm30-4v12l10-6-10-6z",note:"M44 20L32 8H8c-2.2 0-4 1.8-4 4v24.02C4 38.22 5.8 40 8 40l32-.02c2.2 0 4-1.78 4-3.98V20zm-14-9l11 11H30V11z",volumeUp:"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z",volumeMute:"M14 18v12h8l10 10V8L22 18h-8z",volumeOff:"M33 24c0-3.53-2.04-6.58-5-8.05v4.42l4.91 4.91c.06-.42.09-.85.09-1.28zm5 0c0 1.88-.41 3.65-1.08 5.28l3.03 3.03C41.25 29.82 42 27 42 24c0-8.56-5.99-15.72-14-17.54v4.13c5.78 1.72 10 7.07 10 13.41zM8.55 6L6 8.55 15.45 18H6v12h8l10 10V26.55l8.51 8.51c-1.34 1.03-2.85 1.86-4.51 2.36v4.13c2.75-.63 5.26-1.89 7.37-3.62L39.45 42 42 39.45l-18-18L8.55 6zM24 8l-4.18 4.18L24 16.36V8z",volumeDown:"M37 24c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zm-27-6v12h8l10 10V8L18 18h-8z"},function(){for(var e=0,t=Object.keys(s.SVG),i=t.length;e<i;e++){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");"playlistPlay"===t[e]?(n.setAttribute("viewBox","-12 -12 48 48"),n.setAttribute("enable-background","new -12 -12 48 48")):n.setAttribute("viewBox","0 0 48 48"),n="playlistPlay"===t[e]?'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="-12 -12 48 48" enable-background="new -12 -12 48 48"><path d="'+s.SVG[t[e]]+'"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 48 48"><path d="'+s.SVG[t[e]]+'"/></svg>',s.SVG[t[e]]=n}}(),this.CBASE=new cBase,this.now=0,this.dragging={contain:!1,target:void 0},function(){var e=document.createElement("c-player"),t=document.createElement("div");t.classList.add("lyric"),t.classList.add("invisible");var i=document.createElement("lyric-body");t.appendChild(i);var n=document.createElement("div");n.classList.add("controls");var a=document.createElement("div");a.classList.add("c-left");var r=document.createElement("div");r.classList.add("music-description");var o=document.createElement("div");o.classList.add("image");var l=document.createElement("img");l.classList.add("meta-bak"),o.appendChild(l);var c=document.createElement("div");c.classList.add("music-meta");var d=document.createElement("div"),u=document.createElement("span");u.classList.add("music-name");var h=document.createElement("span");h.classList.add("music-artist"),d.appendChild(u),d.appendChild(h),c.appendChild(d),r.appendChild(o),r.appendChild(c);var m=document.createElement("a");m.classList.add("play-icon"),s.CBASE.replaceInner(m,s.SVG.playArrow),a.appendChild(r),a.appendChild(m);var v=document.createElement("div");v.classList.add("c-center");var _=document.createElement("div");_.classList.add("time");var p=document.createElement("div");p.classList.add("time-body");var g=document.createElement("div");g.classList.add("time-line");var L=document.createElement("div");L.classList.add("time-point"),g.appendChild(L),p.appendChild(g),_.appendChild(p),v.appendChild(_);var y=document.createElement("div");y.classList.add("c-right");var f=document.createElement("div");f.classList.add("volume");var w=document.createElement("div");w.classList.add("volume-button");var C=document.createElement("a");C.classList.add("volume-power"),s.CBASE.replaceInner(C,s.SVG.volumeOff),w.appendChild(C);var S=document.createElement("div");S.classList.add("volume-body");var E=document.createElement("div");E.classList.add("volume-line");var B=document.createElement("div");B.classList.add("volume-point"),E.appendChild(B),S.appendChild(E),f.appendChild(w),f.appendChild(S);var T=document.createElement("div");T.classList.add("list-button");var I=document.createElement("a");I.classList.add("list-power"),s.CBASE.replaceInner(I,s.SVG.playlistPlay),T.appendChild(I);var b=document.createElement("div");b.classList.add("lyric-button");var k=document.createElement("a");k.classList.add("lyric-power"),s.CBASE.replaceInner(k,s.SVG.note),b.appendChild(k),y.appendChild(f),y.appendChild(T),y.appendChild(b),n.appendChild(a),n.appendChild(v),n.appendChild(y);var A=document.createElement("div");A.classList.add("list"),A.classList.add("invisible");var P=document.createElement("list-body");A.appendChild(P),e.appendChild(t),e.appendChild(n),e.appendChild(A),s.options.element.appendChild(e)}(),this.CBASE.root=this.options.element.getElementsByTagName("c-player"),this.CBASE.root=this.CBASE.root[this.CBASE.root.length-1],this.__LIST__={lyric:this.CBASE.getByClass("lyric"),lyricBody:this.CBASE.getByTagName("lyric-body"),toggle:this.CBASE.getByClass("play-icon"),img:this.CBASE.getByClass("meta-bak"),name:this.CBASE.getByClass("music-name"),artist:this.CBASE.getByClass("music-artist"),time:this.CBASE.getByClass("time"),timeBody:this.CBASE.getByClass("time-body"),timeLine:this.CBASE.getByClass("time-line"),timePoint:this.CBASE.getByClass("time-point"),lyricPower:this.CBASE.getByClass("lyric-power"),volumePower:this.CBASE.getByClass("volume-power"),volumeBody:this.CBASE.getByClass("volume-body"),volumeLine:this.CBASE.getByClass("volume-line"),volumePoint:this.CBASE.getByClass("volume-point"),listPower:this.CBASE.getByClass("list-power"),list:this.CBASE.getByClass("list"),listBody:this.CBASE.getByTagName("list-body")},this.__LIST__.toggleIcon=this.CBASE.getByTagName("svg",this.__LIST__.toggle),this.__LIST__.volumeIcon=this.CBASE.getByTagName("svg",this.__LIST__.volumePower);var r=this;this.music=document.createElement("audio"),this.music.autoplay=!!this.options.autoplay,this.emitter.on("toggle",function(){s.isPaused()?s.play():s.pause()}).on("clickLyricPower",function(){s.hasLyric(s.now)&&s.__LIST__.lyric.classList.contains("invisible")?s.showLyric():s.hasLyric(s.now)&&!s.__LIST__.lyric.classList.contains("invisible")&&s.hideLyric()}).on("clickListPower",function(){s.hasList()&&s.__LIST__.list.classList.contains("invisible")?s.showList():s.hasLyric()&&!s.__LIST__.list.classList.contains("invisible")&&s.hideList()}).on("clickVolumePower",function(){s.isMuted()?s.music.muted=!1:s.volume(0)}).on("timeupdate",function(){s.updateTime(),s.hasLyric(s.now)&&s.slideLyric(s.music.currentTime)}).on("volumechange",function(){s.volume()}).on("pause",function(){s.CBASE.replaceInner(s.__LIST__.toggle,s.SVG.playArrow)}).on("play",function(){s.CBASE.replaceInner(s.__LIST__.toggle,s.SVG.pause),s.__LIST__.toggleIcon=s.CBASE.getByTagName("svg",s.__LIST__.toggle)}).on("ended",function(){s.CBASE.style(s.__LIST__.lyricBody,"transform",""),s.options.list[s.now].loop===!0?(s.updateTime(0),s.play()):s.hasList()&&s.now!==s.options.list.length-1&&s.next()}),this.options.list[0]&&this.toggle(),this.__LIST__.toggle.addEventListener("click",function(){return s.emitter.emit("toggle")}),this.__LIST__.lyricPower.addEventListener("click",function(){return s.emitter.emit("clickLyricPower")}),this.__LIST__.listPower.addEventListener("click",function(){return s.emitter.emit("clickListPower")}),this.__LIST__.volumePower.addEventListener("click",function(){return s.emitter.emit("clickVolumePower")}),this.music.addEventListener("volumechange",function(e){return s.emitter.emit("volumechange",e)}),this.music.addEventListener("timeupdate",function(e){return s.emitter.emit("timeupdate",e)}),this.music.addEventListener("canplaythrough",function(){return s.emitter.emit("canplaythrough")}),this.music.addEventListener("pause",function(){return s.emitter.emit("pause")}),this.music.addEventListener("play",function(){return s.emitter.emit("play")}),this.music.addEventListener("ended",function(){return s.emitter.emit("ended")}),this.options.element.addEventListener("mousedown",function(e){return i(e)}),this.volume(),this.refreshList()}return _createClass(e,[{key:"volume",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0],i=function(){0===e.music.volume||e.isMuted()?(e.CBASE.replaceInner(e.__LIST__.volumePower,e.SVG.volumeOff),e.__LIST__.volumeIcon=e.CBASE.getByTagName("svg",e.__LIST__.volumePower)):e.music.volume>0&&e.music.volume<=.5?(e.CBASE.replaceInner(e.__LIST__.volumePower,e.SVG.volumeDown),e.__LIST__.volumeIcon=e.CBASE.getByTagName("svg",e.__LIST__.volumePower)):e.music.volume>.5&&e.music.volume<=1?(e.CBASE.replaceInner(e.__LIST__.volumePower,e.SVG.volumeUp),e.__LIST__.volumeIcon=e.CBASE.getByTagName("svg",e.__LIST__.volumePower)):console.log("Unexcepted Volume: "+e.music.volume)};return void 0===t?(this.__LIST__.volumeLine.style.width=100*this.music.volume+"%",i(),this.isMuted()?0:this.music.volume):void(0===t?(this.music.muted=!0,i()):(this.music.volume=t,i()))}},{key:"isMuted",value:function(){return this.music.muted}},{key:"play",value:function(){return this.music.seeking===!0?this:(this.music.play(),this)}},{key:"pause",value:function(){if(this.music.seeking!==!0)return this.music.pause(),this}},{key:"previous",value:function(){if(this.emitter.emit("previous"),0!==this.now)return this.now--,this.toggle().play(),this}},{key:"next",value:function(){if(this.emitter.emit("next"),this.now!==this.options.list.length-1)return this.now++,this.toggle().play(),this}},{key:"to",value:function(e){return this.now=e,this.toggle(),this.play(),this}},{key:"toggle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this.now:arguments[0];this.emitter.emit("toggle");var t=this.options.list[e],i=this.__LIST__;this.music.pause();var s=[t.image,t.name,t.artist,t.url];return i.img.src=s[0],i.name.innerHTML=s[1],i.artist.innerHTML=s[2],this.music.src=s[3],this.transLock=!1,this.refreshLyric(),this.hasLyric(this.now)||this.hideLyric(),this.CBASE.style(this.__LIST__.lyricBody,"transform",""),this}},{key:"isPaused",value:function(e){return void 0!==e&&e(),this.music.paused}},{key:"hasLyric",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments[1];return void 0!==t&&t(),void 0!=this.options.list[e].lyric}},{key:"showLyric",value:function(){return this.emitter.emit("slideLyric",!0),this.hasLyric(this.now)&&this.__LIST__.lyric.classList.remove("invisible"),this.__LIST__.list.classList.contains("invisible")||this.hideList(),this}},{key:"hideLyric",value:function(){return this.emitter.emit("slideLyric",!1),this.__LIST__.lyric.classList.add("invisible"),this}},{key:"hasList",value:function(e){return void 0!==e&&e(),this.options.list.length>1}},{key:"showList",value:function(e){return this.emitter.emit("slideList",!0),this.__LIST__.list.classList.remove("invisible"),this.__LIST__.lyric.classList.contains("invisible")||this.hideLyric(),void 0!==e&&e(),this}},{key:"hideList",value:function(e){return this.emitter.emit("slideList",!1),this.__LIST__.list.classList.add("invisible"),void 0!==e&&e(),this}},{key:"refreshList",value:function(e){var t=this;this.emitter.emit("changeList");var i=this.options.list,s=this.__LIST__.listBody;s.innerHTML="";for(var n=function(e){var n=document.createElement("div");n.innerHTML='<span class="music-name">'+i[e].name+'</span><span class="music-artist">'+i[e].artist+"</span>",n=s.appendChild(n),n.addEventListener("click",function(){t.to(e)})},a=0;a<=i.length-1;a++)n(a);void 0!==e&&e()}},{key:"add",value:function(e,t){var i=this,s=this.options.list.push(e),n=document.createElement("div");n.innerHTML='<span class="music-name">'+e.name+'</span><span class="music-artist">'+e.artist+"</span>",n=this.__LIST__.listBody.appendChild(n),n.addEventListener("click",function(){i.to(s-1)}),1===s&&this.toggle(),void 0!==t&&t()}},{key:"lyric",value:function(){var e=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0];if(void 0===e){if(this.hasLyric(this.now))return this.options.list[this.now].lyric}else this.options.list[this.now].lyric=e,this.refreshLyric();return this}},{key:"refreshLyric",value:function(e){if(this.__LIST__.lyricBody.innerHTML="",this.hasLyric(this.now)){var t=!this.transLock&&e?this.options.list[this.now].transLyric:this.options.list[this.now].lyric;t=t.split("\n");for(var i=[],s=0,n=t[s];s<t.length&&"string"==typeof n;s++,n=t[s]){for(var a=n.split(/\[|\]\[|\]/gi),r=0;r<a.length-1;r++)if(""===a[r]&&r!==a.length-1||null===a[r].match(/\d{1,}\:\d{1,}/gi))a.splice(r,1),r--;else if(a[r].match(/\d{1,}\:\d{1,}/gi)){var o=a[r].split(/\:|\./gi);switch(o.length){case 2:a[r]=60*parseInt(o[0])+parseInt(o[1]);break;case 3:a[r]=60*parseInt(o[0])+parseInt(o[1])+parseFloat("0."+o[2]);break;default:throw new Error("Time not be Found!")}}i.push(a)}for(var l=[],c=i.length-1;c>=0;c--)if(i[c].length>2)for(var d=i[c].length-1;d>=0;d--)d!==i[c].length-1&&void 0!==i[c][i[c].length-1]&&l.push({time:i[c][d],content:i[c][i[c].length-1]});else void 0!==i[c][1]&&l.push({time:i[c][0],content:i[c][1]});l.sort(function(e,t){return e.time-t.time}),l.now=0,this.__LYRIC__=l;for(var u=0;u<=l.length-1;u++){var h=document.createElement("lrc");h.innerHTML=l[u].content,this.__LIST__.lyricBody.appendChild(h)}this.emitter.emit("changeLyric")}}},{key:"updateTime",value:function(){var e=arguments.length<=0||void 0===arguments[0]?void 0:arguments[0],t=arguments[1];void 0!==e&&(this.music.currentTime=e),this.dragging.contain===!1&&(this.__LIST__.timeLine.style.width=this.music.currentTime/this.music.duration*100+"%"),void 0!==t&&t(this.music.currentTime)}},{key:"slideLyric",value:function(e){if(!this.__LIST__.lyric.classList.contains("invisible"))for(var t=void 0,i=void 0,s=void 0,n=this.__LIST__.lyricBody,a=this.__LIST__.lyricBody.getElementsByTagName("lrc"),r=this.__LYRIC__.length-1,o=this.__LYRIC__[r];r>=0;o=this.__LYRIC__[r-1],r--)if(!(o.time>e&&this.__LYRIC__[r-1]&&this.__LYRIC__[r-1].time>e)){if(o.time<e||!this.__LYRIC__[r-1])break;this.__LYRIC__.now!==r-1&&(this.__LYRIC__.now=r-1),a[r-1].classList.add("now"),t=n.childNodes[r-1].offsetTop-n.childNodes[0].offsetTop-.5*n.childNodes[r-1].clientHeight,i=.5*this.__LIST__.lyric.clientHeight-n.childNodes[r-1].clientHeight,s=-(t-i),this.CBASE.style(n,"transform","translateY("+s+"px)");var l=this.__LIST__.lyricBody.getElementsByClassName("now");if(l.length>1)for(var c=l.length-1;c>=0;c--)l[c]!==a[r-1]&&l[c].classList.remove("now")}}},{key:"translate",value:function(){return!(!this.options.list[this.now].transLyric||!this.hasLyric(this.now))&&(this.refreshLyric(!0),void(this.transLock=!0))}},{key:"length",get:function(){return this.options.list.length},set:function(e){throw new SyntaxError("Read-only Property.")}}]),e}();"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var i=arguments[t];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e});var cEmitter=function(){function e(t){_classCallCheck(this,e),t?this.events=t:this.events=[]}return _createClass(e,[{key:"on",value:function(e,t){if(this.events[e]&&void 0!==this.events[e].push&&"function"==typeof t)this.events[e].push(t);else{if(void 0!==this.events[e]&&void 0!==this.events[e].push)throw new TypeError("Uncaught Unexcepted TypeError.");this.events[e]=[]}return this}},{key:"emit",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];for(var n=0;n<this.events[e].length;n++)this.events[e][n](i);return this}}]),e}(),cBase=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?document.documentElement:arguments[0];_classCallCheck(this,e),this.root=t;for(var i=document.documentElement.style,s=i.length;s>0;s--){if(i[s].indexOf("-webkit-")!==-1){this.browser="webkit";break}if(i[s].indexOf("-moz-")!==-1){this.browser="moz";break}if(i[s].indexOf("-o-")!==-1){this.browser="o";break}if(i[s].indexOf("-ms-")!==-1){this.browser="ms";break}}}return _createClass(e,[{key:"replace",value:function(e,t){t=t.cloneNode(!0),e.parentNode.appendChild(t),e.parentNode.removeChild(e)}},{key:"replaceInner",value:function(e,t){e.innerHTML=t}},{key:"getByClass",value:function(e,t){return void 0!=t?t.getElementsByClassName(e)[0]:this.root.getElementsByClassName(e)[0]}},{key:"getByTagName",value:function(e,t){return void 0!=t?t.getElementsByTagName(e)[0]:this.root.getElementsByTagName(e)[0]}},{key:"rand",value:function(e,t){if(void 0===e||void 0===t)return Math.random();if(e>t)throw new RangeError("the EndNumber must be bigger than the StartNumber");return(t-e)*Math.random()+e}},{key:"style",value:function(e,t,i){e.style[this.browser+t.slice(0,1).toUpperCase()+t.slice(1)]=i,e.style[t]=i}}]),e}();window&&(window.cPlayer=cPlayer);