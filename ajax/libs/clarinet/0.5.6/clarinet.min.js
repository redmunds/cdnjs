!function(e){function t(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),o=0,r=0,a=N.length;r<a;r++){var i=t[N[r]].length;if(i>n)switch(N[r]){case"text":closeText(t);break;default:E(t,"Max buffer length exceeded: "+N[r])}o=Math.max(o,i)}t.bufferCheckPosition=e.MAX_BUFFER_LENGTH-o+t.position}function n(e){for(var t=0,n=N.length;t<n;t++)e[N[t]]=""}function o(t){if(!(this instanceof o))return new o(t);var r=this;n(r),r.bufferCheckPosition=e.MAX_BUFFER_LENGTH,r.q=r.c=r.p="",r.opt=t||{},r.closed=r.closedRoot=r.sawRoot=!1,r.tag=r.error=null,r.state=_.BEGIN,r.stack=new h,r.position=r.column=0,r.line=1,i(r,"onready")}function r(e){return new a(e)}function a(e){if(!(this instanceof a))return new a(e);L.apply(t),this._parser=new o(e),this.writable=!0,this.readable=!0;var t=this;this._parser.onend=function(){t.emit("end")},this._parser.onerror=function(e){t.emit("error",e),t._parser.error=null},A.forEach(function(e){Object.defineProperty(t,"on"+e,{get:function(){return t._parser["on"+e]},set:function(n){return n?void t.on(e,n):(t.removeAllListeners(e),t._parser["on"+e]=n,n)},enumerable:!0,configurable:!1})})}function i(t,n,o){e.INFO&&console.log("-- emit",n,o),t[n]&&t[n](o)}function s(e,t,n){e.textNode&&c(e),i(e,t,n)}function c(e,t){e.textNode=l(e.opt,e.textNode),e.textNode&&i(e,t?t:"onvalue",e.textNode),e.textNode=""}function u(e){e.numberNode&&i(e,"onvalue",parseFloat(e.numberNode)),e.numberNode=""}function l(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function E(e,t){return c(e),t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c,t=new Error(t),e.error=t,i(e,"onerror",t),e}function f(e){return e.state!==_.VALUE&&E(e,"Unexpected end"),c(e),e.c="",e.closed=!0,i(e,"onend"),o.call(e,e.opt),e}function p(n){var o=this;if(this.error)throw this.error;if(o.closed)return E(o,"Cannot write after close. Assign an onready handler.");if(null===n)return f(o);var r=0,a=n[0],l=o.p;for(e.DEBUG&&console.log("write -> ["+n+"]");a&&(l=a,o.c=a=n.charAt(r++),l!==a?o.p=l:l=o.p,a);)switch(e.DEBUG&&console.log(r,a,e.STATE[o.state]),o.position++,"\n"===a?(o.line++,o.column=0):o.column++,o.state){case _.BEGIN:"{"===a?o.state=_.OPEN_OBJECT:"["===a?o.state=_.OPEN_ARRAY:"\r"!==a&&"\n"!==a&&" "!==a&&"\t"!==a&&E(o,"Non-whitespace before {[.");continue;case _.OPEN_KEY:case _.OPEN_OBJECT:if("\r"===a||"\n"===a||" "===a||"\t"===a)continue;if(o.state===_.OPEN_KEY)o.stack.push(_.CLOSE_KEY);else{if("}"===a){i(o,"onopenobject"),i(o,"oncloseobject"),o.state=o.stack.pop()||_.VALUE;continue}o.stack.push(_.CLOSE_OBJECT)}'"'===a?o.state=_.STRING:E(o,'Malformed object key should start with "');continue;case _.CLOSE_KEY:case _.CLOSE_OBJECT:if("\r"===a||"\n"===a||" "===a||"\t"===a)continue;o.state===_.CLOSE_KEY?"key":"object";":"===a?(o.state===_.CLOSE_OBJECT?(o.stack.push(_.CLOSE_OBJECT),c(o,"onopenobject")):c(o,"onkey"),o.state=_.VALUE):"}"===a?(s(o,"oncloseobject"),o.state=o.stack.pop()||_.VALUE):","===a?(o.state===_.CLOSE_OBJECT&&o.stack.push(_.CLOSE_OBJECT),c(o),o.state=_.OPEN_KEY):E(o,"Bad object");continue;case _.OPEN_ARRAY:case _.VALUE:if("\r"===a||"\n"===a||" "===a||"\t"===a)continue;if(o.state===_.OPEN_ARRAY){if(i(o,"onopenarray"),o.state=_.VALUE,"]"===a){i(o,"onclosearray"),o.state=o.stack.pop()||_.VALUE;continue}o.stack.push(_.CLOSE_ARRAY)}'"'===a?o.state=_.STRING:"{"===a?o.state=_.OPEN_OBJECT:"["===a?o.state=_.OPEN_ARRAY:"t"===a?o.state=_.TRUE:"f"===a?o.state=_.FALSE:"n"===a?o.state=_.NULL:"-"===a?o.numberNode+=a:"0"===a?(o.numberNode+=a,o.state=_.NUMBER_DIGIT):"123456789".indexOf(a)!==-1?(o.numberNode+=a,o.state=_.NUMBER_DIGIT):E(o,"Bad value");continue;case _.CLOSE_ARRAY:if(","===a)o.stack.push(_.CLOSE_ARRAY),c(o,"onvalue"),o.state=_.VALUE;else if("]"===a)s(o,"onclosearray"),o.state=o.stack.pop()||_.VALUE;else{if("\r"===a||"\n"===a||" "===a||"\t"===a)continue;E(o,"Bad array")}continue;case _.STRING:for(var p=r-1,d=o.consecutive_slashes||0,L=new h;a;){if(e.DEBUG&&console.log(r,a,e.STATE[o.state],d),'"'===a&&(0===d||d%2===0)){o.state=o.stack.pop()||_.VALUE;break}"\\"===a?(d++,0!==d&&d%2!==0&&L.push(r-1)):d=0,o.consecutive_slashes=d,o.position++,"\n"===a?(o.line++,o.column=0):o.column++,b.lastIndex=r;var N=b.exec(n);if(null==N){r=n.length+1;break}N.index>r&&(d=0),r=N.index+1,a=n.charAt(N.index)}for(var A=L.shift(),O=p;"number"==typeof A;)o.textNode+=n.slice(O,A),O=A+1,A=L.shift();o.textNode+=n.substring(O,r-1);continue;case _.TRUE:if(""===a)continue;"r"===a?o.state=_.TRUE2:E(o,"Invalid true started with t"+a);continue;case _.TRUE2:if(""===a)continue;"u"===a?o.state=_.TRUE3:E(o,"Invalid true started with tr"+a);continue;case _.TRUE3:if(""===a)continue;"e"===a?(i(o,"onvalue",!0),o.state=o.stack.pop()||_.VALUE):E(o,"Invalid true started with tru"+a);continue;case _.FALSE:if(""===a)continue;"a"===a?o.state=_.FALSE2:E(o,"Invalid false started with f"+a);continue;case _.FALSE2:if(""===a)continue;"l"===a?o.state=_.FALSE3:E(o,"Invalid false started with fa"+a);continue;case _.FALSE3:if(""===a)continue;"s"===a?o.state=_.FALSE4:E(o,"Invalid false started with fal"+a);continue;case _.FALSE4:if(""===a)continue;"e"===a?(i(o,"onvalue",!1),o.state=o.stack.pop()||_.VALUE):E(o,"Invalid false started with fals"+a);continue;case _.NULL:if(""===a)continue;"u"===a?o.state=_.NULL2:E(o,"Invalid null started with n"+a);continue;case _.NULL2:if(""===a)continue;"l"===a?o.state=_.NULL3:E(o,"Invalid null started with nu"+a);continue;case _.NULL3:if(""===a)continue;"l"===a?(i(o,"onvalue",null),o.state=o.stack.pop()||_.VALUE):E(o,"Invalid null started with nul"+a);continue;case _.NUMBER_DECIMAL_POINT:"."===a?(o.numberNode+=a,o.state=_.NUMBER_DIGIT):E(o,"Leading zero not followed by .");continue;case _.NUMBER_DIGIT:"0123456789".indexOf(a)!==-1?o.numberNode+=a:"."===a?(o.numberNode.indexOf(".")!==-1&&E(o,"Invalid number has two dots"),o.numberNode+=a):"e"===a||"E"===a?(o.numberNode.indexOf("e")===-1&&o.numberNode.indexOf("E")===-1||E(o,"Invalid number has two exponential"),o.numberNode+=a):"+"===a||"-"===a?("e"!==l&&"E"!==l&&E(o,"Invalid symbol in number"),o.numberNode+=a):(u(o),r--,o.state=o.stack.pop()||_.VALUE);continue;default:E(o,"Unknown state: "+o.state)}return o.position>=o.bufferCheckPosition&&t(o),o}var d,h;if(d="object"==typeof process&&process.env?process.env:window,"function"==typeof FastList)h=FastList;else if("function"==typeof require)try{h=require("fast-list")}catch(e){h=Array}else h=Array;e.parser=function(e){return new o(e)},e.CParser=o,e.CStream=a,e.createStream=r,e.MAX_BUFFER_LENGTH=65536,e.DEBUG="debug"===d.CDEBUG,e.INFO="debug"===d.CDEBUG||"info"===d.CDEBUG,e.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var L,N=["textNode","numberNode"],A=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e}),_=0;e.STATE={BEGIN:_++,VALUE:_++,OPEN_OBJECT:_++,CLOSE_OBJECT:_++,OPEN_ARRAY:_++,CLOSE_ARRAY:_++,TEXT_ESCAPE:_++,STRING:_++,BACKSLASH:_++,END:_++,OPEN_KEY:_++,CLOSE_KEY:_++,TRUE:_++,TRUE2:_++,TRUE3:_++,FALSE:_++,FALSE2:_++,FALSE3:_++,FALSE4:_++,NULL:_++,NULL2:_++,NULL3:_++,NUMBER_DECIMAL_POINT:_++,NUMBER_DIGIT:_++};for(var O in e.STATE)e.STATE[e.STATE[O]]=O;_=e.STATE,Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var b=/[\\"\n]/g;o.prototype={end:function(){f(this)},write:p,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{L=require("stream").Stream}catch(e){L=function(){}}a.prototype=Object.create(L.prototype,{constructor:{value:a}}),a.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},a.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||A.indexOf(e)===-1||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),L.prototype.on.call(n,e,t)}}("undefined"==typeof exports?clarinet={}:exports);
//# sourceMappingURL=clarinet.min.js.map