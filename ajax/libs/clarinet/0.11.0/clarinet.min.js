!function(e){function t(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,s=0,o=_.length;s<o;s++){var r=t[_[s]].length;if(r>n)switch(_[s]){case"text":closeText(t);break;default:l(t,"Max buffer length exceeded: "+_[s])}i=Math.max(i,r)}t.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+t.position}function n(e){for(var t=0,n=_.length;t<n;t++)e[_[t]]=""}function i(t){if(!(this instanceof i))return new i(t);var s=this;n(s),s.bufferCheckPosition=e.MAX_BUFFER_LENGTH,s.q=s.c=s.p="",s.opt=t||{},s.closed=s.closedRoot=s.sawRoot=!1,s.tag=s.error=null,s.state=N.BEGIN,s.stack=new Array,s.position=s.column=0,s.line=1,s.slashed=!1,s.unicodeI=0,s.unicodeS=null,s.depth=0,r(s,"onready")}function s(e){return new o(e)}function o(e){if(!(this instanceof o))return new o(e);this._parser=new i(e),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var t=this;p.apply(t),this._parser.onend=function(){t.emit("end")},this._parser.onerror=function(e){t.emit("error",e),t._parser.error=null},b.forEach(function(e){Object.defineProperty(t,"on"+e,{get:function(){return t._parser["on"+e]},set:function(n){return n?void t.on(e,n):(t.removeAllListeners(e),t._parser["on"+e]=n,n)},enumerable:!0,configurable:!1})})}function r(t,n,i){e.INFO&&console.log("-- emit",n,i),t[n]&&t[n](i)}function a(e,t,n){c(e),r(e,t,n)}function c(e,t){e.textNode=f(e.opt,e.textNode),e.textNode&&r(e,t?t:"onvalue",e.textNode),e.textNode=""}function u(e){e.numberNode&&r(e,"onvalue",parseFloat(e.numberNode)),e.numberNode=""}function f(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function l(e,t){return c(e),t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c,t=new Error(t),e.error=t,r(e,"onerror",t),e}function h(e){return e.state===N.VALUE&&0===e.depth||l(e,"Unexpected end"),c(e),e.c="",e.closed=!0,r(e,"onend"),i.call(e,e.opt),e}function E(n){var i=this;if(this.error)throw this.error;if(i.closed)return l(i,"Cannot write after close. Assign an onready handler.");if(null===n)return h(i);var s=0,o=n[0],f=i.p;for(e.DEBUG&&console.log("write -> ["+n+"]");o&&(f=o,i.c=o=n.charAt(s++),f!==o?i.p=f:f=i.p,o);)switch(e.DEBUG&&console.log(s,o,e.STATE[i.state]),i.position++,"\n"===o?(i.line++,i.column=0):i.column++,i.state){case N.BEGIN:"{"===o?i.state=N.OPEN_OBJECT:"["===o?i.state=N.OPEN_ARRAY:"\r"!==o&&"\n"!==o&&" "!==o&&"\t"!==o&&l(i,"Non-whitespace before {[.");continue;case N.OPEN_KEY:case N.OPEN_OBJECT:if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;if(i.state===N.OPEN_KEY)i.stack.push(N.CLOSE_KEY);else{if("}"===o){r(i,"onopenobject"),this.depth++,r(i,"oncloseobject"),this.depth--,i.state=i.stack.pop()||N.VALUE;continue}i.stack.push(N.CLOSE_OBJECT)}'"'===o?i.state=N.STRING:l(i,'Malformed object key should start with "');continue;case N.CLOSE_KEY:case N.CLOSE_OBJECT:if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;i.state===N.CLOSE_KEY?"key":"object";":"===o?(i.state===N.CLOSE_OBJECT?(i.stack.push(N.CLOSE_OBJECT),c(i,"onopenobject"),this.depth++):c(i,"onkey"),i.state=N.VALUE):"}"===o?(a(i,"oncloseobject"),this.depth--,i.state=i.stack.pop()||N.VALUE):","===o?(i.state===N.CLOSE_OBJECT&&i.stack.push(N.CLOSE_OBJECT),c(i),i.state=N.OPEN_KEY):l(i,"Bad object");continue;case N.OPEN_ARRAY:case N.VALUE:if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;if(i.state===N.OPEN_ARRAY){if(r(i,"onopenarray"),this.depth++,i.state=N.VALUE,"]"===o){r(i,"onclosearray"),this.depth--,i.state=i.stack.pop()||N.VALUE;continue}i.stack.push(N.CLOSE_ARRAY)}'"'===o?i.state=N.STRING:"{"===o?i.state=N.OPEN_OBJECT:"["===o?i.state=N.OPEN_ARRAY:"t"===o?i.state=N.TRUE:"f"===o?i.state=N.FALSE:"n"===o?i.state=N.NULL:"-"===o?i.numberNode+=o:"0"===o?(i.numberNode+=o,i.state=N.NUMBER_DIGIT):"123456789".indexOf(o)!==-1?(i.numberNode+=o,i.state=N.NUMBER_DIGIT):l(i,"Bad value");continue;case N.CLOSE_ARRAY:if(","===o)i.stack.push(N.CLOSE_ARRAY),c(i,"onvalue"),i.state=N.VALUE;else if("]"===o)a(i,"onclosearray"),this.depth--,i.state=i.stack.pop()||N.VALUE;else{if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;l(i,"Bad array")}continue;case N.STRING:var E=s-1,d=i.slashed,p=i.unicodeI;e:for(;;){for(e.DEBUG&&console.log(s,o,e.STATE[i.state],d);p>0;)if(i.unicodeS+=o,o=n.charAt(s++),i.position++,4===p?(i.textNode+=String.fromCharCode(parseInt(i.unicodeS,16)),p=0,E=s-1):p++,!o)break e;if('"'===o&&!d){i.state=i.stack.pop()||N.VALUE,i.textNode+=n.substring(E,s-1),i.position+=s-1-E,i.textNode||r(i,"onvalue","");break}if("\\"===o&&!d&&(d=!0,i.textNode+=n.substring(E,s-1),i.position+=s-1-E,o=n.charAt(s++),i.position++,!o))break;if(d){if(d=!1,"n"===o?i.textNode+="\n":"r"===o?i.textNode+="\r":"t"===o?i.textNode+="\t":"f"===o?i.textNode+="\f":"b"===o?i.textNode+="\b":"u"===o?(p=1,i.unicodeS=""):i.textNode+=o,o=n.charAt(s++),i.position++,E=s-1,o)continue;break}L.lastIndex=s;var _=L.exec(n);if(null===_){s=n.length+1,i.textNode+=n.substring(E,s-1),i.position+=s-1-E;break}if(s=_.index+1,o=n.charAt(_.index),!o){i.textNode+=n.substring(E,s-1),i.position+=s-1-E;break}}i.slashed=d,i.unicodeI=p;continue;case N.TRUE:if(""===o)continue;"r"===o?i.state=N.TRUE2:l(i,"Invalid true started with t"+o);continue;case N.TRUE2:if(""===o)continue;"u"===o?i.state=N.TRUE3:l(i,"Invalid true started with tr"+o);continue;case N.TRUE3:if(""===o)continue;"e"===o?(r(i,"onvalue",!0),i.state=i.stack.pop()||N.VALUE):l(i,"Invalid true started with tru"+o);continue;case N.FALSE:if(""===o)continue;"a"===o?i.state=N.FALSE2:l(i,"Invalid false started with f"+o);continue;case N.FALSE2:if(""===o)continue;"l"===o?i.state=N.FALSE3:l(i,"Invalid false started with fa"+o);continue;case N.FALSE3:if(""===o)continue;"s"===o?i.state=N.FALSE4:l(i,"Invalid false started with fal"+o);continue;case N.FALSE4:if(""===o)continue;"e"===o?(r(i,"onvalue",!1),i.state=i.stack.pop()||N.VALUE):l(i,"Invalid false started with fals"+o);continue;case N.NULL:if(""===o)continue;"u"===o?i.state=N.NULL2:l(i,"Invalid null started with n"+o);continue;case N.NULL2:if(""===o)continue;"l"===o?i.state=N.NULL3:l(i,"Invalid null started with nu"+o);continue;case N.NULL3:if(""===o)continue;"l"===o?(r(i,"onvalue",null),i.state=i.stack.pop()||N.VALUE):l(i,"Invalid null started with nul"+o);continue;case N.NUMBER_DECIMAL_POINT:"."===o?(i.numberNode+=o,i.state=N.NUMBER_DIGIT):l(i,"Leading zero not followed by .");continue;case N.NUMBER_DIGIT:"0123456789".indexOf(o)!==-1?i.numberNode+=o:"."===o?(i.numberNode.indexOf(".")!==-1&&l(i,"Invalid number has two dots"),i.numberNode+=o):"e"===o||"E"===o?(i.numberNode.indexOf("e")===-1&&i.numberNode.indexOf("E")===-1||l(i,"Invalid number has two exponential"),i.numberNode+=o):"+"===o||"-"===o?("e"!==f&&"E"!==f&&l(i,"Invalid symbol in number"),i.numberNode+=o):(u(i),s--,i.state=i.stack.pop()||N.VALUE);continue;default:l(i,"Unknown state: "+i.state)}return i.position>=i.bufferCheckPosition&&t(i),i}var d;d="object"==typeof process&&process.env?process.env:window,e.parser=function(e){return new i(e)},e.CParser=i,e.CStream=o,e.createStream=s,e.MAX_BUFFER_LENGTH=65536,e.DEBUG="debug"===d.CDEBUG,e.INFO="debug"===d.CDEBUG||"info"===d.CDEBUG,e.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var p,_=["textNode","numberNode"],b=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e}),N=0;e.STATE={BEGIN:N++,VALUE:N++,OPEN_OBJECT:N++,CLOSE_OBJECT:N++,OPEN_ARRAY:N++,CLOSE_ARRAY:N++,TEXT_ESCAPE:N++,STRING:N++,BACKSLASH:N++,END:N++,OPEN_KEY:N++,CLOSE_KEY:N++,TRUE:N++,TRUE2:N++,TRUE3:N++,FALSE:N++,FALSE2:N++,FALSE3:N++,FALSE4:N++,NULL:N++,NULL2:N++,NULL3:N++,NUMBER_DECIMAL_POINT:N++,NUMBER_DIGIT:N++};for(var A in e.STATE)e.STATE[e.STATE[A]]=A;N=e.STATE,Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var L=/[\\"\n]/g;i.prototype={end:function(){h(this)},write:E,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{p=require("stream").Stream}catch(e){p=function(){}}o.prototype=Object.create(p.prototype,{constructor:{value:o}}),o.prototype.write=function(e){e=new Buffer(e);for(var t=0;t<e.length;t++){var n=e[t];if(this.bytes_remaining>0){for(var i=0;i<this.bytes_remaining;i++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+i]=e[i];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,t=t+i-1,this._parser.write(this.string),this.emit("data",this.string)}else if(0===this.bytes_remaining&&n>=128){if(n>=194&&n<=223&&(this.bytes_in_sequence=2),n>=224&&n<=239&&(this.bytes_in_sequence=3),n>=240&&n<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+t>e.length){for(var s=0;s<=e.length-1-t;s++)this.temp_buffs[this.bytes_in_sequence][s]=e[t+s];return this.bytes_remaining=t+this.bytes_in_sequence-e.length,!0}this.string=e.slice(t,t+this.bytes_in_sequence).toString(),t=t+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string)}else{for(var o=t;o<e.length&&!(e[o]>=128);o++);this.string=e.slice(t,o).toString(),this._parser.write(this.string),this.emit("data",this.string),t=o-1}}},o.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},o.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||b.indexOf(e)===-1||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),p.prototype.on.call(n,e,t)},o.prototype.destroy=function(){n(this._parser),this.emit("close")}}("undefined"==typeof exports?clarinet={}:exports);
//# sourceMappingURL=clarinet.min.js.map