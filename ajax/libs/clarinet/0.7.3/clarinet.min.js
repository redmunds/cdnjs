!function(e){function t(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),r=0,i=0,o=p.length;i<o;i++){var s=t[p[i]].length;if(s>n)switch(p[i]){case"text":closeText(t);break;default:l(t,"Max buffer length exceeded: "+p[i])}r=Math.max(r,s)}t.bufferCheckPosition=e.MAX_BUFFER_LENGTH-r+t.position}function n(e){for(var t=0,n=p.length;t<n;t++)e[p[t]]=""}function r(t){if(!(this instanceof r))return new r(t);var i=this;n(i),i.bufferCheckPosition=e.MAX_BUFFER_LENGTH,i.q=i.c=i.p="",i.opt=t||{},i.closed=i.closedRoot=i.sawRoot=!1,i.tag=i.error=null,i.state=N.BEGIN,i.stack=new Array,i.position=i.column=0,i.line=1,i.slashed=!1,i.unicodeI=0,i.unicodeS=null,s(i,"onready")}function i(e){return new o(e)}function o(e){if(!(this instanceof o))return new o(e);this._parser=new r(e),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var t=this;_.apply(t),this._parser.onend=function(){t.emit("end")},this._parser.onerror=function(e){t.emit("error",e),t._parser.error=null},b.forEach(function(e){Object.defineProperty(t,"on"+e,{get:function(){return t._parser["on"+e]},set:function(n){return n?void t.on(e,n):(t.removeAllListeners(e),t._parser["on"+e]=n,n)},enumerable:!0,configurable:!1})})}function s(t,n,r){e.INFO&&console.log("-- emit",n,r),t[n]&&t[n](r)}function a(e,t,n){c(e),s(e,t,n)}function c(e,t){e.textNode=f(e.opt,e.textNode),e.textNode&&s(e,t?t:"onvalue",e.textNode),e.textNode=""}function u(e){e.numberNode&&s(e,"onvalue",parseFloat(e.numberNode)),e.numberNode=""}function f(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function l(e,t){return c(e),t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c,t=new Error(t),e.error=t,s(e,"onerror",t),e}function E(e){return e.state!==N.VALUE&&l(e,"Unexpected end"),c(e),e.c="",e.closed=!0,s(e,"onend"),r.call(e,e.opt),e}function d(n){var r=this;if(this.error)throw this.error;if(r.closed)return l(r,"Cannot write after close. Assign an onready handler.");if(null===n)return E(r);var i=0,o=n[0],f=r.p;for(e.DEBUG&&console.log("write -> ["+n+"]");o&&(f=o,r.c=o=n.charAt(i++),f!==o?r.p=f:f=r.p,o);)switch(e.DEBUG&&console.log(i,o,e.STATE[r.state]),r.position++,"\n"===o?(r.line++,r.column=0):r.column++,r.state){case N.BEGIN:"{"===o?r.state=N.OPEN_OBJECT:"["===o?r.state=N.OPEN_ARRAY:"\r"!==o&&"\n"!==o&&" "!==o&&"\t"!==o&&l(r,"Non-whitespace before {[.");continue;case N.OPEN_KEY:case N.OPEN_OBJECT:if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;if(r.state===N.OPEN_KEY)r.stack.push(N.CLOSE_KEY);else{if("}"===o){s(r,"onopenobject"),s(r,"oncloseobject"),r.state=r.stack.pop()||N.VALUE;continue}r.stack.push(N.CLOSE_OBJECT)}'"'===o?r.state=N.STRING:l(r,'Malformed object key should start with "');continue;case N.CLOSE_KEY:case N.CLOSE_OBJECT:if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;r.state===N.CLOSE_KEY?"key":"object";":"===o?(r.state===N.CLOSE_OBJECT?(r.stack.push(N.CLOSE_OBJECT),c(r,"onopenobject")):c(r,"onkey"),r.state=N.VALUE):"}"===o?(a(r,"oncloseobject"),r.state=r.stack.pop()||N.VALUE):","===o?(r.state===N.CLOSE_OBJECT&&r.stack.push(N.CLOSE_OBJECT),c(r),r.state=N.OPEN_KEY):l(r,"Bad object");continue;case N.OPEN_ARRAY:case N.VALUE:if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;if(r.state===N.OPEN_ARRAY){if(s(r,"onopenarray"),r.state=N.VALUE,"]"===o){s(r,"onclosearray"),r.state=r.stack.pop()||N.VALUE;continue}r.stack.push(N.CLOSE_ARRAY)}'"'===o?r.state=N.STRING:"{"===o?r.state=N.OPEN_OBJECT:"["===o?r.state=N.OPEN_ARRAY:"t"===o?r.state=N.TRUE:"f"===o?r.state=N.FALSE:"n"===o?r.state=N.NULL:"-"===o?r.numberNode+=o:"0"===o?(r.numberNode+=o,r.state=N.NUMBER_DIGIT):"123456789".indexOf(o)!==-1?(r.numberNode+=o,r.state=N.NUMBER_DIGIT):l(r,"Bad value");continue;case N.CLOSE_ARRAY:if(","===o)r.stack.push(N.CLOSE_ARRAY),c(r,"onvalue"),r.state=N.VALUE;else if("]"===o)a(r,"onclosearray"),r.state=r.stack.pop()||N.VALUE;else{if("\r"===o||"\n"===o||" "===o||"\t"===o)continue;l(r,"Bad array")}continue;case N.STRING:var d=i-1,h=r.slashed,_=r.unicodeI;e:for(;;){for(e.DEBUG&&console.log(i,o,e.STATE[r.state],h);_>0;)if(r.unicodeS+=o,o=n.charAt(i++),4===_?(r.textNode+=String.fromCharCode(parseInt(r.unicodeS,16)),_=0,d=i-1):_++,!o)break e;if('"'===o&&!h){r.state=r.stack.pop()||N.VALUE,r.textNode+=n.substring(d,i-1),r.textNode||s(r,"onvalue","");break}if("\\"===o&&!h&&(h=!0,r.textNode+=n.substring(d,i-1),o=n.charAt(i++),!o))break;if(h){if(h=!1,"n"===o?r.textNode+="\n":"r"===o?r.textNode+="\r":"t"===o?r.textNode+="\t":"f"===o?r.textNode+="\f":"b"===o?r.textNode+="\b":"u"===o?(_=1,r.unicodeS=""):r.textNode+=o,o=n.charAt(i++),d=i-1,o)continue;break}L.lastIndex=i;var p=L.exec(n);if(null===p){i=n.length+1,r.textNode+=n.substring(d,i-1);break}if(i=p.index+1,o=n.charAt(p.index),!o){r.textNode+=n.substring(d,i-1);break}}r.slashed=h,r.unicodeI=_;continue;case N.TRUE:if(""===o)continue;"r"===o?r.state=N.TRUE2:l(r,"Invalid true started with t"+o);continue;case N.TRUE2:if(""===o)continue;"u"===o?r.state=N.TRUE3:l(r,"Invalid true started with tr"+o);continue;case N.TRUE3:if(""===o)continue;"e"===o?(s(r,"onvalue",!0),r.state=r.stack.pop()||N.VALUE):l(r,"Invalid true started with tru"+o);continue;case N.FALSE:if(""===o)continue;"a"===o?r.state=N.FALSE2:l(r,"Invalid false started with f"+o);continue;case N.FALSE2:if(""===o)continue;"l"===o?r.state=N.FALSE3:l(r,"Invalid false started with fa"+o);continue;case N.FALSE3:if(""===o)continue;"s"===o?r.state=N.FALSE4:l(r,"Invalid false started with fal"+o);continue;case N.FALSE4:if(""===o)continue;"e"===o?(s(r,"onvalue",!1),r.state=r.stack.pop()||N.VALUE):l(r,"Invalid false started with fals"+o);continue;case N.NULL:if(""===o)continue;"u"===o?r.state=N.NULL2:l(r,"Invalid null started with n"+o);continue;case N.NULL2:if(""===o)continue;"l"===o?r.state=N.NULL3:l(r,"Invalid null started with nu"+o);continue;case N.NULL3:if(""===o)continue;"l"===o?(s(r,"onvalue",null),r.state=r.stack.pop()||N.VALUE):l(r,"Invalid null started with nul"+o);continue;case N.NUMBER_DECIMAL_POINT:"."===o?(r.numberNode+=o,r.state=N.NUMBER_DIGIT):l(r,"Leading zero not followed by .");continue;case N.NUMBER_DIGIT:"0123456789".indexOf(o)!==-1?r.numberNode+=o:"."===o?(r.numberNode.indexOf(".")!==-1&&l(r,"Invalid number has two dots"),r.numberNode+=o):"e"===o||"E"===o?(r.numberNode.indexOf("e")===-1&&r.numberNode.indexOf("E")===-1||l(r,"Invalid number has two exponential"),r.numberNode+=o):"+"===o||"-"===o?("e"!==f&&"E"!==f&&l(r,"Invalid symbol in number"),r.numberNode+=o):(u(r),i--,r.state=r.stack.pop()||N.VALUE);continue;default:l(r,"Unknown state: "+r.state)}return r.position>=r.bufferCheckPosition&&t(r),r}var h;h="object"==typeof process&&process.env?process.env:window,e.parser=function(e){return new r(e)},e.CParser=r,e.CStream=o,e.createStream=i,e.MAX_BUFFER_LENGTH=65536,e.DEBUG="debug"===h.CDEBUG,e.INFO="debug"===h.CDEBUG||"info"===h.CDEBUG,e.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var _,p=["textNode","numberNode"],b=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e}),N=0;e.STATE={BEGIN:N++,VALUE:N++,OPEN_OBJECT:N++,CLOSE_OBJECT:N++,OPEN_ARRAY:N++,CLOSE_ARRAY:N++,TEXT_ESCAPE:N++,STRING:N++,BACKSLASH:N++,END:N++,OPEN_KEY:N++,CLOSE_KEY:N++,TRUE:N++,TRUE2:N++,TRUE3:N++,FALSE:N++,FALSE2:N++,FALSE3:N++,FALSE4:N++,NULL:N++,NULL2:N++,NULL3:N++,NUMBER_DECIMAL_POINT:N++,NUMBER_DIGIT:N++};for(var A in e.STATE)e.STATE[e.STATE[A]]=A;N=e.STATE,Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var L=/[\\"\n]/g;r.prototype={end:function(){E(this)},write:d,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{_=require("stream").Stream}catch(e){_=function(){}}o.prototype=Object.create(_.prototype,{constructor:{value:o}}),o.prototype.write=function(e){for(var e=new Buffer(e),t=0;t<e.length;t++){var n=e[t];if(this.bytes_remaining>0){for(var r=0;r<this.bytes_remaining;r++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+r]=e[r];return this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,t=t+r-1,this._parser.write(this.string),this.emit("data",this.string),!0}if(!(0===this.bytes_remaining&&n>=128))return this._parser.write(e.toString()),this.emit("data",e),!0;if(n>=194&&n<=223&&(this.bytes_in_sequence=2),n>=224&&n<=239&&(this.bytes_in_sequence=3),n>=240&&n<=244&&(this.bytes_in_sequence=4),!(this.bytes_in_sequence+t>e.length))return this.string=e.slice(t,t+this.bytes_in_sequence).toString(),t=t+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string),!0;for(var i=0;i<=e.length-1-t;i++)this.temp_buffs[this.bytes_in_sequence][i]=e[t+i];this.bytes_remaining=t+this.bytes_in_sequence-e.length,t=e.length-1}},o.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},o.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||b.indexOf(e)===-1||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),_.prototype.on.call(n,e,t)},o.prototype.destroy=function(){n(this._parser),this.emit("close")}}("undefined"==typeof exports?clarinet={}:exports);
//# sourceMappingURL=clarinet.min.js.map