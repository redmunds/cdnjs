!function(e){function t(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),o=0,r=0,a=_.length;r<a;r++){var i=t[_[r]].length;if(i>n)switch(_[r]){case"text":closeText(t);break;default:d(t,"Max buffer length exceeded: "+_[r])}o=Math.max(o,i)}t.bufferCheckPosition=e.MAX_BUFFER_LENGTH-o+t.position}function n(e){for(var t=0,n=_.length;t<n;t++)e[_[t]]=""}function o(e,t){return e.indexOf(t)!==-1}function r(e,t){return!o(e,t)}function a(t){if(!(this instanceof a))return new a(t);var o=this;n(o),o.bufferCheckPosition=e.MAX_BUFFER_LENGTH,o.q=o.c=o.p="",o.opt=t||{},o.closed=o.closedRoot=o.sawRoot=!1,o.tag=o.error=null,o.state=S.BEGIN,o.stack=new L,o.position=o.column=0,o.line=1,c(o,"onready")}function i(e){return new s(e)}function s(e){if(!(this instanceof s))return new s(e);h.apply(t),this._parser=new a(e),this.writable=!0,this.readable=!0;var t=this;this._parser.onend=function(){t.emit("end")},this._parser.onerror=function(e){t.emit("error",e),t._parser.error=null},T.forEach(function(e){Object.defineProperty(t,"on"+e,{get:function(){return t._parser["on"+e]},set:function(n){return n?void t.on(e,n):(t.removeAllListeners(e),t._parser["on"+e]=n,n)},enumerable:!0,configurable:!1})})}function c(t,n,o){e.INFO&&console.log("-- emit",n,o),t[n]&&t[n](o)}function u(e,t,n){e.textNode&&E(e),c(e,t,n)}function E(e,t){e.textNode=f(e.opt,e.textNode),e.textNode&&c(e,t?t:"onvalue",e.textNode),e.textNode=""}function l(e){e.numberNode&&c(e,"onvalue",parseFloat(e.numberNode)),e.numberNode=""}function f(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function d(e,t){return E(e),t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c,t=new Error(t),e.error=t,c(e,"onerror",t),e}function p(e){return e.state!==S.VALUE&&d(e,"Unexpected end"),E(e),e.c="",e.closed=!0,c(e,"onend"),a.call(e,e.opt),e}function N(n){var a=this;if(this.error)throw this.error;if(a.closed)return d(a,"Cannot write after close. Assign an onready handler.");if(null===n)return p(a);var i=0,s=n[0],f=a.p;for(e.DEBUG&&console.log("write -> ["+n+"]");s&&(f=s,a.c=s=n.charAt(i++),f!==s?a.p=f:f=a.p,s);)switch(e.DEBUG&&console.log(i,s,e.STATE[a.state],f),a.position++,"\n"===s?(a.line++,a.column=0):a.column++,a.state){case S.BEGIN:"{"===s?a.state=S.OPEN_OBJECT:"["===s?a.state=S.OPEN_ARRAY:r(O,s)&&d(a,"Non-whitespace before {[.");continue;case S.OPEN_KEY:case S.OPEN_OBJECT:if(o(O,s))continue;if(a.state===S.OPEN_KEY)a.stack.push(S.CLOSE_KEY);else{if("}"===s){c(a,"onopenobject"),c(a,"oncloseobject"),a.state=a.stack.pop()||S.VALUE;continue}a.stack.push(S.CLOSE_OBJECT)}'"'===s?a.state=S.STRING:d(a,'Malformed object key should start with "');continue;case S.CLOSE_KEY:case S.CLOSE_OBJECT:if(o(O,s))continue;a.state===S.CLOSE_KEY?"key":"object";":"===s?(a.state===S.CLOSE_OBJECT?(a.stack.push(S.CLOSE_OBJECT),E(a,"onopenobject")):E(a,"onkey"),a.state=S.VALUE):"}"===s?(u(a,"oncloseobject"),a.state=a.stack.pop()||S.VALUE):","===s?(a.state===S.CLOSE_OBJECT&&a.stack.push(S.CLOSE_OBJECT),E(a),a.state=S.OPEN_KEY):d(a,"Bad object");continue;case S.OPEN_ARRAY:case S.VALUE:if(o(O,s))continue;if(a.state===S.OPEN_ARRAY){if(c(a,"onopenarray"),a.state=S.VALUE,"]"===s){c(a,"onclosearray"),a.state=a.stack.pop()||S.VALUE;continue}a.stack.push(S.CLOSE_ARRAY)}'"'===s?a.state=S.STRING:"{"===s?a.state=S.OPEN_OBJECT:"["===s?a.state=S.OPEN_ARRAY:"t"===s?a.state=S.TRUE:"f"===s?a.state=S.FALSE:"n"===s?a.state=S.NULL:"-"===s?a.numberNode+=s:"0"===s?(a.numberNode+=s,a.state=S.NUMBER_DIGIT):"123456789".indexOf(s)!==-1?(a.numberNode+=s,a.state=S.NUMBER_DIGIT):d(a,"Bad value");continue;case S.CLOSE_ARRAY:if(","===s)a.stack.push(S.CLOSE_ARRAY),E(a,"onvalue"),a.state=S.VALUE;else if("]"===s)u(a,"onclosearray"),a.state=a.stack.pop()||S.VALUE;else{if(o(O,s))continue;d(a,"Bad array")}continue;case S.STRING:'"'===s?a.state=a.stack.pop()||S.VALUE:"\\"===s?a.state=S.BACKSLASH:a.textNode+=s;continue;case S.BACKSLASH:"\\"===s||'"'===s?a.textNode+=s:("\\"===f&&(a.textNode+="\\"),a.textNode+=s),a.state=S.STRING;continue;case S.TRUE:if(""===s)continue;"r"===s?a.state=S.TRUE2:d(a,"Invalid true started with t"+s);continue;case S.TRUE2:if(""===s)continue;"u"===s?a.state=S.TRUE3:d(a,"Invalid true started with tr"+s);continue;case S.TRUE3:if(""===s)continue;"e"===s?(c(a,"onvalue",!0),a.state=a.stack.pop()||S.VALUE):d(a,"Invalid true started with tru"+s);continue;case S.FALSE:if(""===s)continue;"a"===s?a.state=S.FALSE2:d(a,"Invalid false started with f"+s);continue;case S.FALSE2:if(""===s)continue;"l"===s?a.state=S.FALSE3:d(a,"Invalid false started with fa"+s);continue;case S.FALSE3:if(""===s)continue;"s"===s?a.state=S.FALSE4:d(a,"Invalid false started with fal"+s);continue;case S.FALSE4:if(""===s)continue;"e"===s?(c(a,"onvalue",!1),a.state=a.stack.pop()||S.VALUE):d(a,"Invalid false started with fals"+s);continue;case S.NULL:if(""===s)continue;"u"===s?a.state=S.NULL2:d(a,"Invalid null started with n"+s);continue;case S.NULL2:if(""===s)continue;"l"===s?a.state=S.NULL3:d(a,"Invalid null started with nu"+s);continue;case S.NULL3:if(""===s)continue;"l"===s?(c(a,"onvalue",null),a.state=a.stack.pop()||S.VALUE):d(a,"Invalid null started with nul"+s);continue;case S.NUMBER_DECIMAL_POINT:"."===s?(a.numberNode+=s,a.state=S.NUMBER_DIGIT):d(a,"Leading zero not followed by .");continue;case S.NUMBER_DIGIT:"0123456789".indexOf(s)!==-1?a.numberNode+=s:"."===s?(a.numberNode.indexOf(".")!==-1&&d(a,"Invalid number has two dots"),a.numberNode+=s):"e"===s||"E"===s?(a.numberNode.indexOf("e")===-1&&a.numberNode.indexOf("E")===-1||d(a,"Invalid number has two exponential"),a.numberNode+=s):"+"===s||"-"===s?("e"!==f&&"E"!==f&&d(a,"Invalid symbol in number"),a.numberNode+=s):(l(a),i--,a.state=a.stack.pop()||S.VALUE);continue;default:d(a,"Unknown state: "+a.state)}return a.position>=a.bufferCheckPosition&&t(a),a}var L,A=process&&process.env?process.env:window;if("function"==typeof FastList)L=FastList;else if("function"==typeof require)try{L=require("fast-list")}catch(e){L=Array}else L=Array;e.parser=function(e){return new a(e)},e.CParser=a,e.CStream=s,e.createStream=i,e.MAX_BUFFER_LENGTH=65536,e.DEBUG="debug"===A.CDEBUG,e.INFO="debug"===A.CDEBUG||"info"===A.CDEBUG,e.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var h,_=["textNode","numberNode"],O="\r\n\t ",T=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e}),S=0;e.STATE={BEGIN:S++,VALUE:S++,OPEN_OBJECT:S++,CLOSE_OBJECT:S++,OPEN_ARRAY:S++,CLOSE_ARRAY:S++,TEXT_ESCAPE:S++,STRING:S++,BACKSLASH:S++,END:S++,OPEN_KEY:S++,CLOSE_KEY:S++,TRUE:S++,TRUE2:S++,TRUE3:S++,FALSE:S++,FALSE2:S++,FALSE3:S++,FALSE4:S++,NULL:S++,NULL2:S++,NULL3:S++,NUMBER_DECIMAL_POINT:S++,NUMBER_DIGIT:S++};for(var U in e.STATE)e.STATE[e.STATE[U]]=U;S=e.STATE,Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),a.prototype={end:function(){p(this)},write:N,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{h=require("stream").Stream}catch(e){h=function(){}}s.prototype=Object.create(h.prototype,{constructor:{value:s}}),s.prototype.write=function(e){return this._parser.write(e.toString()),this.emit("data",e),!0},s.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},s.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||T.indexOf(e)===-1||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),h.prototype.on.call(n,e,t)}}("undefined"==typeof exports?clarinet={}:exports);
//# sourceMappingURL=clarinet.min.js.map