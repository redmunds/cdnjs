!function(e){function t(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,r=0,s=_.length;r<s;r++){var o=t[_[r]].length;if(o>n)switch(_[r]){case"text":closeText(t);break;default:l(t,"Max buffer length exceeded: "+_[r])}i=Math.max(i,o)}t.bufferCheckPosition=e.MAX_BUFFER_LENGTH-i+t.position}function n(e){for(var t=0,n=_.length;t<n;t++)e[_[t]]=""}function i(t){if(!(this instanceof i))return new i(t);var r=this;n(r),r.bufferCheckPosition=e.MAX_BUFFER_LENGTH,r.q=r.c=r.p="",r.opt=t||{},r.closed=r.closedRoot=r.sawRoot=!1,r.tag=r.error=null,r.state=N.BEGIN,r.stack=new Array,r.position=r.column=0,r.line=1,r.slashed=!1,r.unicodeI=0,r.unicodeS=null,r.depth=0,o(r,"onready")}function r(e){return new s(e)}function s(e){if(!(this instanceof s))return new s(e);this._parser=new i(e),this.writable=!0,this.readable=!0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.temp_buffs={2:new Buffer(2),3:new Buffer(3),4:new Buffer(4)},this.string="";var t=this;p.apply(t),this._parser.onend=function(){t.emit("end")},this._parser.onerror=function(e){t.emit("error",e),t._parser.error=null},b.forEach(function(e){Object.defineProperty(t,"on"+e,{get:function(){return t._parser["on"+e]},set:function(n){return n?void t.on(e,n):(t.removeAllListeners(e),t._parser["on"+e]=n,n)},enumerable:!0,configurable:!1})})}function o(t,n,i){e.INFO&&console.log("-- emit",n,i),t[n]&&t[n](i)}function a(e,t,n){c(e),o(e,t,n)}function c(e,t){e.textNode=f(e.opt,e.textNode),e.textNode&&o(e,t?t:"onvalue",e.textNode),e.textNode=""}function u(e){e.numberNode&&o(e,"onvalue",parseFloat(e.numberNode)),e.numberNode=""}function f(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function l(e,t){return c(e),t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c,t=new Error(t),e.error=t,o(e,"onerror",t),e}function h(e){return e.state===N.VALUE&&0===e.depth||l(e,"Unexpected end"),c(e),e.c="",e.closed=!0,o(e,"onend"),i.call(e,e.opt),e}function E(n){var i=this;if(this.error)throw this.error;if(i.closed)return l(i,"Cannot write after close. Assign an onready handler.");if(null===n)return h(i);var r=0,s=n[0],f=i.p;for(e.DEBUG&&console.log("write -> ["+n+"]");s&&(f=s,i.c=s=n.charAt(r++),f!==s?i.p=f:f=i.p,s);)switch(e.DEBUG&&console.log(r,s,e.STATE[i.state]),i.position++,"\n"===s?(i.line++,i.column=0):i.column++,i.state){case N.BEGIN:"{"===s?i.state=N.OPEN_OBJECT:"["===s?i.state=N.OPEN_ARRAY:"\r"!==s&&"\n"!==s&&" "!==s&&"\t"!==s&&l(i,"Non-whitespace before {[.");continue;case N.OPEN_KEY:case N.OPEN_OBJECT:if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;if(i.state===N.OPEN_KEY)i.stack.push(N.CLOSE_KEY);else{if("}"===s){o(i,"onopenobject"),this.depth++,o(i,"oncloseobject"),this.depth--,i.state=i.stack.pop()||N.VALUE;continue}i.stack.push(N.CLOSE_OBJECT)}'"'===s?i.state=N.STRING:l(i,'Malformed object key should start with "');continue;case N.CLOSE_KEY:case N.CLOSE_OBJECT:if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;i.state===N.CLOSE_KEY?"key":"object";":"===s?(i.state===N.CLOSE_OBJECT?(i.stack.push(N.CLOSE_OBJECT),c(i,"onopenobject"),this.depth++):c(i,"onkey"),i.state=N.VALUE):"}"===s?(a(i,"oncloseobject"),this.depth--,i.state=i.stack.pop()||N.VALUE):","===s?(i.state===N.CLOSE_OBJECT&&i.stack.push(N.CLOSE_OBJECT),c(i),i.state=N.OPEN_KEY):l(i,"Bad object");continue;case N.OPEN_ARRAY:case N.VALUE:if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;if(i.state===N.OPEN_ARRAY){if(o(i,"onopenarray"),this.depth++,i.state=N.VALUE,"]"===s){o(i,"onclosearray"),this.depth--,i.state=i.stack.pop()||N.VALUE;continue}i.stack.push(N.CLOSE_ARRAY)}'"'===s?i.state=N.STRING:"{"===s?i.state=N.OPEN_OBJECT:"["===s?i.state=N.OPEN_ARRAY:"t"===s?i.state=N.TRUE:"f"===s?i.state=N.FALSE:"n"===s?i.state=N.NULL:"-"===s?i.numberNode+=s:"0"===s?(i.numberNode+=s,i.state=N.NUMBER_DIGIT):"123456789".indexOf(s)!==-1?(i.numberNode+=s,i.state=N.NUMBER_DIGIT):l(i,"Bad value");continue;case N.CLOSE_ARRAY:if(","===s)i.stack.push(N.CLOSE_ARRAY),c(i,"onvalue"),i.state=N.VALUE;else if("]"===s)a(i,"onclosearray"),this.depth--,i.state=i.stack.pop()||N.VALUE;else{if("\r"===s||"\n"===s||" "===s||"\t"===s)continue;l(i,"Bad array")}continue;case N.STRING:var E=r-1,d=i.slashed,p=i.unicodeI;e:for(;;){for(e.DEBUG&&console.log(r,s,e.STATE[i.state],d);p>0;)if(i.unicodeS+=s,s=n.charAt(r++),4===p?(i.textNode+=String.fromCharCode(parseInt(i.unicodeS,16)),p=0,E=r-1):p++,!s)break e;if('"'===s&&!d){i.state=i.stack.pop()||N.VALUE,i.textNode+=n.substring(E,r-1),i.textNode||o(i,"onvalue","");break}if("\\"===s&&!d&&(d=!0,i.textNode+=n.substring(E,r-1),s=n.charAt(r++),!s))break;if(d){if(d=!1,"n"===s?i.textNode+="\n":"r"===s?i.textNode+="\r":"t"===s?i.textNode+="\t":"f"===s?i.textNode+="\f":"b"===s?i.textNode+="\b":"u"===s?(p=1,i.unicodeS=""):i.textNode+=s,s=n.charAt(r++),E=r-1,s)continue;break}L.lastIndex=r;var _=L.exec(n);if(null===_){r=n.length+1,i.textNode+=n.substring(E,r-1);break}if(r=_.index+1,s=n.charAt(_.index),!s){i.textNode+=n.substring(E,r-1);break}}i.slashed=d,i.unicodeI=p;continue;case N.TRUE:if(""===s)continue;"r"===s?i.state=N.TRUE2:l(i,"Invalid true started with t"+s);continue;case N.TRUE2:if(""===s)continue;"u"===s?i.state=N.TRUE3:l(i,"Invalid true started with tr"+s);continue;case N.TRUE3:if(""===s)continue;"e"===s?(o(i,"onvalue",!0),i.state=i.stack.pop()||N.VALUE):l(i,"Invalid true started with tru"+s);continue;case N.FALSE:if(""===s)continue;"a"===s?i.state=N.FALSE2:l(i,"Invalid false started with f"+s);continue;case N.FALSE2:if(""===s)continue;"l"===s?i.state=N.FALSE3:l(i,"Invalid false started with fa"+s);continue;case N.FALSE3:if(""===s)continue;"s"===s?i.state=N.FALSE4:l(i,"Invalid false started with fal"+s);continue;case N.FALSE4:if(""===s)continue;"e"===s?(o(i,"onvalue",!1),i.state=i.stack.pop()||N.VALUE):l(i,"Invalid false started with fals"+s);continue;case N.NULL:if(""===s)continue;"u"===s?i.state=N.NULL2:l(i,"Invalid null started with n"+s);continue;case N.NULL2:if(""===s)continue;"l"===s?i.state=N.NULL3:l(i,"Invalid null started with nu"+s);continue;case N.NULL3:if(""===s)continue;"l"===s?(o(i,"onvalue",null),i.state=i.stack.pop()||N.VALUE):l(i,"Invalid null started with nul"+s);continue;case N.NUMBER_DECIMAL_POINT:"."===s?(i.numberNode+=s,i.state=N.NUMBER_DIGIT):l(i,"Leading zero not followed by .");continue;case N.NUMBER_DIGIT:"0123456789".indexOf(s)!==-1?i.numberNode+=s:"."===s?(i.numberNode.indexOf(".")!==-1&&l(i,"Invalid number has two dots"),i.numberNode+=s):"e"===s||"E"===s?(i.numberNode.indexOf("e")===-1&&i.numberNode.indexOf("E")===-1||l(i,"Invalid number has two exponential"),i.numberNode+=s):"+"===s||"-"===s?("e"!==f&&"E"!==f&&l(i,"Invalid symbol in number"),i.numberNode+=s):(u(i),r--,i.state=i.stack.pop()||N.VALUE);continue;default:l(i,"Unknown state: "+i.state)}return i.position>=i.bufferCheckPosition&&t(i),i}var d;d="object"==typeof process&&process.env?process.env:window,e.parser=function(e){return new i(e)},e.CParser=i,e.CStream=s,e.createStream=r,e.MAX_BUFFER_LENGTH=65536,e.DEBUG="debug"===d.CDEBUG,e.INFO="debug"===d.CDEBUG||"info"===d.CDEBUG,e.EVENTS=["value","string","key","openobject","closeobject","openarray","closearray","error","end","ready"];var p,_=["textNode","numberNode"],b=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e}),N=0;e.STATE={BEGIN:N++,VALUE:N++,OPEN_OBJECT:N++,CLOSE_OBJECT:N++,OPEN_ARRAY:N++,CLOSE_ARRAY:N++,TEXT_ESCAPE:N++,STRING:N++,BACKSLASH:N++,END:N++,OPEN_KEY:N++,CLOSE_KEY:N++,TRUE:N++,TRUE2:N++,TRUE3:N++,FALSE:N++,FALSE2:N++,FALSE3:N++,FALSE4:N++,NULL:N++,NULL2:N++,NULL3:N++,NUMBER_DECIMAL_POINT:N++,NUMBER_DIGIT:N++};for(var A in e.STATE)e.STATE[e.STATE[A]]=A;N=e.STATE,Object.create||(Object.create=function(e){function t(){this.__proto__=e}return t.prototype=e,new t}),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t});var L=/[\\"\n]/g;i.prototype={end:function(){h(this)},write:E,resume:function(){return this.error=null,this},close:function(){return this.write(null)}};try{p=require("stream").Stream}catch(e){p=function(){}}s.prototype=Object.create(p.prototype,{constructor:{value:s}}),s.prototype.write=function(e){e=new Buffer(e);for(var t=0;t<e.length;t++){var n=e[t];if(this.bytes_remaining>0){for(var i=0;i<this.bytes_remaining;i++)this.temp_buffs[this.bytes_in_sequence][this.bytes_in_sequence-this.bytes_remaining+i]=e[i];this.string=this.temp_buffs[this.bytes_in_sequence].toString(),this.bytes_in_sequence=this.bytes_remaining=0,t=t+i-1,this._parser.write(this.string),this.emit("data",this.string)}else if(0===this.bytes_remaining&&n>=128){if(n>=194&&n<=223&&(this.bytes_in_sequence=2),n>=224&&n<=239&&(this.bytes_in_sequence=3),n>=240&&n<=244&&(this.bytes_in_sequence=4),this.bytes_in_sequence+t>e.length){for(var r=0;r<=e.length-1-t;r++)this.temp_buffs[this.bytes_in_sequence][r]=e[t+r];return this.bytes_remaining=t+this.bytes_in_sequence-e.length,!0}this.string=e.slice(t,t+this.bytes_in_sequence).toString(),t=t+this.bytes_in_sequence-1,this._parser.write(this.string),this.emit("data",this.string)}else{for(var s=t;s<e.length&&!(e[s]>=128);s++);this.string=e.slice(t,s).toString(),this._parser.write(this.string),this.emit("data",this.string),t=s-1}}},s.prototype.end=function(e){return e&&e.length&&this._parser.write(e.toString()),this._parser.end(),!0},s.prototype.on=function(e,t){var n=this;return n._parser["on"+e]||b.indexOf(e)===-1||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),p.prototype.on.call(n,e,t)},s.prototype.destroy=function(){n(this._parser),this.emit("close")}}("undefined"==typeof exports?clarinet={}:exports);
//# sourceMappingURL=clarinet.min.js.map