!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Network=t()}}(function(){return function t(e,n,r){function i(o,u){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=function(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0})},i=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=n(t("./EventDispatcher")),u=n(t("./Http/HttpModule")),a=n(t("./Http/LatencyModule")),c=n(t("./Http/BandwidthModule")),l=n(t("./Timing")),f=t("../utils/helpers"),d=f.isObject,h=f.assign,p=f.except,g=function(){function t(){var e=void 0===arguments[0]?{}:arguments[0];s(this,t),this._modules={},this._modulesInitialized=!1,this._pendingSettings={},this._registerModule("latency",function(t){return new a(t)})._registerModule("upload",function(t){return new c("upload",t)})._registerModule("download",function(t){return new c("download",t)}),this._initModules(this.settings(e))}return i(t,{settings:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=this,e=void 0===arguments[0]?null:arguments[0],n=Object.keys(this._modules);if(!d(e))return n.reduce(function(e,n){return h(e,r({},n,t._modules[n].settings()))},{});var i=function(){var i=p(e,n),s=p(e,Object.keys(i));return e=n.reduce(function(t,e){return h(t,r({},e,i))},{}),e=h(e,s),t._modulesInitialized?Object.keys(t._modules).forEach(function(n){t._modules[n].settings(e[n])}):t._pendingSettings=e,{v:t}}();return"object"==typeof i?i.v:void 0})},isRequesting:{value:function(){var t=!1;for(var e in this._modules)this._modules.hasOwnProperty(e)&&(t=t||this._modules[e].isRequesting());return t}},_registerModule:{value:function(t,e){return this._modules[t]=e,this}},_initModules:{value:function(){var t=this;return this._modulesInitialized||(Object.keys(this._modules).forEach(function(e){t._modules[e]=t._modules[e](t._pendingSettings[e]).on("_newRequest",function(){return!t.isRequesting()}),t[e]=t._modules[e]}),this._modulesInitialized=!0),this}}},{_exposeInternalClasses:{value:function(){h(window,{EventDispatcher:o,HttpModule:u,LatencyModule:a,BandwidthModule:c,Timing:l})}}}),t}();e.exports=g},{"../utils/helpers":7,"./EventDispatcher":2,"./Http/BandwidthModule":3,"./Http/HttpModule":4,"./Http/LatencyModule":5,"./Timing":6}],2:[function(t,e){"use strict";var n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(){r(this,t),this._events={}}return n(t,{on:{value:function(t,e){var n=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){var r=n._events[t]=n._events[t]||[];~r.indexOf(e)||r.push(e)}),this}},off:{value:function(t,e){var n=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){var r=n._events[t];if(void 0==e&&r)delete n._events[t];else{var i=r?r.indexOf(e):-1;~i&&r.splice(i,1)}}),this}},trigger:{value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];var i=this._events[t]||[],s=!0;return i.forEach(function(t){var e=t.apply(void 0,n);e=e!==!1?!0:!1,s=s&&e}),s}}}),t}();e.exports=i},{}],3:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function f(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:f(i,e,n)}if("value"in r&&r.writable)return r.value;var s=r.get;return void 0===s?void 0:s.call(n)},s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=n(t("./HttpModule")),a=n(t("../Timing")),c=t("../../utils/helpers").defer,l=function(t){function e(t){var n=this,r=void 0===arguments[1]?{}:arguments[1];o(this,e),t=~["upload","download"].indexOf(t)?t:"download",this._enhanceDefaultSettings({data:{size:"upload"==t?2097152:10485760,multiplier:2}}),i(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,r),this._loadingType=t,this._intendedEnd=!1,this._isRestarting=!1,this._lastLoadedValue=null,this._speedRecords=[],this._avgSpeed=null,this._requestID=0,this._progressID=0,this._started=!1,this._firstProgress=!0,this._deferredProgress,this._timingLabels={start:null,progress:null,end:null,measure:null},this.on("xhr-upload-loadstart",function(){return a.mark(n._timingLabels.start)}),this.on("xhr-readystatechange",function(t){n._started||t.readyState!=XMLHttpRequest.LOADING||(a.mark(n._timingLabels.start),n._started=!0)});var s="upload"==t?"xhr-upload":"xhr";this.on(""+s+"-progress",function(t,e){return n._progress(e)}),this.on(""+s+"-timeout",function(){return n._timeout()}),this.on(""+s+"-loadend",function(){return n._end()})}return s(e,t),r(e,{start:{value:function(){var t=this._loadingType,e=this.settings().data,n=this._requestID++;this._intendedEnd=!1,this._lastLoadedValue=null,this._speedRecords=[],this._started=!1,this._firstProgress=!0,this._deferredProgress=c(),this._isRestarting||this.trigger("start",e.size);var r=this._timingLabels;r.start=""+t+"-"+n+"-start",r.progress=""+t+"-"+n+"-progress",r.end=""+t+"-"+n+"-end",r.measure=""+t+"-"+n+"-measure";var i="upload"==t?new Blob([new ArrayBuffer(e.size)]):null,s="download"==t?"GET":"POST";this._newRequest(s,{size:e.size})._sendRequest(i)}},abort:{value:function(){return this._intendedEnd=!0,this._abort()}},_progress:{value:function(t){var e=this;if(this._firstProgress)return this._firstProgress=!1;this._deferredProgress.run();var n=this._timingLabels,r=this._progressID++,i=""+n.progress+"-"+r,s=t.loaded;a.mark(i);var o,u=a.measure(""+n.measure+"-avg-"+r,n.start,i),l=s/u*1e3;if(this._lastLoadedValue){var f=a.measure(""+n.measure+"-instant-"+r,""+n.progress+"-"+(r-1),i);o=(s-this._lastLoadedValue)/f*1e3}else o=l;this._lastLoadedValue=s,this._deferredProgress=c(function(){e._avgSpeed=l,e._speedRecords.push(o),e.trigger("progress",l,o)})}},_timeout:{value:function(){this._intendedEnd=!0}},_end:{value:function(){if(this._intendedEnd)this._isRestarting=!1,this.trigger("end",this._avgSpeed,this._speedRecords);else{var t=(this._loadingType,this.settings().data);t.size*=t.multiplier,this.trigger("restart",t.size),this._isRestarting=!0,this.start()}}}}),e}(u);e.exports=l},{"../../utils/helpers":7,"../Timing":6,"./HttpModule":4}],4:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=Array.prototype.slice,i=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function p(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:p(i,e,n)}if("value"in r&&r.writable)return r.value;var s=r.get;return void 0===s?void 0:s.call(n)},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=n(t("../EventDispatcher")),c=t("../../utils/helpers"),l=c.isObject,f=c.assign,d=c.assignStrict,h=function(t){function e(t){var n=this,r=void 0===arguments[1]?{}:arguments[1];u(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this._enhanceDefaultSettings({endpoint:"./network.php",delay:8e3}),this.settings(r),this._moduleName=t,this._xhr=null,this._lastURLToken=null,this._requestingOverridden=!1,this._requesting=!1,this.on(["xhr-loadstart","xhr-upload-loadstart"],function(){n._requestingOverridden||(n._requesting=!0)}),this.on(["xhr-loadend","xhr-upload-loadend"],function(){n._requestingOverridden||(n._requesting=!1)})}return o(e,t),i(e,{settings:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return l(t)?(this._settings=d(this._defaultSettings||{},this._settings||{},t),this):this._settings||this._defaultSettings||{}})},isRequesting:{value:function(){return this._requesting}},_enhanceDefaultSettings:{value:function(t){this._defaultSettings=f(this._defaultSettings||{},t)}},_newRequest:{value:function(t,e){if(!this.trigger("_newRequest")&&!this._requestingOverridden)return console.warn("To ensure accurate measures, you can only make one request at a time."),this;var n=this.settings(),i=new XMLHttpRequest,s=["GET","POST"];if(!~s.indexOf(t))return console.warn("The HTTP method must be GET or POST."),this;e=e||{};var o=(new Date).getTime();this._lastURLToken="network-"+o;var u=n.endpoint;u+=~u.indexOf("?")?"&":"?",u+="module="+this._moduleName,Object.keys(e).forEach(function(t){var n=encodeURIComponent(e[t]);u+="&"+t+"="+n}),u+="&"+this._lastURLToken,i.open(t,u),i.timeout=n.delay,this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED&&this._xhr.abort(),this._xhr=i;var a=this,c=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"];return c.forEach(function(t){i.addEventListener(t,function(){("progress"!=t||a._requesting)&&a.trigger.apply(a,["xhr-"+t,i].concat(r.call(arguments)))}),"readystatechange"!=t&&i.upload.addEventListener(t,function(){a.trigger.apply(a,["xhr-upload-"+t,i].concat(r.call(arguments)))})}),this}},_sendRequest:{value:function(t){return this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED?this._xhr.send("undefined"!=typeof t?t:null):console.warn("A request must have been created before it can be sent."),this}},_abort:{value:function(){return this._xhr&&this._xhr.abort(),this}},_getTimingEntry:{value:function(t){return setTimeout(function(e){return function(){var n=performance.getEntriesByType("resource").filter(function(t){return~t.name.indexOf(e)});"function"==typeof t&&t(n.length?n[0]:null)}}(this._lastURLToken),0),this}},_setRequesting:{value:function(t){this._requestingOverridden=!0,this._requesting=t}}}),e}(a);e.exports=h},{"../../utils/helpers":7,"../EventDispatcher":2}],5:[function(t,e){"use strict";var n=function(t){return t&&t.__esModule?t["default"]:t},r=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function p(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:p(i,e,n)}if("value"in r&&r.writable)return r.value;var s=r.get;return void 0===s?void 0:s.call(n)},s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=n(t("./HttpModule")),a=n(t("../Timing")),c=t("../../utils/helpers"),l=c.isObject,f=c.assignStrict,d=c.except,h=function(t){function e(){var t=this,n=void 0===arguments[0]?{}:arguments[0];o(this,e),this._enhanceDefaultSettings({measures:5,attempts:3}),i(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,"latency"),this.settings(n),this._requestsLeft=0,this._attemptsLeft=0,this._latencies=[],this._requestID=0,this._timingLabels={start:null,end:null,measure:null},a.supportsResourceTiming()?this.on("xhr-load",function(){return t._measure()}):(this.on("xhr-loadstart",function(){return a.mark(t._timingLabels.start)}),this.on("xhr-readystatechange",function(e){return t._measure(e)}))}return s(e,t),r(e,{settings:{value:function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){var t=void 0===arguments[0]?null:arguments[0];return l(t)?i(Object.getPrototypeOf(e.prototype),"settings",this).call(this,f(t,{delay:0})):d(i(Object.getPrototypeOf(e.prototype),"settings",this).call(this),["delay"])})},start:{value:function(){var t=this._settings.latency,e=t.measures,n=t.attempts;return this._requestsLeft=e,this._attemptsLeft=n*e,a.supportsResourceTiming()||(this._requestsLeft++,this._attemptsLeft++),this._setRequesting(!0),this._latencies=[],this._nextRequest(),this}},_nextRequest:{value:function(){var t=this,e=void 0===arguments[0]?!1:arguments[0],n=this._requestID++,r=e?this._requestsLeft:this._requestsLeft--;if(this._attemptsLeft--&&(r||e)){var i=this._timingLabels;i.start="latency-"+n+"-start",i.end="latency-"+n+"-end",i.measure="latency-"+n+"-measure",this._newRequest("GET")._sendRequest()}else this._setRequesting(!1),setTimeout(function(){return t._end()},0)}},_measure:{value:function(){var t=this,e=void 0===arguments[0]?null:arguments[0];if(e)if(this._requestsLeft<this._settings.latency.measures){if(e.readyState==XMLHttpRequest.HEADERS_RECEIVED){var n=this._timingLabels;a.mark(n.end);var r=a.measure(n.measure,n.start,n.end);r&&this._latencies.push(r),this._abort(),this._nextRequest(!r)}}else this._nextRequest();else this._getTimingEntry(function(e){var n=e.secureConnectionStart?e.secureConnectionStart-e.connectStart:e.connectEnd-e.connectStart;n&&t._latencies.push(n),t._nextRequest(!n)})}},_end:{value:function(){var t=this._latencies,e=t.reduce(function(t,e){return t+e},0)/(t.length||1);if(e=e||null,t.length<this._settings.latency.measures){var n=this._settings.latency,r=n.measures,i=n.attempts;console.warn(["An insufficient number of measures have been processed, this could be due to your web server using","persistant connections or to your client settings (measures: "+r+", attempts: "+i+")"].join(" "))}this.trigger("end",e,t)}}}),e}(u);e.exports=h},{"../../utils/helpers":7,"../Timing":6,"./HttpModule":4}],6:[function(t,e){"use strict";var n=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(){r(this,t),this._marks={},this._measures={},this._support={performance:!!window.performance,userTiming:window.performance&&performance.mark,resourceTiming:window.performance&&"function"==typeof performance.getEntriesByType&&performance.timing}}return n(t,{mark:{value:function(t){var e=this._support,n=this._marks;return e.userTiming?performance.mark(t):n[t]=e.performance?performance.now():(new Date).getTime(),this}},measure:{value:function(t,e,n){var r=this._support,i=this._marks,s=this._measures;return"undefined"==typeof s[t]&&(r.userTiming?(performance.measure(t,e,n),s[t]=performance.getEntriesByName(t)[0].duration):s[t]=i[n]-i[e]),s[t]}},supportsResourceTiming:{value:function(){return this._support.resourceTiming}}}),t}();e.exports=new i},{}],7:[function(t,e,n){"use strict";function r(t){return void 0!=t&&null!=t&&"object"==typeof t.valueOf()}function i(t){return JSON.parse(JSON.stringify(t))}function s(){for(var t=arguments.length,e=Array(t>2?t-2:0),n=2;t>n;n++)e[n-2]=arguments[n];var i=void 0===arguments[0]?!1:arguments[0],s=void 0===arguments[1]?{}:arguments[1];return e.forEach(function(t){Object.keys(t).forEach(function(e){if(!i||s.hasOwnProperty(e)){var n=t[e];s[e]=r(n)?o(s[e],n):n}})}),s}function o(){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;t>n;n++)e[n-1]=arguments[n];var r=void 0===arguments[0]?{}:arguments[0];return s.apply(void 0,[!1,r].concat(e))}function u(){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;t>n;n++)e[n-1]=arguments[n];var r=void 0===arguments[0]?{}:arguments[0];return s.apply(void 0,[!0,r].concat(e))}function a(t,e){var n=i(t);return e.forEach(function(t){return delete n[t]}),n}function c(){var t=void 0===arguments[0]?function(){}:arguments[0];return new(function(){var e=function(){f(this,e),this.cb=t};return l(e,{run:{value:function(){this.cb&&this.cb(),delete this.cb}}}),e}())}var l=function(){function t(t,e){for(var n in e){var r=e[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(t,e)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};n.isObject=r,n.copy=i,n.assign=o,n.assignStrict=u,n.except=a,n.defer=c,Object.defineProperty(n,"__esModule",{value:!0})},{}]},{},[1])(1)});
//# sourceMappingURL=network.min.js.map