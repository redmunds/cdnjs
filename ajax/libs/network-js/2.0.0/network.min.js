!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Network=e()}}(function(){return function e(t,n,r){function i(u,o){if(!n[u]){if(!t[u]){var a="function"==typeof require&&require;if(!o&&a)return a(u,!0);if(s)return s(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[u]={exports:{}};t[u][0].call(f.exports,function(e){var n=t[u][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[u].exports}for(var s="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){r(this,e),this._eventCallbacks={}}return i(e,[{key:"on",value:function(e,t){var n=this;return e=Array.isArray(e)?e:[e],e.forEach(function(e){var r=n._eventCallbacks[e]=n._eventCallbacks[e]||[];~r.indexOf(t)||r.push(t)}),this}},{key:"off",value:function(e){var t=this,n=void 0===arguments[1]?null:arguments[1];return e=Array.isArray(e)?e:[e],e.forEach(function(e){var r=t._eventCallbacks[e];if(!n&&r)delete t._eventCallbacks[e];else{var i=r?r.indexOf(n):-1;-1!=i&&r.splice(i,1)}}),this}},{key:"trigger",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i=this._eventCallbacks[e]||[],s=!0;return i.forEach(function(e){var t=e.apply(void 0,n);t=t!==!1?!0:!1,s=s&&t}),s}}]),e}();n["default"]=s,t.exports=n["default"]},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var i=e,s=t,u=n;o=l=a=void 0,r=!1,null===i&&(i=Function.prototype);var o=Object.getOwnPropertyDescriptor(i,s);if(void 0!==o){if("value"in o)return o.value;var a=o.get;return void 0===a?void 0:a.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=s,n=u,r=!0}},a=e("./HttpModule"),l=r(a),f=e("../Timing"),c=r(f),d=e("../../utils/helpers"),h=function(e){function t(e){var n=this,r=void 0===arguments[1]?{}:arguments[1];i(this,t),e=~["upload","download"].indexOf(e)?e:"download",o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this._extendDefaultSettings({data:{size:"upload"==e?2097152:10485760,multiplier:2}}).settings(r),this._loadingType=e,this._intendedEnd=!1,this._isRestarting=!1,this._lastLoadedValue=null,this._speedRecords=[],this._avgSpeed=null,this._requestID=0,this._progressID=0,this._started=!1,this._firstProgress=!0,this._deferredProgress,this._timingLabels={start:null,progress:null,end:null,measure:null},this.on("xhr-upload-loadstart",function(){return c["default"].mark(n._timingLabels.start)}),this.on("xhr-readystatechange",function(e){n._started||e.readyState!=XMLHttpRequest.LOADING||(c["default"].mark(n._timingLabels.start),n._started=!0)});var s="upload"==e?"xhr-upload":"xhr";this.on(s+"-progress",function(e,t){return n._progress(t)}),this.on(s+"-timeout",function(){return n._timeout()}),this.on(s+"-loadend",function(){return n._end()})}return s(t,e),u(t,[{key:"start",value:function(){var e=this._loadingType,t=this.settings().data,n=this._requestID++;this._intendedEnd=!1,this._lastLoadedValue=null,this._speedRecords=[],this._started=!1,this._firstProgress=!0,this._deferredProgress=d.defer(),this._isRestarting||this.trigger("start",t.size);var r=this._timingLabels;r.start=e+"-"+n+"-start",r.progress=e+"-"+n+"-progress",r.end=e+"-"+n+"-end",r.measure=e+"-"+n+"-measure";var i="upload"==e?new Blob([new ArrayBuffer(t.size)]):null,s="download"==e?"GET":"POST";return this._newRequest(s,{size:t.size})._sendRequest(i),this}},{key:"abort",value:function(){return this._intendedEnd=!0,this._abort()}},{key:"_progress",value:function(e){var t=this;if(this._firstProgress)return this._firstProgress=!1;this._deferredProgress.run();var n=this._timingLabels,r=this._progressID++,i=n.progress+"-"+r,s=e.loaded;c["default"].mark(i);var u,o=c["default"].measure(n.measure+"-avg-"+r,n.start,i),a=s/o*1e3;if(this._lastLoadedValue){var l=c["default"].measure(n.measure+"-instant-"+r,n.progress+"-"+(r-1),i);u=(s-this._lastLoadedValue)/l*1e3}else u=a;return this._lastLoadedValue=s,this._deferredProgress=d.defer(function(){t._avgSpeed=a,t._speedRecords.push(u),t.trigger("progress",a,u)}),this}},{key:"_timeout",value:function(){return this._intendedEnd=!0,this}},{key:"_end",value:function(){if(this._intendedEnd)this._isRestarting=!1,this.trigger("end",this._avgSpeed,this._speedRecords);else{var e=(this._loadingType,this.settings().data);e.size*=e.multiplier,this.trigger("restart",e.size),this._isRestarting=!0,this.start()}return this}}]),t}(l["default"]);n["default"]=h,t.exports=n["default"]},{"../../utils/helpers":7,"../Timing":6,"./HttpModule":3}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var i=e,s=t,u=n;o=l=a=void 0,r=!1,null===i&&(i=Function.prototype);var o=Object.getOwnPropertyDescriptor(i,s);if(void 0!==o){if("value"in o)return o.value;var a=o.get;return void 0===a?void 0:a.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=s,n=u,r=!0}},a=e("../EventDispatcher"),l=r(a),f=e("../../utils/helpers"),c=function(e){function t(e){var n=this,r=void 0===arguments[1]?{}:arguments[1];i(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._extendDefaultSettings({endpoint:"./network.php",delay:8e3}),this.settings(r),this._moduleName=e,this._xhr=null,this._lastURLToken=null,this._requestingOverridden=!1,this._requesting=!1,this.on(["xhr-loadstart","xhr-upload-loadstart"],function(){n._requestingOverridden||(n._requesting=!0)}),this.on(["xhr-loadend","xhr-upload-loadend"],function(){n._requestingOverridden||(n._requesting=!1)})}return s(t,e),u(t,[{key:"settings",value:function(){var e=void 0===arguments[0]?null:arguments[0];return f.isObject(e)?(this._settings=f.assignStrict(this._defaultSettings||{},this._settings||{},e),this):this._settings||this._defaultSettings||{}}},{key:"isRequesting",value:function(){return this._requesting}},{key:"_extendDefaultSettings",value:function(e){return this._defaultSettings=f.assign(this._defaultSettings||{},e),this}},{key:"_newRequest",value:function(e,t){var n=this;if(!this.trigger("_newRequest")&&!this._requestingOverridden)return console.warn("To ensure accurate measures, you can only make one request at a time."),this;var r=this.settings(),i=new XMLHttpRequest,s=["GET","POST"];if(!~s.indexOf(e))return console.warn("The HTTP method must be GET or POST."),this;t=t||{};var u=(new Date).getTime();this._lastURLToken="network-"+u;var o=r.endpoint;o+=~o.indexOf("?")?"&":"?",o+="module="+this._moduleName,Object.keys(t).forEach(function(e){var n=encodeURIComponent(t[e]);o+="&"+e+"="+n}),o+="&"+this._lastURLToken,i.open(e,o),this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED&&this._xhr.abort(),this._xhr=i;var a=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"];a.forEach(function(e){i.addEventListener(e,function(){for(var t=arguments.length,r=Array(t),s=0;t>s;s++)r[s]=arguments[s];("progress"!=e||n._requesting)&&n.trigger.apply(n,["xhr-"+e,i].concat(r))}),"readystatechange"!=e&&i.upload.addEventListener(e,function(){for(var t=arguments.length,r=Array(t),s=0;t>s;s++)r[s]=arguments[s];n.trigger.apply(n,["xhr-upload-"+e,i].concat(r))})});var l=function(e){n.trigger("xhr-timeout"),n.trigger("xhr-upload-timeout"),setTimeout(function(){return e.abort()},r.delay)};return this.on("xhr-upload-loadstart",l).on("xhr-readystatechange",function(e){return function(t){e||t.readyState!=XMLHttpRequest.LOADING||(e=!0,l(t))}}(!1)),this}},{key:"_sendRequest",value:function(){var e=void 0===arguments[0]?null:arguments[0];return this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED?this._xhr.send(e):console.warn("A request must have been created before sending any data."),this}},{key:"_abort",value:function(){return this._xhr&&this._xhr.abort(),this}},{key:"_getTimingEntry",value:function(e){return setTimeout(function(t){return function(){var n=performance.getEntriesByType("resource").filter(function(e){return~e.name.indexOf(t)});e(n.length?n[0]:null)}}(this._lastURLToken),0),this}},{key:"_setRequesting",value:function(e){return this._requestingOverridden=!0,this._requesting=e,this}}]),t}(l["default"]);n["default"]=c,t.exports=n["default"]},{"../../utils/helpers":7,"../EventDispatcher":1}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n){for(var r=!0;r;){var i=e,s=t,u=n;o=l=a=void 0,r=!1,null===i&&(i=Function.prototype);var o=Object.getOwnPropertyDescriptor(i,s);if(void 0!==o){if("value"in o)return o.value;var a=o.get;return void 0===a?void 0:a.call(u)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=s,n=u,r=!0}},a=e("./HttpModule"),l=r(a),f=e("../Timing"),c=r(f),d=e("../../utils/helpers"),h=function(e){function t(){var e=this,n=void 0===arguments[0]?{}:arguments[0];i(this,t),o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"latency"),this._extendDefaultSettings({measures:5,attempts:3}).settings(n),this._requestsLeft=0,this._attemptsLeft=0,this._latencies=[],this._requestID=0,this._timingLabels={start:null,end:null,measure:null},c["default"].supportsResourceTiming()?this.on("xhr-load",function(){return e._measure()}):(this.on("xhr-loadstart",function(){return c["default"].mark(e._timingLabels.start)}),this.on("xhr-readystatechange",function(t){return e._measure(t)}))}return s(t,e),u(t,[{key:"settings",value:function(){var e=void 0===arguments[0]?null:arguments[0];return d.isObject(e)?o(Object.getPrototypeOf(t.prototype),"settings",this).call(this,d.assignStrict(e,{delay:0})):d.except(o(Object.getPrototypeOf(t.prototype),"settings",this).call(this),["delay"])}},{key:"start",value:function(){var e=this.settings(),t=e.measures,n=e.attempts;return this._requestsLeft=t,this._attemptsLeft=n*t,c["default"].supportsResourceTiming()||(this._requestsLeft++,this._attemptsLeft++),this._setRequesting(!0),this._latencies=[],this._nextRequest(),this}},{key:"_nextRequest",value:function(){var e=this,t=void 0===arguments[0]?!1:arguments[0],n=this._requestID++,r=t?this._requestsLeft:this._requestsLeft--;if(this._attemptsLeft--&&(r||t)){var i=this._timingLabels;i.start="latency-"+n+"-start",i.end="latency-"+n+"-end",i.measure="latency-"+n+"-measure",this._newRequest("GET")._sendRequest()}else this._setRequesting(!1),setTimeout(function(){return e._end()},0);return this}},{key:"_measure",value:function(){var e=this,t=void 0===arguments[0]?null:arguments[0];if(t)if(this._requestsLeft<this.settings().measures){if(t.readyState==XMLHttpRequest.HEADERS_RECEIVED){var n=this._timingLabels;c["default"].mark(n.end);var r=c["default"].measure(n.measure,n.start,n.end);r&&this._latencies.push(r),this._abort(),this._nextRequest(!r)}}else this._nextRequest();else this._getTimingEntry(function(t){var n=t.secureConnectionStart?t.secureConnectionStart-t.connectStart:t.connectEnd-t.connectStart;n&&e._latencies.push(n),e._nextRequest(!n)});return this}},{key:"_end",value:function(){var e=this._latencies,t=e.reduce(function(e,t){return e+t},0)/(e.length||1);if(t=t||null,e.length<this.settings().measures){var n=this.settings(),r=n.measures,i=n.attempts;console.warn(["An insufficient number of measures have been processed, this could be due to your web server using","persistant connections or to your client settings (measures: "+r+", attempts: "+i+")"].join(" "))}return this.trigger("end",t,e),this}}]),t}(l["default"]);n["default"]=h,t.exports=n["default"]},{"../../utils/helpers":7,"../Timing":6,"./HttpModule":3}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("./EventDispatcher"),a=r(o),l=e("./Http/HttpModule"),f=r(l),c=e("./Http/LatencyModule"),d=r(c),h=e("./Http/BandwidthModule"),p=r(h),g=e("./Timing"),v=r(g),_=e("../utils/helpers"),m=function(){function e(){var t=void 0===arguments[0]?{}:arguments[0];s(this,e),this._modules={},this._modulesInitialized=!1,this._pendingSettings={},this._registerModule("latency",function(e){return new d["default"](e)})._registerModule("upload",function(e){return new p["default"]("upload",e)})._registerModule("download",function(e){return new p["default"]("download",e)}),this._initModules(this.settings(t))}return u(e,[{key:"settings",value:function(){var e=this,t=void 0===arguments[0]?null:arguments[0],n=Object.keys(this._modules);if(!_.isObject(t))return n.reduce(function(t,n){return _.assign(t,i({},n,e._modules[n].settings()))},{});var r=function(){var r=_.except(t,n),s=_.except(t,Object.keys(r));return t=n.reduce(function(e,t){return _.assign(e,i({},t,r))},{}),t=_.assign(t,s),e._modulesInitialized?Object.keys(e._modules).forEach(function(n){e._modules[n].settings(t[n])}):e._pendingSettings=t,{v:e}}();return"object"==typeof r?r.v:void 0}},{key:"isRequesting",value:function(){var e=!1;for(var t in this._modules)this._modules.hasOwnProperty(t)&&(e=e||this._modules[t].isRequesting());return e}},{key:"_registerModule",value:function(e,t){return this._modules[e]=t,this}},{key:"_initModules",value:function(){var e=this;return this._modulesInitialized||(Object.keys(this._modules).forEach(function(t){e._modules[t]=e._modules[t](e._pendingSettings[t]).on("_newRequest",function(){return!e.isRequesting()}),e[t]=e._modules[t]}),this._modulesInitialized=!0),this}}],[{key:"_exposeInternalClasses",value:function(){var e=_.getGlobalObject(),t={EventDispatcher:a["default"],HttpModule:f["default"],LatencyModule:d["default"],BandwidthModule:p["default"],Timing:v["default"]};return Object.keys(t).forEach(function(n){e[n]=t[n]}),this}}]),e}();n["default"]=m,t.exports=n["default"]},{"../utils/helpers":7,"./EventDispatcher":1,"./Http/BandwidthModule":2,"./Http/HttpModule":3,"./Http/LatencyModule":4,"./Timing":6}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/helpers"),u=function(){function e(){r(this,e);var t=s.getGlobalObject();this._support={performance:!!t.performance,userTiming:t.performance&&performance.mark,resourceTiming:t.performance&&"function"==typeof performance.getEntriesByType&&performance.timing},this._marks={},this._measures={}}return i(e,[{key:"mark",value:function(e){var t=this._support,n=this._marks;return t.userTiming&&performance.mark(e),n[e]=t.performance?performance.now():(new Date).getTime(),this}},{key:"measure",value:function(e,t,n){var r=this._support,i=this._marks,s=this._measures;if("undefined"==typeof s[e]){var u=i[n]-i[t];if(r.userTiming){performance.measure(e,t,n);var o=performance.getEntriesByName(e);s[e]=o.length?o[0].duration:u}else s[e]=u}return s[e]}},{key:"supportsResourceTiming",value:function(){return this._support.resourceTiming}}]),e}();n["default"]=new u,t.exports=n["default"]},{"../utils/helpers":7}],7:[function(e,t,n){(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){return"undefined"!=typeof self?self:"undefined"!=typeof e?e:new Function("return this")()}function i(e){return void 0!=e&&null!=e&&"object"==typeof e.valueOf()}function s(e){return JSON.parse(JSON.stringify(e))}function u(e){var t=void 0===arguments[1]?{}:arguments[1];t=s(t);for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;n>o;o++)r[o-2]=arguments[o];return r.forEach(function(n){Object.keys(n).forEach(function(r){if(!e||t.hasOwnProperty(r)){var s=n[r];t[r]=i(s)?u(e,t[r],s):s}})}),t}function o(){for(var e=void 0===arguments[0]?{}:arguments[0],t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return u.apply(void 0,[!1,e].concat(n))}function a(){for(var e=void 0===arguments[0]?{}:arguments[0],t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return u.apply(void 0,[!0,e].concat(n))}function l(e,t){var n=s(e);return t.forEach(function(e){return delete n[e]}),n}function f(){var e=void 0===arguments[0]?function(){}:arguments[0];return new(function(){var n=function r(){t(this,r),this.func=e};return c(n,[{key:"run",value:function(){this.func&&this.func(),delete this.func}}]),n}())}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.getGlobalObject=r,n.isObject=i,n.copy=s,n.assign=o,n.assignStrict=a,n.except=l,n.defer=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[5])(5)});
//# sourceMappingURL=network.min.js.map