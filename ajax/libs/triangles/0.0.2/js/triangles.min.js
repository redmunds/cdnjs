/**

The MIT License (MIT)

Copyright (c) 2014 Maksim Surguy

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

**/
var Delaunay;
(function(){function a(b){var a=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,g;for(g=b.length;g--;)b[g][0]<a&&(a=b[g][0]),b[g][0]>d&&(d=b[g][0]),b[g][1]<c&&(c=b[g][1]),b[g][1]>h&&(h=b[g][1]);b=d-a;d=h-c;h=Math.max(b,d);a+=.5*b;c+=.5*d;return[[a-20*h,c-h],[a,c+20*h],[a+20*h,c-h]]}function b(b,a,c,p){var h=b[a][0],g=b[a][1],m=b[c][0],r=b[c][1],s=b[p][0],n=b[p][1],q=Math.abs(g-r),y=Math.abs(r-n),x,w;if(q<d&&y<d)throw Error("Eek! Coincident points!");q<
d?(b=(m+h)/2,q=-((s-m)/(n-r))*(b-(m+s)/2)+(r+n)/2):y<d?(b=(s+m)/2,q=-((m-h)/(r-g))*(b-(h+m)/2)+(g+r)/2):(x=-((m-h)/(r-g)),w=-((s-m)/(n-r)),h=(h+m)/2,s=(m+s)/2,g=(g+r)/2,n=(r+n)/2,b=(x*h-w*s+n-g)/(x-w),q=q>y?x*(b-h)+g:w*(b-s)+n);m-=b;r-=q;return{i:a,j:c,k:p,x:b,y:q,r:m*m+r*r}}function c(b){var a,c,d,h,g,m;for(c=b.length;c;)for(h=b[--c],d=b[--c],a=c;a;)if(m=b[--a],g=b[--a],d===g&&h===m||d===m&&h===g){b.splice(c,2);b.splice(a,2);break}}var d=1/1048576;Delaunay={triangulate:function(e,f){var k=e.length,
p,h,g,m,r,s,n,q,y;if(3>k)return[];e=e.slice(0);if(f)for(p=k;p--;)e[p]=e[p][f];g=Array(k);for(p=k;p--;)g[p]=p;g.sort(function(b,a){return e[a][0]-e[b][0]});p=a(e);e.push(p[0],p[1],p[2]);m=[b(e,k+0,k+1,k+2)];r=[];s=[];for(p=g.length;p--;s.length=0){y=g[p];for(h=m.length;h--;)n=e[y][0]-m[h].x,0<n&&n*n>m[h].r?(r.push(m[h]),m.splice(h,1)):(q=e[y][1]-m[h].y,n*n+q*q-m[h].r>d||(s.push(m[h].i,m[h].j,m[h].j,m[h].k,m[h].k,m[h].i),m.splice(h,1)));c(s);for(h=s.length;h;)q=s[--h],n=s[--h],m.push(b(e,n,q,y))}for(p=
m.length;p--;)r.push(m[p]);m.length=0;for(p=r.length;p--;)r[p].i<k&&r[p].j<k&&r[p].k<k&&m.push(r[p].i,r[p].j,r[p].k);return m},contains:function(b,a){if(a[0]<b[0][0]&&a[0]<b[1][0]&&a[0]<b[2][0]||a[0]>b[0][0]&&a[0]>b[1][0]&&a[0]>b[2][0]||a[1]<b[0][1]&&a[1]<b[1][1]&&a[1]<b[2][1]||a[1]>b[0][1]&&a[1]>b[1][1]&&a[1]>b[2][1])return null;var c=b[1][0]-b[0][0],d=b[2][0]-b[0][0],h=b[1][1]-b[0][1],g=b[2][1]-b[0][1],m=c*g-d*h;if(0===m)return null;d=(g*(a[0]-b[0][0])-d*(a[1]-b[0][1]))/m;c=(c*(a[1]-b[0][1])-h*
(a[0]-b[0][0]))/m;return 0>d||0>c||1<d+c?null:[d,c]}};"undefined"!==typeof module&&(module.exports=Delaunay)})();
(function(a,b,c){function d(b,a,c){b.addEventListener?b.addEventListener(a,c,!1):b.attachEvent("on"+a,c)}function e(b){if("keypress"==b.type){var a=String.fromCharCode(b.which);b.shiftKey||(a=a.toLowerCase());return a}return q[b.which]?q[b.which]:y[b.which]?y[b.which]:String.fromCharCode(b.which).toLowerCase()}function f(b){b=b||{};var a=!1,c;for(c in B)b[c]?a=!0:B[c]=0;a||(F=!1)}function k(b,a,c,f,d,e){var g,k,N=[],h=c.type;if(!t[b])return[];"keyup"==h&&m(b)&&(a=[b]);for(g=0;g<t[b].length;++g)if(k=
t[b][g],!(!f&&k.seq&&B[k.seq]!=k.level||h!=k.action||("keypress"!=h||c.metaKey||c.ctrlKey)&&a.sort().join(",")!==k.modifiers.sort().join(","))){var p=f&&k.seq==f&&k.level==e;(!f&&k.combo==d||p)&&t[b].splice(g,1);N.push(k)}return N}function p(b){var a=[];b.shiftKey&&a.push("shift");b.altKey&&a.push("alt");b.ctrlKey&&a.push("ctrl");b.metaKey&&a.push("meta");return a}function h(b,a,c,f){E.stopCallback(a,a.target||a.srcElement,c,f)||!1!==b(a,c)||(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0)}function g(b){"number"!==typeof b.which&&(b.which=b.keyCode);var a=e(b);a&&("keyup"==b.type&&H===a?H=!1:E.handleKey(a,p(b),b))}function m(b){return"shift"==b||"ctrl"==b||"alt"==b||"meta"==b}function r(b,a,c,d){function g(a){return function(){F=a;++B[b];clearTimeout(C);C=setTimeout(f,1E3)}}function k(a){h(c,a,b);"keyup"!==d&&(H=e(a));setTimeout(f,10)}for(var m=B[b]=0;m<a.length;++m){var p=m+1===a.length?k:g(d||s(a[m+1]).action);n(a[m],p,d,b,m)}}function s(b,a){var c,
f,d,g=[];c="+"===b?["+"]:b.split("+");for(d=0;d<c.length;++d)f=c[d],w[f]&&(f=w[f]),a&&"keypress"!=a&&x[f]&&(f=x[f],g.push("shift")),m(f)&&g.push(f);c=f;d=a;if(!d){if(!D){D={};for(var e in q)95<e&&112>e||q.hasOwnProperty(e)&&(D[q[e]]=e)}d=D[c]?"keydown":"keypress"}"keypress"==d&&g.length&&(d="keydown");return{key:f,modifiers:g,action:d}}function n(b,a,c,f,d){v[b+":"+c]=a;b=b.replace(/\s+/g," ");var e=b.split(" ");1<e.length?r(b,e,a,c):(c=s(b,c),t[c.key]=t[c.key]||[],k(c.key,c.modifiers,{type:c.action},
f,b,d),t[c.key][f?"unshift":"push"]({callback:a,modifiers:c.modifiers,action:c.action,seq:f,level:d,combo:b}))}var q={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},x={"~":"`","!":"1",
"@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},w={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},D,t={},v={},B={},C,H=!1,G=!1,F=!1;for(c=1;20>c;++c)q[111+c]="f"+c;for(c=0;9>=c;++c)q[c+96]=c;d(b,"keypress",g);d(b,"keydown",g);d(b,"keyup",g);var E={bind:function(b,a,c){b=b instanceof Array?b:[b];for(var f=0;f<b.length;++f)n(b[f],a,c);return this},
unbind:function(b,a){return E.bind(b,function(){},a)},trigger:function(b,a){if(v[b+":"+a])v[b+":"+a]({},b);return this},reset:function(){t={};v={};return this},stopCallback:function(b,a){return-1<(" "+a.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==a.tagName||"SELECT"==a.tagName||"TEXTAREA"==a.tagName||a.isContentEditable},handleKey:function(b,a,c){var d=k(b,a,c),e;a={};var g=0,p=!1;for(e=0;e<d.length;++e)d[e].seq&&(g=Math.max(g,d[e].level));for(e=0;e<d.length;++e)d[e].seq?d[e].level==g&&(p=!0,
a[d[e].seq]=1,h(d[e].callback,c,d[e].combo,d[e].seq)):p||h(d[e].callback,c,d[e].combo);d="keypress"==c.type&&G;c.type!=F||m(b)||d||f(a);G=p&&"keydown"==c.type}};a.Mousetrap=E;"function"===typeof define&&define.amd&&define(E)})(window,document);
(function(){function a(b,a){return[].slice.call((a||document).querySelectorAll(b))}if(window.addEventListener){var b=window.StyleFix={link:function(a){try{if("stylesheet"!==a.rel||a.hasAttribute("data-noprefix"))return}catch(d){return}var e=a.href||a.getAttribute("data-href"),f=e.replace(/[^\/]+$/,""),k=(/^[a-z]{3,10}:/.exec(f)||[""])[0],p=(/^[a-z]{3,10}:\/\/[^\/]+/.exec(f)||[""])[0],h=/^([^?]*)\??/.exec(e)[1],g=a.parentNode,m=new XMLHttpRequest,r;m.onreadystatechange=function(){4===m.readyState&&
r()};r=function(){var d=m.responseText;if(d&&a.parentNode&&(!m.status||400>m.status||600<m.status)){d=b.fix(d,!0,a);if(f)var d=d.replace(/url\(\s*?((?:"|')?)(.+?)\1\s*?\)/gi,function(b,a,c){return/^([a-z]{3,10}:|#)/i.test(c)?b:/^\/\//.test(c)?'url("'+k+c+'")':/^\//.test(c)?'url("'+p+c+'")':/^\?/.test(c)?'url("'+h+c+'")':'url("'+f+c+'")'}),e=f.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1"),d=d.replace(RegExp("\\b(behavior:\\s*?url\\('?\"?)"+e,"gi"),"$1");e=document.createElement("style");e.textContent=
d;e.media=a.media;e.disabled=a.disabled;e.setAttribute("data-href",a.getAttribute("href"));g.insertBefore(e,a);g.removeChild(a);e.media=a.media}};try{m.open("GET",e),m.send(null)}catch(s){"undefined"!=typeof XDomainRequest&&(m=new XDomainRequest,m.onerror=m.onprogress=function(){},m.onload=r,m.open("GET",e),m.send(null))}a.setAttribute("data-inprogress","")},styleElement:function(a){if(!a.hasAttribute("data-noprefix")){var d=a.disabled;a.textContent=b.fix(a.textContent,!0,a);a.disabled=d}},styleAttribute:function(a){var d=
a.getAttribute("style"),d=b.fix(d,!1,a);a.setAttribute("style",d)},process:function(){a('link[rel="stylesheet"]:not([data-inprogress])').forEach(StyleFix.link);a("style").forEach(StyleFix.styleElement);a("[style]").forEach(StyleFix.styleAttribute)},register:function(a,d){(b.fixers=b.fixers||[]).splice(void 0===d?b.fixers.length:d,0,a)},fix:function(a,d,e){for(var f=0;f<b.fixers.length;f++)a=b.fixers[f](a,d,e)||a;return a},camelCase:function(b){return b.replace(/-([a-z])/g,function(b,a){return a.toUpperCase()}).replace("-",
"")},deCamelCase:function(b){return b.replace(/[A-Z]/g,function(b){return"-"+b.toLowerCase()})}};(function(){setTimeout(function(){a('link[rel="stylesheet"]').forEach(StyleFix.link)},10);document.addEventListener("DOMContentLoaded",StyleFix.process,!1)})()}})();
(function(a){function b(b,a,f,k,p){b=c[b];b.length&&(b=RegExp(a+"("+b.join("|")+")"+f,"gi"),p=p.replace(b,k));return p}if(window.StyleFix&&window.getComputedStyle){var c=window.PrefixFree={prefixCSS:function(a,e,f){var k=c.prefix;-1<c.functions.indexOf("linear-gradient")&&(a=a.replace(/(\s|:|,)(repeating-)?linear-gradient\(\s*(-?\d*\.?\d*)deg/ig,function(a,b,c,f){return b+(c||"")+"linear-gradient("+(90-f)+"deg"}));a=b("functions","(\\s|:|,)","\\s*\\(","$1"+k+"$2(",a);a=b("keywords","(\\s|:)","(\\s|;|\\}|$)",
"$1"+k+"$2$3",a);a=b("properties","(^|\\{|\\s|;)","\\s*:","$1"+k+"$2:",a);if(c.properties.length){var p=RegExp("\\b("+c.properties.join("|")+")(?!:)","gi");a=b("valueProperties","\\b",":(.+?);",function(a){return a.replace(p,k+"$1")},a)}e&&(a=b("selectors","","\\b",c.prefixSelector,a),a=b("atrules","@","\\b","@"+k+"$1",a));a=a.replace(RegExp("-"+k,"g"),"-");return a=a.replace(/-\*-(?=[a-z]+)/gi,c.prefix)},property:function(a){return(c.properties.indexOf(a)?c.prefix:"")+a},value:function(a,e){a=b("functions",
"(^|\\s|,)","\\s*\\(","$1"+c.prefix+"$2(",a);return a=b("keywords","(^|\\s)","(\\s|$)","$1"+c.prefix+"$2$3",a)},prefixSelector:function(a){return a.replace(/^:{1,2}/,function(a){return a+c.prefix})},prefixProperty:function(a,b){var f=c.prefix+a;return b?StyleFix.camelCase(f):f}};(function(){var a={},b=[],f=getComputedStyle(document.documentElement,null),k=document.createElement("div").style,p=function(c){if("-"===c.charAt(0)){b.push(c);c=c.split("-");var f=c[1];for(a[f]=++a[f]||1;3<c.length;)c.pop(),
f=c.join("-"),StyleFix.camelCase(f)in k&&-1===b.indexOf(f)&&b.push(f)}};if(0<f.length)for(var h=0;h<f.length;h++)p(f[h]);else for(var g in f)p(StyleFix.deCamelCase(g));var h={uses:0},m;for(m in a)f=a[m],h.uses<f&&(h={prefix:m,uses:f});c.prefix="-"+h.prefix+"-";c.Prefix=StyleFix.camelCase(c.prefix);c.properties=[];for(h=0;h<b.length;h++)g=b[h],0===g.indexOf(c.prefix)&&(m=g.slice(c.prefix.length),StyleFix.camelCase(m)in k||c.properties.push(m));!("Ms"!=c.Prefix||"transform"in k||"MsTransform"in k)&&
"msTransform"in k&&c.properties.push("transform","transform-origin");c.properties.sort()})();(function(){function a(b,c){k[c]="";k[c]=b;return!!k[c]}var b={"linear-gradient":{property:"backgroundImage",params:"red, teal"},calc:{property:"width",params:"1px + 5%"},element:{property:"backgroundImage",params:"#foo"},"cross-fade":{property:"backgroundImage",params:"url(a.png), url(b.png), 50%"}};b["repeating-linear-gradient"]=b["repeating-radial-gradient"]=b["radial-gradient"]=b["linear-gradient"];var f=
{initial:"color","zoom-in":"cursor","zoom-out":"cursor",box:"display",flexbox:"display","inline-flexbox":"display",flex:"display","inline-flex":"display",grid:"display","inline-grid":"display","min-content":"width"};c.functions=[];c.keywords=[];var k=document.createElement("div").style,p;for(p in b){var h=b[p],g=h.property,h=p+"("+h.params+")";!a(h,g)&&a(c.prefix+h,g)&&c.functions.push(p)}for(var m in f)g=f[m],!a(m,g)&&a(c.prefix+m,g)&&c.keywords.push(m)})();(function(){function b(a){k.textContent=
a+"{}";return!!k.sheet.cssRules.length}var e={":read-only":null,":read-write":null,":any-link":null,"::selection":null},f={keyframes:"name",viewport:null,document:'regexp(".")'};c.selectors=[];c.atrules=[];var k=a.appendChild(document.createElement("style")),p;for(p in e){var h=p+(e[p]?"("+e[p]+")":"");!b(h)&&b(c.prefixSelector(h))&&c.selectors.push(p)}for(var g in f)h=g+" "+(f[g]||""),!b("@"+h)&&b("@"+c.prefix+h)&&c.atrules.push(g);a.removeChild(k)})();c.valueProperties=["transition","transition-property"];
a.className+=" "+c.prefix;StyleFix.register(c.prefixCSS)}})(document.documentElement);FSS={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"};FSS.Array="function"===typeof Float32Array?Float32Array:Array;FSS.Utils={isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}};
(function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var f=(new Date).getTime(),k=Math.max(0,16-(f-a)),p=window.setTimeout(function(){b(f+k)},k);a=f+k;return p});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();Math.PIM2=2*Math.PI;Math.PID2=Math.PI/2;Math.randomInRange=function(a,b){return a+(b-a)*Math.random()};Math.clamp=function(a,b,c){a=Math.max(a,b);return a=Math.min(a,c)};
FSS.Vector3={create:function(a,b,c){var d=new FSS.Array(3);this.set(d,a,b,c);return d},clone:function(a){var b=this.create();this.copy(b,a);return b},set:function(a,b,c,d){a[0]=b||0;a[1]=c||0;a[2]=d||0;return this},setX:function(a,b){a[0]=b||0;return this},setY:function(a,b){a[1]=b||0;return this},setZ:function(a,b){a[2]=b||0;return this},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return this},add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return this},addVectors:function(a,b,c){a[0]=b[0]+
c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return this},addScalar:function(a,b){a[0]+=b;a[1]+=b;a[2]+=b;return this},subtract:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return this},subtractVectors:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return this},subtractScalar:function(a,b){a[0]-=b;a[1]-=b;a[2]-=b;return this},multiply:function(a,b){a[0]*=b[0];a[1]*=b[1];a[2]*=b[2];return this},multiplyVectors:function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return this},multiplyScalar:function(a,
b){a[0]*=b;a[1]*=b;a[2]*=b;return this},divide:function(a,b){a[0]/=b[0];a[1]/=b[1];a[2]/=b[2];return this},divideVectors:function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return this},divideScalar:function(a,b){0!==b?(a[0]/=b,a[1]/=b,a[2]/=b):(a[0]=0,a[1]=0,a[2]=0);return this},cross:function(a,b){var c=a[0],d=a[1],e=a[2];a[0]=d*b[2]-e*b[1];a[1]=e*b[0]-c*b[2];a[2]=c*b[1]-d*b[0];return this},crossVectors:function(a,b,c){a[0]=b[1]*c[2]-b[2]*c[1];a[1]=b[2]*c[0]-b[0]*c[2];a[2]=b[0]*c[1]-b[1]*
c[0];return this},min:function(a,b){a[0]<b&&(a[0]=b);a[1]<b&&(a[1]=b);a[2]<b&&(a[2]=b);return this},max:function(a,b){a[0]>b&&(a[0]=b);a[1]>b&&(a[1]=b);a[2]>b&&(a[2]=b);return this},clamp:function(a,b,c){this.min(a,b);this.max(a,c);return this},limit:function(a,b,c){var d=this.length(a);null!==b&&d<b?this.setLength(a,b):null!==c&&d>c&&this.setLength(a,c);return this},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},normalise:function(a){return this.divideScalar(a,this.length(a))},negate:function(a){return this.multiplyScalar(a,
-1)},distanceSquared:function(a,b){var c=a[0]-b[0],d=a[1]-b[1],e=a[2]-b[2];return c*c+d*d+e*e},distance:function(a,b){return Math.sqrt(this.distanceSquared(a,b))},lengthSquared:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},length:function(a){return Math.sqrt(this.lengthSquared(a))},setLength:function(a,b){var c=this.length(a);0!==c&&b!==c&&this.multiplyScalar(a,b/c);return this}};
FSS.Vector4={create:function(a,b,c,d){d=new FSS.Array(4);this.set(d,a,b,c);return d},set:function(a,b,c,d,e){a[0]=b||0;a[1]=c||0;a[2]=d||0;a[3]=e||0;return this},setX:function(a,b){a[0]=b||0;return this},setY:function(a,b){a[1]=b||0;return this},setZ:function(a,b){a[2]=b||0;return this},setW:function(a,b){a[3]=b||0;return this},add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return this},multiplyVectors:function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return this},
multiplyScalar:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;return this},min:function(a,b){a[0]<b&&(a[0]=b);a[1]<b&&(a[1]=b);a[2]<b&&(a[2]=b);a[3]<b&&(a[3]=b);return this},max:function(a,b){a[0]>b&&(a[0]=b);a[1]>b&&(a[1]=b);a[2]>b&&(a[2]=b);a[3]>b&&(a[3]=b);return this},clamp:function(a,b,c){this.min(a,b);this.max(a,c);return this}};FSS.Color=function(a,b){this.rgba=FSS.Vector4.create();this.hex=a||"#000000";this.opacity=FSS.Utils.isNumber(b)?b:1;this.set(this.hex,this.opacity)};
FSS.Color.prototype={set:function(a,b){a=a.replace("#","");var c=a.length/3;this.rgba[0]=parseInt(a.substring(0*c,1*c),16)/255;this.rgba[1]=parseInt(a.substring(1*c,2*c),16)/255;this.rgba[2]=parseInt(a.substring(2*c,3*c),16)/255;this.rgba[3]=FSS.Utils.isNumber(b)?b:this.rgba[3];return this},hexify:function(a){a=Math.ceil(255*a).toString(16);1===a.length&&(a="0"+a);return a},format:function(){var a=this.hexify(this.rgba[0]),b=this.hexify(this.rgba[1]),c=this.hexify(this.rgba[2]);return this.hex="#"+
a+b+c}};FSS.Object=function(){this.position=FSS.Vector3.create()};FSS.Object.prototype={setPosition:function(a,b,c){FSS.Vector3.set(this.position,a,b,c);return this}};FSS.Light=function(a,b){FSS.Object.call(this);this.ambient=new FSS.Color(a||"#FFFFFF");this.diffuse=new FSS.Color(b||"#FFFFFF");this.ray=FSS.Vector3.create()};FSS.Light.prototype=Object.create(FSS.Object.prototype);FSS.Vertex=function(a,b,c){this.position=FSS.Vector3.create(a,b,c)};
FSS.Vertex.prototype={setPosition:function(a,b,c){FSS.Vector3.set(this.position,a,b,c);return this}};
FSS.Triangle=function(a,b,c){this.a=a||new FSS.Vertex;this.b=b||new FSS.Vertex;this.c=c||new FSS.Vertex;this.vertices=[this.a,this.b,this.c];this.u=FSS.Vector3.create();this.v=FSS.Vector3.create();this.centroid=FSS.Vector3.create();this.normal=FSS.Vector3.create();this.color=new FSS.Color;this.polygon=document.createElementNS(FSS.SVGNS,"polygon");this.polygon.setAttributeNS(null,"stroke-linejoin","round");this.polygon.setAttributeNS(null,"stroke-miterlimit","1");this.polygon.setAttributeNS(null,"stroke-width",
"1");this.computeCentroid();this.computeNormal()};
FSS.Triangle.prototype={computeCentroid:function(){this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0];this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1];this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2];FSS.Vector3.divideScalar(this.centroid,3);return this},computeNormal:function(){FSS.Vector3.subtractVectors(this.u,this.b.position,this.a.position);FSS.Vector3.subtractVectors(this.v,this.c.position,this.a.position);FSS.Vector3.crossVectors(this.normal,
this.u,this.v);FSS.Vector3.normalise(this.normal);return this}};FSS.Geometry=function(){this.vertices=[];this.triangles=[];this.dirty=!1};FSS.Geometry.prototype={update:function(){if(this.dirty){var a,b;for(a=this.triangles.length-1;0<=a;a--)b=this.triangles[a],b.computeCentroid(),b.computeNormal();this.dirty=!1}return this}};
FSS.Plane=function(a,b,c){FSS.Geometry.call(this);this.width=a||100;this.height=b||100;var d,e;c=Array(c);offsetX=-.5*this.width;offsetY=.5*this.height;for(f=c.length;f--;)d=offsetX+Math.random()*a,e=offsetY-Math.random()*b,c[f]=[d,e];c.push([offsetX,offsetY]);c.push([offsetX+a/2,offsetY]);c.push([offsetX+a,offsetY]);c.push([offsetX+a,offsetY-b/2]);c.push([offsetX+a,offsetY-b]);c.push([offsetX+a/2,offsetY-b]);c.push([offsetX,offsetY-b]);c.push([offsetX,offsetY-b/2]);for(var f=6;0<=f;f--)c.push([offsetX+
Math.random()*a,offsetY]),c.push([offsetX,offsetY-Math.random()*b]),c.push([offsetX+a,offsetY-Math.random()*b]),c.push([offsetX+Math.random()*a,offsetY-b]);a=Delaunay.triangulate(c);for(f=a.length;f;)--f,v1=new FSS.Vertex(Math.ceil(c[a[f]][0]),Math.ceil(c[a[f]][1])),--f,v2=new FSS.Vertex(Math.ceil(c[a[f]][0]),Math.ceil(c[a[f]][1])),--f,v3=new FSS.Vertex(Math.ceil(c[a[f]][0]),Math.ceil(c[a[f]][1])),t1=new FSS.Triangle(v1,v2,v3),this.triangles.push(t1),this.vertices.push(v1),this.vertices.push(v2),
this.vertices.push(v3)};FSS.Plane.prototype=Object.create(FSS.Geometry.prototype);FSS.Material=function(a,b){this.ambient=new FSS.Color(a||"#444444");this.diffuse=new FSS.Color(b||"#FFFFFF");this.slave=new FSS.Color};FSS.Mesh=function(a,b){FSS.Object.call(this);this.geometry=a||new FSS.Geometry;this.material=b||new FSS.Material;this.side=FSS.FRONT;this.visible=!0};FSS.Mesh.prototype=Object.create(FSS.Object.prototype);
FSS.Mesh.prototype.update=function(a,b){var c,d,e,f,k;this.geometry.update();if(b)for(c=this.geometry.triangles.length-1;0<=c;c--){d=this.geometry.triangles[c];FSS.Vector4.set(d.color.rgba);for(e=a.length-1;0<=e;e--)f=a[e],FSS.Vector3.subtractVectors(f.ray,f.position,d.centroid),FSS.Vector3.normalise(f.ray),k=FSS.Vector3.dot(d.normal,f.ray),this.side===FSS.FRONT?k=Math.max(k,0):this.side===FSS.BACK?k=Math.abs(Math.min(k,0)):this.side===FSS.DOUBLE&&(k=Math.max(Math.abs(k),0)),FSS.Vector4.multiplyVectors(this.material.slave.rgba,
this.material.ambient.rgba,f.ambient.rgba),FSS.Vector4.add(d.color.rgba,this.material.slave.rgba),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,f.diffuse.rgba),FSS.Vector4.multiplyScalar(this.material.slave.rgba,k),FSS.Vector4.add(d.color.rgba,this.material.slave.rgba);FSS.Vector4.clamp(d.color.rgba,0,1)}return this};FSS.Scene=function(){this.meshes=[];this.lights=[]};
FSS.Scene.prototype={add:function(a){a instanceof FSS.Mesh&&!~this.meshes.indexOf(a)?this.meshes.push(a):a instanceof FSS.Light&&!~this.lights.indexOf(a)&&this.lights.push(a);return this},remove:function(a){a instanceof FSS.Mesh&&~this.meshes.indexOf(a)?this.meshes.splice(this.meshes.indexOf(a),1):a instanceof FSS.Light&&~this.lights.indexOf(a)&&this.lights.splice(this.lights.indexOf(a),1);return this}};FSS.Renderer=function(){this.halfHeight=this.halfWidth=this.height=this.width=0};
FSS.Renderer.prototype={setSize:function(a,b){if(this.width!==a||this.height!==b)return this.width=a,this.height=b,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this},clear:function(){return this},render:function(a){return this}};FSS.CanvasRenderer=function(){FSS.Renderer.call(this);this.element=document.createElement("canvas");this.element.style.display="block";this.context=this.element.getContext("2d");this.setSize(this.element.width,this.element.height)};
FSS.CanvasRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.CanvasRenderer.prototype.setSize=function(a,b){FSS.Renderer.prototype.setSize.call(this,a,b);this.element.width=a;this.element.height=b;this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight);return this};FSS.CanvasRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height);return this};
FSS.CanvasRenderer.prototype.render=function(a){FSS.Renderer.prototype.render.call(this,a);var b,c,d,e,f;this.clear();this.context.lineJoin="round";this.context.lineWidth=1;for(b=a.meshes.length-1;0<=b;b--)if(c=a.meshes[b],c.visible)for(c.update(a.lights,!0),d=c.geometry.triangles.length-1;0<=d;d--)e=c.geometry.triangles[d],f=e.color.format(),this.context.beginPath(),this.context.moveTo(e.a.position[0],e.a.position[1]),this.context.lineTo(e.b.position[0],e.b.position[1]),this.context.lineTo(e.c.position[0],
e.c.position[1]),this.context.closePath(),this.context.strokeStyle=f,this.context.fillStyle=f,this.context.stroke(),this.context.fill();return this};
FSS.WebGLRenderer=function(){FSS.Renderer.call(this);this.element=document.createElement("canvas");this.element.style.display="block";this.lights=this.vertices=null;this.gl=this.getContext(this.element,{preserveDrawingBuffer:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,alpha:!0});if(this.unsupported=!this.gl)return"WebGL is not supported by your browser.";this.gl.clearColor(0,0,0,0);this.gl.enable(this.gl.DEPTH_TEST);this.setSize(this.element.width,this.element.height)};
FSS.WebGLRenderer.prototype=Object.create(FSS.Renderer.prototype);FSS.WebGLRenderer.prototype.getContext=function(a,b){var c=!1;try{if(!(c=a.getContext("experimental-webgl",b)))throw"Error creating WebGL context.";}catch(d){console.error(d)}return c};FSS.WebGLRenderer.prototype.setSize=function(a,b){FSS.Renderer.prototype.setSize.call(this,a,b);if(!this.unsupported)return this.element.width=a,this.element.height=b,this.gl.viewport(0,0,a,b),this};
FSS.WebGLRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);if(!this.unsupported)return this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this};
FSS.WebGLRenderer.prototype.render=function(a){FSS.Renderer.prototype.render.call(this,a);if(!this.unsupported){var b,c,d,e,f,k,p,h;k=!1;var g=a.lights.length,m,r,s,n=0;this.clear();if(this.lights!==g)if(this.lights=g,0<this.lights)this.buildProgram(g);else return;if(this.program){for(b=a.meshes.length-1;0<=b;b--)c=a.meshes[b],c.geometry.dirty&&(k=!0),c.update(a.lights,!1),n+=3*c.geometry.triangles.length;if(k||this.vertices!==n)for(p in this.vertices=n,this.program.attributes){k=this.program.attributes[p];
k.data=new FSS.Array(n*k.size);m=0;for(b=a.meshes.length-1;0<=b;b--)for(c=a.meshes[b],d=0,e=c.geometry.triangles.length;d<e;d++)for(f=c.geometry.triangles[d],r=0,s=f.vertices.length;r<s;r++){vertex=f.vertices[r];switch(p){case "side":this.setBufferData(m,k,c.side);break;case "position":this.setBufferData(m,k,vertex.position);break;case "centroid":this.setBufferData(m,k,f.centroid);break;case "normal":this.setBufferData(m,k,f.normal);break;case "ambient":this.setBufferData(m,k,c.material.ambient.rgba);
break;case "diffuse":this.setBufferData(m,k,c.material.diffuse.rgba)}m++}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,k.buffer);this.gl.bufferData(this.gl.ARRAY_BUFFER,k.data,this.gl.DYNAMIC_DRAW);this.gl.enableVertexAttribArray(k.location);this.gl.vertexAttribPointer(k.location,k.size,this.gl.FLOAT,!1,0,0)}this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]);for(k=g-1;0<=k;k--)b=a.lights[k],this.setBufferData(k,this.program.uniforms.lightPosition,b.position),this.setBufferData(k,
this.program.uniforms.lightAmbient,b.ambient.rgba),this.setBufferData(k,this.program.uniforms.lightDiffuse,b.diffuse.rgba);for(h in this.program.uniforms)switch(k=this.program.uniforms[h],b=k.location,a=k.data,k.structure){case "3f":this.gl.uniform3f(b,a[0],a[1],a[2]);break;case "3fv":this.gl.uniform3fv(b,a);break;case "4fv":this.gl.uniform4fv(b,a)}}this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices);return this}};
FSS.WebGLRenderer.prototype.setBufferData=function(a,b,c){if(FSS.Utils.isNumber(c))b.data[a*b.size]=c;else for(var d=c.length-1;0<=d;d--)b.data[a*b.size+d]=c[d]};
FSS.WebGLRenderer.prototype.buildProgram=function(a){if(!this.unsupported){var b=FSS.WebGLRenderer.VS(a),c=FSS.WebGLRenderer.FS(a),d=b+c;if(!this.program||this.program.code!==d){var e=this.gl.createProgram(),b=this.buildShader(this.gl.VERTEX_SHADER,b),c=this.buildShader(this.gl.FRAGMENT_SHADER,c);this.gl.attachShader(e,b);this.gl.attachShader(e,c);this.gl.linkProgram(e);if(!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))return a=this.gl.getError(),e=this.gl.getProgramParameter(e,this.gl.VALIDATE_STATUS),
console.error("Could not initialise shader.\nVALIDATE_STATUS: "+e+"\nERROR: "+a),null;this.gl.deleteShader(c);this.gl.deleteShader(b);e.code=d;e.attributes={side:this.buildBuffer(e,"attribute","aSide",1,"f"),position:this.buildBuffer(e,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(e,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(e,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(e,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(e,"attribute","aDiffuse",4,"v4")};
e.uniforms={resolution:this.buildBuffer(e,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(e,"uniform","uLightPosition",3,"3fv",a),lightAmbient:this.buildBuffer(e,"uniform","uLightAmbient",4,"4fv",a),lightDiffuse:this.buildBuffer(e,"uniform","uLightDiffuse",4,"4fv",a)};this.program=e;this.gl.useProgram(this.program);return e}}};
FSS.WebGLRenderer.prototype.buildShader=function(a,b){if(!this.unsupported){var c=this.gl.createShader(a);this.gl.shaderSource(c,b);this.gl.compileShader(c);return this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)?c:(console.error(this.gl.getShaderInfoLog(c)),null)}};
FSS.WebGLRenderer.prototype.buildBuffer=function(a,b,c,d,e,f){e={buffer:this.gl.createBuffer(),size:d,structure:e,data:null};switch(b){case "attribute":e.location=this.gl.getAttribLocation(a,c);break;case "uniform":e.location=this.gl.getUniformLocation(a,c)}f&&(e.data=new FSS.Array(f*d));return e};FSS.WebGLRenderer.VS=function(a){return["precision mediump float;","#define LIGHTS "+a,"attribute float aSide;\nattribute vec3 aPosition;\nattribute vec3 aCentroid;\nattribute vec3 aNormal;\nattribute vec4 aAmbient;\nattribute vec4 aDiffuse;\nuniform vec3 uResolution;\nuniform vec3 uLightPosition[LIGHTS];\nuniform vec4 uLightAmbient[LIGHTS];\nuniform vec4 uLightDiffuse[LIGHTS];\nvarying vec4 vColor;\nvoid main() {\nvColor = vec4(0.0);\nvec3 position = aPosition / uResolution * 2.0;\nfor (int i = 0; i < LIGHTS; i++) {\nvec3 lightPosition = uLightPosition[i];\nvec4 lightAmbient = uLightAmbient[i];\nvec4 lightDiffuse = uLightDiffuse[i];\nvec3 ray = normalize(lightPosition - aCentroid);\nfloat illuminance = dot(aNormal, ray);\nif (aSide == 0.0) {\nilluminance = max(illuminance, 0.0);\n} else if (aSide == 1.0) {\nilluminance = abs(min(illuminance, 0.0));\n} else if (aSide == 2.0) {\nilluminance = max(abs(illuminance), 0.0);\n}\nvColor += aAmbient * lightAmbient;\nvColor += aDiffuse * lightDiffuse * illuminance;\n}\nvColor = clamp(vColor, 0.0, 1.0);\ngl_Position = vec4(position, 1.0);\n}"].join("\n")};
FSS.WebGLRenderer.FS=function(a){return"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\ngl_FragColor = vColor;\n}"};FSS.SVGRenderer=function(){FSS.Renderer.call(this);this.element=document.createElementNS(FSS.SVGNS,"svg");this.element.setAttribute("xmlns",FSS.SVGNS);this.element.setAttribute("version","1.1");this.element.style.display="block";this.setSize(300,150)};FSS.SVGRenderer.prototype=Object.create(FSS.Renderer.prototype);
FSS.SVGRenderer.prototype.setSize=function(a,b){FSS.Renderer.prototype.setSize.call(this,a,b);this.element.setAttribute("width",a);this.element.setAttribute("height",b);return this};FSS.SVGRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);for(var a=this.element.childNodes.length-1;0<=a;a--)this.element.removeChild(this.element.childNodes[a]);return this};
FSS.SVGRenderer.prototype.render=function(a){FSS.Renderer.prototype.render.call(this,a);var b,c,d,e,f,k;for(b=a.meshes.length-1;0<=b;b--)if(c=a.meshes[b],c.visible)for(c.update(a.lights,!0),d=c.geometry.triangles.length-1;0<=d;d--)e=c.geometry.triangles[d],e.polygon.parentNode!==this.element&&this.element.appendChild(e.polygon),f=this.formatPoint(e.a)+" ",f+=this.formatPoint(e.b)+" ",f+=this.formatPoint(e.c),k=this.formatStyle(e.color.format()),e.polygon.setAttributeNS(null,"points",f),e.polygon.setAttributeNS(null,
"style",k);return this};FSS.SVGRenderer.prototype.formatPoint=function(a){return this.halfWidth+a.position[0]+","+(this.halfHeight-a.position[1])};FSS.SVGRenderer.prototype.formatStyle=function(a){return a="fill:"+a+";"+("stroke:"+a+";")};var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};
dat.utils.css=function(){return{load:function(a,b){b=b||document;var c=b.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=a;b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){b=b||document;var c=document.createElement("style");c.type="text/css";c.innerHTML=a;b.getElementsByTagName("head")[0].appendChild(c)}}}();
dat.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){this.each(b.call(arguments,1),function(b){for(var e in b)this.isUndefined(b[e])||(a[e]=b[e])},this);return a},defaults:function(a){this.each(b.call(arguments,1),function(b){for(var e in b)this.isUndefined(a[e])&&(a[e]=b[e])},this);return a},compose:function(){var a=b.call(arguments);return function(){for(var d=b.call(arguments),e=a.length-1;0<=e;e--)d=[a[e].apply(this,d)];return d[0]}},
each:function(b,d,e){if(a&&b.forEach===a)b.forEach(d,e);else if(b.length===b.length+0)for(var f=0,k=b.length;f<k&&!(f in b&&d.call(e,b[f],f)===this.BREAK);f++);else for(f in b)if(d.call(e,b[f],f)===this.BREAK)break},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===
Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}();
dat.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b];this.domElement=document.createElement("div");this.object=a;this.property=b;this.__onFinishChange=this.__onChange=void 0};a.extend(b.prototype,{onChange:function(a){this.__onChange=a;return this},onFinishChange:function(a){this.__onFinishChange=a;return this},setValue:function(a){this.object[this.property]=a;this.__onChange&&this.__onChange.call(this,a);this.updateDisplay();return this},getValue:function(){return this.object[this.property]},
updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b}(dat.utils.common);
dat.dom.dom=function(a){function b(b){if("0"===b||a.isUndefined(b))return 0;b=b.match(d);return a.isNull(b)?0:parseFloat(b[1])}var c={};a.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(b,d){a.each(b,function(a){c[a]=d})});var d=/(\d+(\.\d+)?)px/,e={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=
b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0);a.isUndefined(d)&&(d=!0);b.style.position="absolute";c&&(b.style.left=0,b.style.right=0);d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,d,e,h){e=e||{};var g=c[d];if(!g)throw Error("Event type "+d+" not supported.");var m=document.createEvent(g);switch(g){case "MouseEvents":m.initMouseEvent(d,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,e.x||e.clientX||0,e.y||e.clientY||0,!1,
!1,!1,!1,0,null);break;case "KeyboardEvents":g=m.initKeyboardEvent||m.initKeyEvent;a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0});g(d,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:m.initEvent(d,e.bubbles||!1,e.cancelable||!0)}a.defaults(m,h);b.dispatchEvent(m)},bind:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c);return e},
unbind:function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c);return e},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return e},removeClass:function(a,b){if(b){if(void 0!==a.className)if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);-1!=
d&&(c.splice(d,1),a.className=c.join(" "))}}else a.className=void 0;return e},hasClass:function(a,b){return RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){a=getComputedStyle(a);return b(a["border-left-width"])+b(a["border-right-width"])+b(a["padding-left"])+b(a["padding-right"])+b(a.width)},getHeight:function(a){a=getComputedStyle(a);return b(a["border-top-width"])+b(a["border-bottom-width"])+b(a["padding-top"])+b(a["padding-bottom"])+b(a.height)},getOffset:function(a){var b=
{left:0,top:0};if(a.offsetParent){do b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a=a.offsetParent)}return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return e}(dat.utils.common);
dat.controllers.OptionController=function(a,b,c){var d=function(a,f,k){d.superclass.call(this,a,f);var p=this;this.__select=document.createElement("select");if(c.isArray(k)){var h={};c.each(k,function(a){h[a]=a});k=h}c.each(k,function(a,b){var c=document.createElement("option");c.innerHTML=b;c.setAttribute("value",a);p.__select.appendChild(c)});this.updateDisplay();b.bind(this.__select,"change",function(){p.setValue(this.options[this.selectedIndex].value)});this.domElement.appendChild(this.__select)};
d.superclass=a;c.extend(d.prototype,a.prototype,{setValue:function(a){a=d.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());return a},updateDisplay:function(){this.__select.value=this.getValue();return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.NumberController=function(a,b){var c=function(a,e,f){c.superclass.call(this,a,e);f=f||{};this.__min=f.min;this.__max=f.max;this.__step=f.step;a=this.__impliedStep=b.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step;a=a.toString();this.__precision=-1<a.indexOf(".")?a.length-a.indexOf(".")-1:0};c.superclass=a;b.extend(c.prototype,a.prototype,{setValue:function(a){void 0!==this.__min&&a<this.__min?a=this.__min:
void 0!==this.__max&&a>this.__max&&(a=this.__max);void 0!==this.__step&&0!=a%this.__step&&(a=Math.round(a/this.__step)*this.__step);return c.superclass.prototype.setValue.call(this,a)},min:function(a){this.__min=a;return this},max:function(a){this.__max=a;return this},step:function(a){this.__step=a;return this}});return c}(dat.controllers.Controller,dat.utils.common);
dat.controllers.NumberControllerBox=function(a,b,c){var d=function(a,f,k){function p(){var a=parseFloat(m.__input.value);c.isNaN(a)||m.setValue(a)}function h(a){var b=r-a.clientY;m.setValue(m.getValue()+b*m.__impliedStep);r=a.clientY}function g(){b.unbind(window,"mousemove",h);b.unbind(window,"mouseup",g)}this.__truncationSuspended=!1;d.superclass.call(this,a,f,k);var m=this,r;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"change",p);b.bind(this.__input,
"blur",function(){p();m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())});b.bind(this.__input,"mousedown",function(a){b.bind(window,"mousemove",h);b.bind(window,"mouseup",g);r=a.clientY});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1)});this.updateDisplay();this.domElement.appendChild(this.__input)};d.superclass=a;c.extend(d.prototype,a.prototype,{updateDisplay:function(){var a=this.__input,b;if(this.__truncationSuspended)b=
this.getValue();else{b=this.getValue();var c=Math.pow(10,this.__precision);b=Math.round(b*c)/c}a.value=b;return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);
dat.controllers.NumberControllerSlider=function(a,b,c,d,e){var f=function(a,c,d,e,m){function r(a){a.preventDefault();var c=b.getOffset(n.__background),f=b.getWidth(n.__background);n.setValue(n.__min+(a.clientX-c.left)/(c.left+f-c.left)*(n.__max-n.__min));return!1}function s(){b.unbind(window,"mousemove",r);b.unbind(window,"mouseup",s);n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}f.superclass.call(this,a,c,{min:d,max:e,step:m});var n=this;this.__background=document.createElement("div");
this.__foreground=document.createElement("div");b.bind(this.__background,"mousedown",function(a){b.bind(window,"mousemove",r);b.bind(window,"mouseup",s);r(a)});b.addClass(this.__background,"slider");b.addClass(this.__foreground,"slider-fg");this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};f.superclass=a;f.useDefaultStyles=function(){c.inject(e)};d.extend(f.prototype,a.prototype,{updateDisplay:function(){this.__foreground.style.width=
(this.getValue()-this.__min)/(this.__max-this.__min)*100+"%";return f.superclass.prototype.updateDisplay.call(this)}});return f}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");
dat.controllers.FunctionController=function(a,b,c){var d=function(a,c,k){d.superclass.call(this,a,c);var p=this;this.__button=document.createElement("div");this.__button.innerHTML=void 0===k?"Fire":k;b.bind(this.__button,"click",function(a){a.preventDefault();p.fire();return!1});b.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};d.superclass=a;c.extend(d.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this);this.__onFinishChange&&this.__onFinishChange.call(this,
this.getValue());this.getValue().call(this.object)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.controllers.BooleanController=function(a,b,c){var d=function(a,c){d.superclass.call(this,a,c);var k=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");b.bind(this.__checkbox,"change",function(){k.setValue(!k.__prev)},!1);this.domElement.appendChild(this.__checkbox);this.updateDisplay()};d.superclass=a;c.extend(d.prototype,a.prototype,{setValue:function(a){a=d.superclass.prototype.setValue.call(this,a);this.__onFinishChange&&
this.__onFinishChange.call(this,this.getValue());this.__prev=this.getValue();return a},updateDisplay:function(){!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1;return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common);
dat.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(b=b.hex.toString(16);6>b.length;)b="0"+b;return"#"+b}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(dat.utils.common);
dat.color.interpret=function(a,b){var c,d,e=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){a=a.match(/^#([A-F0-9]{6})$/i);return null===a?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString())}},write:a},CSS_RGB:{read:function(a){a=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);
return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:a},CSS_RGBA:{read:function(a){a=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===a?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3!=
a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4!=a.length?!1:{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a)?{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return b.isNumber(a.r)&&
b.isNumber(a.g)&&b.isNumber(a.b)?{space:"RGB",r:a.r,g:a.g,b:a.b}:!1},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a)?{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)?{space:"HSV",h:a.h,s:a.s,v:a.v}:!1},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return function(){d=!1;
var a=1<arguments.length?b.toArray(arguments):arguments[0];b.each(e,function(e){if(e.litmus(a))return b.each(e.conversions,function(e,h){c=e.read(a);if(!1===d&&!1!==c)return d=c,c.conversionName=h,c.conversion=e,b.BREAK}),b.BREAK});return d}}(dat.color.toString,dat.utils.common);
dat.GUI=dat.gui.GUI=function(a,b,c,d,e,f,k,p,h,g,m,r,s,n,q){function y(a,b,c,g){if(void 0===b[c])throw Error("Object "+b+' has no property "'+c+'"');g.color?b=new m(b,c):(b=[b,c].concat(g.factoryArgs),b=d.apply(a,b));g.before instanceof e&&(g.before=g.before.__li);D(a,b);n.addClass(b.domElement,"c");c=document.createElement("span");n.addClass(c,"property-name");c.innerHTML=b.property;var f=document.createElement("div");f.appendChild(c);f.appendChild(b.domElement);g=x(a,f,g.before);n.addClass(g,u.CLASS_CONTROLLER_ROW);
n.addClass(g,typeof b.getValue());w(a,g,b);a.__controllers.push(b);return b}function x(a,b,c){var d=document.createElement("li");b&&d.appendChild(b);c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d);a.onResize();return d}function w(a,b,c){c.__li=b;c.__gui=a;q.extend(c,{options:function(b){if(1<arguments.length)return c.remove(),y(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[q.toArray(arguments)]});if(q.isArray(b)||q.isObject(b))return c.remove(),y(a,c.object,c.property,
{before:c.__li.nextElementSibling,factoryArgs:[b]})},name:function(a){c.__li.firstElementChild.firstElementChild.innerHTML=a;return c},listen:function(){c.__gui.listen(c);return c},remove:function(){c.__gui.remove(c);return c}});if(c instanceof h){var d=new p(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});q.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);b.apply(c,a);return e.apply(d,a)}});
n.addClass(b,"has-slider");c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof p){var e=function(b){return q.isNumber(c.__min)&&q.isNumber(c.__max)?(c.remove(),y(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=q.compose(e,c.min);c.max=q.compose(e,c.max)}else c instanceof f?(n.bind(b,"click",function(){n.fakeEvent(c.__checkbox,"click")}),n.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):
c instanceof k?(n.bind(b,"click",function(){n.fakeEvent(c.__button,"click")}),n.bind(b,"mouseover",function(){n.addClass(c.__button,"hover")}),n.bind(b,"mouseout",function(){n.removeClass(c.__button,"hover")})):c instanceof m&&(n.addClass(b,"color"),c.updateDisplay=q.compose(function(a){b.style.borderLeftColor=c.__color.toString();return a},c.updateDisplay),c.updateDisplay());c.setValue=q.compose(function(b){a.getRoot().__preset_select&&c.isModified()&&G(a.getRoot(),!0);return b},c.setValue)}function D(a,
b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e);e[b.property]=b;if(c.load&&c.load.remembered){c=c.load.remembered;if(c[a.preset])c=c[a.preset];else if(c[E])c=c[E];else return;c[d]&&void 0!==c[d][b.property]&&(d=c[d][b.property],b.initialValue=d,b.setValue(d))}}}function t(a){var b=a.__save_row=document.createElement("li");n.addClass(a.domElement,"has-save");a.__ul.insertBefore(b,
a.__ul.firstChild);n.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;";n.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save";n.addClass(d,"button");n.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New";n.addClass(e,"button");n.addClass(e,"save-as");var g=document.createElement("span");g.innerHTML="Revert";n.addClass(g,"button");n.addClass(g,"revert");var f=a.__preset_select=document.createElement("select");a.load&&
a.load.remembered?q.each(a.load.remembered,function(b,c){H(a,c,c==a.preset)}):H(a,E,!1);n.bind(f,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value});b.appendChild(f);b.appendChild(c);b.appendChild(d);b.appendChild(e);b.appendChild(g);if(A){var b=document.getElementById("dg-save-locally"),m=document.getElementById("dg-local-explain");b.style.display="block";b=document.getElementById("dg-local-storage");"true"===
localStorage.getItem(document.location.href+".isLocal")&&b.setAttribute("checked","checked");var h=function(){m.style.display=a.useLocalStorage?"block":"none"};h();n.bind(b,"change",function(){a.useLocalStorage=!a.useLocalStorage;h()})}var k=document.getElementById("dg-new-constructor");n.bind(k,"keydown",function(a){a.metaKey&&(67===a.which||67==a.keyCode)&&J.hide()});n.bind(c,"click",function(){k.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2);J.show();k.focus();k.select()});n.bind(d,"click",
function(){a.save()});n.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)});n.bind(g,"click",function(){a.revert()})}function v(a){function b(g){g.preventDefault();e=g.clientX;n.addClass(a.__closeButton,u.CLASS_DRAG);n.bind(window,"mousemove",c);n.bind(window,"mouseup",d);return!1}function c(b){b.preventDefault();a.width+=e-b.clientX;a.onResize();e=b.clientX;return!1}function d(){n.removeClass(a.__closeButton,u.CLASS_DRAG);n.unbind(window,"mousemove",c);n.unbind(window,
"mouseup",d)}a.__resize_handle=document.createElement("div");q.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;n.bind(a.__resize_handle,"mousedown",b);n.bind(a.__closeButton,"mousedown",b);a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function B(a,b){a.domElement.style.width=b+"px";a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px");a.__closeButton&&(a.__closeButton.style.width=b+"px")}
function C(a,b){var c={};q.each(a.__rememberedObjects,function(d,e){var g={};q.each(a.__rememberedObjectIndecesToControllers[e],function(a,c){g[c]=b?a.initialValue:a.getValue()});c[e]=g});return c}function H(a,b,c){var d=document.createElement("option");d.innerHTML=b;d.value=b;a.__preset_select.appendChild(d);c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function G(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function F(a){0!=a.length&&
r(function(){F(a)});q.each(a,function(a){a.updateDisplay()})}a.inject(c);var E="Default",A;try{A="localStorage"in window&&null!==window.localStorage}catch(O){A=!1}var J,L=!0,I,K=!1,M=[],u=function(a){function b(){localStorage.setItem(document.location.href+".gui",JSON.stringify(d.getSaveObject()))}function c(){var a=d.getRoot();a.width+=1;q.defer(function(){a.width-=1})}var d=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);
n.addClass(this.domElement,"dg");this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];a=a||{};a=q.defaults(a,{autoPlace:!0,width:u.DEFAULT_WIDTH});a=q.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace});q.isUndefined(a.load)?a.load={preset:E}:a.preset&&(a.load.preset=a.preset);q.isUndefined(a.parent)&&a.hideable&&M.push(this);a.resizable=q.isUndefined(a.parent)&&a.resizable;a.autoPlace&&q.isUndefined(a.scrollable)&&
(a.scrollable=!0);var e=A&&"true"===localStorage.getItem(document.location.href+".isLocal");Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return d.parent?d.getRoot().preset:a.load.preset},set:function(b){d.parent?d.getRoot().preset=b:a.load.preset=b;for(b=0;b<this.__preset_select.length;b++)this.__preset_select[b].value==this.preset&&(this.__preset_select.selectedIndex=
b);d.revert()}},width:{get:function(){return a.width},set:function(b){a.width=b;B(d,b)}},name:{get:function(){return a.name},set:function(b){a.name=b;f&&(f.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(b){a.closed=b;a.closed?n.addClass(d.__ul,u.CLASS_CLOSED):n.removeClass(d.__ul,u.CLASS_CLOSED);this.onResize();d.__closeButton&&(d.__closeButton.innerHTML=b?u.TEXT_OPEN:u.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return e},set:function(a){A&&
((e=a)?n.bind(window,"unload",b):n.unbind(window,"unload",b),localStorage.setItem(document.location.href+".isLocal",a))}}});if(q.isUndefined(a.parent)){a.closed=!1;n.addClass(this.domElement,u.CLASS_MAIN);n.makeSelectable(this.domElement,!1);if(A&&e){d.useLocalStorage=!0;var g=localStorage.getItem(document.location.href+".gui");g&&(a.load=JSON.parse(g))}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=u.TEXT_CLOSED;n.addClass(this.__closeButton,u.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);
n.bind(this.__closeButton,"click",function(){d.closed=!d.closed})}else{void 0===a.closed&&(a.closed=!0);var f=document.createTextNode(a.name);n.addClass(f,"controller-name");g=x(d,f);n.addClass(this.__ul,u.CLASS_CLOSED);n.addClass(g,"title");n.bind(g,"click",function(a){a.preventDefault();d.closed=!d.closed;return!1});a.closed||(this.closed=!1)}a.autoPlace&&(q.isUndefined(a.parent)&&(L&&(I=document.createElement("div"),n.addClass(I,"dg"),n.addClass(I,u.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(I),
L=!1),I.appendChild(this.domElement),n.addClass(this.domElement,u.CLASS_AUTO_PLACE)),this.parent||B(d,a.width));n.bind(window,"resize",function(){d.onResize()});n.bind(this.__ul,"webkitTransitionEnd",function(){d.onResize()});n.bind(this.__ul,"transitionend",function(){d.onResize()});n.bind(this.__ul,"oTransitionEnd",function(){d.onResize()});this.onResize();a.resizable&&v(this);d.getRoot();a.parent||c()};u.toggleHide=function(){K=!K;q.each(M,function(a){a.domElement.style.zIndex=K?-999:999;a.domElement.style.opacity=
K?0:1})};u.CLASS_AUTO_PLACE="a";u.CLASS_AUTO_PLACE_CONTAINER="ac";u.CLASS_MAIN="main";u.CLASS_CONTROLLER_ROW="cr";u.CLASS_TOO_TALL="taller-than-window";u.CLASS_CLOSED="closed";u.CLASS_CLOSE_BUTTON="close-button";u.CLASS_DRAG="drag";u.DEFAULT_WIDTH=245;u.TEXT_CLOSED="Close Controls";u.TEXT_OPEN="Open Controls";n.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||u.toggleHide()},!1);q.extend(u.prototype,{add:function(a,b){return y(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,
2)})},addColor:function(a,b){return y(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li);this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;q.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&I.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace;this.load&&this.load.folders&&this.load.folders[a]&&
(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);b=new u(b);this.__folders[a]=b;a=x(this,b.domElement);n.addClass(a,"folder");return b},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=n.getOffset(a.__ul).top,c=0;q.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=n.getHeight(b))});window.innerHeight-b-20<c?(n.addClass(a.domElement,u.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-
b-20+"px"):(n.removeClass(a.domElement,u.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&q.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"});a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){q.isUndefined(J)&&(J=new s,J.domElement.innerHTML=b);if(this.parent)throw Error("You can only call remember on a top level GUI.");var a=this;q.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&t(a);-1==
a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)});this.autoPlace&&B(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;a.closed=this.closed;0<this.__rememberedObjects.length&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=C(this));a.folders={};q.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()});return a},save:function(){this.load.remembered||(this.load.remembered=
{});this.load.remembered[this.preset]=C(this);G(this,!1)},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[E]=C(this,!0));this.load.remembered[a]=C(this);this.preset=a;H(this,a,!0)},revert:function(a){q.each(this.__controllers,function(b){this.getRoot().load.remembered?D(a||this.getRoot(),b):b.setValue(b.initialValue)},this);q.each(this.__folders,function(a){a.revert(a)});a||G(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a);
b&&F(this.__listening)}});return u}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',
".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",
dat.controllers.factory=function(a,b,c,d,e,f,k){return function(p,h,g,m){var r=p[h];if(k.isArray(g)||k.isObject(g))return new a(p,h,g);if(k.isNumber(r))return k.isNumber(g)&&k.isNumber(m)?new c(p,h,g,m):new b(p,h,{min:g,max:m});if(k.isString(r))return new d(p,h);if(k.isFunction(r))return new e(p,h,"");if(k.isBoolean(r))return new f(p,h)}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(a,b,c){var d=
function(a,c){function k(){p.setValue(p.__input.value)}d.superclass.call(this,a,c);var p=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");b.bind(this.__input,"keyup",k);b.bind(this.__input,"change",k);b.bind(this.__input,"blur",function(){p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())});b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()});this.updateDisplay();this.domElement.appendChild(this.__input)};d.superclass=a;c.extend(d.prototype,
a.prototype,{updateDisplay:function(){b.isActive(this.__input)||(this.__input.value=this.getValue());return d.superclass.prototype.updateDisplay.call(this)}});return d}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,
dat.controllers.ColorController=function(a,b,c,d,e){function f(a,b,c,d){a.style.background="";e.each(h,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function k(a){a.style.background="";a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";
a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var p=function(a,m){function h(a){y(a);b.bind(window,"mousemove",y);b.bind(window,
"mouseup",s)}function s(){b.unbind(window,"mousemove",y);b.unbind(window,"mouseup",s)}function n(){var a=d(this.value);!1!==a?(w.__color.__state=a,w.setValue(w.__color.toOriginal())):this.value=w.__color.toString()}function q(){b.unbind(window,"mousemove",x);b.unbind(window,"mouseup",q)}function y(a){a.preventDefault();var c=b.getWidth(w.__saturation_field),d=b.getOffset(w.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c;a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>
a&&(a=0);1<e?e=1:0>e&&(e=0);w.__color.v=a;w.__color.s=e;w.setValue(w.__color.toOriginal());return!1}function x(a){a.preventDefault();var c=b.getHeight(w.__hue_field),d=b.getOffset(w.__hue_field);a=1-(a.clientY-d.top+document.body.scrollTop)/c;1<a?a=1:0>a&&(a=0);w.__color.h=360*a;w.setValue(w.__color.toOriginal());return!1}p.superclass.call(this,a,m);this.__color=new c(this.getValue());this.__temp=new c(0);var w=this;this.domElement=document.createElement("div");b.makeSelectable(this.domElement,!1);
this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");
this.__input.type="text";this.__input_textShadow="0 1px 1px ";b.bind(this.__input,"keydown",function(a){13===a.keyCode&&n.call(this)});b.bind(this.__input,"blur",n);b.bind(this.__selector,"mousedown",function(){b.addClass(this,"drag").bind(window,"mouseup",function(){b.removeClass(w.__selector,"drag")})});var D=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});e.extend(this.__field_knob.style,
{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(.5>this.__color.v?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});e.extend(D.style,{width:"100%",height:"100%",
background:"none"});f(D,"top","rgba(0,0,0,0)","#000");e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});k(this.__hue_field);e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});b.bind(this.__saturation_field,"mousedown",h);b.bind(this.__field_knob,"mousedown",h);b.bind(this.__hue_field,"mousedown",function(a){x(a);b.bind(window,
"mousemove",x);b.bind(window,"mouseup",q)});this.__saturation_field.appendChild(D);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay()};p.superclass=a;e.extend(p.prototype,a.prototype,{updateDisplay:function(){var a=d(this.getValue());if(!1!==a){var b=!1;
e.each(c.COMPONENTS,function(c){if(!e.isUndefined(a[c])&&!e.isUndefined(this.__color.__state[c])&&a[c]!==this.__color.__state[c])return b=!0,{}},this);b&&e.extend(this.__color.__state,a)}e.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var h=.5>this.__color.v||.5<this.__color.s?255:0,k=255-h;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+h+
","+h+","+h+")"});this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px";this.__temp.s=1;this.__temp.v=1;f(this.__saturation_field,"left","#fff",this.__temp.toString());e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+h+","+h+","+h+")",textShadow:this.__input_textShadow+"rgba("+k+","+k+","+k+",.7)"})}});var h=["-moz-","-o-","-webkit-","-ms-",""];return p}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(a,b,c,d){function e(a,
b,c){Object.defineProperty(a,b,{get:function(){if("RGB"===this.__state.space)return this.__state[b];k(this,b,c);return this.__state[b]},set:function(a){"RGB"!==this.__state.space&&(k(this,b,c),this.__state.space="RGB");this.__state[b]=a}})}function f(a,b){Object.defineProperty(a,b,{get:function(){if("HSV"===this.__state.space)return this.__state[b];p(this);return this.__state[b]},set:function(a){"HSV"!==this.__state.space&&(p(this),this.__state.space="HSV");this.__state[b]=a}})}function k(a,c,e){if("HEX"===
a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,e);else if("HSV"===a.__state.space)d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v));else throw"Corrupted color state";}function p(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v});d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var h=function(){this.__state=a.apply(this,arguments);if(!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||
1};h.COMPONENTS="r g b h s v hex a".split(" ");d.extend(h.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}});e(h.prototype,"r",2);e(h.prototype,"g",1);e(h.prototype,"b",0);f(h.prototype,"h");f(h.prototype,"s");f(h.prototype,"v");Object.defineProperty(h.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}});Object.defineProperty(h.prototype,"hex",{get:function(){"HEX"!==!this.__state.space&&(this.__state.hex=
b.rgb_to_hex(this.r,this.g,this.b));return this.__state.hex},set:function(a){this.__state.space="HEX";this.__state.hex=a}});return h}(dat.color.interpret,dat.color.math=function(){var a;return{hsv_to_rgb:function(a,c,d){var e=a/60-Math.floor(a/60),f=d*(1-c),k=d*(1-e*c);c=d*(1-(1-e)*c);a=[[d,c,f],[k,d,f],[f,d,c],[f,k,d],[c,f,d],[d,f,k]][Math.floor(a/60)%6];return{r:255*a[0],g:255*a[1],b:255*a[2]}},rgb_to_hsv:function(a,c,d){var e=Math.min(a,c,d),f=Math.max(a,c,d),e=f-e;if(0==f)return{h:NaN,s:0,v:0};
a=(a==f?(c-d)/e:c==f?2+(d-a)/e:4+(a-c)/e)/6;0>a&&(a+=1);return{h:360*a,s:e/f,v:f/255}},rgb_to_hex:function(a,c,d){a=this.hex_with_component(0,2,a);a=this.hex_with_component(a,1,c);return this.hex_with_component(a,0,d)},component_from_hex:function(a,c){return a>>8*c&255},hex_with_component:function(b,c,d){return d<<(a=8*c)|b&~(255<<a)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}(),dat.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div");b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});a.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=
document.createElement("div");b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=
0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();b.defer(function(){a.backgroundElement.style.opacity=1;a.domElement.style.opacity=1;a.domElement.style.webkitTransform="scale(1)"})};c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none";b.backgroundElement.style.display="none";a.unbind(b.domElement,"webkitTransitionEnd",c);a.unbind(b.domElement,"transitionend",c);a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",
c);a.bind(this.domElement,"transitionend",c);a.bind(this.domElement,"oTransitionEnd",c);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"};return c}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);
(function(){function a(a){t&&D.removeChild(t.element);switch(a){case m:t=G;break;case r:t=F;break;case s:t=E}t.setSize(x.offsetWidth,x.offsetHeight);D.appendChild(t.element)}function b(){v.remove(B);t.clear();C=new FSS.Plane(h.width*t.width,h.height*t.height,h.slices);H=new FSS.Material(h.ambient,h.diffuse);B=new FSS.Mesh(C,H);v.add(B);var a,b;for(a=C.vertices.length-1;0<=a;a--)b=C.vertices[a],b.depth=Math.randomInRange(0,h.maxdepth/10),b.anchor=FSS.Vector3.clone(b.position)}function c(a,b,c,d,e){a=
"undefined"!==typeof a?a:g.ambient;b="undefined"!==typeof b?b:p();c="undefined"!==typeof c?c:g.xPos;d="undefined"!==typeof d?d:g.yPos;e="undefined"!==typeof e?e:g.zOffset;t.clear();light=new FSS.Light(a,b);light.ambientHex=light.ambient.format();light.diffuseHex=light.diffuse.format();light.setPosition(c,d,e);v.add(light);g.diffuse=b;g.proxy=light;g.pickedup=!0;g.currIndex++}function d(a,c){t.setSize(a,c);FSS.Vector3.set(y,t.halfWidth,t.halfHeight);b()}function e(){f();t.render(v);requestAnimationFrame(e)}
function f(){var a,b,c=h.depth/100;for(a=C.vertices.length-1;0<=a;a--)b=C.vertices[a],FSS.Vector3.set(b.position,1,1,b.depth*c),FSS.Vector3.add(b.position,b.anchor);C.dirty=!0}function k(a){a=document.getElementById(a);a.style.display="block"==a.style.display?"none":"block"}function p(){return"#"+(Math.random().toString(16)+"000000").slice(2,8)}var h={width:1.2,height:1.2,slices:250,depth:0,maxdepth:200,ambient:"#555555",diffuse:"#FFFFFF"},g={count:0,xPos:0,yPos:200,zOffset:100,ambient:"#880066",
diffuse:"#FF8800",pickedup:!0,proxy:!1,currIndex:0,randomize:function(){var a,b,c;a=Math.floor(3*Math.random())+1;1==a&&(h.depth=0);2==a&&(h.depth=Math.randomInRange(0,150));3==a&&(h.depth=Math.randomInRange(150,200));for(l=v.lights.length-1;0<=l;l--){a=Math.randomInRange(-B.geometry.width/2,B.geometry.width/2);b=Math.randomInRange(-B.geometry.height/2,B.geometry.height/2);c=2<v.lights.length?Math.randomInRange(10,80):Math.randomInRange(10,100);light=v.lights[l];FSS.Vector3.set(light.position,a,b,
c);var d=p(),e=p();light.diffuse.set(d);light.diffuseHex=light.diffuse.format();light.ambient.set(e);light.ambientHex=light.ambient.format();g.xPos=a;g.yPos=b;g.zOffset=c;g.diffuse=d;g.ambient=e;A.__folders.Light.__controllers[1].updateDisplay();A.__folders.Light.__controllers[2].updateDisplay()}}},m="webgl",r="canvas",s="svg",n={renderer:r},q={width:2E3,height:1E3,exportCurrent:function(){switch(n.renderer){case m:window.open(G.element.toDataURL(),"_blank");break;case r:window.open(F.element.toDataURL(),
"_blank");break;case s:var a="data:image/svg+xml,"+encodeURIComponent(D.innerHTML);window.open(a,"_blank")}},"export":function(){var a,b,c,e,g=this.width/t.width,k=this.height/t.height;a=h.slices;h.slices=Math.ceil(a*g*1.4);d(this.width,this.height);h.slices=a;for(a=v.lights.length-1;0<=a;a--)e=v.lights[a],b=e.position[0],c=e.position[1],z=e.position[2],FSS.Vector3.set(e.position,b*g,c*k,z*g);f();t.render(v);switch(n.renderer){case m:window.open(G.element.toDataURL(),"_blank");break;case r:window.open(F.element.toDataURL(),
"_blank");break;case s:a="data:image/svg+xml,"+encodeURIComponent(D.innerHTML),window.open(a,"_blank")}d(x.offsetWidth,x.offsetHeight);for(a=v.lights.length-1;0<=a;a--)e=v.lights[a],b=e.position[0],c=e.position[1],z=e.position[2],FSS.Vector3.set(e.position,b/g,c/k,z/g)}},y=FSS.Vector3.create(),x=document.getElementById("container"),w=document.getElementById("controls"),D=document.getElementById("output"),t,v,B,C,H,G,F,E,A;Mousetrap.bind("H",function(){k("controls");k("links")});Mousetrap.bind("enter",
function(){g.count++;c()});Mousetrap.bind("space",function(){g.pickedup=!g.pickedup});G=new FSS.WebGLRenderer;F=new FSS.CanvasRenderer;E=new FSS.SVGRenderer;a(n.renderer);v=new FSS.Scene;b();(function(){for(var a=Math.floor(4*Math.random())+1-1;0<=a;a--)c(),g.count++})();window.addEventListener("resize",function(a){d(x.offsetWidth,x.offsetHeight);t.render(v)});x.addEventListener("mousemove",function(a){g.pickedup&&(g.xPos=a.x-t.width/2,g.yPos=t.height/2-a.y,g.proxy.setPosition(g.xPos,g.yPos,g.proxy.position[2]))});
(function(){var d,e,f;A=new dat.GUI({autoPlace:!1});w.appendChild(A.domElement);renderFolder=A.addFolder("Render");meshFolder=A.addFolder("Mesh");lightFolder=A.addFolder("Light");exportFolder=A.addFolder("Export");lightFolder.open();f=renderFolder.add(n,"renderer",{webgl:m,canvas:r,svg:s});f.onChange(function(b){a(b)});f=meshFolder.addColor(h,"ambient");f.onChange(function(a){d=0;for(e=v.meshes.length;d<e;d++)v.meshes[d].material.ambient.set(a)});f=meshFolder.addColor(h,"diffuse");f.onChange(function(a){d=
0;for(e=v.meshes.length;d<e;d++)v.meshes[d].material.diffuse.set(a)});f=meshFolder.add(h,"width",.05,2);f.onChange(function(a){C.width!==a*t.width&&b()});f=meshFolder.add(h,"height",.05,2);f.onChange(function(a){C.height!==a*t.height&&b()});f=meshFolder.add(h,"depth",0,h.maxdepth).listen();f=meshFolder.add(h,"slices",1,800);f.step(1);f.onChange(function(a){C.slices!==a&&b()});f=lightFolder.add(g,"currIndex",{1:1,2:2,3:3,4:4,5:5,6:6,7:7}).name("Current light").listen();f.onChange(function(a){g.proxy=
v.lights[a-1];g.ambient=g.proxy.ambient.hex;g.diffuse=g.proxy.diffuse.hex;g.xPos=g.proxy.position[0];g.yPos=g.proxy.position[1];g.zOffset=g.proxy.position[2];A.__folders.Light.__controllers[1].updateDisplay();A.__folders.Light.__controllers[2].updateDisplay()});f=lightFolder.addColor(g,"ambient");f.onChange(function(a){g.proxy.ambient.set(a);g.proxy.ambientHex=g.proxy.ambient.format()});f=lightFolder.addColor(g,"diffuse");f.onChange(function(a){g.proxy.diffuse.set(a);g.proxy.diffuseHex=g.proxy.diffuse.format()});
f=lightFolder.add(g,"count",1,7).listen();f.step(1);f.onChange(function(a){if(v.lights.length!==a)if(a>v.lights.length)c();else{for(l=a;l<=v.lights.length;l++)light=v.lights[l],v.remove(light),g.currIndex--;g.proxy=v.lights[g.currIndex-1];g.pickedup=!1;t.clear()}});f=lightFolder.add(g,"xPos",-B.geometry.width/2,B.geometry.width/2).listen();f.step(1);f.onChange(function(a){g.proxy.setPosition(a,g.proxy.position[1],g.proxy.position[2])});f=lightFolder.add(g,"yPos",-B.geometry.height/2,B.geometry.height/
2).listen();f.step(1);f.onChange(function(a){g.proxy.setPosition(g.proxy.position[0],a,g.proxy.position[2])});f=lightFolder.add(g,"zOffset",0,1E3).name("Distance").listen();scrollButtonDistance=Number(g.proxy.position[2]);$("#container").bind("DOMMouseScroll",function(a){scrollButtonDistance=0<a.originalEvent.detail?Number(Math.max(0,scrollButtonDistance-a.detail/4)):Number(Math.min(1E3,scrollButtonDistance-a.detail/4));g.proxy.setPosition(g.proxy.position[0],g.proxy.position[1],scrollButtonDistance);
g.zOffset=scrollButtonDistance;g.z=scrollButtonDistance;A.__folders.Light.__controllers[1].updateDisplay();A.__folders.Light.__controllers[2].updateDisplay();return!1});$("#container").bind("mousewheel",function(a){scrollButtonDistance=0>a.originalEvent.wheelDelta?Number(Math.max(0,scrollButtonDistance+a.originalEvent.wheelDelta/4)):Number(Math.min(1E3,scrollButtonDistance+a.originalEvent.wheelDelta/4));g.proxy.setPosition(Number(g.proxy.position[0]),Number(g.proxy.position[1]),scrollButtonDistance);
g.zOffset=scrollButtonDistance;g.z=scrollButtonDistance;A.__folders.Light.__controllers[1].updateDisplay();A.__folders.Light.__controllers[2].updateDisplay();return!1});f.step(1);f.onChange(function(a){g.proxy.setPosition(g.proxy.position[0],g.proxy.position[1],a)});f=lightFolder.add(g,"randomize");f=exportFolder.add(q,"width",100,3E3);f.step(100);f=exportFolder.add(q,"height",100,3E3);f.step(100);f=exportFolder.add(q,"export").name("export big");f=exportFolder.add(q,"exportCurrent").name("export this")})();
g.randomize();d(x.offsetWidth,x.offsetHeight);e()})();
