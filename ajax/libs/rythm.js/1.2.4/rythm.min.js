!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Rythm=t()}(this,function(){"use strict";function e(){function e(){if(!o.stopped){o._analyser.getByteFrequencyData(o._frequences);for(var n=0;n<o._frequences.length;n++){o._hzHistory[n]||(o._hzHistory[n]=[]),o._hzHistory[n].length>o.maxValueHistory&&o._hzHistory[n].shift(),o._hzHistory[n].push(o._frequences[n]);o._frequences[n]}o.rythmMapping.forEach(function(e){switch(e.type){default:r(e.elementClass,t(e.startValue,e.nbValue))}}),requestAnimationFrame(e)}}function t(e,t){for(var r=0,o=e;o<t+e;o++)r+=n(o);return r/t}function n(e){for(var t=255,n=0,r=0;r<o._hzHistory[e].length;r++)o._hzHistory[e][r]<t&&(t=o._hzHistory[e][r]),o._hzHistory[e][r]>n&&(n=o._hzHistory[e][r]);var i=n-t,a=o._frequences[e]-t,u=a/i;return o.startingScale+o.pulseRatio*u}function r(e,t){for(var n=document.getElementsByClassName(e),r=0;r<n.length;r++)n[r].style.transform="scale("+t+")"}var o=this;o._browserAudioCtx=AudioContext||webkitAudioContext,o._audioCtx=new o._browserAudioCtx,o._init=function(){o._analyser=o._audioCtx.createAnalyser(),o._gain=o._audioCtx.createGain(),o._source={},o._audio={},o._hzHistory=[],o._analyser.fftSize=2048},o._init(),o.stopped=!1,o._rythmInputTypeList={TRACK:0,STREAM:1,EXTERNAL:2},o.startingScale=.75,o.pulseRatio=.5,o.maxValueHistory=100,o.rythmMapping=[],o.addRythm=function(e,t,n,r){o.rythmMapping.push({elementClass:e,type:t,startValue:n,nbValue:r})},o.addRythm("rythm-bass","size",0,10),o.addRythm("rythm-medium","size",150,40),o.addRythm("rythm-high","size",400,200),o._createSourceFromAudioElement=function(e){return o._audioCtx.createMediaElementSource(o._audio)},o.connectExternalAudioElement=function(e){o._audio=e,o._rythmInputType=o._rythmInputTypeList.EXTERNAL,o._source=o._createSourceFromAudioElement(o._audio),o._connectSource(o._source)},o._connectSource=function(e){e.connect(o._gain),o._gain.connect(o._analyser),o._rythmInputType!==o._rythmInputTypeList.STREAM&&(o._analyser.connect(o._audioCtx.destination),o._audio.addEventListener("ended",o.stop))},o.setMusic=function(e){o._audio=new Audio(e),o._rythmInputType=o._rythmInputTypeList.TRACK,o._source=o._createSourceFromAudioElement(o._audio),o._connectSource(o._source)},o.plugMicrophone=function(){return o._getMicrophoneStream().then(function(e){o._audio=e,o._rythmInputType=o._rythmInputTypeList.STREAM,o._source=o._audioCtx.createMediaStreamSource(e),o._connectSource(o._source)})},o._getMicrophoneStream=function(){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,new Promise(function(e,t){navigator.getUserMedia({audio:!0},function(t){e(t)},function(e){t(e)})})},o.setGain=function(e){o._gain.gain.value=e},o.start=function(){o._hzHistory=[],o._frequences=new Uint8Array(o._analyser.frequencyBinCount),o._rythmInputType===o._rythmInputTypeList.TRACK&&o._audio.play(),o.stopped=!1,e()},o.stop=function(){o._rythmInputType===o._rythmInputTypeList.TRACK?o._audio.pause():o._rythmInputType===o._rythmInputTypeList.STREAM&&(o._audio.getAudioTracks()[0].enabled=!1),o.rythmMapping.forEach(function(e){for(var t=document.getElementsByClassName(e.elementClass),n=0;n<t.length;n++)t[n].style.transform="initial"}),o.stopped=!0}}return e});
//# sourceMappingURL=rythm.min.js.map