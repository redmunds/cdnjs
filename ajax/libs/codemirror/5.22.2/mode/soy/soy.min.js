!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],t):t(CodeMirror)}(function(t){"use strict";var e=["template","literal","msg","fallbackmsg","let","if","elseif","else","switch","case","default","foreach","ifempty","for","call","param","deltemplate","delcall","log"];t.defineMode("soy",function(a){function n(t){return t[t.length-1]}function l(t,e,a){var n=t.string,l=a.exec(n.substr(t.pos));l&&(t.string=n.substr(0,t.pos+l.index));var s=t.hideFirstChars(e.indent,function(){return e.localMode.token(t,e.localState)});return t.string=n,s}function s(t,e){for(;t;){if(t.element===e)return!0;t=t.next}return!1}function o(t,e){return{element:e,next:t}}function r(t){return t&&t.next}function i(t,e,a){return s(t,e)?"variable-2":a?"variable":"variable-2 error"}var c=t.getMode(a,"text/plain"),d={html:t.getMode(a,{name:"text/html",multilineTagIndentFactor:2,multilineTagIndentPastTag:!1}),attributes:c,text:c,uri:c,css:t.getMode(a,"text/css"),js:t.getMode(a,{name:"text/javascript",statementIndent:2*a.indentUnit})};return{startState:function(){return{kind:[],kindTag:[],soyState:[],templates:null,variables:null,scopes:null,indent:0,localMode:d.html,localState:t.startState(d.html)}},copyState:function(e){return{tag:e.tag,kind:e.kind.concat([]),kindTag:e.kindTag.concat([]),soyState:e.soyState.concat([]),templates:e.templates,variables:e.variables,scopes:e.scopes,indent:e.indent,localMode:e.localMode,localState:t.copyState(e.localMode,e.localState)}},token:function(s,c){var m;switch(n(c.soyState)){case"comment":return s.match(/^.*?\*\//)?c.soyState.pop():s.skipToEnd(),"comment";case"templ-def":return(m=s.match(/^\.?([\w]+(?!\.[\w]+)*)/))?(c.templates=o(c.templates,m[1]),c.scopes=o(c.scopes,c.variables),c.soyState.pop(),"def"):(s.next(),null);case"templ-ref":return(m=s.match(/^\.?([\w]+)/))?(c.soyState.pop(),"."==m[0][0]?i(c.templates,m[1],!0):"variable"):(s.next(),null);case"param-def":return(m=s.match(/^([\w]+)(?=:)/))?(c.variables=o(c.variables,m[1]),c.soyState.pop(),c.soyState.push("param-type"),"def"):(s.next(),null);case"param-type":return"}"==s.peek()?(c.soyState.pop(),null):s.eatWhile(/^[\w]+/)?"variable-3":(s.next(),null);case"var-def":return(m=s.match(/^\$([\w]+)/))?(c.variables=o(c.variables,m[1]),c.soyState.pop(),"def"):(s.next(),null);case"tag":if(s.match(/^\/?}/))return"/template"==c.tag||"/deltemplate"==c.tag?(c.variables=c.scopes=r(c.scopes),c.indent=0):("/for"!=c.tag&&"/foreach"!=c.tag||(c.variables=c.scopes=r(c.scopes)),c.indent-=a.indentUnit*("/}"==s.current()||e.indexOf(c.tag)==-1?2:1)),c.soyState.pop(),"keyword";if(s.match(/^([\w?]+)(?==)/)){if("kind"==s.current()&&(m=s.match(/^="([^"]+)/,!1))){var p=m[1];c.kind.push(p),c.kindTag.push(c.tag),c.localMode=d[p]||d.html,c.localState=t.startState(c.localMode)}return"attribute"}return s.match(/^"/)?(c.soyState.push("string"),"string"):(m=s.match(/^\$([\w]+)/))?i(c.variables,m[1]):s.match(/(?:as|and|or|not|in)/)?"keyword":(s.next(),null);case"literal":return s.match(/^(?=\{\/literal})/)?(c.indent-=a.indentUnit,c.soyState.pop(),this.token(s,c)):l(s,c,/\{\/literal}/);case"string":var m=s.match(/^.*?("|\\[\s\S])/);return m?'"'==m[1]&&c.soyState.pop():s.skipToEnd(),"string"}return s.match(/^\/\*/)?(c.soyState.push("comment"),"comment"):s.match(s.sol()?/^\s*\/\/.*/:/^\s+\/\/.*/)?"comment":s.match(/^\{literal}/)?(c.indent+=a.indentUnit,c.soyState.push("literal"),"keyword"):(m=s.match(/^\{([\/@\\]?[\w?]*)/))?("/switch"!=m[1]&&(c.indent+=(/^(\/|(else|elseif|ifempty|case|default)$)/.test(m[1])&&"switch"!=c.tag?1:2)*a.indentUnit),c.tag=m[1],c.tag=="/"+n(c.kindTag)&&(c.kind.pop(),c.kindTag.pop(),c.localMode=d[n(c.kind)]||d.html,c.localState=t.startState(c.localMode)),c.soyState.push("tag"),"template"!=c.tag&&"deltemplate"!=c.tag||c.soyState.push("templ-def"),"call"!=c.tag&&"delcall"!=c.tag||c.soyState.push("templ-ref"),"let"==c.tag&&c.soyState.push("var-def"),"for"!=c.tag&&"foreach"!=c.tag||(c.scopes=o(c.scopes,c.variables),c.soyState.push("var-def")),c.tag.match(/^@param\??/)&&c.soyState.push("param-def"),"keyword"):l(s,c,/\{|\s+\/\/|\/\*/)},indent:function(e,l){var s=e.indent,o=n(e.soyState);if("comment"==o)return t.Pass;if("literal"==o)/^\{\/literal}/.test(l)&&(s-=a.indentUnit);else{if(/^\s*\{\/(template|deltemplate)\b/.test(l))return 0;/^\{(\/|(fallbackmsg|elseif|else|ifempty)\b)/.test(l)&&(s-=a.indentUnit),"switch"!=e.tag&&/^\{(case|default)\b/.test(l)&&(s-=a.indentUnit),/^\{\/switch\b/.test(l)&&(s-=a.indentUnit)}return s&&e.localMode.indent&&(s+=e.localMode.indent(e.localState,l)),s},innerMode:function(t){return t.soyState.length&&"literal"!=n(t.soyState)?null:{state:t.localState,mode:t.localMode}},electricInput:/^\s*\{(\/|\/template|\/deltemplate|\/switch|fallbackmsg|elseif|else|case|default|ifempty|\/literal\})$/,lineComment:"//",blockCommentStart:"/*",blockCommentEnd:"*/",blockCommentContinue:" * ",fold:"indent"}},"htmlmixed"),t.registerHelper("hintWords","soy",e.concat(["delpackage","namespace","alias","print","css","debugger"])),t.defineMIME("text/x-soy","soy")});
//# sourceMappingURL=soy.min.js.map