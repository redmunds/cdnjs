!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.avalon=t():e.avalon=t()}(this,function(){function e(t){return new e.init(t)}function n(t,n,r){t[r.name]=e.parseExpr(r)}function r(e){return/\[native code\]/.test(e)}function o(e,t,n){var r="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+n;return Function("fn,scope",r)}function a(e){return!!e&&(e==e.document&&e.document!=e)}function i(e){return Dn.test(Mn.call(e))}function s(t,n){if(!t||"object"!==e.type(t)||t.nodeType||e.isWindow(t))return!1;try{if(t.constructor&&!gn.call(t,"constructor")&&!gn.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(Vn)for(n in t)return gn.call(t,n);for(n in t);return void 0===n||gn.call(t,n)}function c(e){return"[object Object]"===Mn.call(e)&&Object.getPrototypeOf(e)===Object.prototype}function l(e){if(!e)return!1;var t=e.length;if(t===t>>>0){var n=Mn.call(e).slice(8,-1);if(Fn.test(n))return!1;if("Array"===n)return!0;try{return{}.propertyIsEnumerable.call(e,"length")!==!1||Sn.test(e.item||e.callee)}catch(t){return!e.window}}return!1}function u(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}function d(t){return t.uuid||(t.uuid=e.makeHashCode("e"))}function f(e){return e.uuid||(e.uuid="_"+ ++zn)}function p(t){for(var n in t)if(e.ohasOwn.call(t,n)){var r=t[n];"function"==typeof p.plugins[n]?p.plugins[n](r):p[n]=r}return this}function v(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+e)?+e:0,a=isFinite(+t)?Math.abs(t):3,i=r||",",s=n||".",c="",l=function(e,t){var n=Math.pow(10,t);return""+(Math.round(e*n)/n).toFixed(t)};return c=(a?l(o,a):""+Math.round(o)).split("."),c[0].length>3&&(c[0]=c[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(c[1]||"").length<a&&(c[1]=c[1]||"",c[1]+=new Array(a-c[1].length+1).join("0")),c.join(s)}function m(e){return e.replace(Kn,"").replace(Jn,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=Qn[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace(Gn," ").replace(/\s+/g," ")})}function h(e){return parseInt(e,10)||0}function y(e,t,n){var r="";for(e<0&&(r="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function g(e,t,n,r){return function(o){var a=o["get"+e]();return(n>0||a>-n)&&(a+=n),0===a&&n===-12&&(a=12),y(a,t,r)}}function _(e,t){return function(n,r){var o=n["get"+e](),a=(t?"SHORT"+e:e).toUpperCase();return r[a][o]}}function b(e){var t=-1*e.getTimezoneOffset(),n=t>=0?"+":"";return n+=y(Math[t>0?"floor":"ceil"](t/60),2)+y(Math.abs(t%60),2)}function w(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function x(e,t){var n,r,o=x.locate,a="",i=[];if(t=t||"mediumDate",t=o[t]||t,"string"==typeof e)if(/^\d+$/.test(e))e=h(e);else if(nr.test(e))e=+RegExp.$1;else{var s=e.trim(),c=[0,0,0,0,0,0,0],l=new Date(0);s=s.replace(/^(\d+)\D(\d+)\D(\d+)/,function(e,t,n,r){var o=4===r.length?[r,t,n]:[t,n,r];return c[0]=h(o[0]),c[1]=h(o[1])-1,c[2]=h(o[2]),""});var u=l.setFullYear,d=l.setHours;s=s.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(e,t,n,r,o){return c[3]=h(t),c[4]=h(n),c[5]=h(r),o&&(c[6]=Math.round(1e3*parseFloat("0."+o))),""});var f=0,p=0;s=s.replace(/Z|([+-])(\d\d):?(\d\d)/,function(e,t,n,r){return u=l.setUTCFullYear,d=l.setUTCHours,t&&(f=h(t+n),p=h(t+r)),""}),c[3]-=f,c[4]-=p,u.apply(l,c.slice(0,3)),d.apply(l,c.slice(3)),e=l}for("number"==typeof e&&(e=new Date(e));t;)r=tr.exec(t),r?(i=i.concat(r.slice(1)),t=i.pop()):(i.push(t),t=null);return i.forEach(function(t){n=er[t],a+=n?n(e,o):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),a}function $(t,n,r){var o=e.type(t);if("array"!==o&&"object"!==o)throw"orderBy只能处理对象或数组";var a=r&&r<0?-1:1;if("string"==typeof n){var i=n;n=function(e){return e&&e[i]}}t=T(t),t.forEach(function(e){e.order=n(e.value,e.key)}),t.sort(function(e,t){var n=e.order,r=t.order;return Number.isNaN(n)&&Number.isNaN(r)?0:n===r?0:n>r?a:-a});var s="array"===o,c=s?[]:{};return k(c,t,function(e){s?c.push(e.value):c[e.key]=e.value})}function C(t,n){var r=e.type(t);if("array"!==r&&"object"!==r)throw"filterBy只能处理对象或数组";var o=e.slice(arguments,2),a=e.type(n);if("function"===a)var i=n;else{if("string"!==a&&"number"!==a)return t;if(""===n)return t;var s=new RegExp(e.escapeRegExp(n),"i");i=function(e){return s.test(e)}}t=T(t).filter(function(e,t){return!!i.apply(e,[e.value,t].concat(o))});var c="array"===r,l=c?[]:{};return k(l,t,function(e){c?l.push(e.value):l[e.key]=e.value})}function E(t,n,r){if(e.isObject(t)&&!Array.isArray(t)){var o=[];return k(o,n,function(e){o.push(t.hasOwnProperty(e)?t[e]:r?r[e]:"")})}return t}function A(t,n,r){var o=e.type(t);if("array"!==o&&"object"!==o)throw"limitBy只能处理对象或数组";if("number"!=typeof n)return t;if(Number.isNaN(n))return t;"object"===o&&(t=T(t));var a=t.length;n=Math.floor(Math.min(a,n)),r="number"==typeof r?r:0,r<0&&(r=Math.max(0,a+r));for(var i=[],s=r;s<a&&i.length!==n;s++)i.push(t[s]);var c="array"===o;if(c)return i;var l={};return k(l,i,function(e){l[e.key]=e.value})}function k(e,t,n){for(var r=0,o=t.length;r<o;r++)n(t[r]);return e}function T(t){var n=[],r=0;return e.each(t,function(e,t){n[r++]={value:t,key:e}}),n}function N(e){return null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function O(e){return e}function M(t){this.nodeName="#text",this.nodeValue=t,this.skipContent=!e.config.rexpr.test(t)}function j(e){this.nodeName="#comment",this.nodeValue=e}function S(e,t,n){this.nodeName=e,this.props=t,this.children=n}function D(e){return e!==!1&&Object(e)!==e}function L(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function V(e){document.styleSheets.length<31?document.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):document.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");var t=e.split(":");1===t.length&&t.unshift("v");var n=t[1],r=t[0];return document.namespaces[r]||document.namespaces.add(r,"urn:schemas-microsoft-com:vml"),document.createElement("<"+r+":"+n+' class="rvml">')}function F(e){this.nodeName="#document-fragment",this.children=e}function H(e,t){if(1===e.nodeType){var n=e.nodeName.toLowerCase();"object"===n?e.parentNode&&(e.outerHTML=t.outerHTML):"input"===n&&vr.test(t.nodeName)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===n?e.defaultSelected=e.selected=t.defaultSelected:"input"!==n&&"textarea"!==n||(e.defaultValue=t.defaultValue)}}function P(e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName("*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll("*"):[]}function I(e){for(var n=e.cloneNode(!0),r=P(e),o=0;o<r.length;o++)H(t[o],r[o]);return n}function B(e,t){try{for(;t=t.parentNode;)if(t===e)return!0;return!1}catch(e){return!1}}function z(e){if(!("classList"in e)){e.classList={node:e};for(var t in hr)e.classList[t.slice(1)]=hr[t]}return e.classList}function R(e){var t=e.nodeName;return t.toLowerCase()===t&&e.scopeName&&""===e.outerText}function q(t,n){if(t&&1===t.nodeType){n.dynamic["ms-attr"]=1;var r=n["ms-attr"];for(var o in r){var a=r[o];if("href"===o||"src"===o){if(t.hasAttribute||(a=String(a).replace(wr,"&")),t[o]=a,Tn.chrome&&"EMBED"===t.tagName){var i=t.parentNode,s=document.createComment("ms-src");i.replaceChild(s,t),i.replaceChild(t,s)}}else if(0===o.indexOf("data-"))t.setAttribute(o,a);else{var c=yr[o]||o;if("boolean"==typeof t[c]&&(t[c]=!!a),a===!1){t.removeAttribute(c);continue}var l=!br.test(t)&&(!(e.modern||!R(t))||o in t.cloneNode(!1));l?t[c]=a+"":t.setAttribute(o,a)}}}}function Y(e,t){if(e.offsetWidth<=0){if(Or.test(Ar["@:get"](e,"display"))){var n={node:e};for(var r in Nr)n[r]=e.style[r],e.style[r]=Nr[r];t.push(n)}var o=e.parentNode;o&&1===o.nodeType&&Y(o,t)}}function U(e){return e.window||e.defaultView||e.parentWindow||!1}function W(e){var t=e.tagName.toLowerCase();return"input"===t&&vr.test(e.type)?"checked":t}function Z(t,n,r){var o=t.getAttribute("avalon-events");if(o&&(t.disabled!==!0||"click"!==n)){var a=[],i=Rr[n]||(Rr[n]=new RegExp("\\b"+n+"\\:([^,\\s]+)","g"));o.replace(i,function(e,t){return a.push(t),e}),a.length&&r.push({elem:t,uuids:a})}t=t.parentNode;var s=e.gestureEvents||{};t&&t.getAttribute&&(Br[n]||s[n])&&Z(t,n,r)}function X(t){t=new G(t);var n=t.type,r=t.target,o=[];Z(r,n,o);for(var a,i,s,c=0;(s=o[c++])&&!t.cancelBubble;){var l=t.currentTarget=s.elem;for(a=0;i=s.uuids[a++];){if(Yr){Yr=!1;break}var u=e.eventListeners[i];if(u){var d=qr.test(i)?s.elem._ms_context_:0;if(d&&d.$hashcode===!1)return e.unbind(r,n,u);var f=u.call(d||r,t,l._ms_local);f===!1&&(t.preventDefault(),t.stopPropagation())}}}}function K(t){var n=Un.getAttribute("delegate-events")||"";if(n.indexOf(t)===-1){var r=n.match(e.rword)||[];r.push(t),Un.setAttribute("delegate-events",r.join(",")),e._nativeBind(Un,t,X,!!Ur[t])}}function G(e){if(e.originalEvent)return e;for(var t in e)Wr.test(t)||"function"==typeof e[t]||(this[t]=e[t]);this.target||(this.target=e.srcElement);this.target;this.fixEvent(),this.timeStamp=new Date-0,this.originalEvent=e}function J(e){var t={},n=e.nodeName.toLowerCase();if(t.nodeName=n,t.dom=e,"#"===n.charAt(0)){var r=e.nodeValue;/\S/.test(r)&&(t.nodeValue=r)}else{var o=Q(e);Gr[n]&&(t.isVoidTag=!0),t.children=te(e),o&&("selectedIndex"in o&&(e.selectedIndex=o.selectedIndex,delete o.selectedIndex),t.props=o)}return t}function Q(e){for(var t=e.attributes,n={},r=0,o=t.length;r<o;r++){var a=t[r];if(a.specified){var i=a.name;":"===i.charAt(0)&&(i=i.replace(Qr,"ms-")),n[i]=a.value}}Jr.test(e.nodeName)&&(n.type=e.type);var s=e.style.cssText;return s&&(n.style=s),"select-one"===n.type&&(n.selectedIndex=e.selectedIndex),ee(n)?null:n}function ee(e){for(var t in e)return!1;return!0}function te(e){var t=[],n=e.firstChild;if(!n)return t;do{var r=n.nextSibling;switch(n.nodeType){case 1:var o=n.getAttributeNode(":for")||n.getAttributeNode("ms-for");if(o){var a=document.createComment("ms-for:"+o.value),i=document.createComment("ms-for-end:");n.removeAttributeNode(o),e&&(e.insertBefore(i,n.nextSibling),e.insertBefore(a,n)),t.push(J(a),J(n),J(i))}else t.push(J(n));break;case 3:if(/\S/.test(n.nodeValue))t.push(J(n));else{var s=n.parentNode;s&&s.removeChild(n)}break;case 8:t.push(J(n))}n=r}while(n);return t}function ne(t){for(var n,r=0;n=t[r++];)if(1===n.nodeType){var o=re(n),a=e.vmodels[o];if(a&&!a.$element){if(a.$element=n,e.serverTemplates&&e.serverTemplates[o]){var i=e.serverTemplates[o],s=e.speedUp(e.lexer(i)),c=e.render(s),l=c(a),u=e.vdom(l[0],"toDOM");a.$element=u,u.vtree=l,a.$render=c,n.parentNode.replaceChild(u,n),e.diff(l,l);continue}var l=[J(n)],d=new Date;n.vtree=e.speedUp(l);var f=new Date;to&&e.log("构建虚拟DOM耗时",f-d,"ms"),a.$render=e.render(n.vtree),e.scopes[a.$id]={vmodel:a,local:{},isTemp:!0};var p=new Date;to&&p-f>100&&(e.log("构建当前vm的$render方法耗时 ",p-f,"ms\n","如果此时间太长,达100ms以上\n","建议将当前ms-controller拆分成多个ms-controller,减少每个vm管辖的区域"),to=!1),e.rerenderStart=p,e.batch(o)}else o||ne(n.childNodes)}}function re(e){return e.getAttribute("ms-controller")||e.getAttribute(":controller")}function oe(e,t){var n,r=t.split(".")[0];try{e.hasOwnProperty(r)&&(n=e.$accessors?e.$accessors[r].get.heirloom.__vmodel__:Object.getOwnPropertyDescriptor(e,r).get.heirloom.__vmodel__)}catch(e){}return n||e}function ae(t,n){var r=t.indexOf(".*")>0||"*"===t,o=r?this:ae.adjust(this,t),a=this.$events,i=a[t]||(a[t]=[]);return r&&(i.reg=i.reg||se(t)),ce(r,a,t),o!==this&&ce(r,this.$events,t),e.Array.ensure(i,n),function(){e.Array.remove(i,n)}}function ie(t,n,r,o,a,i){if(t&&t.length)try{for(i=i||t.length-1;i>=0;i--){var s=t[i];s.call(n,o,a,r)}}catch(s){i-1>0&&ie(t,n,r,o,a,i-1),e.log(s,r)}}function se(e){var t=e.split(".");return new RegExp("^"+t.map(function(e){return"*"===e?"(?:[^.]+)":e}).join("\\.")+"$","i")}function ce(e,t,n){e&&(t.__fuzzy__?t.__fuzzy__.indexOf(","+n)===-1&&(t.__fuzzy__+=","+n):t.__fuzzy__=n)}function le(e,t){e.length!==t&&e.notify("length",e.length,t,!0)}function ue(t,n,r){return"$"===t.charAt(0)||r[t]||uo.test(e.type(n))||n&&n.nodeName&&n.nodeType>0}function de(t,n,r,o){var a=e.type(t);switch(a){case"array":return oo.arrayFactory(t,n,r,o);case"object":if(n&&n.$id){if(++e.suspendUpdate,n.$track!==Object.keys(t).sort().join(";;"))var i=oo.slaveFactory(n,t,r,o);else i=n;for(var s in t)ao[s]||(i[s]=t[s]);return--e.suspendUpdate,i}return i=oo.masterFactory(t,r,o);default:return t}}function fe(e,t,n){function r(){return o}var o=NaN;return r.heirloom=n,{get:r,set:function(a){if(o!==a){var i=o;i&&i.$model&&(i=i.$model);var s=n.__vmodel__;if(a&&"object"==typeof a&&(a=de(a,o,n,{pathname:t,id:e})),o=a,this.$hashcode&&s){if(s.$events.$$dirty$$=!0,s.$events.$$wait$$)return;n!==s.$events&&(r.heirloom=s.$events),he(r.$decompose,t,a,i),t.indexOf("*")===-1&&ie(r.heirloom[t],s,t,a,i),me(e+"",s,t,a,i),ye(r.heirloom,s,t,a,i),s.$events.$$dirty$$=!1,pe(s.$id)}}},enumerable:!0,configurable:!0}}function pe(t){e.rerenderStart=new Date;var n=t.indexOf(".");n>0?e.batch(t.slice(0,n)):e.batch(t)}function ve(t,n,r,o){if(n&&n.splice){var a=[0,n.length].concat(t);return++e.suspendUpdate,e.callArray=o.pathname,n.splice.apply(n,a),--e.suspendUpdate,n}for(var i in io)t[i]=io[i];t.notify=function(t,n,a,i){var s=r.__vmodel__;if(s){var c=null===t||void 0===t?o.pathname:o.pathname+"."+t;s.$fire(c,n,a),i||r.$$wait$$||e.suspendUpdate||(e.callArray=c,pe(s.$id),delete e.callArray)}};var s=e.makeHashCode("$");o.array=!0,o.hashcode=s,o.id=o.id||s,oo.initViewModel(t,r,{},{},o);for(var c=0,l=t.length;c<l;c++)t[c]=de(t[c],0,{},{id:t.$id+".*",master:!0});return t}function me(t,n,r,o,a){if(t.indexOf(".*.")>0){var i=t.match(fo),s=e.vmodels[i[1]];if(s){var c=i[2];ie(s.$events[c],n,r,o,a)}}}function he(e,t,n,r){if(e&&e[t]){var o=e[t];if(o.$hashcode){var a=t.replace(/^[^.]+\./,"");a!==t&&ie(o.$events[a],o,a,n,r)}else delete e[t]}}function ye(t,n,r,o,a){t.__fuzzy__&&t.__fuzzy__.replace(e.rword,function(e){var i=t[e],s=i.reg;return s&&s.test(r)&&ie(i,n,r,o,a),e})}function ge(t){switch(e.type(t)){case"array":for(var n=[],r=0;r<t.length;r++)n[r]=ge(t[r]);return n;case"object":var o={};for(r in t)if("__proxy__"!==r&&"__data__"!==r&&"__const__"!==r&&t.hasOwnProperty(r)){var a=t[r];o[r]=a&&a.nodeType?a:ge(a)}return o;default:return t}}function _e(e,t,n){po?Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!1,configurable:!0}):e[t]=n}function be(t,n,r,o,a){a.array?e.modern?Object.defineProperty(t,"$model",vo):t.$model=ge(t):(_e(t,"$accessors",o),_e(t,"hasOwnProperty",function(e){return r[e]===!0}),_e(t,"$track",Object.keys(r).sort().join(";;"))),_e(t,"$id",a.id),_e(t,"$hashcode",a.hashcode),a.master===!0&&(_e(t,"$run",function(){xe.call(t)}),_e(t,"$wait",function(){we.call(t)}),_e(t,"$element",null),_e(t,"$render",0),n.__vmodel__=t,_e(t,"$events",n),_e(t,"$watch",function(){return ae.apply(t,arguments)}),_e(t,"$fire",function(e,n,r){var o=t.$events[e];ie(o,t,e,n,r)}))}function we(){this.$events.$$wait$$=!0}function xe(){var t=this.$events;if(delete t.$$wait$$,t.$$dirty$$){delete t.$$dirty$$,e.rerenderStart=new Date;var n=this.$id,r=n.indexOf(".");r>0?e.batch(n.slice(0,r)):e.batch(n)}}function $e(){}function Ce(t,n,r){var o={};t.$skipArray&&(o=e.oneObject(t.$skipArray),delete t.$skipArray);var a={};r=r||{},n=n||{};var i={},s=Ao("$"),c=r.pathname||"";r.id=r.id||s,r.hashcode=r.hashcode||s;var l,u,d;for(l in t)if(!wo[l]){var f=a[l]=t[l];bo(l,f,o)||(u=r.id+"."+l,d=c?c+"."+l:l,i[l]=xo(u,d,n))}i.$model=$o;var p=new $e;p=Co(p,i,t);for(l in a)p[l]=a[l],l in o?delete a[l]:a[l]=!0;return Eo(p,n,a,i,r),p}function Ee(e,t,n,r){var o={},a={},i={};n=n||{};var s,c,l,u=r.pathname,d=e.$accessors||{};for(s in t)wo[s]||(o[s]=!0,bo(s,t[s],ko)?(a[s]=t[s],delete t[s]):d[s]?i[s]=d[s]:(c=r.id+"."+s,l=u?u+"."+s:s,i[s]=xo(c,l,n)));r.hashcode=e.$hashcode||Ao("$"),i.$model=$o;var f=new $e;f=Co(f,i,a);for(s in a)f[s]=a[s];return Eo(f,n,o,i,r),f}function Ae(t,n){for(var r,o,a,i={},s={},c={},l={},u=e.slice(arguments),d={},f="function"==typeof this&&this.isWidget,p=0;p<u.length;p++){var v=u[p],m=v.$accessors;for(var r in v)if(v.hasOwnProperty(r)){var h=v[r];"$skipArray"!==r?f&&u.indexOf(h)!==-1?(o=h,a=r):(i[r]=h,s[r]&&e.isObject(h)&&delete s[r],m&&m[r]?s[r]=m[r]:"function"!=typeof i[r]&&(c[r]=1)):Array.isArray(h)&&h.forEach(function(e){d[e]=1})}}"function"==typeof this&&this(i,c);for(r in c)wo[r]||s[r]||bo(r,i[r],d)||(s[r]=xo(t.$id,r,l),s[r].set(i[r]));var y=new $e;y=Co(y,s,i);for(r in i){if(s[r]||(y[r]=i[r]),f&&o&&s[r]&&o.hasOwnProperty(r)){var g=s[r].get;g.$decompose||(g.$decompose={}),g.$decompose[a+"."+r]=y}r in wo?delete i[r]:i[r]=!0}return Eo(y,l,i,s,{id:t.$id,hashcode:Ao("$"),master:!0}),y}function ke(t,n,r){if(r)t.afterChange=t.afterChange||[],e.Array.ensure(t.afterChange,n);else{var o=t.dom;n(t.dom,t,o&&o.parentNode)}}function Te(t,n){var r=t.ownerDocument,o=t.nodeName,a="_"+o;if(!Te[a]){var i=r.body.appendChild(r.createElement(o));n=e.css(i,"display"),r.body.removeChild(i),n===Mo&&(n="block"),Te[a]=n}return Te[a]}function Ne(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t],r=typeof n;if("string"===r||"number"===r||n===!0)e.push(n);else if(Array.isArray(n))e.push(Ne.apply(null,n));else if("object"===r)for(var o in n)n.hasOwnProperty(o)&&n[o]&&e.push(o)}return e.join(" ")}function Oe(t){var n=t.target;e(n).addClass(n.getAttribute(jo[t.type])||"")}function Me(t){var n=t.target,r=jo[t.type];e(n).removeClass(n.getAttribute(r)||""),"change-active"!==r&&e(n).removeClass(n.getAttribute("change-active")||"")}function je(t,n){var r=t.getAttribute("old-change-class"),o=n["ms-class"];r!==o&&(e(t).removeClass(r).addClass(o),t.setAttribute("old-change-class",o))}function Se(e,t){for(var n in e)if(e[n]!==t[n])return!0;return!1}function De(e){return Vo.test(e)||Do[e]?Rn(e):e}function Le(e){var t=[];for(var n in e){var r=typeof e[n];if("object"===r)if("props"===n){var o=[];for(var a in e.props){var i=e.props[a];"string"==typeof i&&(i=Rn(i)),o.push(De(a)+": "+i)}t.push(n+": {"+o.join(",\n")+"}")}else"children"===n&&t.push("children: ["+e[n].map(function(e){return Le(e)})+"]");else if(e.hasOwnProperty(n)){var s=e[n];"string"===r&&(s=Lo[n]?Rn(s):s),t.push(De(n)+":"+s)}}return"{\n"+t.join(",\n")+"}"}function Ve(e){e.callback&&e.callback.call(e.vmodel,{type:"changed",target:e.dom},e.local)}function Fe(e){var t=this,n=this.__ms_duplex__;if(!t.composing&&t.value!==n.value){if(t.caret)try{var r=n.getCaret(t);n.pos=r}catch(e){}if(n.debounceTime>4){var o=new Date,a=o-n.time||0;n.time=o,a>=n.debounceTime?Fo[n.type].call(n):(clearTimeout(n.debounceID),n.debounceID=setTimeout(function(){Fo[n.type].call(n)},a))}else Fo[n.type].call(n)}}function He(t,n){var r={},o=n["ms-duplex"];switch(o.update=Fe,o.type){case"radio":case"checkbox":r.click=Fe;break;case"select":r.change=Fe;break;case"contenteditable":o.isChanged?r.blur=Fe:e.modern?(qn.webkitURL?r.webkitEditableContentChanged=Fe:qn.MutationEvent&&(r.DOMCharacterDataModified=Fe),r.input=Fe):(r.keydown=Ye,r.paste=Ie,r.cut=Ie,r.focus=qe,r.blur=Re);break;case"input":o.isChanged?r.change=Fe:(Ho&&(r.keyup=Ye),Ho<9?(r.propertychange=Pe,r.paste=Ie,r.cut=Ie):r.input=Fe,(!Ho||Ho>9)&&(r.compositionstart=Re,r.compositionend=qe),Ho||/\[native code\]/.test(qn.Int8Array)||(r.keydown=Ye,r.paste=Ie,r.cut=Ie,qn.netscape&&(r.DOMAutoComplete=Fe)))}/password|text/.test(n.props.type)&&(r.focus=Be,r.blur=ze,o.getCaret=Bo,o.setCaret=Io);for(var a in r)e.bind(t,a,r[a])}function Pe(e){"value"===e.propertyName&&Fe.call(this,e)}function Ie(e){var t=this;setTimeout(function(){Fe.call(t,e)},0)}function Be(){this.caret=!0}function ze(){this.caret=!1}function Re(){this.composing=!0}function qe(e){this.composing=!1,Ie.call(this,e)}function Ye(e){var t=e.keyCode;91===t||15<t&&t<19||37<=t&&t<=40||Fe.call(this,e)}function Ue(t,n){var r=t.__ms_duplex__,o=n["ms-rules"];if(o&&!r.validator)for(;t&&1===t.nodeType;){var a=t._ms_validator_;if(a){r.rules=o,r.validator=a,e.Array.ensure(a.fields,r)&&a.addField(r);break}t=t.parentNode}}function We(t){for(var n,r=0;n=this.parsers[r++];){var o=e.parsers[n];o&&(t=o.call(this,t))}return t}function Ze(){var e=this.data||{};return this.message.replace(ea,function(t,n){return null==e[n]?"":e[n]})}function Xe(t){return"regexp"===e.type(t)}function Ke(e){if("string"==typeof e&&e){var t=e.split("-");if(3===t.length&&4===t[0].length){var n=~~t[0],r=~~t[1]-1,o=~~t[2],a=new Date(n,r,o);return a.getFullYear()===n&&a.getMonth()===r&&a.getDate()===o}}return!1}function Ge(e){var t=typeof e;return e&&"object"===t?e.$hashcode:t+":"+e}function Je(e,t,n,r,o,a,i,s){var c=s?Ge(t):e,l={};l[o]=e,l[a]=t;for(var u in n)u in l||(l[u]=n[u]);r(e,t,c,l,i)}function Qe(e,t){var n=e.children.map(function(e){return e["ms-if"]?e.comment:e.dom});return t&&n.forEach(function(t){e.dom.appendChild(t)}),n}function et(e){var t;for(var n in e){var t=n;break}if(t)return tt(e,t)}function tt(e,t){var n=e[t];if(n){var r=n.arr;if(r){var o=r.pop();return r.length||(n.arr=0),o}return delete e[t],n}}function nt(e,t){var n=t.key;if(e[n]){var r=e[n],o=r.arr||(r.arr=[]);o.push(t)}else e[n]=t}function rt(e,t,n){var r,o={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"};for(var a in o){if(n[a]){r=o[a];break}try{document.createEvent(a);r=o[a];break}catch(e){}}if("string"==typeof r)var i=!0,s=!0,c=r;o={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};var l;for(a in o)if(n[a]){l=o[a];break}if("string"==typeof l){var u=!0;s=!0;var d=l}return{css:s,animation:u,transition:i,animationEndEvent:d,transitionEndEvent:c,transitionDuration:e,animationDuration:t}}function ot(){var e=la[0];e&&e()}function at(e,t,n){e[t]||(e[t]=n)}function it(e){var t=da.test(e)?1e3:1;return parseFloat(e)*t}function st(e,t,n){var r=e[t];r=Array.isArray(r)?r:"function"==typeof r?[r]:[],r.forEach(function(e){e&&e(n)})}function ct(t){var n=t.toLowerCase();return function(r){var o,a=this.el,i=e(a),s=isFinite(r.stagger)?1e3*r.stagger:0;if(s&&r.staggerKey){var c=fa.get(r.staggerKey)||fa.put(r.staggerKey,{count:0,items:0});c.count++,c.items++}var l=c&&c.count||0,u=function(n){var i=n!==!1;0===--a.__ms_effect_&&(e.unbind(a,ca.transitionEndEvent),e.unbind(a,ca.animationEndEvent)),a.animating=void 0,o=!0;var s=i?"Done":"Abort";st(r,"on"+t+s,a),c&&0===--c.items&&(c.count=0),r.queue&&(la.shift(),ot())};st(r,"onBefore"+t,a),r[n]?r[n](a,function(e){u(e!==!1)}):ca.css&&(i.addClass(r[n+"Class"]),"leave"===n?i.removeClass(r.enterClass+" "+r.enterActiveClass):"enter"===n&&i.removeClass(r.leaveClass+" "+r.leaveActiveClass),a.__ms_effect_?a.__ms_effect_++:(i.bind(ca.transitionEndEvent,u),i.bind(ca.animationEndEvent,u),a.__ms_effect_=1),setTimeout(function(){o=NaN===e.root.offsetWidth,i.addClass(r[n+"ActiveClass"]);var t=Tn.getComputedStyle(a),c=t[ca.transitionDuration],l=t[ca.animationDuration],d=it(c)||it(l);0===!d?u(!1):s||setTimeout(function(){o||u(!1)},d+32)},17+s*l))}}function lt(e){e.acton||(e.action=e.hook.replace(/^on/,"").replace(/Done$/,"").toLowerCase())}function ut(e){var t="??"+pa++;return va.map[t]=e,t+" "}function dt(e){var t=va.map[e];return t}function ft(e){for(var t=pt(e),n=0,r=t.length;n<r;n++)e=e.replace(t[n],ut);return e}function pt(e){for(var t,n=0,r=[],o=0,a=e.length;o<a;o++){var i=e.charAt(o);if(t){if("\\"===i){o+=1;continue}i===t&&(r.push(e.slice(n,o+1)),t=!1)}else"'"===i?(t="'",n=o):'"'===i&&(t='"',n=o)}return r}function vt(e){for(var t,n=!1,r=0,o=0,a=e.length,i=0;i<a;i++){var s=e[i];t?"tr"!==s.nodeName&&s.children?t=!1:(t.children.push(s),r++,e[i]=0):"tr"===(s.type||s.nodeName)&&(t={nodeName:"tbody",children:[]},t.children.push(s),s.type&&delete s.type,n=!0,0===o&&(o=i),e[i]=t)}if(n)for(i=o;i<a&&(0!==e[i]||(e.splice(i,1),i--,r--,0!==r));i++);}function mt(e,t,n){switch(t){case"style":case"script":case"noscript":case"template":case"xmp":e.children=[{nodeName:"#text",skipContent:!0,nodeValue:n}];break;case"textarea":var r=e.props;r.type=t,r.value=n,e.children=[{nodeName:"#text",nodeValue:n}];break;case"option":e.children=[{nodeName:"#text",nodeValue:ht(n)}]}}function ht(e){return String(e).replace(ha,"").trim()}function yt(t){va.map={},t=ft(t);var n=[];n.last=function(){return n[n.length-1]};var r=[],o=1e5;do{var a=!1;if("<"!==t.charAt(0)){var i=t.indexOf("<");i=i===-1?t.length:i;var s=t.slice(0,i).replace(ma,dt);t=t.slice(i),a={nodeName:"#text",nodeValue:s},ba.test(s)&&_t(a,n,r)}if(!a){var i=t.indexOf("<!--");if(0===i){var c=t.indexOf("-->");c===-1&&e.error("注释节点没有闭合"+t);var s=t.slice(4,c).replace(ma,dt);t=t.slice(c+3),a={nodeName:"#comment",nodeValue:s},_t(a,n,r)}}if(!a){var l=t.match(ga);if(l){var u=l[1].toLowerCase(),d=Gr[u]||"/"===l[3];a={nodeName:u,props:{},children:[],isVoidTag:d};var f=l[2];if(f&&bt(f,a.props),_t(a,n,r),t=t.slice(l[0].length),d)a.end=!0;else if(n.push(a),ya[u]){var p=t.indexOf("</"+u+">"),v=t.slice(0,p).trim();t=t.slice(p),mt(a,u,wt(v))}}}if(!a){var l=t.match(_a);if(l){var u=l[1].toLowerCase(),m=n.last();m?m.nodeName!==u&&e.error(m.nodeName+"没有闭合"):e.error(l[0]+"前面缺少<"+u+">"),a=n.pop(),a.end=!0,t=t.slice(l[0].length)}}if(!a||0===--o)break;a.end&&(gt(a,n,r),delete a.end)}while(t.length);return r}function gt(e,t,n){var r=e.nodeName,o=e.props;"table"===r&&vt(e.children);var a=o["ms-for"];if(a){delete o["ms-for"];var i=t.last(),s=i?i.children:n;s.splice(s.length-1,1,{nodeName:"#comment",nodeValue:"ms-for:"+a,type:r},e,{nodeName:"#comment",nodeValue:"ms-for-end:",type:r})}}function _t(e,t,n){var r=t.last();r?r.children.push(e):n.push(e)}function bt(e,t){for(;e;){var n=xa.exec(e);if(!n)break;var r=n[1],o=n[2]||"";e=e.replace(n[0],""),":"===r.charAt(0)&&(r="ms-"+r.slice(1)),o&&0===o.indexOf("??")&&(o=wt(o).replace(wa,"").slice(1,-1)),r in t||(t[r]=o)}}function wt(t){return e.unescapeHTML(t.replace(ma,dt))}function xt(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=t[n]||e[n];switch(r.nodeName){case"#text":if(r.dynamic){var a=r.nodeValue+"";a!==o.nodeValue&&(o.nodeValue=a,o.dom&&(o.dom.nodeValue=a))}break;case"#comment":r.forExpr?Bn.for.diff(r,o,e,t,n):r.afterChange&&$t(o,r.afterChange);break;case void 0:xt(r,o);break;case"#document-fragment":xt(r.children,o.children);break;default:if(r.dynamic){var i=n;r["ms-widget"]&&(Bn.widget.diff(r,o,"ms-widget",e,t,i),r=e[n],o=t[n]||$a(),delete r["ms-widget"]),"ms-if"in r&&(Bn.if.diff(r,o,"ms-if",e,t,i),r=e[n],o=t[n]||$a(),delete r["ms-if"]),Ct(r,o)}!/^\w/.test(r.nodeName)||r.skipContent||r.isVoidTag||xt(r.children,o.children||[]),o.afterChange&&$t(o,o.afterChange)}}}function $t(e,t){if(t.length)for(var n,r=0;n=t[r++];)n(e.dom,e);delete e.afterChange}function Ct(t,n){try{for(var r in t){var o=r.match(Ca),a=o&&o[1];Bn[a]&&Bn[a].diff(t,n,r)}}catch(t){e.warn(a,t,t.stack||t.message,"diffProps error")}}function Et(t){if(Aa)return e.Array.ensure(Ea,t);Aa=t;var n=e.scopes[t];if(!n||!document.nodeName||e.suspendUpdate)return Aa=null;var r=n.vmodel,o=r.$element,a=o.vtree||[],i=r.$render,s=i(n.vmodel,n.local);n.isTemp&&delete e.scopes[t],e.diff(s,a);var c=Ea.indexOf(Aa);if(Aa=0,c>-1){var l=Ea.splice(c,1);return Et(l[0])}var u=Ea.shift();u&&Et(u)}function At(e,t){var n=[],r={},o="ms-skip"in t,a={};for(var i in t){var s,c=t[i];if(r[i]=t[i],s=i.match(ka)){if(o)continue;var l=i.replace(s[1],"").split("-");Ta[l[0]]&&l.unshift("on"),"on"===l[0]&&(l[2]=parseFloat(l[2])||0),l.unshift("ms");var u=l[1];if(Bn[u]){var d={type:u,param:l[2],name:l.join("-"),expr:c,priority:Bn[u].priority||100*u.charCodeAt(0)};"on"===u&&(d.priority+=l[3]),a[d.name]||(a[d.name]=c,n.push(d))}}}return e.props=r,n.sort(kt),n}function kt(e,t){return e.priority-t.priority}function Tt(e,t){for(var n,r=t?[]:["\nvar vnodes = [];"],o=0;n=e[o++];){var a=Nt(n);n.$prepend&&r.push(n.$prepend);var i=n.$append;delete n.$append,delete n.$prepend,a&&r.push(a+"\n"),i&&r.push(i)}return t||r.push("return vnodes\n"),r.join("\n")}function Nt(t){if(!t.nodeName)return!1;switch(t.nodeName){case"#text":return t.dynamic?Mt(St(t)):jt(t);case"#comment":var n=t.nodeValue;if(t.forExpr){var r={dynamic:!0,vmodel:"__vmodel__"};for(var o in t)t.hasOwnProperty(o)&&!Sa[o]&&(r[o]=t[o]);return e.directives.for.parse(r,t,t),t.$append+=e.caches[t.signature],jt(r)}if("ms-for-end:"===n)return t.$append=jt({nodeName:"#comment",nodeValue:t.signature})+" return vnodes}\n })\n},__local__,vnodes)\n"+jt({nodeName:"#comment",signature:t.signature,nodeValue:"ms-for-end:"})+"\n","";if(0===n.indexOf("ms-js:")){var a=e.parseExpr({type:"js",expr:n.replace("ms-js:","")})+"\n",i=jt(t),s=a.match(ja);return s&&s[1]?t.$append=(t.$append||"")+a+"\n__local__."+s[1]+" = "+s[1]+"\n":e.warn(n+" parse fail!"),i}return jt(t);default:if(!t.dynamic&&t.skipContent)return jt(t);var r={nodeName:t.nodeName},c=t.props;if(t.dynamic){r.dynamic="{}";var l=At(r,c);l.map(function(n){return e.directives[n.type].parse(r,t,n),n.name})}else if(c){r.props={};for(var o in c)r.props[o]=c[o]}if(t.isVoidTag)r.isVoidTag=!0;else if(!("children"in r)){var u=t.children;u&&(t.skipContent?r.children="["+u.map(function(e){return Le(e)})+"]":1===u.length&&"#text"===u[0].nodeName?u[0].dynamic?r.children="["+St(u[0])+"]":r.children="["+Le(u[0])+"]":r.children="(function(){"+Tt(u)+"})()")}return t.template&&(r.template=t.template),t.skipContent&&(r.skipContent=!0),jt(r)}}function Ot(t){return Ma.test(t)?t:e.parseExpr({expr:t,type:"text"})}function Mt(e){return"vnodes.push("+e+");"}function jt(e){return Mt(Le(e))}function St(e){var t=Dt(e.nodeValue),n="";if(1===t.length)n=Ot(t[0].expr);else{var r=t.map(function(e){return e.type?Ot(e.expr):Oa(e.expr)}).join(" + ");n="String("+r+")"}return'{\nnodeName: "#text",\ndynamic:true,\nnodeValue: '+n+"\n}"}function Dt(t){var n=[];do{var r=t.indexOf(Na.openTag);r=r===-1?t.length:r;var o=t.slice(0,r);if(/\S/.test(o)&&n.push({expr:e._decode(o)}),t=t.slice(r+Na.openTag.length)){r=t.indexOf(Na.closeTag);var o=t.slice(0,r);n.push({expr:e.unescapeHTML(o.replace(Da,"")),type:"text"}),t=t.slice(r+Na.closeTag.length)}}while(t.length);return n}function Lt(e){return Fa(e),e}function Vt(t){var n=t.nodeName;switch(n){case"#text":return!!e.config.rexpr.test(t.nodeValue)&&(t.dynamic=!0);case"#comment":return!!t.dynamic;case void 0:return!0;default:var r=t.props||{};if("ms-skip"in r)return t.skipContent=!0,!1;var o=!1;if("input"===n)r.type||(r.type="text");else if(/xmp|wbr|template/.test(n))!r["ms-widget"]&&r.is&&(r["ms-widget"]='{is:"'+r.is+'"}');else if("select"===n){var a=r.hasOwnProperty("multiple")?"multiple":"one";r.type=n+"-"+a}else 0===n.indexOf("ms-")&&(r["ms-widget"]||(r.is=n,r["ms-widget"]='{is:"'+n+'"}'));var i=!1;if(r["ms-widget"]){i=!0,Ft(r,"html","widget"),Ft(r,"text","widget");var s=e.mix({},t),c=e.mix({},t.props);delete c["ms-widget"],delete s.isVoidTag,s.nodeName="cheng",s.props=c,t.template=e.vdom(s,"toHTML"),t.isVoidTag||(t.children=[])}r["ms-text"]&&(i=!0,Ft(r,"html","text"),t.isVoidTag||(t.children=[])),r["ms-html"]&&(i=!0,t.isVoidTag||(t.children=[]));var l=!1;for(var u in r)if(l=!0,0===u.indexOf("ms-")){o=!0,t.dynamic={};break}if(l&&(t.props=r),t.children){var d=Fa(t.children);if(d)return delete t.skipContent,!0;i?delete t.skipContent:t.skipContent=!0}return o}}function Ft(t,n,r){t["ms-"+n]&&(e.warn(n,"指令不能与",r,"指令共存于同一个元素"),delete t["ms-"+n])}function Ht(e){for(var t,n=0;t=e[n++];)if(t.props&&t.props["ms-effect"])return!0;return!1}function Pt(t){var n=t.expr,r=t.type,o=Ha.get(r+":"+n);if(o)return e.shadowCopy(t,o),o.text;va.map={};var a={},i={},s=n.replace(Wa,ut);s=ft(s),s=s.replace(Ia,ut).replace(za,"$1").replace(qa,"$1__vmodel__.").replace(/(\b[\$\w]+\s*):/g,ut).replace(/\|(\w+)/g,function(e,t){return"|"+ut(t)}).replace(/__vmodel__\.([\$\w\.]+)/g,function(e,t){return a[t]=1,e}),Bt(s,i);var c=s.split(Ba),l=c.shift(),u=l.replace(ma,dt);if("js"===r)return It(t,u,a,i);c.length&&(c=c.map(function(e){var t="(__value__";return e=e.replace(Pa,function(e,n){return/\S/.test(n)&&(t+=","+n),""}).replace(ma,dt),e.replace(/^(\w+)/,'__value__ =  avalon.__format__("$1")')+t+")"}));var d=[];if("on"===r)Ra.test(u)&&(u+="($event)"),c=c.map(function(e){return e.replace(/__value__/g,"$event");
}),c.length&&c.push("if($event.$return){\n\treturn;\n}"),e.modern||(u=u.replace(/__vmodel__\.([^(]+)\(([^)]*)\)/,function(e,t,n){return"__vmodel__."+t+".call(__vmodel__"+(/\S/.test(n)?","+n:"")+")"})),d=["function ($event, __local__){","try{",zt(i).join("\n"),"\tvar __vmodel__ = this;","\t"+u,"}catch(e){",Rt(n,r),"}","}"],c.unshift(2,0);else{if("duplex"===r){var f=["function (__vmodel__,__value__){","try{","\t"+u+" = __value__","}catch(e){",Rt(n,r).replace("parse","set"),"}","}"];Ha.put("duplex:set:"+t.expr,f.join("\n").replace(ma,dt));var p=["function (__vmodel__){","try{","var __value__ = "+u,c.join("\n"),"return __value__","}catch(e){",Rt(n,r).replace("parse","get"),"}","}"].join("\n");return It(t,p,i,a)}d=["(function (){","try{","var __value__ = "+u.replace(ma,dt),"text"===r?"return avalon.parsers.string(__value__)":"return __value__","}catch(e){",Rt(n,r),'\treturn ""',"}","})()"],c.unshift(3,0)}return d.splice.apply(d,c),It(t,d.join("\n"),i,a)}function It(e,t,n,r){t=t.replace(ma,dt);var o={text:t,locals:Object.keys(n).join(","),paths:Object.keys(r).join(",")},a=e.type+":"+e.expr;return e.locals=o.locals,e.paths=o.paths,Ha.put(a,o),t}function Bt(t,n){t.replace(/__vmodel__/," ").replace(Ya," ").replace(Ua,function(t){"$event"===t||e.keyMap[t]||(n[t]=1)})}function zt(t){var n=[];for(var r in t)n.push("var "+r+" = __local__["+e.quote(r)+"]");return n}function Rt(t,n){return"\tavalon.warn(e, "+e.quote("parse "+n+" binding【 "+t+" 】fail")+")"}function qt(t,n){var r=Array.isArray(t)?Tt(t):t,o=[];if(n)for(var a in n)o.push("var "+a+" = __local__["+Rn(a)+"]");r=r.replace(Za,"$1");var i="__local__ = __local__ || {};\n"+o.join(";\n")+"\n"+r;try{var s=Function("__vmodel__","__local__",i)}catch(t){e.warn(r,"render parse error")}return s}function Yt(t,n,r,o){function a(e,t){m.forEach(function(n){delete e[n],delete t[n]})}var i=t.nodeName,s=t.props.is;if(!Xa[i]&&!Xt(i))return void e.warn(i+"不合适做组件的标签");var c={};if(n){var l=[].concat(n);l.forEach(function(e){e&&"object"==typeof e&&Kt(c,e.$model||e,!0)})}else l=[];var u=e.components[s];if(u){var d=c.id||c.$id;!d&&Qa&&(e.warn("warning!",s,"组件最好在ms-widget配置对象中指定全局不重复的$id以提高性能!\n","若在ms-for循环中可以利用 ($index,el) in @array 中的$index拼写你的$id\n","如 ms-widget=\"{is:'ms-button',id:'btn'+$index}\""),Qa=!1),c.define&&(delete c.define,e.warn("warning! 组件的define配置项已经被废掉"));var f=e.directives.widget.define,p=d||t.props.id||"w"+(new Date-0),v=e.mix(!0,{},u.defaults);Kt(c,v,!1);var m=Ja.concat();a.isWidget=!0;var h=f.apply(a,[t.vmodel,v].concat(l));if(!e.modern)for(var y in h)ao[y]||"function"!=typeof h[y]||(h[y]=h[y].bind(h));h.$id=p,e.vmodels[p]=h;for(var g in Ga)c[g]&&c[g].forEach(function(e){h.$watch(g,e)});var _=e.lexer(o),b=_[0];b.children=b.children||[],b.props.is=s,b.props.wid=p,e.speedUp(_);var w=e.render(_,r),x=u.template.trim();"function"==typeof u.getTemplate&&(x=u.getTemplate(h,x));var $=e.lexer(x);$.length>1&&e.error("组件必须用一个元素包起来");var C=u.soleSlot;Zt($,C),e.speedUp($);var E=e.render($),A=Wt+"",k=C?e.quote(C):"null";A=A.replace("XXXXX",Ut(w)).replace("YYYYY",Ut(E)).replace("ZZZZZ",k);var T=A.indexOf("{")+1,N=A.lastIndexOf("}"),O=Function("vm","local",A.slice(T,N));return h.$render=O,t["component-vm:"+s]=h,h.$render=O}}function Ut(e){return e.toString().replace("anonymous","").replace(/\s*\/\*\*\//g,"")}function Wt(){var t=XXXXX(vm,local),n=t[0],r=YYYYY(vm,local),o=r[0];for(var a in n)"children"!==a&&"nodeName"!==a&&("props"===a?e.mix(o.props,n.props):o[a]=n[a]);var i=ZZZZZ,s=e.collectSlots(n,i);return!i||s[i]&&s[i].length||(s[i]=[{nodeName:"#text",nodeValue:vm[i],dynamic:!0}]),e.insertSlots(r,s),delete o.skipAttrs,delete o.skipContent,r}function Zt(e,t){for(var n,r=0;n=e[r];r++)if("slot"===n.nodeName){var o=n.props.name||t;e.splice(r,1,{nodeName:"#comment",nodeValue:"slot:"+o,dynamic:!0,type:o},{nodeName:"#comment",nodeValue:"slot-end:"}),r++}else n.children&&Zt(n.children,t)}function Xt(t){return ei.test(t)||e.components[t]}function Kt(e,t,n){for(var r in t){var o=t[r];Ga[r]?r in e?e[r].push(o):e[r]=[t[r]]:n&&(e[r]=o)}}function Gt(e){for(;e;){if(9===e.nodeType)return!0;e=e.parentNode}return!1}function Jt(t){if(1===t.nodeType&&t.getAttribute("wid")&&!Gt(t)){var n=t.getAttribute("wid"),r=e.scopes[n];if(!r)return;var o=t.getAttribute("ms-controller")||t.getAttribute("ms-important"),a=o&&e.vmodels[o]||r.vmodel;if(a.$fire("onDispose",{type:"dispose",target:t,vmodel:a}),o)return;if(!t.getAttribute("cached")){delete r.vmodel,delete e.scopes[n];var i=t.vtree;Qt(i);var s=t.getAttribute("is");i&&(i[0][s+"-mount"]=!1,i[0]["component-ready:"+s]=!1)}return!1}}function Qt(e){for(var t in e){var n=e[t];if(ti.test(n.nodeName)){for(var t in n)0===t.indexOf("ms-on")&&delete n[t];n.children&&Qt(n.children)}}}function en(e){setTimeout(function(){Jt(e)},4)}function tn(e){for(var t,n=0;t=e[n++];)Jt(t)}function nn(e){e.addEventListener("DOMNodeRemovedFromDocument",function(){en(e)})}function rn(){function t(e,t){var n=r[e];r[e]=function(e,r){return t.call(this,n,e,r)}}function n(t){var n=e.slice(this.getElementsByTagName("*"));o.call(this,t),tn(n)}if(!rn.execute){rn.execute=!0;var r=Node.prototype;t("removeChild",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&en(t),t}),t("replaceChild",function(e,t,n){return e.call(this,t,n),1===n.nodeType&&en(n),t});var o,a=Element.prototype;try{var i=Object.getOwnPropertyDescriptor(a,"innerHTML"),o=i.set;i.set=n,Object.defineProperty(a,"innerHTML",i)}catch(e){if(!a||!a.__lookupSetter__)throw e;o=a.__lookupSetter__("innerHTML"),a.__defineSetter__("innerHTML",n)}t("appendChild",function(e,t){return e.call(this,t),1===t.nodeType&&11===this.nodeType&&en(t),t}),t("insertBefore",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&11===this.nodeType&&en(t),t})}}function on(t){e.Array.ensure(ni,t),ri||(ri=setInterval(function(){for(var t,n=0;t=ni[n];)!1===Jt(t)?e.Array.removeAt(ni,n):n++;0==ni.length&&(clearInterval(ri),ri=0)},700))}function an(e){if(Tn.chrome&&Tn.MutationEvent)nn(e);else try{rn(e)}catch(t){on(e)}}function sn(t,n){var r=n.props.is,o=n["component-vm:"+r],a="component-html:"+r,i=n[a],s=e.vdom(n,"toHTML");i!==s&&(n[a]=s,o.$fire("onViewChange",{type:"viewchange",target:t,vmodel:o,is:r}))}function cn(e){var t=!0;try{ln(e)}catch(e){t=!1}return t}function ln(e){e.children.forEach(function(e){if("#comment"===e.nodeName){if("unresolved component placeholder"===e.nodeValue)throw"unresolved"}else e.children&&ln(e)})}e.init=function(e){this[0]=this.element=e},e.fn=e.prototype=e.init.prototype,e.shadowCopy=function(e,t){for(var n in t)e[n]=t[n];return e};var un={},dn=/([a-z\d])([A-Z]+)/g,fn=/[-_][^-_]/g,pn=/\d\.\d{4}/,vn=/[-.*+?^${}()|[\]\/\\]/g,mn=[].slice,hn=/[^, ]+/g,yn="object"==typeof console;e.shadowCopy(e,{noop:function(){},version:"2.1.17",rword:hn,inspect:{}.toString,ohasOwn:{}.hasOwnProperty,caches:{},vmodels:{},filters:{},components:{},directives:{},eventHooks:{},eventListeners:{},validators:{},scopes:{},effects:{},cssHooks:un,parsers:{number:function(e){return""===e?"":parseFloat(e)||0},string:function(e){return null===e||void 0===e?"":e+""},boolean:function(e){return""===e?e:"true"===e||"1"===e}},log:function(){yn&&e.config.debug&&Function.apply.call(console.log,console,arguments)},warn:function(){if(yn&&e.config.debug){var t=console.warn||console.log;Function.apply.call(t,console,arguments)}},error:function(e,t){throw(t||Error)(e)},oneObject:function(e,t){"string"==typeof e&&(e=e.match(hn)||[]);for(var n={},r=void 0!==t?t:1,o=0,a=e.length;o<a;o++)n[e[o]]=r;return n},isObject:function(e){return null!==e&&"object"==typeof e},range:function(e,t,n){n||(n=1),null==t&&(t=e||0,e=0);for(var r=-1,o=Math.max(0,Math.ceil((t-e)/n)),a=new Array(o);++r<o;)a[r]=e,e+=n;return a},hyphen:function(e){return e.replace(dn,"$1-$2").toLowerCase()},camelize:function(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(fn,function(e){return e.charAt(1).toUpperCase()})},slice:function(e,t,n){return mn.call(e,t,n)},css:function(t,n,r,o){if(t instanceof e&&(t=t[0]),1===t.nodeType){var a=e.camelize(n);if(n=e.cssName(a)||a,void 0===r||"boolean"==typeof r){o=un[a+":get"]||un["@:get"],"background"===n&&(n="backgroundColor");var i=o(t,n);return r===!0?parseFloat(i)||0:i}if(""===r)t.style[n]="";else{if(null==r||r!==r)return;isFinite(r)&&!e.cssNumber[a]&&(r+="px"),o=un[a+":set"]||un["@:set"],o(t,n,r)}}},directive:function(e,t){return t.parse=t.parse||n,this.directives[e]=t},makeHashCode:function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(pn,e)},escapeRegExp:function(e){return(e+"").replace(vn,"\\$&")},Array:{merge:function(e,t){e.push.apply(e,t)},ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(t,n){var r=t.indexOf(n);return!!~r&&e.Array.removeAt(t,r)}}});var gn=Object.prototype.hasOwnProperty;if(!r("司徒正美".trim)){var _n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(_n,"")}}var bn=!{toString:null}.propertyIsEnumerable("toString"),wn=function(){}.propertyIsEnumerable("prototype"),xn=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],$n=xn.length;r(Object.keys)||(Object.keys=function(e){var t=[],n=wn&&"function"==typeof e;if("string"==typeof e||e&&e.callee)for(var r=0;r<e.length;++r)t.push(String(r));else for(var o in e)n&&"prototype"===o||!gn.call(e,o)||t.push(String(o));if(bn)for(var a=e.constructor,i=a&&a.prototype===e,s=0;s<$n;s++){var c=xn[s];i&&"constructor"===c||!gn.call(e,c)||t.push(c)}return t}),r(Array.isArray)||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),r(r.bind)||(Function.prototype.bind=function(e){if(arguments.length<2&&void 0===e)return this;var t=this,n=arguments;return function(){var r,o=[];for(r=1;r<n.length;r++)o.push(n[r]);for(r=0;r<arguments.length;r++)o.push(arguments[r]);return t.apply(e,o)}});var Cn=Array.prototype,En=Cn.slice;try{En.call(document.documentElement)}catch(e){Cn.slice=function(e,t){if(t="undefined"!=typeof t?t:this.length,Array.isArray(this))return En.call(this,e,t);var n,r,o=[],a=this.length,i=e||0;i=i>=0?i:a+i;var s=t?t:a;if(t<0&&(s=a+t),r=s-i,r>0)if(o=new Array(r),this.charAt)for(n=0;n<r;n++)o[n]=this.charAt(i+n);else for(n=0;n<r;n++)o[n]=this[i+n];return o}}if(!r(Cn.map)){var An={indexOf:function(e,t){var n=this.length,r=~~t;for(r<0&&(r+=n);r<n;r++)if(this[r]===e)return r;return-1},lastIndexOf:function(e,t){var n=this.length,r=null==t?n-1:t;for(r<0&&(r=Math.max(0,n+r));r>=0;r--)if(this[r]===e)return r;return-1},forEach:o("","_",""),filter:o("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:o("r=[],","r[i]=_","return r"),some:o("","if(_)return true","return false"),every:o("","if(!_)return false","return true")};for(var kn in An)Cn[kn]=An[kn]}var Tn=Function(" return this")()||this,Nn={window:Tn,document:{createElement:Object,createElementNS:Object,contains:Boolean},root:{outerHTML:"x"},msie:NaN,browser:!1,modern:!0,avalonDiv:{},avalonFragment:null};if(Tn.avalon=e,Tn.location&&Tn.navigator&&Tn.window){var On=Tn.document;Nn.inBrowser=!0,Nn.document=On,Nn.root=On.documentElement,Nn.avalonDiv=On.createElement("div"),Nn.avalonFragment=On.createDocumentFragment(),Tn.VBArray?(Nn.msie=On.documentMode||(Tn.XMLHttpRequest?7:6),Nn.modern=Nn.msie>8):Nn.modern=!0}e.shadowCopy(e,Nn),e.quote="undefined"!=typeof JSON?JSON.stringify:new function(){var e={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},t="000000",n=function(e,n){return(t+(n||0)).slice(-e)},r="\\u00",o=function(t){var o=t.charCodeAt(0),a=e[o];return a?a:r+n(2,o.toString(16))},a=/[\x00-\x1f\x22\x5c]/g;return function(e){return a.lastIndex=0,'"'+(a.test(e)?String(e).replace(a,o):e)+'"'}};var Mn=e.inspect,jn={};"Boolean Number String Function Array Date RegExp Object Error".replace(e.rword,function(e){jn["[object "+e+"]"]=e.toLowerCase()}),e.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?jn[Mn.call(e)]||"object":typeof e};var Sn=/^\s*\bfunction\b/;e.isFunction="object"==typeof alert?function(e){try{return Sn.test(e+"")}catch(e){return!1}}:function(e){return"[object Function]"===Mn.call(e)};var Dn=/^\[object (?:Window|DOMWindow|global)\]$/;e.isWindow=i(e.window)?i:a;var Ln,Vn;for(Ln in e({}))break;var gn=e.ohasOwn;Vn="0"!==Ln,e.isPlainObject=/\[native code\]/.test(Object.getPrototypeOf)?c:s,e.mix=e.fn.mix=function(){var t,n,r,o,a,i,s=arguments[0]||{},c=1,l=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},c++),"object"==typeof s||e.isFunction(s)||(s={}),c===l&&(s=this,c--);c<l;c++)if(null!=(t=arguments[c]))for(n in t){try{r=s[n],o=t[n]}catch(e){continue}s!==o&&(u&&o&&(e.isPlainObject(o)||(a=Array.isArray(o)))?(a?(a=!1,i=r&&Array.isArray(r)?r:[]):i=r&&e.isPlainObject(r)?r:{},s[n]=e.mix(u,i,o)):void 0!==o&&(s[n]=o))}return s};var Fn=/(Array|List|Collection|Map|Arguments)\]$/;e.each=function(e,t){if(e){var n=0;if(l(e))for(var r=e.length;n<r&&t(n,e[n])!==!1;n++);else for(n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)break}},new function(){var t=["%cavalon.js %c"+e.version+" %cin debug mode, %cmore...","color: rgb(114, 157, 52); font-weight: normal;","color: rgb(85, 85, 85); font-weight: normal;","color: rgb(85, 85, 85); font-weight: normal;","color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;"],n="You're running avalon in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\n\nTo disable debug mode, add this line at the start of your app:\n\n  avalon.config({debug: false});\n\nDebug mode also automatically shut down amicably when your app is minified.\n\nGet help and support:\n  https://segmentfault.com/t/avalon\n  http://avalonjs.coding.me/\n  http://www.baidu-x.com/?q=avalonjs\n  http://www.avalon.org.cn/\n\nFound a bug? Raise an issue:\n  https://github.com/RubyLouvre/avalon/issues\n\n";if("object"==typeof console){var r=console,o=r.groupCollapsed||r.log;Function.apply.call(o,r,t),r.log(n),o!==console.log&&r.groupEnd(t)}};var Hn=u.prototype;Hn.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},Hn.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0,delete this._keymap[e.key],this.size--)},Hn.get=function(e){var t=this._keymap[e];if(void 0!==t)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)};var Pn=/&[a-z0-9#]{2,10};/,In=e.avalonDiv;e.shadowCopy(e,{evaluatorPool:new u(888),_decode:function(e){return Pn.test(e)?(In.innerHTML=e,In.innerText||In.textContent):e}});var Bn=e.directives,zn=1,Rn=e.quote,qn=e.window,Yn=e.document,Un=e.root,Wn=e.modern,Zn=e.eventHooks;e.config=p;var Xn={interpolate:function(t){var n=t[0],r=t[1];if(n===r)throw new SyntaxError("openTag!==closeTag");var o=n+"test"+r,a=e.avalonDiv;if(a.innerHTML=o,a.innerHTML!==o&&a.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");a.innerHTML="",p.openTag=n,p.closeTag=r;var i=e.escapeRegExp(n),s=e.escapeRegExp(r);p.rexpr=new RegExp(i+"([\\s\\S]*)"+s)}};p.plugins=Xn,e.config({interpolate:["{{","}}"],debug:!0});var Kn=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,Gn=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,Jn=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,Qn={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},er={yyyy:g("FullYear",4),yy:g("FullYear",2,0,!0),y:g("FullYear",1),MMMM:_("Month"),MMM:_("Month",!0),MM:g("Month",2,1),M:g("Month",1,1),dd:g("Date",2),d:g("Date",1),HH:g("Hours",2),H:g("Hours",1),hh:g("Hours",2,-12),h:g("Hours",1,-12),mm:g("Minutes",2),m:g("Minutes",1),ss:g("Seconds",2),s:g("Seconds",1),sss:g("Milliseconds",3),EEEE:_("Day"),EEE:_("Day",!0),a:w,Z:b},tr=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,nr=/^\/Date\((\d+)\)\/$/,rr={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss",short:"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};rr.SHORTMONTH=rr.MONTH,x.locate=rr,Number.isNaN=Number.isNaN||function(e){return e!==e};var or={orderBy:$,filterBy:C,selectBy:E,limitBy:A},ar={stop:function(e){return e.stopPropagation(),e},prevent:function(e){return e.preventDefault(),e}},ir={esc:27,tab:9,enter:13,space:32,del:46,up:38,left:37,right:39,down:40};for(var sr in ir)!function(e,t){ar[e]=function(e){return e.which!==t&&(e.$return=!0),e}}(sr,ir[sr]);var cr=e.filters;e.escapeHtml=N,e.__format__=function(e){var t=cr[e];return t?t:O},e.mix(cr,{uppercase:function(e){return String(e).toUpperCase()},lowercase:function(e){return String(e).toLowerCase()},truncate:function(e,t,n){return e?(e=String(e),isNaN(t)&&(t=30),n="string"==typeof n?n:"...",e.length>t?e.slice(0,t-n.length)+n:e):""},camelize:e.camelize,date:x,escape:N,sanitize:m,number:v,currency:function(e,t,n){return(t||"¥")+v(e,isFinite(n)?n:2)}},or,ar),M.prototype={constructor:M,toDOM:function(){if(this.dom)return this.dom;var t=e._decode(this.nodeValue);return this.dom=document.createTextNode(t)},toHTML:function(){return this.nodeValue}},j.prototype={constructor:j,toDOM:function(){return this.dom=document.createComment(this.nodeValue)},toHTML:function(){return"<!--"+this.nodeValue+"-->"}};var lr={class:function(e,t){e.className=t},style:function(e,t){e.style.cssText=t},type:function(e,t){try{e.type=t}catch(e){}},for:function(e,t){e.htmlFor=t}};S.prototype={constructor:S,toDOM:function(){if(this.dom)return this.dom;var t,n=this.nodeName;t=e.modern&&ur[n]?L(n):e.modern||!fr[n]&&!dr.test(n)?document.createElement(n):V(n);var r=this.props||{},o=r["ms-important"]||r["ms-controller"]||this.wid;if(o){var a=e.scopes[o],i=a&&a.vmodel&&a.vmodel.$element;if(i){var s=i.vtree[0];return s.children&&(this.children=s.children),i}}for(var c in r){var l=r[c];D(l)&&(lr[c]&&e.msie<8?lr[c](t,l):t.setAttribute(c,l+""))}var u=this.children||[],d=u[0]?u[0].nodeValue:"";switch(this.nodeName){case"script":t.type="noexec",t.text=d,t.type=r.type||"";break;case"style":"styleSheet"in t?(t.setAttribute("type","text/css"),t.styleSheet.cssText=d):t.innerHTML=d;break;case"xmp":case"noscript":t.textContent=d;break;case"template":t.innerHTML=d;break;default:this.isVoidTag||this.children.forEach(function(n){n&&t.appendChild(e.vdom(n,"toDOM"))})}return this.dom=t},toHTML:function(){var t=[],n=this.props||{};for(var r in n){var o=n[r];D(o)&&t.push(r+"="+e.quote(n[r]+""))}t=t.length?" "+t.join(" "):"";var a="<"+this.nodeName+t;return this.isVoidTag?a+"/>":(a+=">",this.children&&(a+=this.children.map(function(t){return t?e.vdom(t,"toHTML"):""}).join("")),a+"</"+this.nodeName+">")}};var ur=e.oneObject("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use,g,svg"),dr=/^\w+\:\w+/,fr=e.oneObject("shape,line,polyline,rect,roundrect,oval,arc,curve,background,image,shapetype,group,fill,stroke,shadow, extrusion, textbox, imagedata, textpath");F.prototype={constructor:F,toDOM:function(){if(this.dom)return this.dom;for(var t,n=document.createDocumentFragment(),r=0;t=this.children[r++];)n.appendChild(e.vdom(t,"toDOM"));return this.split=n.lastChild,this.dom=n},toHTML:function(){return this.children.map(function(t){return e.vdom(t,"toHTML")}).join("")}},e.vdom=e.vdomAdaptor=function(e,t){if(!e)return"toHTML"===t?"":document.createDocumentFragment();switch(e.nodeName){case"#text":return M.prototype[t].call(e);case"#comment":return j.prototype[t].call(e);case"#document-fragment":return F.prototype[t].call(e);case void 0:return new F(e)[t]();default:return S.prototype[t].call(e)}};var pr={VText:M,VComment:j,VElement:S,VFragment:F};e.shadowCopy(e.vdom,pr),e.domize=function(t){return e.vdom(t,"toDOM")};var vr=/radio|checkbox/;e.cloneNode=function(e){return e.cloneNode(!0)},e.contains=B,e.browser&&(e.msie<10&&(e.cloneNode=I),document.contains||(document.contains=function(e){return B(document,e)}),Tn.Node&&!document.createTextNode("x").contains&&(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))}),Tn.HTMLElement&&!e.root.outerHTML&&HTMLElement.prototype.__defineGetter__("outerHTML",function(){var e=document.createElement("div");return e.appendChild(this),e.innerHTML}));var mr=/\S+/g,hr={_toString:function(){var e=this.node,t=e.className,n="string"==typeof t?t:t.baseVal,r=n.match(mr);return r?r.join(" "):""},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;"object"==typeof t.className?t.setAttribute("class",e):t.className=e}};"add,remove".replace(e.rword,function(t){e.fn[t+"Class"]=function(e){var n=this[0]||{};return e&&"string"==typeof e&&1===n.nodeType&&e.replace(mr,function(e){z(n)[t](e)}),this}}),e.shadowCopy(e.fn,{hasClass:function(e){var t=this[0]||{};return 1===t.nodeType&&z(t).contains(e)},toggleClass:function(e,t){var n="boolean"==typeof t,r=this;return String(e).replace(mr,function(e){var o=n?t:!r.hasClass(e);r[o?"addClass":"removeClass"](e)}),this}});var yr={"accept-charset":"acceptCharset",char:"ch",charoff:"chOff",class:"className",for:"htmlFor","http-equiv":"httpEquiv"},gr=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected,","isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(",");gr.replace(/\w+/g,function(e){yr[e.toLowerCase()]=e});var _r=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,contentEditable,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");_r.replace(/\w+/g,function(e){yr[e.toLowerCase()]=e});var br=/^\[object SVG\w*Element\]$/,wr=/&amp;/g,xr=/^[\],:{}\s]*$/,$r=/(?:^|:|,)(?:\s*\[)+/g,Cr=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Er=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;e.parseJSON="object"==typeof JSON?JSON.parse:function(t){if("string"==typeof t){if(t=t.trim(),t&&xr.test(t.replace(Cr,"@").replace(Er,"]").replace($r,"")))return new Function("return "+t)();e.error("Invalid JSON: "+t)}return t},e.fn.attr=function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)};var Ar=e.cssHooks,kr={float:"cssFloat"};e.cssNumber=e.oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom");var Tr=["","-webkit-","-o-","-moz-","-ms-"];e.cssName=function(t,n,r){if(kr[t])return kr[t];n=n||e.root.style||{};for(var o=0,a=Tr.length;o<a;o++)if(r=e.camelize(Tr[o]+t),r in n)return kr[t]=r;return null},e.fn.css=function(t,n){if(e.isPlainObject(t))for(var r in t)e.css(this,r,t[r]);else var o=e.css(this,t,n);return void 0!==o?o:this},e.fn.position=function(){var t,n,r=this[0],o={top:0,left:0};return r?("fixed"===this.css("position")?n=r.getBoundingClientRect():(t=this.offsetParent(),n=this.offset(),"HTML"!==t[0].tagName&&(o=t.offset()),o.top+=e.css(t[0],"borderTopWidth",!0),o.left+=e.css(t[0],"borderLeftWidth",!0),o.top-=t.scrollTop(),o.left-=t.scrollLeft()),{top:n.top-o.top-e.css(r,"marginTop",!0),left:n.left-o.left-e.css(r,"marginLeft",!0)}):o},e.fn.offsetParent=function(){for(var t=this[0].offsetParent;t&&"static"===e.css(t,"position");)t=t.offsetParent;return e(t||e.root)},Ar["@:set"]=function(e,t,n){try{e.style[t]=n}catch(e){}},Ar["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&(n="filter"===t?r.getPropertyValue(t):r[t],""===n&&(n=e.style[t])),n},Ar["opacity:get"]=function(e){var t=Ar["@:get"](e,"opacity");return""===t?"1":t},"top,left".replace(e.rword,function(t){Ar[t+":get"]=function(n){var r=Ar["@:get"](n,t);return/px$/.test(r)?r:e(n).position()[t]+"px"}});var Nr={position:"absolute",visibility:"hidden",display:"block"},Or=/^(none|table(?!-c[ea]).+)/;if(e.each({Width:"width",Height:"height"},function(t,n){var r="client"+t,o="scroll"+t,a="offset"+t;Ar[n+":get"]=function(n,r,o){var i=-4;"number"==typeof o&&(i=o),r="Width"===t?["Left","Right"]:["Top","Bottom"];var s=n[a];return 2===i?s+e.css(n,"margin"+r[0],!0)+e.css(n,"margin"+r[1],!0):(i<0&&(s=s-e.css(n,"border"+r[0]+"Width",!0)-e.css(n,"border"+r[1]+"Width",!0)),i===-4&&(s=s-e.css(n,"padding"+r[0],!0)-e.css(n,"padding"+r[1],!0)),s)},Ar[n+"&get"]=function(e){var t=[];Y(e,t);for(var r,o=Ar[n+":get"](e),a=0;r=t[a++];){e=r.node;for(var i in r)"string"==typeof r[i]&&(e.style[i]=r[i])}return o},e.fn[n]=function(e){var i=this[0];if(0===arguments.length){if(i.setTimeout)return i["inner"+t]||i.document.documentElement[r]||i.document.body[r];if(9===i.nodeType){var s=i.documentElement;return Math.max(i.body[o],s[o],i.body[a],s[a],s[r])}return Ar[n+"&get"](i)}return this.css(n,e)},e.fn["inner"+t]=function(){return Ar[n+":get"](this[0],void 0,-2)},e.fn["outer"+t]=function(e){return Ar[n+":get"](this[0],void 0,e===!0?2:0)}}),e.msie<9){kr.float="styleFloat";var Mr=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,jr=/^(top|right|bottom|left)$/,Sr=/alpha\([^)]*\)/i,Dr=8===e.msie,Lr={thin:Dr?"1px":"2px",medium:Dr?"3px":"4px",thick:Dr?"5px":"6px"};Ar["@:get"]=function(e,t){var n=e.currentStyle,r=n[t];if(Mr.test(r)&&!jr.test(r)){var o=e.style,a=o.left,i=e.runtimeStyle.left;e.runtimeStyle.left=n.left,o.left="fontSize"===t?"1em":r||0,r=o.pixelLeft+"px",o.left=a,e.runtimeStyle.left=i}return"medium"===r&&(t=t.replace("Width","Style"),"none"===n[t]&&(r="0px")),""===r?"auto":Lr[r]||r},Ar["opacity:set"]=function(e,t,n){var r=e.style,o=isFinite(n)&&n<=1?"alpha(opacity="+100*n+")":"",a=r.filter||"";r.zoom=1,r.filter=(Sr.test(a)?a.replace(Sr,o):a+" "+o).trim(),r.filter||r.removeAttribute("filter")},Ar["opacity:get"]=function(e){for(var t,n=/(opacity|\d(\d|\.)*)/g,r=e.style.filter.match(n)||[],o=!1,a=0;t=r[a++];)if("opacity"===t)o=!0;else if(o)return t/100+"";return"1"}}e.fn.offset=function(){var t=this[0],n={left:0,top:0};if(!t||!t.tagName||!t.ownerDocument)return n;var r=t.ownerDocument,o=r.body,a=r.documentElement,i=r.defaultView||r.parentWindow;if(!e.contains(a,t))return n;t.getBoundingClientRect&&(n=t.getBoundingClientRect());var s=a.clientTop||o.clientTop,c=a.clientLeft||o.clientLeft,l=Math.max(i.pageYOffset||0,a.scrollTop,o.scrollTop),u=Math.max(i.pageXOffset||0,a.scrollLeft,o.scrollLeft);return{top:n.top+l-s,left:n.left+u-c}},e.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){e.fn[t]=function(r){var o=this[0]||{},a=U(o),i="scrollTop"===t;return arguments.length?void(a?a.scrollTo(i?e(a).scrollLeft():r,i?r:e(a).scrollTop()):o[t]=r):a?n in a?a[n]:root[t]:o[t]}});var Vr=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,Fr={"option:get":e.msie?function(e){return Vr.test(e.outerHTML)?e.value:e.text.trim()}:function(e){return e.value},"select:get":function(e,t){for(var n,r=e.options,o=e.selectedIndex,a=Fr["option:get"],i="select-one"===e.type||o<0,s=i?null:[],c=i?o+1:r.length,l=o<0?c:i?o:0;l<c;l++)if(n=r[l],(n.selected||l===o)&&!n.disabled&&(!n.parentNode.disabled||"OPTGROUP"!==n.parentNode.tagName)){if(t=a(n),i)return t;s.push(t)}return s},"select:set":function(e,t,n){t=[].concat(t);for(var r,o=Fr["option:get"],a=0;r=e.options[a++];)(r.selected=t.indexOf(o(r))>-1)&&(n=!0);n||(e.selectedIndex=-1)}};e.fn.val=function(e){var t=this[0];if(t&&1===t.nodeType){var n=0===arguments.length,r=n?":get":":set",o=Fr[W(t)+r];if(o)var a=o(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?a:this};var Hr=/<|&#?\w+;/,Pr=new u(128),Ir=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi;e.parseHTML=function(t){var n=e.avalonFragment.cloneNode(!1);if("string"!=typeof t)return n;if(!Hr.test(t))return document.createTextNode(t);t=t.replace(Ir,"<$1></$2>").trim();var r=Pr.get(t);if(r)return e.cloneNode(r);for(var o,a=e.lexer(t),i=0;o=a[i++];)n.appendChild(e.vdom(o,"toDOM"));return t.length<1024&&Pr.put(t,n),n},e.innerHTML=function(e,t){var n=this.parseHTML(t);this.clearHTML(e).appendChild(n)},e.unescapeHTML=function(e){return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e.clearHTML=function(e){for(e.textContent="";e.lastChild;)e.removeChild(e.lastChild);return e};var Br={click:!0,dblclick:!0,keydown:!0,keypress:!0,keyup:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,wheel:!0,mousewheel:!0,input:!0,change:!0,beforeinput:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,select:!0,cut:!0,copy:!0,paste:!0,beforecut:!0,beforecopy:!0,beforepaste:!0,focusin:!0,focusout:!0,DOMFocusIn:!0,DOMFocusOut:!0,DOMActivate:!0,dragend:!0,datasetchanged:!0},zr=e.modern&&Yn.ontouchstart;e.fn.bind=function(t,n,r){if(this[0])return e.bind(this[0],t,n,r)},e.fn.unbind=function(t,n,r){return this[0]&&e.unbind(this[0],t,n,r),this},e.bind=function(t,n,r){if(1===t.nodeType){var o=t.getAttribute("avalon-events")||"",a=f(r),i=Zn[n];"click"===n&&zr&&t.addEventListener("click",e.noop),i&&(n=i.type||n,i.fix&&(r=i.fix(t,r),r.uuid=a));var s=n+":"+a;e.eventListeners[r.uuid]=r,o.indexOf(n+":")===-1&&(Br[n]||e.modern&&Ur[n]?K(n):e._nativeBind(t,n,X));var c=o.split(",");""===c[0]&&c.shift(),c.indexOf(s)===-1&&(c.push(s),t.setAttribute("avalon-events",c.join(",")))}else e._nativeBind(t,n,r);return r},e.unbind=function(t,n,r){if(1===t.nodeType){var o=t.getAttribute("avalon-events")||"";switch(arguments.length){case 1:e._nativeUnBind(t,n,X),t.removeAttribute("avalon-events");break;case 2:o=o.split(",").filter(function(e){return e.indexOf(n+":")===-1}).join(","),t.setAttribute("avalon-events",o);break;default:var a=n+":"+r.uuid;o=o.split(",").filter(function(e){return e!==a}).join(","),t.setAttribute("avalon-events",o),delete e.eventListeners[r.uuid]}}else e._nativeUnBind(t,n,r)};var Rr={},qr=/^e/,Yr=!1,Ur={focus:!0,blur:!0},Wr=/^[A-Z_]+$/;if(G.prototype={fixEvent:function(){},preventDefault:function(){var e=this.originalEvent||{};e.returnValue=this.returnValue=!1,e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent||{};e.cancelBubble=this.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){Yr=!0,this.stopPropagation()},toString:function(){return"[object Event]"}},"onmouseenter"in Un||e.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){Zn[e]={type:t,fix:function(t,n){return function(r){var o=r.relatedTarget;if(!o||o!==t&&!(16&t.compareDocumentPosition(o)))return delete r.type,r.type=e,n.apply(this,arguments)}}}}),e.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){qn[e]&&!Zn.animationend&&(Zn.animationend={type:t})}),void 0===Yn.onmousewheel){var Zr=void 0!==Yn.onwheel?"wheel":"DOMMouseScroll",Xr="wheel"===Zr?"deltaY":"detail";Zn.mousewheel={type:Zr,fix:function(e,t){return function(n){var r=n[Xr]>0?-120:120;return n.wheelDelta=~~e._ms_wheel_+r,e._ms_wheel_=n.wheelDeltaY=n.wheelDelta,n.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(n,"type",{value:"mousewheel"}),t.apply(this,arguments)}}}}Wn||(delete Br.change,delete Br.select),e._nativeBind=Wn?function(e,t,n,r){e.addEventListener(t,n,r)}:function(e,t,n){e.attachEvent("on"+t,n)},e._nativeUnBind=Wn?function(e,t,n){e.removeEventListener(t,n)}:function(e,t,n){e.detachEvent("on"+t,n)},e.fireDom=function(t,n,r){if(Yn.createEvent){var o=Yn.createEvent("Events");o.initEvent(n,!0,!0,r),e.shadowCopy(o,r),
t.dispatchEvent(o)}else Un.contains(t)&&(o=Yn.createEventObject(),e.shadowCopy(o,r),t.fireEvent("on"+n,o))};var Kr=/^(?:mouse|contextmenu|drag)|click/;G.prototype.fixEvent=function(){var e=this;if(null==this.which&&0===e.type.indexOf("key"))this.which=null!=e.charCode?e.charCode:e.keyCode;else if(Kr.test(e.type)&&!("pageX"in this)){var t=e.target.ownerDocument||Yn,n="BackCompat"===t.compatMode?t.body:t.documentElement;this.pageX=e.clientX+(n.scrollLeft>>0)-(n.clientLeft>>0),this.pageY=e.clientY+(n.scrollTop>>0)-(n.clientTop>>0),this.wheelDeltaY=this.wheelDelta,this.wheelDeltaX=0}},"oninput"in Yn.createElement("input")||(Zn.input={type:"propertychange",fix:function(e,t){return function(e){if("value"===e.propertyName)return e.type="input",t.apply(this,arguments)}}});var Gr={area:1,base:1,basefont:1,bgsound:1,br:1,col:1,command:1,embed:1,frame:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},Jr=/input|textarea|select/i,Qr=/^\:/;e.scan=function(t){return t&&t.nodeType?void ne([t]):void e.warn("[avalon.scan] first argument must be element , documentFragment, or document")},e._hydrate=J;var eo,to=!0,no=[],ro=function(t){for(eo=!0;t=no.shift();)t(e)};e.ready=function(t){eo?t(e):no.push(t)},e.ready(function(){e.scan(Yn.body)}),new function(){function t(){try{Un.doScroll("left"),ro()}catch(e){setTimeout(t)}}if(e.inBrowser){if("complete"===Yn.readyState)setTimeout(ro);else if(Yn.addEventListener)Yn.addEventListener("DOMContentLoaded",ro);else if(Yn.attachEvent){Yn.attachEvent("onreadystatechange",function(){"complete"===Yn.readyState&&ro()});try{var n=null===qn.frameElement}catch(e){}Un.doScroll&&n&&qn.external&&t()}e.bind(qn,"load",ro)}};var oo={};ae.adjust=oe;var ao=e.oneObject("$id,$render,$track,$element,$watch,$fire,$events,$skipArray,$accessors,$hashcode,$run,$wait,__proxy__,__data__,__const__"),io={set:function(e,t){if(e>>>0===e&&this[e]!==t){if(e>this.length)throw Error(e+"set方法的第一个参数不能大于原数组长度");this.splice(e,1,t)}},contains:function(e){return this.indexOf(e)!==-1},ensure:function(e){return this.contains(e)||this.push(e),this},pushArray:function(e){return this.push.apply(this,e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>>>0===e?this.splice(e,1):[]},clear:function(){return this.removeAll(),this}},so=Array.prototype,co=so.splice;io.removeAll=function(e){var t=this.length;if(Array.isArray(e))for(var n=this.length-1;n>=0;n--)e.indexOf(this[n])!==-1&&co.call(this,n,1);else if("function"==typeof e)for(n=this.length-1;n>=0;n--){var r=this[n];e(r,n)&&co.call(this,n,1)}else co.call(this,0,this.length);oo.toModel(this),le(this,t),this.notify()};var lo=["push","pop","shift","unshift","splice"];lo.forEach(function(e){var t=so[e];io[e]=function(n,r){var o=[],a=this.length;if("splice"===e&&Object(this[0])===this[0])for(var i=this.slice(n,r),s=so.slice.call(arguments,2),o=[n,r],c=0,l=s.length;c<l;c++){var u=i[c];o[c+2]=oo.modelAdaptor(s[c],u,u&&u.$events||{},{id:this.$id+".*",master:!0})}else for(var d=0,f=arguments.length;d<f;d++)o[d]=oo.modelAdaptor(arguments[d],0,{},{id:this.$id+".*",master:!0});var p=t.apply(this,o);return oo.toModel(this),le(this,a),this.notify(),p}}),"sort,reverse".replace(/\w+/g,function(e){io[e]=function(){return so[e].apply(this,arguments),oo.toModel(this),this.notify(),this}});var uo=/function|window|date|regexp|element/i;oo.isSkip=ue,oo.modelAdaptor=de,oo.makeAccessor=fe,e.define=function(t){var n=t.$id;if(n||e.warn("vm.$id must be specified"),e.vmodels[n])throw Error("error:["+n+"] had defined!");var r=oo.masterFactory(t,{},{pathname:"",id:n,master:!0});return e.vmodels[n]=r},oo.arrayFactory=ve;var fo=/([^.]+)\.(.+)/;oo.$$skipArray=ao;var po=!0;try{Object.defineProperty({},"_",{value:"x"})}catch(e){po=!1}oo.canHideProperty=po,oo.toJson=ge,oo.toModel=function(t){e.modern||(t.$model=ge(t))},oo.hideProperty=_e;var vo={get:function(){return ge(this)},set:e.noop,enumerable:!1,configurable:!0};oo.modelAccessor=vo,oo.initViewModel=be;var mo,ho=Object.defineProperties,yo=new Date-0;if(!po&&("__defineGetter__"in e&&(mo=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},ho=function(e,t){for(var n in t)t.hasOwnProperty(n)&&mo(e,n,t[n]);return e}),e.msie<9)){var go={};Tn.execScript(["Function parseVB(code)","\tExecuteGlobal(code)","End Function"].join("\n"),"VBScript");var _o=function(e,t,n,r){var o=t[n];return 4!==arguments.length?o.get.call(e):void o.set.call(e,r)};ho=function(t,n,r){var o=[];o.push("\r\n\tPrivate [__data__], [__proxy__]","\tPublic Default Function [__const__](d"+yo+", p"+yo+")","\t\tSet [__data__] = d"+yo+": set [__proxy__] = p"+yo,"\t\tSet [__const__] = Me","\tEnd Function");var a={__proxy__:!0,__data__:!0,__const__:!0};for(t in n)a[t]||ao[t]||(a[t]=!0,o.push("\tPublic Property Let ["+t+"](val"+yo+")",'\t\tCall [__proxy__](Me,[__data__], "'+t+'", val'+yo+")","\tEnd Property","\tPublic Property Set ["+t+"](val"+yo+")",'\t\tCall [__proxy__](Me,[__data__], "'+t+'", val'+yo+")","\tEnd Property","\tPublic Property Get ["+t+"]","\tOn Error Resume Next","\t\tSet["+t+'] = [__proxy__](Me,[__data__],"'+t+'")',"\tIf Err.Number <> 0 Then","\t\t["+t+'] = [__proxy__](Me,[__data__],"'+t+'")',"\tEnd If","\tOn Error Goto 0","\tEnd Property"));for(t in r)a[t]||ao[t]||(a[t]=!0,o.push("\tPublic ["+t+"]"));for(t in ao)a[t]||o.push("\tPublic ["+t+"]");o.push("\tPublic [hasOwnProperty]"),o.push("End Class");var i=o.join("\r\n"),s=go[i];s||(s=e.makeHashCode("VBClass"),Tn.parseVB("Class "+s+i),Tn.parseVB(["Function "+s+"Factory(a, b)","\tDim o","\tSet o = (New "+s+")(a, b)","\tSet "+s+"Factory = o","End Function"].join("\r\n")),go[i]=s);var c=Tn[s+"Factory"](n,_o);return c}}oo.createViewModel=ho;var bo=oo.isSkip,wo=oo.$$skipArray;oo.canHideProperty&&(delete wo.$accessors,delete wo.__data__,delete wo.__proxy__,delete wo.__const__);var xo=oo.makeAccessor,$o=oo.modelAccessor,Co=oo.createViewModel,Eo=oo.initViewModel,Ao=e.makeHashCode;oo.masterFactory=Ce;var ko={};oo.slaveFactory=Ee,e.mediatorFactory=Ae,e.directive("important",{priority:1,parse:function(e,t,n){var r=Rn(n.expr);e.local="{}",e.vmodel="__vmodel__",e[n.name]=1,t.$prepend=["(function(__top__){","var __i = avalon.scopes["+r+"]","var ok = !__i || __i.vmodel === __top__","if( !ok ){",'vnodes.push({skipContent:true,nodeName:"'+e.nodeName+'"})','avalon.log("不进入"+'+r+");return }","var __vmodel__ = avalon.vmodels["+r+"];"].join("\n")+"\n",t.$append="\n})(__vmodel__);"},diff:function(e,t,n){t.dynamic[n]||(t.local=e.local,t.vmodel=e.vmodel,ke(t,this.update))},update:function(t,n,r){e.directives.controller.update(t,n,r,"important")}});var To={};e.mediatorFactoryCache=function(t,n){var r=e.vmodels[n];if(r&&t&&r!==t){var o=t.$hashcode,a=r.$hashcode,i=o+a;if(To[i])return To[i];var s=e.mediatorFactory(t,r);return To[i]=s}return t},e.directive("controller",{priority:2,parse:function(e,t,n){var r=Rn(n.expr);e.local="__local__",e.vmodel="__vmodel__",e[n.name]=1,t.$prepend="(function(__top__){\nvar __vmodel__ = avalon.mediatorFactoryCache(__top__,"+r+")\n",t.$append="\n})(__vmodel__);"},diff:function(e,t,n){t.dynamic[n]||(t.local=e.local,t.vmodel=e.vmodel,ke(t,this.update))},update:function(t,n,r,o){var a=n.vmodel,i=n.local,s=o?"ms-important":"ms-controller";n.dynamic[s]=1;var c=n.props[s],l=e.scopes[c];if(!l){var u=e.vmodels[c];if(a.$element&&a.$element.vtree[0]===n)var d=a.$render;else d=e.render([n],i);a.$render=d,a.$element=t,t.vtree=[n],u!==a&&(u.$render=u.$render||d,u.$element=u.$element||t);var f=o?a:u,l=e.scopes[c]={vmodel:a,local:i};ke(n,function(){e(t).removeClass("ms-controller"),t.setAttribute("wid",c),e._disposeComponent&&e._disposeComponent(t);var n=f.$events.onReady;n&&(f.$fire("onReady"),delete f.$events.onReady),l.isMount=!0},"afterChange")}}});var No=e.directive("css",{diff:function(t,n,r){var o=t[r],a=n[r];if(Object(o)===o){if(o=o.$model||o,Array.isArray(o)){var i={};o.forEach(function(t){t&&e.shadowCopy(i,t)}),o=i}var s=!1;if(n.dynamic[r]&&a){var c={};for(var l in o)o[l]!==a[l]&&(s=!0),c[l]=o[l];for(var l in a)l in c||(s=!0,c[l]="");n[r]=c}else n[r]=o,s=!0;s&&("ms-effect"===r&&(n[r]=o),ke(n,this.update))}delete t[r]},update:function(t,n){if(t&&1===t.nodeType){var r=e(t);n.dynamic["ms-css"]=1;var o=n["ms-css"];for(var a in o)r.css(a,o[a])}}}),Oo=No.diff;e.directive("attr",{diff:Oo,update:q});var Mo="none";e.parseDisplay=Te,e.directive("visible",{diff:function(e,t,n){var r=!!e[n];t.dynamic[n]&&r===t[n]||(t[n]=r,ke(t,this.update))},update:function(t,n){if(t&&1===t.nodeType){n.dynamic["ms-visible"]=1;var r,o=n["ms-visible"],a=t.style.display;o?(a===Mo&&(r=n.displayValue,r||(t.style.display="")),""===t.style.display&&e(t).css("display")===Mo&&e.contains(t.ownerDocument,t)&&(r=Te(t))):a!==Mo&&(r=Mo,n.displayValue=a);var i=function(){void 0!==r&&(t.style.display=r)};e.applyEffect(t,n,{hook:o?"onEnterDone":"onLeaveDone",cb:i})}}}),e.directive("expr",{parse:e.noop}),e.directive("text",{parse:function(t,n,r){t[r.name]=1,n.children=[],t.children='[{\nnodeName:"#text",\ndynamic:true,\nnodeValue:avalon.parsers.string('+e.parseExpr(r)+")}]"},diff:function(e,t){t.children.length||ke(t,this.update)},update:function(e,t){if(e&&!t.isVoidTag){for(var n=e;n.firstChild;)n.removeChild(n.firstChild);var e=document.createTextNode("x");n.appendChild(e);var r={nodeType:3,nodeName:"#text",dom:e};t.children.push(r)}}}),e.directive("html",{parse:function(t,n,r){n.isVoidTag?t.children="[]":(t[r.name]=e.parseExpr(r),t.vmodel="__vmodel__",t.local="__local__")},diff:function(t,n,r){var o=t[r]+"";if(n.dynamic["ms-html"]&&n.render&&o===n[r]){if(n.render){var a=n.render(t.vmodel,t.local);t.children=a}}else{n[r]=o;var i=e.speedUp(e.lexer(o)),s=e.render(i,t.local);n.render=s;var a=s(t.vmodel,t.local);n.children=t.children=a,ke(n,this.update)}},update:function(t,n){n.dynamic["ms-html"]=1,e.clearHTML(t),t.appendChild(e.domize(n.children))}}),e.directive("class",{diff:function(e,t,n){var r=n.slice(3),o=e[n],a=t[n]||"",i=t.classEvent||{};"hover"===r?(i.mouseenter=Oe,i.mouseleave=Me):"active"===r&&(t.props.tabindex=e.props.tabindex||-1,i.tabIndex=t.props.tabindex,i.mousedown=Oe,i.mouseup=Me,i.mouseleave=Me),t.classEvent=i;var s=Ne(o);t.dynamic[n]&&a===s||(t[n]=s,t["change-"+r]=s,ke(t,this.update,r))},update:function(t,n){if(t&&1===t.nodeType){var r=n.classEvent;if(r){for(var o in r)"tabIndex"===o?t[o]=r[o]:e.bind(t,o,r[o]);n.classEvent={}}var a=["class","hover","active"];a.forEach(function(r){var o="change-"+r,a=n[o];if(void 0!==a)if(n.dynamic["ms-"+r]=1,"class"===r)t&&je(t,n);else{var i=t.getAttribute("change-"+r);i&&e(t).removeClass(i),t.setAttribute(o,a)}})}}}),Bn.active=Bn.hover=Bn.class;var jo={mouseenter:"change-hover",mouseleave:"change-hover",mousedown:"change-active",mouseup:"change-active"};d(Oe),d(Me);var So=/^ms\-on\-(\w+)/;e.directive("on",{priority:3e3,parse:function(t,n,r){var o=r.name.replace("ms-on-","e").replace("-","_"),a=o+"_"+r.expr.replace(/\s/g,"").replace(/[^$a-z]/gi,function(e){return e.charCodeAt(0)}),i=e.quote(a),s="(function(){\nvar fn610 = "+e.parseExpr(r)+"\nfn610.uuid ="+i+";\nreturn fn610})()";t.vmodel="__vmodel__",t.local="__local__",t[r.name]=s},diff:function(t,n,r){var o=t[r],a=o.uuid,i=n[r]||{},s=!1;n.dynamic[r]&&i.uuid===a||(n[r]=o,e.eventListeners[a]=o,s=!0),Se(n.local||{},t.local)&&(s=!0),s?(n.local=t.local,n.vmodel=t.vmodel,ke(n,this.update)):n.dom&&(n.dom._ms_local=t.local)},update:function(t,n){if(t&&1===t.nodeType){var r,o;t._ms_context_=n.vmodel,t._ms_local=n.local;for(r in n){var a=r.match(So);a&&(o=n[r],n.dynamic[r]=1,e.bind(t,a[1],o))}}}});var Do=e.oneObject("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile");e.keyMap=Do;var Lo={nodeName:1,forExpr:1,type:1,template:1,nodeValue:1,signature:1,wid:1},Vo=/[W\:-]/,Fo={input:function(e){var t=this;e=e||"value";var n=t.dom,r=n[e],o=t.parse(r);t.value=r,t.set(t.vmodel,o),Ve(t);var a=t.pos;n.caret&&t.setCaret(n,a)},radio:function(){var e=this;if(e.isChecked){var t=!e.value;e.set(e.vmodel,t),Ve(e)}else Fo.input.call(e),e.value=NaN},checkbox:function(){var t=this,n=t.value;Array.isArray(n)||(e.warn("ms-duplex应用于checkbox上要对应一个数组"),n=[n]);var r=t.dom.checked?"ensure":"remove";if(n[r]){var o=t.parse(t.dom.value);n[r](o),Ve(t)}},select:function(){var t=this,n=e(t.dom).val();n+""!=this.value+""&&(n=Array.isArray(n)?n.map(function(e){return t.parse(e)}):t.parse(n),t.set(t.vmodel,n),Ve(t))},contenteditable:function(){Fo.input.call(this,"innerHTML")}},Ho=e.msie;f(Be),f(ze),f(Re),f(qe),f(Fe),f(Pe),f(Ie),f(Ye);var Po=function(e){setTimeout(e,0)},Io=function(e,t){var n;e.createTextRange?Po(function(){e.focus(),n=e.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}):(e.focus(),void 0!==e.selectionStart&&e.setSelectionRange(t,t))},Bo=function(e){var t,n,r,o,a,i=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?i=e.selectionStart:(n=Yn.selection.createRange(),n&&n.parentElement()==e&&(o=e.value.length,t=e.value.replace(/\r\n/g,"\n"),r=e.createTextRange(),r.moveToBookmark(n.getBookmark()),a=e.createTextRange(),a.collapse(!1),r.compareEndPoints("StartToEnd",a)>-1?i=o:(i=-r.moveStart("character",-o),i+=t.slice(0,i).split("\n").length-1))),i},zo=!1;try{var Ro={},qo=HTMLInputElement.prototype,Yo=HTMLTextAreaElement.prototype,Uo=function(e){Ro[this.tagName].call(this,e);var t=this.__ms_duplex__;!this.caret&&t&&t.isString&&t.update.call(this,{type:"setter"})},Wo=HTMLInputElement.prototype;Object.getOwnPropertyNames(Wo),Ro.INPUT=Object.getOwnPropertyDescriptor(qo,"value").set,Object.defineProperty(qo,"value",{set:Uo}),Ro.TEXTAREA=Object.getOwnPropertyDescriptor(Yo,"value").set,Object.defineProperty(Yo,"value",{set:Uo}),zo=!0}catch(e){}var Zo={input:function(){this.dom.value=this.value},radio:function(){var t;t=this.isChecked?!!this.value:this.value+""===this.dom.value;var n=this.dom;6===e.msie?setTimeout(function(){n.defaultChecked=t,n.checked=t},31):n.checked=t},checkbox:function(){for(var e=!1,t=this.dom,n=t.value,r=0;r<this.value.length;r++){var o=this.value[r];o+""===n&&(e=!0)}t.checked=e},select:function(){var t=Array.isArray(this.value)?this.value.map(String):this.value+"";e(this.dom).val(t)},contenteditable:function(){this.dom.innerHTML=this.value,this.update.call(this.dom)}},Xo=/\|\s*change\b/,Ko=/^(?:checkbox|radio)$/,Go=/\|\s*debounce(?:\(([^)]+)\))?/,Jo="ms-duplex";e.directive("duplex",{priority:2e3,parse:function(t,n,r){var o,a=r.expr,i=n.props.type,s=r.param,c=!1;s=s?s.split("-").map(function(e){return"checked"===e&&(c=!0),e}):[],Ko.test(i)&&c&&(s=[],o="radio"),/input|textarea|select/.test(n.nodeName)?o||(o="select"===n.nodeName?"select":"checkbox"===i?"checkbox":"radio"===i?"radio":"input"):"contenteditable"in n.props&&(o="contenteditable");var l=!1,u=0;if("input"===o||"contenteditable"===o){var d=!0;if(Xo.test(a)&&(l=!0),!l){var f=a.match(Go);f&&(u=parseInt(f[1],10)||300)}}var p=t.props["data-duplex-changed"],v=e.parseExpr(r),m=s.map(function(t){return e.quote(t)});t[Jo]=Le({type:o,vmodel:"__vmodel__",local:"__local__",debug:e.quote(r.name+"="+r.expr),isChecked:c,parsers:"["+m+"]",isString:!!d,isChanged:l,debounceTime:u,get:v,set:e.evaluatorPool.get("duplex:set:"+a),callback:p?e.parseExpr({expr:p,type:"on"}):"avalon.noop"})},diff:function(e,t){if(t.dynamic[Jo])n=t[Jo];else{var n=t[Jo]=e[Jo];n.parse=We}e!==t&&(e[Jo]=null);var r=n.get(n.vmodel),o=n.value;if(n.isString){if(r=n.parse(r),r+="",r===o)return}else if(Array.isArray(r)){var a=!0;if(r+""===n.arrayHack)return}n.value=r,a&&(n.arayHack=r+""),ke(t,this.update,"afterChange")},update:function(t,n){if(t&&1===t.nodeType){n.dynamic[Jo]=1,t.__ms_duplex__||(t.__ms_duplex__=e.mix(n[Jo],{dom:t}),He(t,n),Ue(t,n));var r=t.__ms_duplex__;if(r.dom=t,r.isString&&!e.msie&&zo===!1&&!t.valueHijack){t.valueHijack=Fe;var o=setInterval(function(){e.contains(e.root,t)?t.valueHijack({type:"poll"}):clearInterval(o)},30)}Zo[r.type].call(r)}}});var Qo=e.directive("validate",{diff:function(e,t,n){var r=e[n],o=t[n];if(!(o&&o.onError&&o.addField)&&Object(r)===r){t.vmValidator=r,r.$id&&(r=r.$model),t[n]=r;for(var n in Qo.defaults)r.hasOwnProperty(n)||(r[n]=Qo.defaults[n]);r.fields=r.fields||[],ke(t,this.update)}},update:function(t,n){function r(){Qo.validateAll.call(o,o.onValidateAll)}var o=n["ms-validate"];t._ms_validator_=o,o.dom=t;var a=n.vmValidator;try{a.onManual=r}catch(e){}delete n.vmValidator,t.setAttribute("novalidate","novalidate"),o.validateAllInSubmit&&e.bind(t,"submit",function(e){e.preventDefault(),r()}),"function"==typeof o.onInit&&o.onInit.call(t,{type:"init",target:t,validator:o})},validateAll:function(e){var t=this,n="function"==typeof e?e:t.onValidateAll,r=t.fields.filter(function(e){var n=e.dom;return n&&!n.disabled&&t.dom.contains(n)}).map(function(e){return Qo.validate(e,!0)});return Promise.all(r).then(function(e){var r=e.concat.apply([],e);if(t.deduplicateInValidateAll){var o={};r=r.filter(function(e){var t=e.element,n=t.uniqueID||(t.uniqueID=setTimeout("1"));return!o[n]&&(o[n]=!0)})}n.call(t.dom,r)})},addField:function(t){var n=this,r=t.dom;!n.validateInKeyup||t.isChanged||t.debounceTime||e.bind(r,"keyup",function(e){Qo.validate(t,0,e)}),n.validateInBlur&&e.bind(r,"blur",function(e){Qo.validate(t,0,e)}),n.resetInFocus&&e.bind(r,"focus",function(e){n.onReset.call(r,e,t)})},validate:function(t,n,r){var o=[],a=t.value,i=t.dom,s=t.validator;if("function"!=typeof Promise&&e.error("please npm install avalon-promise or bluebird"),!i.disabled){var c=t.rules;if(!c.norequired||""!==a)for(var l in c){var u=c[l];if(u!==!1){var d,f,p=e.validators[l];o.push(new Promise(function(e,t){d=e,f=t}));var v=function(e){if(e)d(!0);else{var n={element:i,data:t.data,message:i.getAttribute("data-"+l+"-message")||i.getAttribute("data-message")||p.message,validateRule:l,getMessage:Ze};d(n)}};t.data={},t.data[l]=u,p.get(a,t,v)}}return Promise.all(o).then(function(e){var t=e.filter(function(e){return"object"==typeof e});return n||(t.length?s.onError.call(i,t,r):s.onSuccess.call(i,t,r),s.onComplete.call(i,t,r)),t})}}}),ea=/\\?{{([^{}]+)\}}/gm;Qo.defaults={addField:Qo.addField,onError:e.noop,onSuccess:e.noop,onComplete:e.noop,onManual:e.noop,onReset:e.noop,onValidateAll:e.noop,validateInBlur:!0,validateInKeyup:!0,validateAllInSubmit:!0,resetInFocus:!0,deduplicateInValidateAll:!1},e.directive("rules",{diff:function(e,t,n){var r=e[n];if(r&&"[object Object]"===Object.prototype.toString.call(r)){t[n]=r.$model||r;var o=t.dom&&t.dom.__ms_duplex__;o&&(o.rules=e[n])}}});var ta=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,na=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;e.shadowCopy(e.validators,{pattern:{message:"必须匹配{{pattern}}这样的格式",get:function(e,t,n){var r=t.dom,o=t.data;if(!Xe(o.pattern)){var a=r.getAttribute("pattern");o.pattern=new RegExp("^(?:"+a+")$")}return n(o.pattern.test(e)),e}},digits:{message:"必须整数",get:function(e,t,n){return n(/^\-?\d+$/.test(e)),e}},number:{message:"必须数字",get:function(e,t,n){return n(!!e&&isFinite(e)),e}},norequired:{message:"",get:function(e,t,n){return n(!0),e}},required:{message:"必须填写",get:function(e,t,n){return n(""!==e),e}},equalto:{message:"密码输入不一致",get:function(t,n,r){var o=String(n.data.equalto),a=e(document.getElementById(o)).val()||"";return r(t===a),t}},date:{message:"日期格式不正确",get:function(e,t,n){var r=t.data;return n(Xe(r.date)?r.date.test(e):Ke(e)),e}},url:{message:"URL格式不正确",get:function(e,t,n){return n(na.test(e)),e}},email:{message:"email格式不正确",get:function(e,t,n){return n(ta.test(e)),e}},minlength:{message:"最少输入{{minlength}}个字",get:function(e,t,n){var r=parseInt(t.data.minlength,10);return n(e.length>=r),e}},maxlength:{message:"最多输入{{maxlength}}个字",get:function(e,t,n){var r=parseInt(t.data.maxlength,10);return n(e.length<=r),e}},min:{message:"输入值不能小于{{min}}",get:function(e,t,n){var r=parseInt(t.data.min,10);return n(parseFloat(e)>=r),e}},max:{message:"输入值不能大于{{max}}",get:function(e,t,n){var r=parseInt(t.data.max,10);return n(parseFloat(e)<=r),e}},chs:{message:"必须是中文字符",get:function(e,t,n){return n(/^[\u4e00-\u9fa5]+$/.test(e)),e}}}),e.directive("if",{priority:6,diff:function(e,t,n,r,o,a){var i=!!e[n];t[n]=i,ke(t,this.update)},update:function(t,n,r){var o=n["ms-if"];if(n.dynamic["ms-if"]&&(n.dynamic["ms-if"]=n.nodeName),o){if("#comment"===n.nodeName){n.nodeName=n.dynamic["ms-if"],delete n.nodeValue;var a=n.comment;if(!a)return;r=a.parentNode,r&&r.replaceChild(t,a),delete n.comment,e.applyEffect(t,n,{hook:"onEnterDone"})}}else n.comment||(n.comment=document.createComment("if")),n.nodeName="#comment",n.nodeValue="if",e.applyEffect(t,n,{hook:"onLeaveDone",cb:function(){(r&&11!==r.nodeType||(r=t.parentNode,r&&11!==r.nodeType))&&r.replaceChild(n.comment,t)}})}});var ra=/\s+as\s+([$\w]+)/,oa=/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,aa=/^(null|undefined|NaN|window|this|\$index|\$id)$/,ia=/[$\w_]+/g;e._each=function(e,t,n,r){var o=[];r.push(o);var a=(t+"").slice(0,40).match(ia);if(a.shift(),Array.isArray(e))for(var i=0;i<e.length;i++)Je(i,e[i],n,t,a[0],a[1],o,!0);else for(var i in e)e.hasOwnProperty(i)&&Je(i,e[i],n,t,a[0],a[1],o)},e.directive("for",{priority:3,parse:function(t,n){var r,o=n.forExpr;o=o.replace(ra,function(t,n){return!oa.test(n)||aa.test(n)?e.error("alias "+n+" is invalid --- must be a valid JS identifier which is not a reserved name."):r=n,""});var a=o.split(" in "),i={expr:a[1].trim(),type:"for"},s=e.parseExpr(i),c=(a[0]+" traceKey __local__ vnodes").match(ia);4===c.length&&c.unshift("$key"),n.$append=Array("var loop = "+s+";","avalon._each(loop, function("+c+"){","__local__["+Rn(r||"valueOf")+"] = loop","vnodes.push({",'\tnodeName: "#document-fragment",',"\tindex   : arguments[0],","\tkey     : traceKey,","\tchildren: new function(){\nvar vnodes = []\n").join("\n")},diff:function(t,n,r,o,a){if(!e.callArray||!n.list||n.forExpr.indexOf(e.callArray)!==-1){var i,s,c,l=o[a+1],u=r[a+1],d=r[a+2],f=n.cache||{},p=[];if(l.length)if(l===u){u.forEach(function(e){e.action="move",nt(f,e)}),n.cache=f;var v=!0}else{n.action="update";var m={},h=[];for(i=0;s=u[i];i++){var c=tt(f,s.key);c?(c.oldIndex=c.index,c.index=s.index,nt(m,c)):h.push(s)}for(var s,i=0;s=h[i];i++)c=et(f,s.key),c?(c.oldIndex=c.index,c.index=s.index,c.key=s.key):(c=s,l.push(c)),nt(m,c);l.sort(function(e,t){return e.index-t.index}),n.cache=m;for(var i in f)c=f[i],c.action="leave",e.Array.remove(l,c),p.push(c),c.arr&&(c.arr.forEach(function(e){e.action="leave",p.push(e)}),delete c.arr)}else n.action="init",o[a+1]=u,u.forEach(function(e,t){l[t]=e,nt(f,e)}),n.cache=f;p.length>1&&p.sort(function(e,t){return e.index-t.index}),n.removes=p;var y=e.caches[n.wid],g=t.vmodel;return d&&y&&(d.afterChange=[function(e){y.call(g,{type:"rendered",target:e,signature:n.signature})}]),v||(n.list=l,ke(n,this.update)),!0}},update:function(t,n,r){if("init"===n.action){var o=r;r=document.createDocumentFragment()}for(var a,i=t,s=n.signature,c=0;a=n.removes[c++];)a.dom&&(delete a.split,n.hasEffect?!function(e){var t=Qe(e),n=e.children.concat();e.children.length=0,sa(t,n,{hook:"onLeaveDone",staggerKey:s+"leave",cb:function(e){e.parentNode&&e.parentNode.removeChild(e)}})}(a):Qe(a,"add"));n.list.forEach(function(t,o){if("leave"!==t.action){t.dom||(t.dom=e.domize(t));var a=t.dom;if(void 0===t.oldIndex){if(n.hasEffect)var c=e.slice(a.childNodes);0===o&&"init"===n.action?r.appendChild(a):r.insertBefore(a,i.nextSibling),n.hasEffect&&sa(c,t.children,{hook:"onEnterDone",staggerKey:s+"enter"})}else if(t.index!==t.oldIndex){var c=Qe(t,"add");r.insertBefore(t.dom,i.nextSibling),n.hasEffect&&sa(c,t.children,{hook:"onMoveDone",staggerKey:s+"move"})}i=t.split}}),"init"===n.action&&o.insertBefore(r,t.nextSibling)}});var sa=function(t,n,r){n.forEach(function(n,o){e.applyEffect(t[o],n,r)})},ca=rt(e.cssName("transition-duration"),e.cssName("animation-duration"),e.window);e.directive("effect",{priority:5,diff:function(t,n,r){var o=t[r];"string"==typeof o&&(t[r]={is:o},e.warn("ms-effect的指令值不再支持字符串,必须是一个对象")),Oo.call(this,t,n,r,"afterChange")},update:function(t,n,r,o){if(t&&1===t.nodeType){var a="ms-effect",i=n[a]||o||{};n.dynamic[a]=1;var s=i.is;if(!s)return e.warn("need is option");var c=e.effects;ca.css&&!c[s]&&e.effect(s);var l=c[s];if(!l)return e.warn(s+" effect is undefined");var u={},d=i.action;"boolean"==typeof d&&(u.action=d?"enter":"leave");var f=e.Effect,p=new f(t);e.mix(u,l,i),t.animating=u.action,u.queue?(la.push(function(){p[d](u)}),ot()):setTimeout(function(){p[d](u)},4)}}});var la=[];e.effect=function(t,n){var r=e.effects[t]=n||{};ca.css&&r.css!==!1&&(at(r,"enterClass",t+"-enter"),at(r,"enterActiveClass",r.enterClass+"-active"),at(r,"leaveClass",t+"-leave"),at(r,"leaveActiveClass",r.leaveClass+"-active")),at(r,"action","enter")};var ua=function(e){this.el=e};e.Effect=ua,ua.prototype={enter:ct("Enter"),leave:ct("Leave"),move:ct("Move")};var da=/\d+s$/,fa=new u(128);e.applyEffect=function(t,n,r){var o=r.cb,a=n["ms-effect"];if(a&&t&&1===t.nodeType){var i=r.hook,s=a[i];o&&(Array.isArray(s)?s.push(o):s?a[i]=[s,o]:a[i]=[o]),lt(r),e.directives.effect.update(t,n,0,e.shadowCopy({},r))}else o&&o(t)};var pa=0,va={map:{}},ma=/\?\?\d+/g,ha=/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,ya=e.oneObject("script,style,textarea,xmp,noscript,option,template"),ga=/^<([-A-Za-z0-9_]+)\s*([^>]*?)(\/?)>/,_a=/^<\/([^>]+)>/,ba=/\S/,wa=/[\n\r]s*/g,xa=/([^=\s]+)(?:\s*=\s*(\S+))?/,$a=function(){return{children:[],props:{}}},Ca=/^ms-(\w+)-?(.*)/,Ea=[],Aa=!1;e.suspendUpdate=0;var ka=/^(\:|ms\-)\w+/,Ta=e.oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),Na=e.config,Oa=e.quote,Ma=/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,ja=/^\s*var\s+([$\w]+)\s*\=\s*\S+/,Sa={__local__:1,vmode:1,dom:1},Da=/\n\s*/g,La=/^\s*ms\-for\:\s*/,Va=/^\s*ms\-for\-end/,Fa=function(t){for(var n=[],r=!1,o=0;o<t.length;o++){var a=t[o],i="#comment"===a.nodeName;if(i&&La.test(a.nodeValue)){r=!0,n.push(a);var s=n;n=[],n.list=s,n.start=a}else if(i&&Va.test(a.nodeValue)){var s=n;n=s.list;var c=s.start;delete s.list,delete s.start,n.push(s,a),a.dynamic=!0;var l=c.signature||(c.signature=e.makeHashCode("for"));if(a.signature=l,c.forExpr=c.nodeValue.replace(La,""),1===s.length){var u=s[0];if(u.props){u.props.slot&&(c.props='{slot: "'+u.props.slot+'"}');var d=u.props["data-for-rendered"];if(d){delete u.props["data-for-rendered"];var f=d+":cb";e.caches[f]||(e.caches[f]=Function("return "+e.parseExpr({type:"on",expr:d}))()),c.wid=f}}}for(var p=0;p<s.length;p++){var a=s[p],v=a.dom;v&&v.parentNode&&v.parentNode.removeChild(v)}c.hasEffect=Ht(s),Fa(s),e.caches[l]||(e.caches[l]=Tt(s,!0)),s.length=0}else Vt(a)&&(r=!0),n.push(a)}return t.length=0,t.push.apply(t,n),r},Ha=e.evaluatorPool,Pa=/\(([^)]*)\)/,Ia=/\|\|/g,Ba=/\|(?=\?\?)/,za=/\s*(\.|\|)\s*/g,Ra=/^__vmodel__\.[$\w\.]+$/i,qa=/(^|[^\w\u00c0-\uFFFF_])(@|##)(?=[$\w])/g,Ya=/\.[\w\.\$]+/g,Ua=/[$a-zA-Z_][$a-zA-Z0-9_]*/g,Wa=/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/g;e.lexer=yt,e.diff=xt,e.batch=Et,e.speedUp=Lt,e.parseExpr=Pt;var Za=/\\\\(['"])/g;e.render=qt;var Xa={wbr:1,xmp:1,template:1},Ka="onInit,onReady,onViewChange,onDispose",Ga=e.oneObject(Ka),Ja=Ka.split(",").concat("is","define"),Qa=!0;e.insertSlots=function(t,n){for(var r,o=0;r=t[o];o++)if("#comment"===r.nodeName&&n[r.type]){var a=[o+1,0].concat(n[r.type]);t.splice.apply(t,a),o+=n[r.type].length}else r.children&&e.insertSlots(r.children,n)},e.collectSlots=function(e,t){var n={};return t?(n[t]=e.children,n.__sole__=t):e.children.forEach(function(t,r){var o=t.props&&t.props.slot;o&&(t.forExpr?n[o]=e.children.slice(r,r+2):Array.isArray(n[o])?n[o].push(t):n[o]=[t])}),n};var ei=/^[a-z]([a-z\d]+\-)+[a-z\d]+$/,ti=/^\w/,ni=[],ri=0;return an.byMutationEvent=nn,an.byRewritePrototype=rn,an.byPolling=on,e._disposeComponent=an,e.component=function(t,n){e.components[t]||(e.components[t]=n)},e.directive("widget",{priority:4,parse:function(t,n,r){n.props.wid=n.props.wid||e.makeHashCode("w"),t[r.name]=e.parseExpr(r),t.template=n.template,t.vmodel="__vmodel__",t.local="__local__"},define:function(){return e.mediatorFactory.apply(this,arguments)},diff:function(t,n,r,o,a,i){var s=t[r];if(Object(s)===s){var c=n.props.is||(/^ms\-/.test(n.nodeName)?n.nodeName:0);c||(s=s.$model||s,Array.isArray(s)&&(s.unshift({}),e.mix.apply(0,s),s=s.shift()),c=s.is);var l="component-vm:"+c;if(n.props.is=c,n.vmodel=t.vmodel,!n[l]&&!Yt(n,t[r],t.local,t.template))return n.nodeValue="unresolved component placeholder",o[i]=n,void ke(n,this.mountComment);var u=n[l],d=e.scopes[u.$id];if(d&&d.vmodel){var f=d.vmodel.$element;if(n.dom!==f){var p=f.vtree[0];return a[i]=o[i]=p,n.com=f,p.skipContent||(p.skipContent="optimize"),ke(n,this.replaceCachedComponent),void ke(p,function(){"optimize"===p.skipContent&&(p.skipContent=!0)},"afterChange")}}var v=u.$render,m=v(u,t.local),p=m[0];p&&cn(p)?(p.local=t.local,Array(l,"component-html:"+c,"component-ready:"+c,"dom","dynamic").forEach(function(e){p[e]=n[e]}),p.vmodel=u,o[i]=p,n.comment&&n.nodeValue&&(p.dom=n.comment),n.nodeName!==p.nodeName?(a[i]=p,ke(p,this.mountComponent)):ke(n,this.updateComponent)):(n.nodeValue="unresolved component placeholder",o[i]={nodeValue:"unresolved component placeholder",nodeName:"#comment"},ke(n,this.mountComment))}else n.props.is===t.props.is&&ke(n,this.updateComponent)},replaceCachedComponent:function(e,t,n){var r=t.com;n.replaceChild(r,e),t.dom=r,delete t.com},mountComment:function(e,t,n){var r=document.createComment(t.nodeValue);t.dom=r,n.replaceChild(r,e)},updateComponent:function(e,t){var n=t["component-vm:"+t.props.is],r=n.$events.onViewChange;r&&r.length&&ke(t,sn,"afterChange")},mountComponent:function(t,n,r){delete n.dom;var o=e.vdom(n,"toDOM"),a=n.props.is,i=n["component-vm:"+a];i.$fire("onInit",{type:"init",vmodel:i,is:a}),r.replaceChild(o,t),n.dom=i.$element=o,o.vtree=[n],e._disposeComponent(o),n["component-ready:"+a]=!0,e.scopes[i.$id]={vmodel:i,top:n.vmodel,local:n.local},ke(n,function(){i.$fire("onReady",{type:"ready",target:o,vmodel:i,is:a})},"afterChange"),ke(n,function(){n["component-html:"+a]=e.vdom(n,"toHTML")},"afterChange")}}),e});
//# sourceMappingURL=avalon.min.js.map