!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("avalon")):"function"==typeof define&&define.amd?define(["avalon"],e):"object"==typeof exports?exports.routergrid=e(require("avalon")):t.routergrid=e(t.avalon)}(this,function(t){return function(t){function e(r){if(a[r])return a[r].exports;var n=a[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}({0:function(t,e,a){var r=a(109);a(113);var n=a(114),o=a(115),i=a(116);a(117);var s=r.define({$id:"main",main:"",aaa:"第一页的内容",bbb:"第二页的内容",ccc:"第三页的内容"}),c={aaa:n,bbb:o,ccc:i};r.router.add("/page-{count:\\d+}",function(t){return"/aaa?"+this.path.slice(1)}),r.router.add("/:tab",function(t){console.log(t,"!!"),s.main=c[t]}),r.history.start({root:"/mmRouter"});var l=location.hash.replace(/#!?/,"");r.router.navigate(l||"/aaa",1),r.ready(function(){r.scan(document.body)})},109:function(e,a){e.exports=t},110:function(t,e,a){function r(t){var e=[],a=this.showPages,r=this.totalPages,n=Math.floor(a/2),o=t-n+1-a%2,i=t+n;o<=0&&(o=1,i=a),i>r&&(o=r-a+1,i=r);for(var s=o;s<=i;)e.push(s),s++;return{currentPage:t,pages:e}}var n=a(109);a(!function(){var t=new Error('Cannot find module "./style.scss"');throw t.code="MODULE_NOT_FOUND",t}()),n.component("ms-pager",{template:a(112),defaults:{getHref:function(t){return"#page-"+this.toPage(t)},getTitle:function(t){return t},isDisabled:function(t,e){return this.$buttons[t]=this.currentPage===e},$buttons:{},showPages:5,pages:[],totalPages:15,currentPage:1,firstText:"First",prevText:"Previous",nextText:"Next",lastText:"Last",onPageClick:n.noop,toPage:function(t){var e=this.currentPage,a=this.totalPages;switch(t){case"first":return 1;case"prev":return Math.max(e-1,0);case"next":return Math.min(e+1,a);case"last":return a;default:return t}},cbProxy:function(t,e){if(this.$buttons[e]||e===this.currentPage)return void t.preventDefault();var a=this.toPage(e);return this.render(a),this.onPageClick(t,e)},render:function(t){var e=r.call(this,t);this.pages=e.pages,this.currentPage=e.currentPage},rpage:/(?:#|\?)page\-(\d+)/,onInit:function(){var t=this.currentPage,e=this.rpage&&location.href.match(this.rpage);if(e&&e[1]){var t=~~e[1];(t<0||t>this.totalPages)&&(t=1)}var a=this;this.$watch("totalPages",function(){setTimeout(function(){a.render(a.currentPage)},4)}),this.render(t)}}})},112:function(t,e){t.exports='<ul class=pagination ms-visible=@totalPages><li class=first ms-class=\'{disabled: @isDisabled("first", 1)}\'><a ms-attr=\'{href:@getHref("first"),title:@getTitle("first")}\' ms-click=\'@cbProxy($event,"first")\' class=icon-double-angle-left></a></li><li class=prev ms-class=\'{disabled: @isDisabled("prev",1)}\'><a ms-attr=\'{href:@getHref("prev"),title:@getTitle("prev")}\' ms-click=\'@cbProxy($event,"prev")\' class=icon-angle-left></a></li><li ms-for="page in @pages" ms-class="{active: page === @currentPage}"><a ms-attr={href:@getHref(page),title:@getTitle(page)} ms-click=@cbProxy($event,page)>{{page}}</a></li><li class=next ms-class=\'{disabled: @isDisabled("next",@totalPages)}\'><a ms-attr=\'{href:@getHref("next"),title: @getTitle("next")}\' ms-click=\'@cbProxy($event,"next")\' class=icon-angle-right></a></li><li class=last ms-class=\'{disabled: @isDisabled("last",@totalPages)}\'><a ms-attr=\'{href:@getHref("last"),title: @getTitle("last")}\' ms-click=\'@cbProxy($event,"last")\' class=icon-double-angle-right></a></li></ul>'},113:function(t,e){!function(t){function e(r){if(a[r])return a[r].exports;var n=a[r]={exports:{},id:r,loaded:!1};return t[r].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){function r(){this.rules=[]}function n(t){var e=t.split("?"),a={},r=e[0],n=e[1];if(n)for(var o,i=n.split("&"),s=i.length,c=0;c<s;c++)i[c]&&(o=i[c].split("="),a[decodeURIComponent(o[0])]=decodeURIComponent(o[1]));return{path:r,query:a}}function o(t){return"/"===t||("string"==typeof t&&t.length>1&&"/"===t.charAt(0)||void 0)}function i(t){if("string"==typeof t)return t;var e=[];for(var a in t)"query"!==a&&e.push(a+"="+encodeURIComponent(t[a]));return e.length?"?"+e.join("&"):""}function s(t,e,a){var r=t.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!e)return r;var n=a?"?":"";return r+n+"("+e+")"+n}var c=(a(6),a(7)),l=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g;r.prototype=c,avalon.mix(c,{error:function(t){this.errorback=t},_pathToRegExp:function(t,e){for(var a,r,n,o,i=e.keys=[],c="^",h=0;a=l.exec(t);){r=a[2]||a[3],n=a[4]||("*"==a[1]?".*":"string"),o=t.substring(h,a.index);var u=this.$types[n],d={name:r};u&&(n=u.pattern,d.decode=u.decode),i.push(d),c+=s(o,n,!1),h=l.lastIndex}o=t.substring(h),c+=s(o)+(e.strict?e.last:"/?")+"$";var p="boolean"!=typeof e.caseInsensitive||e.caseInsensitive;return e.regexp=new RegExp(c,p?"i":void 0),e},add:function(t,e,a){var r=this.rules;"/"!==t.charAt(0)&&avalon.error("avalon.router.add的第一个参数必须以/开头"),a=a||{},a.callback=e,t.length>2&&"/"===t.charAt(t.length-1)&&(t=t.slice(0,-1),a.last="/"),avalon.Array.ensure(r,this._pathToRegExp(t,a))},route:function(t,e){t=t.trim();for(var a,r=this.rules,n=0;a=r[n++];){var o=t.match(a.regexp);if(o){a.query=e||{},a.path=t,a.params={};var i=a.keys;return o.shift(),i.length&&this._parseArgs(o,a),a.callback.apply(a,o)}}this.errorback&&this.errorback()},_parseArgs:function(t,e){for(var a=e.keys,r=0,n=a.length;r<n;r++){var o=a[r],i=t[r]||"";if("function"==typeof o.decode)var s=o.decode(i);else try{s=JSON.parse(i)}catch(t){s=i}t[r]=e.params[o.name]=s}},navigate:function(t,e){var a=n(t),r=this.route(a.path,a.query);return o(r)&&(t=r),avalon.router.setLastPath(t),1===e?avalon.history.setHash(t,!0):2===e&&avalon.history.setHash(t),t},when:function(t,e){var a=this,t=t instanceof Array?t:[t];return avalon.each(t,function(t,r){a.add(r,function(){var t=a.urlFormate(e,this.params,this.query);a.navigate(t.path+t.query)})}),this},urlFormate:function(t,e,a){var a=a?i(a):"",r=t.replace(l,function(t){var a=t.replace(/[\{\}]/g,"").split(":");return a=a[0]?a[0]:a[1],void 0!==e[a]?e[a]:""}).replace(/^\//g,"");return{path:r,query:a}},$types:{date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(t){return new Date(t.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*",decode:function(t){return t}},bool:{decode:function(t){return 0!==parseInt(t,10)},pattern:"0|1"},int:{decode:function(t){return parseInt(t,10)},pattern:"\\d+"}}}),t.exports=avalon.router=new r},,,,,,function(t,e){function a(t){var e=t.indexOf("#");return e===-1?"":decodeURI(t.slice(e))}function r(t){for(var e,a=document.getElementsByTagName("A"),r=0;e=a[r++];)if(e.name===t)return e}function n(t){var e,a=avalon(t).css("position");return e="fixed"!==a?0:t.getBoundingClientRect().bottom}function o(t){var e=document.getElementById(t);if(e||(e=r(t)),e){e.scrollIntoView();var a=n(e);if(a){var o=e.getBoundingClientRect().top;window.scrollBy(0,o-a.top)}}else window.scrollTo(0,0)}var i=document.location,s=avalon.msie<=7,c=!!window.history.pushState,l=!(!("onhashchange"in window)||window.VBArray&&s),h={root:"/",html5:!1,hashPrefix:"!",iframeID:null,interval:50,autoScroll:!1},u={hash:a(i.href),check:function(){var t=a(i.href);t!==this.hash&&(this.hash=t,this.onHashChanged())},fire:function(){switch(this.mode){case"popstate":window.onpopstate&&window.onpopstate();break;case"hashchange":window.onhashchange&&window.onhashchange();break;default:this.onHashChanged()}},start:function(t){if(this.started)throw new Error("avalon.history has already been started");this.started=!0,"boolean"==typeof t&&(t={html5:t}),t=avalon.mix({},h,t||{}),t.fireAnchor&&(t.autoScroll=!0);var e=t.root;/^\//.test(e)||avalon.error("root配置项必须以/字符开始, 以非/字符结束"),e.length>1&&(t.root=e.replace(/\/$/,""));var a=t.html5;switch(this.options=t,this.mode=a?"popstate":"hashchange",c||(a&&avalon.warn("浏览器不支持HTML5 pushState，平稳退化到onhashchange!"),this.mode="hashchange"),l||(this.mode="iframepoll"),avalon.log("avalon run mmHistory in the ",this.mode,"mode"),this.mode){case"popstate":setTimeout(function(){window.onpopstate=u.onHashChanged},500);break;case"hashchange":window.onhashchange=u.onHashChanged;break;case"iframepoll":avalon.ready(function(){function e(){"location"===event.propertyName&&u.check()}var a=document.createElement("iframe");a.id=t.iframeID,a.style.display="none",document.body.appendChild(a),u.iframe=a,u.writeFrame(""),avalon.msie&&(document.attachEvent("onpropertychange",e),u.onPropertyChange=e),u.intervalID=window.setInterval(function(){u.check()},t.interval)})}this.onHashChanged()},stop:function(){switch(this.mode){case"popstate":window.onpopstate=avalon.noop;break;case"hashchange":window.onhashchange=avalon.noop;break;case"iframepoll":this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this.onPropertyChange&&document.detachEvent("onpropertychange",this.onPropertyChange),clearInterval(this.intervalID)}this.started=!1},setHash:function(t,e){switch(this.mode){case"iframepoll":if(e){var a=this.iframe;a&&(a.contentWindow._hash=t)}else this.writeFrame(t);break;case"popstate":var r=(this.options.root+"/"+t).replace(/\/+/g,"/");e?window.history.replaceState({},document.title,r):window.history.pushState({},document.title,r),this.fire();break;default:var n=this.options.hashPrefix+t;e&&i.hash!==n&&history.back(),i.hash=n}return this},writeFrame:function(t){var e=u.iframe,a=e.contentDocument||e.contentWindow.document;a.open(),a.write("<script>_hash = '"+t+"'; onload = parent.avalon.history.syncHash;<script>"),a.close()},syncHash:function(){var t=this._hash;return t!==a(i.href)&&(i.hash=t),this},getPath:function(){var t=i.pathname,t=t.split(this.options.root)[1];return"/"!==t.charAt(0)&&(t="/"+t),t},onHashChanged:function(t,e){e||(t="popstate"===u.mode?u.getPath():i.href.replace(/.*#!?/,"")),t=decodeURIComponent(t),t="/"===t.charAt(0)?t:"/"+t,t!==u.hash&&(u.hash=t,avalon.router&&(t=avalon.router.navigate(t,0)),e&&u.setHash(t),e&&u.options.autoScroll&&o(t.slice(1)))}};avalon.bind(document,"click",function(t){if(u.started&&!(t.ctrlKey||t.metaKey||t.shiftKey||2===t.which||2===t.button)&&t.returnValue!==!1){for(var e=t.path?t.path[0]:t.target;"A"!==e.nodeName;)if(e=e.parentNode,!e||"BODY"===e.tagName)return;var a=e.getAttribute("href",2)||e.getAttribute("xlink:href")||"";"#!"===a.slice(0,2)&&(e.hasAttribute("download")||"external"===e.getAttribute("rel")||a.indexOf("mailto:")>-1||e.target&&"_self"!==e.target||(t.preventDefault(),console.log(a.replace("#!","")),u.onHashChanged(a.replace("#!",""),!0)))}}),t.exports=avalon.history=u},function(t,e){function a(){try{return localStorage.setItem("avalon",1),localStorage.removeItem("avalon"),!0}catch(t){return!1}}function r(t){return String(t).replace(/[,;"\\=\s%]/g,function(t){return encodeURIComponent(t)})}function n(t,e){var a=new Date;a.setTime(a.getTime()+864e5),document.cookie=r(t)+"="+r(e)+";expires="+a.toGMTString()}function o(t){var e=String(document.cookie).match(new RegExp("(?:^| )"+t+"(?:(?:=([^;]*))|;|$)"))||["",""];return decodeURIComponent(e[1])}var i={};if(a()){i.getLastPath=function(){return localStorage.getItem("msLastPath")};var s;i.setLastPath=function(t){s&&(clearTimeout(s),s=null),localStorage.setItem("msLastPath",t),s=setTimeout(function(){localStorage.removItem("msLastPath")},864e5)}}else i.getLastPath=function(){return o.getItem("msLastPath")},i.setLastPath=function(t){n("msLastPath",t)};t.exports=i}])},114:function(t,e){t.exports='<div><p>切换卡1</p><div ms-controller=widget1><xmp :widget="{is:\'ms-grid\', id: \'grid1\'}" cached=true><table slot=header class=header><tr><td :for="el in @header" style=width:200px>{{el}}</td></tr></table><table slot=tbody class=tbody><tr :for="obj in @data | limitBy(@count, @start)"><td :for="el in obj | selectBy(@header)" style=width:200px>{{el}}</td></tr></table><ms-pager slot=pager :widget="{onReady:@ready, id:\'pager1\'}"></ms-pager></xmp></div></div>'},115:function(t,e){t.exports="<div><p>切换卡2</p><p>{{@bbb}}</p></div>"},116:function(t,e){t.exports="<div><p>切换卡3</p><p>{{@ccc}}</p><p>{{new Date | date('yyyy-mm-dd HH:MM:ss')}}</p></div>"},117:function(t,e,a){function r(t){for(var e=[],a=0;a<t;a++)e.push({aaa:new Date-a,bbb:Math.random().toString(32).replace(/0\./,""),ccc:(Math.random()+"").replace(/0\./,""),ddd:a});return e}a(110),a(118);var n=avalon.define({$id:"widget1",header:["aaa","bbb","ccc"],start:0,count:10,data:r(300),ready:function(t){t.vmodel.$watch("currentPage",function(t){n.start=t-1,avalon.log(n.start)})},ddd:"bbb"})},118:function(t,e,a){var r=a(109);r.component("ms-grid",{template:a(119),defaults:{}})},119:function(t,e){t.exports="<div class=grid><div><slot name=header></slot></div><div><slot name=tbody></slot></div><div class=pager><slot name=pager></slot></div></div>"}})});
//# sourceMappingURL=routergrid.min.js.map