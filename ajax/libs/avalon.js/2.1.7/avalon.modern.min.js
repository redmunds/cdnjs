!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.avalon=t():e.avalon=t()}(this,function(){function e(t){return new e.init(t)}function t(t,n,r){t[r.name]=e.parseExpr(r)}function n(e){if(e&&"object"==typeof e){var t=e.length,n=sn.call(e);if(ln.test(n))return!0;if("[object Object]"===n&&t===t>>>0)return!0}return!1}function r(e){this.size=0,this.limit=e,this.head=this.tail=void 0,this._keymap={}}function o(t){return t.uuid||(t.uuid=e.makeHashCode("e"))}function a(e){return e.uuid||(e.uuid="_"+ ++mn)}function i(t){for(var n in t)if(e.ohasOwn.call(t,n)){var r=t[n];"function"==typeof i.plugins[n]?i.plugins[n](r):i[n]=r}return this}function s(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var o=isFinite(+e)?+e:0,a=isFinite(+t)?Math.abs(t):3,i=r||",",s=n||".",c="",l=function(e,t){var n=Math.pow(10,t);return""+(Math.round(e*n)/n).toFixed(t)};return c=(a?l(o,a):""+Math.round(o)).split("."),c[0].length>3&&(c[0]=c[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,i)),(c[1]||"").length<a&&(c[1]=c[1]||"",c[1]+=new Array(a-c[1].length+1).join("0")),c.join(s)}function c(e){return e.replace(xn,"").replace(Cn,function(e,t){var n=e.toLowerCase().match(/<(\w+)\s/);if(n){var r=An[n[1]];r&&(e=e.replace(r,function(e,t,n){var r=n.charAt(0);return t+"="+r+"javascript:void(0)"+r}))}return e.replace($n," ").replace(/\s+/g," ")})}function l(e){return parseInt(e,10)||0}function u(e,t,n){var r="";for(e<0&&(r="-",e=-e),e=""+e;e.length<t;)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function d(e,t,n,r){return function(o){var a=o["get"+e]();return(n>0||a>-n)&&(a+=n),0===a&&n===-12&&(a=12),u(a,t,r)}}function f(e,t){return function(n,r){var o=n["get"+e](),a=(t?"SHORT"+e:e).toUpperCase();return r[a][o]}}function p(e){var t=-1*e.getTimezoneOffset(),n=t>=0?"+":"";return n+=u(Math[t>0?"floor":"ceil"](t/60),2)+u(Math.abs(t%60),2)}function v(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function m(e,t){var n,r,o=m.locate,a="",i=[];if(t=t||"mediumDate",t=o[t]||t,"string"==typeof e)if(/^\d+$/.test(e))e=l(e);else if(Nn.test(e))e=+RegExp.$1;else{var s=e.trim(),c=[0,0,0,0,0,0,0],u=new Date(0);s=s.replace(/^(\d+)\D(\d+)\D(\d+)/,function(e,t,n,r){var o=4===r.length?[r,t,n]:[t,n,r];return c[0]=l(o[0]),c[1]=l(o[1])-1,c[2]=l(o[2]),""});var d=u.setFullYear,f=u.setHours;s=s.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(e,t,n,r,o){return c[3]=l(t),c[4]=l(n),c[5]=l(r),o&&(c[6]=Math.round(1e3*parseFloat("0."+o))),""});var p=0,v=0;s=s.replace(/Z|([+-])(\d\d):?(\d\d)/,function(e,t,n,r){return d=u.setUTCFullYear,f=u.setUTCHours,t&&(p=l(t+n),v=l(t+r)),""}),c[3]-=p,c[4]-=v,d.apply(u,c.slice(0,3)),f.apply(u,c.slice(3)),e=u}for("number"==typeof e&&(e=new Date(e));t;)r=kn.exec(t),r?(i=i.concat(r.slice(1)),t=i.pop()):(i.push(t),t=null);return i.forEach(function(t){n=En[t],a+=n?n(e,o):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),a}function h(t,n,r){var o=e.type(t);if("array"!==o&&"object"!==o)throw"orderBy只能处理对象或数组";var a=r&&r<0?-1:1;if("string"==typeof n){var i=n;n=function(e){return e&&e[i]}}t=w(t),t.forEach(function(e){e.order=n(e.value,e.key)}),t.sort(function(e,t){var n=e.order,r=t.order;return Number.isNaN(n)&&Number.isNaN(r)?0:n===r?0:n>r?a:-a});var s="array"===o,c=s?[]:{};return b(c,t,function(e){s?c.push(e.value):c[e.key]=e.value})}function g(t,n){var r=e.type(t);if("array"!==r&&"object"!==r)throw"filterBy只能处理对象或数组";var o=e.slice(arguments,2),a=e.type(n);if("function"===a)var i=n;else{if("string"!==a&&"number"!==a)return t;if(""===n)return t;var s=new RegExp(e.escapeRegExp(n),"i");i=function(e){return s.test(e)}}t=w(t).filter(function(e,t){return!!i.apply(e,[e.value,t].concat(o))});var c="array"===r,l=c?[]:{};return b(l,t,function(e){c?l.push(e.value):l[e.key]=e.value})}function y(t,n,r){if(e.isObject(t)&&!Array.isArray(t)){var o=[];return b(o,n,function(e){o.push(t.hasOwnProperty(e)?t[e]:r?r[e]:"")})}return t}function _(t,n,r){var o=e.type(t);if("array"!==o&&"object"!==o)throw"limitBy只能处理对象或数组";if("number"!=typeof n)return t;if(Number.isNaN(n))return t;"object"===o&&(t=w(t));var a=t.length;n=Math.floor(Math.min(a,n)),r="number"==typeof r?r:0,r<0&&(r=Math.max(0,a+r));for(var i=[],s=r;s<a&&i.length!==n;s++)i.push(t[s]);var c="array"===o;if(c)return i;var l={};return b(l,i,function(e){l[e.key]=e.value})}function b(e,t,n){for(var r=0,o=t.length;r<o;r++)n(t[r]);return e}function w(t){var n=[],r=0;return e.each(t,function(e,t){n[r++]={value:t,key:e}}),n}function x(e){return null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function $(e){return e}function C(t){this.nodeName="#text",this.nodeValue=t,this.skipContent=!e.config.rexpr.test(t)}function A(e){this.nodeName="#comment",this.nodeValue=e}function E(e,t,n){this.nodeName=e,this.props=t,this.children=n}function k(e){return e!==!1&&Object(e)!==e}function N(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function T(e){this.nodeName="#document-fragment",this.children=e}function O(e,t){if(e&&1===e.nodeType){t.dynamic["ms-attr"]=1;var n=t["ms-attr"];for(var r in n){var o=n[r];if("src"===r&&rn.chrome&&"EMBED"===e.tagName){e[r]=o;var a=e.parentNode,i=document.createComment("ms-src");a.replaceChild(i,e),a.replaceChild(e,i)}else if(0===r.indexOf("data-"))e.setAttribute(r,o);else{var s=Fn[r]||r;if("boolean"==typeof e[s]&&(e[s]=!!o),o===!1){e.removeAttribute(r);continue}var c=!Bn.test(e)&&r in e.cloneNode(!1);c?e[s]=o+"":e.setAttribute(r,o)}}}}function M(e,t){if(e.offsetWidth<=0){if(Zn.test(Rn["@:get"](e,"display"))){var n={node:e};for(var r in Yn)n[r]=e.style[r],e.style[r]=Yn[r];t.push(n)}var o=e.parentNode;o&&1===o.nodeType&&M(o,t)}}function j(e){return e.window||e.defaultView||!1}function D(e){var t=e.tagName.toLowerCase();return"input"===t&&Wn.test(e.type)?"checked":t}function S(t,n,r){var o=t.getAttribute("avalon-events");if(o&&(t.disabled!==!0||"click"!==n)){var a=[],i=tr[n]||(tr[n]=new RegExp("\\b"+n+"\\:([^,\\s]+)","g"));o.replace(i,function(e,t){return a.push(t),e}),a.length&&r.push({elem:t,uuids:a})}t=t.parentNode;var s=e.gestureEvents||{};t&&t.getAttribute&&(Qn[n]||s[n])&&S(t,n,r)}function V(t){t=new L(t);var n=t.type,r=t.target,o=[];S(r,n,o);for(var a,i,s,c=0;(s=o[c++])&&!t.cancelBubble;){var l=t.currentTarget=s.elem;for(a=0;i=s.uuids[a++];){if(rr){rr=!1;break}var u=e.eventListeners[i];if(u){var d=nr.test(i)?s.elem._ms_context_:0;if(d&&d.$hashcode===!1)return e.unbind(r,n,u);var f=u.call(d||r,t,l._ms_local);f===!1&&(t.preventDefault(),t.stopPropagation())}}}}function H(t){var n=_n.getAttribute("delegate-events")||"";if(n.indexOf(t)===-1){var r=n.match(e.rword)||[];r.push(t),_n.setAttribute("delegate-events",r.join(",")),e._nativeBind(_n,t,V,!!or[t])}}function L(e){if(e.originalEvent)return this;for(var t in e)ar.test(t)||"function"==typeof e[t]||(this[t]=e[t]);this.target||(this.target=e.srcElement);this.target;this.fixEvent(),this.timeStamp=new Date-0,this.originalEvent=e}function P(e){var t={},n=e.nodeName.toLowerCase();if(t.nodeName=n,t.dom=e,"#"===n.charAt(0)){var r=e.nodeValue;/\S/.test(r)&&(t.nodeValue=r)}else{var o=F(e);cr[n]&&(t.isVoidTag=!0),t.children=z(e),o&&("selectedIndex"in o&&(e.selectedIndex=o.selectedIndex,delete o.selectedIndex),t.props=o)}return t}function F(e){for(var t=e.attributes,n={},r=0,o=t.length;r<o;r++){var a=t[r];if(a.specified){var i=a.name;":"===i.charAt(0)&&(i=i.replace(ur,"ms-")),n[i]=a.value}}lr.test(e.nodeName)&&(n.type=e.type);var s=e.style.cssText;return s&&(n.style=s),"select-one"===n.type&&(n.selectedIndex=e.selectedIndex),I(n)?null:n}function I(e){for(var t in e)return!1;return!0}function z(e){var t=[],n=e.firstChild;if(!n)return t;do{var r=n.nextSibling;switch(n.nodeType){case 1:var o=n.getAttributeNode(":for")||n.getAttributeNode("ms-for");if(o){var a=document.createComment("ms-for:"+o.value),i=document.createComment("ms-for-end:");n.removeAttributeNode(o),e&&(e.insertBefore(i,n.nextSibling),e.insertBefore(a,n)),t.push(P(a),P(n),P(i))}else t.push(P(n));break;case 3:if(/\S/.test(n.nodeValue))t.push(P(n));else{var s=n.parentNode;s&&s.removeChild(n)}break;case 8:t.push(P(n))}n=r}while(n);return t}function B(t){for(var n,r=0;n=t[r++];)if(1===n.nodeType){var o=R(n),a=e.vmodels[o];if(a&&!a.$element){if(a.$element=n,e.serverTemplates&&e.serverTemplates[o]){var i=e.serverTemplates[o],s=e.speedUp(e.lexer(i)),c=e.render(s),l=c(a),u=e.vdom(l[0],"toDOM");a.$element=u,u.vtree=l,a.$render=c,n.parentNode.replaceChild(u,n),e.diff(l,l);continue}var l=[P(n)],d=new Date;n.vtree=e.speedUp(l);var f=new Date;fr&&e.log("构建虚拟DOM耗时",f-d,"ms"),a.$render=e.render(n.vtree),e.scopes[a.$id]={vmodel:a,local:{},isTemp:!0};var p=new Date;fr&&p-f>100&&(e.log("构建当前vm的$render方法耗时 ",p-f,"ms\n","如果此时间太长,达100ms以上\n","建议将当前ms-controller拆分成多个ms-controller,减少每个vm管辖的区域"),fr=!1),e.rerenderStart=p,e.batch(o)}else o||B(n.childNodes)}}function R(e){return e.getAttribute("ms-controller")||e.getAttribute(":controller")}function q(e,t){var n,r=t.split(".")[0];try{e.hasOwnProperty(r)&&(n=e.$accessors?e.$accessors[r].get.heirloom.__vmodel__:Object.getOwnPropertyDescriptor(e,r).get.heirloom.__vmodel__)}catch(e){}return n||e}function U(t,n){var r=t.indexOf(".*")>0||"*"===t,o=r?this:U.adjust(this,t),a=this.$events,i=a[t]||(a[t]=[]);return r&&(i.reg=i.reg||Z(t)),W(r,a,t),o!==this&&W(r,this.$events,t),e.Array.ensure(i,n),function(){e.Array.remove(i,n)}}function Y(t,n,r,o,a,i){if(t&&t.length)try{for(i=i||t.length-1;i>=0;i--){var s=t[i];s.call(n,o,a,r)}}catch(s){i-1>0&&Y(t,n,r,o,a,i-1),e.log(s,r)}}function Z(e){var t=e.split(".");return new RegExp("^"+t.map(function(e){return"*"===e?"(?:[^.]+)":e}).join("\\.")+"$","i")}function W(e,t,n){e&&(t.__fuzzy__?t.__fuzzy__.indexOf(","+n)===-1&&(t.__fuzzy__+=","+n):t.__fuzzy__=n)}function X(e,t){e.length!==t&&e.notify("length",e.length,t,!0)}function K(t,n,r){return"$"===t.charAt(0)||r[t]||wr.test(e.type(n))||n&&n.nodeName&&n.nodeType>0}function J(t,n,r,o){var a=e.type(t);switch(a){case"array":return mr.arrayFactory(t,n,r,o);case"object":if(n&&n.$id){if(++e.suspendUpdate,n.$track!==Object.keys(t).sort().join(";;"))var i=mr.slaveFactory(n,t,r,o);else i=n;for(var s in t)hr[s]||(i[s]=t[s]);return--e.suspendUpdate,i}return i=mr.masterFactory(t,r,o);default:return t}}function G(e,t,n){function r(){return o}var o=NaN;return r.heirloom=n,{get:r,set:function(a){if(o!==a){var i=o;i&&i.$model&&(i=i.$model);var s=n.__vmodel__;if(a&&"object"==typeof a&&(a=J(a,o,n,{pathname:t,id:e})),o=a,this.$hashcode&&s){if(s.$events.$$dirty$$=!0,s.$events.$$wait$$)return;n!==s.$events&&(r.heirloom=s.$events),ne(r.$decompose,t,a,i),t.indexOf("*")===-1&&Y(r.heirloom[t],s,t,a,i),te(e+"",s,t,a,i),re(r.heirloom,s,t,a,i),s.$events.$$dirty$$=!1,Q(s.$id)}}},enumerable:!0,configurable:!0}}function Q(t){e.rerenderStart=new Date;var n=t.indexOf(".");n>0?e.batch(t.slice(0,n)):e.batch(t)}function ee(t,n,r,o){if(n&&n.splice){var a=[0,n.length].concat(t);return++e.suspendUpdate,e.callArray=o.pathname,n.splice.apply(n,a),--e.suspendUpdate,n}for(var i in gr)t[i]=gr[i];t.notify=function(t,n,a,i){var s=r.__vmodel__;if(s){var c=null===t||void 0===t?o.pathname:o.pathname+"."+t;s.$fire(c,n,a),i||r.$$wait$$||e.suspendUpdate||(e.callArray=c,Q(s.$id),delete e.callArray)}};var s=e.makeHashCode("$");o.array=!0,o.hashcode=s,o.id=o.id||s,mr.initViewModel(t,r,{},{},o);for(var c=0,l=t.length;c<l;c++)t[c]=J(t[c],0,{},{id:t.$id+".*",master:!0});return t}function te(t,n,r,o,a){if(t.indexOf(".*.")>0){var i=t.match(xr),s=e.vmodels[i[1]];if(s){var c=i[2];Y(s.$events[c],n,r,o,a)}}}function ne(e,t,n,r){if(e&&e[t]){var o=e[t];if(o.$hashcode){var a=t.replace(/^[^.]+\./,"");a!==t&&Y(o.$events[a],o,a,n,r)}else delete e[t]}}function re(t,n,r,o,a){t.__fuzzy__&&t.__fuzzy__.replace(e.rword,function(e){var i=t[e],s=i.reg;return s&&s.test(r)&&Y(i,n,r,o,a),e})}function oe(t){switch(e.type(t)){case"array":for(var n=[],r=0;r<t.length;r++)n[r]=oe(t[r]);return n;case"object":var o={};for(r in t)if(t.hasOwnProperty(r)){var a=t[r];o[r]=a&&a.nodeType?a:oe(a)}return o;default:return t}}function ae(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!1,configurable:!0})}function ie(e,t,n,r,o){o.array?Object.defineProperty(e,"$model",$r):(ae(e,"$accessors",r),ae(e,"hasOwnProperty",function(e){return n[e]===!0}),ae(e,"$track",Object.keys(n).sort().join(";;"))),ae(e,"$id",o.id),ae(e,"$hashcode",o.hashcode),o.master===!0&&(ae(e,"$run",ce),ae(e,"$wait",se),t.__vmodel__=e,ae(e,"$events",t),ae(e,"$watch",U),ae(e,"$fire",function(t,n,r){var o=e.$events[t];Y(o,e,t,n,r)}))}function se(){this.$events.$$wait$$=!0}function ce(){var t=this.$events;if(delete t.$$wait$$,t.$$dirty$$){delete t.$$dirty$$,e.rerenderStart=new Date;var n=this.$id,r=n.indexOf(".");r>0?e.batch(n.slice(0,r)):e.batch(n)}}function le(){}function ue(t,n,r){var o={};t.$skipArray&&(o=e.oneObject(t.$skipArray),delete t.$skipArray);var a={};r=r||{},n=n||{};var i={},s=Tr("$"),c=r.pathname||"";r.id=r.id||s,r.hashcode=s;var l,u,d;for(l in t)if(!Ar[l]){var f=a[l]=t[l];Cr(l,f,o)||(u=r.id+"."+l,d=c?c+"."+l:l,i[l]=Er(u,d,n))}i.$model=kr;var p=new le;Object.defineProperties(p,i);for(l in a)p[l]=a[l],l in o?delete a[l]:a[l]=!0;return Nr(p,n,a,i,r),p}function de(e,t,n,r){var o={},a={},i=r.pathname;n=n||{};var s,c,l;for(s in t)if(!Ar[s]&&(o[s]=t[s],!Cr(s,t[s],Or))){var u=Object.getOwnPropertyDescriptor(e,s);u&&u.get?a[s]=u:(c=r.id+"."+s,l=i?i+"."+s:s,a[s]=Er(c,l,n))}for(s in e)delete e[s];r.hashcode=e.$hashcode||Tr("$"),a.$model=kr;var d=e;Object.defineProperties(d,a);for(s in o)a[s]||(d[s]=o[s]),o[s]=!0;return Nr(d,n,o,a,r),d}function fe(t,n){for(var r,o,a={},i={},s={},c={},l={},u=e.slice(arguments),d="function"==typeof this&&this.isWidget,f=0;f<u.length;f++){var p=u[f];for(var v in p){var m=p[v];if("$skipArray"!==v)if(d&&u.indexOf(m)!==-1)r=m,o=v;else{var h=Object.getOwnPropertyDescriptor(p,v);a[v]=m,i[v]&&e.isObject(m)&&delete i[v],h.set?i[v]=h:"function"!=typeof a[v]&&(s[v]=1)}else Array.isArray(m)&&m.forEach(function(e){l[e]=1})}}"function"==typeof this&&this(a,s);for(v in s)Ar[v]||i[v]||Cr(v,a[v],l)||(i[v]=Er(t.$id+"."+v,v,c),i[v].set(a[v]));var g=new le;Object.defineProperties(g,i);for(v in a){if(i[v]||(g[v]=a[v]),d&&r&&i[v]&&r.hasOwnProperty(v)){var y=i[v].get;y.$decompose||(y.$decompose={}),y.$decompose[o+"."+v]=g}a[v]=!0}return Nr(g,c,a,i,{id:t.$id,hashcode:Tr("$"),master:!0}),g}function pe(t,n,r){if(r)t.afterChange=t.afterChange||[],e.Array.ensure(t.afterChange,n);else{var o=t.dom;n(t.dom,t,o&&o.parentNode)}}function ve(t,n){var r=t.ownerDocument,o=t.nodeName,a="_"+o;if(!ve[a]){var i=r.body.appendChild(r.createElement(o));n=e.css(i,"display"),r.body.removeChild(i),n===Sr&&(n="block"),ve[a]=n}return ve[a]}function me(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t],r=typeof n;if("string"===r||"number"===r||n===!0)e.push(n);else if(Array.isArray(n))e.push(me.apply(null,n));else if("object"===r)for(var o in n)n.hasOwnProperty(o)&&n[o]&&e.push(o)}return e.join(" ")}function he(t){var n=t.target;e(n).addClass(n.getAttribute(Vr[t.type])||"")}function ge(t){var n=t.target,r=Vr[t.type];e(n).removeClass(n.getAttribute(r)||""),"change-active"!==r&&e(n).removeClass(n.getAttribute("change-active")||"")}function ye(t,n){var r=t.getAttribute("old-change-class"),o=n["ms-class"];r!==o&&(e(t).removeClass(r).addClass(o),t.setAttribute("old-change-class",o))}function _e(e,t){for(var n in e)if(e[n]!==t[n])return!0;return!1}function be(e){return Fr.test(e)||Lr[e]?hn(e):e}function we(e){var t=[];for(var n in e){var r=typeof e[n];if("object"===r)if("props"===n){var o=[];for(var a in e.props){var i=e.props[a];"string"==typeof i&&(i=hn(i)),o.push(be(a)+": "+i)}t.push(n+": {"+o.join(",\n")+"}")}else"children"===n&&t.push("children: ["+e[n].map(function(e){return we(e)})+"]");else if(e.hasOwnProperty(n)){var s=e[n];"string"===r&&(s=Pr[n]?hn(s):s),t.push(be(n)+":"+s)}}return"{\n"+t.join(",\n")+"}"}function xe(e){e.callback&&e.callback.call(e.vmodel,{type:"changed",target:e.dom},e.local)}function $e(e){var t=this,n=this.__ms_duplex__;if(!t.composing&&t.value!==n.value){if(t.caret)try{var r=n.getCaret(t);n.pos=r}catch(e){}if(n.debounceTime>4){var o=new Date,a=o-n.time||0;n.time=o,a>=n.debounceTime?Ir[n.type].call(n):(clearTimeout(n.debounceID),n.debounceID=setTimeout(function(){Ir[n.type].call(n)},a))}else Ir[n.type].call(n)}}function Ce(t,n){var r={},o=n["ms-duplex"];switch(o.update=$e,o.type){case"radio":case"checkbox":r.click=$e;break;case"select":r.change=$e;break;case"contenteditable":o.isChanged?r.blur=$e:(gn.webkitURL?r.webkitEditableContentChanged=$e:gn.MutationEvent&&(r.DOMCharacterDataModified=$e),r.input=$e);break;case"input":o.isChanged?r.change=$e:(r.input=$e,r.compositionstart=Ne,r.compositionend=Te,e.msie&&(r.keyup=Ae))}/password|text/.test(n.props.type)&&(r.focus=Ee,r.blur=ke,o.getCaret=Oe,o.setCaret=Me);for(var a in r)e.bind(t,a,r[a])}function Ae(e){var t=e.keyCode;91===t||15<t&&t<19||37<=t&&t<=40||$e.call(this,e)}function Ee(){this.caret=!0}function ke(){this.caret=!1}function Ne(){this.composing=!0}function Te(e){this.composing=!1;var t=this;setTimeout(function(){$e.call(t,e)},0)}function Oe(e){var t=NaN;return e.setSelectionRange&&(t=e.selectionStart),t}function Me(e,t){e.value&&!e.readOnly&&(e.selectionStart=t,e.selectionEnd=t)}function je(t,n){var r=t.__ms_duplex__,o=n["ms-rules"];if(o&&!r.validator)for(;t&&1===t.nodeType;){var a=t._ms_validator_;if(a){r.rules=o,r.validator=a,e.Array.ensure(a.fields,r)&&a.addField(r);break}t=t.parentNode}}function De(t){for(var n,r=0;n=this.parsers[r++];){var o=e.parsers[n];o&&(t=o.call(this,t))}return t}function Se(){var e=this.data||{};return this.message.replace(Qr,function(t,n){return null==e[n]?"":e[n]})}function Ve(t){return"regexp"===e.type(t)}function He(e){if("string"==typeof e&&e){var t=e.split("-");if(3===t.length&&4===t[0].length){var n=~~t[0],r=~~t[1]-1,o=~~t[2],a=new Date(n,r,o);return a.getFullYear()===n&&a.getMonth()===r&&a.getDate()===o}}return!1}function Le(e){var t=typeof e;return e&&"object"===t?e.$hashcode:t+":"+e}function Pe(e,t,n,r,o,a,i,s){var c=s?Le(t):e,l={};l[o]=e,l[a]=t;for(var u in n)u in l||(l[u]=n[u]);r(e,t,c,l,i)}function Fe(e,t){var n=e.children.map(function(e){return e["ms-if"]?e.comment:e.dom});return t&&n.forEach(function(t){e.dom.appendChild(t)}),n}function Ie(e){var t;for(var n in e){var t=n;break}if(t)return ze(e,t)}function ze(e,t){var n=e[t];if(n){var r=n.arr;if(r){var o=r.pop();return r.length||(n.arr=0),o}return delete e[t],n}}function Be(e,t){var n=t.key;if(e[n]){var r=e[n],o=r.arr||(r.arr=[]);o.push(t)}else e[n]=t}function Re(e,t,n){var r,o={TransitionEvent:"transitionend",WebKitTransitionEvent:"webkitTransitionEnd",OTransitionEvent:"oTransitionEnd",otransitionEvent:"otransitionEnd"};for(var a in o){if(n[a]){r=o[a];break}try{document.createEvent(a);r=o[a];break}catch(e){}}if("string"==typeof r)var i=!0,s=!0,c=r;o={AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"};var l;for(a in o)if(n[a]){l=o[a];break}if("string"==typeof l){var u=!0;s=!0;var d=l}return{css:s,animation:u,transition:i,animationEndEvent:d,transitionEndEvent:c,transitionDuration:e,animationDuration:t}}function qe(){var e=co[0];e&&e()}function Ue(e,t,n){e[t]||(e[t]=n)}function Ye(e){var t=uo.test(e)?1e3:1;return parseFloat(e)*t}function Ze(e,t,n){var r=e[t];r=Array.isArray(r)?r:"function"==typeof r?[r]:[],r.forEach(function(e){e&&e(n)})}function We(t){var n=t.toLowerCase();return function(r){var o,a=this.el,i=e(a),s=isFinite(r.stagger)?1e3*r.stagger:0;if(s&&r.staggerKey){var c=fo.get(r.staggerKey)||fo.put(r.staggerKey,{count:0,items:0});c.count++,c.items++}var l=c&&c.count||0,u=function(n){var i=n!==!1;0===--a.__ms_effect_&&(e.unbind(a,so.transitionEndEvent),e.unbind(a,so.animationEndEvent)),a.animating=void 0,o=!0;var s=i?"Done":"Abort";Ze(r,"on"+t+s,a),c&&0===--c.items&&(c.count=0),r.queue&&(co.shift(),qe())};Ze(r,"onBefore"+t,a),r[n]?r[n](a,function(e){u(e!==!1)}):so.css&&(i.addClass(r[n+"Class"]),"leave"===n?i.removeClass(r.enterClass+" "+r.enterActiveClass):"enter"===n&&i.removeClass(r.leaveClass+" "+r.leaveActiveClass),a.__ms_effect_?a.__ms_effect_++:(i.bind(so.transitionEndEvent,u),i.bind(so.animationEndEvent,u),a.__ms_effect_=1),setTimeout(function(){o=NaN===e.root.offsetWidth,i.addClass(r[n+"ActiveClass"]);var t=rn.getComputedStyle(a),c=t[so.transitionDuration],l=t[so.animationDuration],d=Ye(c)||Ye(l);0===!d?u(!1):s||setTimeout(function(){o||u(!1)},d+32)},17+s*l))}}function Xe(e){e.acton||(e.action=e.hook.replace(/^on/,"").replace(/Done$/,"").toLowerCase())}function Ke(e){var t="??"+po++;return vo.map[t]=e,t+" "}function Je(e){var t=vo.map[e];return t}function Ge(e){for(var t=Qe(e),n=0,r=t.length;n<r;n++)e=e.replace(t[n],Ke);return e}function Qe(e){for(var t,n=0,r=[],o=0,a=e.length;o<a;o++){var i=e.charAt(o);if(t){if("\\"===i){o+=1;continue}i===t&&(r.push(e.slice(n,o+1)),t=!1)}else"'"===i?(t="'",n=o):'"'===i&&(t='"',n=o)}return r}function et(e){for(var t,n=!1,r=0,o=0,a=e.length,i=0;i<a;i++){var s=e[i];t?"tr"!==s.nodeName&&s.children?t=!1:(t.children.push(s),r++,e[i]=0):"tr"===(s.type||s.nodeName)&&(t={nodeName:"tbody",children:[]},t.children.push(s),s.type&&delete s.type,n=!0,0===o&&(o=i),e[i]=t)}if(n)for(i=o;i<a&&(0!==e[i]||(e.splice(i,1),i--,r--,0!==r));i++);}function tt(e,t,n){switch(t){case"style":case"script":case"noscript":case"template":case"xmp":e.children=[{nodeName:"#text",skipContent:!0,nodeValue:n}];break;case"textarea":var r=e.props;r.type=t,r.value=n,e.children=[{nodeName:"#text",nodeValue:n}];break;case"option":e.children=[{nodeName:"#text",nodeValue:nt(n)}]}}function nt(e){return String(e).replace(ho,"").trim()}function rt(t){vo.map={},t=Ge(t);var n=[];n.last=function(){return n[n.length-1]};var r=[],o=1e5;do{var a=!1;if("<"!==t.charAt(0)){var i=t.indexOf("<");i=i===-1?t.length:i;var s=t.slice(0,i).replace(mo,Je);t=t.slice(i),a={nodeName:"#text",nodeValue:s},bo.test(s)&&at(a,n,r)}if(!a){var i=t.indexOf("<!--");if(0===i){var c=t.indexOf("-->");c===-1&&e.error("注释节点没有闭合"+t);var s=t.slice(4,c).replace(mo,Je);t=t.slice(c+3),a={nodeName:"#comment",nodeValue:s},at(a,n,r)}}if(!a){var l=t.match(yo);if(l){var u=l[1].toLowerCase(),d=cr[u]||"/"===l[3];a={nodeName:u,props:{},children:[],isVoidTag:d};var f=l[2];if(f&&it(f,a.props),at(a,n,r),t=t.slice(l[0].length),d)a.end=!0;else if(n.push(a),go[u]){var p=t.indexOf("</"+u+">"),v=t.slice(0,p).trim();t=t.slice(p),tt(a,u,st(v))}}}if(!a){var l=t.match(_o);if(l){var u=l[1].toLowerCase(),m=n.last();m?m.nodeName!==u&&e.error(m.nodeName+"没有闭合"):e.error(l[0]+"前面缺少<"+u+">"),a=n.pop(),a.end=!0,t=t.slice(l[0].length)}}if(!a||0===--o)break;a.end&&(ot(a,n,r),delete a.end)}while(t.length);return r}function ot(e,t,n){var r=e.nodeName,o=e.props;"table"===r&&et(e.children);var a=o["ms-for"];if(a){delete o["ms-for"];var i=t.last(),s=i?i.children:n;s.splice(s.length-1,1,{nodeName:"#comment",nodeValue:"ms-for:"+a,type:r},e,{nodeName:"#comment",nodeValue:"ms-for-end:",type:r})}}function at(e,t,n){var r=t.last();r?r.children.push(e):n.push(e)}function it(e,t){for(;e;){var n=xo.exec(e);if(!n)break;var r=n[1],o=n[2]||"";e=e.replace(n[0],""),":"===r.charAt(0)&&(r="ms-"+r.slice(1)),o&&0===o.indexOf("??")&&(o=st(o).replace(wo,"").slice(1,-1)),r in t||(t[r]=o)}}function st(t){return e.unescapeHTML(t.replace(mo,Je))}function ct(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=t[n]||e[n];switch(r.nodeName){case"#text":if(r.dynamic){var a=r.nodeValue+"";a!==o.nodeValue&&(o.nodeValue=a,o.dom&&(o.dom.nodeValue=a))}break;case"#comment":r.forExpr?vn.for.diff(r,o,e,t,n):r.afterChange&&lt(o,r.afterChange);break;case void 0:ct(r,o);break;case"#document-fragment":ct(r.children,o.children);break;default:if(r.dynamic){var i=n;r["ms-widget"]&&(vn.widget.diff(r,o,"ms-widget",e,t,i),r=e[n],o=t[n]||$o(),delete r["ms-widget"]),"ms-if"in r&&(vn.if.diff(r,o,"ms-if",e,t,i),r=e[n],o=t[n]||$o(),delete r["ms-if"]),ut(r,o)}!/^\w/.test(r.nodeName)||r.skipContent||r.isVoidTag||ct(r.children,o.children||[]),o.afterChange&&lt(o,o.afterChange)}}}function lt(e,t){if(t.length)for(var n,r=0;n=t[r++];)n(e.dom,e);delete e.afterChange}function ut(t,n){try{for(var r in t){var o=r.match(Co),a=o&&o[1];vn[a]&&vn[a].diff(t,n,r)}}catch(t){e.warn(a,t,t.stack||t.message,"diffProps error")}}function dt(t){if(Eo)return e.Array.ensure(Ao,t);Eo=t;var n=e.scopes[t];if(!n||!document.nodeName||e.suspendUpdate)return Eo=null;var r=n.vmodel,o=r.$element,a=o.vtree||[],i=r.$render,s=i(n.vmodel,n.local);n.isTemp&&delete e.scopes[t],e.diff(s,a);var c=Ao.indexOf(Eo);if(Eo=0,c>-1){var l=Ao.splice(c,1);return dt(l[0])}var u=Ao.shift();u&&dt(u)}function ft(e,t){var n=[],r={},o="ms-skip"in t,a={};for(var i in t){var s,c=t[i];if(r[i]=t[i],s=i.match(ko)){if(o)continue;var l=i.replace(s[1],"").split("-");No[l[0]]&&l.unshift("on"),"on"===l[0]&&(l[2]=parseFloat(l[2])||0),l.unshift("ms");var u=l[1];if(vn[u]){var d={type:u,param:l[2],name:l.join("-"),expr:c,priority:vn[u].priority||100*u.charCodeAt(0)};"on"===u&&(d.priority+=l[3]),a[d.name]||(a[d.name]=c,n.push(d))}}}return e.props=r,n.sort(pt),n}function pt(e,t){return e.priority-t.priority}function vt(e,t){for(var n,r=t?[]:["\nvar vnodes = [];"],o=0;n=e[o++];){var a=mt(n);n.$prepend&&r.push(n.$prepend);var i=n.$append;delete n.$append,delete n.$prepend,a&&r.push(a+"\n"),i&&r.push(i)}return t||r.push("return vnodes\n"),r.join("\n")}function mt(t){if(!t.nodeName)return!1;switch(t.nodeName){case"#text":return t.dynamic?gt(_t(t)):yt(t);case"#comment":var n=t.nodeValue;if(t.forExpr){var r={dynamic:!0,vmodel:"__vmodel__"};for(var o in t)t.hasOwnProperty(o)&&!Do[o]&&(r[o]=t[o]);return e.directives.for.parse(r,t,t),t.$append+=e.caches[t.signature],yt(r)}if("ms-for-end:"===n)return t.$append=yt({nodeName:"#comment",nodeValue:t.signature})+" return vnodes}\n })\n},__local__,vnodes)\n"+yt({nodeName:"#comment",signature:t.signature,nodeValue:"ms-for-end:"})+"\n","";if(0===n.indexOf("ms-js:")){var a=e.parseExpr({type:"js",expr:n.replace("ms-js:","")})+"\n",i=yt(t),s=a.match(jo);return s&&s[1]?t.$append=(t.$append||"")+a+"\n__local__."+s[1]+" = "+s[1]+"\n":e.warn(n+" parse fail!"),i}return yt(t);default:if(!t.dynamic&&t.skipContent)return yt(t);var r={nodeName:t.nodeName},c=t.props;if(t.dynamic){r.dynamic="{}";var l=ft(r,c);l.map(function(n){return e.directives[n.type].parse(r,t,n),n.name})}else if(c){r.props={};for(var o in c)r.props[o]=c[o]}if(t.isVoidTag)r.isVoidTag=!0;else if(!("children"in r)){var u=t.children;u&&(t.skipContent?r.children="["+u.map(function(e){return we(e)})+"]":1===u.length&&"#text"===u[0].nodeName?u[0].dynamic?r.children="["+_t(u[0])+"]":r.children="["+we(u[0])+"]":r.children="(function(){"+vt(u)+"})()")}return t.template&&(r.template=t.template),t.skipContent&&(r.skipContent=!0),yt(r)}}function ht(t){return Mo.test(t)?t:e.parseExpr({expr:t,type:"text"})}function gt(e){return"vnodes.push("+e+");"}function yt(e){return gt(we(e))}function _t(e){var t=bt(e.nodeValue),n="";if(1===t.length)n=ht(t[0].expr);else{var r=t.map(function(e){return e.type?ht(e.expr):Oo(e.expr)}).join(" + ");n="String("+r+")"}return'{\nnodeName: "#text",\ndynamic:true,\nnodeValue: '+n+"\n}"}function bt(t){var n=[];do{var r=t.indexOf(To.openTag);r=r===-1?t.length:r;var o=t.slice(0,r);if(/\S/.test(o)&&n.push({expr:e._decode(o)}),t=t.slice(r+To.openTag.length)){r=t.indexOf(To.closeTag);var o=t.slice(0,r);n.push({expr:e.unescapeHTML(o.replace(So,"")),type:"text"}),t=t.slice(r+To.closeTag.length)}}while(t.length);return n}function wt(e){return Lo(e),e}function xt(t){var n=t.nodeName;switch(n){case"#text":return!!e.config.rexpr.test(t.nodeValue)&&(t.dynamic=!0);case"#comment":return!!t.dynamic;case void 0:return!0;default:var r=t.props||{};if("ms-skip"in r)return t.skipContent=!0,!1;var o=!1;if("input"===n)r.type||(r.type="text");else if(/xmp|wbr|template/.test(n))!r["ms-widget"]&&r.is&&(r["ms-widget"]='{is:"'+r.is+'"}');else if("select"===n){var a=r.hasOwnProperty("multiple")?"multiple":"one";r.type=n+"-"+a}else 0===n.indexOf("ms-")&&(r["ms-widget"]||(r.is=n,r["ms-widget"]='{is:"'+n+'"}'));var i=!1;if(r["ms-widget"]){i=!0,$t(r,"html","widget"),$t(r,"text","widget");var s=e.mix({},t),c=e.mix({},t.props);delete c["ms-widget"],delete s.isVoidTag,s.nodeName="cheng",s.props=c,t.template=e.vdom(s,"toHTML"),t.isVoidTag||(t.children=[])}r["ms-text"]&&(i=!0,$t(r,"html","text"),t.isVoidTag||(t.children=[])),r["ms-html"]&&(i=!0,t.isVoidTag||(t.children=[]));var l=!1;for(var u in r)if(l=!0,0===u.indexOf("ms-")){o=!0,t.dynamic={};break}if(l&&(t.props=r),t.children){var d=Lo(t.children);if(d)return delete t.skipContent,!0;i?delete t.skipContent:t.skipContent=!0}return o}}function $t(t,n,r){t["ms-"+n]&&(e.warn(n,"指令不能与",r,"指令共存于同一个元素"),delete t["ms-"+n])}function Ct(e){for(var t,n=0;t=e[n++];)if(t.props&&t.props["ms-effect"])return!0;return!1}function At(t){var n=t.expr,r=t.type,o=Po.get(r+":"+n);if(o)return e.shadowCopy(t,o),o.text;vo.map={};var a={},i={},s=n.replace(Zo,Ke);s=Ge(s),s=s.replace(Io,Ke).replace(Bo,"$1").replace(qo,"$1__vmodel__.").replace(/(\b[\$\w]+\s*):/g,Ke).replace(/\|(\w+)/g,function(e,t){return"|"+Ke(t)}).replace(/__vmodel__\.([\$\w\.]+)/g,function(e,t){return a[t]=1,e}),kt(s,i);var c=s.split(zo),l=c.shift(),u=l.replace(mo,Je);if("js"===r)return Et(t,u,a,i);c.length&&(c=c.map(function(e){var t="(__value__";return e=e.replace(Fo,function(e,n){return/\S/.test(n)&&(t+=","+n),""}).replace(mo,Je),e.replace(/^(\w+)/,'__value__ =  avalon.__format__("$1")')+t+")"}));var d=[];if("on"===r)Ro.test(u)&&(u+="($event)"),c=c.map(function(e){return e.replace(/__value__/g,"$event")}),c.length&&c.push("if($event.$return){\n\treturn;\n}"),e.modern||(u=u.replace(/__vmodel__\.([^(]+)\(([^)]*)\)/,function(e,t,n){return"__vmodel__."+t+".call(__vmodel__"+(/\S/.test(n)?","+n:"")+")"})),d=["function ($event, __local__){","try{",Nt(i).join("\n"),"\tvar __vmodel__ = this;","\t"+u,"}catch(e){",Tt(n,r),"}","}"],c.unshift(2,0);else{if("duplex"===r){var f=["function (__vmodel__,__value__){","try{","\t"+u+" = __value__","}catch(e){",Tt(n,r).replace("parse","set"),"}","}"];Po.put("duplex:set:"+t.expr,f.join("\n").replace(mo,Je));var p=["function (__vmodel__){","try{","var __value__ = "+u,c.join("\n"),"return __value__","}catch(e){",Tt(n,r).replace("parse","get"),"}","}"].join("\n");return Et(t,p,i,a)}d=["(function (){","try{","var __value__ = "+u.replace(mo,Je),"text"===r?"return avalon.parsers.string(__value__)":"return __value__","}catch(e){",Tt(n,r),'\treturn ""',"}","})()"],c.unshift(3,0)}return d.splice.apply(d,c),Et(t,d.join("\n"),i,a)}function Et(e,t,n,r){t=t.replace(mo,Je);var o={text:t,locals:Object.keys(n).join(","),paths:Object.keys(r).join(",")},a=e.type+":"+e.expr;return e.locals=o.locals,e.paths=o.paths,Po.put(a,o),t}function kt(t,n){t.replace(/__vmodel__/," ").replace(Uo," ").replace(Yo,function(t){"$event"===t||e.keyMap[t]||(n[t]=1)})}function Nt(t){var n=[];for(var r in t)n.push("var "+r+" = __local__["+e.quote(r)+"]");return n}function Tt(t,n){return"\tavalon.warn(e, "+e.quote("parse "+n+" binding【 "+t+" 】fail")+")"}function Ot(t,n){var r=Array.isArray(t)?vt(t):t,o=[];if(n)for(var a in n)o.push("var "+a+" = __local__["+hn(a)+"]");r=r.replace(Wo,"$1");var i="__local__ = __local__ || {};\n"+o.join(";\n")+"\n"+r;try{var s=Function("__vmodel__","__local__",i)}catch(t){e.warn(r,"render parse error")}return s}function Mt(t,n,r,o){function a(e,t){m.forEach(function(n){delete e[n],delete t[n]})}var i=t.nodeName,s=t.props.is;if(!Xo[i]&&!Vt(i))return void e.warn(i+"不合适做组件的标签");var c={};if(n){var l=[].concat(n);l.forEach(function(e){e&&"object"==typeof e&&Ht(c,e.$model||e,!0)})}else l=[];var u=e.components[s];if(u){var d=c.id||c.$id;!d&&Qo&&(e.warn("warning!",s,"组件最好在ms-widget配置对象中指定全局不重复的$id以提高性能!\n","若在ms-for循环中可以利用 ($index,el) in @array 中的$index拼写你的$id\n","如 ms-widget=\"{is:'ms-button',id:'btn'+$index}\""),Qo=!1),c.define&&(delete c.define,e.warn("warning! 组件的define配置项已经被废掉"));var f=e.directives.widget.define,p=d||t.props.id||"w"+(new Date-0),v=e.mix(!0,{},u.defaults);Ht(c,v,!1);var m=Go.concat();a.isWidget=!0;var h=f.apply(a,[t.vmodel,v].concat(l));
if(!e.modern)for(var g in h)hr[g]||"function"!=typeof h[g]||(h[g]=h[g].bind(h));h.$id=p,e.vmodels[p]=h;for(var y in Jo)c[y]&&c[y].forEach(function(e){h.$watch(y,e)});var _=e.lexer(o),b=_[0];b.children=b.children||[],b.props.is=s,b.props.wid=p,e.speedUp(_);var w=e.render(_,r),x=u.template.trim();"function"==typeof u.getTemplate&&(x=u.getTemplate(h,x));var $=e.lexer(x);$.length>1&&e.error("组件必须用一个元素包起来");var C=u.soleSlot;St($,C),e.speedUp($);var A=e.render($),E=Dt+"",k=C?e.quote(C):"null";E=E.replace("XXXXX",jt(w)).replace("YYYYY",jt(A)).replace("ZZZZZ",k);var N=E.indexOf("{")+1,T=E.lastIndexOf("}"),O=Function("vm","local",E.slice(N,T));return h.$render=O,t["component-vm:"+s]=h,h.$render=O}}function jt(e){return e.toString().replace("anonymous","").replace(/\s*\/\*\*\//g,"")}function Dt(){var t=XXXXX(vm,local),n=t[0],r=YYYYY(vm,local),o=r[0];for(var a in n)"children"!==a&&"nodeName"!==a&&("props"===a?e.mix(o.props,n.props):o[a]=n[a]);var i=ZZZZZ,s=e.collectSlots(n,i);return!i||s[i]&&s[i].length||(s[i]=[{nodeName:"#text",nodeValue:vm[i],dynamic:!0}]),e.insertSlots(r,s),delete o.skipAttrs,delete o.skipContent,r}function St(e,t){for(var n,r=0;n=e[r];r++)if("slot"===n.nodeName){var o=n.props.name||t;e.splice(r,1,{nodeName:"#comment",nodeValue:"slot:"+o,dynamic:!0,type:o},{nodeName:"#comment",nodeValue:"slot-end:"}),r++}else n.children&&St(n.children,t)}function Vt(t){return ea.test(t)||e.components[t]}function Ht(e,t,n){for(var r in t){var o=t[r];Jo[r]?r in e?e[r].push(o):e[r]=[t[r]]:n&&(e[r]=o)}}function Lt(e){for(;e;){if(9===e.nodeType)return!0;e=e.parentNode}return!1}function Pt(t){if(1===t.nodeType&&t.getAttribute("wid")&&!Lt(t)){var n=t.getAttribute("wid"),r=e.scopes[n];if(!r)return;var o=t.getAttribute("ms-controller")||t.getAttribute("ms-important"),a=o&&e.vmodels[o]||r.vmodel;if(a.$fire("onDispose",{type:"dispose",target:t,vmodel:a}),o)return;if(!t.getAttribute("cached")){delete r.vmodel,delete e.scopes[n];var i=t.vtree;Ft(i);var s=t.getAttribute("is");i&&(i[0][s+"-mount"]=!1,i[0]["component-ready:"+s]=!1)}return!1}}function Ft(e){for(var t in e){var n=e[t];if(ta.test(n.nodeName)){for(var t in n)0===t.indexOf("ms-on")&&delete n[t];n.children&&Ft(n.children)}}}function It(e){setTimeout(function(){Pt(e)},4)}function zt(e){for(var t,n=0;t=e[n++];)Pt(t)}function Bt(e){e.addEventListener("DOMNodeRemovedFromDocument",function(){It(e)})}function Rt(){function t(e,t){var n=r[e];r[e]=function(e,r){return t.call(this,n,e,r)}}function n(t){var n=e.slice(this.getElementsByTagName("*"));o.call(this,t),zt(n)}if(!Rt.execute){Rt.execute=!0;var r=Node.prototype;t("removeChild",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&It(t),t}),t("replaceChild",function(e,t,n){return e.call(this,t,n),1===n.nodeType&&It(n),t});var o,a=Element.prototype;try{var i=Object.getOwnPropertyDescriptor(a,"innerHTML"),o=i.set;i.set=n,Object.defineProperty(a,"innerHTML",i)}catch(e){if(!a||!a.__lookupSetter__)throw e;o=a.__lookupSetter__("innerHTML"),a.__defineSetter__("innerHTML",n)}t("appendChild",function(e,t){return e.call(this,t),1===t.nodeType&&11===this.nodeType&&It(t),t}),t("insertBefore",function(e,t,n){return e.call(this,t,n),1===t.nodeType&&11===this.nodeType&&It(t),t})}}function qt(t){e.Array.ensure(na,t),ra||(ra=setInterval(function(){for(var t,n=0;t=na[n];)!1===Pt(t)?e.Array.removeAt(na,n):n++;0==na.length&&(clearInterval(ra),ra=0)},700))}function Ut(e){if(rn.chrome&&rn.MutationEvent)Bt(e);else try{Rt(e)}catch(t){qt(e)}}function Yt(t,n){var r=n.props.is,o=n["component-vm:"+r],a="component-html:"+r,i=n[a],s=e.vdom(n,"toHTML");i!==s&&(n[a]=s,o.$fire("onViewChange",{type:"viewchange",target:t,vmodel:o,is:r}))}function Zt(e){var t=!0;try{Wt(e)}catch(e){t=!1}return t}function Wt(e){e.children.forEach(function(e){if("#comment"===e.nodeName){if("unresolved component placeholder"===e.nodeValue)throw"unresolved"}else e.children&&Wt(e)})}e.init=function(e){this[0]=this.element=e},e.fn=e.prototype=e.init.prototype,e.shadowCopy=function(e,t){for(var n in t)e[n]=t[n];return e};var Xt={},Kt=/([a-z\d])([A-Z]+)/g,Jt=/[-_][^-_]/g,Gt=/\d\.\d{4}/,Qt=/[-.*+?^${}()|[\]\/\\]/g,en=[].slice,tn=/[^, ]+/g,nn="object"==typeof console;e.shadowCopy(e,{noop:function(){},version:"2.115",rword:tn,inspect:{}.toString,ohasOwn:{}.hasOwnProperty,caches:{},vmodels:{},filters:{},components:{},directives:{},eventHooks:{},eventListeners:{},validators:{},scopes:{},effects:{},cssHooks:Xt,parsers:{number:function(e){return""===e?"":parseFloat(e)||0},string:function(e){return null===e||void 0===e?"":e+""},boolean:function(e){return""===e?e:"true"===e||"1"===e}},log:function(){nn&&e.config.debug&&Function.apply.call(console.log,console,arguments)},warn:function(){if(nn&&e.config.debug){var t=console.warn||console.log;Function.apply.call(t,console,arguments)}},error:function(e,t){throw(t||Error)(e)},oneObject:function(e,t){"string"==typeof e&&(e=e.match(tn)||[]);for(var n={},r=void 0!==t?t:1,o=0,a=e.length;o<a;o++)n[e[o]]=r;return n},isObject:function(e){return null!==e&&"object"==typeof e},range:function(e,t,n){n||(n=1),null==t&&(t=e||0,e=0);for(var r=-1,o=Math.max(0,Math.ceil((t-e)/n)),a=new Array(o);++r<o;)a[r]=e,e+=n;return a},hyphen:function(e){return e.replace(Kt,"$1-$2").toLowerCase()},camelize:function(e){return!e||e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(Jt,function(e){return e.charAt(1).toUpperCase()})},slice:function(e,t,n){return en.call(e,t,n)},css:function(t,n,r,o){if(t instanceof e&&(t=t[0]),1===t.nodeType){var a=e.camelize(n);if(n=e.cssName(a)||a,void 0===r||"boolean"==typeof r){o=Xt[a+":get"]||Xt["@:get"],"background"===n&&(n="backgroundColor");var i=o(t,n);return r===!0?parseFloat(i)||0:i}if(""===r)t.style[n]="";else{if(null==r||r!==r)return;isFinite(r)&&!e.cssNumber[a]&&(r+="px"),o=Xt[a+":set"]||Xt["@:set"],o(t,n,r)}}},directive:function(e,n){return n.parse=n.parse||t,this.directives[e]=n},makeHashCode:function(e){return e=e||"avalon",String(Math.random()+Math.random()).replace(Gt,e)},escapeRegExp:function(e){return(e+"").replace(Qt,"\\$&")},Array:{merge:function(e,t){e.push.apply(e,t)},ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(t,n){var r=t.indexOf(n);return!!~r&&e.Array.removeAt(t,r)}}});var rn=Function(" return this")()||this,on={window:rn,document:{createElement:Object,createElementNS:Object,contains:Boolean},root:{outerHTML:"x"},msie:NaN,browser:!1,modern:!0,avalonDiv:{},avalonFragment:null};if(rn.avalon=e,rn.location&&rn.navigator&&rn.window){var an=rn.document;on.inBrowser=!0,on.document=an,on.root=an.documentElement,on.avalonDiv=an.createElement("div"),on.avalonFragment=an.createDocumentFragment(),rn.VBArray?(on.msie=an.documentMode||(rn.XMLHttpRequest?7:6),on.modern=on.msie>8):on.modern=!0}e.shadowCopy(e,on);var sn=e.inspect,cn=/^\[object (?:Window|DOMWindow|global)\]$/,ln=/(Array|List|Collection|Map|Arguments)\]$/,un={};"Boolean Number String Function Array Date RegExp Object Error".replace(e.rword,function(e){un["[object "+e+"]"]=e.toLowerCase()}),e.type=function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?un[sn.call(e)]||"object":typeof e},e.quote=JSON.stringify,e.isFunction=function(e){return"function"==typeof e},e.isWindow=function(e){return cn.test(sn.call(e))},e.isPlainObject=function(e){return"[object Object]"===sn.call(e)&&Object.getPrototypeOf(e)===Object.prototype},e.mix=e.fn.mix=function(){var t,n,r,o,a,i,s=arguments[0]||{},c=1,l=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},c++),"object"!=typeof s&&"function"!=typeof s&&(s={}),c===l&&(s=this,c--);c<l;c++)if(null!=(t=arguments[c]))for(n in t){r=s[n];try{o=t[n]}catch(e){continue}s!==o&&(u&&o&&(e.isPlainObject(o)||(a=Array.isArray(o)))?(a?(a=!1,i=r&&Array.isArray(r)?r:[]):i=r&&e.isPlainObject(r)?r:{},s[n]=e.mix(u,i,o)):void 0!==o&&(s[n]=o))}return s},e.each=function(e,t){if(e){var r=0;if(n(e))for(var o=e.length;r<o&&t(r,e[r])!==!1;r++);else for(r in e)if(e.hasOwnProperty(r)&&t(r,e[r])===!1)break}},new function(){var t=["%cavalon.js %c"+e.version+" %cin debug mode, %cmore...","color: rgb(114, 157, 52); font-weight: normal;","color: rgb(85, 85, 85); font-weight: normal;","color: rgb(85, 85, 85); font-weight: normal;","color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;"],n="You're running avalon in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\n\nTo disable debug mode, add this line at the start of your app:\n\n  avalon.config({debug: false});\n\nDebug mode also automatically shut down amicably when your app is minified.\n\nGet help and support:\n  https://segmentfault.com/t/avalon\n  http://avalonjs.coding.me/\n  http://www.baidu-x.com/?q=avalonjs\n http://www.avalon.org.cn/\n\nFound a bug? Raise an issue:\n  https://github.com/RubyLouvre/avalon/issues\n\n",r=!!console.groupCollapsed;console[r?"groupCollapsed":"log"].apply(console,t),console.log(n),r&&console.groupEnd(t)};var dn=r.prototype;dn.put=function(e,t){var n={key:e,value:t};return this._keymap[e]=n,this.tail?(this.tail.newer=n,n.older=this.tail):this.head=n,this.tail=n,this.size===this.limit?this.shift():this.size++,t},dn.shift=function(){var e=this.head;e&&(this.head=this.head.newer,this.head.older=e.newer=e.older=this._keymap[e.key]=void 0,delete this._keymap[e.key],this.size--)},dn.get=function(e){var t=this._keymap[e];if(void 0!==t)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)};var fn=/&[a-z0-9#]{2,10};/,pn=e.avalonDiv;e.shadowCopy(e,{evaluatorPool:new r(888),_decode:function(e){return fn.test(e)?(pn.innerHTML=e,pn.innerText||pn.textContent):e}});var vn=e.directives,mn=1,hn=e.quote,gn=e.window,yn=e.document,_n=e.root,bn=e.eventHooks;e.config=i;var wn={interpolate:function(t){var n=t[0],r=t[1];if(n===r)throw new SyntaxError("openTag!==closeTag");var o=n+"test"+r,a=e.avalonDiv;if(a.innerHTML=o,a.innerHTML!==o&&a.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");a.innerHTML="",i.openTag=n,i.closeTag=r;var s=e.escapeRegExp(n),c=e.escapeRegExp(r);i.rexpr=new RegExp(s+"([\\s\\S]*)"+c)}};i.plugins=wn,e.config({interpolate:["{{","}}"],debug:!0});var xn=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,$n=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,Cn=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/gi,An={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/gi,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/gi,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/gi},En={yyyy:d("FullYear",4),yy:d("FullYear",2,0,!0),y:d("FullYear",1),MMMM:f("Month"),MMM:f("Month",!0),MM:d("Month",2,1),M:d("Month",1,1),dd:d("Date",2),d:d("Date",1),HH:d("Hours",2),H:d("Hours",1),hh:d("Hours",2,-12),h:d("Hours",1,-12),mm:d("Minutes",2),m:d("Minutes",1),ss:d("Seconds",2),s:d("Seconds",1),sss:d("Milliseconds",3),EEEE:f("Day"),EEE:f("Day",!0),a:v,Z:p},kn=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,Nn=/^\/Date\((\d+)\)\/$/,Tn={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss",short:"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};Tn.SHORTMONTH=Tn.MONTH,m.locate=Tn,Number.isNaN=Number.isNaN||function(e){return e!==e};var On=Object.freeze({orderBy:h,filterBy:g,selectBy:y,limitBy:_}),Mn={stop:function(e){return e.stopPropagation(),e},prevent:function(e){return e.preventDefault(),e}},jn={esc:27,tab:9,enter:13,space:32,del:46,up:38,left:37,right:39,down:40};for(var Dn in jn)!function(e,t){Mn[e]=function(e){return e.which!==t&&(e.$return=!0),e}}(Dn,jn[Dn]);var Sn=e.filters;e.escapeHtml=x,e.__format__=function(e){var t=Sn[e];return t?t:$},e.mix(Sn,{uppercase:function(e){return String(e).toUpperCase()},lowercase:function(e){return String(e).toLowerCase()},truncate:function(e,t,n){return e?(e=String(e),isNaN(t)&&(t=30),n="string"==typeof n?n:"...",e.length>t?e.slice(0,t-n.length)+n:e):""},camelize:e.camelize,date:m,escape:x,sanitize:c,number:s,currency:function(e,t,n){return(t||"¥")+s(e,isFinite(n)?n:2)}},On,Mn),C.prototype={constructor:C,toDOM:function(){if(this.dom)return this.dom;var t=e._decode(this.nodeValue);return this.dom=document.createTextNode(t)},toHTML:function(){return this.nodeValue}},A.prototype={constructor:A,toDOM:function(){return this.dom=document.createComment(this.nodeValue)},toHTML:function(){return"<!--"+this.nodeValue+"-->"}},E.prototype={constructor:E,toDOM:function(){if(this.dom)return this.dom;var t,n=this.nodeName;t=e.modern&&Vn[n]?N(n):document.createElement(n);var r=this.props||{},o=r["ms-important"]||r["ms-controller"]||this.wid;if(o){var a=e.scopes[o],i=a&&a.vmodel&&a.vmodel.$element;if(i){var s=i.vtree[0];return s.children&&(this.children=s.children),i}}for(var c in r){var l=r[c];k(l)&&t.setAttribute(c,l+"")}var u=this.children||[],d=u[0]?u[0].nodeValue:"";switch(this.nodeName){case"xmp":case"script":case"style":case"noscript":t.innerHTML=d;break;case"template":Hn?t.innerHTML=d:t.textContent=d;break;default:this.isVoidTag||this.children.forEach(function(n){n&&t.appendChild(e.vdom(n,"toDOM"))})}return this.dom=t},toHTML:function(){var t=[],n=this.props||{};for(var r in n){var o=n[r];k(o)&&t.push(r+"="+e.quote(n[r]+""))}t=t.length?" "+t.join(" "):"";var a="<"+this.nodeName+t;return this.isVoidTag?a+"/>":(a+=">",this.children&&(a+=this.children.map(function(t){return t?e.vdom(t,"toHTML"):""}).join("")),a+"</"+this.nodeName+">")}};var Vn=e.oneObject("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use,g,svg");if(e.browser)var Hn="content"in document.createElement("template");T.prototype={constructor:T,toDOM:function(){if(this.dom)return this.dom;for(var t,n=document.createDocumentFragment(),r=0;t=this.children[r++];)n.appendChild(e.vdom(t,"toDOM"));return this.split=n.lastChild,this.dom=n},toHTML:function(){return this.children.map(function(t){return e.vdom(t,"toHTML")}).join("")}},e.vdom=e.vdomAdaptor=function(e,t){if(!e)return"toHTML"===t?"":document.createDocumentFragment();switch(e.nodeName){case"#text":return C.prototype[t].call(e);case"#comment":return A.prototype[t].call(e);case"#document-fragment":return T.prototype[t].call(e);case void 0:return new T(e)[t]();default:return E.prototype[t].call(e)}};var Ln={VText:C,VComment:A,VElement:E,VFragment:T};e.shadowCopy(e.vdom,Ln),e.domize=function(t){return e.vdom(t,"toDOM")},"function"==typeof Node&&(document.contains||(Node.prototype.contains=function(e){return!!(16&this.compareDocumentPosition(e))})),e.cloneNode=function(e){return e.cloneNode(!0)},e.contains=function(e,t){try{for(;t=t.parentNode;)if(t===e)return!0;return!1}catch(e){return!1}};var Pn=/\S+/g;"add,remove".replace(e.rword,function(t){e.fn[t+"Class"]=function(e){var n=this[0]||{};return e&&"string"==typeof e&&1===n.nodeType&&e.replace(Pn,function(e){n.classList[t](e)}),this}}),e.shadowCopy(e.fn,{hasClass:function(e){var t=this[0]||{};return 1===t.nodeType&&t.classList.contains(e)},toggleClass:function(e,t){var n="boolean"==typeof t,r=this;return String(e).replace(Pn,function(e){var o=n?t:!r.hasClass(e);r[o?"addClass":"removeClass"](e)}),this}});var Fn={"accept-charset":"acceptCharset",char:"ch",charoff:"chOff",class:"className",for:"htmlFor","http-equiv":"httpEquiv"},In=["autofocus,autoplay,async,allowTransparency,checked,controls","declare,disabled,defer,defaultChecked,defaultSelected,","isMap,loop,multiple,noHref,noResize,noShade","open,readOnly,selected"].join(",");In.replace(/\w+/g,function(e){Fn[e.toLowerCase()]=e});var zn=["accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan","dateTime,defaultValue,contentEditable,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign"].join(",");zn.replace(/\w+/g,function(e){Fn[e.toLowerCase()]=e});var Bn=/^\[object SVG\w*Element\]$/;e.parseJSON=JSON.parse,e.fn.attr=function(e,t){return 2===arguments.length?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)};var Rn=e.cssHooks,qn={float:"cssFloat"};e.cssNumber=e.oneObject("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom");var Un=["","-webkit-","-o-","-moz-","-ms-"];e.cssName=function(t,n,r){if(qn[t])return qn[t];n=n||e.root.style||{};for(var o=0,a=Un.length;o<a;o++)if(r=e.camelize(Un[o]+t),r in n)return qn[t]=r;return null},e.fn.css=function(t,n){if(e.isPlainObject(t))for(var r in t)e.css(this,r,t[r]);else var o=e.css(this,t,n);return void 0!==o?o:this},e.fn.position=function(){var t,n,r=this[0],o={top:0,left:0};return r?("fixed"===this.css("position")?n=r.getBoundingClientRect():(t=this.offsetParent(),n=this.offset(),"HTML"!==t[0].tagName&&(o=t.offset()),o.top+=e.css(t[0],"borderTopWidth",!0),o.left+=e.css(t[0],"borderLeftWidth",!0),o.top-=t.scrollTop(),o.left-=t.scrollLeft()),{top:n.top-o.top-e.css(r,"marginTop",!0),left:n.left-o.left-e.css(r,"marginLeft",!0)}):o},e.fn.offsetParent=function(){for(var t=this[0].offsetParent;t&&"static"===e.css(t,"position");)t=t.offsetParent;return e(t||e.root)},Rn["@:set"]=function(e,t,n){try{e.style[t]=n}catch(e){}},Rn["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&(n="filter"===t?r.getPropertyValue(t):r[t],""===n&&(n=e.style[t])),n},Rn["opacity:get"]=function(e){var t=Rn["@:get"](e,"opacity");return""===t?"1":t},"top,left".replace(e.rword,function(t){Rn[t+":get"]=function(n){var r=Rn["@:get"](n,t);return/px$/.test(r)?r:e(n).position()[t]+"px"}});var Yn={position:"absolute",visibility:"hidden",display:"block"},Zn=/^(none|table(?!-c[ea]).+)/;e.each({Width:"width",Height:"height"},function(t,n){var r="client"+t,o="scroll"+t,a="offset"+t;Rn[n+":get"]=function(n,r,o){var i=-4;"number"==typeof o&&(i=o),r="Width"===t?["Left","Right"]:["Top","Bottom"];var s=n[a];return 2===i?s+e.css(n,"margin"+r[0],!0)+e.css(n,"margin"+r[1],!0):(i<0&&(s=s-e.css(n,"border"+r[0]+"Width",!0)-e.css(n,"border"+r[1]+"Width",!0)),i===-4&&(s=s-e.css(n,"padding"+r[0],!0)-e.css(n,"padding"+r[1],!0)),s)},Rn[n+"&get"]=function(e){var t=[];M(e,t);for(var r,o=Rn[n+":get"](e),a=0;r=t[a++];){e=r.node;for(var i in r)"string"==typeof r[i]&&(e.style[i]=r[i])}return o},e.fn[n]=function(e){var i=this[0];if(0===arguments.length){if(i.setTimeout)return i["inner"+t]||i.document.documentElement[r]||i.document.body[r];if(9===i.nodeType){var s=i.documentElement;return Math.max(i.body[o],s[o],i.body[a],s[a],s[r])}return Rn[n+"&get"](i)}return this.css(n,e)},e.fn["inner"+t]=function(){return Rn[n+":get"](this[0],void 0,-2)},e.fn["outer"+t]=function(e){return Rn[n+":get"](this[0],void 0,e===!0?2:0)}}),e.fn.offset=function(){var e=this[0];try{var t=e.getBoundingClientRect();if(t.width||t.height||e.getClientRects().length){var n=e.ownerDocument,r=n.documentElement,o=n.defaultView;return{top:t.top+o.pageYOffset-r.clientTop,left:t.left+o.pageXOffset-r.clientLeft}}}catch(e){return{left:0,top:0}}},e.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){e.fn[t]=function(e){var r=this[0]||{},o=j(r),a="scrollTop"===t;return arguments.length?void(o?o.scrollTo(a?o[n]:e,a?e:o[n]):r[t]=e):o?o[n]:r[t]}});var Wn=/radio|checkbox/,Xn={"select:get":function e(t,n,r,o){var a,i=t.children,r=n?r:t.selectedIndex;o=n?o:"select-one"===t.type||r<0,n=n||[];for(var s,c=0;s=i[c++];)if(!s.disabled)switch(s.nodeName.toLowerCase()){case"option":if(s.selected||s.index===r){if(a=s.value,o)return a;n.push(a)}break;case"optgroup":if(a=e(s,n,r,o),"string"==typeof a)return a}return o?null:n},"select:set":function(e,t,n){t=[].concat(t);for(var r,o=0;r=e.options[o++];)(r.selected=t.indexOf(r.value)>-1)&&(n=!0);n||(e.selectedIndex=-1)}};e.fn.val=function(e){var t=this[0];if(t&&1===t.nodeType){var n=0===arguments.length,r=n?":get":":set",o=Xn[D(t)+r];if(o)var a=o(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?a:this};var Kn=/<|&#?\w+;/,Jn=new r(128),Gn=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi;e.parseHTML=function(t){var n=e.avalonFragment.cloneNode(!1);if("string"!=typeof t)return n;if(!Kn.test(t))return document.createTextNode(t);t=t.replace(Gn,"<$1></$2>").trim();var r=Jn.get(t);if(r)return e.cloneNode(r);for(var o,a=e.lexer(t),i=0;o=a[i++];)n.appendChild(e.vdom(o,"toDOM"));return t.length<1024&&Jn.put(t,n),n},e.innerHTML=function(e,t){var n=this.parseHTML(t);this.clearHTML(e).appendChild(n)},e.unescapeHTML=function(e){return String(e).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},e.clearHTML=function(e){for(e.textContent="";e.lastChild;)e.removeChild(e.lastChild);return e};var Qn={click:!0,dblclick:!0,keydown:!0,keypress:!0,keyup:!0,mousedown:!0,mousemove:!0,mouseup:!0,mouseover:!0,mouseout:!0,wheel:!0,mousewheel:!0,input:!0,change:!0,beforeinput:!0,compositionstart:!0,compositionupdate:!0,compositionend:!0,select:!0,cut:!0,copy:!0,paste:!0,beforecut:!0,beforecopy:!0,beforepaste:!0,focusin:!0,focusout:!0,DOMFocusIn:!0,DOMFocusOut:!0,DOMActivate:!0,dragend:!0,datasetchanged:!0},er=e.modern&&yn.ontouchstart;e.fn.bind=function(t,n,r){if(this[0])return e.bind(this[0],t,n,r)},e.fn.unbind=function(t,n,r){return this[0]&&e.unbind(this[0],t,n,r),this},e.bind=function(t,n,r){if(1===t.nodeType){var o=t.getAttribute("avalon-events")||"",i=a(r),s=bn[n];"click"===n&&er&&t.addEventListener("click",e.noop),s&&(n=s.type||n,s.fix&&(r=s.fix(t,r),r.uuid=i));var c=n+":"+i;e.eventListeners[r.uuid]=r,o.indexOf(n+":")===-1&&(Qn[n]||e.modern&&or[n]?H(n):e._nativeBind(t,n,V));var l=o.split(",");""===l[0]&&l.shift(),l.indexOf(c)===-1&&(l.push(c),t.setAttribute("avalon-events",l.join(",")))}else e._nativeBind(t,n,r);return r},e.unbind=function(t,n,r){if(1===t.nodeType){var o=t.getAttribute("avalon-events")||"";switch(arguments.length){case 1:e._nativeUnBind(t,n,V),t.removeAttribute("avalon-events");break;case 2:o=o.split(",").filter(function(e){return e.indexOf(n+":")===-1}).join(","),t.setAttribute("avalon-events",o);break;default:var a=n+":"+r.uuid;o=o.split(",").filter(function(e){return e!==a}).join(","),t.setAttribute("avalon-events",o),delete e.eventListeners[r.uuid]}}else e._nativeUnBind(t,n,r)};var tr={},nr=/^e/,rr=!1,or={focus:!0,blur:!0},ar=/^[A-Z_]+$/;if(L.prototype={fixEvent:function(){},preventDefault:function(){var e=this.originalEvent||{};e.returnValue=this.returnValue=!1,e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent||{};e.cancelBubble=this.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){rr=!0,this.stopPropagation()},toString:function(){return"[object Event]"}},"onmouseenter"in _n||e.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){bn[e]={type:t,fix:function(t,n){return function(r){var o=r.relatedTarget;if(!o||o!==t&&!(16&t.compareDocumentPosition(o)))return delete r.type,r.type=e,n.apply(this,arguments)}}}}),e.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){gn[e]&&!bn.animationend&&(bn.animationend={type:t})}),void 0===yn.onmousewheel){var ir=void 0!==yn.onwheel?"wheel":"DOMMouseScroll",sr="wheel"===ir?"deltaY":"detail";bn.mousewheel={type:ir,fix:function(e,t){return function(n){var r=n[sr]>0?-120:120;return n.wheelDelta=~~e._ms_wheel_+r,e._ms_wheel_=n.wheelDeltaY=n.wheelDelta,n.wheelDeltaX=0,Object.defineProperty&&Object.defineProperty(n,"type",{value:"mousewheel"}),t.apply(this,arguments)}}}}e._nativeBind=function(e,t,n,r){e.addEventListener(t,n,r)},e._nativeUnBind=function(e,t,n){e.removeEventListener(t,n)},e.fireDom=function(t,n,r){if(yn.createEvent){var o=yn.createEvent("Events");o.initEvent(n,!0,!0,r),e.shadowCopy(o,r),t.dispatchEvent(o)}};var cr={area:1,base:1,basefont:1,bgsound:1,br:1,col:1,command:1,embed:1,frame:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},lr=/input|textarea|select/i,ur=/^\:/;e.scan=function(t){return t&&t.nodeType?void B([t]):void e.warn("[avalon.scan] first argument must be element , documentFragment, or document")},e._hydrate=P;var dr,fr=!0,pr=[],vr=function(t){for(dr=!0;t=pr.shift();)t(e)};e.ready=function(t){dr?t(e):pr.push(t)},e.ready(function(){e.scan(yn.body)}),new function(){e.inBrowser&&("complete"===yn.readyState?setTimeout(vr):yn.addEventListener("DOMContentLoaded",vr),e.bind(gn,"load",vr))};var mr={};U.adjust=q;var hr=e.oneObject("$id,$render,$track,$element,$watch,$fire,$events,$skipArray,$accessors,$hashcode,$run,$wait,__proxy__,__data__,__const__"),gr={set:function(e,t){if(e>>>0===e&&this[e]!==t){if(e>this.length)throw Error(e+"set方法的第一个参数不能大于原数组长度");this.splice(e,1,t)}},contains:function(e){return this.indexOf(e)!==-1},ensure:function(e){return this.contains(e)||this.push(e),this},pushArray:function(e){return this.push.apply(this,e)},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>>>0===e?this.splice(e,1):[]},clear:function(){return this.removeAll(),this}},yr=Array.prototype,_r=yr.splice;gr.removeAll=function(e){var t=this.length;if(Array.isArray(e))for(var n=this.length-1;n>=0;n--)e.indexOf(this[n])!==-1&&_r.call(this,n,1);else if("function"==typeof e)for(n=this.length-1;n>=0;n--){var r=this[n];e(r,n)&&_r.call(this,n,1)}else _r.call(this,0,this.length);mr.toModel(this),X(this,t),this.notify()};var br=["push","pop","shift","unshift","splice"];br.forEach(function(e){var t=yr[e];gr[e]=function(n,r){var o=[],a=this.length;if("splice"===e&&Object(this[0])===this[0])for(var i=this.slice(n,r),s=yr.slice.call(arguments,2),o=[n,r],c=0,l=s.length;c<l;c++){var u=i[c];o[c+2]=mr.modelAdaptor(s[c],u,u&&u.$events||{},{id:this.$id+".*",master:!0})}else for(var d=0,f=arguments.length;d<f;d++)o[d]=mr.modelAdaptor(arguments[d],0,{},{id:this.$id+".*",master:!0});var p=t.apply(this,o);return mr.toModel(this),X(this,a),this.notify(),p}}),"sort,reverse".replace(/\w+/g,function(e){gr[e]=function(){return yr[e].apply(this,arguments),mr.toModel(this),this.notify(),this}});var wr=/function|window|date|regexp|element/i;mr.isSkip=K,mr.modelAdaptor=J,mr.makeAccessor=G,e.define=function(t){var n=t.$id;if(n||e.warn("vm.$id must be specified"),e.vmodels[n])throw Error("error:["+n+"] had defined!");var r=mr.masterFactory(t,{},{pathname:"",id:n,master:!0});return e.vmodels[n]=r},mr.arrayFactory=ee;var xr=/([^.]+)\.(.+)/;mr.$$skipArray=hr,mr.canHideProperty=!0,mr.toJson=oe,mr.toModel=function(){},mr.hideProperty=ae;var $r={get:function(){return oe(this)},set:e.noop,enumerable:!1,configurable:!0};mr.modelAccessor=$r,mr.initViewModel=ie,mr.createViewModel=Object.defineProperties;var Cr=mr.isSkip,Ar=mr.$$skipArray;delete Ar.$accessors,delete Ar.__data__,delete Ar.__proxy__,delete Ar.__const__;var Er=mr.makeAccessor,kr=mr.modelAccessor,Nr=mr.initViewModel,Tr=e.makeHashCode;mr.masterFactory=ue;var Or={};mr.slaveFactory=de,e.mediatorFactory=fe,e.directive("important",{priority:1,parse:function(e,t,n){var r=hn(n.expr);e.local="{}",e.vmodel="__vmodel__",e[n.name]=1,t.$prepend=["(function(__top__){","var __i = avalon.scopes["+r+"]","var ok = !__i || __i.vmodel === __top__","if( !ok ){",'vnodes.push({skipContent:true,nodeName:"'+e.nodeName+'"})','avalon.log("不进入"+'+r+");return }","var __vmodel__ = avalon.vmodels["+r+"];"].join("\n")+"\n",t.$append="\n})(__vmodel__);"},diff:function(e,t,n){t.dynamic[n]||(t.local=e.local,t.vmodel=e.vmodel,pe(t,this.update))},update:function(t,n,r){e.directives.controller.update(t,n,r,"important")}});var Mr={};e.mediatorFactoryCache=function(t,n){var r=e.vmodels[n];if(r&&t&&r!==t){var o=t.$hashcode,a=r.$hashcode,i=o+a;if(Mr[i])return Mr[i];var s=e.mediatorFactory(t,r);return Mr[i]=s}return t},e.directive("controller",{priority:2,parse:function(e,t,n){var r=hn(n.expr);e.local="__local__",e.vmodel="__vmodel__",e[n.name]=1,t.$prepend="(function(__top__){\nvar __vmodel__ = avalon.mediatorFactoryCache(__top__,"+r+")\n",t.$append="\n})(__vmodel__);"},diff:function(e,t,n){t.dynamic[n]||(t.local=e.local,t.vmodel=e.vmodel,pe(t,this.update))},update:function(t,n,r,o){var a=n.vmodel,i=n.local,s=o?"ms-important":"ms-controller";n.dynamic[s]=1;var c=n.props[s],l=e.scopes[c];if(!l){var u=e.vmodels[c];if(a.$element&&a.$element.vtree[0]===n)var d=a.$render;else d=e.render([n],i);a.$render=d,a.$element=t,t.vtree=[n],u!==a&&(u.$render=u.$render||d,u.$element=u.$element||t);var f=o?a:u,l=e.scopes[c]={vmodel:a,local:i};pe(n,function(){e(t).removeClass("ms-controller"),t.setAttribute("wid",c),e._disposeComponent&&e._disposeComponent(t);var n=f.$events.onReady;n&&(f.$fire("onReady"),delete f.$events.onReady),l.isMount=!0},"afterChange")}}});var jr=e.directive("css",{diff:function(t,n,r){var o=t[r],a=n[r];if(Object(o)===o){if(o=o.$model||o,Array.isArray(o)){var i={};o.forEach(function(t){t&&e.shadowCopy(i,t)}),o=i}var s=!1;if(n.dynamic[r]&&a){var c={};for(var l in o)o[l]!==a[l]&&(s=!0),c[l]=o[l];for(var l in a)l in c||(s=!0,c[l]="");n[r]=c}else n[r]=o,s=!0;s&&("ms-effect"===r&&(n[r]=o),pe(n,this.update))}delete t[r]},update:function(t,n){if(t&&1===t.nodeType){var r=e(t);n.dynamic["ms-css"]=1;var o=n["ms-css"];for(var a in o)r.css(a,o[a])}}}),Dr=jr.diff;e.directive("attr",{diff:Dr,update:O});var Sr="none";e.parseDisplay=ve,e.directive("visible",{diff:function(e,t,n){var r=!!e[n];t.dynamic[n]&&r===t[n]||(t[n]=r,pe(t,this.update))},update:function(t,n){if(t&&1===t.nodeType){n.dynamic["ms-visible"]=1;var r,o=n["ms-visible"],a=t.style.display;o?(a===Sr&&(r=n.displayValue,r||(t.style.display="")),""===t.style.display&&e(t).css("display")===Sr&&e.contains(t.ownerDocument,t)&&(r=ve(t))):a!==Sr&&(r=Sr,n.displayValue=a);var i=function(){void 0!==r&&(t.style.display=r)};e.applyEffect(t,n,{hook:o?"onEnterDone":"onLeaveDone",cb:i})}}}),e.directive("expr",{parse:e.noop}),e.directive("text",{parse:function(t,n,r){t[r.name]=1,n.children=[],t.children='[{\nnodeName:"#text",\ndynamic:true,\nnodeValue:avalon.parsers.string('+e.parseExpr(r)+")}]"},diff:function(e,t){t.children.length||pe(t,this.update)},update:function(e,t){if(e&&!t.isVoidTag){for(var n=e;n.firstChild;)n.removeChild(n.firstChild);var e=document.createTextNode("x");n.appendChild(e);var r={nodeType:3,nodeName:"#text",dom:e};t.children.push(r)}}}),e.directive("html",{parse:function(t,n,r){n.isVoidTag?t.children="[]":(t[r.name]=e.parseExpr(r),t.vmodel="__vmodel__",t.local="__local__")},diff:function(t,n,r){var o=t[r]+"";if(n.dynamic["ms-html"]&&n.render&&o===n[r]){if(n.render){var a=n.render(t.vmodel,t.local);t.children=a}}else{n[r]=o;var i=e.speedUp(e.lexer(o)),s=e.render(i,t.local);n.render=s;var a=s(t.vmodel,t.local);n.children=t.children=a,pe(n,this.update)}},update:function(t,n){n.dynamic["ms-html"]=1,e.clearHTML(t),t.appendChild(e.domize(n.children))}}),e.directive("class",{diff:function(e,t,n){var r=n.slice(3),o=e[n],a=t[n]||"",i=t.classEvent||{};"hover"===r?(i.mouseenter=he,i.mouseleave=ge):"active"===r&&(t.props.tabindex=e.props.tabindex||-1,i.tabIndex=t.props.tabindex,i.mousedown=he,i.mouseup=ge,i.mouseleave=ge),t.classEvent=i;var s=me(o);t.dynamic[n]&&a===s||(t[n]=s,t["change-"+r]=s,pe(t,this.update,r))},update:function(t,n){if(t&&1===t.nodeType){var r=n.classEvent;if(r){for(var o in r)"tabIndex"===o?t[o]=r[o]:e.bind(t,o,r[o]);n.classEvent={}}var a=["class","hover","active"];a.forEach(function(r){var o="change-"+r,a=n[o];if(void 0!==a)if(n.dynamic["ms-"+r]=1,"class"===r)t&&ye(t,n);else{var i=t.getAttribute("change-"+r);i&&e(t).removeClass(i),t.setAttribute(o,a)}})}}}),vn.active=vn.hover=vn.class;var Vr={mouseenter:"change-hover",mouseleave:"change-hover",mousedown:"change-active",mouseup:"change-active"};o(he),o(ge);var Hr=/^ms\-on\-(\w+)/;e.directive("on",{priority:3e3,parse:function(t,n,r){
var o=r.name.replace("ms-on-","e").replace("-","_"),a=o+"_"+r.expr.replace(/\s/g,"").replace(/[^$a-z]/gi,function(e){return e.charCodeAt(0)}),i=e.quote(a),s="(function(){\nvar fn610 = "+e.parseExpr(r)+"\nfn610.uuid ="+i+";\nreturn fn610})()";t.vmodel="__vmodel__",t.local="__local__",t[r.name]=s},diff:function(t,n,r){var o=t[r],a=o.uuid,i=n[r]||{},s=!1;n.dynamic[r]&&i.uuid===a||(n[r]=o,e.eventListeners[a]=o,s=!0),_e(n.local||{},t.local)&&(s=!0),s?(n.local=t.local,n.vmodel=t.vmodel,pe(n,this.update)):n.dom&&(n.dom._ms_local=t.local)},update:function(t,n){if(t&&1===t.nodeType){var r,o;t._ms_context_=n.vmodel,t._ms_local=n.local;for(r in n){var a=r.match(Hr);a&&(o=n[r],n.dynamic[r]=1,e.bind(t,a[1],o))}}}});var Lr=e.oneObject("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile");e.keyMap=Lr;var Pr={nodeName:1,forExpr:1,type:1,template:1,nodeValue:1,signature:1,wid:1},Fr=/[W\:-]/,Ir={input:function(e){var t=this;e=e||"value";var n=t.dom,r=n[e],o=t.parse(r);t.value=r,t.set(t.vmodel,o),xe(t);var a=t.pos;n.caret&&t.setCaret(n,a)},radio:function(){var e=this;if(e.isChecked){var t=!e.value;e.set(e.vmodel,t),xe(e)}else Ir.input.call(e),e.value=NaN},checkbox:function(){var t=this,n=t.value;Array.isArray(n)||(e.warn("ms-duplex应用于checkbox上要对应一个数组"),n=[n]);var r=t.dom.checked?"ensure":"remove";if(n[r]){var o=t.parse(t.dom.value);n[r](o),xe(t)}},select:function(){var t=this,n=e(t.dom).val();n+""!=this.value+""&&(n=Array.isArray(n)?n.map(function(e){return t.parse(e)}):t.parse(n),t.set(t.vmodel,n),xe(t))},contenteditable:function(){Ir.input.call(this,"innerHTML")}};e.msie;a(Ee),a(ke),a(Ne),a(Te),a(Ae),a($e);var zr=!1;try{var Br={},Rr=HTMLInputElement.prototype,qr=HTMLTextAreaElement.prototype,Ur=function(e){Br[this.tagName].call(this,e);var t=this.__ms_duplex__;!this.caret&&t&&t.isString&&t.update.call(this,{type:"setter"})},Yr=HTMLInputElement.prototype;Object.getOwnPropertyNames(Yr),Br.INPUT=Object.getOwnPropertyDescriptor(Rr,"value").set,Object.defineProperty(Rr,"value",{set:Ur}),Br.TEXTAREA=Object.getOwnPropertyDescriptor(qr,"value").set,Object.defineProperty(qr,"value",{set:Ur}),zr=!0}catch(e){}var Zr={input:function(){this.dom.value=this.value},radio:function(){var e;e=this.isChecked?!!this.value:this.value+""===this.dom.value;var t=this.dom;t.checked=e},checkbox:function(){for(var e=!1,t=this.dom,n=t.value,r=0;r<this.value.length;r++){var o=this.value[r];o+""===n&&(e=!0)}t.checked=e},select:function(){var t=Array.isArray(this.value)?this.value.map(String):this.value+"";e(this.dom).val(t)},contenteditable:function(){this.dom.innerHTML=this.value,this.update.call(this.dom)}},Wr=/\|\s*change\b/,Xr=/^(?:checkbox|radio)$/,Kr=/\|\s*debounce(?:\(([^)]+)\))?/,Jr="ms-duplex";e.directive("duplex",{priority:2e3,parse:function(t,n,r){var o,a=r.expr,i=n.props.type,s=r.param,c=!1;s=s?s.split("-").map(function(e){return"checked"===e&&(c=!0),e}):[],Xr.test(i)&&c&&(s=[],o="radio"),/input|textarea|select/.test(n.nodeName)?o||(o="select"===n.nodeName?"select":"checkbox"===i?"checkbox":"radio"===i?"radio":"input"):"contenteditable"in n.props&&(o="contenteditable");var l=!1,u=0;if("input"===o||"contenteditable"===o){var d=!0;if(Wr.test(a)&&(l=!0),!l){var f=a.match(Kr);f&&(u=parseInt(f[1],10)||300)}}var p=t.props["data-duplex-changed"],v=e.parseExpr(r),m=s.map(function(t){return e.quote(t)});t[Jr]=we({type:o,vmodel:"__vmodel__",local:"__local__",debug:e.quote(r.name+"="+r.expr),isChecked:c,parsers:"["+m+"]",isString:!!d,isChanged:l,debounceTime:u,get:v,set:e.evaluatorPool.get("duplex:set:"+a),callback:p?e.parseExpr({expr:p,type:"on"}):"avalon.noop"})},diff:function(e,t){if(t.dynamic[Jr])n=t[Jr];else{var n=t[Jr]=e[Jr];n.parse=De}e!==t&&(e[Jr]=null);var r=n.get(n.vmodel),o=n.value;if(n.isString){if(r=n.parse(r),r+="",r===o)return}else if(Array.isArray(r)){var a=!0;if(r+""===n.arrayHack)return}n.value=r,a&&(n.arayHack=r+""),pe(t,this.update,"afterChange")},update:function(t,n){if(t&&1===t.nodeType){n.dynamic[Jr]=1,t.__ms_duplex__||(t.__ms_duplex__=e.mix(n[Jr],{dom:t}),Ce(t,n),je(t,n));var r=t.__ms_duplex__;if(r.dom=t,r.isString&&!e.msie&&zr===!1&&!t.valueHijack){t.valueHijack=$e;var o=setInterval(function(){e.contains(e.root,t)?t.valueHijack({type:"poll"}):clearInterval(o)},30)}Zr[r.type].call(r)}}});var Gr=e.directive("validate",{diff:function(e,t,n){var r=e[n],o=t[n];if(!(o&&o.onError&&o.addField)&&Object(r)===r){t.vmValidator=r,r.$id&&(r=r.$model),t[n]=r;for(var n in Gr.defaults)r.hasOwnProperty(n)||(r[n]=Gr.defaults[n]);r.fields=r.fields||[],pe(t,this.update)}},update:function(t,n){function r(){Gr.validateAll.call(o,o.onValidateAll)}var o=n["ms-validate"];t._ms_validator_=o,o.dom=t;var a=n.vmValidator;try{a.onManual=r}catch(e){}delete n.vmValidator,t.setAttribute("novalidate","novalidate"),o.validateAllInSubmit&&e.bind(t,"submit",function(e){e.preventDefault(),r()}),"function"==typeof o.onInit&&o.onInit.call(t,{type:"init",target:t,validator:o})},validateAll:function(e){var t=this,n="function"==typeof e?e:t.onValidateAll,r=t.fields.filter(function(e){var n=e.dom;return n&&!n.disabled&&t.dom.contains(n)}).map(function(e){return Gr.validate(e,!0)});return Promise.all(r).then(function(e){var r=e.concat.apply([],e);if(t.deduplicateInValidateAll){var o={};r=r.filter(function(e){var t=e.element,n=t.uniqueID||(t.uniqueID=setTimeout("1"));return!o[n]&&(o[n]=!0)})}n.call(t.dom,r)})},addField:function(t){var n=this,r=t.dom;!n.validateInKeyup||t.isChanged||t.debounceTime||e.bind(r,"keyup",function(e){n.validate(t,0,e)}),n.validateInBlur&&e.bind(r,"blur",function(e){n.validate(t,0,e)}),n.resetInFocus&&e.bind(r,"focus",function(e){n.onReset.call(r,e,t)})},validate:function(t,n,r){var o=[],a=t.value,i=t.dom,s=t.validator;if("function"!=typeof Promise&&e.error("please npm install avalon-promise or bluebird"),!i.disabled){var c=t.rules;if(!c.norequired||""!==a)for(var l in c){var u=c[l];if(u!==!1){var d,f,p=e.validators[l];o.push(new Promise(function(e,t){d=e,f=t}));var v=function(e){if(e)d(!0);else{var n={element:i,data:t.data,message:i.getAttribute("data-"+l+"-message")||i.getAttribute("data-message")||p.message,validateRule:l,getMessage:Se};d(n)}};t.data={},t.data[l]=u,p.get(a,t,v)}}return Promise.all(o).then(function(e){var t=e.filter(function(e){return"object"==typeof e});return n||(t.length?s.onError.call(i,t,r):s.onSuccess.call(i,t,r),s.onComplete.call(i,t,r)),t})}}}),Qr=/\\?{{([^{}]+)\}}/gm;Gr.defaults={addField:Gr.addField,onError:e.noop,onSuccess:e.noop,onComplete:e.noop,onManual:e.noop,onReset:e.noop,onValidateAll:e.noop,validateInBlur:!0,validateInKeyup:!0,validateAllInSubmit:!0,resetInFocus:!0,deduplicateInValidateAll:!1},e.directive("rules",{diff:function(e,t,n){var r=e[n];if(r&&"[object Object]"===Object.prototype.toString.call(r)){t[n]=r.$model||r;var o=t.dom&&t.dom.__ms_duplex__;o&&(o.rules=e[n])}}});var eo=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,to=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/;e.shadowCopy(e.validators,{pattern:{message:"必须匹配{{pattern}}这样的格式",get:function(e,t,n){var r=t.dom,o=t.data;if(!Ve(o.pattern)){var a=r.getAttribute("pattern");o.pattern=new RegExp("^(?:"+a+")$")}return n(o.pattern.test(e)),e}},digits:{message:"必须整数",get:function(e,t,n){return n(/^\-?\d+$/.test(e)),e}},number:{message:"必须数字",get:function(e,t,n){return n(!!e&&isFinite(e)),e}},norequired:{message:"",get:function(e,t,n){return n(!0),e}},required:{message:"必须填写",get:function(e,t,n){return n(""!==e),e}},equalto:{message:"密码输入不一致",get:function(t,n,r){var o=String(n.data.equalto),a=e(document.getElementById(o)).val()||"";return r(t===a),t}},date:{message:"日期格式不正确",get:function(e,t,n){var r=t.data;return n(Ve(r.date)?r.date.test(e):He(e)),e}},url:{message:"URL格式不正确",get:function(e,t,n){return n(to.test(e)),e}},email:{message:"email格式不正确",get:function(e,t,n){return n(eo.test(e)),e}},minlength:{message:"最少输入{{minlength}}个字",get:function(e,t,n){var r=parseInt(t.data.minlength,10);return n(e.length>=r),e}},maxlength:{message:"最多输入{{maxlength}}个字",get:function(e,t,n){var r=parseInt(t.data.maxlength,10);return n(e.length<=r),e}},min:{message:"输入值不能小于{{min}}",get:function(e,t,n){var r=parseInt(t.data.min,10);return n(parseFloat(e)>=r),e}},max:{message:"输入值不能大于{{max}}",get:function(e,t,n){var r=parseInt(t.data.max,10);return n(parseFloat(e)<=r),e}},chs:{message:"必须是中文字符",get:function(e,t,n){return n(/^[\u4e00-\u9fa5]+$/.test(e)),e}}}),e.directive("if",{priority:6,diff:function(e,t,n,r,o,a){var i=!!e[n];t[n]=i,pe(t,this.update)},update:function(t,n,r){var o=n["ms-if"];if(n.dynamic["ms-if"]&&(n.dynamic["ms-if"]=n.nodeName),o){if("#comment"===n.nodeName){n.nodeName=n.dynamic["ms-if"],delete n.nodeValue;var a=n.comment;if(!a)return;r=a.parentNode,r&&r.replaceChild(t,a),delete n.comment,e.applyEffect(t,n,{hook:"onEnterDone"})}}else n.comment||(n.comment=document.createComment("if")),n.nodeName="#comment",n.nodeValue="if",e.applyEffect(t,n,{hook:"onLeaveDone",cb:function(){r=r||t.parentNode,r&&r.replaceChild(n.comment,t)}})}});var no=/\s+as\s+([$\w]+)/,ro=/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,oo=/^(null|undefined|NaN|window|this|\$index|\$id)$/,ao=/[$\w_]+/g;e._each=function(e,t,n,r){var o=[];r.push(o);var a=(t+"").slice(0,40).match(ao);if(a.shift(),Array.isArray(e))for(var i=0;i<e.length;i++)Pe(i,e[i],n,t,a[0],a[1],o,!0);else for(var i in e)e.hasOwnProperty(i)&&Pe(i,e[i],n,t,a[0],a[1],o)},e.directive("for",{priority:3,parse:function(t,n){var r,o=n.forExpr;o=o.replace(no,function(t,n){return!ro.test(n)||oo.test(n)?e.error("alias "+n+" is invalid --- must be a valid JS identifier which is not a reserved name."):r=n,""});var a=o.split(" in "),i={expr:a[1].trim(),type:"for"},s=e.parseExpr(i),c=(a[0]+" traceKey __local__ vnodes").match(ao);4===c.length&&c.unshift("$key"),n.$append=Array("var loop = "+s+";","avalon._each(loop, function("+c+"){","__local__["+hn(r||"valueOf")+"] = loop","vnodes.push({",'\tnodeName: "#document-fragment",',"\tindex   : arguments[0],","\tkey     : traceKey,","\tchildren: new function(){\nvar vnodes = []\n").join("\n")},diff:function(t,n,r,o,a){if(!e.callArray||!n.list||n.forExpr.indexOf(e.callArray)!==-1){var i,s,c,l=o[a+1],u=r[a+1],d=r[a+2],f=n.cache||{},p=[];if(l.length)if(l===u){u.forEach(function(e){e.action="move",Be(f,e)}),n.cache=f;var v=!0}else{n.action="update";var m={},h=[];for(i=0;s=u[i];i++){var c=ze(f,s.key);c?(c.oldIndex=c.index,c.index=s.index,Be(m,c)):h.push(s)}for(var s,i=0;s=h[i];i++)c=Ie(f,s.key),c?(c.oldIndex=c.index,c.index=s.index,c.key=s.key):(c=s,l.push(c)),Be(m,c);l.sort(function(e,t){return e.index-t.index}),n.cache=m;for(var i in f)c=f[i],c.action="leave",e.Array.remove(l,c),p.push(c),c.arr&&(c.arr.forEach(function(e){e.action="leave",p.push(e)}),delete c.arr)}else n.action="init",o[a+1]=u,u.forEach(function(e,t){l[t]=e,Be(f,e)}),n.cache=f;p.length>1&&p.sort(function(e,t){return e.index-t.index}),n.removes=p;var g=e.caches[n.wid],y=t.vmodel;return d&&g&&(d.afterChange=[function(e){g.call(y,{type:"rendered",target:e,signature:n.signature})}]),v||(n.list=l,pe(n,this.update)),!0}},update:function(t,n,r){if("init"===n.action){var o=r;r=document.createDocumentFragment()}for(var a,i=t,s=n.signature,c=0;a=n.removes[c++];)a.dom&&(delete a.split,n.hasEffect?!function(e){var t=Fe(e),n=e.children.concat();e.children.length=0,io(t,n,{hook:"onLeaveDone",staggerKey:s+"leave",cb:function(e){e.parentNode&&e.parentNode.removeChild(e)}})}(a):Fe(a,"add"));n.list.forEach(function(t,o){if("leave"!==t.action){t.dom||(t.dom=e.domize(t));var a=t.dom;if(void 0===t.oldIndex){if(n.hasEffect)var c=e.slice(a.childNodes);0===o&&"init"===n.action?r.appendChild(a):r.insertBefore(a,i.nextSibling),n.hasEffect&&io(c,t.children,{hook:"onEnterDone",staggerKey:s+"enter"})}else if(t.index!==t.oldIndex){var c=Fe(t,"add");r.insertBefore(t.dom,i.nextSibling),n.hasEffect&&io(c,t.children,{hook:"onMoveDone",staggerKey:s+"move"})}i=t.split}}),"init"===n.action&&o.insertBefore(r,t.nextSibling)}});var io=function(t,n,r){n.forEach(function(n,o){e.applyEffect(t[o],n,r)})},so=Re(e.cssName("transition-duration"),e.cssName("animation-duration"),e.window);e.directive("effect",{priority:5,diff:function(t,n,r){var o=t[r];"string"==typeof o&&(t[r]={is:o},e.warn("ms-effect的指令值不再支持字符串,必须是一个对象")),Dr.call(this,t,n,r,"afterChange")},update:function(t,n,r,o){if(t&&1===t.nodeType){var a="ms-effect",i=n[a]||o||{};n.dynamic[a]=1;var s=i.is;if(!s)return e.warn("need is option");var c=e.effects;so.css&&!c[s]&&e.effect(s);var l=c[s];if(!l)return e.warn(s+" effect is undefined");var u={},d=i.action;"boolean"==typeof d&&(u.action=d?"enter":"leave");var f=e.Effect,p=new f(t);e.mix(u,l,i),t.animating=u.action,u.queue?(co.push(function(){p[d](u)}),qe()):setTimeout(function(){p[d](u)},4)}}});var co=[];e.effect=function(t,n){var r=e.effects[t]=n||{};so.css&&r.css!==!1&&(Ue(r,"enterClass",t+"-enter"),Ue(r,"enterActiveClass",r.enterClass+"-active"),Ue(r,"leaveClass",t+"-leave"),Ue(r,"leaveActiveClass",r.leaveClass+"-active")),Ue(r,"action","enter")};var lo=function(e){this.el=e};e.Effect=lo,lo.prototype={enter:We("Enter"),leave:We("Leave"),move:We("Move")};var uo=/\d+s$/,fo=new r(128);e.applyEffect=function(t,n,r){var o=r.cb,a=n["ms-effect"];if(a&&t&&1===t.nodeType){var i=r.hook,s=a[i];o&&(Array.isArray(s)?s.push(o):s?a[i]=[s,o]:a[i]=[o]),Xe(r),e.directives.effect.update(t,n,0,e.shadowCopy({},r))}else o&&o(t)};var po=0,vo={map:{}},mo=/\?\?\d+/g,ho=/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,go=e.oneObject("script,style,textarea,xmp,noscript,option,template"),yo=/^<([-A-Za-z0-9_]+)\s*([^>]*?)(\/?)>/,_o=/^<\/([^>]+)>/,bo=/\S/,wo=/[\n\r]s*/g,xo=/([^=\s]+)(?:\s*=\s*(\S+))?/,$o=function(){return{children:[],props:{}}},Co=/^ms-(\w+)-?(.*)/,Ao=[],Eo=!1;e.suspendUpdate=0;var ko=/^(\:|ms\-)\w+/,No=e.oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),To=e.config,Oo=e.quote,Mo=/^[$a-zA-Z_][$a-zA-Z0-9_]*$/,jo=/^\s*var\s+([$\w]+)\s*\=\s*\S+/,Do={__local__:1,vmode:1,dom:1},So=/\n\s*/g,Vo=/^\s*ms\-for\:\s*/,Ho=/^\s*ms\-for\-end/,Lo=function(t){for(var n=[],r=!1,o=0;o<t.length;o++){var a=t[o],i="#comment"===a.nodeName;if(i&&Vo.test(a.nodeValue)){r=!0,n.push(a);var s=n;n=[],n.list=s,n.start=a}else if(i&&Ho.test(a.nodeValue)){var s=n;n=s.list;var c=s.start;delete s.list,delete s.start,n.push(s,a),a.dynamic=!0;var l=c.signature||(c.signature=e.makeHashCode("for"));if(a.signature=l,c.forExpr=c.nodeValue.replace(Vo,""),1===s.length){var u=s[0];if(u.props){u.props.slot&&(c.props='{slot: "'+u.props.slot+'"}');var d=u.props["data-for-rendered"];if(d){delete u.props["data-for-rendered"];var f=d+":cb";e.caches[f]||(e.caches[f]=Function("return "+e.parseExpr({type:"on",expr:d}))()),c.wid=f}}}for(var p=0;p<s.length;p++){var a=s[p],v=a.dom;v&&v.parentNode&&v.parentNode.removeChild(v)}c.hasEffect=Ct(s),Lo(s),e.caches[l]||(e.caches[l]=vt(s,!0)),s.length=0}else xt(a)&&(r=!0),n.push(a)}return t.length=0,t.push.apply(t,n),r},Po=e.evaluatorPool,Fo=/\(([^)]*)\)/,Io=/\|\|/g,zo=/\|(?=\?\?)/,Bo=/\s*(\.|\|)\s*/g,Ro=/^__vmodel__\.[$\w\.]+$/i,qo=/(^|[^\w\u00c0-\uFFFF_])(@|##)(?=[$\w])/g,Uo=/\.[\w\.\$]+/g,Yo=/[$a-zA-Z_][$a-zA-Z0-9_]*/g,Zo=/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/g;e.lexer=rt,e.diff=ct,e.batch=dt,e.speedUp=wt,e.parseExpr=At;var Wo=/\\\\(['"])/g;e.render=Ot;var Xo={wbr:1,xmp:1,template:1},Ko="onInit,onReady,onViewChange,onDispose",Jo=e.oneObject(Ko),Go=Ko.split(",").concat("is","define"),Qo=!0;e.insertSlots=function(t,n){for(var r,o=0;r=t[o];o++)if("#comment"===r.nodeName&&n[r.type]){var a=[o+1,0].concat(n[r.type]);t.splice.apply(t,a),o+=n[r.type].length}else r.children&&e.insertSlots(r.children,n)},e.collectSlots=function(e,t){var n={};return t?(n[t]=e.children,n.__sole__=t):e.children.forEach(function(t,r){var o=t.props&&t.props.slot;o&&(t.forExpr?n[o]=e.children.slice(r,r+2):Array.isArray(n[o])?n[o].push(t):n[o]=[t])}),n};var ea=/^[a-z]([a-z\d]+\-)+[a-z\d]+$/,ta=/^\w/,na=[],ra=0;return Ut.byMutationEvent=Bt,Ut.byRewritePrototype=Rt,Ut.byPolling=qt,e._disposeComponent=Ut,e.component=function(t,n){e.components[t]||(e.components[t]=n)},e.directive("widget",{priority:4,parse:function(t,n,r){n.props.wid=n.props.wid||e.makeHashCode("w"),t[r.name]=e.parseExpr(r),t.template=n.template,t.vmodel="__vmodel__",t.local="__local__"},define:function(){return e.mediatorFactory.apply(this,arguments)},diff:function(t,n,r,o,a,i){var s=t[r];if(Object(s)===s){var c=n.props.is||(/^ms\-/.test(n.nodeName)?n.nodeName:0);c||(s=s.$model||s,Array.isArray(s)&&(s.unshift({}),e.mix.apply(0,s),s=s.shift()),c=s.is);var l="component-vm:"+c;if(n.props.is=c,n.vmodel=t.vmodel,!n[l]&&!Mt(n,t[r],t.local,t.template))return n.nodeValue="unresolved component placeholder",o[i]=n,void pe(n,this.mountComment);var u=n[l],d=e.scopes[u.$id];if(d&&d.vmodel){var f=d.vmodel.$element;if(n.dom!==f){var p=f.vtree[0];return a[i]=o[i]=p,n.com=f,p.skipContent||(p.skipContent="optimize"),pe(n,this.replaceCachedComponent),void pe(p,function(){"optimize"===p.skipContent&&(p.skipContent=!0)},"afterChange")}}var v=u.$render,m=v(u,t.local),p=m[0];p&&Zt(p)?(p.local=t.local,Array(l,"component-html:"+c,"component-ready:"+c,"dom","dynamic").forEach(function(e){p[e]=n[e]}),p.vmodel=u,o[i]=p,n.comment&&n.nodeValue&&(p.dom=n.comment),n.nodeName!==p.nodeName?(a[i]=p,pe(p,this.mountComponent)):pe(n,this.updateComponent)):(n.nodeValue="unresolved component placeholder",o[i]={nodeValue:"unresolved component placeholder",nodeName:"#comment"},pe(n,this.mountComment))}else n.props.is===t.props.is&&pe(n,this.updateComponent)},replaceCachedComponent:function(e,t,n){var r=t.com;n.replaceChild(r,e),t.dom=r,delete t.com},mountComment:function(e,t,n){var r=document.createComment(t.nodeValue);t.dom=r,n.replaceChild(r,e)},updateComponent:function(e,t){var n=t["component-vm:"+t.props.is],r=n.$events.onViewChange;r&&r.length&&pe(t,Yt,"afterChange")},mountComponent:function(t,n,r){delete n.dom;var o=e.vdom(n,"toDOM"),a=n.props.is,i=n["component-vm:"+a];i.$fire("onInit",{type:"init",vmodel:i,is:a}),r.replaceChild(o,t),n.dom=i.$element=o,o.vtree=[n],e._disposeComponent(o),n["component-ready:"+a]=!0,e.scopes[i.$id]={vmodel:i,top:n.vmodel,local:n.local},pe(n,function(){i.$fire("onReady",{type:"ready",target:o,vmodel:i,is:a})},"afterChange"),pe(n,function(){n["component-html:"+a]=e.vdom(n,"toHTML")},"afterChange")}}),e});
//# sourceMappingURL=avalon.modern.min.js.map