"use strict";function createPlaceholder(t,e){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='"+t+"' height='"+e+"'%3E%3C/svg%3E"}function polyfillCurrentSrc(t){if(t.srcset&&!supportsCurrentSrc&&window.picturefill){var e=window.picturefill._;t[e.ns]&&t[e.ns].evaled||e.fillImg(t,{reselect:!0}),t[e.ns].curSrc||(t[e.ns].supported=!1,e.fillImg(t,{reselect:!0})),t.currentSrc=t[e.ns].curSrc||t.src}}function getStyle(t){for(var e,i=getComputedStyle(t).fontFamily,r={};null!==(e=propRegex.exec(i));)r[e[1]]=e[2];return r}function setPlaceholder(t,e,i){var r=createPlaceholder(e||1,i||0);nativeGetAttribute.call(t,"src")!==r&&nativeSetAttribute.call(t,"src",r)}function onImageReady(t,e){t.naturalWidth?e(t):setTimeout(onImageReady,100,t,e)}function fixOne(t){var e=getStyle(t),i=t[OFI];if(e["object-fit"]=e["object-fit"]||"fill",!i.img){if("fill"===e["object-fit"])return;if(!i.skipTest&&supportsObjectFit&&!e["object-position"])return}if(!i.img){i.img=new Image(t.width,t.height),i.img.srcset=nativeGetAttribute.call(t,"data-ofi-srcset")||t.srcset,i.img.src=nativeGetAttribute.call(t,"data-ofi-src")||t.src,nativeSetAttribute.call(t,"data-ofi-src",t.src),t.srcset&&nativeSetAttribute.call(t,"data-ofi-srcset",t.srcset),setPlaceholder(t,t.naturalWidth||t.width,t.naturalHeight||t.height),t.srcset&&(t.srcset="");try{keepSrcUsable(t)}catch(t){window.console&&console.log("http://bit.ly/ofi-old-browser")}}polyfillCurrentSrc(i.img),t.style.backgroundImage="url("+(i.img.currentSrc||i.img.src).replace("(","%28").replace(")","%29")+")",t.style.backgroundPosition=e["object-position"]||"center",t.style.backgroundRepeat="no-repeat",/scale-down/.test(e["object-fit"])?onImageReady(i.img,function(){i.img.naturalWidth>t.width||i.img.naturalHeight>t.height?t.style.backgroundSize="contain":t.style.backgroundSize="auto"}):t.style.backgroundSize=e["object-fit"].replace("none","auto").replace("fill","100% 100%"),onImageReady(i.img,function(e){setPlaceholder(t,e.naturalWidth,e.naturalHeight)})}function keepSrcUsable(t){var e={get:function(e){return t[OFI].img[e?e:"src"]},set:function(e,i){return t[OFI].img[i?i:"src"]=e,nativeSetAttribute.call(t,"data-ofi-"+i,e),fixOne(t),e}};Object.defineProperty(t,"src",e),Object.defineProperty(t,"currentSrc",{get:function(){return e.get("currentSrc")}}),Object.defineProperty(t,"srcset",{get:function(){return e.get("srcset")},set:function(t){return e.set(t,"srcset")}})}function hijackAttributes(){function t(t,e){return t[OFI]&&t[OFI].img&&("src"===e||"srcset"===e)?t[OFI].img:t}supportsObjectPosition||(HTMLImageElement.prototype.getAttribute=function(e){return nativeGetAttribute.call(t(this,e),e)},HTMLImageElement.prototype.setAttribute=function(e,i){return nativeSetAttribute.call(t(this,e),e,String(i))})}function fix(t,e){var i=!autoModeEnabled&&!t;if(e=e||{},t=t||"img",supportsObjectPosition&&!e.skipTest||!supportsOFI)return!1;"string"==typeof t?t=document.querySelectorAll(t):"length"in t||(t=[t]);for(var r=0;r<t.length;r++)t[r][OFI]=t[r][OFI]||{skipTest:e.skipTest},fixOne(t[r]);i&&(document.body.addEventListener("load",function(t){"IMG"===t.target.tagName&&fix(t.target,{skipTest:e.skipTest})},!0),autoModeEnabled=!0,t="img"),e.watchMQ&&window.addEventListener("resize",fix.bind(null,t,{skipTest:e.skipTest}))}var OFI="bfred-it:object-fit-images",propRegex=/(object-fit|object-position)\s*:\s*([-\w\s%]+)/g,testImg=new Image,supportsObjectFit="object-fit"in testImg.style,supportsObjectPosition="object-position"in testImg.style,supportsOFI="background-size"in testImg.style,supportsCurrentSrc="string"==typeof testImg.currentSrc,nativeGetAttribute=testImg.getAttribute,nativeSetAttribute=testImg.setAttribute,autoModeEnabled=!1;fix.supportsObjectFit=supportsObjectFit,fix.supportsObjectPosition=supportsObjectPosition,hijackAttributes(),module.exports=fix;
//# sourceMappingURL=ofi.common-js.min.js.map