angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(e,t,n,i,o,r){r=r||{};var u=0,a="ui-tinymce";return r.baseUrl&&(tinymce.baseURL=r.baseUrl),{require:["ngModel","^?form"],priority:999,link:function(s,c,m,d){function l(e){e?(f(),v&&v.getBody().setAttribute("contenteditable",!1)):(f(),v&&!v.settings.readonly&&v.getBody().setAttribute("contenteditable",!0))}function f(){v||(v=tinymce.get(m.id))}if(i.tinymce){var $,v,g=d[0],y=d[1]||null,b={},p=function(t){var n=t.getContent({format:b.format}).trim();n=o.trustAsHtml(n),g.$setViewValue(n),e.$$phase||s.$digest()};m.$set("id",a+"-"+u++),$={},angular.extend($,s.$eval(m.uiTinymce));var h={setup:function(e){e.on("init",function(){g.$render(),g.$setPristine(),g.$setUntouched(),y&&y.$setPristine()}),e.on("ExecCommand",function(){e.save(),p(e)}),e.on("change NodeChange",function(){e.save(),p(e)}),e.on("blur",function(){c[0].blur(),g.$setTouched(),s.$digest()}),e.on("ObjectResized",function(){e.save(),p(e)}),e.on("remove",function(){c.remove()}),$.setup&&$.setup(e,{updateView:p})},format:$.format||"html",selector:"#"+m.id};angular.extend(b,r,$,h),n(function(){b.baseURL&&(tinymce.baseURL=b.baseURL),tinymce.init(b),l(s.$eval(m.ngDisabled))}),g.$formatters.unshift(function(e){return e?o.trustAsHtml(e):""}),g.$parsers.unshift(function(e){return e?o.getTrustedHtml(e):""}),g.$render=function(){f();var e=g.$viewValue?o.getTrustedHtml(g.$viewValue):"";v&&v.getDoc()&&(v.setContent(e),v.fire("change"))},m.$observe("disabled",l),s.$on("$tinymce:refresh",function(e,n){var i=m.id;if(angular.isUndefined(n)||n===i){var o=c.parent(),r=c.clone();r.removeAttr("id"),r.removeAttr("style"),r.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),o.append(t(r)(s))}}),s.$on("$destroy",function(){f(),v&&(v.remove(),v=null)})}}}}]);