angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(e,t,n,i,r,o){o=o||{};var u=0,a="ui-tinymce";return o.baseUrl&&(tinymce.baseURL=o.baseUrl),{require:["ngModel","^?form"],link:function(c,s,m,l){function d(e){e?(f(),v&&v.getBody().setAttribute("contenteditable",!1)):(f(),v&&!v.settings.readonly&&v.getBody().setAttribute("contenteditable",!0))}function f(){v||(v=tinymce.get(m.id))}if(i.tinymce){var $,v,g=l[0],y=l[1]||null,b={},p=function(t){var n=t.getContent({format:b.format}).trim();n=r.trustAsHtml(n),g.$setViewValue(n),e.$$phase||c.$apply()};m.$set("id",a+"-"+u++),$={},angular.extend($,c.$eval(m.uiTinymce));var h={setup:function(e){e.on("init",function(){g.$render(),g.$setPristine(),y&&y.$setPristine()}),e.on("ExecCommand",function(){e.save(),p(e)}),e.on("change NodeChange",function(){e.save(),p(e)}),e.on("blur",function(){s[0].blur()}),e.on("ObjectResized",function(){e.save(),p(e)}),e.on("remove",function(){s.remove()}),$.setup&&$.setup(e,{updateView:p})},format:$.format||"html",selector:"#"+m.id};angular.extend(b,o,$,h),n(function(){b.baseURL&&(tinymce.baseURL=b.baseURL),tinymce.init(b),d(c.$eval(m.ngDisabled))}),g.$formatters.unshift(function(e){return e?r.trustAsHtml(e):""}),g.$parsers.unshift(function(e){return e?r.getTrustedHtml(e):""}),g.$render=function(){f();var e=g.$viewValue?r.getTrustedHtml(g.$viewValue):"";v&&v.getDoc()&&(v.setContent(e),v.fire("change"))},m.$observe("disabled",d),c.$on("$tinymce:refresh",function(e,n){var i=m.id;if(angular.isUndefined(n)||n===i){var r=s.parent(),o=s.clone();o.removeAttr("id"),o.removeAttr("style"),o.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),r.append(t(o)(c))}}),c.$on("$destroy",function(){f(),v&&(v.remove(),v=null)})}}}}]);