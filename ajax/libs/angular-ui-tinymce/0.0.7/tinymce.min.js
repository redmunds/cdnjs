angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$window","uiTinymceConfig",function(n,e,t){t=t||{};var i=0;return{require:["ngModel","^?form"],link:function(o,u,r,a){if(e.tinymce){var c,l,m,s=a[0],f=a[1]||null,$=function(e){l.raw===!0?s.$setViewValue(e.getContent({format:"text"}).trim()):s.$setViewValue(e.getContent().trim()),n.$$phase||o.$apply(),angular.isFunction(l.onChange)&&l.onChange()};r.id||r.$set("id","uiTinymce"+i++),c={},angular.extend(c,o.$eval(r.uiTinymce)),l={setup:function(n){n.on("init",function(){s.$render(),s.$setPristine(),f&&f.$setPristine()}),n.on("ExecCommand",function(){n.save(),$(n)}),n.on("change",function(e){e.originalEvent||(n.save(),$(n))}),n.on("blur",function(){u[0].blur()}),n.on("ObjectResized",function(){n.save(),$(n)}),c.setup&&c.setup(n,{updateView:$})},selector:"#"+r.id},angular.extend(l,t,c),tinymce.init(l),s.$formatters.unshift(function(n){return n||""}),s.$render=function(){m||(m=tinymce.get(r.id));var n=l.raw?"text":"raw";m&&m.getContent({format:n}).trim()!==s.$viewValue.replace(/\r\n/g,"\n")&&m.setContent(s.$viewValue)},o.$on("$destroy",function(){m||(m=tinymce.get(r.id)),m&&(m.remove(),m=null)})}}}}]);