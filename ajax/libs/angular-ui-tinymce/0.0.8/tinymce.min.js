angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(e,n,t,i,o,r){r=r||{};var u=0,a="ui-tinymce";return r.baseUrl&&(tinymce.baseURL=r.baseUrl),{require:["ngModel","^?form"],link:function(c,m,l,s){function d(){v||(v=tinymce.get(l.id))}if(i.tinymce){var f,$,v,g=s[0],y=s[1]||null,p=function(n){var t=n.getContent({format:$.format}).trim();$.trusted&&(t=o.trustAsHtml(t)),g.$setViewValue(t),e.$$phase||c.$apply()};l.$set("id",a+"-"+u++),f={},angular.extend(f,c.$eval(l.uiTinymce)),$={setup:function(e){e.on("init",function(){g.$render(),g.$setPristine(),y&&y.$setPristine()}),e.on("ExecCommand",function(){e.save(),p(e)}),e.on("change",function(n){n.originalEvent||(e.save(),p(e))}),e.on("blur",function(){m[0].blur()}),e.on("ObjectResized",function(){e.save(),p(e)}),e.on("remove",function(){m.remove()}),f.setup&&f.setup(e,{updateView:p})},format:"raw",selector:"#"+l.id},angular.extend($,r,f),t(function(){tinymce.init($)}),g.$formatters.unshift(function(e){return e||""}),g.$render=function(){d(),!v||!v.getDoc()||v.getContent({format:$.format}).trim()===g.$viewValue.replace(/\r\n/g,"\n")&&g.$viewValue&&g.$viewValue.replace(/\r\n/g,"\n")||v.setContent(g.$viewValue)},l.$observe("disabled",function(e){e?(d(),v&&v.getBody().setAttribute("contenteditable",!1)):(d(),v&&v.getBody().setAttribute("contenteditable",!0))}),c.$on("$tinymce:refresh",function(e,t){var i=l.id;if(angular.isUndefined(t)||t===i){var o=m.parent(),r=m.clone();r.removeAttr("id"),r.removeAttr("style"),r.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),o.append(n(r)(c))}}),c.$on("$destroy",function(){d(),v&&(v.remove(),v=null)})}}}}]);