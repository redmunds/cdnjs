angular.module("ui.tinymce",[]).value("uiTinymceConfig",{}).directive("uiTinymce",["$rootScope","$compile","$timeout","$window","$sce","uiTinymceConfig",function(e,t,n,i,r,o){o=o||{};var u=0,a="ui-tinymce";return o.baseUrl&&(tinymce.baseURL=o.baseUrl),{require:["ngModel","^?form"],link:function(c,s,m,d){function f(){v||(v=tinymce.get(m.id))}if(i.tinymce){var l,$,v,y=d[0],g=d[1]||null,p=function(t){var n=t.getContent({format:$.format}).trim();n=r.trustAsHtml(n),y.$setViewValue(n),e.$$phase||c.$apply()};m.$set("id",a+"-"+u++),l={},angular.extend(l,c.$eval(m.uiTinymce)),$={setup:function(e){e.on("init",function(){y.$render(),y.$setPristine(),g&&g.$setPristine()}),e.on("ExecCommand",function(){e.save(),p(e)}),e.on("change",function(t){e.save(),p(e)}),e.on("blur",function(){s[0].blur()}),e.on("ObjectResized",function(){e.save(),p(e)}),e.on("remove",function(){s.remove()}),l.setup&&l.setup(e,{updateView:p})},format:"raw",selector:"#"+m.id},angular.extend($,o,l),n(function(){tinymce.init($)}),y.$formatters.unshift(function(e){return e?r.trustAsHtml(e):""}),y.$parsers.unshift(function(e){return e?r.getTrustedHtml(e):""}),y.$render=function(){f();var e=y.$viewValue?r.getTrustedHtml(y.$viewValue):"";v&&v.getDoc()&&(v.setContent(e),v.fire("change"))},m.$observe("disabled",function(e){e?(f(),v&&v.getBody().setAttribute("contenteditable",!1)):(f(),v&&v.getBody().setAttribute("contenteditable",!0))}),c.$on("$tinymce:refresh",function(e,n){var i=m.id;if(angular.isUndefined(n)||n===i){var r=s.parent(),o=s.clone();o.removeAttr("id"),o.removeAttr("style"),o.removeAttr("aria-hidden"),tinymce.execCommand("mceRemoveEditor",!1,i),r.append(t(o)(c))}}),c.$on("$destroy",function(){f(),v&&(v.remove(),v=null)})}}}}]);