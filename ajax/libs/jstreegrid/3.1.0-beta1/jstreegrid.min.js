!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,r,i,s,d,a="_DATA_",n=24,l=!1,o=!1,h="jsgrid_",p="_col";s=/<\/?[^>]+>/gi,i=function(t,r){var i,s,d,a;return r._gridSettings=r._gridSettings||{},r._gridSettings.indent>0?a=r._gridSettings.indent:(i=e("<div></div>"),s=t.prev("i"),d=s.parent(),i.addClass(r.get_node("#",!0).attr("class")),d.appendTo(i),i.appendTo(e("body")),a=s.width()||n,d.detach(),i.remove(),r._gridSettings.indent=a),a},d=function(e,t){var r,i=e.get_node(t),s=i.children;return i.state.opened?s&&s.length>0&&(r=d(e,s[s.length-1])):r=t,r},t=function(e,t){var r,s,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return r=t.get_node(e).parents.length,s=a-r*i(e,t),d.css({"vertical-align":"top",overflow:"hidden"}),a},r=function(e,t,r){var i,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),n=r.settings.grid.columns[0];i="",n.title&&(n.title===a?i=r.get_text(t):t.attr(n.title)&&(i=t.attr(n.title))),i=i.replace(s,""),i&&d.attr("title",i)},e.jstree.defaults.grid={width:25},e.jstree.plugins.grid=function(i,a){this._initialize=function(){if(!this._initialized){var t,r,i=this.settings.grid||{},s=this.element,d=s.parent(),a=this._gridSettings={columns:i.columns||[],treeClass:"jstree-grid-col-0",columnWidth:i.width,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:i.resizable,indent:0},n=a.columns,l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var h=parseFloat(navigator.appVersion.split("MSIE")[1]);8>h&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;}",".jstree-grid-separator {position:absolute; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-table {table-layout: fixed; width: 100%;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.table=e("<table></table>").addClass("jstree-grid-table"),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(d).append(this.table),this.dataRow=e("<tr></tr>"),this.headerRow=e("<tr></tr>"),this.headerPullers=e("<div></div>"),this.table.append(this.headerRow),this.table.append(this.dataRow),this.gridWrapper.prepend(this.headerPullers),r=0;r<n.length;r++)this.dataRow.append(e("<td></td>").addClass("jstree-grid-cell"));this.dataRow.children("td:first").append(s),this._initialized=!0}},this.init=function(e,t){a.init.call(this,e,t),this._initialize()},this.bind=function(){a.bind.call(this),this._initialize(),this.element.on("create_node.jstree redraw.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var r=this.get_node(t||"#",!0);this._prepare_grid(r)},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,r){var i=this.element.find("li a:first").css("line-height");e('<style type="text/css">td.jstree-grid-cell {line-height: '+i+"}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(r,i){var s=i.new_instance.element;t(s,this),s.find("li > a").each(e.proxy(function(r,i){t(e(i),this)},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,r){var i=t.node.id;this.dataRow.find("."+h+i+p).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,r){var i=t.node.id;this.dataRow.find("."+h+i+p).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,r){this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,r){this.get_node(t.node.id,!0).children("div.jstree-grid-cell").removeClass("jstree-clicked")},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var t=this.parent,r=this.element;r.detach(),e("div.jstree-grid-wrapper",t).remove(),t.append(r),a.teardown.call(this)},this._prepare_headers=function(){var t,r,i,s,d,a,n,o,h,p,g=this._gridSettings,c=g.columns||[],u=g.columnWidth,f=g.resizable||!1,v=g.isThemeroller,j=v?"themeroller":"regular",w=0,m=this.gridparent,_=this.headerPullers,x=g.defaultConf,C=!1,y=0,b=0,S=null,z=0,T={},R=null,H=0,A=0;for(this.parent=m,t=this.headerRow,t.addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+j),r=0;r<c.length;r++)s=c[r].headerClass||"",d=c[r].header||"",d&&(w=!0),i=c[r].width||u,H=v?7:10,i-=H,a=0===r?3:0,n=e("<th></th>").css(x).css({"margin-left":a,width:i,padding:"1px 3px 2px 5px"}).addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+j+" "+s).text(d).appendTo(t),A+=n.outerWidth(),o=e("<div class='jstree-grid-separator jstree-grid-separator-"+j+(v?" ui-widget-header":"")+(f?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(_),o.css({height:24,left:A});o.remove(),n.addClass((v?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+j),void 0===c[c.length-1].width&&(A-=i,n.css({width:"auto",display:"block"}).addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),w?(g.divOffset=t.parent().offset().left,g.header=t):this.headerRow.css("display","none"),!l&&f&&(l=!0,e(document).mouseup(function(){var t,r,i,s,d,a;if(C){for(r=e.jstree.reference(S),i=r.settings.grid.columns,d=R.closest(".jstree-grid-wrapper").find(".jstree-grid-header"),s=[],(isNaN(z)||0>z)&&(r._gridSettings.treeWidthDiff=S.find("ins:eq(0)").width()+S.find("a:eq(0)").width()-r._gridSettings.columns[0].width),C=!1,t=0;t<i.length;t++)a=parseFloat(d[t].style.width)+H,s[t]={w:a,r:t===z},r._gridSettings.columns[t].width=a;S.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(C){b=e.clientX;var t,r,i,s,d,a,n,l,o,g,c,u,f=b-y,v=p.offset().left+p.width();v+f>h&&(f=0),0!==f&&(t=T.prevHeader.width(),r=T.nextHeader.width(),i=parseFloat(T.prevHeader.css("width")),s=parseFloat(T.nextHeader.css("width")),d=parseFloat(T.prevSeparator.css("left")),a=parseFloat(T.nextSeparator.css("left")),n=parseFloat(T.prevHeader.css("margin-left")),f=0>f?Math.max(f,-t):Math.min(f,r),l=t+f+"px",o=r-f+"px",g=d+f,c=a-f,u=n+f,(0>f&&t>0||f>0&&r>0)&&(T.prevHeader.width(l),T.prevSeparator.css("left",g),T.nextHeader.hasClass("jstree-grid-width-auto")?T.nextHeader.css("margin-left",u):T.nextHeader.width(o),y=b))}}),_.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(r){var i;return R=e(this),C=!0,S=R.closest(".jstree-grid-wrapper").find(".jstree"),y=r.clientX,z=R.prevAll(".jstree-grid-resizable-separator").length-1,T.prevSeparator=R,T.prevHeader=t.find(".jstree-grid-header:eq("+(z+1)+")"),T.nextSeparator=R.next(),T.nextHeader=t.find(".jstree-grid-header:eq("+(z+2)+")"),i=R.parent(),h=i.offset().left+i.width()-15,p=i.children(".jstree-grid-separator:last"),!1}))},this.redraw_node=function(e,t,r){return e=a.redraw_node.call(this,e,t,r),e&&this._prepare_grid(e),e},this._hide_grid=function(e){var t,r=this.dataRow,i=e.node.children_d||[];for(t=0;t<i.length;t++)r.find("td div."+h+i[t]+p).remove()},this.holdingCells={},this._prepare_grid=function(i){var a,n,l,o,g,c,u,f,v,j,w,m,_,x,C,y,b,S,z,T,R,H,A,W,F,P=this._gridSettings,k=P.treeClass,V=this,q=P.columns||[],D=P.isThemeroller,N=D?"themeroller":"regular",I=this.get_node(i),L=P.columnWidth,M=P.defaultConf,E=function(t,r,i){return function(){e(this).trigger("select_cell.jstree-grid",[{value:t,column:r.header,node:e(this).closest("li"),sourceName:r.value,sourceType:i}])}},Q=this.dataRow,X=this.get_node(I.parent).children;if(a=e(i),f=a.children("a"),W=a.attr("id"),1===f.length){for(C=h+W+p,y="#"===I.parent?null:h+I.parent+p,f.addClass(k),t(f,V),r(f,a,V),v=f,o=1;o<q.length;o++)A=Q.children("td:eq("+o+")"),z=q[o],c=z.cellClass||"",u=z.wideCellClass||"",g=void 0!==z.value&&null!==z.value&&null!==I.data&&void 0!==I.data?"function"==typeof z.value?z.value(I.data):void 0!==I.data[z.value]?I.data[z.value]:"":"",z.images?(l=z.images[g]||z.images["default"],l&&(T="*"===l[0]?'<span class="'+l.substr(1)+'"></span>':'<img src="'+l+'">')):T=g,j=z.valueClass&&a.attr(z.valueClass)?a.attr(z.valueClass):"",j&&z.valueClassPrefix&&""!==z.valueClassPrefix&&(j=z.valueClassPrefix+j),w=z.wideValueClass&&a.attr(z.wideValueClass)?a.attr(z.wideValueClass):"",w&&z.wideValueClassPrefix&&""!==z.wideValueClassPrefix&&(w=z.wideValueClassPrefix+w),x=z.title&&a.attr(z.title)?a.attr(z.title):"",x=x.replace(s,""),_=7,n=z.width||L,n=H||n-_,v=A.children("div#"+C+o),(!v||v.length<1)&&(v=e("<div></div>"),y?(F=jQuery.inArray(W,X),S=h+(0>=F?I.parent:d(this,X[F-1]))+p+o,b=A.find("div#"+S),b&&b.length>0?v.insertAfter(b):this.holdingCells[S]=(this.holdingCells[S]||e()).add(v)):v.appendTo(A),e("<span></span>").appendTo(v),v.attr("id",C+o),v.addClass(C),this.holdingCells[C+o]&&(v.after(this.holdingCells[C+o]),delete this.holdingCells[C+o])),m=v.children("span"),m.addClass(c+" "+j).css({"margin-right":"0px","*display":"inline","*+display":"inline"}).html(T).click(E(g,z,R)),v=v.css(M).css({"margin-left":0,position:"relative",width:"100%","padding-left":_+"px"}).addClass("jstree-grid-cell jstree-grid-cell-"+N+" "+u+" "+w+(D?" ui-state-default":"")).addClass("jstree-grid-col-"+o),x&&m.attr("title",x);v.addClass("jstree-grid-cell-last"+(D?" ui-state-default":"")),void 0===q[q.length-1].width&&v.css({width:"auto",display:"block"}).addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})}}});
//# sourceMappingURL=jstreegrid.min.js.map