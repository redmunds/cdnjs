!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,i,r,s,d,n=/^\s*$/g,a=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,l="_DATA_",o=24,h=!1,c=!1,g="jsgrid_",p="_col";s=/<\/?[^>]+>/gi,r=function(t,i){var r,s,d,n;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?n=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),d=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),d.appendTo(r),r.appendTo(e("body")),n=s.width()||o,d.detach(),r.remove(),i._gridSettings.indent=n),n},d=function(e,t){var i,r=e.get_node(t),s=r.children;return i=!s||s.length<=0||!r.state.opened?t:d(e,s[s.length-1])},t=function(e,t){var i,s,d=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,s=d-i*r(e,t),d},i=function(e,t,i){var r,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),n=i.settings.grid.columns[0];r="",n.title&&(n.title===l?r=i.get_text(t):t.attr(n.title)&&(r=t.attr(n.title))),r=r.replace(s,""),r&&d.attr("title",r)},e.jstree.defaults.grid={width:25},e.jstree.plugins.grid=function(t,r){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,d=s.parent(),n=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",columnWidth:r.width,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},a=n.columns,l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var o=parseFloat(navigator.appVersion.split("MSIE")[1]);8>o&&(n.defaultConf.display="inline",n.defaultConf.zoom="1")}for(c||(c=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-table {table-layout: fixed; width: 100%;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.table=e("<table></table>").addClass("jstree-grid-table"),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(d).append(this.table),this.dataRow=e("<tr></tr>"),this.headerRow=e("<tr></tr>"),this.colgroup=e("<colgroup></colgroup>"),this.table.append(this.colgroup),this.table.append(this.headerRow),this.table.append(this.dataRow),i=0;i<a.length;i++)this.dataRow.append(e("<td></td>").addClass("jstree-grid-cell"));this.dataRow.children("td:first").append(s),this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.dataRow,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),i=0;i<s.length;i++)r.find("div."+g+s[i]+p).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").css("line-height");e('<style type="text/css">td.jstree-grid-cell {line-height: '+r+"}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&this.dataRow.find("."+g+this._hover_node+p).removeClass("jstree-hovered"),this._hover_node=r,this.dataRow.find("."+g+r+p).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,this.dataRow.find("."+g+r+p).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this.dataRow.find("."+g+r+p).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this.dataRow.find("."+g+r+p).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,s=t.node||[];for(r=0;r<s.length;r++)this.dataRow.find("."+g+s[r]+p).removeClass("jstree-clicked")},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.dataRow;e?i.find("div."+g+t+p).remove():i.children("td:gt(0)").find("div").remove()},this._prepare_headers=function(){var t,i,r,s,d,n,a,l,o,c,g,p=this._gridSettings,u=p.columns||[],f=p.columnWidth,v=p.resizable||!1,_=p.isThemeroller,j=_?"themeroller":"regular",w=!1,m=this.gridparent,C=p.defaultConf,x=!1,y=0,b=0,R=null,z=0,T={},S=null,A=0,W=0;for(this.parent=m,t=this.headerRow,t.addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+j),g=this.colgroup,i=0;i<u.length;i++)r=e("<col/>"),r.appendTo(g),d=u[i].headerClass||"",n=u[i].columnClass||"",a=u[i].header||"",a&&(w=!0),s=u[i].width||f,A=_?7:10,s-=A,l=0===i?3:0,r.css({width:s}),o=e("<th></th>").css(C).css({"margin-left":l}).addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+j+" "+d+" "+n).text(a).appendTo(t),W+=o.outerWidth(),c=e("<div class='jstree-grid-separator jstree-grid-separator-"+j+(_?" ui-widget-header":"")+(v?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(o);c.remove(),o.addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+j),void 0===u[u.length-1].width&&(W-=s,r.css({width:"auto"}),o.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),w?(p.divOffset=t.parent().offset().left,p.header=t):this.headerRow.css("display","none"),!h&&v&&(h=!0,e(document).mouseup(function(){var t,i,r,s,d,n;if(x){for(i=e.jstree.reference(R),r=i.settings.grid.columns,d=g.children("col"),s=[],(isNaN(z)||0>z)&&(i._gridSettings.treeWidthDiff=R.find("ins:eq(0)").width()+R.find("a:eq(0)").width()-i._gridSettings.columns[0].width),x=!1,t=0;t<r.length;t++)n=parseFloat(d[t].style.width),s[t]={w:n,r:t===z},i._gridSettings.columns[t].width=n;R.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(x){b=e.clientX;var t,i,r,s,d,n,a=b-y;0!==a&&(t=T.prevHeader.width(),i=T.nextHeader.width(),r=parseFloat(T.prevCol.css("width")),s=parseFloat(T.nextCol.css("width")),a=0>a?Math.max(a,-t):Math.min(a,i),d=r+a+"px",n=s-a+"px",(0>a&&t>0||a>0&&i>0)&&(T.prevCol.width(d),T.nextHeader.hasClass("jstree-grid-width-auto")||T.nextCol.width(n),y=b))}}),t.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){var i;return S=e(this),x=!0,R=S.closest(".jstree-grid-wrapper").find(".jstree"),y=t.clientX,z=S.closest("th").prevAll("th").length,T.prevCol=g.children("col:eq("+z+")"),T.nextCol=T.prevCol.next("col"),T.prevHeader=S.closest("th"),T.nextHeader=T.prevHeader.next("th"),i=S.parent(),!1}))},this.redraw_node=function(e,t,i,s){return e=r.redraw_node.call(this,e,t,i,s),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),r.refresh.call(this)},this._hide_grid=function(e){var t,i=this.dataRow,r=e&&e.children_d?e.children_d:[];for(t=0;t<r.length;t++)i.find("td div."+g+r[t]+p).remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var s,d,n=e(),a=t.children||[];for(d=0;d<a.length;d++)s=g+a[d]+p+i,r[s]&&(n=n.add(r[s]).add(this.getHoldingCells(this.get_node(a[d]),i,r)),delete r[s]);return n},this._prepare_grid=function(t){var r,l,o,h,c,u,f,v,_,j,w,m,C,x,y,b,R,z,T,S,A,W,H,k,V,F,L,N,P,q=this._gridSettings,B=q.treeClass,D=this,I=q.columns||[],M=q.isThemeroller,$=this.element,E=M?"themeroller":"regular",Q=this.get_node(t),U=q.columnWidth,X=q.defaultConf,O=function(t,i,r,s,d){return function(){d.deselect_all(),d.select_node(i.attr("id")),t.trigger("select_cell.jstree-grid",[{value:r,column:s.header,node:i,grid:e(this),sourceName:s.value}])}},G=this.dataRow,J=Q.id,K=this.get_node(Q.parent).children,Y=jQuery.inArray(J,K),Z=this.holdingCells,ee=!1;if(r=e(t),_=r.children("a"),1===_.length){for(P=!Q.state.opened,b=g+J+p,b=b.replace(a,"\\$&"),R="#"===Q.parent?null:g+Q.parent+p,_.addClass(B),i(_,r,D),j=_,h=1;h<I.length;h++)N=G.children("td:eq("+h+")"),V=I[h],u=V.cellClass||"",f=V.wideCellClass||"",v=V.columnClass||"",N.addClass(v),c=void 0!==V.value&&null!==V.value&&null!==Q.data&&void 0!==Q.data?"function"==typeof V.value?V.value(Q.data):void 0!==Q.data[V.value]?Q.data[V.value]:"":"",V.images?(o=V.images[c]||V.images["default"],o&&(F="*"===o[0]?'<span class="'+o.substr(1)+'"></span>':'<img src="'+o+'">')):F=c,(void 0===F||null===F||n.test(F))&&(F="&nbsp;"),w=V.valueClass&&r.attr(V.valueClass)?r.attr(V.valueClass):"",w&&V.valueClassPrefix&&""!==V.valueClassPrefix&&(w=V.valueClassPrefix+w),m=V.wideValueClass&&r.attr(V.wideValueClass)?r.attr(V.wideValueClass):"",m&&V.wideValueClassPrefix&&""!==V.wideValueClassPrefix&&(m=V.wideValueClassPrefix+m),y=V.title&&r.attr(V.title)?r.attr(V.title):"",y=y.replace(s,""),x=7,l=V.width||U,l=L||l-x,j=N.children("div#"+b+h),(!j||j.length<1)&&(j=e("<div></div>"),e("<span></span>").appendTo(j),j.attr("id",b+h),j.addClass(b)),S=g+(0>=Y?Q.parent:d(this,K[Y-1]))+p+h,T=N.find("div#"+S),W=g+(Y>=K.length-1?"NULL":K[Y+1])+p+h,A=N.find("div#"+W),k=g+(Q.children&&Q.children.length>0?Q.children[0]:"NULL")+p+h,H=N.find("div#"+k),z=N.find("div#"+R+h),R?z&&z.length>0?(T&&T.length>0?j.insertAfter(T):H&&H.length>0?j.insertBefore(H):A&&A.length>0?j.insertBefore(A):j.insertAfter(z),ee=!0):(Z[b+h]=j,ee=!1):(T&&T.length>0?j.insertAfter(T):H&&H.length>0?j.insertBefore(H):A&&A.length>0?j.insertBefore(A):j.appendTo(N),ee=!0),ee&&j.after(this.getHoldingCells(Q,h,Z)),C=j.children("span"),C.addClass(u+" "+w).html(F),j=j.css(X).addClass("jstree-grid-cell jstree-grid-cell-"+E+" "+f+" "+m+(M?" ui-state-default":"")).addClass("jstree-grid-col-"+h),j.click(O($,r,c,V,this)),y&&C.attr("title",y);j.addClass("jstree-grid-cell-last"+(M?" ui-state-default":"")),void 0===I[I.length-1].width&&j.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})}}});
//# sourceMappingURL=jstreegrid.min.js.map