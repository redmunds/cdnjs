!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,i,r,s,d,a="_DATA_",n=24,l=!1,o=!1,h="jsgrid_",g="_col";s=/<\/?[^>]+>/gi,r=function(t,i){var r,s,d,a;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?a=i._gridSettings.indent:(r=e("<div></div>"),s=t.prev("i"),d=s.parent(),r.addClass(i.get_node("#",!0).attr("class")),d.appendTo(r),r.appendTo(e("body")),a=s.width()||n,d.detach(),r.remove(),i._gridSettings.indent=a),a},d=function(e,t){var i,r=e.get_node(t),s=r.children;return r.state.opened?s&&s.length>0&&(i=d(e,s[s.length-1])):i=t,i},t=function(e,t){var i,s,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),a=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,s=a-i*r(e,t),d.css({"vertical-align":"top",overflow:"hidden"}),a},i=function(e,t,i){var r,d="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),n=i.settings.grid.columns[0];r="",n.title&&(n.title===a?r=i.get_text(t):t.attr(n.title)&&(r=t.attr(n.title))),r=r.replace(s,""),r&&d.attr("title",r)},e.jstree.defaults.grid={width:25},e.jstree.plugins.grid=function(r,a){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},s=this.element,d=s.parent(),a=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",columnWidth:r.width,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},n=a.columns,l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var h=parseFloat(navigator.appVersion.split("MSIE")[1]);8>h&&(a.defaultConf.display="inline",a.defaultConf.zoom="1")}for(o||(o=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;}",".jstree-grid-separator {position:absolute; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-table {table-layout: fixed; width: 100%;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.table=e("<table></table>").addClass("jstree-grid-table"),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(d).append(this.table),this.dataRow=e("<tr></tr>"),this.headerRow=e("<tr></tr>"),this.table.append(this.headerRow),this.table.append(this.dataRow),i=0;i<n.length;i++)this.dataRow.append(e("<td></td>").addClass("jstree-grid-cell"));this.dataRow.children("td:first").append(s),this._initialized=!0}},this.init=function(e,t){a.init.call(this,e,t),this._initialize()},this.bind=function(){a.bind.call(this),this._initialize(),this.element.on("create_node.jstree redraw.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").css("line-height");e('<style type="text/css">td.jstree-grid-cell {line-height: '+r+"}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(i,r){var s=r.new_instance.element;t(s,this),s.find("li > a").each(e.proxy(function(i,r){t(e(r),this)},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this.dataRow.find("."+h+r+g).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this.dataRow.find("."+h+r+g).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){this.get_node(t.node.id,!0).children("div.jstree-grid-cell").removeClass("jstree-clicked")},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var t=this.parent,i=this.element;i.detach(),e("div.jstree-grid-wrapper",t).remove(),t.append(i),a.teardown.call(this)},this._prepare_headers=function(){var t,i,r,s,d,a,n,o,h=this._gridSettings,g=h.columns||[],c=h.columnWidth,p=h.resizable||!1,u=h.isThemeroller,f=u?"themeroller":"regular",v=0,j=this.gridparent,w=h.defaultConf,m=!1,_=0,C=0,x=null,y=0,b={},z=null,T=0,H=0;for(this.parent=j,t=this.headerRow,t.addClass((u?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+f),i=0;i<g.length;i++)s=g[i].headerClass||"",d=g[i].header||"",d&&(v=!0),r=g[i].width||c,T=u?7:10,r-=T,a=0===i?3:0,n=e("<th></th>").css(w).css({"margin-left":a,width:r,padding:"1px 3px 2px 5px"}).addClass((u?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+f+" "+s).text(d).appendTo(t),H+=n.outerWidth(),o=e("<div class='jstree-grid-separator jstree-grid-separator-"+f+(u?" ui-widget-header":"")+(p?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(n),o.css({height:24,"float":"right",position:"relative"});o.remove(),n.addClass((u?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+f),void 0===g[g.length-1].width&&(H-=r,n.css({width:"auto",display:"block"}).addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),v?(h.divOffset=t.parent().offset().left,h.header=t):this.headerRow.css("display","none"),!l&&p&&(l=!0,e(document).mouseup(function(){var t,i,r,s,d,a;if(m){for(i=e.jstree.reference(x),r=i.settings.grid.columns,d=z.closest(".jstree-grid-wrapper").find(".jstree-grid-header"),s=[],(isNaN(y)||0>y)&&(i._gridSettings.treeWidthDiff=x.find("ins:eq(0)").width()+x.find("a:eq(0)").width()-i._gridSettings.columns[0].width),m=!1,t=0;t<r.length;t++)a=parseFloat(d[t].style.width)+T,s[t]={w:a,r:t===y},i._gridSettings.columns[t].width=a;x.trigger("resize_column.jstree-grid",s)}}).mousemove(function(e){if(m){C=e.clientX,console.log("mousemove newMouseX oldMouseX "+C+" "+_);var t,i,r,s,d,a,n,l,o=C-_;0!==o&&(t=b.prevHeader.width(),i=b.nextHeader.width(),r=parseFloat(b.prevHeader.css("width")),s=parseFloat(b.nextHeader.css("width")),d=parseFloat(b.prevHeader.css("margin-left")),o=0>o?Math.max(o,-t):Math.min(o,i),a=t+o+"px",n=i-o+"px",l=d+o,console.log("diff/newPrevHeaderWidth/newNextHeaderWidth "+[o,a,n].join("/")),(0>o&&t>0||o>0&&i>0)&&(b.prevHeader.width(a),b.nextHeader.hasClass("jstree-grid-width-auto")?b.nextHeader.css("margin-left",l):b.nextHeader.width(n),_=C))}}),t.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){var i;return z=e(this),m=!0,x=z.closest(".jstree-grid-wrapper").find(".jstree"),_=t.clientX,y=z.closest("th").prevAll("th").length,b.prevHeader=z.closest("th"),b.nextHeader=b.prevHeader.next("th"),i=z.parent(),!1}))},this.redraw_node=function(e,t,i){return e=a.redraw_node.call(this,e,t,i),e&&this._prepare_grid(e),e},this._hide_grid=function(e){var t,i=this.dataRow,r=e.node.children_d||[];for(t=0;t<r.length;t++)i.find("td div."+h+r[t]+g).remove()},this.holdingCells={},this._prepare_grid=function(r){var a,n,l,o,c,p,u,f,v,j,w,m,_,C,x,y,b,z,T,H,S,R,W,A,k,F=this._gridSettings,P=F.treeClass,V=this,N=F.columns||[],D=F.isThemeroller,M=D?"themeroller":"regular",q=this.get_node(r),X=F.columnWidth,I=F.defaultConf,L=function(t,i,r){return function(){e(this).trigger("select_cell.jstree-grid",[{value:t,column:i.header,node:e(this).closest("li"),sourceName:i.value,sourceType:r}])}},E=this.dataRow,Q=this.get_node(q.parent).children;if(a=e(r),f=a.children("a"),A=a.attr("id"),1===f.length){for(x=h+A+g,y="#"===q.parent?null:h+q.parent+g,f.addClass(P),t(f,V),i(f,a,V),v=f,o=1;o<N.length;o++)W=E.children("td:eq("+o+")"),T=N[o],p=T.cellClass||"",u=T.wideCellClass||"",c=void 0!==T.value&&null!==T.value&&null!==q.data&&void 0!==q.data?"function"==typeof T.value?T.value(q.data):void 0!==q.data[T.value]?q.data[T.value]:"":"",T.images?(l=T.images[c]||T.images["default"],l&&(H="*"===l[0]?'<span class="'+l.substr(1)+'"></span>':'<img src="'+l+'">')):H=c,j=T.valueClass&&a.attr(T.valueClass)?a.attr(T.valueClass):"",j&&T.valueClassPrefix&&""!==T.valueClassPrefix&&(j=T.valueClassPrefix+j),w=T.wideValueClass&&a.attr(T.wideValueClass)?a.attr(T.wideValueClass):"",w&&T.wideValueClassPrefix&&""!==T.wideValueClassPrefix&&(w=T.wideValueClassPrefix+w),C=T.title&&a.attr(T.title)?a.attr(T.title):"",C=C.replace(s,""),_=7,n=T.width||X,n=R||n-_,v=W.children("div#"+x+o),(!v||v.length<1)&&(v=e("<div></div>"),y?(k=jQuery.inArray(A,Q),z=h+(0>=k?q.parent:d(this,Q[k-1]))+g+o,b=W.find("div#"+z),b&&b.length>0?v.insertAfter(b):this.holdingCells[z]=(this.holdingCells[z]||e()).add(v)):v.appendTo(W),e("<span></span>").appendTo(v),v.attr("id",x+o),v.addClass(x),this.holdingCells[x+o]&&(v.after(this.holdingCells[x+o]),delete this.holdingCells[x+o])),m=v.children("span"),m.addClass(p+" "+j).css({"margin-right":"0px","*display":"inline","*+display":"inline"}).html(H).click(L(c,T,S)),v=v.css(I).css({"margin-left":0,position:"relative",width:"100%","padding-left":_+"px"}).addClass("jstree-grid-cell jstree-grid-cell-"+M+" "+u+" "+w+(D?" ui-state-default":"")).addClass("jstree-grid-col-"+o),C&&m.attr("title",C);v.addClass("jstree-grid-cell-last"+(D?" ui-state-default":"")),void 0===N[N.length-1].width&&v.css({width:"auto",display:"block"}).addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})}}});
//# sourceMappingURL=jstreegrid.min.js.map