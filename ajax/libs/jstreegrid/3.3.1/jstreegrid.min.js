!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,i,r,n,s,d=/^\s*$/g,a=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,o=function(e){return(e||"").replace(a,"\\$&")},l="data-jstreegrid",h="_DATA_",c=24,p=!1,g=!1,u="jsgrid_",f="_col";n=/<\/?[^>]+>/gi,r=function(t,i){var r,n,s,d;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?d=i._gridSettings.indent:(r=e("<div></div>"),n=t.prev("i"),s=n.parent(),r.addClass(i.get_node("#",!0).attr("class")),s.appendTo(r),r.appendTo(e("body")),d=n.width()||c,s.detach(),r.remove(),i._gridSettings.indent=d),d},s=function(e,t){var i,r=e.get_node(t),n=r.children;return i=!n||n.length<=0||!r.state.opened?t:s(e,n[n.length-1])},t=function(e,t){var i,n,s=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(e).parents.length,n=s-i*r(e,t),s},i=function(e,t,i){var r,s="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),d=i.settings.grid.columns[0];r="",d.title&&(d.title===h?r=i.get_text(t):t.attr(d.title)&&(r=t.attr(d.title))),r=r.replace(n,""),r&&s.attr("title",r)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(t,r){this._initialize=function(){if(!this._initialized){var t,i,r=this.settings.grid||{},n=this.element,s=n.parent(),d=this._gridSettings={columns:r.columns||[],treeClass:"jstree-grid-col-0",context:r.contextmenu||!1,columnWidth:r.width,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:r.resizable,indent:0},a=d.columns,o=0;for(i=0;i<r.columns.length;i++)if(r.columns[i].tree){o=i;break}this.treecol=o,this.rootid=n.attr("id");var l=/msie/.test(navigator.userAgent.toLowerCase());if(l){var h=parseFloat(navigator.appVersion.split("MSIE")[1]);8>h&&(d.defaultConf.display="inline",d.defaultConf.zoom="1")}for(g||(g=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:relative; height:24px; float:right;margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {background-color: #EBF3FD;}",".jstree-grid-resizable-separator {cursor: col-resize;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-table {table-layout: fixed; width: 100%;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.table=e("<table></table>").addClass("jstree-grid-table"),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").appendTo(s).append(this.table),this.dataRow=e("<tr></tr>"),this.headerRow=e("<tr></tr>"),this.colgroup=e("<colgroup></colgroup>"),this.table.append(this.colgroup),this.table.append(this.headerRow),this.table.append(this.dataRow),i=0;i<a.length;i++)this.dataRow.append(e("<td></td>").addClass("jstree-grid-cell jstree-grid-cell-root-"+this.rootid));this.dataRow.children("td:eq("+o+")").append(n),this._initialized=!0}},this.init=function(e,t){r.init.call(this,e,t),this._initialize()},this.bind=function(){r.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var i=this.get_node(t||"#",!0);this._prepare_grid(i)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var i,r=this.dataRow,n=[t.node.id];for(t.node&&t.node.children_d&&(n=n.concat(t.node.children_d)),i=0;i<n.length;i++)r.find("div."+u+n[i]+f).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,i){var r=this.element.find("li a:first").outerHeight();e('<style type="text/css">td.jstree-grid-cell-root-'+this.rootid+" {line-height: "+r+"px}</style>").appendTo("head"),this.gridWrapper.addClass(this.element.attr("class"))},this)).on("move_node.jstree",e.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&this.dataRow.find("."+u+this._hover_node+f).removeClass("jstree-hovered"),this._hover_node=r,this.dataRow.find("."+u+r+f).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this._hover_node=null,this.dataRow.find("."+u+r+f).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this.dataRow.find("."+u+r+f).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,i){var r=t.node.id;this.dataRow.find("."+u+r+f).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,i){var r,n=t.node||[];for(r=0;r<n.length;r++)this.dataRow.find("."+u+n[r]+f).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var i=this.dataRow;return this._data.search.som&&t.nodes.length&&(i.find("div.jstree-grid-cell").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var r=t.id;r&&i.find("."+u+r+f).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.dataRow.find("div.jstree-grid-cell").show(),!0},this)),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,i=e.parent();t.detach(),e.remove(),i.append(t),r.teardown.call(this)},this._clean_grid=function(e,t){var i=this.dataRow;e?i.find("div."+u+t+f).remove():i.children("td:gt(0)").find("div").remove()},this._prepare_headers=function(){var t,i,r,n,s,d,a,o,l,h,c,g=this._gridSettings,u=g.columns||[],f=g.columnWidth,v=g.resizable||!1,_=g.isThemeroller,m=_?"themeroller":"regular",j=!1,w=this.gridparent,x=g.defaultConf,C=!1,y=0,b=0,S=null,R=0,z={},k=null,T=0,W=0;for(this.parent=w,t=this.headerRow,t.addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+m),c=this.colgroup,i=0;i<u.length;i++)r=e("<col/>"),r.appendTo(c),s=u[i].headerClass||"",d=u[i].columnClass||"",a=u[i].header||"",a&&(j=!0),n=u[i].width||f,T=_?7:10,"auto"!==n&&(n-=T),o=0===i?3:0,r.css({width:n}),l=e("<th></th>").css(x).css({"margin-left":o}).addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+m+" "+s+" "+d).html(a).appendTo(t),W+=l.outerWidth(),h=e("<div class='jstree-grid-separator jstree-grid-separator-"+m+(_?" ui-widget-header":"")+(v?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(l);h.remove(),l.addClass((_?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+m),void 0===u[u.length-1].width&&(W-=n,r.css({width:"auto"}),l.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),j?(g.divOffset=t.parent().offset().left,g.header=t):this.headerRow.css("display","none"),!p&&v&&(p=!0,e(document).mouseup(function(){var t,i,r,n,s,d;if(C){for(i=e.jstree.reference(S),r=i.settings.grid.columns,s=c.children("col"),n=[],(isNaN(R)||0>R)&&(i._gridSettings.treeWidthDiff=S.find("ins:eq(0)").width()+S.find("a:eq(0)").width()-i._gridSettings.columns[0].width),C=!1,t=0;t<r.length;t++)d=parseFloat(s[t].style.width),n[t]={w:d,r:t===R},i._gridSettings.columns[t].width=d;S.trigger("resize_column.jstree-grid",n)}}).mousemove(function(e){if(C){b=e.clientX;var t,i,r,n,s,d,a=b-y;0!==a&&(t=z.prevHeader.width(),i=z.nextHeader.width(),r=parseFloat(z.prevCol.css("width")),n=parseFloat(z.nextCol.css("width")),r||(r=z.prevHeader.innerWidth()),n||(n=z.nextHeader.innerWidth()),a=0>a?Math.max(a,-t):Math.min(a,i),s=r+a+"px",d=n-a+"px",(0>a&&t>0||a>0&&i>0)&&(z.prevCol.width(s),z.nextHeader.hasClass("jstree-grid-width-auto")||z.nextCol.width(d),y=b))}}),t.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){var i;return k=e(this),C=!0,S=k.closest(".jstree-grid-wrapper").find(".jstree"),y=t.clientX,R=k.closest("th").prevAll("th").length,z.prevCol=c.children("col:eq("+R+")"),z.nextCol=z.prevCol.next("col"),z.prevHeader=k.closest("th"),z.nextHeader=z.prevHeader.next("th"),i=k.parent(),!1}))},this.redraw_node=function(e,t,i,n){return e=r.redraw_node.call(this,e,t,i,n),e&&this._prepare_grid(e),e},this.refresh=function(){return this._clean_grid(),r.refresh.apply(this,arguments)},this._hide_grid=function(e){var t,i=this.dataRow,r=e&&e.children_d?e.children_d:[];for(t=0;t<r.length;t++)i.find("td div["+l+"='"+r[t]+"']").remove()},this.holdingCells={},this.getHoldingCells=function(t,i,r){var n,s,d=e(),a=t.children||[];for(s=0;s<a.length;s++)n=u+o(a[s])+f+i,r[n]&&t.state.opened&&(d=d.add(r[n]).add(this.getHoldingCells(this.get_node(a[s]),i,r)));return d},this._edit=function(t,i,r){if(!t)return!1;if(!r)return!1;r=e(r),"div"===r.prop("tagName").toLowerCase()&&(r=r.children("span:first"));var n=this._data.core.rtl,s=this.element.width(),d=t.data[i.value],a=e("<div />",{css:{position:"absolute",top:"-200px",left:n?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=e("<input />",{value:d,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=o.val();""===e||e===d?e=d:(t.data[i.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:e,old:d}),this._prepare_grid(this.get_node(t,!0))),o.remove(),r.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=d),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){o.width(Math.min(a.text("pW"+this.value).width(),s))},keypress:function(e){return 13===e.which?!1:void 0}}),l={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide(),r.parent().append(o),o.css(l).width(Math.min(a.text("pW"+o[0].value).width(),s))[0].select()},this._prepare_grid=function(t){var r,a,h,c,p,g,v,_,m,j,w,x,C,y,b,S,R,z,k,T,W,H,A,P,F,V,D,L,N,q=this._gridSettings,I=q.treeClass,B=this,M=q.columns||[],E=q.isThemeroller,U=this.element,X=this.rootid,$=E?"themeroller":"regular",Q=this.get_node(t),O=q.columnWidth,Y=q.defaultConf,G=function(t,i,r,n,s){return function(s){i=t.find("#"+i.attr("id")),i.children(".jstree-anchor").trigger("click.jstree",s),t.trigger("select_cell.jstree-grid",[{value:r,column:n.header,node:i,grid:e(this),sourceName:n.value}])}},J=function(t,i,r,n,s){return function(t){q.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var r=s.get_node(i);B._edit(r,n,t.target)}}}))}},K=function(e,t){return function(){t.hover_node(e)}},Z=function(e,t){return function(){t.dehover_node(e)}},ee=this.dataRow,te=Q.id,ie=this.get_node(Q.parent).children,re=jQuery.inArray(te,ie),ne=this.holdingCells,se=!1;if(r=e(t),m=r.children("a"),1===m.length){for(N=!Q.state.opened,S=u+o(te)+f,R="#"===Q.parent?null:Q.parent,m.addClass(I),i(m,r,B),j=m,c=0;c<M.length;c++)this.treecol!==c&&(F=M[c],L=ee.children("td:eq("+c+")"),g=F.cellClass||"",v=F.wideCellClass||"",_=F.columnClass||"",L.addClass(_),p=void 0!==F.value&&null!==F.value?"function"==typeof F.value?F.value(Q):null!==Q.data&&void 0!==Q.data&&void 0!==Q.data[F.value]?Q.data[F.value]:"":"","function"==typeof F.format&&(p=F.format(p)),F.images?(h=F.images[p]||F.images["default"],h&&(V="*"===h[0]?'<span class="'+h.substr(1)+'"></span>':'<img src="'+h+'">')):V=p,(void 0===V||null===V||d.test(V))&&(V="&nbsp;"),w=F.valueClass&&null!==Q.data&&void 0!==Q.data?Q.data[F.valueClass]||"":"",w&&F.valueClassPrefix&&""!==F.valueClassPrefix&&(w=F.valueClassPrefix+w),x=F.wideValueClass&&null!==Q.data&&void 0!==Q.data?Q.data[F.wideValueClass]||"":"",x&&F.wideValueClassPrefix&&""!==F.wideValueClassPrefix&&(x=F.wideValueClassPrefix+x),b=F.title&&null!==Q.data&&void 0!==Q.data?Q.data[F.title]||"":"",b=b.replace(n,""),y=7,a=F.width||O,"auto"!==a&&(a=D||a-y),j=L.children("div#"+S+c),(!j||j.length<1)&&(j=e("<div></div>"),e("<span></span>").appendTo(j),j.attr("id",S+c),j.addClass(S),j.attr(l,te)),T=0>=re?Q.parent:s(this,ie[re-1]),k=L.find("div["+l+"='"+T+"']"),H=re>=ie.length-1?"NULL":ie[re+1],W=L.find("div["+l+"='"+H+"']"),P=Q.children&&Q.children.length>0?Q.children[0]:"NULL",A=L.find("div["+l+"='"+P+"']"),z=L.find("div["+l+"='"+R+"']"),R?(z&&z.length>0?(k&&k.length>0?j.insertAfter(k):A&&A.length>0?j.insertBefore(A):W&&W.length>0?j.insertBefore(W):j.insertAfter(z),se=!0):se=!1,ne[S+c]=j):(k&&k.length>0?j.insertAfter(k):A&&A.length>0?j.insertBefore(A):W&&W.length>0?j.insertBefore(W):j.appendTo(L),se=!0),se&&j.after(this.getHoldingCells(Q,c,ne)),C=j.children("span"),C.addClass(g+" "+w).html(V),j=j.css(Y).addClass("jstree-grid-cell jstree-grid-cell-root-"+X+" jstree-grid-cell-"+$+" "+v+" "+x+(E?" ui-state-default":"")).addClass("jstree-grid-col-"+c),j.click(G(U,r,p,F,this)),j.on("contextmenu",J(U,r,p,F,this)),j.hover(K(r,this),Z(r,this)),b&&C.attr("title",b));j.addClass("jstree-grid-cell-last"+(E?" ui-state-default":"")),void 0===M[M.length-1].width&&j.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});
//# sourceMappingURL=jstreegrid.min.js.map