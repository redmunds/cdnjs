!function(e){"function"==typeof define&&define.amd?define(["jquery","jstree"],e):e(jQuery)}(function(e){var t,r,i,s,d,n,a=/^\s*$/g,o=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,l=function(e){return(e||"").replace(o,"\\$&")},h="data-jstreegrid",c="data-jstreegrid-column",g="_DATA_",p=24,u=!1,f="jsgrid_",v="_col",m=10,j=function(e,t){return e.find("div["+h+"='"+t+"']")},_=!1,w=null,x=0,y=0;d=/<\/?[^>]+>/gi,i=function(t,r){var i,s,d,n;return r._gridSettings=r._gridSettings||{},r._gridSettings.indent>0?n=r._gridSettings.indent:(i=e("<div></div>"),s=t.prev("i"),d=s.parent(),i.addClass(r.get_node("#",!0).attr("class")),d.appendTo(i),i.appendTo(e("body")),n=s.width()||p,d.detach(),i.remove(),r._gridSettings.indent=n),n},s=function(t,r,i,d,n){var a,o;if(d.data=e.extend(!0,{},r.data),r&&r.children_d&&n)for(a=0,o=r.children_d.length;o>a;a++)s(t,t.get_node(r.children_d[a]),i,i.get_node(d.children_d[a]),n)},n=function(e,t){var r,i=e.get_node(t),s=i.children;return r=!s||s.length<=0||!i.state.opened?t:n(e,s[s.length-1])},t=function(e,t){var r,s,d=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return r=t.get_node(e).parents.length,s=d-r*i(e,t),d},r=function(e,t,r){var i,s="a"===e.get(0).tagName.toLowerCase()?e:e.children("a"),n=r.settings.grid.columns[0];i="",n.title&&(n.title===g?i=r.get_text(t):t.attr(n.title)&&(i=t.attr(n.title))),i=i.replace(d,""),i&&s.attr("title",i)},e.jstree.defaults.grid={width:"auto"},e.jstree.plugins.grid=function(t,i){this._initialize=function(){if(!this._initialized){var t,r,i=this.settings.grid||{},s=this.element,d=this._gridSettings={columns:i.columns||[],treeClass:"jstree-grid-col-0",context:i.contextmenu||!1,columnWidth:i.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:i.resizable,draggable:i.draggable,stateful:i.stateful,indent:0,sortOrder:"text",sortAsc:!0,fixedHeader:i.fixedHeader||!0,width:i.width,height:i.height},n=d.columns,a=0;for(r=0;r<i.columns.length;r++)if(i.columns[r].tree){a=r;break}this.uniq=Math.ceil(1e3*Math.random()),this.rootid=s.attr("id");var o=/msie/.test(navigator.userAgent.toLowerCase());if(o){var l=parseFloat(navigator.appVersion.split("MSIE")[1]);8>l&&(d.defaultConf.display="inline",d.defaultConf.zoom="1")}for(u||(u=!0,t=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}",".jstree-grid-midwrapper {display: table-row;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-col-0 {width: 100%;}"],e('<style type="text/css">'+t.join("\n")+"</style>").appendTo("head")),this.gridWrapper=e("<div></div>").addClass("jstree-grid-wrapper").insertAfter(s),this.midWrapper=e("<div></div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),i.width&&this.gridWrapper.width(i.width),i.height&&this.gridWrapper.height(i.height),r=0;r<n.length;r++)e("<div></div>").addClass("jstree-default jstree-grid-column jstree-grid-column-"+r+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);this.midWrapper.children("div:eq("+a+")").append(s),s.addClass("jstree-grid-cell"),d.fixedHeader&&this.gridWrapper.scroll(function(){e(this).find(".jstree-grid-header").css("top",e(this).scrollTop())});var h=e.proxy(this.settings.sort,this);if(this.settings.sort=function(e,t){var r,i=this.colrefs;if("text"===d.sortOrder)r=1===h(e,t);else{var s=this.get_node(e),n=this.get_node(t),a=i[d.sortOrder].value,o="function"==typeof a?a(s):s.data[a],l="function"==typeof a?a(n):n.data[a];r=o>l}return d.sortAsc===!1&&(r=!r),r?1:-1},d.draggable)if(e.ui&&e.ui.sortable){var c,g;e(this.midWrapper).sortable({axis:"x",handle:".jstree-grid-header",cancel:".jstree-grid-separator",start:function(e,t){c=t.item.index()},stop:function(e,t){g=t.item.index(),d.columns.splice(g,0,d.columns.splice(c,1)[0])}})}else console.warn("[jstree-grid] draggable option requires jQuery UI");this._initialized=!0}},this.init=function(e,t){i.init.call(this,e,t),this._initialize()},this.bind=function(){i.bind.call(this),this._initialize(),this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",e.proxy(function(e,t){var r=this.get_node(t||"#",!0);this._prepare_grid(r)},this)).on("delete_node.jstree",e.proxy(function(e,t){if(void 0!==t.node.id){var r,i=this.gridWrapper,s=[t.node.id];for(t.node&&t.node.children_d&&(s=s.concat(t.node.children_d)),r=0;r<s.length;r++)j(i,s[r]).remove()}},this)).on("close_node.jstree",e.proxy(function(e,t){this._hide_grid(t.node)},this)).on("open_node.jstree",e.proxy(function(e,t){},this)).on("load_node.jstree",e.proxy(function(e,t){},this)).on("loaded.jstree",e.proxy(function(e){this._prepare_headers(),this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",e.proxy(function(t,r){var i,s=this.element.find("li a:first").outerHeight(),d=this.element.attr("class")||"";e('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+s+"px; height: "+s+"px;}</style>").appendTo("head"),i=d.split(/\s+/).map(function(e){var t=e.match(/^jstree(-|$)/);return t?"":e}),this.gridWrapper.addClass(i.join(" "))},this)).on("move_node.jstree",e.proxy(function(t,r){var i=r.new_instance.element;i.find("li > a").each(e.proxy(function(e,t){},this))},this)).on("hover_node.jstree",e.proxy(function(e,t,r){var i=t.node.id;null!==this._hover_node&&void 0!==this._hover_node&&j(this.gridWrapper,this._hover_node).removeClass("jstree-hovered"),this._hover_node=i,j(this.gridWrapper,i).addClass("jstree-hovered")},this)).on("dehover_node.jstree",e.proxy(function(e,t,r){var i=t.node.id;this._hover_node=null,j(this.gridWrapper,i).removeClass("jstree-hovered")},this)).on("select_node.jstree",e.proxy(function(e,t,r){var i=t.node.id;j(this.gridWrapper,i).addClass("jstree-clicked"),this.get_node(t.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",e.proxy(function(e,t,r){var i=t.node.id;j(this.gridWrapper,i).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",e.proxy(function(e,t,r){var i,s=t.node||[];for(i=0;i<s.length;i++)j(this.gridWrapper,s[i]).removeClass("jstree-clicked")},this)).on("search.jstree",e.proxy(function(e,t){var r=this.gridWrapper;return this._data.search.som&&t.nodes.length&&(r.find("div.jstree-grid-cell-regular").hide(),t.nodes.add(t.nodes.parentsUntil(".jstree")).filter(".jstree-node").each(function(e,t){var i=t.id;i&&j(r,i).show()})),!0},this)).on("clear_search.jstree",e.proxy(function(e,t){return this.gridWrapper.find("div.jstree-grid-cell").show(),!0},this)).on("copy_node.jstree",function(e,t){var r=t.new_instance,i=t.old_instance,d=r.get_node(t.node,!0);return s(i,t.original,r,t.node,!0),r._prepare_grid(d),!0}),this._gridSettings.isThemeroller&&this.element.on("select_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",e.proxy(function(e,t){t.rslt.obj.children("a").nextAll("div").removeClass("ui-state-hover")},this)),this._gridSettings.stateful&&this.element.on("resize_column.jstree-grid",e.proxy(function(e,t,r){localStorage["jstree-root-"+this.rootid+"-column-"+t]=r},this))},this.teardown=function(){var e=this.gridWrapper,t=this.element,r=e.parent();t.detach(),e.remove(),r.append(t),i.teardown.call(this)},this._clean_grid=function(e,t){var r=this.gridWrapper;e?j(r,t).remove():r.find("div.jstree-grid-cell-regular").remove()},this._prepare_headers=function(){var t,r,i,s,d,n,a,o,l,h,g,p=this,u=this._gridSettings,f=u.columns||[],v=u.columnWidth,j=u.resizable||!1,C=u.isThemeroller,b=C?"themeroller":"regular",W=!1,S=this.gridparent,z=this.rootid,k=u.defaultConf,A=0,T=0;for(this.parent=S,this.colrefs={},r=0;r<f.length;r++){d=f[r].headerClass||"",n=f[r].columnClass||"",a=f[r].header||"";do g=String(Math.floor(1e4*Math.random()));while(void 0!==this.colrefs[g]);o=f[r].value?g:"text",this.colrefs[o]=f[r],a&&(W=!0),s=u.stateful&&localStorage["jstree-root-"+z+"-column-"+r]?localStorage["jstree-root-"+z+"-column-"+r]:f[r].width||v,A=C?7:10,"auto"!==s&&"string"!=typeof s&&(s-=A),i=this.midWrapper.children("div.jstree-grid-column-"+r),l=e("<div></div>").css(k).addClass("jstree-grid-div-"+this.uniq+"-"+r+" "+(C?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+b+" "+d+" "+n).html(a),l.addClass((C?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+b),l.prependTo(i),l.attr(c,o),T+=l.outerWidth(),h=e("<div class='jstree-grid-separator jstree-grid-separator-"+b+(C?" ui-widget-header":"")+(j?" jstree-grid-resizable-separator":"")+"'>&nbsp;</div>").appendTo(l),i.width(s),i.css("min-width",s),i.css("max-width",s)}l.addClass((C?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+b),void 0===f[f.length-1].width&&(T-=s,i.css({width:"auto"}),l.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),W?u.header=t:e("div.jstree-grid-header").hide(),!this.bound&&j&&(this.bound=!0,e(document).mouseup(function(){var t,r,i,s,d,n;_&&(n=w.prevAll(".jstree-grid-column").length,d=w.closest(".jstree-grid-wrapper").find(".jstree"),t=e.jstree.reference(d),r=t.settings.grid.columns,s=w.parent().children("div.jstree-grid-column"),(isNaN(n)||0>n)&&(t._gridSettings.treeWidthDiff=d.find("ins:eq(0)").width()+d.find("a:eq(0)").width()-t._gridSettings.columns[0].width),i=t._gridSettings.columns[n].width=parseFloat(w.css("width")),_=!1,w=null,d.trigger("resize_column.jstree-grid",[n,i]))}).mousemove(function(e){if(_){y=e.pageX;var t,r,i,s=y-x;0!==s&&(t=w.width(),r=parseFloat(w.css("width")),r||(r=w.innerWidth()),s=0>s?Math.max(s,-t):s,i=r+s,(s>0||t>0)&&i>m&&(w.width(i+"px"),w.css("min-width",i+"px"),w.css("max-width",i+"px"),x=y))}}),this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return _=!0,x=t.pageX,w=e(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(t){var r,i,s=e(this),d=s.closest("div.jstree-grid-column"),n=parseFloat(d.css("width")),a=0,o=d.prevAll(".jstree-grid-column").length,l=d.width();d.find(".jstree-grid-cell").each(function(){var t,r=e(this);r.css("position","absolute"),r.css("width","auto"),t=r.outerWidth(),r.css("position","relative"),t>a&&(a=t)}),r=a-n,r=0>r?Math.max(r,-l):r,i=n+r+"px",d.width(i),d.css("min-width",i),d.css("max-width",i),e(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[o,i])}).on("click",".jstree-grid-separator",function(e){e.stopPropagation()}).on("click",".jstree-grid-header-cell",function(t){if(p.sort){var r,i=e(this).attr(c);u.sortOrder===i&&u.sortAsc===!0?(u.sortAsc=!1,r="&darr;"):(u.sortOrder=i,u.sortAsc=!0,r="&uarr;"),e(this.closest(".jstree-grid-wrapper")).find(".jstree-grid-sort-icon").remove(),e("<span></span>").addClass("jstree-grid-sort-icon").appendTo(e(this)).html(r);var s=p.get_node("#");p.sort(s,!0),p.redraw_node(s,!0)}}))},this.redraw_node=function(t,r,s,d){var n=this._data.search;return t=i.redraw_node.call(this,t,r,s,d),(t&&""===n.str||void 0===n.str||null===n.str||-1!==e.inArray(t.id,n.res))&&this._prepare_grid(t),t},this.refresh=function(){return this._clean_grid(),i.refresh.apply(this,arguments)},this.set_id=function(e,t){var r;e&&(r=e.id);var s=i.set_id.apply(this,arguments);if(s&&void 0!==r){var d,n=this.gridWrapper,a=[r];for(e&&e.children_d&&(a=a.concat(e.children_d)),d=0;d<a.length;d++)j(n,a[d]).attr(h,e.id).attr("id",f+e.id+v+(d+1)).removeClass(f+r+v).addClass(f+e.id+v)}return s},this._hide_grid=function(e){var t,r=e&&e.children_d?e.children_d:[];for(t=0;t<r.length;t++)j(this.gridWrapper,r[t]).remove()},this.holdingCells={},this.getHoldingCells=function(t,r,i){var s,d,n=e(),a=t.children||[];for(d=0;d<a.length;d++)s=f+l(a[d])+v+r,i[s]&&t.state.opened&&(n=n.add(i[s]).add(this.getHoldingCells(this.get_node(a[d]),r,i)));return n},this._edit=function(t,r,i){if(!t)return!1;if(!i)return!1;i=e(i),"div"===i.prop("tagName").toLowerCase()&&(i=i.children("span:first"));var s=this._data.core.rtl,d=this.element.width(),n=t.data[r.value],a=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),o=e("<input />",{value:n,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var e=o.val();""===e||e===n?e=n:(t.data[r.value]=e,this.element.trigger("update_cell.jstree-grid",{node:t,col:r.value,value:e,old:n}),this._prepare_grid(this.get_node(t,!0))),o.remove(),i.show()},this),keydown:function(e){var t=e.which;27===t&&(this.value=n),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){o.width(Math.min(a.text("pW"+this.value).width(),d))},keypress:function(e){return 13===e.which?!1:void 0}}),l={fontFamily:i.css("fontFamily")||"",fontSize:i.css("fontSize")||"",fontWeight:i.css("fontWeight")||"",fontStyle:i.css("fontStyle")||"",fontStretch:i.css("fontStretch")||"",fontVariant:i.css("fontVariant")||"",letterSpacing:i.css("letterSpacing")||"",wordSpacing:i.css("wordSpacing")||""};i.hide(),i.parent().append(o),o.css(l).width(Math.min(a.text("pW"+o[0].value).width(),d))[0].select()},this.grid_hide_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).hide()},this.grid_show_column=function(e){this.midWrapper.find(".jstree-grid-column-"+e).show()},this._prepare_grid=function(t){var i,s,o,c,g,p,u,m,_,w,x,y,C,b,W,S,z,k,A,T,P,M,q,F,H,V,D,I,L,N=this._gridSettings,B=N.treeClass,O=this,U=N.columns||[],$=N.isThemeroller,E=this.element,X=this.rootid,Q=$?"themeroller":"regular",Y=this.get_node(t),G=N.columnWidth,J=N.defaultConf,K=function(t,r,i,s,d){return function(d){r.children(".jstree-anchor").trigger("click.jstree",d),t.trigger("select_cell.jstree-grid",[{value:i,column:s.header,node:r,grid:e(this),sourceName:s.value}])}},R=function(t,r,i,s,d){return function(t){N.context&&(t.preventDefault(),e.vakata.context.show(this,{x:t.pageX,y:t.pageY},{edit:{label:"Edit",action:function(e){var i=d.get_node(r);O._edit(i,s,t.target)}}}))}},Z=function(e,t){return function(){t.hover_node(e)}},ee=function(e,t){return function(){t.dehover_node(e)}},te=this.midWrapper,re=Y.id,ie=this.get_node(Y.parent).children,se=e.inArray(re,ie),de=this.holdingCells,ne=!1;if(i=e(t),_=i.children("a"),1===_.length){L=!Y.state.opened,S=f+l(re)+v,z="#"===Y.parent?null:Y.parent,_.addClass(B),r(_,i,O),w=_;var ae=this.settings.grid,oe=0;for(c=0;c<ae.columns.length;c++)if(ae.columns[c].tree){oe=c;break}for(c=0;c<U.length;c++)oe!==c&&(H=U[c],I=te.children("div:eq("+c+")"),p=H.cellClass||"",u=H.wideCellClass||"",m=H.columnClass||"",I.addClass(m),g=void 0!==H.value&&null!==H.value?"function"==typeof H.value?H.value(Y):null!==Y.data&&void 0!==Y.data&&void 0!==Y.data[H.value]?Y.data[H.value]:"":"","function"==typeof H.format&&(g=H.format(g)),H.images?(o=H.images[g]||H.images["default"],o&&(V="*"===o[0]?'<span class="'+o.substr(1)+'"></span>':'<img src="'+o+'">')):V=g,(void 0===V||null===V||a.test(V))&&(V="&nbsp;"),x=H.valueClass&&null!==Y.data&&void 0!==Y.data?Y.data[H.valueClass]||"":"",x&&H.valueClassPrefix&&""!==H.valueClassPrefix&&(x=H.valueClassPrefix+x),y=H.wideValueClass&&null!==Y.data&&void 0!==Y.data?Y.data[H.wideValueClass]||"":"",y&&H.wideValueClassPrefix&&""!==H.wideValueClassPrefix&&(y=H.wideValueClassPrefix+y),W=H.title&&null!==Y.data&&void 0!==Y.data?Y.data[H.title]||"":"",W=W.replace(d,""),b=7,s=H.width||G,"auto"!==s&&(s=D||s-b),w=j(I,re),(!w||w.length<1)&&(w=e("<div></div>"),e("<span></span>").appendTo(w),w.attr("id",S+c),w.addClass(S),w.attr(h,re)),T=0>=se?Y.parent:n(this,ie[se-1]),A=j(I,T),M=se>=ie.length-1?"NULL":ie[se+1],P=j(I,M),F=Y.children&&Y.children.length>0?Y.children[0]:"NULL",q=j(I,F),k=j(I,z),z?(k&&k.length>0?(A&&A.length>0?w.insertAfter(A):q&&q.length>0?w.insertBefore(q):P&&P.length>0?w.insertBefore(P):w.insertAfter(k),ne=!0):ne=!1,de[S+c]=w):(A&&A.length>0?w.insertAfter(A):q&&q.length>0?w.insertBefore(q):P&&P.length>0?w.insertBefore(P):w.appendTo(I),ne=!0),ne&&w.after(this.getHoldingCells(Y,c,de)),C=w.children("span"),C.addClass(p+" "+x).html(V),w=w.css(J).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+X+" jstree-grid-cell-"+Q+" "+u+" "+y+($?" ui-state-default":"")).addClass("jstree-grid-col-"+c),w.click(K(E,i,g,H,this)),w.on("contextmenu",R(E,i,g,H,this)),w.hover(Z(i,this),ee(i,this)),W&&C.attr("title",W));w.addClass("jstree-grid-cell-last"+($?" ui-state-default":"")),void 0===U[U.length-1].width&&w.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})},this.holdingCells={}}});
//# sourceMappingURL=jstreegrid.min.js.map