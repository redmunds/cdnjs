!function(e,t){"function"==typeof define&&define.amd?define("textAngular",["rangy","rangy/lib/rangy-selectionsaverestore"],function(n,a){return e["textAngular.name"]=t(n,a)}):"object"==typeof exports?module.exports=t(require("rangy"),require("rangy/lib/rangy-selectionsaverestore")):e.textAngular=t(rangy)}(this,function(e){function t(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function n(e,n){if(!e||""===e||r.hasOwnProperty(e))throw"textAngular Error: A unique name is required for a Tool Definition";if(n.display&&(""===n.display||!t(n.display))||!n.display&&!n.buttontext&&!n.iconclass)throw'textAngular Error: Tool Definition for "'+e+'" does not have a valid display/iconclass/buttontext value';r[e]=n}function a(e){var t=document.createElement("DIV");t.innerHTML=e;var n=t.textContent||t.innerText||"";return n.replace("â€‹",""),n=n.trim()}function o(e){var t=document.createElement("DIV");return t.innerHTML=e,t}var r={};angular.module("textAngularSetup",[]).constant("taRegisterTool",n).value("taTools",r).value("taOptions",{forceTextAngularSanitize:!0,keyMappings:[],toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},defaultTagAttributes:{a:{target:""}},setup:{textEditorSetup:function(e){},htmlEditorSetup:function(e){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)?(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unquote selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyFull:{tooltip:"Justify text"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).factory("taToolFunctions",["$window","taTranslations",function(e,t){return{imgOnSelectAction:function(e,t,n){var a=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var o=n.displayElements.popoverContainer;o.empty();var r=angular.element('<div class="btn-group" style="padding-right: 6px;">'),l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');u.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),r.append(l),r.append(i),r.append(s),r.append(u),o.append(r),r=angular.element('<div class="btn-group" style="padding-right: 6px;">');var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');d.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');c.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');p.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),r.append(d),r.append(p),r.append(c),o.append(r),r=angular.element('<div class="btn-group">');var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');f.on("click",function(e){e.preventDefault(),t.remove(),a()}),r.append(f),o.append(r),n.showPopover(t),n.showResizeOverlay(t)},aOnSelectAction:function(n,a,o){n.preventDefault(),o.displayElements.popover.css("width","436px");var r=o.displayElements.popoverContainer;r.empty(),r.css("line-height","28px");var l=angular.element('<a href="'+a.attr("href")+'" target="_blank">'+a.attr("href")+"</a>");l.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),r.append(l);var i=angular.element('<div class="btn-group pull-right">'),s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');s.on("click",function(n){n.preventDefault();var r=e.prompt(t.insertLink.dialogPrompt,a.attr("href"));r&&""!==r&&"http://"!==r&&(a.attr("href",r),o.updateTaBindtaTextElement()),o.hidePopover()}),i.append(s);var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+t.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');u.on("click",function(e){e.preventDefault(),a.replaceWith(a.contents()),o.updateTaBindtaTextElement(),o.hidePopover()}),i.append(u);var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+t.editLink.targetToggle.buttontext+"</button>");"_blank"===a.attr("target")&&d.addClass("active"),d.on("click",function(e){e.preventDefault(),a.attr("target","_blank"===a.attr("target")?"":"_blank"),d.toggleClass("active"),o.updateTaBindtaTextElement()}),i.append(d),r.append(i),o.showPopover(a)},extractYoutubeVideoId:function(e){var t=/(?:youtube(?:-nocookie)?\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/i,n=e.match(t);return n&&n[1]||null}}}]).run(["taRegisterTool","$window","taTranslations","taSelection","taToolFunctions","$sanitize","taOptions",function(e,t,n,a,o,r,l){var i={};if(r("",i),l.forceTextAngularSanitize===!0&&"taSanitize"!==i.version)throw angular.$$minErr("textAngular")("textAngularSetup","The textAngular-sanitize provider has been replaced by another -- have you included angular-sanitize by mistake?");e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var s=function(e){return function(){return this.$editor().queryFormatBlockState(e)}},u=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:u,activeState:s(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),e("justifyFull",{iconclass:"fa fa-align-justify",tooltiptext:n.justifyFull.tooltip,action:function(){return this.$editor().wrapSelection("justifyFull",null)},activeState:function(e){var t=!1;return e&&(t="justify"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyFull")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){if(e&&"#document"===e.nodeName)return!1;var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")},commandKeyCode:"TabKey"}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1},commandKeyCode:"ShiftTabKey"}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",tooltiptext:n.strikeThrough.tooltip,action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var o=angular.element(a.getSelectionElement()),r=function(e){e=angular.element(e);var t=e;angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(o.find("ul"),r),angular.forEach(o.find("ol"),r),"li"===o[0].tagName.toLowerCase()){var l=o[0].parentNode.childNodes,i=[],s=[],u=!1;for(n=0;n<l.length;n++)l[n]===o[0]?u=!0:u?s.push(l[n]):i.push(l[n]);var d=angular.element(o[0].parentNode),c=angular.element("<p></p>");if(c.html(angular.element(o[0]).html()),0===i.length||0===s.length)0===s.length?d.after(c):d[0].parentNode.insertBefore(c[0],d[0]),0===i.length&&0===s.length?d.remove():angular.element(o[0]).remove();else{var p=angular.element("<"+d[0].tagName+"></"+d[0].tagName+">"),f=angular.element("<"+d[0].tagName+"></"+d[0].tagName+">");for(n=0;n<i.length;n++)p.append(angular.element(i[n]));for(n=0;n<s.length;n++)f.append(angular.element(s[n]));d.after(f),d.after(c),d.after(p),d.remove()}a.setSelectionToElementEnd(c[0])}var m=this.$editor(),g=function(e){e=angular.element(e),e[0]!==m.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),g)};angular.forEach(o,g),"li"!==o[0].tagName.toLowerCase()&&"ol"!==o[0].tagName.toLowerCase()&&"ul"!==o[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}});var d=function(e){return-1!==e.toLowerCase().indexOf("javascript")};e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;if(e=t.prompt(n.insertImage.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e&&!d(e)){"a"===a.getSelectionElement().tagName.toLowerCase()&&a.setSelectionAfterElement(a.getSelectionElement());var o='<img src="'+e+'">';return this.$editor().wrapSelection("insertHTML",o,!0)}},onElementSelect:{element:"img",action:o.imgOnSelectAction}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if(e=t.prompt(n.insertVideo.dialogPrompt,"https://"),!d(e)&&e&&""!==e&&"https://"!==e&&(videoId=o.extractYoutubeVideoId(e),videoId)){var r="https://www.youtube.com/embed/"+videoId,l='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+videoId+'/hqdefault.jpg" ta-insert-video="'+r+'" contenteditable="false" allowfullscreen="true" frameborder="0" />';return"a"===a.getSelectionElement().tagName.toLowerCase()&&a.setSelectionAfterElement(a.getSelectionElement()),this.$editor().wrapSelection("insertHTML",l,!0)}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:o.imgOnSelectAction}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return e=t.prompt(n.insertLink.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e&&!d(e)?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:o.aOnSelectAction}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words: <span ng-bind="wordcount"></span></div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerHTML||"",n=0;return""!==t.replace(/\s*<[^>]*?>\s*/g,"")&&(n=t.replace(/<\/?(b|i|em|strong|span|u|strikethrough|a|img|small|sub|sup|label)( [^>*?])?>/gi,"").replace(/(<[^>]*?>\s*<[^>]*?>)/gi," ").replace(/(<[^>]*?>)/gi,"").replace(/\s+/gi," ").match(/\S+/g).length),this.wordcount=n,this.$editor().wordcount=n,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters: <span ng-bind="charcount"></span></div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerText||e[0].textContent,n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]);var l={ie:function(){for(var e,t=3,n=document.createElement("div"),a=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},i=i||{};i.now=function(){return i.now||i.mozNow||i.msNow||i.oNow||i.webkitNow||function(){return(new Date).getTime()}}();var s=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,u=/^(ul|li|ol)$/i,d=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var c,p,f,m,g,h;if(l.ie>8||void 0===l.ie){for(var v=document.styleSheets,b=0;b<v.length;b++)if((0===v[b].media.length||v[b].media.mediaText.match(/(all|screen)/gi))&&v[b].href&&v[b].href.match(/textangular\.(min\.|)css/gi)){c=v[b];break}c||(c=function(){var e=document.createElement("style");return l.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),p=function(e,t){return m(c,e,t)},m=function(e,t,n){var a,o;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),c.rules?o=c.rules[a]:c.cssRules&&(o=c.cssRules[a]),o},h=function(e,t){var n,a;for(n=0;n<t.length;n++)if(t[n].cssText===e.cssText){a=n;break}return a},f=function(e){g(c,e)},g=function(e,t){var n=e.cssRules||e.rules;if(n&&0!==n.length){var a=h(t,n);e.removeRule?e.removeRule(a):e.deleteRule(a)}}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===l.ie?"div":l.ie<=8?"P":"p":l.ie<=8?e.toUpperCase():e:l.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var a=angular.element("<div></div>");return a[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=a.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(a,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),a[0].innerHTML}}]).factory("taFixChrome",function(){var e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,a,o,r=/<([^>\/]+?)style=("([^\"]+)"|'([^']+)')([^>]*)>/gi,l=/<span class="Apple-converted-space">([^<]+)<\/span>/gi,i="",s=0;t=l.exec(e);)a=t[1],a=a.replace(/&nbsp;/gi," "),i+=e.substring(s,t.index)+a,s=t.index+t[0].length;for(s&&(e=i,i="",s=0);t=r.exec(e);)n=t[3]||t[4],n&&n.match(/line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;|color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;|( |)color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|( |)background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi,""),o="<"+t[1].trim(),n.trim().length>0&&(o+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),o+=t[5].trim()+">",i+=e.substring(s,t.index)+o,s=t.index+t[0].length);return i+=e.substring(s),s>0?i.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e};return e}).factory("taSanitize",["$sanitize",function(e){function t(e,t){for(var n,a=0,o=0,r=/<[^>]*>/gi;n=r.exec(e);)if(o=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,o)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(o)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var a,r,l,i,s,d,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,p="",f="",m=0;r=c.exec(e);){i=r[3]||r[4];var g=new RegExp(u,"i");if(angular.isString(i)&&g.test(i)){s="";for(var h=new RegExp(u,"ig");l=h.exec(i);)for(a=0;a<o.length;a++)l[2*a+2]&&(s+="<"+o[a].tag+">");d=n(e.substring(m,r.index)),f+=p.length>0?t(d,p):d,i=i.replace(new RegExp(u,"ig"),""),f+="<"+r[1].trim(),i.length>0&&(f+=' style="'+i+'"'),f+=r[5]+">",m=r.index+r[0].length,p=s}}return f+=p.length>0?t(e.substring(m),p):e.substring(m)}function a(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",o=0;t=n.exec(e);){a+=e.substring(o,t.index),o=t.index+t[0].length;var r="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(r)?r=r.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):r+=' style="text-align:'+(t[3]||t[4])+';"',r+=">",a+=r}return a+e.substring(o)}for(var o=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],r=[],l=0;l<o.length;l++){for(var i="("+o[l].property+":\\s*(",s=0;s<o[l].values.length;s++)s>0&&(i+="|"),i+=o[l].values[s];i+=");)",r.push(i)}var u="("+r.join("|")+")";return function(t,o,r){if(!r)try{t=n(t)}catch(l){}t=a(t);var i;try{i=e(t),r&&(i=t)}catch(l){i=o||""}var s,u=i.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),d=i.replace(/(&#(9|10);)*/gi,""),c=/<pre[^>]*>.*?<\/pre[^>]*>/gi,p=0,f=0;for(i="";null!==(s=c.exec(d))&&p<u.length;)i+=d.substring(f,s.index)+u[p],f=s.index+s[0].length,p++;return i+d.substring(f)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var a,o=e.defer(),r=o.promise,l=this.$editor();try{a=this.action(o,l.startAction()),r["finally"](function(){l.endAction.call(l)})}catch(i){t.error(i)}(a||void 0===a)&&o.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(t,n,a){var o=function(e,n){var a,o,r=e.find("li");for(o=r.length-1;o>=0;o--)a=angular.element("<"+n+">"+r[o].innerHTML+"</"+n+">"),e.after(a);e.remove(),t.setSelectionToElementEnd(a[0])},r=function(e){/(<br(|\/)>)$/i.test(e.innerHTML.trim())?t.setSelectionBeforeElement(angular.element(e).find("br")[0]):t.setSelectionToElementEnd(e)},l=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),r(n.find("li")[0])},i=function(e,t,a){for(var o="",l=0;l<e.length;l++)o+="<"+n("li")+">"+e[l].innerHTML+"</"+n("li")+">";var i=angular.element("<"+a+">"+o+"</"+a+">");t.after(i),t.remove(),r(i.find("li")[0])};return function(r,d){return r=n(r),function(c,p,f,m){var g,h,v,b,y,x,E,S=angular.element("<"+r+">");try{if(E=t.getSelectionElement(),"div"===E.tagName.toLowerCase()&&/taTextElement.+/.test(E.id)){t.setSelectionToElementStart(E.childNodes[1]),E=t.getSelectionElement();var w=E.innerHTML;/<br>/i.test(w)&&(w=w.replace("<br>","&#8203;")),E.innerHTML=w}}catch(T){}var C=angular.element(E);if(void 0!==E){var $=E.tagName.toLowerCase();if("insertorderedlist"===c.toLowerCase()||"insertunorderedlist"===c.toLowerCase()){var N=n("insertorderedlist"===c.toLowerCase()?"ol":"ul");if($===N)return o(C,r);if("li"===$&&C.parent()[0].tagName.toLowerCase()===N&&1===C.parent().children().length)return o(C.parent(),r);if("li"===$&&C.parent()[0].tagName.toLowerCase()!==N&&1===C.parent().children().length)return l(C.parent(),N);if($.match(s)&&!C.hasClass("ta-bind")){if("ol"===$||"ul"===$)return l(C,N);var L=!1;return angular.forEach(C.children(),function(e){e.tagName.match(s)&&(L=!0)}),L?i(C.children(),C,N):i([angular.element("<div>"+E.innerHTML+"</div>")[0]],C,N)}if($.match(s)){if(b=t.getOnlySelectedElements(),0===b.length)h=angular.element("<"+N+"><li>"+E.innerHTML+"</li></"+N+">"),C.html(""),C.append(h);else{if(1===b.length&&("ol"===b[0].tagName.toLowerCase()||"ul"===b[0].tagName.toLowerCase()))return b[0].tagName.toLowerCase()===N?o(angular.element(b[0]),r):l(angular.element(b[0]),N);v="";var k=[];for(g=0;g<b.length;g++)if(3!==b[g].nodeType){var A=angular.element(b[g]);if("li"===b[g].tagName.toLowerCase())continue;v+="ol"===b[g].tagName.toLowerCase()||"ul"===b[g].tagName.toLowerCase()?A[0].innerHTML:"span"!==b[g].tagName.toLowerCase()||"ol"!==b[g].childNodes[0].tagName.toLowerCase()&&"ul"!==b[g].childNodes[0].tagName.toLowerCase()?"<"+n("li")+">"+A[0].innerHTML+"</"+n("li")+">":A[0].childNodes[0].innerHTML,k.unshift(A)}h=angular.element("<"+N+">"+v+"</"+N+">"),k.pop().replaceWith(h),angular.forEach(k,function(e){e.remove()})}return void t.setSelectionToElementEnd(h[0])}}else{if("formatblock"===c.toLowerCase()){for(x=f.toLowerCase().replace(/[<>]/gi,""),"default"===x.trim()&&(x=r,f="<"+r+">"),h="li"===$?C.parent():C;!h[0].tagName||!h[0].tagName.match(s)&&!h.parent().attr("contenteditable");)h=h.parent(),$=(h[0].tagName||"").toLowerCase();if($===x){b=h.children();var M=!1;for(g=0;g<b.length;g++)M=M||b[g].tagName.match(s);M?(h.after(b),y=h.next(),h.remove(),h=y):(S.append(h[0].childNodes),h.after(S),h.remove(),h=S)}else if(h.parent()[0].tagName.toLowerCase()!==x||h.parent().hasClass("ta-bind"))if($.match(u))h.wrap(f);else{for(b=t.getOnlySelectedElements(),0===b.length&&(b=[h[0]]),g=0;g<b.length;g++)if(3===b[g].nodeType||!b[g].tagName.match(s))for(;3===b[g].nodeType||!b[g].tagName||!b[g].tagName.match(s);)b[g]=b[g].parentNode;b=b.filter(function(e,t,n){return n.indexOf(e)===t});var D;if(angular.element(b[0]).hasClass("ta-bind"))h=angular.element(f),D=b[0].innerHTML,/<span class="rangySelectionBoundary".+><br>/i.test(D)&&(D=D.replace("<br>","&#8203;")),h[0].innerHTML=D,b[0].innerHTML=h[0].outerHTML;else if("blockquote"===x){for(v="",g=0;g<b.length;g++)v+=b[g].outerHTML;for(h=angular.element(f),h[0].innerHTML=v,b[0].parentNode.insertBefore(h[0],b[0]),g=b.length-1;g>=0;g--)b[g].parentNode&&b[g].parentNode.removeChild(b[g])}else for(g=0;g<b.length;g++)h=angular.element(f),D=b[g].innerHTML,/<span class="rangySelectionBoundary".+><br>/i.test(D)&&(D=D.replace("<br>","&#8203;")),h[0].innerHTML=D,b[g].parentNode.insertBefore(h[0],b[g]),b[g].parentNode.removeChild(b[g])}else{var H=h.parent(),B=H.contents();for(g=0;g<B.length;g++)H.parent().hasClass("ta-bind")&&3===B[g].nodeType&&(S=angular.element("<"+r+">"),S[0].innerHTML=B[g].outerHTML,B[g]=S[0]),H.parent()[0].insertBefore(B[g],H[0]);H.remove()}return void t.setSelectionToElementEnd(h[0])}if("createlink"===c.toLowerCase()){var R='<a href="'+f+'" target="'+(m.a.target?m.a.target:"")+'">',W="</a>",_=t.getSelection();if(_.collapsed)t.insertHtml(R+f+W,d);else if(e.getSelection().getRangeAt(0).canSurroundContents()){var q=angular.element(R+W)[0];e.getSelection().getRangeAt(0).surroundContents(q)}return}if("inserthtml"===c.toLowerCase())return void t.insertHtml(f,d)}}try{a[0].execCommand(c,p,f)}catch(T){}}}}]).service("taSelection",["$document","taDOM",function(t,n){var a=t[0],o=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},r={getSelection:function(){var t=e.getSelection().getRangeAt(0),n=t.commonAncestorContainer,a={start:o(t.startContainer,t.startOffset),end:o(t.endContainer,t.endOffset),collapsed:t.collapsed};return n=3===n.nodeType?n.parentNode:n,n.parentNode===a.start.element||n.parentNode===a.end.element?a.container=n.parentNode:a.container=n,a},getOnlySelectedElements:function(){var t=e.getSelection().getRangeAt(0),n=t.commonAncestorContainer;return n=3===n.nodeType?n.parentNode:n,t.getNodes([1],function(e){return e.parentNode===n})},getSelectionElement:function(){return r.getSelection().container},setSelection:function(t,n,a){var o=e.createRange();o.setStart(t,n),o.setEnd(t,a),e.getSelection().setSingleRange(o)},setSelectionBeforeElement:function(t){var n=e.createRange();n.selectNode(t),n.collapse(!0),e.getSelection().setSingleRange(n)},setSelectionAfterElement:function(t){var n=e.createRange();n.selectNode(t),n.collapse(!1),e.getSelection().setSingleRange(n)},setSelectionToElementStart:function(t){var n=e.createRange();n.selectNodeContents(t),n.collapse(!0),e.getSelection().setSingleRange(n)},setSelectionToElementEnd:function(t){var n=e.createRange();n.selectNodeContents(t),n.collapse(!1),t.childNodes&&t.childNodes[t.childNodes.length-1]&&"br"===t.childNodes[t.childNodes.length-1].nodeName&&(n.startOffset=n.endOffset=n.startOffset-1),e.getSelection().setSingleRange(n)},insertHtml:function(t,o){var l,i,u,c,p,f,m,g=angular.element("<div>"+t+"</div>"),h=e.getSelection().getRangeAt(0),v=a.createDocumentFragment(),b=g[0].childNodes,y=!0;if(b.length>0){for(c=[],u=0;u<b.length;u++)"p"===b[u].nodeName.toLowerCase()&&""===b[u].innerHTML.trim()||3===b[u].nodeType&&""===b[u].nodeValue.trim()||(y=y&&!s.test(b[u].nodeName),c.push(b[u]));for(var x=0;x<c.length;x++)f=v.appendChild(c[x]);!y&&h.collapsed&&/^(|<br(|\/)>)$/i.test(h.startContainer.innerHTML)&&h.selectNode(h.startContainer)}else y=!0,f=v=a.createTextNode(t);if(y)h.deleteContents();else if(h.collapsed&&h.startContainer!==o)if(h.startContainer.innerHTML&&h.startContainer.innerHTML.match(/^<[^>]*>$/i))l=h.startContainer,1===h.startOffset?(h.setStartAfter(l),h.setEndAfter(l)):(h.setStartBefore(l),h.setEndBefore(l));else{if(3===h.startContainer.nodeType&&h.startContainer.parentNode!==o)for(l=h.startContainer.parentNode,i=l.cloneNode(),n.splitNodes(l.childNodes,l,i,h.startContainer,h.startOffset);!d.test(l.nodeName);){angular.element(l).after(i),l=l.parentNode;var E=i;i=l.cloneNode(),n.splitNodes(l.childNodes,l,i,E)}else l=h.startContainer,i=l.cloneNode(),n.splitNodes(l.childNodes,l,i,void 0,void 0,h.startOffset);if(angular.element(l).after(i),h.setStartAfter(l),h.setEndAfter(l),/^(|<br(|\/)>)$/i.test(l.innerHTML.trim())&&(h.setStartBefore(l),h.setEndBefore(l),angular.element(l).remove()),/^(|<br(|\/)>)$/i.test(i.innerHTML.trim())&&angular.element(i).remove(),"li"===l.nodeName.toLowerCase()){for(m=a.createDocumentFragment(),p=0;p<v.childNodes.length;p++)g=angular.element("<li>"),n.transferChildNodes(v.childNodes[p],g[0]),n.transferNodeAttributes(v.childNodes[p],g[0]),m.appendChild(g[0]);v=m,f&&(f=v.childNodes[v.childNodes.length-1],f=f.childNodes[f.childNodes.length-1])}}else h.deleteContents();h.insertNode(v),f&&r.setSelectionToElementEnd(f)}};return r}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var a=[],o=t.children();return o.length&&angular.forEach(o,function(t){a=a.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&a.push(t),a},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,a,o,r,l){if(!o&&isNaN(l))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var i=document.createDocumentFragment(),s=document.createDocumentFragment(),u=0;t.length>0&&(isNaN(l)||l!==u)&&t[0]!==o;)i.appendChild(t[0]),u++;for(!isNaN(r)&&r>=0&&t[0]&&(i.appendChild(document.createTextNode(t[0].nodeValue.substring(0,r))),
t[0].nodeValue=t[0].nodeValue.substring(r));t.length>0;)s.appendChild(t[0]);e.transferChildNodes(i,n),e.transferChildNodes(s,a)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=o}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=o}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){return function(e){return function(e){if(!e)return!0;var t=a(e);return""===t?!/<img[^>]+>/.test(e):!1}}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(t,n,a,o,r,i,u,c,m,g,h,v,b){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(r,x,E,S){function w(e){var t;return F.forEach(function(n){if(n.keyCode===e.keyCode){var a=(e.metaKey?K:0)+(e.ctrlKey?q:0)+(e.shiftKey?O:0)+(e.altKey?z:0);if(n.forbiddenModifiers&a)return;n.mustHaveModifiers.every(function(e){return a&e})&&(t=n.specialKey)}}),t}var T,C,$,N,L=S[0],k=S[1]||{},A=void 0!==x.attr("contenteditable")&&x.attr("contenteditable"),M=A||"textarea"===x[0].tagName.toLowerCase()||"input"===x[0].tagName.toLowerCase(),D=!1,H=!1,B=!1,R=E.taUnsafeSanitizer||m.disableSanitizer,W=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,_=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,q=1,K=2,z=4,O=8,F=[{specialKey:"UndoKey",forbiddenModifiers:z+O,mustHaveModifiers:[K+q],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:z,mustHaveModifiers:[K+q,O],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:z+O,mustHaveModifiers:[K+q],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:K+O+z+q,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:K+z+q,mustHaveModifiers:[O],keyCode:9}];void 0===E.taDefaultWrap&&(E.taDefaultWrap="p"),""===E.taDefaultWrap?($="",N=void 0===l.ie?"<div><br></div>":l.ie>=11?"<p><br></p>":l.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):($=void 0===l.ie||l.ie>=11?"<"+E.taDefaultWrap+"><br></"+E.taDefaultWrap+">":l.ie<=8?"<"+E.taDefaultWrap.toUpperCase()+"></"+E.taDefaultWrap.toUpperCase()+">":"<"+E.taDefaultWrap+"></"+E.taDefaultWrap+">",N=void 0===l.ie||l.ie>=11?"<"+E.taDefaultWrap+"><br></"+E.taDefaultWrap+">":l.ie<=8?"<"+E.taDefaultWrap.toUpperCase()+">&nbsp;</"+E.taDefaultWrap.toUpperCase()+">":"<"+E.taDefaultWrap+">&nbsp;</"+E.taDefaultWrap+">"),k.$options||(k.$options={});var I=g(N),V=function(e){if(I(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+E.taDefaultWrap+">"+e+"</"+E.taDefaultWrap+">";else{var n,a=t[0].childNodes,o=!1;for(n=0;n<a.length&&!(o=a[n].nodeName.toLowerCase().match(s));n++);if(o)for(e="",n=0;n<a.length;n++){var r=a[n],l=r.nodeName.toLowerCase();if("#comment"===l)e+="<!--"+r.nodeValue+"-->";else if("#text"===l){var i=r.textContent;e+=i.trim()?"<"+E.taDefaultWrap+">"+i+"</"+E.taDefaultWrap+">":i}else if(l.match(s))e+=r.outerHTML;else{var u=r.outerHTML||r.nodeValue;e+=""!==u.trim()?"<"+E.taDefaultWrap+">"+u+"</"+E.taDefaultWrap+">":u}}else e="<"+E.taDefaultWrap+">"+e+"</"+E.taDefaultWrap+">"}return e};E.taPaste&&(C=h(E.taPaste)),x.addClass("ta-bind");var P;r["$undoManager"+(E.id||"")]=L.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),P&&n.cancel(P),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var U,j=r["$undoTaBind"+(E.id||"")]=function(){if(!D&&A){var e=L.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(ue(e),J(e,!1),U&&n.cancel(U),U=n(function(){x[0].focus(),i.setSelectionToElementEnd(x[0])},1))}},G=r["$redoTaBind"+(E.id||"")]=function(){if(!D&&A){var e=L.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(ue(e),J(e,!1),U&&n.cancel(U),U=n(function(){x[0].focus(),i.setSelectionToElementEnd(x[0])},1))}},Y=function(){if(A)return x[0].innerHTML;if(M)return x.val();throw"textAngular Error: attempting to update non-editable taBind"},J=function(e,t,n){B=n||!1,"undefined"!=typeof t&&null!==t||(t=A),"undefined"!=typeof e&&null!==e||(e=Y()),I(e)?(""!==L.$viewValue&&L.$setViewValue(""),t&&""!==L.$undoManager.current()&&L.$undoManager.push("")):(se(),L.$viewValue!==e&&(L.$setViewValue(e),t&&L.$undoManager.push(e))),L.$render()};r["updateTaBind"+(E.id||"")]=function(){D||J(void 0,void 0,!0)};var Q=function(e){return L.$oldViewValue=t(o(e),L.$oldViewValue,R)};if(x.attr("required")&&(L.$validators.required=function(e,t){return!I(e||t)}),L.$parsers.push(Q),L.$parsers.unshift(V),L.$formatters.push(Q),L.$formatters.unshift(V),L.$formatters.unshift(function(e){return L.$undoManager.push(e||"")}),M)if(r.events={},A){var X=!1,Z=function(e){var a=void 0!==e?e.match(/content=["']*OneNote.File/i):!1;if(e&&e.trim().length){if(e.match(/class=["']*Mso(Normal|List)/i)||e.match(/content=["']*Word.Document/i)||e.match(/content=["']*OneNote.File/i)){var o=e.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);o=o?o[1]:e,o=o.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var l=angular.element("<div>"+o+"</div>"),s=angular.element("<div></div>"),u={element:null,lastIndent:[],lastLi:null,isUl:!1};u.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var d=function(e){u.isUl=e,u.element=angular.element(e?"<ul>":"<ol>"),u.lastIndent=[],u.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},u.lastLevelMatch=null},c=0;c<=l[0].childNodes.length;c++)if(l[0].childNodes[c]&&"#text"!==l[0].childNodes[c].nodeName){var p=l[0].childNodes[c].tagName.toLowerCase();if("p"===p||"h1"===p||"h2"===p||"h3"===p||"h4"===p||"h5"===p||"h6"===p){var f=angular.element(l[0].childNodes[c]),m=(f.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(m){if(f[0].childNodes.length<2||f[0].childNodes[1].childNodes.length<1)continue;var g="bullet"===m[1].toLowerCase()||"number"!==m[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(f[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(f[0].childNodes[1].childNodes[0].innerHTML)),h=(f.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),b=parseFloat(h?h[1]:0),y=(f.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(y&&y[2]&&(b=parseInt(y[2])),y&&(!u.lastLevelMatch||y[1]!==u.lastLevelMatch[1])||!m[3]||"first"===m[3].toLowerCase()||null===u.lastIndent.peek()||u.isUl!==g&&u.lastIndent.peek()===b)d(g),s.append(u.element);else if(null!=u.lastIndent.peek()&&u.lastIndent.peek()<b)u.element=angular.element(g?"<ul>":"<ol>"),u.lastLi.append(u.element);else if(null!=u.lastIndent.peek()&&u.lastIndent.peek()>b){for(;null!=u.lastIndent.peek()&&u.lastIndent.peek()>b;)if("li"!==u.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(u.element.parent()[0].tagName.toLowerCase()))break;u.element=u.element.parent(),u.lastIndent.pop()}else u.element=u.element.parent();u.isUl="ul"===u.element[0].tagName.toLowerCase(),g!==u.isUl&&(d(g),s.append(u.element))}u.lastLevelMatch=y,b!==u.lastIndent.peek()&&u.lastIndent.push(b),u.lastLi=angular.element("<li>"),u.element.append(u.lastLi),u.lastLi.html(f.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),f.remove()}else d(!1),s.append(f)}}var E=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(s.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&E(e)}),angular.forEach(s.find("font"),E),e=s.html(),a&&(e=s.html()||l.html())}else{if(e=e.replace(/<(|\/)meta[^>]*?>/gi,""),e.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(e.match(/<[^>]*?(text-angular)[^>]*?>/)){var S=angular.element("<div>"+e+"</div>");S.find("textarea").remove();for(var w=v.getByAttribute(S,"ta-bind"),T=0;T<w.length;T++){for(var $=w[T][0].parentNode.parentNode,N=0;N<w[T][0].childNodes.length;N++)$.parentNode.insertBefore(w[T][0].childNodes[N],$);$.parentNode.removeChild($)}e=S.html().replace('<br class="Apple-interchange-newline">',"")}}else e.match(/^<span/)&&(e.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(e=e.replace(/<(|\/)span[^>]*?>/gi,"")));e=e.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*)?>/i.test(e)&&/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(e)===!1&&(e=e.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")),e=e.replace(/^[ |\u00A0]+/gm,function(e){for(var t="",n=0;n<e.length;n++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),C&&(e=C(r,{$html:e})||e),e=t(e,"",R),i.insertHtml(e,x[0]),n(function(){L.$setViewValue(Y()),X=!1,x.removeClass("processing-paste")},0)}else X=!1,x.removeClass("processing-paste")};x.on("paste",r.events.paste=function(t,o){if(o&&angular.extend(t,o),D||X)return t.stopPropagation(),t.preventDefault(),!1;X=!0,x.addClass("processing-paste");var r,l=(t.originalEvent||t).clipboardData;if(l&&l.getData&&l.types.length>0){for(var i="",s=0;s<l.types.length;s++)i+=" "+l.types[s];return/text\/html/i.test(i)?r=l.getData("text/html"):/text\/plain/i.test(i)&&(r=l.getData("text/plain")),Z(r),t.stopPropagation(),t.preventDefault(),!1}var u=e.saveSelection(),d=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');a.find("body").append(d),d[0].focus(),n(function(){e.restoreSelection(u),Z(d[0].innerHTML),x[0].focus(),d.remove()},0)}),x.on("cut",r.events.cut=function(e){D?e.preventDefault():n(function(){L.$setViewValue(Y())},0)}),x.on("keydown",r.events.keydown=function(e,t){t&&angular.extend(e,t),e.specialKey=w(e);var n;if(m.keyMappings.forEach(function(t){e.specialKey===t.commandKeyCode&&(e.specialKey=void 0),t.testForKey(e)&&(n=t.commandKeyCode),"UndoKey"!==t.commandKeyCode&&"RedoKey"!==t.commandKeyCode||t.enablePropagation||e.preventDefault()}),"undefined"!=typeof n&&(e.specialKey=n),"undefined"==typeof e.specialKey||"UndoKey"===e.specialKey&&"RedoKey"===e.specialKey||(e.preventDefault(),b.sendKeyCommand(r,e)),!D&&("UndoKey"===e.specialKey&&(j(),e.preventDefault()),"RedoKey"===e.specialKey&&(G(),e.preventDefault()),13===e.keyCode&&!e.shiftKey)){var a,o=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},l=i.getSelectionElement();if(!l.tagName.match(d))return;var s=angular.element($),u=["blockquote","ul","ol"];if(o(u,l.parentNode.tagName.toLowerCase())){if(/^<br(|\/)>$/i.test(l.innerHTML.trim())&&!l.nextSibling){a=angular.element(l);var c=a.parent();c.after(s),a.remove(),0===c.children().length&&c.remove(),i.setSelectionToElementStart(s[0]),e.preventDefault()}/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(l.innerHTML.trim())&&(a=angular.element(l),a.after(s),a.remove(),i.setSelectionToElementStart(s[0]),e.preventDefault())}}});var ee;if(x.on("keyup",r.events.keyup=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var a=i.getSelection();return void(a.start.element===x[0]&&x.children().length&&i.setSelectionToElementStart(x.children()[0]))}if(P&&n.cancel(P),!D&&!W.test(e.keyCode)){if(""!==$&&13===e.keyCode&&!e.shiftKey){for(var o=i.getSelectionElement();!o.tagName.match(d)&&o!==x[0];)o=o.parentNode;if(o.tagName.toLowerCase()!==E.taDefaultWrap&&"li"!==o.tagName.toLowerCase()&&(""===o.innerHTML.trim()||"<br>"===o.innerHTML.trim())){var r=angular.element($);angular.element(o).replaceWith(r),i.setSelectionToElementStart(r[0])}}var l=Y();""!==$&&""===l.trim()&&(ue($),i.setSelectionToElementStart(x.children()[0]));var s=T!==e.keyCode&&_.test(e.keyCode);ee&&n.cancel(ee),ee=n(function(){J(l,s,!0)},k.$options.debounce||400),s||(P=n(function(){L.$undoManager.push(l)},250)),T=e.keyCode}}),x.on("blur",r.events.blur=function(){H=!1,D?(B=!0,L.$render()):J(void 0,void 0,!0)}),E.placeholder&&(l.ie>8||void 0===l.ie)){var te;if(!E.id)throw"textAngular Error: An unique ID is required for placeholders to work";te=p("#"+E.id+".placeholder-text:before",'content: "'+E.placeholder+'"'),r.$on("$destroy",function(){f(te)})}x.on("focus",r.events.focus=function(){H=!0,x.removeClass("placeholder-text"),se()}),x.on("mouseup",r.events.mouseup=function(){var e=i.getSelection();e.start.element===x[0]&&x.children().length&&i.setSelectionToElementStart(x.children()[0])}),x.on("mousedown",r.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{x.on("change blur",r.events.change=r.events.blur=function(){D||L.$setViewValue(Y())}),x.on("keydown",r.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,o=x.val();if(e.shiftKey){var r=o.lastIndexOf("\n",n),l=o.lastIndexOf("	",n);-1!==l&&l>=r&&(x.val(o.substring(0,l)+o.substring(l+1)),this.selectionStart=this.selectionEnd=n-1)}else x.val(o.substring(0,n)+"	"+o.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var ne=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},ae=function(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])},oe=function(e,t){var n="",a=e.childNodes;return t++,n+=ne("	",t-1)+e.outerHTML.substring(0,4),ae(a,function(e,a){var o=a.nodeName.toLowerCase();return"#comment"===o?void(n+="<!--"+a.nodeValue+"-->"):"#text"===o?void(n+=a.textContent):void(a.outerHTML&&(n+="ul"===o||"ol"===o?"\n"+oe(a,t):"\n"+ne("	",t)+a.outerHTML))}),n+="\n"+ne("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};L.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;return t.length>0&&(e="",ae(t,function(t,n){var a=n.nodeName.toLowerCase();return"#comment"===a?void(e+="<!--"+n.nodeValue+"-->"):"#text"===a?void(e+=n.textContent):void(n.outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===a||"ol"===a?""+oe(n,0):""+n.outerHTML))})),e})}var re,le=function(e){return r.$emit("ta-element-select",this),e.preventDefault(),!1},ie=function(e,t){if(t&&angular.extend(e,t),!y&&!D){y=!0;var a;a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,r.$emit("ta-drop-event",this,e,a),n(function(){y=!1,J(void 0,void 0,!0)},100)}},se=r["reApplyOnSelectorHandlers"+(E.id||"")]=function(){D||angular.forEach(u,function(e){x.find(e).off("click",le).on("click",le)})},ue=function(e){x[0].innerHTML=e},de=!1;L.$render=function(){if(!de){de=!0;var e=L.$viewValue||"";B||(A&&H&&(x.removeClass("placeholder-text"),re&&n.cancel(re),re=n(function(){H||(x[0].focus(),i.setSelectionToElementEnd(x.children()[x.children().length-1])),re=void 0},1)),A?(ue(E.placeholder?""===e?$:e:""===e?$:e),D?x.off("drop",ie):(se(),x.on("drop",ie))):"textarea"!==x[0].tagName.toLowerCase()&&"input"!==x[0].tagName.toLowerCase()?ue(c(e)):x.val(e)),A&&E.placeholder&&(""===e?H?x.removeClass("placeholder-text"):x.addClass("placeholder-text"):x.removeClass("placeholder-text")),de=B=!1}},E.taReadonly&&(D=r.$eval(E.taReadonly),D?(x.addClass("ta-readonly"),"textarea"!==x[0].tagName.toLowerCase()&&"input"!==x[0].tagName.toLowerCase()||x.attr("disabled","disabled"),void 0!==x.attr("contenteditable")&&x.attr("contenteditable")&&x.removeAttr("contenteditable")):(x.removeClass("ta-readonly"),"textarea"===x[0].tagName.toLowerCase()||"input"===x[0].tagName.toLowerCase()?x.removeAttr("disabled"):A&&x.attr("contenteditable","true")),r.$watch(E.taReadonly,function(e,t){t!==e&&(e?(x.addClass("ta-readonly"),"textarea"!==x[0].tagName.toLowerCase()&&"input"!==x[0].tagName.toLowerCase()||x.attr("disabled","disabled"),void 0!==x.attr("contenteditable")&&x.attr("contenteditable")&&x.removeAttr("contenteditable"),angular.forEach(u,function(e){x.find(e).on("click",le)}),x.off("drop",ie)):(x.removeClass("ta-readonly"),"textarea"===x[0].tagName.toLowerCase()||"input"===x[0].tagName.toLowerCase()?x.removeAttr("disabled"):A&&x.attr("contenteditable","true"),angular.forEach(u,function(e){x.find(e).off("click",le)}),x.on("drop",ie)),D=e)})),A&&!D&&(angular.forEach(u,function(e){x.find(e).on("click",le)}),x.on("drop",ie))}}}]);var y=!1,x=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);return x.config([function(){angular.forEach(r,function(e,t){delete r[t]})}]),x.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$document","$animate","$log","$q","$parse",function(t,n,a,r,l,i,s,u,d,c,p){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(f,m,g,h){var v,b,y,x,E,S,w,T,C,$,N,L=g.serial?g.serial:Math.floor(1e16*Math.random());f._name=g.name?g.name:"textAngularEditor"+L;var k=function(e,t,a){n(function(){var n=function(){e.off(t,n),a.apply(this,arguments)};e.on(t,n)},100)};if(C=l(g.taDefaultWrap),angular.extend(f,angular.copy(a),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?f["$undoTaBindtaTextElement"+L]():"redo"===e.toLowerCase()?f["$redoTaBindtaTextElement"+L]():(C(e,!1,t,f.defaultTagAttributes),n&&f["reApplyOnSelectorHandlerstaTextElement"+L](),f.displayElements.text[0].focus())},showHtml:f.$eval(g.taShowHtml)||!1}),g.taFocussedClass&&(f.classes.focussed=g.taFocussedClass),g.taTextEditorClass&&(f.classes.textEditor=g.taTextEditorClass),g.taHtmlEditorClass&&(f.classes.htmlEditor=g.taHtmlEditorClass),g.taDefaultTagAttributes)try{angular.extend(f.defaultTagAttributes,angular.fromJson(g.taDefaultTagAttributes))}catch(A){d.error(A)}g.taTextEditorSetup&&(f.setup.textEditorSetup=f.$parent.$eval(g.taTextEditorSetup)),g.taHtmlEditorSetup&&(f.setup.htmlEditorSetup=f.$parent.$eval(g.taHtmlEditorSetup)),g.taFileDrop?f.fileDropHandler=f.$parent.$eval(g.taFileDrop):f.fileDropHandler=f.defaultFileDropHandler,w=m[0].innerHTML,m[0].innerHTML="",f.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},f.displayElements.popover.append(f.displayElements.popoverArrow),f.displayElements.popover.append(f.displayElements.popoverContainer),f.displayElements.scrollWindow.append(f.displayElements.popover),f.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),f.showPopover=function(e){f.displayElements.popover.css("display","block"),f.reflowPopover(e),u.addClass(f.displayElements.popover,"in"),k(s.find("body"),"click keyup",function(){f.hidePopover()})},f.reflowPopover=function(e){f.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(f.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+f.displayElements.scrollWindow[0].scrollTop+"px"),f.displayElements.popover.removeClass("top").addClass("bottom")):(f.displayElements.popover.css("top",e[0].offsetTop-54+f.displayElements.scrollWindow[0].scrollTop+"px"),f.displayElements.popover.removeClass("bottom").addClass("top"));var t=f.displayElements.text[0].offsetWidth-f.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-f.displayElements.popover[0].offsetWidth/2;f.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),f.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},f.hidePopover=function(){f.displayElements.popover.css("display",""),f.displayElements.popoverContainer.attr("style",""),f.displayElements.popoverContainer.attr("class","popover-content"),f.displayElements.popover.removeClass("in")},f.displayElements.resize.overlay.append(f.displayElements.resize.background),angular.forEach(f.displayElements.resize.anchors,function(e){f.displayElements.resize.overlay.append(e)}),f.displayElements.resize.overlay.append(f.displayElements.resize.info),f.displayElements.scrollWindow.append(f.displayElements.resize.overlay),f.reflowResizeOverlay=function(e){e=angular.element(e)[0],f.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),f.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},f.showResizeOverlay=function(e){var t=s.find("body");$=function(n){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===a.width||isNaN(a.width))&&(a.width=e[0].offsetWidth),(void 0===a.height||isNaN(a.height))&&(a.height=e[0].offsetHeight),f.hidePopover();var o=a.height/a.width,r=function(t){function n(e){return Math.round(Math.max(0,e))}var r={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))},l=void 0!==g.taResizeForceAspectRatio,i=g.taResizeMaintainAspectRatio,s=l||i&&!t.shiftKey;if(s){var u=r.y/r.x;r.x=o>u?r.x:r.y/o,r.y=o>u?r.x*o:r.y}var d=angular.element(e);d.css("height",n(r.y)+"px"),d.css("width",n(r.x)+"px"),f.reflowResizeOverlay(e)};t.on("mousemove",r),k(t,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),t.off("mousemove",r),f.$apply(function(){f.hidePopover(),f.updateTaBindtaTextElement()},100)}),n.stopPropagation(),n.preventDefault()},f.displayElements.resize.anchors[3].off("mousedown"),f.displayElements.resize.anchors[3].on("mousedown",$),f.reflowResizeOverlay(e),k(t,"click",function(){f.hideResizeOverlay()})},f.hideResizeOverlay=function(){f.displayElements.resize.anchors[3].off("mousedown",$),f.displayElements.resize.overlay.css("display","")},f.setup.htmlEditorSetup(f.displayElements.html),f.setup.textEditorSetup(f.displayElements.text),f.displayElements.html.attr({id:"taHtmlElement"+L,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":m.attr("ng-model-options")}),f.displayElements.text.attr({id:"taTextElement"+L,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":m.attr("ng-model-options")}),f.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),g.taDefaultWrap&&f.displayElements.text.attr("ta-default-wrap",g.taDefaultWrap),g.taUnsafeSanitizer&&(f.displayElements.text.attr("ta-unsafe-sanitizer",g.taUnsafeSanitizer),f.displayElements.html.attr("ta-unsafe-sanitizer",g.taUnsafeSanitizer)),f.displayElements.scrollWindow.append(f.displayElements.text),m.append(f.displayElements.scrollWindow),m.append(f.displayElements.html),f.displayElements.forminput.attr("name",f._name),m.append(f.displayElements.forminput),g.tabindex&&(m.removeAttr("tabindex"),f.displayElements.text.attr("tabindex",g.tabindex),f.displayElements.html.attr("tabindex",g.tabindex)),g.placeholder&&(f.displayElements.text.attr("placeholder",g.placeholder),f.displayElements.html.attr("placeholder",g.placeholder)),g.taDisabled&&(f.displayElements.text.attr("ta-readonly","disabled"),f.displayElements.html.attr("ta-readonly","disabled"),f.disabled=f.$parent.$eval(g.taDisabled),f.$parent.$watch(g.taDisabled,function(e){f.disabled=e,f.disabled?m.addClass(f.classes.disabled):m.removeClass(f.classes.disabled)})),g.taPaste&&(f._pasteHandler=function(e){return p(g.taPaste)(f.$parent,{$html:e})},f.displayElements.text.attr("ta-paste","_pasteHandler($html)")),t(f.displayElements.scrollWindow)(f),t(f.displayElements.html)(f),f.updateTaBindtaTextElement=f["updateTaBindtaTextElement"+L],f.updateTaBindtaHtmlElement=f["updateTaBindtaHtmlElement"+L],m.addClass("ta-root"),f.displayElements.scrollWindow.addClass("ta-text ta-editor "+f.classes.textEditor),f.displayElements.html.addClass("ta-html ta-editor "+f.classes.htmlEditor),f._actionRunning=!1;var M=!1;if(f.startAction=function(){return f._actionRunning=!0,M=e.saveSelection(),function(){M&&e.restoreSelection(M)}},f.endAction=function(){f._actionRunning=!1,M&&(f.showHtml?f.displayElements.html[0].focus():f.displayElements.text[0].focus(),e.removeMarkers(M)),M=!1,f.updateSelectedStyles(),f.showHtml||f["updateTaBindtaTextElement"+L]()},E=function(){f.focussed=!0,m.addClass(f.classes.focussed),T.focus(),m.triggerHandler("focus")},f.displayElements.html.on("focus",E),f.displayElements.text.on("focus",E),S=function(e){return f._actionRunning||s[0].activeElement===f.displayElements.html[0]||s[0].activeElement===f.displayElements.text[0]||(m.removeClass(f.classes.focussed),T.unfocus(),n(function(){f._bUpdateSelectedStyles=!1,m.triggerHandler("blur"),f.focussed=!1},0)),e.preventDefault(),!1},f.displayElements.html.on("blur",S),f.displayElements.text.on("blur",S),f.displayElements.text.on("paste",function(e){m.triggerHandler("paste",e)}),f.queryFormatBlockState=function(e){return!f.showHtml&&e.toLowerCase()===s[0].queryCommandValue("formatBlock").toLowerCase()},f.queryCommandState=function(e){return f.showHtml?"":s[0].queryCommandState(e)},f.switchView=function(){f.showHtml=!f.showHtml,u.enabled(!1,f.displayElements.html),u.enabled(!1,f.displayElements.text);var e;e=h?h.$viewValue:f.html;var t=f.displayElements.html[0].value;o(t).childElementCount!==o(e).childElementCount&&f.displayElements.html.val(e),f.showHtml?n(function(){return u.enabled(!0,f.displayElements.html),u.enabled(!0,f.displayElements.text),f.displayElements.html[0].focus()},100):n(function(){return u.enabled(!0,f.displayElements.html),u.enabled(!0,f.displayElements.text),f.displayElements.text[0].focus()},100)},g.ngModel){var D=!0;h.$render=function(){if(D){D=!1;var e=f.$parent.$eval(g.ngModel);void 0!==e&&null!==e||!w||""===w||h.$setViewValue(w)}f.displayElements.forminput.val(h.$viewValue),f.html=h.$viewValue||""},m.attr("required")&&(h.$validators.required=function(e,t){var n=e||t;return!(!n||""===n.trim())})}else f.displayElements.forminput.val(w),f.html=w;if(f.$watch("html",function(e,t){e!==t&&(g.ngModel&&h.$viewValue!==e&&h.$setViewValue(e),f.displayElements.forminput.val(e))}),g.taTargetToolbars)T=i.registerEditor(f._name,f,g.taTargetToolbars.split(","));else{var H=angular.element('<div text-angular-toolbar name="textAngularToolbar'+L+'">');g.taToolbar&&H.attr("ta-toolbar",g.taToolbar),g.taToolbarClass&&H.attr("ta-toolbar-class",g.taToolbarClass),g.taToolbarGroupClass&&H.attr("ta-toolbar-group-class",g.taToolbarGroupClass),g.taToolbarButtonClass&&H.attr("ta-toolbar-button-class",g.taToolbarButtonClass),g.taToolbarActiveButtonClass&&H.attr("ta-toolbar-active-button-class",g.taToolbarActiveButtonClass),g.taFocussedClass&&H.attr("ta-focussed-class",g.taFocussedClass),m.prepend(H),t(H)(f.$parent),T=i.registerEditor(f._name,f,["textAngularToolbar"+L])}f.$on("$destroy",function(){i.unregisterEditor(f._name),angular.element(window).off("blur")}),f.$on("ta-element-select",function(e,t){T.triggerElementSelect(e,t)&&f["reApplyOnSelectorHandlerstaTextElement"+L]()}),f.$on("ta-drop-event",function(e,t,a,o){f.displayElements.text[0].focus(),o&&o.files&&o.files.length>0?(angular.forEach(o.files,function(e){try{c.when(f.fileDropHandler(e,f.wrapSelection)||f.fileDropHandler!==f.defaultFileDropHandler&&c.when(f.defaultFileDropHandler(e,f.wrapSelection))).then(function(){f["updateTaBindtaTextElement"+L]()})}catch(t){d.error(t)}}),a.preventDefault(),a.stopPropagation()):n(function(){f["updateTaBindtaTextElement"+L]()},0)}),f._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){f._bUpdateSelectedStyles=!1,f.focussed=!1}),f.updateSelectedStyles=function(){var e;N&&n.cancel(N),void 0!==(e=r.getSelectionElement())&&e.parentNode!==f.displayElements.text[0]?T.updateSelectedStyles(angular.element(e)):T.updateSelectedStyles(),f._bUpdateSelectedStyles&&(N=n(f.updateSelectedStyles,200))},v=function(){return f.focussed?void(f._bUpdateSelectedStyles||(f._bUpdateSelectedStyles=!0,f.$apply(function(){f.updateSelectedStyles()}))):void(f._bUpdateSelectedStyles=!1)},f.displayElements.html.on("keydown",v),f.displayElements.text.on("keydown",v),b=function(){f._bUpdateSelectedStyles=!1},f.displayElements.html.on("keyup",b),f.displayElements.text.on("keyup",b),y=function(e,t){t&&angular.extend(e,t),f.$apply(function(){return T.sendKeyCommand(e)?(f._bUpdateSelectedStyles||f.updateSelectedStyles(),e.preventDefault(),!1):void 0})},f.displayElements.html.on("keypress",y),f.displayElements.text.on("keypress",y),x=function(){f._bUpdateSelectedStyles=!1,f.$apply(function(){f.updateSelectedStyles()})},f.displayElements.html.on("mouseup",x),f.displayElements.text.on("mouseup",x)}}}]),x.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool","$interval","$rootScope",function(e,t,n,a,o){var r,l={},i={},s=[],u=0,d=function(e){angular.forEach(i,function(t){t.editorFunctions.updateSelectedStyles(e)})},c=50,p=function(){u=Date.now(),r=a(function(){d(),r=void 0},c,1)};o.$on("destroy",function(){r&&(a.cancel(r),r=void 0)});var f=function(){Math.abs(Date.now()-u)>c&&p()};return{registerEditor:function(n,a,o){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!a)throw"textAngular Error: An editor requires a scope";if(i[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';return angular.forEach(o,function(e){l[e]&&s.push(l[e])}),i[n]={scope:a,toolbars:o,_registerToolbarScope:function(e){this.toolbars.indexOf(e.name)>=0&&s.push(e)},editorFunctions:{disable:function(){angular.forEach(s,function(e){e.disabled=!0})},enable:function(){angular.forEach(s,function(e){e.disabled=!1})},focus:function(){angular.forEach(s,function(e){e._parent=a,e.disabled=!1,e.focussed=!0,a.focussed=!0})},unfocus:function(){angular.forEach(s,function(e){e.disabled=!0,e.focussed=!1}),a.focussed=!1},updateSelectedStyles:function(e){angular.forEach(s,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=a,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var o=!1;return(n.ctrlKey||n.metaKey||n.specialKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&(t.commandKeyCode===n.which||t.commandKeyCode===n.specialKey))for(var l=0;l<s.length;l++)if(void 0!==s[l].tools[r]){
e.call(s[l].tools[r],a),o=!0;break}}),o},triggerElementSelect:function(e,n){var o=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},r=[],l={},i=!1;n=angular.element(n);var u=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(u=u||angular.isArray(e.onElementSelect.onlyWithAttrs)&&o(n,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!o(n,e.onElementSelect.onlyWithAttrs)||(l[t]=e))}),u?(angular.forEach(l,function(e,t){e.onElementSelect.onlyWithAttrs&&o(n,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(l,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var d=0;d<r.length;d++){for(var c=r[d].tool,p=r[d].name,f=0;f<s.length;f++)if(void 0!==s[f].tools[p]){c.onElementSelect.action.call(s[f].tools[p],e,n,a),i=!0;break}if(i)break}return i}}},f(),i[n].editorFunctions},retrieveEditor:function(e){return i[e]},unregisterEditor:function(e){delete i[e],f()},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(l[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';l[e.name]=e,angular.forEach(i,function(t){t._registerToolbarScope(e)}),f()},retrieveToolbar:function(e){return l[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete l[e];var t=[];for(var n in s)s[n].name!==e&&t.push(s[n]);s=t,f()},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)}),f()},updateToolDisplay:function(e,t){var n=this;angular.forEach(l,function(a,o){n.updateToolbarToolDisplay(o,e,t)}),f()},resetToolDisplay:function(e){var t=this;angular.forEach(l,function(n,a){t.resetToolbarToolDisplay(a,e)}),f()},updateToolbarToolDisplay:function(e,t,n){if(!l[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';l[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!l[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';l[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(l,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var a,o=0;o<t.toolbar[n].length;o++){if(t.toolbar[n][o]===e){a={group:n,index:o};break}if(void 0!==a)break}void 0!==a&&(t.toolbar[a.group].slice(a.index,1),t._$element.children().eq(a.group).children().eq(a.index).remove())}}),f()},addTool:function(e,t,a,o){n(e,t),angular.forEach(l,function(n){n.addTool(e,t,a,o)}),f()},addToolToToolbar:function(e,t,a,o,r){n(e,t),l[a].addTool(e,t,o,r),f()},refreshEditor:function(e){if(!i[e])throw'textAngular Error: No Editor with name "'+e+'" exists';i[e].scope.updateTaBindtaTextElement(),i[e].scope.$$phase||i[e].scope.$digest(),f()},sendKeyCommand:function(e,t){var n=i[e._name];return n&&n.editorFunctions.sendKeyCommand(t)?(e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1):void 0},updateStyles:d,getToolbarScopes:function(){return s}}}]),x.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,a,o,r){return{scope:{name:"@"},restrict:"EA",link:function(l,i,s){if(!l.name||""===l.name)throw"textAngular Error: A toolbar requires a name";angular.extend(l,angular.copy(n)),s.taToolbar&&(l.toolbar=l.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(l.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(l.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(l.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(l.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(l.classes.focussed=s.taFocussedClass),l.disabled=!0,l.focussed=!1,l._$element=i,i[0].innerHTML="",i.addClass("ta-toolbar "+l.classes.toolbar),l.$watch("focussed",function(){l.focussed?i.addClass(l.classes.focussed):i.removeClass(l.classes.focussed)});var u=function(t,n){var a;if(a=t&&t.display?angular.element(t.display):angular.element("<button type='button'>"),t&&t["class"]?a.addClass(t["class"]):a.addClass(l.classes.toolbarButton),a.attr("name",n.name),a.attr("ta-button","ta-button"),a.attr("ng-disabled","isDisabled()"),a.attr("tabindex","-1"),a.attr("ng-click","executeAction()"),a.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&a.attr("title",t.tooltiptext),t&&!t.display&&!n._display&&(a[0].innerHTML="",t.buttontext&&(a[0].innerHTML=t.buttontext),t.iconclass)){var o=angular.element("<i>"),r=a[0].innerHTML;o.addClass(t.iconclass),a[0].innerHTML="",a.append(o),r&&""!==r&&a.append("&nbsp;"+r)}return n._lastToolDefinition=angular.copy(t),e(a)(n)};l.tools={},l._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var d={$window:r,$editor:function(){return l._parent},isDisabled:function(){return"html"===this.name&&l._parent.startAction?!1:"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?l.classes.toolbarButtonActive:""},executeAction:o};angular.forEach(l.toolbar,function(e){var t=angular.element("<div>");t.addClass(l.classes.toolbarGroup),angular.forEach(e,function(e){l.tools[e]=angular.extend(l.$new(!0),a[e],d,{name:e}),l.tools[e].$element=u(a[e],l.tools[e]),t.append(l.tools[e].$element)}),i.append(t)}),l.updateToolDisplay=function(e,t,n){var a=l.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var o=u(t,a);a.$element.replaceWith(o),a.$element=o}},l.addTool=function(e,t,n,o){l.tools[e]=angular.extend(l.$new(!0),a[e],d,{name:e}),l.tools[e].$element=u(a[e],l.tools[e]);var r;void 0===n&&(n=l.toolbar.length-1),r=angular.element(i.children()[n]),void 0===o?(r.append(l.tools[e].$element),l.toolbar[n][l.toolbar[n].length-1]=e):(r.children().eq(o).after(l.tools[e].$element),l.toolbar[n][o]=e)},t.registerToolbar(l),l.$on("$destroy",function(){t.unregisterToolbar(l.name)})}}}]),x.name});
//# sourceMappingURL=textAngular.umd.min.js.map