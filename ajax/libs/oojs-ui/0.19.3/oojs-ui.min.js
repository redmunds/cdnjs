!function(t){"use strict";t.ui={},t.ui.bind=$.proxy,t.ui.Keys={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},t.ui.MouseButtons={LEFT:1,MIDDLE:2,RIGHT:3},t.ui.elementId=0,t.ui.generateElementId=function(){return t.ui.elementId++,"oojsui-"+t.ui.elementId},t.ui.isFocusableElement=function(t){var e,i=t[0];return!i.disabled&&(!(!$.expr.filters.visible(i)||t.parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length)&&("true"===i.contentEditable||(t.prop("tabIndex")>=0||(e=i.nodeName.toLowerCase(),["input","select","textarea","button","object"].indexOf(e)!==-1||("a"===e||"area"===e)&&void 0!==t.attr("href")))))},t.ui.findFocusable=function(e,i){var n=$([]),o=e.find("input, select, textarea, button, object, a, area, [contenteditable], [tabindex]");return i&&(o=Array.prototype.reverse.call(o)),o.each(function(){var e=$(this);if(t.ui.isFocusableElement(e))return n=e,!1}),n},t.ui.getUserLanguages=function(){return["en"]},t.ui.getLocalValue=function(e,i,n){var o,s,l;if(e[i])return e[i];for(l=t.ui.getUserLanguages(),o=0,s=l.length;o<s;o++)if(i=l[o],e[i])return e[i];if(e[n])return e[n];for(i in e)return e[i]},t.ui.contains=function(t,e,i){var n;for(Array.isArray(t)||(t=[t]),n=t.length-1;n>=0;n--)if(i&&e===t[n]||$.contains(t[n],e))return!0;return!1},t.ui.debounce=function(t,e,i){var n;return function(){var o=this,s=arguments,l=function(){n=null,i||t.apply(o,s)};i&&!n&&t.apply(o,s),n&&!e||(clearTimeout(n),n=setTimeout(l,e))}},t.ui.warnDeprecation=function(e){void 0!==t.getProp(window,"console","warn")&&console.warn(e)},t.ui.throttle=function(e,i){var n,o,s,l=0,u=function(){s=null,l=t.ui.now(),e.apply(n,o)};return function(){var e=i-(t.ui.now()-l);n=this,o=arguments,e<=0?(clearTimeout(s),u()):s||(s=setTimeout(u,e))}},t.ui.now=Date.now||function(){return(new Date).getTime()},t.ui.infuse=function(e){return t.ui.Element.static.infuse(e)},function(){var e={"ooui-outline-control-move-down":"Move item down","ooui-outline-control-move-up":"Move item up","ooui-outline-control-remove":"Remove item","ooui-toolbar-more":"More","ooui-toolgroup-expand":"More","ooui-toolgroup-collapse":"Fewer","ooui-dialog-message-accept":"OK","ooui-dialog-message-reject":"Cancel","ooui-dialog-process-error":"Something went wrong","ooui-dialog-process-dismiss":"Dismiss","ooui-dialog-process-retry":"Try again","ooui-dialog-process-continue":"Continue","ooui-selectfile-button-select":"Select a file","ooui-selectfile-not-supported":"File selection is not supported","ooui-selectfile-placeholder":"No file is selected","ooui-selectfile-dragdrop-placeholder":"Drop file here"};t.ui.msg=function(t){var i=e[t],n=Array.prototype.slice.call(arguments,1);return i="string"==typeof i?i.replace(/\$(\d+)/g,function(t,e){var i=parseInt(e,10);return void 0!==n[i-1]?n[i-1]:"$"+e}):"["+t+"]"}}(),t.ui.deferMsg=function(){var e=arguments;return function(){return t.ui.msg.apply(t.ui,e)}},t.ui.resolveMsg=function(t){return $.isFunction(t)?t():t},t.ui.isSafeUrl=function(t){function e(t,e){return t.substr(0,e.length)===e}var i,n;if(n=["bitcoin","ftp","ftps","geo","git","gopher","http","https","irc","ircs","magnet","mailto","mms","news","nntp","redis","sftp","sip","sips","sms","ssh","svn","tel","telnet","urn","worldwind","xmpp"],""===t)return!0;for(i=0;i<n.length;i++)if(e(t,n[i]+":"))return!0;return!(!e(t,"/")&&!e(t,"./"))||!(!e(t,"?")&&!e(t,"#"))},t.ui.isMobile=function(){return!1},t.ui.mixin={},t.ui.Element=function(e){e=e||{},this.$=$,this.visible=!0,this.data=e.data,this.$element=e.$element||$(document.createElement(this.getTagName())),this.elementGroup=null,Array.isArray(e.classes)&&this.$element.addClass(e.classes.join(" ")),e.id&&this.$element.attr("id",e.id),e.text&&this.$element.text(e.text),e.content&&this.$element.append(e.content.map(function(e){return"string"==typeof e?document.createTextNode(e):e instanceof t.ui.HtmlSnippet?e.toString():e instanceof t.ui.Element?e.$element:e})),e.$content&&this.$element.append(e.$content)},t.initClass(t.ui.Element),t.ui.Element.static.tagName="div",t.ui.Element.static.infuse=function(e){var i=t.ui.Element.static.unsafeInfuse(e,!1);return i},t.ui.Element.static.unsafeInfuse=function(e,i){var n,o,s,l,u,a,r,h,d,p;if("string"==typeof e?(n=e,o=$(document.getElementById(n))):(o=$(e),n=o.attr("id")),!o.length)throw new Error("Widget not found: "+n);if(o[0].oouiInfused&&(o=o[0].oouiInfused),s=o.data("ooui-infused")){if(s===!0)throw new Error("Circular dependency! "+n);return i&&(d=s.constructor.static.gatherPreInfuseState(o,s),i.done(s.restorePreInfuseState.bind(s,d)),p=o.data("ooui-infused-children"),p&&p.length&&p.forEach(function(t){var e=t.constructor.static.gatherPreInfuseState(o,t);i.done(t.restorePreInfuseState.bind(t,e))})),s}if(s=o.attr("data-ooui"),!s)throw new Error("No infusion data found: "+n);try{s=$.parseJSON(s)}catch(t){s=null}if(!s||!s._)throw new Error("No valid infusion data found: "+n);if("Tag"===s._)return new t.ui.Element({$element:o});if(u=s._.split("."),l=t.getProp.apply(t,[window].concat(u)),void 0===l&&(l=t.getProp.apply(t,[t.ui].concat(u)),void 0===l))throw new Error("Unknown widget type: id: "+n+", class: "+s._);for(a=l.parent;void 0!==a&&a!==t.ui.Element;)a=a.parent;if(a!==t.ui.Element)throw new Error("Unknown widget type: id: "+n+", class: "+s._);return i===!1&&(h=$.Deferred(),i=h.promise()),o.data("ooui-infused",!0),s.id=n,p=[],s=t.copy(s,null,function(e){var n;if(t.isPlainObject(e)){if(e.tag)return n=t.ui.Element.static.unsafeInfuse(e.tag,i),p.push(n),p.push.apply(p,n.$element.data("ooui-infused-children")||[]),n.$element.removeData("ooui-infused-children"),n;if(void 0!==e.html)return new t.ui.HtmlSnippet(e.html)}}),s=l.static.reusePreInfuseDOM(o[0],s),d=l.static.gatherPreInfuseState(o[0],s),r=new l(s),h&&(o[0]!==r.$element[0]&&(o.replaceWith(r.$element),o[0].oouiInfused=r.$element),h.resolve()),r.$element.data("ooui-infused",r),r.$element.data("ooui-infused-children",p),r.$element.attr("data-ooui",""),i.done(r.restorePreInfuseState.bind(r,d)),r},t.ui.Element.static.reusePreInfuseDOM=function(t,e){return e},t.ui.Element.static.gatherPreInfuseState=function(){return{}},t.ui.Element.static.getJQuery=function(t,e){function i(t){return $(t,i.context)}return i.context=this.getDocument(t),e&&(i.$iframe=e),i},t.ui.Element.static.getDocument=function(t){return t[0]&&t[0].ownerDocument||t.context||t.ownerDocument||t.document||9===t.nodeType&&t||null},t.ui.Element.static.getWindow=function(t){var e=this.getDocument(t);return e.defaultView},t.ui.Element.static.getDir=function(t){var e,i;return t instanceof jQuery&&(t=t[0]),e=9===t.nodeType,i=void 0!==t.document,(e||i)&&(i&&(t=t.document),t=t.body),$(t).css("direction")},t.ui.Element.static.getFrameOffset=function(t,e,i){var n,o,s,l,u;if(e||(e=window),i||(i={top:0,left:0}),t.parent===t)return i;for(s=t.parent.document.getElementsByTagName("iframe"),n=0,o=s.length;n<o;n++)if(s[n].contentWindow===t){l=s[n];break}return l&&(u=l.getBoundingClientRect(),i.left+=u.left,i.top+=u.top,t!==e&&this.getFrameOffset(t.parent,i)),i},t.ui.Element.static.getRelativePosition=function(t,e){for(var i,n,o=t.offset(),s=e.offset(),l=this.getDocument(t),u=this.getDocument(e);l!==u;){if(i=l.defaultView.frameElement,!i)throw new Error("$element frame is not contained in $anchor frame");n=$(i).offset(),o.left+=n.left,o.top+=n.top,l=i.ownerDocument}return o.left-=s.left,o.top-=s.top,o},t.ui.Element.static.getBorders=function(t){var e=t.ownerDocument,i=e.defaultView,n=i.getComputedStyle(t,null),o=$(t),s=parseFloat(n?n.borderTopWidth:o.css("borderTopWidth"))||0,l=parseFloat(n?n.borderLeftWidth:o.css("borderLeftWidth"))||0,u=parseFloat(n?n.borderBottomWidth:o.css("borderBottomWidth"))||0,a=parseFloat(n?n.borderRightWidth:o.css("borderRightWidth"))||0;return{top:s,left:l,bottom:u,right:a}},t.ui.Element.static.getDimensions=function(t){var e,i,n=t.ownerDocument||t.document,o=n.defaultView;return o===t||t===n.documentElement?(i=$(o),{borders:{top:0,left:0,bottom:0,right:0},scroll:{top:i.scrollTop(),left:i.scrollLeft()},scrollbar:{right:0,bottom:0},rect:{top:0,left:0,bottom:i.innerHeight(),right:i.innerWidth()}}):(e=$(t),{borders:this.getBorders(t),scroll:{top:e.scrollTop(),left:e.scrollLeft()},scrollbar:{right:e.innerWidth()-t.clientWidth,bottom:e.innerHeight()-t.clientHeight},rect:t.getBoundingClientRect()})},t.ui.Element.static.getRootScrollableElement=function(e){var i,n;return void 0===t.ui.scrollableElement&&(n=e.ownerDocument.body,i=n.scrollTop,n.scrollTop=1,1===n.scrollTop?(n.scrollTop=i,t.ui.scrollableElement="body"):t.ui.scrollableElement="documentElement"),e.ownerDocument[t.ui.scrollableElement]},t.ui.Element.static.getClosestScrollableContainer=function(t,e){var i,n,o=["overflow-x","overflow-y"],s=$(t).parent();for("x"!==e&&"y"!==e||(o=["overflow-"+e]);s.length;){if(s[0]===this.getRootScrollableElement(t))return s[0];for(i=o.length;i--;)if(n=s.css(o[i]),"auto"===n||"scroll"===n)return s[0];s=s.parent()}return this.getDocument(t).body},t.ui.Element.static.scrollIntoView=function(e,i){var n,o,s,l,u,a,r,h,d=$.Deferred();return i=i||{},o={},s="function"==typeof i.complete&&i.complete,s&&t.ui.warnDeprecation("Element#scrollIntoView: The `complete` callback config option is deprecated. Use the return promise instead."),l=this.getClosestScrollableContainer(e,i.direction),u=$(l),a=this.getDimensions(e),r=this.getDimensions(l),h=$(this.getWindow(e)),n=u.is("html, body")?{top:a.rect.top,bottom:h.innerHeight()-a.rect.bottom,left:a.rect.left,right:h.innerWidth()-a.rect.right}:{top:a.rect.top-(r.rect.top+r.borders.top),bottom:r.rect.bottom-r.borders.bottom-r.scrollbar.bottom-a.rect.bottom,left:a.rect.left-(r.rect.left+r.borders.left),right:r.rect.right-r.borders.right-r.scrollbar.right-a.rect.right},i.direction&&"y"!==i.direction||(n.top<0?o.scrollTop=r.scroll.top+n.top:n.top>0&&n.bottom<0&&(o.scrollTop=r.scroll.top+Math.min(n.top,-n.bottom))),i.direction&&"x"!==i.direction||(n.left<0?o.scrollLeft=r.scroll.left+n.left:n.left>0&&n.right<0&&(o.scrollLeft=r.scroll.left+Math.min(n.left,-n.right))),$.isEmptyObject(o)?(s&&s(),d.resolve()):(u.stop(!0).animate(o,void 0===i.duration?"fast":i.duration),u.queue(function(t){s&&s(),d.resolve(),t()})),d.promise()},t.ui.Element.static.reconsiderScrollbars=function(t){var e,i,n,o,s=[];for(n=t.scrollLeft,o=t.scrollTop;t.firstChild;)s.push(t.firstChild),t.removeChild(t.firstChild);for(void t.offsetHeight,e=0,i=s.length;e<i;e++)t.appendChild(s[e]);t.scrollLeft=n,t.scrollTop=o},t.ui.Element.prototype.toggle=function(t){return t=void 0===t?!this.visible:!!t,t!==this.isVisible()&&(this.visible=t,this.$element.toggleClass("oo-ui-element-hidden",!this.visible),this.emit("toggle",t)),this},t.ui.Element.prototype.isVisible=function(){return this.visible},t.ui.Element.prototype.getData=function(){return this.data},t.ui.Element.prototype.setData=function(t){return this.data=t,this},t.ui.Element.prototype.supports=function(t){var e,i,n=0;for(t=Array.isArray(t)?t:[t],e=0,i=t.length;e<i;e++)$.isFunction(this[t[e]])&&n++;return t.length===n},t.ui.Element.prototype.updateThemeClasses=function(){t.ui.theme.queueUpdateElementClasses(this)},t.ui.Element.prototype.getTagName=function(){return this.constructor.static.tagName},t.ui.Element.prototype.isElementAttached=function(){return $.contains(this.getElementDocument(),this.$element[0])},t.ui.Element.prototype.getElementDocument=function(){return t.ui.Element.static.getDocument(this.$element)},t.ui.Element.prototype.getElementWindow=function(){return t.ui.Element.static.getWindow(this.$element)},t.ui.Element.prototype.getClosestScrollableElementContainer=function(){return t.ui.Element.static.getClosestScrollableContainer(this.$element[0])},t.ui.Element.prototype.getElementGroup=function(){return this.elementGroup},t.ui.Element.prototype.setElementGroup=function(t){return this.elementGroup=t,this},t.ui.Element.prototype.scrollElementIntoView=function(e){return!this.isElementAttached()||!this.isVisible()||this.getElementGroup()&&!this.getElementGroup().isVisible()?$.Deferred().resolve():t.ui.Element.static.scrollIntoView(this.$element[0],e)},t.ui.Element.prototype.restorePreInfuseState=function(){},t.ui.HtmlSnippet=function(t){this.content=t},t.initClass(t.ui.HtmlSnippet),t.ui.HtmlSnippet.prototype.toString=function(){return this.content},t.ui.Layout=function(e){e=e||{},t.ui.Layout.parent.call(this,e),t.EventEmitter.call(this),this.$element.addClass("oo-ui-layout")},t.inheritClass(t.ui.Layout,t.ui.Element),t.mixinClass(t.ui.Layout,t.EventEmitter),t.ui.Widget=function(e){e=$.extend({disabled:!1},e),t.ui.Widget.parent.call(this,e),t.EventEmitter.call(this),this.disabled=null,this.wasDisabled=null,this.$element.addClass("oo-ui-widget"),this.setDisabled(!!e.disabled)},t.inheritClass(t.ui.Widget,t.ui.Element),t.mixinClass(t.ui.Widget,t.EventEmitter),t.ui.Widget.static.supportsSimpleLabel=!1,t.ui.Widget.prototype.isDisabled=function(){return this.disabled},t.ui.Widget.prototype.setDisabled=function(t){var e;return this.disabled=!!t,e=this.isDisabled(),e!==this.wasDisabled&&(this.$element.toggleClass("oo-ui-widget-disabled",e),this.$element.toggleClass("oo-ui-widget-enabled",!e),this.$element.attr("aria-disabled",e.toString()),this.emit("disable",e),this.updateThemeClasses()),this.wasDisabled=e,this},t.ui.Widget.prototype.updateDisabled=function(){return this.setDisabled(this.disabled),this},t.ui.Theme=function(){this.elementClassesQueue=[],this.debouncedUpdateQueuedElementClasses=t.ui.debounce(this.updateQueuedElementClasses)},t.initClass(t.ui.Theme),t.ui.Theme.prototype.getElementClasses=function(){return{on:[],off:[]}},t.ui.Theme.prototype.updateElementClasses=function(t){var e=$([]),i=this.getElementClasses(t);t.$icon&&(e=e.add(t.$icon)),t.$indicator&&(e=e.add(t.$indicator)),e.removeClass(i.off.join(" ")).addClass(i.on.join(" "))},t.ui.Theme.prototype.updateQueuedElementClasses=function(){var t;for(t=0;t<this.elementClassesQueue.length;t++)this.updateElementClasses(this.elementClassesQueue[t]);this.elementClassesQueue=[]},t.ui.Theme.prototype.queueUpdateElementClasses=function(t){this.elementClassesQueue.lastIndexOf(t)===-1&&(this.elementClassesQueue.push(t),this.debouncedUpdateQueuedElementClasses())},t.ui.Theme.prototype.getDialogTransitionDuration=function(){return 0},t.ui.mixin.TabIndexedElement=function(t){t=$.extend({tabIndex:0},t),this.$tabIndexed=null,this.tabIndex=null,this.connect(this,{disable:"onTabIndexedElementDisable"}),this.setTabIndex(t.tabIndex),this.setTabIndexedElement(t.$tabIndexed||this.$element)},t.initClass(t.ui.mixin.TabIndexedElement),t.ui.mixin.TabIndexedElement.prototype.setTabIndexedElement=function(t){var e=this.tabIndex;return this.setTabIndex(null),this.$tabIndexed=t,this.tabIndex=e,this.updateTabIndex()},t.ui.mixin.TabIndexedElement.prototype.setTabIndex=function(t){return t="number"==typeof t?t:null,this.tabIndex!==t&&(this.tabIndex=t,this.updateTabIndex()),this},t.ui.mixin.TabIndexedElement.prototype.updateTabIndex=function(){return this.$tabIndexed&&(null!==this.tabIndex?this.$tabIndexed.attr({tabindex:this.isDisabled()?-1:this.tabIndex,"aria-disabled":this.isDisabled().toString()}):this.$tabIndexed.removeAttr("tabindex aria-disabled")),this},t.ui.mixin.TabIndexedElement.prototype.onTabIndexedElementDisable=function(){this.updateTabIndex()},t.ui.mixin.TabIndexedElement.prototype.getTabIndex=function(){return this.tabIndex},t.ui.mixin.ButtonElement=function(t){t=t||{},this.$button=null,this.framed=null,this.active=void 0!==t.active&&t.active,this.onMouseUpHandler=this.onMouseUp.bind(this),this.onMouseDownHandler=this.onMouseDown.bind(this),this.onKeyDownHandler=this.onKeyDown.bind(this),this.onKeyUpHandler=this.onKeyUp.bind(this),this.onClickHandler=this.onClick.bind(this),this.onKeyPressHandler=this.onKeyPress.bind(this),this.$element.addClass("oo-ui-buttonElement"),this.toggleFramed(void 0===t.framed||t.framed),this.setButtonElement(t.$button||$("<a>"))},t.initClass(t.ui.mixin.ButtonElement),t.ui.mixin.ButtonElement.static.cancelButtonMouseDownEvents=!0,t.ui.mixin.ButtonElement.prototype.setButtonElement=function(t){this.$button&&this.$button.removeClass("oo-ui-buttonElement-button").removeAttr("role accesskey").off({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),this.$button=t.addClass("oo-ui-buttonElement-button").on({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),"A"===this.$button.prop("tagName").toUpperCase()&&this.$button.attr("role","button")},t.ui.mixin.ButtonElement.prototype.onMouseDown=function(e){if(!this.isDisabled()&&e.which===t.ui.MouseButtons.LEFT)return this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("mouseup",this.onMouseUpHandler,!0),!this.constructor.static.cancelButtonMouseDownEvents&&void 0},t.ui.mixin.ButtonElement.prototype.onMouseUp=function(e){this.isDisabled()||e.which!==t.ui.MouseButtons.LEFT||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("mouseup",this.onMouseUpHandler,!0))},t.ui.mixin.ButtonElement.prototype.onClick=function(e){if(!this.isDisabled()&&e.which===t.ui.MouseButtons.LEFT&&this.emit("click"))return!1},t.ui.mixin.ButtonElement.prototype.onKeyDown=function(e){this.isDisabled()||e.which!==t.ui.Keys.SPACE&&e.which!==t.ui.Keys.ENTER||(this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("keyup",this.onKeyUpHandler,!0))},t.ui.mixin.ButtonElement.prototype.onKeyUp=function(e){this.isDisabled()||e.which!==t.ui.Keys.SPACE&&e.which!==t.ui.Keys.ENTER||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("keyup",this.onKeyUpHandler,!0))},t.ui.mixin.ButtonElement.prototype.onKeyPress=function(e){if(!this.isDisabled()&&(e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER)&&this.emit("click"))return!1},t.ui.mixin.ButtonElement.prototype.isFramed=function(){return this.framed},t.ui.mixin.ButtonElement.prototype.toggleFramed=function(t){return t=void 0===t?!this.framed:!!t,t!==this.framed&&(this.framed=t,this.$element.toggleClass("oo-ui-buttonElement-frameless",!t).toggleClass("oo-ui-buttonElement-framed",t),this.updateThemeClasses()),this},t.ui.mixin.ButtonElement.prototype.setActive=function(t){return this.active=!!t,this.$element.toggleClass("oo-ui-buttonElement-active",this.active),this.updateThemeClasses(),this},t.ui.mixin.ButtonElement.prototype.isActive=function(){return this.active},t.ui.mixin.GroupElement=function(t){t=t||{},this.$group=null,this.items=[],this.aggregateItemEvents={},this.setGroupElement(t.$group||$("<div>"))},t.ui.mixin.GroupElement.prototype.setGroupElement=function(t){var e,i;for(this.$group=t,e=0,i=this.items.length;e<i;e++)this.$group.append(this.items[e].$element)},t.ui.mixin.GroupElement.prototype.isEmpty=function(){return!this.items.length},t.ui.mixin.GroupElement.prototype.getItems=function(){return this.items.slice(0)},t.ui.mixin.GroupElement.prototype.getItemFromData=function(e){var i,n,o,s=t.getHash(e);for(i=0,n=this.items.length;i<n;i++)if(o=this.items[i],s===t.getHash(o.getData()))return o;return null},t.ui.mixin.GroupElement.prototype.getItemsFromData=function(e){var i,n,o,s=t.getHash(e),l=[];for(i=0,n=this.items.length;i<n;i++)o=this.items[i],s===t.getHash(o.getData())&&l.push(o);return l},t.ui.mixin.GroupElement.prototype.aggregate=function(t){var e,i,n,o,s,l,u;for(l in t){if(u=t[l],Object.prototype.hasOwnProperty.call(this.aggregateItemEvents,l)){if(u)throw new Error("Duplicate item event aggregation for "+l);for(e=0,i=this.items.length;e<i;e++)n=this.items[e],n.connect&&n.disconnect&&(s={},s[l]=["emit",this.aggregateItemEvents[l],n],n.disconnect(this,s));delete this.aggregateItemEvents[l]}if(u)for(this.aggregateItemEvents[l]=u,e=0,i=this.items.length;e<i;e++)n=this.items[e],n.connect&&n.disconnect&&(o={},o[l]=["emit",u,n],n.connect(this,o))}},t.ui.mixin.GroupElement.prototype.addItems=function(t,e){var i,n,o,s,l,u,a=[];for(i=0,n=t.length;i<n;i++){if(o=t[i],u=this.items.indexOf(o),u>=0&&(this.removeItems([o]),u<e&&e--),o.connect&&o.disconnect&&!$.isEmptyObject(this.aggregateItemEvents)){l={};for(s in this.aggregateItemEvents)l[s]=["emit",this.aggregateItemEvents[s],o];o.connect(this,l)}o.setElementGroup(this),a.push(o.$element.get(0))}return void 0===e||e<0||e>=this.items.length?(this.$group.append(a),this.items.push.apply(this.items,t)):0===e?(this.$group.prepend(a),this.items.unshift.apply(this.items,t)):(this.items[e].$element.before(a),this.items.splice.apply(this.items,[e,0].concat(t))),this.emit("change",this.getItems()),this},t.ui.mixin.GroupElement.prototype.removeItems=function(t){var e,i,n,o,s,l;for(e=0,i=t.length;e<i;e++)if(n=t[e],o=this.items.indexOf(n),o!==-1){if(n.connect&&n.disconnect&&!$.isEmptyObject(this.aggregateItemEvents)){s={};for(l in this.aggregateItemEvents)s[l]=["emit",this.aggregateItemEvents[l],n];n.disconnect(this,s)}n.setElementGroup(null),this.items.splice(o,1),n.$element.detach()}return this.emit("change",this.getItems()),this},t.ui.mixin.GroupElement.prototype.clearItems=function(){var t,e,i,n,o;for(t=0,e=this.items.length;t<e;t++)i=this.items[t],i.connect&&i.disconnect&&!$.isEmptyObject(this.aggregateItemEvents)&&(n={},Object.prototype.hasOwnProperty.call(this.aggregateItemEvents,o)&&(n[o]=["emit",this.aggregateItemEvents[o],i]),i.disconnect(this,n)),i.setElementGroup(null),i.$element.detach();return this.emit("change",this.getItems()),this.items=[],this},t.ui.mixin.IconElement=function(t){t=t||{},this.$icon=null,this.icon=null,this.iconTitle=null,this.setIcon(t.icon||this.constructor.static.icon),this.setIconTitle(t.iconTitle||this.constructor.static.iconTitle),this.setIconElement(t.$icon||$("<span>"))},t.initClass(t.ui.mixin.IconElement),t.ui.mixin.IconElement.static.icon=null,t.ui.mixin.IconElement.static.iconTitle=null,t.ui.mixin.IconElement.prototype.setIconElement=function(t){this.$icon&&this.$icon.removeClass("oo-ui-iconElement-icon oo-ui-icon-"+this.icon).removeAttr("title"),this.$icon=t.addClass("oo-ui-iconElement-icon").toggleClass("oo-ui-icon-"+this.icon,!!this.icon),null!==this.iconTitle&&this.$icon.attr("title",this.iconTitle),this.updateThemeClasses()},t.ui.mixin.IconElement.prototype.setIcon=function(e){return e=t.isPlainObject(e)?t.ui.getLocalValue(e,null,"default"):e,e="string"==typeof e&&e.trim().length?e.trim():null,this.icon!==e&&(this.$icon&&(null!==this.icon&&this.$icon.removeClass("oo-ui-icon-"+this.icon),null!==e&&this.$icon.addClass("oo-ui-icon-"+e)),this.icon=e),this.$element.toggleClass("oo-ui-iconElement",!!this.icon),this.updateThemeClasses(),this},t.ui.mixin.IconElement.prototype.setIconTitle=function(e){return e="function"==typeof e||"string"==typeof e&&e.length?t.ui.resolveMsg(e):null,this.iconTitle!==e&&(this.iconTitle=e,this.$icon&&(null!==this.iconTitle?this.$icon.attr("title",e):this.$icon.removeAttr("title"))),this},t.ui.mixin.IconElement.prototype.getIcon=function(){return this.icon},t.ui.mixin.IconElement.prototype.getIconTitle=function(){return this.iconTitle},t.ui.mixin.IndicatorElement=function(t){t=t||{},this.$indicator=null,this.indicator=null,this.indicatorTitle=null,this.setIndicator(t.indicator||this.constructor.static.indicator),this.setIndicatorTitle(t.indicatorTitle||this.constructor.static.indicatorTitle),this.setIndicatorElement(t.$indicator||$("<span>"))},t.initClass(t.ui.mixin.IndicatorElement),t.ui.mixin.IndicatorElement.static.indicator=null,t.ui.mixin.IndicatorElement.static.indicatorTitle=null,t.ui.mixin.IndicatorElement.prototype.setIndicatorElement=function(t){this.$indicator&&this.$indicator.removeClass("oo-ui-indicatorElement-indicator oo-ui-indicator-"+this.indicator).removeAttr("title"),this.$indicator=t.addClass("oo-ui-indicatorElement-indicator").toggleClass("oo-ui-indicator-"+this.indicator,!!this.indicator),null!==this.indicatorTitle&&this.$indicator.attr("title",this.indicatorTitle),this.updateThemeClasses()},t.ui.mixin.IndicatorElement.prototype.setIndicator=function(t){return t="string"==typeof t&&t.length?t.trim():null,this.indicator!==t&&(this.$indicator&&(null!==this.indicator&&this.$indicator.removeClass("oo-ui-indicator-"+this.indicator),null!==t&&this.$indicator.addClass("oo-ui-indicator-"+t)),this.indicator=t),this.$element.toggleClass("oo-ui-indicatorElement",!!this.indicator),this.updateThemeClasses(),this},t.ui.mixin.IndicatorElement.prototype.setIndicatorTitle=function(e){return e="function"==typeof e||"string"==typeof e&&e.length?t.ui.resolveMsg(e):null,this.indicatorTitle!==e&&(this.indicatorTitle=e,this.$indicator&&(null!==this.indicatorTitle?this.$indicator.attr("title",e):this.$indicator.removeAttr("title"))),this},t.ui.mixin.IndicatorElement.prototype.getIndicator=function(){return this.indicator},t.ui.mixin.IndicatorElement.prototype.getIndicatorTitle=function(){return this.indicatorTitle},t.ui.mixin.LabelElement=function(t){t=t||{},this.$label=null,this.label=null,this.setLabel(t.label||this.constructor.static.label),this.setLabelElement(t.$label||$("<span>"))},t.initClass(t.ui.mixin.LabelElement),t.ui.mixin.LabelElement.static.label=null,t.ui.mixin.LabelElement.static.highlightQuery=function(t,e){var i=$("<span>"),n=t.toLowerCase().indexOf(e.toLowerCase());return e.length&&n!==-1?(i.append(document.createTextNode(t.slice(0,n)),$("<span>").addClass("oo-ui-labelElement-label-highlight").text(t.slice(n,n+e.length)),document.createTextNode(t.slice(n+e.length))),i.contents()):i.text(t)},t.ui.mixin.LabelElement.prototype.setLabelElement=function(t){this.$label&&this.$label.removeClass("oo-ui-labelElement-label").empty(),this.$label=t.addClass("oo-ui-labelElement-label"),this.setLabelContent(this.label)},t.ui.mixin.LabelElement.prototype.setLabel=function(e){return e="function"==typeof e?t.ui.resolveMsg(e):e,e=("string"==typeof e||e instanceof jQuery)&&e.length||e instanceof t.ui.HtmlSnippet&&e.toString().length?e:null,this.label!==e&&(this.$label&&this.setLabelContent(e),this.label=e,this.emit("labelChange")),this.$element.toggleClass("oo-ui-labelElement",!!this.label),this},t.ui.mixin.LabelElement.prototype.setHighlightedQuery=function(t,e){return this.setLabel(this.constructor.static.highlightQuery(t,e))},t.ui.mixin.LabelElement.prototype.getLabel=function(){return this.label},t.ui.mixin.LabelElement.prototype.setLabelContent=function(e){"string"==typeof e?e.match(/^\s*$/)?this.$label.html("&nbsp;"):this.$label.text(e):e instanceof t.ui.HtmlSnippet?this.$label.html(e.toString()):e instanceof jQuery?this.$label.empty().append(e):this.$label.empty()},t.ui.mixin.FlaggedElement=function(t){t=t||{},this.flags={},this.$flagged=null,this.setFlags(t.flags),this.setFlaggedElement(t.$flagged||this.$element)},t.ui.mixin.FlaggedElement.prototype.setFlaggedElement=function(t){var e=Object.keys(this.flags).map(function(t){return"oo-ui-flaggedElement-"+t}).join(" ");this.$flagged&&this.$flagged.removeClass(e),this.$flagged=t.addClass(e)},t.ui.mixin.FlaggedElement.prototype.hasFlag=function(t){return this.flags&&t in this.flags},t.ui.mixin.FlaggedElement.prototype.getFlags=function(){return Object.keys(this.flags||{})},t.ui.mixin.FlaggedElement.prototype.clearFlags=function(){var t,e,i={},n=[],o="oo-ui-flaggedElement-";for(t in this.flags)e=o+t,i[t]=!1,delete this.flags[t],n.push(e);return this.$flagged&&this.$flagged.removeClass(n.join(" ")),this.updateThemeClasses(),this.emit("flag",i),this},t.ui.mixin.FlaggedElement.prototype.setFlags=function(e){var i,n,o,s,l={},u=[],a=[],r="oo-ui-flaggedElement-";if("string"==typeof e)s=r+e,this.flags[e]||(this.flags[e]=!0,u.push(s));else if(Array.isArray(e))for(i=0,n=e.length;i<n;i++)o=e[i],s=r+o,this.flags[o]||(l[o]=!0,this.flags[o]=!0,u.push(s));else if(t.isPlainObject(e))for(o in e)s=r+o,e[o]?this.flags[o]||(l[o]=!0,this.flags[o]=!0,u.push(s)):this.flags[o]&&(l[o]=!1,delete this.flags[o],a.push(s));return this.$flagged&&this.$flagged.addClass(u.join(" ")).removeClass(a.join(" ")),this.updateThemeClasses(),this.emit("flag",l),this},t.ui.mixin.TitledElement=function(t){t=t||{},this.$titled=null,this.title=null,this.setTitle(void 0!==t.title?t.title:this.constructor.static.title),this.setTitledElement(t.$titled||this.$element)},t.initClass(t.ui.mixin.TitledElement),t.ui.mixin.TitledElement.static.title=null,t.ui.mixin.TitledElement.prototype.setTitledElement=function(t){this.$titled&&this.$titled.removeAttr("title"),this.$titled=t,this.title&&this.$titled.attr("title",this.title)},t.ui.mixin.TitledElement.prototype.setTitle=function(e){return e="function"==typeof e?t.ui.resolveMsg(e):e,e="string"==typeof e&&e.length?e:null,this.title!==e&&(this.$titled&&(null!==e?this.$titled.attr("title",e):this.$titled.removeAttr("title")),this.title=e),this},t.ui.mixin.TitledElement.prototype.getTitle=function(){return this.title},t.ui.mixin.AccessKeyedElement=function(t){t=t||{},this.$accessKeyed=null,this.accessKey=null,this.setAccessKey(t.accessKey||null),this.setAccessKeyedElement(t.$accessKeyed||this.$element)},t.initClass(t.ui.mixin.AccessKeyedElement),t.ui.mixin.AccessKeyedElement.static.accessKey=null,t.ui.mixin.AccessKeyedElement.prototype.setAccessKeyedElement=function(t){this.$accessKeyed&&this.$accessKeyed.removeAttr("accesskey"),this.$accessKeyed=t,this.accessKey&&this.$accessKeyed.attr("accesskey",this.accessKey)},t.ui.mixin.AccessKeyedElement.prototype.setAccessKey=function(e){return e="string"==typeof e?t.ui.resolveMsg(e):null,this.accessKey!==e&&(this.$accessKeyed&&(null!==e?this.$accessKeyed.attr("accesskey",e):this.$accessKeyed.removeAttr("accesskey")),this.accessKey=e),this},t.ui.mixin.AccessKeyedElement.prototype.getAccessKey=function(){return this.accessKey},t.ui.ButtonWidget=function(e){e=e||{},t.ui.ButtonWidget.parent.call(this,e),t.ui.mixin.ButtonElement.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$button})),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$button})),t.ui.mixin.AccessKeyedElement.call(this,$.extend({},e,{$accessKeyed:this.$button})),this.href=null,this.target=null,this.noFollow=!1,this.connect(this,{disable:"onDisable"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonWidget").append(this.$button),this.setActive(e.active),this.setHref(e.href),this.setTarget(e.target),this.setNoFollow(e.noFollow)},t.inheritClass(t.ui.ButtonWidget,t.ui.Widget),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.ButtonElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.TitledElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.TabIndexedElement),t.mixinClass(t.ui.ButtonWidget,t.ui.mixin.AccessKeyedElement),t.ui.ButtonWidget.static.cancelButtonMouseDownEvents=!1,t.ui.ButtonWidget.prototype.getHref=function(){return this.href},t.ui.ButtonWidget.prototype.getTarget=function(){return this.target},t.ui.ButtonWidget.prototype.getNoFollow=function(){return this.noFollow},t.ui.ButtonWidget.prototype.setHref=function(e){return e="string"==typeof e?e:null,null===e||t.ui.isSafeUrl(e)||(e="./"+e),e!==this.href&&(this.href=e,this.updateHref()),this},t.ui.ButtonWidget.prototype.updateHref=function(){return null===this.href||this.isDisabled()?this.$button.removeAttr("href"):this.$button.attr("href",this.href),this},t.ui.ButtonWidget.prototype.onDisable=function(){this.updateHref()},t.ui.ButtonWidget.prototype.setTarget=function(t){return t="string"==typeof t?t:null,t!==this.target&&(this.target=t,null!==t?this.$button.attr("target",t):this.$button.removeAttr("target")),
this},t.ui.ButtonWidget.prototype.setNoFollow=function(t){return t="boolean"!=typeof t||t,t!==this.noFollow&&(this.noFollow=t,t?this.$button.attr("rel","nofollow"):this.$button.removeAttr("rel")),this},t.ui.ButtonGroupWidget=function(e){e=e||{},t.ui.ButtonGroupWidget.parent.call(this,e),t.ui.mixin.GroupElement.call(this,$.extend({},e,{$group:this.$element})),this.$element.addClass("oo-ui-buttonGroupWidget"),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.ButtonGroupWidget,t.ui.Widget),t.mixinClass(t.ui.ButtonGroupWidget,t.ui.mixin.GroupElement),t.ui.IconWidget=function(e){e=e||{},t.ui.IconWidget.parent.call(this,e),t.ui.mixin.IconElement.call(this,$.extend({},e,{$icon:this.$element})),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$element})),t.ui.mixin.FlaggedElement.call(this,$.extend({},e,{$flagged:this.$element})),this.$element.addClass("oo-ui-iconWidget")},t.inheritClass(t.ui.IconWidget,t.ui.Widget),t.mixinClass(t.ui.IconWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.IconWidget,t.ui.mixin.TitledElement),t.mixinClass(t.ui.IconWidget,t.ui.mixin.FlaggedElement),t.ui.IconWidget.static.tagName="span",t.ui.IndicatorWidget=function(e){e=e||{},t.ui.IndicatorWidget.parent.call(this,e),t.ui.mixin.IndicatorElement.call(this,$.extend({},e,{$indicator:this.$element})),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$element})),this.$element.addClass("oo-ui-indicatorWidget")},t.inheritClass(t.ui.IndicatorWidget,t.ui.Widget),t.mixinClass(t.ui.IndicatorWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.IndicatorWidget,t.ui.mixin.TitledElement),t.ui.IndicatorWidget.static.tagName="span",t.ui.LabelWidget=function(e){e=e||{},t.ui.LabelWidget.parent.call(this,e),t.ui.mixin.LabelElement.call(this,$.extend({},e,{$label:this.$element})),t.ui.mixin.TitledElement.call(this,e),this.input=e.input,this.input instanceof t.ui.InputWidget&&(this.input.getInputId()?this.$element.attr("for",this.input.getInputId()):this.$label.on("click",function(){return this.fieldWidget.focus(),!1}.bind(this))),this.$element.addClass("oo-ui-labelWidget")},t.inheritClass(t.ui.LabelWidget,t.ui.Widget),t.mixinClass(t.ui.LabelWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.LabelWidget,t.ui.mixin.TitledElement),t.ui.LabelWidget.static.tagName="label",t.ui.mixin.PendingElement=function(t){t=t||{},this.pending=0,this.$pending=null,this.setPendingElement(t.$pending||this.$element)},t.initClass(t.ui.mixin.PendingElement),t.ui.mixin.PendingElement.prototype.setPendingElement=function(t){this.$pending&&this.$pending.removeClass("oo-ui-pendingElement-pending"),this.$pending=t,this.pending>0&&this.$pending.addClass("oo-ui-pendingElement-pending")},t.ui.mixin.PendingElement.prototype.isPending=function(){return!!this.pending},t.ui.mixin.PendingElement.prototype.pushPending=function(){return 0===this.pending&&(this.$pending.addClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending++,this},t.ui.mixin.PendingElement.prototype.popPending=function(){return 1===this.pending&&(this.$pending.removeClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending=Math.max(0,this.pending-1),this},t.ui.mixin.FloatableElement=function(t){t=t||{},this.$floatable=null,this.$floatableContainer=null,this.$floatableWindow=null,this.$floatableClosestScrollable=null,this.onFloatableScrollHandler=this.position.bind(this),this.onFloatableWindowResizeHandler=this.position.bind(this),this.setFloatableContainer(t.$floatableContainer),this.setFloatableElement(t.$floatable||this.$element)},t.ui.mixin.FloatableElement.prototype.setFloatableElement=function(t){this.$floatable&&(this.$floatable.removeClass("oo-ui-floatableElement-floatable"),this.$floatable.css({left:"",top:""})),this.$floatable=t.addClass("oo-ui-floatableElement-floatable"),this.position()},t.ui.mixin.FloatableElement.prototype.setFloatableContainer=function(t){this.$floatableContainer=t,this.$floatable&&this.position()},t.ui.mixin.FloatableElement.prototype.togglePositioning=function(e){var i;return this.$floatable&&this.$floatableContainer?(e=void 0===e?!this.positioning:!!e,!e||this.warnedUnattached||this.isElementAttached()||(t.ui.warnDeprecation("FloatableElement#togglePositioning: Before calling this method, the element must be attached to the DOM."),this.warnedUnattached=!0),this.positioning!==e&&(this.positioning=e,i=t.ui.Element.static.getClosestScrollableContainer(this.$floatableContainer[0]),this.needsCustomPosition=!t.ui.contains(this.$floatableContainer[0],this.$floatable[0]),$(i).is("html, body")&&(i=t.ui.Element.static.getWindow(i)),e?(this.$floatableWindow=$(this.getElementWindow()),this.$floatableWindow.on("resize",this.onFloatableWindowResizeHandler),this.$floatableClosestScrollable=$(i),this.$floatableClosestScrollable.on("scroll",this.onFloatableScrollHandler),this.position()):(this.$floatableWindow&&(this.$floatableWindow.off("resize",this.onFloatableWindowResizeHandler),this.$floatableWindow=null),this.$floatableClosestScrollable&&(this.$floatableClosestScrollable.off("scroll",this.onFloatableScrollHandler),this.$floatableClosestScrollable=null),this.$floatable.css({left:"",right:"",top:""}))),this):this};t.ui.mixin.FloatableElement.prototype.isElementInViewport=function(t,e){var i,n,o=!1,s=!1,l=!1;return i=t[0].getBoundingClientRect(),n=e[0]===window?{top:0,left:0,right:document.documentElement.clientWidth,bottom:document.documentElement.clientHeight}:e[0].getBoundingClientRect(),i.left>=n.left&&i.left<=n.right&&(o=!0),i.bottom>=n.top&&i.bottom<=n.bottom&&(s=!0),i.right>=n.left&&i.right<=n.right&&(l=!0),s&&(o||l)};t.ui.mixin.FloatableElement.prototype.position=function(){var e;return this.positioning?this.isElementInViewport(this.$floatableContainer,this.$floatableClosestScrollable)?(this.$floatable.removeClass("oo-ui-element-hidden"),this.needsCustomPosition?(e=t.ui.Element.static.getRelativePosition(this.$floatableContainer,this.$floatable.offsetParent()),e.top+=this.$floatableContainer.height(),"rtl"===this.$floatableContainer.css("direction")&&(e.right=this.$floatable.offsetParent().width()-e.left-this.$floatableContainer.outerWidth(),delete e.left),this.$floatable.css(e),this.clip&&this.clip(),this):void 0):void this.$floatable.addClass("oo-ui-element-hidden"):this},t.ui.mixin.ClippableElement=function(t){t=t||{},this.$clippable=null,this.$clippableContainer=null,this.clipping=!1,this.clippedHorizontally=!1,this.clippedVertically=!1,this.$clippableScrollableContainer=null,this.$clippableScroller=null,this.$clippableWindow=null,this.idealWidth=null,this.idealHeight=null,this.onClippableScrollHandler=this.clip.bind(this),this.onClippableWindowResizeHandler=this.clip.bind(this),t.$clippableContainer&&this.setClippableContainer(t.$clippableContainer),this.setClippableElement(t.$clippable||this.$element)},t.ui.mixin.ClippableElement.prototype.setClippableElement=function(e){this.$clippable&&(this.$clippable.removeClass("oo-ui-clippableElement-clippable"),this.$clippable.css({width:"",height:"",overflowX:"",overflowY:""}),t.ui.Element.static.reconsiderScrollbars(this.$clippable[0])),this.$clippable=e.addClass("oo-ui-clippableElement-clippable"),this.clip()},t.ui.mixin.ClippableElement.prototype.setClippableContainer=function(t){this.$clippableContainer=t,this.$clippable&&this.clip()},t.ui.mixin.ClippableElement.prototype.toggleClipping=function(e){return e=void 0===e?!this.clipping:!!e,!e||this.warnedUnattached||this.isElementAttached()||(t.ui.warnDeprecation("ClippableElement#toggleClipping: Before calling this method, the element must be attached to the DOM."),this.warnedUnattached=!0),this.clipping!==e&&(this.clipping=e,e?(this.$clippableScrollableContainer=$(this.getClosestScrollableElementContainer()),this.$clippableScroller=this.$clippableScrollableContainer.is("html, body")?$(t.ui.Element.static.getWindow(this.$clippableScrollableContainer)):this.$clippableScrollableContainer,this.$clippableScroller.on("scroll",this.onClippableScrollHandler),this.$clippableWindow=$(this.getElementWindow()).on("resize",this.onClippableWindowResizeHandler),this.clip()):(this.$clippable.css({width:"",height:"",maxWidth:"",maxHeight:"",overflowX:"",overflowY:""}),t.ui.Element.static.reconsiderScrollbars(this.$clippable[0]),this.$clippableScrollableContainer=null,this.$clippableScroller.off("scroll",this.onClippableScrollHandler),this.$clippableScroller=null,this.$clippableWindow.off("resize",this.onClippableWindowResizeHandler),this.$clippableWindow=null)),this},t.ui.mixin.ClippableElement.prototype.isClipping=function(){return this.clipping},t.ui.mixin.ClippableElement.prototype.isClipped=function(){return this.clippedHorizontally||this.clippedVertically},t.ui.mixin.ClippableElement.prototype.isClippedHorizontally=function(){return this.clippedHorizontally},t.ui.mixin.ClippableElement.prototype.isClippedVertically=function(){return this.clippedVertically},t.ui.mixin.ClippableElement.prototype.setIdealSize=function(t,e){this.idealWidth=t,this.idealHeight=e,this.clipping||this.$clippable.css({width:t,height:e})},t.ui.mixin.ClippableElement.prototype.clip=function(){var e,i,n,o,s,l,u,a,r,h,d,p,c,g,m,f,y,b,$,W,C=7;return this.clipping?(e=this.$clippableContainer||this.$clippable,i=e.outerHeight()-this.$clippable.outerHeight(),n=e.outerWidth()-this.$clippable.outerWidth(),o=e.offset(),this.$clippableScrollableContainer.is("html, body")?(s=this.$clippableWindow,l={top:0,left:0}):(s=this.$clippableScrollableContainer,l=s.offset()),u=s.innerHeight()-C,a=s.innerWidth()-C,r=e.outerWidth()+C,h=this.$clippableScroller[0]===this.$clippableWindow[0],d=h?this.$clippableScroller.scrollTop():0,p=h?this.$clippableScroller.scrollLeft():0,c=o.left<0?r+o.left:l.left+p+a-o.left,g=l.top+d+u-o.top,c=Math.min(c,document.documentElement.clientWidth),g=Math.min(g,document.documentElement.clientHeight),m=Math.ceil(c-n),f=Math.ceil(g-i),y=this.$clippable.prop("scrollWidth"),b=this.$clippable.prop("scrollHeight"),$=m<y,W=f<b,$?(this.$clippable.css("overflowX","scroll"),void this.$clippable[0].offsetHeight,this.$clippable.css({width:Math.max(0,m),maxWidth:""})):this.$clippable.css({overflowX:"",width:this.idealWidth?this.idealWidth-n:"",maxWidth:Math.max(0,m)}),W?(this.$clippable.css("overflowY","scroll"),void this.$clippable[0].offsetHeight,this.$clippable.css({height:Math.max(0,f),maxHeight:""})):this.$clippable.css({overflowY:"",height:this.idealHeight?this.idealHeight-i:"",maxHeight:Math.max(0,f)}),(this.clippedHorizontally&&!$||this.clippedVertically&&!W)&&t.ui.Element.static.reconsiderScrollbars(this.$clippable[0]),this.clippedHorizontally=$,this.clippedVertically=W,this):this},t.ui.PopupWidget=function(e){e=e||{},t.ui.PopupWidget.parent.call(this,e),this.$body=$("<div>"),this.$popup=$("<div>"),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.ClippableElement.call(this,$.extend({},e,{$clippable:this.$body,$clippableContainer:this.$popup})),t.ui.mixin.FloatableElement.call(this,e),this.$anchor=$("<div>"),this.$container=e.$container,this.containerPadding=void 0!==e.containerPadding?e.containerPadding:10,this.autoClose=!!e.autoClose,this.$autoCloseIgnore=e.$autoCloseIgnore,this.transitionTimeout=null,this.anchor=null,this.width=void 0!==e.width?e.width:320,this.height=void 0!==e.height?e.height:null,this.setAlignment(e.align),this.onMouseDownHandler=this.onMouseDown.bind(this),this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.toggleAnchor(void 0===e.anchor||e.anchor),this.$body.addClass("oo-ui-popupWidget-body"),this.$anchor.addClass("oo-ui-popupWidget-anchor"),this.$popup.addClass("oo-ui-popupWidget-popup").append(this.$body),this.$element.addClass("oo-ui-popupWidget").append(this.$popup,this.$anchor),e.$content instanceof jQuery&&this.$body.append(e.$content),e.padded&&this.$body.addClass("oo-ui-popupWidget-body-padded"),e.head&&(this.closeButton=new t.ui.ButtonWidget({framed:!1,icon:"close"}),this.closeButton.connect(this,{click:"onCloseButtonClick"}),this.$head=$("<div>").addClass("oo-ui-popupWidget-head").append(this.$label,this.closeButton.$element),this.$popup.prepend(this.$head)),e.$footer&&(this.$footer=$("<div>").addClass("oo-ui-popupWidget-footer").append(e.$footer),this.$popup.append(this.$footer)),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},t.inheritClass(t.ui.PopupWidget,t.ui.Widget),t.mixinClass(t.ui.PopupWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.PopupWidget,t.ui.mixin.ClippableElement),t.mixinClass(t.ui.PopupWidget,t.ui.mixin.FloatableElement),t.ui.PopupWidget.prototype.onMouseDown=function(e){this.isVisible()&&!t.ui.contains(this.$element.add(this.$autoCloseIgnore).get(),e.target,!0)&&this.toggle(!1)},t.ui.PopupWidget.prototype.bindMouseDownListener=function(){this.getElementWindow().addEventListener("mousedown",this.onMouseDownHandler,!0)},t.ui.PopupWidget.prototype.onCloseButtonClick=function(){this.isVisible()&&this.toggle(!1)},t.ui.PopupWidget.prototype.unbindMouseDownListener=function(){this.getElementWindow().removeEventListener("mousedown",this.onMouseDownHandler,!0)},t.ui.PopupWidget.prototype.onDocumentKeyDown=function(e){e.which===t.ui.Keys.ESCAPE&&this.isVisible()&&(this.toggle(!1),e.preventDefault(),e.stopPropagation())},t.ui.PopupWidget.prototype.bindKeyDownListener=function(){this.getElementWindow().addEventListener("keydown",this.onDocumentKeyDownHandler,!0)},t.ui.PopupWidget.prototype.unbindKeyDownListener=function(){this.getElementWindow().removeEventListener("keydown",this.onDocumentKeyDownHandler,!0)},t.ui.PopupWidget.prototype.toggleAnchor=function(t){t=void 0===t?!this.anchored:!!t,this.anchored!==t&&(t?this.$element.addClass("oo-ui-popupWidget-anchored"):this.$element.removeClass("oo-ui-popupWidget-anchored"),this.anchored=t)},t.ui.PopupWidget.prototype.hasAnchor=function(){return this.anchor},t.ui.PopupWidget.prototype.toggle=function(e){var i;return e=void 0===e?!this.isVisible():!!e,i=e!==this.isVisible(),!e||this.warnedUnattached||this.isElementAttached()||(t.ui.warnDeprecation("PopupWidget#toggle: Before calling this method, the popup must be attached to the DOM."),this.warnedUnattached=!0),t.ui.PopupWidget.parent.prototype.toggle.call(this,e),i&&(this.togglePositioning(e&&!!this.$floatableContainer),e?(this.autoClose&&(this.bindMouseDownListener(),this.bindKeyDownListener()),this.updateDimensions(),this.toggleClipping(!0)):(this.toggleClipping(!1),this.autoClose&&(this.unbindMouseDownListener(),this.unbindKeyDownListener()))),this},t.ui.PopupWidget.prototype.setSize=function(t,e,i){this.width=t,this.height=void 0!==e?e:null,this.isVisible()&&this.updateDimensions(i)},t.ui.PopupWidget.prototype.updateDimensions=function(t){var e,i,n,o,s,l,u,a,r,h,d,p,c,g={ltr:{"force-left":"backwards","force-right":"forwards"},rtl:{"force-left":"forwards","force-right":"backwards"}},m=this;return this.$container||(this.$container=$(this.getClosestScrollableElementContainer())),d=this.$container.css("direction"),p="rtl"===d?-1:1,c=g[d][this.align]||this.align,this.$popup.css({width:this.width,height:null!==this.height?this.height:"auto"}),e=this.width*{backwards:-1,center:-.5,forwards:0}[c],i=this.$element.offset().left,n=this.$container.offset().left,o=this.$container.innerWidth(),s=n+o,l=p*e-this.containerPadding,u=p*e+this.containerPadding+this.width+this.containerPadding,a=i+l-n,r=s-(i+u),r<0?e+=p*r:a<0&&(e-=p*a),h=2*this.$anchor[0].scrollWidth,e+this.width<h?e=h-this.width:-e<h&&(e=-h),clearTimeout(this.transitionTimeout),t&&this.$element.addClass("oo-ui-popupWidget-transitioning"),this.$popup.css("rtl"===d?"margin-right":"margin-left",e),t?this.transitionTimeout=setTimeout(function(){m.$element.removeClass("oo-ui-popupWidget-transitioning")},200):this.$element.removeClass("oo-ui-popupWidget-transitioning"),this.clip(),this},t.ui.PopupWidget.prototype.setAlignment=function(e){"left"!==e&&"right"!==e||(t.ui.warnDeprecation("PopupWidget#setAlignment parameter value `"+e+"` is deprecated. Use `force-right` or `force-left` instead."),e={left:"force-right",right:"force-left"}[e]),["force-left","force-right","backwards","forwards","center"].indexOf(e)>-1?this.align=e:this.align="center"},t.ui.PopupWidget.prototype.getAlignment=function(){return this.align},t.ui.mixin.PopupElement=function(e){e=e||{},this.popup=new t.ui.PopupWidget($.extend({autoClose:!0},e.popup,{$autoCloseIgnore:this.$element.add(e.popup&&e.popup.$autoCloseIgnore)}))},t.ui.mixin.PopupElement.prototype.getPopup=function(){return this.popup},t.ui.PopupButtonWidget=function(e){t.ui.PopupButtonWidget.parent.call(this,e),t.ui.mixin.PopupElement.call(this,$.extend(!0,{},e,{popup:{$floatableContainer:this.$element}})),this.$overlay=e.$overlay||this.$element,this.connect(this,{click:"onAction"}),this.$element.addClass("oo-ui-popupButtonWidget").attr("aria-haspopup","true"),this.popup.$element.addClass("oo-ui-popupButtonWidget-popup").toggleClass("oo-ui-popupButtonWidget-framed-popup",this.isFramed()).toggleClass("oo-ui-popupButtonWidget-frameless-popup",!this.isFramed()),this.$overlay.append(this.popup.$element)},t.inheritClass(t.ui.PopupButtonWidget,t.ui.ButtonWidget),t.mixinClass(t.ui.PopupButtonWidget,t.ui.mixin.PopupElement),t.ui.PopupButtonWidget.prototype.onAction=function(){this.popup.toggle()},t.ui.mixin.GroupWidget=function(e){t.ui.mixin.GroupElement.call(this,e)},t.mixinClass(t.ui.mixin.GroupWidget,t.ui.mixin.GroupElement),t.ui.mixin.GroupWidget.prototype.setDisabled=function(e){var i,n;if(t.ui.Widget.prototype.setDisabled.call(this,e),this.items)for(i=0,n=this.items.length;i<n;i++)this.items[i].updateDisabled();return this},t.ui.mixin.ItemWidget=function(){},t.ui.mixin.ItemWidget.prototype.isDisabled=function(){return this.disabled||this.elementGroup instanceof t.ui.Widget&&this.elementGroup.isDisabled()},t.ui.mixin.ItemWidget.prototype.setElementGroup=function(e){return t.ui.Element.prototype.setElementGroup.call(this,e),this.updateDisabled(),this},t.ui.OptionWidget=function(e){e=e||{},t.ui.OptionWidget.parent.call(this,e),t.ui.mixin.ItemWidget.call(this),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.AccessKeyedElement.call(this,e),this.selected=!1,this.highlighted=!1,this.pressed=!1,this.$element.data("oo-ui-optionWidget",this).attr("tabindex","-1").attr("role","option").attr("aria-selected","false").addClass("oo-ui-optionWidget").append(this.$label)},t.inheritClass(t.ui.OptionWidget,t.ui.Widget),t.mixinClass(t.ui.OptionWidget,t.ui.mixin.ItemWidget),t.mixinClass(t.ui.OptionWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.OptionWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.OptionWidget,t.ui.mixin.AccessKeyedElement),t.ui.OptionWidget.static.selectable=!0,t.ui.OptionWidget.static.highlightable=!0,t.ui.OptionWidget.static.pressable=!0,t.ui.OptionWidget.static.scrollIntoViewOnSelect=!1,t.ui.OptionWidget.prototype.isSelectable=function(){return this.constructor.static.selectable&&!this.isDisabled()&&this.isVisible()},t.ui.OptionWidget.prototype.isHighlightable=function(){return this.constructor.static.highlightable&&!this.isDisabled()&&this.isVisible()},t.ui.OptionWidget.prototype.isPressable=function(){return this.constructor.static.pressable&&!this.isDisabled()&&this.isVisible()},t.ui.OptionWidget.prototype.isSelected=function(){return this.selected},t.ui.OptionWidget.prototype.isHighlighted=function(){return this.highlighted},t.ui.OptionWidget.prototype.isPressed=function(){return this.pressed},t.ui.OptionWidget.prototype.setSelected=function(t){return this.constructor.static.selectable&&(this.selected=!!t,this.$element.toggleClass("oo-ui-optionWidget-selected",t).attr("aria-selected",t.toString()),t&&this.constructor.static.scrollIntoViewOnSelect&&this.scrollElementIntoView(),this.updateThemeClasses()),this},t.ui.OptionWidget.prototype.setHighlighted=function(t){return this.constructor.static.highlightable&&(this.highlighted=!!t,this.$element.toggleClass("oo-ui-optionWidget-highlighted",t),this.updateThemeClasses()),this},t.ui.OptionWidget.prototype.setPressed=function(t){return this.constructor.static.pressable&&(this.pressed=!!t,this.$element.toggleClass("oo-ui-optionWidget-pressed",t),this.updateThemeClasses()),this},t.ui.OptionWidget.prototype.getMatchText=function(){var t=this.getLabel();return"string"==typeof t?t:this.$label.text()},t.ui.SelectWidget=function(e){e=e||{},t.ui.SelectWidget.parent.call(this,e),t.ui.mixin.GroupWidget.call(this,$.extend({},e,{$group:this.$element})),this.pressed=!1,this.selecting=null,this.onMouseUpHandler=this.onMouseUp.bind(this),this.onMouseMoveHandler=this.onMouseMove.bind(this),this.onKeyDownHandler=this.onKeyDown.bind(this),this.onKeyPressHandler=this.onKeyPress.bind(this),this.keyPressBuffer="",this.keyPressBufferTimer=null,this.blockMouseOverEvents=0,this.connect(this,{toggle:"onToggle"}),this.$element.on({focusin:this.onFocus.bind(this),mousedown:this.onMouseDown.bind(this),mouseover:this.onMouseOver.bind(this),mouseleave:this.onMouseLeave.bind(this)}),this.$element.addClass("oo-ui-selectWidget oo-ui-selectWidget-depressed").attr("role","listbox"),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.SelectWidget,t.ui.Widget),t.mixinClass(t.ui.SelectWidget,t.ui.mixin.GroupWidget),t.ui.SelectWidget.prototype.onFocus=function(t){var e;t.target===this.$element[0]?this.getSelectedItem()||(e=this.getFirstSelectableItem()):e=this.getTargetItem(t),e&&(e.constructor.static.highlightable?this.highlightItem(e):this.selectItem(e)),t.target!==this.$element[0]&&this.$element.focus()},t.ui.SelectWidget.prototype.onMouseDown=function(e){var i;return this.isDisabled()||e.which!==t.ui.MouseButtons.LEFT||(this.togglePressed(!0),i=this.getTargetItem(e),i&&i.isSelectable()&&(this.pressItem(i),this.selecting=i,this.getElementDocument().addEventListener("mouseup",this.onMouseUpHandler,!0),this.getElementDocument().addEventListener("mousemove",this.onMouseMoveHandler,!0))),!1},t.ui.SelectWidget.prototype.onMouseUp=function(e){var i;return this.togglePressed(!1),this.selecting||(i=this.getTargetItem(e),i&&i.isSelectable()&&(this.selecting=i)),!this.isDisabled()&&e.which===t.ui.MouseButtons.LEFT&&this.selecting&&(this.pressItem(null),this.chooseItem(this.selecting),this.selecting=null),this.getElementDocument().removeEventListener("mouseup",this.onMouseUpHandler,!0),this.getElementDocument().removeEventListener("mousemove",this.onMouseMoveHandler,!0),!1},t.ui.SelectWidget.prototype.onMouseMove=function(t){var e;!this.isDisabled()&&this.pressed&&(e=this.getTargetItem(t),e&&e!==this.selecting&&e.isSelectable()&&(this.pressItem(e),this.selecting=e))},t.ui.SelectWidget.prototype.onMouseOver=function(t){var e;if(!this.blockMouseOverEvents)return this.isDisabled()||(e=this.getTargetItem(t),this.highlightItem(e&&e.isHighlightable()?e:null)),!1},t.ui.SelectWidget.prototype.onMouseLeave=function(){return this.isDisabled()||this.highlightItem(null),!1},t.ui.SelectWidget.prototype.onKeyDown=function(e){var i,n=!1,o=this.getHighlightedItem()||this.getSelectedItem();if(!this.isDisabled()&&this.isVisible()){switch(e.keyCode){case t.ui.Keys.ENTER:o&&o.constructor.static.highlightable&&(this.chooseItem(o),n=!0);break;case t.ui.Keys.UP:case t.ui.Keys.LEFT:this.clearKeyPressBuffer(),i=this.getRelativeSelectableItem(o,-1),n=!0;break;case t.ui.Keys.DOWN:case t.ui.Keys.RIGHT:this.clearKeyPressBuffer(),i=this.getRelativeSelectableItem(o,1),n=!0;break;case t.ui.Keys.ESCAPE:case t.ui.Keys.TAB:o&&o.constructor.static.highlightable&&o.setHighlighted(!1),this.unbindKeyDownListener(),this.unbindKeyPressListener(),n=!1}i&&(i.constructor.static.highlightable?this.highlightItem(i):this.chooseItem(i),this.scrollItemIntoView(i)),n&&(e.preventDefault(),e.stopPropagation())}},t.ui.SelectWidget.prototype.bindKeyDownListener=function(){this.getElementWindow().addEventListener("keydown",this.onKeyDownHandler,!0)},t.ui.SelectWidget.prototype.unbindKeyDownListener=function(){this.getElementWindow().removeEventListener("keydown",this.onKeyDownHandler,!0)},t.ui.SelectWidget.prototype.scrollItemIntoView=function(t){var e=this;this.blockMouseOverEvents++,t.scrollElementIntoView().done(function(){setTimeout(function(){e.blockMouseOverEvents--},200)})},t.ui.SelectWidget.prototype.clearKeyPressBuffer=function(){this.keyPressBufferTimer&&(clearTimeout(this.keyPressBufferTimer),this.keyPressBufferTimer=null),this.keyPressBuffer=""},t.ui.SelectWidget.prototype.onKeyPress=function(e){var i,n,o;if(e.charCode)i=String.fromCodePoint?String.fromCodePoint(e.charCode):String.fromCharCode(e.charCode),this.keyPressBufferTimer&&clearTimeout(this.keyPressBufferTimer),this.keyPressBufferTimer=setTimeout(this.clearKeyPressBuffer.bind(this),1500),o=this.getHighlightedItem()||this.getSelectedItem(),this.keyPressBuffer===i?o&&(o=this.getRelativeSelectableItem(o,1)):this.keyPressBuffer+=i,n=this.getItemMatcher(this.keyPressBuffer,!1),o&&n(o)||(o=this.getRelativeSelectableItem(o,1,n)),o&&(this.isVisible()&&o.constructor.static.highlightable?this.highlightItem(o):this.chooseItem(o),this.scrollItemIntoView(o)),e.preventDefault(),e.stopPropagation();else if(e.keyCode===t.ui.Keys.BACKSPACE&&""!==this.keyPressBuffer)return this.keyPressBuffer=this.keyPressBuffer.substr(0,this.keyPressBuffer.length-1),!1},t.ui.SelectWidget.prototype.getItemMatcher=function(t,e){var i;return t.normalize&&(t=t.normalize()),t=e?t.trim():t.replace(/^\s+/,""),i="^\\s*"+t.replace(/([\\{}()|.?*+\-\^$\[\]])/g,"\\$1").replace(/\s+/g,"\\s+"),e&&(i+="\\s*$"),i=new RegExp(i,"i"),function(t){var e=t.getMatchText();return e.normalize&&(e=e.normalize()),i.test(e)}},t.ui.SelectWidget.prototype.bindKeyPressListener=function(){this.getElementWindow().addEventListener("keypress",this.onKeyPressHandler,!0)},t.ui.SelectWidget.prototype.unbindKeyPressListener=function(){this.getElementWindow().removeEventListener("keypress",this.onKeyPressHandler,!0),this.clearKeyPressBuffer()},t.ui.SelectWidget.prototype.onToggle=function(t){t||this.clearKeyPressBuffer()},t.ui.SelectWidget.prototype.getTargetItem=function(t){return $(t.target).closest(".oo-ui-optionWidget").data("oo-ui-optionWidget")||null},t.ui.SelectWidget.prototype.getSelectedItem=function(){var t,e;for(t=0,e=this.items.length;t<e;t++)if(this.items[t].isSelected())return this.items[t];return null},t.ui.SelectWidget.prototype.getHighlightedItem=function(){var t,e;for(t=0,e=this.items.length;t<e;t++)if(this.items[t].isHighlighted())return this.items[t];return null},t.ui.SelectWidget.prototype.togglePressed=function(t){void 0===t&&(t=!this.pressed),t!==this.pressed&&(this.$element.toggleClass("oo-ui-selectWidget-pressed",t).toggleClass("oo-ui-selectWidget-depressed",!t),this.pressed=t)},t.ui.SelectWidget.prototype.highlightItem=function(t){var e,i,n,o=!1;for(e=0,i=this.items.length;e<i;e++)n=this.items[e]===t,this.items[e].isHighlighted()!==n&&(this.items[e].setHighlighted(n),o=!0);return o&&this.emit("highlight",t),this},t.ui.SelectWidget.prototype.getItemFromLabel=function(e,i){var n,o,s,l=this.items.length,u=this.getItemMatcher(e,!0);for(n=0;n<l;n++)if(o=this.items[n],o instanceof t.ui.OptionWidget&&o.isSelectable()&&u(o))return o;if(i){for(s=null,u=this.getItemMatcher(e,!1),n=0;n<l;n++)if(o=this.items[n],o instanceof t.ui.OptionWidget&&o.isSelectable()&&u(o)){if(s)return null;s=o}if(s)return s}return null},t.ui.SelectWidget.prototype.selectItemByLabel=function(t,e){var i=this.getItemFromLabel(t,!!e);return void 0!==t&&i?this.selectItem(i):this.selectItem()},t.ui.SelectWidget.prototype.selectItemByData=function(t){var e=this.getItemFromData(t);return void 0!==t&&e?this.selectItem(e):this.selectItem()},t.ui.SelectWidget.prototype.selectItem=function(t){var e,i,n,o=!1;for(e=0,i=this.items.length;e<i;e++)n=this.items[e]===t,this.items[e].isSelected()!==n&&(this.items[e].setSelected(n),o=!0);return o&&this.emit("select",t),this},t.ui.SelectWidget.prototype.pressItem=function(t){var e,i,n,o=!1;for(e=0,i=this.items.length;e<i;e++)n=this.items[e]===t,this.items[e].isPressed()!==n&&(this.items[e].setPressed(n),o=!0);return o&&this.emit("press",t),this},t.ui.SelectWidget.prototype.chooseItem=function(t){return t&&(this.selectItem(t),this.emit("choose",t)),this},t.ui.SelectWidget.prototype.getRelativeSelectableItem=function(e,i,n){var o,s,l,u=i>0?1:-1,a=this.items.length;for(e instanceof t.ui.OptionWidget?(o=this.items.indexOf(e),s=(o+u+a)%a):s=i>0?0:a-1,l=0;l<a;l++){if(e=this.items[s],e instanceof t.ui.OptionWidget&&e.isSelectable()&&(!n||n(e)))return e;s=(s+u+a)%a}return null},t.ui.SelectWidget.prototype.getFirstSelectableItem=function(){return this.getRelativeSelectableItem(null,1)},t.ui.SelectWidget.prototype.addItems=function(e,i){return t.ui.mixin.GroupWidget.prototype.addItems.call(this,e,i),this.emit("add",e,void 0===i?this.items.length-e.length-1:i),this},t.ui.SelectWidget.prototype.removeItems=function(e){var i,n,o;for(i=0,n=e.length;i<n;i++)o=e[i],o.isSelected()&&this.selectItem(null);return t.ui.mixin.GroupWidget.prototype.removeItems.call(this,e),this.emit("remove",e),this},t.ui.SelectWidget.prototype.clearItems=function(){var e=this.items.slice();return t.ui.mixin.GroupWidget.prototype.clearItems.call(this),this.selectItem(null),this.emit("remove",e),this},t.ui.DecoratedOptionWidget=function(e){t.ui.DecoratedOptionWidget.parent.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),this.$element.addClass("oo-ui-decoratedOptionWidget").prepend(this.$icon).append(this.$indicator)},t.inheritClass(t.ui.DecoratedOptionWidget,t.ui.OptionWidget),t.mixinClass(t.ui.DecoratedOptionWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.DecoratedOptionWidget,t.ui.mixin.IndicatorElement),t.ui.MenuOptionWidget=function(e){e=$.extend({icon:"check"},e),t.ui.MenuOptionWidget.parent.call(this,e),this.$element.attr("role","menuitem").addClass("oo-ui-menuOptionWidget")},t.inheritClass(t.ui.MenuOptionWidget,t.ui.DecoratedOptionWidget),t.ui.MenuOptionWidget.static.scrollIntoViewOnSelect=!0,t.ui.MenuSectionOptionWidget=function(e){t.ui.MenuSectionOptionWidget.parent.call(this,e),this.$element.addClass("oo-ui-menuSectionOptionWidget")},t.inheritClass(t.ui.MenuSectionOptionWidget,t.ui.DecoratedOptionWidget),t.ui.MenuSectionOptionWidget.static.selectable=!1,t.ui.MenuSectionOptionWidget.static.highlightable=!1,t.ui.MenuSelectWidget=function(e){e=e||{},t.ui.MenuSelectWidget.parent.call(this,e),t.ui.mixin.ClippableElement.call(this,$.extend({},e,{$clippable:this.$group})),this.autoHide=void 0===e.autoHide||!!e.autoHide,this.hideOnChoose=void 0===e.hideOnChoose||!!e.hideOnChoose,this.filterFromInput=!!e.filterFromInput,this.$input=e.$input?e.$input:e.input?e.input.$input:null,this.$widget=e.widget?e.widget.$element:null,this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.onInputEditHandler=t.ui.debounce(this.updateItemVisibility.bind(this),100),this.$element.addClass("oo-ui-menuSelectWidget").attr("role","menu"),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},t.inheritClass(t.ui.MenuSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.MenuSelectWidget,t.ui.mixin.ClippableElement),t.ui.MenuSelectWidget.prototype.onDocumentMouseDown=function(e){t.ui.contains(this.$element[0],e.target,!0)||this.$widget&&t.ui.contains(this.$widget[0],e.target,!0)||this.toggle(!1)},t.ui.MenuSelectWidget.prototype.onKeyDown=function(e){var i=this.getHighlightedItem()||this.getSelectedItem();if(!this.isDisabled()&&this.isVisible())switch(e.keyCode){case t.ui.Keys.LEFT:case t.ui.Keys.RIGHT:this.$input||t.ui.MenuSelectWidget.parent.prototype.onKeyDown.call(this,e);break;case t.ui.Keys.ESCAPE:case t.ui.Keys.TAB:i&&i.setHighlighted(!1),this.toggle(!1),e.keyCode===t.ui.Keys.ESCAPE&&(e.preventDefault(),e.stopPropagation());break;default:return void t.ui.MenuSelectWidget.parent.prototype.onKeyDown.call(this,e)}},t.ui.MenuSelectWidget.prototype.updateItemVisibility=function(){var e,i,n,o=!1,s=this.items.length,l=!this.isVisible(),u=l?null:this.getItemMatcher(this.$input.val());for(e=0;e<s;e++)i=this.items[e],i instanceof t.ui.OptionWidget&&(n=l||u(i),o=o||n,
i.toggle(n));this.$element.toggleClass("oo-ui-menuSelectWidget-invisible",!o),this.clip()},t.ui.MenuSelectWidget.prototype.bindKeyDownListener=function(){this.$input?this.$input.on("keydown",this.onKeyDownHandler):t.ui.MenuSelectWidget.parent.prototype.bindKeyDownListener.call(this)},t.ui.MenuSelectWidget.prototype.unbindKeyDownListener=function(){this.$input?this.$input.off("keydown",this.onKeyDownHandler):t.ui.MenuSelectWidget.parent.prototype.unbindKeyDownListener.call(this)},t.ui.MenuSelectWidget.prototype.bindKeyPressListener=function(){this.$input?this.filterFromInput&&this.$input.on("keydown mouseup cut paste change input select",this.onInputEditHandler):t.ui.MenuSelectWidget.parent.prototype.bindKeyPressListener.call(this)},t.ui.MenuSelectWidget.prototype.unbindKeyPressListener=function(){this.$input?this.filterFromInput&&(this.$input.off("keydown mouseup cut paste change input select",this.onInputEditHandler),this.updateItemVisibility()):t.ui.MenuSelectWidget.parent.prototype.unbindKeyPressListener.call(this)},t.ui.MenuSelectWidget.prototype.chooseItem=function(e){return t.ui.MenuSelectWidget.parent.prototype.chooseItem.call(this,e),this.hideOnChoose&&this.toggle(!1),this},t.ui.MenuSelectWidget.prototype.addItems=function(e,i){return t.ui.MenuSelectWidget.parent.prototype.addItems.call(this,e,i),this.clip(),this},t.ui.MenuSelectWidget.prototype.removeItems=function(e){return t.ui.MenuSelectWidget.parent.prototype.removeItems.call(this,e),this.clip(),this},t.ui.MenuSelectWidget.prototype.clearItems=function(){return t.ui.MenuSelectWidget.parent.prototype.clearItems.call(this),this.clip(),this},t.ui.MenuSelectWidget.prototype.toggle=function(e){var i;return e=(void 0===e?!this.visible:!!e)&&!!this.items.length,i=e!==this.isVisible(),!e||this.warnedUnattached||this.isElementAttached()||(t.ui.warnDeprecation("MenuSelectWidget#toggle: Before calling this method, the menu must be attached to the DOM."),this.warnedUnattached=!0),t.ui.MenuSelectWidget.parent.prototype.toggle.call(this,e),i&&(e?(this.bindKeyDownListener(),this.bindKeyPressListener(),this.toggleClipping(!0),this.getSelectedItem()&&this.getSelectedItem().scrollElementIntoView({duration:0}),this.autoHide&&this.getElementDocument().addEventListener("mousedown",this.onDocumentMouseDownHandler,!0)):(this.unbindKeyDownListener(),this.unbindKeyPressListener(),this.getElementDocument().removeEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.toggleClipping(!1))),this},t.ui.DropdownWidget=function(e){e=$.extend({indicator:"down"},e),t.ui.DropdownWidget.parent.call(this,e),this.$handle=this.$("<span>"),this.$overlay=e.$overlay||this.$element,t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$label})),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$handle})),this.menu=new t.ui.FloatingMenuSelectWidget($.extend({widget:this,$container:this.$element},e.menu)),this.$handle.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this),keypress:this.menu.onKeyPressHandler,blur:this.menu.clearKeyPressBuffer.bind(this.menu)}),this.menu.connect(this,{select:"onMenuSelect",toggle:"onMenuToggle"}),this.$handle.addClass("oo-ui-dropdownWidget-handle").append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-dropdownWidget").append(this.$handle),this.$overlay.append(this.menu.$element)},t.inheritClass(t.ui.DropdownWidget,t.ui.Widget),t.mixinClass(t.ui.DropdownWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.DropdownWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.DropdownWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.DropdownWidget,t.ui.mixin.TitledElement),t.mixinClass(t.ui.DropdownWidget,t.ui.mixin.TabIndexedElement),t.ui.DropdownWidget.prototype.getMenu=function(){return this.menu},t.ui.DropdownWidget.prototype.onMenuSelect=function(t){var e;return t?(e=t.getLabel(),e instanceof jQuery&&(e=e.clone()),void this.setLabel(e)):void this.setLabel(null)},t.ui.DropdownWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-dropdownWidget-open",t)},t.ui.DropdownWidget.prototype.onClick=function(e){return this.isDisabled()||e.which!==t.ui.MouseButtons.LEFT||this.menu.toggle(),!1},t.ui.DropdownWidget.prototype.onKeyDown=function(e){if(!(this.isDisabled()||e.which!==t.ui.Keys.ENTER&&(this.menu.isVisible()||e.which!==t.ui.Keys.SPACE&&e.which!==t.ui.Keys.UP&&e.which!==t.ui.Keys.DOWN)))return this.menu.toggle(),!1},t.ui.RadioOptionWidget=function(e){e=e||{},this.radio=new t.ui.RadioInputWidget({value:e.data,tabIndex:-1}),t.ui.RadioOptionWidget.parent.call(this,e),this.radio.$input.attr("role","presentation"),this.$element.addClass("oo-ui-radioOptionWidget").attr("role","radio").attr("aria-checked","false").removeAttr("aria-selected").prepend(this.radio.$element)},t.inheritClass(t.ui.RadioOptionWidget,t.ui.OptionWidget),t.ui.RadioOptionWidget.static.highlightable=!1,t.ui.RadioOptionWidget.static.scrollIntoViewOnSelect=!0,t.ui.RadioOptionWidget.static.pressable=!1,t.ui.RadioOptionWidget.static.tagName="label",t.ui.RadioOptionWidget.prototype.setSelected=function(e){return t.ui.RadioOptionWidget.parent.prototype.setSelected.call(this,e),this.radio.setSelected(e),this.$element.attr("aria-checked",e.toString()).removeAttr("aria-selected"),this},t.ui.RadioOptionWidget.prototype.setDisabled=function(e){return t.ui.RadioOptionWidget.parent.prototype.setDisabled.call(this,e),this.radio.setDisabled(this.isDisabled()),this},t.ui.RadioSelectWidget=function(e){t.ui.RadioSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-radioSelectWidget").attr("role","radiogroup")},t.inheritClass(t.ui.RadioSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.RadioSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.MultioptionWidget=function(e){e=e||{},t.ui.MultioptionWidget.parent.call(this,e),t.ui.mixin.ItemWidget.call(this),t.ui.mixin.LabelElement.call(this,e),this.selected=null,this.$element.addClass("oo-ui-multioptionWidget").append(this.$label),this.setSelected(e.selected)},t.inheritClass(t.ui.MultioptionWidget,t.ui.Widget),t.mixinClass(t.ui.MultioptionWidget,t.ui.mixin.ItemWidget),t.mixinClass(t.ui.MultioptionWidget,t.ui.mixin.LabelElement),t.ui.MultioptionWidget.prototype.isSelected=function(){return this.selected},t.ui.MultioptionWidget.prototype.setSelected=function(t){return t=!!t,this.selected!==t&&(this.selected=t,this.emit("change",t),this.$element.toggleClass("oo-ui-multioptionWidget-selected",t)),this},t.ui.MultiselectWidget=function(e){t.ui.MultiselectWidget.parent.call(this,e),e=e||{},t.ui.mixin.GroupWidget.call(this,e),this.aggregate({change:"select"}),this.connect(this,{select:["emit","change"]}),e.items&&this.addItems(e.items),this.$group.addClass("oo-ui-multiselectWidget-group"),this.$element.addClass("oo-ui-multiselectWidget").append(this.$group)},t.inheritClass(t.ui.MultiselectWidget,t.ui.Widget),t.mixinClass(t.ui.MultiselectWidget,t.ui.mixin.GroupWidget),t.ui.MultiselectWidget.prototype.getSelectedItems=function(){return this.items.filter(function(t){return t.isSelected()})},t.ui.MultiselectWidget.prototype.getSelectedItemsData=function(){return this.getSelectedItems().map(function(t){return t.data})},t.ui.MultiselectWidget.prototype.selectItems=function(t){return this.items.forEach(function(e){var i=t.indexOf(e)!==-1;e.setSelected(i)}),this},t.ui.MultiselectWidget.prototype.selectItemsByData=function(t){var e,i=this;return e=t.map(function(t){return i.getItemFromData(t)}),this.selectItems(e),this},t.ui.CheckboxMultioptionWidget=function(e){e=e||{},this.checkbox=new t.ui.CheckboxInputWidget,t.ui.CheckboxMultioptionWidget.parent.call(this,e),this.checkbox.on("change",this.onCheckboxChange.bind(this)),this.$element.on("keydown",this.onKeyDown.bind(this)),this.$element.addClass("oo-ui-checkboxMultioptionWidget").prepend(this.checkbox.$element)},t.inheritClass(t.ui.CheckboxMultioptionWidget,t.ui.MultioptionWidget),t.ui.CheckboxMultioptionWidget.static.tagName="label",t.ui.CheckboxMultioptionWidget.prototype.onCheckboxChange=function(){this.setSelected(this.checkbox.isSelected())},t.ui.CheckboxMultioptionWidget.prototype.setSelected=function(e){return t.ui.CheckboxMultioptionWidget.parent.prototype.setSelected.call(this,e),this.checkbox.setSelected(e),this},t.ui.CheckboxMultioptionWidget.prototype.setDisabled=function(e){return t.ui.CheckboxMultioptionWidget.parent.prototype.setDisabled.call(this,e),this.checkbox.setDisabled(this.isDisabled()),this},t.ui.CheckboxMultioptionWidget.prototype.focus=function(){this.checkbox.focus()},t.ui.CheckboxMultioptionWidget.prototype.onKeyDown=function(e){var i,n=this.getElementGroup();e.keyCode===t.ui.Keys.LEFT||e.keyCode===t.ui.Keys.UP?i=n.getRelativeFocusableItem(this,-1):e.keyCode!==t.ui.Keys.RIGHT&&e.keyCode!==t.ui.Keys.DOWN||(i=n.getRelativeFocusableItem(this,1)),i&&(e.preventDefault(),i.focus())},t.ui.CheckboxMultiselectWidget=function(e){t.ui.CheckboxMultiselectWidget.parent.call(this,e),this.$lastClicked=null,this.$group.on("click",this.onClick.bind(this)),this.$element.addClass("oo-ui-checkboxMultiselectWidget")},t.inheritClass(t.ui.CheckboxMultiselectWidget,t.ui.MultiselectWidget),t.ui.CheckboxMultiselectWidget.prototype.getRelativeFocusableItem=function(t,e){var i,n,o,s=e>0?1:-1,l=this.items.length;for(t?(i=this.items.indexOf(t),n=(i+s+l)%l):n=e>0?0:l-1,o=0;o<l;o++){if(t=this.items[n],t&&!t.isDisabled())return t;n=(n+s+l)%l}return null},t.ui.CheckboxMultiselectWidget.prototype.onClick=function(t){var e,i,n,o,s,l,u,a=this.$lastClicked,r=$(t.target).closest(".oo-ui-checkboxMultioptionWidget").not(".oo-ui-widget-disabled");if(a&&r.length&&t.shiftKey&&(e=this.$group.find(".oo-ui-checkboxMultioptionWidget"),i=e.index(a),n=e.index(r),n!==i)){for(u=this.items,l=u[n].isSelected(),s=n>i?1:-1,o=i;o!==n;o+=s)u[o].isDisabled()||u[o].setSelected(!l);t.preventDefault(),setTimeout(function(){u[n].isDisabled()||u[n].setSelected(!l)})}r.length&&(this.$lastClicked=r)},t.ui.FloatingMenuSelectWidget=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.inputWidget),i=i||{},t.ui.FloatingMenuSelectWidget.parent.call(this,i),this.inputWidget=e,this.$container=i.$container||this.inputWidget.$element,t.ui.mixin.FloatableElement.call(this,$.extend({},i,{$floatableContainer:this.$container})),this.$element.addClass("oo-ui-floatingMenuSelectWidget"),this.$element.addClass("oo-ui-textInputMenuSelectWidget")},t.inheritClass(t.ui.FloatingMenuSelectWidget,t.ui.MenuSelectWidget),t.mixinClass(t.ui.FloatingMenuSelectWidget,t.ui.mixin.FloatableElement),t.ui.FloatingMenuSelectWidget.prototype.toggle=function(e){var i;return e=void 0===e?!this.isVisible():!!e,i=e!==this.isVisible(),i&&e&&this.setIdealSize(this.$container.width()),t.ui.FloatingMenuSelectWidget.parent.prototype.toggle.call(this,e),i&&this.togglePositioning(this.isVisible()),this},t.ui.TextInputMenuSelectWidget=function(){t.ui.warnDeprecation("TextInputMenuSelectWidget is deprecated. Use the FloatingMenuSelectWidget instead."),t.ui.TextInputMenuSelectWidget.parent.apply(this,arguments)},t.inheritClass(t.ui.TextInputMenuSelectWidget,t.ui.FloatingMenuSelectWidget),t.ui.ProgressBarWidget=function(e){e=e||{},t.ui.ProgressBarWidget.parent.call(this,e),this.$bar=$("<div>"),this.progress=null,this.setProgress(void 0!==e.progress&&e.progress),this.$bar.addClass("oo-ui-progressBarWidget-bar"),this.$element.attr({role:"progressbar","aria-valuemin":0,"aria-valuemax":100}).addClass("oo-ui-progressBarWidget").append(this.$bar)},t.inheritClass(t.ui.ProgressBarWidget,t.ui.Widget),t.ui.ProgressBarWidget.static.tagName="div",t.ui.ProgressBarWidget.prototype.getProgress=function(){return this.progress},t.ui.ProgressBarWidget.prototype.setProgress=function(t){this.progress=t,t!==!1?(this.$bar.css("width",this.progress+"%"),this.$element.attr("aria-valuenow",this.progress)):(this.$bar.css("width",""),this.$element.removeAttr("aria-valuenow")),this.$element.toggleClass("oo-ui-progressBarWidget-indeterminate",t===!1)},t.ui.InputWidget=function(e){e=e||{},t.ui.InputWidget.parent.call(this,e),this.$input=e.$input||this.getInputElement(e),this.value="",this.inputFilter=e.inputFilter,t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$input})),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$input})),t.ui.mixin.AccessKeyedElement.call(this,$.extend({},e,{$accessKeyed:this.$input})),this.$input.on("keydown mouseup cut paste change input select",this.onEdit.bind(this)),this.$input.addClass("oo-ui-inputWidget-input").attr("name",e.name).prop("disabled",this.isDisabled()),this.$element.addClass("oo-ui-inputWidget").append(this.$input),this.setValue(e.value),e.dir&&this.setDir(e.dir)},t.inheritClass(t.ui.InputWidget,t.ui.Widget),t.mixinClass(t.ui.InputWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.InputWidget,t.ui.mixin.TabIndexedElement),t.mixinClass(t.ui.InputWidget,t.ui.mixin.TitledElement),t.mixinClass(t.ui.InputWidget,t.ui.mixin.AccessKeyedElement),t.ui.InputWidget.static.supportsSimpleLabel=!0,t.ui.InputWidget.static.reusePreInfuseDOM=function(e,i){return i=t.ui.InputWidget.parent.static.reusePreInfuseDOM(e,i),i.$input=$(e).find(".oo-ui-inputWidget-input"),i},t.ui.InputWidget.static.gatherPreInfuseState=function(e,i){var n=t.ui.InputWidget.parent.static.gatherPreInfuseState(e,i);return i.$input&&i.$input.length&&(n.value=i.$input.val(),n.focus=i.$input.is(":focus")),n},t.ui.InputWidget.prototype.getInputElement=function(){return $("<input>")},t.ui.InputWidget.prototype.getInputId=function(){var e=this.$input.attr("id");return void 0===e&&(e=t.ui.generateElementId(),this.$input.attr("id",e)),e},t.ui.InputWidget.prototype.onEdit=function(){var t=this;this.isDisabled()||setTimeout(function(){t.setValue(t.$input.val())})},t.ui.InputWidget.prototype.getValue=function(){var t=this.$input.val();return this.value!==t&&this.setValue(t),this.value},t.ui.InputWidget.prototype.setDir=function(t){return this.$input.prop("dir",t),this},t.ui.InputWidget.prototype.setValue=function(t){return t=this.cleanUpValue(t),this.$input.val()!==t&&this.$input.val(t),this.value!==t&&(this.value=t,this.emit("change",this.value)),this},t.ui.InputWidget.prototype.cleanUpValue=function(t){return void 0===t||null===t?"":this.inputFilter?this.inputFilter(String(t)):String(t)},t.ui.InputWidget.prototype.simulateLabelClick=function(){t.ui.warnDeprecation("InputWidget: simulateLabelClick() is deprecated."),this.isDisabled()||(this.$input.is(":checkbox, :radio")&&this.$input.click(),this.$input.is(":input")&&this.$input[0].focus())},t.ui.InputWidget.prototype.setDisabled=function(e){return t.ui.InputWidget.parent.prototype.setDisabled.call(this,e),this.$input&&this.$input.prop("disabled",this.isDisabled()),this};t.ui.InputWidget.prototype.focus=function(){return this.$input[0].focus(),this};t.ui.InputWidget.prototype.blur=function(){return this.$input[0].blur(),this},t.ui.InputWidget.prototype.restorePreInfuseState=function(e){t.ui.InputWidget.parent.prototype.restorePreInfuseState.call(this,e),void 0!==e.value&&e.value!==this.getValue()&&this.setValue(e.value),e.focus&&this.focus()},t.ui.ButtonInputWidget=function(e){e=$.extend({type:"button",useInputTag:!1},e),e.$input&&e.$input.empty(),this.useInputTag=e.useInputTag,t.ui.ButtonInputWidget.parent.call(this,e),t.ui.mixin.ButtonElement.call(this,$.extend({},e,{$button:this.$input})),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$input})),e.useInputTag||this.$input.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonInputWidget")},t.inheritClass(t.ui.ButtonInputWidget,t.ui.InputWidget),t.mixinClass(t.ui.ButtonInputWidget,t.ui.mixin.ButtonElement),t.mixinClass(t.ui.ButtonInputWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.ButtonInputWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.ButtonInputWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.ButtonInputWidget,t.ui.mixin.TitledElement),t.ui.ButtonInputWidget.static.supportsSimpleLabel=!1,t.ui.ButtonInputWidget.prototype.getInputElement=function(t){var e;return e=["button","submit","reset"].indexOf(t.type)!==-1?t.type:"button",$("<"+(t.useInputTag?"input":"button")+' type="'+e+'">')},t.ui.ButtonInputWidget.prototype.setLabel=function(e){return"function"==typeof e&&(e=t.ui.resolveMsg(e)),this.useInputTag&&("string"!=typeof e&&(e=""),this.$input.val(e)),t.ui.mixin.LabelElement.prototype.setLabel.call(this,e)},t.ui.ButtonInputWidget.prototype.setValue=function(e){return this.useInputTag||t.ui.ButtonInputWidget.parent.prototype.setValue.call(this,e),this},t.ui.CheckboxInputWidget=function(e){e=e||{},t.ui.CheckboxInputWidget.parent.call(this,e),this.$element.addClass("oo-ui-checkboxInputWidget").append($("<span>")),this.setSelected(void 0!==e.selected&&e.selected)},t.inheritClass(t.ui.CheckboxInputWidget,t.ui.InputWidget),t.ui.CheckboxInputWidget.static.gatherPreInfuseState=function(e,i){var n=t.ui.CheckboxInputWidget.parent.static.gatherPreInfuseState(e,i);return n.checked=i.$input.prop("checked"),n},t.ui.CheckboxInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","checkbox")},t.ui.CheckboxInputWidget.prototype.onEdit=function(){var t=this;this.isDisabled()||setTimeout(function(){t.setSelected(t.$input.prop("checked"))})},t.ui.CheckboxInputWidget.prototype.setSelected=function(t){return t=!!t,this.selected!==t&&(this.selected=t,this.$input.prop("checked",this.selected),this.emit("change",this.selected)),this},t.ui.CheckboxInputWidget.prototype.isSelected=function(){var t=this.$input.prop("checked");return this.selected!==t&&this.setSelected(t),this.selected},t.ui.CheckboxInputWidget.prototype.restorePreInfuseState=function(e){t.ui.CheckboxInputWidget.parent.prototype.restorePreInfuseState.call(this,e),void 0!==e.checked&&e.checked!==this.isSelected()&&this.setSelected(e.checked)},t.ui.DropdownInputWidget=function(e){e=e||{},e.$input&&e.$input.addClass("oo-ui-element-hidden"),this.dropdownWidget=new t.ui.DropdownWidget(e.dropdown),t.ui.DropdownInputWidget.parent.call(this,e),t.ui.mixin.TitledElement.call(this,e),this.dropdownWidget.getMenu().connect(this,{select:"onMenuSelect"}),this.setOptions(e.options||[]),this.$element.addClass("oo-ui-dropdownInputWidget").append(this.dropdownWidget.$element)},t.inheritClass(t.ui.DropdownInputWidget,t.ui.InputWidget),t.mixinClass(t.ui.DropdownInputWidget,t.ui.mixin.TitledElement),t.ui.DropdownInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","hidden")},t.ui.DropdownInputWidget.prototype.onMenuSelect=function(t){this.setValue(t.getData())},t.ui.DropdownInputWidget.prototype.setValue=function(e){return e=this.cleanUpValue(e),this.dropdownWidget.getMenu().selectItemByData(e),t.ui.DropdownInputWidget.parent.prototype.setValue.call(this,e),this},t.ui.DropdownInputWidget.prototype.setDisabled=function(e){return this.dropdownWidget.setDisabled(e),t.ui.DropdownInputWidget.parent.prototype.setDisabled.call(this,e),this},t.ui.DropdownInputWidget.prototype.setOptions=function(e){var i=this.getValue(),n=this;return this.dropdownWidget.getMenu().clearItems().addItems(e.map(function(e){var i=n.cleanUpValue(e.data);return new t.ui.MenuOptionWidget({data:i,label:void 0!==e.label?e.label:i})})),this.dropdownWidget.getMenu().getItemFromData(i)?this.setValue(i):e.length&&this.setValue(e[0].data),this},t.ui.DropdownInputWidget.prototype.focus=function(){return this.dropdownWidget.getMenu().toggle(!0),this},t.ui.DropdownInputWidget.prototype.blur=function(){return this.dropdownWidget.getMenu().toggle(!1),this},t.ui.RadioInputWidget=function(e){e=e||{},t.ui.RadioInputWidget.parent.call(this,e),this.$element.addClass("oo-ui-radioInputWidget").append($("<span>")),this.setSelected(void 0!==e.selected&&e.selected)},t.inheritClass(t.ui.RadioInputWidget,t.ui.InputWidget),t.ui.RadioInputWidget.static.gatherPreInfuseState=function(e,i){var n=t.ui.RadioInputWidget.parent.static.gatherPreInfuseState(e,i);return n.checked=i.$input.prop("checked"),n},t.ui.RadioInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","radio")},t.ui.RadioInputWidget.prototype.onEdit=function(){},t.ui.RadioInputWidget.prototype.setSelected=function(t){return this.$input.prop("checked",t),this},t.ui.RadioInputWidget.prototype.isSelected=function(){return this.$input.prop("checked")},t.ui.RadioInputWidget.prototype.restorePreInfuseState=function(e){t.ui.RadioInputWidget.parent.prototype.restorePreInfuseState.call(this,e),void 0!==e.checked&&e.checked!==this.isSelected()&&this.setSelected(e.checked)},t.ui.RadioSelectInputWidget=function(e){e=e||{},this.radioSelectWidget=new t.ui.RadioSelectWidget,t.ui.RadioSelectInputWidget.parent.call(this,e),this.radioSelectWidget.connect(this,{select:"onMenuSelect"}),this.setOptions(e.options||[]),this.$element.addClass("oo-ui-radioSelectInputWidget").append(this.radioSelectWidget.$element)},t.inheritClass(t.ui.RadioSelectInputWidget,t.ui.InputWidget),t.ui.RadioSelectInputWidget.static.supportsSimpleLabel=!1,t.ui.RadioSelectInputWidget.static.gatherPreInfuseState=function(e,i){var n=t.ui.RadioSelectInputWidget.parent.static.gatherPreInfuseState(e,i);return n.value=$(e).find(".oo-ui-radioInputWidget .oo-ui-inputWidget-input:checked").val(),n},t.ui.RadioSelectInputWidget.static.reusePreInfuseDOM=function(e,i){return i=t.ui.RadioSelectInputWidget.parent.static.reusePreInfuseDOM(e,i),delete i.$input,i},t.ui.RadioSelectInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","hidden")},t.ui.RadioSelectInputWidget.prototype.onMenuSelect=function(t){this.setValue(t.getData())},t.ui.RadioSelectInputWidget.prototype.setValue=function(e){return e=this.cleanUpValue(e),this.radioSelectWidget.selectItemByData(e),t.ui.RadioSelectInputWidget.parent.prototype.setValue.call(this,e),this},t.ui.RadioSelectInputWidget.prototype.setDisabled=function(e){return this.radioSelectWidget.setDisabled(e),t.ui.RadioSelectInputWidget.parent.prototype.setDisabled.call(this,e),this},t.ui.RadioSelectInputWidget.prototype.setOptions=function(e){var i=this.getValue(),n=this;return this.radioSelectWidget.clearItems().addItems(e.map(function(e){var i=n.cleanUpValue(e.data);return new t.ui.RadioOptionWidget({data:i,label:void 0!==e.label?e.label:i})})),this.radioSelectWidget.getItemFromData(i)?this.setValue(i):e.length&&this.setValue(e[0].data),this},t.ui.CheckboxMultiselectInputWidget=function(e){e=e||{},this.checkboxMultiselectWidget=new t.ui.CheckboxMultiselectWidget,t.ui.CheckboxMultiselectInputWidget.parent.call(this,e),this.inputName=e.name,this.$element.addClass("oo-ui-checkboxMultiselectInputWidget").append(this.checkboxMultiselectWidget.$element),this.$input.detach(),this.setOptions(e.options||[]),this.setValue(e.value)},t.inheritClass(t.ui.CheckboxMultiselectInputWidget,t.ui.InputWidget),t.ui.CheckboxMultiselectInputWidget.static.supportsSimpleLabel=!1,t.ui.CheckboxMultiselectInputWidget.static.gatherPreInfuseState=function(e,i){var n=t.ui.CheckboxMultiselectInputWidget.parent.static.gatherPreInfuseState(e,i);return n.value=$(e).find(".oo-ui-checkboxInputWidget .oo-ui-inputWidget-input:checked").toArray().map(function(t){return t.value}),n},t.ui.CheckboxMultiselectInputWidget.static.reusePreInfuseDOM=function(e,i){return i=t.ui.CheckboxMultiselectInputWidget.parent.static.reusePreInfuseDOM(e,i),delete i.$input,i},t.ui.CheckboxMultiselectInputWidget.prototype.getInputElement=function(){return $("<div>")},t.ui.CheckboxMultiselectInputWidget.prototype.getValue=function(){var t=this.$element.find(".oo-ui-checkboxInputWidget .oo-ui-inputWidget-input:checked").toArray().map(function(t){return t.value});return this.value!==t&&this.setValue(t),this.value},t.ui.CheckboxMultiselectInputWidget.prototype.setValue=function(e){return e=this.cleanUpValue(e),this.checkboxMultiselectWidget.selectItemsByData(e),t.ui.CheckboxMultiselectInputWidget.parent.prototype.setValue.call(this,e),this},t.ui.CheckboxMultiselectInputWidget.prototype.cleanUpValue=function(e){var i,n,o=[];if(!Array.isArray(e))return o;for(i=0;i<e.length;i++)n=t.ui.CheckboxMultiselectInputWidget.parent.prototype.cleanUpValue.call(this,e[i]),this.checkboxMultiselectWidget.getItemFromData(n)&&o.push(n);return o},t.ui.CheckboxMultiselectInputWidget.prototype.setDisabled=function(e){return this.checkboxMultiselectWidget.setDisabled(e),t.ui.CheckboxMultiselectInputWidget.parent.prototype.setDisabled.call(this,e),this},t.ui.CheckboxMultiselectInputWidget.prototype.setOptions=function(e){var i=this;return this.checkboxMultiselectWidget.clearItems().addItems(e.map(function(e){var n,o,s;return n=t.ui.CheckboxMultiselectInputWidget.parent.prototype.cleanUpValue.call(i,e.data),s=void 0!==e.disabled&&e.disabled,o=new t.ui.CheckboxMultioptionWidget({data:n,label:void 0!==e.label?e.label:n,disabled:s}),o.checkbox.$input.attr("name",i.inputName),o.checkbox.setValue(n),o})),this.setValue(this.getValue()),this},t.ui.TextInputWidget=function(e){e=$.extend({type:"text",labelPosition:"after"},e),"search"===e.type&&(t.ui.warnDeprecation("TextInputWidget: config.type='search' is deprecated. Use the SearchInputWidget instead. See T148471 for details."),void 0===e.icon&&(e.icon="search")),t.ui.TextInputWidget.parent.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.PendingElement.call(this,$.extend({},e,{$pending:this.$input})),t.ui.mixin.LabelElement.call(this,e),this.type=this.getSaneType(e),this.readOnly=!1,this.required=!1,this.multiline=!!e.multiline,this.autosize=!!e.autosize,this.minRows=void 0!==e.rows?e.rows:"",this.maxRows=e.maxRows||Math.max(2*(this.minRows||0),10),this.validate=null,this.styleHeight=null,this.scrollWidth=null,this.autosize&&(this.$clone=this.$input.clone().insertAfter(this.$input).attr("aria-hidden","true").addClass("oo-ui-element-hidden")),this.setValidation(e.validate),this.setLabelPosition(e.labelPosition),this.$input.on({keypress:this.onKeyPress.bind(this),blur:this.onBlur.bind(this),focus:this.onFocus.bind(this)}),this.$icon.on("mousedown",this.onIconMouseDown.bind(this)),this.$indicator.on("mousedown",this.onIndicatorMouseDown.bind(this)),this.on("labelChange",this.updatePosition.bind(this)),this.connect(this,{change:"onChange",disable:"onDisable"}),this.on("change",t.ui.debounce(this.onDebouncedChange.bind(this),250)),this.$element.addClass("oo-ui-textInputWidget oo-ui-textInputWidget-type-"+this.type).append(this.$icon,this.$indicator),this.setReadOnly(!!e.readOnly),this.setRequired(!!e.required),this.updateSearchIndicator(),void 0!==e.placeholder&&this.$input.attr("placeholder",e.placeholder),void 0!==e.maxLength&&this.$input.attr("maxlength",e.maxLength),e.autofocus&&this.$input.attr("autofocus","autofocus"),e.autocomplete===!1&&(this.$input.attr("autocomplete","off"),$(window).on({beforeunload:function(){this.$input.removeAttr("autocomplete")}.bind(this),pageshow:function(){this.$input.attr("autocomplete","off")}.bind(this)})),this.multiline&&e.rows&&this.$input.attr("rows",e.rows),(this.label||e.autosize)&&(this.isWaitingToBeAttached=!0,this.installParentChangeDetector())},t.inheritClass(t.ui.TextInputWidget,t.ui.InputWidget),t.mixinClass(t.ui.TextInputWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.TextInputWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.TextInputWidget,t.ui.mixin.PendingElement),t.mixinClass(t.ui.TextInputWidget,t.ui.mixin.LabelElement),t.ui.TextInputWidget.static.validationPatterns={"non-empty":/.+/,integer:/^\d+$/},t.ui.TextInputWidget.static.gatherPreInfuseState=function(e,i){var n=t.ui.TextInputWidget.parent.static.gatherPreInfuseState(e,i);return i.multiline&&(n.scrollTop=i.$input.scrollTop()),n},t.ui.TextInputWidget.prototype.onIconMouseDown=function(e){if(e.which===t.ui.MouseButtons.LEFT)return this.$input[0].focus(),!1},t.ui.TextInputWidget.prototype.onIndicatorMouseDown=function(e){if(e.which===t.ui.MouseButtons.LEFT)return"search"===this.type&&this.setValue(""),this.$input[0].focus(),!1},t.ui.TextInputWidget.prototype.onKeyPress=function(e){e.which!==t.ui.Keys.ENTER||this.multiline||this.emit("enter",e)},t.ui.TextInputWidget.prototype.onBlur=function(){this.setValidityFlag()},t.ui.TextInputWidget.prototype.onFocus=function(){this.isWaitingToBeAttached&&this.onElementAttach(),this.setValidityFlag(!0)},t.ui.TextInputWidget.prototype.onElementAttach=function(){this.isWaitingToBeAttached=!1,this.valCache=null,this.adjustSize(),this.positionLabel()},t.ui.TextInputWidget.prototype.onChange=function(){this.updateSearchIndicator(),this.adjustSize()},t.ui.TextInputWidget.prototype.onDebouncedChange=function(){this.setValidityFlag()},t.ui.TextInputWidget.prototype.onDisable=function(){this.updateSearchIndicator()},t.ui.TextInputWidget.prototype.isReadOnly=function(){return this.readOnly},t.ui.TextInputWidget.prototype.setReadOnly=function(t){return this.readOnly=!!t,this.$input.prop("readOnly",this.readOnly),this.updateSearchIndicator(),this},t.ui.TextInputWidget.prototype.isRequired=function(){return this.required},t.ui.TextInputWidget.prototype.setRequired=function(t){return this.required=!!t,this.required?(this.$input.attr("required","required").attr("aria-required","true"),null===this.getIndicator()&&this.setIndicator("required")):(this.$input.removeAttr("required").removeAttr("aria-required"),"required"===this.getIndicator()&&this.setIndicator(null)),this.updateSearchIndicator(),this},t.ui.TextInputWidget.prototype.installParentChangeDetector=function(){var t,e,i,n,o=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,s=this;if(o){if(this.isElementAttached())return;for(i=this.$element[0];i.parentNode;)i=i.parentNode;t=new o(function(t){var n,o,s;for(n=0;n<t.length;n++)for(s=t[n].removedNodes,o=0;o<s.length;o++)if(s[o]===i)return void setTimeout(e,0)}),e=function(){s.isElementAttached()&&s.onElementAttach(),t.disconnect(),s.installParentChangeDetector()},n=$("<div>").append(i)[0],t.observe(n,{childList:!0})}else this.$element.on("DOMNodeInsertedIntoDocument",this.onElementAttach.bind(this))},t.ui.TextInputWidget.prototype.adjustSize=function(){var t,e,i,n,o,s,l,u,a;return this.isWaitingToBeAttached?this:(this.multiline&&this.$input.val()!==this.valCache&&(this.autosize&&(this.$clone.val(this.$input.val()).attr("rows",this.minRows).css("height",0),this.$clone.removeClass("oo-ui-element-hidden"),this.valCache=this.$input.val(),t=this.$clone[0].scrollHeight,this.$clone.css("height",""),e=this.$clone.innerHeight(),i=this.$clone.outerHeight(),this.$clone.attr("rows",this.maxRows).css("height","auto").val(""),n=this.$clone.innerHeight(),o=n-this.$clone[0].scrollHeight,s=Math.min(n,t+o),this.$clone.addClass("oo-ui-element-hidden"),l=s>e?s+(i-e):"",l!==this.styleHeight&&(this.$input.css("height",l),this.styleHeight=l,this.emit("resize"))),u=this.$input[0].offsetWidth-this.$input[0].clientWidth,u!==this.scrollWidth&&(a="rtl"===this.$element.css("direction")?"left":"right",this.$label.css({right:"",left:""}),this.$indicator.css({right:"",left:""}),u&&(this.$indicator.css(a,u),"after"===this.labelPosition&&this.$label.css(a,u)),this.scrollWidth=u,this.positionLabel())),this)},t.ui.TextInputWidget.prototype.getInputElement=function(t){return t.multiline?$("<textarea>"):"number"===this.getSaneType(t)?$("<input>").attr("step","any").attr("type","number"):$("<input>").attr("type",this.getSaneType(t))},t.ui.TextInputWidget.prototype.getSaneType=function(t){var e=["text","password","search","email","url","date","month","number"];return e.indexOf(t.type)!==-1?t.type:"text"},t.ui.TextInputWidget.prototype.isMultiline=function(){return!!this.multiline},t.ui.TextInputWidget.prototype.isAutosizing=function(){
return!!this.autosize},t.ui.TextInputWidget.prototype.selectRange=function(t,e){var i,n,o,s=this.$input[0];e=e||t,i=e<t,n=i?e:t,o=i?t:e,this.focus();try{s.setSelectionRange(n,o,i?"backward":"forward")}catch(t){if(this.getElementDocument().body.contains(s))throw t}return this},t.ui.TextInputWidget.prototype.getRange=function(){var t=this.$input[0],e=t.selectionStart,i=t.selectionEnd,n="backward"===t.selectionDirection;return{from:n?i:e,to:n?e:i}},t.ui.TextInputWidget.prototype.getInputLength=function(){return this.$input[0].value.length},t.ui.TextInputWidget.prototype.select=function(){return this.selectRange(0,this.getInputLength())},t.ui.TextInputWidget.prototype.moveCursorToStart=function(){return this.selectRange(0)},t.ui.TextInputWidget.prototype.moveCursorToEnd=function(){return this.selectRange(this.getInputLength())},t.ui.TextInputWidget.prototype.insertContent=function(t){var e,i,n=this.getRange(),o=this.getValue();return e=Math.min(n.from,n.to),i=Math.max(n.from,n.to),this.setValue(o.slice(0,e)+t+o.slice(i)),this.selectRange(e+t.length),this},t.ui.TextInputWidget.prototype.encapsulateContent=function(t,e){var i,n,o=this.getRange(),s=t.length;return i=Math.min(o.from,o.to),n=Math.max(o.from,o.to),this.selectRange(i).insertContent(t),this.selectRange(s+n).insertContent(e),this.selectRange(s+i,s+n),this},t.ui.TextInputWidget.prototype.setValidation=function(t){t instanceof RegExp||t instanceof Function?this.validate=t:this.validate=this.constructor.static.validationPatterns[t]||/.*/},t.ui.TextInputWidget.prototype.setValidityFlag=function(t){var e=this,i=function(t){t?e.$input.removeAttr("aria-invalid"):e.$input.attr("aria-invalid","true"),e.setFlags({invalid:!t})};void 0!==t?i(t):this.getValidity().then(function(){i(!0)},function(){i(!1)})},t.ui.TextInputWidget.prototype.getValidity=function(){function t(t){return t?$.Deferred().resolve().promise():$.Deferred().reject().promise()}var e;return void 0!==this.$input[0].checkValidity&&this.$input[0].checkValidity()===!1?t(!1):this.validate instanceof Function?(e=this.validate(this.getValue()),e&&$.isFunction(e.promise)?e.promise().then(function(e){return t(e)}):t(e)):t(this.getValue().match(this.validate))},t.ui.TextInputWidget.prototype.setLabelPosition=function(t){return this.labelPosition=t,this.label&&this.updatePosition(),this},t.ui.TextInputWidget.prototype.updatePosition=function(){var t="after"===this.labelPosition;return this.$element.toggleClass("oo-ui-textInputWidget-labelPosition-after",!!this.label&&t).toggleClass("oo-ui-textInputWidget-labelPosition-before",!!this.label&&!t),this.valCache=null,this.scrollWidth=null,this.adjustSize(),this.positionLabel(),this},t.ui.TextInputWidget.prototype.updateSearchIndicator=function(){"search"===this.type&&(""===this.getValue()||this.isDisabled()||this.isReadOnly()?this.setIndicator(null):this.setIndicator("clear"))},t.ui.TextInputWidget.prototype.positionLabel=function(){var t,e,i;return this.isWaitingToBeAttached?this:(this.$input.css({"padding-right":"","padding-left":""}),this.label?(this.$element.append(this.$label),t="after"===this.labelPosition,e="rtl"===this.$element.css("direction"),i=t===e?"padding-left":"padding-right",this.$input.css(i,this.$label.outerWidth(!0)+(t?this.scrollWidth:0)),this):void this.$label.detach())},t.ui.TextInputWidget.prototype.restorePreInfuseState=function(e){t.ui.TextInputWidget.parent.prototype.restorePreInfuseState.call(this,e),void 0!==e.scrollTop&&this.$input.scrollTop(e.scrollTop)},t.ui.SearchInputWidget=function(e){e=$.extend({icon:"search"},e),e.type="text",t.ui.SearchInputWidget.parent.call(this,e),this.$element.addClass("oo-ui-textInputWidget-type-search"),this.updateSearchIndicator(),this.connect(this,{disable:"onDisable"})},t.inheritClass(t.ui.SearchInputWidget,t.ui.TextInputWidget),t.ui.SearchInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","search")},t.ui.SearchInputWidget.prototype.onIndicatorMouseDown=function(e){if(e.which===t.ui.MouseButtons.LEFT)return this.setValue(""),this.$input[0].focus(),!1},t.ui.SearchInputWidget.prototype.updateSearchIndicator=function(){""===this.getValue()||this.isDisabled()||this.isReadOnly()?this.setIndicator(null):this.setIndicator("clear")},t.ui.SearchInputWidget.prototype.onChange=function(){t.ui.SearchInputWidget.parent.prototype.onChange.call(this),this.updateSearchIndicator()},t.ui.SearchInputWidget.prototype.onDisable=function(){this.updateSearchIndicator()},t.ui.SearchInputWidget.prototype.setReadOnly=function(e){return t.ui.SearchInputWidget.parent.prototype.setReadOnly.call(this,e),this.updateSearchIndicator(),this},t.ui.ComboBoxInputWidget=function(e){e=$.extend({autocomplete:!1},e),e.multiline=!1,t.ui.ComboBoxInputWidget.parent.call(this,e),this.$overlay=e.$overlay||this.$element,this.dropdownButton=new t.ui.ButtonWidget({classes:["oo-ui-comboBoxInputWidget-dropdownButton"],indicator:"down",disabled:this.disabled}),this.menu=new t.ui.FloatingMenuSelectWidget($.extend({widget:this,input:this,$container:this.$element,disabled:this.isDisabled()},e.menu)),this.connect(this,{change:"onInputChange",enter:"onInputEnter"}),this.dropdownButton.connect(this,{click:"onDropdownButtonClick"}),this.menu.connect(this,{choose:"onMenuChoose",add:"onMenuItemsChange",remove:"onMenuItemsChange"}),this.$input.attr({role:"combobox","aria-autocomplete":"list"}),void 0!==e.options&&this.setOptions(e.options),this.$field=$("<div>").addClass("oo-ui-comboBoxInputWidget-field").append(this.$input,this.dropdownButton.$element),this.$element.addClass("oo-ui-comboBoxInputWidget").append(this.$field),this.$overlay.append(this.menu.$element),this.onMenuItemsChange()},t.inheritClass(t.ui.ComboBoxInputWidget,t.ui.TextInputWidget),t.ui.ComboBoxInputWidget.prototype.getMenu=function(){return this.menu},t.ui.ComboBoxInputWidget.prototype.getInput=function(){return this},t.ui.ComboBoxInputWidget.prototype.onInputChange=function(t){var e=this.menu.getItemFromData(t);this.menu.selectItem(e),this.menu.getHighlightedItem()&&this.menu.highlightItem(e),this.isDisabled()||this.menu.toggle(!0)},t.ui.ComboBoxInputWidget.prototype.onInputEnter=function(){this.isDisabled()||this.menu.toggle(!1)},t.ui.ComboBoxInputWidget.prototype.onDropdownButtonClick=function(){this.menu.toggle(),this.$input[0].focus()},t.ui.ComboBoxInputWidget.prototype.onMenuChoose=function(t){this.setValue(t.getData())},t.ui.ComboBoxInputWidget.prototype.onMenuItemsChange=function(){var t=this.menu.getItemFromData(this.getValue());this.menu.selectItem(t),this.menu.getHighlightedItem()&&this.menu.highlightItem(t),this.$element.toggleClass("oo-ui-comboBoxInputWidget-empty",this.menu.isEmpty())},t.ui.ComboBoxInputWidget.prototype.setDisabled=function(e){return t.ui.ComboBoxInputWidget.parent.prototype.setDisabled.call(this,e),this.dropdownButton&&this.dropdownButton.setDisabled(this.isDisabled()),this.menu&&this.menu.setDisabled(this.isDisabled()),this},t.ui.ComboBoxInputWidget.prototype.setOptions=function(e){return this.getMenu().clearItems().addItems(e.map(function(e){return new t.ui.MenuOptionWidget({data:e.data,label:void 0!==e.label?e.label:e.data})})),this},t.ui.FieldLayout=function(e,i){if(t.isPlainObject(e)&&void 0===i&&(i=e,e=i.fieldWidget),void 0===e)throw new Error("Widget not found");i=$.extend({align:"left"},i),t.ui.FieldLayout.parent.call(this,i),t.ui.mixin.LabelElement.call(this,$.extend({},i,{$label:$("<label>")})),t.ui.mixin.TitledElement.call(this,$.extend({},i,{$titled:this.$label})),this.fieldWidget=e,this.errors=[],this.notices=[],this.$field=$("<div>"),this.$messages=$("<ul>"),this.$header=$("<div>"),this.$body=$("<div>"),this.align=null,i.help?(this.popupButtonWidget=new t.ui.PopupButtonWidget({$overlay:i.$overlay,popup:{padded:!0},classes:["oo-ui-fieldLayout-help"],framed:!1,icon:"info"}),i.help instanceof t.ui.HtmlSnippet?this.popupButtonWidget.getPopup().$body.html(i.help.toString()):this.popupButtonWidget.getPopup().$body.text(i.help),this.$help=this.popupButtonWidget.$element):this.$help=$([]),this.fieldWidget.connect(this,{disable:"onFieldDisable"}),e.constructor.static.supportsSimpleLabel&&(this.fieldWidget.getInputId()?this.$label.attr("for",this.fieldWidget.getInputId()):this.$label.on("click",function(){return this.fieldWidget.focus(),!1}.bind(this))),this.$element.addClass("oo-ui-fieldLayout").toggleClass("oo-ui-fieldLayout-disabled",this.fieldWidget.isDisabled()).append(this.$body),this.$body.addClass("oo-ui-fieldLayout-body"),this.$header.addClass("oo-ui-fieldLayout-header"),this.$messages.addClass("oo-ui-fieldLayout-messages"),this.$field.addClass("oo-ui-fieldLayout-field").append(this.fieldWidget.$element),this.setErrors(i.errors||[]),this.setNotices(i.notices||[]),this.setAlignment(i.align)},t.inheritClass(t.ui.FieldLayout,t.ui.Layout),t.mixinClass(t.ui.FieldLayout,t.ui.mixin.LabelElement),t.mixinClass(t.ui.FieldLayout,t.ui.mixin.TitledElement),t.ui.FieldLayout.prototype.onFieldDisable=function(t){this.$element.toggleClass("oo-ui-fieldLayout-disabled",t)},t.ui.FieldLayout.prototype.getField=function(){return this.fieldWidget},t.ui.FieldLayout.prototype.makeMessage=function(e,i){var n,o,s;return n=$("<li>"),o="error"===e?new t.ui.IconWidget({icon:"alert",flags:["warning"]}).$element:"notice"===e?new t.ui.IconWidget({icon:"info"}).$element:"",s=new t.ui.LabelWidget({label:i}),n.append(o,s.$element).addClass("oo-ui-fieldLayout-messages-"+e),n},t.ui.FieldLayout.prototype.setAlignment=function(t){return t!==this.align&&(["left","right","top","inline"].indexOf(t)===-1&&(t="left"),"top"===t?(this.$header.append(this.$label,this.$help),this.$body.append(this.$header,this.$field)):"inline"===t?(this.$header.append(this.$label,this.$help),this.$body.append(this.$field,this.$header)):(this.$header.append(this.$label),this.$body.append(this.$header,this.$help,this.$field)),this.align&&this.$element.removeClass("oo-ui-fieldLayout-align-"+this.align),this.$element.addClass("oo-ui-fieldLayout-align-"+t),this.align=t),this},t.ui.FieldLayout.prototype.setErrors=function(t){return this.errors=t.slice(),this.updateMessages(),this},t.ui.FieldLayout.prototype.setNotices=function(t){return this.notices=t.slice(),this.updateMessages(),this},t.ui.FieldLayout.prototype.updateMessages=function(){var t;if(this.$messages.empty(),!this.errors.length&&!this.notices.length)return void this.$messages.remove();for(this.$body.after(this.$messages),t=0;t<this.notices.length;t++)this.$messages.append(this.makeMessage("notice",this.notices[t]));for(t=0;t<this.errors.length;t++)this.$messages.append(this.makeMessage("error",this.errors[t]))},t.ui.ActionFieldLayout=function(e,i,n){t.isPlainObject(e)&&void 0===n&&(n=e,e=n.fieldWidget,i=n.buttonWidget),t.ui.ActionFieldLayout.parent.call(this,e,n),this.buttonWidget=i,this.$button=$("<div>"),this.$input=$("<div>"),this.$element.addClass("oo-ui-actionFieldLayout"),this.$button.addClass("oo-ui-actionFieldLayout-button").append(this.buttonWidget.$element),this.$input.addClass("oo-ui-actionFieldLayout-input").append(this.fieldWidget.$element),this.$field.append(this.$input,this.$button)},t.inheritClass(t.ui.ActionFieldLayout,t.ui.FieldLayout),t.ui.FieldsetLayout=function(e){e=e||{},t.ui.FieldsetLayout.parent.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.LabelElement.call(this,$.extend({},e,{$label:$("<div>")})),t.ui.mixin.GroupElement.call(this,e),this.$header=$("<div>"),e.help?(this.popupButtonWidget=new t.ui.PopupButtonWidget({$overlay:e.$overlay,popup:{padded:!0},classes:["oo-ui-fieldsetLayout-help"],framed:!1,icon:"info"}),e.help instanceof t.ui.HtmlSnippet?this.popupButtonWidget.getPopup().$body.html(e.help.toString()):this.popupButtonWidget.getPopup().$body.text(e.help),this.$help=this.popupButtonWidget.$element):this.$help=$([]),this.$header.addClass("oo-ui-fieldsetLayout-header").append(this.$icon,this.$label,this.$help),this.$group.addClass("oo-ui-fieldsetLayout-group"),this.$element.addClass("oo-ui-fieldsetLayout").prepend(this.$header,this.$group),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.FieldsetLayout,t.ui.Layout),t.mixinClass(t.ui.FieldsetLayout,t.ui.mixin.IconElement),t.mixinClass(t.ui.FieldsetLayout,t.ui.mixin.LabelElement),t.mixinClass(t.ui.FieldsetLayout,t.ui.mixin.GroupElement),t.ui.FieldsetLayout.static.tagName="fieldset",t.ui.FormLayout=function(e){var i;e=e||{},t.ui.FormLayout.parent.call(this,e),t.ui.mixin.GroupElement.call(this,$.extend({},e,{$group:this.$element})),this.$element.on("submit",this.onFormSubmit.bind(this)),i=e.action,void 0===i||t.ui.isSafeUrl(i)||(i="./"+i),this.$element.addClass("oo-ui-formLayout").attr({method:e.method,action:i,enctype:e.enctype}),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.FormLayout,t.ui.Layout),t.mixinClass(t.ui.FormLayout,t.ui.mixin.GroupElement),t.ui.FormLayout.static.tagName="form",t.ui.FormLayout.prototype.onFormSubmit=function(){if(this.emit("submit"))return!1},t.ui.PanelLayout=function(e){e=$.extend({scrollable:!1,padded:!1,expanded:!0,framed:!1},e),t.ui.PanelLayout.parent.call(this,e),this.$element.addClass("oo-ui-panelLayout"),e.scrollable&&this.$element.addClass("oo-ui-panelLayout-scrollable"),e.padded&&this.$element.addClass("oo-ui-panelLayout-padded"),e.expanded&&this.$element.addClass("oo-ui-panelLayout-expanded"),e.framed&&this.$element.addClass("oo-ui-panelLayout-framed")},t.inheritClass(t.ui.PanelLayout,t.ui.Layout),t.ui.PanelLayout.prototype.focus=function(){t.ui.findFocusable(this.$element).focus()},t.ui.HorizontalLayout=function(e){e=e||{},t.ui.HorizontalLayout.parent.call(this,e),t.ui.mixin.GroupElement.call(this,$.extend({},e,{$group:this.$element})),this.$element.addClass("oo-ui-horizontalLayout"),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.HorizontalLayout,t.ui.Layout),t.mixinClass(t.ui.HorizontalLayout,t.ui.mixin.GroupElement)}(OO),function(t){"use strict";t.ui.mixin.DraggableElement=function(t){t=t||{},this.index=null,this.$handle=t.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").attr("draggable",!0).on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle")},t.initClass(t.ui.mixin.DraggableElement),t.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,t.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(e){this.wasHandleUsed=this.$handle[0]===this.$element[0]||t.ui.contains(this.$handle[0],e.target,!0)},t.ui.mixin.DraggableElement.prototype.onDragStart=function(t){var e=this,i=t.originalEvent.dataTransfer;if(!this.wasHandleUsed)return!1;i.dropEffect="none",i.effectAllowed="move";try{i.setData("application-x/OOjs-UI-draggable",this.getIndex())}catch(t){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(function(){e.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},t.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},t.ui.mixin.DraggableElement.prototype.onDrop=function(t){t.preventDefault(),this.emit("drop",t)},t.ui.mixin.DraggableElement.prototype.onDragOver=function(t){t.preventDefault()},t.ui.mixin.DraggableElement.prototype.setIndex=function(t){this.index!==t&&(this.index=t,this.$element.data("index",t))},t.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},t.ui.mixin.DraggableGroupElement=function(e){e=e||{},t.ui.mixin.GroupElement.call(this,e),this.orientation=e.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),Array.isArray(e.items)&&this.addItems(e.items),this.$element.addClass("oo-ui-draggableGroupElement").attr("role","listbox").append(this.$status).toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},t.mixinClass(t.ui.mixin.DraggableGroupElement,t.ui.mixin.GroupElement),t.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(t){this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(t)},t.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){var t,e;for(t=0,e=this.itemsOrder.length;t<e;t++)this.itemsOrder[t].setIndex(t)},t.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var t,e,i=this.getDragItem();return i&&(e=this.items.indexOf(i),t=i.getIndex()+(i.getIndex()>e?1:0),t!==e&&(this.reorder(this.getDragItem(),t),this.emit("reorder",this.getDragItem(),t)),this.updateIndexes()),this.unsetDragItem(),!1},t.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(t){var e,i,n=this.getDragItem(),o=n.getIndex();e=$(t.target).closest(".oo-ui-draggableElement").data("index"),void 0!==e&&e!==o&&(i=e+(e>o?1:0),i>0?this.$group.children().eq(i-1).after(n.$element):this.$group.prepend(n.$element),this.itemsOrder.splice(e,0,this.itemsOrder.splice(o,1)[0]),this.updateIndexes(),this.emit("drag",n,i)),t.preventDefault()},t.ui.mixin.DraggableGroupElement.prototype.reorder=function(t,e){this.addItems([t],e)},t.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(t){this.dragItem!==t&&(this.dragItem=t,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},t.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},t.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},t.ui.mixin.RequestManager=function(){this.requestCache={},this.requestQuery=null,this.requestRequest=null},t.initClass(t.ui.mixin.RequestManager),t.ui.mixin.RequestManager.prototype.getRequestData=function(){var t,e=this,i=this.getRequestQuery(),n=$.Deferred();return this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,i)?n.resolve(this.requestCache[i]):(this.pushPending&&this.pushPending(),this.requestQuery=i,t=this.requestRequest=this.getRequest(),t.always(function(){e.popPending&&e.popPending()}).done(function(o){t===e.requestRequest&&(e.requestQuery=null,e.requestRequest=null,e.requestCache[i]=e.getRequestCacheDataFromResponse(o),n.resolve(e.requestCache[i]))}).fail(function(){t===e.requestRequest&&(e.requestQuery=null,e.requestRequest=null,n.reject())})),n.promise()},t.ui.mixin.RequestManager.prototype.abortRequest=function(){var t=this.requestRequest;t&&(this.requestRequest=null,this.requestQuery=null,t.abort())},t.ui.mixin.RequestManager.prototype.getRequestQuery=null,t.ui.mixin.RequestManager.prototype.getRequest=null,t.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,t.ui.mixin.LookupElement=function(e){e=$.extend({highlightFirst:!0},e),t.ui.mixin.RequestManager.call(this,e),this.$overlay=e.$overlay||this.$element,this.lookupMenu=new t.ui.FloatingMenuSelectWidget({widget:this,input:this,$container:e.$container||this.$element}),this.allowSuggestionsWhenEmpty=e.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=e.highlightFirst,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},t.mixinClass(t.ui.mixin.LookupElement,t.ui.mixin.RequestManager),t.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.populateLookupMenu()},t.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},t.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupInputFocused&&!this.lookupMenu.isVisible()&&this.populateLookupMenu()},t.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},t.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(t){t||(this.abortLookupRequest(),this.lookupMenu.clearItems())},t.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose=function(t){this.setValue(t.getData())},t.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},t.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(t){this.lookupsDisabled=!!t},t.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},t.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},t.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var t=this,e=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==e?e!==this.lookupQuery&&this.getLookupMenuItems().done(function(e){t.lookupMenu.clearItems(),e.length?(t.lookupMenu.addItems(e).toggle(!0),t.initializeLookupMenuSelection()):t.lookupMenu.toggle(!1)}).fail(function(){t.lookupMenu.clearItems()}):this.closeLookupMenu(),this},t.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.getSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.getFirstSelectableItem())},t.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(function(t){return this.getLookupMenuOptionsFromData(t)}.bind(this))},t.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},t.ui.mixin.LookupElement.prototype.getLookupRequest=null,t.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,t.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,t.ui.mixin.LookupElement.prototype.setReadOnly=function(e){return t.ui.TextInputWidget.prototype.setReadOnly.call(this,e),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},t.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},t.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},t.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(t){return this.getLookupCacheDataFromResponse(t)},t.ui.CardLayout=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.name),i=$.extend({scrollable:!0},i),t.ui.CardLayout.parent.call(this,i),this.name=e,this.label=i.label,this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-cardLayout")},t.inheritClass(t.ui.CardLayout,t.ui.PanelLayout),t.ui.CardLayout.prototype.getName=function(){return this.name},t.ui.CardLayout.prototype.isActive=function(){return this.active},t.ui.CardLayout.prototype.getTabItem=function(){return this.tabItem},t.ui.CardLayout.prototype.setTabItem=function(t){return this.tabItem=t||null,t&&this.setupTabItem(),this},t.ui.CardLayout.prototype.setupTabItem=function(){return this.label&&this.tabItem.setLabel(this.label),this},t.ui.CardLayout.prototype.setActive=function(t){t=!!t,t!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-cardLayout-active",this.active),this.emit("active",this.active))},t.ui.PageLayout=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.name),i=$.extend({scrollable:!0},i),t.ui.PageLayout.parent.call(this,i),this.name=e,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},t.inheritClass(t.ui.PageLayout,t.ui.PanelLayout),t.ui.PageLayout.prototype.getName=function(){return this.name},t.ui.PageLayout.prototype.isActive=function(){return this.active},t.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},t.ui.PageLayout.prototype.setOutlineItem=function(t){return this.outlineItem=t||null,t&&this.setupOutlineItem(),this},t.ui.PageLayout.prototype.setupOutlineItem=function(){return this},t.ui.PageLayout.prototype.setActive=function(t){t=!!t,t!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-pageLayout-active",t),this.emit("active",this.active))},t.ui.StackLayout=function(e){e=$.extend({scrollable:!0},e),t.ui.StackLayout.parent.call(this,e),t.ui.mixin.GroupElement.call(this,$.extend({},e,{$group:this.$element})),this.currentItem=null,this.continuous=!!e.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&(this.$element.addClass("oo-ui-stackLayout-continuous"),this.$element.on("scroll",t.ui.debounce(this.onScroll.bind(this),250))),Array.isArray(e.items)&&this.addItems(e.items)},t.inheritClass(t.ui.StackLayout,t.ui.PanelLayout),t.mixinClass(t.ui.StackLayout,t.ui.mixin.GroupElement),t.ui.StackLayout.prototype.onScroll=function(){function t(t){return t.$element[0].getBoundingClientRect()}function e(e){var i=t(e);return i.bottom>l.top&&i.top<l.bottom}var i,n=this.items.length,o=this.items.indexOf(this.currentItem),s=o,l=this.$element[0].getBoundingClientRect();if(l&&(l.top||l.bottom)){if(i=t(this.currentItem),i.bottom<l.top)for(;++s<n&&!e(this.items[s]););else if(i.top>l.bottom)for(;--s>=0&&!e(this.items[s]););s!==o&&this.emit("visibleItemChange",this.items[s])}},t.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},t.ui.StackLayout.prototype.unsetCurrentItem=function(){var t=this.currentItem;null!==t&&(this.currentItem=null,this.emit("set",null))},t.ui.StackLayout.prototype.addItems=function(e,i){return this.updateHiddenState(e,this.currentItem),t.ui.mixin.GroupElement.prototype.addItems.call(this,e,i),!this.currentItem&&e.length&&this.setItem(e[0]),this},t.ui.StackLayout.prototype.removeItems=function(e){return t.ui.mixin.GroupElement.prototype.removeItems.call(this,e),e.indexOf(this.currentItem)!==-1&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},t.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),t.ui.mixin.GroupElement.prototype.clearItems.call(this),this},t.ui.StackLayout.prototype.setItem=function(t){return t!==this.currentItem&&(this.updateHiddenState(this.items,t),this.items.indexOf(t)!==-1?(this.currentItem=t,this.emit("set",t)):this.unsetCurrentItem()),this},t.ui.StackLayout.prototype.updateHiddenState=function(t,e){var i,n;if(!this.continuous){for(i=0,n=t.length;i<n;i++)e&&e===t[i]||(t[i].$element.addClass("oo-ui-element-hidden"),t[i].$element.attr("aria-hidden","true"));e&&(e.$element.removeClass("oo-ui-element-hidden"),e.$element.removeAttr("aria-hidden"))}},t.ui.MenuLayout=function(e){e=$.extend({showMenu:!0,menuPosition:"before"},e),t.ui.MenuLayout.parent.call(this,e),this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout").append(this.$content,this.$menu),this.setMenuPosition(e.menuPosition),this.toggleMenu(e.showMenu)},t.inheritClass(t.ui.MenuLayout,t.ui.Layout),t.ui.MenuLayout.prototype.toggleMenu=function(t){return t=void 0===t?!this.showMenu:!!t,this.showMenu!==t&&(this.showMenu=t,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},t.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},t.ui.MenuLayout.prototype.setMenuPosition=function(t){return this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=t,this.$element.addClass("oo-ui-menuLayout-"+t),this},t.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},t.ui.BookletLayout=function(e){e=e||{},t.ui.BookletLayout.parent.call(this,e),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new t.ui.StackLayout({continuous:!!e.continuous}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===e.autoFocus||!!e.autoFocus,this.outlineVisible=!1,this.outlined=!!e.outlined,this.outlined&&(this.editable=!!e.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new t.ui.OutlineSelectWidget,this.outlinePanel=new t.ui.PanelLayout({scrollable:!0}),this.$menu.append(this.outlinePanel.$element),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new t.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&(this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.scrolling=!1,this.stackLayout.connect(this,{visibleItemChange:"onStackLayoutVisibleItemChange"})),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},t.inheritClass(t.ui.BookletLayout,t.ui.MenuLayout),t.ui.BookletLayout.prototype.onStackLayoutFocus=function(t){var e,i;i=$(t.target).closest(".oo-ui-pageLayout");for(e in this.pages)if(this.pages[e].$element[0]===i[0]&&e!==this.currentPageName){this.setPage(e);break}},t.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange=function(t){this.scrolling=!0,this.outlineSelectWidget.selectItemByData(t.getName()),this.scrolling=!1},t.ui.BookletLayout.prototype.onStackLayoutSet=function(e){var i=this;!this.scrolling&&e&&e.scrollElementIntoView().done(function(){i.autoFocus&&!t.ui.isMobile()&&i.focus()})},t.ui.BookletLayout.prototype.focus=function(e){var i,n=this.stackLayout.getItems();i=void 0!==e&&n[e]?n[e]:this.stackLayout.getCurrentItem(),!i&&this.outlined&&(this.selectFirstSelectablePage(),i=this.stackLayout.getCurrentItem()),i&&(t.ui.contains(i.$element[0],this.getElementDocument().activeElement,!0)||i.focus())},t.ui.BookletLayout.prototype.focusFirstFocusable=function(){t.ui.findFocusable(this.stackLayout.$element).focus()},t.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(t){t&&this.setPage(t.getData())},t.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},t.ui.BookletLayout.prototype.isEditable=function(){return this.editable},t.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},t.ui.BookletLayout.prototype.toggleOutline=function(t){return this.outlined&&(t=void 0===t?!this.outlineVisible:!!t,this.outlineVisible=t,this.toggleMenu(t)),this},t.ui.BookletLayout.prototype.getClosestPage=function(t){var e,i,n,o=this.stackLayout.getItems(),s=o.indexOf(t);if(s!==-1&&(e=o[s+1],i=o[s-1],this.outlined)){if(n=this.outlineSelectWidget.getItemFromData(t.getName()).getLevel(),i&&n===this.outlineSelectWidget.getItemFromData(i.getName()).getLevel())return i;if(e&&n===this.outlineSelectWidget.getItemFromData(e.getName()).getLevel())return e}return i||e||null},t.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},t.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},t.ui.BookletLayout.prototype.getPage=function(t){return this.pages[t]},t.ui.BookletLayout.prototype.getCurrentPage=function(){var t=this.getCurrentPageName();return t?this.getPage(t):void 0},t.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},t.ui.BookletLayout.prototype.addPages=function(e,i){
var n,o,s,l,u,a,r=this.stackLayout.getItems(),h=[],d=[];for(n=0,o=e.length;n<o;n++)l=e[n],s=l.getName(),Object.prototype.hasOwnProperty.call(this.pages,s)&&(a=r.indexOf(this.pages[s]),a!==-1&&a+1<i&&i--,h.push(this.pages[s]));for(h.length&&this.removePages(h),n=0,o=e.length;n<o;n++)l=e[n],s=l.getName(),this.pages[l.getName()]=l,this.outlined&&(u=new t.ui.OutlineOptionWidget({data:s}),l.setOutlineItem(u),d.push(u));return this.outlined&&d.length&&(this.outlineSelectWidget.addItems(d,i),this.selectFirstSelectablePage()),this.stackLayout.addItems(e,i),this.emit("add",e,i),this},t.ui.BookletLayout.prototype.removePages=function(t){var e,i,n,o,s=[];for(e=0,i=t.length;e<i;e++)o=t[e],n=o.getName(),delete this.pages[n],this.outlined&&(s.push(this.outlineSelectWidget.getItemFromData(n)),o.setOutlineItem(null));return this.outlined&&s.length&&(this.outlineSelectWidget.removeItems(s),this.selectFirstSelectablePage()),this.stackLayout.removeItems(t),this.emit("remove",t),this},t.ui.BookletLayout.prototype.clearPages=function(){var t,e,i=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},t.ui.BookletLayout.prototype.setPage=function(e){var i,n,o=this.pages[e],s=this.currentPageName&&this.pages[this.currentPageName];e!==this.currentPageName&&(this.outlined&&(i=this.outlineSelectWidget.getSelectedItem(),i&&i.getData()!==e&&this.outlineSelectWidget.selectItemByData(e)),o&&(s&&(s.setActive(!1),this.autoFocus&&!t.ui.isMobile()&&this.stackLayout.continuous&&0!==t.ui.findFocusable(o.$element).length&&(n=s.$element.find(":focus"),n.length&&n[0].blur())),this.currentPageName=e,o.setActive(!0),this.stackLayout.setItem(o),!this.stackLayout.continuous&&s&&(n=s.$element.find(":focus"),n.length&&n[0].blur()),this.emit("set",o)))},t.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.getSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.getFirstSelectableItem()),this},t.ui.IndexLayout=function(e){e=$.extend({},e,{menuPosition:"top"}),t.ui.IndexLayout.parent.call(this,e),this.currentCardName=null,this.cards={},this.ignoreFocus=!1,this.stackLayout=new t.ui.StackLayout({continuous:!!e.continuous,expanded:e.expanded}),this.$content.append(this.stackLayout.$element),this.autoFocus=void 0===e.autoFocus||!!e.autoFocus,this.tabSelectWidget=new t.ui.TabSelectWidget,this.tabPanel=new t.ui.PanelLayout,this.$menu.append(this.tabPanel.$element),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element)},t.inheritClass(t.ui.IndexLayout,t.ui.MenuLayout),t.ui.IndexLayout.prototype.onStackLayoutFocus=function(t){var e,i;i=$(t.target).closest(".oo-ui-cardLayout");for(e in this.cards)if(this.cards[e].$element[0]===i[0]&&e!==this.currentCardName){this.setCard(e);break}},t.ui.IndexLayout.prototype.onStackLayoutSet=function(e){var i=this;e&&e.scrollElementIntoView().done(function(){i.autoFocus&&!t.ui.isMobile()&&i.focus()})},t.ui.IndexLayout.prototype.focus=function(e){var i,n=this.stackLayout.getItems();i=void 0!==e&&n[e]?n[e]:this.stackLayout.getCurrentItem(),i||(this.selectFirstSelectableCard(),i=this.stackLayout.getCurrentItem()),i&&(t.ui.contains(i.$element[0],this.getElementDocument().activeElement,!0)||i.focus())},t.ui.IndexLayout.prototype.focusFirstFocusable=function(){t.ui.findFocusable(this.stackLayout.$element).focus()},t.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(t){t&&this.setCard(t.getData())},t.ui.IndexLayout.prototype.getClosestCard=function(t){var e,i,n,o=this.stackLayout.getItems(),s=o.indexOf(t);if(s!==-1){if(e=o[s+1],i=o[s-1],n=this.tabSelectWidget.getItemFromData(t.getName()).getLevel(),i&&n===this.tabSelectWidget.getItemFromData(i.getName()).getLevel())return i;if(e&&n===this.tabSelectWidget.getItemFromData(e.getName()).getLevel())return e}return i||e||null},t.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},t.ui.IndexLayout.prototype.getCard=function(t){return this.cards[t]},t.ui.IndexLayout.prototype.getCurrentCard=function(){var t=this.getCurrentCardName();return t?this.getCard(t):void 0},t.ui.IndexLayout.prototype.getCurrentCardName=function(){return this.currentCardName},t.ui.IndexLayout.prototype.addCards=function(e,i){var n,o,s,l,u,a,r=this.stackLayout.getItems(),h=[],d=[];for(n=0,o=e.length;n<o;n++)l=e[n],s=l.getName(),Object.prototype.hasOwnProperty.call(this.cards,s)&&(a=r.indexOf(this.cards[s]),a!==-1&&a+1<i&&i--,h.push(this.cards[s]));for(h.length&&this.removeCards(h),n=0,o=e.length;n<o;n++)l=e[n],s=l.getName(),this.cards[l.getName()]=l,u=new t.ui.TabOptionWidget({data:s}),l.setTabItem(u),d.push(u);return d.length&&(this.tabSelectWidget.addItems(d,i),this.selectFirstSelectableCard()),this.stackLayout.addItems(e,i),this.emit("add",e,i),this},t.ui.IndexLayout.prototype.removeCards=function(t){var e,i,n,o,s=[];for(e=0,i=t.length;e<i;e++)o=t[e],n=o.getName(),delete this.cards[n],s.push(this.tabSelectWidget.getItemFromData(n)),o.setTabItem(null);return s.length&&(this.tabSelectWidget.removeItems(s),this.selectFirstSelectableCard()),this.stackLayout.removeItems(t),this.emit("remove",t),this},t.ui.IndexLayout.prototype.clearCards=function(){var t,e,i=this.stackLayout.getItems();for(this.cards={},this.currentCardName=null,this.tabSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},t.ui.IndexLayout.prototype.setCard=function(e){var i,n,o=this.cards[e],s=this.currentCardName&&this.cards[this.currentCardName];e!==this.currentCardName&&(i=this.tabSelectWidget.getSelectedItem(),i&&i.getData()!==e&&this.tabSelectWidget.selectItemByData(e),o&&(s&&(s.setActive(!1),this.autoFocus&&!t.ui.isMobile()&&this.stackLayout.continuous&&0!==t.ui.findFocusable(o.$element).length&&(n=s.$element.find(":focus"),n.length&&n[0].blur())),this.currentCardName=e,o.setActive(!0),this.stackLayout.setItem(o),!this.stackLayout.continuous&&s&&(n=s.$element.find(":focus"),n.length&&n[0].blur()),this.emit("set",o)))},t.ui.IndexLayout.prototype.selectFirstSelectableCard=function(){return this.tabSelectWidget.getSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.getFirstSelectableItem()),this},t.ui.ToggleWidget=function(e){e=e||{},t.ui.ToggleWidget.parent.call(this,e),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!e.value)},t.inheritClass(t.ui.ToggleWidget,t.ui.Widget),t.ui.ToggleWidget.prototype.getValue=function(){return this.value},t.ui.ToggleWidget.prototype.setValue=function(t){return t=!!t,this.value!==t&&(this.value=t,this.emit("change",t),this.$element.toggleClass("oo-ui-toggleWidget-on",t),this.$element.toggleClass("oo-ui-toggleWidget-off",!t),this.$element.attr("aria-checked",t.toString())),this},t.ui.ToggleButtonWidget=function(e){e=e||{},t.ui.ToggleButtonWidget.parent.call(this,e),t.ui.mixin.ButtonElement.call(this,$.extend({},e,{active:this.active})),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$button})),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$button})),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button)},t.inheritClass(t.ui.ToggleButtonWidget,t.ui.ToggleWidget),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.ButtonElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.TitledElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.ToggleButtonWidget,t.ui.mixin.TabIndexedElement),t.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},t.ui.ToggleButtonWidget.prototype.setValue=function(e){return e=!!e,e!==this.value&&(this.$button&&this.$button.attr("aria-pressed",e.toString()),this.setActive(e)),t.ui.ToggleButtonWidget.parent.prototype.setValue.call(this,e),this},t.ui.ToggleButtonWidget.prototype.setButtonElement=function(e){this.$button&&this.$button.removeAttr("aria-pressed"),t.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,e),this.$button.attr("aria-pressed",this.value.toString())},t.ui.ToggleSwitchWidget=function(e){t.ui.ToggleSwitchWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},t.inheritClass(t.ui.ToggleSwitchWidget,t.ui.ToggleWidget),t.mixinClass(t.ui.ToggleSwitchWidget,t.ui.mixin.TabIndexedElement),t.ui.ToggleSwitchWidget.prototype.onClick=function(e){return this.isDisabled()||e.which!==t.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},t.ui.ToggleSwitchWidget.prototype.onKeyPress=function(e){if(!this.isDisabled()&&(e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return this.setValue(!this.value),!1},t.ui.OutlineControlsWidget=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.outline),i=$.extend({icon:"add"},i),t.ui.OutlineControlsWidget.parent.call(this,i),t.ui.mixin.GroupElement.call(this,i),t.ui.mixin.IconElement.call(this,i),this.outline=e,this.$movers=$("<div>"),this.upButton=new t.ui.ButtonWidget({framed:!1,icon:"collapse",title:t.ui.msg("ooui-outline-control-move-up")}),this.downButton=new t.ui.ButtonWidget({framed:!1,icon:"expand",title:t.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new t.ui.ButtonWidget({framed:!1,icon:"remove",title:t.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},e.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(i.abilities||{})},t.inheritClass(t.ui.OutlineControlsWidget,t.ui.Widget),t.mixinClass(t.ui.OutlineControlsWidget,t.ui.mixin.GroupElement),t.mixinClass(t.ui.OutlineControlsWidget,t.ui.mixin.IconElement),t.ui.OutlineControlsWidget.prototype.setAbilities=function(t){var e;for(e in this.abilities)void 0!==t[e]&&(this.abilities[e]=!!t[e]);this.onOutlineChange()},t.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var t,e,i,n,o=this.outline.getItems(),s=this.outline.getSelectedItem(),l=this.abilities.move&&s&&s.isMovable(),u=this.abilities.remove&&s&&s.isRemovable();if(l){for(t=-1,e=o.length;++t<e;)if(o[t].isMovable()){i=o[t];break}for(t=e;t--;)if(o[t].isMovable()){n=o[t];break}}this.upButton.setDisabled(!l||s===i),this.downButton.setDisabled(!l||s===n),this.removeButton.setDisabled(!u)},t.ui.OutlineOptionWidget=function(e){e=e||{},t.ui.OutlineOptionWidget.parent.call(this,e),this.level=0,this.movable=!!e.movable,this.removable=!!e.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(e.level)},t.inheritClass(t.ui.OutlineOptionWidget,t.ui.DecoratedOptionWidget),t.ui.OutlineOptionWidget.static.highlightable=!0,t.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,t.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",t.ui.OutlineOptionWidget.static.levels=3,t.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},t.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},t.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},t.ui.OutlineOptionWidget.prototype.setPressed=function(e){return t.ui.OutlineOptionWidget.parent.prototype.setPressed.call(this,e),this.pressed?this.setFlags({progressive:!0}):this.selected||this.setFlags({progressive:!1}),this},t.ui.OutlineOptionWidget.prototype.setMovable=function(t){return this.movable=!!t,this.updateThemeClasses(),this},t.ui.OutlineOptionWidget.prototype.setRemovable=function(t){return this.removable=!!t,this.updateThemeClasses(),this},t.ui.OutlineOptionWidget.prototype.setSelected=function(e){return t.ui.OutlineOptionWidget.parent.prototype.setSelected.call(this,e),this.selected?this.setFlags({progressive:!0}):this.setFlags({progressive:!1}),this},t.ui.OutlineOptionWidget.prototype.setLevel=function(t){var e=this.constructor.static.levels,i=this.constructor.static.levelClass,n=e;for(this.level=t?Math.max(0,Math.min(e-1,t)):0;n--;)this.level===n?this.$element.addClass(i+n):this.$element.removeClass(i+n);return this.updateThemeClasses(),this},t.ui.OutlineSelectWidget=function(e){t.ui.OutlineSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},t.inheritClass(t.ui.OutlineSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.OutlineSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.ButtonOptionWidget=function(e){e=e||{},t.ui.ButtonOptionWidget.parent.call(this,e),t.ui.mixin.ButtonElement.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.TitledElement.call(this,$.extend({},e,{$titled:this.$button})),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button)},t.inheritClass(t.ui.ButtonOptionWidget,t.ui.OptionWidget),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.ButtonElement),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.ButtonOptionWidget,t.ui.mixin.TitledElement),t.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,t.ui.ButtonOptionWidget.static.highlightable=!1,t.ui.ButtonOptionWidget.prototype.setSelected=function(e){return t.ui.ButtonOptionWidget.parent.prototype.setSelected.call(this,e),this.constructor.static.selectable&&this.setActive(e),this},t.ui.ButtonSelectWidget=function(e){t.ui.ButtonSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},t.inheritClass(t.ui.ButtonSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.ButtonSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.TabOptionWidget=function(e){e=e||{},t.ui.TabOptionWidget.parent.call(this,e),this.$element.addClass("oo-ui-tabOptionWidget")},t.inheritClass(t.ui.TabOptionWidget,t.ui.OptionWidget),t.ui.TabOptionWidget.static.highlightable=!1,t.ui.TabSelectWidget=function(e){t.ui.TabSelectWidget.parent.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.$element.on({focus:this.bindKeyDownListener.bind(this),blur:this.unbindKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget")},t.inheritClass(t.ui.TabSelectWidget,t.ui.SelectWidget),t.mixinClass(t.ui.TabSelectWidget,t.ui.mixin.TabIndexedElement),t.ui.CapsuleItemWidget=function(e){e=e||{},t.ui.CapsuleItemWidget.parent.call(this,e),t.ui.mixin.ItemWidget.call(this),t.ui.mixin.LabelElement.call(this,e),t.ui.mixin.FlaggedElement.call(this,e),t.ui.mixin.TabIndexedElement.call(this,e),this.closeButton=new t.ui.ButtonWidget({framed:!1,indicator:"clear",tabIndex:-1}).on("click",this.onCloseClick.bind(this)),this.on("disable",function(t){this.closeButton.setDisabled(t)}.bind(this)),this.$element.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this)}).addClass("oo-ui-capsuleItemWidget").append(this.$label,this.closeButton.$element)},t.inheritClass(t.ui.CapsuleItemWidget,t.ui.Widget),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.ItemWidget),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.LabelElement),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.CapsuleItemWidget,t.ui.mixin.TabIndexedElement),t.ui.CapsuleItemWidget.prototype.onCloseClick=function(){var t=this.getElementGroup();t&&$.isFunction(t.removeItems)&&(t.removeItems([this]),t.focus())},t.ui.CapsuleItemWidget.prototype.onClick=function(){var t=this.getElementGroup();!this.isDisabled()&&t&&$.isFunction(t.editItem)&&t.editItem(this)},t.ui.CapsuleItemWidget.prototype.onKeyDown=function(e){var i=this.getElementGroup();return e.keyCode===t.ui.Keys.BACKSPACE||e.keyCode===t.ui.Keys.DELETE?(i.removeItems([this]),i.focus(),!1):e.keyCode===t.ui.Keys.ENTER?(i.editItem(this),!1):void(e.keyCode===t.ui.Keys.LEFT?i.getPreviousItem(this).focus():e.keyCode===t.ui.Keys.RIGHT&&i.getNextItem(this).focus())},t.ui.CapsuleItemWidget.prototype.focus=function(){this.$element.focus()},t.ui.CapsuleMultiselectWidget=function(e){var i;t.ui.CapsuleMultiselectWidget.parent.call(this,e),e=$.extend({allowArbitrary:!1,allowDuplicates:!1,$overlay:this.$element},e),this.$handle=$("<div>"),this.$input=e.popup?null:$("<input>"),void 0!==e.placeholder&&""!==e.placeholder&&this.$input.attr("placeholder",e.placeholder),t.ui.mixin.GroupElement.call(this,e),e.popup?(e.popup=$.extend({},e.popup,{align:"forwards",anchor:!1}),t.ui.mixin.PopupElement.call(this,$.extend(!0,{},e,{popup:{$floatableContainer:this.$element}})),i=$("<span>"),t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:i}))):(this.popup=null,i=null,t.ui.mixin.TabIndexedElement.call(this,$.extend({},e,{$tabIndexed:this.$input}))),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.IconElement.call(this,e),this.$content=$("<div>"),this.allowArbitrary=e.allowArbitrary,this.allowDuplicates=e.allowDuplicates,this.$overlay=e.$overlay,this.menu=new t.ui.FloatingMenuSelectWidget($.extend({widget:this,$input:this.$input,$container:this.$element,filterFromInput:!0,disabled:this.isDisabled()},e.menu)),this.popup?(i.on({focus:this.focus.bind(this)}),this.popup.$element.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.$autoCloseIgnore&&this.popup.$autoCloseIgnore.on("focusout",this.onPopupFocusOut.bind(this)),this.popup.connect(this,{toggle:function(t){i.toggle(!t)}})):this.$input.on({focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":t.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onKeyDown.bind(this),keypress:this.onKeyPress.bind(this)}),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle",add:"onMenuItemsChange",remove:"onMenuItemsChange"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$input&&(this.$input.prop("disabled",this.isDisabled()),this.$input.attr({role:"combobox","aria-autocomplete":"list"})),e.data&&this.setItemsFromData(e.data),this.$content.addClass("oo-ui-capsuleMultiselectWidget-content").append(this.$group),this.$group.addClass("oo-ui-capsuleMultiselectWidget-group"),this.$handle.addClass("oo-ui-capsuleMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content),this.$element.addClass("oo-ui-capsuleMultiselectWidget").append(this.$handle),this.popup?(this.popup.$element.addClass("oo-ui-capsuleMultiselectWidget-popup"),this.$content.append(i),this.$overlay.append(this.popup.$element)):(this.$content.append(this.$input),this.$overlay.append(this.menu.$element)),i&&i.addClass("oo-ui-capsuleMultiselectWidget-focusTrap"),setTimeout(function(){this.$input&&this.updateInputSize()}.bind(this)),this.onMenuItemsChange()},t.inheritClass(t.ui.CapsuleMultiselectWidget,t.ui.Widget),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.GroupElement),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.PopupElement),t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.TabIndexedElement);t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.IndicatorElement);t.mixinClass(t.ui.CapsuleMultiselectWidget,t.ui.mixin.IconElement),t.ui.CapsuleMultiselectWidget.static.supportsSimpleLabel=!0,t.ui.CapsuleMultiselectWidget.prototype.createItemWidget=function(e,i){return""===i?null:new t.ui.CapsuleItemWidget({data:e,label:i})},t.ui.CapsuleMultiselectWidget.prototype.getInputId=function(){var e;return!!this.$input&&(e=this.$input.attr("id"),void 0===e&&(e=t.ui.generateElementId(),this.$input.attr("id",e)),e)},t.ui.CapsuleMultiselectWidget.prototype.getItemsData=function(){return this.getItems().map(function(t){return t.data})},t.ui.CapsuleMultiselectWidget.prototype.setItemsFromData=function(t){var e=this,i=this.menu,n=this.getItems();return $.each(t,function(t,o){var s,l,u=i.getItemFromData(o);if(u)l=u.label;else{if(!e.allowArbitrary)return;l=String(o)}for(u=null,s=0;s<n.length;s++)if(n[s].data===o&&n[s].label===l){u=n[s],n.splice(s,1);break}u||(u=e.createItemWidget(o,l)),u&&e.addItems([u],t)}),n.length&&e.removeItems(n),this},t.ui.CapsuleMultiselectWidget.prototype.addItemsFromData=function(t){var e=this,i=this.menu,n=[];return $.each(t,function(t,o){var s;e.getItemFromData(o)&&!e.allowDuplicates||(s=i.getItemFromData(o),s?s=e.createItemWidget(o,s.label):e.allowArbitrary&&(s=e.createItemWidget(o,String(o))),s&&n.push(s))}),n.length&&this.addItems(n),this},t.ui.CapsuleMultiselectWidget.prototype.addItemFromLabel=function(e){var i,n;return i=this.menu.getItemFromLabel(e,!0),i?(this.addItemsFromData([i.data]),!0):!!this.allowArbitrary&&(n=this.getItems(),this.addItemsFromData([e]),!t.compare(this.getItems(),n))},t.ui.CapsuleMultiselectWidget.prototype.removeItemsFromData=function(t){var e=this,i=[];return $.each(t,function(t,n){var o=e.getItemFromData(n);o&&i.push(o)}),i.length&&this.removeItems(i),this},t.ui.CapsuleMultiselectWidget.prototype.addItems=function(e){var i,n,o,s=this.items.slice();if(t.ui.mixin.GroupElement.prototype.addItems.call(this,e),this.items.length!==s.length)i=!1;else for(i=!0,n=0,o=s.length;i&&n<o;n++)i=i&&this.items[n]===s[n];return i||(this.emit("change",this.getItemsData()),this.updateIfHeightChanged()),this},t.ui.CapsuleMultiselectWidget.prototype.editItem=function(t){this.addItemFromLabel(this.$input.val()),this.clearInput(),this.$input.val(t.label),this.updateInputSize(),this.focus(),this.menu.updateItemVisibility(),this.removeItems([t])},t.ui.CapsuleMultiselectWidget.prototype.removeItems=function(e){var i,n,o,s=this.items.slice();if(t.ui.mixin.GroupElement.prototype.removeItems.call(this,e),this.items.length!==s.length)i=!1;else for(i=!0,n=0,o=s.length;i&&n<o;n++)i=i&&this.items[n]===s[n];return i||(this.emit("change",this.getItemsData()),this.updateIfHeightChanged()),this},t.ui.CapsuleMultiselectWidget.prototype.clearItems=function(){return this.items.length&&(t.ui.mixin.GroupElement.prototype.clearItems.call(this),this.emit("change",this.getItemsData()),this.updateIfHeightChanged()),this},t.ui.CapsuleMultiselectWidget.prototype.getNextItem=function(t){var e;return void 0===t?this.items[0]:(e=this.items.indexOf(t),!(e<0)&&(e===this.items.length-1?this.$input:this.items[e+1]))},t.ui.CapsuleMultiselectWidget.prototype.getPreviousItem=function(t){var e;return void 0===t?this.items[this.items.length-1]:(e=this.items.indexOf(t),!(e<0)&&(0===e?this.$input:this.items[e-1]))},t.ui.CapsuleMultiselectWidget.prototype.getMenu=function(){return this.menu},t.ui.CapsuleMultiselectWidget.prototype.onInputFocus=function(){this.isDisabled()||this.menu.toggle(!0)},t.ui.CapsuleMultiselectWidget.prototype.onInputBlur=function(){this.addItemFromLabel(this.$input.val()),this.clearInput()},t.ui.CapsuleMultiselectWidget.prototype.onPopupFocusOut=function(){var e=this.popup;setTimeout(function(){e.isVisible()&&!t.ui.contains(e.$element.add(e.$autoCloseIgnore).get(),document.activeElement,!0)&&e.toggle(!1)})},t.ui.CapsuleMultiselectWidget.prototype.onMouseDown=function(e){return e.which===t.ui.MouseButtons.LEFT?(this.focus(),!1):void this.updateInputSize()},t.ui.CapsuleMultiselectWidget.prototype.onKeyPress=function(e){if(!this.isDisabled()){if(e.which===t.ui.Keys.ESCAPE)return this.clearInput(),!1;if(!this.popup){if(this.menu.toggle(!0),e.which===t.ui.Keys.ENTER)return this.addItemFromLabel(this.$input.val())&&this.clearInput(),!1;setTimeout(this.updateInputSize.bind(this),0)}}},t.ui.CapsuleMultiselectWidget.prototype.onKeyDown=function(e){if(!this.isDisabled()&&""===this.$input.val()&&this.items.length){if(e.keyCode===t.ui.Keys.BACKSPACE)return e.metaKey||e.ctrlKey?this.removeItems(this.items.slice(-1)):this.editItem(this.items[this.items.length-1]),!1;e.keyCode===t.ui.Keys.LEFT?this.getPreviousItem().focus():e.keyCode===t.ui.Keys.RIGHT&&this.getNextItem().focus()}},t.ui.CapsuleMultiselectWidget.prototype.updateInputSize=function(){var e,i,n,o,s;if(this.$input&&!this.isDisabled()){if(this.$input.css("width","1em"),e=this.$group.children().last(),i=t.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.$input.val()&&void 0!==this.$input.attr("placeholder")&&(this.$input.val(this.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.$input[0].scrollWidth,this.$input.val("")),n=Math.max(this.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder),o=this.$input.width(),n<o)return;s=0===e.length?this.$content.innerWidth():"ltr"===i?this.$content.innerWidth()-e.position().left-e.outerWidth():e.position().left,s-=10,n>s&&(s=this.$content.innerWidth()-10),this.$input.width(Math.floor(s)),this.updateIfHeightChanged()}},t.ui.CapsuleMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.menu.position(),this.emit("resize"))},t.ui.CapsuleMultiselectWidget.prototype.onMenuChoose=function(t){t&&t.isVisible()&&(this.addItemsFromData([t.getData()]),this.clearInput())},t.ui.CapsuleMultiselectWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-open",t)},t.ui.CapsuleMultiselectWidget.prototype.onMenuItemsChange=function(){this.setItemsFromData(this.getItemsData()),this.$element.toggleClass("oo-ui-capsuleMultiselectWidget-empty",this.menu.isEmpty())},t.ui.CapsuleMultiselectWidget.prototype.clearInput=function(){this.$input&&(this.$input.val(""),this.updateInputSize()),this.popup&&this.popup.toggle(!1),this.menu.toggle(!1),this.menu.selectItem(),this.menu.highlightItem()},t.ui.CapsuleMultiselectWidget.prototype.setDisabled=function(e){var i,n;if(t.ui.CapsuleMultiselectWidget.parent.prototype.setDisabled.call(this,e),this.$input&&this.$input.prop("disabled",this.isDisabled()),this.menu&&this.menu.setDisabled(this.isDisabled()),this.popup&&this.popup.setDisabled(this.isDisabled()),this.items)for(i=0,n=this.items.length;i<n;i++)this.items[i].updateDisabled();return this},t.ui.CapsuleMultiselectWidget.prototype.focus=function(){return this.isDisabled()||(this.popup?(this.popup.setSize(this.$handle.outerWidth()),this.popup.toggle(!0),t.ui.findFocusable(this.popup.$element).focus()):(this.updateInputSize(),this.menu.toggle(!0),this.$input.focus())),this},t.ui.CapsuleMultiSelectWidget=function(){t.ui.warnDeprecation("CapsuleMultiSelectWidget is deprecated. Use the CapsuleMultiselectWidget instead."),t.ui.CapsuleMultiSelectWidget.parent.apply(this,arguments)},t.inheritClass(t.ui.CapsuleMultiSelectWidget,t.ui.CapsuleMultiselectWidget),t.ui.SelectFileWidget=function(e){var i;e=$.extend({accept:null,placeholder:t.ui.msg("ooui-selectfile-placeholder"),notsupported:t.ui.msg("ooui-selectfile-not-supported"),droppable:!0,showDropTarget:!1,thumbnailSizeLimit:20},e),t.ui.SelectFileWidget.parent.call(this,e),t.ui.mixin.IconElement.call(this,e),t.ui.mixin.IndicatorElement.call(this,e),t.ui.mixin.PendingElement.call(this,$.extend({},e,{$pending:this.$info})),t.ui.mixin.LabelElement.call(this,e),this.$info=$("<span>"),this.showDropTarget=e.showDropTarget,this.thumbnailSizeLimit=e.thumbnailSizeLimit,this.isSupported=this.constructor.static.isSupported(),this.currentFile=null,Array.isArray(e.accept)?this.accept=e.accept:this.accept=null,this.placeholder=e.placeholder,this.notsupported=e.notsupported,this.onFileSelectedHandler=this.onFileSelected.bind(this),this.selectButton=new t.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-selectButton"],label:t.ui.msg("ooui-selectfile-button-select"),disabled:this.disabled||!this.isSupported}),this.clearButton=new t.ui.ButtonWidget({classes:["oo-ui-selectFileWidget-clearButton"],framed:!1,icon:"close",disabled:this.disabled}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.clearButton.connect(this,{click:"onClearClick"}),e.droppable&&(i=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:i,dragover:i,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.addInput(),this.$label.addClass("oo-ui-selectFileWidget-label"),this.$info.addClass("oo-ui-selectFileWidget-info").append(this.$icon,this.$label,this.clearButton.$element,this.$indicator),e.droppable&&e.showDropTarget?(this.selectButton.setIcon("upload"),this.$thumbnail=$("<div>").addClass("oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileWidget-dropTarget oo-ui-selectFileWidget").on({click:this.onDropTargetClick.bind(this)}).append(this.$thumbnail,this.$info,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileWidget-dropLabel").text(t.ui.msg("ooui-selectfile-dragdrop-placeholder")))):this.$element.addClass("oo-ui-selectFileWidget").append(this.$info,this.selectButton.$element),this.updateUI()},t.inheritClass(t.ui.SelectFileWidget,t.ui.Widget),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.IconElement),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.PendingElement),t.mixinClass(t.ui.SelectFileWidget,t.ui.mixin.LabelElement),t.ui.SelectFileWidget.static.isSupported=function(){var e;return null===t.ui.SelectFileWidget.static.isSupportedCache&&(e=$("<input>").attr("type","file"),t.ui.SelectFileWidget.static.isSupportedCache=void 0!==e[0].files),t.ui.SelectFileWidget.static.isSupportedCache},t.ui.SelectFileWidget.static.isSupportedCache=null,t.ui.SelectFileWidget.prototype.getValue=function(){return this.currentFile},t.ui.SelectFileWidget.prototype.setValue=function(t){this.currentFile!==t&&(this.currentFile=t,this.updateUI(),this.emit("change",this.currentFile))},t.ui.SelectFileWidget.prototype.focus=function(){return this.selectButton.$button[0].focus(),this},t.ui.SelectFileWidget.prototype.updateUI=function(){var e;this.isSupported?(this.$element.addClass("oo-ui-selectFileWidget-supported"),this.currentFile?(this.$element.removeClass("oo-ui-selectFileWidget-empty"),e=$([]),e=e.add($("<span>").addClass("oo-ui-selectFileWidget-fileName").text(this.currentFile.name)),this.setLabel(e),this.showDropTarget&&(this.pushPending(),this.loadAndGetImageUrl().done(function(t){this.$thumbnail.css("background-image","url( "+t+" )")}.bind(this)).fail(function(){this.$thumbnail.append(new t.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileWidget-noThumbnail-icon"]
}).$element)}.bind(this)).always(function(){this.popPending()}.bind(this)),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.placeholder))):(this.$element.addClass("oo-ui-selectFileWidget-notsupported"),this.$element.removeClass("oo-ui-selectFileWidget-empty"),this.setLabel(this.notsupported))},t.ui.SelectFileWidget.prototype.loadAndGetImageUrl=function(){var e=$.Deferred(),i=this.currentFile,n=new FileReader;return i&&0===(t.getProp(i,"type")||"").indexOf("image/")&&i.size<1024*this.thumbnailSizeLimit*1024?(n.onload=function(t){var i=document.createElement("img");i.addEventListener("load",function(){0===i.naturalWidth||0===i.naturalHeight||i.complete===!1?e.reject():e.resolve(t.target.result)}),i.src=t.target.result},n.readAsDataURL(i)):e.reject(),e.promise()},t.ui.SelectFileWidget.prototype.addInput=function(){return this.$input&&this.$input.remove(),this.isSupported?(this.$input=$("<input>").attr("type","file"),this.$input.on("change",this.onFileSelectedHandler),this.$input.on("click",function(t){t.stopPropagation()}),this.$input.attr({tabindex:-1}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),void this.selectButton.$button.append(this.$input)):void(this.$input=null)},t.ui.SelectFileWidget.prototype.isAllowedType=function(t){var e,i;if(!this.accept||!t)return!0;for(e=0;e<this.accept.length;e++){if(i=this.accept[e],i===t)return!0;if("/*"===i.substr(-2)&&(i=i.substr(0,i.length-1),t.substr(0,i.length)===i))return!0}return!1},t.ui.SelectFileWidget.prototype.onFileSelected=function(e){var i=t.getProp(e.target,"files",0)||null;i&&!this.isAllowedType(i.type)&&(i=null),this.setValue(i),this.addInput()},t.ui.SelectFileWidget.prototype.onClearClick=function(){return this.setValue(null),!1},t.ui.SelectFileWidget.prototype.onKeyPress=function(e){if(this.isSupported&&!this.isDisabled()&&this.$input&&(e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return this.$input.click(),!1},t.ui.SelectFileWidget.prototype.onDropTargetClick=function(){if(this.isSupported&&!this.isDisabled()&&this.$input)return this.$input.click(),!1},t.ui.SelectFileWidget.prototype.onDragEnterOrOver=function(e){var i,n=!1,o=e.originalEvent.dataTransfer;return e.preventDefault(),e.stopPropagation(),this.isDisabled()||!this.isSupported?(this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),o.dropEffect="none",!1):(i=t.getProp(o,"items",0)||t.getProp(o,"files",0),i?this.isAllowedType(i.type)&&(n=!0):Array.prototype.indexOf.call(t.getProp(o,"types")||[],"Files")!==-1&&(n=!0),this.$element.toggleClass("oo-ui-selectFileWidget-canDrop",n),n||(o.dropEffect="none"),!1)},t.ui.SelectFileWidget.prototype.onDragLeave=function(){this.$element.removeClass("oo-ui-selectFileWidget-canDrop")},t.ui.SelectFileWidget.prototype.onDrop=function(e){var i=null,n=e.originalEvent.dataTransfer;return e.preventDefault(),e.stopPropagation(),this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),!(this.isDisabled()||!this.isSupported)&&(i=t.getProp(n,"files",0),i&&!this.isAllowedType(i.type)&&(i=null),i&&this.setValue(i),!1)},t.ui.SelectFileWidget.prototype.setDisabled=function(e){return t.ui.SelectFileWidget.parent.prototype.setDisabled.call(this,e),this.selectButton&&this.selectButton.setDisabled(e),this.clearButton&&this.clearButton.setDisabled(e),this},t.ui.SearchWidget=function(e){e=e||{},t.ui.SearchWidget.parent.call(this,e),this.query=new t.ui.TextInputWidget({icon:"search",placeholder:e.placeholder,value:e.value}),this.results=new t.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},t.inheritClass(t.ui.SearchWidget,t.ui.Widget),t.ui.SearchWidget.prototype.onQueryKeydown=function(e){var i,n,o=e.which===t.ui.Keys.DOWN?1:e.which===t.ui.Keys.UP?-1:0;o&&(i=this.results.getHighlightedItem(),i||(i=this.results.getSelectedItem()),n=this.results.getRelativeSelectableItem(i,o),this.results.highlightItem(n),n.scrollElementIntoView())},t.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},t.ui.SearchWidget.prototype.onQueryEnter=function(){var t=this.results.getHighlightedItem();t&&this.results.chooseItem(t)},t.ui.SearchWidget.prototype.getQuery=function(){return this.query},t.ui.SearchWidget.prototype.getResults=function(){return this.results},t.ui.NumberInputWidget=function(e){e=$.extend({isInteger:!1,min:-(1/0),max:1/0,step:1,pageStep:null,showButtons:!0},e),t.ui.NumberInputWidget.parent.call(this,e),this.input=new t.ui.TextInputWidget($.extend({disabled:this.isDisabled(),type:"number"},e.input)),e.showButtons&&(this.minusButton=new t.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-minusButton"],label:"−"},e.minusButton)),this.plusButton=new t.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-plusButton"],label:"+"},e.plusButton))),this.input.connect(this,{change:this.emit.bind(this,"change"),enter:this.emit.bind(this,"enter")}),this.input.$input.on({keydown:this.onKeyDown.bind(this),"wheel mousewheel DOMMouseScroll":this.onWheel.bind(this)}),e.showButtons&&(this.plusButton.connect(this,{click:["onButtonClick",1]}),this.minusButton.connect(this,{click:["onButtonClick",-1]})),this.setIsInteger(!!e.isInteger),this.setRange(e.min,e.max),this.setStep(e.step,e.pageStep),this.$field=$("<div>").addClass("oo-ui-numberInputWidget-field").append(this.input.$element),this.$element.addClass("oo-ui-numberInputWidget").append(this.$field),e.showButtons&&(this.$field.prepend(this.minusButton.$element).append(this.plusButton.$element),this.$element.addClass("oo-ui-numberInputWidget-buttoned")),this.input.setValidation(this.validateNumber.bind(this))},t.inheritClass(t.ui.NumberInputWidget,t.ui.Widget),t.ui.NumberInputWidget.prototype.setIsInteger=function(t){this.isInteger=!!t,this.input.setValidityFlag()},t.ui.NumberInputWidget.prototype.getIsInteger=function(){return this.isInteger},t.ui.NumberInputWidget.prototype.setRange=function(t,e){if(t>e)throw new Error("Minimum ("+t+") must not be greater than maximum ("+e+")");this.min=t,this.max=e,this.input.setValidityFlag()},t.ui.NumberInputWidget.prototype.getRange=function(){return[this.min,this.max]},t.ui.NumberInputWidget.prototype.setStep=function(t,e){if(t<=0)throw new Error("Step value must be positive");if(null===e)e=10*t;else if(e<=0)throw new Error("Page step value must be positive");this.step=t,this.pageStep=e},t.ui.NumberInputWidget.prototype.getStep=function(){return[this.step,this.pageStep]},t.ui.NumberInputWidget.prototype.getValue=function(){return this.input.getValue()},t.ui.NumberInputWidget.prototype.getNumericValue=function(){return+this.input.getValue()},t.ui.NumberInputWidget.prototype.setValue=function(t){this.input.setValue(t)},t.ui.NumberInputWidget.prototype.adjustValue=function(t){var e,i=this.getNumericValue();if(t=+t,isNaN(t)||!isFinite(t))throw new Error("Delta must be a finite number");isNaN(i)?e=0:(e=i+t,e=Math.max(Math.min(e,this.max),this.min),this.isInteger&&(e=Math.round(e))),e!==i&&this.setValue(e)},t.ui.NumberInputWidget.prototype.validateNumber=function(t){var e=+t;return!(isNaN(e)||!isFinite(e))&&((!this.isInteger||Math.floor(e)===e)&&!(e<this.min||e>this.max))},t.ui.NumberInputWidget.prototype.onButtonClick=function(t){this.adjustValue(t*this.step)},t.ui.NumberInputWidget.prototype.onWheel=function(t){var e=0;if(!this.isDisabled()&&this.input.$input.is(":focus"))return void 0!==t.originalEvent.deltaMode&&(this.sawWheelEvent=!0),t.originalEvent.deltaY?e=-t.originalEvent.deltaY:t.originalEvent.deltaX&&(e=t.originalEvent.deltaX),this.sawWheelEvent||(t.originalEvent.wheelDeltaX?e=-t.originalEvent.wheelDeltaX:t.originalEvent.wheelDeltaY?e=t.originalEvent.wheelDeltaY:t.originalEvent.wheelDelta?e=t.originalEvent.wheelDelta:t.originalEvent.detail&&(e=-t.originalEvent.detail)),e&&(e=e<0?-1:1,this.adjustValue(e*this.step)),!1},t.ui.NumberInputWidget.prototype.onKeyDown=function(e){if(!this.isDisabled())switch(e.which){case t.ui.Keys.UP:return this.adjustValue(this.step),!1;case t.ui.Keys.DOWN:return this.adjustValue(-this.step),!1;case t.ui.Keys.PAGEUP:return this.adjustValue(this.pageStep),!1;case t.ui.Keys.PAGEDOWN:return this.adjustValue(-this.pageStep),!1}},t.ui.NumberInputWidget.prototype.setDisabled=function(e){return t.ui.NumberInputWidget.parent.prototype.setDisabled.call(this,e),this.input&&this.input.setDisabled(this.isDisabled()),this.minusButton&&this.minusButton.setDisabled(this.isDisabled()),this.plusButton&&this.plusButton.setDisabled(this.isDisabled()),this}}(OO),function(t){"use strict";t.ui.Toolbar=function(e,i,n){t.isPlainObject(e)&&void 0===n&&(n=e,e=n.toolFactory,i=n.toolGroupFactory),n=n||{},t.ui.Toolbar.parent.call(this,n),t.EventEmitter.call(this),t.ui.mixin.GroupElement.call(this,n),this.toolFactory=e,this.toolGroupFactory=i,this.groups=[],this.tools={},this.position=n.position||"top",this.$bar=$("<div>"),this.$actions=$("<div>"),this.initialized=!1,this.narrowThreshold=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.$element.add(this.$bar).add(this.$group).add(this.$actions).on("mousedown keydown",this.onPointerDown.bind(this)),this.$group.addClass("oo-ui-toolbar-tools"),n.actions&&this.$bar.append(this.$actions.addClass("oo-ui-toolbar-actions")),this.$bar.addClass("oo-ui-toolbar-bar").append(this.$group,'<div style="clear:both"></div>'),this.$element.addClass("oo-ui-toolbar oo-ui-toolbar-position-"+this.position).append(this.$bar)},t.inheritClass(t.ui.Toolbar,t.ui.Element),t.mixinClass(t.ui.Toolbar,t.EventEmitter),t.mixinClass(t.ui.Toolbar,t.ui.mixin.GroupElement),t.ui.Toolbar.prototype.getToolFactory=function(){return this.toolFactory},t.ui.Toolbar.prototype.getToolGroupFactory=function(){return this.toolGroupFactory},t.ui.Toolbar.prototype.onPointerDown=function(t){var e=$(t.target).closest(".oo-ui-widget"),i=this.$element.closest(".oo-ui-widget");if(!e.length||e[0]===i[0])return!1},t.ui.Toolbar.prototype.onWindowResize=function(){this.$element.toggleClass("oo-ui-toolbar-narrow",this.$bar.width()<=this.getNarrowThreshold())},t.ui.Toolbar.prototype.getNarrowThreshold=function(){return null===this.narrowThreshold&&(this.narrowThreshold=this.$group.width()+this.$actions.width()),this.narrowThreshold},t.ui.Toolbar.prototype.initialize=function(){this.initialized||(this.initialized=!0,$(this.getElementWindow()).on("resize",this.onWindowResizeHandler),this.onWindowResize())},t.ui.Toolbar.prototype.setup=function(e){var i,n,o,s,l=[],u="bar";for(this.reset(),i=0,n=e.length;i<n;i++)s=e[i],"*"===s.include&&(void 0===s.type&&(s.type="list"),void 0===s.label&&(s.label=t.ui.msg("ooui-toolbar-more"))),o=this.getToolGroupFactory().lookup(s.type)?s.type:u,l.push(this.getToolGroupFactory().create(o,this,s));this.addItems(l)},t.ui.Toolbar.prototype.reset=function(){var t,e;for(this.groups=[],this.tools={},t=0,e=this.items.length;t<e;t++)this.items[t].destroy();this.clearItems()},t.ui.Toolbar.prototype.destroy=function(){$(this.getElementWindow()).off("resize",this.onWindowResizeHandler),this.reset(),this.$element.remove()},t.ui.Toolbar.prototype.isToolAvailable=function(t){return!this.tools[t]},t.ui.Toolbar.prototype.reserveTool=function(t){this.tools[t.getName()]=t},t.ui.Toolbar.prototype.releaseTool=function(t){delete this.tools[t.getName()]},t.ui.Toolbar.prototype.getToolAccelerator=function(){},t.ui.Tool=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolGroup),i=i||{},t.ui.Tool.parent.call(this,i),this.toolGroup=e,this.toolbar=this.toolGroup.getToolbar(),this.active=!1,this.$title=$("<span>"),this.$accel=$("<span>"),this.$link=$("<a>"),this.title=null,t.ui.mixin.IconElement.call(this,i),t.ui.mixin.FlaggedElement.call(this,i),t.ui.mixin.TabIndexedElement.call(this,$.extend({},i,{$tabIndexed:this.$link})),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$title.addClass("oo-ui-tool-title"),this.$accel.addClass("oo-ui-tool-accel").prop({dir:"ltr",lang:"en"}),this.$link.addClass("oo-ui-tool-link").append(this.$icon,this.$title,this.$accel).attr("role","button"),this.$element.data("oo-ui-tool",this).addClass("oo-ui-tool oo-ui-tool-name-"+this.constructor.static.name.replace(/^([^\/]+)\/([^\/]+).*$/,"$1-$2")).toggleClass("oo-ui-tool-with-label",this.constructor.static.displayBothIconAndLabel).append(this.$link),this.setTitle(i.title||this.constructor.static.title)},t.inheritClass(t.ui.Tool,t.ui.Widget),t.mixinClass(t.ui.Tool,t.ui.mixin.IconElement),t.mixinClass(t.ui.Tool,t.ui.mixin.FlaggedElement),t.mixinClass(t.ui.Tool,t.ui.mixin.TabIndexedElement),t.ui.Tool.static.tagName="span",t.ui.Tool.static.name="",t.ui.Tool.static.group="",t.ui.Tool.static.title="",t.ui.Tool.static.displayBothIconAndLabel=!1,t.ui.Tool.static.autoAddToCatchall=!0,t.ui.Tool.static.autoAddToGroup=!0,t.ui.Tool.static.isCompatibleWith=function(){return!1},t.ui.Tool.prototype.onUpdateState=null,t.ui.Tool.prototype.onSelect=null,t.ui.Tool.prototype.isActive=function(){return this.active},t.ui.Tool.prototype.setActive=function(t){this.active=!!t,this.active?(this.$element.addClass("oo-ui-tool-active"),this.setFlags({progressive:!0})):(this.$element.removeClass("oo-ui-tool-active"),this.setFlags({progressive:!1}))},t.ui.Tool.prototype.setTitle=function(e){return this.title=t.ui.resolveMsg(e),this.updateTitle(),this},t.ui.Tool.prototype.getTitle=function(){return this.title},t.ui.Tool.prototype.getName=function(){return this.constructor.static.name},t.ui.Tool.prototype.updateTitle=function(){var t=this.toolGroup.constructor.static.titleTooltips,e=this.toolGroup.constructor.static.accelTooltips,i=this.toolbar.getToolAccelerator(this.constructor.static.name),n=[];this.$title.text(this.title),this.$accel.text(i),t&&"string"==typeof this.title&&this.title.length&&n.push(this.title),e&&"string"==typeof i&&i.length&&n.push(i),n.length?this.$link.attr("title",n.join(" ")):this.$link.removeAttr("title")},t.ui.Tool.prototype.destroy=function(){this.toolbar.disconnect(this),this.$element.remove()},t.ui.ToolGroup=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolbar),i=i||{},t.ui.ToolGroup.parent.call(this,i),t.ui.mixin.GroupElement.call(this,i),this.toolbar=e,this.tools={},this.pressed=null,this.autoDisabled=!1,this.include=i.include||[],this.exclude=i.exclude||[],this.promote=i.promote||[],this.demote=i.demote||[],this.onCapturedMouseKeyUpHandler=this.onCapturedMouseKeyUp.bind(this),this.$element.on({mousedown:this.onMouseKeyDown.bind(this),mouseup:this.onMouseKeyUp.bind(this),keydown:this.onMouseKeyDown.bind(this),keyup:this.onMouseKeyUp.bind(this),focus:this.onMouseOverFocus.bind(this),blur:this.onMouseOutBlur.bind(this),mouseover:this.onMouseOverFocus.bind(this),mouseout:this.onMouseOutBlur.bind(this)}),this.toolbar.getToolFactory().connect(this,{register:"onToolFactoryRegister"}),this.aggregate({disable:"itemDisable"}),this.connect(this,{itemDisable:"updateDisabled"}),this.$group.addClass("oo-ui-toolGroup-tools"),this.$element.addClass("oo-ui-toolGroup").append(this.$group),this.populate()},t.inheritClass(t.ui.ToolGroup,t.ui.Widget),t.mixinClass(t.ui.ToolGroup,t.ui.mixin.GroupElement),t.ui.ToolGroup.static.titleTooltips=!1,t.ui.ToolGroup.static.accelTooltips=!1,t.ui.ToolGroup.static.autoDisable=!0,t.ui.ToolGroup.static.name=null,t.ui.ToolGroup.prototype.isDisabled=function(){return this.autoDisabled||t.ui.ToolGroup.parent.prototype.isDisabled.apply(this,arguments)},t.ui.ToolGroup.prototype.updateDisabled=function(){var e,i,n=!0;if(this.constructor.static.autoDisable){for(e=this.items.length-1;e>=0;e--)if(i=this.items[e],!i.isDisabled()){n=!1;break}this.autoDisabled=n}t.ui.ToolGroup.parent.prototype.updateDisabled.apply(this,arguments)},t.ui.ToolGroup.prototype.onMouseKeyDown=function(e){if(!this.isDisabled()&&(e.which===t.ui.MouseButtons.LEFT||e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return this.pressed=this.getTargetTool(e),this.pressed&&(this.pressed.setActive(!0),this.getElementDocument().addEventListener("mouseup",this.onCapturedMouseKeyUpHandler,!0),this.getElementDocument().addEventListener("keyup",this.onCapturedMouseKeyUpHandler,!0)),!1},t.ui.ToolGroup.prototype.onCapturedMouseKeyUp=function(t){this.getElementDocument().removeEventListener("mouseup",this.onCapturedMouseKeyUpHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onCapturedMouseKeyUpHandler,!0),this.onMouseKeyUp(t)},t.ui.ToolGroup.prototype.onMouseKeyUp=function(e){var i=this.getTargetTool(e);this.isDisabled()||!this.pressed||this.pressed!==i||e.which!==t.ui.MouseButtons.LEFT&&e.which!==t.ui.Keys.SPACE&&e.which!==t.ui.Keys.ENTER||(this.pressed.onSelect(),this.pressed=null,e.preventDefault(),e.stopPropagation()),this.pressed=null},t.ui.ToolGroup.prototype.onMouseOverFocus=function(t){var e=this.getTargetTool(t);this.pressed&&this.pressed===e&&this.pressed.setActive(!0)},t.ui.ToolGroup.prototype.onMouseOutBlur=function(t){var e=this.getTargetTool(t);this.pressed&&this.pressed===e&&this.pressed.setActive(!1)},t.ui.ToolGroup.prototype.getTargetTool=function(t){var e,i=$(t.target).closest(".oo-ui-tool-link");return i.length&&(e=i.parent().data("oo-ui-tool")),e&&!e.isDisabled()?e:null},t.ui.ToolGroup.prototype.onToolFactoryRegister=function(){this.populate()},t.ui.ToolGroup.prototype.getToolbar=function(){return this.toolbar},t.ui.ToolGroup.prototype.populate=function(){var t,e,i,n,o=this.toolbar.getToolFactory(),s={},l=[],u=[],a=this.toolbar.getToolFactory().getTools(this.include,this.exclude,this.promote,this.demote);for(t=0,e=a.length;t<e;t++)i=a[t],o.lookup(i)&&(this.toolbar.isToolAvailable(i)||this.tools[i])&&(this.toolbar.tools[i]=!0,n=this.tools[i],n||(this.tools[i]=n=o.create(i,this),n.updateTitle()),this.toolbar.reserveTool(n),l.push(n),s[i]=!0);for(i in this.tools)s[i]||(this.tools[i].destroy(),this.toolbar.releaseTool(this.tools[i]),u.push(this.tools[i]),delete this.tools[i]);u.length&&this.removeItems(u),l.length?this.$element.removeClass("oo-ui-toolGroup-empty"):this.$element.addClass("oo-ui-toolGroup-empty"),this.addItems(l),this.updateDisabled()},t.ui.ToolGroup.prototype.destroy=function(){var t;this.clearItems(),this.toolbar.getToolFactory().disconnect(this);for(t in this.tools)this.toolbar.releaseTool(this.tools[t]),this.tools[t].disconnect(this).destroy(),delete this.tools[t];this.$element.remove()},t.ui.ToolFactory=function(){t.ui.ToolFactory.parent.call(this)},t.inheritClass(t.ui.ToolFactory,t.Factory),t.ui.ToolFactory.prototype.getTools=function(e,i,n,o){var s,l,u,a,r,h=[],d={};for(u=t.simpleArrayDifference(this.extract(e),this.extract(i)),a=this.extract(n,d),r=this.extract(o,d),s=0,l=u.length;s<l;s++)d[u[s]]||h.push(u[s]);return a.concat(h).concat(r)},t.ui.ToolFactory.prototype.extract=function(e,i){var n,o,s,l,u,a=[];for(e=Array.isArray(e)?e:[e],n=0,o=e.length;n<o;n++)if(s=e[n],"*"===s)for(l in this.registry)u=this.registry[l],!u.static.autoAddToCatchall||i&&i[l]||(a.push(l),i&&(i[l]=!0));else if("string"==typeof s&&(s={name:s}),t.isPlainObject(s))if(s.group)for(l in this.registry)u=this.registry[l],u.static.group!==s.group||!u.static.autoAddToGroup||i&&i[l]||(a.push(l),i&&(i[l]=!0));else!s.name||i&&i[s.name]||(a.push(s.name),i&&(i[s.name]=!0));return a},t.ui.ToolGroupFactory=function(){var e,i,n;for(t.Factory.call(this),n=this.constructor.static.getDefaultClasses(),e=0,i=n.length;e<i;e++)this.register(n[e])},t.inheritClass(t.ui.ToolGroupFactory,t.Factory),t.ui.ToolGroupFactory.static.getDefaultClasses=function(){return[t.ui.BarToolGroup,t.ui.ListToolGroup,t.ui.MenuToolGroup]},t.ui.PopupTool=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolGroup),t.ui.PopupTool.parent.call(this,e,i),t.ui.mixin.PopupElement.call(this,i),this.$element.addClass("oo-ui-popupTool").append(this.popup.$element)},t.inheritClass(t.ui.PopupTool,t.ui.Tool),t.mixinClass(t.ui.PopupTool,t.ui.mixin.PopupElement),t.ui.PopupTool.prototype.onSelect=function(){return this.isDisabled()||this.popup.toggle(),this.setActive(!1),!1},t.ui.PopupTool.prototype.onUpdateState=function(){this.setActive(!1)},t.ui.ToolGroupTool=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolGroup),t.ui.ToolGroupTool.parent.call(this,e,i),this.innerToolGroup=this.createGroup(this.constructor.static.groupConfig),this.innerToolGroup.connect(this,{disable:"onToolGroupDisable"}),this.$link.remove(),this.$element.addClass("oo-ui-toolGroupTool").append(this.innerToolGroup.$element)},t.inheritClass(t.ui.ToolGroupTool,t.ui.Tool),t.ui.ToolGroupTool.static.groupConfig={},t.ui.ToolGroupTool.prototype.onSelect=function(){return this.innerToolGroup.setActive(!this.innerToolGroup.active),!1},t.ui.ToolGroupTool.prototype.onToolGroupDisable=function(t){this.setDisabled(t)},t.ui.ToolGroupTool.prototype.onUpdateState=function(){this.setActive(!1)},t.ui.ToolGroupTool.prototype.createGroup=function(e){return"*"===e.include&&void 0===e.label&&(e.label=t.ui.msg("ooui-toolbar-more")),this.toolbar.getToolGroupFactory().create("list",this.toolbar,e)},t.ui.BarToolGroup=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolbar),t.ui.BarToolGroup.parent.call(this,e,i),this.$element.addClass("oo-ui-barToolGroup")},t.inheritClass(t.ui.BarToolGroup,t.ui.ToolGroup),t.ui.BarToolGroup.static.titleTooltips=!0,t.ui.BarToolGroup.static.accelTooltips=!0,t.ui.BarToolGroup.static.name="bar",t.ui.PopupToolGroup=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolbar),i=$.extend({indicator:"bottom"===e.position?"up":"down"},i),t.ui.PopupToolGroup.parent.call(this,e,i),this.active=!1,this.dragging=!1,this.onBlurHandler=this.onBlur.bind(this),this.$handle=$("<span>"),t.ui.mixin.IconElement.call(this,i),t.ui.mixin.IndicatorElement.call(this,i),t.ui.mixin.LabelElement.call(this,i),t.ui.mixin.TitledElement.call(this,i),t.ui.mixin.ClippableElement.call(this,$.extend({},i,{$clippable:this.$group})),t.ui.mixin.TabIndexedElement.call(this,$.extend({},i,{$tabIndexed:this.$handle})),this.$handle.on({keydown:this.onHandleMouseKeyDown.bind(this),keyup:this.onHandleMouseKeyUp.bind(this),mousedown:this.onHandleMouseKeyDown.bind(this),mouseup:this.onHandleMouseKeyUp.bind(this)}),this.$handle.addClass("oo-ui-popupToolGroup-handle").append(this.$icon,this.$label,this.$indicator),void 0!==i.header&&this.$group.prepend($("<span>").addClass("oo-ui-popupToolGroup-header").text(i.header)),this.$element.addClass("oo-ui-popupToolGroup").prepend(this.$handle)},t.inheritClass(t.ui.PopupToolGroup,t.ui.ToolGroup),t.mixinClass(t.ui.PopupToolGroup,t.ui.mixin.IconElement),t.mixinClass(t.ui.PopupToolGroup,t.ui.mixin.IndicatorElement),t.mixinClass(t.ui.PopupToolGroup,t.ui.mixin.LabelElement),t.mixinClass(t.ui.PopupToolGroup,t.ui.mixin.TitledElement),t.mixinClass(t.ui.PopupToolGroup,t.ui.mixin.ClippableElement),t.mixinClass(t.ui.PopupToolGroup,t.ui.mixin.TabIndexedElement),t.ui.PopupToolGroup.prototype.setDisabled=function(){t.ui.PopupToolGroup.parent.prototype.setDisabled.apply(this,arguments),this.isDisabled()&&this.isElementAttached()&&this.setActive(!1)},t.ui.PopupToolGroup.prototype.onBlur=function(t){$(t.target).closest(".oo-ui-popupToolGroup")[0]!==this.$element[0]&&this.setActive(!1)},t.ui.PopupToolGroup.prototype.onMouseKeyUp=function(e){return this.isDisabled()||!this.pressed||this.pressed!==this.getTargetTool(e)||e.which!==t.ui.MouseButtons.LEFT&&e.which!==t.ui.Keys.SPACE&&e.which!==t.ui.Keys.ENTER||this.setActive(!1),t.ui.PopupToolGroup.parent.prototype.onMouseKeyUp.call(this,e)},t.ui.PopupToolGroup.prototype.onHandleMouseKeyUp=function(e){if(!this.isDisabled()&&(e.which===t.ui.MouseButtons.LEFT||e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return!1},t.ui.PopupToolGroup.prototype.onHandleMouseKeyDown=function(e){if(!this.isDisabled()&&(e.which===t.ui.MouseButtons.LEFT||e.which===t.ui.Keys.SPACE||e.which===t.ui.Keys.ENTER))return this.setActive(!this.active),!1},t.ui.PopupToolGroup.prototype.setActive=function(t){var e,i;t=!!t,this.active!==t&&(this.active=t,t?(this.getElementDocument().addEventListener("mouseup",this.onBlurHandler,!0),this.getElementDocument().addEventListener("keyup",this.onBlurHandler,!0),this.$clippable.css("left",""),this.$element.addClass("oo-ui-popupToolGroup-active oo-ui-popupToolGroup-left"),this.toggleClipping(!0),this.isClippedHorizontally()&&(this.toggleClipping(!1),this.$element.removeClass("oo-ui-popupToolGroup-left").addClass("oo-ui-popupToolGroup-right"),this.toggleClipping(!0)),this.isClippedHorizontally()&&(e=this.$clippableScrollableContainer.width(),i=this.$clippableScrollableContainer.offset().left,this.toggleClipping(!1),this.$element.removeClass("oo-ui-popupToolGroup-right"),this.$clippable.css({left:-(this.$element.offset().left-i),width:e}))):(this.getElementDocument().removeEventListener("mouseup",this.onBlurHandler,!0),this.getElementDocument().removeEventListener("keyup",this.onBlurHandler,!0),this.$element.removeClass("oo-ui-popupToolGroup-active oo-ui-popupToolGroup-left  oo-ui-popupToolGroup-right"),this.toggleClipping(!1)))},t.ui.ListToolGroup=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolbar),i=i||{},this.allowCollapse=i.allowCollapse,this.forceExpand=i.forceExpand,this.expanded=void 0!==i.expanded&&i.expanded,this.collapsibleTools=[],t.ui.ListToolGroup.parent.call(this,e,i),this.$element.addClass("oo-ui-listToolGroup")},t.inheritClass(t.ui.ListToolGroup,t.ui.PopupToolGroup),t.ui.ListToolGroup.static.name="list",t.ui.ListToolGroup.prototype.populate=function(){var e,i,n=[];for(t.ui.ListToolGroup.parent.prototype.populate.call(this),void 0!==this.allowCollapse?n=this.allowCollapse:void 0!==this.forceExpand&&(n=t.simpleArrayDifference(Object.keys(this.tools),this.forceExpand)),this.collapsibleTools=[],e=0,i=n.length;e<i;e++)void 0!==this.tools[n[e]]&&this.collapsibleTools.push(this.tools[n[e]]);this.$group.append(this.getExpandCollapseTool().$element),this.getExpandCollapseTool().toggle(0!==this.collapsibleTools.length),this.updateCollapsibleState()},t.ui.ListToolGroup.prototype.getExpandCollapseTool=function(){var e;return void 0===this.expandCollapseTool&&(e=function(){e.parent.apply(this,arguments)},t.inheritClass(e,t.ui.Tool),e.prototype.onSelect=function(){this.toolGroup.expanded=!this.toolGroup.expanded,this.toolGroup.updateCollapsibleState(),this.setActive(!1)},e.prototype.onUpdateState=function(){},e.static.name="more-fewer",this.expandCollapseTool=new e(this)),this.expandCollapseTool},t.ui.ListToolGroup.prototype.onMouseKeyUp=function(e){return!$(e.target).closest(".oo-ui-tool-name-more-fewer").length||e.which!==t.ui.MouseButtons.LEFT&&e.which!==t.ui.Keys.SPACE&&e.which!==t.ui.Keys.ENTER?t.ui.ListToolGroup.parent.prototype.onMouseKeyUp.call(this,e):t.ui.ListToolGroup.parent.parent.prototype.onMouseKeyUp.call(this,e)},t.ui.ListToolGroup.prototype.updateCollapsibleState=function(){var e,i;for(this.getExpandCollapseTool().setIcon(this.expanded?"collapse":"expand").setTitle(t.ui.msg(this.expanded?"ooui-toolgroup-collapse":"ooui-toolgroup-expand")),e=0,i=this.collapsibleTools.length;e<i;e++)this.collapsibleTools[e].toggle(this.expanded)},t.ui.MenuToolGroup=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.toolbar),i=i||{},t.ui.MenuToolGroup.parent.call(this,e,i),this.toolbar.connect(this,{updateState:"onUpdateState"}),this.$element.addClass("oo-ui-menuToolGroup")},t.inheritClass(t.ui.MenuToolGroup,t.ui.PopupToolGroup),t.ui.MenuToolGroup.static.name="menu",t.ui.MenuToolGroup.prototype.onUpdateState=function(){var t,e=[];for(t in this.tools)this.tools[t].isActive()&&e.push(this.tools[t].getTitle());this.setLabel(e.join(", ")||" ")}}(OO),function(t){"use strict";t.ui.ActionWidget=function(e){e=$.extend({framed:!1},e),t.ui.ActionWidget.parent.call(this,e),t.ui.mixin.PendingElement.call(this,e),this.action=e.action||"",this.modes=e.modes||[],this.width=0,this.height=0,this.$element.addClass("oo-ui-actionWidget")},t.inheritClass(t.ui.ActionWidget,t.ui.ButtonWidget),t.mixinClass(t.ui.ActionWidget,t.ui.mixin.PendingElement),t.ui.ActionWidget.prototype.hasMode=function(t){return this.modes.indexOf(t)!==-1},t.ui.ActionWidget.prototype.getAction=function(){return this.action},t.ui.ActionWidget.prototype.getModes=function(){return this.modes.slice()},t.ui.ActionWidget.prototype.propagateResize=function(){var t,e;return this.isElementAttached()&&(t=this.$element.width(),e=this.$element.height(),t===this.width&&e===this.height||(this.width=t,this.height=e,this.emit("resize"))),this},t.ui.ActionWidget.prototype.setIcon=function(){return t.ui.mixin.IconElement.prototype.setIcon.apply(this,arguments),this.propagateResize(),this},t.ui.ActionWidget.prototype.setLabel=function(){return t.ui.mixin.LabelElement.prototype.setLabel.apply(this,arguments),this.propagateResize(),this},t.ui.ActionWidget.prototype.setFlags=function(){return t.ui.mixin.FlaggedElement.prototype.setFlags.apply(this,arguments),this.propagateResize(),this},t.ui.ActionWidget.prototype.clearFlags=function(){return t.ui.mixin.FlaggedElement.prototype.clearFlags.apply(this,arguments),this.propagateResize(),this},t.ui.ActionWidget.prototype.toggle=function(){return t.ui.ActionWidget.parent.prototype.toggle.apply(this,arguments),this.propagateResize(),this},t.ui.ActionSet=function(e){e=e||{},t.EventEmitter.call(this),this.list=[],this.categories={actions:"getAction",flags:"getFlags",modes:"getModes"},this.categorized={},this.special={},this.others=[],this.organized=!1,this.changing=!1,this.changed=!1},t.mixinClass(t.ui.ActionSet,t.EventEmitter),t.ui.ActionSet.static.specialFlags=["safe","primary"],t.ui.ActionSet.prototype.onActionChange=function(){this.organized=!1,this.changing?this.changed=!0:this.emit("change")},t.ui.ActionSet.prototype.isSpecial=function(t){var e;for(e in this.special)if(t===this.special[e])return!0;return!1},t.ui.ActionSet.prototype.get=function(t){var e,i,n,o,s,l,u,a;if(t){this.organize(),a=[];for(o in this.categorized)if(n=t[o])for(Array.isArray(n)||(n=[n]),e=0,i=n.length;e<i;e++)s=this.categorized[o][n[e]],Array.isArray(s)&&a.push.apply(a,s);for(e=0,i=a.length;e<i;e++)u=a[e],(void 0!==t.visible&&u.isVisible()!==t.visible||void 0!==t.disabled&&u.isDisabled()!==t.disabled)&&(a.splice(e,1),i--,e--);for(e=0,i=a.length;e<i;e++)for(u=a[e],l=a.lastIndexOf(u);l!==e;)a.splice(l,1),i--,l=a.lastIndexOf(u);return a}return this.list.slice()},t.ui.ActionSet.prototype.getSpecial=function(){return this.organize(),$.extend({},this.special)},t.ui.ActionSet.prototype.getOthers=function(){return this.organize(),this.others.slice()},t.ui.ActionSet.prototype.setMode=function(t){var e,i,n;for(this.changing=!0,e=0,i=this.list.length;e<i;e++)n=this.list[e],n.toggle(n.hasMode(t));return this.organized=!1,this.changing=!1,this.emit("change"),this},t.ui.ActionSet.prototype.setAbilities=function(t){var e,i,n,o;for(e=0,i=this.list.length;e<i;e++)o=this.list[e],n=o.getAction(),void 0!==t[n]&&o.setDisabled(!t[n]);return this},t.ui.ActionSet.prototype.forEach=function(t,e){return this.changed=!1,this.changing=!0,this.get(t).forEach(e),this.changing=!1,this.changed&&this.emit("change"),this},t.ui.ActionSet.prototype.add=function(t){var e,i,n;for(this.changing=!0,e=0,i=t.length;e<i;e++)n=t[e],n.connect(this,{click:["emit","click",n],resize:["emit","resize",n],toggle:["onActionChange"]}),this.list.push(n);return this.organized=!1,this.emit("add",t),this.changing=!1,this.emit("change"),this},t.ui.ActionSet.prototype.remove=function(t){var e,i,n,o;for(this.changing=!0,e=0,i=t.length;e<i;e++)o=t[e],n=this.list.indexOf(o),n!==-1&&(o.disconnect(this),this.list.splice(n,1));return this.organized=!1,
this.emit("remove",t),this.changing=!1,this.emit("change"),this},t.ui.ActionSet.prototype.clear=function(){var t,e,i,n=this.list.slice();for(this.changing=!0,t=0,e=this.list.length;t<e;t++)i=this.list[t],i.disconnect(this);return this.list=[],this.organized=!1,this.emit("remove",n),this.changing=!1,this.emit("change"),this},t.ui.ActionSet.prototype.organize=function(){var t,e,i,n,o,s,l,u,a,r,h=this.constructor.static.specialFlags;if(!this.organized){for(this.categorized={},this.special={},this.others=[],t=0,e=this.list.length;t<e;t++)if(s=this.list[t],s.isVisible()){for(l in this.categories)for(this.categorized[l]||(this.categorized[l]={}),u=s[this.categories[l]](),Array.isArray(u)||(u=[u]),i=0,n=u.length;i<n;i++)a=u[i],this.categorized[l][a]||(this.categorized[l][a]=[]),this.categorized[l][a].push(s);for(r=!1,i=0,n=h.length;i<n;i++)if(o=h[i],!this.special[o]&&s.hasFlag(o)){this.special[o]=s,r=!0;break}r||this.others.push(s)}this.organized=!0}return this},t.ui.Error=function(e,i){t.isPlainObject(e)&&void 0===i&&(i=e,e=i.message),i=i||{},this.message=e instanceof jQuery?e:String(e),this.recoverable=void 0===i.recoverable||!!i.recoverable,this.warning=!!i.warning},t.initClass(t.ui.Error),t.ui.Error.prototype.isRecoverable=function(){return this.recoverable},t.ui.Error.prototype.isWarning=function(){return this.warning},t.ui.Error.prototype.getMessage=function(){return this.message instanceof jQuery?this.message.clone():$("<div>").text(this.message).contents()},t.ui.Error.prototype.getMessageText=function(){return this.message instanceof jQuery?this.message.text():this.message},t.ui.Process=function(t,e){this.steps=[],void 0!==t&&this.next(t,e)},t.initClass(t.ui.Process),t.ui.Process.prototype.execute=function(){function e(e){return function(){var i,n=e.callback.call(e.context);if(n===!1)return $.Deferred().reject([]).promise();if("number"==typeof n){if(n<0)throw new Error("Cannot go back in time: flux capacitor is out of service");return i=$.Deferred(),setTimeout(i.resolve,n),i.promise()}return n instanceof t.ui.Error?$.Deferred().reject([n]).promise():Array.isArray(n)&&n.length&&n[0]instanceof t.ui.Error?$.Deferred().reject(n).promise():n&&$.isFunction(n.promise)?n.promise():$.Deferred().resolve().promise()}}var i,n,o;if(this.steps.length)for(o=e(this.steps[0])(),i=1,n=this.steps.length;i<n;i++)o=o.then(e(this.steps[i]));else o=$.Deferred().resolve().promise();return o},t.ui.Process.prototype.createStep=function(t,e){if("number"==typeof t||$.isFunction(t.promise))return{callback:function(){return t},context:null};if($.isFunction(t))return{callback:t,context:e};throw new Error("Cannot create process step: number, promise or function expected")},t.ui.Process.prototype.first=function(t,e){return this.steps.unshift(this.createStep(t,e)),this},t.ui.Process.prototype.next=function(t,e){return this.steps.push(this.createStep(t,e)),this},t.ui.WindowManager=function(e){e=e||{},t.ui.WindowManager.parent.call(this,e),t.EventEmitter.call(this),this.factory=e.factory,this.modal=void 0===e.modal||!!e.modal,this.windows={},this.opening=null,this.opened=null,this.closing=null,this.preparingToOpen=null,this.preparingToClose=null,this.currentWindow=null,this.globalEvents=!1,this.$returnFocusTo=null,this.$ariaHidden=null,this.onWindowResizeTimeout=null,this.onWindowResizeHandler=this.onWindowResize.bind(this),this.afterWindowResizeHandler=this.afterWindowResize.bind(this),this.$element.addClass("oo-ui-windowManager").toggleClass("oo-ui-windowManager-modal",this.modal)},t.inheritClass(t.ui.WindowManager,t.ui.Element),t.mixinClass(t.ui.WindowManager,t.EventEmitter),t.ui.WindowManager.static.sizes={small:{width:300},medium:{width:500},large:{width:700},larger:{width:900},full:{width:"100%",height:"100%"}},t.ui.WindowManager.static.defaultSize="medium",t.ui.WindowManager.prototype.onWindowResize=function(){clearTimeout(this.onWindowResizeTimeout),this.onWindowResizeTimeout=setTimeout(this.afterWindowResizeHandler,200)},t.ui.WindowManager.prototype.afterWindowResize=function(){this.currentWindow&&this.updateWindowSize(this.currentWindow)},t.ui.WindowManager.prototype.isOpening=function(t){return t===this.currentWindow&&!!this.opening&&"pending"===this.opening.state()},t.ui.WindowManager.prototype.isClosing=function(t){return t===this.currentWindow&&!!this.closing&&"pending"===this.closing.state()},t.ui.WindowManager.prototype.isOpened=function(t){return t===this.currentWindow&&!!this.opened&&"pending"===this.opened.state()},t.ui.WindowManager.prototype.hasWindow=function(t){var e;for(e in this.windows)if(this.windows[e]===t)return!0;return!1},t.ui.WindowManager.prototype.getSetupDelay=function(){return 0},t.ui.WindowManager.prototype.getReadyDelay=function(){return 0},t.ui.WindowManager.prototype.getHoldDelay=function(){return 0},t.ui.WindowManager.prototype.getTeardownDelay=function(){return this.modal?250:0},t.ui.WindowManager.prototype.getWindow=function(e){var i=$.Deferred(),n=this.windows[e];return n instanceof t.ui.Window?i.resolve(n):this.factory?this.factory.lookup(e)?(n=this.factory.create(e),this.addWindows([n]),i.resolve(n)):i.reject(new t.ui.Error("Cannot auto-instantiate window: symbolic name is unrecognized by the factory")):i.reject(new t.ui.Error("Cannot get unmanaged window: symbolic name unrecognized as a managed window")),i.promise()},t.ui.WindowManager.prototype.getCurrentWindow=function(){return this.currentWindow},t.ui.WindowManager.prototype.openWindow=function(e,i){var n=this,o=$.Deferred();return i=i||{},"string"==typeof e?this.getWindow(e).then(function(t){return n.openWindow(t,i)}):(this.hasWindow(e)?(this.preparingToOpen||this.opening||this.opened)&&o.reject(new t.ui.Error("Cannot open window: another window is opening or open")):o.reject(new t.ui.Error("Cannot open window: window is not attached to manager")),"rejected"!==o.state()&&(this.preparingToOpen=$.when(this.closing),this.preparingToOpen.done(function(){n.modal&&(n.toggleGlobalEvents(!0),n.toggleAriaIsolation(!0)),n.$returnFocusTo=i.$returnFocusTo||$(document.activeElement),n.currentWindow=e,n.opening=o,n.preparingToOpen=null,n.emit("opening",e,o,i),setTimeout(function(){e.setup(i).then(function(){n.updateWindowSize(e),n.opening.notify({state:"setup"}),setTimeout(function(){e.ready(i).then(function(){n.opening.notify({state:"ready"}),n.opening=null,n.opened=$.Deferred(),o.resolve(n.opened.promise(),i)},function(){n.opening=null,n.opened=$.Deferred(),o.reject(),n.closeWindow(e)})},n.getReadyDelay())},function(){n.opening=null,n.opened=$.Deferred(),o.reject(),n.closeWindow(e)})},n.getSetupDelay())})),o.promise())},t.ui.WindowManager.prototype.closeWindow=function(e,i){var n,o=this,s=$.Deferred();return"string"==typeof e?e=this.windows[e]:this.hasWindow(e)||(e=null),e?e!==this.currentWindow?s.reject(new t.ui.Error("Cannot close window: window already closed with different data")):(this.preparingToClose||this.closing)&&s.reject(new t.ui.Error("Cannot close window: window already closing with different data")):s.reject(new t.ui.Error("Cannot close window: window is not attached to manager")),"rejected"!==s.state()&&(this.preparingToClose=$.when(this.opening),this.preparingToClose.always(function(){o.closing=s,o.preparingToClose=null,o.emit("closing",e,s,i),n=o.opened,o.opened=null,n.resolve(s.promise(),i),setTimeout(function(){e.hold(i).then(function(){s.notify({state:"hold"}),setTimeout(function(){e.teardown(i).then(function(){s.notify({state:"teardown"}),o.modal&&(o.toggleGlobalEvents(!1),o.toggleAriaIsolation(!1)),o.$returnFocusTo&&o.$returnFocusTo.length&&o.$returnFocusTo[0].focus(),o.closing=null,o.currentWindow=null,s.resolve(i)})},o.getTeardownDelay())})},o.getHoldDelay())})),s.promise()},t.ui.WindowManager.prototype.addWindows=function(e){var i,n,o,s,l;if(Array.isArray(e))for(l={},i=0,n=e.length;i<n;i++){if(s=e[i].constructor.static.name,!s)throw new Error("Windows must have a `name` static property defined.");l[s]=e[i]}else t.isPlainObject(e)&&(l=e);for(s in l)o=l[s],this.windows[s]=o.toggle(!1),this.$element.append(o.$element),o.setManager(this)},t.ui.WindowManager.prototype.removeWindows=function(t){var e,i,n,o,s,l=this,u=[],a=function(t,e){delete l.windows[t],e.$element.detach()};for(e=0,i=t.length;e<i;e++){if(o=t[e],n=this.windows[o],!n)throw new Error("Cannot remove window");s=a.bind(null,o,n),u.push(this.closeWindow(o).then(s,s))}return $.when.apply($,u)},t.ui.WindowManager.prototype.clearWindows=function(){return this.removeWindows(Object.keys(this.windows))},t.ui.WindowManager.prototype.updateWindowSize=function(t){var e;if(t===this.currentWindow)return e="full"===t.getSize(),this.$element.toggleClass("oo-ui-windowManager-fullscreen",e),this.$element.toggleClass("oo-ui-windowManager-floating",!e),t.setDimensions(t.getSizeProperties()),this.emit("resize",t),this},t.ui.WindowManager.prototype.toggleGlobalEvents=function(t){var e,i,n=$(this.getElementDocument().body),o=n.data("windowManagerGlobalEvents")||0;return t=void 0===t?!!this.globalEvents:!!t,t?this.globalEvents||($(this.getElementWindow()).on({"orientationchange resize":this.onWindowResizeHandler}),0===o&&(e=window.innerWidth-document.documentElement.clientWidth,i=parseFloat(n.css("margin-right"))||0,n.css({overflow:"hidden","margin-right":i+e})),o++,this.globalEvents=!0):this.globalEvents&&($(this.getElementWindow()).off({"orientationchange resize":this.onWindowResizeHandler}),o--,0===o&&n.css({overflow:"","margin-right":""}),this.globalEvents=!1),n.data("windowManagerGlobalEvents",o),this},t.ui.WindowManager.prototype.toggleAriaIsolation=function(t){return t=void 0===t?!this.$ariaHidden:!!t,t?this.$ariaHidden||(this.$ariaHidden=$("body").children().not(this.$element.parentsUntil("body").last()).attr("aria-hidden","")):this.$ariaHidden&&(this.$ariaHidden.removeAttr("aria-hidden"),this.$ariaHidden=null),this},t.ui.WindowManager.prototype.destroy=function(){this.toggleGlobalEvents(!1),this.toggleAriaIsolation(!1),this.clearWindows(),this.$element.remove()},t.ui.Window=function(e){e=e||{},t.ui.Window.parent.call(this,e),t.EventEmitter.call(this),this.manager=null,this.size=e.size||this.constructor.static.size,this.$frame=$("<div>"),this.$overlay=$("<div>"),this.$content=$("<div>"),this.$focusTrapBefore=$("<div>").prop("tabIndex",0),this.$focusTrapAfter=$("<div>").prop("tabIndex",0),this.$focusTraps=this.$focusTrapBefore.add(this.$focusTrapAfter),this.$overlay.addClass("oo-ui-window-overlay"),this.$content.addClass("oo-ui-window-content").attr("tabindex",0),this.$frame.addClass("oo-ui-window-frame").append(this.$focusTrapBefore,this.$content,this.$focusTrapAfter),this.$element.addClass("oo-ui-window").append(this.$frame,this.$overlay),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},t.inheritClass(t.ui.Window,t.ui.Element),t.mixinClass(t.ui.Window,t.EventEmitter),t.ui.Window.static.size="medium",t.ui.Window.prototype.onMouseDown=function(t){if(t.target===this.$element[0])return!1},t.ui.Window.prototype.isInitialized=function(){return!!this.manager},t.ui.Window.prototype.isVisible=function(){return this.visible},t.ui.Window.prototype.isOpening=function(){return this.manager.isOpening(this)},t.ui.Window.prototype.isClosing=function(){return this.manager.isClosing(this)},t.ui.Window.prototype.isOpened=function(){return this.manager.isOpened(this)},t.ui.Window.prototype.getManager=function(){return this.manager},t.ui.Window.prototype.getSize=function(){var e=t.ui.Element.static.getDimensions(this.getElementWindow()),i=this.manager.constructor.static.sizes,n=this.size;return i[n]||(n=this.manager.constructor.static.defaultSize),"full"!==n&&e.rect.right-e.rect.left<i[n].width&&(n="full"),n},t.ui.Window.prototype.getSizeProperties=function(){return this.manager.constructor.static.sizes[this.getSize()]},t.ui.Window.prototype.withoutSizeTransitions=function(t){var e=this.$frame.css("transition-property")+" "+this.$frame.css("transition-duration")+" "+this.$frame.css("transition-timing-function")+" "+this.$frame.css("transition-delay");this.$frame.css("transition","none"),t(),this.$frame.height(),this.$frame.css("transition",e)},t.ui.Window.prototype.getContentHeight=function(){var t,e=this,i=this.$body[0].style,n=this.$frame[0].style;return this.withoutSizeTransitions(function(){var o=n.height,s=i.position;n.height="1px",i.position="relative",t=e.getBodyHeight(),n.height=o,i.position=s}),this.$frame.outerHeight()-this.$frame.innerHeight()+(this.$head.outerHeight(!0)+t+this.$foot.outerHeight(!0))},t.ui.Window.prototype.getBodyHeight=function(){return this.$body[0].scrollHeight},t.ui.Window.prototype.getDir=function(){return t.ui.Element.static.getDir(this.$content)||"ltr"},t.ui.Window.prototype.getSetupProcess=function(){return new t.ui.Process},t.ui.Window.prototype.getReadyProcess=function(){return new t.ui.Process},t.ui.Window.prototype.getHoldProcess=function(){return new t.ui.Process},t.ui.Window.prototype.getTeardownProcess=function(){return new t.ui.Process},t.ui.Window.prototype.setManager=function(t){if(this.manager)throw new Error("Cannot set window manager, window already has a manager");return this.manager=t,this.initialize(),this},t.ui.Window.prototype.setSize=function(t){return this.size=t,this.updateSize(),this},t.ui.Window.prototype.updateSize=function(){if(!this.manager)throw new Error("Cannot update window size, must be attached to a manager");return this.manager.updateWindowSize(this),this},t.ui.Window.prototype.setDimensions=function(t){var e,i=this,n=this.$frame[0].style;return void 0===t.height?this.withoutSizeTransitions(function(){var o=n.width;i.$frame.css("width",t.width||""),e=i.getContentHeight(),n.width=o}):e=t.height,this.$frame.css({width:t.width||"",minWidth:t.minWidth||"",maxWidth:t.maxWidth||"",height:e||"",minHeight:t.minHeight||"",maxHeight:t.maxHeight||""}),this},t.ui.Window.prototype.initialize=function(){if(!this.manager)throw new Error("Cannot initialize window, must be attached to a manager");return this.$head=$("<div>"),this.$body=$("<div>"),this.$foot=$("<div>"),this.$document=$(this.getElementDocument()),this.$element.on("mousedown",this.onMouseDown.bind(this)),this.$head.addClass("oo-ui-window-head"),this.$body.addClass("oo-ui-window-body"),this.$foot.addClass("oo-ui-window-foot"),this.$content.append(this.$head,this.$body,this.$foot),this},t.ui.Window.prototype.onFocusTrapFocused=function(e){var i=this.$focusTrapBefore.is(e.target),n=t.ui.findFocusable(this.$content,i);n?n.focus():this.$content.focus()},t.ui.Window.prototype.open=function(t){if(!this.manager)throw new Error("Cannot open window, must be attached to a manager");return this.manager.openWindow(this,t)},t.ui.Window.prototype.close=function(t){if(!this.manager)throw new Error("Cannot close window, must be attached to a manager");return this.manager.closeWindow(this,t)},t.ui.Window.prototype.setup=function(e){var i=this;return this.toggle(!0),this.focusTrapHandler=t.ui.bind(this.onFocusTrapFocused,this),this.$focusTraps.on("focus",this.focusTrapHandler),this.getSetupProcess(e).execute().then(function(){i.$element.addClass("oo-ui-window-active oo-ui-window-setup").width(),i.$content.addClass("oo-ui-window-content-setup").width()})},t.ui.Window.prototype.ready=function(t){var e=this;return this.$content.focus(),this.getReadyProcess(t).execute().then(function(){e.$element.addClass("oo-ui-window-ready").width(),e.$content.addClass("oo-ui-window-content-ready").width()})},t.ui.Window.prototype.hold=function(e){var i=this;return this.getHoldProcess(e).execute().then(function(){var e=i.$content.find(t.ui.Element.static.getDocument(i.$content).activeElement);e.length&&e[0].blur(),i.$element.removeClass("oo-ui-window-ready").width(),i.$content.removeClass("oo-ui-window-content-ready").width()})},t.ui.Window.prototype.teardown=function(t){var e=this;return this.getTeardownProcess(t).execute().then(function(){e.$element.removeClass("oo-ui-window-active oo-ui-window-setup").width(),e.$content.removeClass("oo-ui-window-content-setup").width(),e.$focusTraps.off("focus",e.focusTrapHandler),e.toggle(!1)})},t.ui.Dialog=function(e){t.ui.Dialog.parent.call(this,e),t.ui.mixin.PendingElement.call(this),this.actions=new t.ui.ActionSet,this.attachedActions=[],this.currentAction=null,this.onDialogKeyDownHandler=this.onDialogKeyDown.bind(this),this.actions.connect(this,{click:"onActionClick",change:"onActionsChange"}),this.$element.addClass("oo-ui-dialog").attr("role","dialog")},t.inheritClass(t.ui.Dialog,t.ui.Window),t.mixinClass(t.ui.Dialog,t.ui.mixin.PendingElement),t.ui.Dialog.static.name="",t.ui.Dialog.static.title="",t.ui.Dialog.static.actions=[],t.ui.Dialog.static.escapable=!0,t.ui.Dialog.prototype.onDialogKeyDown=function(e){var i;e.which===t.ui.Keys.ESCAPE&&this.constructor.static.escapable?(this.executeAction(""),e.preventDefault(),e.stopPropagation()):e.which===t.ui.Keys.ENTER&&(e.ctrlKey||e.metaKey)&&(i=this.actions.get({flags:"primary",visible:!0,disabled:!1}),i.length>0&&(this.executeAction(i[0].getAction()),e.preventDefault(),e.stopPropagation()))},t.ui.Dialog.prototype.onActionClick=function(t){this.isPending()||this.executeAction(t.getAction())},t.ui.Dialog.prototype.onActionsChange=function(){this.detachActions(),this.isClosing()||this.attachActions()},t.ui.Dialog.prototype.getActions=function(){return this.actions},t.ui.Dialog.prototype.getActionProcess=function(e){return(new t.ui.Process).next(function(){e||this.close()},this)},t.ui.Dialog.prototype.getSetupProcess=function(e){return e=e||{},t.ui.Dialog.parent.prototype.getSetupProcess.call(this,e).next(function(){var t=this.constructor.static,i=void 0!==e.actions?e.actions:t.actions,n=void 0!==e.title?e.title:t.title;this.title.setLabel(n).setTitle(n),this.actions.add(this.getActionWidgets(i)),this.$element.on("keydown",this.onDialogKeyDownHandler)},this)},t.ui.Dialog.prototype.getTeardownProcess=function(e){return t.ui.Dialog.parent.prototype.getTeardownProcess.call(this,e).first(function(){this.$element.off("keydown",this.onDialogKeyDownHandler),this.actions.clear(),this.currentAction=null},this)},t.ui.Dialog.prototype.initialize=function(){var e;t.ui.Dialog.parent.prototype.initialize.call(this),e=t.ui.generateElementId(),this.title=new t.ui.LabelWidget({id:e}),this.$content.addClass("oo-ui-dialog-content"),this.$element.attr("aria-labelledby",e),this.setPendingElement(this.$head)},t.ui.Dialog.prototype.getActionWidgets=function(e){var i,n,o=[];for(i=0,n=e.length;i<n;i++)o.push(new t.ui.ActionWidget(e[i]));return o},t.ui.Dialog.prototype.attachActions=function(){this.attachedActions=this.actions.get()},t.ui.Dialog.prototype.detachActions=function(){var t,e;for(t=0,e=this.attachedActions.length;t<e;t++)this.attachedActions[t].$element.detach();this.attachedActions=[]},t.ui.Dialog.prototype.executeAction=function(t){return this.pushPending(),this.currentAction=t,this.getActionProcess(t).execute().always(this.popPending.bind(this))},t.ui.MessageDialog=function(e){t.ui.MessageDialog.parent.call(this,e),this.verticalActionLayout=null,this.$element.addClass("oo-ui-messageDialog")},t.inheritClass(t.ui.MessageDialog,t.ui.Dialog),t.ui.MessageDialog.static.name="message",t.ui.MessageDialog.static.size="small",t.ui.MessageDialog.static.verbose=!0,t.ui.MessageDialog.static.title=null,t.ui.MessageDialog.static.message=null,t.ui.MessageDialog.static.actions=[{action:"accept",label:t.ui.deferMsg("ooui-dialog-message-accept"),flags:"primary"},{action:"reject",label:t.ui.deferMsg("ooui-dialog-message-reject"),flags:"safe"}],t.ui.MessageDialog.prototype.setManager=function(e){return t.ui.MessageDialog.parent.prototype.setManager.call(this,e),this.manager.connect(this,{resize:"onResize"}),this},t.ui.MessageDialog.prototype.onResize=function(){var t=this;t.fitActions(),setTimeout(function(){t.fitActions()},300)},t.ui.MessageDialog.prototype.toggleVerticalActionLayout=function(t){return t=void 0===t?!this.verticalActionLayout:!!t,t!==this.verticalActionLayout&&(this.verticalActionLayout=t,this.$actions.toggleClass("oo-ui-messageDialog-actions-vertical",t).toggleClass("oo-ui-messageDialog-actions-horizontal",!t)),this},t.ui.MessageDialog.prototype.getActionProcess=function(e){return e?new t.ui.Process(function(){this.close({action:e})},this):t.ui.MessageDialog.parent.prototype.getActionProcess.call(this,e)},t.ui.MessageDialog.prototype.getSetupProcess=function(e){return e=e||{},t.ui.MessageDialog.parent.prototype.getSetupProcess.call(this,e).next(function(){this.title.setLabel(void 0!==e.title?e.title:this.constructor.static.title),this.message.setLabel(void 0!==e.message?e.message:this.constructor.static.message),this.message.$element.toggleClass("oo-ui-messageDialog-message-verbose",void 0!==e.verbose?e.verbose:this.constructor.static.verbose)},this)},t.ui.MessageDialog.prototype.getReadyProcess=function(e){return e=e||{},t.ui.MessageDialog.parent.prototype.getReadyProcess.call(this,e).next(function(){var t=this.actions.get();t=t.filter(function(t){return t.getFlags().indexOf("primary")>-1}),t.length>0&&t[0].$button.focus()},this)},t.ui.MessageDialog.prototype.getBodyHeight=function(){var e,i,n=this.container.$element;return i=n[0].style.overflow,n[0].style.overflow="hidden",t.ui.Element.static.reconsiderScrollbars(n[0]),e=this.text.$element.outerHeight(!0),n[0].style.overflow=i,e},t.ui.MessageDialog.prototype.setDimensions=function(e){var i=this.container.$element;return t.ui.MessageDialog.parent.prototype.setDimensions.call(this,e),setTimeout(function(){var e=i[0].style.overflow,n=document.activeElement;i[0].style.overflow="hidden",t.ui.Element.static.reconsiderScrollbars(i[0]),n&&n!==document.activeElement&&n.focus&&n.focus(),i[0].style.overflow=e},300),this},t.ui.MessageDialog.prototype.initialize=function(){t.ui.MessageDialog.parent.prototype.initialize.call(this),this.$actions=$("<div>"),this.container=new t.ui.PanelLayout({scrollable:!0,classes:["oo-ui-messageDialog-container"]}),this.text=new t.ui.PanelLayout({padded:!0,expanded:!1,classes:["oo-ui-messageDialog-text"]}),this.message=new t.ui.LabelWidget({classes:["oo-ui-messageDialog-message"]}),this.title.$element.addClass("oo-ui-messageDialog-title"),this.$content.addClass("oo-ui-messageDialog-content"),this.container.$element.append(this.text.$element),this.text.$element.append(this.title.$element,this.message.$element),this.$body.append(this.container.$element),this.$actions.addClass("oo-ui-messageDialog-actions"),this.$foot.append(this.$actions)},t.ui.MessageDialog.prototype.attachActions=function(){var e,i,n,o,s;if(t.ui.MessageDialog.parent.prototype.attachActions.call(this),o=this.actions.getSpecial(),s=this.actions.getOthers(),o.safe&&(this.$actions.append(o.safe.$element),o.safe.toggleFramed(!1)),s.length)for(e=0,i=s.length;e<i;e++)n=s[e],this.$actions.append(n.$element),n.toggleFramed(!1);o.primary&&(this.$actions.append(o.primary.$element),o.primary.toggleFramed(!1)),this.isOpening()||this.updateSize()},t.ui.MessageDialog.prototype.fitActions=function(){var t,e,i,n=this.verticalActionLayout,o=this.actions.get();for(this.toggleVerticalActionLayout(!1),t=0,e=o.length;t<e;t++)if(i=o[t],i.$element.innerWidth()<i.$label.outerWidth(!0)){this.toggleVerticalActionLayout(!0);break}this.$body.css("bottom",this.$foot.outerHeight(!0)),this.verticalActionLayout!==n&&this.updateSize()},t.ui.ProcessDialog=function(e){t.ui.ProcessDialog.parent.call(this,e),this.fitOnOpen=!1,this.$element.addClass("oo-ui-processDialog")},t.inheritClass(t.ui.ProcessDialog,t.ui.Dialog),t.ui.ProcessDialog.prototype.onDismissErrorButtonClick=function(){this.hideErrors()},t.ui.ProcessDialog.prototype.onRetryButtonClick=function(){this.hideErrors(),this.executeAction(this.currentAction)},t.ui.ProcessDialog.prototype.initialize=function(){t.ui.ProcessDialog.parent.prototype.initialize.call(this),this.$navigation=$("<div>"),this.$location=$("<div>"),this.$safeActions=$("<div>"),this.$primaryActions=$("<div>"),this.$otherActions=$("<div>"),this.dismissButton=new t.ui.ButtonWidget({label:t.ui.msg("ooui-dialog-process-dismiss")}),this.retryButton=new t.ui.ButtonWidget,this.$errors=$("<div>"),this.$errorsTitle=$("<div>"),this.dismissButton.connect(this,{click:"onDismissErrorButtonClick"}),this.retryButton.connect(this,{click:"onRetryButtonClick"}),this.title.$element.addClass("oo-ui-processDialog-title"),this.$location.append(this.title.$element).addClass("oo-ui-processDialog-location"),this.$safeActions.addClass("oo-ui-processDialog-actions-safe"),this.$primaryActions.addClass("oo-ui-processDialog-actions-primary"),this.$otherActions.addClass("oo-ui-processDialog-actions-other"),this.$errorsTitle.addClass("oo-ui-processDialog-errors-title").text(t.ui.msg("ooui-dialog-process-error")),this.$errors.addClass("oo-ui-processDialog-errors oo-ui-element-hidden").append(this.$errorsTitle,this.dismissButton.$element,this.retryButton.$element),this.$content.addClass("oo-ui-processDialog-content").append(this.$errors),this.$navigation.addClass("oo-ui-processDialog-navigation").append(this.$primaryActions,this.$location,this.$safeActions),this.$head.append(this.$navigation),this.$foot.append(this.$otherActions)},t.ui.ProcessDialog.prototype.getActionWidgets=function(e){var i,n,o,s=t.ui.isMobile(),l=[];for(i=0,n=e.length;i<n;i++)o=$.extend({framed:!t.ui.isMobile()},e[i]),s&&("back"===o.flags||Array.isArray(o.flags)&&o.flags.indexOf("back")!==-1)&&$.extend(o,{icon:"previous",label:""}),l.push(new t.ui.ActionWidget(o));return l},t.ui.ProcessDialog.prototype.attachActions=function(){var e,i,n,o,s;for(t.ui.ProcessDialog.parent.prototype.attachActions.call(this),o=this.actions.getSpecial(),s=this.actions.getOthers(),o.primary&&this.$primaryActions.append(o.primary.$element),e=0,i=s.length;e<i;e++)n=s[e],this.$otherActions.append(n.$element);o.safe&&this.$safeActions.append(o.safe.$element),this.fitLabel(),this.$body.css("bottom",this.$foot.outerHeight(!0))},t.ui.ProcessDialog.prototype.executeAction=function(e){var i=this;return t.ui.ProcessDialog.parent.prototype.executeAction.call(this,e).fail(function(t){i.showErrors(t||[])})},t.ui.ProcessDialog.prototype.setDimensions=function(){t.ui.ProcessDialog.parent.prototype.setDimensions.apply(this,arguments),this.fitLabel()},t.ui.ProcessDialog.prototype.fitLabel=function(){var t,e,i,n,o,s,l,u=this.getSizeProperties();if("number"!=typeof u.width){if(!this.isOpened())return this.isOpening()?void(this.fitOnOpen||(this.manager.opening.done(this.fitLabel.bind(this)),this.fitOnOpen=!0)):void 0;o=this.$head.width()-20}else o=u.width-20;return t=this.$safeActions.is(":visible")?this.$safeActions.width():0,e=this.$primaryActions.is(":visible")?this.$primaryActions.width():0,i=Math.max(t,e),n=this.title.$element.width(),2*i+n<o?s=l=i:"ltr"===this.getDir()?(s=t,l=e):(s=e,l=t),this.$location.css({paddingLeft:s,paddingRight:l}),this},t.ui.ProcessDialog.prototype.showErrors=function(e){var i,n,o,s,l=[],u={},a=!0,r=!1;for(e instanceof t.ui.Error&&(e=[e]),i=0,n=e.length;i<n;i++)e[i].isRecoverable()||(a=!1),e[i].isWarning()&&(r=!0),o=$("<div>").addClass("oo-ui-processDialog-error").append(e[i].getMessage()),l.push(o[0]);this.$errorItems=$(l),a?(u[this.currentAction]=!0,s=this.actions.get({actions:this.currentAction}),s.length&&this.retryButton.clearFlags().setFlags(s[0].getFlags())):(u[this.currentAction]=!1,this.actions.setAbilities(u)),r?this.retryButton.setLabel(t.ui.msg("ooui-dialog-process-continue")):this.retryButton.setLabel(t.ui.msg("ooui-dialog-process-retry")),this.retryButton.toggle(a),this.$errorsTitle.after(this.$errorItems),this.$errors.removeClass("oo-ui-element-hidden").scrollTop(0)},t.ui.ProcessDialog.prototype.hideErrors=function(){this.$errors.addClass("oo-ui-element-hidden"),this.$errorItems&&(this.$errorItems.remove(),this.$errorItems=null)},t.ui.ProcessDialog.prototype.getTeardownProcess=function(e){return t.ui.ProcessDialog.parent.prototype.getTeardownProcess.call(this,e).first(function(){this.hideErrors(),this.fitOnOpen=!1},this)},t.ui.getWindowManager=function(){return t.ui.windowManager||(t.ui.windowManager=new t.ui.WindowManager,$("body").append(t.ui.windowManager.$element),t.ui.windowManager.addWindows([new t.ui.MessageDialog])),t.ui.windowManager},t.ui.alert=function(e,i){return t.ui.getWindowManager().openWindow("message",$.extend({message:e,actions:[t.ui.MessageDialog.static.actions[0]]},i)).then(function(t){return t.then(function(t){return t.then(function(){return $.Deferred().resolve()})})})},t.ui.confirm=function(e,i){return t.ui.getWindowManager().openWindow("message",$.extend({message:e},i)).then(function(t){return t.then(function(t){return t.then(function(t){return $.Deferred().resolve(!(!t||"accept"!==t.action))})})})},t.ui.prompt=function(e,i){var n=t.ui.getWindowManager(),o=new t.ui.TextInputWidget(i&&i.textInput||{}),s=new t.ui.FieldLayout(o,{align:"top",label:e});return n.openWindow("message",$.extend({message:s.$element},i)).then(function(t){return o.on("enter",function(){n.getCurrentWindow().close({action:"accept"})}),o.focus(),t.then(function(t){return t.then(function(t){return $.Deferred().resolve(t&&"accept"===t.action?o.getValue():null)})})})}}(OO);
//# sourceMappingURL=oojs-ui.min.js.map