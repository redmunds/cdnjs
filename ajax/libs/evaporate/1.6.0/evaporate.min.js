!function(){"use strict";function e(e){var t=document.createElement("a");return t.href=e||"/",{protocol:t.protocol,hostname:t.hostname,pathname:t.pathname.replace(/(^\/?)/,"/"),port:t.port,search:"?"===t.search[0]?t.search.substr(1):t.search,hash:t.hash,host:t.host}}function t(e){return e?e.toISOString():""}function n(e,t,n){var r=e.slice?"slice":e.mozSlice?"mozSlice":"webkitSlice";return e[r](t,n)}function r(e){var t=new DOMParser,n=t.parseFromString(e.responseText,"text/html"),r=n.getElementsByTagName("Code"),a=n.getElementsByTagName("Message");return r=r&&r.length?r[0].innerHTML||r[0].textContent:"",a=a&&a.length?a[0].innerHTML||a[0].textContent:"",r.length?{code:r,msg:a}:{}}var a=new Date("2060-10-22"),o=function(o){function s(){return{d:function(){},w:function(){},e:function(){}}}function i(e,t){var n=O.length;return O.push(new p(f({started:function(){},progress:function(){},complete:function(){},cancelled:function(){},paused:function(){},resumed:function(){},pausing:function(){},info:function(){},warn:function(){},error:function(){},xAmzHeadersAtInitiate:{},notSignedHeadersAtInitiate:{},xAmzHeadersCommon:null,xAmzHeadersAtUpload:{},xAmzHeadersAtComplete:{}},e,{id:n,status:w,priority:0,onStatusChange:u,loadedBytes:0,sizeBytes:e.file.size,eTag:""}),t)),n}function u(){B.d("onFileUploadStatusChange"),l()}function d(e){var t=e.split("/"),n=[];return t.forEach(function(e){n.push(encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/,"%27"))}),n.join("/")}function l(){B.d("processQueue   length:",O.length);var e=-1,t=-1,n=!0;O.forEach(function(r,a){r.priority>t&&r.status===w&&(e=a,t=r.priority),r.status===S&&(n=!1)}),n&&e>=0&&O[e].start()}function p(o,s){function i(e){R=Math.max(0,R+e),s.evaporateChanged(Oe,R)}function u(e){je.indexOf(e.part)===-1&&(je.push(e.part),i(1))}function d(e){p(je,e)&&i(-1)}function l(e){p(Ue,e.part),d(e.part),0===je.length&&Oe.status===_&&(Oe.status=b,Oe.paused())}function p(e,t){var n=e.indexOf(t);if(n>-1)return e.splice(n,1),!0}function C(e){[x,z,T,P,b].indexOf(e)>-1&&le(),Oe.status=e,Oe.onStatusChange()}function H(){var e=[];je.forEach(function(t){e.push(t)}),e.forEach(function(e){V(e,!0)}),ie()}function O(){B.d("cancelAllRequests()"),K()}function U(e){e&&Z(),de(),s.computeContentMd5&&Oe.file.size>0?J():ee(),se()}function F(e){var t,n={method:"POST",path:_e()+"?uploads",step:"initiate",x_amz_headers:Oe.xAmzHeadersAtInitiate,not_signed_headers:Oe.notSignedHeadersAtInitiate},a=Oe.status;Oe.contentType&&(n.contentType=Oe.contentType),n.onErr=function(o){t||Oe.status===P||Oe.status===T||(t=!0,B.d("onInitiateError for FileUpload ",Oe.id),Oe.warn("Error initiating upload",r(o)),C(z),Ie(n),setTimeout(function(){Oe.status!==P&&Oe.status!==T&&(Oe.status=a,F(e))},oe(De++)))},n.on200=function(t){var r=t.response.match(/<UploadId>(.+)<\/UploadId>/);r&&r[1]?(Oe.uploadId=r[1],Oe.awsKey=e,B.d("requester success. got uploadId ",Oe.uploadId),Z(),U()):n.onErr(t)},pe(n),fe(n),de()}function N(e){var t,a,o,s;s=Re[e],o={method:"PUT",path:_e()+"?partNumber="+e+"&uploadId="+Oe.uploadId,step:"upload #"+e,x_amz_headers:Oe.xAmzHeadersCommon||Oe.xAmzHeadersAtUpload,md5_digest:s.md5_digest,contentSha256:"UNSIGNED-PAYLOAD",attempts:s.attempts,part:s},o.onErr=function(t,n){if(s.loadedBytes=0,s.status=z,!([T,P,b,_].indexOf(Oe.status)>-1))if(404===t.status){l(s);var i="404 error on part PUT. The part and the file will abort.";B.w(i," Server response: ",t.response),Oe.error(i),s.status=P,K()}else{var u="problem uploading part #"+e+",   http status: "+t.status+",   hasErrored: "+!!a+",   part status: "+s.status+",   readyState: "+t.readyState+(n?",   isOnError":"");B.w(u),Oe.warn(u);var p=r(t);if(p.code&&B.e('AWS Server response: code="'+p.code+'", message="'+p.msg+'"'),Ie(o),n||(d(s.part),se()),a)return;a=!0}},o.on200=function(t){var n,r=t.getResponseHeader("ETag");B.d("uploadPart 200 response for part #",e,"ETag:",r),s.isEmpty||r!==M?(s.eTag=r,s.status=x,Be.push(s),Ne+=s.loadedBytes,l(s)):(s.status=z,s.loadedBytes=0,n=["eTag matches MD5 of 0 length blob for part #",e,"Retrying part."].join(" "),B.w(n),Oe.warn(n),d(s.part)),se()},o.onProgress=function(e){s.loadedBytes=e.loaded},o.toSend=function(){var t=n(Oe.file,s.start,s.end);return B.d("part #",e,"( bytes",s.start,"->",s.end,")  reported length:",t.size),s.isEmpty||0!==t.size||B.w("  *** WARN: blob reporting size of 0 bytes. Will try upload anyway.."),t},o.onFailedAuth=function(){var t=["onFailedAuth for uploadPart #",e,"- Will set status to ERROR"].join(" ");B.w(t),Oe.warn(t),s.status=z,s.loadedBytes=0,d(e),se()},t=oe(s.attempts),B.d("uploadPart #",e,"- will wait",t,"ms before",0===s.attempts?"submitting":"retrying"),setTimeout(function(){s.status!==x&&[P,b,T].indexOf(Oe.status)===-1&&je.indexOf(s.part)===-1&&(s.status=S,s.attempts+=1,s.loadedBytesPrevious=null,Fe+=1,pe(o),Ie(o),u(s),fe(o),B.d("upload #",e,o))},t),s.uploader=o}function V(e,t){var n=Re[e];n.currentXhr&&(t&&(n.currentXhr.onreadystatechange=function(){}),n.currentXhr.abort(),n.loadedBytes=0)}function W(){B.d("completeUpload"),Oe.info("will attempt to complete upload"),le();var e,t=[],n=Oe.status;t.push("<CompleteMultipartUpload>"),Re.forEach(function(e,n){n>0&&t.push(["<Part><PartNumber>",n,"</PartNumber><ETag>",e.eTag,"</ETag></Part>"].join(""))}),t.push("</CompleteMultipartUpload>");var a={method:"POST",contentType:"application/xml; charset=UTF-8",path:_e()+"?uploadId="+Oe.uploadId,x_amz_headers:Oe.xAmzHeadersCommon||Oe.xAmzHeadersAtComplete,step:"complete"};a.onErr=function(t){if(!e&&Oe.status!==P&&Oe.status!==T){e=!0;var a="Error completing upload.";B.w(a,r(t)),Oe.error(a),C(z),setTimeout(function(){Oe.status!==P&&Oe.status!==T&&(Oe.status=n,W())},oe(ke++))}},a.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("CompleteMultipartUploadResult")[0];Oe.eTag=v(n,"ETag"),Oe.complete(e,Oe.name),te()},a.toSend=function(){return t.join("")},pe(a),fe(a)}function G(e){B.d("headObject"),Oe.info("will attempt to verify existence of the file");var t={method:"HEAD",path:_e(),x_amz_headers:Oe.xAmzHeadersCommon,step:"head_object"};t.onErr=function(){var t="Error completing headObject. Will re-upload file.";B.w(t),F(e)},t.on200=function(t){var n=t.getResponseHeader("Etag");n===Oe.eTag?(B.d("headObject found matching object on S3."),Oe.progress(1),Oe.complete(t,Oe.name),C(x)):(B.d("headObject not found on S3."),F(e))},pe(t),fe(t)}function X(e){return function(){var t=Oe.status;if(!([z,T,P].indexOf(t)>-1)){var n=s.cryptoMd5Method.call(this,this.result);B.d("part #",e.part,"MD5 digest is",n),e.md5_digest=n,1===e.part&&ee(),delete e.reader,Le+=1,R<s.maxConcurrentParts&&se(),Le===qe&&B.d("All parts have MD5 digests"),setTimeout(J,s.processMd5ThrottlingMs)}}}function J(){for(var e=0;e<Ue.length;e++){var t=Re[Ue[e]];if(null===t.md5_digest){Ue[e]>1||"undefined"==typeof Oe.firstMd5Digest?(t.reader=new FileReader,t.reader.onloadend=X(t),t.reader.readAsArrayBuffer(n(Oe.file,t.start,t.end))):(t.md5_digest=Oe.firstMd5Digest,ee(),setTimeout(J,s.processMd5ThrottlingMs));break}}}function K(){if(B.d("abortUpload"),Oe.info("will attempt to abort the upload"),H(),"undefined"==typeof Oe.uploadId)return void C(P);var e={method:"DELETE",path:_e()+"?uploadId="+Oe.uploadId,x_amz_headers:Oe.xAmzHeadersCommon,step:"abort"};e.onErr=function(){var e="Error aborting upload.";B.w(e),Oe.error(e)},e.on200=function(){C(P),Q()},pe(e),fe(e)}function Q(){B.d("listParts"),Oe.info("list parts");var e={method:"GET",path:_e()+"?uploadId="+Oe.uploadId,x_amz_headers:Oe.xAmzHeadersCommon,step:"list"};e.onErr=function(e){if(404===e.status)ne(),Oe.info("upload canceled"),Ne=0;else{var t="Error listing parts.";B.w(t,r(e)),Oe.error(t)}R=0,s.evaporateChanged(Oe,R)},e.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("Part");n.length?(B.d("Parts still found after abort...waiting."),setTimeout(function(){K()},s.abortCompletionThrottlingMs)):(Ne=0,Oe.info("upload canceled"))},pe(e),fe(e)}function Y(e){var t=["getUploadParts() for uploadId starting at part #",e].join(" ");B.d(t),Oe.info(t);var n={method:"GET",path:_e()+"?uploadId="+Oe.uploadId,query_string:"&part-number-marker="+e,x_amz_headers:Oe.xAmzHeadersCommon,step:"get upload parts"};"4"===s.awsSignatureVersion&&(n.path=[_e(),"?uploadId=",Oe.uploadId,"&part-number-marker="+e].join("")),n.onErr=function(t){if(404===t.status)Oe.info(["uploadId ",Oe.uploadId," does not exist."].join("")),ne(),de(),Z(),se();else{var n="Error listing parts for getUploadParts() starting at part # "+(e+1);B.w(n,r(t)),Oe.error(n)}},n.on200=function(t){Oe.info("uploadId",Oe.uploadId,"is not complete. Fetching parts from part marker",e);for(var n,r,a=c(t.responseText),o=a.getElementsByTagName("ListPartsResult")[0],s="true"===v(o,"IsTruncated"),i=a.getElementsByTagName("Part"),u=i.length,d=0;d<u;d++)n=i[d],r=parseInt(v(n,"Size"),10),Ne+=r,Be.push({eTag:v(n,"ETag"),partNumber:parseInt(v(n,"PartNumber"),10),size:r,LastModified:v(n,"LastModified")});if(s){var l=v(o,"NextPartNumberMarker");Y(l)}else Be.forEach(function(e){var t=$(e.partNumber,x,e.size);t.eTag=e.eTag,t.attempts=1,t.loadedBytes=e.size,t.loadedBytesPrevious=e.size,t.finishedUploadingAt=e.LastModified,Re[e.partNumber]=t}),Z(),de(),U();o=null},pe(n),fe(n)}function Z(){qe=Math.ceil(Oe.file.size/s.partSize)||1;for(var e=1;e<=qe;e++){var t="undefined"==typeof Re[e]?w:Re[e].status;t!==x&&(Re[e]=$(e,w,Oe.file.size),Ue.push(e))}}function $(e,t,n){return{status:t,start:(e-1)*s.partSize,end:e*s.partSize,attempts:0,loadedBytes:0,loadedBytesPrevious:null,isEmpty:0===n,md5_digest:null,part:e}}function ee(){var e=g(Oe),n={awsKey:Oe.name,bucket:s.bucket,uploadId:Oe.uploadId,fileSize:Oe.file.size,fileType:Oe.file.type,lastModifiedDate:t(Oe.file.lastModifiedDate),partSize:s.partSize,signParams:s.signParams,createdAt:(new Date).toISOString()};s.computeContentMd5&&qe&&"undefined"!=typeof Re[1].md5_digest&&(n.firstMd5Digest=Re[1].md5_digest),h(e,n)}function te(){var e=m(),t=e[g(Oe)];"undefined"!=typeof t&&(t.completedAt=(new Date).toISOString(),t.eTag=Oe.eTag,D.setItem("awsUploads",JSON.stringify(e))),C(x),Oe.progress(1)}function ne(){"undefined"!=typeof Oe.file&&y(g(Oe))}function re(){var e=m(!0),t=e[g(Oe)];ae(t)&&(Oe.uploadId=t.uploadId,Oe.name=t.awsKey,Oe.eTag=t.eTag,Oe.firstMd5Digest=t.firstMd5Digest,Oe.signParams=t.signParams)}function ae(e){if("undefined"==typeof e)return!1;var t=new Date(e.completedAt||a);return s.partSize===e.partSize&&t>L&&s.bucket===e.bucket&&(!s.onlyRetryForSameFileName||Oe.name===e.awsKey)}function oe(e){return 1===e?0:1e3*Math.min(s.maxRetryBackoffSecs,Math.pow(s.retryBackoffPower,e-2))}function se(){if(qe===Be.length)return void([x,E].indexOf(Oe.status)===-1&&(Oe.status=E,W()));var e=[],t=[],n=s.maxConcurrentParts-R;if(0!==n){if(Oe.status!==S)return void Oe.info("will not process parts list, as not currently evaporating");for(var r=0;r<Ue.length;r++){var a=Re[Ue[r]];if(s.computeContentMd5&&null===a.md5_digest)return;if(e.push(a.status),a.status===S)t.push(a.loadedBytes);else if(R<s.maxConcurrentParts&&je.indexOf(a.part)===-1&&N(a.part),n-=1,0===n)break}t.length?A===I.offline&&(B.d("processPartsList() Back online."),A=I.online):(B.w("processPartsList() No bytes loaded for any parts. We may be offline."),A===I.online&&(A=I.offline));var o=e.toString()+" // bytesLoaded: "+t.toString();B.d("processPartsList(): ",o),Fe>=qe&&Oe.info("part stati:",o)}}function ie(){clearInterval(Ae),Ae=setInterval(function(){var e=Ne;je.forEach(function(t){e+=Re[t].loadedBytes}),Oe.progress(e/Oe.sizeBytes)},s.progressIntervalMS)}function ue(){clearInterval(He),He=setInterval(function(){B.d("monitorPartsProgress()"),je.forEach(function(e){var t,n=Re[e];return null===n.loadedBytesPrevious?void(n.loadedBytesPrevious=n.loadedBytes):(t=n.loadedBytesPrevious<n.loadedBytes,s.simulateStalling&&4===e&&Math.random()<.25&&(t=!1),B.d(e,t?"moving.":"stalled.",n.loadedBytesPrevious,n.loadedBytes),t||setTimeout(function(){Oe.info("part #"+e," stalled. will abort.",n.loadedBytesPrevious,n.loadedBytes),V(e),n.status=w,d(e),se()},0),void(n.loadedBytesPrevious=n.loadedBytes))})},A)}function de(){ie(),ue()}function le(){clearInterval(Ae),clearInterval(He)}function pe(e){e.getPayload=function(){return e.toSend?e.toSend():null},e.getPayloadSha256Content=function(){var t=e.contentSha256||s.cryptoHexEncodedHash256(e.getPayload()||"");return B.d("getPayloadSha256Content",t),t},B.d("setupRequest()",e);var t=s.timeUrl?new Date((new Date).getTime()+q):new Date;"4"===s.awsSignatureVersion?e.dateString=t.toISOString().slice(0,19).replace(/-|:/g,"")+"Z":e.dateString=t.toUTCString(),e.x_amz_headers=f(e.x_amz_headers,{"x-amz-date":e.dateString}),e.onGotAuth=function(){function t(e){return e.status>=200&&e.status<=299}if(Me(e)){var n=["onGotAuth() step #",e.step,"is already in progress. Returning."].join(" ");return B.d(n),void B.w(n)}var r=Ce(e),a=e.getPayload(),o=k+e.path,i={};e.query_string&&(o+=e.query_string),f(i,e.not_signed_headers),f(i,e.x_amz_headers),s.simulateErrors&&1===e.attempts&&"upload #3"===e.step&&(B.d("simulating error by POST part #3 to invalid url"),o="https:///foo"),r.open(e.method,o),r.setRequestHeader("Authorization",ye(e));for(var u in i)i.hasOwnProperty(u)&&r.setRequestHeader(u,i[u]);"4"===s.awsSignatureVersion&&r.setRequestHeader("x-amz-content-sha256",e.getPayloadSha256Content()),e.contentType&&r.setRequestHeader("Content-Type",e.contentType),e.md5_digest&&r.setRequestHeader("Content-MD5",e.md5_digest),r.onreadystatechange=function(){4===r.readyState&&(a&&B.d("  ###",a.size),e[t(r)?"on200":"onErr"](r),0===r.status&&(r.onreadystatechange=function(){},r.abort()),Ie(e))},r.onerror=function(){e.onErr(r,!0),Ie(e)},"function"==typeof e.onProgress&&(r.upload.onprogress=function(t){e.onProgress(t)}),r.send(a)},e.onFailedAuth=e.onFailedAuth||function(t){Oe.error("Error onFailedAuth for step: "+e.step),e.onErr(t)}}function fe(e){function t(t){var r=["failed to get authorization (",t,") for",e.step,"-  xhr.status:",n.status,".-  xhr.response:",n.response].join(" ");B.w(r),Oe.warn(r),e.onFailedAuth(n)}if(Me(e))return void B.w("authorizedSend() step",e.step,"is already in progress. Returning.");if(B.d("authorizedSend()",e.step),s.awsLambda)return ce(e);var n=Ce(e),r=me(e),a=[s.signerUrl,"?to_sign=",r,"&datetime=",e.dateString].join("");if("undefined"==typeof s.signerUrl)return e.auth=ge(null,r,e.dateString),Ie(e),void e.onGotAuth();var o=he(Oe.signParams);for(var i in o)o.hasOwnProperty(i)&&(a+="&"+encodeURIComponent(i)+"="+encodeURIComponent(o[i]));s.xhrWithCredentials&&(n.withCredentials=!0),n.onreadystatechange=function(){if(4===n.readyState){var r="readyState===4";if(200===n.status){var a=ge(n.response);Ie(e),"2"===s.awsSignatureVersion&&28!==a.length?t(r):(B.d("authorizedSend got signature for:",e.step,"- signature:",a),e.auth=a,e.onGotAuth())}else n.onerror(r)}},n.onerror=function(e){t(e||"onerror")},n.open("GET",a);var u=he(s.signHeaders);for(var d in u)u.hasOwnProperty(d)&&n.setRequestHeader(d,u[d]);"function"==typeof Oe.beforeSigner&&Oe.beforeSigner(n,a),n.send()}function ce(e){s.awsLambda.invoke({FunctionName:s.awsLambdaFunction,InvocationType:"RequestResponse",Payload:JSON.stringify({to_sign:ve(e),sign_params:he(Oe.signParams),sign_headers:he(s.signHeaders)})},function(t,n){if(t){var r="failed to get authorization with lambda "+t;return B.w(r),Oe.warn(r),void e.onFailedAuth(t)}e.auth=ge(JSON.parse(n.Payload)),e.onGotAuth()})}function me(e){return encodeURIComponent("4"===s.awsSignatureVersion?we(e):ve(e))}function ge(e,t,n){return"function"==typeof s.signResponseHandler&&(e=s.signResponseHandler(e,t,n)||e),e}function he(e){var t={};for(var n in e)e.hasOwnProperty(n)&&("function"==typeof e[n]?t[n]=e[n]():t[n]=e[n]);return t}function ye(e){return"4"===s.awsSignatureVersion?xe(e):Se(e)}function ve(e){var t,n="",r=[];for(var a in e.x_amz_headers)e.x_amz_headers.hasOwnProperty(a)&&r.push(a);return r.sort(),r.forEach(function(t){n+=t+":"+e.x_amz_headers[t]+"\n"}),t=e.method+"\n"+(e.md5_digest||"")+"\n"+(e.contentType||"")+"\n\n"+n+(s.cloudfront?"/"+s.bucket:"")+e.path,B.d("makeStringToSign (V2)",t),t}function we(e){var t=[];t.push("AWS4-HMAC-SHA256"),t.push(e.dateString),t.push(be(e)),t.push(s.cryptoHexEncodedHash256(Te(e)));var n=t.join("\n");return B.d("makeStringToSign (V4)",n),n}function Se(e){return["AWS ",s.aws_key,":",e.auth].join("")}function xe(e){var t=[],n=be(e),r=Pe(e);return t.push(["AWS4-HMAC-SHA256 Credential=",s.aws_key,"/",n].join("")),t.push("SignedHeaders="+r.signedHeaders),t.push("Signature="+e.auth),t.join(", ")}function be(e){var t=[];return t.push(e.dateString.slice(0,8)),t.push(s.awsRegion),t.push("s3"),t.push("aws4_request"),t.join("/")}function Te(t){var n=[];n.push(t.method),n.push(e(t.path).pathname),n.push(ze(t)||"");var r=Pe(t);n.push(r.canonicalHeaders+"\n"),n.push(r.signedHeaders),n.push(t.getPayloadSha256Content());var a=n.join("\n");return B.d("CanonicalRequest (V4)",a),a}function ze(t){var n,r,a=e(t.path).search,o=a.length?a.split("&"):[],s=[];for(r=0;r<o.length;r++)n=o[r].split("="),s.push({name:encodeURIComponent(n[0]),value:n.length>1?encodeURIComponent(n[1]):null});var i=s.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),u=[];for(r=0;r<i.length;r++)n=i[r].value?[i[r].name,i[r].value].join("="):i[r].name+"=",u.push(n);return u.join("&")}function Pe(e){function t(e,t){var n=e.toLowerCase();a.push(n),r[n]=t.replace(/\s+/g," ")}var n,r=[],a=[];e.md5_digest&&t("Content-Md5",e.md5_digest),t("Host",j),e.contentType&&t("Content-Type",e.contentType||"");var o=e.x_amz_headers||{};for(var s in o)o.hasOwnProperty(s)&&t(s,o[s]);var i=a.sort(function(e,t){return e<t?-1:e>t?1:0}),u=[],d=[],l=e.not_signed_headers||[],p=[];for(n=0;n<l.length;n++)d.push(l[n].toLowerCase());for(n=0;n<i.length;n++){var f=i[n];u.push([f,r[f]].join(":")),d.indexOf(f)===-1&&p.push(f)}return{canonicalHeaders:u.join("\n"),signedHeaders:p.join(";")}}function _e(){var e="/"+s.bucket+"/"+Oe.name;return(s.cloudfront||k.indexOf("cloudfront")>-1)&&(e="/"+Oe.name),e}function Ee(e){return"undefined"==typeof e.part?e:e.part}function Me(e){return!!Ee(e).currentXhr}function Ce(e){return Ee(e).currentXhr=new XMLHttpRequest}function Ie(e){delete Ee(e).currentXhr}var Ae,He,Oe=this,Re=[],Be=[],Ue=[],Fe=0,De=0,ke=0,je=[],Ne=0;f(Oe,o),Oe.signParams=s.signParams,Oe.start=function(){if(B.d("starting FileUpload",Oe.id),Oe.started(Oe.id),Oe.status!==P){C(S);var e=Oe.name;if(re(),"undefined"==typeof Oe.uploadId)F(e);else if("undefined"!=typeof Oe.eTag&&Oe.firstMd5Digest&&s.computeContentMd5){var t=new FileReader;t.onloadend=function(){var t=s.cryptoMd5Method.call(this,this.result);s.allowS3ExistenceOptimization&&Oe.firstMd5Digest===t?G(e):(Oe.firstMd5Digest=t,F(e))},t.readAsArrayBuffer(n(Oe.file,0,s.partSize))}else Be.length?U(!1):Y(0)}},Oe.stop=function(){B.d("stopping FileUpload ",Oe.id),Oe.cancelled(),C(T),Oe.info("Canceling uploads..."),O()},Oe.pause=function(e){B.d("pausing FileUpload ",Oe.id),Oe.info("Pausing uploads..."),e?(B.d("Pausing requests to force abort parts that are evaporating"),H(),C(b),Oe.paused()):(C(_),Oe.pausing())},Oe.resume=function(){[_,b].indexOf(Oe.status)>-1&&(B.d("resuming FileUpload ",Oe.id),C(w),Oe.resumed())};var Le=0,qe=-1}function f(e,t,n){function r(e,t){if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}return e=e||{},r(t,n),r(e,t),e}function c(e){var t=new DOMParser;return t.parseFromString(e,"text/xml")}function m(e){var t=JSON.parse(D.getItem("awsUploads")||"{}");if(e){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],o=new Date(r.completedAt||a);o<L&&delete t[n]}D.setItem("awsUploads",JSON.stringify(t))}return t}function g(e){return[e.file.name,e.file.type,t(e.file.lastModifiedDate),e.file.size].join("-")}function h(e,t){var n=m();n[e]=t,D.setItem("awsUploads",JSON.stringify(n))}function y(e){var t=m();delete t[e],D.setItem("awsUploads",JSON.stringify(t))}function v(e,t){return e.getElementsByTagName(t)[0].textContent}var w=0,S=2,x=3,b=4,T=5,z=10,P=20,_=30,E=40,M='"d41d8cd98f00b204e9800998ecf8427e"',C=["maxConcurrentParts","logging","cloudfront","aws_url","encodeFilename","computeContentMd5","allowS3ExistenceOptimization","onlyRetryForSameFileName","timeUrl","cryptoMd5Method","cryptoHexEncodedHash256","aws_key","awsRegion","awsSignatureVersion","evaporateChanged"],I={online:12e4,offline:2e4},A=I.online,H=this,O=[],R=0,B=s(),U=f({bucket:null,logging:!0,maxConcurrentParts:5,partSize:6291456,retryBackoffPower:2,maxRetryBackoffSecs:300,progressIntervalMS:500,cloudfront:!1,s3Acceleration:!1,encodeFilename:!0,computeContentMd5:!1,allowS3ExistenceOptimization:!1,onlyRetryForSameFileName:!1,timeUrl:null,cryptoMd5Method:null,cryptoHexEncodedHash256:null,aws_key:null,awsRegion:"us-east-1",awsSignatureVersion:"2",s3FileCacheHoursAgo:null,signParams:{},signHeaders:{},awsLambda:null,awsLambdaFunction:null,maxFileSize:null,signResponseHandler:null,xhrWithCredentials:!1,testUnsupported:!1,simulateStalling:!1,simulateErrors:!1,evaporateChanged:function(){},processMd5ThrottlingMs:1500,abortCompletionThrottlingMs:1e3},o);if("undefined"!=typeof window&&window.console&&(B=window.console,B.d=B.log,B.w=window.console.warn?B.warn:B.d,B.e=window.console.error?B.error:B.d),this.supported=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice)||o.testUnsupported),!U.signerUrl&&"function"!=typeof U.signResponseHandler)return void B.e("Option signerUrl is required unless signResponseHandler is present.");if(!U.bucket)return void B.e("The AWS 'bucket' option must be present.");if(!this.supported)return void B.e("The browser does not support the necessary features of File and Blob [webkitSlice || mozSlice || slice]");if(U.computeContentMd5){if(this.supported="undefined"!=typeof FileReader.prototype.readAsArrayBuffer,!this.supported)return void B.e("The browser's FileReader object does not support readAsArrayBuffer");if("function"!=typeof U.cryptoMd5Method)return void B.e("Option computeContentMd5 has been set but cryptoMd5Method is not defined.");if("4"===U.awsSignatureVersion&&"function"!=typeof U.cryptoHexEncodedHash256)return void B.e("Option awsSignatureVersion is 4 but cryptoHexEncodedHash256 is not defined.")}else if("4"===U.awsSignatureVersion)return void B.e("Option awsSignatureVersion is 4 but computeContentMd5 is not enabled.");U.logging||(B=s());var F,D={supported:function(){var e=!1;if("undefined"==typeof window)return e;if(!("localStorage"in window))return e;try{localStorage.setItem("___test","OK");var t=localStorage.getItem("___test");localStorage.removeItem("___test"),e="OK"===t}catch(t){return e}return e}(),getItem:function(e){if(this.supported)return localStorage.getItem(e)},setItem:function(e,t){if(this.supported)return localStorage.setItem(e,t)},clear:function(){if(this.supported)return localStorage.clear()},key:function(e){if(this.supported)return localStorage.key(e)},removeItem:function(e){if(this.supported)return localStorage.removeItem(e)}};U.aws_url?F=[U.aws_url]:(U.s3Acceleration?(F=["https://",U.bucket,".s3-accelerate"],U.cloudfront=!0):(F=["https://",U.cloudfront?U.bucket+".":"","s3"],"us-east-1"!==U.awsRegion&&F.push("-",U.awsRegion)),F.push(".amazonaws.com"));var k=F.join(""),j=e(k).hostname,N=new Date,L=new Date(N.setHours(N.getHours()-(U.s3FileCacheHoursAgo||-100))),q=0;if(U.timeUrl){var V=new XMLHttpRequest;V.open("GET",U.timeUrl+"?requestTime="+(new Date).getTime()),V.onreadystatechange=function(){if(4===V.readyState&&200===V.status){var e=new Date(Date.parse(V.responseText)),t=new Date;q=t-e,B.d("localTimeOffset is",q,"ms")}},V.onerror=function(){B.e("xhr error timeUrl",V)},V.send()}H.add=function(e,t){var n=f(t,{});C.map(function(e){delete n[e]});var r=f(U,n);B.d("add");var a;if("undefined"==typeof e)return"Missing file";if(r.maxFileSize&&e.file.size>r.maxFileSize)return"File size too large. Maximum size allowed is "+r.maxFileSize;if("undefined"==typeof e.name?a="Missing attribute: name  ":r.encodeFilename&&(e.name=d(e.name)),a)return a;var o=i(e,r);return setTimeout(l,1),o},H.cancel=function(e){return B.d("cancel ",e),!!O[e]&&(O[e].stop(),!0)},H.pause=function(e,t){t=t||{};var n="undefined"!==t.force&&t.force,r=typeof e;"undefined"===r?(B.d("Pausing all file uploads"),O.forEach(function(e){[w,S,z].indexOf(e.status)>-1&&e.pause(n)})):"undefined"==typeof O[e]?B.w("Cannot pause a file that has not been added."):O[e].status===b?B.w("Cannot pause a file that is already paused. Status:",O[e].status):O[e].pause(n)},H.resume=function(e){var t=[b,_];"undefined"==typeof e?(B.d("Resuming all file uploads"),O.forEach(function(e){t.indexOf(e.status)>-1&&e.resume()})):"undefined"==typeof O[e]?B.w("Cannot pause a file that does not exist."):t.indexOf(O[e].status)===-1?B.w("Cannot resume a file that has not been paused. Status:",O[e].status):O[e].resume()},H.forceRetry=function(){}};"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof window&&(window.Evaporate=o)}();
//# sourceMappingURL=evaporate.min.js.map