!function(){"use strict";function e(e){var t=document.createElement("a");return t.href=e||"/",{protocol:t.protocol,hostname:t.hostname,pathname:t.pathname,port:t.port,search:"?"===t.search[0]?t.search.substr(1):t.search,hash:t.hash,host:t.host}}function t(e){return e?e.toISOString():""}function n(e,t,n){var a=e.slice?"slice":e.mozSlice?"mozSlice":"webkitSlice";return e[a](t,n)}function a(e){var t=new DOMParser,n=t.parseFromString(e.responseText,"text/xml"),a=n.getElementsByTagName("Code"),r=n.getElementsByTagName("Message");return a=a.length?a[0].innerHTML:"",r=r.length?r[0].innerHTML:"",a.length?{code:a,msg:r}:{}}var r=new Date("2060-10-22"),o=function(o){function s(){return{d:function(){},w:function(){},e:function(){}}}function i(e,t){var n=A.length;return A.push(new p(f({started:function(){},progress:function(){},complete:function(){},cancelled:function(){},paused:function(){},resumed:function(){},pausing:function(){},info:function(){},warn:function(){},error:function(){},xAmzHeadersAtInitiate:{},notSignedHeadersAtInitiate:{},xAmzHeadersAtUpload:{},xAmzHeadersAtComplete:{}},e,{id:n,status:S,priority:0,onStatusChange:u,loadedBytes:0,sizeBytes:e.file.size,eTag:""}),t)),n}function u(){H.d("onFileUploadStatusChange"),l()}function d(){setTimeout(l,1)}function l(){H.d("processQueue   length: "+A.length);var e=-1,t=-1,n=!0;A.forEach(function(a,r){a.priority>t&&a.status===S&&(e=r,t=a.priority),a.status===w&&(n=!1)}),n&&e>=0&&A[e].start()}function p(o,s){function i(e){C=Math.max(0,C+e),s.evaporateChanged(Me,C)}function u(e){Fe.push(e.part)}function d(e){l(Fe,e.part),l(He,e.part),i(-1),0===Fe.length&&Me.status==I&&(Me.status=x,Me.paused())}function l(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function p(e){[b,T,P,E,x].indexOf(e)>-1&&se(),Me.status=e,Me.onStatusChange()}function _(){var e=[];Fe.forEach(function(t){e.push(t)}),e.forEach(function(e){N(e,!0)}),ae()}function M(){H.d("cancelAllRequests()"),W()}function A(){s.computeContentMd5&&Me.file.size>0?V():(Q(),ne())}function B(e){var t,n={method:"POST",path:xe()+"?uploads",step:"initiate",x_amz_headers:Me.xAmzHeadersAtInitiate,not_signed_headers:Me.notSignedHeadersAtInitiate},r=Me.status;Me.contentType&&(n.contentType=Me.contentType),n.onErr=function(n){t||Me.status===E||Me.status===P||(t=!0,H.d("onInitiateError for FileUpload "+Me.id),Me.warn("Error initiating upload",a(n)),p(T),n.abort(),setTimeout(function(){Me.status!==E&&Me.status!==P&&(Me.status=r,B(e))},te(Oe++)))},n.on200=function(t){var a=t.response.match(/<UploadId>(.+)<\/UploadId>/);a&&a[1]?(Me.uploadId=a[1],Me.awsKey=e,H.d("requester success. got uploadId "+Me.uploadId),J(),A()):n.onErr(t)},ie(n),ue(n),oe()}function U(e){var t,r,o,s;s=Ae[e],s.status=w,Be++,i(1),s.loadedBytesPrevious=null,t=te(s.attempts++),H.d("uploadPart #"+e+"     will wait "+t+"ms to try"),o={method:"PUT",path:xe()+"?partNumber="+e+"&uploadId="+Me.uploadId,step:"upload #"+e,x_amz_headers:Me.xAmzHeadersAtUpload,md5_digest:s.md5_digest,contentSha256:"UNSIGNED-PAYLOAD",attempts:s.attempts,part:s},o.onErr=function(t,n){if(d(s),!([P,E,x,I].indexOf(Me.status)>-1)){var o="problem uploading part #"+e+",   http status: "+t.status+",   hasErrored: "+!!r+",   part status: "+s.status+",   readyState: "+t.readyState+(n?",   isOnError":"");if(H.w(o),Me.warn(o),!r){if(r=!0,404===t.status){var i="404 error resulted in abortion of both this part and the entire file.";H.w(i+" Server response: "+t.response),Me.error(i),s.status=E,W()}else{s.status=T,s.loadedBytes=0;var u=a(t);u.code&&H.e('AWS Server response: code="'+u.code+'", message="'+u.msg+'"'),ne()}t.abort()}}},o.on200=function(t){var n,a=t.getResponseHeader("ETag");H.d("uploadPart 200 response for part #"+e+"     ETag: "+a),s.isEmpty||a!==z?(s.eTag=a,s.status=b,d(s)):(s.status=T,s.loadedBytes=0,n="eTag matches MD5 of 0 length blob for part #"+e+"   Retrying part.",H.w(n),Me.warn(n)),ne()},o.onProgress=function(e){s.loadedBytes=e.loaded},o.toSend=function(){var t=n(Me.file,s.start,s.end);return H.d("part # "+e+" (bytes "+s.start+" -> "+s.end+")  reported length: "+t.size),s.isEmpty||0!==t.size||H.w("  *** WARN: blob reporting size of 0 bytes. Will try upload anyway.."),t},o.onFailedAuth=function(){var t="onFailedAuth for uploadPart #"+e+".   Will set status to ERROR";H.w(t),Me.warn(t),s.status=T,s.loadedBytes=0,ne()},ie(o),setTimeout(function(){[E,x,P].indexOf(Me.status)===-1&&(u(s),ue(o),H.d("upload #",e,o))},t),s.uploader=o}function N(e,t){var n=Ae[e];n.currentXhr&&(t&&(n.currentXhr.onreadystatechange=function(){4===n.currentXhr.readyState&&i(-1)}),n.currentXhr.abort(),n.loadedBytes=0)}function j(){H.d("completeUpload"),Me.info("will attempt to complete upload");var e,t=[],n=Me.status;t.push("<CompleteMultipartUpload>"),Ae.forEach(function(e,n){n>0&&t.push(["<Part><PartNumber>",n,"</PartNumber><ETag>",e.eTag,"</ETag></Part>"].join(""))}),t.push("</CompleteMultipartUpload>");var r={method:"POST",contentType:"application/xml; charset=UTF-8",path:xe()+"?uploadId="+Me.uploadId,x_amz_headers:Me.xAmzHeadersAtComplete,step:"complete"};r.onErr=function(t){if(!e&&Me.status!==E&&Me.status!==P){e=!0;var r="Error completing upload.";H.w(r,a(t)),Me.error(r),p(T),t.abort(),setTimeout(function(){Me.status!==E&&Me.status!==P&&(Me.status=n,j(),oe())},te(Re++))}},r.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("CompleteMultipartUploadResult")[0];Me.eTag=v(n,"ETag"),Me.complete(e,Me.name),Y()},r.toSend=function(){return t.join("")},ie(r),ue(r)}function q(e){H.d("headObject"),Me.info("will attempt to verify existence of the file");var t={method:"HEAD",path:xe(),step:"head_object"};t.onErr=function(){var t="Error completing head object. Will re-upload file.";H.w(t),B(e)},t.on200=function(t){var n=t.getResponseHeader("Etag");n===Me.eTag?(H.d("headObject found matching object on S3."),Me.progress(1),Me.complete(t,Me.name),p(b)):(H.d("headObject not found on S3."),B(e))},ie(t),ue(t)}function L(e){return function(){var t=Me.status;if(!([T,P,E].indexOf(t)>-1)){var n=s.cryptoMd5Method.call(this,this.result);H.d(["part #",e.part," MD5 digest is ",n].join("")),e.md5_digest=n,1===e.part&&Q(),delete e.reader,De+=1,C<s.maxConcurrentParts&&ne(),De===ke&&H.d("All parts have MD5 digests"),setTimeout(V,1500)}}}function V(){for(var e=1,t=1;t<=ke;t++){var a=Ae[t];if(a.status===b)e+=1;else if(null===a.md5_digest){if(t>1||"undefined"==typeof Me.firstMd5Digest){a.reader=new FileReader,a.reader.onloadend=L(a),a.reader.readAsArrayBuffer(n(Me.file,a.start,a.end));break}a.md5_digest=Me.firstMd5Digest,Q(),ne()}}e===Ae.length&&(p(b),Me.progress(1))}function W(){if(H.d("abortUpload"),Me.info("will attempt to abort the upload"),_(),"undefined"==typeof Me.uploadId)return void p(E);var e={method:"DELETE",path:xe()+"?uploadId="+Me.uploadId,step:"abort",successStatus:204};e.onErr=function(){var e="Error aborting upload.";H.w(e),Me.error(e)},e.on200=function(){p(E),G()},ie(e),ue(e)}function G(){H.d("listParts"),Me.info("list parts");var e={method:"GET",path:xe()+"?uploadId="+Me.uploadId,step:"list"};e.onErr=function(e){if(404===e.status)Z(),Me.info("upload canceled");else{var t="Error listing parts.";H.w(t,a(e)),Me.error(t)}},e.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("Part");n.length?(H.d("Parts still found after abort...waiting."),setTimeout(function(){W()},1e3)):Me.info("upload canceled")},ie(e),ue(e)}function X(e){H.d("getUploadParts() for uploadId starting at part #",e),Me.info("getUploadParts() for uploadId starting at part #",e);var t={method:"GET",path:xe()+"?uploadId="+Me.uploadId,query_string:"&part-number-marker="+e,step:"get upload parts"};"4"===s.awsSignatureVersion&&(t.path=[xe(),"?uploadId=",Me.uploadId,"&part-number-marker="+e].join("")),t.onErr=function(t){if(404===t.status)Me.info(["uploadId ",Me.uploadId," does not exist."].join("")),Z(),oe(),J(),ne();else{var n="Error listing parts for getUploadParts() starting at part # "+e;H.w(n,a(t)),Me.error(n)}},t.on200=function(t){Me.info(["uploadId",Me.uploadId,"is not complete. Fetching parts from part marker=",e].join(""));for(var n,a,r,o=c(t.responseText),s=o.getElementsByTagName("ListPartsResult")[0],i="true"===v(s,"IsTruncated"),u=o.getElementsByTagName("Part"),d=u.length,l=0;l<d;l++)a=u[l],r=parseInt(v(a,"Size")),Ue+=r,Ce.push({eTag:v(a,"ETag"),partNumber:parseInt(v(a,"PartNumber")),size:r,LastModified:v(a,"LastModified")});if(o=u=null,i){var p=v(s,"NextPartNumberMarker");X(p)}else J(),Ce.forEach(function(e){n=K(e.partNumber,b,e.size),n.eTag=e.eTag,n.attempts=1,n.loadedBytes=e.size,n.loadedBytesPrevious=e.size,n.finishedUploadingAt=e.LastModified,n.md5_digest="n/a",Ae[e.partNumber]=n}),oe(),A();s=null},ie(t),ue(t)}function J(){ke=Math.ceil(Me.file.size/s.partSize)||1;for(var e=1;e<=ke;e++){var t="undefined"==typeof Ae[e]?S:Ae[e].status;t!==b&&(Ae[e]=K(e,S,Me.file.size),He.push(e))}}function K(e,t,n){return{status:t,start:(e-1)*s.partSize,end:e*s.partSize,attempts:0,loadedBytes:0,loadedBytesPrevious:null,isEmpty:0===n,md5_digest:null,part:e}}function Q(){var e=m(Me),n={awsKey:Me.name,bucket:s.bucket,uploadId:Me.uploadId,fileSize:Me.file.size,fileType:Me.file.type,lastModifiedDate:t(Me.file.lastModifiedDate),partSize:s.partSize,signParams:Me.signParams,createdAt:(new Date).toISOString()};s.computeContentMd5&&Ae.length&&"undefined"!=typeof Ae[1].md5_digest&&(n.firstMd5Digest=Ae[1].md5_digest),h(e,n)}function Y(){var e=g(),t=e[m(Me)];"undefined"!=typeof t&&(t.completedAt=(new Date).toISOString(),t.eTag=Me.eTag,R.setItem("awsUploads",JSON.stringify(e))),p(b),Me.progress(1)}function Z(){"undefined"!=typeof Me.file&&y(m(Me))}function $(){var e=g(!0),t=e[m(Me)];ee(t)&&(Me.uploadId=t.uploadId,Me.name=t.awsKey,Me.eTag=t.eTag,Me.firstMd5Digest=t.firstMd5Digest,Me.signParams=t.signParams)}function ee(e){if("undefined"==typeof e)return!1;var t=new Date(e.completedAt||r);return s.partSize===e.partSize&&t>D&&s.bucket===e.bucket&&(!s.onlyRetryForSameFileName||Me.name===e.awsKey)}function te(e){return 1===e?0:1e3*Math.min(s.maxRetryBackoffSecs,Math.pow(s.retryBackoffPower,e-2))}function ne(){var e,t=!0,n=!1,a=[],r=[];if(Me.status!==w)return void Me.info("will not process parts list, as not currently evaporating");for(var o=0;o<He.length;o++){var i=Ae[He[o]];if(s.computeContentMd5&&null===i.md5_digest)return;var u=!1;switch(a.push(i.status),i.status){case w:t=!1,r.push(i.loadedBytes);break;case T:n=!0,u=!0;break;case S:u=!0}if(u){if(t=!1,!(C<s.maxConcurrentParts))return;U(i.part)}}e=a.toString()+" // bytesLoaded: "+r.toString(),H.d("processPartsList()  anyPartHasErrored: "+n,e),(Be>=Ae.length-1||n)&&Me.info("part stati:",e),t&&j()}function ae(){clearInterval(ze),ze=setInterval(function(){var e=0;Ae.forEach(function(t){e+=t.loadedBytes}),Me.progress(e/Me.sizeBytes)},s.progressIntervalMS)}function re(){clearInterval(_e),_e=setInterval(function(){H.d("monitorPartsProgress() "+new Date),Fe.forEach(function(e){var t,n=Ae[e];return n.status!==w?void H.d(e,"not evaporating "):null===n.loadedBytesPrevious?(H.d(e,"no previous "),void(n.loadedBytesPrevious=n.loadedBytes)):(t=n.loadedBytesPrevious<n.loadedBytes,s.simulateStalling&&4===e&&Math.random()<.25&&(t=!1),H.d(e,t?"moving.":"stalled.",n.loadedBytesPrevious,n.loadedBytes),t||setTimeout(function(){Me.info("part #"+e," stalled. will abort.",n.loadedBytesPrevious,n.loadedBytes),N(e)},0),void(n.loadedBytesPrevious=n.loadedBytes))})},12e4)}function oe(){ae(),re()}function se(){clearInterval(ze),clearInterval(_e)}function ie(e){e.getPayload=function(){return e.toSend?e.toSend():null},e.getPayloadSha256Content=function(){var t=e.contentSha256||s.cryptoHexEncodedHash256(e.getPayload()||"");return H.d("getPayloadSha256Content",t),t},H.d("setupRequest()",e);var t=s.timeUrl?new Date((new Date).getTime()+k):new Date;"4"===s.awsSignatureVersion?e.dateString=t.toISOString().slice(0,19).replace(/-|:/g,"")+"Z":e.dateString=t.toUTCString(),e.x_amz_headers=f(e.x_amz_headers,{"x-amz-date":e.dateString}),e.onGotAuth=function(){if(Te(e))return void H.w("onGotAuth() step",e.step,"is already in progress. Returning.");var t=Ee(e),n=e.getPayload(),a=O+e.path;e.query_string&&(a+=e.query_string);var r={},o=e.successStatus||200;f(r,e.not_signed_headers),f(r,e.x_amz_headers),s.simulateErrors&&1===e.attempts&&"upload #3"===e.step&&(H.d("simulating error by POST part #3 to invalid url"),a="https:///foo"),t.open(e.method,a),t.setRequestHeader("Authorization",ce(e));for(var i in r)r.hasOwnProperty(i)&&t.setRequestHeader(i,r[i]);"4"===s.awsSignatureVersion&&t.setRequestHeader("x-amz-content-sha256",e.getPayloadSha256Content()),e.contentType&&t.setRequestHeader("Content-Type",e.contentType),e.md5_digest&&t.setRequestHeader("Content-MD5",e.md5_digest),t.onreadystatechange=function(){4===t.readyState&&(n&&H.d("  ### "+n.size),Ie(e),t.status===o?e.on200(t):e.onErr(t))},t.onerror=function(){Ie(e),e.onErr(t,!0)},"function"==typeof e.onProgress&&(t.upload.onprogress=function(t){e.onProgress(t)}),t.send(n)},e.onFailedAuth=e.onFailedAuth||function(t){Me.error("Error onFailedAuth for step: "+e.step),e.onErr(t)}}function ue(e){if(H.d("authorizedSend() "+e.step),Te(e))return void H.w("authorizedSend() step",e.step,"is already in progress. Returning.");if(s.awsLambda)return de(e);var t,n=Ee(e),a=[s.signerUrl,"?to_sign=",le(e),"&datetime=",e.dateString].join(""),r=fe(Me.signParams);for(var o in r)r.hasOwnProperty(o)&&(a+="&"+encodeURIComponent(o)+"="+encodeURIComponent(r[o]));s.xhrWithCredentials&&(n.withCredentials=!0),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var a=pe(n.response);"2"===s.awsSignatureVersion&&28!==a.length?(t="failed to get authorization (readyState=4) for "+e.step+".  xhr.status: "+n.status+".  xhr.response: "+n.response,H.w(t),Me.warn(t),Ie(e),e.onFailedAuth(n)):(H.d("authorizedSend got signature for step: '"+e.step+"'    sig: "+a),e.auth=a,Ie(e),e.onGotAuth())}else t="failed to get authorization (readyState=4) for "+e.step+".  xhr.status: "+n.status+".  xhr.response: "+n.response,H.w(t),Me.warn(t),Ie(e),e.onFailedAuth(n)},n.onerror=function(){t="failed to get authorization (onerror) for "+e.step+".  xhr.status: "+n.status+".  xhr.response: "+n.response,H.w(t),Me.warn(t),e.onFailedAuth(n)},n.open("GET",a);var i=fe(Me.signHeaders);for(var u in i)i.hasOwnProperty(u)&&n.setRequestHeader(u,i[u]);"function"==typeof Me.beforeSigner&&Me.beforeSigner(n,a),n.send()}function de(e){s.awsLambda.invoke({FunctionName:s.awsLambdaFunction,InvocationType:"RequestResponse",Payload:JSON.stringify({to_sign:ge(e),sign_params:fe(Me.signParams),sign_headers:fe(Me.signHeaders)})},function(t,n){if(t){var a="failed to get authorization with lambda "+t;return H.w(a),Me.warn(a),void e.onFailedAuth(t)}e.auth=pe(JSON.parse(n.Payload)),e.onGotAuth()})}function le(e){return encodeURIComponent("4"===s.awsSignatureVersion?me(e):ge(e))}function pe(e){return"function"==typeof s.signResponseHandler&&(e=s.signResponseHandler(e)||e),e}function fe(e){var t={};for(var n in e)e.hasOwnProperty(n)&&("function"==typeof e[n]?t[n]=e[n]():t[n]=e[n]);return t}function ce(e){return"4"===s.awsSignatureVersion?ye(e):he(e)}function ge(e){var t,n="",a=[];for(var r in e.x_amz_headers)e.x_amz_headers.hasOwnProperty(r)&&a.push(r);return a.sort(),a.forEach(function(t){n+=t+":"+e.x_amz_headers[t]+"\n"}),t=e.method+"\n"+(e.md5_digest||"")+"\n"+(e.contentType||"")+"\n\n"+n+(s.cloudfront?"/"+s.bucket:"")+e.path,H.d("makeStringToSign (V2)",t),t}function me(e){var t=[];t.push("AWS4-HMAC-SHA256"),t.push(e.dateString),t.push(ve(e)),t.push(s.cryptoHexEncodedHash256(Se(e)));var n=t.join("\n");return H.d("makeStringToSign (V4)",n),n}function he(e){return["AWS ",s.aws_key,":",e.auth].join("")}function ye(e){var t=[],n=ve(e),a=be(e);return t.push(["AWS4-HMAC-SHA256 Credential=",s.aws_key,"/",n].join("")),t.push("SignedHeaders="+a.signedHeaders),t.push("Signature="+e.auth),t.join(", ")}function ve(e){var t=[];return t.push(e.dateString.slice(0,8)),t.push(s.awsRegion),t.push("s3"),t.push("aws4_request"),t.join("/")}function Se(t){var n=[];n.push(t.method),n.push(e(t.path).pathname),n.push(we(t)||"");var a=be(t);n.push(a.canonicalHeaders+"\n"),n.push(a.signedHeaders),n.push(t.getPayloadSha256Content());var r=n.join("\n");return H.d("CanonicalRequest",r),r}function we(t){var n,a,r=e(t.path).search,o=r.length?r.split("&"):[],s=[];for(a=0;a<o.length;a++)n=o[a].split("="),s.push({name:encodeURIComponent(n[0]),value:n.length>1?encodeURIComponent(n[1]):null});var i=s.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),u=[];for(a=0;a<i.length;a++)n=i[a].value?[i[a].name,i[a].value].join("="):i[a].name+"=",u.push(n);return u.join("&")}function be(e){function t(e,t){var n=e.toLowerCase();r.push(n),a[n]=t.replace(/\s+/g," ")}var n,a=[],r=[];e.md5_digest&&t("Content-Md5",e.md5_digest),t("Host",F),e.contentType&&t("Content-Type",e.contentType||"");var o=e.x_amz_headers||{};for(var s in o)o.hasOwnProperty(s)&&t(s,o[s]);var i=r.sort(function(e,t){return e<t?-1:e>t?1:0}),u=[],d=[],l=e.not_signed_headers||[],p=[];for(n=0;n<l.length;n++)d.push(l[n].toLowerCase());for(n=0;n<i.length;n++){var f=i[n];u.push([f,a[f]].join(":")),d.indexOf(f)===-1&&p.push(f)}return{canonicalHeaders:u.join("\n"),signedHeaders:p.join(";")}}function xe(){var e="/"+s.bucket+"/"+Me.name;return(s.cloudfront||O.indexOf("cloudfront")>-1)&&(e="/"+Me.name),e}function Pe(e){return"undefined"==typeof e.part?e:e.part}function Te(e){return!!Pe(e).currentXhr}function Ee(e){return Pe(e).currentXhr=new XMLHttpRequest}function Ie(e){delete Pe(e).currentXhr}var ze,_e,Me=this,Ae=[],Ce=[],He=[],Be=0,Oe=0,Re=0,Fe=[],Ue=0;f(Me,o),Me.start=function(){H.d("starting FileUpload "+Me.id),Me.started(Me.id),p(w);var e=Me.name;if($(),"undefined"==typeof Me.uploadId)B(e);else if("undefined"!=typeof Me.eTag&&Me.firstMd5Digest){var t=new FileReader;t.onloadend=function(){var t=s.cryptoMd5Method.call(this,this.result);s.allowS3ExistenceOptimization&&Me.firstMd5Digest===t?q(e):(Me.firstMd5Digest=t,B(e))},t.readAsArrayBuffer(n(Me.file,0,s.partSize))}else X(0)},Me.stop=function(){H.d("stopping FileUpload ",Me.id),Me.cancelled(),p(P),Me.info("Canceling uploads..."),M()},Me.pause=function(e){H.d("pausing FileUpload ",Me.id),Me.info("Pausing uploads..."),e?(H.d("Pause requests to force abort parts that are evaporating"),_(),p(x),Me.paused()):(Me.status===T?Me.statusBeforePause=Me.status:delete Me.statusBeforePause,p(I),Me.pausing())},Me.resume=function(){H.d("resuming FileUpload ",Me.id),p(Me.statusBeforePause||S),Me.resumed()};var De=0,ke=-1}function f(e,t,n){if(e="undefined"==typeof e?{}:e,"object"==typeof n)for(var a in n)t[a]=n[a];for(var r in t)e[r]=t[r];return e}function c(e){var t=new DOMParser;return t.parseFromString(e,"text/xml")}function g(e){var t=JSON.parse(R.getItem("awsUploads")||"{}");if(e){for(var n in t)if(t.hasOwnProperty(n)){var a=t[n],o=new Date(a.completedAt||r);o<D&&delete t[n]}R.setItem("awsUploads",JSON.stringify(t))}return t}function m(e){return[e.file.name,e.file.type,t(e.file.lastModifiedDate),e.file.size].join("-")}function h(e,t){var n=g();n[e]=t,R.setItem("awsUploads",JSON.stringify(n))}function y(e){var t=g();delete t[e],R.setItem("awsUploads",JSON.stringify(t))}function v(e,t){return e.getElementsByTagName(t)[0].textContent}var S=0,w=2,b=3,x=4,P=5,T=10,E=20,I=30,z='"d41d8cd98f00b204e9800998ecf8427e"',_=["maxConcurrentParts","logging","cloudfront","aws_url","encodeFilename","computeContentMd5","allowS3ExistenceOptimization","onlyRetryForSameFileName","timeUrl","cryptoMd5Method","cryptoHexEncodedHash256","aws_key","awsRegion","awsSignatureVersion","evaporateChanged"],M=this,A=[],C=0,H=s(),B=f({bucket:null,logging:!0,maxConcurrentParts:5,partSize:6291456,retryBackoffPower:2,maxRetryBackoffSecs:300,progressIntervalMS:500,cloudfront:!1,s3Acceleration:!1,encodeFilename:!0,computeContentMd5:!1,allowS3ExistenceOptimization:!1,onlyRetryForSameFileName:!1,timeUrl:null,cryptoMd5Method:null,cryptoHexEncodedHash256:null,aws_key:null,awsRegion:null,awsSignatureVersion:"2",s3FileCacheHoursAgo:null,signParams:{},signHeaders:{},awsLambda:null,awsLambdaFunction:null,maxFileSize:null,signResponseHandler:null,xhrWithCredentials:!1,testUnsupported:!1,simulateStalling:!1,simulateErrors:!1,evaporateChanged:function(){}},o);if(console&&console.log&&(H=console,H.d=H.log,H.w=console.warn?H.warn:H.d,H.e=console.error?H.error:H.d),this.supported=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice)||o.testUnsupported),!B.bucket)return void H.e("The AWS 'bucket' option must be present.");if(!this.supported)return void H.e("The browser does not support the necessary features of File and Blob [webkitSlice || mozSlice || slice]");if(B.computeContentMd5){if(this.supported="undefined"!=typeof FileReader.prototype.readAsArrayBuffer,!this.supported)return void H.e("The browser's FileReader object does not support readAsArrayBuffer");if("function"!=typeof B.cryptoMd5Method)return void H.e("Option computeContentMd5 has been set but cryptoMd5Method is not defined.");if("4"===B.awsSignatureVersion&&"function"!=typeof B.cryptoHexEncodedHash256)return void H.e("Option awsSignatureVersion is 4 but cryptoHexEncodedHash256 is not defined.")}else if("4"===B.awsSignatureVersion)return void H.e("Option awsSignatureVersion is 4 but computeContentMd5 is not enabled.");B.logging||(H=s());var O,R={supported:function(){var e=!1;if("undefined"==typeof window)return e;if(!("localStorage"in window))return e;try{localStorage.setItem("___test","OK");var t=localStorage.getItem("___test");localStorage.removeItem("___test"),e="OK"===t}catch(t){return e}return e}(),getItem:function(e){if(this.supported)return localStorage.getItem(e)},setItem:function(e,t){if(this.supported)return localStorage.setItem(e,t)},clear:function(){if(this.supported)return localStorage.clear()},key:function(e){if(this.supported)return localStorage.key(e)},removeItem:function(e){if(this.supported)return localStorage.removeItem(e)}};B.s3Acceleration?(O=["https://",B.bucket,".s3-accelerate.amazonaws.com"].join(""),B.cloudfront=!0):O=B.aws_url||["https://",B.cloudfront?B.bucket+".":"","s3.amazonaws.com"].join("");var F=e(O).hostname,U=new Date,D=new Date(U.setHours(U.getHours()-(B.s3FileCacheHoursAgo||-100))),k=0;if(B.timeUrl){var N=new XMLHttpRequest;N.open("GET",B.timeUrl+"?requestTime="+(new Date).getTime()),N.onreadystatechange=function(){if(4===N.readyState&&200===N.status){var e=new Date(Date.parse(N.responseText)),t=new Date;k=t-e,H.d("localTimeOffset is",k,"ms")}},N.onerror=function(){H.e("xhr error timeUrl",N)},N.send()}M.add=function(e,t){var n=f(t,{});_.map(function(e){delete n[e]});var a=f(B,n);H.d("add");var r;if("undefined"==typeof e)return"Missing file";if(a.maxFileSize&&e.file.size>a.maxFileSize)return"File size too large. Maximum size allowed is "+a.maxFileSize;if("undefined"==typeof e.name?r="Missing attribute: name  ":a.encodeFilename&&(e.name=encodeURIComponent(e.name)),r)return r;var o=i(e,a);return d(),o},M.cancel=function(e){return H.d("cancel ",e),!!A[e]&&(A[e].stop(),!0)},M.pause=function(e,t){t=t||{};var n="undefined"!==t.force&&t.force,a=typeof e;"undefined"===a?(H.d("Pausing all file uploads"),A.forEach(function(e){[S,w,T].indexOf(e.status)>-1&&e.pause(n)})):"undefined"==typeof A[e]?H.w("Cannot pause a file that has not been added."):A[e].status===x?H.w("Cannot pause a file that is already paused. Status:",A[e].status):A[e].pause(n)},M.resume=function(e){var t=[x,I];"undefined"==typeof e?(H.d("Resuming all file uploads"),A.forEach(function(e){t.indexOf(e.status)>-1&&e.resume()})):"undefined"==typeof A[e]?H.w("Cannot pause a file that does not exist."):t.indexOf(A[e].status)===-1?H.w("Cannot resume a file that has not been paused. Status:",A[e].status):A[e].resume()},M.forceRetry=function(){}};"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof window&&(window.Evaporate=o)}();
//# sourceMappingURL=evaporate.min.js.map