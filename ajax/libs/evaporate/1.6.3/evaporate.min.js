!function(){"use strict";function e(e){var t=document.createElement("a");return t.href=e||"/",{protocol:t.protocol,hostname:t.hostname,pathname:t.pathname.replace(/(^\/?)/,"/"),port:t.port,search:"?"===t.search[0]?t.search.substr(1):t.search,hash:t.hash,host:t.host}}function t(e){return e?new Date(e).toISOString():""}function n(e,t,n){var r=e.slice?"slice":e.mozSlice?"mozSlice":"webkitSlice";return e[r](t,n)}function r(e){var t=new DOMParser,n=t.parseFromString(e.responseText,"text/html"),r=n.getElementsByTagName("Code"),a=n.getElementsByTagName("Message");return r=r&&r.length?r[0].innerHTML||r[0].textContent:"",a=a&&a.length?a[0].innerHTML||a[0].textContent:"",r.length?{code:r,msg:a}:{}}var a=new Date("2060-10-22"),o=function(o){function s(){return{d:function(){},w:function(){},e:function(){}}}function i(e,t){var n=O.length;return O.push(new p(f({started:function(){},progress:function(){},complete:function(){},cancelled:function(){},paused:function(){},resumed:function(){},pausing:function(){},info:function(){},warn:function(){},error:function(){},xAmzHeadersAtInitiate:{},notSignedHeadersAtInitiate:{},xAmzHeadersCommon:null,xAmzHeadersAtUpload:{},xAmzHeadersAtComplete:{}},e,{id:n,status:w,priority:0,onStatusChange:u,loadedBytes:0,sizeBytes:e.file.size,eTag:""}),t)),n}function u(){B.d("onFileUploadStatusChange"),l()}function d(e){var t=e.split("/"),n=[];return t.forEach(function(e){n.push(encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/,"%27"))}),n.join("/")}function l(){B.d("processQueue   length:",O.length);var e=-1,t=-1,n=!0;O.forEach(function(r,a){r.priority>t&&r.status===w&&(e=a,t=r.priority),r.status===S&&(n=!1)}),n&&e>=0&&O[e].start()}function p(t,o){function s(e){R=Math.max(0,R+e),o.evaporateChanged(He,R)}function i(e){De.indexOf(e.part)===-1&&(De.push(e.part),s(1))}function u(e){l(De,e)&&s(-1)}function d(e){l(Be,e.part),u(e.part),0===De.length&&He.status===_&&(He.status=b,He.paused())}function l(e,t){var n=e.indexOf(t);if(n>-1)return e.splice(n,1),!0}function p(e){[x,z,T,P,b].indexOf(e)>-1&&de(),He.status=e,He.onStatusChange()}function I(){var e=[];De.forEach(function(t){e.push(t)}),e.forEach(function(e){N(e,!0)}),se()}function H(){B.d("cancelAllRequests()"),J()}function O(e){e&&Y(),ue(),o.computeContentMd5&&He.file.size>0?X():$(),oe()}function U(e){var t,n={method:"POST",path:Pe()+"?uploads",step:"initiate",x_amz_headers:He.xAmzHeadersAtInitiate,not_signed_headers:He.notSignedHeadersAtInitiate},a=He.status;He.contentType&&(n.contentType=He.contentType),n.onErr=function(o){t||He.status===P||He.status===T||(t=!0,B.d("onInitiateError for FileUpload ",He.id),He.warn("Error initiating upload",r(o)),p(z),Ie(n),setTimeout(function(){He.status!==P&&He.status!==T&&(He.status=a,U(e))},ae(Fe++)))},n.on200=function(t){var r=t.response.match(/<UploadId>(.+)<\/UploadId>/);r&&r[1]?(He.uploadId=r[1],He.awsKey=e,B.d("requester success. got uploadId ",He.uploadId),Y(),O()):n.onErr(t)},le(n),pe(n),ue()}function F(e){var t,a,o,s;s=Oe[e],o={method:"PUT",path:Pe()+"?partNumber="+e+"&uploadId="+He.uploadId,step:"upload #"+e,x_amz_headers:He.xAmzHeadersCommon||He.xAmzHeadersAtUpload,md5_digest:s.md5_digest,contentSha256:"UNSIGNED-PAYLOAD",attempts:s.attempts,part:s},o.onErr=function(t,n){if(s.loadedBytes=0,s.status=z,!([T,P,b,_].indexOf(He.status)>-1))if(404===t.status){d(s);var i="404 error on part PUT. The part and the file will abort.";B.w(i," Server response: ",t.response),He.error(i),s.status=P,J()}else{var l="problem uploading part #"+e+",   http status: "+t.status+",   hasErrored: "+!!a+",   part status: "+s.status+",   readyState: "+t.readyState+(n?",   isOnError":"");B.w(l),He.warn(l);var p=r(t);if(p.code&&B.e('AWS Server response: code="'+p.code+'", message="'+p.msg+'"'),Ie(o),n||(u(s.part),oe()),a)return;a=!0}},o.on200=function(t){var n,r=t.getResponseHeader("ETag");B.d("uploadPart 200 response for part #",e,"ETag:",r),s.isEmpty||r!==C?(s.eTag=r,s.status=x,Re.push(s),je+=s.loadedBytes,d(s)):(s.status=z,s.loadedBytes=0,n=["eTag matches MD5 of 0 length blob for part #",e,"Retrying part."].join(" "),B.w(n),He.warn(n),u(s.part)),oe()},o.onProgress=function(e){s.loadedBytes=e.loaded},o.toSend=function(){var t=n(He.file,s.start,s.end);return B.d("part #",e,"( bytes",s.start,"->",s.end,")  reported length:",t.size),s.isEmpty||0!==t.size||B.w("  *** WARN: blob reporting size of 0 bytes. Will try upload anyway.."),t},o.onFailedAuth=function(){var t=["onFailedAuth for uploadPart #",e,"- Will set status to ERROR"].join(" ");B.w(t),He.warn(t),s.status=z,s.loadedBytes=0,u(e),oe()},t=ae(s.attempts),B.d("uploadPart #",e,"- will wait",t,"ms before",0===s.attempts?"submitting":"retrying"),setTimeout(function(){s.status!==x&&[P,b,T].indexOf(He.status)===-1&&De.indexOf(s.part)===-1&&(s.status=S,s.attempts+=1,s.loadedBytesPrevious=null,Ue+=1,le(o),Ie(o),i(s),pe(o),B.d("upload #",e,o))},t),s.uploader=o}function N(e,t){var n=Oe[e];n.currentXhr&&(t&&(n.currentXhr.onreadystatechange=function(){}),n.currentXhr.abort(),n.loadedBytes=0)}function V(){B.d("completeUpload"),He.info("will attempt to complete upload"),de();var e,t=[],n=He.status;t.push("<CompleteMultipartUpload>"),Oe.forEach(function(e,n){n>0&&t.push(["<Part><PartNumber>",n,"</PartNumber><ETag>",e.eTag,"</ETag></Part>"].join(""))}),t.push("</CompleteMultipartUpload>");var a={method:"POST",contentType:"application/xml; charset=UTF-8",path:Pe()+"?uploadId="+He.uploadId,x_amz_headers:He.xAmzHeadersCommon||He.xAmzHeadersAtComplete,step:"complete"};a.onErr=function(t){if(!e&&He.status!==P&&He.status!==T){e=!0;var a="Error completing upload.";B.w(a,r(t)),He.error(a),p(z),setTimeout(function(){He.status!==P&&He.status!==T&&(He.status=n,V())},ae(ke++))}},a.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("CompleteMultipartUploadResult")[0];He.eTag=v(n,"ETag"),He.complete(e,He.name),ee()},a.toSend=function(){return t.join("")},le(a),pe(a)}function W(e){B.d("headObject"),He.info("will attempt to verify existence of the file");var t={method:"HEAD",path:Pe(),x_amz_headers:He.xAmzHeadersCommon,step:"head_object"};t.onErr=function(){var t="Error completing headObject. Will re-upload file.";B.w(t),U(e)},t.on200=function(t){var n=t.getResponseHeader("Etag");n===He.eTag?(B.d("headObject found matching object on S3."),He.progress(1),He.complete(t,He.name),p(x)):(B.d("headObject not found on S3."),U(e))},le(t),pe(t)}function G(e){return function(){var t=He.status;if(!([z,T,P].indexOf(t)>-1)){var n=o.cryptoMd5Method.call(this,this.result);B.d("part #",e.part,"MD5 digest is",n),e.md5_digest=n,1===e.part&&$(),delete e.reader,Ne+=1,R<o.maxConcurrentParts&&oe(),Ne===Le&&B.d("All parts have MD5 digests"),setTimeout(X,o.processMd5ThrottlingMs)}}}function X(){for(var e=0;e<Be.length;e++){var t=Oe[Be[e]];if(null===t.md5_digest){Be[e]>1||"undefined"==typeof He.firstMd5Digest?(t.reader=new FileReader,t.reader.onloadend=G(t),t.reader.readAsArrayBuffer(n(He.file,t.start,t.end))):(t.md5_digest=He.firstMd5Digest,$(),setTimeout(X,o.processMd5ThrottlingMs));break}}}function J(){if(B.d("abortUpload"),He.info("will attempt to abort the upload"),I(),"undefined"==typeof He.uploadId)return void p(P);var e={method:"DELETE",path:Pe()+"?uploadId="+He.uploadId,x_amz_headers:He.xAmzHeadersCommon,step:"abort"};e.onErr=function(){var e="Error aborting upload.";B.w(e),He.error(e)},e.on200=function(){p(P),K()},le(e),pe(e)}function K(){B.d("listParts"),He.info("list parts");var e={method:"GET",path:Pe()+"?uploadId="+He.uploadId,x_amz_headers:He.xAmzHeadersCommon,step:"list"};e.onErr=function(e){if(404===e.status)te(),He.info("upload canceled"),je=0;else{var t="Error listing parts.";B.w(t,r(e)),He.error(t)}R=0,o.evaporateChanged(He,R)},e.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("Part");n.length?(B.d("Parts still found after abort...waiting."),setTimeout(function(){J()},o.abortCompletionThrottlingMs)):(je=0,He.info("upload canceled"))},le(e),pe(e)}function Q(e){var t=["getUploadParts() for uploadId starting at part #",e].join(" ");B.d(t),He.info(t);var n={method:"GET",path:Pe()+"?uploadId="+He.uploadId,query_string:"&part-number-marker="+e,x_amz_headers:He.xAmzHeadersCommon,step:"get upload parts"};"4"===o.awsSignatureVersion&&(n.path=[Pe(),"?uploadId=",He.uploadId,"&part-number-marker="+e].join("")),n.onErr=function(t){if(404===t.status)He.info(["uploadId ",He.uploadId," does not exist."].join("")),te(),ue(),Y(),oe();else{var n="Error listing parts for getUploadParts() starting at part # "+(e+1);B.w(n,r(t)),He.error(n)}},n.on200=function(t){He.info("uploadId",He.uploadId,"is not complete. Fetching parts from part marker",e);for(var n,r,a=c(t.responseText),o=a.getElementsByTagName("ListPartsResult")[0],s="true"===v(o,"IsTruncated"),i=a.getElementsByTagName("Part"),u=i.length,d=0;d<u;d++)n=i[d],r=parseInt(v(n,"Size"),10),je+=r,Re.push({eTag:v(n,"ETag"),partNumber:parseInt(v(n,"PartNumber"),10),size:r,LastModified:v(n,"LastModified")});if(s){var l=v(o,"NextPartNumberMarker");Q(l)}else Re.forEach(function(e){var t=Z(e.partNumber,x,e.size);t.eTag=e.eTag,t.attempts=1,t.loadedBytes=e.size,t.loadedBytesPrevious=e.size,t.finishedUploadingAt=e.LastModified,Oe[e.partNumber]=t}),Y(),ue(),O();o=null},le(n),pe(n)}function Y(){Le=Math.ceil(He.file.size/o.partSize)||1;for(var e=1;e<=Le;e++){var t="undefined"==typeof Oe[e]?w:Oe[e].status;t!==x&&(Oe[e]=Z(e,w,He.file.size),Be.push(e))}}function Z(e,t,n){return{status:t,start:(e-1)*o.partSize,end:e*o.partSize,attempts:0,loadedBytes:0,loadedBytesPrevious:null,isEmpty:0===n,md5_digest:null,part:e}}function $(){var e=g(He),t={awsKey:He.name,bucket:o.bucket,uploadId:He.uploadId,fileSize:He.file.size,fileType:He.file.type,partSize:o.partSize,signParams:o.signParams,createdAt:(new Date).toISOString()};o.computeContentMd5&&Le&&"undefined"!=typeof Oe[1].md5_digest&&(t.firstMd5Digest=Oe[1].md5_digest),h(e,t)}function ee(){var e=m(),t=e[g(He)];"undefined"!=typeof t&&(t.completedAt=(new Date).toISOString(),t.eTag=He.eTag,k.setItem("awsUploads",JSON.stringify(e))),p(x),He.progress(1)}function te(){"undefined"!=typeof He.file&&y(g(He))}function ne(){var e=m(!0),t=e[g(He)];re(t)&&(He.uploadId=t.uploadId,He.name=t.awsKey,He.eTag=t.eTag,He.firstMd5Digest=t.firstMd5Digest,He.signParams=t.signParams)}function re(e){if("undefined"==typeof e)return!1;var t=new Date(e.completedAt||a);return o.partSize===e.partSize&&t>L&&o.bucket===e.bucket&&(!o.onlyRetryForSameFileName||He.name===e.awsKey)}function ae(e){return 1===e?0:1e3*Math.min(o.maxRetryBackoffSecs,Math.pow(o.retryBackoffPower,e-2))}function oe(){if(Le===Re.length)return void([x,E].indexOf(He.status)===-1&&(He.status=E,V()));var e=[],t=[],n=o.maxConcurrentParts-R;if(0!==n){if(He.status!==S)return void He.info("will not process parts list, as not currently evaporating");for(var r=0;r<Be.length;r++){var a=Oe[Be[r]];if(o.computeContentMd5&&null===a.md5_digest)return;if(e.push(a.status),a.status===S)t.push(a.loadedBytes);else if(R<o.maxConcurrentParts&&De.indexOf(a.part)===-1&&F(a.part),n-=1,0===n)break}t.length?A===M.offline&&(B.d("processPartsList() Back online."),A=M.online):(B.w("processPartsList() No bytes loaded for any parts. We may be offline."),A===M.online&&(A=M.offline));var s=e.toString()+" // bytesLoaded: "+t.toString();B.d("processPartsList(): ",s),Ue>=Le&&He.info("part stati:",s)}}function se(){clearInterval(Me),Me=setInterval(function(){var e=je;De.forEach(function(t){e+=Oe[t].loadedBytes}),He.progress(e/He.sizeBytes)},o.progressIntervalMS)}function ie(){clearInterval(Ae),Ae=setInterval(function(){B.d("monitorPartsProgress()"),De.forEach(function(e){var t,n=Oe[e];return null===n.loadedBytesPrevious?void(n.loadedBytesPrevious=n.loadedBytes):(t=n.loadedBytesPrevious<n.loadedBytes,o.simulateStalling&&4===e&&Math.random()<.25&&(t=!1),B.d(e,t?"moving.":"stalled.",n.loadedBytesPrevious,n.loadedBytes),t||setTimeout(function(){He.info("part #"+e," stalled. will abort.",n.loadedBytesPrevious,n.loadedBytes),N(e),n.status=w,u(e),oe()},0),void(n.loadedBytesPrevious=n.loadedBytes))})},A)}function ue(){se(),ie()}function de(){clearInterval(Me),clearInterval(Ae)}function le(e){e.getPayload=function(){return e.toSend?e.toSend():null},e.getPayloadSha256Content=function(){var t=e.contentSha256||o.cryptoHexEncodedHash256(e.getPayload()||"");return B.d("getPayloadSha256Content",t),t},B.d("setupRequest()",e);var t=o.timeUrl?new Date((new Date).getTime()+q):new Date;"4"===o.awsSignatureVersion?e.dateString=t.toISOString().slice(0,19).replace(/-|:/g,"")+"Z":e.dateString=t.toUTCString(),e.x_amz_headers=f(e.x_amz_headers,{"x-amz-date":e.dateString}),e.onGotAuth=function(){function t(e){return e.status>=200&&e.status<=299}if(Ee(e)){var n=["onGotAuth() step #",e.step,"is already in progress. Returning."].join(" ");return B.d(n),void B.w(n)}var r=Ce(e),a=e.getPayload(),s=D+e.path,i={};e.query_string&&(s+=e.query_string),f(i,e.not_signed_headers),f(i,e.x_amz_headers),o.simulateErrors&&1===e.attempts&&"upload #3"===e.step&&(B.d("simulating error by POST part #3 to invalid url"),s="https:///foo"),r.open(e.method,s),r.setRequestHeader("Authorization",he(e));for(var u in i)i.hasOwnProperty(u)&&r.setRequestHeader(u,i[u]);"4"===o.awsSignatureVersion&&r.setRequestHeader("x-amz-content-sha256",e.getPayloadSha256Content()),e.contentType&&r.setRequestHeader("Content-Type",e.contentType),e.md5_digest&&r.setRequestHeader("Content-MD5",e.md5_digest),r.onreadystatechange=function(){4===r.readyState&&(a&&B.d("  ###",a.size),e[t(r)?"on200":"onErr"](r),0===r.status&&(r.onreadystatechange=function(){},r.abort()),Ie(e))},r.onerror=function(){e.onErr(r,!0),Ie(e)},"function"==typeof e.onProgress&&(r.upload.onprogress=function(t){e.onProgress(t)}),r.send(a)},e.onFailedAuth=e.onFailedAuth||function(t){He.error("Error onFailedAuth for step: "+e.step),e.onErr(t)}}function pe(e){function t(t){var r=["failed to get authorization (",t,") for",e.step,"-  xhr.status:",n.status,".-  xhr.response:",n.response].join(" ");B.w(r),He.warn(r),e.onFailedAuth(n)}if(Ee(e))return void B.w("authorizedSend() step",e.step,"is already in progress. Returning.");if(B.d("authorizedSend()",e.step),o.awsLambda)return fe(e);var n=Ce(e),r=ce(e),a=[o.signerUrl,"?to_sign=",r,"&datetime=",e.dateString].join("");if("undefined"==typeof o.signerUrl)return e.auth=me(null,r,e.dateString),Ie(e),void e.onGotAuth();var s=ge(He.signParams);for(var i in s)s.hasOwnProperty(i)&&(a+="&"+encodeURIComponent(i)+"="+encodeURIComponent(s[i]));o.xhrWithCredentials&&(n.withCredentials=!0),n.onreadystatechange=function(){if(4===n.readyState){var r="readyState===4";if(200===n.status){var a=me(n.response);Ie(e),"2"===o.awsSignatureVersion&&28!==a.length?t(r):(B.d("authorizedSend got signature for:",e.step,"- signature:",a),e.auth=a,e.onGotAuth())}else n.onerror(r)}},n.onerror=function(e){t(e||"onerror")},n.open("GET",a);var u=ge(o.signHeaders);for(var d in u)u.hasOwnProperty(d)&&n.setRequestHeader(d,u[d]);"function"==typeof He.beforeSigner&&He.beforeSigner(n,a),n.send()}function fe(e){o.awsLambda.invoke({FunctionName:o.awsLambdaFunction,InvocationType:"RequestResponse",Payload:JSON.stringify({to_sign:ye(e),sign_params:ge(He.signParams),sign_headers:ge(o.signHeaders)})},function(t,n){if(t){var r="failed to get authorization with lambda "+t;return B.w(r),He.warn(r),void e.onFailedAuth(t)}e.auth=me(JSON.parse(n.Payload)),e.onGotAuth()})}function ce(e){return encodeURIComponent("4"===o.awsSignatureVersion?ve(e):ye(e))}function me(e,t,n){return"function"==typeof o.signResponseHandler&&(e=o.signResponseHandler(e,t,n)||e),e}function ge(e){var t={};for(var n in e)e.hasOwnProperty(n)&&("function"==typeof e[n]?t[n]=e[n]():t[n]=e[n]);return t}function he(e){return"4"===o.awsSignatureVersion?Se(e):we(e)}function ye(e){var t,n="",r=[];for(var a in e.x_amz_headers)e.x_amz_headers.hasOwnProperty(a)&&r.push(a);return r.sort(),r.forEach(function(t){n+=t+":"+e.x_amz_headers[t]+"\n"}),t=e.method+"\n"+(e.md5_digest||"")+"\n"+(e.contentType||"")+"\n\n"+n+(o.cloudfront?"/"+o.bucket:"")+e.path,B.d("makeStringToSign (V2)",t),t}function ve(e){var t=[];t.push("AWS4-HMAC-SHA256"),t.push(e.dateString),t.push(xe(e)),t.push(o.cryptoHexEncodedHash256(be(e)));var n=t.join("\n");return B.d("makeStringToSign (V4)",n),n}function we(e){return["AWS ",o.aws_key,":",e.auth].join("")}function Se(e){var t=[],n=xe(e),r=ze(e);return t.push(["AWS4-HMAC-SHA256 Credential=",o.aws_key,"/",n].join("")),t.push("SignedHeaders="+r.signedHeaders),t.push("Signature="+e.auth),t.join(", ")}function xe(e){var t=[];return t.push(e.dateString.slice(0,8)),t.push(o.awsRegion),t.push("s3"),t.push("aws4_request"),t.join("/")}function be(t){var n=[];n.push(t.method),n.push(e(t.path).pathname),n.push(Te(t)||"");var r=ze(t);n.push(r.canonicalHeaders+"\n"),n.push(r.signedHeaders),n.push(t.getPayloadSha256Content());var a=n.join("\n");return B.d("CanonicalRequest (V4)",a),a}function Te(t){var n,r,a=e(t.path).search,o=a.length?a.split("&"):[],s=[];for(r=0;r<o.length;r++)n=o[r].split("="),s.push({name:encodeURIComponent(n[0]),value:n.length>1?encodeURIComponent(n[1]):null});var i=s.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),u=[];for(r=0;r<i.length;r++)n=i[r].value?[i[r].name,i[r].value].join("="):i[r].name+"=",u.push(n);return u.join("&")}function ze(e){function t(e,t){var n=e.toLowerCase();a.push(n),r[n]=t.replace(/\s+/g," ")}var n,r=[],a=[];e.md5_digest&&t("Content-Md5",e.md5_digest),t("Host",j),e.contentType&&t("Content-Type",e.contentType||"");var o=e.x_amz_headers||{};for(var s in o)o.hasOwnProperty(s)&&t(s,o[s]);var i=a.sort(function(e,t){return e<t?-1:e>t?1:0}),u=[],d=[],l=e.not_signed_headers||[],p=[];for(n=0;n<l.length;n++)d.push(l[n].toLowerCase());for(n=0;n<i.length;n++){var f=i[n];u.push([f,r[f]].join(":")),d.indexOf(f)===-1&&p.push(f)}return{canonicalHeaders:u.join("\n"),signedHeaders:p.join(";")}}function Pe(){var e="/"+o.bucket+"/"+He.name;return(o.cloudfront||D.indexOf("cloudfront")>-1)&&(e="/"+He.name),e}function _e(e){return"undefined"==typeof e.part?e:e.part}function Ee(e){return!!_e(e).currentXhr}function Ce(e){return _e(e).currentXhr=new XMLHttpRequest}function Ie(e){delete _e(e).currentXhr}var Me,Ae,He=this,Oe=[],Re=[],Be=[],Ue=0,Fe=0,ke=0,De=[],je=0;f(He,t),He.signParams=o.signParams,He.start=function(){if(B.d("starting FileUpload",He.id),He.started(He.id),He.status!==P){p(S);var e=He.name;if(ne(),"undefined"==typeof He.uploadId)U(e);else if("undefined"!=typeof He.eTag&&He.firstMd5Digest&&o.computeContentMd5){var t=new FileReader;t.onloadend=function(){var t=o.cryptoMd5Method.call(this,this.result);o.allowS3ExistenceOptimization&&He.firstMd5Digest===t?W(e):(He.firstMd5Digest=t,U(e))},t.readAsArrayBuffer(n(He.file,0,o.partSize))}else Re.length?O(!1):Q(0)}},He.stop=function(){B.d("stopping FileUpload ",He.id),He.cancelled(),p(T),He.info("Canceling uploads..."),H()},He.pause=function(e){B.d("pausing FileUpload ",He.id),He.info("Pausing uploads..."),e?(B.d("Pausing requests to force abort parts that are evaporating"),I(),p(b),He.paused()):(p(_),He.pausing())},He.resume=function(){[_,b].indexOf(He.status)>-1&&(B.d("resuming FileUpload ",He.id),p(w),He.resumed())};var Ne=0,Le=-1}function f(e,t,n){function r(e,t){if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}return e=e||{},r(t,n),r(e,t),e}function c(e){var t=new DOMParser;return t.parseFromString(e,"text/xml")}function m(e){var t=JSON.parse(k.getItem("awsUploads")||"{}");if(e){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],o=new Date(r.completedAt||a);o<L&&delete t[n]}k.setItem("awsUploads",JSON.stringify(t))}return t}function g(e){return[e.file.name,e.file.type,t(e.file.lastModified),e.file.size].join("-")}function h(e,t){var n=m();n[e]=t,k.setItem("awsUploads",JSON.stringify(n))}function y(e){var t=m();delete t[e],k.setItem("awsUploads",JSON.stringify(t))}function v(e,t){return e.getElementsByTagName(t)[0].textContent}var w=0,S=2,x=3,b=4,T=5,z=10,P=20,_=30,E=40,C='"d41d8cd98f00b204e9800998ecf8427e"',I=["maxConcurrentParts","logging","cloudfront","aws_url","encodeFilename","computeContentMd5","allowS3ExistenceOptimization","onlyRetryForSameFileName","timeUrl","cryptoMd5Method","cryptoHexEncodedHash256","aws_key","awsRegion","awsSignatureVersion","evaporateChanged"],M={online:12e4,offline:2e4},A=M.online,H=this,O=[],R=0,B=s(),U=f({bucket:null,logging:!0,maxConcurrentParts:5,partSize:6291456,retryBackoffPower:2,maxRetryBackoffSecs:300,progressIntervalMS:500,cloudfront:!1,s3Acceleration:!1,encodeFilename:!0,computeContentMd5:!1,allowS3ExistenceOptimization:!1,onlyRetryForSameFileName:!1,timeUrl:null,cryptoMd5Method:null,cryptoHexEncodedHash256:null,aws_key:null,awsRegion:"us-east-1",awsSignatureVersion:"2",s3FileCacheHoursAgo:null,signParams:{},signHeaders:{},awsLambda:null,awsLambdaFunction:null,maxFileSize:null,signResponseHandler:null,xhrWithCredentials:!1,testUnsupported:!1,simulateStalling:!1,simulateErrors:!1,evaporateChanged:function(){},processMd5ThrottlingMs:1500,abortCompletionThrottlingMs:1e3},o);if("undefined"!=typeof window&&window.console&&(B=window.console,B.d=B.log,B.w=window.console.warn?B.warn:B.d,B.e=window.console.error?B.error:B.d),this.supported=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice)||o.testUnsupported),!U.signerUrl&&"function"!=typeof U.signResponseHandler)return void B.e("Option signerUrl is required unless signResponseHandler is present.");if(!U.bucket)return void B.e("The AWS 'bucket' option must be present.");if(!this.supported)return void B.e("The browser does not support the necessary features of File and Blob [webkitSlice || mozSlice || slice]");if(U.computeContentMd5){if(this.supported="undefined"!=typeof FileReader.prototype.readAsArrayBuffer,!this.supported)return void B.e("The browser's FileReader object does not support readAsArrayBuffer");if("function"!=typeof U.cryptoMd5Method)return void B.e("Option computeContentMd5 has been set but cryptoMd5Method is not defined.");if("4"===U.awsSignatureVersion&&"function"!=typeof U.cryptoHexEncodedHash256)return void B.e("Option awsSignatureVersion is 4 but cryptoHexEncodedHash256 is not defined.")}else if("4"===U.awsSignatureVersion)return void B.e("Option awsSignatureVersion is 4 but computeContentMd5 is not enabled.");U.logging||(B=s());var F,k={supported:function(){var e=!1;if("undefined"==typeof window)return e;if(!("localStorage"in window))return e;try{localStorage.setItem("___test","OK");var t=localStorage.getItem("___test");localStorage.removeItem("___test"),e="OK"===t}catch(t){return e}return e}(),getItem:function(e){if(this.supported)return localStorage.getItem(e)},setItem:function(e,t){if(this.supported)return localStorage.setItem(e,t)},clear:function(){if(this.supported)return localStorage.clear()},key:function(e){if(this.supported)return localStorage.key(e)},removeItem:function(e){if(this.supported)return localStorage.removeItem(e)}};U.aws_url?F=[U.aws_url]:(U.s3Acceleration?(F=["https://",U.bucket,".s3-accelerate"],U.cloudfront=!0):(F=["https://",U.cloudfront?U.bucket+".":"","s3"],"us-east-1"!==U.awsRegion&&F.push("-",U.awsRegion)),F.push(".amazonaws.com"));var D=F.join(""),j=e(D).hostname,N=new Date,L=new Date(N.setHours(N.getHours()-(U.s3FileCacheHoursAgo||-100))),q=0;if(U.timeUrl){var V=new XMLHttpRequest;V.open("GET",U.timeUrl+"?requestTime="+(new Date).getTime()),V.onreadystatechange=function(){if(4===V.readyState&&200===V.status){var e=new Date(Date.parse(V.responseText)),t=new Date;q=e-t,B.d("localTimeOffset is",q,"ms")}},V.onerror=function(){B.e("xhr error timeUrl",V)},V.send()}H.add=function(e,t){var n=f(t,{});I.map(function(e){delete n[e]});var r=f(U,n);B.d("add");var a;if("undefined"==typeof e)return"Missing file";if(r.maxFileSize&&e.file.size>r.maxFileSize)return"File size too large. Maximum size allowed is "+r.maxFileSize;if("undefined"==typeof e.name?a="Missing attribute: name  ":r.encodeFilename&&(e.name=d(e.name)),a)return a;var o=i(e,r);return setTimeout(l,1),o},H.cancel=function(e){return B.d("cancel ",e),!!O[e]&&(O[e].stop(),!0)},H.pause=function(e,t){t=t||{};var n="undefined"!==t.force&&t.force,r=typeof e;"undefined"===r?(B.d("Pausing all file uploads"),O.forEach(function(e){[w,S,z].indexOf(e.status)>-1&&e.pause(n)})):"undefined"==typeof O[e]?B.w("Cannot pause a file that has not been added."):O[e].status===b?B.w("Cannot pause a file that is already paused. Status:",O[e].status):O[e].pause(n)},H.resume=function(e){var t=[b,_];"undefined"==typeof e?(B.d("Resuming all file uploads"),O.forEach(function(e){t.indexOf(e.status)>-1&&e.resume()})):"undefined"==typeof O[e]?B.w("Cannot pause a file that does not exist."):t.indexOf(O[e].status)===-1?B.w("Cannot resume a file that has not been paused. Status:",O[e].status):O[e].resume()},H.forceRetry=function(){}};"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof window&&(window.Evaporate=o)}();
//# sourceMappingURL=evaporate.min.js.map