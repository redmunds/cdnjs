!function(){"use strict";function e(e){var t=document.createElement("a");return t.href=e||"/",{protocol:t.protocol,hostname:t.hostname,pathname:t.pathname.replace(/(^\/?)/,"/"),port:t.port,search:"?"===t.search[0]?t.search.substr(1):t.search,hash:t.hash,host:t.host}}function t(e){return e?e.toISOString():""}function n(e,t,n){var a=e.slice?"slice":e.mozSlice?"mozSlice":"webkitSlice";return e[a](t,n)}function a(e){var t=new DOMParser,n=t.parseFromString(e.responseText,"text/html"),a=n.getElementsByTagName("Code"),r=n.getElementsByTagName("Message");return a=a&&a.length?a[0].innerHTML:"",r=r&&r.length?r[0].innerHTML:"",a.length?{code:a,msg:r}:{}}var r=new Date("2060-10-22"),o=function(o){function s(){return{d:function(){},w:function(){},e:function(){}}}function i(e,t){var n=H.length;return H.push(new p(f({started:function(){},progress:function(){},complete:function(){},cancelled:function(){},paused:function(){},resumed:function(){},pausing:function(){},info:function(){},warn:function(){},error:function(){},xAmzHeadersAtInitiate:{},notSignedHeadersAtInitiate:{},xAmzHeadersAtUpload:{},xAmzHeadersAtComplete:{}},e,{id:n,status:w,priority:0,onStatusChange:u,loadedBytes:0,sizeBytes:e.file.size,eTag:""}),t)),n}function u(){B.d("onFileUploadStatusChange"),l()}function d(e){var t=e.split("/"),n=[];return t.forEach(function(e){n.push(encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29"))}),n.join("/")}function l(){B.d("processQueue   length:",H.length);var e=-1,t=-1,n=!0;H.forEach(function(a,r){a.priority>t&&a.status===w&&(e=r,t=a.priority),a.status===S&&(n=!1)}),n&&e>=0&&H[e].start()}function p(o,s){function i(e){O=Math.max(0,O+e),s.evaporateChanged(He,O)}function u(e){ke.indexOf(e.part)===-1&&(ke.push(e.part),i(1))}function d(e){p(ke,e)&&i(-1)}function l(e){p(Re,e.part),d(e.part),0===ke.length&&He.status===I&&(He.status=P,He.paused())}function p(e,t){var n=e.indexOf(t);if(n>-1)return e.splice(n,1),!0}function _(e){[b,x,T,E,P].indexOf(e)>-1&&de(),He.status=e,He.onStatusChange()}function C(){var e=[];ke.forEach(function(t){e.push(t)}),e.forEach(function(e){q(e,!0)}),se()}function H(){B.d("cancelAllRequests()"),J()}function R(){s.computeContentMd5&&He.file.size>0?X():$(),oe()}function U(e){var t,n={method:"POST",path:Ee()+"?uploads",step:"initiate",x_amz_headers:He.xAmzHeadersAtInitiate,not_signed_headers:He.notSignedHeadersAtInitiate},r=He.status;He.contentType&&(n.contentType=He.contentType),n.onErr=function(o){t||He.status===E||He.status===T||(t=!0,B.d("onInitiateError for FileUpload ",He.id),He.warn("Error initiating upload",a(o)),_(x),o.abort(),Me(n),setTimeout(function(){He.status!==E&&He.status!==T&&(He.status=r,U(e))},re(Fe++)))},n.on200=function(t){var a=t.response.match(/<UploadId>(.+)<\/UploadId>/);a&&a[1]?(He.uploadId=a[1],He.awsKey=e,B.d("requester success. got uploadId ",He.uploadId),Y(),R()):n.onErr(t)},le(n),pe(n),ue()}function j(e){var t,r,o,s;s=Oe[e],o={method:"PUT",path:Ee()+"?partNumber="+e+"&uploadId="+He.uploadId,step:"upload #"+e,x_amz_headers:He.xAmzHeadersAtUpload,md5_digest:s.md5_digest,contentSha256:"UNSIGNED-PAYLOAD",attempts:s.attempts,part:s},o.onErr=function(t,n){if(s.loadedBytes=0,s.status=x,!([T,E,P,I].indexOf(He.status)>-1))if(404===t.status){l(s);var i="404 error on part PUT. The part and the file will abort.";B.w(i," Server response: ",t.response),He.error(i),s.status=E,J()}else{var u="problem uploading part #"+e+",   http status: "+t.status+",   hasErrored: "+!!r+",   part status: "+s.status+",   readyState: "+t.readyState+(n?",   isOnError":"");B.w(u),He.warn(u);var p=a(t);if(p.code&&B.e('AWS Server response: code="'+p.code+'", message="'+p.msg+'"'),t.abort(),Me(o),n||(d(s.part),oe()),r)return;r=!0}},o.on200=function(t){var n,a=t.getResponseHeader("ETag");B.d("uploadPart 200 response for part #",e,"ETag:",a),s.isEmpty||a!==z?(s.eTag=a,s.status=b,Be.push(s),je+=s.loadedBytes,l(s)):(s.status=x,s.loadedBytes=0,n=["eTag matches MD5 of 0 length blob for part #",e,"Retrying part."].join(" "),B.w(n),He.warn(n),d(s.part)),oe()},o.onProgress=function(e){s.loadedBytes=e.loaded},o.toSend=function(){var t=n(He.file,s.start,s.end);return B.d("part #",e,"( bytes",s.start,"->",s.end,")  reported length:",t.size),s.isEmpty||0!==t.size||B.w("  *** WARN: blob reporting size of 0 bytes. Will try upload anyway.."),t},o.onFailedAuth=function(){var t=["onFailedAuth for uploadPart #",e,"- Will set status to ERROR"].join(" ");B.w(t),He.warn(t),s.status=x,s.loadedBytes=0,d(e),oe()},t=re(s.attempts),B.d("uploadPart #",e,"- will wait",t,"ms before",0===s.attempts?"submitting":"retrying"),setTimeout(function(){s.status!==b&&[E,P,T].indexOf(He.status)===-1&&ke.indexOf(s.part)===-1&&(s.status=S,s.attempts+=1,s.loadedBytesPrevious=null,Ue+=1,le(o),Me(o),u(s),pe(o),B.d("upload #",e,o))},t),s.uploader=o}function q(e,t){var n=Oe[e];n.currentXhr&&(t&&(n.currentXhr.onreadystatechange=function(){}),n.currentXhr.abort(),n.loadedBytes=0)}function V(){B.d("completeUpload"),He.info("will attempt to complete upload"),de();var e,t=[],n=He.status;t.push("<CompleteMultipartUpload>"),Oe.forEach(function(e,n){n>0&&t.push(["<Part><PartNumber>",n,"</PartNumber><ETag>",e.eTag,"</ETag></Part>"].join(""))}),t.push("</CompleteMultipartUpload>");var r={method:"POST",contentType:"application/xml; charset=UTF-8",path:Ee()+"?uploadId="+He.uploadId,x_amz_headers:He.xAmzHeadersAtComplete,step:"complete"};r.onErr=function(t){if(!e&&He.status!==E&&He.status!==T){e=!0;var r="Error completing upload.";B.w(r,a(t)),He.error(r),_(x),t.abort(),setTimeout(function(){He.status!==E&&He.status!==T&&(He.status=n,V())},re(De++))}},r.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("CompleteMultipartUploadResult")[0];He.eTag=v(n,"ETag"),He.complete(e,He.name),ee()},r.toSend=function(){return t.join("")},le(r),pe(r)}function W(e){B.d("headObject"),He.info("will attempt to verify existence of the file");var t={method:"HEAD",path:Ee(),step:"head_object"};t.onErr=function(){var t="Error completing headObject. Will re-upload file.";B.w(t),U(e)},t.on200=function(t){var n=t.getResponseHeader("Etag");n===He.eTag?(B.d("headObject found matching object on S3."),He.progress(1),He.complete(t,He.name),_(b)):(B.d("headObject not found on S3."),U(e))},le(t),pe(t)}function G(e){return function(){var t=He.status;if(!([x,T,E].indexOf(t)>-1)){var n=s.cryptoMd5Method.call(this,this.result);B.d("part #",e.part,"MD5 digest is",n),e.md5_digest=n,1===e.part&&$(),delete e.reader,Ne+=1,O<s.maxConcurrentParts&&oe(),Ne===Le&&B.d("All parts have MD5 digests"),setTimeout(X,1500)}}}function X(){for(var e=0;e<Re.length;e++){var t=Oe[Re[e]];if(null===t.md5_digest){Re[e]>1||"undefined"==typeof He.firstMd5Digest?(t.reader=new FileReader,t.reader.onloadend=G(t),t.reader.readAsArrayBuffer(n(He.file,t.start,t.end))):(t.md5_digest=He.firstMd5Digest,$(),setTimeout(X,1500));break}}}function J(){if(B.d("abortUpload"),He.info("will attempt to abort the upload"),C(),"undefined"==typeof He.uploadId)return void _(E);var e={method:"DELETE",path:Ee()+"?uploadId="+He.uploadId,step:"abort"};e.onErr=function(){var e="Error aborting upload.";B.w(e),He.error(e)},e.on200=function(){_(E),K()},le(e),pe(e)}function K(){B.d("listParts"),He.info("list parts");var e={method:"GET",path:Ee()+"?uploadId="+He.uploadId,step:"list"};e.onErr=function(e){if(404===e.status)te(),He.info("upload canceled"),je=0;else{var t="Error listing parts.";B.w(t,a(e)),He.error(t)}O=0,s.evaporateChanged(He,O)},e.on200=function(e){var t=c(e.responseText),n=t.getElementsByTagName("Part");n.length?(B.d("Parts still found after abort...waiting."),setTimeout(function(){J()},1e3)):(je=0,He.info("upload canceled"))},le(e),pe(e)}function Q(e){var t=["getUploadParts() for uploadId starting at part #",e].join(" ");B.d(t),He.info(t),Be=[];var n={method:"GET",path:Ee()+"?uploadId="+He.uploadId,query_string:"&part-number-marker="+e,step:"get upload parts"};"4"===s.awsSignatureVersion&&(n.path=[Ee(),"?uploadId=",He.uploadId,"&part-number-marker="+e].join("")),n.onErr=function(t){if(404===t.status)He.info(["uploadId ",He.uploadId," does not exist."].join("")),te(),ue(),Y(),oe();else{var n="Error listing parts for getUploadParts() starting at part # "+e;B.w(n,a(t)),He.error(n)}},n.on200=function(t){He.info("uploadId",He.uploadId,"is not complete. Fetching parts from part marker",e);for(var n,a,r=c(t.responseText),o=r.getElementsByTagName("ListPartsResult")[0],s="true"===v(o,"IsTruncated"),i=r.getElementsByTagName("Part"),u=i.length,d=0;d<u;d++)n=i[d],a=parseInt(v(n,"Size"),10),je+=a,Be.push({eTag:v(n,"ETag"),partNumber:parseInt(v(n,"PartNumber"),10),size:a,LastModified:v(n,"LastModified")});if(s){var l=v(o,"NextPartNumberMarker");Q(l)}else Be.forEach(function(e){var t=Z(e.partNumber,b,e.size);t.eTag=e.eTag,t.attempts=1,t.loadedBytes=e.size,t.loadedBytesPrevious=e.size,t.finishedUploadingAt=e.LastModified,Oe[e.partNumber]=t}),Y(),ue(),R();o=null},le(n),pe(n)}function Y(){Le=Math.ceil(He.file.size/s.partSize)||1;for(var e=1;e<=Le;e++){var t="undefined"==typeof Oe[e]?w:Oe[e].status;t!==b&&(Oe[e]=Z(e,w,He.file.size),Re.push(e))}}function Z(e,t,n){return{status:t,start:(e-1)*s.partSize,end:e*s.partSize,attempts:0,loadedBytes:0,loadedBytesPrevious:null,isEmpty:0===n,md5_digest:null,part:e}}function $(){var e=m(He),n={awsKey:He.name,bucket:s.bucket,uploadId:He.uploadId,fileSize:He.file.size,fileType:He.file.type,lastModifiedDate:t(He.file.lastModifiedDate),partSize:s.partSize,signParams:s.signParams,createdAt:(new Date).toISOString()};s.computeContentMd5&&Le&&"undefined"!=typeof Oe[1].md5_digest&&(n.firstMd5Digest=Oe[1].md5_digest),h(e,n)}function ee(){var e=g(),t=e[m(He)];"undefined"!=typeof t&&(t.completedAt=(new Date).toISOString(),t.eTag=He.eTag,F.setItem("awsUploads",JSON.stringify(e))),_(b),He.progress(1)}function te(){"undefined"!=typeof He.file&&y(m(He))}function ne(){var e=g(!0),t=e[m(He)];ae(t)&&(He.uploadId=t.uploadId,He.name=t.awsKey,He.eTag=t.eTag,He.firstMd5Digest=t.firstMd5Digest,He.signParams=t.signParams)}function ae(e){if("undefined"==typeof e)return!1;var t=new Date(e.completedAt||r);return s.partSize===e.partSize&&t>N&&s.bucket===e.bucket&&(!s.onlyRetryForSameFileName||He.name===e.awsKey)}function re(e){return 1===e?0:1e3*Math.min(s.maxRetryBackoffSecs,Math.pow(s.retryBackoffPower,e-2))}function oe(){if(Le===Be.length)return void V();var e=[],t=[],n=s.maxConcurrentParts-O;if(0!==n){if(He.status!==S)return void He.info("will not process parts list, as not currently evaporating");for(var a=0;a<Re.length;a++){var r=Oe[Re[a]];if(s.computeContentMd5&&null===r.md5_digest)return;if(e.push(r.status),r.status===S)t.push(r.loadedBytes);else if(O<s.maxConcurrentParts&&ke.indexOf(r.part)===-1&&j(r.part),n-=1,0===n)break}t.length?A===M.offline&&(B.d("processPartsList() Back online."),A=M.online):(B.w("processPartsList() No bytes loaded for any parts. We may be offline."),A===M.online&&(A=M.offline));var o=e.toString()+" // bytesLoaded: "+t.toString();B.d("processPartsList(): ",o),Ue>=Le&&He.info("part stati:",o)}}function se(){clearInterval(Ae),Ae=setInterval(function(){var e=je;ke.forEach(function(t){e+=Oe[t].loadedBytes}),He.progress(e/He.sizeBytes)},s.progressIntervalMS)}function ie(){clearInterval(Ce),Ce=setInterval(function(){B.d("monitorPartsProgress()"),ke.forEach(function(e){var t,n=Oe[e];return null===n.loadedBytesPrevious?void(n.loadedBytesPrevious=n.loadedBytes):(t=n.loadedBytesPrevious<n.loadedBytes,s.simulateStalling&&4===e&&Math.random()<.25&&(t=!1),B.d(e,t?"moving.":"stalled.",n.loadedBytesPrevious,n.loadedBytes),t||setTimeout(function(){He.info("part #"+e," stalled. will abort.",n.loadedBytesPrevious,n.loadedBytes),q(e),n.status=w,d(e),oe()},0),void(n.loadedBytesPrevious=n.loadedBytes))})},A)}function ue(){se(),ie()}function de(){clearInterval(Ae),clearInterval(Ce)}function le(e){e.getPayload=function(){return e.toSend?e.toSend():null},e.getPayloadSha256Content=function(){var t=e.contentSha256||s.cryptoHexEncodedHash256(e.getPayload()||"");return B.d("getPayloadSha256Content",t),t},B.d("setupRequest()",e);var t=s.timeUrl?new Date((new Date).getTime()+L):new Date;"4"===s.awsSignatureVersion?e.dateString=t.toISOString().slice(0,19).replace(/-|:/g,"")+"Z":e.dateString=t.toUTCString(),e.x_amz_headers=f(e.x_amz_headers,{"x-amz-date":e.dateString}),e.onGotAuth=function(){function t(e){return e.status>=200&&e.status<=299}if(ze(e)){var n=["onGotAuth() step #",e.step,"is already in progress. Returning."].join(" ");return B.d(n),void B.w(n)}var a=_e(e),r=e.getPayload(),o=D+e.path,i={};e.query_string&&(o+=e.query_string),f(i,e.not_signed_headers),f(i,e.x_amz_headers),s.simulateErrors&&1===e.attempts&&"upload #3"===e.step&&(B.d("simulating error by POST part #3 to invalid url"),o="https:///foo"),a.open(e.method,o),a.setRequestHeader("Authorization",he(e));for(var u in i)i.hasOwnProperty(u)&&a.setRequestHeader(u,i[u]);"4"===s.awsSignatureVersion&&a.setRequestHeader("x-amz-content-sha256",e.getPayloadSha256Content()),e.contentType&&a.setRequestHeader("Content-Type",e.contentType),e.md5_digest&&a.setRequestHeader("Content-MD5",e.md5_digest),a.onreadystatechange=function(){4===a.readyState&&(r&&B.d("  ###",r.size),e[t(a)?"on200":"onErr"](a),0===a.status&&(a.onreadystatechange=function(){},a.abort()),Me(e))},a.onerror=function(){e.onErr(a,!0),Me(e)},"function"==typeof e.onProgress&&(a.upload.onprogress=function(t){e.onProgress(t)}),a.send(r)},e.onFailedAuth=e.onFailedAuth||function(t){He.error("Error onFailedAuth for step: "+e.step),e.onErr(t)}}function pe(e){function t(t){var a=["failed to get authorization (",t,") for",e.step,"-  xhr.status:",n.status,".-  xhr.response:",n.response].join(" ");B.w(a),He.warn(a),e.onFailedAuth(n)}if(ze(e))return void B.w("authorizedSend() step",e.step,"is already in progress. Returning.");if(B.d("authorizedSend()",e.step),s.awsLambda)return fe(e);if("undefined"==typeof s.signerUrl)return e.auth=ge(),void e.onGotAuth();var n=_e(e),a=[s.signerUrl,"?to_sign=",ce(e),"&datetime=",e.dateString].join(""),r=me(He.signParams);for(var o in r)r.hasOwnProperty(o)&&(a+="&"+encodeURIComponent(o)+"="+encodeURIComponent(r[o]));s.xhrWithCredentials&&(n.withCredentials=!0),n.onreadystatechange=function(){if(4===n.readyState){var a="readyState===4";if(200===n.status){var r=ge(n.response);Me(e),"2"===s.awsSignatureVersion&&28!==r.length?t(a):(B.d("authorizedSend got signature for:",e.step,"- signature:",r),e.auth=r,e.onGotAuth())}else n.onerror(a)}},n.onerror=function(e){t(e||"onerror")},n.open("GET",a);var i=me(s.signHeaders);for(var u in i)i.hasOwnProperty(u)&&n.setRequestHeader(u,i[u]);"function"==typeof He.beforeSigner&&He.beforeSigner(n,a),n.send()}function fe(e){s.awsLambda.invoke({FunctionName:s.awsLambdaFunction,InvocationType:"RequestResponse",Payload:JSON.stringify({to_sign:ye(e),sign_params:me(He.signParams),sign_headers:me(s.signHeaders)})},function(t,n){if(t){var a="failed to get authorization with lambda "+t;return B.w(a),He.warn(a),void e.onFailedAuth(t)}e.auth=ge(JSON.parse(n.Payload)),e.onGotAuth()})}function ce(e){return encodeURIComponent("4"===s.awsSignatureVersion?ve(e):ye(e))}function ge(e){return"function"==typeof s.signResponseHandler&&(e=s.signResponseHandler(e)||e),e}function me(e){var t={};for(var n in e)e.hasOwnProperty(n)&&("function"==typeof e[n]?t[n]=e[n]():t[n]=e[n]);return t}function he(e){return"4"===s.awsSignatureVersion?Se(e):we(e)}function ye(e){var t,n="",a=[];for(var r in e.x_amz_headers)e.x_amz_headers.hasOwnProperty(r)&&a.push(r);return a.sort(),a.forEach(function(t){n+=t+":"+e.x_amz_headers[t]+"\n"}),t=e.method+"\n"+(e.md5_digest||"")+"\n"+(e.contentType||"")+"\n\n"+n+(s.cloudfront?"/"+s.bucket:"")+e.path,B.d("makeStringToSign (V2)",t),t}function ve(e){var t=[];t.push("AWS4-HMAC-SHA256"),t.push(e.dateString),t.push(be(e)),t.push(s.cryptoHexEncodedHash256(Pe(e)));var n=t.join("\n");return B.d("makeStringToSign (V4)",n),n}function we(e){return["AWS ",s.aws_key,":",e.auth].join("")}function Se(e){var t=[],n=be(e),a=xe(e);return t.push(["AWS4-HMAC-SHA256 Credential=",s.aws_key,"/",n].join("")),t.push("SignedHeaders="+a.signedHeaders),t.push("Signature="+e.auth),t.join(", ")}function be(e){var t=[];return t.push(e.dateString.slice(0,8)),t.push(s.awsRegion),t.push("s3"),t.push("aws4_request"),t.join("/")}function Pe(t){var n=[];n.push(t.method),n.push(e(t.path).pathname),n.push(Te(t)||"");var a=xe(t);n.push(a.canonicalHeaders+"\n"),n.push(a.signedHeaders),n.push(t.getPayloadSha256Content());var r=n.join("\n");return B.d("CanonicalRequest (V4)",r),r}function Te(t){var n,a,r=e(t.path).search,o=r.length?r.split("&"):[],s=[];for(a=0;a<o.length;a++)n=o[a].split("="),s.push({name:encodeURIComponent(n[0]),value:n.length>1?encodeURIComponent(n[1]):null});var i=s.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),u=[];for(a=0;a<i.length;a++)n=i[a].value?[i[a].name,i[a].value].join("="):i[a].name+"=",u.push(n);return u.join("&")}function xe(e){function t(e,t){var n=e.toLowerCase();r.push(n),a[n]=t.replace(/\s+/g," ")}var n,a=[],r=[];e.md5_digest&&t("Content-Md5",e.md5_digest),t("Host",k),e.contentType&&t("Content-Type",e.contentType||"");var o=e.x_amz_headers||{};for(var s in o)o.hasOwnProperty(s)&&t(s,o[s]);var i=r.sort(function(e,t){return e<t?-1:e>t?1:0}),u=[],d=[],l=e.not_signed_headers||[],p=[];for(n=0;n<l.length;n++)d.push(l[n].toLowerCase());for(n=0;n<i.length;n++){var f=i[n];u.push([f,a[f]].join(":")),d.indexOf(f)===-1&&p.push(f)}return{canonicalHeaders:u.join("\n"),signedHeaders:p.join(";")}}function Ee(){var e="/"+s.bucket+"/"+He.name;return(s.cloudfront||D.indexOf("cloudfront")>-1)&&(e="/"+He.name),e}function Ie(e){return"undefined"==typeof e.part?e:e.part}function ze(e){return!!Ie(e).currentXhr}function _e(e){return Ie(e).currentXhr=new XMLHttpRequest}function Me(e){delete Ie(e).currentXhr}var Ae,Ce,He=this,Oe=[],Be=[],Re=[],Ue=0,Fe=0,De=0,ke=[],je=0;f(He,o),He.signParams=s.signParams,He.start=function(){B.d("starting FileUpload",He.id),He.started(He.id),_(S);var e=He.name;if(ne(),"undefined"==typeof He.uploadId)U(e);else if("undefined"!=typeof He.eTag&&He.firstMd5Digest){var t=new FileReader;t.onloadend=function(){var t=s.cryptoMd5Method.call(this,this.result);s.allowS3ExistenceOptimization&&He.firstMd5Digest===t?W(e):(He.firstMd5Digest=t,U(e))},t.readAsArrayBuffer(n(He.file,0,s.partSize))}else Q(0)},He.stop=function(){B.d("stopping FileUpload ",He.id),He.cancelled(),_(T),He.info("Canceling uploads..."),H()},He.pause=function(e){B.d("pausing FileUpload ",He.id),He.info("Pausing uploads..."),e?(B.d("Pausing requests to force abort parts that are evaporating"),C(),_(P),He.paused()):(He.status===x?He.statusBeforePause=He.status:delete He.statusBeforePause,_(I),He.pausing())},He.resume=function(){B.d("resuming FileUpload ",He.id),_(He.statusBeforePause||w),He.resumed()};var Ne=0,Le=-1}function f(e,t,n){function a(e,t){if("object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}return e=e||{},a(t,n),a(e,t),e}function c(e){var t=new DOMParser;return t.parseFromString(e,"text/xml")}function g(e){var t=JSON.parse(F.getItem("awsUploads")||"{}");if(e){for(var n in t)if(t.hasOwnProperty(n)){var a=t[n],o=new Date(a.completedAt||r);o<N&&delete t[n]}F.setItem("awsUploads",JSON.stringify(t))}return t}function m(e){return[e.file.name,e.file.type,t(e.file.lastModifiedDate),e.file.size].join("-")}function h(e,t){var n=g();n[e]=t,F.setItem("awsUploads",JSON.stringify(n))}function y(e){var t=g();delete t[e],F.setItem("awsUploads",JSON.stringify(t))}function v(e,t){return e.getElementsByTagName(t)[0].textContent}var w=0,S=2,b=3,P=4,T=5,x=10,E=20,I=30,z='"d41d8cd98f00b204e9800998ecf8427e"',_=["maxConcurrentParts","logging","cloudfront","aws_url","encodeFilename","computeContentMd5","allowS3ExistenceOptimization","onlyRetryForSameFileName","timeUrl","cryptoMd5Method","cryptoHexEncodedHash256","aws_key","awsRegion","awsSignatureVersion","evaporateChanged"],M={online:12e4,offline:2e4},A=M.online,C=this,H=[],O=0,B=s(),R=f({bucket:null,logging:!0,maxConcurrentParts:5,partSize:6291456,retryBackoffPower:2,maxRetryBackoffSecs:300,progressIntervalMS:500,cloudfront:!1,s3Acceleration:!1,encodeFilename:!0,computeContentMd5:!1,allowS3ExistenceOptimization:!1,onlyRetryForSameFileName:!1,timeUrl:null,cryptoMd5Method:null,cryptoHexEncodedHash256:null,aws_key:null,awsRegion:"us-east-1",awsSignatureVersion:"2",s3FileCacheHoursAgo:null,signParams:{},signHeaders:{},awsLambda:null,awsLambdaFunction:null,maxFileSize:null,signResponseHandler:null,xhrWithCredentials:!1,testUnsupported:!1,simulateStalling:!1,simulateErrors:!1,evaporateChanged:function(){}},o);if("undefined"!=typeof window&&window.console&&(B=window.console,B.d=B.log,B.w=window.console.warn?B.warn:B.d,B.e=window.console.error?B.error:B.d),this.supported=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof(Blob.prototype.webkitSlice||Blob.prototype.mozSlice||Blob.prototype.slice)||o.testUnsupported),!R.signerUrl&&"function"!=typeof R.signResponseHandler)return void B.e("Option signerUrl is required unless signResponseHandler is present.");if(!R.bucket)return void B.e("The AWS 'bucket' option must be present.");if(!this.supported)return void B.e("The browser does not support the necessary features of File and Blob [webkitSlice || mozSlice || slice]");if(R.computeContentMd5){if(this.supported="undefined"!=typeof FileReader.prototype.readAsArrayBuffer,!this.supported)return void B.e("The browser's FileReader object does not support readAsArrayBuffer");if("function"!=typeof R.cryptoMd5Method)return void B.e("Option computeContentMd5 has been set but cryptoMd5Method is not defined.");if("4"===R.awsSignatureVersion&&"function"!=typeof R.cryptoHexEncodedHash256)return void B.e("Option awsSignatureVersion is 4 but cryptoHexEncodedHash256 is not defined.")}else if("4"===R.awsSignatureVersion)return void B.e("Option awsSignatureVersion is 4 but computeContentMd5 is not enabled.");R.logging||(B=s());var U,F={supported:function(){var e=!1;if("undefined"==typeof window)return e;if(!("localStorage"in window))return e;try{localStorage.setItem("___test","OK");var t=localStorage.getItem("___test");localStorage.removeItem("___test"),e="OK"===t}catch(t){return e}return e}(),getItem:function(e){if(this.supported)return localStorage.getItem(e)},setItem:function(e,t){if(this.supported)return localStorage.setItem(e,t)},clear:function(){if(this.supported)return localStorage.clear()},key:function(e){if(this.supported)return localStorage.key(e)},removeItem:function(e){if(this.supported)return localStorage.removeItem(e)}};R.aws_url?U=[R.aws_url]:(R.s3Acceleration?(U=["https://",R.bucket,".s3-accelerate"],R.cloudfront=!0):(U=["https://",R.cloudfront?R.bucket+".":"","s3"],"us-east-1"!==R.awsRegion&&U.push("-",R.awsRegion)),U.push(".amazonaws.com"));var D=U.join(""),k=e(D).hostname,j=new Date,N=new Date(j.setHours(j.getHours()-(R.s3FileCacheHoursAgo||-100))),L=0;if(R.timeUrl){var q=new XMLHttpRequest;q.open("GET",R.timeUrl+"?requestTime="+(new Date).getTime()),q.onreadystatechange=function(){if(4===q.readyState&&200===q.status){var e=new Date(Date.parse(q.responseText)),t=new Date;L=t-e,B.d("localTimeOffset is",L,"ms")}},q.onerror=function(){B.e("xhr error timeUrl",q)},q.send()}C.add=function(e,t){var n=f(t,{});_.map(function(e){delete n[e]});var a=f(R,n);B.d("add");var r;if("undefined"==typeof e)return"Missing file";if(a.maxFileSize&&e.file.size>a.maxFileSize)return"File size too large. Maximum size allowed is "+a.maxFileSize;if("undefined"==typeof e.name?r="Missing attribute: name  ":a.encodeFilename&&(e.name=d(e.name)),r)return r;var o=i(e,a);return setTimeout(l,1),o},C.cancel=function(e){return B.d("cancel ",e),!!H[e]&&(H[e].stop(),!0)},C.pause=function(e,t){t=t||{};var n="undefined"!==t.force&&t.force,a=typeof e;"undefined"===a?(B.d("Pausing all file uploads"),H.forEach(function(e){[w,S,x].indexOf(e.status)>-1&&e.pause(n)})):"undefined"==typeof H[e]?B.w("Cannot pause a file that has not been added."):H[e].status===P?B.w("Cannot pause a file that is already paused. Status:",H[e].status):H[e].pause(n)},C.resume=function(e){var t=[P,I];"undefined"==typeof e?(B.d("Resuming all file uploads"),H.forEach(function(e){t.indexOf(e.status)>-1&&e.resume()})):"undefined"==typeof H[e]?B.w("Cannot pause a file that does not exist."):t.indexOf(H[e].status)===-1?B.w("Cannot resume a file that has not been paused. Status:",H[e].status):H[e].resume()},C.forceRetry=function(){}};"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof window&&(window.Evaporate=o)}();
//# sourceMappingURL=evaporate.min.js.map