var UniBox=function(){var y=-1;var s;var e;var h;var f="";var n="";var D=-80;var F;var a;var k=[];var M=true;var p;var q=300;var m="";var l=2;var v;var t;var K;var d;var c;var A;var L=[];var r="all";var z=-1;var x="";var b=false;var J=[];var i=[];var u=undefined;function I(P){if(P!==undefined){var Q=s.val();if(P.keyCode==9||P.keyCode==27||P.keyCode==13||Q.length<l){w();if(P.keyCode==13&&v!=undefined&&y==-1){v.call(this,Q)}y=-1}}else{w();y=-1}}function w(){h.removeClass("uniboxActive");h.slideUp(q)}function E(Q,P){var R=null;return function(){var T=this,S=arguments;clearTimeout(R);R=window.setTimeout(function(){Q.apply(T,S)},P||50)}}function G(Q,P){if(!M){return Q}var W=P.replace(/[^a-zA-Z0-9äöüÄÖÜß]|\s+|\r?\n|\r/gmi," ").replace(/\W+/g," ").split(" ");W.sort(function(Y,X){return X.length-Y.length});var V={};jQuery.each(W,function(X,ac){if(ac.length<1){return}var ab=Q.match(new RegExp("(("+ac+")(?!#<##|-\\d+#<##))(?!.*\\1)","gi"));if(ab!=null){for(var aa=0;aa<ab.length;aa++){var Z=ab[aa];var Y=Z.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");Q=Q.replace(new RegExp("("+Y+")(?!#<##|-\\d+#<##)","g"),"##>#"+X+"-"+aa+"#<##");V["##>#"+X+"-"+aa+"#<##"]='<span class="unibox-highlight">'+Z+"</span>"}}});var T=Object.keys(V).reverse();for(var R=0;R<T.length;R++){var U=T[R];var S=V[U];Q=Q.replace(new RegExp(U,"gi"),S)}return Q}function N(P){return P.replace(/[ "§$%&/(){}+*,.;|]/g,"_").toLowerCase()}function O(T){if(z==13){I();return}var P=s.val();h.html("");var R=false;var S=Object.keys(T.suggests);if(J&&J.length>0){S=J;jQuery.each(Object.keys(T.suggests),function(U,V){if(jQuery.inArray(V,S)<0){S.push(V)}})}jQuery.each(S,function(U,X){var W=T.suggests[X];if(!W||W.length==0){return true}var V=0;jQuery.each(S,function(aa,ac){var ab=T.suggests[ac];if(!ab||X===ac||ab.length==0){return true}V+=ab.length});var Z=jQuery('<div class="unibox-suggest-cluster unibox-suggest-'+N(X)+" "+("unibox-"+W.length+"-entries")+" "+(V==0?"unibox-single-suggestion-block":"")+'"></div>');if(X.replace(/_/,"").length>0&&W.length>0){var Y=jQuery("<h4>"+X+"</h4>");Z.append(Y)}jQuery.each(W,function(ai,ag){var af='<div class="unibox-selectable">';if(ag.image!=undefined){var ak=ag.image.length===0&&F?F:ag.image.length===0||ag.image.indexOf("/")===0||ag.image.indexOf("http")===0?ag.image:n+ag.image;af+='<div class="unibox-selectable-img-container"><img src="'+ak+'"/></div>'}if(ag.link!=undefined){af+='<a href="'+ag.link+'">';af+=G(ag.name,P);af+="</a>"}else{af+="<span>"+G(ag.name,P)+"</span>"}if(p!=undefined){var ah=p.match(/##(.*?)##/gi);var ae=p;var ad=false;for(var ab in ah){var ac=ah[ab].replace(/#/g,"");var aa=ag[ac];if(aa==undefined){ad=true;continue}var al=new RegExp(ah[ab],"g");ae=ae.replace(al,aa)}if(!ad){af+='<div class="unibox-extra">'+ae+"</div>"}}af+='<div class="unibox-ca"></div></div>';var aj=jQuery(af);Z.append(aj);R=true});h.append(Z)});if(i&&i.length>0){k=[];jQuery.each(i,function(U,V){k=k.concat(e.find(".unibox-suggest-"+N(V)+":first .unibox-selectable").get())})}else{k=e.find(".unibox-selectable")}y=-1;jQuery(k).mousedown(function(){var V=jQuery(this).text();s.val(V);var U=undefined;try{U=jQuery(this).find("a:first").attr("href")}catch(W){}if(t!=undefined){t.call(this,V,U)}I()});e.find(".unibox-selectable .unibox-extra").click(function(U){U.stopPropagation()});if(T.words.length>0&&m.length>0&&(r=="all"||r=="bottom")){h.append("<h4>"+m+"</h4>");R=true}var Q=[];jQuery.each(T.words,function(V,Y){if((r=="all"||r=="bottom")){if(Y.overlayImage!=undefined){h.append('<img class="unibox-vis" src="'+n+Y.overlayImage+'" style="background-image: url(\''+n+Y.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{if(Y.image!=undefined){h.append('<img class="unibox-vis" src="'+n+Y.image+'">')}}}var X=e.find("#unibox-invisible");X.html(P.replace(new RegExp(Y.name,"gi"),"<span>"+Y.name+"</span>"));if((r=="all"||r=="top")&&jQuery.inArray(Y.image,L)==-1){var W=e.find("#unibox-invisible span")[0];if(W!=undefined&&Y.name.length>0&&Y.image!=undefined){var U=jQuery(W).position().left;visImage=jQuery('<div class="unibox-ivf"><img src="'+n+Y.image+'" alt="'+Y.name+'"></div>');visImage.css("left",j().left+U-10);visImage.css("top",j().top-s.outerHeight()+D);e.append(visImage);setTimeout(function(){e.find(".unibox-ivf").find("img").addClass("l")},10);Q.push(Y.image)}}else{if(jQuery.inArray(Y.image,L)>-1){Q.push(Y.image)}}});L=Q;jQuery("img").error(function(){if(F){jQuery(this).attr("src",F)}else{jQuery(this).hide()}});g();if(R){if(h.is(":visible")){h.addClass("uniboxActive");h.css("left",j().left);h.css("top",j().top)}else{h.slideDown(q,function(){h.addClass("uniboxActive");h.css("left",j().left);h.css("top",j().top)})}}else{I()}}function j(){return{left:s.offset().left-e.offset().left,top:s.offset().top-e.offset().top+s.outerHeight()}}function C(){var Q=e.find(".unibox-ivf img").map(function(){return jQuery(this).attr("src")}).get();for(var P=0;P<Q.length;P++){if(jQuery.inArray(Q[P].replace(n,""),L)==-1){e.find('.unibox-ivf:has(img[src*="'+Q[P]+'"])').remove()}}}function o(){L=[];e.find(".unibox-ivf").remove()}function H(P){if(s.val().length<=1){o()}if(K!=undefined){K.call(this,s.val())}if(P.keyCode!=37&&P.keyCode!=38&&P.keyCode!=39&&P.keyCode!=40&&P.keyCode!=13){C();return}if(P.keyCode==38&&y>0){y--}else{if(P.keyCode==40){y++}else{if(P.keyCode==38&&y<=0){y=((y!=-1)?y-1:y)+k.length}else{if((P.keyCode==37||P.keyCode==39)&&y>-1){y=y%k.length;var T=jQuery(k[y]);var W=T.closest(".unibox-suggest-cluster");var R;if(P.keyCode==37){R=W.prev()}else{if(P.keyCode==39){R=W.next()}}if(R.hasClass("unibox-suggest-cluster")){var X=R.find("div.unibox-selectable")[0];y=jQuery("#unibox-suggest-box div.unibox-selectable").index(X)}}}}}if(k.length>0&&y>-1){y=y%k.length;jQuery(k).removeClass("active");var U=jQuery(k[y]);U.addClass("active")}if(P.keyCode==13){if(t!=undefined){var S=s.val();var Q=undefined;if(y!=-1){S=jQuery(e.find(".unibox-selectable.active")[0]).text();s.val(S);try{Q=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}catch(V){}if(t!=undefined){t.call(this,S,Q)}}}else{if(y!=-1){window.location.href=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}if(y>-1){P.preventDefault()}}function B(P){if(z==18){z=P.keyCode;return}z=P.keyCode;if(((P.keyCode==37||P.keyCode==39)&&y>-1)||P.keyCode==38||P.keyCode==40||P.keyCode==13||P.keyCode==9){return}var Q=s.val();if(z==46&&Q.length==0){o()}if(Q.length>=l){x=Q;jQuery.ajax({usedQuery:Q,url:f+encodeURIComponent(Q),dataType:"json",success:function(R){if(this.usedQuery==x){O(R)}}})}}function g(){var Q=jQuery("#unibox-suggest-box");var P=Q.css("border-width").replace("px","");Q.css("min-width",s.outerWidth()-2*P);if(u==undefined){Q.css("max-width",s.outerWidth()-2*P)}else{Q.css("max-width",u-2*P)}Q.css("left",j().left);Q.css("top",j().top)}return{updateSuggestUrl:function(P){f=P},hideSuggestBox:function(){I()},setIvfImagePath:function(P){n=P;if(n.charAt(n.length-1)!="/"){n+="/"}},changeInstantVisualFeedbackState:function(P){r=P},render:function(){g()},getText:function(){return s.val()},init:function(ac,ae){s=ac;e=ae.searchBoxContainer;M=ae.highlight;p=ae.extraHtml;f=ae.suggestUrl;n=ae.ivfImagePath;D=ae.ivfImageOffset;F=ae.missingErrorImage;a=ae.throttleTime;q=ae.animationSpeed;l=ae.minChars;v=ae.enterCallback;t=ae.enterCallbackResult;K=ae.typeCallback;d=ae.focusCallback;c=ae.blurCallback;A=ae.placeholder;r=ae.instantVisualFeedback;m=ae.queryVisualizationHeadline;b=ae.showDeleteAllButton;J=ae.suggestOrder;i=ae.suggestSelectionOrder;u=ae.maxWidth;s.attr("autocomplete","off");h=jQuery('<div id="unibox-suggest-box"></div>');e.prepend(h);var aa=e.css("position");if(aa!="absolute"){e.css("position","relative")}var V=h.css("border-width").replace("px","");h.css("min-width",s.outerWidth()-2*V);h.css("max-width",ae.maxWidth-2*V);s.keydown(H);s.keydown(E(B,a));s.keyup(I);s.focusout(function(){w();if(c!=undefined){c.call(this,jQuery(this).val())}});s.focus(function(af){af.stopPropagation();if(jQuery(this).val().length>0){B({keyCode:-1})}if(d!=undefined){d.call(this,jQuery(this).val())}});h.mouseenter(function(){h.find(".unibox-selectable.active").removeClass("active")});jQuery("html").click(function(){w()});s.click(function(af){af.stopPropagation()});h.click(function(af){af.stopPropagation()});var Q=s.attr("placeholder");A=Q&&Q.length>0?Q:A;if(A&&A.length>0){var X=document.createElement("input");if(!("placeholder" in X)){s.focus(function(){var af=jQuery(this).attr("placeholder");if((af)&&(af.length>0)&&(af!="")&&jQuery(this).val()==af){jQuery(this).val("").removeClass("hasPlaceholder")}}).blur(function(){var af=jQuery(this).attr("placeholder");if((af)&&(af.length>0)&&(af!="")&&(jQuery(this).val()==""||jQuery(this).val()==af)){jQuery(this).val(af).addClass("hasPlaceholder")}});s.val(A)}s.attr("placeholder",A)}var ad=jQuery('<div id="unibox-invisible">&nbsp;<span>&nbsp;</span></div>');e.append(ad);if(b){var ab=jQuery('<div id="unibox-dab-holder"><div id="unibox-dab"></div></div>');e.append(ab);jQuery(ab).mousedown(function(af){(af||window.event).stopPropagation();s.val("");s.focus();return false});s.focus(function(){if(s.val().length>0){ab.show()}else{ab.hide()}}).blur(function(){ab.hide()}).keydown(function(){if(jQuery(this).val().length>0){jQuery(ab).show()}});var Z=parseInt(s.css("paddingTop").replace("px","").trim());var Y=s.outerHeight();var W=parseInt(s.css("borderTopWidth").replace("px","").trim());var T=s.css("boxShadow").match(/\d{1,3}px/g);var S=(T&&T.length>2)?parseInt(T[2].replace("px","").trim()):0;ab.height(Y-(2*W)-S-Z);var P=parseInt(s.css("paddingRight").replace("px","").trim());P=(P>25)?P:25;s.css("paddingRight",P);var U=W+S+(s.offset().top-s.parent().offset().top-s.parent().scrollTop());var R=Math.abs(s[0].getBoundingClientRect().left-s.parent()[0].getBoundingClientRect().left)+s.outerWidth()-ab.outerWidth()-W-P;ab.css("top",U);ab.css("left",R)}if(r=="none"){jQuery("#unibox-invisible").css("display","none")}}}};(function(a){a.fn.unibox=function(b){var c=this.map(function(e,h){h=a(h);var f=a.extend({suggestUrl:"",ivfImagePath:"",ivfImageOffset:-80,missingErrorImage:undefined,queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,enterCallbackResult:undefined,typeCallback:undefined,focusCallback:undefined,blurCallback:undefined,placeholder:undefined,extraHtml:undefined,minChars:3,maxWidth:h.outerWidth(),showDeleteAllButton:false,suggestOrder:[],suggestSelectionOrder:[]},b);if(f.searchBoxContainerSelector==undefined){f.searchBoxContainer=h.parent()}else{f.searchBoxContainer=a(f.searchBoxContainerSelector)}var g=new UniBox();g.init(h,f);return g});var d=a.makeArray(c);if(d.length==1){return d[0]}return d}}(jQuery));