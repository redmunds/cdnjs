var UniBox=function(){var A=-1;var t;var e;var h;var f="";var o="";var F=-80;var H;var a;var k=[];var O=true;var q;var r=300;var n="";var l=2;var w;var u;var M;var d;var c;var C;var N=[];var s="all";var B=-1;var z="";var b=false;var L=[];var i=[];var v=undefined;var Q=undefined;var m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function K(S){if(S!==undefined){var T=t.val();if(S.keyCode==9||S.keyCode==27||S.keyCode==13||T.length<l){y();if(S.keyCode==13&&w!=undefined&&A==-1){w.call(this,T)}A=-1}}else{y();A=-1}}function y(){h.removeClass("uniboxActive");h.slideUp(r)}function G(T,S){var U=null;return function(){var W=this,V=arguments;clearTimeout(U);U=window.setTimeout(function(){T.apply(W,V)},S||50)}}function I(T,S){if(!O){return T}var Z=S.replace(/[^a-zA-Z0-9äöüÄÖÜß]|\s+|\r?\n|\r/gmi," ").replace(/[^a-zA-Z0-9äöüÄÖÜß]/g," ").split(" ");Z.sort(function(ab,aa){return aa.length-ab.length});var Y={};jQuery.each(Z,function(aa,af){if(af.length<1){return}var ae=T.match(new RegExp("(("+af+")(?!#<##|-\\d+#<##))(?!.*\\1)","gi"));if(ae!=null){for(var ad=0;ad<ae.length;ad++){var ac=ae[ad];var ab=ac.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");T=T.replace(new RegExp("("+ab+")(?!#<##|-\\d+#<##)","g"),"##>#"+aa+"-"+ad+"#<##");Y["##>#"+aa+"-"+ad+"#<##"]='<span class="unibox-highlight">'+ac+"</span>"}}});var W=Object.keys(Y).reverse();for(var U=0;U<W.length;U++){var X=W[U];var V=Y[X];T=T.replace(new RegExp(X,"gi"),V)}return T}function P(S){return S.replace(/[ "§$%&/(){}+*,.;|]/g,"_").toLowerCase()}function x(S){return String(S).replace(/[&<>"'\/]/g,function(T){return m[T]})}function R(W){if(B==13){K();return}var S=t.val();var X=x(S);h.html("");var U=false;var V=Object.keys(W.suggests);if(L&&L.length>0){V=L;jQuery.each(Object.keys(W.suggests),function(Y,Z){if(jQuery.inArray(Z,V)<0){V.push(Z)}})}jQuery.each(V,function(Y,ab){var aa=W.suggests[ab];if(!aa||aa.length==0){return true}var Z=0;jQuery.each(V,function(ae,ag){var af=W.suggests[ag];if(!af||ab===ag||af.length==0){return true}Z+=af.length});var ad=jQuery('<div class="unibox-suggest-cluster unibox-suggest-'+P(ab)+" "+("unibox-"+aa.length+"-entries")+" "+(Z==0?"unibox-single-suggestion-block":"")+'"></div>');if(ab.replace(/_/,"").length>0&&aa.length>0){var ac=jQuery("<h4>"+ab+"</h4>");ad.append(ac)}jQuery.each(aa,function(am,ak){var aj='<div class="unibox-selectable">';if(ak.image!=undefined){var ao=ak.image.length===0&&H?H:ak.image.length===0||ak.image.indexOf("/")===0||ak.image.indexOf("http")===0?ak.image:o+ak.image;aj+='<div class="unibox-selectable-img-container"><img src="'+ao+'"/></div>'}if(ak.link!=undefined){aj+='<a href="'+ak.link+'">';aj+=I(ak.name,X);aj+="</a>"}else{aj+="<span>"+I(ak.name,X)+"</span>"}if(q!=undefined){var al=q.match(/##(.*?)##/gi);var ai=q;var ah=false;for(var af in al){var ag=al[af].replace(/#/g,"");var ae=ak[ag];if(ae==undefined){ah=true;continue}var ap=new RegExp(al[af],"g");ai=ai.replace(ap,ae)}if(!ah){aj+='<div class="unibox-extra">'+ai+"</div>"}}aj+='<div class="unibox-ca"></div></div>';var an=jQuery(aj);ad.append(an);U=true});h.append(ad)});if(i&&i.length>0){k=[];jQuery.each(i,function(Y,Z){k=k.concat(e.find(".unibox-suggest-"+P(Z)+":first .unibox-selectable").get())})}else{k=e.find(".unibox-selectable")}A=-1;jQuery(k).mousedown(function(){var Z=jQuery(this).text();t.val(Z);var Y=undefined;try{Y=jQuery(this).find("a:first").attr("href")}catch(aa){}if(u!=undefined){u.call(this,Z,Y)}K()});e.find(".unibox-selectable .unibox-extra").click(function(Y){Y.stopPropagation()});if(W.words.length>0&&n.length>0&&(s=="all"||s=="bottom")){h.append("<h4>"+n+"</h4>");U=true}var T=[];jQuery.each(W.words,function(Z,ac){if((s=="all"||s=="bottom")){if(ac.overlayImage!=undefined){h.append('<img class="unibox-vis" src="'+o+ac.overlayImage+'" style="background-image: url(\''+o+ac.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{if(ac.image!=undefined){h.append('<img class="unibox-vis" src="'+o+ac.image+'">')}}}var ab=e.find("#unibox-invisible");ab.html(X.replace(new RegExp(ac.name,"gi"),"<span>"+ac.name+"</span>"));if((s=="all"||s=="top")&&jQuery.inArray(ac.image,N)==-1){var aa=e.find("#unibox-invisible span")[0];if(aa!=undefined&&ac.name.length>0&&ac.image!=undefined){var Y=jQuery(aa).position().left;visImage=jQuery('<div class="unibox-ivf"><img src="'+o+ac.image+'" alt="'+ac.name+'"></div>');visImage.css("left",j().left+Y-10);visImage.css("top",j().top-t.outerHeight()+F);e.append(visImage);setTimeout(function(){e.find(".unibox-ivf").find("img").addClass("l")},10);T.push(ac.image)}}else{if(jQuery.inArray(ac.image,N)>-1){T.push(ac.image)}}});N=T;jQuery("img").error(function(){if(H){jQuery(this).attr("src",H)}else{jQuery(this).hide()}});g();if(Q!=undefined){U=true;h.append(Q)}if(U){if(h.is(":visible")){h.addClass("uniboxActive");h.css("left",j().left);h.css("top",j().top)}else{h.slideDown(r,function(){h.addClass("uniboxActive");h.css("left",j().left);h.css("top",j().top)})}}else{K()}}function j(){return{left:t.offset().left-e.offset().left,top:t.offset().top-e.offset().top+t.outerHeight()}}function E(){var T=e.find(".unibox-ivf img").map(function(){return jQuery(this).attr("src")}).get();for(var S=0;S<T.length;S++){if(jQuery.inArray(T[S].replace(o,""),N)==-1){e.find('.unibox-ivf:has(img[src*="'+T[S]+'"])').remove()}}}function p(){N=[];e.find(".unibox-ivf").remove()}function J(S){if(t.val().length<=1){p()}if(M!=undefined){M.call(this,t.val())}if(S.keyCode!=37&&S.keyCode!=38&&S.keyCode!=39&&S.keyCode!=40&&S.keyCode!=13){E();return}if(S.keyCode==38&&A>0){A--}else{if(S.keyCode==40){A++}else{if(S.keyCode==38&&A<=0){A=((A!=-1)?A-1:A)+k.length}else{if((S.keyCode==37||S.keyCode==39)&&A>-1){A=A%k.length;var W=jQuery(k[A]);var Z=W.closest(".unibox-suggest-cluster");var U;if(S.keyCode==37){U=Z.prev()}else{if(S.keyCode==39){U=Z.next()}}if(U.hasClass("unibox-suggest-cluster")){var aa=U.find("div.unibox-selectable")[0];A=jQuery("#unibox-suggest-box div.unibox-selectable").index(aa)}}}}}if(k.length>0&&A>-1){A=A%k.length;jQuery(k).removeClass("active");var X=jQuery(k[A]);X.addClass("active")}if(S.keyCode==13){if(u!=undefined){var V=t.val();var T=undefined;if(A!=-1){V=jQuery(e.find(".unibox-selectable.active")[0]).text();t.val(V);try{T=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}catch(Y){}if(u!=undefined){u.call(this,V,T)}}}else{if(A!=-1){window.location.href=jQuery(e.find(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}if(A>-1){S.preventDefault()}}function D(S){if(B==18){B=S.keyCode;return}B=S.keyCode;if(((S.keyCode==37||S.keyCode==39)&&A>-1)||S.keyCode==38||S.keyCode==40||S.keyCode==13||S.keyCode==9){return}var T=t.val();if(B==46&&T.length==0){p()}if(T.length>=l){z=T;jQuery.ajax({usedQuery:T,url:f+encodeURIComponent(T),dataType:"json",success:function(U){if(this.usedQuery==z){R(U)}}})}}function g(){var T=jQuery("#unibox-suggest-box");var S=T.css("border-width").replace("px","");T.css("min-width",t.outerWidth()-2*S);if(v==undefined){T.css("max-width",t.outerWidth()-2*S)}else{T.css("max-width",v-2*S)}T.css("left",j().left);T.css("top",j().top)}return{updateSuggestUrl:function(S){f=S},hideSuggestBox:function(){K()},setIvfImagePath:function(S){o=S;if(o.charAt(o.length-1)!="/"){o+="/"}},changeInstantVisualFeedbackState:function(S){s=S},render:function(){g()},getText:function(){return t.val()},init:function(af,ah){t=af;e=ah.searchBoxContainer;O=ah.highlight;q=ah.extraHtml;f=ah.suggestUrl;o=ah.ivfImagePath;F=ah.ivfImageOffset;H=ah.missingErrorImage;a=ah.throttleTime;r=ah.animationSpeed;l=ah.minChars;w=ah.enterCallback;u=ah.enterCallbackResult;M=ah.typeCallback;d=ah.focusCallback;c=ah.blurCallback;C=ah.placeholder;s=ah.instantVisualFeedback;n=ah.queryVisualizationHeadline;b=ah.showDeleteAllButton;L=ah.suggestOrder;i=ah.suggestSelectionOrder;v=ah.maxWidth;Q=ah.noSuggests;t.attr("autocomplete","off");h=jQuery('<div id="unibox-suggest-box"></div>');e.prepend(h);var ad=e.css("position");if(ad!="absolute"){e.css("position","relative")}var Y=h.css("border-width").replace("px","");h.css("min-width",t.outerWidth()-2*Y);h.css("max-width",ah.maxWidth-2*Y);t.keydown(J);t.keydown(G(D,a));t.keyup(K);t.focusout(function(){y();if(c!=undefined){c.call(this,jQuery(this).val())}});t.focus(function(ai){ai.stopPropagation();if(jQuery(this).val().length>0){D({keyCode:-1})}if(d!=undefined){d.call(this,jQuery(this).val())}});h.mouseenter(function(){h.find(".unibox-selectable.active").removeClass("active")});jQuery("html").click(function(){y()});t.click(function(ai){ai.stopPropagation()});h.click(function(ai){ai.stopPropagation()});var T=t.attr("placeholder");C=T&&T.length>0?T:C;if(C&&C.length>0){var aa=document.createElement("input");if(!("placeholder" in aa)){t.focus(function(){var ai=jQuery(this).attr("placeholder");if((ai)&&(ai.length>0)&&(ai!="")&&jQuery(this).val()==ai){jQuery(this).val("").removeClass("hasPlaceholder")}}).blur(function(){var ai=jQuery(this).attr("placeholder");if((ai)&&(ai.length>0)&&(ai!="")&&(jQuery(this).val()==""||jQuery(this).val()==ai)){jQuery(this).val(ai).addClass("hasPlaceholder")}});t.val(C)}t.attr("placeholder",C)}var ag=jQuery('<div id="unibox-invisible">&nbsp;<span>&nbsp;</span></div>');e.append(ag);if(b){var ae=jQuery('<div id="unibox-dab-holder"><div id="unibox-dab"></div></div>');e.append(ae);jQuery(ae).mousedown(function(ai){(ai||window.event).stopPropagation();t.val("");t.focus();return false});t.focus(function(){if(t.val().length>0){ae.show()}else{ae.hide()}}).blur(function(){ae.hide()}).keydown(function(){if(jQuery(this).val().length>0){jQuery(ae).show()}});var ac=parseInt(t.css("paddingTop").replace("px","").trim());var ab=t.outerHeight();var Z=parseInt(t.css("borderTopWidth").replace("px","").trim());var W=t.css("boxShadow").match(/\d{1,3}px/g);var V=(W&&W.length>2)?parseInt(W[2].replace("px","").trim()):0;ae.height(ab-(2*Z)-V-ac);var S=parseInt(t.css("paddingRight").replace("px","").trim());S=(S>25)?S:25;t.css("paddingRight",S);var X=Z+V+(t.offset().top-t.parent().offset().top-t.parent().scrollTop());var U=Math.abs(t[0].getBoundingClientRect().left-t.parent()[0].getBoundingClientRect().left)+t.outerWidth()-ae.outerWidth()-Z-S;ae.css("top",X);ae.css("left",U)}if(s=="none"){jQuery("#unibox-invisible").css("display","none")}}}};(function(a){a.fn.unibox=function(b){var c=this.map(function(e,h){h=a(h);var f=a.extend({suggestUrl:"",ivfImagePath:"",ivfImageOffset:-80,missingErrorImage:undefined,queryVisualizationHeadline:"",highlight:true,throttleTime:50,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,enterCallbackResult:undefined,typeCallback:undefined,focusCallback:undefined,blurCallback:undefined,placeholder:undefined,extraHtml:undefined,noSuggests:undefined,minChars:3,maxWidth:h.outerWidth(),showDeleteAllButton:false,suggestOrder:[],suggestSelectionOrder:[]},b);if(f.searchBoxContainerSelector==undefined){f.searchBoxContainer=h.parent()}else{f.searchBoxContainer=a(f.searchBoxContainerSelector)}var g=new UniBox();g.init(h,f);return g});var d=a.makeArray(c);if(d.length==1){return d[0]}return d}}(jQuery));