var THREE=THREE||{};THREE.Color=function(i){this.autoUpdate=!0,this.setHex(i)},THREE.Color.prototype={setRGB:function(i,t,e){this.r=i,this.g=t,this.b=e,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(i){this.hex=16777215&~~i,this.autoUpdate&&(this.updateRGBA(),this.updateStyleString())},updateHex:function(){this.hex=~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},updateRGBA:function(){this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgb("+~~(255*this.r)+","+~~(255*this.g)+","+~~(255*this.b)+")"},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}},THREE.Vector2=function(i,t){this.x=i||0,this.y=t||0},THREE.Vector2.prototype={set:function(i,t){return this.x=i,this.y=t,this},copy:function(i){return this.x=i.x,this.y=i.y,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},THREE.Vector3=function(i,t,e){this.x=i||0,this.y=t||0,this.z=e||0},THREE.Vector3.prototype={set:function(i,t,e){return this.x=i,this.y=t,this.z=e,this},copy:function(i){return this.x=i.x,this.y=i.y,this.z=i.z,this},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this.z=i.z+t.z,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this},addScalar:function(i){return this.x+=i,this.y+=i,this.z+=i,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this.z=i.z-t.z,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this},cross:function(i,t){return this.x=i.y*t.z-i.z*t.y,this.y=i.z*t.x-i.x*t.z,this.z=i.x*t.y-i.y*t.x,this},crossSelf:function(i){var t=this.x,e=this.y,n=this.z;return this.x=e*i.z-n*i.y,this.y=n*i.x-t*i.z,this.z=t*i.y-e*i.x,this},multiply:function(i,t){return this.x=i.x*t.x,this.y=i.y*t.y,this.z=i.z*t.z,this},multiplySelf:function(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this.z*=i,this},divideScalar:function(i){return this.x/=i,this.y/=i,this.z/=i,this},dot:function(i){return this.x*i.x+this.y*i.y+this.z*i.z},distanceTo:function(i){var t=this.x-i.x,e=this.y-i.y;return i=this.z-i.z,Math.sqrt(t*t+e*e+i*i)},distanceToSquared:function(i){var t=this.x-i.x,e=this.y-i.y;return i=this.z-i.z,t*t+e*e+i*i},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){var i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return i>0?this.multiplyScalar(1/i):this.set(0,0,0),this},setLength:function(i){return this.normalize().multiplyScalar(i)},isZero:function(){return Math.abs(this.x)<1e-4&&Math.abs(this.y)<1e-4&&Math.abs(this.z)<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},THREE.Vector4=function(i,t,e,n){this.x=i||0,this.y=t||0,this.z=e||0,this.w=n||1},THREE.Vector4.prototype={set:function(i,t,e,n){return this.x=i,this.y=t,this.z=e,this.w=n,this},copy:function(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w||1,this},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this.z=i.z+t.z,this.w=i.w+t.w,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this.w+=i.w,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this.z=i.z-t.z,this.w=i.w-t.w,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this.w-=i.w,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},divideScalar:function(i){return this.x/=i,this.y/=i,this.z/=i,this.w/=i,this},lerpSelf:function(i,t){this.x+=(i.x-this.x)*t,this.y+=(i.y-this.y)*t,this.z+=(i.z-this.z)*t,this.w+=(i.w-this.w)*t},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},THREE.Ray=function(i,t){this.origin=i||new THREE.Vector3,this.direction=t||new THREE.Vector3},THREE.Ray.prototype={intersectScene:function(i){var t,e,n=i.objects,r=[];for(i=0,t=n.length;i<t;i++)e=n[i],e instanceof THREE.Mesh&&(r=r.concat(this.intersectObject(e)));return r.sort(function(i,t){return i.distance-t.distance}),r},intersectObject:function(i){function t(i,t,e,n){n=n.clone().subSelf(t),e=e.clone().subSelf(t);var r=i.clone().subSelf(t);i=n.dot(n),t=n.dot(e),n=n.dot(r);var o=e.dot(e);return e=e.dot(r),r=1/(i*o-t*t),o=(o*n-t*e)*r,i=(i*e-t*n)*r,o>0&&i>0&&o+i<1}var e,n,r,o,s,a,h,l,c,f,u,m=i.geometry,E=m.vertices,p=[];for(e=0,n=m.faces.length;e<n;e++)r=m.faces[e],f=this.origin.clone(),u=this.direction.clone(),o=i.matrix.multiplyVector3(E[r.a].position.clone()),s=i.matrix.multiplyVector3(E[r.b].position.clone()),a=i.matrix.multiplyVector3(E[r.c].position.clone()),h=r instanceof THREE.Face4?i.matrix.multiplyVector3(E[r.d].position.clone()):null,l=i.rotationMatrix.multiplyVector3(r.normal.clone()),c=u.dot(l),c<0&&(l=l.dot((new THREE.Vector3).sub(o,f))/c,f=f.addSelf(u.multiplyScalar(l)),r instanceof THREE.Face3?t(f,o,s,a)&&(r={distance:this.origin.distanceTo(f),point:f,face:r,object:i},p.push(r)):r instanceof THREE.Face4&&(t(f,o,s,h)||t(f,s,a,h))&&(r={distance:this.origin.distanceTo(f),point:f,face:r,object:i},p.push(r)));return p}},THREE.Rectangle=function(){function i(){o=n-t,s=r-e}var t,e,n,r,o,s,a=!0;this.getX=function(){return t},this.getY=function(){return e},this.getWidth=function(){return o},this.getHeight=function(){return s},this.getLeft=function(){return t},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(o,s,h,l){a=!1,t=o,e=s,n=h,r=l,i()},this.addPoint=function(o,s){a?(a=!1,t=o,e=s,n=o,r=s):(t=Math.min(t,o),e=Math.min(e,s),n=Math.max(n,o),r=Math.max(r,s)),i()},this.addRectangle=function(o){a?(a=!1,t=o.getLeft(),e=o.getTop(),n=o.getRight(),r=o.getBottom()):(t=Math.min(t,o.getLeft()),e=Math.min(e,o.getTop()),n=Math.max(n,o.getRight()),r=Math.max(r,o.getBottom())),i()},this.inflate=function(o){t-=o,e-=o,n+=o,r+=o,i()},this.minSelf=function(o){t=Math.max(t,o.getLeft()),e=Math.max(e,o.getTop()),n=Math.min(n,o.getRight()),r=Math.min(r,o.getBottom()),i()},this.instersects=function(i){return Math.min(n,i.getRight())-Math.max(t,i.getLeft())>=0&&Math.min(r,i.getBottom())-Math.max(e,i.getTop())>=0},this.empty=function(){a=!0,r=n=e=t=0,i()},this.isEmpty=function(){return a},this.toString=function(){return"THREE.Rectangle ( left: "+t+", right: "+n+", top: "+e+", bottom: "+r+", width: "+o+", height: "+s+" )"}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={transpose:function(){var i;return i=this.m[1],this.m[1]=this.m[3],this.m[3]=i,i=this.m[2],this.m[2]=this.m[6],this.m[6]=i,i=this.m[5],this.m[5]=this.m[7],this.m[7]=i,this}},THREE.Matrix4=function(){},THREE.Matrix4.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1,this.n21=this.n14=this.n13=this.n12=0,this.n22=1,this.n32=this.n31=this.n24=this.n23=0,this.n33=1,this.n43=this.n42=this.n41=this.n34=0,this.n44=1},copy:function(i){this.n11=i.n11,this.n12=i.n12,this.n13=i.n13,this.n14=i.n14,this.n21=i.n21,this.n22=i.n22,this.n23=i.n23,this.n24=i.n24,this.n31=i.n31,this.n32=i.n32,this.n33=i.n33,this.n34=i.n34,this.n41=i.n41,this.n42=i.n42,this.n43=i.n43,this.n44=i.n44},lookAt:function(i,t,e){var n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3;o.sub(i,t).normalize(),n.cross(e,o).normalize(),r.cross(o,n).normalize(),this.n11=n.x,this.n12=n.y,this.n13=n.z,this.n14=-n.dot(i),this.n21=r.x,this.n22=r.y,this.n23=r.z,this.n24=-r.dot(i),this.n31=o.x,this.n32=o.y,this.n33=o.z,this.n34=-o.dot(i),this.n43=this.n42=this.n41=0,this.n44=1},multiplyVector3:function(i){var t=i.x,e=i.y,n=i.z,r=1/(this.n41*t+this.n42*e+this.n43*n+this.n44);return i.x=(this.n11*t+this.n12*e+this.n13*n+this.n14)*r,i.y=(this.n21*t+this.n22*e+this.n23*n+this.n24)*r,i.z=(this.n31*t+this.n32*e+this.n33*n+this.n34)*r,i},multiplyVector4:function(i){var t=i.x,e=i.y,n=i.z,r=i.w;return i.x=this.n11*t+this.n12*e+this.n13*n+this.n14*r,i.y=this.n21*t+this.n22*e+this.n23*n+this.n24*r,i.z=this.n31*t+this.n32*e+this.n33*n+this.n34*r,i.w=this.n41*t+this.n42*e+this.n43*n+this.n44*r,i},crossVector:function(i){var t=new THREE.Vector4;return t.x=this.n11*i.x+this.n12*i.y+this.n13*i.z+this.n14*i.w,t.y=this.n21*i.x+this.n22*i.y+this.n23*i.z+this.n24*i.w,t.z=this.n31*i.x+this.n32*i.y+this.n33*i.z+this.n34*i.w,t.w=i.w?this.n41*i.x+this.n42*i.y+this.n43*i.z+this.n44*i.w:1,t},multiply:function(i,t){var e=i.n11,n=i.n12,r=i.n13,o=i.n14,s=i.n21,a=i.n22,h=i.n23,l=i.n24,c=i.n31,f=i.n32,u=i.n33,m=i.n34,E=i.n41,p=i.n42,d=i.n43,g=i.n44,v=t.n11,b=t.n12,R=t.n13,y=t.n14,T=t.n21,x=t.n22,_=t.n23,M=t.n24,w=t.n31,H=t.n32,S=t.n33,L=t.n34,C=t.n41,z=t.n42,A=t.n43,P=t.n44;this.n11=e*v+n*T+r*w+o*C,this.n12=e*b+n*x+r*H+o*z,this.n13=e*R+n*_+r*S+o*A,this.n14=e*y+n*M+r*L+o*P,this.n21=s*v+a*T+h*w+l*C,this.n22=s*b+a*x+h*H+l*z,this.n23=s*R+a*_+h*S+l*A,this.n24=s*y+a*M+h*L+l*P,this.n31=c*v+f*T+u*w+m*C,this.n32=c*b+f*x+u*H+m*z,this.n33=c*R+f*_+u*S+m*A,this.n34=c*y+f*M+u*L+m*P,this.n41=E*v+p*T+d*w+g*C,this.n42=E*b+p*x+d*H+g*z,this.n43=E*R+p*_+d*S+g*A,this.n44=E*y+p*M+d*L+g*P},multiplySelf:function(i){var t=this.n11,e=this.n12,n=this.n13,r=this.n14,o=this.n21,s=this.n22,a=this.n23,h=this.n24,l=this.n31,c=this.n32,f=this.n33,u=this.n34,m=this.n41,E=this.n42,p=this.n43,d=this.n44;this.n11=t*i.n11+e*i.n21+n*i.n31+r*i.n41,this.n12=t*i.n12+e*i.n22+n*i.n32+r*i.n42,this.n13=t*i.n13+e*i.n23+n*i.n33+r*i.n43,this.n14=t*i.n14+e*i.n24+n*i.n34+r*i.n44,this.n21=o*i.n11+s*i.n21+a*i.n31+h*i.n41,this.n22=o*i.n12+s*i.n22+a*i.n32+h*i.n42,this.n23=o*i.n13+s*i.n23+a*i.n33+h*i.n43,this.n24=o*i.n14+s*i.n24+a*i.n34+h*i.n44,this.n31=l*i.n11+c*i.n21+f*i.n31+u*i.n41,this.n32=l*i.n12+c*i.n22+f*i.n32+u*i.n42,this.n33=l*i.n13+c*i.n23+f*i.n33+u*i.n43,this.n34=l*i.n14+c*i.n24+f*i.n34+u*i.n44,this.n41=m*i.n11+E*i.n21+p*i.n31+d*i.n41,this.n42=m*i.n12+E*i.n22+p*i.n32+d*i.n42,this.n43=m*i.n13+E*i.n23+p*i.n33+d*i.n43,this.n44=m*i.n14+E*i.n24+p*i.n34+d*i.n44},multiplyScalar:function(i){this.n11*=i,this.n12*=i,this.n13*=i,this.n14*=i,this.n21*=i,this.n22*=i,this.n23*=i,this.n24*=i,this.n31*=i,this.n32*=i,this.n33*=i,this.n34*=i,this.n41*=i,this.n42*=i,this.n43*=i,this.n44*=i},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function i(i,t,e){var n=i[t];i[t]=i[e],i[e]=n}return i(this,"n21","n12"),i(this,"n31","n13"),i(this,"n32","n23"),i(this,"n41","n14"),i(this,"n42","n24"),i(this,"n43","n34"),this},clone:function(){var i=new THREE.Matrix4;return i.n11=this.n11,i.n12=this.n12,i.n13=this.n13,i.n14=this.n14,i.n21=this.n21,i.n22=this.n22,i.n23=this.n23,i.n24=this.n24,i.n31=this.n31,i.n32=this.n32,i.n33=this.n33,i.n34=this.n34,i.n41=this.n41,i.n42=this.n42,i.n43=this.n43,i.n44=this.n44,i},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},THREE.Matrix4.translationMatrix=function(i,t,e){var n=new THREE.Matrix4;return n.n14=i,n.n24=t,n.n34=e,n},THREE.Matrix4.scaleMatrix=function(i,t,e){var n=new THREE.Matrix4;return n.n11=i,n.n22=t,n.n33=e,n},THREE.Matrix4.rotationXMatrix=function(i){var t=new THREE.Matrix4;return t.n22=t.n33=Math.cos(i),t.n32=Math.sin(i),t.n23=-t.n32,t},THREE.Matrix4.rotationYMatrix=function(i){var t=new THREE.Matrix4;return t.n11=t.n33=Math.cos(i),t.n13=Math.sin(i),t.n31=-t.n13,t},THREE.Matrix4.rotationZMatrix=function(i){var t=new THREE.Matrix4;return t.n11=t.n22=Math.cos(i),t.n21=Math.sin(i),t.n12=-t.n21,t},THREE.Matrix4.rotationAxisAngleMatrix=function(i,t){var e=new THREE.Matrix4,n=Math.cos(t),r=Math.sin(t),o=1-n,s=i.x,a=i.y,h=i.z;return e.n11=o*s*s+n,e.n12=o*s*a-r*h,e.n13=o*s*h+r*a,e.n21=o*s*a+r*h,e.n22=o*a*a+n,e.n23=o*a*h-r*s,e.n31=o*s*h-r*a,e.n32=o*a*h+r*s,e.n33=o*h*h+n,e},THREE.Matrix4.makeInvert=function(i){var t=new THREE.Matrix4;return t.n11=i.n23*i.n34*i.n42-i.n24*i.n33*i.n42+i.n24*i.n32*i.n43-i.n22*i.n34*i.n43-i.n23*i.n32*i.n44+i.n22*i.n33*i.n44,t.n12=i.n14*i.n33*i.n42-i.n13*i.n34*i.n42-i.n14*i.n32*i.n43+i.n12*i.n34*i.n43+i.n13*i.n32*i.n44-i.n12*i.n33*i.n44,t.n13=i.n13*i.n24*i.n42-i.n14*i.n23*i.n42+i.n14*i.n22*i.n43-i.n12*i.n24*i.n43-i.n13*i.n22*i.n44+i.n12*i.n23*i.n44,t.n14=i.n14*i.n23*i.n32-i.n13*i.n24*i.n32-i.n14*i.n22*i.n33+i.n12*i.n24*i.n33+i.n13*i.n22*i.n34-i.n12*i.n23*i.n34,t.n21=i.n24*i.n33*i.n41-i.n23*i.n34*i.n41-i.n24*i.n31*i.n43+i.n21*i.n34*i.n43+i.n23*i.n31*i.n44-i.n21*i.n33*i.n44,t.n22=i.n13*i.n34*i.n41-i.n14*i.n33*i.n41+i.n14*i.n31*i.n43-i.n11*i.n34*i.n43-i.n13*i.n31*i.n44+i.n11*i.n33*i.n44,t.n23=i.n14*i.n23*i.n41-i.n13*i.n24*i.n41-i.n14*i.n21*i.n43+i.n11*i.n24*i.n43+i.n13*i.n21*i.n44-i.n11*i.n23*i.n44,t.n24=i.n13*i.n24*i.n31-i.n14*i.n23*i.n31+i.n14*i.n21*i.n33-i.n11*i.n24*i.n33-i.n13*i.n21*i.n34+i.n11*i.n23*i.n34,t.n31=i.n22*i.n34*i.n41-i.n24*i.n32*i.n41+i.n24*i.n31*i.n42-i.n21*i.n34*i.n42-i.n22*i.n31*i.n44+i.n21*i.n32*i.n44,t.n32=i.n14*i.n32*i.n41-i.n12*i.n34*i.n41-i.n14*i.n31*i.n42+i.n11*i.n34*i.n42+i.n12*i.n31*i.n44-i.n11*i.n32*i.n44,t.n33=i.n13*i.n24*i.n41-i.n14*i.n22*i.n41+i.n14*i.n21*i.n42-i.n11*i.n24*i.n42-i.n12*i.n21*i.n44+i.n11*i.n22*i.n44,t.n34=i.n14*i.n22*i.n31-i.n12*i.n24*i.n31-i.n14*i.n21*i.n32+i.n11*i.n24*i.n32+i.n12*i.n21*i.n34-i.n11*i.n22*i.n34,t.n41=i.n23*i.n32*i.n41-i.n22*i.n33*i.n41-i.n23*i.n31*i.n42+i.n21*i.n33*i.n42+i.n22*i.n31*i.n43-i.n21*i.n32*i.n43,t.n42=i.n12*i.n33*i.n41-i.n13*i.n32*i.n41+i.n13*i.n31*i.n42-i.n11*i.n33*i.n42-i.n12*i.n31*i.n43+i.n11*i.n32*i.n43,t.n43=i.n13*i.n22*i.n41-i.n12*i.n23*i.n41-i.n13*i.n21*i.n42+i.n11*i.n23*i.n42+i.n12*i.n21*i.n43-i.n11*i.n22*i.n43,t.n44=i.n12*i.n23*i.n31-i.n13*i.n22*i.n31+i.n13*i.n21*i.n32-i.n11*i.n23*i.n32-i.n12*i.n21*i.n33+i.n11*i.n22*i.n33,t.multiplyScalar(1/i.determinant()),t},THREE.Matrix4.makeInvert3x3=function(i){var t=i.flatten();i=new THREE.Matrix3;var e=t[10]*t[5]-t[6]*t[9],n=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],o=-t[10]*t[4]+t[6]*t[8],s=t[10]*t[0]-t[2]*t[8],a=-t[6]*t[0]+t[2]*t[4],h=t[9]*t[4]-t[5]*t[8],l=-t[9]*t[0]+t[1]*t[8],c=t[5]*t[0]-t[1]*t[4];if(t=t[0]*e+t[1]*o+t[2]*h,0==t)throw"matrix not invertible";return t=1/t,i.m[0]=t*e,i.m[1]=t*n,i.m[2]=t*r,i.m[3]=t*o,i.m[4]=t*s,i.m[5]=t*a,i.m[6]=t*h,i.m[7]=t*l,i.m[8]=t*c,i},THREE.Matrix4.makeFrustum=function(i,t,e,n,r,o){var s,a,h;return s=new THREE.Matrix4,a=2*r/(t-i),h=2*r/(n-e),i=(t+i)/(t-i),e=(n+e)/(n-e),n=-(o+r)/(o-r),r=-2*o*r/(o-r),s.n11=a,s.n12=0,s.n13=i,s.n14=0,s.n21=0,s.n22=h,s.n23=e,s.n24=0,s.n31=0,s.n32=0,s.n33=n,s.n34=r,s.n41=0,s.n42=0,s.n43=-1,s.n44=0,s},THREE.Matrix4.makePerspective=function(i,t,e,n){var r;return i=e*Math.tan(i*Math.PI/360),r=-i,THREE.Matrix4.makeFrustum(r*t,i*t,r,i,e,n)},THREE.Matrix4.makeOrtho=function(i,t,e,n,r,o){var s,a,h,l;return s=new THREE.Matrix4,a=t-i,h=e-n,l=o-r,i=(t+i)/a,e=(e+n)/h,r=(o+r)/l,s.n11=2/a,s.n12=0,s.n13=0,s.n14=-i,s.n21=0,s.n22=2/h,s.n23=0,s.n24=-e,s.n31=0,s.n32=0,s.n33=-2/l,s.n34=-r,s.n41=0,s.n42=0,s.n43=0,s.n44=1,s},THREE.Vertex=function(i,t){this.position=i||new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.normal=t||new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.normalScreen=new THREE.Vector3,this.__visible=!0},THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},THREE.Face3=function(i,t,e,n,r){this.a=i,this.b=t,this.c=e,this.centroid=new THREE.Vector3,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.material=r instanceof Array?r:[r]},THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},THREE.Face4=function(i,t,e,n,r,o){this.a=i,this.b=t,this.c=e,this.d=n,this.centroid=new THREE.Vector3,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.material=o instanceof Array?o:[o]},THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},THREE.UV=function(i,t){this.u=i||0,this.v=t||0},THREE.UV.prototype={copy:function(i){this.u=i.u,this.v=i.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},THREE.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[],this.geometryChunks={}},THREE.Geometry.prototype={computeCentroids:function(){var i,t,e;for(i=0,t=this.faces.length;i<t;i++)e=this.faces[i],e.centroid.set(0,0,0),e instanceof THREE.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof THREE.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeNormals:function(i){var t,e,n,r,o,s,a=new THREE.Vector3,h=new THREE.Vector3;for(n=0,r=this.vertices.length;n<r;n++)o=this.vertices[n],o.normal.set(0,0,0);for(n=0,r=this.faces.length;n<r;n++){if(o=this.faces[n],i&&o.vertexNormals.length){for(a.set(0,0,0),t=0,e=o.normal.length;t<e;t++)a.addSelf(o.vertexNormals[t]);a.divideScalar(3)}else t=this.vertices[o.a],e=this.vertices[o.b],s=this.vertices[o.c],a.sub(s.position,e.position),h.sub(t.position,e.position),a.crossSelf(h);a.isZero()||a.normalize(),o.normal.copy(a)}},computeVertexNormals:function(){var i,t,e,n=[];for(i=0,vl=this.vertices.length;i<vl;i++)n[i]=new THREE.Vector3;for(i=0,t=this.faces.length;i<t;i++)e=this.faces[i],e instanceof THREE.Face3?(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal)):e instanceof THREE.Face4&&(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal),n[e.d].addSelf(e.normal));for(i=0,vl=this.vertices.length;i<vl;i++)n[i].normalize();for(i=0,t=this.faces.length;i<t;i++)e=this.faces[i],e instanceof THREE.Face3?(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone()):e instanceof THREE.Face4&&(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone(),e.vertexNormals[3]=n[e.d].clone())},computeBoundingBox:function(){if(this.vertices.length>0){this.bbox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var i=1,t=this.vertices.length;i<t;i++)vertex=this.vertices[i],vertex.position.x<this.bbox.x[0]?this.bbox.x[0]=vertex.position.x:vertex.position.x>this.bbox.x[1]&&(this.bbox.x[1]=vertex.position.x),vertex.position.y<this.bbox.y[0]?this.bbox.y[0]=vertex.position.y:vertex.position.y>this.bbox.y[1]&&(this.bbox.y[1]=vertex.position.y),vertex.position.z<this.bbox.z[0]?this.bbox.z[0]=vertex.position.z:vertex.position.z>this.bbox.z[1]&&(this.bbox.z[1]=vertex.position.z)}},sortFacesByMaterial:function(){function i(i){var n=[];for(t=0,e=i.length;t<e;t++)void 0==i[t]?n.push("undefined"):n.push(i[t].toString());return n.join("_")}var t,e,n,r,o,s,a,h,l={};for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s=o.material,a=i(s),void 0==l[a]&&(l[a]={hash:a,counter:0}),h=l[a].hash+"_"+l[a].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],material:s,vertices:0}),o=o instanceof THREE.Face3?3:4,this.geometryChunks[h].vertices+o>65535&&(l[a].counter+=1,h=l[a].hash+"_"+l[a].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],material:s,vertices:0})),this.geometryChunks[h].faces.push(n),this.geometryChunks[h].vertices+=o},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+", uvs: "+this.uvs+" )"}},THREE.Camera=function(i,t,e,n){this.position=new THREE.Vector3(0,0,0),this.target={position:new THREE.Vector3(0,0,0)},this.up=new THREE.Vector3(0,1,0),this.matrix=new THREE.Matrix4,this.projectionMatrix=THREE.Matrix4.makePerspective(i,t,e,n),this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},THREE.Light=function(i){this.color=new THREE.Color(i)},THREE.AmbientLight=function(i){THREE.Light.call(this,i)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(i,t){THREE.Light.call(this,i),this.position=new THREE.Vector3(0,1,0),this.intensity=t||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(i,t){THREE.Light.call(this,i),this.position=new THREE.Vector3,this.intensity=t||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.PointLight,THREE.Object3D=function(){this.id=THREE.Object3DCounter.value++,this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.matrix=new THREE.Matrix4,this.translationMatrix=new THREE.Matrix4,this.rotationMatrix=new THREE.Matrix4,this.scaleMatrix=new THREE.Matrix4,this.screen=new THREE.Vector3,this.autoUpdateMatrix=this.visible=!0,this.updateMatrix=function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z),this.rotationMatrix=THREE.Matrix4.rotationXMatrix(this.rotation.x),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y)),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z)),this.scaleMatrix=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z),this.matrix.copy(this.matrixPosition),this.matrix.multiplySelf(this.rotationMatrix),this.matrix.multiplySelf(this.scaleMatrix)}},THREE.Object3DCounter={value:0},THREE.Particle=function(i){THREE.Object3D.call(this),this.material=i instanceof Array?i:[i],this.autoUpdateMatrix=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(i,t){THREE.Object3D.call(this),this.geometry=i,this.material=t instanceof Array?t:[t]},THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(i,t,e){THREE.Object3D.call(this),this.geometry=i,this.material=t instanceof Array?t:[t],this.overdraw=this.doubleSided=this.flipSided=!1,e&&this.normalizeUVs(),this.geometry.computeBoundingBox()},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.normalizeUVs=function(){var i,t,e,n,r;for(i=0,t=this.geometry.uvs.length;i<t;i++)for(r=this.geometry.uvs[i],e=0,n=r.length;e<n;e++)1!=r[e].u&&(r[e].u-=Math.floor(r[e].u)),1!=r[e].v&&(r[e].v-=Math.floor(r[e].v))},THREE.FlatShading=0,THREE.SmoothShading=1,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.LineBasicMaterial=function(i){this.color=new THREE.Color(16711680),this.opacity=1,this.blending=THREE.NormalBlending,this.linewidth=1,this.linejoin=this.linecap="round",i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.linewidth&&(this.linewidth=i.linewidth),void 0!==i.linecap&&(this.linecap=i.linecap),void 0!==i.linejoin&&(this.linejoin=i.linejoin)),this.toString=function(){return"THREE.LineBasicMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>linewidth: "+this.linewidth+"<br/>linecap: "+this.linecap+"<br/>linejoin: "+this.linejoin+"<br/>)"}},THREE.MeshBasicMaterial=function(i){this.id=THREE.MeshBasicMaterialCounter.value++,this.color=new THREE.Color(15658734),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.map&&(this.map=i.map),void 0!==i.env_map&&(this.env_map=i.env_map),void 0!==i.combine&&(this.combine=i.combine),void 0!==i.reflectivity&&(this.reflectivity=i.reflectivity),void 0!==i.refraction_ratio&&(this.refraction_ratio=i.refraction_ratio),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin)),this.toString=function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshBasicMaterialCounter={value:0},THREE.MeshLambertMaterial=function(i){this.id=THREE.MeshLambertMaterialCounter.value++,this.color=new THREE.Color(15658734),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.map&&(this.map=i.map),void 0!==i.env_map&&(this.env_map=i.env_map),void 0!==i.combine&&(this.combine=i.combine),void 0!==i.reflectivity&&(this.reflectivity=i.reflectivity),void 0!==i.refraction_ratio&&(this.refraction_ratio=i.refraction_ratio),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin)),this.toString=function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/> )"}},THREE.MeshLambertMaterialCounter={value:0},THREE.MeshPhongMaterial=function(i){this.id=THREE.MeshPhongMaterialCounter.value++,this.color=new THREE.Color(15658734),this.ambient=new THREE.Color(328965),this.specular=new THREE.Color(1118481),this.shininess=30,this.env_map=this.specular_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.color&&(this.color=new THREE.Color(i.color)),void 0!==i.ambient&&(this.ambient=new THREE.Color(i.ambient)),void 0!==i.specular&&(this.specular=new THREE.Color(i.specular)),void 0!==i.shininess&&(this.shininess=i.shininess),void 0!==i.map&&(this.map=i.map),void 0!==i.specular_map&&(this.specular_map=i.specular_map),void 0!==i.env_map&&(this.env_map=i.env_map),void 0!==i.combine&&(this.combine=i.combine),void 0!==i.reflectivity&&(this.reflectivity=i.reflectivity),void 0!==i.refraction_ratio&&(this.refraction_ratio=i.refraction_ratio),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin)),this.toString=function(){return"THREE.MeshPhongMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>shininess: "+this.shininess+"<br/>map: "+this.map+"<br/>specular_map: "+this.specular_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>NaN"}},THREE.MeshPhongMaterialCounter={value:0},THREE.MeshDepthMaterial=function(i){this.near=1,this.far=1e3,this.opacity=1,this.blending=THREE.NormalBlending,i&&(void 0!==i.near&&(this.near=i.near),void 0!==i.far&&(this.far=i.far),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending)),this.__2near=2*this.near,this.__farPlusNear=this.far+this.near,this.__farMinusNear=this.far-this.near,this.toString=function(){return"THREE.MeshDepthMaterial"}},THREE.MeshNormalMaterial=function(i){this.opacity=1,this.shading=THREE.FlatShading,this.blending=THREE.NormalBlending,i&&(void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending)),this.toString=function(){return"THREE.MeshNormalMaterial"}},THREE.MeshFaceMaterial=function(){this.toString=function(){return"THREE.MeshFaceMaterial";
}},THREE.MeshCubeMaterial=function(i){this.id=THREE.MeshCubeMaterial.value++,this.env_map=null,this.blending=THREE.NormalBlending,i&&void 0!==i.env_map&&(this.env_map=i.env_map),this.toString=function(){return"THREE.MeshCubeMaterial( id: "+this.id+"<br/>env_map: "+this.env_map+" )"}},THREE.MeshCubeMaterialCounter={value:0},THREE.MeshShaderMaterial=function(i){this.id=THREE.MeshShaderMaterialCounter.value++,this.vertex_shader=this.fragment_shader="void main() {}",this.uniforms={},this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.fragment_shader&&(this.fragment_shader=i.fragment_shader),void 0!==i.vertex_shader&&(this.vertex_shader=i.vertex_shader),void 0!==i.uniforms&&(this.uniforms=i.uniforms),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin)),this.toString=function(){return"THREE.MeshShaderMaterial (<br/>id: "+this.id+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshShaderMaterialCounter={value:0},THREE.ParticleBasicMaterial=function(i){this.color=new THREE.Color(16711680),this.map=null,this.opacity=1,this.blending=THREE.NormalBlending,this.offset=new THREE.Vector2,i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.map&&(this.map=i.map),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending)),this.toString=function(){return"THREE.ParticleBasicMaterial (<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleCircleMaterial=function(i){this.color=new THREE.Color(16711680),this.opacity=1,this.blending=THREE.NormalBlending,i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending)),this.toString=function(){return"THREE.ParticleCircleMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleDOMMaterial=function(i){this.domElement=i,this.toString=function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}},THREE.Texture=function(i,t,e,n,r,o){this.image=i,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrap_s=void 0!==e?e:THREE.ClampToEdgeWrapping,this.wrap_t=void 0!==n?n:THREE.ClampToEdgeWrapping,this.mag_filter=void 0!==r?r:THREE.LinearFilter,this.min_filter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.toString=function(){return"THREE.Texture (<br/>image: "+this.image+"<br/>wrap_s: "+this.wrap_s+"<br/>wrap_t: "+this.wrap_t+"<br/>mag_filter: "+this.mag_filter+"<br/>min_filter: "+this.min_filter+"<br/>)"}},THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.Scene=function(){this.objects=[],this.lights=[],this.addObject=function(i){this.objects.push(i)},this.removeObject=function(i){i=this.objects.indexOf(i),i!==-1&&this.objects.splice(i,1)},this.addLight=function(i){this.lights.push(i)},this.removeLight=function(i){i=this.lights.indexOf(i),i!==-1&&this.lights.splice(i,1)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},THREE.Projector=function(){function i(i,t){var e=0,n=1,r=i.z+i.w,o=t.z+t.w,s=-i.z+i.w,a=-t.z+t.w;return r>=0&&o>=0&&s>=0&&a>=0||!(r<0&&o<0||s<0&&a<0)&&(r<0?e=Math.max(e,r/(r-o)):o<0&&(n=Math.min(n,r/(r-o))),s<0?e=Math.max(e,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<e)&&(i.lerpSelf(t,e),t.lerpSelf(i,1-n),!0))}var t,e,n,r,o,s,a,h,l=null,c=[],f=[],u=[],m=new THREE.Vector4,E=new THREE.Matrix4,p=new THREE.Matrix4,d=new THREE.Vector4,g=new THREE.Vector4;this.projectScene=function(v,b){var R,y,T,x,_,M,w,H,S,L,C,z,A,P,N,B,F;for(l=[],n=o=a=0,b.autoUpdateMatrix&&b.updateMatrix(),E.multiply(b.projectionMatrix,b.matrix),w=v.objects,R=0,y=w.length;R<y;R++)if(H=w[R],H.autoUpdateMatrix&&H.updateMatrix(),S=H.matrix,L=H.rotationMatrix,C=H.material,z=H.overdraw,H instanceof THREE.Mesh){for(A=H.geometry.vertices,T=0,x=A.length;T<x;T++)P=A[T],P.positionWorld.copy(P.position),S.multiplyVector3(P.positionWorld),N=P.positionScreen,N.copy(P.positionWorld),E.multiplyVector4(N),N.multiplyScalar(1/N.w),P.__visible=N.z>0&&N.z<1;for(P=H.geometry.faces,T=0,x=P.length;T<x;T++)if(N=P[T],N instanceof THREE.Face3){if(_=A[N.a],M=A[N.b],B=A[N.c],_.__visible&&M.__visible&&B.__visible&&(H.doubleSided||H.flipSided!=(B.positionScreen.x-_.positionScreen.x)*(M.positionScreen.y-_.positionScreen.y)-(B.positionScreen.y-_.positionScreen.y)*(M.positionScreen.x-_.positionScreen.x)<0)){for(t=c[n]=c[n]||new THREE.RenderableFace3,t.v1.positionWorld.copy(_.positionWorld),t.v2.positionWorld.copy(M.positionWorld),t.v3.positionWorld.copy(B.positionWorld),t.v1.positionScreen.copy(_.positionScreen),t.v2.positionScreen.copy(M.positionScreen),t.v3.positionScreen.copy(B.positionScreen),t.normalWorld.copy(N.normal),L.multiplyVector3(t.normalWorld),t.centroidWorld.copy(N.centroid),S.multiplyVector3(t.centroidWorld),t.centroidScreen.copy(t.centroidWorld),E.multiplyVector3(t.centroidScreen),B=N.vertexNormals,h=t.vertexNormalsWorld,_=0,M=B.length;_<M;_++)F=h[_]=h[_]||new THREE.Vector3,F.copy(B[_]),L.multiplyVector3(F);t.z=t.centroidScreen.z,t.meshMaterial=C,t.faceMaterial=N.material,t.overdraw=z,H.geometry.uvs[T]&&(t.uvs[0]=H.geometry.uvs[T][0],t.uvs[1]=H.geometry.uvs[T][1],t.uvs[2]=H.geometry.uvs[T][2]),l.push(t),n++}}else N instanceof THREE.Face4&&(_=A[N.a],M=A[N.b],B=A[N.c],F=A[N.d],_.__visible&&M.__visible&&B.__visible&&F.__visible&&(H.doubleSided||H.flipSided!=((F.positionScreen.x-_.positionScreen.x)*(M.positionScreen.y-_.positionScreen.y)-(F.positionScreen.y-_.positionScreen.y)*(M.positionScreen.x-_.positionScreen.x)<0||(M.positionScreen.x-B.positionScreen.x)*(F.positionScreen.y-B.positionScreen.y)-(M.positionScreen.y-B.positionScreen.y)*(F.positionScreen.x-B.positionScreen.x)<0))&&(t=c[n]=c[n]||new THREE.RenderableFace3,t.v1.positionWorld.copy(_.positionWorld),t.v2.positionWorld.copy(M.positionWorld),t.v3.positionWorld.copy(F.positionWorld),t.v1.positionScreen.copy(_.positionScreen),t.v2.positionScreen.copy(M.positionScreen),t.v3.positionScreen.copy(F.positionScreen),t.normalWorld.copy(N.normal),L.multiplyVector3(t.normalWorld),t.centroidWorld.copy(N.centroid),S.multiplyVector3(t.centroidWorld),t.centroidScreen.copy(t.centroidWorld),E.multiplyVector3(t.centroidScreen),t.z=t.centroidScreen.z,t.meshMaterial=C,t.faceMaterial=N.material,t.overdraw=z,H.geometry.uvs[T]&&(t.uvs[0]=H.geometry.uvs[T][0],t.uvs[1]=H.geometry.uvs[T][1],t.uvs[2]=H.geometry.uvs[T][3]),l.push(t),n++,e=c[n]=c[n]||new THREE.RenderableFace3,e.v1.positionWorld.copy(M.positionWorld),e.v2.positionWorld.copy(B.positionWorld),e.v3.positionWorld.copy(F.positionWorld),e.v1.positionScreen.copy(M.positionScreen),e.v2.positionScreen.copy(B.positionScreen),e.v3.positionScreen.copy(F.positionScreen),e.normalWorld.copy(t.normalWorld),e.centroidWorld.copy(t.centroidWorld),e.centroidScreen.copy(t.centroidScreen),e.z=e.centroidScreen.z,e.meshMaterial=C,e.faceMaterial=N.material,e.overdraw=z,H.geometry.uvs[T]&&(e.uvs[0]=H.geometry.uvs[T][1],e.uvs[1]=H.geometry.uvs[T][2],e.uvs[2]=H.geometry.uvs[T][3]),l.push(e),n++))}else if(H instanceof THREE.Line)for(p.multiply(E,S),A=H.geometry.vertices,P=A[0],P.positionScreen.copy(P.position),p.multiplyVector4(P.positionScreen),T=1,x=A.length;T<x;T++)_=A[T],_.positionScreen.copy(_.position),p.multiplyVector4(_.positionScreen),M=A[T-1],d.copy(_.positionScreen),g.copy(M.positionScreen),i(d,g)&&(d.multiplyScalar(1/d.w),g.multiplyScalar(1/g.w),r=f[o]=f[o]||new THREE.RenderableLine,r.v1.positionScreen.copy(d),r.v2.positionScreen.copy(g),r.z=Math.max(d.z,g.z),r.material=H.material,l.push(r),o++);else H instanceof THREE.Particle&&(m.set(H.position.x,H.position.y,H.position.z,1),E.multiplyVector4(m),m.z/=m.w,m.z>0&&m.z<1&&(s=u[a]=u[a]||new THREE.RenderableParticle,s.x=m.x/m.w,s.y=m.y/m.w,s.z=m.z,s.rotation=H.rotation.z,s.scale.x=H.scale.x*Math.abs(s.x-(m.x+b.projectionMatrix.n11)/(m.w+b.projectionMatrix.n14)),s.scale.y=H.scale.y*Math.abs(s.y-(m.y+b.projectionMatrix.n22)/(m.w+b.projectionMatrix.n24)),s.material=H.material,l.push(s),a++));return l.sort(function(i,t){return t.z-i.z}),l},this.unprojectVector=function(i,t){var e=new THREE.Matrix4;return e.multiply(THREE.Matrix4.makeInvert(t.matrix),THREE.Matrix4.makeInvert(t.projectionMatrix)),e.multiplyVector3(i),i}},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var i,t,e,n,r=null,o=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(r,o){i=r,t=o,e=i/2,n=t/2},this.render=function(i,t){var s,a,h,l,c,f,u,m;for(r=o.projectScene(i,t),s=0,a=r.length;s<a;s++)if(c=r[s],c instanceof THREE.RenderableParticle)for(u=c.x*e+e,m=c.y*n+n,h=0,l=c.material.length;h<l;h++)f=c.material[h],f instanceof THREE.ParticleDOMMaterial&&(f=f.domElement,f.style.left=u+"px",f.style.top=m+"px")}},THREE.CanvasRenderer=function(){var i,t,e,n,r,o,s,a,h,l,c,f,u,m,E,p,d,g,v,b,R,y,T,x,_,M,w,H,S,L=null,C=new THREE.Projector,z=document.createElement("canvas"),A=z.getContext("2d"),P=1,N=0,B=null,F=null,V=1,W=Math.min,D=Math.max,j=new THREE.Color,U=new THREE.Color,G=new THREE.Color,I=new THREE.Color,O=new THREE.Color,k=new THREE.Rectangle,X=new THREE.Rectangle,Y=new THREE.Rectangle,q=!1,Z=new THREE.Color,K=new THREE.Color,Q=new THREE.Color,J=new THREE.Color,$=2*Math.PI,ii=new THREE.Vector3,ti=16;x=document.createElement("canvas"),x.width=x.height=2,_=x.getContext("2d"),_.fillStyle="rgba(0,0,0,1)",_.fillRect(0,0,2,2),M=_.getImageData(0,0,2,2),w=M.data,H=document.createElement("canvas"),H.width=H.height=ti,S=H.getContext("2d"),S.translate(-ti/2,-ti/2),S.scale(ti,ti),ti--,this.domElement=z,this.autoClear=!0,this.setSize=function(r,o){i=r,t=o,e=i/2,n=t/2,z.width=i,z.height=t,k.set(-e,-n,e,n)},this.clear=function(){X.isEmpty()||(X.inflate(1),X.minSelf(k),A.clearRect(X.getX(),X.getY(),X.getWidth(),X.getHeight()),X.empty())},this.render=function(i,t){function z(i){var t,e,n,r=i.lights;for(K.setRGB(0,0,0),Q.setRGB(0,0,0),J.setRGB(0,0,0),i=0,t=r.length;i<t;i++)e=r[i],n=e.color,e instanceof THREE.AmbientLight?(K.r+=n.r,K.g+=n.g,K.b+=n.b):e instanceof THREE.DirectionalLight?(Q.r+=n.r,Q.g+=n.g,Q.b+=n.b):e instanceof THREE.PointLight&&(J.r+=n.r,J.g+=n.g,J.b+=n.b)}function ti(i,t,e,n){var r,o,s,a,h=i.lights;for(i=0,r=h.length;i<r;i++)o=h[i],s=o.color,a=o.intensity,o instanceof THREE.DirectionalLight?(o=e.dot(o.position)*a,o>0&&(n.r+=s.r*o,n.g+=s.g*o,n.b+=s.b*o)):o instanceof THREE.PointLight&&(ii.sub(o.position,t),ii.normalize(),o=e.dot(ii)*a,o>0&&(n.r+=s.r*o,n.g+=s.g*o,n.b+=s.b*o))}function ei(i,t,r){if(0!=r.opacity){hi(r.opacity),li(r.blending);var o,s,a,h,l,c;if(r instanceof THREE.ParticleBasicMaterial){if(r.map){if(h=r.map,l=h.width>>1,c=h.height>>1,s=t.scale.x*e,a=t.scale.y*n,r=s*l,o=a*c,Y.set(i.x-r,i.y-o,i.x+r,i.y+o),!k.instersects(Y))return;A.save(),A.translate(i.x,i.y),A.rotate(-t.rotation),A.scale(s,-a),A.translate(-l,-c),A.drawImage(h,0,0),A.restore()}A.beginPath(),A.moveTo(i.x-10,i.y),A.lineTo(i.x+10,i.y),A.moveTo(i.x,i.y-10),A.lineTo(i.x,i.y+10),A.closePath(),A.strokeStyle="rgb(255,255,0)",A.stroke()}else r instanceof THREE.ParticleCircleMaterial&&(q?(Z.r=K.r+Q.r+J.r,Z.g=K.g+Q.g+J.g,Z.b=K.b+Q.b+J.b,j.r=r.color.r*Z.r,j.g=r.color.g*Z.g,j.b=r.color.b*Z.b,j.updateStyleString()):j.__styleString=r.color.__styleString,r=t.scale.x*e,o=t.scale.y*n,Y.set(i.x-r,i.y-o,i.x+r,i.y+o),k.instersects(Y)&&(s=j.__styleString,F!=s&&(A.fillStyle=F=s),A.save(),A.translate(i.x,i.y),A.rotate(-t.rotation),A.scale(r,o),A.beginPath(),A.arc(0,0,1,0,$,!0),A.closePath(),A.fill(),A.restore()))}}function ni(i,t,e,n){0!=n.opacity&&(hi(n.opacity),li(n.blending),A.beginPath(),A.moveTo(i.positionScreen.x,i.positionScreen.y),A.lineTo(t.positionScreen.x,t.positionScreen.y),A.closePath(),n instanceof THREE.LineBasicMaterial&&(j.__styleString=n.color.__styleString,i=n.linewidth,V!=i&&(A.lineWidth=V=i),i=j.__styleString,B!=i&&(A.strokeStyle=B=i),A.stroke(),Y.inflate(2*n.linewidth)))}function ri(i,e,n,r,o,s){0!=o.opacity&&(hi(o.opacity),li(o.blending),a=i.positionScreen.x,h=i.positionScreen.y,l=e.positionScreen.x,c=e.positionScreen.y,f=n.positionScreen.x,u=n.positionScreen.y,A.beginPath(),A.moveTo(a,h),A.lineTo(l,c),A.lineTo(f,u),A.lineTo(a,h),A.closePath(),o instanceof THREE.MeshBasicMaterial?o.map?o.map.image.loaded&&o.map.mapping instanceof THREE.UVMapping&&ai(a,h,l,c,f,u,o.map.image,r.uvs[0].u,r.uvs[0].v,r.uvs[1].u,r.uvs[1].v,r.uvs[2].u,r.uvs[2].v):o.env_map?o.env_map.image.loaded&&o.env_map.mapping instanceof THREE.SphericalReflectionMapping&&(i=t.matrix,ii.copy(r.vertexNormalsWorld[0]),g=.5*(ii.x*i.n11+ii.y*i.n12+ii.z*i.n13)+.5,v=.5*-(ii.x*i.n21+ii.y*i.n22+ii.z*i.n23)+.5,ii.copy(r.vertexNormalsWorld[1]),b=.5*(ii.x*i.n11+ii.y*i.n12+ii.z*i.n13)+.5,R=.5*-(ii.x*i.n21+ii.y*i.n22+ii.z*i.n23)+.5,ii.copy(r.vertexNormalsWorld[2]),y=.5*(ii.x*i.n11+ii.y*i.n12+ii.z*i.n13)+.5,T=.5*-(ii.x*i.n21+ii.y*i.n22+ii.z*i.n23)+.5,ai(a,h,l,c,f,u,o.env_map.image,g,v,b,R,y,T)):o.wireframe?oi(o.color.__styleString,o.wireframe_linewidth):si(o.color.__styleString):o instanceof THREE.MeshLambertMaterial?(o.map&&!o.wireframe&&(o.map.mapping instanceof THREE.UVMapping&&ai(a,h,l,c,f,u,o.map.image,r.uvs[0].u,r.uvs[0].v,r.uvs[1].u,r.uvs[1].v,r.uvs[2].u,r.uvs[2].v),li(THREE.SubtractiveBlending)),q?o.wireframe||o.shading!=THREE.SmoothShading||3!=r.vertexNormalsWorld.length?(Z.r=K.r,Z.g=K.g,Z.b=K.b,ti(s,r.centroidWorld,r.normalWorld,Z),j.r=o.color.r*Z.r,j.g=o.color.g*Z.g,j.b=o.color.b*Z.b,j.updateStyleString(),o.wireframe?oi(j.__styleString,o.wireframe_linewidth):si(j.__styleString)):(U.r=G.r=I.r=K.r,U.g=G.g=I.g=K.g,U.b=G.b=I.b=K.b,ti(s,r.v1.positionWorld,r.vertexNormalsWorld[0],U),ti(s,r.v2.positionWorld,r.vertexNormalsWorld[1],G),ti(s,r.v3.positionWorld,r.vertexNormalsWorld[2],I),O.r=.5*(G.r+I.r),O.g=.5*(G.g+I.g),O.b=.5*(G.b+I.b),d=ci(U,G,I,O),ai(a,h,l,c,f,u,d,0,0,1,0,0,1)):o.wireframe?oi(o.color.__styleString,o.wireframe_linewidth):si(o.color.__styleString)):o instanceof THREE.MeshDepthMaterial?(m=o.__2near,E=o.__farPlusNear,p=o.__farMinusNear,U.r=U.g=U.b=1-m/(E-i.positionScreen.z*p),G.r=G.g=G.b=1-m/(E-e.positionScreen.z*p),I.r=I.g=I.b=1-m/(E-n.positionScreen.z*p),O.r=.5*(G.r+I.r),O.g=.5*(G.g+I.g),O.b=.5*(G.b+I.b),d=ci(U,G,I,O),ai(a,h,l,c,f,u,d,0,0,1,0,0,1)):o instanceof THREE.MeshNormalMaterial&&(j.r=fi(r.normalWorld.x),j.g=fi(r.normalWorld.y),j.b=fi(r.normalWorld.z),j.updateStyleString(),o.wireframe?oi(j.__styleString,o.wireframe_linewidth):si(j.__styleString)))}function oi(i,t){B!=i&&(A.strokeStyle=B=i),V!=t&&(A.lineWidth=V=t),A.stroke(),Y.inflate(2*t)}function si(i){F!=i&&(A.fillStyle=F=i),A.fill()}function ai(i,t,e,n,r,o,s,a,h,l,c,f,u){var m,E;m=s.width-1,E=s.height-1,a*=m,h*=E,l*=m,c*=E,f*=m,u*=E,e-=i,n-=t,r-=i,o-=t,l-=a,c-=h,f-=a,u-=h,E=1/(l*u-f*c),m=(u*e-c*r)*E,c=(u*n-c*o)*E,e=(l*r-f*e)*E,n=(l*o-f*n)*E,i=i-m*a-e*h,t=t-c*a-n*h,A.save(),A.transform(m,c,e,n,i,t),A.clip(),A.drawImage(s,0,0),A.restore()}function hi(i){P!=i&&(A.globalAlpha=P=i)}function li(i){if(N!=i){switch(i){case THREE.NormalBlending:A.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:A.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:A.globalCompositeOperation="darker"}N=i}}function ci(i,t,e,n){return w[0]=D(0,W(255,~~(255*i.r))),w[1]=D(0,W(255,~~(255*i.g))),w[2]=D(0,W(255,~~(255*i.b))),w[4]=D(0,W(255,~~(255*t.r))),w[5]=D(0,W(255,~~(255*t.g))),w[6]=D(0,W(255,~~(255*t.b))),w[8]=D(0,W(255,~~(255*e.r))),w[9]=D(0,W(255,~~(255*e.g))),w[10]=D(0,W(255,~~(255*e.b))),w[12]=D(0,W(255,~~(255*n.r))),w[13]=D(0,W(255,~~(255*n.g))),w[14]=D(0,W(255,~~(255*n.b))),_.putImageData(M,0,0),S.drawImage(x,0,0),H}function fi(i){return i<0?W(.5*(1+i),.5):.5+W(.5*i,.5)}function ui(i,t){var e=t.x-i.x,n=t.y-i.y,r=1/Math.sqrt(e*e+n*n);e*=r,n*=r,t.x+=e,t.y+=n,i.x-=e,i.y-=n}var mi,Ei,pi,di,gi,vi,bi,Ri;for(A.setTransform(1,0,0,-1,e,n),this.autoClear&&this.clear(),L=C.projectScene(i,t),A.fillStyle="rgba(0, 255, 255, 0.5)",A.fillRect(k.getX(),k.getY(),k.getWidth(),k.getHeight()),(q=i.lights.length>0)&&z(i),mi=0,Ei=L.length;mi<Ei;mi++){if(pi=L[mi],Y.empty(),pi instanceof THREE.RenderableParticle)for(r=pi,r.x*=e,r.y*=n,di=0,gi=pi.material.length;di<gi;di++)ei(r,pi,pi.material[di],i);else if(pi instanceof THREE.RenderableLine){if(r=pi.v1,o=pi.v2,r.positionScreen.x*=e,r.positionScreen.y*=n,o.positionScreen.x*=e,o.positionScreen.y*=n,Y.addPoint(r.positionScreen.x,r.positionScreen.y),Y.addPoint(o.positionScreen.x,o.positionScreen.y),k.instersects(Y))for(di=0,gi=pi.material.length;di<gi;)ni(r,o,pi,pi.material[di++],i)}else if(pi instanceof THREE.RenderableFace3&&(r=pi.v1,o=pi.v2,s=pi.v3,r.positionScreen.x*=e,r.positionScreen.y*=n,o.positionScreen.x*=e,o.positionScreen.y*=n,s.positionScreen.x*=e,s.positionScreen.y*=n,pi.overdraw&&(ui(r.positionScreen,o.positionScreen),ui(o.positionScreen,s.positionScreen),ui(s.positionScreen,r.positionScreen)),Y.addPoint(r.positionScreen.x,r.positionScreen.y),Y.addPoint(o.positionScreen.x,o.positionScreen.y),Y.addPoint(s.positionScreen.x,s.positionScreen.y),k.instersects(Y)))for(di=0,gi=pi.meshMaterial.length;di<gi;)if(Ri=pi.meshMaterial[di++],Ri instanceof THREE.MeshFaceMaterial)for(vi=0,bi=pi.faceMaterial.length;vi<bi;)(Ri=pi.faceMaterial[vi++])&&ri(r,o,s,pi,Ri,i);else ri(r,o,s,pi,Ri,i);X.addRectangle(Y)}A.lineWidth=1,A.strokeStyle="rgba( 255, 0, 0, 0.5 )",A.strokeRect(X.getX(),X.getY(),X.getWidth(),X.getHeight()),A.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function i(i,t,e){var n,r,o,s;for(n=0,r=i.lights.length;n<r;n++)o=i.lights[n],o instanceof THREE.DirectionalLight?(s=t.normalWorld.dot(o.position)*o.intensity,s>0&&(e.r+=o.color.r*s,e.g+=o.color.g*s,e.b+=o.color.b*s)):o instanceof THREE.PointLight&&(L.sub(o.position,t.centroidWorld),L.normalize(),s=t.normalWorld.dot(L)*o.intensity,s>0&&(e.r+=o.color.r*s,e.g+=o.color.g*s,e.b+=o.color.b*s))}function t(t,e,o,s,a,h){E=n(p++),E.setAttribute("d","M "+t.positionScreen.x+" "+t.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),a instanceof THREE.MeshBasicMaterial?_.__styleString=a.color.__styleString:a instanceof THREE.MeshLambertMaterial?x?(M.r=w.r,M.g=w.g,M.b=w.b,i(h,s,M),_.r=a.color.r*M.r,_.g=a.color.g*M.g,_.b=a.color.b*M.b,_.updateStyleString()):_.__styleString=a.color.__styleString:a instanceof THREE.MeshDepthMaterial?(m=1-a.__2near/(a.__farPlusNear-s.z*a.__farMinusNear),_.setRGB(m,m,m)):a instanceof THREE.MeshNormalMaterial&&_.setRGB(r(s.normalWorld.x),r(s.normalWorld.y),r(s.normalWorld.z)),a.wireframe?E.setAttribute("style","fill: none; stroke: "+_.__styleString+"; stroke-width: "+a.wireframe_linewidth+"; stroke-opacity: "+a.opacity+"; stroke-linecap: "+a.wireframe_linecap+"; stroke-linejoin: "+a.wireframe_linejoin):E.setAttribute("style","fill: "+_.__styleString+"; fill-opacity: "+a.opacity),R.appendChild(E)}function e(t,e,o,s,a,h,l){E=n(p++),E.setAttribute("d","M "+t.positionScreen.x+" "+t.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+" L "+s.positionScreen.x+","+s.positionScreen.y+"z"),h instanceof THREE.MeshBasicMaterial?_.__styleString=h.color.__styleString:h instanceof THREE.MeshLambertMaterial?x?(M.r=w.r,M.g=w.g,M.b=w.b,i(l,a,M),_.r=h.color.r*M.r,_.g=h.color.g*M.g,_.b=h.color.b*M.b,_.updateStyleString()):_.__styleString=h.color.__styleString:h instanceof THREE.MeshDepthMaterial?(m=1-h.__2near/(h.__farPlusNear-a.z*h.__farMinusNear),_.setRGB(m,m,m)):h instanceof THREE.MeshNormalMaterial&&_.setRGB(r(a.normalWorld.x),r(a.normalWorld.y),r(a.normalWorld.z)),h.wireframe?E.setAttribute("style","fill: none; stroke: "+_.__styleString+"; stroke-width: "+h.wireframe_linewidth+"; stroke-opacity: "+h.opacity+"; stroke-linecap: "+h.wireframe_linecap+"; stroke-linejoin: "+h.wireframe_linejoin):E.setAttribute("style","fill: "+_.__styleString+"; fill-opacity: "+h.opacity),R.appendChild(E)}function n(i){return null==C[i]?(C[i]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==P&&C[i].setAttribute("shape-rendering","crispEdges"),C[i]):C[i]}function r(i){return i<0?Math.min(.5*(1+i),.5):.5+Math.min(.5*i,.5)}var o,s,a,h,l,c,f,u,m,E,p,d,g,v=null,b=new THREE.Projector,R=document.createElementNS("http://www.w3.org/2000/svg","svg"),y=new THREE.Rectangle,T=new THREE.Rectangle,x=!1,_=new THREE.Color(16777215),M=new THREE.Color(16777215),w=new THREE.Color(0),H=new THREE.Color(0),S=new THREE.Color(0),L=new THREE.Vector3,C=[],z=[],A=[],P=1;this.domElement=R,this.autoClear=!0,this.setQuality=function(i){switch(i){case"high":P=1;break;case"low":P=0}},this.setSize=function(i,t){o=i,s=t,a=o/2,h=s/2,R.setAttribute("viewBox",-a+" "+-h+" "+o+" "+s),R.setAttribute("width",o),R.setAttribute("height",s),y.set(-a,-h,a,h)},this.clear=function(){for(;R.childNodes.length>0;)R.removeChild(R.childNodes[0])},this.render=function(i,n){var r,o,s,m,L,C,N,B;if(this.autoClear&&this.clear(),v=b.projectScene(i,n),g=d=p=0,x=i.lights.length>0)for(N=i.lights,w.setRGB(0,0,0),H.setRGB(0,0,0),S.setRGB(0,0,0),r=0,o=N.length;r<o;r++)s=N[r],m=s.color,s instanceof THREE.AmbientLight?(w.r+=m.r,w.g+=m.g,w.b+=m.b):s instanceof THREE.DirectionalLight?(H.r+=m.r,H.g+=m.g,H.b+=m.b):s instanceof THREE.PointLight&&(S.r+=m.r,S.g+=m.g,S.b+=m.b);for(r=0,o=v.length;r<o;r++)if(N=v[r],T.empty(),N instanceof THREE.RenderableParticle){for(l=N,l.x*=a,l.y*=-h,s=0,m=N.material.length;s<m;s++)if(B=N.material[s]){L=l,C=N,B=B;var F=d++;null==z[F]&&(z[F]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==P&&z[F].setAttribute("shape-rendering","crispEdges")),E=z[F],E.setAttribute("cx",L.x),E.setAttribute("cy",L.y),E.setAttribute("r",C.scale.x*a),B instanceof THREE.ParticleCircleMaterial&&(x?(M.r=w.r+H.r+S.r,M.g=w.g+H.g+S.g,M.b=w.b+H.b+S.b,_.r=B.color.r*M.r,_.g=B.color.g*M.g,_.b=B.color.b*M.b,_.updateStyleString()):_=B.color,E.setAttribute("style","fill: "+_.__styleString)),R.appendChild(E)}}else if(N instanceof THREE.RenderableLine){if(l=N.v1,c=N.v2,l.positionScreen.x*=a,l.positionScreen.y*=-h,c.positionScreen.x*=a,c.positionScreen.y*=-h,T.addPoint(l.positionScreen.x,l.positionScreen.y),T.addPoint(c.positionScreen.x,c.positionScreen.y),y.instersects(T))for(s=0,m=N.material.length;s<m;)(B=N.material[s++])&&(L=l,C=c,B=B,F=g++,null==A[F]&&(A[F]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==P&&A[F].setAttribute("shape-rendering","crispEdges")),E=A[F],E.setAttribute("x1",L.positionScreen.x),E.setAttribute("y1",L.positionScreen.y),E.setAttribute("x2",C.positionScreen.x),E.setAttribute("y2",C.positionScreen.y),B instanceof THREE.LineBasicMaterial&&(_.__styleString=B.color.__styleString,E.setAttribute("style","fill: none; stroke: "+_.__styleString+"; stroke-width: "+B.linewidth+"; stroke-opacity: "+B.opacity+"; stroke-linecap: "+B.linecap+"; stroke-linejoin: "+B.linejoin),R.appendChild(E)))}else if(N instanceof THREE.RenderableFace3){if(l=N.v1,c=N.v2,f=N.v3,l.positionScreen.x*=a,l.positionScreen.y*=-h,c.positionScreen.x*=a,c.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,T.addPoint(l.positionScreen.x,l.positionScreen.y),T.addPoint(c.positionScreen.x,c.positionScreen.y),T.addPoint(f.positionScreen.x,f.positionScreen.y),y.instersects(T))for(s=0,m=N.meshMaterial.length;s<m;)if(B=N.meshMaterial[s++],B instanceof THREE.MeshFaceMaterial)for(L=0,C=N.faceMaterial.length;L<C;)(B=N.faceMaterial[L++])&&t(l,c,f,N,B,i);else B&&t(l,c,f,N,B,i)}else if(N instanceof THREE.RenderableFace4&&(l=N.v1,c=N.v2,f=N.v3,u=N.v4,l.positionScreen.x*=a,l.positionScreen.y*=-h,c.positionScreen.x*=a,c.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,u.positionScreen.x*=a,u.positionScreen.y*=-h,T.addPoint(l.positionScreen.x,l.positionScreen.y),T.addPoint(c.positionScreen.x,c.positionScreen.y),T.addPoint(f.positionScreen.x,f.positionScreen.y),T.addPoint(u.positionScreen.x,u.positionScreen.y),y.instersects(T)))for(s=0,m=N.meshMaterial.length;s<m;)if(B=N.meshMaterial[s++],B instanceof THREE.MeshFaceMaterial)for(L=0,C=N.faceMaterial.length;L<C;)(B=N.faceMaterial[L++])&&e(l,c,f,u,N,B,i);else B&&e(l,c,f,u,N,B,i)}},THREE.WebGLRenderer=function(i){function t(i,t){var e=h.createProgram();return h.attachShader(e,s("fragment","#ifdef GL_ES\nprecision highp float;\n#endif\n"+i)),h.attachShader(e,s("vertex","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n"+t)),h.linkProgram(e),h.getProgramParameter(e,h.LINK_STATUS)||alert("Could not initialise shaders\nVALIDATE_STATUS: "+h.getProgramParameter(e,h.VALIDATE_STATUS)+", gl error ["+h.getError()+"]"),e.uniforms={},e.attributes={},e}function e(i,t){if(6==i.image.length){if(!i.image.__webGLTextureCube&&!i.image.__cubeMapInitialized&&6==i.image.loadCount){i.image.__webGLTextureCube=h.createTexture(),h.bindTexture(h.TEXTURE_CUBE_MAP,i.image.__webGLTextureCube),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR);for(var e=0;e<6;++e)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,i.image[e]);h.generateMipmap(h.TEXTURE_CUBE_MAP),h.bindTexture(h.TEXTURE_CUBE_MAP,null),i.image.__cubeMapInitialized=!0}h.activeTexture(h.TEXTURE0+t),h.bindTexture(h.TEXTURE_CUBE_MAP,i.image.__webGLTextureCube)}}function n(i,t){!i.__webGLTexture&&i.image.loaded&&(i.__webGLTexture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,i.__webGLTexture),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,i.image),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a(i.wrap_s)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a(i.wrap_t)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,a(i.mag_filter)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a(i.min_filter)),h.generateMipmap(h.TEXTURE_2D),h.bindTexture(h.TEXTURE_2D,null)),h.activeTexture(h.TEXTURE0+t),h.bindTexture(h.TEXTURE_2D,i.__webGLTexture)}function r(i,t){var e,n,r;for(e=0,n=t.length;e<n;e++)r=t[e],i.uniforms[r]=h.getUniformLocation(i,r)}function o(i,t){var e,n,r;for(e=0,n=t.length;e<n;e++)r=t[e],i.attributes[r]=h.getAttribLocation(i,r),i.attributes[r]>=0&&h.enableVertexAttribArray(i.attributes[r])}function s(i,t){var e;return"fragment"==i?e=h.createShader(h.FRAGMENT_SHADER):"vertex"==i&&(e=h.createShader(h.VERTEX_SHADER)),h.shaderSource(e,t),h.compileShader(e),h.getShaderParameter(e,h.COMPILE_STATUS)?e:(alert(h.getShaderInfoLog(e)),null)}function a(i){switch(i){case THREE.RepeatWrapping:return h.REPEAT;case THREE.ClampToEdgeWrapping:return h.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return h.MIRRORED_REPEAT;case THREE.NearestFilter:return h.NEAREST;case THREE.NearestMipMapNearestFilter:return h.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return h.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return h.LINEAR;case THREE.LinearMipMapNearestFilter:return h.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return h.LINEAR_MIPMAP_LINEAR}return 0}var h,l,c,f,u=document.createElement("canvas"),m=new THREE.Matrix4,E=new Float32Array(16),p=new Float32Array(16),d=new Float32Array(16),g=new Float32Array(9),v=new Float32Array(16);i=function(i,t){if(i){var e,n,r,o=pointLights=maxDirLights=maxPointLights=0;for(e=0,n=i.lights.length;e<n;e++)r=i.lights[e],r instanceof THREE.DirectionalLight&&o++,r instanceof THREE.PointLight&&pointLights++;return pointLights+o<=t?(maxDirLights=o,maxPointLights=pointLights):(maxDirLights=Math.ceil(t*o/(pointLights+o)),maxPointLights=t-maxDirLights),{directional:maxDirLights,point:maxPointLights}}return{directional:1,point:t-1}}(i,4),this.domElement=u,this.autoClear=!0;try{h=u.getContext("experimental-webgl",{antialias:!0})}catch(i){}if(!h)throw alert("WebGL not supported"),"cannot create webgl context";h.clearColor(0,0,0,1),h.clearDepth(1),h.enable(h.DEPTH_TEST),h.depthFunc(h.LEQUAL),h.frontFace(h.CCW),h.cullFace(h.BACK),h.enable(h.CULL_FACE),h.enable(h.BLEND),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA),h.clearColor(0,0,0,0),l=c=function(i,e){var n=[i?"#define MAX_DIR_LIGHTS "+i:"",e?"#define MAX_POINT_LIGHTS "+e:"","uniform bool enableLighting;\nuniform bool useRefract;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;\nuniform vec3 ambientLightColor;",i?"uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];":"",i?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"",e?"uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];":"",e?"uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];":"","uniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",e?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vReflect;\nuniform float mRefractionRatio;\nvoid main(void) {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nif ( !enableLighting ) {\nvLightWeighting = vec3( 1.0, 1.0, 1.0 );\n} else {\nvLightWeighting = ambientLightColor;",i?"for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {":"",i?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",i?"float directionalLightWeighting = max( dot( transformedNormal, normalize(lDirection.xyz ) ), 0.0 );":"",i?"vLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;":"",i?"}":"",e?"for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {":"",e?"vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );":"",e?"vPointLightVector[ i ] = normalize( lPosition.xyz - mvPosition.xyz );":"",e?"float pointLightWeighting = max( dot( transformedNormal, vPointLightVector[ i ] ), 0.0 );":"",e?"vLightWeighting += pointLightColor[ i ] * pointLightWeighting;":"",e?"}":"","}\nvNormal = transformedNormal;\nvUv = uv;\nif ( useRefract ) {\nvReflect = refract( normalize(mPosition.xyz - cameraPosition), normalize(nWorld.xyz), mRefractionRatio );\n} else {\nvReflect = reflect( normalize(mPosition.xyz - cameraPosition), normalize(nWorld.xyz) );\n}\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),s=[i?"#define MAX_DIR_LIGHTS "+i:"",e?"#define MAX_POINT_LIGHTS "+e:"","uniform int material;\nuniform bool enableMap;\nuniform bool enableCubeMap;\nuniform bool mixEnvMap;\nuniform samplerCube tCube;\nuniform float mReflectivity;\nuniform sampler2D tMap;\nuniform vec4 mColor;\nuniform float mOpacity;\nuniform vec4 mAmbient;\nuniform vec4 mSpecular;\nuniform float mShininess;\nuniform float m2Near;\nuniform float mFarPlusNear;\nuniform float mFarMinusNear;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;",i?"uniform mat4 viewMatrix;":"",i?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"","varying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",e?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vReflect;\nuniform vec3 cameraPosition;\nvoid main() {\nvec4 mapColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nvec4 cubeColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nif ( enableMap ) {\nmapColor = texture2D( tMap, vUv );\n}\nif ( enableCubeMap ) {\ncubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n}\nif ( material == 5 ) { \nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( -wPos.x, wPos.yz ) );\n} else if ( material == 4 ) { \ngl_FragColor = vec4( 0.5*normalize( vNormal ) + vec3(0.5, 0.5, 0.5), mOpacity );\n} else if ( material == 3 ) { \nfloat w = 0.5;\ngl_FragColor = vec4( w, w, w, mOpacity );\n} else if ( material == 2 ) { \nvec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );",e?"vec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",e?"vec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",e?"for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {":"",e?"vec3 pointVector = normalize( vPointLightVector[ i ] );":"",e?"vec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );":"",e?"float pointDotNormalHalf = dot( normal, pointHalfVector );":"",e?"float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );":"",e?"float pointSpecularWeight = 0.0;":"",e?"if ( pointDotNormalHalf >= 0.0 )":"",e?"pointSpecularWeight = pow( pointDotNormalHalf, mShininess );":"",e?"pointDiffuse  += mColor * pointDiffuseWeight;":"",e?"pointSpecular += mSpecular * pointSpecularWeight;":"",e?"}":"",i?"vec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",i?"vec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",i?"for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {":"",i?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",i?"vec3 dirVector = normalize( lDirection.xyz );":"",i?"vec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );":"",i?"float dirDotNormalHalf = dot( normal, dirHalfVector );":"",i?"float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );":"",i?"float dirSpecularWeight = 0.0;":"",i?"if ( dirDotNormalHalf >= 0.0 )":"",i?"dirSpecularWeight = pow( dirDotNormalHalf, mShininess );":"",i?"dirDiffuse  += mColor * dirDiffuseWeight;":"",i?"dirSpecular += mSpecular * dirSpecularWeight;":"",i?"}":"","vec4 totalLight = mAmbient;",i?"totalLight += dirDiffuse + dirSpecular;":"",e?"totalLight += pointDiffuse + pointSpecular;":"","if ( mixEnvMap ) {\ngl_FragColor = vec4( mix( mapColor.rgb * totalLight.xyz * vLightWeighting, cubeColor.rgb, mReflectivity ), mapColor.a );\n} else {\ngl_FragColor = vec4( mapColor.rgb * cubeColor.rgb * totalLight.xyz * vLightWeighting, mapColor.a );\n}\n} else if ( material == 1 ) {\nif ( mixEnvMap ) {\ngl_FragColor = vec4( mix( mColor.rgb * mapColor.rgb * vLightWeighting, cubeColor.rgb, mReflectivity ), mColor.a * mapColor.a );\n} else {\ngl_FragColor = vec4( mColor.rgb * mapColor.rgb * cubeColor.rgb * vLightWeighting, mColor.a * mapColor.a );\n}\n} else {\nif ( mixEnvMap ) {\ngl_FragColor = mix( mColor * mapColor, cubeColor, mReflectivity );\n} else {\ngl_FragColor = mColor * mapColor * cubeColor;\n}\n}\n}"].join("\n");
return n=t(s,n),h.useProgram(n),r(n,["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","enableLighting","ambientLightColor","material","mColor","mAmbient","mSpecular","mShininess","mOpacity","enableMap","tMap","enableCubeMap","tCube","mixEnvMap","mReflectivity","mRefractionRatio","useRefract","m2Near","mFarPlusNear","mFarMinusNear"]),i&&r(n,["directionalLightNumber","directionalLightColor","directionalLightDirection"]),e&&r(n,["pointLightNumber","pointLightColor","pointLightPosition"]),h.uniform1i(n.uniforms.enableMap,0),h.uniform1i(n.uniforms.tMap,0),h.uniform1i(n.uniforms.enableCubeMap,0),h.uniform1i(n.uniforms.tCube,1),h.uniform1i(n.uniforms.mixEnvMap,0),h.uniform1i(n.uniforms.useRefract,0),o(n,["position","normal","uv"]),n}(i.directional,i.point),this.setSize=function(i,t){u.width=i,u.height=t,h.viewport(0,0,u.width,u.height)},this.clear=function(){h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)},this.setupLights=function(i,t){var e,n,r,o,s,a=[],l=[],c=[];for(o=[],s=[],h.uniform1i(i.uniforms.enableLighting,t.length),e=0,n=t.length;e<n;e++)r=t[e],r instanceof THREE.AmbientLight?a.push(r):r instanceof THREE.DirectionalLight?c.push(r):r instanceof THREE.PointLight&&l.push(r);for(e=r=o=s=0,n=a.length;e<n;e++)r+=a[e].color.r,o+=a[e].color.g,s+=a[e].color.b;for(h.uniform3f(i.uniforms.ambientLightColor,r,o,s),o=[],s=[],e=0,n=c.length;e<n;e++)r=c[e],o.push(r.color.r*r.intensity),o.push(r.color.g*r.intensity),o.push(r.color.b*r.intensity),s.push(r.position.x),s.push(r.position.y),s.push(r.position.z);for(c.length&&(h.uniform1i(i.uniforms.directionalLightNumber,c.length),h.uniform3fv(i.uniforms.directionalLightDirection,s),h.uniform3fv(i.uniforms.directionalLightColor,o)),o=[],s=[],e=0,n=l.length;e<n;e++)r=l[e],o.push(r.color.r*r.intensity),o.push(r.color.g*r.intensity),o.push(r.color.b*r.intensity),s.push(r.position.x),s.push(r.position.y),s.push(r.position.z);l.length&&(h.uniform1i(i.uniforms.pointLightNumber,l.length),h.uniform3fv(i.uniforms.pointLightPosition,s),h.uniform3fv(i.uniforms.pointLightColor,o))},this.createBuffers=function(i,t){var e,n,r,o,s,a,l,c,f,u=[],m=[],E=[],p=[],d=[],g=0,v=i.geometry.geometryChunks[t];for(r=!1,e=0,n=i.material.length;e<n;e++){if(meshMaterial=i.material[e],meshMaterial instanceof THREE.MeshFaceMaterial){for(s=0,f=v.material.length;s<f;s++)if(v.material[s]&&void 0!=v.material[s].shading&&v.material[s].shading==THREE.SmoothShading){r=!0;break}}else if(meshMaterial&&void 0!=meshMaterial.shading&&meshMaterial.shading==THREE.SmoothShading){r=!0;break}if(r)break}for(f=r,e=0,n=v.faces.length;e<n;e++)if(r=v.faces[e],o=i.geometry.faces[r],s=o.vertexNormals,faceNormal=o.normal,r=i.geometry.uvs[r],o instanceof THREE.Face3){if(a=i.geometry.vertices[o.a].position,l=i.geometry.vertices[o.b].position,c=i.geometry.vertices[o.c].position,E.push(a.x,a.y,a.z),E.push(l.x,l.y,l.z),E.push(c.x,c.y,c.z),3==s.length&&f)for(o=0;o<3;o++)p.push(s[o].x,s[o].y,s[o].z);else for(o=0;o<3;o++)p.push(faceNormal.x,faceNormal.y,faceNormal.z);if(r)for(o=0;o<3;o++)d.push(r[o].u,r[o].v);u.push(g,g+1,g+2),m.push(g,g+1),m.push(g,g+2),m.push(g+1,g+2),g+=3}else if(o instanceof THREE.Face4){if(a=i.geometry.vertices[o.a].position,l=i.geometry.vertices[o.b].position,c=i.geometry.vertices[o.c].position,o=i.geometry.vertices[o.d].position,E.push(a.x,a.y,a.z),E.push(l.x,l.y,l.z),E.push(c.x,c.y,c.z),E.push(o.x,o.y,o.z),4==s.length&&f)for(o=0;o<4;o++)p.push(s[o].x,s[o].y,s[o].z);else for(o=0;o<4;o++)p.push(faceNormal.x,faceNormal.y,faceNormal.z);if(r)for(o=0;o<4;o++)d.push(r[o].u,r[o].v);u.push(g,g+1,g+2),u.push(g,g+2,g+3),m.push(g,g+1),m.push(g,g+2),m.push(g,g+3),m.push(g+1,g+2),m.push(g+2,g+3),g+=4}E.length&&(v.__webGLVertexBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,v.__webGLVertexBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(E),h.STATIC_DRAW),v.__webGLNormalBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,v.__webGLNormalBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(p),h.STATIC_DRAW),d.length>0&&(v.__webGLUVBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,v.__webGLUVBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(d),h.STATIC_DRAW)),v.__webGLFaceBuffer=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,v.__webGLFaceBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),h.STATIC_DRAW),v.__webGLLineBuffer=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,v.__webGLLineBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),h.STATIC_DRAW),v.__webGLFaceCount=u.length,v.__webGLLineCount=m.length)},this.renderBuffer=function(i,s,a,f){var u,m,E,p,d,g,v,b,R;if(a instanceof THREE.MeshShaderMaterial){if(!a.program){a.program=t(a.fragment_shader,a.vertex_shader),v=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition"];for(R in a.uniforms)v.push(R);r(a.program,v),o(a.program,["position","normal","uv"])}R=a.program}else R=c;if(R!=l&&(h.useProgram(R),l=R),R==c&&this.setupLights(R,s),this.loadCamera(R,i),this.loadMatrices(R),a instanceof THREE.MeshShaderMaterial){E=a.wireframe,p=a.wireframe_linewidth,i=R,s=a.uniforms;var y;for(u in s)b=s[u].type,v=s[u].value,y=i.uniforms[u],"i"==b?h.uniform1i(y,v):"f"==b?h.uniform1f(y,v):"t"==b&&(h.uniform1i(y,v),(b=s[u].texture)&&(b.image instanceof Array&&6==b.image.length?e(b,v):n(b,v)))}(a instanceof THREE.MeshPhongMaterial||a instanceof THREE.MeshLambertMaterial||a instanceof THREE.MeshBasicMaterial)&&(u=a.color,m=a.opacity,E=a.wireframe,p=a.wireframe_linewidth,d=a.map,g=a.env_map,s=a.combine==THREE.MixOperation,i=a.reflectivity,b=a.env_map&&a.env_map.mapping instanceof THREE.CubeRefractionMapping,v=a.refraction_ratio,h.uniform4f(R.uniforms.mColor,u.r*m,u.g*m,u.b*m,m),h.uniform1i(R.uniforms.mixEnvMap,s),h.uniform1f(R.uniforms.mReflectivity,i),h.uniform1i(R.uniforms.useRefract,b),h.uniform1f(R.uniforms.mRefractionRatio,v)),a instanceof THREE.MeshNormalMaterial?(m=a.opacity,h.uniform1f(R.uniforms.mOpacity,m),h.uniform1i(R.uniforms.material,4)):a instanceof THREE.MeshDepthMaterial?(m=a.opacity,E=a.wireframe,p=a.wireframe_linewidth,h.uniform1f(R.uniforms.mOpacity,m),h.uniform1f(R.uniforms.m2Near,a.__2near),h.uniform1f(R.uniforms.mFarPlusNear,a.__farPlusNear),h.uniform1f(R.uniforms.mFarMinusNear,a.__farMinusNear),h.uniform1i(R.uniforms.material,3)):a instanceof THREE.MeshPhongMaterial?(u=a.ambient,i=a.specular,a=a.shininess,h.uniform4f(R.uniforms.mAmbient,u.r,u.g,u.b,m),h.uniform4f(R.uniforms.mSpecular,i.r,i.g,i.b,m),h.uniform1f(R.uniforms.mShininess,a),h.uniform1i(R.uniforms.material,2)):a instanceof THREE.MeshLambertMaterial?h.uniform1i(R.uniforms.material,1):a instanceof THREE.MeshBasicMaterial?h.uniform1i(R.uniforms.material,0):a instanceof THREE.MeshCubeMaterial&&(h.uniform1i(R.uniforms.material,5),g=a.env_map),d?(n(d,0),h.uniform1i(R.uniforms.tMap,0),h.uniform1i(R.uniforms.enableMap,1)):h.uniform1i(R.uniforms.enableMap,0),g?(e(g,1),h.uniform1i(R.uniforms.tCube,1),h.uniform1i(R.uniforms.enableCubeMap,1)):h.uniform1i(R.uniforms.enableCubeMap,0),m=R.attributes,h.bindBuffer(h.ARRAY_BUFFER,f.__webGLVertexBuffer),h.vertexAttribPointer(m.position,3,h.FLOAT,!1,0,0),h.bindBuffer(h.ARRAY_BUFFER,f.__webGLNormalBuffer),h.vertexAttribPointer(m.normal,3,h.FLOAT,!1,0,0),m.uv>=0&&(f.__webGLUVBuffer?(h.bindBuffer(h.ARRAY_BUFFER,f.__webGLUVBuffer),h.enableVertexAttribArray(m.uv),h.vertexAttribPointer(m.uv,2,h.FLOAT,!1,0,0)):h.disableVertexAttribArray(m.uv)),E?(h.lineWidth(p),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,f.__webGLLineBuffer),h.drawElements(h.LINES,f.__webGLLineCount,h.UNSIGNED_SHORT,0)):(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,f.__webGLFaceBuffer),h.drawElements(h.TRIANGLES,f.__webGLFaceCount,h.UNSIGNED_SHORT,0))},this.renderPass=function(i,t,e,n,r,o){var s,a,h,l,c;for(h=0,l=e.material.length;h<l;h++)if(s=e.material[h],s instanceof THREE.MeshFaceMaterial)for(s=0,a=n.material.length;s<a;s++)(c=n.material[s])&&c.blending==r&&c.opacity<1==o&&(this.setBlending(c.blending),this.renderBuffer(i,t,c,n));else(c=s)&&c.blending==r&&c.opacity<1==o&&(this.setBlending(c.blending),this.renderBuffer(i,t,c,n))},this.render=function(i,t){var e,n,r,o,s=i.lights;for(this.initWebGLObjects(i),this.autoClear&&this.clear(),t.autoUpdateMatrix&&t.updateMatrix(),e=0,n=i.__webGLObjects.length;e<n;e++)r=i.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,t),this.renderPass(t,s,o,r,THREE.NormalBlending,!1));for(e=0,n=i.__webGLObjects.length;e<n;e++)r=i.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,t),this.renderPass(t,s,o,r,THREE.AdditiveBlending,!1),this.renderPass(t,s,o,r,THREE.SubtractiveBlending,!1),this.renderPass(t,s,o,r,THREE.AdditiveBlending,!0),this.renderPass(t,s,o,r,THREE.SubtractiveBlending,!0),this.renderPass(t,s,o,r,THREE.NormalBlending,!0))},this.initWebGLObjects=function(i){var t,e,n,r,o,s;for(i.__webGLObjects||(i.__webGLObjects=[],i.__webGLObjectsMap={}),t=0,e=i.objects.length;t<e;t++)if(n=i.objects[t],void 0==i.__webGLObjectsMap[n.id]&&(i.__webGLObjectsMap[n.id]={}),s=i.__webGLObjectsMap[n.id],n instanceof THREE.Mesh)for(o in n.geometry.geometryChunks)r=n.geometry.geometryChunks[o],r.__webGLVertexBuffer||this.createBuffers(n,o),void 0==s[o]&&(r={buffer:r,object:n},i.__webGLObjects.push(r),s[o]=1)},this.removeObject=function(i,t){var e,n;for(e=i.__webGLObjects.length-1;e>=0;e--)n=i.__webGLObjects[e].object,t==n&&i.__webGLObjects.splice(e,1)},this.setupMatrices=function(i,t){i.autoUpdateMatrix&&i.updateMatrix(),m.multiply(t.matrix,i.matrix),E.set(t.matrix.flatten()),p.set(m.flatten()),d.set(t.projectionMatrix.flatten()),f=THREE.Matrix4.makeInvert3x3(m).transpose(),g.set(f.m),v.set(i.matrix.flatten())},this.loadMatrices=function(i){h.uniformMatrix4fv(i.uniforms.viewMatrix,!1,E),h.uniformMatrix4fv(i.uniforms.modelViewMatrix,!1,p),h.uniformMatrix4fv(i.uniforms.projectionMatrix,!1,d),h.uniformMatrix3fv(i.uniforms.normalMatrix,!1,g),h.uniformMatrix4fv(i.uniforms.objectMatrix,!1,v)},this.loadCamera=function(i,t){h.uniform3f(i.uniforms.cameraPosition,t.position.x,t.position.y,t.position.z)},this.setBlending=function(i){switch(i){case THREE.AdditiveBlending:h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ONE,h.ONE);break;case THREE.SubtractiveBlending:h.blendFunc(h.DST_COLOR,h.ZERO);break;default:h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA)}},this.setFaceCulling=function(i,t){i?(t&&"ccw"!=t?h.frontFace(h.CW):h.frontFace(h.CCW),"back"==i?h.cullFace(h.BACK):"front"==i?h.cullFace(h.FRONT):h.cullFace(h.FRONT_AND_BACK),h.enable(h.CULL_FACE)):h.disable(h.CULL_FACE)}},THREE.RenderableFace3=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.v3=new THREE.Vertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[],this.faceMaterial=this.meshMaterial=null,this.overdraw=!1,this.uvs=[null,null,null]},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.material=null};