var THREE=THREE||{};THREE.Color=function(t){this.autoUpdate=!0,this.setHex(t)},THREE.Color.prototype={setRGB:function(t,i,e){this.r=t,this.g=i,this.b=e,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(t){this.hex=16777215&~~t,this.autoUpdate&&(this.updateRGBA(),this.updateStyleString())},updateHex:function(){this.hex=~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},updateRGBA:function(){this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgb("+~~(255*this.r)+","+~~(255*this.g)+","+~~(255*this.b)+")"},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}},THREE.Vector2=function(t,i){this.x=t||0,this.y=i||0},THREE.Vector2.prototype={set:function(t,i){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},THREE.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},THREE.Vector3.prototype={set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},cross:function(t,i){return this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x,this},crossSelf:function(t){var i=this.x,e=this.y,n=this.z;return this.x=e*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-e*t.x,this},multiply:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},distanceTo:function(t){var i=this.x-t.x,e=this.y-t.y;return t=this.z-t.z,Math.sqrt(i*i+e*e+t*t)},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return t=this.z-t.z,i*i+e*e+t*t},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0?this.multiplyScalar(1/t):this.set(0,0,0),this},setLength:function(t){return this.normalize().multiplyScalar(t)},isZero:function(){return Math.abs(this.x)<1e-4&&Math.abs(this.y)<1e-4&&Math.abs(this.z)<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},THREE.Vector4=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=n||1},THREE.Vector4.prototype={set:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w||1,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},lerpSelf:function(t,i){this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},THREE.Ray=function(t,i){this.origin=t||new THREE.Vector3,this.direction=i||new THREE.Vector3},THREE.Ray.prototype={intersectScene:function(t){var i,e,n=t.objects,r=[];for(t=0,i=n.length;t<i;t++)e=n[t],e instanceof THREE.Mesh&&(r=r.concat(this.intersectObject(e)));return r.sort(function(t,i){return t.distance-i.distance}),r},intersectObject:function(t){function i(t,i,e,n){n=n.clone().subSelf(i),e=e.clone().subSelf(i);var r=t.clone().subSelf(i);t=n.dot(n),i=n.dot(e),n=n.dot(r);var o=e.dot(e);return e=e.dot(r),r=1/(t*o-i*i),o=(o*n-i*e)*r,t=(t*e-i*n)*r,o>0&&t>0&&o+t<1}var e,n,r,o,a,s,h,l,c,u,f,E=t.geometry,m=E.vertices,p=[];for(e=0,n=E.faces.length;e<n;e++)r=E.faces[e],u=this.origin.clone(),f=this.direction.clone(),o=t.matrix.multiplyVector3(m[r.a].position.clone()),a=t.matrix.multiplyVector3(m[r.b].position.clone()),s=t.matrix.multiplyVector3(m[r.c].position.clone()),h=r instanceof THREE.Face4?t.matrix.multiplyVector3(m[r.d].position.clone()):null,l=t.rotationMatrix.multiplyVector3(r.normal.clone()),c=f.dot(l),c<0&&(l=l.dot((new THREE.Vector3).sub(o,u))/c,u=u.addSelf(f.multiplyScalar(l)),r instanceof THREE.Face3?i(u,o,a,s)&&(r={distance:this.origin.distanceTo(u),point:u,face:r,object:t},p.push(r)):r instanceof THREE.Face4&&(i(u,o,a,h)||i(u,a,s,h))&&(r={distance:this.origin.distanceTo(u),point:u,face:r,object:t},p.push(r)));return p}},THREE.Rectangle=function(){function t(){o=n-i,a=r-e}var i,e,n,r,o,a,s=!0;this.getX=function(){return i},this.getY=function(){return e},this.getWidth=function(){return o},this.getHeight=function(){return a},this.getLeft=function(){return i},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(o,a,h,l){s=!1,i=o,e=a,n=h,r=l,t()},this.addPoint=function(o,a){s?(s=!1,i=o,e=a,n=o,r=a):(i=Math.min(i,o),e=Math.min(e,a),n=Math.max(n,o),r=Math.max(r,a)),t()},this.addRectangle=function(o){s?(s=!1,i=o.getLeft(),e=o.getTop(),n=o.getRight(),r=o.getBottom()):(i=Math.min(i,o.getLeft()),e=Math.min(e,o.getTop()),n=Math.max(n,o.getRight()),r=Math.max(r,o.getBottom())),t()},this.inflate=function(o){i-=o,e-=o,n+=o,r+=o,t()},this.minSelf=function(o){i=Math.max(i,o.getLeft()),e=Math.max(e,o.getTop()),n=Math.min(n,o.getRight()),r=Math.min(r,o.getBottom()),t()},this.instersects=function(t){return Math.min(n,t.getRight())-Math.max(i,t.getLeft())>=0&&Math.min(r,t.getBottom())-Math.max(e,t.getTop())>=0},this.empty=function(){s=!0,r=n=e=i=0,t()},this.isEmpty=function(){return s},this.toString=function(){return"THREE.Rectangle ( left: "+i+", right: "+n+", top: "+e+", bottom: "+r+", width: "+o+", height: "+a+" )"}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={transpose:function(){var t;return t=this.m[1],this.m[1]=this.m[3],this.m[3]=t,t=this.m[2],this.m[2]=this.m[6],this.m[6]=t,t=this.m[5],this.m[5]=this.m[7],this.m[7]=t,this}},THREE.Matrix4=function(){},THREE.Matrix4.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1,this.n21=this.n14=this.n13=this.n12=0,this.n22=1,this.n32=this.n31=this.n24=this.n23=0,this.n33=1,this.n43=this.n42=this.n41=this.n34=0,this.n44=1},copy:function(t){this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this.n41=t.n41,this.n42=t.n42,this.n43=t.n43,this.n44=t.n44},lookAt:function(t,i,e){var n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3;o.sub(t,i).normalize(),n.cross(e,o).normalize(),r.cross(o,n).normalize(),this.n11=n.x,this.n12=n.y,this.n13=n.z,this.n14=-n.dot(t),this.n21=r.x,this.n22=r.y,this.n23=r.z,this.n24=-r.dot(t),this.n31=o.x,this.n32=o.y,this.n33=o.z,this.n34=-o.dot(t),this.n43=this.n42=this.n41=0,this.n44=1},multiplyVector3:function(t){var i=t.x,e=t.y,n=t.z,r=1/(this.n41*i+this.n42*e+this.n43*n+this.n44);return t.x=(this.n11*i+this.n12*e+this.n13*n+this.n14)*r,t.y=(this.n21*i+this.n22*e+this.n23*n+this.n24)*r,t.z=(this.n31*i+this.n32*e+this.n33*n+this.n34)*r,t},multiplyVector4:function(t){var i=t.x,e=t.y,n=t.z,r=t.w;return t.x=this.n11*i+this.n12*e+this.n13*n+this.n14*r,t.y=this.n21*i+this.n22*e+this.n23*n+this.n24*r,t.z=this.n31*i+this.n32*e+this.n33*n+this.n34*r,t.w=this.n41*i+this.n42*e+this.n43*n+this.n44*r,t},crossVector:function(t){var i=new THREE.Vector4;return i.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,i.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,i.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,i.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,i},multiply:function(t,i){var e=t.n11,n=t.n12,r=t.n13,o=t.n14,a=t.n21,s=t.n22,h=t.n23,l=t.n24,c=t.n31,u=t.n32,f=t.n33,E=t.n34,m=t.n41,p=t.n42,d=t.n43,v=t.n44,g=i.n11,y=i.n12,R=i.n13,b=i.n14,x=i.n21,T=i.n22,_=i.n23,w=i.n24,H=i.n31,M=i.n32,S=i.n33,L=i.n34,C=i.n41,z=i.n42,P=i.n43,A=i.n44;this.n11=e*g+n*x+r*H+o*C,this.n12=e*y+n*T+r*M+o*z,this.n13=e*R+n*_+r*S+o*P,this.n14=e*b+n*w+r*L+o*A,this.n21=a*g+s*x+h*H+l*C,this.n22=a*y+s*T+h*M+l*z,this.n23=a*R+s*_+h*S+l*P,this.n24=a*b+s*w+h*L+l*A,this.n31=c*g+u*x+f*H+E*C,this.n32=c*y+u*T+f*M+E*z,this.n33=c*R+u*_+f*S+E*P,this.n34=c*b+u*w+f*L+E*A,this.n41=m*g+p*x+d*H+v*C,this.n42=m*y+p*T+d*M+v*z,this.n43=m*R+p*_+d*S+v*P,this.n44=m*b+p*w+d*L+v*A},multiplySelf:function(t){var i=this.n11,e=this.n12,n=this.n13,r=this.n14,o=this.n21,a=this.n22,s=this.n23,h=this.n24,l=this.n31,c=this.n32,u=this.n33,f=this.n34,E=this.n41,m=this.n42,p=this.n43,d=this.n44;this.n11=i*t.n11+e*t.n21+n*t.n31+r*t.n41,this.n12=i*t.n12+e*t.n22+n*t.n32+r*t.n42,this.n13=i*t.n13+e*t.n23+n*t.n33+r*t.n43,this.n14=i*t.n14+e*t.n24+n*t.n34+r*t.n44,this.n21=o*t.n11+a*t.n21+s*t.n31+h*t.n41,this.n22=o*t.n12+a*t.n22+s*t.n32+h*t.n42,this.n23=o*t.n13+a*t.n23+s*t.n33+h*t.n43,this.n24=o*t.n14+a*t.n24+s*t.n34+h*t.n44,this.n31=l*t.n11+c*t.n21+u*t.n31+f*t.n41,this.n32=l*t.n12+c*t.n22+u*t.n32+f*t.n42,this.n33=l*t.n13+c*t.n23+u*t.n33+f*t.n43,this.n34=l*t.n14+c*t.n24+u*t.n34+f*t.n44,this.n41=E*t.n11+m*t.n21+p*t.n31+d*t.n41,this.n42=E*t.n12+m*t.n22+p*t.n32+d*t.n42,this.n43=E*t.n13+m*t.n23+p*t.n33+d*t.n43,this.n44=E*t.n14+m*t.n24+p*t.n34+d*t.n44},multiplyScalar:function(t){this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function t(t,i,e){var n=t[i];t[i]=t[e],t[e]=n}return t(this,"n21","n12"),t(this,"n31","n13"),t(this,"n32","n23"),t(this,"n41","n14"),t(this,"n42","n24"),t(this,"n43","n34"),this},clone:function(){var t=new THREE.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},THREE.Matrix4.translationMatrix=function(t,i,e){var n=new THREE.Matrix4;return n.n14=t,n.n24=i,n.n34=e,n},THREE.Matrix4.scaleMatrix=function(t,i,e){var n=new THREE.Matrix4;return n.n11=t,n.n22=i,n.n33=e,n},THREE.Matrix4.rotationXMatrix=function(t){var i=new THREE.Matrix4;return i.n22=i.n33=Math.cos(t),i.n32=Math.sin(t),i.n23=-i.n32,i},THREE.Matrix4.rotationYMatrix=function(t){var i=new THREE.Matrix4;return i.n11=i.n33=Math.cos(t),i.n13=Math.sin(t),i.n31=-i.n13,i},THREE.Matrix4.rotationZMatrix=function(t){var i=new THREE.Matrix4;return i.n11=i.n22=Math.cos(t),i.n21=Math.sin(t),i.n12=-i.n21,i},THREE.Matrix4.rotationAxisAngleMatrix=function(t,i){var e=new THREE.Matrix4,n=Math.cos(i),r=Math.sin(i),o=1-n,a=t.x,s=t.y,h=t.z;return e.n11=o*a*a+n,e.n12=o*a*s-r*h,e.n13=o*a*h+r*s,e.n21=o*a*s+r*h,e.n22=o*s*s+n,e.n23=o*s*h-r*a,e.n31=o*a*h-r*s,e.n32=o*s*h+r*a,e.n33=o*h*h+n,e},THREE.Matrix4.makeInvert=function(t){var i=new THREE.Matrix4;return i.n11=t.n23*t.n34*t.n42-t.n24*t.n33*t.n42+t.n24*t.n32*t.n43-t.n22*t.n34*t.n43-t.n23*t.n32*t.n44+t.n22*t.n33*t.n44,i.n12=t.n14*t.n33*t.n42-t.n13*t.n34*t.n42-t.n14*t.n32*t.n43+t.n12*t.n34*t.n43+t.n13*t.n32*t.n44-t.n12*t.n33*t.n44,i.n13=t.n13*t.n24*t.n42-t.n14*t.n23*t.n42+t.n14*t.n22*t.n43-t.n12*t.n24*t.n43-t.n13*t.n22*t.n44+t.n12*t.n23*t.n44,i.n14=t.n14*t.n23*t.n32-t.n13*t.n24*t.n32-t.n14*t.n22*t.n33+t.n12*t.n24*t.n33+t.n13*t.n22*t.n34-t.n12*t.n23*t.n34,i.n21=t.n24*t.n33*t.n41-t.n23*t.n34*t.n41-t.n24*t.n31*t.n43+t.n21*t.n34*t.n43+t.n23*t.n31*t.n44-t.n21*t.n33*t.n44,i.n22=t.n13*t.n34*t.n41-t.n14*t.n33*t.n41+t.n14*t.n31*t.n43-t.n11*t.n34*t.n43-t.n13*t.n31*t.n44+t.n11*t.n33*t.n44,i.n23=t.n14*t.n23*t.n41-t.n13*t.n24*t.n41-t.n14*t.n21*t.n43+t.n11*t.n24*t.n43+t.n13*t.n21*t.n44-t.n11*t.n23*t.n44,i.n24=t.n13*t.n24*t.n31-t.n14*t.n23*t.n31+t.n14*t.n21*t.n33-t.n11*t.n24*t.n33-t.n13*t.n21*t.n34+t.n11*t.n23*t.n34,i.n31=t.n22*t.n34*t.n41-t.n24*t.n32*t.n41+t.n24*t.n31*t.n42-t.n21*t.n34*t.n42-t.n22*t.n31*t.n44+t.n21*t.n32*t.n44,i.n32=t.n14*t.n32*t.n41-t.n12*t.n34*t.n41-t.n14*t.n31*t.n42+t.n11*t.n34*t.n42+t.n12*t.n31*t.n44-t.n11*t.n32*t.n44,i.n33=t.n13*t.n24*t.n41-t.n14*t.n22*t.n41+t.n14*t.n21*t.n42-t.n11*t.n24*t.n42-t.n12*t.n21*t.n44+t.n11*t.n22*t.n44,i.n34=t.n14*t.n22*t.n31-t.n12*t.n24*t.n31-t.n14*t.n21*t.n32+t.n11*t.n24*t.n32+t.n12*t.n21*t.n34-t.n11*t.n22*t.n34,i.n41=t.n23*t.n32*t.n41-t.n22*t.n33*t.n41-t.n23*t.n31*t.n42+t.n21*t.n33*t.n42+t.n22*t.n31*t.n43-t.n21*t.n32*t.n43,i.n42=t.n12*t.n33*t.n41-t.n13*t.n32*t.n41+t.n13*t.n31*t.n42-t.n11*t.n33*t.n42-t.n12*t.n31*t.n43+t.n11*t.n32*t.n43,i.n43=t.n13*t.n22*t.n41-t.n12*t.n23*t.n41-t.n13*t.n21*t.n42+t.n11*t.n23*t.n42+t.n12*t.n21*t.n43-t.n11*t.n22*t.n43,i.n44=t.n12*t.n23*t.n31-t.n13*t.n22*t.n31+t.n13*t.n21*t.n32-t.n11*t.n23*t.n32-t.n12*t.n21*t.n33+t.n11*t.n22*t.n33,i.multiplyScalar(1/t.determinant()),i},THREE.Matrix4.makeInvert3x3=function(t){var i=t.flatten();t=new THREE.Matrix3;var e=i[10]*i[5]-i[6]*i[9],n=-i[10]*i[1]+i[2]*i[9],r=i[6]*i[1]-i[2]*i[5],o=-i[10]*i[4]+i[6]*i[8],a=i[10]*i[0]-i[2]*i[8],s=-i[6]*i[0]+i[2]*i[4],h=i[9]*i[4]-i[5]*i[8],l=-i[9]*i[0]+i[1]*i[8],c=i[5]*i[0]-i[1]*i[4];if(i=i[0]*e+i[1]*o+i[2]*h,0==i)throw"matrix not invertible";return i=1/i,t.m[0]=i*e,t.m[1]=i*n,t.m[2]=i*r,t.m[3]=i*o,t.m[4]=i*a,t.m[5]=i*s,t.m[6]=i*h,t.m[7]=i*l,t.m[8]=i*c,t},THREE.Matrix4.makeFrustum=function(t,i,e,n,r,o){var a,s,h;return a=new THREE.Matrix4,s=2*r/(i-t),h=2*r/(n-e),t=(i+t)/(i-t),e=(n+e)/(n-e),n=-(o+r)/(o-r),r=-2*o*r/(o-r),a.n11=s,a.n12=0,a.n13=t,a.n14=0,a.n21=0,a.n22=h,a.n23=e,a.n24=0,a.n31=0,a.n32=0,a.n33=n,a.n34=r,a.n41=0,a.n42=0,a.n43=-1,a.n44=0,a},THREE.Matrix4.makePerspective=function(t,i,e,n){var r;return t=e*Math.tan(t*Math.PI/360),r=-t,THREE.Matrix4.makeFrustum(r*i,t*i,r,t,e,n)},THREE.Matrix4.makeOrtho=function(t,i,e,n,r,o){var a,s,h,l;return a=new THREE.Matrix4,s=i-t,h=e-n,l=o-r,t=(i+t)/s,e=(e+n)/h,r=(o+r)/l,a.n11=2/s,a.n12=0,a.n13=0,a.n14=-t,a.n21=0,a.n22=2/h,a.n23=0,a.n24=-e,a.n31=0,a.n32=0,a.n33=-2/l,a.n34=-r,a.n41=0,a.n42=0,a.n43=0,a.n44=1,a},THREE.Vertex=function(t,i){this.position=t||new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.normal=i||new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.normalScreen=new THREE.Vector3,this.__visible=!0},THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},THREE.Face3=function(t,i,e,n,r){this.a=t,this.b=i,this.c=e,this.centroid=new THREE.Vector3,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.material=r instanceof Array?r:[r]},THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},THREE.Face4=function(t,i,e,n,r,o){this.a=t,this.b=i,this.c=e,this.d=n,this.centroid=new THREE.Vector3,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.material=o instanceof Array?o:[o]},THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},THREE.UV=function(t,i){this.u=t||0,this.v=i||0},THREE.UV.prototype={copy:function(t){this.u=t.u,this.v=t.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},THREE.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[],this.geometryChunks={}},THREE.Geometry.prototype={computeCentroids:function(){var t,i,e;for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],e.centroid.set(0,0,0),e instanceof THREE.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof THREE.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeNormals:function(t){var i,e,n,r,o,a,s=new THREE.Vector3,h=new THREE.Vector3;for(n=0,r=this.vertices.length;n<r;n++)o=this.vertices[n],o.normal.set(0,0,0);for(n=0,r=this.faces.length;n<r;n++){if(o=this.faces[n],t&&o.vertexNormals.length){for(s.set(0,0,0),i=0,e=o.normal.length;i<e;i++)s.addSelf(o.vertexNormals[i]);s.divideScalar(3)}else i=this.vertices[o.a],e=this.vertices[o.b],a=this.vertices[o.c],s.sub(a.position,e.position),h.sub(i.position,e.position),s.crossSelf(h);s.isZero()||s.normalize(),o.normal.copy(s)}},computeVertexNormals:function(){var t,i,e,n=[];for(t=0,vl=this.vertices.length;t<vl;t++)n[t]=new THREE.Vector3;for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],e instanceof THREE.Face3?(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal)):e instanceof THREE.Face4&&(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal),n[e.d].addSelf(e.normal));for(t=0,vl=this.vertices.length;t<vl;t++)n[t].normalize();for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],e instanceof THREE.Face3?(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone()):e instanceof THREE.Face4&&(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone(),e.vertexNormals[3]=n[e.d].clone())},computeBoundingBox:function(){if(this.vertices.length>0){this.bbox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,i=this.vertices.length;t<i;t++)vertex=this.vertices[t],vertex.position.x<this.bbox.x[0]?this.bbox.x[0]=vertex.position.x:vertex.position.x>this.bbox.x[1]&&(this.bbox.x[1]=vertex.position.x),vertex.position.y<this.bbox.y[0]?this.bbox.y[0]=vertex.position.y:vertex.position.y>this.bbox.y[1]&&(this.bbox.y[1]=vertex.position.y),vertex.position.z<this.bbox.z[0]?this.bbox.z[0]=vertex.position.z:vertex.position.z>this.bbox.z[1]&&(this.bbox.z[1]=vertex.position.z)}},sortFacesByMaterial:function(){function t(t){var n=[];for(i=0,e=t.length;i<e;i++)void 0==t[i]?n.push("undefined"):n.push(t[i].toString());return n.join("_")}var i,e,n,r,o,a,s,h,l={};for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],a=o.material,s=t(a),void 0==l[s]&&(l[s]={hash:s,counter:0}),h=l[s].hash+"_"+l[s].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],material:a,vertices:0}),o=o instanceof THREE.Face3?3:4,this.geometryChunks[h].vertices+o>65535&&(l[s].counter+=1,h=l[s].hash+"_"+l[s].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],material:a,vertices:0})),this.geometryChunks[h].faces.push(n),this.geometryChunks[h].vertices+=o},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+", uvs: "+this.uvs+" )"}},THREE.Camera=function(t,i,e,n){this.position=new THREE.Vector3(0,0,0),this.target={position:new THREE.Vector3(0,0,0)},this.up=new THREE.Vector3(0,1,0),this.matrix=new THREE.Matrix4,this.projectionMatrix=THREE.Matrix4.makePerspective(t,i,e,n),this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},THREE.Light=function(t){this.color=new THREE.Color(t)},THREE.AmbientLight=function(t){THREE.Light.call(this,t)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(t,i){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,1,0),this.intensity=i||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(t,i){THREE.Light.call(this,t),this.position=new THREE.Vector3,this.intensity=i||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.PointLight,THREE.Object3D=function(){this.id=THREE.Object3DCounter.value++,this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.matrix=new THREE.Matrix4,this.translationMatrix=new THREE.Matrix4,this.rotationMatrix=new THREE.Matrix4,this.scaleMatrix=new THREE.Matrix4,this.screen=new THREE.Vector3,this.autoUpdateMatrix=this.visible=!0,this.updateMatrix=function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z),this.rotationMatrix=THREE.Matrix4.rotationXMatrix(this.rotation.x),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y)),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z)),this.scaleMatrix=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z),this.matrix.copy(this.matrixPosition),this.matrix.multiplySelf(this.rotationMatrix),this.matrix.multiplySelf(this.scaleMatrix)}},THREE.Object3DCounter={value:0},THREE.Particle=function(t){THREE.Object3D.call(this),this.material=t instanceof Array?t:[t],this.autoUpdateMatrix=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(t,i){THREE.Object3D.call(this),this.geometry=t,this.material=i instanceof Array?i:[i]},THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(t,i,e){THREE.Object3D.call(this),this.geometry=t,this.material=i instanceof Array?i:[i],this.overdraw=this.doubleSided=this.flipSided=!1,e&&this.normalizeUVs(),this.geometry.computeBoundingBox()},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.normalizeUVs=function(){var t,i,e,n,r;for(t=0,i=this.geometry.uvs.length;t<i;t++)for(r=this.geometry.uvs[t],e=0,n=r.length;e<n;e++)1!=r[e].u&&(r[e].u-=Math.floor(r[e].u)),1!=r[e].v&&(r[e].v-=Math.floor(r[e].v))},THREE.FlatShading=0,THREE.SmoothShading=1,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.LineBasicMaterial=function(t){this.color=new THREE.Color(16711680),this.opacity=1,this.blending=THREE.NormalBlending,this.linewidth=1,this.linejoin=this.linecap="round",t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.linewidth&&(this.linewidth=t.linewidth),void 0!==t.linecap&&(this.linecap=t.linecap),void 0!==t.linejoin&&(this.linejoin=t.linejoin)),this.toString=function(){return"THREE.LineBasicMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>linewidth: "+this.linewidth+"<br/>linecap: "+this.linecap+"<br/>linejoin: "+this.linejoin+"<br/>)"}},THREE.MeshBasicMaterial=function(t){this.id=THREE.MeshBasicMaterialCounter.value++,this.color=new THREE.Color(15658734),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.env_map&&(this.env_map=t.env_map),void 0!==t.combine&&(this.combine=t.combine),void 0!==t.reflectivity&&(this.reflectivity=t.reflectivity),void 0!==t.refraction_ratio&&(this.refraction_ratio=t.refraction_ratio),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin)),this.toString=function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshBasicMaterialCounter={value:0},THREE.MeshLambertMaterial=function(t){this.id=THREE.MeshLambertMaterialCounter.value++,this.color=new THREE.Color(15658734),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.env_map&&(this.env_map=t.env_map),void 0!==t.combine&&(this.combine=t.combine),void 0!==t.reflectivity&&(this.reflectivity=t.reflectivity),void 0!==t.refraction_ratio&&(this.refraction_ratio=t.refraction_ratio),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin)),this.toString=function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/> )"}},THREE.MeshLambertMaterialCounter={value:0},THREE.MeshPhongMaterial=function(t){this.id=THREE.MeshPhongMaterialCounter.value++,this.color=new THREE.Color(15658734),this.ambient=new THREE.Color(328965),this.specular=new THREE.Color(1118481),this.shininess=30,this.env_map=this.specular_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.color&&(this.color=new THREE.Color(t.color)),void 0!==t.ambient&&(this.ambient=new THREE.Color(t.ambient)),void 0!==t.specular&&(this.specular=new THREE.Color(t.specular)),void 0!==t.shininess&&(this.shininess=t.shininess),void 0!==t.map&&(this.map=t.map),void 0!==t.specular_map&&(this.specular_map=t.specular_map),void 0!==t.env_map&&(this.env_map=t.env_map),void 0!==t.combine&&(this.combine=t.combine),void 0!==t.reflectivity&&(this.reflectivity=t.reflectivity),void 0!==t.refraction_ratio&&(this.refraction_ratio=t.refraction_ratio),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin)),this.toString=function(){return"THREE.MeshPhongMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>shininess: "+this.shininess+"<br/>map: "+this.map+"<br/>specular_map: "+this.specular_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>NaN"}},THREE.MeshPhongMaterialCounter={value:0},THREE.MeshDepthMaterial=function(t){this.near=1,this.far=1e3,this.opacity=1,this.blending=THREE.NormalBlending,t&&(void 0!==t.near&&(this.near=t.near),void 0!==t.far&&(this.far=t.far),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending)),this.__2near=2*this.near,this.__farPlusNear=this.far+this.near,this.__farMinusNear=this.far-this.near,this.toString=function(){return"THREE.MeshDepthMaterial"}},THREE.MeshNormalMaterial=function(t){this.opacity=1,this.shading=THREE.FlatShading,this.blending=THREE.NormalBlending,t&&(void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending)),this.toString=function(){return"THREE.MeshNormalMaterial"}},THREE.MeshFaceMaterial=function(){this.toString=function(){return"THREE.MeshFaceMaterial";
}},THREE.MeshCubeMaterial=function(t){this.id=THREE.MeshCubeMaterial.value++,this.env_map=null,this.blending=THREE.NormalBlending,t&&void 0!==t.env_map&&(this.env_map=t.env_map),this.toString=function(){return"THREE.MeshCubeMaterial( id: "+this.id+"<br/>env_map: "+this.env_map+" )"}},THREE.MeshCubeMaterialCounter={value:0},THREE.MeshShaderMaterial=function(t){this.id=THREE.MeshShaderMaterialCounter.value++,this.vertex_shader=this.fragment_shader="void main() {}",this.uniforms={},this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.fragment_shader&&(this.fragment_shader=t.fragment_shader),void 0!==t.vertex_shader&&(this.vertex_shader=t.vertex_shader),void 0!==t.uniforms&&(this.uniforms=t.uniforms),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin)),this.toString=function(){return"THREE.MeshShaderMaterial (<br/>id: "+this.id+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshShaderMaterialCounter={value:0},THREE.ParticleBasicMaterial=function(t){this.color=new THREE.Color(16711680),this.map=null,this.opacity=1,this.blending=THREE.NormalBlending,this.offset=new THREE.Vector2,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending)),this.toString=function(){return"THREE.ParticleBasicMaterial (<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleCircleMaterial=function(t){this.color=new THREE.Color(16711680),this.opacity=1,this.blending=THREE.NormalBlending,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending)),this.toString=function(){return"THREE.ParticleCircleMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleDOMMaterial=function(t){this.domElement=t,this.toString=function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}},THREE.Texture=function(t,i,e,n,r,o){this.image=t,this.mapping=void 0!==i?i:new THREE.UVMapping,this.wrap_s=void 0!==e?e:THREE.ClampToEdgeWrapping,this.wrap_t=void 0!==n?n:THREE.ClampToEdgeWrapping,this.mag_filter=void 0!==r?r:THREE.LinearFilter,this.min_filter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.toString=function(){return"THREE.Texture (<br/>image: "+this.image+"<br/>wrap_s: "+this.wrap_s+"<br/>wrap_t: "+this.wrap_t+"<br/>mag_filter: "+this.mag_filter+"<br/>min_filter: "+this.min_filter+"<br/>)"}},THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8,THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.Scene=function(){this.objects=[],this.lights=[],this.addObject=function(t){this.objects.push(t)},this.removeObject=function(t){t=this.objects.indexOf(t),t!==-1&&this.objects.splice(t,1)},this.addLight=function(t){this.lights.push(t)},this.removeLight=function(t){t=this.lights.indexOf(t),t!==-1&&this.lights.splice(t,1)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},THREE.Projector=function(){function t(t,i){var e=0,n=1,r=t.z+t.w,o=i.z+i.w,a=-t.z+t.w,s=-i.z+i.w;return r>=0&&o>=0&&a>=0&&s>=0||!(r<0&&o<0||a<0&&s<0)&&(r<0?e=Math.max(e,r/(r-o)):o<0&&(n=Math.min(n,r/(r-o))),a<0?e=Math.max(e,a/(a-s)):s<0&&(n=Math.min(n,a/(a-s))),!(n<e)&&(t.lerpSelf(i,e),i.lerpSelf(t,1-n),!0))}var i,e,n,r,o,a,s,h,l=null,c=[],u=[],f=[],E=new THREE.Vector4,m=new THREE.Matrix4,p=new THREE.Matrix4,d=new THREE.Vector4,v=new THREE.Vector4;this.projectScene=function(g,y){var R,b,x,T,_,w,H,M,S,L,C,z,P,A,V,F,N;for(l=[],n=o=s=0,y.autoUpdateMatrix&&y.updateMatrix(),m.multiply(y.projectionMatrix,y.matrix),H=g.objects,R=0,b=H.length;R<b;R++)if(M=H[R],M.autoUpdateMatrix&&M.updateMatrix(),S=M.matrix,L=M.rotationMatrix,C=M.material,z=M.overdraw,M instanceof THREE.Mesh){for(P=M.geometry.vertices,x=0,T=P.length;x<T;x++)A=P[x],A.positionWorld.copy(A.position),S.multiplyVector3(A.positionWorld),V=A.positionScreen,V.copy(A.positionWorld),m.multiplyVector4(V),V.multiplyScalar(1/V.w),A.__visible=V.z>0&&V.z<1;for(A=M.geometry.faces,x=0,T=A.length;x<T;x++)if(V=A[x],V instanceof THREE.Face3){if(_=P[V.a],w=P[V.b],F=P[V.c],_.__visible&&w.__visible&&F.__visible&&(M.doubleSided||M.flipSided!=(F.positionScreen.x-_.positionScreen.x)*(w.positionScreen.y-_.positionScreen.y)-(F.positionScreen.y-_.positionScreen.y)*(w.positionScreen.x-_.positionScreen.x)<0)){for(i=c[n]=c[n]||new THREE.RenderableFace3,i.v1.positionWorld.copy(_.positionWorld),i.v2.positionWorld.copy(w.positionWorld),i.v3.positionWorld.copy(F.positionWorld),i.v1.positionScreen.copy(_.positionScreen),i.v2.positionScreen.copy(w.positionScreen),i.v3.positionScreen.copy(F.positionScreen),i.normalWorld.copy(V.normal),L.multiplyVector3(i.normalWorld),i.centroidWorld.copy(V.centroid),S.multiplyVector3(i.centroidWorld),i.centroidScreen.copy(i.centroidWorld),m.multiplyVector3(i.centroidScreen),F=V.vertexNormals,h=i.vertexNormalsWorld,_=0,w=F.length;_<w;_++)N=h[_]=h[_]||new THREE.Vector3,N.copy(F[_]),L.multiplyVector3(N);i.z=i.centroidScreen.z,i.meshMaterial=C,i.faceMaterial=V.material,i.overdraw=z,M.geometry.uvs[x]&&(i.uvs[0]=M.geometry.uvs[x][0],i.uvs[1]=M.geometry.uvs[x][1],i.uvs[2]=M.geometry.uvs[x][2]),l.push(i),n++}}else V instanceof THREE.Face4&&(_=P[V.a],w=P[V.b],F=P[V.c],N=P[V.d],_.__visible&&w.__visible&&F.__visible&&N.__visible&&(M.doubleSided||M.flipSided!=((N.positionScreen.x-_.positionScreen.x)*(w.positionScreen.y-_.positionScreen.y)-(N.positionScreen.y-_.positionScreen.y)*(w.positionScreen.x-_.positionScreen.x)<0||(w.positionScreen.x-F.positionScreen.x)*(N.positionScreen.y-F.positionScreen.y)-(w.positionScreen.y-F.positionScreen.y)*(N.positionScreen.x-F.positionScreen.x)<0))&&(i=c[n]=c[n]||new THREE.RenderableFace3,i.v1.positionWorld.copy(_.positionWorld),i.v2.positionWorld.copy(w.positionWorld),i.v3.positionWorld.copy(N.positionWorld),i.v1.positionScreen.copy(_.positionScreen),i.v2.positionScreen.copy(w.positionScreen),i.v3.positionScreen.copy(N.positionScreen),i.normalWorld.copy(V.normal),L.multiplyVector3(i.normalWorld),i.centroidWorld.copy(V.centroid),S.multiplyVector3(i.centroidWorld),i.centroidScreen.copy(i.centroidWorld),m.multiplyVector3(i.centroidScreen),i.z=i.centroidScreen.z,i.meshMaterial=C,i.faceMaterial=V.material,i.overdraw=z,M.geometry.uvs[x]&&(i.uvs[0]=M.geometry.uvs[x][0],i.uvs[1]=M.geometry.uvs[x][1],i.uvs[2]=M.geometry.uvs[x][3]),l.push(i),n++,e=c[n]=c[n]||new THREE.RenderableFace3,e.v1.positionWorld.copy(w.positionWorld),e.v2.positionWorld.copy(F.positionWorld),e.v3.positionWorld.copy(N.positionWorld),e.v1.positionScreen.copy(w.positionScreen),e.v2.positionScreen.copy(F.positionScreen),e.v3.positionScreen.copy(N.positionScreen),e.normalWorld.copy(i.normalWorld),e.centroidWorld.copy(i.centroidWorld),e.centroidScreen.copy(i.centroidScreen),e.z=e.centroidScreen.z,e.meshMaterial=C,e.faceMaterial=V.material,e.overdraw=z,M.geometry.uvs[x]&&(e.uvs[0]=M.geometry.uvs[x][1],e.uvs[1]=M.geometry.uvs[x][2],e.uvs[2]=M.geometry.uvs[x][3]),l.push(e),n++))}else if(M instanceof THREE.Line)for(p.multiply(m,S),P=M.geometry.vertices,A=P[0],A.positionScreen.copy(A.position),p.multiplyVector4(A.positionScreen),x=1,T=P.length;x<T;x++)_=P[x],_.positionScreen.copy(_.position),p.multiplyVector4(_.positionScreen),w=P[x-1],d.copy(_.positionScreen),v.copy(w.positionScreen),t(d,v)&&(d.multiplyScalar(1/d.w),v.multiplyScalar(1/v.w),r=u[o]=u[o]||new THREE.RenderableLine,r.v1.positionScreen.copy(d),r.v2.positionScreen.copy(v),r.z=Math.max(d.z,v.z),r.material=M.material,l.push(r),o++);else M instanceof THREE.Particle&&(E.set(M.position.x,M.position.y,M.position.z,1),m.multiplyVector4(E),E.z/=E.w,E.z>0&&E.z<1&&(a=f[s]=f[s]||new THREE.RenderableParticle,a.x=E.x/E.w,a.y=E.y/E.w,a.z=E.z,a.rotation=M.rotation.z,a.scale.x=M.scale.x*Math.abs(a.x-(E.x+y.projectionMatrix.n11)/(E.w+y.projectionMatrix.n14)),a.scale.y=M.scale.y*Math.abs(a.y-(E.y+y.projectionMatrix.n22)/(E.w+y.projectionMatrix.n24)),a.material=M.material,l.push(a),s++));return l.sort(function(t,i){return i.z-t.z}),l},this.unprojectVector=function(t,i){var e=new THREE.Matrix4;return e.multiply(THREE.Matrix4.makeInvert(i.matrix),THREE.Matrix4.makeInvert(i.projectionMatrix)),e.multiplyVector3(t),t}},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var t,i,e,n,r=null,o=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(r,o){t=r,i=o,e=t/2,n=i/2},this.render=function(t,i){var a,s,h,l,c,u,f,E;for(r=o.projectScene(t,i),a=0,s=r.length;a<s;a++)if(c=r[a],c instanceof THREE.RenderableParticle)for(f=c.x*e+e,E=c.y*n+n,h=0,l=c.material.length;h<l;h++)u=c.material[h],u instanceof THREE.ParticleDOMMaterial&&(u=u.domElement,u.style.left=f+"px",u.style.top=E+"px")}},THREE.CanvasRenderer=function(){var t,i,e,n,r,o,a,s,h,l,c,u,f,E,m,p,d,v,g,y,R,b,x,T,_,w,H,M,S,L=null,C=new THREE.Projector,z=document.createElement("canvas"),P=z.getContext("2d"),A=1,V=0,F=null,N=null,B=1,W=Math.min,U=Math.max,j=new THREE.Color,D=new THREE.Color,G=new THREE.Color,I=new THREE.Color,O=new THREE.Color,k=new THREE.Rectangle,X=new THREE.Rectangle,q=new THREE.Rectangle,Y=!1,K=new THREE.Color,Z=new THREE.Color,Q=new THREE.Color,J=new THREE.Color,$=2*Math.PI,tt=new THREE.Vector3,it=16;T=document.createElement("canvas"),T.width=T.height=2,_=T.getContext("2d"),_.fillStyle="rgba(0,0,0,1)",_.fillRect(0,0,2,2),w=_.getImageData(0,0,2,2),H=w.data,M=document.createElement("canvas"),M.width=M.height=it,S=M.getContext("2d"),S.translate(-it/2,-it/2),S.scale(it,it),it--,this.domElement=z,this.autoClear=!0,this.setSize=function(r,o){t=r,i=o,e=t/2,n=i/2,z.width=t,z.height=i,k.set(-e,-n,e,n)},this.clear=function(){X.isEmpty()||(X.inflate(1),X.minSelf(k),P.clearRect(X.getX(),X.getY(),X.getWidth(),X.getHeight()),X.empty())},this.render=function(t,i){function z(t){var i,e,n,r=t.lights;for(Z.setRGB(0,0,0),Q.setRGB(0,0,0),J.setRGB(0,0,0),t=0,i=r.length;t<i;t++)e=r[t],n=e.color,e instanceof THREE.AmbientLight?(Z.r+=n.r,Z.g+=n.g,Z.b+=n.b):e instanceof THREE.DirectionalLight?(Q.r+=n.r,Q.g+=n.g,Q.b+=n.b):e instanceof THREE.PointLight&&(J.r+=n.r,J.g+=n.g,J.b+=n.b)}function it(t,i,e,n){var r,o,a,s,h=t.lights;for(t=0,r=h.length;t<r;t++)o=h[t],a=o.color,s=o.intensity,o instanceof THREE.DirectionalLight?(o=e.dot(o.position)*s,o>0&&(n.r+=a.r*o,n.g+=a.g*o,n.b+=a.b*o)):o instanceof THREE.PointLight&&(tt.sub(o.position,i),tt.normalize(),o=e.dot(tt)*s,o>0&&(n.r+=a.r*o,n.g+=a.g*o,n.b+=a.b*o))}function et(t,i,r){if(0!=r.opacity){ht(r.opacity),lt(r.blending);var o,a,s,h,l,c;r instanceof THREE.ParticleBasicMaterial?r.map&&(h=r.map,l=h.width>>1,c=h.height>>1,a=i.scale.x*e,s=i.scale.y*n,r=a*l,o=s*c,q.set(t.x-r,t.y-o,t.x+r,t.y+o),k.instersects(q)&&(P.save(),P.translate(t.x,t.y),P.rotate(-i.rotation),P.scale(a,-s),P.translate(-l,-c),P.drawImage(h,0,0),P.restore())):r instanceof THREE.ParticleCircleMaterial&&(Y?(K.r=Z.r+Q.r+J.r,K.g=Z.g+Q.g+J.g,K.b=Z.b+Q.b+J.b,j.r=r.color.r*K.r,j.g=r.color.g*K.g,j.b=r.color.b*K.b,j.updateStyleString()):j.__styleString=r.color.__styleString,r=i.scale.x*e,o=i.scale.y*n,q.set(t.x-r,t.y-o,t.x+r,t.y+o),k.instersects(q)&&(a=j.__styleString,N!=a&&(P.fillStyle=N=a),P.save(),P.translate(t.x,t.y),P.rotate(-i.rotation),P.scale(r,o),P.beginPath(),P.arc(0,0,1,0,$,!0),P.closePath(),P.fill(),P.restore()))}}function nt(t,i,e,n){0!=n.opacity&&(ht(n.opacity),lt(n.blending),P.beginPath(),P.moveTo(t.positionScreen.x,t.positionScreen.y),P.lineTo(i.positionScreen.x,i.positionScreen.y),P.closePath(),n instanceof THREE.LineBasicMaterial&&(j.__styleString=n.color.__styleString,t=n.linewidth,B!=t&&(P.lineWidth=B=t),t=j.__styleString,F!=t&&(P.strokeStyle=F=t),P.stroke(),q.inflate(2*n.linewidth)))}function rt(t,e,n,r,o,a){0!=o.opacity&&(ht(o.opacity),lt(o.blending),s=t.positionScreen.x,h=t.positionScreen.y,l=e.positionScreen.x,c=e.positionScreen.y,u=n.positionScreen.x,f=n.positionScreen.y,P.beginPath(),P.moveTo(s,h),P.lineTo(l,c),P.lineTo(u,f),P.lineTo(s,h),P.closePath(),o instanceof THREE.MeshBasicMaterial?o.map?o.map.image.loaded&&o.map.mapping instanceof THREE.UVMapping&&st(s,h,l,c,u,f,o.map.image,r.uvs[0].u,r.uvs[0].v,r.uvs[1].u,r.uvs[1].v,r.uvs[2].u,r.uvs[2].v):o.env_map?o.env_map.image.loaded&&o.env_map.mapping instanceof THREE.SphericalReflectionMapping&&(t=i.matrix,tt.copy(r.vertexNormalsWorld[0]),v=.5*(tt.x*t.n11+tt.y*t.n12+tt.z*t.n13)+.5,g=.5*-(tt.x*t.n21+tt.y*t.n22+tt.z*t.n23)+.5,tt.copy(r.vertexNormalsWorld[1]),y=.5*(tt.x*t.n11+tt.y*t.n12+tt.z*t.n13)+.5,R=.5*-(tt.x*t.n21+tt.y*t.n22+tt.z*t.n23)+.5,tt.copy(r.vertexNormalsWorld[2]),b=.5*(tt.x*t.n11+tt.y*t.n12+tt.z*t.n13)+.5,x=.5*-(tt.x*t.n21+tt.y*t.n22+tt.z*t.n23)+.5,st(s,h,l,c,u,f,o.env_map.image,v,g,y,R,b,x)):o.wireframe?ot(o.color.__styleString,o.wireframe_linewidth):at(o.color.__styleString):o instanceof THREE.MeshLambertMaterial?(o.map&&!o.wireframe&&(o.map.mapping instanceof THREE.UVMapping&&st(s,h,l,c,u,f,o.map.image,r.uvs[0].u,r.uvs[0].v,r.uvs[1].u,r.uvs[1].v,r.uvs[2].u,r.uvs[2].v),lt(THREE.SubtractiveBlending)),Y?o.wireframe||o.shading!=THREE.SmoothShading||3!=r.vertexNormalsWorld.length?(K.r=Z.r,K.g=Z.g,K.b=Z.b,it(a,r.centroidWorld,r.normalWorld,K),j.r=o.color.r*K.r,j.g=o.color.g*K.g,j.b=o.color.b*K.b,j.updateStyleString(),o.wireframe?ot(j.__styleString,o.wireframe_linewidth):at(j.__styleString)):(D.r=G.r=I.r=Z.r,D.g=G.g=I.g=Z.g,D.b=G.b=I.b=Z.b,it(a,r.v1.positionWorld,r.vertexNormalsWorld[0],D),it(a,r.v2.positionWorld,r.vertexNormalsWorld[1],G),it(a,r.v3.positionWorld,r.vertexNormalsWorld[2],I),O.r=.5*(G.r+I.r),O.g=.5*(G.g+I.g),O.b=.5*(G.b+I.b),d=ct(D,G,I,O),st(s,h,l,c,u,f,d,0,0,1,0,0,1)):o.wireframe?ot(o.color.__styleString,o.wireframe_linewidth):at(o.color.__styleString)):o instanceof THREE.MeshDepthMaterial?(E=o.__2near,m=o.__farPlusNear,p=o.__farMinusNear,D.r=D.g=D.b=1-E/(m-t.positionScreen.z*p),G.r=G.g=G.b=1-E/(m-e.positionScreen.z*p),I.r=I.g=I.b=1-E/(m-n.positionScreen.z*p),O.r=.5*(G.r+I.r),O.g=.5*(G.g+I.g),O.b=.5*(G.b+I.b),d=ct(D,G,I,O),st(s,h,l,c,u,f,d,0,0,1,0,0,1)):o instanceof THREE.MeshNormalMaterial&&(j.r=ut(r.normalWorld.x),j.g=ut(r.normalWorld.y),j.b=ut(r.normalWorld.z),j.updateStyleString(),o.wireframe?ot(j.__styleString,o.wireframe_linewidth):at(j.__styleString)))}function ot(t,i){F!=t&&(P.strokeStyle=F=t),B!=i&&(P.lineWidth=B=i),P.stroke(),q.inflate(2*i)}function at(t){N!=t&&(P.fillStyle=N=t),P.fill()}function st(t,i,e,n,r,o,a,s,h,l,c,u,f){var E,m;E=a.width-1,m=a.height-1,s*=E,h*=m,l*=E,c*=m,u*=E,f*=m,e-=t,n-=i,r-=t,o-=i,l-=s,c-=h,u-=s,f-=h,m=1/(l*f-u*c),E=(f*e-c*r)*m,c=(f*n-c*o)*m,e=(l*r-u*e)*m,n=(l*o-u*n)*m,t=t-E*s-e*h,i=i-c*s-n*h,P.save(),P.transform(E,c,e,n,t,i),P.clip(),P.drawImage(a,0,0),P.restore()}function ht(t){A!=t&&(P.globalAlpha=A=t)}function lt(t){if(V!=t){switch(t){case THREE.NormalBlending:P.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:P.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:P.globalCompositeOperation="darker"}V=t}}function ct(t,i,e,n){return H[0]=U(0,W(255,~~(255*t.r))),H[1]=U(0,W(255,~~(255*t.g))),H[2]=U(0,W(255,~~(255*t.b))),H[4]=U(0,W(255,~~(255*i.r))),H[5]=U(0,W(255,~~(255*i.g))),H[6]=U(0,W(255,~~(255*i.b))),H[8]=U(0,W(255,~~(255*e.r))),H[9]=U(0,W(255,~~(255*e.g))),H[10]=U(0,W(255,~~(255*e.b))),H[12]=U(0,W(255,~~(255*n.r))),H[13]=U(0,W(255,~~(255*n.g))),H[14]=U(0,W(255,~~(255*n.b))),_.putImageData(w,0,0),S.drawImage(T,0,0),M}function ut(t){return t<0?W(.5*(1+t),.5):.5+W(.5*t,.5)}function ft(t,i){var e=i.x-t.x,n=i.y-t.y,r=1/Math.sqrt(e*e+n*n);e*=r,n*=r,i.x+=e,i.y+=n,t.x-=e,t.y-=n}var Et,mt,pt,dt,vt,gt,yt,Rt;for(P.setTransform(1,0,0,-1,e,n),this.autoClear&&this.clear(),L=C.projectScene(t,i),(Y=t.lights.length>0)&&z(t),Et=0,mt=L.length;Et<mt;Et++){if(pt=L[Et],q.empty(),pt instanceof THREE.RenderableParticle)for(r=pt,r.x*=e,r.y*=n,dt=0,vt=pt.material.length;dt<vt;dt++)et(r,pt,pt.material[dt],t);else if(pt instanceof THREE.RenderableLine){if(r=pt.v1,o=pt.v2,r.positionScreen.x*=e,r.positionScreen.y*=n,o.positionScreen.x*=e,o.positionScreen.y*=n,q.addPoint(r.positionScreen.x,r.positionScreen.y),q.addPoint(o.positionScreen.x,o.positionScreen.y),k.instersects(q))for(dt=0,vt=pt.material.length;dt<vt;)nt(r,o,pt,pt.material[dt++],t)}else if(pt instanceof THREE.RenderableFace3&&(r=pt.v1,o=pt.v2,a=pt.v3,r.positionScreen.x*=e,r.positionScreen.y*=n,o.positionScreen.x*=e,o.positionScreen.y*=n,a.positionScreen.x*=e,a.positionScreen.y*=n,pt.overdraw&&(ft(r.positionScreen,o.positionScreen),ft(o.positionScreen,a.positionScreen),ft(a.positionScreen,r.positionScreen)),q.addPoint(r.positionScreen.x,r.positionScreen.y),q.addPoint(o.positionScreen.x,o.positionScreen.y),q.addPoint(a.positionScreen.x,a.positionScreen.y),k.instersects(q)))for(dt=0,vt=pt.meshMaterial.length;dt<vt;)if(Rt=pt.meshMaterial[dt++],Rt instanceof THREE.MeshFaceMaterial)for(gt=0,yt=pt.faceMaterial.length;gt<yt;)(Rt=pt.faceMaterial[gt++])&&rt(r,o,a,pt,Rt,t);else rt(r,o,a,pt,Rt,t);X.addRectangle(q)}P.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function t(t,i,e){var n,r,o,a;for(n=0,r=t.lights.length;n<r;n++)o=t.lights[n],o instanceof THREE.DirectionalLight?(a=i.normalWorld.dot(o.position)*o.intensity,a>0&&(e.r+=o.color.r*a,e.g+=o.color.g*a,e.b+=o.color.b*a)):o instanceof THREE.PointLight&&(L.sub(o.position,i.centroidWorld),L.normalize(),a=i.normalWorld.dot(L)*o.intensity,a>0&&(e.r+=o.color.r*a,e.g+=o.color.g*a,e.b+=o.color.b*a))}function i(i,e,o,a,s,h){m=n(p++),m.setAttribute("d","M "+i.positionScreen.x+" "+i.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),s instanceof THREE.MeshBasicMaterial?_.__styleString=s.color.__styleString:s instanceof THREE.MeshLambertMaterial?T?(w.r=H.r,w.g=H.g,w.b=H.b,t(h,a,w),_.r=s.color.r*w.r,_.g=s.color.g*w.g,_.b=s.color.b*w.b,_.updateStyleString()):_.__styleString=s.color.__styleString:s instanceof THREE.MeshDepthMaterial?(E=1-s.__2near/(s.__farPlusNear-a.z*s.__farMinusNear),_.setRGB(E,E,E)):s instanceof THREE.MeshNormalMaterial&&_.setRGB(r(a.normalWorld.x),r(a.normalWorld.y),r(a.normalWorld.z)),s.wireframe?m.setAttribute("style","fill: none; stroke: "+_.__styleString+"; stroke-width: "+s.wireframe_linewidth+"; stroke-opacity: "+s.opacity+"; stroke-linecap: "+s.wireframe_linecap+"; stroke-linejoin: "+s.wireframe_linejoin):m.setAttribute("style","fill: "+_.__styleString+"; fill-opacity: "+s.opacity),R.appendChild(m)}function e(i,e,o,a,s,h,l){m=n(p++),m.setAttribute("d","M "+i.positionScreen.x+" "+i.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+" L "+a.positionScreen.x+","+a.positionScreen.y+"z"),h instanceof THREE.MeshBasicMaterial?_.__styleString=h.color.__styleString:h instanceof THREE.MeshLambertMaterial?T?(w.r=H.r,w.g=H.g,w.b=H.b,t(l,s,w),_.r=h.color.r*w.r,_.g=h.color.g*w.g,_.b=h.color.b*w.b,_.updateStyleString()):_.__styleString=h.color.__styleString:h instanceof THREE.MeshDepthMaterial?(E=1-h.__2near/(h.__farPlusNear-s.z*h.__farMinusNear),_.setRGB(E,E,E)):h instanceof THREE.MeshNormalMaterial&&_.setRGB(r(s.normalWorld.x),r(s.normalWorld.y),r(s.normalWorld.z)),h.wireframe?m.setAttribute("style","fill: none; stroke: "+_.__styleString+"; stroke-width: "+h.wireframe_linewidth+"; stroke-opacity: "+h.opacity+"; stroke-linecap: "+h.wireframe_linecap+"; stroke-linejoin: "+h.wireframe_linejoin):m.setAttribute("style","fill: "+_.__styleString+"; fill-opacity: "+h.opacity),R.appendChild(m)}function n(t){return null==C[t]?(C[t]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==A&&C[t].setAttribute("shape-rendering","crispEdges"),C[t]):C[t]}function r(t){return t<0?Math.min(.5*(1+t),.5):.5+Math.min(.5*t,.5)}var o,a,s,h,l,c,u,f,E,m,p,d,v,g=null,y=new THREE.Projector,R=document.createElementNS("http://www.w3.org/2000/svg","svg"),b=new THREE.Rectangle,x=new THREE.Rectangle,T=!1,_=new THREE.Color(16777215),w=new THREE.Color(16777215),H=new THREE.Color(0),M=new THREE.Color(0),S=new THREE.Color(0),L=new THREE.Vector3,C=[],z=[],P=[],A=1;this.domElement=R,this.autoClear=!0,this.setQuality=function(t){switch(t){case"high":A=1;break;case"low":A=0}},this.setSize=function(t,i){o=t,a=i,s=o/2,h=a/2,R.setAttribute("viewBox",-s+" "+-h+" "+o+" "+a),R.setAttribute("width",o),R.setAttribute("height",a),b.set(-s,-h,s,h)},this.clear=function(){for(;R.childNodes.length>0;)R.removeChild(R.childNodes[0])},this.render=function(t,n){var r,o,a,E,L,C,V,F;if(this.autoClear&&this.clear(),g=y.projectScene(t,n),v=d=p=0,T=t.lights.length>0)for(V=t.lights,H.setRGB(0,0,0),M.setRGB(0,0,0),S.setRGB(0,0,0),r=0,o=V.length;r<o;r++)a=V[r],E=a.color,a instanceof THREE.AmbientLight?(H.r+=E.r,H.g+=E.g,H.b+=E.b):a instanceof THREE.DirectionalLight?(M.r+=E.r,M.g+=E.g,M.b+=E.b):a instanceof THREE.PointLight&&(S.r+=E.r,S.g+=E.g,S.b+=E.b);for(r=0,o=g.length;r<o;r++)if(V=g[r],x.empty(),V instanceof THREE.RenderableParticle){for(l=V,l.x*=s,l.y*=-h,a=0,E=V.material.length;a<E;a++)if(F=V.material[a]){L=l,C=V,F=F;var N=d++;null==z[N]&&(z[N]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==A&&z[N].setAttribute("shape-rendering","crispEdges")),m=z[N],m.setAttribute("cx",L.x),m.setAttribute("cy",L.y),m.setAttribute("r",C.scale.x*s),F instanceof THREE.ParticleCircleMaterial&&(T?(w.r=H.r+M.r+S.r,w.g=H.g+M.g+S.g,w.b=H.b+M.b+S.b,_.r=F.color.r*w.r,_.g=F.color.g*w.g,_.b=F.color.b*w.b,_.updateStyleString()):_=F.color,m.setAttribute("style","fill: "+_.__styleString)),R.appendChild(m)}}else if(V instanceof THREE.RenderableLine){if(l=V.v1,c=V.v2,l.positionScreen.x*=s,l.positionScreen.y*=-h,c.positionScreen.x*=s,c.positionScreen.y*=-h,x.addPoint(l.positionScreen.x,l.positionScreen.y),x.addPoint(c.positionScreen.x,c.positionScreen.y),b.instersects(x))for(a=0,E=V.material.length;a<E;)(F=V.material[a++])&&(L=l,C=c,F=F,N=v++,null==P[N]&&(P[N]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==A&&P[N].setAttribute("shape-rendering","crispEdges")),m=P[N],m.setAttribute("x1",L.positionScreen.x),m.setAttribute("y1",L.positionScreen.y),m.setAttribute("x2",C.positionScreen.x),m.setAttribute("y2",C.positionScreen.y),F instanceof THREE.LineBasicMaterial&&(_.__styleString=F.color.__styleString,m.setAttribute("style","fill: none; stroke: "+_.__styleString+"; stroke-width: "+F.linewidth+"; stroke-opacity: "+F.opacity+"; stroke-linecap: "+F.linecap+"; stroke-linejoin: "+F.linejoin),R.appendChild(m)))}else if(V instanceof THREE.RenderableFace3){if(l=V.v1,c=V.v2,u=V.v3,l.positionScreen.x*=s,l.positionScreen.y*=-h,c.positionScreen.x*=s,c.positionScreen.y*=-h,u.positionScreen.x*=s,u.positionScreen.y*=-h,x.addPoint(l.positionScreen.x,l.positionScreen.y),x.addPoint(c.positionScreen.x,c.positionScreen.y),x.addPoint(u.positionScreen.x,u.positionScreen.y),b.instersects(x))for(a=0,E=V.meshMaterial.length;a<E;)if(F=V.meshMaterial[a++],F instanceof THREE.MeshFaceMaterial)for(L=0,C=V.faceMaterial.length;L<C;)(F=V.faceMaterial[L++])&&i(l,c,u,V,F,t);else F&&i(l,c,u,V,F,t)}else if(V instanceof THREE.RenderableFace4&&(l=V.v1,c=V.v2,u=V.v3,f=V.v4,l.positionScreen.x*=s,l.positionScreen.y*=-h,c.positionScreen.x*=s,c.positionScreen.y*=-h,u.positionScreen.x*=s,u.positionScreen.y*=-h,f.positionScreen.x*=s,f.positionScreen.y*=-h,x.addPoint(l.positionScreen.x,l.positionScreen.y),x.addPoint(c.positionScreen.x,c.positionScreen.y),x.addPoint(u.positionScreen.x,u.positionScreen.y),x.addPoint(f.positionScreen.x,f.positionScreen.y),b.instersects(x)))for(a=0,E=V.meshMaterial.length;a<E;)if(F=V.meshMaterial[a++],F instanceof THREE.MeshFaceMaterial)for(L=0,C=V.faceMaterial.length;L<C;)(F=V.faceMaterial[L++])&&e(l,c,u,f,V,F,t);else F&&e(l,c,u,f,V,F,t)}},THREE.WebGLRenderer=function(t){function i(t,i){var e=h.createProgram();return h.attachShader(e,a("fragment","#ifdef GL_ES\nprecision highp float;\n#endif\n"+t)),h.attachShader(e,a("vertex","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n"+i)),h.linkProgram(e),h.getProgramParameter(e,h.LINK_STATUS)||alert("Could not initialise shaders\nVALIDATE_STATUS: "+h.getProgramParameter(e,h.VALIDATE_STATUS)+", gl error ["+h.getError()+"]"),e.uniforms={},e.attributes={},e}function e(t,i){if(6==t.image.length){if(!t.image.__webGLTextureCube&&!t.image.__cubeMapInitialized&&6==t.image.loadCount){t.image.__webGLTextureCube=h.createTexture(),h.bindTexture(h.TEXTURE_CUBE_MAP,t.image.__webGLTextureCube),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_CUBE_MAP,h.TEXTURE_MIN_FILTER,h.LINEAR_MIPMAP_LINEAR);for(var e=0;e<6;++e)h.texImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t.image[e]);h.generateMipmap(h.TEXTURE_CUBE_MAP),h.bindTexture(h.TEXTURE_CUBE_MAP,null),t.image.__cubeMapInitialized=!0}h.activeTexture(h.TEXTURE0+i),h.bindTexture(h.TEXTURE_CUBE_MAP,t.image.__webGLTextureCube)}}function n(t,i){!t.__webGLTexture&&t.image.loaded&&(t.__webGLTexture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,t.__webGLTexture),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t.image),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s(t.wrap_s)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s(t.wrap_t)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,s(t.mag_filter)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s(t.min_filter)),h.generateMipmap(h.TEXTURE_2D),h.bindTexture(h.TEXTURE_2D,null)),h.activeTexture(h.TEXTURE0+i),h.bindTexture(h.TEXTURE_2D,t.__webGLTexture)}function r(t,i){var e,n,r;for(e=0,n=i.length;e<n;e++)r=i[e],t.uniforms[r]=h.getUniformLocation(t,r)}function o(t,i){var e,n,r;for(e=0,n=i.length;e<n;e++)r=i[e],t.attributes[r]=h.getAttribLocation(t,r),t.attributes[r]>=0&&h.enableVertexAttribArray(t.attributes[r])}function a(t,i){var e;return"fragment"==t?e=h.createShader(h.FRAGMENT_SHADER):"vertex"==t&&(e=h.createShader(h.VERTEX_SHADER)),h.shaderSource(e,i),h.compileShader(e),h.getShaderParameter(e,h.COMPILE_STATUS)?e:(alert(h.getShaderInfoLog(e)),null)}function s(t){switch(t){case THREE.RepeatWrapping:return h.REPEAT;case THREE.ClampToEdgeWrapping:return h.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return h.MIRRORED_REPEAT;case THREE.NearestFilter:return h.NEAREST;case THREE.NearestMipMapNearestFilter:return h.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return h.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return h.LINEAR;case THREE.LinearMipMapNearestFilter:return h.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return h.LINEAR_MIPMAP_LINEAR}return 0}var h,l,c,u,f=document.createElement("canvas"),E=new THREE.Matrix4,m=new Float32Array(16),p=new Float32Array(16),d=new Float32Array(16),v=new Float32Array(9),g=new Float32Array(16);t=function(t,i){if(t){var e,n,r,o=pointLights=maxDirLights=maxPointLights=0;for(e=0,n=t.lights.length;e<n;e++)r=t.lights[e],r instanceof THREE.DirectionalLight&&o++,r instanceof THREE.PointLight&&pointLights++;return pointLights+o<=i?(maxDirLights=o,maxPointLights=pointLights):(maxDirLights=Math.ceil(i*o/(pointLights+o)),maxPointLights=i-maxDirLights),{directional:maxDirLights,point:maxPointLights}}return{directional:1,point:i-1}}(t,4),this.domElement=f,this.autoClear=!0;try{h=f.getContext("experimental-webgl",{antialias:!0})}catch(t){}if(!h)throw alert("WebGL not supported"),"cannot create webgl context";h.clearColor(0,0,0,1),h.clearDepth(1),h.enable(h.DEPTH_TEST),h.depthFunc(h.LEQUAL),h.frontFace(h.CCW),h.cullFace(h.BACK),h.enable(h.CULL_FACE),h.enable(h.BLEND),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA),h.clearColor(0,0,0,0),l=c=function(t,e){var n=[t?"#define MAX_DIR_LIGHTS "+t:"",e?"#define MAX_POINT_LIGHTS "+e:"","uniform bool enableLighting;\nuniform bool useRefract;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;\nuniform vec3 ambientLightColor;",t?"uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];":"",t?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"",e?"uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];":"",e?"uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];":"","uniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",e?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vReflect;\nuniform float mRefractionRatio;\nvoid main(void) {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nif ( !enableLighting ) {\nvLightWeighting = vec3( 1.0, 1.0, 1.0 );\n} else {\nvLightWeighting = ambientLightColor;",t?"for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {":"",t?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",t?"float directionalLightWeighting = max( dot( transformedNormal, normalize(lDirection.xyz ) ), 0.0 );":"",t?"vLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;":"",t?"}":"",e?"for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {":"",e?"vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );":"",e?"vPointLightVector[ i ] = normalize( lPosition.xyz - mvPosition.xyz );":"",e?"float pointLightWeighting = max( dot( transformedNormal, vPointLightVector[ i ] ), 0.0 );":"",e?"vLightWeighting += pointLightColor[ i ] * pointLightWeighting;":"",e?"}":"","}\nvNormal = transformedNormal;\nvUv = uv;\nif ( useRefract ) {\nvReflect = refract( normalize(mPosition.xyz - cameraPosition), normalize(nWorld.xyz), mRefractionRatio );\n} else {\nvReflect = reflect( normalize(mPosition.xyz - cameraPosition), normalize(nWorld.xyz) );\n}\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),a=[t?"#define MAX_DIR_LIGHTS "+t:"",e?"#define MAX_POINT_LIGHTS "+e:"","uniform int material;\nuniform bool enableMap;\nuniform bool enableCubeMap;\nuniform bool mixEnvMap;\nuniform samplerCube tCube;\nuniform float mReflectivity;\nuniform sampler2D tMap;\nuniform vec4 mColor;\nuniform float mOpacity;\nuniform vec4 mAmbient;\nuniform vec4 mSpecular;\nuniform float mShininess;\nuniform float m2Near;\nuniform float mFarPlusNear;\nuniform float mFarMinusNear;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;",t?"uniform mat4 viewMatrix;":"",t?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"","varying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",e?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vReflect;\nuniform vec3 cameraPosition;\nvoid main() {\nvec4 mapColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nvec4 cubeColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nif ( enableMap ) {\nmapColor = texture2D( tMap, vUv );\n}\nif ( enableCubeMap ) {\ncubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n}\nif ( material == 5 ) { \nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( -wPos.x, wPos.yz ) );\n} else if ( material == 4 ) { \ngl_FragColor = vec4( 0.5*normalize( vNormal ) + vec3(0.5, 0.5, 0.5), mOpacity );\n} else if ( material == 3 ) { \nfloat w = 0.5;\ngl_FragColor = vec4( w, w, w, mOpacity );\n} else if ( material == 2 ) { \nvec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );",e?"vec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",e?"vec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",e?"for( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {":"",e?"vec3 pointVector = normalize( vPointLightVector[ i ] );":"",e?"vec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );":"",e?"float pointDotNormalHalf = dot( normal, pointHalfVector );":"",e?"float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );":"",e?"float pointSpecularWeight = 0.0;":"",e?"if ( pointDotNormalHalf >= 0.0 )":"",e?"pointSpecularWeight = pow( pointDotNormalHalf, mShininess );":"",e?"pointDiffuse  += mColor * pointDiffuseWeight;":"",e?"pointSpecular += mSpecular * pointSpecularWeight;":"",e?"}":"",t?"vec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",t?"vec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",t?"for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {":"",t?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",t?"vec3 dirVector = normalize( lDirection.xyz );":"",t?"vec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );":"",t?"float dirDotNormalHalf = dot( normal, dirHalfVector );":"",t?"float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );":"",t?"float dirSpecularWeight = 0.0;":"",t?"if ( dirDotNormalHalf >= 0.0 )":"",t?"dirSpecularWeight = pow( dirDotNormalHalf, mShininess );":"",t?"dirDiffuse  += mColor * dirDiffuseWeight;":"",t?"dirSpecular += mSpecular * dirSpecularWeight;":"",t?"}":"","vec4 totalLight = mAmbient;",t?"totalLight += dirDiffuse + dirSpecular;":"",e?"totalLight += pointDiffuse + pointSpecular;":"","if ( mixEnvMap ) {\ngl_FragColor = vec4( mix( mapColor.rgb * totalLight.xyz * vLightWeighting, cubeColor.rgb, mReflectivity ), mapColor.a );\n} else {\ngl_FragColor = vec4( mapColor.rgb * cubeColor.rgb * totalLight.xyz * vLightWeighting, mapColor.a );\n}\n} else if ( material == 1 ) {\nif ( mixEnvMap ) {\ngl_FragColor = vec4( mix( mColor.rgb * mapColor.rgb * vLightWeighting, cubeColor.rgb, mReflectivity ), mColor.a * mapColor.a );\n} else {\ngl_FragColor = vec4( mColor.rgb * mapColor.rgb * cubeColor.rgb * vLightWeighting, mColor.a * mapColor.a );\n}\n} else {\nif ( mixEnvMap ) {\ngl_FragColor = mix( mColor * mapColor, cubeColor, mReflectivity );\n} else {\ngl_FragColor = mColor * mapColor * cubeColor;\n}\n}\n}"].join("\n");
return n=i(a,n),h.useProgram(n),r(n,["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","enableLighting","ambientLightColor","material","mColor","mAmbient","mSpecular","mShininess","mOpacity","enableMap","tMap","enableCubeMap","tCube","mixEnvMap","mReflectivity","mRefractionRatio","useRefract","m2Near","mFarPlusNear","mFarMinusNear"]),t&&r(n,["directionalLightNumber","directionalLightColor","directionalLightDirection"]),e&&r(n,["pointLightNumber","pointLightColor","pointLightPosition"]),h.uniform1i(n.uniforms.enableMap,0),h.uniform1i(n.uniforms.tMap,0),h.uniform1i(n.uniforms.enableCubeMap,0),h.uniform1i(n.uniforms.tCube,1),h.uniform1i(n.uniforms.mixEnvMap,0),h.uniform1i(n.uniforms.useRefract,0),o(n,["position","normal","uv"]),n}(t.directional,t.point),this.setSize=function(t,i){f.width=t,f.height=i,h.viewport(0,0,f.width,f.height)},this.clear=function(){h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)},this.setupLights=function(t,i){var e,n,r,o,a,s=[],l=[],c=[];for(o=[],a=[],h.uniform1i(t.uniforms.enableLighting,i.length),e=0,n=i.length;e<n;e++)r=i[e],r instanceof THREE.AmbientLight?s.push(r):r instanceof THREE.DirectionalLight?c.push(r):r instanceof THREE.PointLight&&l.push(r);for(e=r=o=a=0,n=s.length;e<n;e++)r+=s[e].color.r,o+=s[e].color.g,a+=s[e].color.b;for(h.uniform3f(t.uniforms.ambientLightColor,r,o,a),o=[],a=[],e=0,n=c.length;e<n;e++)r=c[e],o.push(r.color.r*r.intensity),o.push(r.color.g*r.intensity),o.push(r.color.b*r.intensity),a.push(r.position.x),a.push(r.position.y),a.push(r.position.z);for(c.length&&(h.uniform1i(t.uniforms.directionalLightNumber,c.length),h.uniform3fv(t.uniforms.directionalLightDirection,a),h.uniform3fv(t.uniforms.directionalLightColor,o)),o=[],a=[],e=0,n=l.length;e<n;e++)r=l[e],o.push(r.color.r*r.intensity),o.push(r.color.g*r.intensity),o.push(r.color.b*r.intensity),a.push(r.position.x),a.push(r.position.y),a.push(r.position.z);l.length&&(h.uniform1i(t.uniforms.pointLightNumber,l.length),h.uniform3fv(t.uniforms.pointLightPosition,a),h.uniform3fv(t.uniforms.pointLightColor,o))},this.createBuffers=function(t,i){var e,n,r,o,a,s,l,c,u,f=[],E=[],m=[],p=[],d=[],v=0,g=t.geometry.geometryChunks[i];for(r=!1,e=0,n=t.material.length;e<n;e++){if(meshMaterial=t.material[e],meshMaterial instanceof THREE.MeshFaceMaterial){for(a=0,u=g.material.length;a<u;a++)if(g.material[a]&&void 0!=g.material[a].shading&&g.material[a].shading==THREE.SmoothShading){r=!0;break}}else if(meshMaterial&&void 0!=meshMaterial.shading&&meshMaterial.shading==THREE.SmoothShading){r=!0;break}if(r)break}for(u=r,e=0,n=g.faces.length;e<n;e++)if(r=g.faces[e],o=t.geometry.faces[r],a=o.vertexNormals,faceNormal=o.normal,r=t.geometry.uvs[r],o instanceof THREE.Face3){if(s=t.geometry.vertices[o.a].position,l=t.geometry.vertices[o.b].position,c=t.geometry.vertices[o.c].position,m.push(s.x,s.y,s.z),m.push(l.x,l.y,l.z),m.push(c.x,c.y,c.z),3==a.length&&u)for(o=0;o<3;o++)p.push(a[o].x,a[o].y,a[o].z);else for(o=0;o<3;o++)p.push(faceNormal.x,faceNormal.y,faceNormal.z);if(r)for(o=0;o<3;o++)d.push(r[o].u,r[o].v);f.push(v,v+1,v+2),E.push(v,v+1),E.push(v,v+2),E.push(v+1,v+2),v+=3}else if(o instanceof THREE.Face4){if(s=t.geometry.vertices[o.a].position,l=t.geometry.vertices[o.b].position,c=t.geometry.vertices[o.c].position,o=t.geometry.vertices[o.d].position,m.push(s.x,s.y,s.z),m.push(l.x,l.y,l.z),m.push(c.x,c.y,c.z),m.push(o.x,o.y,o.z),4==a.length&&u)for(o=0;o<4;o++)p.push(a[o].x,a[o].y,a[o].z);else for(o=0;o<4;o++)p.push(faceNormal.x,faceNormal.y,faceNormal.z);if(r)for(o=0;o<4;o++)d.push(r[o].u,r[o].v);f.push(v,v+1,v+2),f.push(v,v+2,v+3),E.push(v,v+1),E.push(v,v+2),E.push(v,v+3),E.push(v+1,v+2),E.push(v+2,v+3),v+=4}m.length&&(g.__webGLVertexBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,g.__webGLVertexBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(m),h.STATIC_DRAW),g.__webGLNormalBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,g.__webGLNormalBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(p),h.STATIC_DRAW),d.length>0&&(g.__webGLUVBuffer=h.createBuffer(),h.bindBuffer(h.ARRAY_BUFFER,g.__webGLUVBuffer),h.bufferData(h.ARRAY_BUFFER,new Float32Array(d),h.STATIC_DRAW)),g.__webGLFaceBuffer=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,g.__webGLFaceBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(f),h.STATIC_DRAW),g.__webGLLineBuffer=h.createBuffer(),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,g.__webGLLineBuffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,new Uint16Array(E),h.STATIC_DRAW),g.__webGLFaceCount=f.length,g.__webGLLineCount=E.length)},this.renderBuffer=function(t,a,s,u){var f,E,m,p,d,v,g,y,R;if(s instanceof THREE.MeshShaderMaterial){if(!s.program){s.program=i(s.fragment_shader,s.vertex_shader),g=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition"];for(R in s.uniforms)g.push(R);r(s.program,g),o(s.program,["position","normal","uv"])}R=s.program}else R=c;if(R!=l&&(h.useProgram(R),l=R),R==c&&this.setupLights(R,a),this.loadCamera(R,t),this.loadMatrices(R),s instanceof THREE.MeshShaderMaterial){m=s.wireframe,p=s.wireframe_linewidth,t=R,a=s.uniforms;var b;for(f in a)y=a[f].type,g=a[f].value,b=t.uniforms[f],"i"==y?h.uniform1i(b,g):"f"==y?h.uniform1f(b,g):"t"==y&&(h.uniform1i(b,g),(y=a[f].texture)&&(y.image instanceof Array&&6==y.image.length?e(y,g):n(y,g)))}(s instanceof THREE.MeshPhongMaterial||s instanceof THREE.MeshLambertMaterial||s instanceof THREE.MeshBasicMaterial)&&(f=s.color,E=s.opacity,m=s.wireframe,p=s.wireframe_linewidth,d=s.map,v=s.env_map,a=s.combine==THREE.MixOperation,t=s.reflectivity,y=s.env_map&&s.env_map.mapping instanceof THREE.CubeRefractionMapping,g=s.refraction_ratio,h.uniform4f(R.uniforms.mColor,f.r*E,f.g*E,f.b*E,E),h.uniform1i(R.uniforms.mixEnvMap,a),h.uniform1f(R.uniforms.mReflectivity,t),h.uniform1i(R.uniforms.useRefract,y),h.uniform1f(R.uniforms.mRefractionRatio,g)),s instanceof THREE.MeshNormalMaterial?(E=s.opacity,h.uniform1f(R.uniforms.mOpacity,E),h.uniform1i(R.uniforms.material,4)):s instanceof THREE.MeshDepthMaterial?(E=s.opacity,m=s.wireframe,p=s.wireframe_linewidth,h.uniform1f(R.uniforms.mOpacity,E),h.uniform1f(R.uniforms.m2Near,s.__2near),h.uniform1f(R.uniforms.mFarPlusNear,s.__farPlusNear),h.uniform1f(R.uniforms.mFarMinusNear,s.__farMinusNear),h.uniform1i(R.uniforms.material,3)):s instanceof THREE.MeshPhongMaterial?(f=s.ambient,t=s.specular,s=s.shininess,h.uniform4f(R.uniforms.mAmbient,f.r,f.g,f.b,E),h.uniform4f(R.uniforms.mSpecular,t.r,t.g,t.b,E),h.uniform1f(R.uniforms.mShininess,s),h.uniform1i(R.uniforms.material,2)):s instanceof THREE.MeshLambertMaterial?h.uniform1i(R.uniforms.material,1):s instanceof THREE.MeshBasicMaterial?h.uniform1i(R.uniforms.material,0):s instanceof THREE.MeshCubeMaterial&&(h.uniform1i(R.uniforms.material,5),v=s.env_map),d?(n(d,0),h.uniform1i(R.uniforms.tMap,0),h.uniform1i(R.uniforms.enableMap,1)):h.uniform1i(R.uniforms.enableMap,0),v?(e(v,1),h.uniform1i(R.uniforms.tCube,1),h.uniform1i(R.uniforms.enableCubeMap,1)):h.uniform1i(R.uniforms.enableCubeMap,0),E=R.attributes,h.bindBuffer(h.ARRAY_BUFFER,u.__webGLVertexBuffer),h.vertexAttribPointer(E.position,3,h.FLOAT,!1,0,0),h.bindBuffer(h.ARRAY_BUFFER,u.__webGLNormalBuffer),h.vertexAttribPointer(E.normal,3,h.FLOAT,!1,0,0),E.uv>=0&&(u.__webGLUVBuffer?(h.bindBuffer(h.ARRAY_BUFFER,u.__webGLUVBuffer),h.enableVertexAttribArray(E.uv),h.vertexAttribPointer(E.uv,2,h.FLOAT,!1,0,0)):h.disableVertexAttribArray(E.uv)),m?(h.lineWidth(p),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,u.__webGLLineBuffer),h.drawElements(h.LINES,u.__webGLLineCount,h.UNSIGNED_SHORT,0)):(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,u.__webGLFaceBuffer),h.drawElements(h.TRIANGLES,u.__webGLFaceCount,h.UNSIGNED_SHORT,0))},this.renderPass=function(t,i,e,n,r,o){var a,s,h,l,c;for(h=0,l=e.material.length;h<l;h++)if(a=e.material[h],a instanceof THREE.MeshFaceMaterial)for(a=0,s=n.material.length;a<s;a++)(c=n.material[a])&&c.blending==r&&c.opacity<1==o&&(this.setBlending(c.blending),this.renderBuffer(t,i,c,n));else(c=a)&&c.blending==r&&c.opacity<1==o&&(this.setBlending(c.blending),this.renderBuffer(t,i,c,n))},this.render=function(t,i){var e,n,r,o,a=t.lights;for(this.initWebGLObjects(t),this.autoClear&&this.clear(),i.autoUpdateMatrix&&i.updateMatrix(),e=0,n=t.__webGLObjects.length;e<n;e++)r=t.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,i),this.renderPass(i,a,o,r,THREE.NormalBlending,!1));for(e=0,n=t.__webGLObjects.length;e<n;e++)r=t.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,i),this.renderPass(i,a,o,r,THREE.AdditiveBlending,!1),this.renderPass(i,a,o,r,THREE.SubtractiveBlending,!1),this.renderPass(i,a,o,r,THREE.AdditiveBlending,!0),this.renderPass(i,a,o,r,THREE.SubtractiveBlending,!0),this.renderPass(i,a,o,r,THREE.NormalBlending,!0))},this.initWebGLObjects=function(t){var i,e,n,r,o,a;for(t.__webGLObjects||(t.__webGLObjects=[],t.__webGLObjectsMap={}),i=0,e=t.objects.length;i<e;i++)if(n=t.objects[i],void 0==t.__webGLObjectsMap[n.id]&&(t.__webGLObjectsMap[n.id]={}),a=t.__webGLObjectsMap[n.id],n instanceof THREE.Mesh)for(o in n.geometry.geometryChunks)r=n.geometry.geometryChunks[o],r.__webGLVertexBuffer||this.createBuffers(n,o),void 0==a[o]&&(r={buffer:r,object:n},t.__webGLObjects.push(r),a[o]=1)},this.removeObject=function(t,i){var e,n;for(e=t.__webGLObjects.length-1;e>=0;e--)n=t.__webGLObjects[e].object,i==n&&t.__webGLObjects.splice(e,1)},this.setupMatrices=function(t,i){t.autoUpdateMatrix&&t.updateMatrix(),E.multiply(i.matrix,t.matrix),m.set(i.matrix.flatten()),p.set(E.flatten()),d.set(i.projectionMatrix.flatten()),u=THREE.Matrix4.makeInvert3x3(E).transpose(),v.set(u.m),g.set(t.matrix.flatten())},this.loadMatrices=function(t){h.uniformMatrix4fv(t.uniforms.viewMatrix,!1,m),h.uniformMatrix4fv(t.uniforms.modelViewMatrix,!1,p),h.uniformMatrix4fv(t.uniforms.projectionMatrix,!1,d),h.uniformMatrix3fv(t.uniforms.normalMatrix,!1,v),h.uniformMatrix4fv(t.uniforms.objectMatrix,!1,g)},this.loadCamera=function(t,i){h.uniform3f(t.uniforms.cameraPosition,i.position.x,i.position.y,i.position.z)},this.setBlending=function(t){switch(t){case THREE.AdditiveBlending:h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ONE,h.ONE);break;case THREE.SubtractiveBlending:h.blendFunc(h.DST_COLOR,h.ZERO);break;default:h.blendEquation(h.FUNC_ADD),h.blendFunc(h.ONE,h.ONE_MINUS_SRC_ALPHA)}},this.setFaceCulling=function(t,i){t?(i&&"ccw"!=i?h.frontFace(h.CW):h.frontFace(h.CCW),"back"==t?h.cullFace(h.BACK):"front"==t?h.cullFace(h.FRONT):h.cullFace(h.FRONT_AND_BACK),h.enable(h.CULL_FACE)):h.disable(h.CULL_FACE)}},THREE.RenderableFace3=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.v3=new THREE.Vertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[],this.faceMaterial=this.meshMaterial=null,this.overdraw=!1,this.uvs=[null,null,null]},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.material=null};var GeometryUtils={merge:function(t,i){var e=i instanceof THREE.Mesh,n=t.vertices.length,r=e?i.geometry:i,o=t.vertices,a=r.vertices,s=t.faces,h=r.faces,l=t.uvs;r=r.uvs,e&&i.updateMatrix();for(var c=0,u=a.length;c<u;c++){var f=new THREE.Vertex(a[c].position.clone());e&&i.matrix.multiplyVector3(f.position),o.push(f)}for(c=0,u=h.length;c<u;c++){a=h[c];var E,m=a.vertexNormals;for(a instanceof THREE.Face3?E=new THREE.Face3(a.a+n,a.b+n,a.c+n):a instanceof THREE.Face4&&(E=new THREE.Face4(a.a+n,a.b+n,a.c+n,a.d+n)),E.centroid.copy(a.centroid),E.normal.copy(a.normal),e=0,o=m.length;e<o;e++)f=m[e],E.vertexNormals.push(f.clone());E.material=a.material.slice(),s.push(E)}for(c=0,u=r.length;c<u;c++){for(n=r[c],s=[],e=0,o=n.length;e<o;e++)s.push(new THREE.UV(n[e].u,n[e].v));l.push(s)}}},ImageUtils={loadTexture:function(t,i){var e=new Image;return e.onload=function(){this.loaded=!0},e.src=t,new THREE.Texture(e,i)},loadArray:function(t){var i,e,n=[];for(i=n.loadCount=0,e=t.length;i<e;++i)n[i]=new Image,n[i].loaded=0,n[i].onload=function(){n.loadCount+=1,this.loaded=!0},n[i].src=t[i];return n}},SceneUtils={addMesh:function(t,i,e,n,r,o,a,s,h,l){return i=new THREE.Mesh(i,l),i.scale.x=i.scale.y=i.scale.z=e,i.position.x=n,i.position.y=r,i.position.z=o,i.rotation.x=a,i.rotation.y=s,i.rotation.z=h,t.addObject(i),i},addPanoramaCubeWebGL:function(t,i,e){return e=new THREE.MeshCubeMaterial({env_map:e}),i=new THREE.Mesh(new Cube(i,i,i,1,1,null,!0),e),t.addObject(i),i},addPanoramaCube:function(t,i,e){var n=[];return n.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(e[0])})),n.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(e[1])})),n.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(e[2])})),n.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(e[3])})),n.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(e[4])})),n.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(e[5])})),mesh=new THREE.Mesh(new Cube(i,i,i,1,1,n,!0),new THREE.MeshFaceMaterial),t.addObject(mesh),mesh},addPanoramaCubePlanes:function(t,i,e){var n=i/2;i=new Plane(i,i);var r=Math.PI/2,o=Math.PI;SceneUtils.addMesh(t,i,1,0,0,-n,0,0,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(e[5])})),SceneUtils.addMesh(t,i,1,-n,0,0,0,r,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(e[0])})),SceneUtils.addMesh(t,i,1,n,0,0,0,-r,0,new THREE.MeshBasicMaterial({map:new THREE.Texture(e[1])})),SceneUtils.addMesh(t,i,1,0,n,0,r,0,o,new THREE.MeshBasicMaterial({map:new THREE.Texture(e[2])})),SceneUtils.addMesh(t,i,1,0,-n,0,-r,0,o,new THREE.MeshBasicMaterial({map:new THREE.Texture(e[3])}))}},ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragment_shader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertex_shader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main(void) {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"}}},Cube=function(t,i,e,n,r,o,a){function s(t,i,e,o,a,s,u,f){var E=n||1,m=r||1,p=E+1,d=m+1;a/=E,s/=m;var v,g=h.vertices.length;for("x"==t&&"y"==i||"y"==t&&"x"==i?v="z":"x"==t&&"z"==i||"z"==t&&"x"==i?v="y":("z"==t&&"y"==i||"y"==t&&"z"==i)&&(v="x"),iy=0;iy<d;iy++)for(ix=0;ix<p;ix++){var y=new THREE.Vector3;y[t]=(ix*a-l)*e,y[i]=(iy*s-c)*o,y[v]=u,h.vertices.push(new THREE.Vertex(y))}for(iy=0;iy<m;iy++)for(ix=0;ix<E;ix++)h.faces.push(new THREE.Face4(ix+p*iy+g,ix+p*(iy+1)+g,ix+1+p*(iy+1)+g,ix+1+p*iy+g,null,f)),h.uvs.push([new THREE.UV(ix/E,iy/m),new THREE.UV(ix/E,(iy+1)/m),new THREE.UV((ix+1)/E,(iy+1)/m),new THREE.UV((ix+1)/E,iy/m)])}THREE.Geometry.call(this);var h=this,l=t/2,c=i/2,u=e/2;if(a=a?-1:1,void 0!==o)if(o instanceof Array)this.materials=o;else{this.materials=[];for(var f=0;f<6;f++)this.materials.push([o])}else this.materials=[];s("z","y",1*a,-1,e,i,-l,this.materials[0]),s("z","y",-1*a,-1,e,i,l,this.materials[1]),s("x","z",1*a,1,t,e,c,this.materials[2]),s("x","z",1*a,-1,t,e,-c,this.materials[3]),s("x","y",1*a,-1,t,i,u,this.materials[4]),s("x","y",-1*a,-1,t,i,-u,this.materials[5]),function(){for(var t=[],i=[],e=0,n=h.vertices.length;e<n;e++){for(var r=h.vertices[e],o=!1,a=0,s=t.length;a<s;a++){var l=t[a];if(r.position.x==l.position.x&&r.position.y==l.position.y&&r.position.z==l.position.z){i[e]=a,o=!0;break}}o||(i[e]=t.length,t.push(new THREE.Vertex(r.position.clone())))}for(e=0,n=h.faces.length;e<n;e++)r=h.faces[e],r.a=i[r.a],r.b=i[r.b],r.c=i[r.c],r.d=i[r.d];h.vertices=t}(),this.computeCentroids(),this.computeNormals(),this.sortFacesByMaterial()};Cube.prototype=new THREE.Geometry,Cube.prototype.constructor=Cube;var Cylinder=function(t,i,e,n,r){function o(t,i,e){s.vertices.push(new THREE.Vertex(new THREE.Vector3(t,i,e)))}THREE.Geometry.call(this);var a,s=this;for(a=0;a<t;a++)o(Math.sin(6.283*a/t)*i,Math.cos(6.283*a/t)*i,0);for(a=0;a<t;a++)o(Math.sin(6.283*a/t)*e,Math.cos(6.283*a/t)*e,n);for(a=0;a<t;a++)s.faces.push(new THREE.Face4(a,a+t,t+(a+1)%t,(a+1)%t));if(0!=e)for(o(0,0,-r),a=t;a<t+t/2;a++)s.faces.push(new THREE.Face4(2*t,(2*a-2*t)%t,(2*a-2*t+1)%t,(2*a-2*t+2)%t));if(0!=i)for(o(0,0,n+r),a=t+t/2;a<2*t;a++)s.faces.push(new THREE.Face4((2*a-2*t+2)%t+t,(2*a-2*t+1)%t+t,(2*a-2*t)%t+t,2*t+1));this.computeCentroids(),this.computeNormals(),this.sortFacesByMaterial()};Cylinder.prototype=new THREE.Geometry,Cylinder.prototype.constructor=Cylinder;var Plane=function(t,i,e,n){THREE.Geometry.call(this);var r,o=t/2,a=i/2;e=e||1,n=n||1;var s=e+1,h=n+1;t/=e;var l=i/n;for(r=0;r<h;r++)for(i=0;i<s;i++)this.vertices.push(new THREE.Vertex(new THREE.Vector3(i*t-o,-(r*l-a),0)));for(r=0;r<n;r++)for(i=0;i<e;i++)this.faces.push(new THREE.Face4(i+s*r,i+s*(r+1),i+1+s*(r+1),i+1+s*r)),this.uvs.push([new THREE.UV(i/e,r/n),new THREE.UV(i/e,(r+1)/n),new THREE.UV((i+1)/e,(r+1)/n),new THREE.UV((i+1)/e,r/n)]);this.computeCentroids(),this.computeNormals(),this.sortFacesByMaterial()};Plane.prototype=new THREE.Geometry,Plane.prototype.constructor=Plane;var Sphere=function(t,i,e){THREE.Geometry.call(this);var n,r=Math.max(3,i||8),o=Math.max(2,e||6);for(i=[],e=0;e<o+1;e++){n=e/o;var a=t*Math.cos(n*Math.PI),s=t*Math.sin(n*Math.PI),h=[],l=0;for(n=0;n<r;n++){var c=2*n/r,u=s*Math.sin(c*Math.PI);c=s*Math.cos(c*Math.PI),(0==e||e==o)&&n>0||(l=this.vertices.push(new THREE.Vertex(new THREE.Vector3(c,a,u)))-1),h.push(l)}i.push(h)}var f,E,m;for(t=i.length,e=0;e<t;e++)if(r=i[e].length,e>0)for(n=0;n<r;n++){h=n==r-1,o=i[e][h?0:n+1],a=i[e][h?r-1:n],s=i[e-1][h?r-1:n],h=i[e-1][h?0:n+1],u=e/(t-1),f=(e-1)/(t-1),E=(n+1)/r,c=n/r,l=new THREE.UV(1-E,u),u=new THREE.UV(1-c,u),c=new THREE.UV(1-c,f);var p=new THREE.UV(1-E,f);e<i.length-1&&(f=this.vertices[o].position.clone(),E=this.vertices[a].position.clone(),m=this.vertices[s].position.clone(),f.normalize(),E.normalize(),m.normalize(),this.faces.push(new THREE.Face3(o,a,s,[new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(E.x,E.y,E.z),new THREE.Vector3(m.x,m.y,m.z)])),this.uvs.push([l,u,c])),e>1&&(f=this.vertices[o].position.clone(),E=this.vertices[s].position.clone(),m=this.vertices[h].position.clone(),f.normalize(),E.normalize(),m.normalize(),this.faces.push(new THREE.Face3(o,s,h,[new THREE.Vector3(f.x,f.y,f.z),new THREE.Vector3(E.x,E.y,E.z),new THREE.Vector3(m.x,m.y,m.z)])),this.uvs.push([l,c,p]))}this.computeCentroids(),this.computeNormals(),this.sortFacesByMaterial()};Sphere.prototype=new THREE.Geometry,Sphere.prototype.constructor=Sphere,THREE.Loader=function(t){this.statusDomElement=(this.showStatus=t)?this.addStatusElement():null},THREE.Loader.prototype={addStatusElement:function(){var t=document.createElement("div");return t.style.fontSize="0.8em",t.style.textAlign="left",t.style.background="#b00",t.style.color="#fff",t.style.width="140px",t.style.padding="0.25em 0.25em 0.25em 0.5em",t.style.position="absolute",t.style.right="0px",t.style.top="0px",t.style.zIndex=1e3,t.innerHTML="Loading ...",t},updateProgress:function(t){var i="Loaded ";i+=t.total?(100*t.loaded/t.total).toFixed(0)+"%":(t.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=i},loadAsciiOld:function(t,i){var e=document.createElement("script");e.type="text/javascript",e.onload=i,e.src=t,document.getElementsByTagName("head")[0].appendChild(e)},loadAscii:function(t,i,e){var n=(new Date).getTime();t=new Worker(t),t.onmessage=function(t){THREE.Loader.prototype.createModel(t.data,i,e)},t.postMessage(n)},loadBinary:function(t,i,e){var n=(new Date).getTime();t=new Worker(t);var r=this.showProgress?THREE.Loader.prototype.updateProgress:null;t.onmessage=function(t){THREE.Loader.prototype.loadAjaxBuffers(t.data.buffers,t.data.materials,i,e,r)},t.onerror=function(t){alert("worker.onerror: "+t.message+"\n"+t.data),t.preventDefault()},t.postMessage(n)},loadAjaxBuffers:function(t,i,e,n,r){var o=new XMLHttpRequest,a=n+"/"+t,s=0;o.onreadystatechange=function(){4==o.readyState?200==o.status||0==o.status?THREE.Loader.prototype.createBinModel(o.responseText,e,n,i):alert("Couldn't load ["+a+"] ["+o.status+"]"):3==o.readyState?r&&(0==s&&(s=o.getResponseHeader("Content-Length")),r({total:s,loaded:o.responseText.length})):2==o.readyState&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",a,!0),o.overrideMimeType("text/plain; charset=x-user-defined"),o.setRequestHeader("Content-Type","text/plain"),o.send(null)},createBinModel:function(t,i,e,n){var r=function(i){function e(t,i){var e=s(t,i),n=s(t,i+1),r=s(t,i+2),o=s(t,i+3),a=(o<<1&255|r>>7)-127;return e|=(127&r)<<16|n<<8,0==e&&a==-127?0:(1-2*(o>>7))*(1+e*Math.pow(2,-23))*Math.pow(2,a)}function r(t,i){var e=s(t,i),n=s(t,i+1),r=s(t,i+2);return(s(t,i+3)<<24)+(r<<16)+(n<<8)+e}function o(t,i){var e=s(t,i);return(s(t,i+1)<<8)+e}function a(t,i){var e=s(t,i);return e>127?e-256:e}function s(t,i){return 255&t.charCodeAt(i)}function h(i){var e,n,a;e=r(t,i),n=r(t,i+p),a=r(t,i+d),i=o(t,i+v),THREE.Loader.prototype.f3(V,e,n,a,i)}function l(i){var e,n,a,s,h,l;e=r(t,i),n=r(t,i+p),a=r(t,i+d),s=o(t,i+v),h=r(t,i+g),l=r(t,i+y),i=r(t,i+R),THREE.Loader.prototype.f3n(V,N,e,n,a,s,h,l,i)}function c(i){var e,n,a,s;e=r(t,i),n=r(t,i+b),a=r(t,i+x),s=r(t,i+T),i=o(t,i+_),THREE.Loader.prototype.f4(V,e,n,a,s,i)}function u(i){var e,n,a,s,h,l,c,u;e=r(t,i),n=r(t,i+b),a=r(t,i+x),s=r(t,i+T),h=o(t,i+_),l=r(t,i+w),c=r(t,i+H),u=r(t,i+M),i=r(t,i+S),THREE.Loader.prototype.f4n(V,N,e,n,a,s,h,l,c,u,i)}function f(i){var e,n;e=r(t,i),n=r(t,i+L),i=r(t,i+C),THREE.Loader.prototype.uv3(V,B[2*e],B[2*e+1],B[2*n],B[2*n+1],B[2*i],B[2*i+1])}function E(i){var e,n,o;e=r(t,i),n=r(t,i+z),o=r(t,i+P),i=r(t,i+A),THREE.Loader.prototype.uv4(V,B[2*e],B[2*e+1],B[2*n],B[2*n+1],B[2*o],B[2*o+1],B[2*i],B[2*i+1])}var m,p,d,v,g,y,R,b,x,T,_,w,H,M,S,L,C,z,P,A,V=this,F=0,N=[],B=[];THREE.Geometry.call(this),THREE.Loader.prototype.init_materials(V,n,i),m={signature:t.substr(F,8),header_bytes:s(t,F+8),vertex_coordinate_bytes:s(t,F+9),normal_coordinate_bytes:s(t,F+10),uv_coordinate_bytes:s(t,F+11),vertex_index_bytes:s(t,F+12),normal_index_bytes:s(t,F+13),uv_index_bytes:s(t,F+14),material_index_bytes:s(t,F+15),nvertices:r(t,F+16),nnormals:r(t,F+16+4),nuvs:r(t,F+16+8),ntri_flat:r(t,F+16+12),ntri_smooth:r(t,F+16+16),ntri_flat_uv:r(t,F+16+20),ntri_smooth_uv:r(t,F+16+24),nquad_flat:r(t,F+16+28),nquad_smooth:r(t,F+16+32),nquad_flat_uv:r(t,F+16+36),nquad_smooth_uv:r(t,F+16+40)},F+=m.header_bytes,p=m.vertex_index_bytes,d=2*m.vertex_index_bytes,v=3*m.vertex_index_bytes,g=3*m.vertex_index_bytes+m.material_index_bytes,y=3*m.vertex_index_bytes+m.material_index_bytes+m.normal_index_bytes,R=3*m.vertex_index_bytes+m.material_index_bytes+2*m.normal_index_bytes,b=m.vertex_index_bytes,x=2*m.vertex_index_bytes,T=3*m.vertex_index_bytes,_=4*m.vertex_index_bytes,w=4*m.vertex_index_bytes+m.material_index_bytes,H=4*m.vertex_index_bytes+m.material_index_bytes+m.normal_index_bytes,M=4*m.vertex_index_bytes+m.material_index_bytes+2*m.normal_index_bytes,S=4*m.vertex_index_bytes+m.material_index_bytes+3*m.normal_index_bytes,L=m.uv_index_bytes,C=2*m.uv_index_bytes,z=m.uv_index_bytes,P=2*m.uv_index_bytes,A=3*m.uv_index_bytes,F+=function(i){var n,r,o,a=3*m.vertex_coordinate_bytes,s=i+m.nvertices*a;for(i=i;i<s;i+=a)n=e(t,i),r=e(t,i+m.vertex_coordinate_bytes),o=e(t,i+2*m.vertex_coordinate_bytes),THREE.Loader.prototype.v(V,n,r,o);return m.nvertices*a}(F),F+=function(i){var e,n,r,o=3*m.normal_coordinate_bytes,s=i+m.nnormals*o;for(i=i;i<s;i+=o)e=a(t,i),n=a(t,i+m.normal_coordinate_bytes),r=a(t,i+2*m.normal_coordinate_bytes),N.push(e/127,n/127,r/127);return m.nnormals*o}(F),F+=function(i){var n,r,o=2*m.uv_coordinate_bytes,a=i+m.nuvs*o;for(i=i;i<a;i+=o)n=e(t,i),r=e(t,i+m.uv_coordinate_bytes),B.push(n,r);return m.nuvs*o}(F),F+=function(t){var i,e=3*m.vertex_index_bytes+m.material_index_bytes,n=t+m.ntri_flat*e;for(i=t;i<n;i+=e)h(i);return n-t}(F),F+=function(t){var i,e=3*m.vertex_index_bytes+m.material_index_bytes+3*m.normal_index_bytes,n=t+m.ntri_smooth*e;for(i=t;i<n;i+=e)l(i);return n-t}(F),F+=function(t){var i,e=3*m.vertex_index_bytes+m.material_index_bytes,n=e+3*m.uv_index_bytes,r=t+m.ntri_flat_uv*n;for(i=t;i<r;i+=n)h(i),f(i+e);return r-t}(F),F+=function(t){var i,e=3*m.vertex_index_bytes+m.material_index_bytes+3*m.normal_index_bytes,n=e+3*m.uv_index_bytes,r=t+m.ntri_smooth_uv*n;for(i=t;i<r;i+=n)l(i),f(i+e);return r-t}(F),F+=function(t){var i,e=4*m.vertex_index_bytes+m.material_index_bytes,n=t+m.nquad_flat*e;for(i=t;i<n;i+=e)c(i);return n-t}(F),F+=function(t){var i,e=4*m.vertex_index_bytes+m.material_index_bytes+4*m.normal_index_bytes,n=t+m.nquad_smooth*e;for(i=t;i<n;i+=e)u(i);return n-t}(F),F+=function(t){var i,e=4*m.vertex_index_bytes+m.material_index_bytes,n=e+4*m.uv_index_bytes,r=t+m.nquad_flat_uv*n;for(i=t;i<r;i+=n)c(i),E(i+e);return r-t}(F),F+=function(t){var i,e=4*m.vertex_index_bytes+m.material_index_bytes+4*m.normal_index_bytes,n=e+4*m.uv_index_bytes,r=t+m.nquad_smooth_uv*n;for(i=t;i<r;i+=n)u(i),E(i+e);return r-t}(F),this.computeCentroids(),this.computeNormals(),this.sortFacesByMaterial()};r.prototype=new THREE.Geometry,r.prototype.constructor=r,i(new r(e))},createModel:function(t,i,e){var n=function(i){var e=this;THREE.Geometry.call(this),THREE.Loader.prototype.init_materials(e,t.materials,i),function(){var i,n,r,o,a;for(i=0,n=t.vertices.length;i<n;i+=3)r=t.vertices[i],o=t.vertices[i+1],a=t.vertices[i+2],THREE.Loader.prototype.v(e,r,o,a)}(),function(){function i(t,i){THREE.Loader.prototype.f3(e,t[i],t[i+1],t[i+2],t[i+3])}function n(i,n){THREE.Loader.prototype.f3n(e,t.normals,i[n],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6])}function r(t,i){THREE.Loader.prototype.f4(e,t[i],t[i+1],t[i+2],t[i+3],t[i+4])}function o(i,n){THREE.Loader.prototype.f4n(e,t.normals,i[n],i[n+1],i[n+2],i[n+3],i[n+4],i[n+5],i[n+6],i[n+7],i[n+8])}function a(i,n){var r,o,a;r=i[n],o=i[n+1],a=i[n+2],THREE.Loader.prototype.uv3(e,t.uvs[2*r],t.uvs[2*r+1],t.uvs[2*o],t.uvs[2*o+1],t.uvs[2*a],t.uvs[2*a+1])}function s(i,n){var r,o,a,s;r=i[n],o=i[n+1],a=i[n+2],s=i[n+3],THREE.Loader.prototype.uv4(e,t.uvs[2*r],t.uvs[2*r+1],t.uvs[2*o],t.uvs[2*o+1],t.uvs[2*a],t.uvs[2*a+1],t.uvs[2*s],t.uvs[2*s+1])}var h,l;for(h=0,l=t.triangles.length;h<l;h+=4)i(t.triangles,h);for(h=0,l=t.triangles_uv.length;h<l;h+=7)i(t.triangles_uv,h),a(t.triangles_uv,h+4);for(h=0,l=t.triangles_n.length;h<l;h+=7)n(t.triangles_n,h);for(h=0,l=t.triangles_n_uv.length;h<l;h+=10)n(t.triangles_n_uv,h),a(t.triangles_n_uv,h+7);for(h=0,l=t.quads.length;h<l;h+=5)r(t.quads,h);for(h=0,l=t.quads_uv.length;h<l;h+=9)r(t.quads_uv,h),s(t.quads_uv,h+5);for(h=0,l=t.quads_n.length;h<l;h+=9)o(t.quads_n,h);for(h=0,l=t.quads_n_uv.length;h<l;h+=13)o(t.quads_n_uv,h),s(t.quads_n_uv,h+9)}(),this.computeCentroids(),this.computeNormals(),this.sortFacesByMaterial()};n.prototype=new THREE.Geometry,n.prototype.constructor=n,i(new n(e))},v:function(t,i,e,n){t.vertices.push(new THREE.Vertex(new THREE.Vector3(i,e,n)))},f3:function(t,i,e,n,r){t.faces.push(new THREE.Face3(i,e,n,null,t.materials[r]))},f4:function(t,i,e,n,r,o){t.faces.push(new THREE.Face4(i,e,n,r,null,t.materials[o]))},f3n:function(t,i,e,n,r,o,a,s,h){o=t.materials[o];var l=i[3*s],c=i[3*s+1];s=i[3*s+2];var u=i[3*h],f=i[3*h+1];h=i[3*h+2],t.faces.push(new THREE.Face3(e,n,r,[new THREE.Vector3(i[3*a],i[3*a+1],i[3*a+2]),new THREE.Vector3(l,c,s),new THREE.Vector3(u,f,h)],o))},f4n:function(t,i,e,n,r,o,a,s,h,l,c){a=t.materials[a];var u=i[3*h],f=i[3*h+1];h=i[3*h+2];var E=i[3*l],m=i[3*l+1];l=i[3*l+2];var p=i[3*c],d=i[3*c+1];c=i[3*c+2],t.faces.push(new THREE.Face4(e,n,r,o,[new THREE.Vector3(i[3*s],i[3*s+1],i[3*s+2]),new THREE.Vector3(u,f,h),new THREE.Vector3(E,m,l),new THREE.Vector3(p,d,c)],a))},uv3:function(t,i,e,n,r,o,a){var s=[];s.push(new THREE.UV(i,e)),s.push(new THREE.UV(n,r)),s.push(new THREE.UV(o,a)),t.uvs.push(s)},uv4:function(t,i,e,n,r,o,a,s,h){var l=[];l.push(new THREE.UV(i,e)),l.push(new THREE.UV(n,r)),l.push(new THREE.UV(o,a)),l.push(new THREE.UV(s,h)),t.uvs.push(l)},init_materials:function(t,i,e){t.materials=[];for(var n=0;n<i.length;++n)t.materials[n]=[THREE.Loader.prototype.createMaterial(i[n],e)]},createMaterial:function(t,i){function e(t){return t=Math.log(t)/Math.LN2,Math.floor(t)==t}var n,r;return t.map_diffuse&&i?(r=document.createElement("canvas"),n=new THREE.MeshLambertMaterial({map:new THREE.Texture(r)}),r=new Image,r.onload=function(){if(e(this.width)&&e(this.height))n.map.image=this;else{var t=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),i=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));n.map.image.width=t,n.map.image.height=i,n.map.image.getContext("2d").drawImage(this,0,0,t,i)}n.map.image.loaded=1},r.src=i+"/"+t.map_diffuse):t.col_diffuse?(r=(255*t.col_diffuse[0]<<16)+(255*t.col_diffuse[1]<<8)+255*t.col_diffuse[2],n=new THREE.MeshLambertMaterial({color:r,opacity:t.transparency})):n=t.a_dbg_color?new THREE.MeshLambertMaterial({color:t.a_dbg_color}):new THREE.MeshLambertMaterial({color:15658734}),n}};