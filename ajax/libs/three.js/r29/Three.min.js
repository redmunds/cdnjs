var THREE=THREE||{};THREE.Color=function(t){this.autoUpdate=!0,this.setHex(t)},THREE.Color.prototype={setRGB:function(t,i,n){this.r=t,this.g=i,this.b=n,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(t){this.hex=16777215&~~t,this.autoUpdate&&(this.updateRGBA(),this.updateStyleString())},updateHex:function(){this.hex=~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},updateRGBA:function(){this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgb("+~~(255*this.r)+","+~~(255*this.g)+","+~~(255*this.b)+")"},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}},THREE.Vector2=function(t,i){this.x=t||0,this.y=i||0},THREE.Vector2.prototype={set:function(t,i){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},THREE.Vector3=function(t,i,n){this.x=t||0,this.y=i||0,this.z=n||0},THREE.Vector3.prototype={set:function(t,i,n){return this.x=t,this.y=i,this.z=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},cross:function(t,i){return this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x,this},crossSelf:function(t){var i=this.x,n=this.y,e=this.z;return this.x=n*t.z-e*t.y,this.y=e*t.x-i*t.z,this.z=i*t.y-n*t.x,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var i=this.x-t.x,n=this.y-t.y;return t=this.z-t.z,i*i+n*n+t*t},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.length()>0?this.multiplyScalar(1/this.length()):this.multiplyScalar(0),this},setLength:function(t){return this.normalize().multiplyScalar(t)},isZero:function(){return Math.abs(this.x)<1e-4&&Math.abs(this.y)<1e-4&&Math.abs(this.z)<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},THREE.Vector4=function(t,i,n,e){this.x=t||0,this.y=i||0,this.z=n||0,this.w=e||1},THREE.Vector4.prototype={set:function(t,i,n,e){return this.x=t,this.y=i,this.z=n,this.w=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w||1,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},lerpSelf:function(t,i){this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},THREE.Ray=function(t,i){this.origin=t||new THREE.Vector3,this.direction=i||new THREE.Vector3},THREE.Ray.prototype={intersectScene:function(t){var i,n,e=t.objects,r=[];for(t=0,i=e.length;t<i;t++)n=e[t],n instanceof THREE.Mesh&&(r=r.concat(this.intersectObject(n)));return r.sort(function(t,i){return t.distance-i.distance}),r},intersectObject:function(t){function i(t,i,n,e){e=e.clone().subSelf(i),n=n.clone().subSelf(i);var r=t.clone().subSelf(i);t=e.dot(e),i=e.dot(n),e=e.dot(r);var o=n.dot(n);return n=n.dot(r),r=1/(t*o-i*i),o=(o*e-i*n)*r,t=(t*n-i*e)*r,o>0&&t>0&&o+t<1}var n,e,r,o,s,a,h,c,l,u,f,E=t.geometry,p=E.vertices,m=[];for(n=0,e=E.faces.length;n<e;n++)r=E.faces[n],u=this.origin.clone(),f=this.direction.clone(),o=t.matrix.transform(p[r.a].position.clone()),s=t.matrix.transform(p[r.b].position.clone()),a=t.matrix.transform(p[r.c].position.clone()),h=r instanceof THREE.Face4?t.matrix.transform(p[r.d].position.clone()):null,c=t.matrixRotation.transform(r.normal.clone()),l=f.dot(c),l<0&&(c=c.dot((new THREE.Vector3).sub(o,u))/l,u=u.addSelf(f.multiplyScalar(c)),r instanceof THREE.Face3?i(u,o,s,a)&&(r={distance:this.origin.distanceTo(u),point:u,face:r,object:t},m.push(r)):r instanceof THREE.Face4&&(i(u,o,s,h)||i(u,s,a,h))&&(r={distance:this.origin.distanceTo(u),point:u,face:r,object:t},m.push(r)));return m}},THREE.Rectangle=function(){function t(){o=e-i,s=r-n}var i,n,e,r,o,s,a=!0;this.getX=function(){return i},this.getY=function(){return n},this.getWidth=function(){return o},this.getHeight=function(){return s},this.getLeft=function(){return i},this.getTop=function(){return n},this.getRight=function(){return e},this.getBottom=function(){return r},this.set=function(o,s,h,c){a=!1,i=o,n=s,e=h,r=c,t()},this.addPoint=function(o,s){a?(a=!1,i=o,n=s,e=o,r=s):(i=Math.min(i,o),n=Math.min(n,s),e=Math.max(e,o),r=Math.max(r,s)),t()},this.addRectangle=function(o){a?(a=!1,i=o.getLeft(),n=o.getTop(),e=o.getRight(),r=o.getBottom()):(i=Math.min(i,o.getLeft()),n=Math.min(n,o.getTop()),e=Math.max(e,o.getRight()),r=Math.max(r,o.getBottom())),t()},this.inflate=function(o){i-=o,n-=o,e+=o,r+=o,t()},this.minSelf=function(o){i=Math.max(i,o.getLeft()),n=Math.max(n,o.getTop()),e=Math.min(e,o.getRight()),r=Math.min(r,o.getBottom()),t()},this.instersects=function(t){return Math.min(e,t.getRight())-Math.max(i,t.getLeft())>=0&&Math.min(r,t.getBottom())-Math.max(n,t.getTop())>=0},this.empty=function(){a=!0,r=e=n=i=0,t()},this.isEmpty=function(){return a},this.toString=function(){return"THREE.Rectangle ( left: "+i+", right: "+e+", top: "+n+", bottom: "+r+", width: "+o+", height: "+s+" )"}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={transpose:function(){var t;return t=this.m[1],this.m[1]=this.m[3],this.m[3]=t,t=this.m[2],this.m[2]=this.m[6],this.m[6]=t,t=this.m[5],this.m[5]=this.m[7],this.m[7]=t,this}},THREE.Matrix4=function(){this._x=new THREE.Vector3,this._y=new THREE.Vector3,this._z=new THREE.Vector3},THREE.Matrix4.prototype={n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,identity:function(){this.n11=1,this.n21=this.n14=this.n13=this.n12=0,this.n22=1,this.n32=this.n31=this.n24=this.n23=0,this.n33=1,this.n43=this.n42=this.n41=this.n34=0,this.n44=1},copy:function(t){this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this.n41=t.n41,this.n42=t.n42,this.n43=t.n43,this.n44=t.n44},lookAt:function(t,i,n){var e=this._x,r=this._y,o=this._z;o.sub(t,i),o.normalize(),e.cross(n,o),e.normalize(),r.cross(o,e),r.normalize(),this.n11=e.x,this.n12=e.y,this.n13=e.z,this.n14=-e.dot(t),this.n21=r.x,this.n22=r.y,this.n23=r.z,this.n24=-r.dot(t),this.n31=o.x,this.n32=o.y,this.n33=o.z,this.n34=-o.dot(t),this.n43=this.n42=this.n41=0,this.n44=1},transform:function(t){var i=t.x,n=t.y,e=t.z,r=t.w?t.w:1;return t.x=this.n11*i+this.n12*n+this.n13*e+this.n14*r,t.y=this.n21*i+this.n22*n+this.n23*e+this.n24*r,t.z=this.n31*i+this.n32*n+this.n33*e+this.n34*r,r=this.n41*i+this.n42*n+this.n43*e+this.n44*r,t.w?t.w=r:(t.x/=r,t.y/=r,t.z/=r),t},crossVector:function(t){var i=new THREE.Vector4;return i.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,i.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,i.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,i.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,i},multiply:function(t,i){this.n11=t.n11*i.n11+t.n12*i.n21+t.n13*i.n31+t.n14*i.n41,this.n12=t.n11*i.n12+t.n12*i.n22+t.n13*i.n32+t.n14*i.n42,this.n13=t.n11*i.n13+t.n12*i.n23+t.n13*i.n33+t.n14*i.n43,this.n14=t.n11*i.n14+t.n12*i.n24+t.n13*i.n34+t.n14*i.n44,this.n21=t.n21*i.n11+t.n22*i.n21+t.n23*i.n31+t.n24*i.n41,this.n22=t.n21*i.n12+t.n22*i.n22+t.n23*i.n32+t.n24*i.n42,this.n23=t.n21*i.n13+t.n22*i.n23+t.n23*i.n33+t.n24*i.n43,this.n24=t.n21*i.n14+t.n22*i.n24+t.n23*i.n34+t.n24*i.n44,this.n31=t.n31*i.n11+t.n32*i.n21+t.n33*i.n31+t.n34*i.n41,this.n32=t.n31*i.n12+t.n32*i.n22+t.n33*i.n32+t.n34*i.n42,this.n33=t.n31*i.n13+t.n32*i.n23+t.n33*i.n33+t.n34*i.n43,this.n34=t.n31*i.n14+t.n32*i.n24+t.n33*i.n34+t.n34*i.n44,this.n41=t.n41*i.n11+t.n42*i.n21+t.n43*i.n31+t.n44*i.n41,this.n42=t.n41*i.n12+t.n42*i.n22+t.n43*i.n32+t.n44*i.n42,this.n43=t.n41*i.n13+t.n42*i.n23+t.n43*i.n33+t.n44*i.n43,this.n44=t.n41*i.n14+t.n42*i.n24+t.n43*i.n34+t.n44*i.n44},multiplySelf:function(t){var i=this.n11,n=this.n12,e=this.n13,r=this.n14,o=this.n21,s=this.n22,a=this.n23,h=this.n24,c=this.n31,l=this.n32,u=this.n33,f=this.n34,E=this.n41,p=this.n42,m=this.n43,g=this.n44;this.n11=i*t.n11+n*t.n21+e*t.n31+r*t.n41,this.n12=i*t.n12+n*t.n22+e*t.n32+r*t.n42,this.n13=i*t.n13+n*t.n23+e*t.n33+r*t.n43,this.n14=i*t.n14+n*t.n24+e*t.n34+r*t.n44,this.n21=o*t.n11+s*t.n21+a*t.n31+h*t.n41,this.n22=o*t.n12+s*t.n22+a*t.n32+h*t.n42,this.n23=o*t.n13+s*t.n23+a*t.n33+h*t.n43,this.n24=o*t.n14+s*t.n24+a*t.n34+h*t.n44,this.n31=c*t.n11+l*t.n21+u*t.n31+f*t.n41,this.n32=c*t.n12+l*t.n22+u*t.n32+f*t.n42,this.n33=c*t.n13+l*t.n23+u*t.n33+f*t.n43,this.n34=c*t.n14+l*t.n24+u*t.n34+f*t.n44,this.n41=E*t.n11+p*t.n21+m*t.n31+g*t.n41,this.n42=E*t.n12+p*t.n22+m*t.n32+g*t.n42,this.n43=E*t.n13+p*t.n23+m*t.n33+g*t.n43,this.n44=E*t.n14+p*t.n24+m*t.n34+g*t.n44},multiplyScalar:function(t){this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function t(t,i,n){var e=t[i];t[i]=t[n],t[n]=e}return t(this,"n21","n12"),t(this,"n31","n13"),t(this,"n32","n23"),t(this,"n41","n14"),t(this,"n42","n24"),t(this,"n43","n34"),this},clone:function(){var t=new THREE.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},THREE.Matrix4.translationMatrix=function(t,i,n){var e=new THREE.Matrix4;return e.n14=t,e.n24=i,e.n34=n,e},THREE.Matrix4.scaleMatrix=function(t,i,n){var e=new THREE.Matrix4;return e.n11=t,e.n22=i,e.n33=n,e},THREE.Matrix4.rotationXMatrix=function(t){var i=new THREE.Matrix4;return i.n22=i.n33=Math.cos(t),i.n32=Math.sin(t),i.n23=-i.n32,i},THREE.Matrix4.rotationYMatrix=function(t){var i=new THREE.Matrix4;return i.n11=i.n33=Math.cos(t),i.n13=Math.sin(t),i.n31=-i.n13,i},THREE.Matrix4.rotationZMatrix=function(t){var i=new THREE.Matrix4;return i.n11=i.n22=Math.cos(t),i.n21=Math.sin(t),i.n12=-i.n21,i},THREE.Matrix4.rotationAxisAngleMatrix=function(t,i){var n=new THREE.Matrix4,e=Math.cos(i),r=Math.sin(i),o=1-e,s=t.x,a=t.y,h=t.z;return n.n11=o*s*s+e,n.n12=o*s*a-r*h,n.n13=o*s*h+r*a,n.n21=o*s*a+r*h,n.n22=o*a*a+e,n.n23=o*a*h-r*s,n.n31=o*s*h-r*a,n.n32=o*a*h+r*s,n.n33=o*h*h+e,n},THREE.Matrix4.makeInvert=function(t){var i=new THREE.Matrix4;return i.n11=t.n23*t.n34*t.n42-t.n24*t.n33*t.n42+t.n24*t.n32*t.n43-t.n22*t.n34*t.n43-t.n23*t.n32*t.n44+t.n22*t.n33*t.n44,i.n12=t.n14*t.n33*t.n42-t.n13*t.n34*t.n42-t.n14*t.n32*t.n43+t.n12*t.n34*t.n43+t.n13*t.n32*t.n44-t.n12*t.n33*t.n44,i.n13=t.n13*t.n24*t.n42-t.n14*t.n23*t.n42+t.n14*t.n22*t.n43-t.n12*t.n24*t.n43-t.n13*t.n22*t.n44+t.n12*t.n23*t.n44,i.n14=t.n14*t.n23*t.n32-t.n13*t.n24*t.n32-t.n14*t.n22*t.n33+t.n12*t.n24*t.n33+t.n13*t.n22*t.n34-t.n12*t.n23*t.n34,i.n21=t.n24*t.n33*t.n41-t.n23*t.n34*t.n41-t.n24*t.n31*t.n43+t.n21*t.n34*t.n43+t.n23*t.n31*t.n44-t.n21*t.n33*t.n44,i.n22=t.n13*t.n34*t.n41-t.n14*t.n33*t.n41+t.n14*t.n31*t.n43-t.n11*t.n34*t.n43-t.n13*t.n31*t.n44+t.n11*t.n33*t.n44,i.n23=t.n14*t.n23*t.n41-t.n13*t.n24*t.n41-t.n14*t.n21*t.n43+t.n11*t.n24*t.n43+t.n13*t.n21*t.n44-t.n11*t.n23*t.n44,i.n24=t.n13*t.n24*t.n31-t.n14*t.n23*t.n31+t.n14*t.n21*t.n33-t.n11*t.n24*t.n33-t.n13*t.n21*t.n34+t.n11*t.n23*t.n34,i.n31=t.n22*t.n34*t.n41-t.n24*t.n32*t.n41+t.n24*t.n31*t.n42-t.n21*t.n34*t.n42-t.n22*t.n31*t.n44+t.n21*t.n32*t.n44,i.n32=t.n14*t.n32*t.n41-t.n12*t.n34*t.n41-t.n14*t.n31*t.n42+t.n11*t.n34*t.n42+t.n12*t.n31*t.n44-t.n11*t.n32*t.n44,i.n33=t.n13*t.n24*t.n41-t.n14*t.n22*t.n41+t.n14*t.n21*t.n42-t.n11*t.n24*t.n42-t.n12*t.n21*t.n44+t.n11*t.n22*t.n44,i.n34=t.n14*t.n22*t.n31-t.n12*t.n24*t.n31-t.n14*t.n21*t.n32+t.n11*t.n24*t.n32+t.n12*t.n21*t.n34-t.n11*t.n22*t.n34,i.n41=t.n23*t.n32*t.n41-t.n22*t.n33*t.n41-t.n23*t.n31*t.n42+t.n21*t.n33*t.n42+t.n22*t.n31*t.n43-t.n21*t.n32*t.n43,i.n42=t.n12*t.n33*t.n41-t.n13*t.n32*t.n41+t.n13*t.n31*t.n42-t.n11*t.n33*t.n42-t.n12*t.n31*t.n43+t.n11*t.n32*t.n43,i.n43=t.n13*t.n22*t.n41-t.n12*t.n23*t.n41-t.n13*t.n21*t.n42+t.n11*t.n23*t.n42+t.n12*t.n21*t.n43-t.n11*t.n22*t.n43,i.n44=t.n12*t.n23*t.n31-t.n13*t.n22*t.n31+t.n13*t.n21*t.n32-t.n11*t.n23*t.n32-t.n12*t.n21*t.n33+t.n11*t.n22*t.n33,i.multiplyScalar(1/t.determinant()),i},THREE.Matrix4.makeInvert3x3=function(t){var i=t.flatten();t=new THREE.Matrix3;var n=i[10]*i[5]-i[6]*i[9],e=-i[10]*i[1]+i[2]*i[9],r=i[6]*i[1]-i[2]*i[5],o=-i[10]*i[4]+i[6]*i[8],s=i[10]*i[0]-i[2]*i[8],a=-i[6]*i[0]+i[2]*i[4],h=i[9]*i[4]-i[5]*i[8],c=-i[9]*i[0]+i[1]*i[8],l=i[5]*i[0]-i[1]*i[4];if(i=i[0]*n+i[1]*o+i[2]*h,0==i)throw"matrix not invertible";return i=1/i,t.m[0]=i*n,t.m[1]=i*e,t.m[2]=i*r,t.m[3]=i*o,t.m[4]=i*s,t.m[5]=i*a,t.m[6]=i*h,t.m[7]=i*c,t.m[8]=i*l,t},THREE.Matrix4.makeFrustum=function(t,i,n,e,r,o){var s,a,h;return s=new THREE.Matrix4,a=2*r/(i-t),h=2*r/(e-n),t=(i+t)/(i-t),n=(e+n)/(e-n),e=-(o+r)/(o-r),r=-2*o*r/(o-r),s.n11=a,s.n12=0,s.n13=t,s.n14=0,s.n21=0,s.n22=h,s.n23=n,s.n24=0,s.n31=0,s.n32=0,s.n33=e,s.n34=r,s.n41=0,s.n42=0,s.n43=-1,s.n44=0,s},THREE.Matrix4.makePerspective=function(t,i,n,e){var r;return t=n*Math.tan(t*Math.PI/360),r=-t,THREE.Matrix4.makeFrustum(r*i,t*i,r,t,n,e)},THREE.Matrix4.makeOrtho=function(t,i,n,e,r,o){var s,a,h,c;return s=new THREE.Matrix4,a=i-t,h=n-e,c=o-r,t=(i+t)/a,n=(n+e)/h,r=(o+r)/c,s.n11=2/a,s.n12=0,s.n13=0,s.n14=-t,s.n21=0,s.n22=2/h,s.n23=0,s.n24=-n,s.n31=0,s.n32=0,s.n33=-2/c,s.n34=-r,s.n41=0,s.n42=0,s.n43=0,s.n44=1,s},THREE.Vertex=function(t,i){this.position=t||new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.normal=i||new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.normalScreen=new THREE.Vector3,this.__visible=!0},THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},THREE.Face3=function(t,i,n,e,r){this.a=t,this.b=i,this.c=n,this.centroid=new THREE.Vector3,this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3,this.vertexNormals=e instanceof Array?e:[],this.material=r instanceof Array?r:[r]},THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},THREE.Face4=function(t,i,n,e,r,o){this.a=t,this.b=i,this.c=n,this.d=e,this.centroid=new THREE.Vector3,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.material=o instanceof Array?o:[o]},THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},THREE.UV=function(t,i){this.u=t||0,this.v=i||0},THREE.UV.prototype={copy:function(t){this.u=t.u,this.v=t.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},THREE.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[]},THREE.Geometry.prototype={computeCentroids:function(){var t,i,n;for(t=0,i=this.faces.length;t<i;t++)n=this.faces[t],n.centroid.set(0,0,0),n instanceof THREE.Face3?(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.divideScalar(3)):n instanceof THREE.Face4&&(n.centroid.addSelf(this.vertices[n.a].position),n.centroid.addSelf(this.vertices[n.b].position),n.centroid.addSelf(this.vertices[n.c].position),n.centroid.addSelf(this.vertices[n.d].position),n.centroid.divideScalar(4))},computeNormals:function(t){var i,n,e,r,o,s,a=new THREE.Vector3,h=new THREE.Vector3;for(e=0,r=this.vertices.length;e<r;e++)o=this.vertices[e],o.normal.set(0,0,0);for(e=0,r=this.faces.length;e<r;e++){if(o=this.faces[e],t&&o.vertexNormals.length){for(a.set(0,0,0),i=0,n=o.normal.length;i<n;i++)a.addSelf(o.vertexNormals[i]);a.divideScalar(3)}else i=this.vertices[o.a],n=this.vertices[o.b],s=this.vertices[o.c],a.sub(s.position,n.position),h.sub(i.position,n.position),a.crossSelf(h);a.isZero()||a.normalize(),o.normal.copy(a)}},computeBoundingBox:function(){if(this.vertices.length>0){this.bbox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,i=this.vertices.length;t<i;t++)vertex=this.vertices[t],vertex.position.x<this.bbox.x[0]?this.bbox.x[0]=vertex.position.x:vertex.position.x>this.bbox.x[1]&&(this.bbox.x[1]=vertex.position.x),vertex.position.y<this.bbox.y[0]?this.bbox.y[0]=vertex.position.y:vertex.position.y>this.bbox.y[1]&&(this.bbox.y[1]=vertex.position.y),vertex.position.z<this.bbox.z[0]?this.bbox.z[0]=vertex.position.z:vertex.position.z>this.bbox.z[1]&&(this.bbox.z[1]=vertex.position.z)}},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+" )"}},THREE.Camera=function(t,i,n,e){this.position=new THREE.Vector3(0,0,0),this.target={position:new THREE.Vector3(0,0,0)},this.up=new THREE.Vector3(0,1,0),this.matrix=new THREE.Matrix4,this.projectionMatrix=THREE.Matrix4.makePerspective(t,i,n,e),this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.toString=function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},THREE.Light=function(t){this.color=new THREE.Color(-16777216|t)},THREE.AmbientLight=function(t){THREE.Light.call(this,t)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(t,i){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,1,0),this.intensity=i||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(t,i){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,0,0),this.intensity=i||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.PointLight,THREE.Object3D=function(){this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.matrix=new THREE.Matrix4,this.matrixTranslation=new THREE.Matrix4,this.matrixRotation=new THREE.Matrix4,this.matrixScale=new THREE.Matrix4,this.screen=new THREE.Vector3,this.autoUpdateMatrix=!0,this.updateMatrix=function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z),this.matrixRotation=THREE.Matrix4.rotationXMatrix(this.rotation.x),this.matrixRotation.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y)),this.matrixRotation.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z)),this.matrixScale=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z),this.matrix.copy(this.matrixPosition),this.matrix.multiplySelf(this.matrixRotation),this.matrix.multiplySelf(this.matrixScale)}},THREE.Particle=function(t){THREE.Object3D.call(this),this.material=t instanceof Array?t:[t],this.autoUpdateMatrix=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(t,i){THREE.Object3D.call(this),this.geometry=t,this.material=i instanceof Array?i:[i]},THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(t,i,n){THREE.Object3D.call(this),this.geometry=t,this.material=i instanceof Array?i:[i],this.overdraw=this.doubleSided=this.flipSided=!1,this.materialFaceGroup={},this.sortFacesByMaterial(),n&&this.normalizeUVs(),this.geometry.computeBoundingBox()},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.sortFacesByMaterial=function(){function t(t){var e=[];for(i=0,n=t.length;i<n;i++)void 0==t[i]?e.push("undefined"):e.push(t[i].toString());return e.join("_")}var i,n,e,r,o,s,a,h,c={};for(e=0,r=this.geometry.faces.length;e<r;e++)o=this.geometry.faces[e],s=o.material,a=t(s),void 0==c[a]&&(c[a]={hash:a,counter:0}),h=c[a].hash+"_"+c[a].counter,void 0==this.materialFaceGroup[h]&&(this.materialFaceGroup[h]={faces:[],material:s,vertices:0}),o=o instanceof THREE.Face3?3:4,this.materialFaceGroup[h].vertices+o>65535&&(c[a].counter+=1,h=c[a].hash+"_"+c[a].counter,void 0==this.materialFaceGroup[h]&&(this.materialFaceGroup[h]={faces:[],material:s,vertices:0})),this.materialFaceGroup[h].faces.push(e),this.materialFaceGroup[h].vertices+=o},THREE.Mesh.prototype.normalizeUVs=function(){var t,i,n,e,r;for(t=0,i=this.geometry.uvs.length;t<i;t++)for(r=this.geometry.uvs[t],n=0,e=r.length;n<e;n++)1!=r[n].u&&(r[n].u-=Math.floor(r[n].u)),1!=r[n].v&&(r[n].v-=Math.floor(r[n].v))},THREE.FlatShading=0,THREE.SmoothShading=1,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.LineBasicMaterial=function(t){this.color=new THREE.Color(16711680),this.opacity=1,this.blending=THREE.NormalBlending,this.linewidth=1,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.linewidth&&(this.linewidth=t.linewidth)),this.toString=function(){return"THREE.LineBasicMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>linewidth: "+this.linewidth+"<br/>)"}},THREE.MeshBasicMaterial=function(t){this.id=THREE.MeshBasicMaterialCounter.value++,this.color=new THREE.Color(15658734),this.map=null,this.opacity=1,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth)),this.toString=function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>)"}},THREE.MeshBasicMaterialCounter={value:0},THREE.MeshLambertMaterial=function(t){this.id=THREE.MeshLambertMaterialCounter.value++,this.color=new THREE.Color(15658734),this.map=null,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth)),this.toString=function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_size: "+this.wireframe_linewidth+"<br/> )"}},THREE.MeshLambertMaterialCounter={value:0},THREE.MeshPhongMaterial=function(t){this.id=THREE.MeshPhongMaterialCounter.value++,this.color=new THREE.Color(15658734),this.map=null,this.ambient=new THREE.Color(328965),this.specular=new THREE.Color(1118481),this.specular_map=null,this.shininess=30,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,t&&(void 0!==t.color&&(this.color=new THREE.Color(t.color)),void 0!==t.map&&(this.map=t.map),void 0!==t.ambient&&(this.ambient=new THREE.Color(t.ambient)),void 0!==t.specular&&(this.specular=new THREE.Color(t.specular)),void 0!==t.specular_map&&(this.specular_map=t.specular_map),void 0!==t.shininess&&(this.shininess=t.shininess),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth)),this.toString=function(){return"THREE.MeshPhongMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>specular_map: "+this.specular_map+"<br/>shininess: "+this.shininess+"<br/>alpha: "+this.opacity+"<br/>shading: "+this.shading+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>NaN"}},THREE.MeshPhongMaterialCounter={value:0},THREE.MeshDepthMaterial=function(t){this.near=1,this.far=1e3,this.opacity=1,this.blending=THREE.NormalBlending,t&&(void 0!==t.near&&(this.near=t.near),void 0!==t.far&&(this.far=t.far),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending)),this.__2near=2*this.near,this.__farPlusNear=this.far+this.near,this.__farMinusNear=this.far-this.near,this.toString=function(){return"THREE.MeshDepthMaterial"}},THREE.MeshNormalMaterial=function(t){this.opacity=1,this.shading=THREE.FlatShading,this.blending=THREE.NormalBlending,t&&(void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending)),this.toString=function(){return"THREE.MeshNormalMaterial"}},THREE.MeshFaceMaterial=function(){this.toString=function(){return"THREE.MeshFaceMaterial"}},THREE.ParticleBasicMaterial=function(t){this.color=new THREE.Color(16711680),this.map=null,this.opacity=1,this.blending=THREE.NormalBlending,this.offset=new THREE.Vector2,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending)),this.toString=function(){return"THREE.ParticleBasicMaterial (<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleCircleMaterial=function(t){this.color=new THREE.Color(16711680),this.opacity=1,this.blending=THREE.NormalBlending,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending)),this.toString=function(){return"THREE.ParticleCircleMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleDOMMaterial=function(t){this.domElement=t,this.toString=function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}},THREE.Texture=function(t,i){this.image=t,this.mapping=i?i:THREE.UVMapping,this.toString=function(){return"THREE.Texture (<br/>image: "+this.image+"<br/>mapping: "+this.mapping+"<br/>)"}},THREE.UVMapping=0,THREE.ReflectionMap=1,THREE.CubeMap=2,THREE.Scene=function(){this.objects=[],this.lights=[],this.addObject=function(t){this.objects.push(t)},this.removeObject=function(t){t=this.objects.indexOf(t),t!==-1&&this.objects.splice(t,1)},this.addLight=function(t){this.lights.push(t)},this.removeLight=function(t){t=this.lights.indexOf(t),t!==-1&&this.lights.splice(t,1)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},THREE.Projector=function(){function t(t,i){var n;n=0;var e=1,r=t.z+t.w,o=i.z+i.w,s=-t.z+t.w,a=-i.z+i.w;return r>=0&&o>=0&&s>=0&&a>=0?n=!0:r<0&&o<0||s<0&&a<0?n=!1:(r<0?n=Math.max(n,r/(r-o)):o<0&&(e=Math.min(e,r/(r-o))),s<0?n=Math.max(n,s/(s-a)):a<0&&(e=Math.min(e,s/(s-a))),e<n?n=!1:(t.lerpSelf(i,n),i.lerpSelf(t,1-e),n=!0)),n}var i,n,e,r,o,s,a,h,c=null,l=[],u=[],f=[],E=[],p=new THREE.Vector4,m=new THREE.Matrix4,g=new THREE.Matrix4;this.projectScene=function(d,y){var x,b,R,v,T,S,H,w,M,_,L,z,A,P;for(c=[],h=s=r=n=0,y.autoUpdateMatrix&&y.updateMatrix(),m.multiply(y.projectionMatrix,y.matrix),T=d.objects,x=0,b=T.length;x<b;x++)if(S=T[x],H=S.matrix,S.autoUpdateMatrix&&S.updateMatrix(),S instanceof THREE.Mesh){for(g.multiply(m,H),w=S.geometry.vertices,R=0,v=w.length;R<v;R++)M=w[R],_=M.positionScreen,_.copy(M.position),g.transform(_),_.multiplyScalar(1/_.w),M.__visible=_.z>0&&_.z<1;for(M=S.geometry.faces,R=0,v=M.length;R<v;R++)_=M[R],_ instanceof THREE.Face3?(L=w[_.a],z=w[_.b],A=w[_.c],L.__visible&&z.__visible&&A.__visible&&(S.doubleSided||S.flipSided!=(A.positionScreen.x-L.positionScreen.x)*(z.positionScreen.y-L.positionScreen.y)-(A.positionScreen.y-L.positionScreen.y)*(z.positionScreen.x-L.positionScreen.x)<0)&&(i=l[n]=l[n]||new THREE.RenderableFace3,i.v1.positionScreen.copy(L.positionScreen),i.v2.positionScreen.copy(z.positionScreen),i.v3.positionScreen.copy(A.positionScreen),i.normalWorld.copy(_.normal),S.matrixRotation.transform(i.normalWorld),i.centroidWorld.copy(_.centroid),H.transform(i.centroidWorld),i.centroidScreen.copy(i.centroidWorld),m.transform(i.centroidScreen),i.z=i.centroidScreen.z,i.meshMaterial=S.material,i.faceMaterial=_.material,i.overdraw=S.overdraw,i.uvs=S.geometry.uvs[R],i.color=_.color,
c.push(i),n++)):_ instanceof THREE.Face4&&(L=w[_.a],z=w[_.b],A=w[_.c],P=w[_.d],L.__visible&&z.__visible&&A.__visible&&P.__visible&&(S.doubleSided||S.flipSided!=((P.positionScreen.x-L.positionScreen.x)*(z.positionScreen.y-L.positionScreen.y)-(P.positionScreen.y-L.positionScreen.y)*(z.positionScreen.x-L.positionScreen.x)<0||(z.positionScreen.x-A.positionScreen.x)*(P.positionScreen.y-A.positionScreen.y)-(z.positionScreen.y-A.positionScreen.y)*(P.positionScreen.x-A.positionScreen.x)<0))&&(e=u[r]=u[r]||new THREE.RenderableFace4,e.v1.positionScreen.copy(L.positionScreen),e.v2.positionScreen.copy(z.positionScreen),e.v3.positionScreen.copy(A.positionScreen),e.v4.positionScreen.copy(P.positionScreen),e.normalWorld.copy(_.normal),S.matrixRotation.transform(e.normalWorld),e.centroidWorld.copy(_.centroid),H.transform(e.centroidWorld),e.centroidScreen.copy(e.centroidWorld),m.transform(e.centroidScreen),e.z=e.centroidScreen.z,e.meshMaterial=S.material,e.faceMaterial=_.material,e.overdraw=S.overdraw,e.uvs=S.geometry.uvs[R],e.color=_.color,c.push(e),r++))}else if(S instanceof THREE.Line){for(g.multiply(m,H),w=S.geometry.vertices,R=0,v=w.length;R<v;R++)M=w[R],M.positionScreen.copy(M.position),g.transform(M.positionScreen);for(R=1,v=w.length;R<v;R++)H=w[R],M=w[R-1],t(H.positionScreen,M.positionScreen)&&(H.positionScreen.multiplyScalar(1/H.positionScreen.w),M.positionScreen.multiplyScalar(1/M.positionScreen.w),o=f[s]=f[s]||new THREE.RenderableLine,o.v1.positionScreen.copy(H.positionScreen),o.v2.positionScreen.copy(M.positionScreen),o.z=Math.max(H.positionScreen.z,M.positionScreen.z),o.material=S.material,c.push(o),s++)}else S instanceof THREE.Particle&&(p.set(S.position.x,S.position.y,S.position.z,1),y.matrix.transform(p),y.projectionMatrix.transform(p),S.screen.set(p.x/p.w,p.y/p.w,p.z/p.w),S.screen.z>0&&S.screen.z<1&&(a=E[h]=E[h]||new THREE.RenderableParticle,a.x=S.screen.x,a.y=S.screen.y,a.z=S.screen.z,a.rotation=S.rotation.z,a.scale.x=S.scale.x*Math.abs(p.x/p.w-(p.x+y.projectionMatrix.n11)/(p.w+y.projectionMatrix.n14)),a.scale.y=S.scale.y*Math.abs(p.y/p.w-(p.y+y.projectionMatrix.n22)/(p.w+y.projectionMatrix.n24)),a.material=S.material,a.color=S.color,c.push(a),h++));return c.sort(function(t,i){return i.z-t.z}),c},this.unprojectVector=function(t,i){var n=new THREE.Matrix4;return n.multiply(THREE.Matrix4.makeInvert(i.matrix),THREE.Matrix4.makeInvert(i.projectionMatrix)),n.transform(t),t}},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var t,i,n,e,r=null,o=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(r,o){t=r,i=o,n=t/2,e=i/2},this.render=function(t,i){var s,a,h,c,l,u,f,E;for(r=o.projectScene(t,i),s=0,a=r.length;s<a;s++)if(l=r[s],l instanceof THREE.RenderableParticle)for(f=l.x*n+n,E=l.y*e+e,h=0,c=l.material.length;h<c;h++)u=l.material[h],u instanceof THREE.ParticleDOMMaterial&&(u=u.domElement,u.style.left=f+"px",u.style.top=E+"px")}},THREE.CanvasRenderer=function(){function t(t,i,n){var e,r,o;for(lights=t.lights,t=0,e=lights.length;t<e;t++)r=lights[t],o=r.color,r instanceof THREE.DirectionalLight?(r=i.normalWorld.dot(r.position)*r.intensity,r>0&&(n.r+=o.r*r,n.g+=o.g*r,n.b+=o.b*r)):r instanceof THREE.PointLight&&(Et.sub(r.position,i.centroidWorld),Et.normalize(),r=i.normalWorld.dot(Et)*r.intensity,r>0&&(n.r+=o.r*r,n.g+=o.g*r,n.b+=o.b*r))}function i(i,n,r,c,l,u){y=i.positionScreen.x,x=i.positionScreen.y,b=n.positionScreen.x,R=n.positionScreen.y,v=r.positionScreen.x,T=r.positionScreen.y,l.opacity!=K&&(Z.globalAlpha=K=l.opacity),l.blending!=Q&&s(l.blending),l.map?(V=l.map.image,D=V.width-1,U=V.height-1,pt.u=c.uvs[0].u*D,pt.v=c.uvs[0].v*U,mt.u=c.uvs[1].u*D,mt.v=c.uvs[1].v*U,gt.u=c.uvs[2].u*D,gt.v=c.uvs[2].v*U,o(V,y,x,b,R,v,T,pt.u,pt.v,mt.u,mt.v,gt.u,gt.v)):l instanceof THREE.MeshBasicMaterial?e(y,x,b,R,v,T,l.color,l.wireframe,l.wireframe_linewidth):l instanceof THREE.MeshLambertMaterial?(st?(ht.r=ct.r,ht.g=ct.g,ht.b=ct.b,t(u,c,ht),at.r=l.color.r*ht.r,at.g=l.color.g*ht.g,at.b=l.color.b*ht.b,at.updateStyleString()):at.__styleString=l.color.__styleString,e(y,x,b,R,v,T,at,l.wireframe,l.wireframe_linewidth)):l instanceof THREE.MeshDepthMaterial?(C=l.__2near,N=l.__farPlusNear,B=l.__farMinusNear,z=~~(255*(1-C/(N-i.positionScreen.z*B))),A=~~(255*(1-C/(N-n.positionScreen.z*B))),P=~~(255*(1-C/(N-r.positionScreen.z*B))),V=a([z,z,z],[A,A,A],[P,P,P],[P,P,P]),pt.u=0,pt.v=0,mt.u=yt,mt.v=0,gt.u=0,gt.v=yt,o(V,y,x,b,R,v,T,pt.u,pt.v,mt.u,mt.v,gt.u,gt.v)):l instanceof THREE.MeshNormalMaterial&&(at.r=h(c.normalWorld.x),at.g=h(c.normalWorld.y),at.b=h(c.normalWorld.z),at.updateStyleString(),e(y,x,b,R,v,T,at,l.wireframe,l.wireframe_linewidth))}function n(i,n,e,c,l,u,f,E,p){y=i.positionScreen.x,x=i.positionScreen.y,b=n.positionScreen.x,R=n.positionScreen.y,v=e.positionScreen.x,T=e.positionScreen.y,S=c.positionScreen.x,H=c.positionScreen.y,w=l.positionScreen.x,M=l.positionScreen.y,_=u.positionScreen.x,L=u.positionScreen.y,E.opacity!=K&&(Z.globalAlpha=K=E.opacity),E.blending!=Q&&s(E.blending),E.map?(V=E.map.image,D=V.width-1,U=V.height-1,pt.copy(f.uvs[0]),mt.copy(f.uvs[1]),gt.copy(f.uvs[2]),dt.copy(f.uvs[3]),pt.u*=D,pt.v*=U,mt.u*=D,mt.v*=U,gt.u*=D,gt.v*=U,dt.u*=D,dt.v*=U,o(V,y,x,b,R,S,H,pt.u,pt.v,mt.u,mt.v,dt.u,dt.v),o(V,w,M,v,T,_,L,mt.u,mt.v,gt.u,gt.v,dt.u,dt.v)):E instanceof THREE.MeshBasicMaterial?r(y,x,b,R,v,T,S,H,E.color,E.wireframe,E.wireframe_linewidth):E instanceof THREE.MeshLambertMaterial?(st?(ht.r=ct.r,ht.g=ct.g,ht.b=ct.b,t(p,f,ht),at.r=E.color.r*ht.r,at.g=E.color.g*ht.g,at.b=E.color.b*ht.b,at.updateStyleString()):at.__styleString=E.color.__styleString,r(y,x,b,R,v,T,S,H,at,E.wireframe,E.wireframe_linewidth)):E instanceof THREE.MeshDepthMaterial?(C=E.__2near,N=E.__farPlusNear,B=E.__farMinusNear,z=~~(255*(1-C/(N-i.positionScreen.z*B))),A=~~(255*(1-C/(N-n.positionScreen.z*B))),P=~~(255*(1-C/(N-e.positionScreen.z*B))),F=~~(255*(1-C/(N-c.positionScreen.z*B))),V=a([z,z,z],[A,A,A],[F,F,F],[P,P,P]),pt.u=0,pt.v=0,mt.u=yt,mt.v=0,gt.u=yt,gt.v=yt,dt.u=0,dt.v=yt,o(V,y,x,b,R,S,H,pt.u,pt.v,mt.u,mt.v,dt.u,dt.v),o(V,w,M,v,T,_,L,mt.u,mt.v,gt.u,gt.v,dt.u,dt.v)):E instanceof THREE.MeshNormalMaterial&&(at.r=h(f.normalWorld.x),at.g=h(f.normalWorld.y),at.b=h(f.normalWorld.z),at.updateStyleString(),r(y,x,b,R,v,T,S,H,at,E.wireframe,E.wireframe_linewidth))}function e(t,i,n,e,r,o,s,a,h){Z.beginPath(),Z.moveTo(t,i),Z.lineTo(n,e),Z.lineTo(r,o),Z.lineTo(t,i),Z.closePath(),a?(tt!=h&&(Z.lineWidth=tt=h),J!=s.__styleString&&(Z.strokeStyle=J=s.__styleString),Z.stroke(),ot.inflate(2*h)):($!=s.__styleString&&(Z.fillStyle=$=s.__styleString),Z.fill())}function r(t,i,n,e,r,o,s,a,h,c,l){Z.beginPath(),Z.moveTo(t,i),Z.lineTo(n,e),Z.lineTo(r,o),Z.lineTo(s,a),Z.lineTo(t,i),Z.closePath(),c?(tt!=l&&(Z.lineWidth=tt=l),J!=h.__styleString&&(Z.strokeStyle=J=h.__styleString),Z.stroke(),ot.inflate(2*l)):($!=h.__styleString&&(Z.fillStyle=$=h.__styleString),Z.fill())}function o(t,i,n,e,r,o,s,a,h,c,l,u,f){Z.beginPath(),Z.moveTo(i,n),Z.lineTo(e,r),Z.lineTo(o,s),Z.closePath(),e-=i,r-=n,o-=i,s-=n,c-=a,l-=h,u-=a,f-=h;var E=1/(c*f-u*l),p=(f*e-l*o)*E;l=(f*r-l*s)*E,e=(c*o-u*e)*E,r=(c*s-u*r)*E,i=i-p*a-e*h,n=n-l*a-r*h,Z.save(),Z.transform(p,l,e,r,i,n),Z.clip(),Z.drawImage(t,0,0),Z.restore()}function s(t){switch(t){case THREE.NormalBlending:Z.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:Z.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:Z.globalCompositeOperation="darker"}Q=t}function a(t,i,n,e){return O[0]=t[0],O[1]=t[1],O[2]=t[2],O[4]=i[0],O[5]=i[1],O[6]=i[2],O[8]=n[0],O[9]=n[1],O[10]=n[2],O[12]=e[0],O[13]=e[1],O[14]=e[2],j.putImageData(W,0,0),k.drawImage(G,0,0),I}function h(t){return t<0?Math.min(.5*(1+t),.5):.5+Math.min(.5*t,.5)}function c(t,i){var n=i.x-t.x,e=i.y-t.y,r=1/Math.sqrt(n*n+e*e);n*=r,e*=r,i.x+=n,i.y+=e,t.x-=n,t.y-=e}var l,u,f,E,p,m,g,d,y,x,b,R,v,T,S,H,w,M,_,L,z,A,P,F,C,N,B,V,D,U,G,j,W,O,I,k,X=null,Y=new THREE.Projector,q=document.createElement("canvas"),Z=q.getContext("2d"),K=1,Q=0,J=null,$=null,tt=1,it=new THREE.Vertex,nt=new THREE.Vertex,et=new THREE.Rectangle,rt=new THREE.Rectangle,ot=new THREE.Rectangle,st=!1,at=new THREE.Color(4294967295),ht=new THREE.Color(4294967295),ct=new THREE.Color(4278190080),lt=new THREE.Color(4278190080),ut=new THREE.Color(4278190080),ft=2*Math.PI,Et=new THREE.Vector3,pt=new THREE.UV,mt=new THREE.UV,gt=new THREE.UV,dt=new THREE.UV,yt=16;G=document.createElement("canvas"),G.width=G.height=2,j=G.getContext("2d"),j.fillStyle="rgba(0,0,0,1)",j.fillRect(0,0,2,2),W=j.getImageData(0,0,2,2),O=W.data,I=document.createElement("canvas"),I.width=I.height=yt,k=I.getContext("2d"),k.translate(-yt/2,-yt/2),k.scale(yt,yt),yt--,this.domElement=q,this.autoClear=!0,this.setSize=function(t,i){l=t,u=i,f=l/2,E=u/2,q.width=l,q.height=u,Z.lineJoin="round",Z.lineCap="round",et.set(-f,-E,f,E)},this.clear=function(){rt.isEmpty()||(rt.inflate(1),rt.minSelf(et),Z.setTransform(1,0,0,-1,f,E),Z.clearRect(rt.getX(),rt.getY(),rt.getWidth(),rt.getHeight()),rt.empty())},this.render=function(t,e){var r,o,a,h,l,u,y,x;if(this.autoClear&&this.clear(),X=Y.projectScene(t,e),Z.setTransform(1,0,0,-1,f,E),st=t.lights.length>0)for(l=t.lights,ct.setRGB(0,0,0),lt.setRGB(0,0,0),ut.setRGB(0,0,0),r=0,o=l.length;r<o;r++)a=l[r],h=a.color,a instanceof THREE.AmbientLight?(ct.r+=h.r,ct.g+=h.g,ct.b+=h.b):a instanceof THREE.DirectionalLight?(lt.r+=h.r,lt.g+=h.g,lt.b+=h.b):a instanceof THREE.PointLight&&(ut.r+=h.r,ut.g+=h.g,ut.b+=h.b);for(r=0,o=X.length;r<o;r++){if(a=X[r],ot.empty(),a instanceof THREE.RenderableParticle){for(p=a,p.x*=f,p.y*=E,h=0,l=a.material.length;h<l;h++)if(x=a.material[h]){u=p,y=a,x=x;var b=void 0,R=void 0,v=void 0,T=void 0,S=void 0,H=void 0,w=void 0,M=void 0,_=void 0;x.opacity!=K&&(Z.globalAlpha=K=x.opacity),x.blending!=Q&&s(x.blending),x instanceof THREE.ParticleBasicMaterial?(w=x.bitmap,M=w.width/2,_=w.height/2,v=y.scale.x*f,T=y.scale.y*E,b=v*M,R=T*_,S=x.offset.x*v,H=x.offset.y*T,ot.set(u.x+S-b,u.y+H-R,u.x+S+b,u.y+H+R),et.instersects(ot)&&(Z.save(),Z.translate(u.x,u.y),Z.rotate(-y.rotation),Z.scale(v,-T),Z.translate(-M+x.offset.x,-_-x.offset.y),Z.drawImage(w,0,0),Z.restore())):x instanceof THREE.ParticleCircleMaterial&&(st?(ht.r=ct.r+lt.r+ut.r,ht.g=ct.g+lt.g+ut.g,ht.b=ct.b+lt.b+ut.b,at.r=x.color.r*ht.r,at.g=x.color.g*ht.g,at.b=x.color.b*ht.b,at.updateStyleString()):at.__styleString=x.color.__styleString,b=y.scale.x*f,R=y.scale.y*E,ot.set(u.x-b,u.y-R,u.x+b,u.y+R),et.instersects(ot)&&($!==at.__styleString&&(Z.fillStyle=$=at.__styleString),Z.save(),Z.translate(u.x,u.y),Z.rotate(-y.rotation),Z.scale(b,R),Z.beginPath(),Z.arc(0,0,1,0,ft,!0),Z.closePath(),Z.fill(),Z.restore()))}}else if(a instanceof THREE.RenderableLine){if(p=a.v1,m=a.v2,p.positionScreen.x*=f,p.positionScreen.y*=E,m.positionScreen.x*=f,m.positionScreen.y*=E,ot.addPoint(p.positionScreen.x,p.positionScreen.y),ot.addPoint(m.positionScreen.x,m.positionScreen.y),!et.instersects(ot))continue;for(h=0,l=a.material.length;h<l;)(x=a.material[h++])&&(u=p,y=m,x=x,x.opacity!=K&&(Z.globalAlpha=K=x.opacity),x.blending!=Q&&s(x.blending),Z.beginPath(),Z.moveTo(u.positionScreen.x,u.positionScreen.y),Z.lineTo(y.positionScreen.x,y.positionScreen.y),Z.closePath(),x instanceof THREE.LineBasicMaterial&&(at.__styleString=x.color.__styleString,tt!=x.linewidth&&(Z.lineWidth=tt=x.linewidth),J!=at.__styleString&&(Z.strokeStyle=J=at.__styleString),Z.stroke(),ot.inflate(2*x.linewidth)))}else if(a instanceof THREE.RenderableFace3){if(p=a.v1,m=a.v2,g=a.v3,p.positionScreen.x*=f,p.positionScreen.y*=E,m.positionScreen.x*=f,m.positionScreen.y*=E,g.positionScreen.x*=f,g.positionScreen.y*=E,a.overdraw&&(c(p.positionScreen,m.positionScreen),c(m.positionScreen,g.positionScreen),c(g.positionScreen,p.positionScreen)),ot.addPoint(p.positionScreen.x,p.positionScreen.y),ot.addPoint(m.positionScreen.x,m.positionScreen.y),ot.addPoint(g.positionScreen.x,g.positionScreen.y),!et.instersects(ot))continue;for(h=0,l=a.meshMaterial.length;h<l;)if(x=a.meshMaterial[h++],x instanceof THREE.MeshFaceMaterial)for(u=0,y=a.faceMaterial.length;u<y;)(x=a.faceMaterial[u++])&&i(p,m,g,a,x,t);else x&&i(p,m,g,a,x,t)}else if(a instanceof THREE.RenderableFace4){if(p=a.v1,m=a.v2,g=a.v3,d=a.v4,p.positionScreen.x*=f,p.positionScreen.y*=E,m.positionScreen.x*=f,m.positionScreen.y*=E,g.positionScreen.x*=f,g.positionScreen.y*=E,d.positionScreen.x*=f,d.positionScreen.y*=E,it.positionScreen.copy(m.positionScreen),nt.positionScreen.copy(d.positionScreen),a.overdraw&&(c(p.positionScreen,m.positionScreen),c(m.positionScreen,d.positionScreen),c(d.positionScreen,p.positionScreen)),a.overdraw&&(c(g.positionScreen,it.positionScreen),c(g.positionScreen,nt.positionScreen)),ot.addPoint(p.positionScreen.x,p.positionScreen.y),ot.addPoint(m.positionScreen.x,m.positionScreen.y),ot.addPoint(g.positionScreen.x,g.positionScreen.y),ot.addPoint(d.positionScreen.x,d.positionScreen.y),!et.instersects(ot))continue;for(h=0,l=a.meshMaterial.length;h<l;)if(x=a.meshMaterial[h++],x instanceof THREE.MeshFaceMaterial)for(u=0,y=a.faceMaterial.length;u<y;)(x=a.faceMaterial[u++])&&n(p,m,g,d,it,nt,a,x,t);else x&&n(p,m,g,d,it,nt,a,x,t)}rt.addRectangle(ot)}Z.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function t(t,i,n){var e,r,o,s;for(e=0,r=t.lights.length;e<r;e++)o=t.lights[e],o instanceof THREE.DirectionalLight?(s=i.normalWorld.dot(o.position)*o.intensity,s>0&&(n.r+=o.color.r*s,n.g+=o.color.g*s,n.b+=o.color.b*s)):o instanceof THREE.PointLight&&(_.sub(o.position,i.centroidWorld),_.normalize(),s=i.normalWorld.dot(_)*o.intensity,s>0&&(n.r+=o.color.r*s,n.g+=o.color.g*s,n.b+=o.color.b*s))}function i(i,n,o,s,a,h){p=e(m++),p.setAttribute("d","M "+i.positionScreen.x+" "+i.positionScreen.y+" L "+n.positionScreen.x+" "+n.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),a instanceof THREE.MeshBasicMaterial?T.__styleString=a.color.__styleString:a instanceof THREE.MeshLambertMaterial?v?(S.r=H.r,S.g=H.g,S.b=H.b,t(h,s,S),T.r=a.color.r*S.r,T.g=a.color.g*S.g,T.b=a.color.b*S.b,T.updateStyleString()):T.__styleString=a.color.__styleString:a instanceof THREE.MeshDepthMaterial?(E=1-a.__2near/(a.__farPlusNear-s.z*a.__farMinusNear),T.setRGB(E,E,E)):a instanceof THREE.MeshNormalMaterial&&T.setRGB(r(s.normalWorld.x),r(s.normalWorld.y),r(s.normalWorld.z)),a.wireframe?p.setAttribute("style","fill: none; stroke: "+T.__styleString+"; stroke-width: "+a.wireframe_linewidth+"; stroke-opacity: "+a.opacity+"; stroke-linecap: round; stroke-linejoin: round"):p.setAttribute("style","fill: "+T.__styleString+"; fill-opacity: "+a.opacity),x.appendChild(p)}function n(i,n,o,s,a,h,c){p=e(m++),p.setAttribute("d","M "+i.positionScreen.x+" "+i.positionScreen.y+" L "+n.positionScreen.x+" "+n.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+" L "+s.positionScreen.x+","+s.positionScreen.y+"z"),h instanceof THREE.MeshBasicMaterial?T.__styleString=h.color.__styleString:h instanceof THREE.MeshLambertMaterial?v?(S.r=H.r,S.g=H.g,S.b=H.b,t(c,a,S),T.r=h.color.r*S.r,T.g=h.color.g*S.g,T.b=h.color.b*S.b,T.updateStyleString()):T.__styleString=h.color.__styleString:h instanceof THREE.MeshDepthMaterial?(E=1-h.__2near/(h.__farPlusNear-a.z*h.__farMinusNear),T.setRGB(E,E,E)):h instanceof THREE.MeshNormalMaterial&&T.setRGB(r(a.normalWorld.x),r(a.normalWorld.y),r(a.normalWorld.z)),h.wireframe?p.setAttribute("style","fill: none; stroke: "+T.__styleString+"; stroke-width: "+h.wireframe_linewidth+"; stroke-opacity: "+h.opacity+"; stroke-linecap: round; stroke-linejoin: round"):p.setAttribute("style","fill: "+T.__styleString+"; fill-opacity: "+h.opacity),x.appendChild(p)}function e(t){return null==L[t]?(L[t]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==A&&L[t].setAttribute("shape-rendering","crispEdges"),L[t]):L[t]}function r(t){return t<0?Math.min(.5*(1+t),.5):.5+Math.min(.5*t,.5)}var o,s,a,h,c,l,u,f,E,p,m,g,d=null,y=new THREE.Projector,x=document.createElementNS("http://www.w3.org/2000/svg","svg"),b=new THREE.Rectangle,R=new THREE.Rectangle,v=!1,T=new THREE.Color(4294967295),S=new THREE.Color(4294967295),H=new THREE.Color(4278190080),w=new THREE.Color(4278190080),M=new THREE.Color(4278190080),_=new THREE.Vector3,L=[],z=[],A=1;this.domElement=x,this.autoClear=!0,this.setQuality=function(t){switch(t){case"high":A=1;break;case"low":A=0}},this.setSize=function(t,i){o=t,s=i,a=o/2,h=s/2,x.setAttribute("viewBox",-a+" "+-h+" "+o+" "+s),x.setAttribute("width",o),x.setAttribute("height",s),b.set(-a,-h,a,h)},this.clear=function(){for(;x.childNodes.length>0;)x.removeChild(x.childNodes[0])},this.render=function(t,e){var r,o,s,E,_,L,P,F;if(this.autoClear&&this.clear(),d=y.projectScene(t,e),g=m=0,v=t.lights.length>0)for(P=t.lights,H.setRGB(0,0,0),w.setRGB(0,0,0),M.setRGB(0,0,0),r=0,o=P.length;r<o;r++)s=P[r],E=s.color,s instanceof THREE.AmbientLight?(H.r+=E.r,H.g+=E.g,H.b+=E.b):s instanceof THREE.DirectionalLight?(w.r+=E.r,w.g+=E.g,w.b+=E.b):s instanceof THREE.PointLight&&(M.r+=E.r,M.g+=E.g,M.b+=E.b);for(r=0,o=d.length;r<o;r++)if(P=d[r],R.empty(),P instanceof THREE.RenderableParticle){for(c=P,c.x*=a,c.y*=-h,s=0,E=P.material.length;s<E;s++)if(F=P.material[s]){_=c,L=P,F=F;var C=g++;null==z[C]&&(z[C]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==A&&z[C].setAttribute("shape-rendering","crispEdges")),p=z[C],p.setAttribute("cx",_.x),p.setAttribute("cy",_.y),p.setAttribute("r",L.scale.x*a),F instanceof THREE.ParticleCircleMaterial&&(v?(S.r=H.r+w.r+M.r,S.g=H.g+w.g+M.g,S.b=H.b+w.b+M.b,T.r=F.color.r*S.r,T.g=F.color.g*S.g,T.b=F.color.b*S.b,T.updateStyleString()):T=F.color,p.setAttribute("style","fill: "+T.__styleString)),x.appendChild(p)}}else if(P instanceof THREE.RenderableFace3){if(c=P.v1,l=P.v2,u=P.v3,c.positionScreen.x*=a,c.positionScreen.y*=-h,l.positionScreen.x*=a,l.positionScreen.y*=-h,u.positionScreen.x*=a,u.positionScreen.y*=-h,R.addPoint(c.positionScreen.x,c.positionScreen.y),R.addPoint(l.positionScreen.x,l.positionScreen.y),R.addPoint(u.positionScreen.x,u.positionScreen.y),b.instersects(R))for(s=0,E=P.meshMaterial.length;s<E;)if(F=P.meshMaterial[s++],F instanceof THREE.MeshFaceMaterial)for(_=0,L=P.faceMaterial.length;_<L;)(F=P.faceMaterial[_++])&&i(c,l,u,P,F,t);else F&&i(c,l,u,P,F,t)}else if(P instanceof THREE.RenderableFace4&&(c=P.v1,l=P.v2,u=P.v3,f=P.v4,c.positionScreen.x*=a,c.positionScreen.y*=-h,l.positionScreen.x*=a,l.positionScreen.y*=-h,u.positionScreen.x*=a,u.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,R.addPoint(c.positionScreen.x,c.positionScreen.y),R.addPoint(l.positionScreen.x,l.positionScreen.y),R.addPoint(u.positionScreen.x,u.positionScreen.y),R.addPoint(f.positionScreen.x,f.positionScreen.y),b.instersects(R)))for(s=0,E=P.meshMaterial.length;s<E;)if(F=P.meshMaterial[s++],F instanceof THREE.MeshFaceMaterial)for(_=0,L=P.faceMaterial.length;_<L;)(F=P.faceMaterial[_++])&&n(c,l,u,f,P,F,t);else F&&n(c,l,u,f,P,F,t)}},THREE.WebGLRenderer=function(t){function i(t,i){var e;return"fragment"==t?e=n.createShader(n.FRAGMENT_SHADER):"vertex"==t&&(e=n.createShader(n.VERTEX_SHADER)),n.shaderSource(e,i),n.compileShader(e),n.getShaderParameter(e,n.COMPILE_STATUS)?e:(alert(n.getShaderInfoLog(e)),null)}var n,e,r,o=document.createElement("canvas"),s=new THREE.Matrix4;t=function(t,i){if(t){var n,e,r,o=pointLights=maxDirLights=maxPointLights=0;for(n=0,e=t.lights.length;n<e;n++)r=t.lights[n],r instanceof THREE.DirectionalLight&&o++,r instanceof THREE.PointLight&&pointLights++;return pointLights+o<=i?(maxDirLights=o,maxPointLights=pointLights):(maxDirLights=Math.ceil(i*o/(pointLights+o)),maxPointLights=i-maxDirLights),{directional:maxDirLights,point:maxPointLights}}return{directional:1,point:i-1}}(t,5),this.domElement=o,this.autoClear=!0;try{n=o.getContext("experimental-webgl",{antialias:!0})}catch(t){}if(!n)throw alert("WebGL not supported"),"cannot create webgl context";n.clearColor(0,0,0,1),n.clearDepth(1),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.frontFace(n.CCW),n.cullFace(n.BACK),n.enable(n.CULL_FACE),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.clearColor(0,0,0,0),function(t,r){e=n.createProgram(),n.attachShader(e,i("fragment",["#ifdef GL_ES\nprecision highp float;\n#endif",t?"#define MAX_DIR_LIGHTS "+t:"",r?"#define MAX_POINT_LIGHTS "+r:"","uniform int material;\nuniform bool enableMap;\nuniform sampler2D tMap;\nuniform vec4 mColor;\nuniform float mOpacity;\nuniform vec4 mAmbient;\nuniform vec4 mSpecular;\nuniform float mShininess;\nuniform float m2Near;\nuniform float mFarPlusNear;\nuniform float mFarMinusNear;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;",t?"uniform mat4 viewMatrix;":"",t?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"","varying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",r?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvoid main() {\nvec4 mapColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nif ( enableMap ) {\nmapColor = texture2D( tMap, vUv );\n}\nif ( material == 4 ) { \ngl_FragColor = vec4( 0.5*normalize( vNormal ) + vec3(0.5, 0.5, 0.5), mOpacity );\n} else if ( material == 3 ) { \nfloat w = 0.5;\ngl_FragColor = vec4( w, w, w, mOpacity );\n} else if ( material == 2 ) { \nvec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );",r?"vec4 pointDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",r?"vec4 pointSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",r?"for( int i = 0; i < pointLightNumber; i++ ) {":"",r?"vec3 pointVector = normalize( vPointLightVector[ i ] );":"",r?"vec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );":"",r?"float pointDotNormalHalf = dot( normal, pointHalfVector );":"",r?"float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );":"",r?"float pointSpecularWeight = 0.0;":"",r?"if ( pointDotNormalHalf >= 0.0 )":"",r?"pointSpecularWeight = pow( pointDotNormalHalf, mShininess );":"",r?"pointDiffuse  += mColor * pointDiffuseWeight;":"",r?"pointSpecular += mSpecular * pointSpecularWeight;":"",r?"}":"",t?"vec4 dirDiffuse  = vec4( 0.0, 0.0, 0.0, 0.0 );":"",t?"vec4 dirSpecular = vec4( 0.0, 0.0, 0.0, 0.0 );":"",t?"for( int i = 0; i < directionalLightNumber; i++ ) {":"",t?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",t?"vec3 dirVector = normalize( lDirection.xyz );":"",t?"vec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );":"",t?"float dirDotNormalHalf = dot( normal, dirHalfVector );":"",t?"float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );":"",t?"float dirSpecularWeight = 0.0;":"",t?"if ( dirDotNormalHalf >= 0.0 )":"",t?"dirSpecularWeight = pow( dirDotNormalHalf, mShininess );":"",t?"dirDiffuse  += mColor * dirDiffuseWeight;":"",t?"dirSpecular += mSpecular * dirSpecularWeight;":"",t?"}":"","vec4 totalLight = mAmbient;",t?"totalLight += dirDiffuse + dirSpecular;":"",r?"totalLight += pointDiffuse + pointSpecular;":"","gl_FragColor = vec4( mapColor.rgb * totalLight.xyz * vLightWeighting, mapColor.a );\n} else if ( material == 1 ) {\ngl_FragColor = vec4( mColor.rgb * mapColor.rgb * vLightWeighting, mColor.a * mapColor.a );\n} else {\ngl_FragColor = mColor * mapColor;\n}\n}"].join("\n"))),n.attachShader(e,i("vertex",[t?"#define MAX_DIR_LIGHTS "+t:"",r?"#define MAX_POINT_LIGHTS "+r:"","attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nuniform vec3 cameraPosition;\nuniform bool enableLighting;\nuniform int pointLightNumber;\nuniform int directionalLightNumber;\nuniform vec3 ambientLightColor;",t?"uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];":"",t?"uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];":"",r?"uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];":"",r?"uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];":"","uniform mat4 objMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vLightWeighting;",r?"varying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];":"","varying vec3 vViewPosition;\nvarying vec3 vFragPosition;\nvoid main(void) {\nvec4 mPosition = objMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec3 transformedNormal = normalize( normalMatrix * normal );\nif ( !enableLighting ) {\nvLightWeighting = vec3( 1.0, 1.0, 1.0 );\n} else {\nvLightWeighting = ambientLightColor;",t?"for( int i = 0; i < directionalLightNumber; i++ ) {":"",t?"vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );":"",t?"float directionalLightWeighting = max( dot( transformedNormal, normalize(lDirection.xyz ) ), 0.0 );":"",t?"vLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;":"",t?"}":"",r?"for( int i = 0; i < pointLightNumber; i++ ) {":"",r?"vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );":"",r?"vPointLightVector[ i ] = normalize( lPosition.xyz - mvPosition.xyz );":"",r?"float pointLightWeighting = max( dot( transformedNormal, vPointLightVector[ i ] ), 0.0 );":"",r?"vLightWeighting += pointLightColor[ i ] * pointLightWeighting;":"",r?"}":"","}\nvNormal = transformedNormal;\nvUv = uv;\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"))),n.linkProgram(e),n.getProgramParameter(e,n.LINK_STATUS)||alert("Could not initialise shaders"),n.useProgram(e),e.viewMatrix=n.getUniformLocation(e,"viewMatrix"),e.modelViewMatrix=n.getUniformLocation(e,"modelViewMatrix"),e.projectionMatrix=n.getUniformLocation(e,"projectionMatrix"),e.normalMatrix=n.getUniformLocation(e,"normalMatrix"),e.objMatrix=n.getUniformLocation(e,"objMatrix"),e.cameraPosition=n.getUniformLocation(e,"cameraPosition"),e.enableLighting=n.getUniformLocation(e,"enableLighting"),e.ambientLightColor=n.getUniformLocation(e,"ambientLightColor"),t&&(e.directionalLightNumber=n.getUniformLocation(e,"directionalLightNumber"),e.directionalLightColor=n.getUniformLocation(e,"directionalLightColor"),e.directionalLightDirection=n.getUniformLocation(e,"directionalLightDirection")),r&&(e.pointLightNumber=n.getUniformLocation(e,"pointLightNumber"),e.pointLightColor=n.getUniformLocation(e,"pointLightColor"),e.pointLightPosition=n.getUniformLocation(e,"pointLightPosition")),e.material=n.getUniformLocation(e,"material"),e.mColor=n.getUniformLocation(e,"mColor"),e.mOpacity=n.getUniformLocation(e,"mOpacity"),e.mAmbient=n.getUniformLocation(e,"mAmbient"),e.mSpecular=n.getUniformLocation(e,"mSpecular"),e.mShininess=n.getUniformLocation(e,"mShininess"),e.enableMap=n.getUniformLocation(e,"enableMap"),n.uniform1i(e.enableMap,0),e.tMap=n.getUniformLocation(e,"tMap"),n.uniform1i(e.tMap,0),e.m2Near=n.getUniformLocation(e,"m2Near"),e.mFarPlusNear=n.getUniformLocation(e,"mFarPlusNear"),e.mFarMinusNear=n.getUniformLocation(e,"mFarMinusNear"),e.position=n.getAttribLocation(e,"position"),n.enableVertexAttribArray(e.position),e.normal=n.getAttribLocation(e,"normal"),n.enableVertexAttribArray(e.normal),e.uv=n.getAttribLocation(e,"uv"),n.enableVertexAttribArray(e.uv),e.viewMatrixArray=new Float32Array(16),e.modelViewMatrixArray=new Float32Array(16),e.projectionMatrixArray=new Float32Array(16)}(t.directional,t.point),this.setSize=function(t,i){o.width=t,o.height=i,n.viewport(0,0,o.width,o.height)},this.clear=function(){n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)},this.setupLights=function(t){var i,r,o,s,a=[],h=[],c=[];s=[];var l=[];for(n.uniform1i(e.enableLighting,t.lights.length),i=0,r=t.lights.length;i<r;i++)o=t.lights[i],o instanceof THREE.AmbientLight?a.push(o):o instanceof THREE.DirectionalLight?c.push(o):o instanceof THREE.PointLight&&h.push(o);for(i=t=o=s=0,r=a.length;i<r;i++)t+=a[i].color.r,o+=a[i].color.g,s+=a[i].color.b;for(n.uniform3f(e.ambientLightColor,t,o,s),s=[],l=[],i=0,r=c.length;i<r;i++)o=c[i],s.push(o.color.r*o.intensity),s.push(o.color.g*o.intensity),s.push(o.color.b*o.intensity),l.push(o.position.x),l.push(o.position.y),l.push(o.position.z);for(c.length&&(n.uniform1i(e.directionalLightNumber,c.length),n.uniform3fv(e.directionalLightDirection,l),n.uniform3fv(e.directionalLightColor,s)),s=[],l=[],i=0,r=h.length;i<r;i++)o=h[i],s.push(o.color.r*o.intensity),s.push(o.color.g*o.intensity),s.push(o.color.b*o.intensity),l.push(o.position.x),l.push(o.position.y),l.push(o.position.z);h.length&&(n.uniform1i(e.pointLightNumber,h.length),n.uniform3fv(e.pointLightPosition,l),n.uniform3fv(e.pointLightColor,s))},this.createBuffers=function(t,i){var e,r,o,s,a,h,c,l,u,f=t.materialFaceGroup[i],E=[],p=[],m=[],g=[],d=[],y=0,x=!1;for(e=0,r=t.material.length;e<r;e++){if(meshMaterial=t.material[e],meshMaterial instanceof THREE.MeshFaceMaterial){for(a=0,h=f.material.length;a<h;a++)if(void 0!=f.material[a].shading&&f.material[a].shading==THREE.SmoothShading){x=!0;break}}else if(void 0!=meshMaterial.shading&&meshMaterial.shading==THREE.SmoothShading){x=!0;break}if(x)break}for(e=0,r=f.faces.length;e<r;e++)o=f.faces[e],s=t.geometry.faces[o],a=s.vertexNormals,h=s.normal,o=t.geometry.uvs[o],s instanceof THREE.Face3?(c=t.geometry.vertices[s.a].position,l=t.geometry.vertices[s.b].position,u=t.geometry.vertices[s.c].position,m.push(c.x,c.y,c.z),m.push(l.x,l.y,l.z),m.push(u.x,u.y,u.z),3==a.length&&x?(g.push(a[0].x,a[0].y,a[0].z),g.push(a[1].x,a[1].y,a[1].z),g.push(a[2].x,a[2].y,a[2].z)):(g.push(h.x,h.y,h.z),g.push(h.x,h.y,h.z),g.push(h.x,h.y,h.z)),o&&(d.push(o[0].u,o[0].v),d.push(o[1].u,o[1].v),d.push(o[2].u,o[2].v)),E.push(y,y+1,y+2),p.push(y,y+1),p.push(y,y+2),p.push(y+1,y+2),y+=3):s instanceof THREE.Face4&&(c=t.geometry.vertices[s.a].position,l=t.geometry.vertices[s.b].position,u=t.geometry.vertices[s.c].position,s=t.geometry.vertices[s.d].position,m.push(c.x,c.y,c.z),m.push(l.x,l.y,l.z),m.push(u.x,u.y,u.z),m.push(s.x,s.y,s.z),4==a.length&&x?(g.push(a[0].x,a[0].y,a[0].z),g.push(a[1].x,a[1].y,a[1].z),g.push(a[2].x,a[2].y,a[2].z),g.push(a[3].x,a[3].y,a[3].z)):(g.push(h.x,h.y,h.z),g.push(h.x,h.y,h.z),g.push(h.x,h.y,h.z),g.push(h.x,h.y,h.z)),o&&(d.push(o[0].u,o[0].v),d.push(o[1].u,o[1].v),d.push(o[2].u,o[2].v),d.push(o[3].u,o[3].v)),E.push(y,y+1,y+2),E.push(y,y+2,y+3),p.push(y,y+1),p.push(y,y+2),p.push(y,y+3),p.push(y+1,y+2),p.push(y+2,y+3),y+=4);m.length&&(f.__webGLVertexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,f.__webGLVertexBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(m),n.STATIC_DRAW),f.__webGLNormalBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,f.__webGLNormalBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(g),n.STATIC_DRAW),f.__webGLUVBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,f.__webGLUVBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(d),n.STATIC_DRAW),f.__webGLFaceBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,f.__webGLFaceBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(E),n.STATIC_DRAW),f.__webGLLineBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,f.__webGLLineBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),n.STATIC_DRAW),f.__webGLFaceCount=E.length,f.__webGLLineCount=p.length)},this.renderBuffer=function(t,i){var r,o,s,a,h,c,l;(t instanceof THREE.MeshPhongMaterial||t instanceof THREE.MeshLambertMaterial||t instanceof THREE.MeshBasicMaterial)&&(r=t.color,o=t.opacity,s=t.wireframe,a=t.wireframe_linewidth,l=t.map,n.uniform4f(e.mColor,r.r*o,r.g*o,r.b*o,o)),t instanceof THREE.MeshNormalMaterial?(o=t.opacity,n.uniform1f(e.mOpacity,o),n.uniform1i(e.material,4)):t instanceof THREE.MeshDepthMaterial?(o=t.opacity,s=t.wireframe,a=t.wireframe_linewidth,n.uniform1f(e.mOpacity,o),n.uniform1f(e.m2Near,t.__2near),n.uniform1f(e.mFarPlusNear,t.__farPlusNear),n.uniform1f(e.mFarMinusNear,t.__farMinusNear),n.uniform1i(e.material,3)):t instanceof THREE.MeshPhongMaterial?(r=t.ambient,h=t.specular,c=t.shininess,n.uniform4f(e.mAmbient,r.r,r.g,r.b,o),n.uniform4f(e.mSpecular,h.r,h.g,h.b,o),n.uniform1f(e.mShininess,c),n.uniform1i(e.material,2)):t instanceof THREE.MeshLambertMaterial?n.uniform1i(e.material,1):t instanceof THREE.MeshBasicMaterial&&n.uniform1i(e.material,0),l?(!t.__webGLTexture&&t.map.loaded&&(t.__webGLTexture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,t.__webGLTexture),
n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t.map.image),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null)),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.__webGLTexture),n.uniform1i(e.tMap,0),n.uniform1i(e.enableMap,1)):n.uniform1i(e.enableMap,0),n.bindBuffer(n.ARRAY_BUFFER,i.__webGLVertexBuffer),n.vertexAttribPointer(e.position,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,i.__webGLNormalBuffer),n.vertexAttribPointer(e.normal,3,n.FLOAT,!1,0,0),l?(n.bindBuffer(n.ARRAY_BUFFER,i.__webGLUVBuffer),n.enableVertexAttribArray(e.uv),n.vertexAttribPointer(e.uv,2,n.FLOAT,!1,0,0)):n.disableVertexAttribArray(e.uv),s?(n.lineWidth(a),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.__webGLLineBuffer),n.drawElements(n.LINES,i.__webGLLineCount,n.UNSIGNED_SHORT,0)):(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.__webGLFaceBuffer),n.drawElements(n.TRIANGLES,i.__webGLFaceCount,n.UNSIGNED_SHORT,0))},this.renderPass=function(t,i,n){var e,r,o,s,a;for(o=0,s=t.material.length;o<s;o++)if(e=t.material[o],e instanceof THREE.MeshFaceMaterial)for(e=0,r=i.material.length;e<r;e++)a=i.material[e],a.blending==n&&(this.setBlending(a.blending),this.renderBuffer(a,i));else a=e,a.blending==n&&(this.setBlending(a.blending),this.renderBuffer(a,i))},this.render=function(t,i){var r,o;for(this.initWebGLObjects(t),this.autoClear&&this.clear(),i.autoUpdateMatrix&&i.updateMatrix(),n.uniform3f(e.cameraPosition,i.position.x,i.position.y,i.position.z),this.setupLights(t),r=0,o=t.__webGLObjects.length;r<o;r++)webGLObject=t.__webGLObjects[r],this.setupMatrices(webGLObject.__object,i),this.renderPass(webGLObject.__object,webGLObject,THREE.NormalBlending);for(r=0,o=t.__webGLObjects.length;r<o;r++)webGLObject=t.__webGLObjects[r],this.setupMatrices(webGLObject.__object,i),this.renderPass(webGLObject.__object,webGLObject,THREE.AdditiveBlending),this.renderPass(webGLObject.__object,webGLObject,THREE.SubtractiveBlending)},this.initWebGLObjects=function(t){var i,n,e,r,o;for(t.__webGLObjects||(t.__webGLObjects=[]),i=0,n=t.objects.length;i<n;i++)if(e=t.objects[i],e instanceof THREE.Mesh)for(r in e.materialFaceGroup)o=e.materialFaceGroup[r],o.__webGLVertexBuffer||(this.createBuffers(e,r),o.__object=e,t.__webGLObjects.push(o))},this.setupMatrices=function(t,i){t.autoUpdateMatrix&&t.updateMatrix(),s.multiply(i.matrix,t.matrix),e.viewMatrixArray=new Float32Array(i.matrix.flatten()),e.modelViewMatrixArray=new Float32Array(s.flatten()),e.projectionMatrixArray=new Float32Array(i.projectionMatrix.flatten()),r=THREE.Matrix4.makeInvert3x3(s).transpose(),e.normalMatrixArray=new Float32Array(r.m),n.uniformMatrix4fv(e.viewMatrix,!1,e.viewMatrixArray),n.uniformMatrix4fv(e.modelViewMatrix,!1,e.modelViewMatrixArray),n.uniformMatrix4fv(e.projectionMatrix,!1,e.projectionMatrixArray),n.uniformMatrix3fv(e.normalMatrix,!1,e.normalMatrixArray),n.uniformMatrix4fv(e.objMatrix,!1,new Float32Array(t.matrix.flatten()))},this.setBlending=function(t){switch(t){case THREE.AdditiveBlending:n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ONE);break;case THREE.SubtractiveBlending:n.blendFunc(n.DST_COLOR,n.ZERO);break;default:n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)}},this.setFaceCulling=function(t,i){t?(i&&"ccw"!=i?n.frontFace(n.CW):n.frontFace(n.CCW),"back"==t?n.cullFace(n.BACK):"front"==t?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK),n.enable(n.CULL_FACE)):n.disable(n.CULL_FACE)}},THREE.RenderableFace3=function(){this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.v3=new THREE.Vertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.material=this.color=this.z=null},THREE.RenderableFace4=function(){this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.v3=new THREE.Vertex,this.v4=new THREE.Vertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.material=this.color=this.z=null},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.material=this.color=null},THREE.RenderableLine=function(){this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.material=this.color=this.z=null};