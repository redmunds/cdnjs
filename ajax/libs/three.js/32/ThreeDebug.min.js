var THREE=THREE||{};THREE.Color=function(t){this.autoUpdate=!0,this.setHex(t)},THREE.Color.prototype={setRGB:function(t,i,e){this.r=t,this.g=i,this.b=e,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(t){this.hex=16777215&~~t,this.autoUpdate&&(this.updateRGBA(),this.updateStyleString())},updateHex:function(){this.hex=~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},updateRGBA:function(){this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgb("+~~(255*this.r)+","+~~(255*this.g)+","+~~(255*this.b)+")"},clone:function(){return new THREE.Color(this.hex)},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}},THREE.Vector2=function(t,i){this.x=t||0,this.y=i||0},THREE.Vector2.prototype={set:function(t,i){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},THREE.Vector3=function(t,i,e){this.x=t||0,this.y=i||0,this.z=e||0},THREE.Vector3.prototype={set:function(t,i,e){return this.x=t,this.y=i,this.z=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},cross:function(t,i){return this.x=t.y*i.z-t.z*i.y,this.y=t.z*i.x-t.x*i.z,this.z=t.x*i.y-t.y*i.x,this},crossSelf:function(t){var i=this.x,e=this.y,n=this.z;return this.x=e*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-e*t.x,this},multiply:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},multiplySelf:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},distanceTo:function(t){var i=this.x-t.x,e=this.y-t.y;return t=this.z-t.z,Math.sqrt(i*i+e*e+t*t)},distanceToSquared:function(t){var i=this.x-t.x,e=this.y-t.y;return t=this.z-t.z,i*i+e*e+t*t},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0?this.multiplyScalar(1/t):this.set(0,0,0),this},setLength:function(t){return this.normalize().multiplyScalar(t)},isZero:function(){return Math.abs(this.x)<1e-4&&Math.abs(this.y)<1e-4&&Math.abs(this.z)<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},THREE.Vector4=function(t,i,e,n){this.x=t||0,this.y=i||0,this.z=e||0,this.w=n||1},THREE.Vector4.prototype={set:function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w||1,this},add:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},addSelf:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},sub:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},subSelf:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},divideScalar:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},lerpSelf:function(t,i){this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},THREE.Ray=function(t,i){this.origin=t||new THREE.Vector3,this.direction=i||new THREE.Vector3},THREE.Ray.prototype={intersectScene:function(t){var i,e,n=t.objects,r=[];for(t=0,i=n.length;t<i;t++)e=n[t],e instanceof THREE.Mesh&&(r=r.concat(this.intersectObject(e)));return r.sort(function(t,i){return t.distance-i.distance}),r},intersectObject:function(t){function i(t,i,e,n){n=n.clone().subSelf(i),e=e.clone().subSelf(i);var r=t.clone().subSelf(i);t=n.dot(n),i=n.dot(e),n=n.dot(r);var o=e.dot(e);return e=e.dot(r),r=1/(t*o-i*i),o=(o*n-i*e)*r,t=(t*e-i*n)*r,o>0&&t>0&&o+t<1}var e,n,r,o,s,a,h,l,c,f,E,p=t.geometry,m=p.vertices,u=[];for(e=0,n=p.faces.length;e<n;e++)r=p.faces[e],f=this.origin.clone(),E=this.direction.clone(),o=t.matrix.multiplyVector3(m[r.a].position.clone()),s=t.matrix.multiplyVector3(m[r.b].position.clone()),a=t.matrix.multiplyVector3(m[r.c].position.clone()),h=r instanceof THREE.Face4?t.matrix.multiplyVector3(m[r.d].position.clone()):null,l=t.rotationMatrix.multiplyVector3(r.normal.clone()),c=E.dot(l),c<0&&(l=l.dot((new THREE.Vector3).sub(o,f))/c,f=f.addSelf(E.multiplyScalar(l)),r instanceof THREE.Face3?i(f,o,s,a)&&(r={distance:this.origin.distanceTo(f),point:f,face:r,object:t},u.push(r)):r instanceof THREE.Face4&&(i(f,o,s,h)||i(f,s,a,h))&&(r={distance:this.origin.distanceTo(f),point:f,face:r,object:t},u.push(r)));return u}},THREE.Rectangle=function(){function t(){o=n-i,s=r-e}var i,e,n,r,o,s,a=!0;this.getX=function(){return i},this.getY=function(){return e},this.getWidth=function(){return o},this.getHeight=function(){return s},this.getLeft=function(){return i},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(o,s,h,l){a=!1,i=o,e=s,n=h,r=l,t()},this.addPoint=function(o,s){a?(a=!1,i=o,e=s,n=o,r=s):(i=i<o?i:o,e=e<s?e:s,n=n>o?n:o,r=r>s?r:s),t()},this.add3Points=function(o,s,h,l,c,f){a?(a=!1,i=o<h?o<c?o:c:h<c?h:c,e=s<l?s<f?s:f:l<f?l:f,n=o>h?o>c?o:c:h>c?h:c,r=s>l?s>f?s:f:l>f?l:f):(i=o<h?o<c?o<i?o:i:c<i?c:i:h<c?h<i?h:i:c<i?c:i,e=s<l?s<f?s<e?s:e:f<e?f:e:l<f?l<e?l:e:f<e?f:e,n=o>h?o>c?o>n?o:n:c>n?c:n:h>c?h>n?h:n:c>n?c:n,r=s>l?s>f?s>r?s:r:f>r?f:r:l>f?l>r?l:r:f>r?f:r),t()},this.addRectangle=function(o){a?(a=!1,i=o.getLeft(),e=o.getTop(),n=o.getRight(),r=o.getBottom()):(i=i<o.getLeft()?i:o.getLeft(),e=e<o.getTop()?e:o.getTop(),n=n>o.getRight()?n:o.getRight(),r=r>o.getBottom()?r:o.getBottom()),t()},this.inflate=function(o){i-=o,e-=o,n+=o,r+=o,t()},this.minSelf=function(o){i=i>o.getLeft()?i:o.getLeft(),e=e>o.getTop()?e:o.getTop(),n=n<o.getRight()?n:o.getRight(),r=r<o.getBottom()?r:o.getBottom(),t()},this.instersects=function(t){return Math.min(n,t.getRight())-Math.max(i,t.getLeft())>=0&&Math.min(r,t.getBottom())-Math.max(e,t.getTop())>=0},this.empty=function(){a=!0,r=n=e=i=0,t()},this.isEmpty=function(){return a},this.toString=function(){return"THREE.Rectangle ( left: "+i+", right: "+n+", top: "+e+", bottom: "+r+", width: "+o+", height: "+s+" )"}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={transpose:function(){var t;return t=this.m[1],this.m[1]=this.m[3],this.m[3]=t,t=this.m[2],this.m[2]=this.m[6],this.m[6]=t,t=this.m[5],this.m[5]=this.m[7],this.m[7]=t,this}},THREE.Matrix4=function(t,i,e,n,r,o,s,a,h,l,c,f,E,p,m,u){this.n11=t||1,this.n12=i||0,this.n13=e||0,this.n14=n||0,this.n21=r||0,this.n22=o||1,this.n23=s||0,this.n24=a||0,this.n31=h||0,this.n32=l||0,this.n33=c||1,this.n34=f||0,this.n41=E||0,this.n42=p||0,this.n43=m||0,this.n44=u||1},THREE.Matrix4.prototype={identity:function(){return this.n11=1,this.n21=this.n14=this.n13=this.n12=0,this.n22=1,this.n32=this.n31=this.n24=this.n23=0,this.n33=1,this.n43=this.n42=this.n41=this.n34=0,this.n44=1,this},set:function(t,i,e,n,r,o,s,a,h,l,c,f,E,p,m,u){return this.n11=t,this.n12=i,this.n13=e,this.n14=n,this.n21=r,this.n22=o,this.n23=s,this.n24=a,this.n31=h,this.n32=l,this.n33=c,this.n34=f,this.n41=E,this.n42=p,this.n43=m,this.n44=u,this},copy:function(t){return this.n11=t.n11,this.n12=t.n12,this.n13=t.n13,this.n14=t.n14,this.n21=t.n21,this.n22=t.n22,this.n23=t.n23,this.n24=t.n24,this.n31=t.n31,this.n32=t.n32,this.n33=t.n33,this.n34=t.n34,this.n41=t.n41,this.n42=t.n42,this.n43=t.n43,this.n44=t.n44,this},lookAt:function(t,i,e){var n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3;return o.sub(t,i).normalize(),n.cross(e,o).normalize(),r.cross(o,n).normalize(),this.n11=n.x,this.n12=n.y,this.n13=n.z,this.n14=-n.dot(t),this.n21=r.x,this.n22=r.y,this.n23=r.z,this.n24=-r.dot(t),this.n31=o.x,this.n32=o.y,this.n33=o.z,this.n34=-o.dot(t),this.n43=this.n42=this.n41=0,this.n44=1,this},multiplyVector3:function(t){var i=t.x,e=t.y,n=t.z,r=1/(this.n41*i+this.n42*e+this.n43*n+this.n44);return t.x=(this.n11*i+this.n12*e+this.n13*n+this.n14)*r,t.y=(this.n21*i+this.n22*e+this.n23*n+this.n24)*r,t.z=(this.n31*i+this.n32*e+this.n33*n+this.n34)*r,t},multiplyVector4:function(t){var i=t.x,e=t.y,n=t.z,r=t.w;return t.x=this.n11*i+this.n12*e+this.n13*n+this.n14*r,t.y=this.n21*i+this.n22*e+this.n23*n+this.n24*r,t.z=this.n31*i+this.n32*e+this.n33*n+this.n34*r,t.w=this.n41*i+this.n42*e+this.n43*n+this.n44*r,t},crossVector:function(t){var i=new THREE.Vector4;return i.x=this.n11*t.x+this.n12*t.y+this.n13*t.z+this.n14*t.w,i.y=this.n21*t.x+this.n22*t.y+this.n23*t.z+this.n24*t.w,i.z=this.n31*t.x+this.n32*t.y+this.n33*t.z+this.n34*t.w,i.w=t.w?this.n41*t.x+this.n42*t.y+this.n43*t.z+this.n44*t.w:1,i},multiply:function(t,i){var e=t.n11,n=t.n12,r=t.n13,o=t.n14,s=t.n21,a=t.n22,h=t.n23,l=t.n24,c=t.n31,f=t.n32,E=t.n33,p=t.n34,m=t.n41,u=t.n42,g=t.n43,d=t.n44,v=i.n11,R=i.n12,T=i.n13,y=i.n14,_=i.n21,b=i.n22,x=i.n23,H=i.n24,S=i.n31,w=i.n32,M=i.n33,L=i.n34,A=i.n41,z=i.n42,P=i.n43,C=i.n44;return this.n11=e*v+n*_+r*S+o*A,this.n12=e*R+n*b+r*w+o*z,this.n13=e*T+n*x+r*M+o*P,this.n14=e*y+n*H+r*L+o*C,this.n21=s*v+a*_+h*S+l*A,this.n22=s*R+a*b+h*w+l*z,this.n23=s*T+a*x+h*M+l*P,this.n24=s*y+a*H+h*L+l*C,this.n31=c*v+f*_+E*S+p*A,this.n32=c*R+f*b+E*w+p*z,this.n33=c*T+f*x+E*M+p*P,this.n34=c*y+f*H+E*L+p*C,this.n41=m*v+u*_+g*S+d*A,this.n42=m*R+u*b+g*w+d*z,this.n43=m*T+u*x+g*M+d*P,this.n44=m*y+u*H+g*L+d*C,this},multiplySelf:function(t){var i=this.n11,e=this.n12,n=this.n13,r=this.n14,o=this.n21,s=this.n22,a=this.n23,h=this.n24,l=this.n31,c=this.n32,f=this.n33,E=this.n34,p=this.n41,m=this.n42,u=this.n43,g=this.n44,d=t.n11,v=t.n21,R=t.n31,T=t.n41,y=t.n12,_=t.n22,b=t.n32,x=t.n42,H=t.n13,S=t.n23,w=t.n33,M=t.n43,L=t.n14,A=t.n24,z=t.n34;return t=t.n44,this.n11=i*d+e*v+n*R+r*T,this.n12=i*y+e*_+n*b+r*x,this.n13=i*H+e*S+n*w+r*M,this.n14=i*L+e*A+n*z+r*t,this.n21=o*d+s*v+a*R+h*T,this.n22=o*y+s*_+a*b+h*x,this.n23=o*H+s*S+a*w+h*M,this.n24=o*L+s*A+a*z+h*t,this.n31=l*d+c*v+f*R+E*T,this.n32=l*y+c*_+f*b+E*x,this.n33=l*H+c*S+f*w+E*M,this.n34=l*L+c*A+f*z+E*t,this.n41=p*d+m*v+u*R+g*T,this.n42=p*y+m*_+u*b+g*x,this.n43=p*H+m*S+u*w+g*M,this.n44=p*L+m*A+u*z+g*t,this},multiplyScalar:function(t){return this.n11*=t,this.n12*=t,this.n13*=t,this.n14*=t,this.n21*=t,this.n22*=t,this.n23*=t,this.n24*=t,this.n31*=t,this.n32*=t,this.n33*=t,this.n34*=t,this.n41*=t,this.n42*=t,this.n43*=t,this.n44*=t,this},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function t(t,i,e){var n=t[i];t[i]=t[e],t[e]=n}return t(this,"n21","n12"),t(this,"n31","n13"),t(this,"n32","n23"),t(this,"n41","n14"),t(this,"n42","n24"),t(this,"n43","n34"),this},clone:function(){var t=new THREE.Matrix4;return t.n11=this.n11,t.n12=this.n12,t.n13=this.n13,t.n14=this.n14,t.n21=this.n21,t.n22=this.n22,t.n23=this.n23,t.n24=this.n24,t.n31=this.n31,t.n32=this.n32,t.n33=this.n33,t.n34=this.n34,t.n41=this.n41,t.n42=this.n42,t.n43=this.n43,t.n44=this.n44,t},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},THREE.Matrix4.translationMatrix=function(t,i,e){var n=new THREE.Matrix4;return n.n14=t,n.n24=i,n.n34=e,n},THREE.Matrix4.scaleMatrix=function(t,i,e){var n=new THREE.Matrix4;return n.n11=t,n.n22=i,n.n33=e,n},THREE.Matrix4.rotationXMatrix=function(t){var i=new THREE.Matrix4;return i.n22=i.n33=Math.cos(t),i.n32=Math.sin(t),i.n23=-i.n32,i},THREE.Matrix4.rotationYMatrix=function(t){var i=new THREE.Matrix4;return i.n11=i.n33=Math.cos(t),i.n13=Math.sin(t),i.n31=-i.n13,i},THREE.Matrix4.rotationZMatrix=function(t){var i=new THREE.Matrix4;return i.n11=i.n22=Math.cos(t),i.n21=Math.sin(t),i.n12=-i.n21,i},THREE.Matrix4.rotationAxisAngleMatrix=function(t,i){var e=new THREE.Matrix4,n=Math.cos(i),r=Math.sin(i),o=1-n,s=t.x,a=t.y,h=t.z;return e.n11=o*s*s+n,e.n12=o*s*a-r*h,e.n13=o*s*h+r*a,e.n21=o*s*a+r*h,e.n22=o*a*a+n,e.n23=o*a*h-r*s,e.n31=o*s*h-r*a,e.n32=o*a*h+r*s,e.n33=o*h*h+n,e},THREE.Matrix4.makeInvert=function(t){var i=new THREE.Matrix4;return i.n11=t.n23*t.n34*t.n42-t.n24*t.n33*t.n42+t.n24*t.n32*t.n43-t.n22*t.n34*t.n43-t.n23*t.n32*t.n44+t.n22*t.n33*t.n44,i.n12=t.n14*t.n33*t.n42-t.n13*t.n34*t.n42-t.n14*t.n32*t.n43+t.n12*t.n34*t.n43+t.n13*t.n32*t.n44-t.n12*t.n33*t.n44,i.n13=t.n13*t.n24*t.n42-t.n14*t.n23*t.n42+t.n14*t.n22*t.n43-t.n12*t.n24*t.n43-t.n13*t.n22*t.n44+t.n12*t.n23*t.n44,i.n14=t.n14*t.n23*t.n32-t.n13*t.n24*t.n32-t.n14*t.n22*t.n33+t.n12*t.n24*t.n33+t.n13*t.n22*t.n34-t.n12*t.n23*t.n34,i.n21=t.n24*t.n33*t.n41-t.n23*t.n34*t.n41-t.n24*t.n31*t.n43+t.n21*t.n34*t.n43+t.n23*t.n31*t.n44-t.n21*t.n33*t.n44,i.n22=t.n13*t.n34*t.n41-t.n14*t.n33*t.n41+t.n14*t.n31*t.n43-t.n11*t.n34*t.n43-t.n13*t.n31*t.n44+t.n11*t.n33*t.n44,i.n23=t.n14*t.n23*t.n41-t.n13*t.n24*t.n41-t.n14*t.n21*t.n43+t.n11*t.n24*t.n43+t.n13*t.n21*t.n44-t.n11*t.n23*t.n44,i.n24=t.n13*t.n24*t.n31-t.n14*t.n23*t.n31+t.n14*t.n21*t.n33-t.n11*t.n24*t.n33-t.n13*t.n21*t.n34+t.n11*t.n23*t.n34,i.n31=t.n22*t.n34*t.n41-t.n24*t.n32*t.n41+t.n24*t.n31*t.n42-t.n21*t.n34*t.n42-t.n22*t.n31*t.n44+t.n21*t.n32*t.n44,i.n32=t.n14*t.n32*t.n41-t.n12*t.n34*t.n41-t.n14*t.n31*t.n42+t.n11*t.n34*t.n42+t.n12*t.n31*t.n44-t.n11*t.n32*t.n44,i.n33=t.n13*t.n24*t.n41-t.n14*t.n22*t.n41+t.n14*t.n21*t.n42-t.n11*t.n24*t.n42-t.n12*t.n21*t.n44+t.n11*t.n22*t.n44,i.n34=t.n14*t.n22*t.n31-t.n12*t.n24*t.n31-t.n14*t.n21*t.n32+t.n11*t.n24*t.n32+t.n12*t.n21*t.n34-t.n11*t.n22*t.n34,i.n41=t.n23*t.n32*t.n41-t.n22*t.n33*t.n41-t.n23*t.n31*t.n42+t.n21*t.n33*t.n42+t.n22*t.n31*t.n43-t.n21*t.n32*t.n43,i.n42=t.n12*t.n33*t.n41-t.n13*t.n32*t.n41+t.n13*t.n31*t.n42-t.n11*t.n33*t.n42-t.n12*t.n31*t.n43+t.n11*t.n32*t.n43,i.n43=t.n13*t.n22*t.n41-t.n12*t.n23*t.n41-t.n13*t.n21*t.n42+t.n11*t.n23*t.n42+t.n12*t.n21*t.n43-t.n11*t.n22*t.n43,i.n44=t.n12*t.n23*t.n31-t.n13*t.n22*t.n31+t.n13*t.n21*t.n32-t.n11*t.n23*t.n32-t.n12*t.n21*t.n33+t.n11*t.n22*t.n33,i.multiplyScalar(1/t.determinant()),i},THREE.Matrix4.makeInvert3x3=function(t){var i=t.flatten();t=new THREE.Matrix3;var e=i[10]*i[5]-i[6]*i[9],n=-i[10]*i[1]+i[2]*i[9],r=i[6]*i[1]-i[2]*i[5],o=-i[10]*i[4]+i[6]*i[8],s=i[10]*i[0]-i[2]*i[8],a=-i[6]*i[0]+i[2]*i[4],h=i[9]*i[4]-i[5]*i[8],l=-i[9]*i[0]+i[1]*i[8],c=i[5]*i[0]-i[1]*i[4];if(i=i[0]*e+i[1]*o+i[2]*h,0==i)throw"matrix not invertible";return i=1/i,t.m[0]=i*e,t.m[1]=i*n,t.m[2]=i*r,t.m[3]=i*o,t.m[4]=i*s,t.m[5]=i*a,t.m[6]=i*h,t.m[7]=i*l,t.m[8]=i*c,t},THREE.Matrix4.makeFrustum=function(t,i,e,n,r,o){var s,a,h;return s=new THREE.Matrix4,a=2*r/(i-t),h=2*r/(n-e),t=(i+t)/(i-t),e=(n+e)/(n-e),n=-(o+r)/(o-r),r=-2*o*r/(o-r),s.n11=a,s.n12=0,s.n13=t,s.n14=0,s.n21=0,s.n22=h,s.n23=e,s.n24=0,s.n31=0,s.n32=0,s.n33=n,s.n34=r,s.n41=0,s.n42=0,s.n43=-1,s.n44=0,s},THREE.Matrix4.makePerspective=function(t,i,e,n){var r;return t=e*Math.tan(t*Math.PI/360),r=-t,THREE.Matrix4.makeFrustum(r*i,t*i,r,t,e,n)},THREE.Matrix4.makeOrtho=function(t,i,e,n,r,o){var s,a,h,l;return s=new THREE.Matrix4,a=i-t,h=e-n,l=o-r,t=(i+t)/a,e=(e+n)/h,r=(o+r)/l,s.n11=2/a,s.n12=0,s.n13=0,s.n14=-t,s.n21=0,s.n22=2/h,s.n23=0,s.n24=-e,s.n31=0,s.n32=0,s.n33=-2/l,s.n34=-r,s.n41=0,s.n42=0,s.n43=0,s.n44=1,s},THREE.Vertex=function(t,i){this.position=t||new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.normal=i||new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.normalScreen=new THREE.Vector3,this.tangent=new THREE.Vector4,this.__visible=!0},THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},THREE.Face3=function(t,i,e,n,r){this.a=t,this.b=i,this.c=e,this.centroid=new THREE.Vector3,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.materials=r instanceof Array?r:[r]},THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},THREE.Face4=function(t,i,e,n,r,o){this.a=t,this.b=i,this.c=e,this.d=n,this.centroid=new THREE.Vector3,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.materials=o instanceof Array?o:[o]},THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},THREE.UV=function(t,i){this.u=t||0,this.v=i||0},THREE.UV.prototype={copy:function(t){this.u=t.u,this.v=t.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},THREE.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[],this.boundingSphere=this.boundingBox=null,this.geometryChunks={},this.hasTangents=!1},THREE.Geometry.prototype={computeCentroids:function(){var t,i,e;for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],e.centroid.set(0,0,0),e instanceof THREE.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof THREE.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeFaceNormals:function(t){var i,e,n,r,o,s,a=new THREE.Vector3,h=new THREE.Vector3;for(n=0,r=this.vertices.length;n<r;n++)o=this.vertices[n],o.normal.set(0,0,0);for(n=0,r=this.faces.length;n<r;n++){if(o=this.faces[n],t&&o.vertexNormals.length){for(a.set(0,0,0),i=0,e=o.normal.length;i<e;i++)a.addSelf(o.vertexNormals[i]);a.divideScalar(3)}else i=this.vertices[o.a],e=this.vertices[o.b],s=this.vertices[o.c],a.sub(s.position,e.position),h.sub(i.position,e.position),a.crossSelf(h);a.isZero()||a.normalize(),o.normal.copy(a)}},computeVertexNormals:function(){var t,i,e,n=[];for(t=0,i=this.vertices.length;t<i;t++)n[t]=new THREE.Vector3;for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],e instanceof THREE.Face3?(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal)):e instanceof THREE.Face4&&(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal),n[e.d].addSelf(e.normal));for(t=0,i=this.vertices.length;t<i;t++)n[t].normalize();for(t=0,i=this.faces.length;t<i;t++)e=this.faces[t],e instanceof THREE.Face3?(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone()):e instanceof THREE.Face4&&(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone(),e.vertexNormals[3]=n[e.d].clone())},computeTangents:function(){function t(t,i,e,n,S,w,M){o=t.vertices[i].position,s=t.vertices[e].position,a=t.vertices[n].position,h=r[S],l=r[w],c=r[M],f=s.x-o.x,E=a.x-o.x,p=s.y-o.y,m=a.y-o.y,u=s.z-o.z,g=a.z-o.z,d=l.u-h.u,v=c.u-h.u,R=l.v-h.v,T=c.v-h.v,y=1/(d*T-v*R),x.set((T*f-R*E)*y,(T*p-R*m)*y,(T*u-R*g)*y),H.set((d*E-v*f)*y,(d*m-v*p)*y,(d*g-v*u)*y),_[i].addSelf(x),_[e].addSelf(x),_[n].addSelf(x),b[i].addSelf(H),b[e].addSelf(H),b[n].addSelf(H)}var i,e,n,r,o,s,a,h,l,c,f,E,p,m,u,g,d,v,R,T,y,_=[],b=[],x=new THREE.Vector3,H=new THREE.Vector3,S=new THREE.Vector3,w=new THREE.Vector3,M=new THREE.Vector3;for(i=0,e=this.vertices.length;i<e;i++)_[i]=new THREE.Vector3,b[i]=new THREE.Vector3;for(i=0,e=this.faces.length;i<e;i++)n=this.faces[i],r=this.uvs[i],n instanceof THREE.Face3?(t(this,n.a,n.b,n.c,0,1,2),this.vertices[n.a].normal.copy(n.vertexNormals[0]),this.vertices[n.b].normal.copy(n.vertexNormals[1]),this.vertices[n.c].normal.copy(n.vertexNormals[2])):n instanceof THREE.Face4&&(t(this,n.a,n.b,n.c,0,1,2),t(this,n.a,n.b,n.d,0,1,3),this.vertices[n.a].normal.copy(n.vertexNormals[0]),this.vertices[n.b].normal.copy(n.vertexNormals[1]),this.vertices[n.c].normal.copy(n.vertexNormals[2]),this.vertices[n.d].normal.copy(n.vertexNormals[3]));for(i=0,e=this.vertices.length;i<e;i++)M.copy(this.vertices[i].normal),n=_[i],S.copy(n),S.subSelf(M.multiplyScalar(M.dot(n))).normalize(),w.cross(this.vertices[i].normal,n),n=w.dot(b[i]),n=n<0?-1:1,this.vertices[i].tangent.set(S.x,S.y,S.z,n);this.hasTangents=!0},computeBoundingBox:function(){var t;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var i=1,e=this.vertices.length;i<e;i++)t=this.vertices[i],t.position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=t.position.x:t.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=t.position.x),t.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=t.position.y:t.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=t.position.y),t.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=t.position.z:t.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=t.position.z)}},computeBoundingSphere:function(){for(var t=null===this.boundingSphere?0:this.boundingSphere.radius,i=0,e=this.vertices.length;i<e;i++)t=Math.max(t,this.vertices[i].position.length());this.boundingSphere={radius:t}},sortFacesByMaterial:function(){function t(t){var n=[];for(i=0,e=t.length;i<e;i++)void 0==t[i]?n.push("undefined"):n.push(t[i].toString());return n.join("_")}var i,e,n,r,o,s,a,h,l={};for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s=o.materials,a=t(s),void 0==l[a]&&(l[a]={hash:a,counter:0}),h=l[a].hash+"_"+l[a].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],materials:s,vertices:0}),o=o instanceof THREE.Face3?3:4,this.geometryChunks[h].vertices+o>65535&&(l[a].counter+=1,h=l[a].hash+"_"+l[a].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],materials:s,vertices:0})),this.geometryChunks[h].faces.push(n),this.geometryChunks[h].vertices+=o},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+", uvs: "+this.uvs+" )"}},THREE.Camera=function(t,i,e,n){this.fov=t,this.aspect=i,this.near=e,this.far=n,this.position=new THREE.Vector3,this.target={position:new THREE.Vector3},this.autoUpdateMatrix=!0,this.projectionMatrix=null,this.matrix=new THREE.Matrix4,this.up=new THREE.Vector3(0,1,0),this.translateX=function(t){t=this.target.position.clone().subSelf(this.position).normalize().multiplyScalar(t),t.cross(t.clone(),this.up),this.position.addSelf(t),this.target.position.addSelf(t)},this.translateZ=function(t){t=this.target.position.clone().subSelf(this.position).normalize().multiplyScalar(t),this.position.subSelf(t),this.target.position.subSelf(t)},this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},this.updateProjectionMatrix()},THREE.Camera.prototype={toString:function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},THREE.Light=function(t){this.color=new THREE.Color(t)},THREE.AmbientLight=function(t){THREE.Light.call(this,t)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(t,i){THREE.Light.call(this,t),this.position=new THREE.Vector3(0,1,0),this.intensity=i||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(t,i){THREE.Light.call(this,t),this.position=new THREE.Vector3,this.intensity=i||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.PointLight,THREE.Object3D=function(){this.id=THREE.Object3DCounter.value++,this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.matrix=new THREE.Matrix4,this.translationMatrix=new THREE.Matrix4,this.rotationMatrix=new THREE.Matrix4,this.scaleMatrix=new THREE.Matrix4,this.screen=new THREE.Vector3,this.visible=this.autoUpdateMatrix=!0},THREE.Object3D.prototype={updateMatrix:function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z),this.rotationMatrix=THREE.Matrix4.rotationXMatrix(this.rotation.x),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y)),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z)),this.scaleMatrix=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z),this.matrix.copy(this.matrixPosition),this.matrix.multiplySelf(this.rotationMatrix),this.matrix.multiplySelf(this.scaleMatrix)}},THREE.Object3DCounter={value:0},THREE.Particle=function(t){THREE.Object3D.call(this),this.materials=t instanceof Array?t:[t],this.autoUpdateMatrix=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(t,i){THREE.Object3D.call(this),this.geometry=t,this.materials=i instanceof Array?i:[i]},THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(t,i){THREE.Object3D.call(this),this.geometry=t,this.materials=i instanceof Array?i:[i],this.overdraw=this.doubleSided=this.flipSided=!1,this.geometry.boundingSphere||this.geometry.computeBoundingSphere()},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.FlatShading=0,THREE.SmoothShading=1,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.LineBasicMaterial=function(t){this.color=new THREE.Color(16777215),this.opacity=1,this.blending=THREE.NormalBlending,this.linewidth=1,this.linejoin=this.linecap="round",t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.linewidth&&(this.linewidth=t.linewidth),void 0!==t.linecap&&(this.linecap=t.linecap),void 0!==t.linejoin&&(this.linejoin=t.linejoin))},THREE.LineBasicMaterial.prototype={toString:function(){return"THREE.LineBasicMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>linewidth: "+this.linewidth+"<br/>linecap: "+this.linecap+"<br/>linejoin: "+this.linejoin+"<br/>)"}},THREE.MeshBasicMaterial=function(t){this.id=THREE.MeshBasicMaterialCounter.value++,this.color=new THREE.Color(16777215),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.fog=!0,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.env_map&&(this.env_map=t.env_map),void 0!==t.combine&&(this.combine=t.combine),void 0!==t.reflectivity&&(this.reflectivity=t.reflectivity),void 0!==t.refraction_ratio&&(this.refraction_ratio=t.refraction_ratio),void 0!==t.fog&&(this.fog=t.fog),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin))},THREE.MeshBasicMaterial.prototype={toString:function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshBasicMaterialCounter={value:0},THREE.MeshLambertMaterial=function(t){this.id=THREE.MeshLambertMaterialCounter.value++,this.color=new THREE.Color(16777215),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.fog=!0,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.env_map&&(this.env_map=t.env_map),void 0!==t.combine&&(this.combine=t.combine),void 0!==t.reflectivity&&(this.reflectivity=t.reflectivity),void 0!==t.refraction_ratio&&(this.refraction_ratio=t.refraction_ratio),void 0!==t.fog&&(this.fog=t.fog),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin))},THREE.MeshLambertMaterial.prototype={toString:function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/> )";
}},THREE.MeshLambertMaterialCounter={value:0},THREE.MeshPhongMaterial=function(t){this.id=THREE.MeshPhongMaterialCounter.value++,this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(328965),this.specular=new THREE.Color(1118481),this.shininess=30,this.env_map=this.specular_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.fog=!0,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.color&&(this.color=new THREE.Color(t.color)),void 0!==t.ambient&&(this.ambient=new THREE.Color(t.ambient)),void 0!==t.specular&&(this.specular=new THREE.Color(t.specular)),void 0!==t.shininess&&(this.shininess=t.shininess),void 0!==t.map&&(this.map=t.map),void 0!==t.specular_map&&(this.specular_map=t.specular_map),void 0!==t.env_map&&(this.env_map=t.env_map),void 0!==t.combine&&(this.combine=t.combine),void 0!==t.reflectivity&&(this.reflectivity=t.reflectivity),void 0!==t.refraction_ratio&&(this.refraction_ratio=t.refraction_ratio),void 0!==t.fog&&(this.fog=t.fog),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin))},THREE.MeshPhongMaterial.prototype={toString:function(){return"THREE.MeshPhongMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>shininess: "+this.shininess+"<br/>map: "+this.map+"<br/>specular_map: "+this.specular_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshPhongMaterialCounter={value:0},THREE.MeshDepthMaterial=function(t){this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending))},THREE.MeshDepthMaterial.prototype={toString:function(){return"THREE.MeshDepthMaterial"}},THREE.MeshNormalMaterial=function(t){this.opacity=1,this.shading=THREE.FlatShading,this.blending=THREE.NormalBlending,t&&(void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending))},THREE.MeshNormalMaterial.prototype={toString:function(){return"THREE.MeshNormalMaterial"}},THREE.MeshFaceMaterial=function(){},THREE.MeshFaceMaterial.prototype={toString:function(){return"THREE.MeshFaceMaterial"}},THREE.MeshShaderMaterial=function(t){this.id=THREE.MeshShaderMaterialCounter.value++,this.vertex_shader=this.fragment_shader="void main() {}",this.uniforms={},this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",t&&(void 0!==t.fragment_shader&&(this.fragment_shader=t.fragment_shader),void 0!==t.vertex_shader&&(this.vertex_shader=t.vertex_shader),void 0!==t.uniforms&&(this.uniforms=t.uniforms),void 0!==t.shading&&(this.shading=t.shading),void 0!==t.blending&&(this.blending=t.blending),void 0!==t.wireframe&&(this.wireframe=t.wireframe),void 0!==t.wireframe_linewidth&&(this.wireframe_linewidth=t.wireframe_linewidth),void 0!==t.wireframe_linecap&&(this.wireframe_linecap=t.wireframe_linecap),void 0!==t.wireframe_linejoin&&(this.wireframe_linejoin=t.wireframe_linejoin))},THREE.MeshShaderMaterial.prototype={toString:function(){return"THREE.MeshShaderMaterial (<br/>id: "+this.id+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshShaderMaterialCounter={value:0},THREE.ParticleBasicMaterial=function(t){this.color=new THREE.Color(16777215),this.map=null,this.opacity=1,this.blending=THREE.NormalBlending,this.offset=new THREE.Vector2,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.map&&(this.map=t.map),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending))},THREE.ParticleBasicMaterial.prototype={toString:function(){return"THREE.ParticleBasicMaterial (<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleCircleMaterial=function(t){this.color=new THREE.Color(16777215),this.opacity=1,this.blending=THREE.NormalBlending,t&&(void 0!==t.color&&this.color.setHex(t.color),void 0!==t.opacity&&(this.opacity=t.opacity),void 0!==t.blending&&(this.blending=t.blending))},THREE.ParticleCircleMaterial.prototype={toString:function(){return"THREE.ParticleCircleMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleDOMMaterial=function(t){this.domElement=t},THREE.ParticleDOMMaterial.prototype={toString:function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}},THREE.Texture=function(t,i,e,n,r,o){this.image=t,this.mapping=void 0!==i?i:new THREE.UVMapping,this.wrap_s=void 0!==e?e:THREE.ClampToEdgeWrapping,this.wrap_t=void 0!==n?n:THREE.ClampToEdgeWrapping,this.mag_filter=void 0!==r?r:THREE.LinearFilter,this.min_filter=void 0!==o?o:THREE.LinearMipMapLinearFilter},THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrap_s,this.wrap_t,this.mag_filter,this.min_filter)},toString:function(){return"THREE.Texture (<br/>image: "+this.image+"<br/>wrap_s: "+this.wrap_s+"<br/>wrap_t: "+this.wrap_t+"<br/>mag_filter: "+this.mag_filter+"<br/>min_filter: "+this.min_filter+"<br/>)"}},THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8;var Uniforms={clone:function(t){var i,e,n,r={};for(i in t){r[i]={};for(e in t[i])n=t[i][e],r[i][e]=n instanceof THREE.Color||n instanceof THREE.Vector3||n instanceof THREE.Texture?n.clone():n}return r},merge:function(t){var i,e,n,r={};for(i=0;i<t.length;i++){n=this.clone(t[i]);for(e in n)r[e]=n[e]}return r}};THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.Scene=function(){this.objects=[],this.lights=[],this.fog=null,this.addObject=function(t){this.objects.indexOf(t)===-1&&this.objects.push(t)},this.removeObject=function(t){t=this.objects.indexOf(t),t!==-1&&this.objects.splice(t,1)},this.addLight=function(t){this.lights.indexOf(t)===-1&&this.lights.push(t)},this.removeLight=function(t){t=this.lights.indexOf(t),t!==-1&&this.lights.splice(t,1)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},THREE.Fog=function(t,i,e){this.color=new THREE.Color(t),this.near=i||1,this.far=e||1e3},THREE.FogExp2=function(t,i){this.color=new THREE.Color(t),this.density=i||25e-5},THREE.Projector=function(){function t(t,i){return i.z-t.z}function i(t,i){var e=0,n=1,r=t.z+t.w,o=i.z+i.w,s=-t.z+t.w,a=-i.z+i.w;return r>=0&&o>=0&&s>=0&&a>=0||!(r<0&&o<0||s<0&&a<0)&&(r<0?e=Math.max(e,r/(r-o)):o<0&&(n=Math.min(n,r/(r-o))),s<0?e=Math.max(e,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<e)&&(t.lerpSelf(i,e),i.lerpSelf(t,1-n),!0))}var e,n,r,o,s,a,h,l,c,f,E=[],p=[],m=[],u=[],g=new THREE.Vector4,d=new THREE.Vector4,v=new THREE.Matrix4,R=new THREE.Matrix4,T=[],y=new THREE.Vector4,_=new THREE.Vector4;this.projectObjects=function(i,r,o){var s,a,h=[];for(n=0,v.multiply(r.projectionMatrix,r.matrix),T[0]=new THREE.Vector4(v.n41-v.n11,v.n42-v.n12,v.n43-v.n13,v.n44-v.n14),T[1]=new THREE.Vector4(v.n41+v.n11,v.n42+v.n12,v.n43+v.n13,v.n44+v.n14),T[2]=new THREE.Vector4(v.n41+v.n21,v.n42+v.n22,v.n43+v.n23,v.n44+v.n24),T[3]=new THREE.Vector4(v.n41-v.n21,v.n42-v.n22,v.n43-v.n23,v.n44-v.n24),T[4]=new THREE.Vector4(v.n41-v.n31,v.n42-v.n32,v.n43-v.n33,v.n44-v.n34),T[5]=new THREE.Vector4(v.n41+v.n31,v.n42+v.n32,v.n43+v.n33,v.n44+v.n34),r=0,s=T.length;r<s;r++)a=T[r],a.divideScalar(Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z));for(s=i.objects,i=0,r=s.length;i<r;i++){a=s[i];var l;if(!(l=!a.visible)){if(l=a instanceof THREE.Mesh){t:{l=void 0;for(var c=a.position,f=-a.geometry.boundingSphere.radius*Math.max(a.scale.x,Math.max(a.scale.y,a.scale.z)),p=0;p<6;p++)if(l=T[p].x*c.x+T[p].y*c.y+T[p].z*c.z+T[p].w,l<=f){l=!1;break t}l=!0}l=!l}l=l}l||(e=E[n]=E[n]||new THREE.RenderableObject,g.copy(a.position),v.multiplyVector3(g),e.object=a,e.z=g.z,h.push(e),n++)}return o&&h.sort(t),h},this.projectScene=function(e,n,E){var g,T,b,x,H,S,w,M,L,A,z,P,C,F,B,N,V=[],j=n.near,U=n.far;for(s=h=c=0,n.autoUpdateMatrix&&n.updateMatrix(),v.multiply(n.projectionMatrix,n.matrix),S=this.projectObjects(e,n,!0),e=0,g=S.length;e<g;e++)if(w=S[e].object,w.visible)if(w.autoUpdateMatrix&&w.updateMatrix(),M=w.matrix,L=w.rotationMatrix,A=w.materials,z=w.overdraw,w instanceof THREE.Mesh){for(P=w.geometry,C=P.vertices,T=0,b=C.length;T<b;T++)F=C[T],F.positionWorld.copy(F.position),M.multiplyVector3(F.positionWorld),x=F.positionScreen,x.copy(F.positionWorld),v.multiplyVector4(x),x.x/=x.w,x.y/=x.w,F.__visible=x.z>j&&x.z<U;for(P=P.faces,T=0,b=P.length;T<b;T++)if(F=P[T],F instanceof THREE.Face3){if(x=C[F.a],H=C[F.b],B=C[F.c],x.__visible&&H.__visible&&B.__visible&&(w.doubleSided||w.flipSided!=(B.positionScreen.x-x.positionScreen.x)*(H.positionScreen.y-x.positionScreen.y)-(B.positionScreen.y-x.positionScreen.y)*(H.positionScreen.x-x.positionScreen.x)<0)){for(r=p[s]=p[s]||new THREE.RenderableFace3,r.v1.positionWorld.copy(x.positionWorld),r.v2.positionWorld.copy(H.positionWorld),r.v3.positionWorld.copy(B.positionWorld),r.v1.positionScreen.copy(x.positionScreen),r.v2.positionScreen.copy(H.positionScreen),r.v3.positionScreen.copy(B.positionScreen),r.normalWorld.copy(F.normal),L.multiplyVector3(r.normalWorld),r.centroidWorld.copy(F.centroid),M.multiplyVector3(r.centroidWorld),r.centroidScreen.copy(r.centroidWorld),v.multiplyVector3(r.centroidScreen),B=F.vertexNormals,f=r.vertexNormalsWorld,x=0,H=B.length;x<H;x++)N=f[x]=f[x]||new THREE.Vector3,N.copy(B[x]),L.multiplyVector3(N);r.z=r.centroidScreen.z,r.meshMaterials=A,r.faceMaterials=F.materials,r.overdraw=z,w.geometry.uvs[T]&&(r.uvs[0]=w.geometry.uvs[T][0],r.uvs[1]=w.geometry.uvs[T][1],r.uvs[2]=w.geometry.uvs[T][2]),V.push(r),s++}}else F instanceof THREE.Face4&&(x=C[F.a],H=C[F.b],B=C[F.c],N=C[F.d],x.__visible&&H.__visible&&B.__visible&&N.__visible&&(w.doubleSided||w.flipSided!=((N.positionScreen.x-x.positionScreen.x)*(H.positionScreen.y-x.positionScreen.y)-(N.positionScreen.y-x.positionScreen.y)*(H.positionScreen.x-x.positionScreen.x)<0||(H.positionScreen.x-B.positionScreen.x)*(N.positionScreen.y-B.positionScreen.y)-(H.positionScreen.y-B.positionScreen.y)*(N.positionScreen.x-B.positionScreen.x)<0))&&(r=p[s]=p[s]||new THREE.RenderableFace3,r.v1.positionWorld.copy(x.positionWorld),r.v2.positionWorld.copy(H.positionWorld),r.v3.positionWorld.copy(N.positionWorld),r.v1.positionScreen.copy(x.positionScreen),r.v2.positionScreen.copy(H.positionScreen),r.v3.positionScreen.copy(N.positionScreen),r.normalWorld.copy(F.normal),L.multiplyVector3(r.normalWorld),r.centroidWorld.copy(F.centroid),M.multiplyVector3(r.centroidWorld),r.centroidScreen.copy(r.centroidWorld),v.multiplyVector3(r.centroidScreen),r.z=r.centroidScreen.z,r.meshMaterials=A,r.faceMaterials=F.materials,r.overdraw=z,w.geometry.uvs[T]&&(r.uvs[0]=w.geometry.uvs[T][0],r.uvs[1]=w.geometry.uvs[T][1],r.uvs[2]=w.geometry.uvs[T][3]),V.push(r),s++,o=p[s]=p[s]||new THREE.RenderableFace3,o.v1.positionWorld.copy(H.positionWorld),o.v2.positionWorld.copy(B.positionWorld),o.v3.positionWorld.copy(N.positionWorld),o.v1.positionScreen.copy(H.positionScreen),o.v2.positionScreen.copy(B.positionScreen),o.v3.positionScreen.copy(N.positionScreen),o.normalWorld.copy(r.normalWorld),o.centroidWorld.copy(r.centroidWorld),o.centroidScreen.copy(r.centroidScreen),o.z=o.centroidScreen.z,o.meshMaterials=A,o.faceMaterials=F.materials,o.overdraw=z,w.geometry.uvs[T]&&(o.uvs[0]=w.geometry.uvs[T][1],o.uvs[1]=w.geometry.uvs[T][2],o.uvs[2]=w.geometry.uvs[T][3]),V.push(o),s++))}else if(w instanceof THREE.Line)for(R.multiply(v,M),C=w.geometry.vertices,F=C[0],F.positionScreen.copy(F.position),R.multiplyVector4(F.positionScreen),T=1,b=C.length;T<b;T++)x=C[T],x.positionScreen.copy(x.position),R.multiplyVector4(x.positionScreen),H=C[T-1],y.copy(x.positionScreen),_.copy(H.positionScreen),i(y,_)&&(y.multiplyScalar(1/y.w),_.multiplyScalar(1/_.w),a=m[h]=m[h]||new THREE.RenderableLine,a.v1.positionScreen.copy(y),a.v2.positionScreen.copy(_),a.z=Math.max(y.z,_.z),a.materials=w.materials,V.push(a),h++);else w instanceof THREE.Particle&&(d.set(w.position.x,w.position.y,w.position.z,1),v.multiplyVector4(d),d.z/=d.w,d.z>0&&d.z<1&&(l=u[c]=u[c]||new THREE.RenderableParticle,l.x=d.x/d.w,l.y=d.y/d.w,l.z=d.z,l.rotation=w.rotation.z,l.scale.x=w.scale.x*Math.abs(l.x-(d.x+n.projectionMatrix.n11)/(d.w+n.projectionMatrix.n14)),l.scale.y=w.scale.y*Math.abs(l.y-(d.y+n.projectionMatrix.n22)/(d.w+n.projectionMatrix.n24)),l.materials=w.materials,V.push(l),c++));return E&&V.sort(t),V},this.unprojectVector=function(t,i){var e=new THREE.Matrix4;return e.multiply(THREE.Matrix4.makeInvert(i.matrix),THREE.Matrix4.makeInvert(i.projectionMatrix)),e.multiplyVector3(t),t}},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var t,i,e,n,r=null,o=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(r,o){t=r,i=o,e=t/2,n=i/2},this.render=function(t,i){var s,a,h,l,c,f,E,p;for(r=o.projectScene(t,i),s=0,a=r.length;s<a;s++)if(c=r[s],c instanceof THREE.RenderableParticle)for(E=c.x*e+e,p=c.y*n+n,h=0,l=c.material.length;h<l;h++)f=c.material[h],f instanceof THREE.ParticleDOMMaterial&&(f=f.domElement,f.style.left=E+"px",f.style.top=p+"px")}},THREE.CanvasRenderer=function(){function t(t){N!=t&&(C.globalAlpha=N=t)}function i(t){if(V!=t){switch(t){case THREE.NormalBlending:C.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:C.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:C.globalCompositeOperation="darker"}V=t}}var e,n,r,o,s,a,h,l,c,f,E,p,m,u,g,d,v,R,T,y,_,b,x,H,S,w,M,L,A=null,z=new THREE.Projector,P=document.createElement("canvas"),C=P.getContext("2d"),F=null,B=null,N=1,V=0,j=null,U=null,D=1,W=new THREE.Color,G=new THREE.Color,I=new THREE.Color,O=new THREE.Color,X=new THREE.Color,k=new THREE.Rectangle,Y=new THREE.Rectangle,q=new THREE.Rectangle,Z=!1,K=new THREE.Color,Q=new THREE.Color,J=new THREE.Color,$=new THREE.Color,tt=2*Math.PI,it=new THREE.Vector3,et=16;x=document.createElement("canvas"),x.width=x.height=2,H=x.getContext("2d"),H.fillStyle="rgba(0,0,0,1)",H.fillRect(0,0,2,2),S=H.getImageData(0,0,2,2),w=S.data,M=document.createElement("canvas"),M.width=M.height=et,L=M.getContext("2d"),L.translate(-et/2,-et/2),L.scale(et,et),et--,this.domElement=P,this.sortElements=this.sortObjects=this.autoClear=!0,this.setSize=function(t,i){e=t,n=i,r=e/2,o=n/2,P.width=e,P.height=n,k.set(-r,-o,r,o)},this.setClearColor=function(t,i){F=null!==t?new THREE.Color(t):null,B=i,Y.set(-r,-o,r,o),C.setTransform(1,0,0,-1,r,o),this.clear()},this.clear=function(){Y.isEmpty()||(Y.inflate(1),Y.minSelf(k),null!==F?(i(THREE.NormalBlending),t(1),C.fillStyle="rgba("+Math.floor(255*F.r)+","+Math.floor(255*F.g)+","+Math.floor(255*F.b)+","+B+")",C.fillRect(Y.getX(),Y.getY(),Y.getWidth(),Y.getHeight())):C.clearRect(Y.getX(),Y.getY(),Y.getWidth(),Y.getHeight()),Y.empty())},this.render=function(e,n){function P(t){var i,e,n,r=t.lights;for(Q.setRGB(0,0,0),J.setRGB(0,0,0),$.setRGB(0,0,0),t=0,i=r.length;t<i;t++)e=r[t],n=e.color,e instanceof THREE.AmbientLight?(Q.r+=n.r,Q.g+=n.g,Q.b+=n.b):e instanceof THREE.DirectionalLight?(J.r+=n.r,J.g+=n.g,J.b+=n.b):e instanceof THREE.PointLight&&($.r+=n.r,$.g+=n.g,$.b+=n.b)}function F(t,i,e,n){var r,o,s,a,h=t.lights;for(t=0,r=h.length;t<r;t++)o=h[t],s=o.color,a=o.intensity,o instanceof THREE.DirectionalLight?(o=e.dot(o.position)*a,o>0&&(n.r+=s.r*o,n.g+=s.g*o,n.b+=s.b*o)):o instanceof THREE.PointLight&&(it.sub(o.position,i),it.normalize(),o=e.dot(it)*a,o>0&&(n.r+=s.r*o,n.g+=s.g*o,n.b+=s.b*o))}function B(e,n,s){if(0!=s.opacity){t(s.opacity),i(s.blending);var a,h,l,c,f,E;if(s instanceof THREE.ParticleBasicMaterial){if(s.map){if(c=s.map,f=c.width>>1,E=c.height>>1,h=n.scale.x*r,l=n.scale.y*o,s=h*f,a=l*E,q.set(e.x-s,e.y-a,e.x+s,e.y+a),!k.instersects(q))return;C.save(),C.translate(e.x,e.y),C.rotate(-n.rotation),C.scale(h,-l),C.translate(-f,-E),C.drawImage(c,0,0),C.restore()}C.beginPath(),C.moveTo(e.x-10,e.y),C.lineTo(e.x+10,e.y),C.moveTo(e.x,e.y-10),C.lineTo(e.x,e.y+10),C.closePath(),C.strokeStyle="rgb(255,255,0)",C.stroke()}else s instanceof THREE.ParticleCircleMaterial&&(Z?(K.r=Q.r+J.r+$.r,K.g=Q.g+J.g+$.g,K.b=Q.b+J.b+$.b,W.r=s.color.r*K.r,W.g=s.color.g*K.g,W.b=s.color.b*K.b,W.updateStyleString()):W.__styleString=s.color.__styleString,s=n.scale.x*r,a=n.scale.y*o,q.set(e.x-s,e.y-a,e.x+s,e.y+a),k.instersects(q)&&(h=W.__styleString,U!=h&&(C.fillStyle=U=h),C.save(),C.translate(e.x,e.y),C.rotate(-n.rotation),C.scale(s,a),C.beginPath(),C.arc(0,0,1,0,tt,!0),C.closePath(),C.fill(),C.restore()))}}function N(e,n,r,o){0!=o.opacity&&(t(o.opacity),i(o.blending),C.beginPath(),C.moveTo(e.positionScreen.x,e.positionScreen.y),C.lineTo(n.positionScreen.x,n.positionScreen.y),C.closePath(),o instanceof THREE.LineBasicMaterial&&(W.__styleString=o.color.__styleString,e=o.linewidth,D!=e&&(C.lineWidth=D=e),e=W.__styleString,j!=e&&(C.strokeStyle=j=e),C.stroke(),q.inflate(2*o.linewidth)))}function V(e,r,o,s,a,h){0!=a.opacity&&(t(a.opacity),i(a.blending),l=e.positionScreen.x,c=e.positionScreen.y,f=r.positionScreen.x,E=r.positionScreen.y,p=o.positionScreen.x,m=o.positionScreen.y,C.beginPath(),C.moveTo(l,c),C.lineTo(f,E),C.lineTo(p,m),C.lineTo(l,c),C.closePath(),a instanceof THREE.MeshBasicMaterial?a.map?a.map.image.loaded&&a.map.mapping instanceof THREE.UVMapping&&rt(l,c,f,E,p,m,a.map.image,s.uvs[0].u,s.uvs[0].v,s.uvs[1].u,s.uvs[1].v,s.uvs[2].u,s.uvs[2].v):a.env_map?a.env_map.image.loaded&&a.env_map.mapping instanceof THREE.SphericalReflectionMapping&&(e=n.matrix,it.copy(s.vertexNormalsWorld[0]),v=.5*(it.x*e.n11+it.y*e.n12+it.z*e.n13)+.5,R=.5*-(it.x*e.n21+it.y*e.n22+it.z*e.n23)+.5,it.copy(s.vertexNormalsWorld[1]),T=.5*(it.x*e.n11+it.y*e.n12+it.z*e.n13)+.5,y=.5*-(it.x*e.n21+it.y*e.n22+it.z*e.n23)+.5,it.copy(s.vertexNormalsWorld[2]),_=.5*(it.x*e.n11+it.y*e.n12+it.z*e.n13)+.5,b=.5*-(it.x*e.n21+it.y*e.n22+it.z*e.n23)+.5,rt(l,c,f,E,p,m,a.env_map.image,v,R,T,y,_,b)):a.wireframe?et(a.color.__styleString,a.wireframe_linewidth):nt(a.color.__styleString):a instanceof THREE.MeshLambertMaterial?(a.map&&!a.wireframe&&(a.map.mapping instanceof THREE.UVMapping&&rt(l,c,f,E,p,m,a.map.image,s.uvs[0].u,s.uvs[0].v,s.uvs[1].u,s.uvs[1].v,s.uvs[2].u,s.uvs[2].v),i(THREE.SubtractiveBlending)),Z?a.wireframe||a.shading!=THREE.SmoothShading||3!=s.vertexNormalsWorld.length?(K.r=Q.r,K.g=Q.g,K.b=Q.b,F(h,s.centroidWorld,s.normalWorld,K),W.r=a.color.r*K.r,W.g=a.color.g*K.g,W.b=a.color.b*K.b,W.updateStyleString(),a.wireframe?et(W.__styleString,a.wireframe_linewidth):nt(W.__styleString)):(G.r=I.r=O.r=Q.r,G.g=I.g=O.g=Q.g,G.b=I.b=O.b=Q.b,F(h,s.v1.positionWorld,s.vertexNormalsWorld[0],G),F(h,s.v2.positionWorld,s.vertexNormalsWorld[1],I),F(h,s.v3.positionWorld,s.vertexNormalsWorld[2],O),X.r=.5*(I.r+O.r),X.g=.5*(I.g+O.g),X.b=.5*(I.b+O.b),d=ot(G,I,O,X),rt(l,c,f,E,p,m,d,0,0,1,0,0,1)):a.wireframe?et(a.color.__styleString,a.wireframe_linewidth):nt(a.color.__styleString)):a instanceof THREE.MeshDepthMaterial?(u=n.near,g=n.far,G.r=G.g=G.b=1-st(e.positionScreen.z,u,g),I.r=I.g=I.b=1-st(r.positionScreen.z,u,g),O.r=O.g=O.b=1-st(o.positionScreen.z,u,g),X.r=.5*(I.r+O.r),X.g=.5*(I.g+O.g),X.b=.5*(I.b+O.b),d=ot(G,I,O,X),rt(l,c,f,E,p,m,d,0,0,1,0,0,1)):a instanceof THREE.MeshNormalMaterial&&(W.r=at(s.normalWorld.x),W.g=at(s.normalWorld.y),W.b=at(s.normalWorld.z),W.updateStyleString(),a.wireframe?et(W.__styleString,a.wireframe_linewidth):nt(W.__styleString)))}function et(t,i){j!=t&&(C.strokeStyle=j=t),D!=i&&(C.lineWidth=D=i),C.stroke(),q.inflate(2*i)}function nt(t){U!=t&&(C.fillStyle=U=t),C.fill()}function rt(t,i,e,n,r,o,s,a,h,l,c,f,E){var p,m;p=s.width-1,m=s.height-1,a*=p,h*=m,l*=p,c*=m,f*=p,E*=m,e-=t,n-=i,r-=t,o-=i,l-=a,c-=h,f-=a,E-=h,m=1/(l*E-f*c),p=(E*e-c*r)*m,c=(E*n-c*o)*m,e=(l*r-f*e)*m,n=(l*o-f*n)*m,t=t-p*a-e*h,i=i-c*a-n*h,C.save(),C.transform(p,c,e,n,t,i),C.clip(),C.drawImage(s,0,0),C.restore()}function ot(t,i,e,n){var r=~~(255*t.r),o=~~(255*t.g);t=~~(255*t.b);var s=~~(255*i.r),a=~~(255*i.g);i=~~(255*i.b);var h=~~(255*e.r),l=~~(255*e.g);e=~~(255*e.b);var c=~~(255*n.r),f=~~(255*n.g);return n=~~(255*n.b),w[0]=r<0?0:r>255?255:r,w[1]=o<0?0:o>255?255:o,w[2]=t<0?0:t>255?255:t,w[4]=s<0?0:s>255?255:s,w[5]=a<0?0:a>255?255:a,w[6]=i<0?0:i>255?255:i,w[8]=h<0?0:h>255?255:h,w[9]=l<0?0:l>255?255:l,w[10]=e<0?0:e>255?255:e,w[12]=c<0?0:c>255?255:c,w[13]=f<0?0:f>255?255:f,w[14]=n<0?0:n>255?255:n,H.putImageData(S,0,0),L.drawImage(x,0,0),M}function st(t,i,e){return t=(t-i)/(e-i),t*t*(3-2*t)}function at(t){return t=.5*(t+1),t<0?0:t>1?1:t}function ht(t,i){var e=i.x-t.x,n=i.y-t.y,r=1/Math.sqrt(e*e+n*n);e*=r,n*=r,i.x+=e,i.y+=n,t.x-=e,t.y-=n}var lt,ct,ft,Et,pt,mt,ut,gt;for(C.setTransform(1,0,0,-1,r,o),this.autoClear&&this.clear(),A=z.projectScene(e,n,this.sortElements),C.fillStyle="rgba( 0, 255, 255, 0.5 )",C.fillRect(k.getX(),k.getY(),k.getWidth(),k.getHeight()),(Z=e.lights.length>0)&&P(e),lt=0,ct=A.length;lt<ct;lt++){if(ft=A[lt],q.empty(),ft instanceof THREE.RenderableParticle)for(s=ft,s.x*=r,s.y*=o,Et=0,pt=ft.materials.length;Et<pt;Et++)B(s,ft,ft.materials[Et],e);else if(ft instanceof THREE.RenderableLine){if(s=ft.v1,a=ft.v2,s.positionScreen.x*=r,s.positionScreen.y*=o,a.positionScreen.x*=r,a.positionScreen.y*=o,q.addPoint(s.positionScreen.x,s.positionScreen.y),q.addPoint(a.positionScreen.x,a.positionScreen.y),k.instersects(q))for(Et=0,pt=ft.materials.length;Et<pt;)N(s,a,ft,ft.materials[Et++],e)}else if(ft instanceof THREE.RenderableFace3&&(s=ft.v1,a=ft.v2,h=ft.v3,s.positionScreen.x*=r,s.positionScreen.y*=o,a.positionScreen.x*=r,a.positionScreen.y*=o,h.positionScreen.x*=r,h.positionScreen.y*=o,ft.overdraw&&(ht(s.positionScreen,a.positionScreen),ht(a.positionScreen,h.positionScreen),ht(h.positionScreen,s.positionScreen)),q.add3Points(s.positionScreen.x,s.positionScreen.y,a.positionScreen.x,a.positionScreen.y,h.positionScreen.x,h.positionScreen.y),k.instersects(q)))for(Et=0,pt=ft.meshMaterials.length;Et<pt;)if(gt=ft.meshMaterials[Et++],gt instanceof THREE.MeshFaceMaterial)for(mt=0,ut=ft.faceMaterials.length;mt<ut;)(gt=ft.faceMaterials[mt++])&&V(s,a,h,ft,gt,e);else V(s,a,h,ft,gt,e);Y.addRectangle(q)}C.lineWidth=1,C.strokeStyle="rgba( 255, 0, 0, 0.5 )",C.strokeRect(Y.getX(),Y.getY(),Y.getWidth(),Y.getHeight()),C.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function t(t,i,e){var n,r,o,s;for(n=0,r=t.lights.length;n<r;n++)o=t.lights[n],o instanceof THREE.DirectionalLight?(s=i.normalWorld.dot(o.position)*o.intensity,s>0&&(e.r+=o.color.r*s,e.g+=o.color.g*s,e.b+=o.color.b*s)):o instanceof THREE.PointLight&&(L.sub(o.position,i.centroidWorld),L.normalize(),s=i.normalWorld.dot(L)*o.intensity,s>0&&(e.r+=o.color.r*s,e.g+=o.color.g*s,e.b+=o.color.b*s))}function i(i,e,o,s,a,h){m=n(u++),m.setAttribute("d","M "+i.positionScreen.x+" "+i.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),a instanceof THREE.MeshBasicMaterial?x.__styleString=a.color.__styleString:a instanceof THREE.MeshLambertMaterial?b?(H.r=S.r,H.g=S.g,H.b=S.b,t(h,s,H),x.r=a.color.r*H.r,x.g=a.color.g*H.g,x.b=a.color.b*H.b,x.updateStyleString()):x.__styleString=a.color.__styleString:a instanceof THREE.MeshDepthMaterial?(p=1-a.__2near/(a.__farPlusNear-s.z*a.__farMinusNear),x.setRGB(p,p,p)):a instanceof THREE.MeshNormalMaterial&&x.setRGB(r(s.normalWorld.x),r(s.normalWorld.y),r(s.normalWorld.z)),a.wireframe?m.setAttribute("style","fill: none; stroke: "+x.__styleString+"; stroke-width: "+a.wireframe_linewidth+"; stroke-opacity: "+a.opacity+"; stroke-linecap: "+a.wireframe_linecap+"; stroke-linejoin: "+a.wireframe_linejoin):m.setAttribute("style","fill: "+x.__styleString+"; fill-opacity: "+a.opacity),T.appendChild(m)}function e(i,e,o,s,a,h,l){m=n(u++),m.setAttribute("d","M "+i.positionScreen.x+" "+i.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+" L "+s.positionScreen.x+","+s.positionScreen.y+"z"),h instanceof THREE.MeshBasicMaterial?x.__styleString=h.color.__styleString:h instanceof THREE.MeshLambertMaterial?b?(H.r=S.r,H.g=S.g,H.b=S.b,t(l,a,H),x.r=h.color.r*H.r,x.g=h.color.g*H.g,x.b=h.color.b*H.b,x.updateStyleString()):x.__styleString=h.color.__styleString:h instanceof THREE.MeshDepthMaterial?(p=1-h.__2near/(h.__farPlusNear-a.z*h.__farMinusNear),x.setRGB(p,p,p)):h instanceof THREE.MeshNormalMaterial&&x.setRGB(r(a.normalWorld.x),r(a.normalWorld.y),r(a.normalWorld.z)),h.wireframe?m.setAttribute("style","fill: none; stroke: "+x.__styleString+"; stroke-width: "+h.wireframe_linewidth+"; stroke-opacity: "+h.opacity+"; stroke-linecap: "+h.wireframe_linecap+"; stroke-linejoin: "+h.wireframe_linejoin):m.setAttribute("style","fill: "+x.__styleString+"; fill-opacity: "+h.opacity),T.appendChild(m)}function n(t){return null==A[t]?(A[t]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==C&&A[t].setAttribute("shape-rendering","crispEdges"),A[t]):A[t]}function r(t){return t<0?Math.min(.5*(1+t),.5):.5+Math.min(.5*t,.5)}var o,s,a,h,l,c,f,E,p,m,u,g,d,v=null,R=new THREE.Projector,T=document.createElementNS("http://www.w3.org/2000/svg","svg"),y=new THREE.Rectangle,_=new THREE.Rectangle,b=!1,x=new THREE.Color(16777215),H=new THREE.Color(16777215),S=new THREE.Color(0),w=new THREE.Color(0),M=new THREE.Color(0),L=new THREE.Vector3,A=[],z=[],P=[],C=1;this.domElement=T,this.sortElements=this.sortObjects=this.autoClear=!0,this.setQuality=function(t){switch(t){case"high":C=1;break;case"low":C=0}},this.setSize=function(t,i){o=t,s=i,a=o/2,h=s/2,T.setAttribute("viewBox",-a+" "+-h+" "+o+" "+s),T.setAttribute("width",o),T.setAttribute("height",s),y.set(-a,-h,a,h)},this.clear=function(){for(;T.childNodes.length>0;)T.removeChild(T.childNodes[0])},this.render=function(t,n){var r,o,s,p,L,A,F,B;if(this.autoClear&&this.clear(),v=R.projectScene(t,n,this.sortElements),d=g=u=0,b=t.lights.length>0)for(F=t.lights,S.setRGB(0,0,0),w.setRGB(0,0,0),M.setRGB(0,0,0),r=0,o=F.length;r<o;r++)s=F[r],p=s.color,s instanceof THREE.AmbientLight?(S.r+=p.r,S.g+=p.g,S.b+=p.b):s instanceof THREE.DirectionalLight?(w.r+=p.r,w.g+=p.g,w.b+=p.b):s instanceof THREE.PointLight&&(M.r+=p.r,M.g+=p.g,M.b+=p.b);for(r=0,o=v.length;r<o;r++)if(F=v[r],_.empty(),F instanceof THREE.RenderableParticle){for(l=F,l.x*=a,l.y*=-h,s=0,p=F.materials.length;s<p;s++)if(B=F.materials[s]){L=l,A=F,B=B;var N=g++;null==z[N]&&(z[N]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==C&&z[N].setAttribute("shape-rendering","crispEdges")),m=z[N],m.setAttribute("cx",L.x),m.setAttribute("cy",L.y),m.setAttribute("r",A.scale.x*a),B instanceof THREE.ParticleCircleMaterial&&(b?(H.r=S.r+w.r+M.r,H.g=S.g+w.g+M.g,H.b=S.b+w.b+M.b,x.r=B.color.r*H.r,x.g=B.color.g*H.g,x.b=B.color.b*H.b,x.updateStyleString()):x=B.color,m.setAttribute("style","fill: "+x.__styleString)),T.appendChild(m)}}else if(F instanceof THREE.RenderableLine){if(l=F.v1,c=F.v2,l.positionScreen.x*=a,l.positionScreen.y*=-h,c.positionScreen.x*=a,c.positionScreen.y*=-h,_.addPoint(l.positionScreen.x,l.positionScreen.y),_.addPoint(c.positionScreen.x,c.positionScreen.y),y.instersects(_))for(s=0,p=F.materials.length;s<p;)(B=F.materials[s++])&&(L=l,A=c,B=B,N=d++,null==P[N]&&(P[N]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==C&&P[N].setAttribute("shape-rendering","crispEdges")),m=P[N],m.setAttribute("x1",L.positionScreen.x),m.setAttribute("y1",L.positionScreen.y),m.setAttribute("x2",A.positionScreen.x),m.setAttribute("y2",A.positionScreen.y),B instanceof THREE.LineBasicMaterial&&(x.__styleString=B.color.__styleString,m.setAttribute("style","fill: none; stroke: "+x.__styleString+"; stroke-width: "+B.linewidth+"; stroke-opacity: "+B.opacity+"; stroke-linecap: "+B.linecap+"; stroke-linejoin: "+B.linejoin),T.appendChild(m)))}else if(F instanceof THREE.RenderableFace3){if(l=F.v1,c=F.v2,f=F.v3,l.positionScreen.x*=a,l.positionScreen.y*=-h,c.positionScreen.x*=a,c.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,_.addPoint(l.positionScreen.x,l.positionScreen.y),_.addPoint(c.positionScreen.x,c.positionScreen.y),_.addPoint(f.positionScreen.x,f.positionScreen.y),y.instersects(_))for(s=0,p=F.meshMaterials.length;s<p;)if(B=F.meshMaterials[s++],B instanceof THREE.MeshFaceMaterial)for(L=0,A=F.faceMaterials.length;L<A;)(B=F.faceMaterials[L++])&&i(l,c,f,F,B,t);else B&&i(l,c,f,F,B,t)}else if(F instanceof THREE.RenderableFace4&&(l=F.v1,c=F.v2,f=F.v3,E=F.v4,l.positionScreen.x*=a,l.positionScreen.y*=-h,c.positionScreen.x*=a,c.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,E.positionScreen.x*=a,E.positionScreen.y*=-h,_.addPoint(l.positionScreen.x,l.positionScreen.y),_.addPoint(c.positionScreen.x,c.positionScreen.y),_.addPoint(f.positionScreen.x,f.positionScreen.y),_.addPoint(E.positionScreen.x,E.positionScreen.y),y.instersects(_)))for(s=0,p=F.meshMaterials.length;s<p;)if(B=F.meshMaterials[s++],B instanceof THREE.MeshFaceMaterial)for(L=0,A=F.faceMaterials.length;L<A;)(B=F.faceMaterials[L++])&&e(l,c,f,E,F,B,t);else B&&e(l,c,f,E,F,B,t)}},THREE.WebGLRenderer=function(t){function i(t,i){t.fragment_shader=i.fragment_shader,t.vertex_shader=i.vertex_shader,t.uniforms=Uniforms.clone(i.uniforms)}function e(t,i){t.uniforms.color.value.setRGB(t.color.r*t.opacity,t.color.g*t.opacity,t.color.b*t.opacity),t.uniforms.opacity.value=t.opacity,t.uniforms.map.texture=t.map,t.uniforms.env_map.texture=t.env_map,t.uniforms.reflectivity.value=t.reflectivity,t.uniforms.refraction_ratio.value=t.refraction_ratio,t.uniforms.combine.value=t.combine,t.uniforms.useRefract.value=t.env_map&&t.env_map.mapping instanceof THREE.CubeRefractionMapping,i&&(t.uniforms.fogColor.value.setHex(i.color.hex),i instanceof THREE.Fog?(t.uniforms.fogNear.value=i.near,t.uniforms.fogFar.value=i.far):i instanceof THREE.FogExp2&&(t.uniforms.fogDensity.value=i.density))}function n(t,i){var e;return"fragment"==t?e=o.createShader(o.FRAGMENT_SHADER):"vertex"==t&&(e=o.createShader(o.VERTEX_SHADER)),o.shaderSource(e,i),o.compileShader(e),o.getShaderParameter(e,o.COMPILE_STATUS)?e:(alert(o.getShaderInfoLog(e)),null)}function r(t){switch(t){case THREE.RepeatWrapping:return o.REPEAT;case THREE.ClampToEdgeWrapping:return o.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return o.MIRRORED_REPEAT;case THREE.NearestFilter:return o.NEAREST;case THREE.NearestMipMapNearestFilter:return o.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return o.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return o.LINEAR;case THREE.LinearMipMapNearestFilter:return o.LINEAR_MIPMAP_NEAREST;
case THREE.LinearMipMapLinearFilter:return o.LINEAR_MIPMAP_LINEAR}return 0}var o,s,a=document.createElement("canvas"),h=null,l=new THREE.Matrix4,c=new Float32Array(16),f=new Float32Array(16),E=new Float32Array(16),p=new Float32Array(9),m=new Float32Array(16),u=!0,d=new THREE.Color(0),v=0;t&&(void 0!==t.antialias&&(u=t.antialias),void 0!==t.clearColor&&d.setHex(t.clearColor),void 0!==t.clearAlpha&&(v=t.clearAlpha)),this.domElement=a,this.autoClear=!0,function(t,i,e){try{o=a.getContext("experimental-webgl",{antialias:t})}catch(t){}if(!o)throw alert("WebGL not supported"),"cannot create webgl context";o.clearColor(0,0,0,1),o.clearDepth(1),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.frontFace(o.CCW),o.cullFace(o.BACK),o.enable(o.CULL_FACE),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.clearColor(i.r,i.g,i.b,e)}(u,d,v),this.setSize=function(t,i){a.width=t,a.height=i,o.viewport(0,0,a.width,a.height)},this.setClearColor=function(t,i){var e=new THREE.Color(t);o.clearColor(e.r,e.g,e.b,i)},this.clear=function(){o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)},this.setupLights=function(t,i){var e,n,r,o=g=b=0,s=[],a=[],h=[],l=[];for(e=0,n=i.length;e<n;e++)r=i[e],r instanceof THREE.AmbientLight?(o+=r.color.r,g+=r.color.g,b+=r.color.b):r instanceof THREE.DirectionalLight?(s.push(r.color.r*r.intensity,r.color.g*r.intensity,r.color.b*r.intensity),a.push(r.position.x,r.position.y,r.position.z)):r instanceof THREE.PointLight&&(h.push(r.color.r*r.intensity,r.color.g*r.intensity,r.color.b*r.intensity),l.push(r.position.x,r.position.y,r.position.z));return{ambient:[o,g,b],directional:{colors:s,positions:a},point:{colors:h,positions:l}}},this.createBuffers=function(t,i){var e,n,r,s,a,h,l,c,f,E,p,m=[],u=[],g=[],d=[],v=[],R=[],T=0,y=t.geometry.geometryChunks[i];for(a=!1,e=0,n=t.materials.length;e<n;e++){if(h=t.materials[e],h instanceof THREE.MeshFaceMaterial){for(h=0,p=y.materials.length;h<p;h++)if(y.materials[h]&&void 0!=y.materials[h].shading&&y.materials[h].shading==THREE.SmoothShading){a=!0;break}}else if(h&&void 0!=h.shading&&h.shading==THREE.SmoothShading){a=!0;break}if(a)break}for(p=a,e=0,n=y.faces.length;e<n;e++)if(r=y.faces[e],s=t.geometry.faces[r],a=s.vertexNormals,h=s.normal,r=t.geometry.uvs[r],s instanceof THREE.Face3){if(l=t.geometry.vertices[s.a].position,c=t.geometry.vertices[s.b].position,f=t.geometry.vertices[s.c].position,g.push(l.x,l.y,l.z,c.x,c.y,c.z,f.x,f.y,f.z),t.geometry.hasTangents&&(l=t.geometry.vertices[s.a].tangent,c=t.geometry.vertices[s.b].tangent,f=t.geometry.vertices[s.c].tangent,v.push(l.x,l.y,l.z,l.w,c.x,c.y,c.z,c.w,f.x,f.y,f.z,f.w)),3==a.length&&p)for(s=0;s<3;s++)d.push(a[s].x,a[s].y,a[s].z);else for(s=0;s<3;s++)d.push(h.x,h.y,h.z);if(r)for(s=0;s<3;s++)R.push(r[s].u,r[s].v);m.push(T,T+1,T+2),u.push(T,T+1,T,T+2,T+1,T+2),T+=3}else if(s instanceof THREE.Face4){if(l=t.geometry.vertices[s.a].position,c=t.geometry.vertices[s.b].position,f=t.geometry.vertices[s.c].position,E=t.geometry.vertices[s.d].position,g.push(l.x,l.y,l.z,c.x,c.y,c.z,f.x,f.y,f.z,E.x,E.y,E.z),t.geometry.hasTangents&&(l=t.geometry.vertices[s.a].tangent,c=t.geometry.vertices[s.b].tangent,f=t.geometry.vertices[s.c].tangent,s=t.geometry.vertices[s.d].tangent,v.push(l.x,l.y,l.z,l.w,c.x,c.y,c.z,c.w,f.x,f.y,f.z,f.w,s.x,s.y,s.z,s.w)),4==a.length&&p)for(s=0;s<4;s++)d.push(a[s].x,a[s].y,a[s].z);else for(s=0;s<4;s++)d.push(h.x,h.y,h.z);if(r)for(s=0;s<4;s++)R.push(r[s].u,r[s].v);m.push(T,T+1,T+2,T,T+2,T+3),u.push(T,T+1,T,T+2,T,T+3,T+1,T+2,T+2,T+3),T+=4}g.length&&(y.__webGLVertexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLVertexBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(g),o.STATIC_DRAW),y.__webGLNormalBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLNormalBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(d),o.STATIC_DRAW),t.geometry.hasTangents&&(y.__webGLTangentBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLTangentBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(v),o.STATIC_DRAW)),R.length>0&&(y.__webGLUVBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLUVBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(R),o.STATIC_DRAW)),y.__webGLFaceBuffer=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,y.__webGLFaceBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),o.STATIC_DRAW),y.__webGLLineBuffer=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,y.__webGLLineBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),o.STATIC_DRAW),y.__webGLFaceCount=m.length,y.__webGLLineCount=u.length)},this.renderBuffer=function(t,s,a,l,c){var f,E,p,m;if(!l.program){if(l instanceof THREE.MeshDepthMaterial?(i(l,THREE.ShaderLib.depth),l.uniforms.mNear.value=t.near,l.uniforms.mFar.value=t.far):l instanceof THREE.MeshNormalMaterial?i(l,THREE.ShaderLib.normal):l instanceof THREE.MeshBasicMaterial?(i(l,THREE.ShaderLib.basic),e(l,a)):l instanceof THREE.MeshLambertMaterial?(i(l,THREE.ShaderLib.lambert),e(l,a)):l instanceof THREE.MeshPhongMaterial&&(i(l,THREE.ShaderLib.phong),e(l,a)),scene){var u,g,d;for(u=m=E=0,g=s.length;u<g;u++)d=s[u],d instanceof THREE.DirectionalLight&&m++,d instanceof THREE.PointLight&&E++;E+m<=4?(u=m,E=E):(u=Math.ceil(4*m/(E+m)),E=4-u),E={directional:u,point:E}}else E={directional:1,point:3};m={fog:a,map:l.map,env_map:l.env_map,maxDirLights:E.directional,maxPointLights:E.point},E=l.fragment_shader,u=l.vertex_shader,g=o.createProgram(),d=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+m.maxDirLights,"#define MAX_POINT_LIGHTS "+m.maxPointLights,m.fog?"#define USE_FOG":"",m.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",m.map?"#define USE_MAP":"",m.env_map?"#define USE_ENVMAP":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),m=[o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+m.maxDirLights,"#define MAX_POINT_LIGHTS "+m.maxPointLights,m.map?"#define USE_MAP":"",m.env_map?"#define USE_ENVMAP":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n"].join("\n"),o.attachShader(g,n("fragment",d+E)),o.attachShader(g,n("vertex",m+u)),o.linkProgram(g),o.getProgramParameter(g,o.LINK_STATUS)||alert("Could not initialise shaders\nVALIDATE_STATUS: "+o.getProgramParameter(g,o.VALIDATE_STATUS)+", gl error ["+o.getError()+"]"),g.uniforms={},g.attributes={},l.program=g,E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition"];for(f in l.uniforms)E.push(f);for(f=l.program,u=0,g=E.length;u<g;u++)d=E[u],f.uniforms[d]=o.getUniformLocation(f,d);for(f=l.program,E=["position","normal","uv","tangent"],u=0,g=E.length;u<g;u++)d=E[u],f.attributes[d]=o.getAttribLocation(f,d)}f=l.program,f!=h&&(o.useProgram(f),h=f),this.loadCamera(f,t),this.loadMatrices(f),(l instanceof THREE.MeshPhongMaterial||l instanceof THREE.MeshLambertMaterial)&&(t=this.setupLights(f,s),l.uniforms.enableLighting.value=t.directional.positions.length+t.point.positions.length,l.uniforms.ambientLightColor.value=t.ambient,l.uniforms.directionalLightColor.value=t.directional.colors,l.uniforms.directionalLightDirection.value=t.directional.positions,l.uniforms.pointLightColor.value=t.point.colors,l.uniforms.pointLightPosition.value=t.point.positions),(l instanceof THREE.MeshBasicMaterial||l instanceof THREE.MeshLambertMaterial||l instanceof THREE.MeshPhongMaterial)&&e(l,a),l instanceof THREE.MeshPhongMaterial&&(l.uniforms.ambient.value.setRGB(l.ambient.r,l.ambient.g,l.ambient.b),l.uniforms.specular.value.setRGB(l.specular.r,l.specular.g,l.specular.b),l.uniforms.shininess.value=l.shininess),a=l.uniforms;for(p in a)if(s=a[p].type,t=a[p].value,E=f.uniforms[p],"i"==s)o.uniform1i(E,t);else if("f"==s)o.uniform1f(E,t);else if("fv"==s)o.uniform3fv(E,t);else if("v2"==s)o.uniform2f(E,t.x,t.y);else if("v3"==s)o.uniform3f(E,t.x,t.y,t.z);else if("c"==s)o.uniform3f(E,t.r,t.g,t.b);else if("t"==s&&(o.uniform1i(E,t),s=a[p].texture))if(s.image instanceof Array&&6==s.image.length){if(s=s,t=t,6==s.image.length){if(!s.image.__webGLTextureCube&&!s.image.__cubeMapInitialized&&6==s.image.loadCount){for(s.image.__webGLTextureCube=o.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,s.image.__webGLTextureCube),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),E=0;E<6;++E)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,s.image[E]);o.generateMipmap(o.TEXTURE_CUBE_MAP),o.bindTexture(o.TEXTURE_CUBE_MAP,null),s.image.__cubeMapInitialized=!0}o.activeTexture(o.TEXTURE0+t),o.bindTexture(o.TEXTURE_CUBE_MAP,s.image.__webGLTextureCube)}}else s=s,t=t,!s.__webGLTexture&&s.image.loaded&&(s.__webGLTexture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,s.__webGLTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,s.image),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r(s.wrap_s)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r(s.wrap_t)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,r(s.mag_filter)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,r(s.min_filter)),o.generateMipmap(o.TEXTURE_2D),o.bindTexture(o.TEXTURE_2D,null)),o.activeTexture(o.TEXTURE0+t),o.bindTexture(o.TEXTURE_2D,s.__webGLTexture);p=f.attributes,o.bindBuffer(o.ARRAY_BUFFER,c.__webGLVertexBuffer),o.vertexAttribPointer(p.position,3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.position),p.normal>=0&&(o.bindBuffer(o.ARRAY_BUFFER,c.__webGLNormalBuffer),o.vertexAttribPointer(p.normal,3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.normal)),p.tangent>=0&&(o.bindBuffer(o.ARRAY_BUFFER,c.__webGLTangentBuffer),o.vertexAttribPointer(p.tangent,4,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.tangent)),p.uv>=0&&(c.__webGLUVBuffer?(o.bindBuffer(o.ARRAY_BUFFER,c.__webGLUVBuffer),o.vertexAttribPointer(p.uv,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.uv)):o.disableVertexAttribArray(p.uv)),l.wireframe?(o.lineWidth(l.wireframe_linewidth),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,c.__webGLLineBuffer),o.drawElements(o.LINES,c.__webGLLineCount,o.UNSIGNED_SHORT,0)):(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,c.__webGLFaceBuffer),o.drawElements(o.TRIANGLES,c.__webGLFaceCount,o.UNSIGNED_SHORT,0))},this.renderPass=function(t,i,e,n,r,o,s){var a,h,l,c,f;for(l=0,c=n.materials.length;l<c;l++)if(a=n.materials[l],a instanceof THREE.MeshFaceMaterial)for(a=0,h=r.materials.length;a<h;a++)(f=r.materials[a])&&f.blending==o&&f.opacity<1==s&&(this.setBlending(f.blending),this.renderBuffer(t,i,e,f,r));else(f=a)&&f.blending==o&&f.opacity<1==s&&(this.setBlending(f.blending),this.renderBuffer(t,i,e,f,r))},this.render=function(t,i){var e,n,r,o,s=t.lights,a=t.fog;for(this.initWebGLObjects(t),this.autoClear&&this.clear(),i.autoUpdateMatrix&&i.updateMatrix(),c.set(i.matrix.flatten()),E.set(i.projectionMatrix.flatten()),e=0,n=t.__webGLObjects.length;e<n;e++)r=t.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,i),this.renderPass(i,s,a,o,r,THREE.NormalBlending,!1));for(e=0,n=t.__webGLObjects.length;e<n;e++)r=t.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,i),this.renderPass(i,s,a,o,r,THREE.AdditiveBlending,!1),this.renderPass(i,s,a,o,r,THREE.SubtractiveBlending,!1),this.renderPass(i,s,a,o,r,THREE.AdditiveBlending,!0),this.renderPass(i,s,a,o,r,THREE.SubtractiveBlending,!0),this.renderPass(i,s,a,o,r,THREE.NormalBlending,!0))},this.initWebGLObjects=function(t){var i,e,n,r,o,s;for(t.__webGLObjects||(t.__webGLObjects=[],t.__webGLObjectsMap={}),i=0,e=t.objects.length;i<e;i++)if(n=t.objects[i],void 0==t.__webGLObjectsMap[n.id]&&(t.__webGLObjectsMap[n.id]={}),s=t.__webGLObjectsMap[n.id],n instanceof THREE.Mesh)for(o in n.geometry.geometryChunks)r=n.geometry.geometryChunks[o],r.__webGLVertexBuffer||this.createBuffers(n,o),void 0==s[o]&&(r={buffer:r,object:n},t.__webGLObjects.push(r),s[o]=1)},this.removeObject=function(t,i){var e,n;for(e=t.__webGLObjects.length-1;e>=0;e--)n=t.__webGLObjects[e].object,i==n&&t.__webGLObjects.splice(e,1)},this.setupMatrices=function(t,i){t.autoUpdateMatrix&&t.updateMatrix(),l.multiply(i.matrix,t.matrix),f.set(l.flatten()),s=THREE.Matrix4.makeInvert3x3(l).transpose(),p.set(s.m),m.set(t.matrix.flatten())},this.loadMatrices=function(t){o.uniformMatrix4fv(t.uniforms.viewMatrix,!1,c),o.uniformMatrix4fv(t.uniforms.modelViewMatrix,!1,f),o.uniformMatrix4fv(t.uniforms.projectionMatrix,!1,E),o.uniformMatrix3fv(t.uniforms.normalMatrix,!1,p),o.uniformMatrix4fv(t.uniforms.objectMatrix,!1,m)},this.loadCamera=function(t,i){o.uniform3f(t.uniforms.cameraPosition,i.position.x,i.position.y,i.position.z)},this.setBlending=function(t){switch(t){case THREE.AdditiveBlending:o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ONE);break;case THREE.SubtractiveBlending:o.blendFunc(o.DST_COLOR,o.ZERO);break;default:o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA)}},this.setFaceCulling=function(t,i){t?(i&&"ccw"!=i?o.frontFace(o.CW):o.frontFace(o.CCW),"back"==t?o.cullFace(o.BACK):"front"==t?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK),o.enable(o.CULL_FACE)):o.disable(o.CULL_FACE)},this.supportsVertexTextures=function(){return o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},THREE.Snippets={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, 1.0 ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube env_map;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\ncubeColor = textureCube( env_map, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = mix( gl_FragColor, cubeColor, reflectivity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refraction_ratio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refraction_ratio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\nmapColor = texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\nfloat pointLightWeighting = max( dot( transformedNormal, pointLightVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting;\n#ifdef PHONG\nvPointLightVector[ i ] = pointLightVector;\n#endif\n}\n#endif\n}",lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec3 pointVector = normalize( vPointLightVector[ i ] );\nvec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight;\npointSpecular += mSpecular * pointSpecularWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif"},THREE.UniformsLib={common:{color:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},env_map:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refraction_ratio:{type:"f",value:.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]}}},THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3}},fragment_shader:"uniform float mNear;\nuniform float mFar;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), 1.0 );\n}",vertex_shader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{},fragment_shader:"varying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, 1.0 );\n}",vertex_shader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragment_shader:["uniform vec3 color;\nuniform float opacity;",THREE.Snippets.map_pars_fragment,THREE.Snippets.envmap_pars_fragment,THREE.Snippets.fog_pars_fragment,"void main() {\nvec4 mColor = vec4( color, opacity );\nvec4 mapColor = vec4( 1.0 );\nvec4 cubeColor = vec4( 1.0 );",THREE.Snippets.map_fragment,"gl_FragColor = mColor * mapColor;",THREE.Snippets.envmap_fragment,THREE.Snippets.fog_fragment,"}"].join("\n"),vertex_shader:[THREE.Snippets.map_pars_vertex,THREE.Snippets.envmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.Snippets.map_vertex,THREE.Snippets.envmap_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},lambert:{uniforms:Uniforms.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),fragment_shader:["uniform vec3 color;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.Snippets.map_pars_fragment,THREE.Snippets.envmap_pars_fragment,THREE.Snippets.fog_pars_fragment,"void main() {\nvec4 mColor = vec4( color, opacity );\nvec4 mapColor = vec4( 1.0 );\nvec4 cubeColor = vec4( 1.0 );",THREE.Snippets.map_fragment,"gl_FragColor =  mColor * mapColor * vec4( vLightWeighting, 1.0 );",THREE.Snippets.envmap_fragment,THREE.Snippets.fog_fragment,"}"].join("\n"),vertex_shader:["varying vec3 vLightWeighting;",THREE.Snippets.map_pars_vertex,THREE.Snippets.envmap_pars_vertex,THREE.Snippets.lights_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.Snippets.map_vertex,THREE.Snippets.envmap_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.Snippets.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},phong:{uniforms:Uniforms.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),fragment_shader:["uniform vec3 color;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.Snippets.map_pars_fragment,THREE.Snippets.envmap_pars_fragment,THREE.Snippets.fog_pars_fragment,THREE.Snippets.lights_pars_fragment,"void main() {\nvec4 mColor = vec4( color, opacity );\nvec4 mapColor = vec4( 1.0 );\nvec4 cubeColor = vec4( 1.0 );",THREE.Snippets.map_fragment,THREE.Snippets.lights_fragment,"gl_FragColor =  mapColor * totalLight * vec4( vLightWeighting, 1.0 );",THREE.Snippets.envmap_fragment,THREE.Snippets.fog_fragment,"}"].join("\n"),vertex_shader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.Snippets.map_pars_vertex,THREE.Snippets.envmap_pars_vertex,THREE.Snippets.lights_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.Snippets.map_vertex,THREE.Snippets.envmap_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.Snippets.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableFace3=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.v3=new THREE.Vertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[],this.faceMaterials=this.meshMaterials=null,this.overdraw=!1,this.uvs=[null,null,null]},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.materials=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.materials=null};