var THREE=THREE||{};THREE.Color=function(i){this.autoUpdate=!0,this.setHex(i)},THREE.Color.prototype={setRGB:function(i,t,e){this.r=i,this.g=t,this.b=e,this.autoUpdate&&(this.updateHex(),this.updateStyleString())},setHex:function(i){this.hex=16777215&~~i,this.autoUpdate&&(this.updateRGBA(),this.updateStyleString())},updateHex:function(){this.hex=~~(255*this.r)<<16^~~(255*this.g)<<8^~~(255*this.b)},updateRGBA:function(){this.r=(this.hex>>16&255)/255,this.g=(this.hex>>8&255)/255,this.b=(255&this.hex)/255},updateStyleString:function(){this.__styleString="rgb("+~~(255*this.r)+","+~~(255*this.g)+","+~~(255*this.b)+")"},clone:function(){return new THREE.Color(this.hex)},toString:function(){return"THREE.Color ( r: "+this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}},THREE.Vector2=function(i,t){this.x=i||0,this.y=t||0},THREE.Vector2.prototype={set:function(i,t){return this.x=i,this.y=t,this},copy:function(i){return this.x=i.x,this.y=i.y,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this},unit:function(){return this.multiplyScalar(1/this.length()),this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}},THREE.Vector3=function(i,t,e){this.x=i||0,this.y=t||0,this.z=e||0},THREE.Vector3.prototype={set:function(i,t,e){return this.x=i,this.y=t,this.z=e,this},copy:function(i){return this.x=i.x,this.y=i.y,this.z=i.z,this},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this.z=i.z+t.z,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this},addScalar:function(i){return this.x+=i,this.y+=i,this.z+=i,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this.z=i.z-t.z,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this},cross:function(i,t){return this.x=i.y*t.z-i.z*t.y,this.y=i.z*t.x-i.x*t.z,this.z=i.x*t.y-i.y*t.x,this},crossSelf:function(i){var t=this.x,e=this.y,n=this.z;return this.x=e*i.z-n*i.y,this.y=n*i.x-t*i.z,this.z=t*i.y-e*i.x,this},multiply:function(i,t){return this.x=i.x*t.x,this.y=i.y*t.y,this.z=i.z*t.z,this},multiplySelf:function(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this.z*=i,this},divideScalar:function(i){return this.x/=i,this.y/=i,this.z/=i,this},dot:function(i){return this.x*i.x+this.y*i.y+this.z*i.z},distanceTo:function(i){var t=this.x-i.x,e=this.y-i.y;return i=this.z-i.z,Math.sqrt(t*t+e*e+i*i)},distanceToSquared:function(i){var t=this.x-i.x,e=this.y-i.y;return i=this.z-i.z,t*t+e*e+i*i},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){var i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return i>0?this.multiplyScalar(1/i):this.set(0,0,0),this},setLength:function(i){return this.normalize().multiplyScalar(i)},isZero:function(){return Math.abs(this.x)<1e-4&&Math.abs(this.y)<1e-4&&Math.abs(this.z)<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}},THREE.Vector4=function(i,t,e,n){this.x=i||0,this.y=t||0,this.z=e||0,this.w=n||1},THREE.Vector4.prototype={set:function(i,t,e,n){return this.x=i,this.y=t,this.z=e,this.w=n,this},copy:function(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w||1,this},add:function(i,t){return this.x=i.x+t.x,this.y=i.y+t.y,this.z=i.z+t.z,this.w=i.w+t.w,this},addSelf:function(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this.w+=i.w,this},sub:function(i,t){return this.x=i.x-t.x,this.y=i.y-t.y,this.z=i.z-t.z,this.w=i.w-t.w,this},subSelf:function(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this.w-=i.w,this},multiplyScalar:function(i){return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},divideScalar:function(i){return this.x/=i,this.y/=i,this.z/=i,this.w/=i,this},lerpSelf:function(i,t){this.x+=(i.x-this.x)*t,this.y+=(i.y-this.y)*t,this.z+=(i.z-this.z)*t,this.w+=(i.w-this.w)*t},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}},THREE.Ray=function(i,t){this.origin=i||new THREE.Vector3,this.direction=t||new THREE.Vector3},THREE.Ray.prototype={intersectScene:function(i){var t,e,n=i.objects,r=[];for(i=0,t=n.length;i<t;i++)e=n[i],e instanceof THREE.Mesh&&(r=r.concat(this.intersectObject(e)));return r.sort(function(i,t){return i.distance-t.distance}),r},intersectObject:function(i){function t(i,t,e,n){n=n.clone().subSelf(t),e=e.clone().subSelf(t);var r=i.clone().subSelf(t);i=n.dot(n),t=n.dot(e),n=n.dot(r);var o=e.dot(e);return e=e.dot(r),r=1/(i*o-t*t),o=(o*n-t*e)*r,i=(i*e-t*n)*r,o>0&&i>0&&o+i<1}var e,n,r,o,s,a,h,c,l,f,E,p=i.geometry,m=p.vertices,u=[];for(e=0,n=p.faces.length;e<n;e++)r=p.faces[e],f=this.origin.clone(),E=this.direction.clone(),o=i.matrix.multiplyVector3(m[r.a].position.clone()),s=i.matrix.multiplyVector3(m[r.b].position.clone()),a=i.matrix.multiplyVector3(m[r.c].position.clone()),h=r instanceof THREE.Face4?i.matrix.multiplyVector3(m[r.d].position.clone()):null,c=i.rotationMatrix.multiplyVector3(r.normal.clone()),l=E.dot(c),l<0&&(c=c.dot((new THREE.Vector3).sub(o,f))/l,f=f.addSelf(E.multiplyScalar(c)),r instanceof THREE.Face3?t(f,o,s,a)&&(r={distance:this.origin.distanceTo(f),point:f,face:r,object:i},u.push(r)):r instanceof THREE.Face4&&(t(f,o,s,h)||t(f,s,a,h))&&(r={distance:this.origin.distanceTo(f),point:f,face:r,object:i},u.push(r)));return u}},THREE.Rectangle=function(){function i(){o=n-t,s=r-e}var t,e,n,r,o,s,a=!0;this.getX=function(){return t},this.getY=function(){return e},this.getWidth=function(){return o},this.getHeight=function(){return s},this.getLeft=function(){return t},this.getTop=function(){return e},this.getRight=function(){return n},this.getBottom=function(){return r},this.set=function(o,s,h,c){a=!1,t=o,e=s,n=h,r=c,i()},this.addPoint=function(o,s){a?(a=!1,t=o,e=s,n=o,r=s):(t=t<o?t:o,e=e<s?e:s,n=n>o?n:o,r=r>s?r:s),i()},this.add3Points=function(o,s,h,c,l,f){a?(a=!1,t=o<h?o<l?o:l:h<l?h:l,e=s<c?s<f?s:f:c<f?c:f,n=o>h?o>l?o:l:h>l?h:l,r=s>c?s>f?s:f:c>f?c:f):(t=o<h?o<l?o<t?o:t:l<t?l:t:h<l?h<t?h:t:l<t?l:t,e=s<c?s<f?s<e?s:e:f<e?f:e:c<f?c<e?c:e:f<e?f:e,n=o>h?o>l?o>n?o:n:l>n?l:n:h>l?h>n?h:n:l>n?l:n,r=s>c?s>f?s>r?s:r:f>r?f:r:c>f?c>r?c:r:f>r?f:r),i()},this.addRectangle=function(o){a?(a=!1,t=o.getLeft(),e=o.getTop(),n=o.getRight(),r=o.getBottom()):(t=t<o.getLeft()?t:o.getLeft(),e=e<o.getTop()?e:o.getTop(),n=n>o.getRight()?n:o.getRight(),r=r>o.getBottom()?r:o.getBottom()),i()},this.inflate=function(o){t-=o,e-=o,n+=o,r+=o,i()},this.minSelf=function(o){t=t>o.getLeft()?t:o.getLeft(),e=e>o.getTop()?e:o.getTop(),n=n<o.getRight()?n:o.getRight(),r=r<o.getBottom()?r:o.getBottom(),i()},this.instersects=function(i){return Math.min(n,i.getRight())-Math.max(t,i.getLeft())>=0&&Math.min(r,i.getBottom())-Math.max(e,i.getTop())>=0},this.empty=function(){a=!0,r=n=e=t=0,i()},this.isEmpty=function(){return a},this.toString=function(){return"THREE.Rectangle ( left: "+t+", right: "+n+", top: "+e+", bottom: "+r+", width: "+o+", height: "+s+" )"}},THREE.Matrix3=function(){this.m=[]},THREE.Matrix3.prototype={transpose:function(){var i;return i=this.m[1],this.m[1]=this.m[3],this.m[3]=i,i=this.m[2],this.m[2]=this.m[6],this.m[6]=i,i=this.m[5],this.m[5]=this.m[7],this.m[7]=i,this}},THREE.Matrix4=function(i,t,e,n,r,o,s,a,h,c,l,f,E,p,m,u){this.n11=i||1,this.n12=t||0,this.n13=e||0,this.n14=n||0,this.n21=r||0,this.n22=o||1,this.n23=s||0,this.n24=a||0,this.n31=h||0,this.n32=c||0,this.n33=l||1,this.n34=f||0,this.n41=E||0,this.n42=p||0,this.n43=m||0,this.n44=u||1},THREE.Matrix4.prototype={identity:function(){return this.n11=1,this.n21=this.n14=this.n13=this.n12=0,this.n22=1,this.n32=this.n31=this.n24=this.n23=0,this.n33=1,this.n43=this.n42=this.n41=this.n34=0,this.n44=1,this},set:function(i,t,e,n,r,o,s,a,h,c,l,f,E,p,m,u){return this.n11=i,this.n12=t,this.n13=e,this.n14=n,this.n21=r,this.n22=o,this.n23=s,this.n24=a,this.n31=h,this.n32=c,this.n33=l,this.n34=f,this.n41=E,this.n42=p,this.n43=m,this.n44=u,this},copy:function(i){return this.n11=i.n11,this.n12=i.n12,this.n13=i.n13,this.n14=i.n14,this.n21=i.n21,this.n22=i.n22,this.n23=i.n23,this.n24=i.n24,this.n31=i.n31,this.n32=i.n32,this.n33=i.n33,this.n34=i.n34,this.n41=i.n41,this.n42=i.n42,this.n43=i.n43,this.n44=i.n44,this},lookAt:function(i,t,e){var n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3;return o.sub(i,t).normalize(),n.cross(e,o).normalize(),r.cross(o,n).normalize(),this.n11=n.x,this.n12=n.y,this.n13=n.z,this.n14=-n.dot(i),this.n21=r.x,this.n22=r.y,this.n23=r.z,this.n24=-r.dot(i),this.n31=o.x,this.n32=o.y,this.n33=o.z,this.n34=-o.dot(i),this.n43=this.n42=this.n41=0,this.n44=1,this},multiplyVector3:function(i){var t=i.x,e=i.y,n=i.z,r=1/(this.n41*t+this.n42*e+this.n43*n+this.n44);return i.x=(this.n11*t+this.n12*e+this.n13*n+this.n14)*r,i.y=(this.n21*t+this.n22*e+this.n23*n+this.n24)*r,i.z=(this.n31*t+this.n32*e+this.n33*n+this.n34)*r,i},multiplyVector4:function(i){var t=i.x,e=i.y,n=i.z,r=i.w;return i.x=this.n11*t+this.n12*e+this.n13*n+this.n14*r,i.y=this.n21*t+this.n22*e+this.n23*n+this.n24*r,i.z=this.n31*t+this.n32*e+this.n33*n+this.n34*r,i.w=this.n41*t+this.n42*e+this.n43*n+this.n44*r,i},crossVector:function(i){var t=new THREE.Vector4;return t.x=this.n11*i.x+this.n12*i.y+this.n13*i.z+this.n14*i.w,t.y=this.n21*i.x+this.n22*i.y+this.n23*i.z+this.n24*i.w,t.z=this.n31*i.x+this.n32*i.y+this.n33*i.z+this.n34*i.w,t.w=i.w?this.n41*i.x+this.n42*i.y+this.n43*i.z+this.n44*i.w:1,t},multiply:function(i,t){var e=i.n11,n=i.n12,r=i.n13,o=i.n14,s=i.n21,a=i.n22,h=i.n23,c=i.n24,l=i.n31,f=i.n32,E=i.n33,p=i.n34,m=i.n41,u=i.n42,g=i.n43,d=i.n44,v=t.n11,R=t.n12,T=t.n13,y=t.n14,_=t.n21,b=t.n22,x=t.n23,H=t.n24,S=t.n31,w=t.n32,M=t.n33,L=t.n34,A=t.n41,z=t.n42,P=t.n43,C=t.n44;return this.n11=e*v+n*_+r*S+o*A,this.n12=e*R+n*b+r*w+o*z,this.n13=e*T+n*x+r*M+o*P,this.n14=e*y+n*H+r*L+o*C,this.n21=s*v+a*_+h*S+c*A,this.n22=s*R+a*b+h*w+c*z,this.n23=s*T+a*x+h*M+c*P,this.n24=s*y+a*H+h*L+c*C,this.n31=l*v+f*_+E*S+p*A,this.n32=l*R+f*b+E*w+p*z,this.n33=l*T+f*x+E*M+p*P,this.n34=l*y+f*H+E*L+p*C,this.n41=m*v+u*_+g*S+d*A,this.n42=m*R+u*b+g*w+d*z,this.n43=m*T+u*x+g*M+d*P,this.n44=m*y+u*H+g*L+d*C,this},multiplySelf:function(i){var t=this.n11,e=this.n12,n=this.n13,r=this.n14,o=this.n21,s=this.n22,a=this.n23,h=this.n24,c=this.n31,l=this.n32,f=this.n33,E=this.n34,p=this.n41,m=this.n42,u=this.n43,g=this.n44,d=i.n11,v=i.n21,R=i.n31,T=i.n41,y=i.n12,_=i.n22,b=i.n32,x=i.n42,H=i.n13,S=i.n23,w=i.n33,M=i.n43,L=i.n14,A=i.n24,z=i.n34;return i=i.n44,this.n11=t*d+e*v+n*R+r*T,this.n12=t*y+e*_+n*b+r*x,this.n13=t*H+e*S+n*w+r*M,this.n14=t*L+e*A+n*z+r*i,this.n21=o*d+s*v+a*R+h*T,this.n22=o*y+s*_+a*b+h*x,this.n23=o*H+s*S+a*w+h*M,this.n24=o*L+s*A+a*z+h*i,this.n31=c*d+l*v+f*R+E*T,this.n32=c*y+l*_+f*b+E*x,this.n33=c*H+l*S+f*w+E*M,this.n34=c*L+l*A+f*z+E*i,this.n41=p*d+m*v+u*R+g*T,this.n42=p*y+m*_+u*b+g*x,this.n43=p*H+m*S+u*w+g*M,this.n44=p*L+m*A+u*z+g*i,this},multiplyScalar:function(i){return this.n11*=i,this.n12*=i,this.n13*=i,this.n14*=i,this.n21*=i,this.n22*=i,this.n23*=i,this.n24*=i,this.n31*=i,this.n32*=i,this.n33*=i,this.n34*=i,this.n41*=i,this.n42*=i,this.n43*=i,this.n44*=i,this},determinant:function(){return this.n14*this.n23*this.n32*this.n41-this.n13*this.n24*this.n32*this.n41-this.n14*this.n22*this.n33*this.n41+this.n12*this.n24*this.n33*this.n41+this.n13*this.n22*this.n34*this.n41-this.n12*this.n23*this.n34*this.n41-this.n14*this.n23*this.n31*this.n42+this.n13*this.n24*this.n31*this.n42+this.n14*this.n21*this.n33*this.n42-this.n11*this.n24*this.n33*this.n42-this.n13*this.n21*this.n34*this.n42+this.n11*this.n23*this.n34*this.n42+this.n14*this.n22*this.n31*this.n43-this.n12*this.n24*this.n31*this.n43-this.n14*this.n21*this.n32*this.n43+this.n11*this.n24*this.n32*this.n43+this.n12*this.n21*this.n34*this.n43-this.n11*this.n22*this.n34*this.n43-this.n13*this.n22*this.n31*this.n44+this.n12*this.n23*this.n31*this.n44+this.n13*this.n21*this.n32*this.n44-this.n11*this.n23*this.n32*this.n44-this.n12*this.n21*this.n33*this.n44+this.n11*this.n22*this.n33*this.n44},transpose:function(){function i(i,t,e){var n=i[t];i[t]=i[e],i[e]=n}return i(this,"n21","n12"),i(this,"n31","n13"),i(this,"n32","n23"),i(this,"n41","n14"),i(this,"n42","n24"),i(this,"n43","n34"),this},clone:function(){var i=new THREE.Matrix4;return i.n11=this.n11,i.n12=this.n12,i.n13=this.n13,i.n14=this.n14,i.n21=this.n21,i.n22=this.n22,i.n23=this.n23,i.n24=this.n24,i.n31=this.n31,i.n32=this.n32,i.n33=this.n33,i.n34=this.n34,i.n41=this.n41,i.n42=this.n42,i.n43=this.n43,i.n44=this.n44,i},flatten:function(){return[this.n11,this.n21,this.n31,this.n41,this.n12,this.n22,this.n32,this.n42,this.n13,this.n23,this.n33,this.n43,this.n14,this.n24,this.n34,this.n44]},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}},THREE.Matrix4.translationMatrix=function(i,t,e){var n=new THREE.Matrix4;return n.n14=i,n.n24=t,n.n34=e,n},THREE.Matrix4.scaleMatrix=function(i,t,e){var n=new THREE.Matrix4;return n.n11=i,n.n22=t,n.n33=e,n},THREE.Matrix4.rotationXMatrix=function(i){var t=new THREE.Matrix4;return t.n22=t.n33=Math.cos(i),t.n32=Math.sin(i),t.n23=-t.n32,t},THREE.Matrix4.rotationYMatrix=function(i){var t=new THREE.Matrix4;return t.n11=t.n33=Math.cos(i),t.n13=Math.sin(i),t.n31=-t.n13,t},THREE.Matrix4.rotationZMatrix=function(i){var t=new THREE.Matrix4;return t.n11=t.n22=Math.cos(i),t.n21=Math.sin(i),t.n12=-t.n21,t},THREE.Matrix4.rotationAxisAngleMatrix=function(i,t){var e=new THREE.Matrix4,n=Math.cos(t),r=Math.sin(t),o=1-n,s=i.x,a=i.y,h=i.z;return e.n11=o*s*s+n,e.n12=o*s*a-r*h,e.n13=o*s*h+r*a,e.n21=o*s*a+r*h,e.n22=o*a*a+n,e.n23=o*a*h-r*s,e.n31=o*s*h-r*a,e.n32=o*a*h+r*s,e.n33=o*h*h+n,e},THREE.Matrix4.makeInvert=function(i){var t=new THREE.Matrix4;return t.n11=i.n23*i.n34*i.n42-i.n24*i.n33*i.n42+i.n24*i.n32*i.n43-i.n22*i.n34*i.n43-i.n23*i.n32*i.n44+i.n22*i.n33*i.n44,t.n12=i.n14*i.n33*i.n42-i.n13*i.n34*i.n42-i.n14*i.n32*i.n43+i.n12*i.n34*i.n43+i.n13*i.n32*i.n44-i.n12*i.n33*i.n44,t.n13=i.n13*i.n24*i.n42-i.n14*i.n23*i.n42+i.n14*i.n22*i.n43-i.n12*i.n24*i.n43-i.n13*i.n22*i.n44+i.n12*i.n23*i.n44,t.n14=i.n14*i.n23*i.n32-i.n13*i.n24*i.n32-i.n14*i.n22*i.n33+i.n12*i.n24*i.n33+i.n13*i.n22*i.n34-i.n12*i.n23*i.n34,t.n21=i.n24*i.n33*i.n41-i.n23*i.n34*i.n41-i.n24*i.n31*i.n43+i.n21*i.n34*i.n43+i.n23*i.n31*i.n44-i.n21*i.n33*i.n44,t.n22=i.n13*i.n34*i.n41-i.n14*i.n33*i.n41+i.n14*i.n31*i.n43-i.n11*i.n34*i.n43-i.n13*i.n31*i.n44+i.n11*i.n33*i.n44,t.n23=i.n14*i.n23*i.n41-i.n13*i.n24*i.n41-i.n14*i.n21*i.n43+i.n11*i.n24*i.n43+i.n13*i.n21*i.n44-i.n11*i.n23*i.n44,t.n24=i.n13*i.n24*i.n31-i.n14*i.n23*i.n31+i.n14*i.n21*i.n33-i.n11*i.n24*i.n33-i.n13*i.n21*i.n34+i.n11*i.n23*i.n34,t.n31=i.n22*i.n34*i.n41-i.n24*i.n32*i.n41+i.n24*i.n31*i.n42-i.n21*i.n34*i.n42-i.n22*i.n31*i.n44+i.n21*i.n32*i.n44,t.n32=i.n14*i.n32*i.n41-i.n12*i.n34*i.n41-i.n14*i.n31*i.n42+i.n11*i.n34*i.n42+i.n12*i.n31*i.n44-i.n11*i.n32*i.n44,t.n33=i.n13*i.n24*i.n41-i.n14*i.n22*i.n41+i.n14*i.n21*i.n42-i.n11*i.n24*i.n42-i.n12*i.n21*i.n44+i.n11*i.n22*i.n44,t.n34=i.n14*i.n22*i.n31-i.n12*i.n24*i.n31-i.n14*i.n21*i.n32+i.n11*i.n24*i.n32+i.n12*i.n21*i.n34-i.n11*i.n22*i.n34,t.n41=i.n23*i.n32*i.n41-i.n22*i.n33*i.n41-i.n23*i.n31*i.n42+i.n21*i.n33*i.n42+i.n22*i.n31*i.n43-i.n21*i.n32*i.n43,t.n42=i.n12*i.n33*i.n41-i.n13*i.n32*i.n41+i.n13*i.n31*i.n42-i.n11*i.n33*i.n42-i.n12*i.n31*i.n43+i.n11*i.n32*i.n43,t.n43=i.n13*i.n22*i.n41-i.n12*i.n23*i.n41-i.n13*i.n21*i.n42+i.n11*i.n23*i.n42+i.n12*i.n21*i.n43-i.n11*i.n22*i.n43,t.n44=i.n12*i.n23*i.n31-i.n13*i.n22*i.n31+i.n13*i.n21*i.n32-i.n11*i.n23*i.n32-i.n12*i.n21*i.n33+i.n11*i.n22*i.n33,t.multiplyScalar(1/i.determinant()),t},THREE.Matrix4.makeInvert3x3=function(i){var t=i.flatten();i=new THREE.Matrix3;var e=t[10]*t[5]-t[6]*t[9],n=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],o=-t[10]*t[4]+t[6]*t[8],s=t[10]*t[0]-t[2]*t[8],a=-t[6]*t[0]+t[2]*t[4],h=t[9]*t[4]-t[5]*t[8],c=-t[9]*t[0]+t[1]*t[8],l=t[5]*t[0]-t[1]*t[4];if(t=t[0]*e+t[1]*o+t[2]*h,0==t)throw"matrix not invertible";return t=1/t,i.m[0]=t*e,i.m[1]=t*n,i.m[2]=t*r,i.m[3]=t*o,i.m[4]=t*s,i.m[5]=t*a,i.m[6]=t*h,i.m[7]=t*c,i.m[8]=t*l,i},THREE.Matrix4.makeFrustum=function(i,t,e,n,r,o){var s,a,h;return s=new THREE.Matrix4,a=2*r/(t-i),h=2*r/(n-e),i=(t+i)/(t-i),e=(n+e)/(n-e),n=-(o+r)/(o-r),r=-2*o*r/(o-r),s.n11=a,s.n12=0,s.n13=i,s.n14=0,s.n21=0,s.n22=h,s.n23=e,s.n24=0,s.n31=0,s.n32=0,s.n33=n,s.n34=r,s.n41=0,s.n42=0,s.n43=-1,s.n44=0,s},THREE.Matrix4.makePerspective=function(i,t,e,n){var r;return i=e*Math.tan(i*Math.PI/360),r=-i,THREE.Matrix4.makeFrustum(r*t,i*t,r,i,e,n)},THREE.Matrix4.makeOrtho=function(i,t,e,n,r,o){var s,a,h,c;return s=new THREE.Matrix4,a=t-i,h=e-n,c=o-r,i=(t+i)/a,e=(e+n)/h,r=(o+r)/c,s.n11=2/a,s.n12=0,s.n13=0,s.n14=-i,s.n21=0,s.n22=2/h,s.n23=0,s.n24=-e,s.n31=0,s.n32=0,s.n33=-2/c,s.n34=-r,s.n41=0,s.n42=0,s.n43=0,s.n44=1,s},THREE.Vertex=function(i,t){this.position=i||new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.normal=t||new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.normalScreen=new THREE.Vector3,this.tangent=new THREE.Vector4,this.__visible=!0},THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}},THREE.Face3=function(i,t,e,n,r){this.a=i,this.b=t,this.c=e,this.centroid=new THREE.Vector3,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.materials=r instanceof Array?r:[r]},THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}},THREE.Face4=function(i,t,e,n,r,o){this.a=i,this.b=t,this.c=e,this.d=n,this.centroid=new THREE.Vector3,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.materials=o instanceof Array?o:[o]},THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}},THREE.UV=function(i,t){this.u=i||0,this.v=t||0},THREE.UV.prototype={copy:function(i){this.u=i.u,this.v=i.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}},THREE.Geometry=function(){this.vertices=[],this.faces=[],this.uvs=[],this.boundingSphere=this.boundingBox=null,this.geometryChunks={},this.hasTangents=!1},THREE.Geometry.prototype={computeCentroids:function(){var i,t,e;for(i=0,t=this.faces.length;i<t;i++)e=this.faces[i],e.centroid.set(0,0,0),e instanceof THREE.Face3?(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.divideScalar(3)):e instanceof THREE.Face4&&(e.centroid.addSelf(this.vertices[e.a].position),e.centroid.addSelf(this.vertices[e.b].position),e.centroid.addSelf(this.vertices[e.c].position),e.centroid.addSelf(this.vertices[e.d].position),e.centroid.divideScalar(4))},computeFaceNormals:function(i){var t,e,n,r,o,s,a=new THREE.Vector3,h=new THREE.Vector3;for(n=0,r=this.vertices.length;n<r;n++)o=this.vertices[n],o.normal.set(0,0,0);for(n=0,r=this.faces.length;n<r;n++){if(o=this.faces[n],i&&o.vertexNormals.length){for(a.set(0,0,0),t=0,e=o.normal.length;t<e;t++)a.addSelf(o.vertexNormals[t]);a.divideScalar(3)}else t=this.vertices[o.a],e=this.vertices[o.b],s=this.vertices[o.c],a.sub(s.position,e.position),h.sub(t.position,e.position),a.crossSelf(h);a.isZero()||a.normalize(),o.normal.copy(a)}},computeVertexNormals:function(){var i,t,e,n=[];for(i=0,t=this.vertices.length;i<t;i++)n[i]=new THREE.Vector3;for(i=0,t=this.faces.length;i<t;i++)e=this.faces[i],e instanceof THREE.Face3?(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal)):e instanceof THREE.Face4&&(n[e.a].addSelf(e.normal),n[e.b].addSelf(e.normal),n[e.c].addSelf(e.normal),n[e.d].addSelf(e.normal));for(i=0,t=this.vertices.length;i<t;i++)n[i].normalize();for(i=0,t=this.faces.length;i<t;i++)e=this.faces[i],e instanceof THREE.Face3?(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone()):e instanceof THREE.Face4&&(e.vertexNormals[0]=n[e.a].clone(),e.vertexNormals[1]=n[e.b].clone(),e.vertexNormals[2]=n[e.c].clone(),e.vertexNormals[3]=n[e.d].clone())},computeTangents:function(){function i(i,t,e,n,S,w,M){o=i.vertices[t].position,s=i.vertices[e].position,a=i.vertices[n].position,h=r[S],c=r[w],l=r[M],f=s.x-o.x,E=a.x-o.x,p=s.y-o.y,m=a.y-o.y,u=s.z-o.z,g=a.z-o.z,d=c.u-h.u,v=l.u-h.u,R=c.v-h.v,T=l.v-h.v,y=1/(d*T-v*R),x.set((T*f-R*E)*y,(T*p-R*m)*y,(T*u-R*g)*y),H.set((d*E-v*f)*y,(d*m-v*p)*y,(d*g-v*u)*y),_[t].addSelf(x),_[e].addSelf(x),_[n].addSelf(x),b[t].addSelf(H),b[e].addSelf(H),b[n].addSelf(H)}var t,e,n,r,o,s,a,h,c,l,f,E,p,m,u,g,d,v,R,T,y,_=[],b=[],x=new THREE.Vector3,H=new THREE.Vector3,S=new THREE.Vector3,w=new THREE.Vector3,M=new THREE.Vector3;for(t=0,e=this.vertices.length;t<e;t++)_[t]=new THREE.Vector3,b[t]=new THREE.Vector3;for(t=0,e=this.faces.length;t<e;t++)n=this.faces[t],r=this.uvs[t],n instanceof THREE.Face3?(i(this,n.a,n.b,n.c,0,1,2),this.vertices[n.a].normal.copy(n.vertexNormals[0]),this.vertices[n.b].normal.copy(n.vertexNormals[1]),this.vertices[n.c].normal.copy(n.vertexNormals[2])):n instanceof THREE.Face4&&(i(this,n.a,n.b,n.c,0,1,2),i(this,n.a,n.b,n.d,0,1,3),this.vertices[n.a].normal.copy(n.vertexNormals[0]),this.vertices[n.b].normal.copy(n.vertexNormals[1]),this.vertices[n.c].normal.copy(n.vertexNormals[2]),this.vertices[n.d].normal.copy(n.vertexNormals[3]));for(t=0,e=this.vertices.length;t<e;t++)M.copy(this.vertices[t].normal),n=_[t],S.copy(n),S.subSelf(M.multiplyScalar(M.dot(n))).normalize(),w.cross(this.vertices[t].normal,n),n=w.dot(b[t]),n=n<0?-1:1,this.vertices[t].tangent.set(S.x,S.y,S.z,n);this.hasTangents=!0},computeBoundingBox:function(){var i;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var t=1,e=this.vertices.length;t<e;t++)i=this.vertices[t],i.position.x<this.boundingBox.x[0]?this.boundingBox.x[0]=i.position.x:i.position.x>this.boundingBox.x[1]&&(this.boundingBox.x[1]=i.position.x),i.position.y<this.boundingBox.y[0]?this.boundingBox.y[0]=i.position.y:i.position.y>this.boundingBox.y[1]&&(this.boundingBox.y[1]=i.position.y),i.position.z<this.boundingBox.z[0]?this.boundingBox.z[0]=i.position.z:i.position.z>this.boundingBox.z[1]&&(this.boundingBox.z[1]=i.position.z)}},computeBoundingSphere:function(){for(var i=null===this.boundingSphere?0:this.boundingSphere.radius,t=0,e=this.vertices.length;t<e;t++)i=Math.max(i,this.vertices[t].position.length());this.boundingSphere={radius:i}},sortFacesByMaterial:function(){function i(i){var n=[];for(t=0,e=i.length;t<e;t++)void 0==i[t]?n.push("undefined"):n.push(i[t].toString());return n.join("_")}var t,e,n,r,o,s,a,h,c={};for(n=0,r=this.faces.length;n<r;n++)o=this.faces[n],s=o.materials,a=i(s),void 0==c[a]&&(c[a]={hash:a,counter:0}),h=c[a].hash+"_"+c[a].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],materials:s,vertices:0}),o=o instanceof THREE.Face3?3:4,this.geometryChunks[h].vertices+o>65535&&(c[a].counter+=1,h=c[a].hash+"_"+c[a].counter,void 0==this.geometryChunks[h]&&(this.geometryChunks[h]={faces:[],materials:s,vertices:0})),this.geometryChunks[h].faces.push(n),this.geometryChunks[h].vertices+=o},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+", uvs: "+this.uvs+" )"}},THREE.Camera=function(i,t,e,n){this.fov=i,this.aspect=t,this.near=e,this.far=n,this.position=new THREE.Vector3,this.target={position:new THREE.Vector3},this.autoUpdateMatrix=!0,this.projectionMatrix=null,this.matrix=new THREE.Matrix4,this.up=new THREE.Vector3(0,1,0),this.translateX=function(i){i=this.target.position.clone().subSelf(this.position).normalize().multiplyScalar(i),i.cross(i.clone(),this.up),this.position.addSelf(i),this.target.position.addSelf(i)},this.translateZ=function(i){i=this.target.position.clone().subSelf(this.position).normalize().multiplyScalar(i),this.position.subSelf(i),this.target.position.subSelf(i)},this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)},this.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)},this.updateProjectionMatrix()},THREE.Camera.prototype={toString:function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}},THREE.Light=function(i){this.color=new THREE.Color(i)},THREE.AmbientLight=function(i){THREE.Light.call(this,i)},THREE.AmbientLight.prototype=new THREE.Light,THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.DirectionalLight=function(i,t){THREE.Light.call(this,i),this.position=new THREE.Vector3(0,1,0),this.intensity=t||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.PointLight=function(i,t){THREE.Light.call(this,i),this.position=new THREE.Vector3,this.intensity=t||1},THREE.DirectionalLight.prototype=new THREE.Light,THREE.DirectionalLight.prototype.constructor=THREE.PointLight,THREE.Object3D=function(){this.id=THREE.Object3DCounter.value++,this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3(1,1,1),this.matrix=new THREE.Matrix4,this.translationMatrix=new THREE.Matrix4,this.rotationMatrix=new THREE.Matrix4,this.scaleMatrix=new THREE.Matrix4,this.screen=new THREE.Vector3,this.visible=this.autoUpdateMatrix=!0},THREE.Object3D.prototype={updateMatrix:function(){this.matrixPosition=THREE.Matrix4.translationMatrix(this.position.x,this.position.y,this.position.z),this.rotationMatrix=THREE.Matrix4.rotationXMatrix(this.rotation.x),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationYMatrix(this.rotation.y)),this.rotationMatrix.multiplySelf(THREE.Matrix4.rotationZMatrix(this.rotation.z)),this.scaleMatrix=THREE.Matrix4.scaleMatrix(this.scale.x,this.scale.y,this.scale.z),this.matrix.copy(this.matrixPosition),this.matrix.multiplySelf(this.rotationMatrix),this.matrix.multiplySelf(this.scaleMatrix)}},THREE.Object3DCounter={value:0},THREE.Particle=function(i){THREE.Object3D.call(this),this.materials=i instanceof Array?i:[i],this.autoUpdateMatrix=!1},THREE.Particle.prototype=new THREE.Object3D,THREE.Particle.prototype.constructor=THREE.Particle,THREE.Line=function(i,t){THREE.Object3D.call(this),this.geometry=i,this.materials=t instanceof Array?t:[t]},THREE.Line.prototype=new THREE.Object3D,THREE.Line.prototype.constructor=THREE.Line,THREE.Mesh=function(i,t){THREE.Object3D.call(this),this.geometry=i,this.materials=t instanceof Array?t:[t],this.overdraw=this.doubleSided=this.flipSided=!1,this.geometry.boundingSphere||this.geometry.computeBoundingSphere()},THREE.Mesh.prototype=new THREE.Object3D,THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.FlatShading=0,THREE.SmoothShading=1,THREE.NormalBlending=0,THREE.AdditiveBlending=1,THREE.SubtractiveBlending=2,THREE.LineBasicMaterial=function(i){this.color=new THREE.Color(16777215),this.opacity=1,this.blending=THREE.NormalBlending,this.linewidth=1,this.linejoin=this.linecap="round",i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.linewidth&&(this.linewidth=i.linewidth),void 0!==i.linecap&&(this.linecap=i.linecap),void 0!==i.linejoin&&(this.linejoin=i.linejoin))},THREE.LineBasicMaterial.prototype={toString:function(){return"THREE.LineBasicMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>linewidth: "+this.linewidth+"<br/>linecap: "+this.linecap+"<br/>linejoin: "+this.linejoin+"<br/>)"}},THREE.MeshBasicMaterial=function(i){this.id=THREE.MeshBasicMaterialCounter.value++,this.color=new THREE.Color(16777215),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.fog=!0,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.map&&(this.map=i.map),void 0!==i.env_map&&(this.env_map=i.env_map),void 0!==i.combine&&(this.combine=i.combine),void 0!==i.reflectivity&&(this.reflectivity=i.reflectivity),void 0!==i.refraction_ratio&&(this.refraction_ratio=i.refraction_ratio),void 0!==i.fog&&(this.fog=i.fog),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin))},THREE.MeshBasicMaterial.prototype={toString:function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshBasicMaterialCounter={value:0},THREE.MeshLambertMaterial=function(i){this.id=THREE.MeshLambertMaterialCounter.value++,this.color=new THREE.Color(16777215),this.env_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.fog=!0,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.map&&(this.map=i.map),void 0!==i.env_map&&(this.env_map=i.env_map),void 0!==i.combine&&(this.combine=i.combine),void 0!==i.reflectivity&&(this.reflectivity=i.reflectivity),void 0!==i.refraction_ratio&&(this.refraction_ratio=i.refraction_ratio),void 0!==i.fog&&(this.fog=i.fog),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin))},THREE.MeshLambertMaterial.prototype={toString:function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/> )";
}},THREE.MeshLambertMaterialCounter={value:0},THREE.MeshPhongMaterial=function(i){this.id=THREE.MeshPhongMaterialCounter.value++,this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(328965),this.specular=new THREE.Color(1118481),this.shininess=30,this.env_map=this.specular_map=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refraction_ratio=.98,this.fog=!0,this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.color&&(this.color=new THREE.Color(i.color)),void 0!==i.ambient&&(this.ambient=new THREE.Color(i.ambient)),void 0!==i.specular&&(this.specular=new THREE.Color(i.specular)),void 0!==i.shininess&&(this.shininess=i.shininess),void 0!==i.map&&(this.map=i.map),void 0!==i.specular_map&&(this.specular_map=i.specular_map),void 0!==i.env_map&&(this.env_map=i.env_map),void 0!==i.combine&&(this.combine=i.combine),void 0!==i.reflectivity&&(this.reflectivity=i.reflectivity),void 0!==i.refraction_ratio&&(this.refraction_ratio=i.refraction_ratio),void 0!==i.fog&&(this.fog=i.fog),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin))},THREE.MeshPhongMaterial.prototype={toString:function(){return"THREE.MeshPhongMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>ambient: "+this.ambient+"<br/>specular: "+this.specular+"<br/>shininess: "+this.shininess+"<br/>map: "+this.map+"<br/>specular_map: "+this.specular_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>opacity: "+this.opacity+"<br/>shading: "+this.shading+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshPhongMaterialCounter={value:0},THREE.MeshDepthMaterial=function(i){this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending))},THREE.MeshDepthMaterial.prototype={toString:function(){return"THREE.MeshDepthMaterial"}},THREE.MeshNormalMaterial=function(i){this.opacity=1,this.shading=THREE.FlatShading,this.blending=THREE.NormalBlending,i&&(void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending))},THREE.MeshNormalMaterial.prototype={toString:function(){return"THREE.MeshNormalMaterial"}},THREE.MeshFaceMaterial=function(){},THREE.MeshFaceMaterial.prototype={toString:function(){return"THREE.MeshFaceMaterial"}},THREE.MeshShaderMaterial=function(i){this.id=THREE.MeshShaderMaterialCounter.value++,this.vertex_shader=this.fragment_shader="void main() {}",this.uniforms={},this.opacity=1,this.shading=THREE.SmoothShading,this.blending=THREE.NormalBlending,this.wireframe=!1,this.wireframe_linewidth=1,this.wireframe_linejoin=this.wireframe_linecap="round",i&&(void 0!==i.fragment_shader&&(this.fragment_shader=i.fragment_shader),void 0!==i.vertex_shader&&(this.vertex_shader=i.vertex_shader),void 0!==i.uniforms&&(this.uniforms=i.uniforms),void 0!==i.shading&&(this.shading=i.shading),void 0!==i.blending&&(this.blending=i.blending),void 0!==i.wireframe&&(this.wireframe=i.wireframe),void 0!==i.wireframe_linewidth&&(this.wireframe_linewidth=i.wireframe_linewidth),void 0!==i.wireframe_linecap&&(this.wireframe_linecap=i.wireframe_linecap),void 0!==i.wireframe_linejoin&&(this.wireframe_linejoin=i.wireframe_linejoin))},THREE.MeshShaderMaterial.prototype={toString:function(){return"THREE.MeshShaderMaterial (<br/>id: "+this.id+"<br/>blending: "+this.blending+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>)"}},THREE.MeshShaderMaterialCounter={value:0},THREE.ParticleBasicMaterial=function(i){this.color=new THREE.Color(16777215),this.map=null,this.opacity=1,this.blending=THREE.NormalBlending,this.offset=new THREE.Vector2,i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.map&&(this.map=i.map),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending))},THREE.ParticleBasicMaterial.prototype={toString:function(){return"THREE.ParticleBasicMaterial (<br/>color: "+this.color+"<br/>map: "+this.map+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleCircleMaterial=function(i){this.color=new THREE.Color(16777215),this.opacity=1,this.blending=THREE.NormalBlending,i&&(void 0!==i.color&&this.color.setHex(i.color),void 0!==i.opacity&&(this.opacity=i.opacity),void 0!==i.blending&&(this.blending=i.blending))},THREE.ParticleCircleMaterial.prototype={toString:function(){return"THREE.ParticleCircleMaterial (<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>blending: "+this.blending+"<br/>)"}},THREE.ParticleDOMMaterial=function(i){this.domElement=i},THREE.ParticleDOMMaterial.prototype={toString:function(){return"THREE.ParticleDOMMaterial ( domElement: "+this.domElement+" )"}},THREE.Texture=function(i,t,e,n,r,o){this.image=i,this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrap_s=void 0!==e?e:THREE.ClampToEdgeWrapping,this.wrap_t=void 0!==n?n:THREE.ClampToEdgeWrapping,this.mag_filter=void 0!==r?r:THREE.LinearFilter,this.min_filter=void 0!==o?o:THREE.LinearMipMapLinearFilter},THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrap_s,this.wrap_t,this.mag_filter,this.min_filter)},toString:function(){return"THREE.Texture (<br/>image: "+this.image+"<br/>wrap_s: "+this.wrap_s+"<br/>wrap_t: "+this.wrap_t+"<br/>mag_filter: "+this.mag_filter+"<br/>min_filter: "+this.min_filter+"<br/>)"}},THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.RepeatWrapping=0,THREE.ClampToEdgeWrapping=1,THREE.MirroredRepeatWrapping=2,THREE.NearestFilter=3,THREE.NearestMipMapNearestFilter=4,THREE.NearestMipMapLinearFilter=5,THREE.LinearFilter=6,THREE.LinearMipMapNearestFilter=7,THREE.LinearMipMapLinearFilter=8;var Uniforms={clone:function(i){var t,e,n,r={};for(t in i){r[t]={};for(e in i[t])n=i[t][e],r[t][e]=n instanceof THREE.Color||n instanceof THREE.Vector3||n instanceof THREE.Texture?n.clone():n}return r},merge:function(i){var t,e,n,r={};for(t=0;t<i.length;t++){n=this.clone(i[t]);for(e in n)r[e]=n[e]}return r}};THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.LatitudeReflectionMapping=function(){},THREE.LatitudeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.UVMapping=function(){},THREE.Scene=function(){this.objects=[],this.lights=[],this.fog=null,this.addObject=function(i){this.objects.indexOf(i)===-1&&this.objects.push(i)},this.removeObject=function(i){i=this.objects.indexOf(i),i!==-1&&this.objects.splice(i,1)},this.addLight=function(i){this.lights.indexOf(i)===-1&&this.lights.push(i)},this.removeLight=function(i){i=this.lights.indexOf(i),i!==-1&&this.lights.splice(i,1)},this.toString=function(){return"THREE.Scene ( "+this.objects+" )"}},THREE.Fog=function(i,t,e){this.color=new THREE.Color(i),this.near=t||1,this.far=e||1e3},THREE.FogExp2=function(i,t){this.color=new THREE.Color(i),this.density=t||25e-5},THREE.Projector=function(){function i(i,t){return t.z-i.z}function t(i,t){var e=0,n=1,r=i.z+i.w,o=t.z+t.w,s=-i.z+i.w,a=-t.z+t.w;return r>=0&&o>=0&&s>=0&&a>=0||!(r<0&&o<0||s<0&&a<0)&&(r<0?e=Math.max(e,r/(r-o)):o<0&&(n=Math.min(n,r/(r-o))),s<0?e=Math.max(e,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<e)&&(i.lerpSelf(t,e),t.lerpSelf(i,1-n),!0))}var e,n,r,o,s,a,h,c,l,f,E=[],p=[],m=[],u=[],g=new THREE.Vector4,d=new THREE.Vector4,v=new THREE.Matrix4,R=new THREE.Matrix4,T=[],y=new THREE.Vector4,_=new THREE.Vector4;this.projectObjects=function(t,r,o){var s,a,h=[];for(n=0,v.multiply(r.projectionMatrix,r.matrix),T[0]=new THREE.Vector4(v.n41-v.n11,v.n42-v.n12,v.n43-v.n13,v.n44-v.n14),T[1]=new THREE.Vector4(v.n41+v.n11,v.n42+v.n12,v.n43+v.n13,v.n44+v.n14),T[2]=new THREE.Vector4(v.n41+v.n21,v.n42+v.n22,v.n43+v.n23,v.n44+v.n24),T[3]=new THREE.Vector4(v.n41-v.n21,v.n42-v.n22,v.n43-v.n23,v.n44-v.n24),T[4]=new THREE.Vector4(v.n41-v.n31,v.n42-v.n32,v.n43-v.n33,v.n44-v.n34),T[5]=new THREE.Vector4(v.n41+v.n31,v.n42+v.n32,v.n43+v.n33,v.n44+v.n34),r=0,s=T.length;r<s;r++)a=T[r],a.divideScalar(Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z));for(s=t.objects,t=0,r=s.length;t<r;t++){a=s[t];var c;if(!(c=!a.visible)){if(c=a instanceof THREE.Mesh){i:{c=void 0;for(var l=a.position,f=-a.geometry.boundingSphere.radius*Math.max(a.scale.x,Math.max(a.scale.y,a.scale.z)),p=0;p<6;p++)if(c=T[p].x*l.x+T[p].y*l.y+T[p].z*l.z+T[p].w,c<=f){c=!1;break i}c=!0}c=!c}c=c}c||(e=E[n]=E[n]||new THREE.RenderableObject,g.copy(a.position),v.multiplyVector3(g),e.object=a,e.z=g.z,h.push(e),n++)}return o&&h.sort(i),h},this.projectScene=function(e,n,E){var g,T,b,x,H,S,w,M,L,A,z,P,C,F,B,N,V=[],j=n.near,U=n.far;for(s=h=l=0,n.autoUpdateMatrix&&n.updateMatrix(),v.multiply(n.projectionMatrix,n.matrix),S=this.projectObjects(e,n,!0),e=0,g=S.length;e<g;e++)if(w=S[e].object,w.visible)if(w.autoUpdateMatrix&&w.updateMatrix(),M=w.matrix,L=w.rotationMatrix,A=w.materials,z=w.overdraw,w instanceof THREE.Mesh){for(P=w.geometry,C=P.vertices,T=0,b=C.length;T<b;T++)F=C[T],F.positionWorld.copy(F.position),M.multiplyVector3(F.positionWorld),x=F.positionScreen,x.copy(F.positionWorld),v.multiplyVector4(x),x.x/=x.w,x.y/=x.w,F.__visible=x.z>j&&x.z<U;for(P=P.faces,T=0,b=P.length;T<b;T++)if(F=P[T],F instanceof THREE.Face3){if(x=C[F.a],H=C[F.b],B=C[F.c],x.__visible&&H.__visible&&B.__visible&&(w.doubleSided||w.flipSided!=(B.positionScreen.x-x.positionScreen.x)*(H.positionScreen.y-x.positionScreen.y)-(B.positionScreen.y-x.positionScreen.y)*(H.positionScreen.x-x.positionScreen.x)<0)){for(r=p[s]=p[s]||new THREE.RenderableFace3,r.v1.positionWorld.copy(x.positionWorld),r.v2.positionWorld.copy(H.positionWorld),r.v3.positionWorld.copy(B.positionWorld),r.v1.positionScreen.copy(x.positionScreen),r.v2.positionScreen.copy(H.positionScreen),r.v3.positionScreen.copy(B.positionScreen),r.normalWorld.copy(F.normal),L.multiplyVector3(r.normalWorld),r.centroidWorld.copy(F.centroid),M.multiplyVector3(r.centroidWorld),r.centroidScreen.copy(r.centroidWorld),v.multiplyVector3(r.centroidScreen),B=F.vertexNormals,f=r.vertexNormalsWorld,x=0,H=B.length;x<H;x++)N=f[x]=f[x]||new THREE.Vector3,N.copy(B[x]),L.multiplyVector3(N);r.z=r.centroidScreen.z,r.meshMaterials=A,r.faceMaterials=F.materials,r.overdraw=z,w.geometry.uvs[T]&&(r.uvs[0]=w.geometry.uvs[T][0],r.uvs[1]=w.geometry.uvs[T][1],r.uvs[2]=w.geometry.uvs[T][2]),V.push(r),s++}}else F instanceof THREE.Face4&&(x=C[F.a],H=C[F.b],B=C[F.c],N=C[F.d],x.__visible&&H.__visible&&B.__visible&&N.__visible&&(w.doubleSided||w.flipSided!=((N.positionScreen.x-x.positionScreen.x)*(H.positionScreen.y-x.positionScreen.y)-(N.positionScreen.y-x.positionScreen.y)*(H.positionScreen.x-x.positionScreen.x)<0||(H.positionScreen.x-B.positionScreen.x)*(N.positionScreen.y-B.positionScreen.y)-(H.positionScreen.y-B.positionScreen.y)*(N.positionScreen.x-B.positionScreen.x)<0))&&(r=p[s]=p[s]||new THREE.RenderableFace3,r.v1.positionWorld.copy(x.positionWorld),r.v2.positionWorld.copy(H.positionWorld),r.v3.positionWorld.copy(N.positionWorld),r.v1.positionScreen.copy(x.positionScreen),r.v2.positionScreen.copy(H.positionScreen),r.v3.positionScreen.copy(N.positionScreen),r.normalWorld.copy(F.normal),L.multiplyVector3(r.normalWorld),r.centroidWorld.copy(F.centroid),M.multiplyVector3(r.centroidWorld),r.centroidScreen.copy(r.centroidWorld),v.multiplyVector3(r.centroidScreen),r.z=r.centroidScreen.z,r.meshMaterials=A,r.faceMaterials=F.materials,r.overdraw=z,w.geometry.uvs[T]&&(r.uvs[0]=w.geometry.uvs[T][0],r.uvs[1]=w.geometry.uvs[T][1],r.uvs[2]=w.geometry.uvs[T][3]),V.push(r),s++,o=p[s]=p[s]||new THREE.RenderableFace3,o.v1.positionWorld.copy(H.positionWorld),o.v2.positionWorld.copy(B.positionWorld),o.v3.positionWorld.copy(N.positionWorld),o.v1.positionScreen.copy(H.positionScreen),o.v2.positionScreen.copy(B.positionScreen),o.v3.positionScreen.copy(N.positionScreen),o.normalWorld.copy(r.normalWorld),o.centroidWorld.copy(r.centroidWorld),o.centroidScreen.copy(r.centroidScreen),o.z=o.centroidScreen.z,o.meshMaterials=A,o.faceMaterials=F.materials,o.overdraw=z,w.geometry.uvs[T]&&(o.uvs[0]=w.geometry.uvs[T][1],o.uvs[1]=w.geometry.uvs[T][2],o.uvs[2]=w.geometry.uvs[T][3]),V.push(o),s++))}else if(w instanceof THREE.Line)for(R.multiply(v,M),C=w.geometry.vertices,F=C[0],F.positionScreen.copy(F.position),R.multiplyVector4(F.positionScreen),T=1,b=C.length;T<b;T++)x=C[T],x.positionScreen.copy(x.position),R.multiplyVector4(x.positionScreen),H=C[T-1],y.copy(x.positionScreen),_.copy(H.positionScreen),t(y,_)&&(y.multiplyScalar(1/y.w),_.multiplyScalar(1/_.w),a=m[h]=m[h]||new THREE.RenderableLine,a.v1.positionScreen.copy(y),a.v2.positionScreen.copy(_),a.z=Math.max(y.z,_.z),a.materials=w.materials,V.push(a),h++);else w instanceof THREE.Particle&&(d.set(w.position.x,w.position.y,w.position.z,1),v.multiplyVector4(d),d.z/=d.w,d.z>0&&d.z<1&&(c=u[l]=u[l]||new THREE.RenderableParticle,c.x=d.x/d.w,c.y=d.y/d.w,c.z=d.z,c.rotation=w.rotation.z,c.scale.x=w.scale.x*Math.abs(c.x-(d.x+n.projectionMatrix.n11)/(d.w+n.projectionMatrix.n14)),c.scale.y=w.scale.y*Math.abs(c.y-(d.y+n.projectionMatrix.n22)/(d.w+n.projectionMatrix.n24)),c.materials=w.materials,V.push(c),l++));return E&&V.sort(i),V},this.unprojectVector=function(i,t){var e=new THREE.Matrix4;return e.multiply(THREE.Matrix4.makeInvert(t.matrix),THREE.Matrix4.makeInvert(t.projectionMatrix)),e.multiplyVector3(i),i}},THREE.DOMRenderer=function(){THREE.Renderer.call(this);var i,t,e,n,r=null,o=new THREE.Projector;this.domElement=document.createElement("div"),this.setSize=function(r,o){i=r,t=o,e=i/2,n=t/2},this.render=function(i,t){var s,a,h,c,l,f,E,p;for(r=o.projectScene(i,t),s=0,a=r.length;s<a;s++)if(l=r[s],l instanceof THREE.RenderableParticle)for(E=l.x*e+e,p=l.y*n+n,h=0,c=l.material.length;h<c;h++)f=l.material[h],f instanceof THREE.ParticleDOMMaterial&&(f=f.domElement,f.style.left=E+"px",f.style.top=p+"px")}},THREE.CanvasRenderer=function(){function i(i){N!=i&&(C.globalAlpha=N=i)}function t(i){if(V!=i){switch(i){case THREE.NormalBlending:C.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:C.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:C.globalCompositeOperation="darker"}V=i}}var e,n,r,o,s,a,h,c,l,f,E,p,m,u,g,d,v,R,T,y,_,b,x,H,S,w,M,L,A=null,z=new THREE.Projector,P=document.createElement("canvas"),C=P.getContext("2d"),F=null,B=null,N=1,V=0,j=null,U=null,D=1,G=new THREE.Color,W=new THREE.Color,I=new THREE.Color,O=new THREE.Color,X=new THREE.Color,k=new THREE.Rectangle,Y=new THREE.Rectangle,q=new THREE.Rectangle,Z=!1,K=new THREE.Color,Q=new THREE.Color,J=new THREE.Color,$=new THREE.Color,ii=2*Math.PI,ti=new THREE.Vector3,ei=16;x=document.createElement("canvas"),x.width=x.height=2,H=x.getContext("2d"),H.fillStyle="rgba(0,0,0,1)",H.fillRect(0,0,2,2),S=H.getImageData(0,0,2,2),w=S.data,M=document.createElement("canvas"),M.width=M.height=ei,L=M.getContext("2d"),L.translate(-ei/2,-ei/2),L.scale(ei,ei),ei--,this.domElement=P,this.sortElements=this.sortObjects=this.autoClear=!0,this.setSize=function(i,t){e=i,n=t,r=e/2,o=n/2,P.width=e,P.height=n,k.set(-r,-o,r,o)},this.setClearColor=function(i,t){F=null!==i?new THREE.Color(i):null,B=t,Y.set(-r,-o,r,o),C.setTransform(1,0,0,-1,r,o),this.clear()},this.clear=function(){Y.isEmpty()||(Y.inflate(1),Y.minSelf(k),null!==F?(t(THREE.NormalBlending),i(1),C.fillStyle="rgba("+Math.floor(255*F.r)+","+Math.floor(255*F.g)+","+Math.floor(255*F.b)+","+B+")",C.fillRect(Y.getX(),Y.getY(),Y.getWidth(),Y.getHeight())):C.clearRect(Y.getX(),Y.getY(),Y.getWidth(),Y.getHeight()),Y.empty())},this.render=function(e,n){function P(i){var t,e,n,r=i.lights;for(Q.setRGB(0,0,0),J.setRGB(0,0,0),$.setRGB(0,0,0),i=0,t=r.length;i<t;i++)e=r[i],n=e.color,e instanceof THREE.AmbientLight?(Q.r+=n.r,Q.g+=n.g,Q.b+=n.b):e instanceof THREE.DirectionalLight?(J.r+=n.r,J.g+=n.g,J.b+=n.b):e instanceof THREE.PointLight&&($.r+=n.r,$.g+=n.g,$.b+=n.b)}function F(i,t,e,n){var r,o,s,a,h=i.lights;for(i=0,r=h.length;i<r;i++)o=h[i],s=o.color,a=o.intensity,o instanceof THREE.DirectionalLight?(o=e.dot(o.position)*a,o>0&&(n.r+=s.r*o,n.g+=s.g*o,n.b+=s.b*o)):o instanceof THREE.PointLight&&(ti.sub(o.position,t),ti.normalize(),o=e.dot(ti)*a,o>0&&(n.r+=s.r*o,n.g+=s.g*o,n.b+=s.b*o))}function B(e,n,s){if(0!=s.opacity){i(s.opacity),t(s.blending);var a,h,c,l,f,E;s instanceof THREE.ParticleBasicMaterial?s.map&&(l=s.map,f=l.width>>1,E=l.height>>1,h=n.scale.x*r,c=n.scale.y*o,s=h*f,a=c*E,q.set(e.x-s,e.y-a,e.x+s,e.y+a),k.instersects(q)&&(C.save(),C.translate(e.x,e.y),C.rotate(-n.rotation),C.scale(h,-c),C.translate(-f,-E),C.drawImage(l,0,0),C.restore())):s instanceof THREE.ParticleCircleMaterial&&(Z?(K.r=Q.r+J.r+$.r,K.g=Q.g+J.g+$.g,K.b=Q.b+J.b+$.b,G.r=s.color.r*K.r,G.g=s.color.g*K.g,G.b=s.color.b*K.b,G.updateStyleString()):G.__styleString=s.color.__styleString,s=n.scale.x*r,a=n.scale.y*o,q.set(e.x-s,e.y-a,e.x+s,e.y+a),k.instersects(q)&&(h=G.__styleString,U!=h&&(C.fillStyle=U=h),C.save(),C.translate(e.x,e.y),C.rotate(-n.rotation),C.scale(s,a),C.beginPath(),C.arc(0,0,1,0,ii,!0),C.closePath(),C.fill(),C.restore()))}}function N(e,n,r,o){0!=o.opacity&&(i(o.opacity),t(o.blending),C.beginPath(),C.moveTo(e.positionScreen.x,e.positionScreen.y),C.lineTo(n.positionScreen.x,n.positionScreen.y),C.closePath(),o instanceof THREE.LineBasicMaterial&&(G.__styleString=o.color.__styleString,e=o.linewidth,D!=e&&(C.lineWidth=D=e),e=G.__styleString,j!=e&&(C.strokeStyle=j=e),C.stroke(),q.inflate(2*o.linewidth)))}function V(e,r,o,s,a,h){0!=a.opacity&&(i(a.opacity),t(a.blending),c=e.positionScreen.x,l=e.positionScreen.y,f=r.positionScreen.x,E=r.positionScreen.y,p=o.positionScreen.x,m=o.positionScreen.y,C.beginPath(),C.moveTo(c,l),C.lineTo(f,E),C.lineTo(p,m),C.lineTo(c,l),C.closePath(),a instanceof THREE.MeshBasicMaterial?a.map?a.map.image.loaded&&a.map.mapping instanceof THREE.UVMapping&&ri(c,l,f,E,p,m,a.map.image,s.uvs[0].u,s.uvs[0].v,s.uvs[1].u,s.uvs[1].v,s.uvs[2].u,s.uvs[2].v):a.env_map?a.env_map.image.loaded&&a.env_map.mapping instanceof THREE.SphericalReflectionMapping&&(e=n.matrix,ti.copy(s.vertexNormalsWorld[0]),v=.5*(ti.x*e.n11+ti.y*e.n12+ti.z*e.n13)+.5,R=.5*-(ti.x*e.n21+ti.y*e.n22+ti.z*e.n23)+.5,ti.copy(s.vertexNormalsWorld[1]),T=.5*(ti.x*e.n11+ti.y*e.n12+ti.z*e.n13)+.5,y=.5*-(ti.x*e.n21+ti.y*e.n22+ti.z*e.n23)+.5,ti.copy(s.vertexNormalsWorld[2]),_=.5*(ti.x*e.n11+ti.y*e.n12+ti.z*e.n13)+.5,b=.5*-(ti.x*e.n21+ti.y*e.n22+ti.z*e.n23)+.5,ri(c,l,f,E,p,m,a.env_map.image,v,R,T,y,_,b)):a.wireframe?ei(a.color.__styleString,a.wireframe_linewidth):ni(a.color.__styleString):a instanceof THREE.MeshLambertMaterial?(a.map&&!a.wireframe&&(a.map.mapping instanceof THREE.UVMapping&&ri(c,l,f,E,p,m,a.map.image,s.uvs[0].u,s.uvs[0].v,s.uvs[1].u,s.uvs[1].v,s.uvs[2].u,s.uvs[2].v),t(THREE.SubtractiveBlending)),Z?a.wireframe||a.shading!=THREE.SmoothShading||3!=s.vertexNormalsWorld.length?(K.r=Q.r,K.g=Q.g,K.b=Q.b,F(h,s.centroidWorld,s.normalWorld,K),G.r=a.color.r*K.r,G.g=a.color.g*K.g,G.b=a.color.b*K.b,G.updateStyleString(),a.wireframe?ei(G.__styleString,a.wireframe_linewidth):ni(G.__styleString)):(W.r=I.r=O.r=Q.r,W.g=I.g=O.g=Q.g,W.b=I.b=O.b=Q.b,F(h,s.v1.positionWorld,s.vertexNormalsWorld[0],W),F(h,s.v2.positionWorld,s.vertexNormalsWorld[1],I),F(h,s.v3.positionWorld,s.vertexNormalsWorld[2],O),X.r=.5*(I.r+O.r),X.g=.5*(I.g+O.g),X.b=.5*(I.b+O.b),d=oi(W,I,O,X),ri(c,l,f,E,p,m,d,0,0,1,0,0,1)):a.wireframe?ei(a.color.__styleString,a.wireframe_linewidth):ni(a.color.__styleString)):a instanceof THREE.MeshDepthMaterial?(u=n.near,g=n.far,W.r=W.g=W.b=1-si(e.positionScreen.z,u,g),I.r=I.g=I.b=1-si(r.positionScreen.z,u,g),O.r=O.g=O.b=1-si(o.positionScreen.z,u,g),X.r=.5*(I.r+O.r),X.g=.5*(I.g+O.g),X.b=.5*(I.b+O.b),d=oi(W,I,O,X),ri(c,l,f,E,p,m,d,0,0,1,0,0,1)):a instanceof THREE.MeshNormalMaterial&&(G.r=ai(s.normalWorld.x),G.g=ai(s.normalWorld.y),G.b=ai(s.normalWorld.z),G.updateStyleString(),a.wireframe?ei(G.__styleString,a.wireframe_linewidth):ni(G.__styleString)))}function ei(i,t){j!=i&&(C.strokeStyle=j=i),D!=t&&(C.lineWidth=D=t),C.stroke(),q.inflate(2*t)}function ni(i){U!=i&&(C.fillStyle=U=i),C.fill()}function ri(i,t,e,n,r,o,s,a,h,c,l,f,E){var p,m;p=s.width-1,m=s.height-1,a*=p,h*=m,c*=p,l*=m,f*=p,E*=m,e-=i,n-=t,r-=i,o-=t,c-=a,l-=h,f-=a,E-=h,m=1/(c*E-f*l),p=(E*e-l*r)*m,l=(E*n-l*o)*m,e=(c*r-f*e)*m,n=(c*o-f*n)*m,i=i-p*a-e*h,t=t-l*a-n*h,C.save(),C.transform(p,l,e,n,i,t),C.clip(),C.drawImage(s,0,0),C.restore()}function oi(i,t,e,n){var r=~~(255*i.r),o=~~(255*i.g);i=~~(255*i.b);var s=~~(255*t.r),a=~~(255*t.g);t=~~(255*t.b);var h=~~(255*e.r),c=~~(255*e.g);e=~~(255*e.b);var l=~~(255*n.r),f=~~(255*n.g);return n=~~(255*n.b),w[0]=r<0?0:r>255?255:r,w[1]=o<0?0:o>255?255:o,w[2]=i<0?0:i>255?255:i,w[4]=s<0?0:s>255?255:s,w[5]=a<0?0:a>255?255:a,w[6]=t<0?0:t>255?255:t,w[8]=h<0?0:h>255?255:h,w[9]=c<0?0:c>255?255:c,w[10]=e<0?0:e>255?255:e,w[12]=l<0?0:l>255?255:l,w[13]=f<0?0:f>255?255:f,w[14]=n<0?0:n>255?255:n,H.putImageData(S,0,0),L.drawImage(x,0,0),M}function si(i,t,e){return i=(i-t)/(e-t),i*i*(3-2*i)}function ai(i){return i=.5*(i+1),i<0?0:i>1?1:i}function hi(i,t){var e=t.x-i.x,n=t.y-i.y,r=1/Math.sqrt(e*e+n*n);e*=r,n*=r,t.x+=e,t.y+=n,i.x-=e,i.y-=n}var ci,li,fi,Ei,pi,mi,ui,gi;for(C.setTransform(1,0,0,-1,r,o),this.autoClear&&this.clear(),A=z.projectScene(e,n,this.sortElements),(Z=e.lights.length>0)&&P(e),ci=0,li=A.length;ci<li;ci++){if(fi=A[ci],q.empty(),fi instanceof THREE.RenderableParticle)for(s=fi,s.x*=r,s.y*=o,Ei=0,pi=fi.materials.length;Ei<pi;Ei++)B(s,fi,fi.materials[Ei],e);else if(fi instanceof THREE.RenderableLine){if(s=fi.v1,a=fi.v2,s.positionScreen.x*=r,s.positionScreen.y*=o,a.positionScreen.x*=r,a.positionScreen.y*=o,q.addPoint(s.positionScreen.x,s.positionScreen.y),q.addPoint(a.positionScreen.x,a.positionScreen.y),k.instersects(q))for(Ei=0,pi=fi.materials.length;Ei<pi;)N(s,a,fi,fi.materials[Ei++],e)}else if(fi instanceof THREE.RenderableFace3&&(s=fi.v1,a=fi.v2,h=fi.v3,s.positionScreen.x*=r,s.positionScreen.y*=o,a.positionScreen.x*=r,a.positionScreen.y*=o,h.positionScreen.x*=r,h.positionScreen.y*=o,fi.overdraw&&(hi(s.positionScreen,a.positionScreen),hi(a.positionScreen,h.positionScreen),hi(h.positionScreen,s.positionScreen)),q.add3Points(s.positionScreen.x,s.positionScreen.y,a.positionScreen.x,a.positionScreen.y,h.positionScreen.x,h.positionScreen.y),k.instersects(q)))for(Ei=0,pi=fi.meshMaterials.length;Ei<pi;)if(gi=fi.meshMaterials[Ei++],gi instanceof THREE.MeshFaceMaterial)for(mi=0,ui=fi.faceMaterials.length;mi<ui;)(gi=fi.faceMaterials[mi++])&&V(s,a,h,fi,gi,e);else V(s,a,h,fi,gi,e);Y.addRectangle(q)}C.setTransform(1,0,0,1,0,0)}},THREE.SVGRenderer=function(){function i(i,t,e){var n,r,o,s;for(n=0,r=i.lights.length;n<r;n++)o=i.lights[n],o instanceof THREE.DirectionalLight?(s=t.normalWorld.dot(o.position)*o.intensity,s>0&&(e.r+=o.color.r*s,e.g+=o.color.g*s,e.b+=o.color.b*s)):o instanceof THREE.PointLight&&(L.sub(o.position,t.centroidWorld),L.normalize(),s=t.normalWorld.dot(L)*o.intensity,s>0&&(e.r+=o.color.r*s,e.g+=o.color.g*s,e.b+=o.color.b*s))}function t(t,e,o,s,a,h){m=n(u++),m.setAttribute("d","M "+t.positionScreen.x+" "+t.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+"z"),a instanceof THREE.MeshBasicMaterial?x.__styleString=a.color.__styleString:a instanceof THREE.MeshLambertMaterial?b?(H.r=S.r,H.g=S.g,H.b=S.b,i(h,s,H),x.r=a.color.r*H.r,x.g=a.color.g*H.g,x.b=a.color.b*H.b,x.updateStyleString()):x.__styleString=a.color.__styleString:a instanceof THREE.MeshDepthMaterial?(p=1-a.__2near/(a.__farPlusNear-s.z*a.__farMinusNear),x.setRGB(p,p,p)):a instanceof THREE.MeshNormalMaterial&&x.setRGB(r(s.normalWorld.x),r(s.normalWorld.y),r(s.normalWorld.z)),a.wireframe?m.setAttribute("style","fill: none; stroke: "+x.__styleString+"; stroke-width: "+a.wireframe_linewidth+"; stroke-opacity: "+a.opacity+"; stroke-linecap: "+a.wireframe_linecap+"; stroke-linejoin: "+a.wireframe_linejoin):m.setAttribute("style","fill: "+x.__styleString+"; fill-opacity: "+a.opacity),T.appendChild(m)}function e(t,e,o,s,a,h,c){m=n(u++),m.setAttribute("d","M "+t.positionScreen.x+" "+t.positionScreen.y+" L "+e.positionScreen.x+" "+e.positionScreen.y+" L "+o.positionScreen.x+","+o.positionScreen.y+" L "+s.positionScreen.x+","+s.positionScreen.y+"z"),h instanceof THREE.MeshBasicMaterial?x.__styleString=h.color.__styleString:h instanceof THREE.MeshLambertMaterial?b?(H.r=S.r,H.g=S.g,H.b=S.b,i(c,a,H),x.r=h.color.r*H.r,x.g=h.color.g*H.g,x.b=h.color.b*H.b,x.updateStyleString()):x.__styleString=h.color.__styleString:h instanceof THREE.MeshDepthMaterial?(p=1-h.__2near/(h.__farPlusNear-a.z*h.__farMinusNear),x.setRGB(p,p,p)):h instanceof THREE.MeshNormalMaterial&&x.setRGB(r(a.normalWorld.x),r(a.normalWorld.y),r(a.normalWorld.z)),h.wireframe?m.setAttribute("style","fill: none; stroke: "+x.__styleString+"; stroke-width: "+h.wireframe_linewidth+"; stroke-opacity: "+h.opacity+"; stroke-linecap: "+h.wireframe_linecap+"; stroke-linejoin: "+h.wireframe_linejoin):m.setAttribute("style","fill: "+x.__styleString+"; fill-opacity: "+h.opacity),T.appendChild(m)}function n(i){return null==A[i]?(A[i]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==C&&A[i].setAttribute("shape-rendering","crispEdges"),A[i]):A[i]}function r(i){return i<0?Math.min(.5*(1+i),.5):.5+Math.min(.5*i,.5)}var o,s,a,h,c,l,f,E,p,m,u,g,d,v=null,R=new THREE.Projector,T=document.createElementNS("http://www.w3.org/2000/svg","svg"),y=new THREE.Rectangle,_=new THREE.Rectangle,b=!1,x=new THREE.Color(16777215),H=new THREE.Color(16777215),S=new THREE.Color(0),w=new THREE.Color(0),M=new THREE.Color(0),L=new THREE.Vector3,A=[],z=[],P=[],C=1;this.domElement=T,this.sortElements=this.sortObjects=this.autoClear=!0,this.setQuality=function(i){switch(i){case"high":C=1;break;case"low":C=0}},this.setSize=function(i,t){o=i,s=t,a=o/2,h=s/2,T.setAttribute("viewBox",-a+" "+-h+" "+o+" "+s),T.setAttribute("width",o),T.setAttribute("height",s),y.set(-a,-h,a,h)},this.clear=function(){for(;T.childNodes.length>0;)T.removeChild(T.childNodes[0])},this.render=function(i,n){var r,o,s,p,L,A,F,B;if(this.autoClear&&this.clear(),v=R.projectScene(i,n,this.sortElements),d=g=u=0,b=i.lights.length>0)for(F=i.lights,S.setRGB(0,0,0),w.setRGB(0,0,0),M.setRGB(0,0,0),r=0,o=F.length;r<o;r++)s=F[r],p=s.color,s instanceof THREE.AmbientLight?(S.r+=p.r,S.g+=p.g,S.b+=p.b):s instanceof THREE.DirectionalLight?(w.r+=p.r,w.g+=p.g,w.b+=p.b):s instanceof THREE.PointLight&&(M.r+=p.r,M.g+=p.g,M.b+=p.b);for(r=0,o=v.length;r<o;r++)if(F=v[r],_.empty(),F instanceof THREE.RenderableParticle){for(c=F,c.x*=a,c.y*=-h,s=0,p=F.materials.length;s<p;s++)if(B=F.materials[s]){L=c,A=F,B=B;var N=g++;null==z[N]&&(z[N]=document.createElementNS("http://www.w3.org/2000/svg","circle"),0==C&&z[N].setAttribute("shape-rendering","crispEdges")),m=z[N],m.setAttribute("cx",L.x),m.setAttribute("cy",L.y),m.setAttribute("r",A.scale.x*a),B instanceof THREE.ParticleCircleMaterial&&(b?(H.r=S.r+w.r+M.r,H.g=S.g+w.g+M.g,H.b=S.b+w.b+M.b,x.r=B.color.r*H.r,x.g=B.color.g*H.g,x.b=B.color.b*H.b,x.updateStyleString()):x=B.color,m.setAttribute("style","fill: "+x.__styleString)),T.appendChild(m)}}else if(F instanceof THREE.RenderableLine){if(c=F.v1,l=F.v2,c.positionScreen.x*=a,c.positionScreen.y*=-h,l.positionScreen.x*=a,l.positionScreen.y*=-h,_.addPoint(c.positionScreen.x,c.positionScreen.y),_.addPoint(l.positionScreen.x,l.positionScreen.y),y.instersects(_))for(s=0,p=F.materials.length;s<p;)(B=F.materials[s++])&&(L=c,A=l,B=B,N=d++,null==P[N]&&(P[N]=document.createElementNS("http://www.w3.org/2000/svg","line"),0==C&&P[N].setAttribute("shape-rendering","crispEdges")),m=P[N],m.setAttribute("x1",L.positionScreen.x),m.setAttribute("y1",L.positionScreen.y),m.setAttribute("x2",A.positionScreen.x),m.setAttribute("y2",A.positionScreen.y),B instanceof THREE.LineBasicMaterial&&(x.__styleString=B.color.__styleString,m.setAttribute("style","fill: none; stroke: "+x.__styleString+"; stroke-width: "+B.linewidth+"; stroke-opacity: "+B.opacity+"; stroke-linecap: "+B.linecap+"; stroke-linejoin: "+B.linejoin),T.appendChild(m)))}else if(F instanceof THREE.RenderableFace3){if(c=F.v1,l=F.v2,f=F.v3,c.positionScreen.x*=a,c.positionScreen.y*=-h,l.positionScreen.x*=a,l.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,_.addPoint(c.positionScreen.x,c.positionScreen.y),_.addPoint(l.positionScreen.x,l.positionScreen.y),_.addPoint(f.positionScreen.x,f.positionScreen.y),y.instersects(_))for(s=0,p=F.meshMaterials.length;s<p;)if(B=F.meshMaterials[s++],B instanceof THREE.MeshFaceMaterial)for(L=0,A=F.faceMaterials.length;L<A;)(B=F.faceMaterials[L++])&&t(c,l,f,F,B,i);else B&&t(c,l,f,F,B,i)}else if(F instanceof THREE.RenderableFace4&&(c=F.v1,l=F.v2,f=F.v3,E=F.v4,c.positionScreen.x*=a,c.positionScreen.y*=-h,l.positionScreen.x*=a,l.positionScreen.y*=-h,f.positionScreen.x*=a,f.positionScreen.y*=-h,E.positionScreen.x*=a,E.positionScreen.y*=-h,_.addPoint(c.positionScreen.x,c.positionScreen.y),_.addPoint(l.positionScreen.x,l.positionScreen.y),_.addPoint(f.positionScreen.x,f.positionScreen.y),_.addPoint(E.positionScreen.x,E.positionScreen.y),y.instersects(_)))for(s=0,p=F.meshMaterials.length;s<p;)if(B=F.meshMaterials[s++],B instanceof THREE.MeshFaceMaterial)for(L=0,A=F.faceMaterials.length;L<A;)(B=F.faceMaterials[L++])&&e(c,l,f,E,F,B,i);else B&&e(c,l,f,E,F,B,i)}},THREE.WebGLRenderer=function(i){function t(i,t){i.fragment_shader=t.fragment_shader,i.vertex_shader=t.vertex_shader,i.uniforms=Uniforms.clone(t.uniforms)}function e(i,t){i.uniforms.color.value.setRGB(i.color.r*i.opacity,i.color.g*i.opacity,i.color.b*i.opacity),i.uniforms.opacity.value=i.opacity,i.uniforms.map.texture=i.map,i.uniforms.env_map.texture=i.env_map,i.uniforms.reflectivity.value=i.reflectivity,i.uniforms.refraction_ratio.value=i.refraction_ratio,i.uniforms.combine.value=i.combine,i.uniforms.useRefract.value=i.env_map&&i.env_map.mapping instanceof THREE.CubeRefractionMapping,t&&(i.uniforms.fogColor.value.setHex(t.color.hex),t instanceof THREE.Fog?(i.uniforms.fogNear.value=t.near,i.uniforms.fogFar.value=t.far):t instanceof THREE.FogExp2&&(i.uniforms.fogDensity.value=t.density))}function n(i,t){var e;return"fragment"==i?e=o.createShader(o.FRAGMENT_SHADER):"vertex"==i&&(e=o.createShader(o.VERTEX_SHADER)),o.shaderSource(e,t),o.compileShader(e),o.getShaderParameter(e,o.COMPILE_STATUS)?e:(alert(o.getShaderInfoLog(e)),null)}function r(i){switch(i){case THREE.RepeatWrapping:return o.REPEAT;case THREE.ClampToEdgeWrapping:return o.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return o.MIRRORED_REPEAT;case THREE.NearestFilter:return o.NEAREST;case THREE.NearestMipMapNearestFilter:return o.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return o.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return o.LINEAR;case THREE.LinearMipMapNearestFilter:return o.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return o.LINEAR_MIPMAP_LINEAR}return 0}var o,s,a=document.createElement("canvas"),h=null,c=new THREE.Matrix4,l=new Float32Array(16),f=new Float32Array(16),E=new Float32Array(16),p=new Float32Array(9),m=new Float32Array(16),u=!0,d=new THREE.Color(0),v=0;i&&(void 0!==i.antialias&&(u=i.antialias),void 0!==i.clearColor&&d.setHex(i.clearColor),void 0!==i.clearAlpha&&(v=i.clearAlpha)),
this.domElement=a,this.autoClear=!0,function(i,t,e){try{o=a.getContext("experimental-webgl",{antialias:i})}catch(i){}if(!o)throw alert("WebGL not supported"),"cannot create webgl context";o.clearColor(0,0,0,1),o.clearDepth(1),o.enable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.frontFace(o.CCW),o.cullFace(o.BACK),o.enable(o.CULL_FACE),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.clearColor(t.r,t.g,t.b,e)}(u,d,v),this.setSize=function(i,t){a.width=i,a.height=t,o.viewport(0,0,a.width,a.height)},this.setClearColor=function(i,t){var e=new THREE.Color(i);o.clearColor(e.r,e.g,e.b,t)},this.clear=function(){o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)},this.setupLights=function(i,t){var e,n,r,o=g=b=0,s=[],a=[],h=[],c=[];for(e=0,n=t.length;e<n;e++)r=t[e],r instanceof THREE.AmbientLight?(o+=r.color.r,g+=r.color.g,b+=r.color.b):r instanceof THREE.DirectionalLight?(s.push(r.color.r*r.intensity,r.color.g*r.intensity,r.color.b*r.intensity),a.push(r.position.x,r.position.y,r.position.z)):r instanceof THREE.PointLight&&(h.push(r.color.r*r.intensity,r.color.g*r.intensity,r.color.b*r.intensity),c.push(r.position.x,r.position.y,r.position.z));return{ambient:[o,g,b],directional:{colors:s,positions:a},point:{colors:h,positions:c}}},this.createBuffers=function(i,t){var e,n,r,s,a,h,c,l,f,E,p,m=[],u=[],g=[],d=[],v=[],R=[],T=0,y=i.geometry.geometryChunks[t];for(a=!1,e=0,n=i.materials.length;e<n;e++){if(h=i.materials[e],h instanceof THREE.MeshFaceMaterial){for(h=0,p=y.materials.length;h<p;h++)if(y.materials[h]&&void 0!=y.materials[h].shading&&y.materials[h].shading==THREE.SmoothShading){a=!0;break}}else if(h&&void 0!=h.shading&&h.shading==THREE.SmoothShading){a=!0;break}if(a)break}for(p=a,e=0,n=y.faces.length;e<n;e++)if(r=y.faces[e],s=i.geometry.faces[r],a=s.vertexNormals,h=s.normal,r=i.geometry.uvs[r],s instanceof THREE.Face3){if(c=i.geometry.vertices[s.a].position,l=i.geometry.vertices[s.b].position,f=i.geometry.vertices[s.c].position,g.push(c.x,c.y,c.z,l.x,l.y,l.z,f.x,f.y,f.z),i.geometry.hasTangents&&(c=i.geometry.vertices[s.a].tangent,l=i.geometry.vertices[s.b].tangent,f=i.geometry.vertices[s.c].tangent,v.push(c.x,c.y,c.z,c.w,l.x,l.y,l.z,l.w,f.x,f.y,f.z,f.w)),3==a.length&&p)for(s=0;s<3;s++)d.push(a[s].x,a[s].y,a[s].z);else for(s=0;s<3;s++)d.push(h.x,h.y,h.z);if(r)for(s=0;s<3;s++)R.push(r[s].u,r[s].v);m.push(T,T+1,T+2),u.push(T,T+1,T,T+2,T+1,T+2),T+=3}else if(s instanceof THREE.Face4){if(c=i.geometry.vertices[s.a].position,l=i.geometry.vertices[s.b].position,f=i.geometry.vertices[s.c].position,E=i.geometry.vertices[s.d].position,g.push(c.x,c.y,c.z,l.x,l.y,l.z,f.x,f.y,f.z,E.x,E.y,E.z),i.geometry.hasTangents&&(c=i.geometry.vertices[s.a].tangent,l=i.geometry.vertices[s.b].tangent,f=i.geometry.vertices[s.c].tangent,s=i.geometry.vertices[s.d].tangent,v.push(c.x,c.y,c.z,c.w,l.x,l.y,l.z,l.w,f.x,f.y,f.z,f.w,s.x,s.y,s.z,s.w)),4==a.length&&p)for(s=0;s<4;s++)d.push(a[s].x,a[s].y,a[s].z);else for(s=0;s<4;s++)d.push(h.x,h.y,h.z);if(r)for(s=0;s<4;s++)R.push(r[s].u,r[s].v);m.push(T,T+1,T+2,T,T+2,T+3),u.push(T,T+1,T,T+2,T,T+3,T+1,T+2,T+2,T+3),T+=4}g.length&&(y.__webGLVertexBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLVertexBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(g),o.STATIC_DRAW),y.__webGLNormalBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLNormalBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(d),o.STATIC_DRAW),i.geometry.hasTangents&&(y.__webGLTangentBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLTangentBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(v),o.STATIC_DRAW)),R.length>0&&(y.__webGLUVBuffer=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,y.__webGLUVBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(R),o.STATIC_DRAW)),y.__webGLFaceBuffer=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,y.__webGLFaceBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(m),o.STATIC_DRAW),y.__webGLLineBuffer=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,y.__webGLLineBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),o.STATIC_DRAW),y.__webGLFaceCount=m.length,y.__webGLLineCount=u.length)},this.renderBuffer=function(i,s,a,c,l){var f,E,p,m;if(!c.program){if(c instanceof THREE.MeshDepthMaterial?(t(c,THREE.ShaderLib.depth),c.uniforms.mNear.value=i.near,c.uniforms.mFar.value=i.far):c instanceof THREE.MeshNormalMaterial?t(c,THREE.ShaderLib.normal):c instanceof THREE.MeshBasicMaterial?(t(c,THREE.ShaderLib.basic),e(c,a)):c instanceof THREE.MeshLambertMaterial?(t(c,THREE.ShaderLib.lambert),e(c,a)):c instanceof THREE.MeshPhongMaterial&&(t(c,THREE.ShaderLib.phong),e(c,a)),scene){var u,g,d;for(u=m=E=0,g=s.length;u<g;u++)d=s[u],d instanceof THREE.DirectionalLight&&m++,d instanceof THREE.PointLight&&E++;E+m<=4?(u=m,E=E):(u=Math.ceil(4*m/(E+m)),E=4-u),E={directional:u,point:E}}else E={directional:1,point:3};m={fog:a,map:c.map,env_map:c.env_map,maxDirLights:E.directional,maxPointLights:E.point},E=c.fragment_shader,u=c.vertex_shader,g=o.createProgram(),d=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+m.maxDirLights,"#define MAX_POINT_LIGHTS "+m.maxPointLights,m.fog?"#define USE_FOG":"",m.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",m.map?"#define USE_MAP":"",m.env_map?"#define USE_ENVMAP":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),m=[o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+m.maxDirLights,"#define MAX_POINT_LIGHTS "+m.maxPointLights,m.map?"#define USE_MAP":"",m.env_map?"#define USE_ENVMAP":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n"].join("\n"),o.attachShader(g,n("fragment",d+E)),o.attachShader(g,n("vertex",m+u)),o.linkProgram(g),o.getProgramParameter(g,o.LINK_STATUS)||alert("Could not initialise shaders\nVALIDATE_STATUS: "+o.getProgramParameter(g,o.VALIDATE_STATUS)+", gl error ["+o.getError()+"]"),g.uniforms={},g.attributes={},c.program=g,E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition"];for(f in c.uniforms)E.push(f);for(f=c.program,u=0,g=E.length;u<g;u++)d=E[u],f.uniforms[d]=o.getUniformLocation(f,d);for(f=c.program,E=["position","normal","uv","tangent"],u=0,g=E.length;u<g;u++)d=E[u],f.attributes[d]=o.getAttribLocation(f,d)}f=c.program,f!=h&&(o.useProgram(f),h=f),this.loadCamera(f,i),this.loadMatrices(f),(c instanceof THREE.MeshPhongMaterial||c instanceof THREE.MeshLambertMaterial)&&(i=this.setupLights(f,s),c.uniforms.enableLighting.value=i.directional.positions.length+i.point.positions.length,c.uniforms.ambientLightColor.value=i.ambient,c.uniforms.directionalLightColor.value=i.directional.colors,c.uniforms.directionalLightDirection.value=i.directional.positions,c.uniforms.pointLightColor.value=i.point.colors,c.uniforms.pointLightPosition.value=i.point.positions),(c instanceof THREE.MeshBasicMaterial||c instanceof THREE.MeshLambertMaterial||c instanceof THREE.MeshPhongMaterial)&&e(c,a),c instanceof THREE.MeshPhongMaterial&&(c.uniforms.ambient.value.setRGB(c.ambient.r,c.ambient.g,c.ambient.b),c.uniforms.specular.value.setRGB(c.specular.r,c.specular.g,c.specular.b),c.uniforms.shininess.value=c.shininess),a=c.uniforms;for(p in a)if(s=a[p].type,i=a[p].value,E=f.uniforms[p],"i"==s)o.uniform1i(E,i);else if("f"==s)o.uniform1f(E,i);else if("fv"==s)o.uniform3fv(E,i);else if("v2"==s)o.uniform2f(E,i.x,i.y);else if("v3"==s)o.uniform3f(E,i.x,i.y,i.z);else if("c"==s)o.uniform3f(E,i.r,i.g,i.b);else if("t"==s&&(o.uniform1i(E,i),s=a[p].texture))if(s.image instanceof Array&&6==s.image.length){if(s=s,i=i,6==s.image.length){if(!s.image.__webGLTextureCube&&!s.image.__cubeMapInitialized&&6==s.image.loadCount){for(s.image.__webGLTextureCube=o.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,s.image.__webGLTextureCube),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_LINEAR),E=0;E<6;++E)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,s.image[E]);o.generateMipmap(o.TEXTURE_CUBE_MAP),o.bindTexture(o.TEXTURE_CUBE_MAP,null),s.image.__cubeMapInitialized=!0}o.activeTexture(o.TEXTURE0+i),o.bindTexture(o.TEXTURE_CUBE_MAP,s.image.__webGLTextureCube)}}else s=s,i=i,!s.__webGLTexture&&s.image.loaded&&(s.__webGLTexture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,s.__webGLTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,s.image),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r(s.wrap_s)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,r(s.wrap_t)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,r(s.mag_filter)),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,r(s.min_filter)),o.generateMipmap(o.TEXTURE_2D),o.bindTexture(o.TEXTURE_2D,null)),o.activeTexture(o.TEXTURE0+i),o.bindTexture(o.TEXTURE_2D,s.__webGLTexture);p=f.attributes,o.bindBuffer(o.ARRAY_BUFFER,l.__webGLVertexBuffer),o.vertexAttribPointer(p.position,3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.position),p.normal>=0&&(o.bindBuffer(o.ARRAY_BUFFER,l.__webGLNormalBuffer),o.vertexAttribPointer(p.normal,3,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.normal)),p.tangent>=0&&(o.bindBuffer(o.ARRAY_BUFFER,l.__webGLTangentBuffer),o.vertexAttribPointer(p.tangent,4,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.tangent)),p.uv>=0&&(l.__webGLUVBuffer?(o.bindBuffer(o.ARRAY_BUFFER,l.__webGLUVBuffer),o.vertexAttribPointer(p.uv,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p.uv)):o.disableVertexAttribArray(p.uv)),c.wireframe?(o.lineWidth(c.wireframe_linewidth),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l.__webGLLineBuffer),o.drawElements(o.LINES,l.__webGLLineCount,o.UNSIGNED_SHORT,0)):(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l.__webGLFaceBuffer),o.drawElements(o.TRIANGLES,l.__webGLFaceCount,o.UNSIGNED_SHORT,0))},this.renderPass=function(i,t,e,n,r,o,s){var a,h,c,l,f;for(c=0,l=n.materials.length;c<l;c++)if(a=n.materials[c],a instanceof THREE.MeshFaceMaterial)for(a=0,h=r.materials.length;a<h;a++)(f=r.materials[a])&&f.blending==o&&f.opacity<1==s&&(this.setBlending(f.blending),this.renderBuffer(i,t,e,f,r));else(f=a)&&f.blending==o&&f.opacity<1==s&&(this.setBlending(f.blending),this.renderBuffer(i,t,e,f,r))},this.render=function(i,t){var e,n,r,o,s=i.lights,a=i.fog;for(this.initWebGLObjects(i),this.autoClear&&this.clear(),t.autoUpdateMatrix&&t.updateMatrix(),l.set(t.matrix.flatten()),E.set(t.projectionMatrix.flatten()),e=0,n=i.__webGLObjects.length;e<n;e++)r=i.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,t),this.renderPass(t,s,a,o,r,THREE.NormalBlending,!1));for(e=0,n=i.__webGLObjects.length;e<n;e++)r=i.__webGLObjects[e],o=r.object,r=r.buffer,o.visible&&(this.setupMatrices(o,t),this.renderPass(t,s,a,o,r,THREE.AdditiveBlending,!1),this.renderPass(t,s,a,o,r,THREE.SubtractiveBlending,!1),this.renderPass(t,s,a,o,r,THREE.AdditiveBlending,!0),this.renderPass(t,s,a,o,r,THREE.SubtractiveBlending,!0),this.renderPass(t,s,a,o,r,THREE.NormalBlending,!0))},this.initWebGLObjects=function(i){var t,e,n,r,o,s;for(i.__webGLObjects||(i.__webGLObjects=[],i.__webGLObjectsMap={}),t=0,e=i.objects.length;t<e;t++)if(n=i.objects[t],void 0==i.__webGLObjectsMap[n.id]&&(i.__webGLObjectsMap[n.id]={}),s=i.__webGLObjectsMap[n.id],n instanceof THREE.Mesh)for(o in n.geometry.geometryChunks)r=n.geometry.geometryChunks[o],r.__webGLVertexBuffer||this.createBuffers(n,o),void 0==s[o]&&(r={buffer:r,object:n},i.__webGLObjects.push(r),s[o]=1)},this.removeObject=function(i,t){var e,n;for(e=i.__webGLObjects.length-1;e>=0;e--)n=i.__webGLObjects[e].object,t==n&&i.__webGLObjects.splice(e,1)},this.setupMatrices=function(i,t){i.autoUpdateMatrix&&i.updateMatrix(),c.multiply(t.matrix,i.matrix),f.set(c.flatten()),s=THREE.Matrix4.makeInvert3x3(c).transpose(),p.set(s.m),m.set(i.matrix.flatten())},this.loadMatrices=function(i){o.uniformMatrix4fv(i.uniforms.viewMatrix,!1,l),o.uniformMatrix4fv(i.uniforms.modelViewMatrix,!1,f),o.uniformMatrix4fv(i.uniforms.projectionMatrix,!1,E),o.uniformMatrix3fv(i.uniforms.normalMatrix,!1,p),o.uniformMatrix4fv(i.uniforms.objectMatrix,!1,m)},this.loadCamera=function(i,t){o.uniform3f(i.uniforms.cameraPosition,t.position.x,t.position.y,t.position.z)},this.setBlending=function(i){switch(i){case THREE.AdditiveBlending:o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ONE);break;case THREE.SubtractiveBlending:o.blendFunc(o.DST_COLOR,o.ZERO);break;default:o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA)}},this.setFaceCulling=function(i,t){i?(t&&"ccw"!=t?o.frontFace(o.CW):o.frontFace(o.CCW),"back"==i?o.cullFace(o.BACK):"front"==i?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK),o.enable(o.CULL_FACE)):o.disable(o.CULL_FACE)},this.supportsVertexTextures=function(){return o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0}},THREE.Snippets={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, 1.0 ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube env_map;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\ncubeColor = textureCube( env_map, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = mix( gl_FragColor, cubeColor, reflectivity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refraction_ratio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refraction_ratio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\n#endif",map_fragment:"#ifdef USE_MAP\nmapColor = texture2D( map, vUv );\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointLightVector = normalize( lPosition.xyz - mvPosition.xyz );\nfloat pointLightWeighting = max( dot( transformedNormal, pointLightVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting;\n#ifdef PHONG\nvPointLightVector[ i ] = pointLightVector;\n#endif\n}\n#endif\n}",lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec3 vPointLightVector[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec3 pointVector = normalize( vPointLightVector[ i ] );\nvec3 pointHalfVector = normalize( vPointLightVector[ i ] + vViewPosition );\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight;\npointSpecular += mSpecular * pointSpecularWeight;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif"},THREE.UniformsLib={common:{color:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},env_map:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refraction_ratio:{type:"f",value:.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]}}},THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3}},fragment_shader:"uniform float mNear;\nuniform float mFar;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), 1.0 );\n}",vertex_shader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{},fragment_shader:"varying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, 1.0 );\n}",vertex_shader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragment_shader:["uniform vec3 color;\nuniform float opacity;",THREE.Snippets.map_pars_fragment,THREE.Snippets.envmap_pars_fragment,THREE.Snippets.fog_pars_fragment,"void main() {\nvec4 mColor = vec4( color, opacity );\nvec4 mapColor = vec4( 1.0 );\nvec4 cubeColor = vec4( 1.0 );",THREE.Snippets.map_fragment,"gl_FragColor = mColor * mapColor;",THREE.Snippets.envmap_fragment,THREE.Snippets.fog_fragment,"}"].join("\n"),vertex_shader:[THREE.Snippets.map_pars_vertex,THREE.Snippets.envmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.Snippets.map_vertex,THREE.Snippets.envmap_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},lambert:{uniforms:Uniforms.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),fragment_shader:["uniform vec3 color;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.Snippets.map_pars_fragment,THREE.Snippets.envmap_pars_fragment,THREE.Snippets.fog_pars_fragment,"void main() {\nvec4 mColor = vec4( color, opacity );\nvec4 mapColor = vec4( 1.0 );\nvec4 cubeColor = vec4( 1.0 );",THREE.Snippets.map_fragment,"gl_FragColor =  mColor * mapColor * vec4( vLightWeighting, 1.0 );",THREE.Snippets.envmap_fragment,THREE.Snippets.fog_fragment,"}"].join("\n"),vertex_shader:["varying vec3 vLightWeighting;",THREE.Snippets.map_pars_vertex,THREE.Snippets.envmap_pars_vertex,THREE.Snippets.lights_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.Snippets.map_vertex,THREE.Snippets.envmap_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.Snippets.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")},phong:{uniforms:Uniforms.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),fragment_shader:["uniform vec3 color;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.Snippets.map_pars_fragment,THREE.Snippets.envmap_pars_fragment,THREE.Snippets.fog_pars_fragment,THREE.Snippets.lights_pars_fragment,"void main() {\nvec4 mColor = vec4( color, opacity );\nvec4 mapColor = vec4( 1.0 );\nvec4 cubeColor = vec4( 1.0 );",THREE.Snippets.map_fragment,THREE.Snippets.lights_fragment,"gl_FragColor =  mapColor * totalLight * vec4( vLightWeighting, 1.0 );",THREE.Snippets.envmap_fragment,THREE.Snippets.fog_fragment,"}"].join("\n"),vertex_shader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.Snippets.map_pars_vertex,THREE.Snippets.envmap_pars_vertex,THREE.Snippets.lights_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.Snippets.map_vertex,THREE.Snippets.envmap_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.Snippets.lights_vertex,"gl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}},THREE.RenderableObject=function(){this.z=this.object=null},THREE.RenderableFace3=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.v3=new THREE.Vertex,this.centroidWorld=new THREE.Vector3,this.centroidScreen=new THREE.Vector3,this.normalWorld=new THREE.Vector3,this.vertexNormalsWorld=[],this.faceMaterials=this.meshMaterials=null,this.overdraw=!1,this.uvs=[null,null,null]},THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null,this.scale=new THREE.Vector2,this.materials=null},THREE.RenderableLine=function(){this.z=null,this.v1=new THREE.Vertex,this.v2=new THREE.Vertex,this.materials=null};