/**
 * Vidom
 * @author Filatov Dmitry <dfilatov@inbox.ru>
 * @version 0.5.4
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.vidom=t.vidom||{})}(this,function(t){"use strict";function e(t){return t+="",~t.indexOf("&")&&(t=t.replace(/&/g,"&amp;")),~t.indexOf('"')&&(t=t.replace(/"/g,"&quot;")),t}function n(t,e){for(var n=t.length,o=0;o<n;)if(t[o++]==e)return!0;return!1}function o(t){return t.replace(Yt,"$1-$2").toLowerCase()}function i(){}function r(t,e,n){if("type"===e&&"INPUT"===t.tagName){var o=t.value;t.setAttribute(e,""+n),t.value=o}else t.setAttribute(re[e]||e,""+n)}function s(t,e,n){n?r(t,e,n):h(t,e)}function a(t,e,n){t[e]=n}function u(t,e,n){var o=t[e];for(var i in n)o[i]=null==n[i]?"":n[i]}function c(t,e,n){"value"===e&&"SELECT"===t.tagName?l(t,n):t[e]!==n&&(t[e]=n)}function h(t,e){t.removeAttribute(re[e]||e)}function d(t,e){"style"===e?t[e].cssText="":"value"===e&&"SELECT"===t.tagName?f(t):t[e]=m(t.tagName,e)}function l(t,e){for(var o=Array.isArray(e),i=t.options,r=i.length,s=0,a=void 0;s<r;)a=i[s++],a.selected=null!=e&&(o?n(e,a.value):a.value==e)}function f(t){for(var e=t.options,n=e.length,o=0;o<n;)e[o++].selected=!1}function p(t,n){return(re[t]||t)+'="'+e(n)+'"'}function _(t,e){return e?t:""}function v(t,e){var n="";for(var i in e)null!=e[i]&&(n+=o(i)+":"+e[i]+";");return n?t+'="'+n+'"':n}function m(t,e){var n=ie[t]||(ie[t]={});return e in n?n[e]:n[e]=document.createElement(t)[e]}function g(t,e){if(Array.isArray(t))N(e,t[1]);else if(Array.isArray(e)){for(var n=e[0],o=void 0,i=e[1];n!==i;)o=n.nextSibling,t.appendChild(n),n=o;t.appendChild(i)}else t.appendChild(e)}function y(t){if(Array.isArray(t)){for(var e=t[0],n=void 0,o=t[1],i=o.parentNode;e!==o;)n=e.nextSibling,i.removeChild(e),e=n;i.removeChild(o)}else t.parentNode.removeChild(t)}function N(t,e){if(Array.isArray(e)&&(e=e[0]),Array.isArray(t)){for(var n=t[0],o=void 0,i=t[1],r=i.parentNode;n!==i;)o=n.nextSibling,r.insertBefore(n,e),n=o;r.insertBefore(i,e)}else e.parentNode.insertBefore(t,e)}function C(t,e,n){if(n){Array.isArray(e)&&(e=e[1]);var o=e.nextSibling;o?N(t,o):g(e.parentNode,t)}else N(t,e)}function D(t,e){Array.isArray(t)?(N(e,t),y(t)):t.parentNode.replaceChild(e,t)}function x(t){if(Array.isArray(t))for(var e=t[0].nextSibling,n=void 0,o=t[1],i=o.parentNode;e!==o;)n=e.nextSibling,i.removeChild(e),e=n;else t.textContent=""}function A(t,e,n){if(Array.isArray(t)){var o=t[1],i=o.previousSibling;i===t[0]?o.parentNode.insertBefore(document.createTextNode(e),o):i.nodeValue=e}else if(n){var r=t.firstChild;r?r.nodeValue=e:t.textContent=e}else t.innerHTML=e}function b(t){if(Array.isArray(t)){var e=t[0].nextSibling;e.parentNode.removeChild(e)}else t.textContent=""}function k(t){var e="on"+t;if(e in document)return!0;var n=document.createElement("div");return n.setAttribute(e,"return;"),"function"==typeof n[e]||"wheel"===t&&document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0&&document.implementation.hasFeature("Events.wheel","3.0")}function S(t,e){this.type=t,this.target=e.target,this.nativeEvent=e,this._isPropagationStopped=!1,this._isDefaultPrevented=!1,this._isPersisted=!1}function T(t,e){var n=fe[t];return n&&!n._isPersisted?(n.target=e.target,n.nativeEvent=e,n._isPropagationStopped=!1,n._isDefaultPrevented=!1,n):fe[t]=new S(t,e)}function w(t,e){return t[pe]||(e?null:t[pe]=_e++)}function R(t,e){if(Se){e||(e=t.type);for(var n=ke[e],o=t.target,i=n.listenersCounter,r=void 0,s=void 0,a=void 0,u=void 0;i>0&&o&&o!==document;){if((a=w(o,!0))&&(r=be.get(a),r&&(s=r[e]))){if(s(u||(u=T(e,t))),u.isPropagationStopped())break;--i}o=o.parentNode}}}function M(t){Se&&be.get(w(t.currentTarget))[t.type](T(t.type,t))}function E(t,e,n){var o=ke[e];if(o){o.set||(o.setup?o.setup():o.bubbles&&document.addEventListener(e,R,!1),o.set=!0);var i=w(t),r=be.get(i);r||be.set(i,r={}),r[e]||(o.bubbles?++o.listenersCounter:t.addEventListener(e,M,!1)),r[e]=n}}function P(t,e){var n=ke[e];n&&(n.bubbles?--n.listenersCounter:t.removeEventListener(e,M))}function I(t,e){var n=w(t,!0);if(n){var o=be.get(n);o&&o[e]&&(o[e]=null,P(t,e))}}function U(t){var e=w(t,!0);if(e){var n=be.get(e);if(n){for(var o in n)n[o]&&P(t,o);be.delete(e)}}}function L(){Se=!1}function O(){Se=!0}function F(t){return Array.isArray(t)?j(t):t.namespaceURI===Te?null:t.namespaceURI}function j(t){return F((Array.isArray(t)?t[t.length-1]:t).parentNode)}function q(t,e){var n=t.getDomNode();le.append(n,e.renderToDom(F(n))),e.mount()}function B(t,e){var n=e.getDomNode();le.insertBefore(t.renderToDom(j(n)),n),t.mount()}function V(t){var e=t.getDomNode();t.unmount(),le.remove(e)}function z(t,e,n){var o=document.activeElement;L(),le.move(t.getDomNode(),e.getDomNode(),n),document.activeElement!==o&&o.focus(),O()}function H(t){for(var e=t.getDomNode(),n=t._children,o=n.length,i=0;i<o;)n[i++].unmount();le.removeChildren(e)}function K(t,e){var n=t.getDomNode();t.unmount(),le.replace(n,e.renderToDom(j(n))),e.mount()}function W(t,e,n){var o=t.getDomNode();we[e]?E(o,we[e],n):de(e).set(o,e,n)}function G(t,e){var n=t.getDomNode();we[e]?I(n,we[e]):de(e).remove(n,e)}function Z(t,e,n){le.updateText(t.getDomNode(),e,n)}function $(t){le.removeText(t.getDomNode())}function J(t,e){var n=t._children,o=e._children,i=n.length,r=o.length;if(1===i&&1===r)return void n[0].patch(o[0]);for(var s=0,a=i-1,u=n[s],c=u._key,h=n[a],d=h._key,l=0,f=r-1,p=o[l],_=p._key,v=o[f],m=v._key,g=!1,y=!1,N=!1,C=!1,D={},x=void 0,A=void 0,b=void 0;s<=a&&l<=f;)D[s]?g=!0:D[a]?y=!0:c===_?(u.patch(p),g=!0,N=!0):d===m?(h.patch(v),y=!0,C=!0):null!=c&&c===m?(Re.moveChild(u,h,!0),u.patch(v),g=!0,C=!0):null!=d&&d===_?(Re.moveChild(h,u,!1),h.patch(p),y=!0,N=!0):null!=c&&null==_?(Re.insertChild(p,u),N=!0):null==c&&null!=_?(Re.removeChild(u),g=!0):(x||(x=Q(n,s,a)),null==(A=x[_])?Re.insertChild(p,u):(b=n[A],D[A]=!0,Re.moveChild(b,u,!1),b.patch(p)),N=!0),g&&(g=!1,++s<=a&&(u=n[s],c=u._key)),y&&(y=!1,--a>=s&&(h=n[a],d=h._key)),N&&(N=!1,++l<=f&&(p=o[l],_=p._key)),C&&(C=!1,--f>=l&&(v=o[f],m=v._key));for(;s<=a;)D[s]||Re.removeChild(n[s]),++s;for(;l<=f;)f<r-1?Re.insertChild(o[l],o[f+1]):Re.appendChild(e,o[l]),++l}function Q(t,e,n){for(var o={},i=void 0;e<n;)i=t[e],null!=i._key&&(o[i._key]=e),++e;return o}function X(t){return t+="",~t.indexOf("&")&&(t=t.replace(/&/g,"&amp;")),~t.indexOf("<")&&(t=t.replace(/</g,"&lt;")),~t.indexOf(">")&&(t=t.replace(/>/g,"&gt;")),t}function Y(t,e){var n=void 0;if(e){var o=e+":"+t;n=Ee[o]||(Ee[o]=document.createElementNS(e,t))}else n=Ee[t]||(Ee[t]="!"===t?document.createComment(""):document.createElement(t));return n.cloneNode()}function tt(t,e,n){var o=Ie[e]||"div",i=Ue[o]||(Ue[o]=document.createElement(o));if(!n||!Pe[n]||Pe[n]===e)return i.innerHTML=t,i.removeChild(i.firstChild);var r=Pe[n];return i.innerHTML="<"+r+' xmlns="'+n+'">'+t+"</"+r+">",i.removeChild(i.firstChild).firstChild}function et(t){this.type=Oe,this._tag=t,this._domNode=null,this._key=null,this._ns=null,this._attrs=null,this._children=null,this._escapeChildren=!0,this._ctx=Me}function nt(t){if(null==t)return null;var e=typeof t;if("object"===e){var n=Array.isArray(t)?t:[t];return n}return"string"===e?t:t.toString()}function ot(t){this.type=qe,this._component=t,this._key=null,this._attrs=null,this._instance=null,this._children=null,this._ctx=Me}function it(t){this.type=Be,this._component=t,this._key=null,this._attrs=Me,this._rootNode=null,this._children=null,this._ctx=Me}function rt(){this.type=je,this._domNode=null,this._key=null,this._children=null,this._ctx=Me}function st(t){if(null==t)return null;var e=Array.isArray(t)?t:[t];return e}function at(){this.type=Fe,this._domNode=null,this._key=null,this._children=null}function ut(t){return null==t||"string"==typeof t?t:t.toString()}function ct(){for(var t=0;t<Ke.length;)Ke[t++]();Ke=[]}function ht(t,e){var n={};for(var o in t)n[o]=t[o];for(var i in e)n[i]=e[i];return n}function dt(){this._listeners={}}function lt(t){this.type=Le,this._childNode=t,this._ns=null}function ft(t,e,n,o,i){var r=w(t),s=Ge.get(r),a=void 0;if(s&&s.tree){a=++s.id;var u=function(){if(s=Ge.get(r),s&&s.id===a){var t=s.tree,i=new lt(e);i.ns(t._ns).ctx(n),t.patch(i),s.tree=i,_t(o)}};i?u():We(u)}else{if(Ge.set(r,s={tree:null,id:a=++Ze}),t.childNodes.length){var c=vt(t);if(c){var h=s.tree=new lt(e);return h.ns(F(t)).ctx(n),h.adoptDom(c),h.mount(),void _t(o)}t.textContent=""}var d=function(){var i=Ge.get(r);if(i&&i.id===a){var s=i.tree=new lt(e);s.ns(F(t)).ctx(n),le.append(t,s.renderToDom()),s.mount(),_t(o)}};i?d():We(d)}}function pt(t,e,n){var o=w(t),i=Ge.get(o);i?!function(){var t=++i.id,r=function(){if(i=Ge.get(o),i&&i.id===t){Ge.delete(o);var n=i.tree;if(n){var r=n.getDomNode();n.unmount(),le.remove(r)}_t(e)}};i.tree?n?r():We(r):n||_t(e)}():n||_t(e)}function _t(t){t&&t()}function vt(t){for(var e=t.childNodes,n=e.length,o=0,i=void 0,r=void 0;o<n;)r=e[o++],i?i.push(r):r.nodeType===Node.COMMENT_NODE&&"vidom"===r.textContent&&(i=[]);return i}function mt(t,e,n,o){"function"==typeof n&&(o=n,n=this),ft(t,e,n,o,!1)}function gt(t,e,n,o){mt(t,e,n,o)}function yt(t,e,n){ft(t,e,n,null,!0)}function Nt(t,e){pt(t,e,!1)}function Ct(t,e){Nt(t,e)}function Dt(t){pt(t,null,!0)}function xt(){var t=[];return Ge.forEach(function(e){var n=e.tree;n&&t.push(n)}),t}function At(){this.__isMounted=!0,this.onMount(this.__attrs,this.__children)}function bt(){this.__isMounted=!1,this.__domRefs=null,this.onUnmount()}function kt(t,e,n){t=this.__buildAttrs(t);var o=this.__rootNode,i=this.__attrs,r=this.__children;if((i!==t||r!==e)&&(this.__attrs=t,this.isMounted())){var s=this.__isUpdating;this.__isUpdating=!0,this.onAttrsReceive(t,i,e,r),this.__isUpdating=s}if(this.__children=e,this.__ctx=n,!this.__isUpdating){var a=this.shouldUpdate(t,i,e,r);a&&(this.__rootNode=this.render(),o.patch(this.__rootNode),this.isMounted()&&this.onUpdate(t,i,e,r))}}function St(){return!0}function Tt(t){return this.__rootNode.renderToDom(t)}function wt(){return this.__rootNode.renderToString()}function Rt(t,e){return this.__rootNode.adoptDom(t,e)}function Mt(){return this.__rootNode.getDomNode()}function Et(){return this.__attrs}function Pt(){return Me}function It(){return Me}function Ut(t){this.__prevState=this.__state,this.__state=ht(this.__state,t),this.update(Lt)}function Lt(){this.__prevState=this.__state}function Ot(){return this.__state}function Ft(){return this.__prevState}function jt(){this.__domRefs={};var t=this.onRender(this.__attrs,this.__children)||en("!"),e=this.onChildContextRequest(this.__attrs);return t.ctx(e===Me?this.__ctx:this.__ctx===Me?e:ht(this.__ctx,e)),t}function qt(t){var e=this;this.__isUpdating?t&&We(function(){return t.call(e)}):(this.__isUpdating=!0,We(function(){if(e.isMounted()){e.__isUpdating=!1;e.__rootNode;e.patch(e.__attrs,e.__children,e.__ctx),t&&t.call(e)}}))}function Bt(){return this.__rootNode}function Vt(){return this.__isMounted}function zt(t,e){return this.__domRefs[t]=e}function Ht(t){return this.__domRefs[t]?this.__domRefs[t].getDomNode():null}function Kt(){return this.__ctx}function Wt(){return Me}function Gt(t){if(this.__attrs&&t===this.__attrs)return t;var e=this.constructor,n=e.__defaultAttrs||(e.__defaultAttrs=e.getDefaultAttrs());return t?n===Me?t:ht(n,t):n}function Zt(t,e){var n=function(t,e,n){this.__attrs=this.__buildAttrs(t),this.__children=e,this.__ctx=n,this.__domRefs=null,this.__isMounted=!1,this.__isUpdating=!1,this.__state=this.onInitialStateRequest(this.__attrs,e),this.__prevState=this.__state,this.onInit(this.__attrs,e),this.__rootNode=this.render()},o={constructor:n,onInitialStateRequest:It,onInit:i,mount:At,unmount:bt,onMount:i,onUnmount:i,onAttrsReceive:i,shouldUpdate:St,onUpdate:i,isMounted:Vt,getState:Ot,getPrevState:Ft,setState:Ut,renderToDom:Tt,renderToString:wt,adoptDom:Rt,getDomNode:Mt,getRootNode:Bt,render:jt,onRender:i,update:qt,patch:kt,getDomRef:Ht,setDomRef:zt,getAttrs:Et,onChildContextRequest:Pt,getContext:Kt,__buildAttrs:Gt};for(var r in t)o[r]=t[r];n.prototype=o,n.getDefaultAttrs=Wt;for(var s in e)n[s]=e[s];return n.__vidom__component__=!0,n}function $t(t,e){var n=Je.get(t);n?n.push(e):Je.set(t,[e])}function Jt(t,e){for(var n=Je.get(t),o=n.length,i=0;i<o;){if(n[i]===e)return void(1===o?Je.delete(t):n.splice(i,1));i++}}function Qt(t){if(null==t)return null;var e=typeof t;if("object"!==e)return"string"===e?t||null:""+t;if(!Array.isArray(t))return t;if(!t.length)return null;for(var n=t,o=0,i=t.length,r=!1,s={},a=void 0;o<i;){if(a=o in s?s[o]:Qt(t[o]),null===a)null!==n&&(r?n===t&&(n=t.slice(0,o)):n=null);else if("object"==typeof a)Array.isArray(a)?n=r?(n===t?n.slice(0,o):Array.isArray(n)?n:[Xt(n)]).concat(a):a:n!==t?r?Array.isArray(n)?n.push(a):n=[Xt(n),a]:n=a:a!==t[o]&&(r?(n=n.slice(0,o),n.push(a)):n=a),r=!0;else{for(var u=void 0,c=o;++c<i;)if(u=s[c]=Qt(t[c]),"string"==typeof u)a+=u;else if(null!==u)break;r?Array.isArray(n)?(n===t&&(n=n.slice(0,o)),n.push(Xt(a))):n=[n,Xt(a)]:n=""+a,o=c-1,r=!0}++o}return n}function Xt(t){return"object"==typeof t?t:en("text").children(t)}var Yt=/([^A-Z]+)([A-Z])/g,te="undefined"==typeof console?null:console,ee={},ne={log:"",info:"",warn:"Warning!",error:"Error!"};["log","info","warn","error"].forEach(function(t){ee[t]=te?te[t]?function(e,n,o,i,r){var s=ne[t];switch(arguments.length){case 1:te[t](s,e);break;case 2:te[t](s,e,n);break;case 3:te[t](s,e,n,o);break;case 4:te[t](s,e,n,o,i);break;case 5:te[t](s,e,n,o,i,r)}}:function(){te.log.apply(te,arguments)}:i});var oe="undefined"==typeof process||"production"!==process.env.NODE_ENV,ie={},re={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",autoCapitalize:"autocapitalize",autoComplete:"autocomplete",autoCorrect:"autocorrect",autoFocus:"autofocus",autoPlay:"autoplay",encType:"encoding",hrefLang:"hreflang",radioGroup:"radiogroup",spellCheck:"spellcheck",srcDoc:"srcdoc",srcSet:"srcset",tabIndex:"tabindex"},se={set:r,remove:h,toString:p},ae={set:s,remove:h,toString:_},ue={set:a,remove:d,toString:p},ce={set:a,remove:d,toString:_},he={checked:ce,controls:ue,disabled:ae,id:ue,ismap:ae,loop:ue,multiple:ce,muted:ue,open:ae,readOnly:ce,selected:ce,srcDoc:ue,style:{set:u,remove:d,toString:v},value:{set:c,remove:d,toString:p}},de=function(t){return he[t]||se},le={append:g,remove:y,insertBefore:N,move:C,replace:D,removeChildren:x,updateText:A,removeText:b};S.prototype={stopPropagation:function(){this._isPropagationStopped=!0;var t=this.nativeEvent;t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},isPropagationStopped:function(){return this._isPropagationStopped},preventDefault:function(){this._isDefaultPrevented=!0;var t=this.nativeEvent;t.preventDefault?t.preventDefault():t.returnValue=!1},isDefaultPrevented:function(){return this._isDefaultPrevented},persist:function(){this._isPersisted=!0}};var fe={},pe="__vidom__id__",_e=1,ve=void 0;"undefined"==typeof Map?(ve=function(){this._storage={}},ve.prototype={has:function(t){return t in this._storage},get:function(t){return this._storage[t]},set:function(t,e){return this._storage[t]=e,this},delete:function(t){return delete this._storage[t]},forEach:function(t,e){var n=this._storage;for(var o in n)t.call(e,n[o],o,this)}}):ve=Map;var me=ve,ge="undefined"==typeof navigator?"":navigator.userAgent,ye=ge.indexOf("Trident")>-1,Ne=ge.indexOf("Edge")>-1,Ce=/iPad|iPhone|iPod/.test(ge)&&"undefined"==typeof MSStream,De=["click","mousedown","mousemove","mouseout","mouseover","mouseup"],xe=["blur","change","contextmenu","copy","cut","dblclick","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","focus","input","keydown","keypress","keyup","paste","submit","touchcancel","touchend","touchmove","touchstart","wheel"],Ae=["canplay","canplaythrough","complete","durationchange","emptied","ended","error","load","loadeddata","loadedmetadata","loadstart","mouseenter","mouseleave","pause","play","playing","progress","ratechange","scroll","seeked","seeking","select","stalled","suspend","timeupdate","volumechange","waiting"];Ce?Ae=[].concat(Ae,De):xe=[].concat(xe,De);var be=new me,ke={},Se=!0;"undefined"!=typeof document&&!function(){for(var t={focus:"focusin",blur:"focusout"},e=0,n=void 0;e<xe.length;)n=xe[e++],ke[n]={type:n,bubbles:!0,listenersCounter:0,set:!1,setup:t[n]?k(t[n])?function(){var e=this.type;document.addEventListener(t[e],function(t){R(t,e)})}:function(){document.addEventListener(this.type,R,!0)}:null};for(e=0;e<Ae.length;)ke[Ae[e++]]={type:n,bubbles:!1,set:!1}}();var Te="http://www.w3.org/1999/xhtml",we={onBlur:"blur",onCanPlay:"canplay",onCanPlayThrough:"canplaythrough",onChange:"change",onClick:"click",onComplete:"complete",onContextMenu:"contextmenu",onCopy:"copy",onCut:"cut",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragStart:"dragstart",onDrop:"drop",onDurationChange:"durationchange",onEmptied:"emptied",onEnded:"ended",onError:"error",onFocus:"focus",onInput:"input",onKeyDown:"keydown",onKeyPress:"keypress",onKeyUp:"keyup",onLoad:"load",onLoadedData:"loadeddata",onLoadedMetadata:"loadedmetadata",onLoadStart:"loadstart",onMouseDown:"mousedown",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPaste:"paste",onPause:"pause",onPlay:"play",onPlaying:"playing",onProgress:"progress",onRateChange:"ratechange",onScroll:"scroll",onSeeked:"seeked",onSeeking:"seeking",onSelect:"select",onStalled:"stalled",onSubmit:"submit",onSuspend:"suspend",onTimeUpdate:"timeupdate",onTouchCancel:"touchcancel",onTouchEnd:"touchend",onTouchMove:"touchmove",onTouchStart:"touchstart",onVolumeChange:"volumechange",onWaiting:"waiting",onWheel:"wheel"},Re={appendChild:q,insertChild:B,removeChild:V,moveChild:z,removeChildren:H,replace:K,updateAttr:W,removeAttr:G,updateText:Z,removeText:$},Me={},Ee={},Pe={"http://www.w3.org/2000/svg":"svg","http://www.w3.org/1998/Math/MathML":"math"},Ie={thead:"table",tbody:"table",tfoot:"table",tr:"tbody",td:"tr"},Ue={},Le=1,Oe=2,Fe=3,je=4,qe=5,Be=6,Ve={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuitem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},ze=ye||Ne;et.prototype={getDomNode:function(){return this._domNode},key:function(t){return this._key=t,this},ns:function(t){return this._ns=t,this},attrs:function(t){return this._attrs=t,this},children:function(t){return this._children=nt(t),this},ctx:function(t){if(t!==Me){this._ctx=t;var e=this._children;if(e&&"string"!=typeof e)for(var n=e.length,o=0;o<n;)e[o++].ctx(t)}return this},html:function(t){return this._children=t,this._escapeChildren=!1,this},renderToDom:function(t){var e=this._ns||t,n=this._children;if(ze&&n&&"string"!=typeof n){var o=tt(this.renderToString(),this._tag,e);return this.adoptDom([o],0),o}var i=this._domNode=Y(this._tag,e),r=this._attrs;if(n)if("string"==typeof n)this._escapeChildren?i.textContent=n:i.innerHTML=n;else for(var s=0,a=n.length;s<a;)i.appendChild(n[s++].renderToDom(e));if(r){var u=void 0,c=void 0;for(u in r)null!=(c=r[u])&&(we[u]?E(i,we[u],c):de(u).set(i,u,c))}return i},renderToString:function(){var t=this._tag;if("!"===t)return"<!---->";var e=this._ns,o=this._attrs,i=this._children,r="<"+t;if(e&&(r+=' xmlns="'+e+'"'),o){var s=void 0,a=void 0,u=void 0;for(s in o)if(a=o[s],null!=a){if("value"===s)switch(t){case"textarea":i=a;continue;case"select":this.ctx({value:a,multiple:o.multiple});continue;case"option":(this._ctx.multiple?n(this._ctx.value,a):this._ctx.value===a)&&(r+=" "+de("selected").toString("selected",!0))}!we[s]&&(u=de(s).toString(s,a))&&(r+=" "+u)}}if(Ve[t])r+="/>";else{if(r+=">",i)if("string"==typeof i)r+=this._escapeChildren?X(i):i;else for(var c=0,h=i.length;c<h;)r+=i[c++].renderToString();r+="</"+t+">"}return r},adoptDom:function(t,e){var n=this._domNode=t[e],o=this._attrs,i=this._children;if(o){var r=void 0,s=void 0;for(r in o)null!=(s=o[r])&&we[r]&&E(n,we[r],s)}if(i&&"string"!=typeof i){var a=0,u=i.length;if(u)for(var c=n.childNodes,h=0;a<u;)h=i[a++].adoptDom(c,h)}return e+1},mount:function(){var t=this._children;if(t&&"string"!=typeof t)for(var e=0,n=t.length;e<n;)t[e++].mount()},unmount:function(){var t=this._children;if(t&&"string"!=typeof t)for(var e=0,n=t.length;e<n;)t[e++].unmount();U(this._domNode),this._domNode=null},patch:function(t){if(this===t)return void this._patchChildren(t);switch(t.type){case Oe:this._tag!==t._tag||this._ns!==t._ns?Re.replace(this,t):(t._domNode=this._domNode,this._patchChildren(t),this._patchAttrs(t));break;case qe:var e=t._getInstance();this.patch(e.getRootNode()),e.mount();break;case Be:this.patch(t._getRootNode());break;default:Re.replace(this,t)}},_patchChildren:function(t){var e=this._children,n=t._children;if(e||n){var o="string"==typeof e,i="string"==typeof n;if(i)return o?void(e!==n&&Re.updateText(this,n,t._escapeChildren)):(e&&e.length&&Re.removeChildren(this),void(n&&Re.updateText(this,n,t._escapeChildren)));if(!n||!n.length)return void(e&&(o?Re.removeText(this):e.length&&Re.removeChildren(this)));if(o&&e&&Re.removeText(this),!o&&e&&e.length)J(this,t);else for(var r=n.length,s=0;s<r;)Re.appendChild(t,n[s++])}},_patchAttrs:function(t){var e=this._attrs,n=t._attrs;if(e!==n){var o=void 0;if(n){var i=void 0,r=void 0,s=void 0,a=void 0;for(o in n)r=n[o],e&&null!=(i=e[o])?null==r?Re.removeAttr(this,o):"object"==typeof r&&"object"==typeof i?(a=Array.isArray(r),s=Array.isArray(i),a||s?a&&s?this._patchAttrArr(o,i,r):Re.updateAttr(this,o,r):this._patchAttrObj(o,i,r)):i!==r&&Re.updateAttr(this,o,r):null!=r&&Re.updateAttr(this,o,r)}if(e)for(o in e)n&&o in n||null==e[o]||Re.removeAttr(this,o)}},_patchAttrArr:function(t,e,n){if(e!==n){var o=e.length,i=!1;if(o===n.length)for(var r=0;!i&&r<o;)e[r]!=n[r]&&(i=!0),++r;else i=!0;i&&Re.updateAttr(this,t,n)}},_patchAttrObj:function(t,e,n){if(e!==n){var o=!1,i={};for(var r in n)e[r]!=n[r]&&(o=!0,i[r]=n[r]);for(var s in e)null==e[s]||s in n||(o=!0,i[s]=null);o&&Re.updateAttr(this,t,i)}}},ot.prototype={getDomNode:function(){return this._instance&&this._instance.getDomNode()},key:function(t){return this._key=t,this},attrs:function(t){return this._attrs=t,this},children:function(t){return this._children=t,this},ctx:function(t){return this._ctx=t,this},renderToDom:function(t){return this._getInstance().renderToDom(t)},renderToString:function(){return this._getInstance().renderToString()},adoptDom:function(t,e){return this._getInstance().adoptDom(t,e)},mount:function(){this._instance.getRootNode().mount(),this._instance.mount()},unmount:function(){this._instance&&(this._instance.getRootNode().unmount(),this._instance.unmount(),this._instance=null)},patch:function(t){var e=this._getInstance();if(this===t)e.patch(t._attrs,t._children,t._ctx);else{if(this.type===t.type)if(this._component===t._component)e.patch(t._attrs,t._children,t._ctx),t._instance=e;else{e.unmount();var n=t._getInstance();e.getRootNode().patch(n.getRootNode()),n.mount()}else e.unmount(),e.getRootNode().patch(t);this._instance=null}},_getInstance:function(){return this._instance||(this._instance=new this._component(this._attrs,this._children,this._ctx))}},it.prototype={getDomNode:function(){return this._rootNode&&this._rootNode.getDomNode()},key:function(t){return this._key=t,this},attrs:function(t){return this._attrs=t,this},children:function(t){return this._children=t,this},ctx:function(t){return this._ctx=t,this},renderToDom:function(t){return this._getRootNode().renderToDom(t)},renderToString:function(){return this._getRootNode().renderToString()},adoptDom:function(t,e){return this._getRootNode().adoptDom(t,e)},mount:function(){this._getRootNode().mount()},unmount:function(){this._rootNode&&(this._rootNode.unmount(),this._rootNode=null)},patch:function(t){if(this===t){var e=this._getRootNode();this._rootNode=null,e.patch(this._getRootNode())}else this._getRootNode().patch(this.type===t.type?t._getRootNode():t),this._rootNode=null},_getRootNode:function(){if(this._rootNode)return this._rootNode;var t=this._component(this._attrs,this._children,this._ctx)||en("!");return t.ctx(this._ctx),this._rootNode=t}},rt.prototype={getDomNode:function(){return this._domNode},key:function(t){return this._key=t,this},children:function(t){return this._children=st(t),this},ctx:function(t){if(t!==Me){this._ctx=t;var e=this._children;if(e)for(var n=e.length,o=0;o<n;)e[o++].ctx(t)}return this},renderToDom:function(t){var e=this._children,n=[Y("!"),Y("!")],o=document.createDocumentFragment();if(o.appendChild(n[0]),e)for(var i=e.length,r=0;r<i;)o.appendChild(e[r++].renderToDom(t));return o.appendChild(n[1]),this._domNode=n,o},renderToString:function(){var t=this._children,e="<!---->";if(t)for(var n=t.length-1;n>=0;)e=t[n--].renderToString()+e;return"<!---->"+e},adoptDom:function(t,e){var n=[t[e++]],o=this._children;if(o)for(var i=o.length,r=0;r<i;)e=o[r++].adoptDom(t,e);return n.push(t[e]),this._domNode=n,e+1},mount:function(){var t=this._children;if(t)for(var e=0,n=t.length;e<n;)t[e++].mount()},unmount:function(){var t=this._children;if(t)for(var e=t.length,n=0;n<e;)t[n++].unmount()},patch:function(t){if(this===t)return void this._patchChildren(t);switch(t.type){case je:t._domNode=this._domNode,this._patchChildren(t);break;case qe:var e=t._getInstance();this.patch(e.getRootNode()),e.mount();break;case Be:this.patch(t._getRootNode());break;default:Re.replace(this,t)}},_patchChildren:function(t){var e=this._children,n=t._children;if(e||n){if(!n||!n.length)return void(e&&e.length&&Re.removeChildren(this));if(e&&e.length)J(this,t);else for(var o=n.length,i=0;i<o;)Re.appendChild(t,n[i++])}}},at.prototype={getDomNode:function(){return this._domNode},key:function(t){return this._key=t,this},children:function(t){return this._children=ut(t),this},ctx:function(){return this},renderToDom:function(){var t=document.createDocumentFragment(),e=[Y("!"),Y("!")],n=this._children;return t.appendChild(e[0]),n&&t.appendChild(document.createTextNode(n)),t.appendChild(e[1]),this._domNode=e,t},renderToString:function(){return"<!---->"+(this._children||"")+"<!---->"},adoptDom:function(t,e){var n=[t[e++]];return this._children&&e++,n.push(t[e++]),this._domNode=n,e},mount:function(){},unmount:function(){},patch:function(t){if(this!==t)switch(t.type){case Fe:t._domNode=this._domNode,this._patchChildren(t);break;case qe:var e=t._getInstance();this.patch(e.getRootNode()),e.mount();break;case Be:this.patch(t._getRootNode());break;default:Re.replace(this,t)}},_patchChildren:function(t){var e=this._children,n=t._children;e!==n&&(n?Re.updateText(this,n,!1):e&&Re.removeText(this))}};var He="undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame)||function(t){setTimeout(t,1e3/60)},Ke=[],We=function(t){1===Ke.push(t)&&He(ct)};dt.prototype={on:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,fnCtx:n}),this},off:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=this._listeners[t];if(o)for(var i=0,r=void 0;i<o.length;){if(r=o[i],r.fn===e&&r.fnCtx===n){o.splice(i,1);break}i++}return this},emit:function(t){var e=this._listeners[t];if(e){for(var n=0,o=arguments.length,i=Array(o>1?o-1:0),r=1;r<o;r++)i[r-1]=arguments[r];for(;n<e.length;){var s=e[n++],a=s.fn,u=s.fnCtx;a.call.apply(a,[u].concat(i))}}return this}},lt.prototype={getDomNode:function(){return this._childNode.getDomNode()},ns:function(t){return t&&(this._ns=t),this},ctx:function(t){return t&&this._childNode.ctx(t),this},renderToDom:function(){return this._childNode.renderToDom(this._ns)},adoptDom:function(t){this._childNode.adoptDom(t,0)},patch:function(t){this._childNode.patch(t._childNode)},mount:function(){this._childNode.mount()},unmount:function(){this._childNode.unmount()}};var Ge=new me,Ze=0,$e=new dt;$e.getRootNodes=xt;var Je=new me,Qe=Zt({onInit:function(){var t=this;this.onInput=function(e){var n=t.getAttrs(),o=n.onInput,i=n.onChange;if(o&&o(e),i&&i(e),ct(),t.isMounted()){var r=t.getDomRef("control"),s=t.getAttrs(),a=s.value;"undefined"!=typeof a&&r.value!==a&&(r.value=a)}},this.onChange=function(e){var n=t.getAttrs(),o=n.onChange,i=t.getDomRef("control");if(o&&o(e),ct(),t.isMounted()){var r=t.getAttrs(),s=r.name,a=r.type,u=r.checked;if("undefined"!=typeof u&&i.checked!==u)if("radio"===a&&s){for(var c=Je.get(s),h=c.length,d=0,l=void 0,f=void 0;d<h;)if(l=c[d++],f=l.getAttrs().checked,"undefined"!=typeof f){var p=l.getDomRef("control");f!==p.checked&&(p.checked=f)}}else i.checked=u}}},onRender:function(t){var e=void 0;return"file"===t.type?e=t:(e=ht(t,{onChange:null}),"checkbox"===t.type||"radio"===t.type?e.onChange=this.onChange:e.onInput=this.onInput),this.setDomRef("control",new et("input").attrs(e))},onMount:function(t){var e=t.type,n=t.name;"radio"===e&&n&&$t(n,this)},onUpdate:function(t,e){var n=t.type,o=t.name,i=e.type,r=e.name;"radio"===i?n!==i?r&&Jt(r,this):o!==r&&(r&&Jt(r,this),o&&$t(o,this)):"radio"===n&&o&&$t(o,this)},onUnmount:function(){var t=this.getAttrs(),e=t.type,n=t.name;"radio"===e&&n&&Jt(n,this)}}),Xe=Zt({onInit:function(){var t=this;this.onInput=function(e){var n=t.getAttrs();if(n.onInput&&n.onInput(e),n.onChange&&n.onChange(e),ct(),t.isMounted()){var o=t.getDomRef("control"),i=t.getAttrs(),r=i.value;"undefined"!=typeof r&&o.value!==r&&(o.value=r)}}},onRender:function(t){return this.setDomRef("control",new et("textarea").attrs(ht(t,{onInput:this.onInput,onChange:null})))}}),Ye=Zt({onInit:function(){var t=this;this.onChange=function(e){var n=t.getAttrs();if(n.onChange&&n.onChange(e),ct(),t.isMounted()){var o=t.getDomRef("control"),i=t.getAttrs(),r=i.value;"undefined"!=typeof r&&o.value!==r&&(o.value=r)}}},onRender:function(t,e){return this.setDomRef("control",new et("select").attrs(ht(t,{onChange:this.onChange})).children(e))}}),tn={input:Qe,textarea:Xe,select:Ye},en=function(t){switch(typeof t){case"string":switch(t){case"fragment":return new rt;case"text":return new at;default:return tn[t]?new ot(tn[t]):new et(t)}case"function":return t.__vidom__component__?new ot(t):new it(t)}},nn=function(t){return"<!--vidom-->"+t.renderToString()},on=function(t){var e=Qt(t);return null===e||"object"!=typeof e||Array.isArray(e)||(e=[e]),e},rn=Zt();t.node=en,t.createComponent=Zt,t.renderToString=nn,t.normalizeChildren=on,t.IS_DEBUG=oe,t.console=ee,t.Component=rn,t.mount=mt,t.mountToDom=gt,t.mountSync=yt,t.unmount=Nt,t.unmountFromDom=Ct,t.unmountSync=Dt,t.getMountedRootNodes=xt,Object.defineProperty(t,"__esModule",{value:!0})});
