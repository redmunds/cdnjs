!function(e){function r(){this.pool=new t,this.templates={},this.filters={},this.wrappers={}}function t(){this.store={}}function o(){}function n(e){this.children=[],this.placeholderNode=document.createComment(e||"node")}r.prototype.foreach=function(e,r,t,n,i){var p,h,d,s=o.size(t);d=s-i.length;for(p in t)if(t.hasOwnProperty(p)){if(!(d-->0))break;t[p].remove()}h=0;for(p in t)t.hasOwnProperty(p)&&t[p].update(i[h++]);for(h=s,d=i.length;d>h;h++){var a=this.render(n,i[h]);a.parent=e,a.appendTo(r),p=o.push(t,a);var l=a.remove;a.remove=function(e,r,n){return function(){n(),o.remove(t,e)}}(p,a,l)}},r.prototype.iftest=function(e,r,t,o,n,i){if(t.child)i?t.child.update(n):t.child.remove();else if(i){var p=this.render(o,n);p.parent=e,p.appendTo(r);var h=p.remove;p.remove=function(){h(),t.child=null},t.child=p}},r.prototype.render=function(e,r,t){if(t=t||!1,this.templates[e]){var o;return t?o=this.templates[e]():(o=this.pool.pull(e),o||(o=this.templates[e]())),o.appendTo=function(e){for(var r=0,t=o.nodes.length;t>r;r++){var i=o.nodes[r];i instanceof n?i.appendTo(e):e instanceof n?(e.appendChild(i),o.onRemove.push(function(r){return function(){var t=e.children.indexOf(r);-1!==t&&e.children.splice(t,1)}}(i))):e.appendChild(i)}},o.onRemove=[],o.remove=function(){for(var e=0,r=o.nodes.length;r>e;e++)o.nodes[e].parentNode.removeChild(o.nodes[e]);for(var t;t=o.onRemove.pop();)t()},void 0!==r&&o.update(r),o.wrapped=o.wrapped||{},this.wrappers[e]&&!o.wrapped[e]&&(o=this.wrappers[e](o),o.wrapped[e]=!0),o}throw new Error('Template with name "'+e+'" does not found.')},r.prototype.prerender=function(e,r){for(;r--;)this.pool.push(e,this.render(e,void 0,!0))},r.prototype.mount=function(e){var r=this;Object.keys(e).forEach(function(t){r.templates[t]=e[t]})},r.prototype.pnode=function(e){return new n(e)},t.prototype.push=function(e,r){this.store[e]||(this.store[e]=[]),this.store[e].push(r)},t.prototype.pull=function(e){return this.store[e]?this.store[e].pop():void 0},o.max=function i(e){var i=0;for(var r in e)e.hasOwnProperty(r)&&r>i&&(i=r);return parseInt(i)},o.push=function(e,r){var t=o.max(e)+1;return e[t]=r,t},o.remove=function(e,r){delete e[r]},o.size=function p(e){var p=0;for(var r in e)e.hasOwnProperty(r)&&p++;return p},n.prototype.remove=function(){for(var e=0,r=this.children.length;r>e;e++)this.children[e].parentNode&&(this.children[e].parentNode.removeChild(this.children[e]),this.children.splice(e,1))},n.prototype.appendChild=function(e){this.children.push(e),this.placeholderNode.parentNode&&this.placeholderNode.parentNode.insertBefore(e,this.placeholderNode)},n.prototype.appendTo=function(e){e.appendChild(this.placeholderNode);for(var r=0,t=this.children.length;t>r;r++)this.placeholderNode.parentNode.insertBefore(this.children[r],this.placeholderNode);var o=this;this.parentNode={removeChild:function(e){if(!(e instanceof n&&e===o))throw new Error("You are trying to remove from pseudo node another node or another type.");for(var r=[],t=0,i=e.children.length;i>t;t++)o.placeholderNode.parentNode.removeChild(e.children[t]),-1==o.children.indexOf(e.children[t])&&r.push(e.children[t]);o.children=r}}},n.prototype.setAttribute=function(e,r){for(var t=0,o=this.children.length;o>t;t++)this.children[t].setAttribute(e,r)},e.monkberry=new r}(window);
