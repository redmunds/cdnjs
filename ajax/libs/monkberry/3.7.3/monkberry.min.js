!function(e){function t(){this.pool=new n,this.templates={},this.filters={},this.wrappers={}}function n(){this.store={}}function o(){this.items=Object.create(null),this.length=0,this.next=0}function r(e,t,n,o,r){if(r){var i=e;return i[r.value]=t[o],r.key&&(i[r.key]=o),i}return t[o]}function i(e,t,n,o,r){if(r){var i=e;return i[r.value]=t[n[o]],r.key&&(i[r.key]=n[o]),i}return t[n[o]]}t.prototype.foreach=function(e,t,n,o,s,p,h){var u,d,f,a,l,c,m=n.length;Array.isArray(p)?(l=r,c=p.length):(l=i,a=Object.keys(p),c=a.length),f=m-c;for(u in n.items){if(!(f-- >0))break;n.items[u].remove()}d=0;for(u in n.items)n.items[u].update(l(s,p,a,d,h)),d++;for(d=m,f=c;f>d;d++){var y=this._render(o,void 0,void 0,!0);y.parent=e,e.nested.push(y),8==t.nodeType?y.insertBefore(t):y.appendTo(t),y.onRender&&y.onRender(),y.update(l(s,p,a,d,h)),u=n.push(y),y.onRemove=function(e){return function(){n.remove(e)}}(u)}},t.prototype.insert=function(e,t,n,o,r,i){if(n.ref)i?n.ref.update(r):n.ref.remove();else if(i){var s=this._render(o,void 0,void 0,!0);s.parent=e,e.nested.push(s),8==t.nodeType?s.insertBefore(t):s.appendTo(t),s.onRender&&s.onRender(),s.update(r),n.ref=s,s.onRemove=function(){n.ref=null}}return i},t.prototype.render=function(e,t,n){return this._render(e,t,n)},t.prototype._render=function(e,t,n,o){if(n=n||!1,o=o||!1,this.templates[e]){var r;return n?(r=this.templates[e](),r.name=e,r.pool=this.pool):(r=this.pool.pull(e),r||(r=this.templates[e](),r.name=e,r.pool=this.pool)),!o&&r.onRender&&r.onRender(),void 0!==t&&r.update(t),this.wrappers[e]&&!r.wrapped[e]&&(r=this.wrappers[e](r),r.wrapped[e]=!0),r}throw new Error('Template with name "'+e+'" does not found.')},t.prototype.prerender=function(e,t){for(;t--;)this.pool.push(e,this.render(e,void 0,!0))},t.prototype.mount=function(t){var n=this;"function"==typeof t&&(t=t(this,e)),Object.keys(t).forEach(function(e){n.templates[e]=t[e]})},t.prototype.createPool=function(){var e=new t;return e.filters=this.filters,e},t.prototype.getPoolInfo=function(){var e,t={};for(e in this.pool.store)t[e]=this.pool.store[e].length;return t},t.prototype.view=function(){return new t.View},t.prototype.map=function(){return new o},t.View=function(){this.name="",this.parent=null,this.nested=[],this.nodes=[],this.wrapped={},this.onRender=null,this.onRemove=null},t.View.prototype.update=function(e){var t=this,n="object"==typeof e?Object.keys(e):[];t.__cache__&&n.forEach(function(e){e in t.__cache__&&delete t.__cache__[e]}),t.__update__&&n.forEach(function(n){t.__update__.hasOwnProperty(n)&&t.__update__[n](e,e[n])})},t.View.prototype.appendTo=function(e){for(var t=0,n=this.nodes.length;n>t;t++)e.appendChild(this.nodes[t])},t.View.prototype.insertBefore=function(e){if(!e.parentNode)throw new Error("Can not insert child view into parent node. You need append your view first and then update.");for(var t=0,n=this.nodes.length;n>t;t++)e.parentNode.insertBefore(this.nodes[t],e)},t.View.prototype.createDocument=function(){if(1==this.nodes.length)return this.nodes[0];for(var t=e.createDocumentFragment(),n=0,o=this.nodes.length;o>n;n++)t.appendChild(this.nodes[n]);return t},t.View.prototype.dom=function(){return this.createDocument()},t.View.prototype.remove=function(e){e=e||!1;for(var t=this.nodes.length;t--;)this.nodes[t].parentNode.removeChild(this.nodes[t]);for(this.onRemove&&this.onRemove(),t=this.nested.length;t--;)this.nested[t].remove(e);this.parent&&(t=this.parent.nested.indexOf(this),this.parent.nested.splice(t,1)),e||this.pool.push(this.name,this)},t.View.prototype.getElementById=function(e){return this.querySelector("#"+e)},t.View.prototype.querySelector=function(e){for(var t=0;t<this.nodes.length;t++){if(this.nodes[t].matches&&this.nodes[t].matches(e))return this.nodes[t];if(8===this.nodes[t].nodeType)throw"Can not use querySelector with non-element nodes on first level.";if(this.nodes[t].querySelector){var n=this.nodes[t].querySelector(e);if(n)return n}}return null},n.prototype.push=function(e,t){this.store[e]||(this.store[e]=[]),this.store[e].push(t)},n.prototype.pull=function(e){return this.store[e]?this.store[e].pop():void 0},o.prototype.push=function(e){return this.items[this.next]=e,this.length+=1,this.next+=1,this.next-1},o.prototype.remove=function(e){if(!(e in this.items))throw new Error('You are trying to delete not existing element "'+e+'" form map.');delete this.items[e],this.length-=1},o.prototype.forEach=function(e){for(var t in this.items)e(this.items[t])},"undefined"!=typeof module?module.exports=new t:window.monkberry=new t}(window.document);
//# sourceMappingURL=monkberry.min.js.map