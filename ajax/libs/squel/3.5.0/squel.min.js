(function(){var t,e,r,n,i,o,l,s,u,a,c,p=[].slice,h={}.hasOwnProperty,f=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t={},i=function(){var t,e,r,n,i,o,l;if(t=arguments[0],r=2<=arguments.length?p.call(arguments,1):[])for(o=0,l=r.length;o<l;o++)if(n=r[o])for(e in n)h.call(n,e)&&(i=n[e],t[e]=i);return t},c=function(){var t,e,r,n,o,l;for(e=arguments[0],n=2<=arguments.length?p.call(arguments,1):[],t=i({},e),o=0,l=n.length;o<l;o++)r=n[o],delete t[r];return t},t.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],numberedParameters:!1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" "},t.globalValueHandlers=[],r=function(t,e,r){var n,i,o;if("function"!=typeof e)throw new Error("type must be a class constructor");if("function"!=typeof r)throw new Error("handler must be a function");for(i=0,o=t.length;i<o;i++)if(n=t[i],n.type===e)return void(n.handler=r);return t.push({type:e,handler:r})},e=function(){var t,e,r,n,i,o,l,s;for(n=arguments[0],t=2<=arguments.length?p.call(arguments,1):[],i=0,l=t.length;i<l;i++)for(e=t[i],o=0,s=e.length;o<s;o++)if(r=e[o],n instanceof r.type)return r.handler},t.registerValueHandler=function(e,n){return r(t.globalValueHandlers,e,n)},t.Cloneable=function(){function t(){}return t.prototype.clone=function(){var t;return t=new this.constructor,i(t,JSON.parse(JSON.stringify(this)))},t}(),t.BaseBuilder=function(n){function o(e){var r;r=JSON.parse(JSON.stringify(t.DefaultQueryBuilderOptions)),this.options=i({},r,e)}return f(o,n),o.prototype.registerValueHandler=function(t,e){return r(this.options.valueHandlers,t,e),this},o.prototype._getObjectClassName=function(t){var e;if(t&&t.constructor&&t.constructor.toString&&(e=t.constructor.toString().match(/function\s*(\w+)/),e&&2===e.length))return e[1]},o.prototype._sanitizeCondition=function(e){if(e instanceof t.Expression&&(e=e.toString()),"string"!=typeof e)throw new Error("condition must be a string or Expression instance");return e},o.prototype._sanitizeName=function(t,e){if("string"!=typeof t)throw new Error(""+e+" must be a string");return t},o.prototype._sanitizeField=function(e,r){var n;return null==r&&(r={}),e instanceof t.QueryBuilder?e="("+e+")":(e=this._sanitizeName(e,"field name"),this.options.autoQuoteFieldNames&&(n=this.options.nameQuoteCharacter,e=r.ignorePeriodsForFieldNameQuotes?""+n+e+n:e.split(".").map(function(t){return""+n+t+n}).join("."))),e},o.prototype._sanitizeTable=function(e,r){var n;if(null==r&&(r=!1),r){if("string"!=typeof e){if(e instanceof t.QueryBuilder&&e.isNestable())return e;throw new Error("table name must be a string or a nestable query instance")}n=e}else n=this._sanitizeName(e,"table name");return this.options.autoQuoteTableNames?""+this.options.nameQuoteCharacter+n+this.options.nameQuoteCharacter:n},o.prototype._sanitizeTableAlias=function(t){var e;return e=this._sanitizeName(t,"table alias"),this.options.autoQuoteAliasNames?""+this.options.tableAliasQuoteCharacter+e+this.options.tableAliasQuoteCharacter:e},o.prototype._sanitizeFieldAlias=function(t){var e;return e=this._sanitizeName(t,"field alias"),this.options.autoQuoteAliasNames?""+this.options.fieldAliasQuoteCharacter+e+this.options.fieldAliasQuoteCharacter:e},o.prototype._sanitizeLimitOffset=function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t},o.prototype._sanitizeValue=function(r){var n,i;if(n=typeof r,null===r);else if("string"===n||"number"===n||"boolean"===n);else if(r instanceof t.QueryBuilder&&r.isNestable());else if(i=void 0!==e(r,this.options.valueHandlers,t.globalValueHandlers),!i)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types");return r},o.prototype._escapeValue=function(t){return!0!==this.options.replaceSingleQuotes?t:t.replace(/\'/g,this.options.singleQuoteReplacement)},o.prototype._formatCustomValue=function(r){var n;return n=e(r,this.options.valueHandlers,t.globalValueHandlers),n&&(r=n(r)),r},o.prototype._formatValueAsParam=function(e){return e instanceof t.QueryBuilder&&e.isNestable()?""+e:this._formatCustomValue(e)},o.prototype._formatValue=function(e,r){return null==r&&(r={}),e=this._formatCustomValue(e),null===e?e="NULL":"boolean"==typeof e?e=e?"TRUE":"FALSE":e instanceof t.QueryBuilder?e="("+e+")":"number"!=typeof e&&(e=this._escapeValue(e),e=r.dontQuote?""+e:"'"+e+"'"),e},o}(t.Cloneable),t.Expression=function(t){function e(){var t=this;e.__super__.constructor.call(this),this.tree={parent:null,nodes:[]},this.current=this.tree,this._begin=function(e){var r;return r={type:e,parent:t.current,nodes:[]},t.current.nodes.push(r),t.current=t.current.nodes[t.current.nodes.length-1],t}}return f(e,t),e.prototype.tree=null,e.prototype.current=null,e.prototype.and_begin=function(){return this._begin("AND")},e.prototype.or_begin=function(){return this._begin("OR")},e.prototype.end=function(){if(!this.current.parent)throw new Error("begin() needs to be called");return this.current=this.current.parent,this},e.prototype.and=function(t,e){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this.current.nodes.push({type:"AND",expr:t,para:e}),this},e.prototype.or=function(t,e){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this.current.nodes.push({type:"OR",expr:t,para:e}),this},e.prototype.toString=function(){if(null!==this.current.parent)throw new Error("end() needs to be called");return this._toString(this.tree)},e.prototype.toParam=function(){if(null!==this.current.parent)throw new Error("end() needs to be called");return this._toString(this.tree,!0)},e.prototype._toString=function(t,e){var r,n,i,o,l,s,u,a,c,p,h;for(null==e&&(e=!1),l="",o=[],p=t.nodes,s=0,a=p.length;s<a;s++){if(r=p[s],null!=r.expr){if(n=r.expr,null!=r.para)if(e)if(Array.isArray(r.para))for(h=r.para,u=0,c=h.length;u<c;u++)i=h[u],o.push(this._formatValueAsParam(i));else o.push(this._formatValueAsParam(r.para));else r.para=Array.isArray(r.para)?"("+r.para.join(", ")+")":this._formatValue(r.para),n=n.replace("?",r.para)}else n=this._toString(r,e),e&&(o=o.concat(n.values),n=n.text),""!==n&&(n="("+n+")");""!==n&&(""!==l&&(l+=" "+r.type+" "),l+=n)}return e?{text:l,values:o}:l},e.prototype.clone=function(){var t,e;return t=new this.constructor,(e=function(r){var n,i,o,l,s;for(l=r.nodes,s=[],i=0,o=l.length;i<o;i++)n=l[i],null!=n.expr?s.push(t.current.nodes.push(JSON.parse(JSON.stringify(n)))):(t._begin(n.type),e(n),!this.current===n?s.push(t.end()):s.push(void 0));return s})(this.tree),t},e}(t.BaseBuilder),t.Block=function(e){function r(){return o=r.__super__.constructor.apply(this,arguments)}return f(r,e),r.prototype.exposedMethods=function(){var e,r,n;r={};for(e in this)n=this[e],"function"!=typeof n||"_"===e.charAt(0)||t.Block.prototype[e]||(r[e]=n);return r},r.prototype.buildStr=function(t){return""},r.prototype.buildParam=function(t){return{text:this.buildStr(t),values:[]}},r}(t.BaseBuilder),t.StringBlock=function(t){function e(t,r){e.__super__.constructor.call(this,t),this.str=r}return f(e,t),e.prototype.buildStr=function(t){return this.str},e}(t.Block),t.AbstractTableBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.tables=[]}return f(e,t),e.prototype._table=function(t,e){return null==e&&(e=null),e&&(e=this._sanitizeTableAlias(e)),t=this._sanitizeTable(t,this.options.allowNested||!1),this.options.singleTable&&(this.tables=[]),this.tables.push({table:t,alias:e})},e.prototype.buildStr=function(t){var e,r,n,i,o;if(0>=this.tables.length)throw new Error("_table() needs to be called");for(r="",o=this.tables,n=0,i=o.length;n<i;n++)e=o[n],""!==r&&(r+=", "),r+="string"==typeof e.table?e.table:"("+e.table+")",e.alias&&(r+=" "+e.alias);return r},e}(t.Block),t.UpdateTableBlock=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.table=function(t,e){return null==e&&(e=null),this._table(t,e)},e}(t.AbstractTableBlock),t.FromTableBlock=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.from=function(t,e){return null==e&&(e=null),this._table(t,e)},e.prototype.buildStr=function(t){var r;if(0>=this.tables.length)throw new Error("from() needs to be called");return r=e.__super__.buildStr.call(this,t),"FROM "+r},e}(t.AbstractTableBlock),t.IntoTableBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.table=null}return f(e,t),e.prototype.into=function(t){return this.table=this._sanitizeTable(t,!1)},e.prototype.buildStr=function(t){if(!this.table)throw new Error("into() needs to be called");return"INTO "+this.table},e}(t.Block),t.GetFieldBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this._fields=[]}return f(e,t),e.prototype.fields=function(t,e){var r,n,i;null==e&&(e={}),i=[];for(n in t)r=t[n],i.push(this.field(n,r,e));return i},e.prototype.field=function(t,e,r){return null==e&&(e=null),null==r&&(r={}),t=this._sanitizeField(t,r),e&&(e=this._sanitizeFieldAlias(e)),this._fields.push({name:t,alias:e})},e.prototype.buildStr=function(t){var e,r,n,i,o;for(r="",o=this._fields,n=0,i=o.length;n<i;n++)e=o[n],""!==r&&(r+=", "),r+=e.name,e.alias&&(r+=" AS "+e.alias);return""===r?"*":r},e}(t.Block),t.AbstractSetFieldBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.fieldOptions=[],this.fields=[],this.values=[]}return f(e,t),e.prototype.set=function(t,e,r){var n;if(null==r&&(r={}),this.values.length>1)throw new Error("Cannot call set or setFields on multiple rows of fields.");return void 0!==e&&(e=this._sanitizeValue(e)),n=this.fields.indexOf(this._sanitizeField(t,r)),n!==-1?(this.values[0][n]=e,this.fieldOptions[0][n]=r):(this.fields.push(this._sanitizeField(t,r)),n=this.fields.length-1,Array.isArray(this.values[0])?(this.values[0][n]=e,this.fieldOptions[0][n]=r):(this.values.push([e]),this.fieldOptions.push([r]))),this},e.prototype.setFields=function(t,e){var r;if(null==e&&(e={}),"object"!=typeof t)throw new Error("Expected an object but got "+typeof t);for(r in t)h.call(t,r)&&this.set(r,t[r],e);return this},e.prototype.setFieldsRows=function(t,e){var r,n,i,o,l,s,u;if(null==e&&(e={}),!Array.isArray(t))throw new Error("Expected an array of objects but got "+typeof t);for(this.fields=[],this.values=[],n=l=0,s=t.length;0<=s?l<s:l>s;n=0<=s?++l:--l){u=t[n];for(r in u)if(h.call(u,r)){if(i=this.fields.indexOf(this._sanitizeField(r,e)),0<n&&-1===i)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===i&&(this.fields.push(this._sanitizeField(r,e)),i=this.fields.length-1),o=this._sanitizeValue(t[n][r]),Array.isArray(this.values[n])?(this.values[n][i]=o,this.fieldOptions[n][i]=e):(this.values[n]=[o],this.fieldOptions[n]=[e])}}return this},e.prototype.buildStr=function(){throw new Error("Not yet implemented")},e.prototype.buildParam=function(){throw new Error("Not yet implemented")},e}(t.Block),t.SetFieldBlock=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.setFieldsRows=function(){throw new Error("Cannot call setFieldRows for an UPDATE SET")},e.prototype.buildStr=function(t){var e,r,n,i,o,l,s;if(0>=this.fields.length)throw new Error("set() needs to be called");for(i="",n=l=0,s=this.fields.length;0<=s?l<s:l>s;n=0<=s?++l:--l)e=this.fields[n],""!==i&&(i+=", "),o=this.values[0][n],r=this.fieldOptions[0][n],i+="undefined"==typeof o?e:""+e+" = "+this._formatValue(o,r);return"SET "+i},e.prototype.buildParam=function(t){var e,r,n,i,o,l,s;if(0>=this.fields.length)throw new Error("set() needs to be called");for(n="",i=[],r=l=0,s=this.fields.length;0<=s?l<s:l>s;r=0<=s?++l:--l)e=this.fields[r],""!==n&&(n+=", "),o=this.values[0][r],"undefined"==typeof o?n+=e:(n+=""+e+" = ?",i.push(this._formatValueAsParam(o)));return{text:"SET "+n,values:i}},e}(t.AbstractSetFieldBlock),t.InsertFieldValueBlock=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.buildStr=function(t){var e,r,n,i,o,l,s,u;if(0>=this.fields.length)throw new Error("set() needs to be called");for(i=[],r=o=0,s=this.values.length;0<=s?o<s:o>s;r=0<=s?++o:--o)for(n=l=0,u=this.values[r].length;0<=u?l<u:l>u;n=0<=u?++l:--l)e=this._formatValue(this.values[r][n],this.fieldOptions[r][n]),"string"==typeof i[r]?i[r]+=", "+e:i[r]=""+e;return"("+this.fields.join(", ")+") VALUES ("+i.join("), (")+")"},e.prototype.buildParam=function(t){var e,r,n,i,o,l,s,u,a,c,p;if(0>=this.fields.length)throw new Error("set() needs to be called");for(i="",o=[],n=[],e=l=0,a=this.fields.length;0<=a?l<a:l>a;e=0<=a?++l:--l)""!==i&&(i+=", "),i+=this.fields[e];for(e=s=0,c=this.values.length;0<=c?s<c:s>c;e=0<=c?++s:--s)for(r=u=0,p=this.values[e].length;0<=p?u<p:u>p;r=0<=p?++u:--u)n.push(this._formatValueAsParam(this.values[e][r])),"string"==typeof o[e]?o[e]+=", ?":o[e]="?";return{text:"("+i+") VALUES ("+o.join("), (")+")",values:n}},e}(t.AbstractSetFieldBlock),t.DistinctBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.useDistinct=!1}return f(e,t),e.prototype.distinct=function(){return this.useDistinct=!0},e.prototype.buildStr=function(t){return this.useDistinct?"DISTINCT":""},e}(t.Block),t.GroupByBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.groups=[]}return f(e,t),e.prototype.group=function(t){return t=this._sanitizeField(t),this.groups.push(t)},e.prototype.buildStr=function(t){var e,r,n,i,o;if(r="",0<this.groups.length){for(o=this.groups,n=0,i=o.length;n<i;n++)e=o[n],""!==r&&(r+=", "),r+=e;r="GROUP BY "+r}return r},e}(t.Block),t.OffsetBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.offsets=null}return f(e,t),e.prototype.offset=function(t){return t=this._sanitizeLimitOffset(t),this.offsets=t},e.prototype.buildStr=function(t){return this.offsets?"OFFSET "+this.offsets:""},e}(t.Block),t.WhereBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.wheres=[]}return f(e,t),e.prototype.where=function(){var t,e,r,n,i,o,l,s,u,a,c,h,f;for(e=arguments[0],u=2<=arguments.length?p.call(arguments,1):[],e=this._sanitizeCondition(e),r="",n=[],i=a=0,f=e.length;0<=f?a<f:a>f;i=0<=f?++a:--a)if(t=e.charAt(i),"?"===t&&0<u.length)if(s=u.shift(),Array.isArray(s)){for(o=[],c=0,h=s.length;c<h;c++)l=s[c],o.push(this._sanitizeValue(l));n=n.concat(o),r+="("+function(){var t,e,r;for(r=[],t=0,e=o.length;t<e;t++)l=o[t],r.push("?");return r}().join(", ")+")"}else r+="?",n.push(this._sanitizeValue(s));else r+=t;if(""!==r)return this.wheres.push({text:r,values:n})},e.prototype.buildStr=function(t){var e,r,n,i,o,l,s,u,a,c;if(0>=this.wheres.length)return"";for(o="",a=this.wheres,l=0,u=a.length;l<u;l++)if(i=a[l],""!==o&&(o+=") AND ("),0<i.values.length)for(n=0,r=s=0,c=i.text.length;0<=c?s<c:s>c;r=0<=c?++s:--s)e=i.text.charAt(r),o+="?"===e?this._formatValue(i.values[n++]):e;else o+=i.text;return"WHERE ("+o+")"},e.prototype.buildParam=function(t){var e,r,n,i,o,l,s,u,a,c,p;if(e={text:"",values:[]},0>=this.wheres.length)return e;for(o="",c=this.wheres,l=0,u=c.length;l<u;l++)for(i=c[l],""!==o&&(o+=") AND ("),o+=i.text,p=i.values,s=0,a=p.length;s<a;s++)r=p[s],e.values.push(this._formatValueAsParam(r)),n=this._formatValueAsParam(n);return e.text="WHERE ("+o+")",e},e}(t.Block),t.OrderByBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.orders=[]}return f(e,t),e.prototype.order=function(t,e){return null==e&&(e=!0),t=this._sanitizeField(t),this.orders.push({field:t,dir:!!e})},e.prototype.buildStr=function(t){var e,r,n,i,o;if(0<this.orders.length){for(r="",o=this.orders,n=0,i=o.length;n<i;n++)e=o[n],""!==r&&(r+=", "),r+=""+e.field+" "+(e.dir?"ASC":"DESC");return"ORDER BY "+r}return""},e}(t.Block),t.LimitBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.limits=null}return f(e,t),e.prototype.limit=function(t){return t=this._sanitizeLimitOffset(t),this.limits=t},e.prototype.buildStr=function(t){return this.limits?"LIMIT "+this.limits:""},e}(t.Block),t.JoinBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.joins=[]}return f(e,t),e.prototype.join=function(t,e,r,n){return null==e&&(e=null),null==r&&(r=null),null==n&&(n="INNER"),t=this._sanitizeTable(t,!0),e&&(e=this._sanitizeTableAlias(e)),r&&(r=this._sanitizeCondition(r)),this.joins.push({type:n,table:t,alias:e,condition:r}),this},e.prototype.left_join=function(t,e,r){return null==e&&(e=null),null==r&&(r=null),this.join(t,e,r,"LEFT")},e.prototype.right_join=function(t,e,r){return null==e&&(e=null),null==r&&(r=null),this.join(t,e,r,"RIGHT")},e.prototype.outer_join=function(t,e,r){return null==e&&(e=null),null==r&&(r=null),this.join(t,e,r,"OUTER")},e.prototype.left_outer_join=function(t,e,r){return null==e&&(e=null),null==r&&(r=null),this.join(t,e,r,"LEFT OUTER")},e.prototype.buildStr=function(t){var e,r,n,i,o;for(r="",o=this.joins||[],n=0,i=o.length;n<i;n++)e=o[n],""!==r&&(r+=" "),r+=""+e.type+" JOIN ",r+="string"==typeof e.table?e.table:"("+e.table+")",e.alias&&(r+=" "+e.alias),e.condition&&(r+=" ON ("+e.condition+")");return r},e}(t.Block),t.QueryBuilder=function(t){function e(t,r){var n,i,o,l,s,u,a,c,p=this;for(e.__super__.constructor.call(this,t),this.blocks=r||[],a=this.blocks,s=0,u=a.length;s<u;s++){n=a[s],c=n.exposedMethods(),l=function(t,e,r){return p[e]=function(){return r.apply(t,arguments),p}};for(o in c){if(i=c[o],null!=this[o])throw new Error(""+this._getObjectClassName(this)+" already has a builder method called: "+o);l(n,o,i)}}}return f(e,t),e.prototype.registerValueHandler=function(t,r){var n,i,o,l;for(l=this.blocks,i=0,o=l.length;i<o;i++)n=l[i],n.registerValueHandler(t,r);return e.__super__.registerValueHandler.call(this,t,r),this},e.prototype.updateOptions=function(t){var e,r,n,o,l;for(this.options=i({},this.options,t),o=this.blocks,l=[],r=0,n=o.length;r<n;r++)e=o[r],l.push(e.options=i({},e.options,t));return l},e.prototype.toString=function(){var t;return function(){var e,r,n,i;for(n=this.blocks,i=[],e=0,r=n.length;e<r;e++)t=n[e],i.push(t.buildStr(this));return i}.call(this).filter(function(t){return 0<t.length}).join(this.options.separator)},e.prototype.toParam=function(){var t,e,r,n,i;return n={text:"",values:[]},e=function(){var e,r,n,i;for(n=this.blocks,i=[],e=0,r=n.length;e<r;e++)t=n[e],i.push(t.buildParam(this));return i}.call(this),n.text=function(){var r,n,i;for(i=[],r=0,n=e.length;r<n;r++)t=e[r],i.push(t.text);return i}().filter(function(t){return 0<t.length}).join(this.options.separator),n.values=(i=[]).concat.apply(i,function(){var r,n,i;for(i=[],r=0,n=e.length;r<n;r++)t=e[r],i.push(t.values);return i}()),this.options.numberedParameters&&(r=0,n.text=n.text.replace(/\?/g,function(){return"$"+ ++r})),n},e.prototype.clone=function(){var t;return new this.constructor(this.options,function(){var e,r,n,i;for(n=this.blocks,i=[],e=0,r=n.length;e<r;e++)t=n[e],i.push(t.clone());return i}.call(this))},e.prototype.isNestable=function(){return!1},e}(t.BaseBuilder),t.Select=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"SELECT"),new t.DistinctBlock(e),new t.GetFieldBlock(e),new t.FromTableBlock(i({},e,{allowNested:!0})),new t.JoinBlock(i({},e,{allowNested:!0})),new t.WhereBlock(e),new t.GroupByBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e),new t.OffsetBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r.prototype.isNestable=function(){return!0},r}(t.QueryBuilder),t.Update=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"UPDATE"),new t.UpdateTableBlock(e),new t.SetFieldBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder),t.Delete=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"DELETE"),new t.FromTableBlock(i({},e,{singleTable:!0})),new t.JoinBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder),t.Insert=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.InsertFieldValueBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder),n={VERSION:"3.5.0",expr:function(){return new t.Expression},select:function(e,r){return new t.Select(e,r)},update:function(e,r){return new t.Update(e,r)},insert:function(e,r){return new t.Insert(e,r)},delete:function(e,r){return new t.Delete(e,r)},registerValueHandler:t.registerValueHandler},n.remove=n.delete,n.cls=t,("undefined"!=typeof define&&null!==define?define.amd:void 0)?define(function(){return n}):("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=n:"undefined"!=typeof window&&null!==window&&(window.squel=n),n.flavours={},n.useFlavour=function(t){if(!(n.flavours[t]instanceof Function))throw new Error("Flavour not available: "+t);return n.flavours[t].call(null,n),n},n.flavours.postgres=function(){return t=n.cls,t.DefaultQueryBuilderOptions.numberedParameters=!0,t.ReturningBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this._str=null}return f(e,t),e.prototype.returning=function(t){return this._str=this._sanitizeField(t)},e.prototype.buildStr=function(){return this._str?"RETURNING "+this._str:""},e}(t.Block),t.Insert=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.InsertFieldValueBlock(e),new t.ReturningBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder),t.Update=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"UPDATE"),new t.UpdateTableBlock(e),new t.SetFieldBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e),new t.ReturningBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder),t.Delete=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"DELETE"),new t.FromTableBlock(i({},e,{singleTable:!0})),new t.JoinBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e),new t.ReturningBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder)},n.flavours.mysql=function(){return t=n.cls,t.MysqlInsertFieldValueBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this._duplicateKeyUpdates={}}return f(e,t),e.prototype.set=function(t,r,n){return null==n&&(n={}),e.__super__.set.call(this,t,r,c(n,"duplicateKeyUpdate")),void 0!==(null!=n?n.duplicateKeyUpdate:void 0)&&(this._duplicateKeyUpdates[t]=this._sanitizeValue(n.duplicateKeyUpdate)),this},e.prototype.setFields=function(t,r){var n,i,o;null==r&&(r={}),e.__super__.setFields.call(this,t,c(r,"duplicateKeyUpdate")),o=r.duplicateKeyUpdate;for(n in o)i=o[n],this._duplicateKeyUpdates[n]=this._sanitizeValue(i);return this},e.prototype.setFieldsRows=function(t,r){var n,i,o;null==r&&(r={}),e.__super__.setFieldsRows.call(this,t,c(r,"duplicateKeyUpdate")),o=r.duplicateKeyUpdate;for(n in o)i=o[n],this._duplicateKeyUpdates[n]=this._sanitizeValue(i);return this},e.prototype.buildStr=function(){var t;return t=e.__super__.buildStr.call(this),""+t+this._buildDuplicateKeyUpdateStr()},e.prototype.buildParam=function(t){var r,n;return n=e.__super__.buildParam.call(this,t),r=this._buildDuplicateKeyUpdateParam(),n.text=""+n.text+r.text,n.values.push.apply(n.values,r.values),n},e.prototype._buildDuplicateKeyUpdateStr=function(){var t,e,r,n;e="",n=this._duplicateKeyUpdates;for(t in n)r=n[t],""!==e&&(e+=", "),e+=""+t+" = "+this._formatValue(r);return""!==e?" ON DUPLICATE KEY UPDATE "+e:""},e.prototype._buildDuplicateKeyUpdateParam=function(){var t,e,r,n,i;r={text:"",values:[]},e="",i=this._duplicateKeyUpdates;for(t in i)n=i[t],""!==e&&(e+=", "),e+=""+t+" = ?",r.values.push(this._formatValueAsParam(n));return""!==e&&(r.text=" ON DUPLICATE KEY UPDATE "+e),r},e}(t.InsertFieldValueBlock),t.Insert=function(e){function r(e,n){null==n&&(n=null),n||(n=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.MysqlInsertFieldValueBlock(e)]),r.__super__.constructor.call(this,e,n)}return f(r,e),r}(t.QueryBuilder)}}).call(this);