(function(){var t,e,n,r,i,o,l,s,u,a,c,p=[].slice,f={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d=function(t,e){return function(){return t.apply(e,arguments)}};t={},i=function(){var t,e,n,r,i,o,l;if(t=arguments[0],n=2<=arguments.length?p.call(arguments,1):[])for(o=0,l=n.length;o<l;o++)if(r=n[o])for(e in r)f.call(r,e)&&(i=r[e],t[e]=i);return t},c=function(){var t,e,n,r,o,l;for(e=arguments[0],r=2<=arguments.length?p.call(arguments,1):[],t=i({},e),o=0,l=r.length;o<l;o++)n=r[o],delete t[n];return t},t.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],numberedParameters:!1,numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" "},t.globalValueHandlers=[],n=function(t,e,n){var r,i,o;if("function"!=typeof e&&"string"!=typeof e)throw new Error("type must be a class constructor or string denoting 'typeof' result");if("function"!=typeof n)throw new Error("handler must be a function");for(i=0,o=t.length;i<o;i++)if(r=t[i],r.type===e)return void(r.handler=n);return t.push({type:e,handler:n})},e=function(){var t,e,n,r,i,o,l,s;for(r=arguments[0],t=2<=arguments.length?p.call(arguments,1):[],i=0,l=t.length;i<l;i++)for(e=t[i],o=0,s=e.length;o<s;o++)if(n=e[o],n.type===typeof r||"string"!=typeof n.type&&r instanceof n.type)return n.handler},t.registerValueHandler=function(e,r){return n(t.globalValueHandlers,e,r)},t.Cloneable=function(){function t(){}return t.prototype.clone=function(){var t;return t=new this.constructor,i(t,JSON.parse(JSON.stringify(this)))},t}(),t.BaseBuilder=function(r){function o(e){var n;n=JSON.parse(JSON.stringify(t.DefaultQueryBuilderOptions)),this.options=i({},n,e)}return h(o,r),o.prototype.registerValueHandler=function(t,e){return n(this.options.valueHandlers,t,e),this},o.prototype._getObjectClassName=function(t){var e;if(t&&t.constructor&&t.constructor.toString&&(e=t.constructor.toString().match(/function\s*(\w+)/),e&&2===e.length))return e[1]},o.prototype._sanitizeCondition=function(e){if(!(e instanceof t.Expression)&&"string"!=typeof e)throw new Error("condition must be a string or Expression instance");return e},o.prototype._sanitizeName=function(t,e){if("string"!=typeof t)throw new Error(""+e+" must be a string");return t},o.prototype._sanitizeField=function(e,n){var r;return null==n&&(n={}),e instanceof t.QueryBuilder?e="("+e+")":(e=this._sanitizeName(e,"field name"),this.options.autoQuoteFieldNames&&(r=this.options.nameQuoteCharacter,e=n.ignorePeriodsForFieldNameQuotes?""+r+e+r:e.split(".").map(function(t){return"*"===t?t:""+r+t+r}).join("."))),e},o.prototype._sanitizeTable=function(e,n){var r;if(null==n&&(n=!1),n){if("string"!=typeof e){if(e instanceof t.QueryBuilder&&e.isNestable())return e;throw new Error("table name must be a string or a nestable query instance")}r=e}else r=this._sanitizeName(e,"table name");return this.options.autoQuoteTableNames?""+this.options.nameQuoteCharacter+r+this.options.nameQuoteCharacter:r},o.prototype._sanitizeTableAlias=function(t){var e;return e=this._sanitizeName(t,"table alias"),this.options.autoQuoteAliasNames?""+this.options.tableAliasQuoteCharacter+e+this.options.tableAliasQuoteCharacter:e},o.prototype._sanitizeFieldAlias=function(t){var e;return e=this._sanitizeName(t,"field alias"),this.options.autoQuoteAliasNames?""+this.options.fieldAliasQuoteCharacter+e+this.options.fieldAliasQuoteCharacter:e},o.prototype._sanitizeLimitOffset=function(t){if(t=parseInt(t),0>t||isNaN(t))throw new Error("limit/offset must be >= 0");return t},o.prototype._sanitizeValue=function(n){var r,i;if(r=typeof n,null===n);else if("string"===r||"number"===r||"boolean"===r);else if(n instanceof t.QueryBuilder&&n.isNestable());else if(i=void 0!==e(n,this.options.valueHandlers,t.globalValueHandlers),!i)throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types");return n},o.prototype._escapeValue=function(t){return!0!==this.options.replaceSingleQuotes?t:t.replace(/\'/g,this.options.singleQuoteReplacement)},o.prototype._formatCustomValue=function(n){var r;return r=e(n,this.options.valueHandlers,t.globalValueHandlers),r&&(n=r(n)),n},o.prototype._formatValueAsParam=function(e){var n,r=this;return Array.isArray(e)?e.map(function(t){return r._formatValueAsParam(t)}):e instanceof t.QueryBuilder&&e.isNestable()?(e.updateOptions({nestedBuilder:!0}),n=e.toParam()):e instanceof t.Expression?n=e.toParam():this._formatCustomValue(e)},o.prototype._formatValue=function(e,n){var r=this;return null==n&&(n={}),e=this._formatCustomValue(e),Array.isArray(e)?(e=e.map(function(t){return r._formatValue(t)}),e="("+e.join(", ")+")"):null===e?e="NULL":"boolean"==typeof e?e=e?"TRUE":"FALSE":e instanceof t.QueryBuilder?e="("+e+")":e instanceof t.Expression?e="("+e+")":"number"!=typeof e&&(e=this._escapeValue(e),e=n.dontQuote?""+e:"'"+e+"'"),e},o}(t.Cloneable),t.Expression=function(t){function e(){var t=this;e.__super__.constructor.call(this),this.tree={parent:null,nodes:[]},this.current=this.tree,this._begin=function(e){var n;return n={type:e,parent:t.current,nodes:[]},t.current.nodes.push(n),t.current=t.current.nodes[t.current.nodes.length-1],t}}return h(e,t),e.prototype.tree=null,e.prototype.current=null,e.prototype.and_begin=function(){return this._begin("AND")},e.prototype.or_begin=function(){return this._begin("OR")},e.prototype.end=function(){if(!this.current.parent)throw new Error("begin() needs to be called");return this.current=this.current.parent,this},e.prototype.and=function(t,e){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this.current.nodes.push({type:"AND",expr:t,para:e}),this},e.prototype.or=function(t,e){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this.current.nodes.push({type:"OR",expr:t,para:e}),this},e.prototype.toString=function(){if(null!==this.current.parent)throw new Error("end() needs to be called");return this._toString(this.tree)},e.prototype.toParam=function(){if(null!==this.current.parent)throw new Error("end() needs to be called");return this._toString(this.tree,!0)},e.prototype._toString=function(t,e){var n,r,i,o,l,s,u,a,c;for(null==e&&(e=!1),s="",l=[],c=t.nodes,u=0,a=c.length;u<a;u++)n=c[u],null!=n.expr?(o=n.expr,null!=n.para&&(e?(r=this._formatValueAsParam(n.para),null!=r.text?(l=l.concat(r.values),o=o.replace("?","("+r.text+")")):l=l.concat(r),Array.isArray(n.para)&&(i=Array.apply(null,new Array(n.para.length)).map(function(){return"?"}),o=o.replace("?","("+i.join(", ")+")"))):o=o.replace("?",this._formatValue(n.para)))):(o=this._toString(n,e),e&&(l=l.concat(o.values),o=o.text),""!==o&&(o="("+o+")")),""!==o&&(""!==s&&(s+=" "+n.type+" "),s+=o);return e?{text:s,values:l}:s},e.prototype.clone=function(){var t,e;return t=new this.constructor,(e=function(n){var r,i,o,l,s;for(l=n.nodes,s=[],i=0,o=l.length;i<o;i++)r=l[i],null!=r.expr?s.push(t.current.nodes.push(JSON.parse(JSON.stringify(r)))):(t._begin(r.type),e(r),!this.current===r?s.push(t.end()):s.push(void 0));return s})(this.tree),t},e}(t.BaseBuilder),t.Block=function(e){function n(){return o=n.__super__.constructor.apply(this,arguments)}return h(n,e),n.prototype.exposedMethods=function(){var e,n,r;n={};for(e in this)r=this[e],"function"!=typeof r||"_"===e.charAt(0)||t.Block.prototype[e]||(n[e]=r);return n},n.prototype.buildStr=function(t){return""},n.prototype.buildParam=function(t){return{text:this.buildStr(t),values:[]}},n}(t.BaseBuilder),t.StringBlock=function(t){function e(t,n){e.__super__.constructor.call(this,t),this.str=n}return h(e,t),e.prototype.buildStr=function(t){return this.str},e}(t.Block),t.AbstractTableBlock=function(e){function n(t){n.__super__.constructor.call(this,t),this.tables=[]}return h(n,e),n.prototype._table=function(t,e){return null==e&&(e=null),e&&(e=this._sanitizeTableAlias(e)),t=this._sanitizeTable(t,this.options.allowNested||!1),this.options.singleTable&&(this.tables=[]),this.tables.push({table:t,alias:e})},n.prototype.buildStr=function(t){var e,n,r,i,o;if(0>=this.tables.length)throw new Error("_table() needs to be called");for(n="",o=this.tables,r=0,i=o.length;r<i;r++)e=o[r],""!==n&&(n+=", "),n+="string"==typeof e.table?e.table:"("+e.table+")",e.alias&&(n+=" "+e.alias);return n},n.prototype._buildParam=function(e,n){var r,i,o,l,s,u,a,c,p,f,h,d,_,y;if(null==n&&(n=null),s={text:"",values:[]},l=[],o="",0>=this.tables.length)return s;for(_=this.tables,a=0,f=_.length;a<f;a++)r=_[a],"string"==typeof r.table?i={text:""+r.table,values:[]}:r.table instanceof t.QueryBuilder?(r.table.updateOptions({nestedBuilder:!0}),i=r.table.toParam()):(r.updateOptions({nestedBuilder:!0}),i=r.buildParam(e)),i.table=r,l.push(i);for(c=0,h=l.length;c<h;c++)for(i=l[c],""!==o?o+=", ":null!=n&&""!==n&&(o+=""+n+" "+o),o+="string"==typeof i.table.table?""+i.text:"("+i.text+")",null!=i.table.alias&&(o+=" "+i.table.alias),y=i.values,p=0,d=y.length;p<d;p++)u=y[p],s.values.push(this._formatCustomValue(u));return s.text+=o,s},n.prototype.buildParam=function(t){return this._buildParam(t)},n}(t.Block),t.UpdateTableBlock=function(t){function e(){return l=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.table=function(t,e){return null==e&&(e=null),this._table(t,e)},e}(t.AbstractTableBlock),t.FromTableBlock=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.from=function(t,e){return null==e&&(e=null),this._table(t,e)},e.prototype.buildStr=function(t){var n;if(0>=this.tables.length)throw new Error("from() needs to be called");return n=e.__super__.buildStr.call(this,t),"FROM "+n},e.prototype.buildParam=function(t){if(0>=this.tables.length)throw new Error("from() needs to be called");return this._buildParam(t,"FROM")},e}(t.AbstractTableBlock),t.IntoTableBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.table=null}return h(e,t),e.prototype.into=function(t){return this.table=this._sanitizeTable(t,!1)},e.prototype.buildStr=function(t){if(!this.table)throw new Error("into() needs to be called");return"INTO "+this.table},e}(t.Block),t.GetFieldBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this._fields=[]}return h(e,t),e.prototype.fields=function(t,e){var n,r,i;null==e&&(e={}),i=[];for(r in t)n=t[r],i.push(this.field(r,n,e));return i},e.prototype.field=function(t,e,n){return null==e&&(e=null),null==n&&(n={}),t=this._sanitizeField(t,n),e&&(e=this._sanitizeFieldAlias(e)),this._fields.push({name:t,alias:e})},e.prototype.buildStr=function(t){var e,n,r,i,o;for(n="",o=this._fields,r=0,i=o.length;r<i;r++)e=o[r],""!==n&&(n+=", "),n+=e.name,e.alias&&(n+=" AS "+e.alias);return""===n?"*":n},e}(t.Block),t.AbstractSetFieldBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.fieldOptions=[],this.fields=[],this.values=[]}return h(e,t),e.prototype._set=function(t,e,n){var r;if(null==n&&(n={}),this.values.length>1)throw new Error("Cannot call set or setFields on multiple rows of fields.");return void 0!==e&&(e=this._sanitizeValue(e)),r=this.fields.indexOf(this._sanitizeField(t,n)),r!==-1?(this.values[0][r]=e,this.fieldOptions[0][r]=n):(this.fields.push(this._sanitizeField(t,n)),r=this.fields.length-1,Array.isArray(this.values[0])?(this.values[0][r]=e,this.fieldOptions[0][r]=n):(this.values.push([e]),this.fieldOptions.push([n]))),this},e.prototype._setFields=function(t,e){var n;if(null==e&&(e={}),"object"!=typeof t)throw new Error("Expected an object but got "+typeof t);for(n in t)f.call(t,n)&&this._set(n,t[n],e);return this},e.prototype._setFieldsRows=function(t,e){var n,r,i,o,l,s,u;if(null==e&&(e={}),!Array.isArray(t))throw new Error("Expected an array of objects but got "+typeof t);for(this.fields=[],this.values=[],r=l=0,s=t.length;0<=s?l<s:l>s;r=0<=s?++l:--l){u=t[r];for(n in u)if(f.call(u,n)){if(i=this.fields.indexOf(this._sanitizeField(n,e)),0<r&&-1===i)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===i&&(this.fields.push(this._sanitizeField(n,e)),i=this.fields.length-1),o=this._sanitizeValue(t[r][n]),Array.isArray(this.values[r])?(this.values[r][i]=o,this.fieldOptions[r][i]=e):(this.values[r]=[o],this.fieldOptions[r]=[e])}}return this},e.prototype.buildStr=function(){throw new Error("Not yet implemented")},e.prototype.buildParam=function(){throw new Error("Not yet implemented")},e}(t.Block),t.SetFieldBlock=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.set=function(t,e,n){return this._set(t,e,n)},e.prototype.setFields=function(t,e){return this._setFields(t,e)},e.prototype.buildStr=function(t){var e,n,r,i,o,l,s;if(0>=this.fields.length)throw new Error("set() needs to be called");for(i="",r=l=0,s=this.fields.length;0<=s?l<s:l>s;r=0<=s?++l:--l)e=this.fields[r],""!==i&&(i+=", "),o=this.values[0][r],n=this.fieldOptions[0][r],i+="undefined"==typeof o?e:""+e+" = "+this._formatValue(o,n);return"SET "+i},e.prototype.buildParam=function(t){var e,n,r,i,o,l,s,u,a,c,p,f;if(0>=this.fields.length)throw new Error("set() needs to be called");for(i="",l=[],n=u=0,p=this.fields.length;0<=p?u<p:u>p;n=0<=p?++u:--u)if(e=this.fields[n],""!==i&&(i+=", "),s=this.values[0][n],"undefined"==typeof s)i+=e;else if(r=this._formatValueAsParam(s),null!=r.text)for(i+=""+e+" = ("+r.text+")",f=r.values,a=0,c=f.length;a<c;a++)o=f[a],l.push(o);else i+=""+e+" = ?",l.push(r);return{text:"SET "+i,values:l}},e}(t.AbstractSetFieldBlock),t.InsertFieldValueBlock=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.set=function(t,e,n){return null==n&&(n={}),this._set(t,e,n)},e.prototype.setFields=function(t,e){return this._setFields(t,e)},e.prototype.setFieldsRows=function(t,e){return this._setFieldsRows(t,e)},e.prototype._buildVals=function(){var t,e,n,r,i,o,l,s;for(r=[],e=i=0,l=this.values.length;0<=l?i<l:i>l;e=0<=l?++i:--i)for(n=o=0,s=this.values[e].length;0<=s?o<s:o>s;n=0<=s?++o:--o)t=this._formatValue(this.values[e][n],this.fieldOptions[e][n]),"string"==typeof r[e]?r[e]+=", "+t:r[e]=""+t;return r},e.prototype._buildValParams=function(){var t,e,n,r,i,o,l,s,u,a,c,p,f,h;for(l=[],r=[],t=s=0,p=this.values.length;0<=p?s<p:s>p;t=0<=p?++s:--s)for(e=u=0,f=this.values[t].length;0<=f?u<f:u>f;e=0<=f?++u:--u){if(n=this._formatValueAsParam(this.values[t][e]),null!=n.text)for(i=n.text,h=n.values,a=0,c=h.length;a<c;a++)o=h[a],r.push(o);else i="?",r.push(n);"string"==typeof l[t]?l[t]+=", "+i:l[t]=""+i}return{vals:l,params:r}},e.prototype.buildStr=function(t){if(0>=this.fields.length)throw new Error("set() needs to be called");return"("+this.fields.join(", ")+") VALUES ("+this._buildVals().join("), (")+")"},e.prototype.buildParam=function(t){var e,n,r,i,o,l,s;if(0>=this.fields.length)throw new Error("set() needs to be called");for(r="",l=this._buildValParams(),i=l.vals,n=l.params,e=o=0,s=this.fields.length;0<=s?o<s:o>s;e=0<=s?++o:--o)""!==r&&(r+=", "),r+=this.fields[e];return{text:"("+r+") VALUES ("+i.join("), (")+")",values:n}},e}(t.AbstractSetFieldBlock),t.DistinctBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.useDistinct=!1}return h(e,t),e.prototype.distinct=function(){return this.useDistinct=!0},e.prototype.buildStr=function(t){return this.useDistinct?"DISTINCT":""},e}(t.Block),t.GroupByBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.groups=[]}return h(e,t),e.prototype.group=function(t){return t=this._sanitizeField(t),this.groups.push(t)},e.prototype.buildStr=function(t){var e,n,r,i,o;if(n="",0<this.groups.length){for(o=this.groups,r=0,i=o.length;r<i;r++)e=o[r],""!==n&&(n+=", "),n+=e;n="GROUP BY "+n}return n},e}(t.Block),t.OffsetBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.offsets=null}return h(e,t),e.prototype.offset=function(t){return t=this._sanitizeLimitOffset(t),this.offsets=t},e.prototype.buildStr=function(t){return this.offsets?"OFFSET "+this.offsets:""},e}(t.Block),t.WhereBlock=function(e){function n(t){n.__super__.constructor.call(this,t),this.wheres=[]}return h(n,e),n.prototype.where=function(){var e,n,r,i,o,l,s,u,a,c,f,h,d,_;if(n=arguments[0],c=2<=arguments.length?p.call(arguments,1):[],n=this._sanitizeCondition(n),r="",i=[],n instanceof t.Expression)a=n.toParam(),r=a.text,i=a.values;else for(o=f=0,_=n.length;0<=_?f<_:f>_;o=0<=_?++f:--f)if(e=n.charAt(o),"?"===e&&0<c.length)if(u=c.shift(),Array.isArray(u)){for(l=[],h=0,d=u.length;h<d;h++)s=u[h],l.push(this._sanitizeValue(s));i=i.concat(l),r+="("+function(){var t,e,n;for(n=[],t=0,e=l.length;t<e;t++)s=l[t],n.push("?");return n}().join(", ")+")"}else r+="?",i.push(this._sanitizeValue(u));else r+=e;if(""!==r)return this.wheres.push({text:r,values:i})},n.prototype.buildStr=function(t){var e,n,r,i,o,l,s,u,a,c;if(0>=this.wheres.length)return"";for(o="",a=this.wheres,l=0,u=a.length;l<u;l++)if(i=a[l],""!==o&&(o+=") AND ("),0<i.values.length)for(r=0,n=s=0,c=i.text.length;0<=c?s<c:s>c;n=0<=c?++s:--s)e=i.text.charAt(n),o+="?"===e?this._formatValue(i.values[r++]):e;else o+=i.text;return"WHERE ("+o+")"},n.prototype.buildParam=function(t){var e,n,r,i,o,l,s,u,a,c,p,f,h,d,_,y,b;if(i={text:"",values:[]},0>=this.wheres.length)return i;for(u="",_=this.wheres,a=0,f=_.length;a<f;a++){for(s=_[a],""!==u&&(u+=") AND ("),o=s.text.split("?"),e=0,y=s.values,c=0,h=y.length;c<h;c++){if(l=y[c],n=this._formatValueAsParam(l),null!=o[e]&&(u+=""+o[e]),null!=n.text)for(u+="("+n.text+")",b=n.values,p=0,d=b.length;p<d;p++)r=b[p],i.values.push(r);else u+="?",i.values.push(n);e+=1}null!=o[e]&&(u+=""+o[e])}return i.text="WHERE ("+u+")",i},n}(t.Block),t.OrderByBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.orders=[],this._values=[]}return h(e,t),e.prototype.order=function(){var t,e,n;return e=arguments[0],t=arguments[1],n=3<=arguments.length?p.call(arguments,2):[],null==t&&(t=!0),e=this._sanitizeField(e),this._values=n,this.orders.push({field:e,dir:!!t})},e.prototype._buildStr=function(t){var e,n,r,i,o,l,s,u,a,c,p;if(null==t&&(t=!1),0<this.orders.length){for(l=0,o="",c=this.orders,s=0,a=c.length;s<a;s++){if(i=c[s],""!==o&&(o+=", "),n="",t)n=i.field;else for(r=u=0,p=i.field.length;0<=p?u<p:u>p;r=0<=p?++u:--u)e=i.field.charAt(r),n+="?"===e?this._formatValue(this._values[l++]):e;o+=""+n+" "+(i.dir?"ASC":"DESC")}return"ORDER BY "+o}return""},e.prototype.buildStr=function(t){return this._buildStr()},e.prototype.buildParam=function(t){var e=this;return{text:this._buildStr(!0),values:this._values.map(function(t){return e._formatValueAsParam(t)})}},e}(t.Block),t.LimitBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.limits=null}return h(e,t),e.prototype.limit=function(t){return t=this._sanitizeLimitOffset(t),this.limits=t},e.prototype.buildStr=function(t){return this.limits?"LIMIT "+this.limits:""},e}(t.Block),t.JoinBlock=function(e){function n(t){n.__super__.constructor.call(this,t),this.joins=[]}return h(n,e),n.prototype.join=function(t,e,n,r){return null==e&&(e=null),null==n&&(n=null),null==r&&(r="INNER"),t=this._sanitizeTable(t,!0),e&&(e=this._sanitizeTableAlias(e)),n&&(n=this._sanitizeCondition(n)),this.joins.push({type:r,table:t,alias:e,condition:n}),this},n.prototype.left_join=function(t,e,n){return null==e&&(e=null),null==n&&(n=null),this.join(t,e,n,"LEFT")},n.prototype.right_join=function(t,e,n){return null==e&&(e=null),null==n&&(n=null),this.join(t,e,n,"RIGHT")},n.prototype.outer_join=function(t,e,n){return null==e&&(e=null),null==n&&(n=null),this.join(t,e,n,"OUTER")},n.prototype.left_outer_join=function(t,e,n){return null==e&&(e=null),null==n&&(n=null),this.join(t,e,n,"LEFT OUTER")},n.prototype.full_join=function(t,e,n){return null==e&&(e=null),null==n&&(n=null),this.join(t,e,n,"FULL")},n.prototype.buildStr=function(t){var e,n,r,i,o;for(n="",o=this.joins||[],r=0,i=o.length;r<i;r++)e=o[r],""!==n&&(n+=" "),n+=""+e.type+" JOIN ",n+="string"==typeof e.table?e.table:"("+e.table+")",e.alias&&(n+=" "+e.alias),e.condition&&(n+=" ON ("+e.condition+")");return n},n.prototype.buildParam=function(e){var n,r,i,o,l,s,u,a,c,p,f,h,d,_,y;if(s={text:"",values:[]},l=[],i="",0>=this.joins.length)return s;for(_=this.joins,a=0,f=_.length;a<f;a++)n=_[a],"string"==typeof n.table?o={text:""+n.table,values:[]}:n.table instanceof t.QueryBuilder?(n.table.updateOptions({nestedBuilder:!0}),o=n.table.toParam()):(n.updateOptions({nestedBuilder:!0}),o=n.buildParam(e)),n.condition instanceof t.Expression?(r=n.condition.toParam(),o.condition=r.text,o.values=o.values.concat(r.values)):o.condition=n.condition,o.join=n,l.push(o);for(c=0,h=l.length;c<h;c++)for(o=l[c],""!==i&&(i+=" "),i+=""+o.join.type+" JOIN ",i+="string"==typeof o.join.table?o.text:"("+o.text+")",o.join.alias&&(i+=" "+o.join.alias),o.condition&&(i+=" ON ("+o.condition+")"),y=o.values,p=0,d=y.length;p<d;p++)u=y[p],s.values.push(this._formatCustomValue(u));return s.text+=i,s},n}(t.Block),t.UnionBlock=function(e){function n(t){n.__super__.constructor.call(this,t),this.unions=[]}return h(n,e),n.prototype.union=function(t,e){return null==e&&(e="UNION"),t=this._sanitizeTable(t,!0),this.unions.push({type:e,table:t}),this},n.prototype.union_all=function(t){return this.union(t,"UNION ALL")},n.prototype.buildStr=function(t){var e,n,r,i,o;for(n="",o=this.unions||[],r=0,i=o.length;r<i;r++)e=o[r],""!==n&&(n+=" "),n+=""+e.type+" ",n+="string"==typeof e.table?e.table:"("+e.table+")";return n},n.prototype.buildParam=function(e){var n,r,i,o,l,s,u,a,c,p,f,h,d,_;if(o={text:"",values:[]},i=[],l="",0>=this.unions.length)return o;for(d=this.unions||[],u=0,p=d.length;u<p;u++)n=d[u],"string"==typeof n.table?r={text:""+n.table,values:[]}:n.table instanceof t.QueryBuilder?(n.table.updateOptions({nestedBuilder:!0}),r=n.table.toParam()):(n.updateOptions({nestedBuilder:!0}),r=n.buildParam(e)),r.type=n.type,i.push(r);for(a=0,f=i.length;a<f;a++)for(r=i[a],""!==l&&(l+=" "),l+=""+r.type+" ("+r.text+")",_=r.values,c=0,h=_.length;c<h;c++)s=_[c],o.values.push(this._formatCustomValue(s));return o.text+=l,o},n}(t.Block),t.QueryBuilder=function(t){function e(t,n){var r,i,o,l,s,u,a,c,p=this;for(e.__super__.constructor.call(this,t),this.blocks=n||[],a=this.blocks,s=0,u=a.length;s<u;s++){r=a[s],c=r.exposedMethods(),l=function(t,e,n){return p[e]=function(){return n.apply(t,arguments),p}};for(o in c){if(i=c[o],null!=this[o])throw new Error(""+this._getObjectClassName(this)+" already has a builder method called: "+o);l(r,o,i)}}}return h(e,t),e.prototype.registerValueHandler=function(t,n){var r,i,o,l;for(l=this.blocks,i=0,o=l.length;i<o;i++)r=l[i],r.registerValueHandler(t,n);return e.__super__.registerValueHandler.call(this,t,n),this},e.prototype.updateOptions=function(t){var e,n,r,o,l;for(this.options=i({},this.options,t),o=this.blocks,l=[],n=0,r=o.length;n<r;n++)e=o[n],l.push(e.options=i({},e.options,t));return l},e.prototype.toString=function(){var t;return function(){var e,n,r,i;for(r=this.blocks,i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(t.buildStr(this));return i}.call(this).filter(function(t){return 0<t.length}).join(this.options.separator)},e.prototype.toParam=function(t){var e,n,r,o,l,s;return null==t&&(t=void 0),o=this.options,null!=t&&(this.options=i({},this.options,t)),l={text:"",values:[]},n=function(){var t,n,r,i;for(r=this.blocks,i=[],t=0,n=r.length;t<n;t++)e=r[t],i.push(e.buildParam(this));return i}.call(this),l.text=function(){var t,r,i;for(i=[],t=0,r=n.length;t<r;t++)e=n[t],i.push(e.text);return i}().filter(function(t){return 0<t.length}).join(this.options.separator),l.values=(s=[]).concat.apply(s,function(){var t,r,i;for(i=[],t=0,r=n.length;t<r;t++)e=n[t],i.push(e.values);return i}()),null==this.options.nestedBuilder&&(this.options.numberedParameters||null!=(null!=t?t.numberedParametersStartAt:void 0))&&(r=1,null!=this.options.numberedParametersStartAt&&(r=this.options.numberedParametersStartAt),l.text=l.text.replace(/\?/g,function(){return"$"+r++})),this.options=o,l},e.prototype.clone=function(){var t;return new this.constructor(this.options,function(){var e,n,r,i;for(r=this.blocks,i=[],e=0,n=r.length;e<n;e++)t=r[e],i.push(t.clone());return i}.call(this))},e.prototype.isNestable=function(){return!1},e}(t.BaseBuilder),t.Select=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"SELECT"),new t.DistinctBlock(e),new t.GetFieldBlock(e),new t.FromTableBlock(i({},e,{allowNested:!0})),new t.JoinBlock(i({},e,{allowNested:!0})),new t.WhereBlock(e),new t.GroupByBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e),new t.OffsetBlock(e),new t.UnionBlock(i({},e,{allowNested:!0}))]),n.__super__.constructor.call(this,e,r)}return h(n,e),n.prototype.isNestable=function(){return!0},n}(t.QueryBuilder),t.Update=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"UPDATE"),new t.UpdateTableBlock(e),new t.SetFieldBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),t.Delete=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"DELETE"),new t.FromTableBlock(i({},e,{singleTable:!0})),new t.JoinBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),t.Insert=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.InsertFieldValueBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),r={VERSION:"3.9.0",expr:function(){return new t.Expression},select:function(e,n){return new t.Select(e,n)},update:function(e,n){return new t.Update(e,n)},insert:function(e,n){return new t.Insert(e,n)},delete:function(e,n){return new t.Delete(e,n)},registerValueHandler:t.registerValueHandler},r.remove=r.delete,r.cls=t,("undefined"!=typeof define&&null!==define?define.amd:void 0)?define(function(){return r}):("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=r:"undefined"!=typeof window&&null!==window&&(window.squel=r),r.flavours={},r.useFlavour=function(t){if(!(r.flavours[t]instanceof Function))throw new Error("Flavour not available: "+t);return r.flavours[t].call(null,r),r},r.flavours.postgres=function(){return t=r.cls,t.DefaultQueryBuilderOptions.numberedParameters=!0,t.DefaultQueryBuilderOptions.numberedParametersStartAt=1,t.ReturningBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this._str=null}return h(e,t),e.prototype.returning=function(t){return this._str=this._sanitizeField(t)},e.prototype.buildStr=function(){return this._str?"RETURNING "+this._str:""},e}(t.Block),t.Insert=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.InsertFieldValueBlock(e),new t.ReturningBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),t.Update=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"UPDATE"),new t.UpdateTableBlock(e),new t.SetFieldBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e),new t.ReturningBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),t.Delete=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"DELETE"),new t.FromTableBlock(i({},e,{singleTable:!0})),new t.JoinBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e),new t.ReturningBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder)},r.flavours.mysql=function(){var e;return t=r.cls,t.MysqlOnDuplicateKeyUpdateBlock=function(t){function n(){return e=n.__super__.constructor.apply(this,arguments)}return h(n,t),n.prototype.onDupUpdate=function(t,e,n){return this._set(t,e,n)},n.prototype.buildStr=function(){var t,e,n,r,i,o,l;for(r="",n=o=0,l=this.fields.length;0<=l?o<l:o>l;n=0<=l?++o:--o)t=this.fields[n],""!==r&&(r+=", "),i=this.values[0][n],e=this.fieldOptions[0][n],r+="undefined"==typeof i?t:""+t+" = "+this._formatValue(i,e);return""===r?"":"ON DUPLICATE KEY UPDATE "+r},n.prototype.buildParam=function(t){var e,n,r,i,o,l,s;for(r="",i=[],n=l=0,s=this.fields.length;0<=s?l<s:l>s;n=0<=s?++l:--l)e=this.fields[n],""!==r&&(r+=", "),o=this.values[0][n],"undefined"==typeof o?r+=e:(r+=""+e+" = ?",i.push(this._formatValueAsParam(o)));return{text:""===r?"":"ON DUPLICATE KEY UPDATE "+r,values:i}},n}(t.AbstractSetFieldBlock),t.Insert=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.InsertFieldValueBlock(e),new t.MysqlOnDuplicateKeyUpdateBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder)},i=function(){var t,e,n,r,i,o,l;if(t=arguments[0],n=2<=arguments.length?p.call(arguments,1):[])for(o=0,l=n.length;o<l;o++)if(r=n[o])for(e in r)f.call(r,e)&&(i=r[e],t[e]=i);return t},r.flavours.mssql=function(){return t=r.cls,t.DefaultQueryBuilderOptions.replaceSingleQuotes=!0,t.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,r.registerValueHandler(Date,function(t){return""+t.getUTCFullYear()+"-"+(t.getUTCMonth()+1)+"-"+t.getUTCDate()+" "+t.getUTCHours()+":"+t.getUTCMinutes()+":"+t.getUTCSeconds()}),t.MssqlLimitOffsetTopBlock=function(e){function n(t){n.__super__.constructor.call(this,t),this.limits=null,this.offsets=null}var r,i,o,l,s,u,a,c;return h(n,e),s=function(t){return t=this._sanitizeLimitOffset(t),this._parent.limits=t},o=function(t){function e(t){e.__super__.constructor.call(this,t.options),this._parent=t}return h(e,t),e}(t.Block),r=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.limit=s,e.prototype.buildStr=function(t){return this._parent.limits&&this._parent.offsets?"FETCH NEXT "+this._parent.limits+" ROWS ONLY":""},e}(o),l=function(t){function e(){return a=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.top=s,e.prototype.buildStr=function(t){return this._parent.limits&&!this._parent.offsets?"TOP ("+this._parent.limits+")":""},e}(o),i=function(t){function e(){return this.offset=d(this.offset,this),c=e.__super__.constructor.apply(this,arguments)}return h(e,t),e.prototype.offset=function(t){return t=this._sanitizeLimitOffset(t),this._parent.offsets=t},e.prototype.buildStr=function(t){return this._parent.offsets?"OFFSET "+this._parent.offsets+" ROWS":""},e}(o),n.prototype.LIMIT=function(t){return this.constructor(t),new r(this)},n.prototype.TOP=function(t){return this.constructor(t),new l(this)},n.prototype.OFFSET=function(t){return this.constructor(t),new i(this)},n}.call(this,t.Block),t.MssqlUpdateTopBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.limits=null}var n;return h(e,t),n=function(t){return t=this._sanitizeLimitOffset(t),this.limits=t},e.prototype.limit=n,e.prototype.top=n,e.prototype.buildStr=function(t){return this.limits?"TOP ("+this.limits+")":""},e}(t.Block),t.MssqlInsertFieldValueBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this.outputs=[]}return h(e,t),e.prototype.output=function(t){var e,n,r,i;if("string"==typeof t)return this.outputs.push("INSERTED."+this._sanitizeField(t));for(i=[],n=0,r=t.length;n<r;n++)e=t[n],i.push(this.outputs.push("INSERTED."+this._sanitizeField(e)));return i},e.prototype.buildStr=function(t){if(0>=this.fields.length)throw new Error("set() needs to be called");return"("+this.fields.join(", ")+") "+(0!==this.outputs.length?"OUTPUT "+this.outputs.join(", ")+" ":"")+"VALUES ("+this._buildVals().join("), (")+")"},e.prototype.buildParam=function(t){var e,n,r,i,o,l,s;if(0>=this.fields.length)throw new Error("set() needs to be called");for(r="",l=this._buildValParams(),i=l.vals,n=l.params,e=o=0,s=this.fields.length;0<=s?o<s:o>s;e=0<=s?++o:--o)""!==r&&(r+=", "),r+=this.fields[e];return{text:"("+r+") "+(0!==this.outputs.length?"OUTPUT "+this.outputs.join(", ")+" ":"")+"VALUES ("+i.join("), (")+")",
values:n}},e}(t.InsertFieldValueBlock),t.MssqlUpdateOutputBlock=function(t){function e(t){e.__super__.constructor.call(this,t),this._outputs=[]}return h(e,t),e.prototype.outputs=function(t){var e,n,r;r=[];for(n in t)e=t[n],r.push(this.output(n,e));return r},e.prototype.output=function(t,e){return null==e&&(e=null),t=this._sanitizeField(t),e&&(e=this._sanitizeFieldAlias(e)),this._outputs.push({name:"INSERTED."+t,alias:e})},e.prototype.buildStr=function(t){var e,n,r,i,o;if(n="",this._outputs.length>0){for(o=this._outputs,r=0,i=o.length;r<i;r++)e=o[r],""!==n&&(n+=", "),n+=e.name,e.alias&&(n+=" AS "+e.alias);n="OUTPUT "+n}return n},e}(t.Block),t.Select=function(e){function n(e,r){var o;null==r&&(r=null),o=new t.MssqlLimitOffsetTopBlock(e),r||(r=[new t.StringBlock(e,"SELECT"),new t.DistinctBlock(e),o.TOP(e),new t.GetFieldBlock(e),new t.FromTableBlock(i({},e,{allowNested:!0})),new t.JoinBlock(i({},e,{allowNested:!0})),new t.WhereBlock(e),new t.GroupByBlock(e),new t.OrderByBlock(e),o.OFFSET(e),o.LIMIT(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n.prototype.isNestable=function(){return!0},n}(t.QueryBuilder),t.Update=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"UPDATE"),new t.MssqlUpdateTopBlock(e),new t.UpdateTableBlock(e),new t.SetFieldBlock(e),new t.MssqlUpdateOutputBlock(e),new t.WhereBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),t.Delete=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"DELETE"),new t.FromTableBlock(i({},e,{singleTable:!0})),new t.JoinBlock(e),new t.WhereBlock(e),new t.OrderByBlock(e),new t.LimitBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder),t.Insert=function(e){function n(e,r){null==r&&(r=null),r||(r=[new t.StringBlock(e,"INSERT"),new t.IntoTableBlock(e),new t.MssqlInsertFieldValueBlock(e)]),n.__super__.constructor.call(this,e,r)}return h(n,e),n}(t.QueryBuilder)}}).call(this);