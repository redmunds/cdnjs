(function(){var t,i,r,n,e,o,s,h,u,l,p,f,c,a,d,g=function(t,i){return function(){return t.apply(i,arguments)}},y=Object.prototype.hasOwnProperty,b=function(t,i){function r(){this.constructor=t}for(var n in i)y.call(i,n)&&(t[n]=i[n]);return r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype,t};i=function(){function t(){this.toString=g(this.toString,this),this.or=g(this.or,this),this.and=g(this.and,this),this.end=g(this.end,this),this.or_begin=g(this.or_begin,this),this.and_begin=g(this.and_begin,this);var t=this;this.tree={parent:null,nodes:[]},this.current=this.tree,this._begin=function(i){var r;return r={type:i,parent:t.current,nodes:[]},t.current.nodes.push(r),t.current=t.current.nodes[t.current.nodes.length-1],t}}var i;return t.prototype.tree=null,t.prototype.current=null,t.prototype.and_begin=function(){return this._begin("AND")},t.prototype.or_begin=function(){return this._begin("OR")},t.prototype.end=function(){if(!this.current.parent)throw new Error("begin() needs to be called");return this.current=this.current.parent,this},t.prototype.and=function(t){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this.current.nodes.push({type:"AND",expr:t}),this},t.prototype.or=function(t){if(!t||"string"!=typeof t)throw new Error("expr must be a string");return this.current.nodes.push({type:"OR",expr:t}),this},t.prototype.toString=function(){if(null!==this.current.parent)throw new Error("end() needs to be called");return i(this.tree)},i=function(t){var r,n,e,o,s,h;for(e="",h=t.nodes,o=0,s=h.length;o<s;o++)r=h[o],null!=r.expr?n=r.expr:(n=i(r),""!==n&&(n="("+n+")")),""!==n&&(""!==e&&(e+=" "+r.type+" "),e+=n);return e},t}(),h=function(t){var i;if(t&&t.constructor&&t.constructor.toString&&(i=t.constructor.toString().match(/function\s*(\w+)/),i&&2===i.length))return i[1]},l=function(t){var i;if(i=typeof t,"Expression"!==h(t)&&"string"!==i)throw new Error("condition must be a string or Expression instance");return"Expression"===i&&(t=t.toString()),t},c=function(t,i){if("string"!=typeof t)throw new Error(""+i+" must be a string");return t},p=function(t){return c(t,"field name")},a=function(t){return c(t,"table name")},u=function(t){return c(t,"alias")},f=function(t){if(t=parseInt(t),0>t)throw new Error("limit/offset must be >=0");return t},d=function(t){var i;if(i=typeof t,null!==t&&"string"!==i&&"number"!==i&&"boolean"!==i)throw new Error("field value must be a string, number, boolean or null");return t},s=function(t){return null===t?t="NULL":"boolean"==typeof t?t=t?"TRUE":"FALSE":"number"!=typeof t&&(t='"'+t+'"'),t},o=function(){function t(){this.limitString=g(this.limitString,this),this.orderString=g(this.orderString,this),this.whereString=g(this.whereString,this),this.limit=g(this.limit,this),this.order=g(this.order,this),this.where=g(this.where,this),this.wheres=[],this.orders=[]}return t.prototype.wheres=null,t.prototype.orders=null,t.prototype.limits=null,t.prototype.where=function(t){return t=l(t),""!==t&&this.wheres.push(t),this},t.prototype.order=function(t,i){return null==i&&(i=!0),t=p(t),this.orders.push({field:t,dir:i?"ASC":"DESC"}),this},t.prototype.limit=function(t){return t=f(t),this.limits=t,this},t.prototype.whereString=function(){return 0<this.wheres.length?" WHERE ("+this.wheres.join(") AND (")+")":""},t.prototype.orderString=function(){var t,i,r,n,e;if(0<this.orders.length){for(i="",e=this.orders,r=0,n=e.length;r<n;r++)t=e[r],""!==i&&(i+=", "),i+=""+t.field+" "+t.dir;return" ORDER BY "+i}return""},t.prototype.limitString=function(){return this.limits?" LIMIT "+this.limits:""},t}(),n=function(t){function i(){this.toString=g(this.toString,this),this.offset=g(this.offset,this),this.group=g(this.group,this),this.outer_join=g(this.outer_join,this),this.right_join=g(this.right_join,this),this.left_join=g(this.left_join,this),this.join=g(this.join,this),this.field=g(this.field,this),this.from=g(this.from,this),this.distinct=g(this.distinct,this);var t=this;i.__super__.constructor.apply(this,arguments),this.froms=[],this.fields=[],this.joins=[],this.groups=[],this._join=function(i,r,n,e){return r=a(r),n&&(n=u(n)),e&&(e=l(e)),t.joins.push({type:i,table:r,alias:n,condition:e}),t}}return b(i,t),i.prototype.froms=null,i.prototype.fields=null,i.prototype.joins=null,i.prototype.groups=null,i.prototype.offsets=null,i.prototype.useDistinct=!1,i.prototype.distinct=function(){return this.useDistinct=!0,this},i.prototype.from=function(t,i){return null==i&&(i=null),t=a(t),i&&(i=u(i)),this.froms.push({name:t,alias:i}),this},i.prototype.field=function(t,i){return null==i&&(i=null),t=p(t),i&&(i=u(i)),this.fields.push({field:t,alias:i}),this},i.prototype.join=function(t,i,r){return null==i&&(i=null),null==r&&(r=null),this._join("INNER",t,i,r)},i.prototype.left_join=function(t,i,r){return null==i&&(i=null),null==r&&(r=null),this._join("LEFT",t,i,r)},i.prototype.right_join=function(t,i,r){return null==i&&(i=null),null==r&&(r=null),this._join("RIGHT",t,i,r)},i.prototype.outer_join=function(t,i,r){return null==i&&(i=null),null==r&&(r=null),this._join("OUTER",t,i,r)},i.prototype.group=function(t){return t=p(t),this.groups.push(t),this},i.prototype.offset=function(t){return t=f(t),this.offsets=t,this},i.prototype.toString=function(){var t,i,r,n,e,o,s,h,u,l,p,f,c,a,d,g,y,b,w,S,m;if(0>=this.froms.length)throw new Error("from() needs to be called");for(s="SELECT ",this.useDistinct&&(s+="DISTINCT "),r="",b=this.fields,l=0,a=b.length;l<a;l++)i=b[l],""!==r&&(r+=", "),r+=i.field,i.alias&&(r+=' AS "'+i.alias+'"');for(s+=""===r?"*":r,u="",w=this.froms,p=0,d=w.length;p<d;p++)h=w[p],""!==u&&(u+=", "),u+=h.name,h.alias&&(u+=" `"+h.alias+"`");for(s+=" FROM "+u,o="",S=this.joins,f=0,g=S.length;f<g;f++)e=S[f],o+=" "+e.type+" JOIN "+e.table,e.alias&&(o+=" `"+e.alias+"`"),e.condition&&(o+=" ON ("+e.condition+")");if(s+=o,s+=this.whereString(),0<this.groups.length){for(n="",m=this.groups,c=0,y=m.length;c<y;c++)t=m[c],""!==n&&(n+=", "),n+=t;s+=" GROUP BY "+n}return s+=this.orderString(),s+=this.limitString(),this.offsets&&(s+=" OFFSET "+this.offsets),s},i}(o),e=function(t){function i(){this.toString=g(this.toString,this),this.set=g(this.set,this),this.table=g(this.table,this),i.__super__.constructor.apply(this,arguments),this.tables=[],this.fields={}}return b(i,t),i.prototype.tables=null,i.prototype.fields=null,i.prototype.table=function(t,i){return null==i&&(i=null),t=a(t),i&&(i=u(i)),this.tables.push({name:t,alias:i}),this},i.prototype.set=function(t,i){return t=p(t),i=d(i),this.fields[t]=i,this},i.prototype.toString=function(){var t,i,r,n,e,o,h,u,l,p,f;if(0>=this.tables.length)throw new Error("table() needs to be called");if(i=function(){var i,r;i=this.fields,r=[];for(t in i)y.call(i,t)&&r.push(t);return r}.call(this),0>=i.length)throw new Error("set() needs to be called");for(n="UPDATE ",o="",f=this.tables,h=0,l=f.length;h<l;h++)e=f[h],""!==o&&(o+=", "),o+=e.name,e.alias&&(o+=" AS `"+e.alias+"`");for(n+=o,r="",u=0,p=i.length;u<p;u++)t=i[u],""!==r&&(r+=", "),r+=""+t+" = "+s(this.fields[t]);return n+=" SET "+r,n+=this.whereString(),n+=this.orderString(),n+=this.limitString()},i}(o),t=function(t){function i(){this.toString=g(this.toString,this),this.from=g(this.from,this),i.__super__.constructor.apply(this,arguments)}return b(i,t),i.prototype.table=null,i.prototype.from=function(t){return t=a(t),this.table=t,this},i.prototype.toString=function(){var t;if(!this.table)throw new Error("from() needs to be called");return t="DELETE FROM "+this.table,t+=this.whereString(),t+=this.orderString(),t+=this.limitString()},i}(o),r=function(){function t(){this.toString=g(this.toString,this),this.set=g(this.set,this),this.into=g(this.into,this),this.fields={}}return t.prototype.table=null,t.prototype.fields=null,t.prototype.into=function(t){return t=a(t),this.table=t,this},t.prototype.set=function(t,i){return t=p(t),i=d(i),this.fields[t]=i,this},t.prototype.toString=function(){var t,i,r,n,e,o,h;if(!this.table)throw new Error("into() needs to be called");if(i=function(){var t,i;t=this.fields,i=[];for(n in t)y.call(t,n)&&i.push(n);return i}.call(this),0>=i.length)throw new Error("set() needs to be called");for(r="",e="",o=0,h=i.length;o<h;o++)t=i[o],""!==r&&(r+=", "),r+=t,""!==e&&(e+=", "),e+=s(this.fields[t]);return"INSERT INTO "+this.table+" ("+r+") VALUES ("+e+")"},t}(),"undefined"!=typeof module&&null!==module&&(module.exports={expr:function(){return new i},select:function(){return new n},update:function(){return new e},insert:function(){return new r},delete:function(){return new t}})}).call(this);