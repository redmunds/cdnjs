{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js","../src/router.js"],"sourcesContent":["export default function (tag, data) {\n\tdata = data || {}\n\n\tvar children = []\n\tchildren.push.apply(children, arguments)\n\tchildren.shift()\n\tchildren.shift()\n\tvar head = children[0]\n\n\tfor (var name in data) {\n\t\tif (name[0] === \"o\" && name[1] === \"n\") {\n\t\t\tdata[name.toLowerCase()] = data[name]\n\t\t}\n\t}\n\n\tchildren = Array.isArray(head) || head === undefined ? head : children\n\n\tif (typeof tag === \"function\") {\n\t\tdata.children = children || []\n\t\treturn tag(data)\n\t}\n\n\tif (tag === \"svg\") {\n\t\tsvg(tag, data, children)\n\t}\n\n\treturn {\n\t\ttag: tag,\n\t\tdata: data,\n\t\tchildren: [].concat.apply([], children)\n\t}\n}\n\nfunction svg(tag, data, children) {\n\tdata.ns = \"http://www.w3.org/2000/svg\"\n\n\tfor (var i = 0; i < children.length; i++) {\n\t\tvar node = children[i]\n\n\t\tif (node.data) {\n\t\t\tsvg(node.tag, node.data, node.children)\n\t\t}\n\t}\n}\n","export default function (options) {\n\tvar model = options.model\n\tvar view = options.view\n\n\tvar actions = {}\n\tvar effects = options.effects || {}\n\tvar reducers = options.reducers || options.update || {}\n\n\tvar subs = options.subscriptions\n\n\tvar router = options.router || Function.prototype\n\n\tvar node\n\tvar root\n\n\tvar hooks = merge({\n\t\tonAction: Function.prototype,\n\t\tonUpdate: Function.prototype,\n\t\tonError: function (err) {\n\t\t\tthrow err\n\t\t}\n\t}, options.hooks)\n\n\tfor (var name in merge(reducers, effects)) {\n\t\t(function (name) {\n\t\t\tactions[name] = function (data) {\n\t\t\t\thooks.onAction(name, data)\n\n\t\t\t\tvar effect = effects[name]\n\t\t\t\tif (effect) {\n\t\t\t\t\treturn effect(model, actions, data, hooks.onError)\n\t\t\t\t}\n\n\t\t\t\tvar update = reducers[name], _model = model\n\t\t\t\trender(model = merge(model, update(model, data)), view, node)\n\n\t\t\t\thooks.onUpdate(_model, model, data)\n\t\t\t}\n\t\t}(name))\n\t}\n\n\tready(function () {\n\t\troot = options.root || document.body.appendChild(document.createElement(\"div\"))\n\n\t\tif (typeof view === \"function\") {\n\t\t\trender(model, view)\n\t\t}\n\n\t\trouter(function (newView) {\n\t\t\trender(model, view = newView ? newView : view, node)\n\t\t}, options)\n\n\t\tfor (var key in subs) {\n\t\t\tsubs[key](model, actions, hooks.onError)\n\t\t}\n\t})\n\n\tfunction ready(cb) {\n\t\tif (document.readyState !== \"loading\") {\n\t\t\tcb()\n\t\t} else {\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", cb)\n\t\t}\n\t}\n\n\tfunction render(model, view, lastNode) {\n\t\tpatch(root, node = view(model, actions), lastNode, 0)\n\t}\n\n\tfunction merge(a, b) {\n\t\tvar obj = {}, key\n\n\t\tif (isPrimitive(typeof b) || Array.isArray(b)) {\n\t\t\treturn b\n\t\t}\n\n\t\tfor (key in a) {\n\t\t\tobj[key] = a[key]\n\t\t}\n\t\tfor (key in b) {\n\t\t\tobj[key] = b[key]\n\t\t}\n\n\t\treturn obj\n\t}\n\n\tfunction isPrimitive(type) {\n\t\treturn type === \"string\" || type === \"number\" || type === \"boolean\"\n\t}\n\n\tfunction defer(fn, data) {\n\t\tsetTimeout(function () {\n\t\t\tfn(data)\n\t\t}, 0)\n\t}\n\n\tfunction shouldUpdate(a, b) {\n\t\treturn a.tag !== b.tag\n\t\t\t|| typeof a !== typeof b\n\t\t\t|| isPrimitive(typeof a) && a !== b\n\t}\n\n\tfunction createElementFrom(node) {\n\t\tvar element\n\t\tif (isPrimitive(typeof node)) {\n\t\t\telement = document.createTextNode(node)\n\n\t\t} else {\n\t\t\telement = node.data && node.data.ns\n\t\t\t\t? document.createElementNS(node.data.ns, node.tag)\n\t\t\t\t: document.createElement(node.tag)\n\n\t\t\tfor (var name in node.data) {\n\t\t\t\tif (name === \"oncreate\") {\n\t\t\t\t\tdefer(node.data[name], element)\n\t\t\t\t} else {\n\t\t\t\t\tsetElementData(element, name, node.data[name])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < node.children.length; i++) {\n\t\t\t\tvar childNode = node.children[i]\n\n\t\t\t\tif (childNode !== undefined && typeof childNode !== \"boolean\") {\n\t\t\t\t\telement.appendChild(createElementFrom(childNode))\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn element\n\t}\n\n\tfunction removeElementData(element, name, value) {\n\t\telement.removeAttribute(name === \"className\" ? \"class\" : name)\n\n\t\tif (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n\t\t\telement[name] = false\n\t\t}\n\t}\n\n\tfunction setElementData(element, name, value, oldValue) {\n\t\tif (name === \"style\") {\n\t\t\tfor (var i in value) {\n\t\t\t\telement.style[i] = value[i]\n\t\t\t}\n\n\t\t} else if (name[0] === \"o\" && name[1] === \"n\") {\n\t\t\tvar event = name.substr(2)\n\t\t\telement.removeEventListener(event, oldValue)\n\t\t\telement.addEventListener(event, value)\n\n\t\t} else {\n\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\telement.removeAttribute(name)\n\t\t\t\telement[name] = false\n\t\t\t} else {\n\t\t\t\telement.setAttribute(name, value)\n\t\t\t\telement[name] = value\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction updateElementData(element, data, oldData) {\n\t\tfor (var name in merge(oldData, data)) {\n\t\t\tvar value = data[name], oldValue = oldData[name]\n\n\t\t\tif (value === undefined) {\n\t\t\t\tremoveElementData(element, name, oldValue)\n\n\t\t\t} else if (value !== oldValue) {\n\t\t\t\tname === \"onupdate\"\n\t\t\t\t\t? defer(value, element)\n\t\t\t\t\t: setElementData(element, name, value, oldValue)\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction patch(parent, node, oldNode, index) {\n\t\tif (oldNode === undefined) {\n\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t} else if (node === undefined) {\n\t\t\twhile (index > 0 && !parent.childNodes[index]) {\n\t\t\t\tindex--\n\t\t\t}\n\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tif (oldNode && oldNode.data) {\n\t\t\t\tvar hook = oldNode.data.onremove\n\t\t\t\tif (hook) {\n\t\t\t\t\tdefer(hook, element)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparent.removeChild(element)\n\n\t\t} else if (shouldUpdate(node, oldNode)) {\n\t\t\tparent.replaceChild(createElementFrom(node), parent.childNodes[index])\n\n\t\t} else if (node.tag) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tupdateElementData(element, node.data, oldNode.data)\n\n\t\t\tvar len = node.children.length, oldLen = oldNode.children.length\n\n\t\t\tfor (var i = 0; i < len || i < oldLen; i++) {\n\t\t\t\tpatch(element, node.children[i], oldNode.children[i], i)\n\t\t\t}\n\t\t}\n\t}\n}\n","export default function (render, options) {\n    var routes = options.view\n\n    function setLocation(data) {\n        render(match(routes, data))\n        history.pushState({}, \"\", data)\n    }\n\n    window.addEventListener(\"popstate\", function () {\n        render(match(routes, location.pathname))\n    })\n\n    window.addEventListener(\"click\", function (e) {\n        if (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) {\n            return\n        }\n\n        var target = e.target\n\n        while (target && target.localName !== \"a\") {\n            target = target.parentNode\n        }\n\n        if (target && target.host === location.host\n            && !target.hasAttribute(\"data-no-routing\")) {\n\n            var element = document.querySelector(target.hash === \"\" ? element : target.hash)\n\n            if (element) {\n                element.scrollIntoView(true)\n            } else {\n                e.preventDefault()\n                setLocation(target.pathname)\n            }\n        }\n    })\n\n    render(match(routes, location.pathname))\n\n    function match(routes, path) {\n        for (var route in routes) {\n            var re = regexify(route), params = {}, match\n\n            path.replace(new RegExp(re.re, \"g\"), function () {\n                for (var i = 1; i < arguments.length - 2; i++) {\n                    params[re.keys.shift()] = arguments[i]\n                }\n\n                match = function (model, actions) {\n                    actions.setLocation = setLocation\n                    return routes[route](model, actions, params)\n                }\n            })\n\n            if (match) {\n                return match\n            }\n        }\n\n        return routes[\"/\"]\n    }\n\n    function regexify(path) {\n        var keys = [], re = \"^\" + path\n            .replace(/\\//g, \"\\\\/\")\n            .replace(/:([A-Za-z0-9_]+)/g, function (_, key) {\n                keys.push(key)\n                return \"([A-Za-z0-9_]+)\"\n            }) + \"/?$\"\n\n        return { re: re, keys: keys }\n    }\n}\n"],"names":["svg","tag","data","children","ns","i","length","node","push","apply","arguments","shift","head","name","toLowerCase","Array","isArray","undefined","concat","options","ready","cb","document","readyState","addEventListener","render","model","view","lastNode","patch","root","actions","merge","a","b","key","obj","isPrimitive","type","defer","fn","setTimeout","shouldUpdate","createElementFrom","element","createTextNode","createElementNS","createElement","setElementData","childNode","appendChild","removeElementData","value","removeAttribute","oldValue","style","event","substr","removeEventListener","setAttribute","updateElementData","oldData","parent","oldNode","index","childNodes","hook","onremove","removeChild","replaceChild","len","oldLen","effects","reducers","update","subs","subscriptions","router","Function","prototype","hooks","onAction","onUpdate","onError","err","effect","_model","body","newView","setLocation","match","routes","history","pushState","path","route","re","regexify","params","replace","RegExp","keys","_","window","location","pathname","e","metaKey","shiftKey","ctrlKey","altKey","target","localName","parentNode","host","hasAttribute","querySelector","hash","scrollIntoView","preventDefault"],"mappings":"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"}