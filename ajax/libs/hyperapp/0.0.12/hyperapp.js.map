{"version":3,"file":"hyperapp.js","sources":["../h.js","../app.js","../index.js"],"sourcesContent":["module.exports = function (tag, data) {\n  \tvar tree = []\n\ttree.push.apply(tree, arguments)\n\ttree.shift()\n\ttree.shift()\n\tvar head = tree[0]\n\n\ttree = Array.isArray(head) || head === undefined ? head : tree\n\n\tif (tag === \"svg\") {\n\t\tsvg(tag, data, tree)\n\t}\n\n\treturn {\n\t\ttag: tag,\n\t\tdata: data || {},\n\t\ttree: [].concat.apply([], tree)\n\t}\n}\n\nfunction svg(tag, data, tree) {\n\tdata.ns = \"http://www.w3.org/2000/svg\"\n\n\tfor (var i = 0; i < tree.length; i++) {\n\t\tvar node = tree[i]\n\t\tif (node.data) {\n\t\t\tsvg(node.tag, node.data, node.tree)\n\t\t}\n\t}\n}\n\n","module.exports = function (options) {\n\tvar msg = {}\n\n\tvar model = options.model\n\tvar reducers = options.update || {}\n\tvar effects = options.effects || {}\n\tvar subs = options.subs || {}\n\n\tvar hooks = merge({\n\t\tonAction: Function.prototype,\n\t\tonUpdate: Function.prototype,\n\t\tonError: function (err) {\n\t\t\tthrow err\n\t\t}\n\t}, options.hooks)\n\n\tvar node\n\tvar root = options.root || document.body.appendChild(document.createElement(\"div\"))\n\tvar view = options.view || function () {\n\t\treturn root\n\t}\n\tvar routes = typeof view === \"function\" ? undefined : view\n\n\tif (routes) {\n\t\tview = route(routes, location.pathname)\n\n\t\tmsg.setLocation = function (data) {\n\t\t\trender(model, view = route(routes, data), node)\n\t\t\thistory.pushState({}, \"\", data)\n\t\t}\n\n\t\twindow.addEventListener(\"popstate\", function () {\n\t\t\trender(model, view = route(routes, location.pathname), node)\n\t\t})\n\n\t\twindow.onclick = function (e) {\n\t\t\tif (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tvar target = e.target\n\n\t\t\twhile (target && target.localName !== \"a\") {\n\t\t\t\ttarget = target.parentNode\n\t\t\t}\n\n\t\t\tif (target && target.host === location.host\n\t\t\t\t&& !target.hasAttribute(\"data-no-routing\")) {\n\n\t\t\t\tvar element = target.hash === \"\" ? element : document.querySelector(target.hash)\n\t\t\t\tif (element) {\n\t\t\t\t\telement.scrollIntoView(true)\n\n\t\t\t\t} else {\n\t\t\t\t\tmsg.setLocation(target.pathname)\n\t\t\t\t\te.preventDefault()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (var name in merge(reducers, effects)) {\n\t\t(function (name) {\n\t\t\tmsg[name] = function (data) {\n\t\t\t\thooks.onAction(name, data)\n\n\t\t\t\tvar effect = effects[name]\n\t\t\t\tif (effect) {\n\t\t\t\t\treturn effect(model, msg, data, hooks.onError)\n\t\t\t\t}\n\n\t\t\t\tvar update = reducers[name], _model = model\n\t\t\t\trender(model = merge(model, update(model, data)), view, node)\n\n\t\t\t\thooks.onUpdate(_model, model, data)\n\t\t\t}\n\t\t} (name))\n\t}\n\n\tdocument.addEventListener(\"DOMContentLoaded\", function () {\n\t\tfor (var sub in subs) {\n\t\t\tsubs[sub](model, msg, hooks.onError)\n\t\t}\n\t})\n\n\trender(model, view)\n\n\tfunction render(model, view, lastNode) {\n\t\tpatch(root, node = view(model, msg), lastNode, 0)\n\t}\n\n\tfunction route(routes, path) {\n\t\tfor (var route in routes) {\n\t\t\tvar re = regexify(route), params = {}, match\n\n\t\t\tpath.replace(new RegExp(re.re, \"g\"), function () {\n\t\t\t\tfor (var i = 1; i < arguments.length - 2; i++) {\n\t\t\t\t\tparams[re.keys.shift()] = arguments[i]\n\t\t\t\t}\n\n\t\t\t\tmatch = function (model, msg) {\n\t\t\t\t\treturn routes[route](model, msg, params)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tif (match) {\n\t\t\t\treturn match\n\t\t\t}\n\t\t}\n\n\t\treturn routes[\"/\"]\n\t}\n\n\tfunction regexify(path) {\n\t\tvar keys = [], re = \"^\" + path\n\t\t\t.replace(/\\//g, \"\\\\/\")\n\t\t\t.replace(/:([A-Za-z0-9_]+)/g, function (_, key) {\n\t\t\t\tkeys.push(key)\n\t\t\t\treturn \"([A-Za-z0-9_]+)\"\n\t\t\t}) + \"/?$\"\n\n\t\treturn { re: re, keys: keys }\n\t}\n\n\tfunction isPrimitive(type) {\n\t\treturn type === \"string\" || type === \"number\" || type === \"boolean\"\n\t}\n\n\tfunction defer(fn, data) {\n\t\tsetTimeout(function () {\n\t\t\tfn(data)\n\t\t}, 0)\n\t}\n\n\tfunction merge(a, b) {\n\t\tvar obj = {}, key\n\n\t\tif (isPrimitive(typeof b) || Array.isArray(b)) {\n\t\t\treturn b\n\t\t}\n\n\t\tfor (key in a) {\n\t\t\tobj[key] = a[key]\n\t\t}\n\t\tfor (key in b) {\n\t\t\tobj[key] = b[key]\n\t\t}\n\n\t\treturn obj\n\t}\n\n\tfunction shouldUpdate(a, b) {\n\t\treturn a.tag !== b.tag\n\t\t\t|| typeof a !== typeof b\n\t\t\t|| isPrimitive(typeof a) && a !== b\n\t}\n\n\tfunction createElementFrom(node) {\n\t\tvar element\n\t\tif (isPrimitive(typeof node)) {\n\t\t\telement = document.createTextNode(node)\n\n\t\t} else {\n\t\t\telement = node.data && node.data.ns\n\t\t\t\t? document.createElementNS(node.data.ns, node.tag)\n\t\t\t\t: document.createElement(node.tag)\n\n\t\t\tfor (var name in node.data) {\n\t\t\t\tif (name === \"oncreate\") {\n\t\t\t\t\tdefer(node.data[name], element)\n\t\t\t\t} else {\n\t\t\t\t\tsetElementData(element, name, node.data[name])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < node.tree.length; i++) {\n\t\t\t\telement.appendChild(createElementFrom(node.tree[i]))\n\t\t\t}\n\t\t}\n\n\t\treturn element\n\t}\n\n\tfunction removeElementData(element, name, value) {\n\t\telement.removeAttribute(name === \"className\" ? \"class\" : name)\n\n\t\tif (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n\t\t\telement[name] = false\n\t\t}\n\t}\n\n\tfunction setElementData(element, name, value, oldValue) {\n\t\tif (name === \"style\") {\n\t\t\tfor (var i in value) {\n\t\t\t\telement.style[i] = value[i]\n\t\t\t}\n\n\t\t} else if (name.substr(0, 2) === \"on\") {\n\t\t\tvar event = name.substr(2)\n\t\t\telement.removeEventListener(event, oldValue)\n\t\t\telement.addEventListener(event, value)\n\n\t\t} else {\n\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\telement.removeAttribute(name)\n\t\t\t\telement[name] = false\n\t\t\t} else {\n\t\t\t\telement.setAttribute(name, value)\n\t\t\t\telement[name] = value\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction updateElementData(element, data, oldData) {\n\t\tfor (var name in merge(oldData, data)) {\n\t\t\tvar value = data[name], oldValue = oldData[name]\n\n\t\t\tif (value === undefined) {\n\t\t\t\tremoveElementData(element, name, oldValue)\n\n\t\t\t} else if (value !== oldValue) {\n\t\t\t\tname === \"onupdate\"\n\t\t\t\t\t? defer(value, element)\n\t\t\t\t\t: setElementData(element, name, value, oldValue)\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction patch(parent, node, oldNode, index) {\n\t\tif (oldNode === undefined) {\n\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t} else if (node === undefined) {\n\t\t\twhile (index > 0 && !parent.childNodes[index]) {\n\t\t\t\tindex--\n\t\t\t}\n\n\t\t\tif (index >= 0) {\n\t\t\t\tvar element = parent.childNodes[index]\n\n\t\t\t\tif (oldNode && oldNode.data) {\n\t\t\t\t\tvar hook = oldNode.data.onremove\n\t\t\t\t\tif (hook) {\n\t\t\t\t\t\tdefer(hook, element)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tparent.removeChild(element)\n\t\t\t}\n\n\t\t} else if (shouldUpdate(node, oldNode)) {\n\t\t\tparent.replaceChild(createElementFrom(node), parent.childNodes[index])\n\n\t\t} else if (node.tag) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tupdateElementData(element, node.data, oldNode.data)\n\n\t\t\tvar len = node.tree.length, oldLen = oldNode.tree.length\n\n\t\t\tfor (var i = 0; i < len || i < oldLen; i++) {\n\t\t\t\tpatch(element, node.tree[i], oldNode.tree[i], i)\n\t\t\t}\n\t\t}\n\t}\n}","module.exports = {\n    app: require(\"./app\"),\n    h: require(\"./h\")\n}"],"names":["svg","tag","data","tree","ns","i","length","node","options","render","model","view","lastNode","patch","root","msg","route","routes","path","match","re","regexify","params","replace","RegExp","arguments","keys","shift","_","key","push","isPrimitive","type","defer","fn","setTimeout","merge","a","b","obj","Array","isArray","shouldUpdate","createElementFrom","element","document","createTextNode","createElementNS","createElement","name","setElementData","appendChild","removeElementData","value","removeAttribute","oldValue","style","substr","event","removeEventListener","addEventListener","setAttribute","updateElementData","oldData","undefined","parent","oldNode","index","childNodes","hook","onremove","removeChild","replaceChild","len","oldLen","reducers","update","effects","subs","hooks","onAction","Function","prototype","onUpdate","onError","err","body","location","pathname","setLocation","history","pushState","window","onclick","e","metaKey","shiftKey","ctrlKey","altKey","target","localName","parentNode","host","hasAttribute","hash","querySelector","scrollIntoView","preventDefault","effect","_model","sub","apply","head","concat","app","require$$0","h","require$$1"],"mappings":"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"}