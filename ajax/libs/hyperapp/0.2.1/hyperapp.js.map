{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js","../src/index.js"],"sourcesContent":["module.exports = function (tag, data) {\n\tdata = data || {}\n\n\tvar children = []\n\tchildren.push.apply(children, arguments)\n\tchildren.shift()\n\tchildren.shift()\n\tvar head = children[0]\n\n\tchildren = Array.isArray(head) || head === undefined ? head : children\n\n\tif (typeof tag === \"function\") {\n\t\tdata.children = children || []\n\t\treturn tag(data)\n\t}\n\n\tif (tag === \"svg\") {\n\t\tsvg(tag, data, children)\n\t}\n\n\treturn {\n\t\ttag: tag,\n\t\tdata: data,\n\t\tchildren: [].concat.apply([], children)\n\t}\n}\n\nfunction svg(tag, data, children) {\n\tdata.ns = \"http://www.w3.org/2000/svg\"\n\n\tfor (var i = 0; i < children.length; i++) {\n\t\tvar node = children[i]\n\t\tif (node.data) {\n\t\t\tsvg(node.tag, node.data, node.children)\n\t\t}\n\t}\n}\n","module.exports = function (options) {\n\tvar model = options.model\n\tvar view = options.view\n\n\tvar actions = {}\n\tvar effects = options.effects || {}\n\tvar reducers = options.update || {}\n\n\tvar subs = options.subscriptions\n\n\tvar router = options.router || Function.prototype\n\n\tvar node\n\tvar root\n\n\tvar hooks = merge({\n\t\t// onRoute?\n\t\tonAction: Function.prototype,\n\t\tonUpdate: Function.prototype,\n\t\tonError: function (err) {\n\t\t\tthrow err\n\t\t}\n\t}, options.hooks)\n\n\tfor (var name in merge(reducers, effects)) {\n\t\t(function (name) {\n\t\t\tactions[name] = function (data) {\n\t\t\t\thooks.onAction(name, data)\n\n\t\t\t\tvar effect = effects[name]\n\t\t\t\tif (effect) {\n\t\t\t\t\treturn effect(model, actions, data, hooks.onError)\n\t\t\t\t}\n\n\t\t\t\tvar update = reducers[name], _model = model\n\t\t\t\trender(model = merge(model, update(model, data)), view, node)\n\n\t\t\t\thooks.onUpdate(_model, model, data)\n\t\t\t}\n\t\t}(name))\n\t}\n\n\tready(function () {\n\t\troot = options.root || document.body.appendChild(document.createElement(\"div\"))\n\n\t\tif (typeof view === \"function\") {\n\t\t\trender(model, view)\n\t\t}\n\n\t\trouter(merge(options, {\n\t\t\trender: function (newView) {\n\t\t\t\trender(model, view = newView ? newView : view, node)\n\t\t\t}\n\t\t}))\n\n\t\tfor (var key in subs) {\n\t\t\tsubs[key](model, actions, hooks.onError)\n\t\t}\n\t})\n\n\tfunction ready(cb) {\n\t\tif (document.readyState !== \"loading\") {\n\t\t\tcb()\n\t\t} else {\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", cb)\n\t\t}\n\t}\n\n\tfunction render(model, view, lastNode) {\n\t\tpatch(root, node = view(model, actions), lastNode, 0)\n\t}\n\n\tfunction merge(a, b) {\n\t\tvar obj = {}, key\n\n\t\tif (isPrimitive(typeof b) || Array.isArray(b)) {\n\t\t\treturn b\n\t\t}\n\n\t\tfor (key in a) {\n\t\t\tobj[key] = a[key]\n\t\t}\n\t\tfor (key in b) {\n\t\t\tobj[key] = b[key]\n\t\t}\n\n\t\treturn obj\n\t}\n\n\tfunction isPrimitive(type) {\n\t\treturn type === \"string\" || type === \"number\" || type === \"boolean\"\n\t}\n\n\tfunction defer(fn, data) {\n\t\tsetTimeout(function () {\n\t\t\tfn(data)\n\t\t}, 0)\n\t}\n\n\tfunction shouldUpdate(a, b) {\n\t\treturn a.tag !== b.tag\n\t\t\t|| typeof a !== typeof b\n\t\t\t|| isPrimitive(typeof a) && a !== b\n\t}\n\n\tfunction createElementFrom(node) {\n\t\tvar element\n\t\tif (isPrimitive(typeof node)) {\n\t\t\telement = document.createTextNode(node)\n\n\t\t} else {\n\t\t\telement = node.data && node.data.ns\n\t\t\t\t? document.createElementNS(node.data.ns, node.tag)\n\t\t\t\t: document.createElement(node.tag)\n\n\t\t\tfor (var name in node.data) {\n\t\t\t\tif (name === \"oncreate\") {\n\t\t\t\t\tdefer(node.data[name], element)\n\t\t\t\t} else {\n\t\t\t\t\tsetElementData(element, name, node.data[name])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < node.children.length; i++) {\n\t\t\t\telement.appendChild(createElementFrom(node.children[i]))\n\t\t\t}\n\t\t}\n\n\t\treturn element\n\t}\n\n\tfunction removeElementData(element, name, value) {\n\t\telement.removeAttribute(name === \"className\" ? \"class\" : name)\n\n\t\tif (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n\t\t\telement[name] = false\n\t\t}\n\t}\n\n\tfunction setElementData(element, name, value, oldValue) {\n\t\tif (name === \"style\") {\n\t\t\tfor (var i in value) {\n\t\t\t\telement.style[i] = value[i]\n\t\t\t}\n\n\t\t} else if (name.substr(0, 2) === \"on\") {\n\t\t\tvar event = name.substr(2).toLowerCase()\n\t\t\telement.removeEventListener(event, oldValue)\n\t\t\telement.addEventListener(event, value)\n\n\t\t} else {\n\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\telement.removeAttribute(name)\n\t\t\t\telement[name] = false\n\t\t\t} else {\n\t\t\t\telement.setAttribute(name, value)\n\t\t\t\telement[name] = value\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction updateElementData(element, data, oldData) {\n\t\tfor (var name in merge(oldData, data)) {\n\t\t\tvar value = data[name], oldValue = oldData[name]\n\n\t\t\tif (value === undefined) {\n\t\t\t\tremoveElementData(element, name, oldValue)\n\n\t\t\t} else if (value !== oldValue) {\n\t\t\t\tname === \"onupdate\"\n\t\t\t\t\t? defer(value, element)\n\t\t\t\t\t: setElementData(element, name, value, oldValue)\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction patch(parent, node, oldNode, index) {\n\t\tif (oldNode === undefined) {\n\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t} else if (node === undefined) {\n\t\t\twhile (index > 0 && !parent.childNodes[index]) {\n\t\t\t\tindex--\n\t\t\t}\n\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tif (oldNode && oldNode.data) {\n\t\t\t\tvar hook = oldNode.data.onremove\n\t\t\t\tif (hook) {\n\t\t\t\t\tdefer(hook, element)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparent.removeChild(element)\n\n\t\t} else if (shouldUpdate(node, oldNode)) {\n\t\t\tparent.replaceChild(createElementFrom(node), parent.childNodes[index])\n\n\t\t} else if (node.tag) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tupdateElementData(element, node.data, oldNode.data)\n\n\t\t\tvar len = node.children.length, oldLen = oldNode.children.length\n\n\t\t\tfor (var i = 0; i < len || i < oldLen; i++) {\n\t\t\t\tpatch(element, node.children[i], oldNode.children[i], i)\n\t\t\t}\n\t\t}\n\t}\n}\n","module.exports = {\n    // router: require(\"./router\"),\n    app: require(\"./app\"),\n    h: require(\"./h\")\n}\n"],"names":["svg","tag","data","children","ns","i","length","node","options","ready","cb","document","readyState","addEventListener","render","model","view","lastNode","patch","root","actions","merge","a","b","key","obj","isPrimitive","Array","isArray","type","defer","fn","setTimeout","shouldUpdate","createElementFrom","element","createTextNode","createElementNS","createElement","name","setElementData","appendChild","removeElementData","value","removeAttribute","oldValue","style","substr","event","toLowerCase","removeEventListener","setAttribute","updateElementData","oldData","undefined","parent","oldNode","index","childNodes","hook","onremove","removeChild","replaceChild","len","oldLen","effects","reducers","update","subs","subscriptions","router","Function","prototype","hooks","onAction","onUpdate","onError","err","effect","_model","body","newView","push","apply","arguments","shift","head","concat","app","require$$0","h","require$$1"],"mappings":"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"}