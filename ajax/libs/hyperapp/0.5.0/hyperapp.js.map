{"version":3,"file":"hyperapp.js","sources":["../src/h.js","../src/app.js","../src/router.js"],"sourcesContent":["export default function(tag, data) {\n    data = data || {}\n\n    var children = []\n    children.push.apply(children, arguments)\n    children.shift()\n    children.shift()\n    // var children = children.push.apply(children, arguments).splice(2)\n    var head = children[0]\n\n    children = Array.isArray(head) || head === undefined ? head : children\n\n    if (typeof tag === \"function\") {\n        return tag(data, children || [])\n    }\n\n    if (tag === \"svg\") {\n        svg(tag, data, children)\n    }\n\n    return {\n        tag: tag,\n        data: data,\n        children: [].concat.apply([], children)\n    }\n}\n\nfunction svg(tag, data, children) {\n    data.ns = \"http://www.w3.org/2000/svg\"\n\n    for (var i = 0; i < children.length; i++) {\n        var node = children[i]\n\n        if (node.data) {\n            svg(node.tag, node.data, node.children)\n        }\n    }\n}\n","export default function (options) {\n\tvar model = options.model\n\tvar view = options.view\n\n\tvar actions = {}\n\tvar effects = options.effects || {}\n\tvar reducers = options.reducers || options.update || {}\n\n\tvar subs = options.subscriptions\n\n\tvar router = options.router || Function.prototype\n\n\tvar node\n\tvar root\n\n\tvar hooks = merge({\n\t\tonAction: Function.prototype,\n\t\tonUpdate: Function.prototype,\n\t\tonError: function (err) {\n\t\t\tthrow err\n\t\t}\n\t}, options.hooks)\n\n\tfor (var name in merge(reducers, effects)) {\n\t\t(function (name) {\n\t\t\tactions[name] = function (data) {\n\t\t\t\thooks.onAction(name, data)\n\n\t\t\t\tvar effect = effects[name]\n\t\t\t\tif (effect) {\n\t\t\t\t\treturn effect(model, actions, data, hooks.onError)\n\t\t\t\t}\n\n\t\t\t\tvar update = reducers[name], _model = model\n\t\t\t\trender(model = merge(model, update(model, data)), view, node)\n\n\t\t\t\thooks.onUpdate(_model, model, data)\n\t\t\t}\n\t\t}(name))\n\t}\n\n\tready(function () {\n\t\troot = options.root || document.body.appendChild(document.createElement(\"div\"))\n\n\t\tif (typeof view === \"function\") {\n\t\t\trender(model, view)\n\t\t}\n\n\t\trouter(function (newView) {\n\t\t\trender(model, view = newView ? newView : view, node)\n\t\t}, options)\n\n\t\tfor (var key in subs) {\n\t\t\tsubs[key](model, actions, hooks.onError)\n\t\t}\n\t})\n\n\tfunction ready(cb) {\n\t\tif (document.readyState !== \"loading\") {\n\t\t\tcb()\n\t\t} else {\n\t\t\tdocument.addEventListener(\"DOMContentLoaded\", cb)\n\t\t}\n\t}\n\n\tfunction render(model, view, lastNode) {\n\t\tpatch(root, node = view(model, actions), lastNode, 0)\n\t}\n\n\tfunction merge(a, b) {\n\t\tvar obj = {}, key\n\n\t\tif (isPrimitive(typeof b) || Array.isArray(b)) {\n\t\t\treturn b\n\t\t}\n\n\t\tfor (key in a) {\n\t\t\tobj[key] = a[key]\n\t\t}\n\t\tfor (key in b) {\n\t\t\tobj[key] = b[key]\n\t\t}\n\n\t\treturn obj\n\t}\n\n\tfunction isPrimitive(type) {\n\t\treturn type === \"string\" || type === \"number\" || type === \"boolean\"\n\t}\n\n\tfunction defer(fn, data) {\n\t\tsetTimeout(function () {\n\t\t\tfn(data)\n\t\t}, 0)\n\t}\n\n\tfunction shouldUpdate(a, b) {\n\t\treturn a.tag !== b.tag\n\t\t\t|| typeof a !== typeof b\n\t\t\t|| isPrimitive(typeof a) && a !== b\n\t}\n\n\tfunction createElementFrom(node) {\n\t\tvar element\n\t\tif (isPrimitive(typeof node)) {\n\t\t\telement = document.createTextNode(node)\n\n\t\t} else {\n\t\t\telement = node.data && node.data.ns\n\t\t\t\t? document.createElementNS(node.data.ns, node.tag)\n\t\t\t\t: document.createElement(node.tag)\n\n\t\t\tfor (var name in node.data) {\n\t\t\t\tif (name === \"oncreate\") {\n\t\t\t\t\tdefer(node.data[name], element)\n\t\t\t\t} else {\n\t\t\t\t\tsetElementData(element, name, node.data[name])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < node.children.length; i++) {\n\t\t\t\tvar childNode = node.children[i]\n\n\t\t\t\tif (childNode !== undefined && typeof childNode !== \"boolean\" && childNode !== null) {\n\t\t\t\t\telement.appendChild(createElementFrom(childNode))\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn element\n\t}\n\n\tfunction removeElementData(element, name, value) {\n\t\telement.removeAttribute(name === \"className\" ? \"class\" : name)\n\n\t\tif (typeof value === \"boolean\" || value === \"true\" || value === \"false\") {\n\t\t\telement[name] = false\n\t\t}\n\t}\n\n\tfunction setElementData(element, name, value, oldValue) {\n\t\tif (name === \"style\") {\n\t\t\tfor (var i in value) {\n\t\t\t\telement.style[i] = value[i]\n\t\t\t}\n\n\t\t} else if (name[0] === \"o\" && name[1] === \"n\") {\n\t\t\tvar event = name.substr(2)\n\t\t\telement.removeEventListener(event, oldValue)\n\t\t\telement.addEventListener(event, value)\n\n\t\t} else {\n\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\telement.removeAttribute(name)\n\t\t\t\telement[name] = false\n\t\t\t} else {\n\t\t\t\telement.setAttribute(name, value)\n\t\t\t\tif (element.namespaceURI !== \"http://www.w3.org/2000/svg\") {\n\t\t\t\t\telement[name] = value\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction updateElementData(element, data, oldData) {\n\t\tfor (var name in merge(oldData, data)) {\n\t\t\tvar value = data[name]\n\t\t\tvar oldValue = oldData[name]\n\t\t\tvar realValue = element[name]\n\n\t\t\tif (value === undefined) {\n\t\t\t\tremoveElementData(element, name, oldValue)\n\n\t\t\t} else if (name === \"onupdate\") {\n\t\t\t\tdefer(value, element)\n\n\t\t\t} else if (value !== oldValue\n\t\t\t\t|| typeof realValue === \"boolean\" && realValue !== value) {\n\t\t\t\tsetElementData(element, name, value, oldValue)\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction patch(parent, node, oldNode, index) {\n\t\tif (node === null) {\n\t\t\treturn\n\t\t}\n\n\t\tif (oldNode === undefined) {\n\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t} else if (node === undefined) {\n\t\t\twhile (index > 0 && !parent.childNodes[index]) {\n\t\t\t\tindex--\n\t\t\t}\n\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tif (oldNode && oldNode.data) {\n\t\t\t\tvar hook = oldNode.data.onremove\n\t\t\t\tif (hook) {\n\t\t\t\t\tdefer(hook, element)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tparent.removeChild(element)\n\n\t\t} else if (shouldUpdate(node, oldNode)) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tif (typeof node === \"boolean\") {\n\t\t\t\tparent.removeChild(element)\n\n\t\t\t} else if (element === undefined) {\n\t\t\t\tparent.appendChild(createElementFrom(node))\n\n\t\t\t} else {\n\t\t\t\tparent.replaceChild(createElementFrom(node), element)\n\t\t\t}\n\t\t} else if (node.tag) {\n\t\t\tvar element = parent.childNodes[index]\n\n\t\t\tupdateElementData(element, node.data, oldNode.data)\n\n\t\t\tvar len = node.children.length, oldLen = oldNode.children.length\n\n\t\t\tfor (var i = 0; i < len || i < oldLen; i++) {\n\t\t\t\tpatch(element, node.children[i], oldNode.children[i], i)\n\t\t\t}\n\t\t}\n\t}\n}\n","export default function (render, options) {\n    var routes = options.view\n\n    function setLocation(data) {\n        render(match(routes, data))\n        history.pushState({}, \"\", data)\n    }\n\n    window.addEventListener(\"popstate\", function () {\n        render(match(routes, location.pathname))\n    })\n\n    window.addEventListener(\"click\", function (e) {\n        if (e.metaKey || e.shiftKey || e.ctrlKey || e.altKey) {\n            return\n        }\n\n        var target = e.target\n\n        while (target && target.localName !== \"a\") {\n            target = target.parentNode\n        }\n\n        if (target && target.host === location.host\n            && !target.hasAttribute(\"data-no-routing\")) {\n\n            var element = document.querySelector(target.hash === \"\" ? element : target.hash)\n\n            if (element) {\n                element.scrollIntoView(true)\n            } else {\n                e.preventDefault()\n                setLocation(target.pathname)\n            }\n        }\n    })\n\n    render(match(routes, location.pathname))\n\n    function match(routes, path) {\n        for (var route in routes) {\n            var re = regexify(route), params = {}, match\n\n            path.replace(new RegExp(re.re, \"g\"), function () {\n                for (var i = 1; i < arguments.length - 2; i++) {\n                    params[re.keys.shift()] = arguments[i]\n                }\n\n                match = function (model, actions) {\n                    actions.setLocation = setLocation\n                    return routes[route](model, actions, params)\n                }\n            })\n\n            if (match) {\n                return match\n            }\n        }\n\n        return routes[\"/\"]\n    }\n\n    function regexify(path) {\n        var keys = [], re = \"^\" + path\n            .replace(/\\//g, \"\\\\/\")\n            .replace(/:([A-Za-z0-9_]+)/g, function (_, key) {\n                keys.push(key)\n                return \"([A-Za-z0-9_]+)\"\n            }) + \"/?$\"\n\n        return { re: re, keys: keys }\n    }\n}\n"],"names":["svg","tag","data","children","ns","i","length","node","push","apply","arguments","shift","head","Array","isArray","undefined","concat","options","ready","cb","document","readyState","addEventListener","render","model","view","lastNode","patch","root","actions","merge","a","b","key","obj","isPrimitive","type","defer","fn","setTimeout","shouldUpdate","createElementFrom","element","createTextNode","createElementNS","createElement","name","setElementData","childNode","appendChild","removeElementData","value","removeAttribute","oldValue","style","event","substr","removeEventListener","setAttribute","namespaceURI","updateElementData","oldData","realValue","parent","oldNode","index","childNodes","hook","onremove","removeChild","replaceChild","len","oldLen","effects","reducers","update","subs","subscriptions","router","Function","prototype","hooks","onAction","onUpdate","onError","err","effect","_model","body","newView","setLocation","match","routes","history","pushState","path","route","re","regexify","params","replace","RegExp","keys","_","window","location","pathname","e","metaKey","shiftKey","ctrlKey","altKey","target","localName","parentNode","host","hasAttribute","querySelector","hash","scrollIntoView","preventDefault"],"mappings":"sMA2BA,SAASA,GAAIC,EAAKC,EAAMC,GACpBD,EAAKE,GAAK,4BAEV,KAAK,GAAIC,GAAI,EAAGA,EAAIF,EAASG,OAAQD,IAAK,CACtC,GAAIE,GAAOJ,EAASE,EAEhBE,GAAKL,MACLF,EAAIO,EAAKN,IAAKM,EAAKL,KAAMK,EAAKJ,WAlC1C,MAAe,SAASF,EAAKC,GACzBA,EAAOA,KAEP,IAAIC,KACJA,GAASK,KAAKC,MAAMN,EAAUO,WAC9BP,EAASQ,QACTR,EAASQ,OAET,IAAIC,GAAOT,EAAS,EAIpB,OAFAA,GAAWU,MAAMC,QAAQF,IAAkBG,SAATH,EAAqBA,EAAOT,EAE3C,kBAARF,GACAA,EAAIC,EAAMC,QAGT,QAARF,GACAD,EAAIC,EAAKC,EAAMC,IAIfF,IAAKA,EACLC,KAAMA,EACNC,YAAaa,OAAOP,SAAUN,QCvBvB,SAAUc,GAyDxB,QAASC,GAAMC,GACc,YAAxBC,SAASC,WACZF,IAEAC,SAASE,iBAAiB,mBAAoBH,GAIhD,QAASI,GAAOC,EAAOC,EAAMC,GAC5BC,EAAMC,EAAMrB,EAAOkB,EAAKD,EAAOK,GAAUH,EAAU,GAGpD,QAASI,GAAMC,EAAGC,GACjB,GAAcC,GAAVC,IAEJ,IAAIC,QAAmBH,KAAMnB,MAAMC,QAAQkB,GAC1C,MAAOA,EAGR,KAAKC,IAAOF,GACXG,EAAID,GAAOF,EAAEE,EAEd,KAAKA,IAAOD,GACXE,EAAID,GAAOD,EAAEC,EAGd,OAAOC,GAGR,QAASC,GAAYC,GACpB,MAAgB,WAATA,GAA8B,WAATA,GAA8B,YAATA,EAGlD,QAASC,GAAMC,EAAIpC,GAClBqC,WAAW,WACVD,EAAGpC,IACD,GAGJ,QAASsC,GAAaT,EAAGC,GACxB,MAAOD,GAAE9B,MAAQ+B,EAAE/B,WACR8B,UAAaC,IACpBG,QAAmBJ,KAAMA,IAAMC,EAGpC,QAASS,GAAkBlC,GAC1B,GAAImC,EACJ,IAAIP,QAAmB5B,IACtBmC,EAAUtB,SAASuB,eAAepC,OAE5B,CACNmC,EAAUnC,EAAKL,MAAQK,EAAKL,KAAKE,GAC9BgB,SAASwB,gBAAgBrC,EAAKL,KAAKE,GAAIG,EAAKN,KAC5CmB,SAASyB,cAActC,EAAKN,IAE/B,KAAK,GAAI6C,KAAQvC,GAAKL,KACR,aAAT4C,EACHT,EAAM9B,EAAKL,KAAK4C,GAAOJ,GAEvBK,EAAeL,EAASI,EAAMvC,EAAKL,KAAK4C,GAI1C,KAAK,GAAIzC,GAAI,EAAGA,EAAIE,EAAKJ,SAASG,OAAQD,IAAK,CAC9C,GAAI2C,GAAYzC,EAAKJ,SAASE,EAEZU,UAAdiC,GAAgD,iBAAdA,IAAyC,OAAdA,GAChEN,EAAQO,YAAYR,EAAkBO,KAKzC,MAAON,GAGR,QAASQ,GAAkBR,EAASI,EAAMK,GACzCT,EAAQU,gBAAyB,cAATN,EAAuB,QAAUA,GAEpC,iBAAVK,IAAiC,SAAVA,GAA8B,UAAVA,IACrDT,EAAQI,IAAQ,GAIlB,QAASC,GAAeL,EAASI,EAAMK,EAAOE,GAC7C,GAAa,UAATP,EACH,IAAK,GAAIzC,KAAK8C,GACbT,EAAQY,MAAMjD,GAAK8C,EAAM9C,OAGpB,IAAgB,MAAZyC,EAAK,IAA0B,MAAZA,EAAK,GAAY,CAC9C,GAAIS,GAAQT,EAAKU,OAAO,EACxBd,GAAQe,oBAAoBF,EAAOF,GACnCX,EAAQpB,iBAAiBiC,EAAOJ,OAGlB,UAAVA,GAAqBA,KAAU,GAClCT,EAAQU,gBAAgBN,GACxBJ,EAAQI,IAAQ,IAEhBJ,EAAQgB,aAAaZ,EAAMK,GACE,+BAAzBT,EAAQiB,eACXjB,EAAQI,GAAQK,IAMpB,QAASS,GAAkBlB,EAASxC,EAAM2D,GACzC,IAAK,GAAIf,KAAQhB,GAAM+B,EAAS3D,GAAO,CACtC,GAAIiD,GAAQjD,EAAK4C,GACbO,EAAWQ,EAAQf,GACnBgB,EAAYpB,EAAQI,EAEV/B,UAAVoC,EACHD,EAAkBR,EAASI,EAAMO,GAEd,aAATP,EACVT,EAAMc,EAAOT,IAEHS,IAAUE,GACI,iBAAdS,IAA2BA,IAAcX,IACnDJ,EAAeL,EAASI,EAAMK,EAAOE,IAKxC,QAAS1B,GAAMoC,EAAQxD,EAAMyD,EAASC,GACrC,GAAa,OAAT1D,EAIJ,GAAgBQ,SAAZiD,EACHD,EAAOd,YAAYR,EAAkBlC,QAE/B,IAAaQ,SAATR,EAAoB,CAC9B,KAAO0D,EAAQ,IAAMF,EAAOG,WAAWD,IACtCA,GAGD,IAAIvB,GAAUqB,EAAOG,WAAWD,EAEhC,IAAID,GAAWA,EAAQ9D,KAAM,CAC5B,GAAIiE,GAAOH,EAAQ9D,KAAKkE,QACpBD,IACH9B,EAAM8B,EAAMzB,GAIdqB,EAAOM,YAAY3B,OAEb,IAAIF,EAAajC,EAAMyD,GAAU,CACvC,GAAItB,GAAUqB,EAAOG,WAAWD,EAEZ,kBAAT1D,GACVwD,EAAOM,YAAY3B,GAEG3B,SAAZ2B,EACVqB,EAAOd,YAAYR,EAAkBlC,IAGrCwD,EAAOO,aAAa7B,EAAkBlC,GAAOmC,OAExC,IAAInC,EAAKN,IAAK,CACpB,GAAIyC,GAAUqB,EAAOG,WAAWD,EAEhCL,GAAkBlB,EAASnC,EAAKL,KAAM8D,EAAQ9D,KAI9C,KAAK,GAFDqE,GAAMhE,EAAKJ,SAASG,OAAQkE,EAASR,EAAQ7D,SAASG,OAEjDD,EAAI,EAAGA,EAAIkE,GAAOlE,EAAImE,EAAQnE,IACtCsB,EAAMe,EAASnC,EAAKJ,SAASE,GAAI2D,EAAQ7D,SAASE,GAAIA,IAlOzD,GAWIE,GACAqB,EAZAJ,EAAQP,EAAQO,MAChBC,EAAOR,EAAQQ,KAEfI,KACA4C,EAAUxD,EAAQwD,YAClBC,EAAWzD,EAAQyD,UAAYzD,EAAQ0D,WAEvCC,EAAO3D,EAAQ4D,cAEfC,EAAS7D,EAAQ6D,QAAUC,SAASC,UAKpCC,EAAQnD,GACXoD,SAAUH,SAASC,UACnBG,SAAUJ,SAASC,UACnBI,QAAS,SAAUC,GAClB,KAAMA,KAELpE,EAAQgE,MAEX,KAAK,GAAInC,KAAQhB,GAAM4C,EAAUD,IAC/B,SAAU3B,GACVjB,EAAQiB,GAAQ,SAAU5C,GACzB+E,EAAMC,SAASpC,EAAM5C,EAErB,IAAIoF,GAASb,EAAQ3B,EACrB,IAAIwC,EACH,MAAOA,GAAO9D,EAAOK,EAAS3B,EAAM+E,EAAMG,QAG3C,IAAIT,GAASD,EAAS5B,GAAOyC,EAAS/D,CACtCD,GAAOC,EAAQM,EAAMN,EAAOmD,EAAOnD,EAAOtB,IAAQuB,EAAMlB,GAExD0E,EAAME,SAASI,EAAQ/D,EAAOtB,KAE9B4C,EAGH5B,GAAM,WACLU,EAAOX,EAAQW,MAAQR,SAASoE,KAAKvC,YAAY7B,SAASyB,cAAc,QAEpD,kBAATpB,IACVF,EAAOC,EAAOC,GAGfqD,EAAO,SAAUW,GAChBlE,EAAOC,EAAOC,EAAOgE,EAAUA,EAAUhE,EAAMlB,IAC7CU,EAEH,KAAK,GAAIgB,KAAO2C,GACfA,EAAK3C,GAAKT,EAAOK,EAASoD,EAAMG,cCrDpB,SAAU7D,EAAQN,GAG7B,QAASyE,GAAYxF,GACjBqB,EAAOoE,EAAMC,EAAQ1F,IACrB2F,QAAQC,aAAc,GAAI5F,GAkC9B,QAASyF,GAAMC,EAAQG,GACnB,IAAK,GAAIC,KAASJ,GAAQ,CACtB,GAAuCD,GAAnCM,EAAKC,EAASF,GAAQG,IAa1B,IAXAJ,EAAKK,QAAQ,GAAIC,QAAOJ,EAAGA,GAAI,KAAM,WACjC,IAAK,GAAI5F,GAAI,EAAGA,EAAIK,UAAUJ,OAAS,EAAGD,IACtC8F,EAAOF,EAAGK,KAAK3F,SAAWD,UAAUL,EAGxCsF,GAAQ,SAAUnE,EAAOK,GAErB,MADAA,GAAQ6D,YAAcA,EACfE,EAAOI,GAAOxE,EAAOK,EAASsE,MAIzCR,EACA,MAAOA,GAIf,MAAOC,GAAO,KAGlB,QAASM,GAASH,GACd,GAAIO,KAOJ,QAASL,GAPW,IAAMF,EACrBK,QAAQ,MAAO,OACfA,QAAQ,oBAAqB,SAAUG,EAAGtE,GAEvC,MADAqE,GAAK9F,KAAKyB,GACH,oBACN,MAEQqE,KAAMA,GArE3B,GAAIV,GAAS3E,EAAQQ,IAOrB+E,QAAOlF,iBAAiB,WAAY,WAChCC,EAAOoE,EAAMC,EAAQa,SAASC,aAGlCF,OAAOlF,iBAAiB,QAAS,SAAUqF,GACvC,KAAIA,EAAEC,SAAWD,EAAEE,UAAYF,EAAEG,SAAWH,EAAEI,QAA9C,CAMA,IAFA,GAAIC,GAASL,EAAEK,OAERA,GAA+B,MAArBA,EAAOC,WACpBD,EAASA,EAAOE,UAGpB,IAAIF,GAAUA,EAAOG,OAASV,SAASU,OAC/BH,EAAOI,aAAa,mBAAoB,CAE5C,GAAI1E,GAAUtB,SAASiG,cAA8B,KAAhBL,EAAOM,KAAc5E,EAAUsE,EAAOM,KAEvE5E,GACAA,EAAQ6E,gBAAe,IAEvBZ,EAAEa,iBACF9B,EAAYsB,EAAON,eAK/BnF,EAAOoE,EAAMC,EAAQa,SAASC"}