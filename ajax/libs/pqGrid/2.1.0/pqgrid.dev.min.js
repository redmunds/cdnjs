!function(t){t.paramquery=t.paramquery||{},t.paramquery.pqgrid=t.paramquery.pqgrid||{},t.paramquery.xmlToArray=function(e,i){var r=i.itemParent,o=i.itemNames,n=[],a=t(e).find(r);return a.each(function(e,i){var r=t(i),a=[];t(o).each(function(t,e){a.push(r.find(e).text())}),n.push(a)}),n},t.paramquery.xmlToJson=function(e,i){var r=i.itemParent,o=i.itemNames,n=[],a=t(e).find(r);return a.each(function(e,i){for(var r=t(i),a={},l=0,s=o.length;l<s;l++){var d=o[l];a[d]=r.find(d).text()}n.push(a)}),n},t.paramquery.tableToArray=function(e){var i=t(e),r=[],o=[],n=i.find("tr:first"),a=i.find("tr:eq(1)");return n.find("th,td").each(function(e,i){var o=t(i),n=o.html(),l=o.width(),s="string",d=a.find("td:eq("+e+")"),h=d.text(),c=d.attr("align");h=h.replace(/,/g,""),parseInt(h)==h&&(parseInt(h)+"").length==h.length?s="integer":parseFloat(h)==h&&(s="float");var u={title:n,width:l,dataType:s,align:c,dataIndx:e};r.push(u)}),i.find("tr").each(function(e,i){if(0!=e){var r=t(i),n=[];r.find("td").each(function(e,i){n.push(t.trim(t(i).html()))}),o.push(n)}}),{data:o,colModel:r}},t.paramquery.formatCurrency=function(t){t=Math.round(10*t)/10,t+="",t.indexOf(".")==-1&&(t+=".0");for(var e=t.length,i=t.substring(0,e-2),r=t.substring(e-2,e),o=i.match(/\d/g).reverse(),n=[],a=0;a<o.length;a++)a>0&&a%3==0&&n.push(","),n.push(o[a]);return n=n.reverse(),i=n.join(""),i+r},t.paramquery.validation={is:function(t,e){return"string"==t||!t||(t=t.substring(0,1).toUpperCase()+t.substring(1,t.length),this["is"+t](e))},isFloat:function(t){var e=parseFloat(t);return!isNaN(e)&&e==t},isInteger:function(t){var e=parseInt(t);return!isNaN(e)&&e==t},isDate:function(t){var e=Date.parse(t);return!isNaN(e)}}}(jQuery),function(t){var e={};e.options={curPage:0,totalPages:0,totalRecords:0,msg:"",rPPOptions:[10,20,30,40,50,100],rPP:20},e._regional={strDisplay:"Displaying {0} to {1} of {2} items.",strFirstPage:"First Page",strLastPage:"Last Page",strNextPage:"Next Page",strPage:"Page {0} of {1}",strPrevPage:"Previous Page",strRefresh:"Refresh",strRpp:"Records per page:{0}"},t.extend(e.options,e._regional),e._create=function(){var e=this,i=this.options;this.element.addClass("pq-pager"),this.first=t("<button type='button' title='"+i.strFirstPage+"'></button>",{}).appendTo(this.element).button({icons:{primary:"ui-icon-seek-first"},text:!1}).bind("click.paramquery",function(t){e.options.curPage>1&&e._trigger("change",t,{curPage:1})!==!1&&e.option({curPage:1})}),this.prev=t("<button type='button' title='"+i.strPrevPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-prev"},text:!1}).bind("click",function(t){if(e.options.curPage>1){var i=e.options.curPage-1;e._trigger("change",t,{curPage:i})!==!1&&e.option({curPage:i})}}),t("<span class='pq-separator'></span>").appendTo(this.element),this.pageHolder=t("<span class='pq-page-placeholder'></span>").appendTo(this.element),t("<span class='pq-separator'></span>").appendTo(this.element),this.next=t("<button type='button' title='"+this.options.strNextPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-next"},text:!1}).bind("click",function(t){var i=e.options.curPage+1;e._trigger("change",t,{curPage:i})!==!1&&e.option({curPage:i})}),this.last=t("<button type='button' title='"+this.options.strLastPage+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-seek-end"},text:!1}).bind("click",function(t){var i=e.options.totalPages;e._trigger("change",t,{curPage:i})!==!1&&e.option({curPage:i})}),t("<span class='pq-separator'></span>").appendTo(this.element),this.rPPHolder=t("<span class='pq-page-placeholder'></span>").appendTo(this.element),this.$refresh=t("<button type='button' title='"+this.options.strRefresh+"'></button>").appendTo(this.element).button({icons:{primary:"ui-icon-refresh"},text:!1}).bind("click",function(t){e._trigger("refresh",t)!==!1}),t("<span class='pq-separator'></span>").appendTo(this.element),this.$msg=t("<span class='pq-pager-msg'></span>").appendTo(this.element),this._refresh()},e._refreshPage=function(){var e=this;this.pageHolder.empty();for(var i=this.options,r=i.strPage,o=r.split(" "),n=[],a=0,l=o.length;a<l;a++){var s=o[a];"{0}"==s?n.push("<input type='text' tabindex='0' class='ui-corner-all' />"):"{1}"==s?n.push("<span class='total'></span>"):n.push("<span>",s,"</span>")}var d=n.join(""),h=t(d).appendTo(this.pageHolder);this.page=h.filter("input").bind("change",function(r){var o=t(this),n=o.val();return isNaN(n)||n<1?(o.val(i.curPage),!1):(n=parseInt(n),n>i.totalPages?(o.val(i.curPage),!1):e._trigger("change",r,{curPage:n})===!1?(o.val(i.curPage),!1):void e.option({curPage:n}))}),this.$total=h.filter("span.total")},e._refresh=function(){this._refreshPage();var e=(this.$rPP,this),i=this.options;if(this.first.attr("title",i.strFirstPage),this.prev.attr("title",i.strPrevPage),this.next.attr("title",i.strNextPage),this.last.attr("title",i.strLastPage),this.$refresh.attr("title",i.strRefresh),this.rPPHolder.empty(),i.strRpp){var r=i.rPPOptions,o=i.strRpp;if(o.indexOf("{0}")!=-1){for(var n=["<select class='ui-corner-all'>"],a=0,l=r.length;a<l;a++){var s=r[a];n.push('<option value="',s,'">',s,"</option>")}n.push("</select>");var d=n.join("");o=o.replace("{0}","</span>"+d),o="<span>"+o+"<span class='pq-separator'></span>"}else o="<span>"+o+"</span><span class='pq-separator'></span>";this.$rPP=t(o).appendTo(this.rPPHolder).filter("select").val(i.rPP).change(function(i){var r=t(this).val();if(e._trigger("change",i,{rPP:r})!==!1)return e.options.rPP=r,!1})}if(i.curPage>=i.totalPages?(this.next.button({disabled:!0}),this.last.button({disabled:!0})):(this.next.button({disabled:!1}),this.last.button({disabled:!1})),i.curPage<=1?(this.first.button({disabled:!0}),this.prev.button({disabled:!0})):(this.first.button({disabled:!1}),this.prev.button({disabled:!1})),this.page.val(i.curPage),this.$total.text(i.totalPages),this.options.totalRecords>0){var h=i.rPP,c=i.curPage,u=i.totalRecords,f=(c-1)*h,p=c*h;p>u&&(p=u);var g=i.strDisplay;g=g.replace("{0}",f+1),g=g.replace("{1}",p),g=g.replace("{2}",u),this.$msg.html(g)}else this.$msg.html("")},e._destroy=function(){this.element.empty().removeClass("pq-pager").enableSelection()},e._setOption=function(t,e){"curPage"!=t&&"totalPages"!=t||(e=parseInt(e)),this._super.call(this,t,e)},e._setOptions=function(){this._super.apply(this,arguments),this._refresh()},t.widget("paramquery.pqPager",e),t.paramquery.pqPager.regional={},t.paramquery.pqPager.regional.en=e._regional}(jQuery),function(t){var e={};e.options={length:200,num_eles:3,cur_pos:0,ratio:0,timeout:350,pace:"optimum",direction:"vertical",theme:!1},e._destroy=function(){this.element.removeClass("pq-sb-vert pq-sb-vert-t pq-sb-vert-wt").enableSelection().removeClass("pq-sb-horiz pq-sb-horiz-t pq-sb-horiz-wt").unbind("click.pq-scrollbar").empty(),this.element.removeData()},e._create=function(){this._createLayout()},e._createLayout=function(){var e=this,i=this.options,r=i.direction,o=i.theme,n=this.element.empty();"vertical"==r?(n.removeClass("pq-sb-vert-t pq-sb-vert-wt").addClass("pq-sb-vert"),o?(n.addClass("pq-sb-vert-t"),n.html(["<div class='top-btn pq-sb-btn ui-state-default ui-corner-top'>","<div class='ui-icon ui-icon-triangle-1-n'></div></div>","<div class='pq-sb-slider ui-corner-all ui-state-default'>","</div>","<div class='bottom-btn pq-sb-btn ui-state-default ui-corner-bottom'>","<div class='ui-icon ui-icon-triangle-1-s'></div></div>"].join(""))):(n.addClass("pq-sb-vert-wt"),n.html(["<div class='top-btn pq-sb-btn'></div>","<div class='pq-sb-slider'>","<div class='vert-slider-top'></div>","<div class='vert-slider-bg'></div>","<div class='vert-slider-center'></div>","<div class='vert-slider-bg'></div>","<div class='vert-slider-bottom'></div>","</div>","<div class='bottom-btn pq-sb-btn'></div>"].join("")))):(n.removeClass("pq-sb-horiz-t pq-sb-horiz-wt").addClass("pq-sb-horiz"),o?(n.addClass("pq-sb-horiz-t"),n.html(["<div class='left-btn pq-sb-btn ui-state-default ui-corner-left'>","<div class='ui-icon ui-icon-triangle-1-w'></div></div>","<div class='pq-sb-slider pq-sb-slider-h ui-state-default ui-corner-all'>","</div>","<div class='right-btn pq-sb-btn ui-state-default ui-corner-right'>","<div class='ui-icon ui-icon-triangle-1-e'></div></div>"].join(""))):(n.addClass("pq-sb-horiz-wt"),n.width(this.width),n.html(["<div class='left-btn pq-sb-btn'></div>","<div class='pq-sb-slider pq-sb-slider-h'>","<span class='horiz-slider-left'></span>","<span class='horiz-slider-bg'></span>","<span class='horiz-slider-center'></span>","<span class='horiz-slider-bg'></span>","<span class='horiz-slider-right'></span>","</div>","<div class='right-btn pq-sb-btn'></div>"].join("")))),n.disableSelection().unbind(".pq-scrollbar").on("mouseup.pq-scrollbar",function(t){e._mouseup(t)}).on("mousedown.pq-scrollbar",function(t){if(!i.disabled&&!e.$slider.is(":hidden"))if("vertical"==r){var o=t.pageY,n=e.element.offset().top,a=n+i.length,l=e.$slider,s=l.offset().top,d=l.height(),h=s+d;o<s&&o>n+17?e.mousedownInterval=window.setInterval(function(){o>=l.offset().top?(window.clearInterval(e.mousedownInterval),e.mousedownInterval=null):e._pageUp(t)},0):o>h&&o<a-17&&(e.mousedownInterval=window.setInterval(function(){o<=l.offset().top+d?(window.clearInterval(e.mousedownInterval),e.mousedownInterval=null):e._pageDown(t)},0))}else{var c=t.pageX,n=e.element.offset().left,a=n+i.length,s=e.$slider.offset().left,h=s+e.$slider.width();c<s&&c>n+17?(e.$slider.css("left",c-e.element.offset().left),e._updateCurPosAndTrigger(t)):c>h&&c<a-17&&(e.$slider.css("left",c-e.element.offset().left-e.$slider.width()),e._updateCurPosAndTrigger(t))}});var a=this.$slider=t("div.pq-sb-slider",this.element);o&&a.attr("tabindex","0"),this._bindSliderEvents(a),this.$top_btn=t("div.top-btn,div.left-btn",this.element).click(function(t){if(!e.options.disabled)return e.decr_cur_pos(t),t.preventDefault(),!1}).mousedown(function(t){e.options.disabled||(e.mousedownTimeout=window.setTimeout(function(){e.mousedownInterval=window.setInterval(function(){e.decr_cur_pos(t)},0)},e.options.timeout))}).bind("mouseup mouseout",function(t){e._mouseup(t)}),this.$bottom_btn=t("div.bottom-btn,div.right-btn",this.element).click(function(t){if(!e.options.disabled)return e.incr_cur_pos(t),t.preventDefault(),!1}).mousedown(function(t){e.options.disabled||(e.mousedownTimeout=window.setTimeout(function(){e.mousedownInterval=window.setInterval(function(){e.incr_cur_pos(t)},0)},e.options.timeout))}).bind("mouseup mouseout",function(t){e._mouseup(t)}),this._refresh()},e._bindSliderEvents=function(e){var i=this,r=this.options.direction,o="x";"vertical"==r&&(o="y"),e.draggable({axis:o,helper:function(t,e){return i._setDragLimits(),this},start:function(t){i.topWhileDrag=null},drag:function(t){i.dragging=!0;var e=i.options.pace;"optimum"==e?i._setNormalPace(t):"fast"==e&&i._updateCurPosAndTrigger(t)},stop:function(t){i._updateCurPosAndTrigger(t),i.dragging=!1}}).on("keydown.pq-scrollbar",function(e){var r=e.keyCode,o=i.options,n=o.cur_pos,a=o.ratio,l=o.num_eles,s=t.ui.keyCode;if(null==i.keydownTimeout&&(i.keydownTimeout=window.setTimeout(function(){r==s.DOWN||r==s.RIGHT?i.incr_cur_pos(e):r==s.UP||r==s.LEFT?i.decr_cur_pos(e):r==s.HOME?o.steps?n>0&&(o.cur_pos=0,i.updateSliderPos(),i.scroll(e)):a>0&&(o.ratio=0,i.updateSliderPos(),i.drag(e)):r==s.END?o.steps?n<l&&(o.cur_pos=l,i.updateSliderPos(),i.scroll(e)):a<1&&(o.ratio=1,i.updateSliderPos(),i.drag(e)):"vertical"==o.direction&&(r==s.PAGE_DOWN?i._pageDown(e):r==s.PAGE_UP&&i._pageUp(e)),i.keydownTimeout=null},0)),r==s.DOWN||r==s.RIGHT||r==s.UP||r==s.LEFT||r==s.PAGE_DOWN||r==s.PAGE_UP||r==s.HOME||r==s.END)return e.preventDefault(),!1})},e.decr_cur_pos=function(t){var e=this,i=e.options,r=i.steps;if(r)i.cur_pos>0&&(i.cur_pos--,e.updateSliderPos(),e.scroll(t));else if(i.ratio>0){var o=i.ratio-1/(i.num_eles-1);o<0&&(o=0),i.ratio=o,e.updateSliderPos(),e.drag(t)}},e.incr_cur_pos=function(t){var e=this,i=e.options,r=i.steps;if(r)i.cur_pos<i.num_eles-1&&i.cur_pos++,e.updateSliderPos(),e.scroll(t);else{if(i.ratio<1){var o=i.ratio+1/(i.num_eles-1);o>1&&(o=1),i.ratio=o}e.updateSliderPos(),e.drag(t)}},e._mouseup=function(t){if(!this.options.disabled){var e=this;window.clearTimeout(e.mousedownTimeout),e.mousedownTimeout=null,window.clearInterval(e.mousedownInterval),e.mousedownInterval=null}},e._setDragLimits=function(){var t=this.options;if("vertical"==t.direction){var e=this.element.offset().top+17,i=e+t.length-34-this.slider_length;this.$slider.draggable("option","containment",[0,e,0,i])}else e=this.element.offset().left+17,i=e+t.length-34-this.slider_length,this.$slider.draggable("option","containment",[e,0,i,0])},e._refresh=function(){var t=this.options;t.num_eles<=1?this.element.css("display","none"):this.element.css("display",""),this._validateCurPos(),this.$slider.css("display",""),"vertical"==t.direction?(this.element.height(t.length),this._setSliderBgLength(),this.scroll_space=t.length-34-this.slider_length,(this.scroll_space<4||t.num_eles<=1)&&this.$slider.css("display","none"),this.updateSliderPos(t.cur_pos)):(this.element.width(t.length),this._setSliderBgLength(),this.scroll_space=t.length-34-this.slider_length,(this.scroll_space<4||t.num_eles<=1)&&this.$slider.css("display","none"),this.updateSliderPos(t.cur_pos))},e._setSliderBgLength=function(){var e=this.options,i=e.theme,r=e.length,o=40*e.num_eles+r,n=r-34,a=n*r/o,l=Math.round((a-14)/2);l<1&&(l=1),this.slider_length=14+2*l,"vertical"==e.direction?i?this.$slider.height(this.slider_length-2):(t("div.vert-slider-bg",this.element).height(l),this.$slider.height(this.slider_length)):i?this.$slider.width(this.slider_length-2):(t(".horiz-slider-bg",this.element).width(l),this.$slider.width(this.slider_length))},e._updateCurPosAndTrigger=function(t,e){var i=this,r=this.options,o=r.direction,n=i.$slider;null==e&&(e="vertical"==o?parseInt(n[0].style.top,10):parseInt(n[0].style.left,10));var a=r.length-34-this.slider_length,l=(e-17)/a;if(r.steps){var s=l*(r.num_eles-1);if(s=Math.round(s),r.cur_pos!=s){if(this.dragging){if(null!=this.topWhileDrag){if(this.topWhileDrag<e&&r.cur_pos>s)return;if(this.topWhileDrag>e&&r.cur_pos<s)return}this.topWhileDrag=e}i.options.cur_pos=s,this.scroll(t)}}else r.ratio=l,this.drag(t)},e._setNormalPace=function(t){this.timer&&(window.clearInterval(this.timer),this.timer=null);var e=this,i=this.options,r=i.direction;e.timer=window.setInterval(function(){var i=e.$slider,o="vertical"==r?parseInt(i[0].style.top,10):parseInt(i[0].style.left,10);e.prev_top==o&&(e._updateCurPosAndTrigger(t,o),window.clearInterval(e.timer),e.timer=null),e.prev_top=o},20)},e.setNumEles=function(t){this.options.num_eles=t,this.updateSliderPos()},e._validateCurPos=function(){var t=this.options;t.cur_pos>=t.num_eles&&(t.cur_pos=t.num_eles-1),t.cur_pos<0&&(t.cur_pos=0)},e._updateSliderPosRatio=function(){var t=this,e=this.options,i=e.direction,r=e.ratio,o=t.$slider,n=e.length-34-this.slider_length;if(null==r)throw"ration N/A";var a=r*n+17;"vertical"==i?o.css("top",a):o.css("left",a)},e._updateSliderPosCurPos=function(){var t=this.options,e=this.scroll_space*t.cur_pos/(t.num_eles-1);"vertical"==t.direction?this.$slider.css("top",17+e):this.$slider.css("left",17+e)},e.updateSliderPos=function(){var t=this.options;if(void 0===t.steps)throw"assert failed. steps N/A";t.steps?this._updateSliderPosCurPos():this._updateSliderPosRatio()},e.scroll=function(t){var e=this.options;this._trigger("scroll",t,{cur_pos:e.cur_pos,num_eles:e.num_eles})},e.drag=function(t){var e=this,i=e.options;this._trigger("drag",t,{ratio:i.ratio})},e._pageDown=function(t){this._trigger("pageDown",t,null)},e._pageUp=function(t){this._trigger("pageUp",t,null)},e._setOption=function(t,e){"disabled"==t?(this._super.call(this,t,e),1==e?this.$slider.draggable("disable"):this.$slider.draggable("enable")):"theme"==t?(this._super.call(this,t,e),this._createLayout()):"ratio"==t?e>=0&&e<=1&&this._super.call(this,t,e):this._super.call(this,t,e)},e._setOptions=function(){this._super.apply(this,arguments),this._refresh()},t.widget("paramquery.pqScrollBar",e)}(jQuery),function(t){var e=function(){};e.prototype.belongs=function(t){if(t.target==this.that.element[0])return!0},t.paramquery.cClass=e;var i=function(t){this.that=t,this.hidearrHS1=[],this.options=t.options,this.offset=null};t.paramquery.cGenerateView=i;var r=i.prototype;r.generateView=function(e){var i,r,o=this,n=this.that,a=n.options,l=a.freezeCols,s=(a.virtualX,a.virtualY,n.colModel),h=n.initH,c=n.finalH,u=a.groupModel,f=n.pqpanes;if(e){var p=this._generateTables(null,null,e),g=e.$cont;g.empty(),f.v?g.append(["<div class='pq-cont-inner'>",p,"</div>","<div class='pq-cont-inner'>",p,"</div>"].join("")):g.append("<div class='pq-cont-inner'>"+p+"</div>");var v=g.children("div"),w=v.children("table"),x=w[0].scrollHeight-1;if(g.height(x),f.v){var m=t(v[0]),I=w[0].scrollWidth,_=t(v[1]),b=t(w[1]),q=d.call(n,-1,l),y=d.call(n,l,h);m.css({width:q,zIndex:1}),_.css({left:q-1,width:I,position:"absolute",height:x}),b.css({left:-1*(y+q)})}n.tables||(n.tables=[]);for(var C=-1,M=0;M<n.tables.length;M++){var D=n.tables[M].cont;D==e.$cont[0]&&(C=M)}C==-1?n.tables.push({$tbl:w,cont:e.$cont[0]}):n.tables[C].$tbl=w}else{n._bufferObj_calcInitFinal(),i=n.initV,r=n.finalV;var P=u?n.dataGM:n.data,g=n.$cont;null!=a.editModel.indices&&n.blurEditor({force:!0});var p=o._generateTables(i,r,e);g.empty(),0===n.totalVisibleRows?g.append("<div class='pq-cont-inner pq-grid-norows' >"+a.strNoRows+"</div>"):f.h&&f.v?g.append(["<div class='pq-cont-inner'>",p,"</div>","<div class='pq-cont-inner'>",p,"</div>","<div class='pq-cont-inner'>",p,"</div>","<div class='pq-cont-inner'>",p,"</div>"].join("")):f.h||f.v?g.append(["<div class='pq-cont-inner'>",p,"</div>","<div class='pq-cont-inner'>",p,"</div>"].join("")):g.append("<div class='pq-cont-inner'>"+p+"</div>"),n.$tbl=g.children("div").children("table"),n._fixTableViewPort(),n._trigger("afterTable",null,{dataModel:a.dataModel,colModel:s,pageData:P,initV:i,finalV:r,initH:h,finalH:c})}n._saveDims(),this.scrollView(),e||n._trigger("refresh",null,{dataModel:a.dataModel,colModel:s,pageData:P,initV:i,finalV:r,initH:h,finalH:c}),n._saveDims(),this.scrollView()},r.scrollView=function(){var t=this.that,e=this.options,i=e.virtualX,r=e.virtualY;i||t.$hscroll.pqScrollBar("drag"),r||t.$vscroll.pqScrollBar("drag")},r.setPanes=function(){var e,i,r,o=this.that,n=o.$cont,a=o.pqpanes,l=n.children("div"),s=o.$tbl,h=o.options,c=parseInt(h.freezeCols),u=o.initH;if(s&&s.length){var f=s[0].scrollWidth;if(a.h&&a.v){var p=t(l[0]),g=t(l[1]),v=t(s[1]),w=t(l[2]),x=t(s[2]),m=t(l[3]),I=t(s[3]);e=d.call(o,-1,c);var r=o.calcHeightFrozenRows();p.css({width:e,height:r,zIndex:2}),g.css({left:e,width:f,height:r,position:"absolute"}),v.css({left:-1*e}),w.css({width:e,zIndex:1,top:r,position:"absolute"}),x.css({top:-r}),m.css({left:e,width:f,zIndex:1,top:r,position:"absolute"}),I.css({top:-r,left:-1*e})}else if(a.v){var _=t(l[0]),b=t(l[1]),q=t(s[1]);e=d.call(o,-1,c),i=d.call(o,c,u),_.css({width:e,zIndex:1}),b.css({left:e,width:f,position:"absolute"}),q.css({left:-1*(i+e)})}else if(a.h){var y=t(l[0]),C=t(l[1]),M=t(s[1]);r=o.calcHeightFrozenRows(),y.css({height:r,zIndex:1}),C.css({width:f,top:r,position:"absolute"}),M.css({top:-1*r})}}},r._generateTables=function(t,e,i){var r=this.that,o=r.colModel,n=(o.length,r.options),a=n.virtualX,l=r.initH,s=r.finalH,d=n.numberCell,h=n.columnBorders,c=n.rowBorders,u=n.wrap,f=(n.scrollModel,n.groupModel),p=(r.hidearrHS,n.freezeCols),g=parseInt(n.freezeRows),v=!1,w=0,x=i?i.data.length-1:e,m=!!f,I=(n.treeModel,i&&i.data?i.data:m?r.dataGM:r.data),_=r.rowIndxOffset;if(i||null!=t&&null!=x){i||r._trigger("beforeTableView",null,{pageData:I,initV:t,finalV:e,initH:l,finalH:s,colModel:o});var b="pq-grid-table ";h&&(b+="pq-td-border-right "),c&&(b+="pq-td-border-bottom "),b+=u?"pq-wrap ":"pq-no-wrap ";var q=["<table class='"+b+"' cellpadding=0 cellspacing=0 >"];if(this.hidearrHS1=[],q.push("<tr class='pq-row-hidden'>"),d.show){var y=d.width+1;q.push("<td style='width:"+y+"px;' ></td>")}for(var C=0;C<=s;C++){if(C<l&&C>=p&&(a||i)&&(C=l,C>s))throw"initH>finalH";var M=o[C];M.hidden||(y=M.outerWidth,q.push("<td style='width:",y,"px;' pq-col-indx='",C,"'></td>"))}q.push("</tr>"),this.offsetRow=null;for(var w=0;w<=x;w++){w<t&&w>=g&&(w=t);var D=I[w],P=m?D.rowIndx-_:w,R=!!D&&D.pq_hidden;if(!R){var v=r.lastFrozenRow===P;if(f&&D.groupTitle)this._generateTitleRow(f,D,q,v);else if(f&&D.groupSummary)this._generateSummaryRow(D.data,o,q,v);else{var $=D.pq_detail&&D.pq_detail.show;this._generateRow(D,P,o,q,i,v,$),$&&this._generateDetailRow(D,P,o,q,i,v)}}}r.scrollMode=!1,q.push("</table>");var S=q.join("");return S}},r._renderCell=function(t,e){var i=(this.that,this.options),r=t.rowData,o=t.column,n=o.type,a=o.dataIndx,l=r[a];if(r){var s;if(void 0!=e)s=e;else if("checkBoxSelection"==n)s="<input type='checkbox' "+(l?"checked='checked'":"")+" />";else if("detail"==n){var d=i.detailModel,h=l&&l.show?d.expandIcon:d.collapseIcon;s="<div class='ui-icon "+h+"'></div>"}else s=l;""!==s&&void 0!=s||(s="&nbsp;");var c,u="";if(t.tree&&(c=i.treeModel)&&c.labelIndx==a){var f=r.pq_leaf,p=r.pq_level,g=!r.pq_collapse,v=(p+1)*c.indent,w="";w=f?c.leafIcon:g?c.expandIcon+" pq-tree-expand-icon":c.collapseIcon+" pq-tree-expand-icon";var x=["<div class='pq-tree-icon-container' style='width:",v,"px;'>","<div class='ui-icon ",w," pq-tree-icon' ></div></div>"].join("");u="<div class='"+cls+"'>"+x+s+"</div>"}else u=s;return u}},r.renderCell=function(t){var e=this.that,i=this.options,r=t.rowData,o=t.rowIndx,n=t.rowIndxPage,a=t.column,l=t.colIndx,s=a.dataIndx,d=i.freezeCols,h=i.columnBorders,c="pq-col-indx='"+l+"'",u=!1,f="pq-grid-cell ";"right"==a.align?f+=" pq-align-right":"center"==a.align&&(f+=" pq-align-center"),l==d-1&&h&&(f+=" pq-last-freeze-col");var p=a.cls;p&&(f=f+" "+p);var g=r.pq_cellselect;g&&(u=g[s]),u&&(f+=" pq-cell-select ui-state-highlight");var v;a.render&&(v=a.render.call(e.element[0],{data:e.data,dataModel:i.dataModel,rowData:r,cellData:r[s],rowIndxPage:n,rowIndx:o,colIndx:l,column:a,dataIndx:s}));var w=r.pq_cellcls;if(w){var x=w[s];x&&(f+=" "+x)}var m=["<td class='",f,"' ",c," >",this._renderCell(t,v),"</td>"].join("");return m},r.refreshRow=function(t,e,i){var r=this.that,o=r.data[t],n=r.lastFrozenRow===t,a=o.pq_detail&&o.pq_detail.show;this._generateRow(o,t,e,i,null,n,a)},r._generateRow=function(t,e,i,r,o,n,a){var l="pq-grid-row";n&&(l+=" pq-last-freeze-row"),a&&(l+=" pq-detail-master");var s=this.that,d=this.options,h=d.freezeCols,c=d.numberCell,u=d.treeModel,f=!!u.labelIndx,p=d.virtualX,g=s.initH,v=s.finalH,w=this.offset;d.stripeRows&&e/2==parseInt(e/2)&&(l+=" pq-grid-oddRow"),t.pq_rowselect&&(l+=" pq-row-select ui-state-highlight");var x=t.pq_rowcls;null!=x&&(l+=" "+x),r.push("<tr pq-row-indx='",e,"' class='",l,"' >"),c.show&&r.push(["<td class='pq-grid-number-cell ui-state-default'>",o?"&nbsp;":e+1,"</td>"].join(""));for(var m={rowIndx:e+w,rowIndxPage:e,rowData:t},I=0;I<=v;I++){if(I<g&&I>=h&&(p||o)&&(I=g,I>v))throw"initH>finalH";var _=i[I];_.hidden||(m.column=_,m.colIndx=I,m.tree=f,r.push(this.renderCell(m)))}return r.push("</tr>"),r};var o={widgetEventPrefix:"pqgrid"};o.options={cancel:"input,textarea,button,select,option,.ui-resizable-handle,div[contenteditable],.pq-draggable",distance:3,collapsible:{on:!0,collapsed:!1,_collapsed:!1,refreshAfterExpand:!0},colModel:null,columnBorders:!0,dataModel:{cache:!1,dataType:"JSON",location:"local",sorting:"local",sortDir:"up",method:"GET"},direction:"",draggable:!1,editable:!0,editModel:{cellBorderWidth:0,clicksToEdit:1,filterKeys:!0,keyUpDown:!0,reInt:/^([\-]?[1-9][0-9]*|[\-]?[0-9]?)$/,reFloat:/^(([\-]?[1-9][0-9]*\.?[0-9]*)|([\-]?[0-9]\.[0-9]*)|([0-9]?))$/,onBlur:"validate",saveKey:""},editor:{select:!1,type:"textbox"},validation:{icon:"ui-icon-alert",cls:"ui-state-error"},flexHeight:!1,flexWidth:!1,freezeCols:0,freezeRows:0,getDataIndicesFromColIndices:!0,height:400,hoverMode:"null",_maxColWidth:"100%",_minColWidth:50,minWidth:100,numberCell:{width:30,title:"",resizable:!1,minWidth:30,show:!0},pageModel:{curPage:1,totalPages:0,rPP:10,rPPOptions:[10,20,50,100]},resizable:!1,roundCorners:!0,rowBorders:!0,scrollModel:{pace:"fast",horizontal:!0,autoFit:!1,theme:!1},selectionModel:{type:"row",mode:"range"},swipeModel:{on:!0,speed:50,ratio:.15,repeat:20},showBottom:!0,showHeader:!0,showTitle:!0,showToolbar:!0,showTop:!0,sortable:!0,sql:!1,stripeRows:!0,title:"&nbsp;",treeModel:null,virtualX:!1,virtualY:!1,width:"auto",wrap:!0,hwrap:!0},o._regional={strAdd:"Add",strDelete:"Delete",strEdit:"Edit",strLoading:"Loading",strNextResult:"Next Result",strNoRows:"No rows to display.",strNothingFound:"Nothing found",strPrevResult:"Previous Result",strSearch:"Search",strSelectedmatches:"Selected {0} of {1} match(es)"},t.extend(o.options,o._regional),o._destroyResizable=function(){this.element.data("resizable")&&this.element.resizable("destroy")},o._disable=function(){null==this.$disable&&(this.$disable=t("<div class='pq-grid-disable'></div>").css("opacity",.2).appendTo(this.element))},o._enable=function(){this.$disable&&(this.element[0].removeChild(this.$disable[0]),this.$disable=null)},o._destroy=function(){this._destroyResizable(),this._destroyDraggable(),this._mouseDestroy(),this.element.off(this.eventNamespace),t(window).unbind(this.eventNamespace),this.element.empty(),this.element.css("height",""),this.element.css("width",""),this.element.removeClass("pq-grid ui-widget ui-widget-content ui-corner-all").removeData()},o.decidePanes=function(){this.pqpanes={v:!1,h:!1};var t=this.pqpanes,e=this.options,i=e.virtualX,r=e.virtualY,o=e.flexHeight,n=e.flexWidth,a=e.numberCell,l=e.freezeRows,s=e.freezeCols;!l||o||!s&&!a.show||n?l&&!o?r||(t.h=!0):!s&&!a.show||n||i||(t.v=!0):(r||(t.h=!0),i||(t.v=!0))},o.collapse=function(t){var e=this,i=this.element,r=this.options,o=r.collapsible,n=o.$collapsible.children("span"),a=function(){n.addClass("ui-icon-circle-triangle-s").removeClass("ui-icon-circle-triangle-n"),i.hasClass("ui-resizable")&&i.resizable("destroy"),e.$toolbar.pqToolbar("disable"),o.collapsed=!0,o._collapsed=!0,o.animating=!1,e._trigger("collapse")};return t=t?t:{},!o._collapsed&&(o.htCapture=i.height(),void(t.animate===!1?(i.height(23),a()):(o.animating=!0,i.animate({height:"23px"},function(){a()}))))},o.expand=function(t){var e=this,i=this.element,r=this.options,o=r.collapsible,n=o.htCapture,a=o.$collapsible.children("span"),l=function(){o._collapsed=!1,o.collapsed=!1,o.refreshAfterExpand?e.refresh():e._refreshResizable(),a.addClass("ui-icon-circle-triangle-n").removeClass("ui-icon-circle-triangle-s"),e.$toolbar.pqToolbar("enable"),o.animating=!1,e._trigger("expand")};return t=t?t:{},o._collapsed!==!1&&void(t.animate===!1?(i.height(n),l()):(o.animating=!0,i.animate({height:n},function(){l()})))},o._createCollapse=function(){var e=this,i=this.$top,r=this.options,o=r.collapsible;if(o.on&&!o.$collapsible){var n=t(["<div class='pq-slider-icon' style='z-index:5;' >","<span class='ui-icon ui-icon-circle-triangle-n'></span>","</div>"].join("")).appendTo(i);o.$collapsible=n,n.mouseover(function(t){n.addClass("ui-state-hover")}).mouseout(function(t){n.removeClass("ui-state-hover")}).click(function(t){o.collapsed?e.expand():e.collapse()})}else!o.on&&o.$collapsible&&(o.$collapsible.remove(),delete o.$collapsible);o.collapsed&&!o._collapsed?e.collapse({animate:!1}):!o.collapsed&&o._collapsed&&e.expand({animate:!1})},o._create=function(){var e=this;this.decidePanes(),this.setEditorPosTimer(),this.iGenerateView=new i(this),this.iKeyNav=new l(this),this.iRefreshColumn=new h(this),this.rowHeight=22,this.hidearr=[],this.hidearrHS=[],this.tables=[];var e=this,r=this.options;this.$tbl=null,this._refreshGridWidthAndHeight(),this._calcThisColModel(),this.iSort=new t.paramquery.cSort(this),this.iSort._refreshSorters(),this._initTypeColumns();var o=this.element;o.empty().addClass("pq-grid ui-widget ui-widget-content"+(r.roundCorners?" ui-corner-all":"")).append(["<div class='pq-grid-top ui-widget-header",r.roundCorners?" ui-corner-top":"","'>","<div class='pq-grid-title",r.roundCorners?" ui-corner-top":"","'>&nbsp;</div>","</div>","<div class='pq-grid-inner' >","<div class='pq-header-outer ui-widget-header'>","</div>","<div class='pq-cont-right' >","<div class='pq-cont'></div>","</div>","</div>","<div class='pq-grid-bottom ui-widget-header",r.roundCorners?" ui-corner-bottom":"","'>","<div class='pq-grid-footer'>&nbsp;</div>","</div>"].join("")),this._trigger("render",null,{dataModel:this.options.dataModel,colModel:this.colModel}),this.$top=t("div.pq-grid-top",o),this.$title=t("div.pq-grid-title",o),r.showTitle||this.$title.css("display","none"),this.$toolbar=t("div.pq-grid-toolbar",o),this.$grid_inner=t("div.pq-grid-inner",o),this.$header_o=t("div.pq-header-outer",this.$grid_inner),r.showTop||this.$top.css("display","none"),this.$bottom=t("div.pq-grid-bottom",o),r.showBottom||this.$bottom.css("display","none"),this.$footer=t("div.pq-grid-footer",o),this.$cont_o=t("div.pq-cont-right",this.$grid_inner),this.$cont_fixed=t("div.pq-cont-fixed",this.$grid_inner);var n=this.$cont=t("div.pq-cont",this.$grid_inner);t(window).bind("resize"+e.eventNamespace,function(t){e._onWindowResize(t)}),n.on("click","td.pq-grid-cell",function(i){if(t.data(i.target,e.widgetName+".preventClickEvent")!==!0)return t(i.target).closest(".pq-grid")[0]==e.element[0]?e._onClickCell(i):void 0}),n.on("click","tr.pq-grid-row",function(i){if(t.data(i.target,e.widgetName+".preventClickEvent")!==!0)return t(i.target).closest(".pq-grid")[0]==e.element[0]?e._onClickRow(i):void 0}),n.on("contextmenu","td.pq-grid-cell",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onRightClickCell(i)}),n.on("contextmenu","tr.pq-grid-row",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onRightClickRow(i)}),n.on("dblclick","td.pq-grid-cell",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onDblClickCell(i)}),n.on("dblclick","tr.pq-grid-row",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onDblClickRow(i)}),n.on("mousedown","td.pq-grid-cell",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onCellMouseDown(i)}),n.on("mousedown","tr.pq-grid-row",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onRowMouseDown(i)}),n.on("mousedown",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onContMouseDown(i)}),n.on("mouseenter","td.pq-grid-cell",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onCellMouseEnter(i,t(this))}),n.on("mouseenter","tr.pq-grid-row",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onRowMouseEnter(i,t(this))}),n.on("mouseleave","td.pq-grid-cell",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onCellMouseLeave(i,t(this))}),n.on("mouseleave","tr.pq-grid-row",function(i){if(t(i.target).closest(".pq-grid")[0]==e.element[0])return e._onRowMouseLeave(i,t(this))}),n.bind("mousewheel DOMMouseScroll",function(t){return e._onMouseWheel(t)});this.$hvscroll=t("<div class='pq-hvscroll-square ui-widget-content'></div>").appendTo(this.$grid_inner),this.$vscroll=t("<div class='pq-vscroll'></div>").appendTo(this.$grid_inner),this.prevVScroll=0;var a=r.scrollModel;void 0===a.lastColumn&&r.virtualX&&(a.lastColumn="auto"),this.$vscroll.pqScrollBar({pace:a.pace,theme:a.theme,steps:r.virtualY,direction:"vertical",cur_pos:0,pageDown:function(t,i){e.iKeyNav.pageDown()},pageUp:function(t,i){e.iKeyNav.pageUp()},drag:function(t,i){var o=r.virtualY;if(!o){var n=i.ratio;e._syncViewWithScrollBarVert(n)}},scroll:function(t,i){var o=r.virtualY;if(o){e.scrollMode=!0,e.setFlexWHCallback(function(){e.iGenerateView.generateView()});var n;n=t.originalEvent&&"drag"==t.originalEvent.type?e._setScrollVNumEles():e._setScrollVNumEles(!0),n<=1&&(e._setScrollHLength(),e._setScrollHVLength())}}});this.$hscroll=t("<div class='pq-hscroll'></div>").appendTo(this.$grid_inner),this.$hscroll.pqScrollBar({
direction:"horizontal",pace:a.pace,theme:a.theme,steps:r.virtualX,cur_pos:0,drag:function(t,i){var o=r.virtualX;if(!o){var n=i.ratio;e._syncViewWithScrollBarHor(n)}},scroll:function(t,i){var o=r.virtualX;o&&e.refresh()}}),this.element.height(""),this.disableSelection(),window.opera?this.$grid_inner.bind("keypress.pq-grid",{that:this},function(i){t(i.target).closest(".pq-grid")[0]==e.element[0]&&e._onKeyPressDown(i)}):this.$grid_inner.bind("keydown.pq-grid",{that:this},function(i){t(i.target).closest(".pq-grid")[0]==e.element[0]&&e._onKeyPressDown(i)}),this._refreshOptions(),this._refreshTitle(),this._refreshDataIndices(),this.iRows=new t.paramquery.cRows(this),this.iCells=new t.paramquery.cCells(this),this.generateLoading(),this._initPager(),this._refreshResizable(),this._refreshDraggable(),this._mouseInit()},o._mouseCapture=function(e){var i=this.options;if(i.virtualX&&i.virtualY)return!1;if(!e.target)return!1;if(t(e.target).closest(".pq-grid")[0]==this.element[0]){if(i.flexHeight&&i.flexWidth)return!1;var r=i.swipeModel;return!(0==r.on||"touch"==r.on&&!t.support.touch)}return!1},o._saveDims=function(){var e=this.$cont;e.data("offsetWidth",e[0].offsetWidth),e.data("offsetHeight",e[0].offsetHeight);var i=this.$tbl;if(i)for(var r=0;r<i.length;r++){var o=i[r],n=t(o);n.data("offsetHeight",o.offsetHeight),n.data("scrollWidth",o.scrollWidth)}var a=this.$tbl_header;if(a)for(var r=0;r<a.length;r++){var o=a[r],l=t(o).parent();l.data("offsetHeight",o.offsetHeight),l.data("scrollWidth",o.scrollWidth)}},o._mouseDown=function(t){return this._saveDims(),this._super.call(this,t)},o._mouseStart=function(t){return this.blurEditor({force:!0}),!0},o._mouseDrag=function(t){return 0!=this._trigger("mouseDrag",t,null)},o._mouseStop=function(t){return 0!=this._trigger("mouseStop",t,null)},o._refreshGridWidthAndHeight=function(){var e,i,r=this.options,o=(r.width+"").indexOf("%")>-1,n=(r.height+"").indexOf("%")>-1,a=this.element;if(o||n){var l=a.parent();if(!l.length)return;var s=l.width(),d=l[0]==document.body?t(document).height():l.height(),h=null,c=function(t){var e=/(-|\+)([0-9]+)/,i=e.exec(t);return i&&3==i.length?parseInt(i[1]+i[2]):0},u=o?c(r.width):0,f=n?c(r.height):0;if(0==s){for(;"BODY"!=l[0].tagName.toUpperCase();){var p=l.parent();if(null==p[0]){h=l;break}l=p}if(h){var g=h.css("position"),v=h.css("left"),w=h.css("top");h.css({position:"absolute",left:"-2000",top:"-2000"}).appendTo(t(document.body)),l=a.parent(),o&&(s=l.width()),n&&(d=l.height()),h.css({position:g,left:v,top:w})}}o&&(e=parseInt(r.width)*s/100+u),n&&(i=parseInt(r.height)*d/100+f)}o||(e=r.width),n||(i=r.height),"auto"!=e&&e<r.minWidth&&(e=r.minWidth),i<r.minHeight&&(i=r.minHeight),a.width(e),a.height(i)};var n,a;o._onWindowResize=function(e){var i,r,o=this.options,l=this.element,s=l.parent();if(s.length&&(i=s.height(),r=s.width(),(null==n||i!=n&&s.closest(".ui-resizable").length||r!=a)&&(n=i,a=r,!(t.support.touch&&o.editModel.indices&&t(document.activeElement).is(".pq-editor-focus"))))){var d=this,h=o.autoSizeInterval,h=void 0===h?0:h;this.autoResizeTimeout&&(clearTimeout(this.autoResizeTimeout),delete this.autoResizeTimeout),this.autoResizeTimeout=window.setTimeout(function(){d._refreshAfterResize(),delete d.autoResizeTimeout},h)}},o._onMouseWheel=function(t){this._saveDims();var e=this.options;if(e.flexHeight)return!0;var i=this,r=i.$vscroll,o=0,t=t.originalEvent;t.wheelDelta?o=t.wheelDelta/120:t.detail&&(o=t.detail*-1/3);var n=r.pqScrollBar("option"),a=parseInt(n.cur_pos),l=parseInt(n.num_eles),s=n.ratio,d=a-o;if(e.virtualY)d>=0&&(r.pqScrollBar("option","cur_pos",a-o),r.pqScrollBar("scroll"));else{var h=s-o/(l-1);h>1?h=1:h<0&&(h=0),r.pqScrollBar("option","ratio",h),r.pqScrollBar("drag")}return!1},o._onDblClickCell=function(e){var i=this,r=t(e.currentTarget),o=i.getCellIndices({$td:r}),n=o.rowIndxPage,a=i.rowIndxOffset,l=n+a,s=o.colIndx;if(null!=s)return 0!=i._trigger("cellDblClick",e,{$td:r,rowIndxPage:n,rowIndx:l,colIndx:s,column:i.colModel[s],rowData:i.data[n]})&&void(i.options.editModel.clicksToEdit>1&&this.isEditableRow({rowIndx:l})&&this.isEditableCell({colIndx:s,rowIndx:l})&&i.editCell({rowIndxPage:n,colIndx:s}))},o._onClickCont=function(t){},o._onClickRow=function(e){var i=this,r=t(e.currentTarget),o=parseInt(r.attr("pq-row-indx")),n=i.rowIndxOffset,a=o+n;if(!isNaN(o)){this.options;return 0!=i._trigger("rowClick",e,{$tr:r,rowIndxPage:o,rowIndx:a,rowData:i.data[o]})&&void 0}},o._onRightClickRow=function(e){var i=this,r=t(e.currentTarget),o=parseInt(r.attr("pq-row-indx")),n=i.rowIndxOffset,a=o+n;if(!isNaN(o)){this.options;return 0!=i._trigger("rowRightClick",e,{$tr:r,rowIndxPage:o,rowIndx:a,rowData:i.data[o]})&&void 0}},o._onDblClickRow=function(e){var i=this,r=t(e.currentTarget),o=parseInt(r.attr("pq-row-indx")),n=i.getRowIndxOffset(),a=o+n;if(0==i._trigger("rowDblClick",e,{$tr:r,rowIndxPage:o,rowIndx:a,rowData:i.data[o]}))return!1},o._isValidCell=function(e){var i=this,r=e.rowData,o=t.trim(e.value),n=e.valueOrig,a=e.column,l=e.silent,s=a.dataIndx,d=this.options,h=d.validation,c=a.validations,u=document.activeElement;if(c&&c.length>0)for(var f=0;f<c.length;f++){var p=c[f],p=t.extend({},h,p),g=p.type,v=p.msg,v=v?v:"&nbsp;",w=p.icon,x=p.cls,x=x?x:"",m="padding:3px 10px;"+p.style,I=p.css,_=!0,b={valid:!1,msg:v,dataIndx:s},q=p.value;if("minLen"==g&&o.length<q)_=!1;else if("maxLen"==g&&o.length>q)_=!1;else if("gt"==g&&o<=q)_=!1;else if("gte"==g&&o<q)_=!1;else if("lt"==g&&o>=q)_=!1;else if("lte"==g&&o>q)_=!1;else if("regexp"==g&&0==new RegExp(q).test(o))_=!1;else if("function"==typeof g){var y={column:a,value:o,rowData:r,msg:v};0==g.call(i.element[0],y)&&(_=!1,y.msg!=v&&(v=y.msg))}if(!_&&l===!0)return b;if(!_){var C=this.getRowIndx({rowData:r}).rowIndx;if(void 0===n){if(null==C)throw"incorrect usage of isValid";this.goToPage({rowIndx:C}),this.editCell({rowIndx:C,dataIndx:s})}else if(t(u).hasClass("pq-editor-focus")){var M=d.editModel.indices;if(M){var D=M.rowIndx,P=M.dataIndx;if(null!=C&&C!=D)throw"incorrect usage of isValid rowIndx: "+C;if(s!=P)throw"incorrect usage of isValid dataIndx: "+s;this.editCell({rowIndx:D,dataIndx:s})}}var R=this.getEditCell();if(R&&R.$cell){var $=R.$cell;$.attr("title",v);try{$.tooltip("destroy")}catch(t){}$.tooltip({position:{my:"left center+5",at:"right center"},content:function(){var e=(t(this),""==w?"":"<span class='ui-icon "+w+" pq-tooltip-icon'></span>");return e+v},open:function(t,e){if(x&&e.tooltip.addClass(x),m){var i=e.tooltip.attr("style");e.tooltip.attr("style",i+";"+m)}I&&e.tooltip.css(I)}}).tooltip("open")}return b}}if(void 0!==n){var R=this.getEditCell();if(R&&R.$cell){var $=R.$cell;$.removeAttr("title");try{$.tooltip("destroy")}catch(t){}}}return{valid:!0}},o.isValid=function(t){var e=this.getRowData(t),i=t.dataIndx;if(null==i)for(var r=this.colModel,o=0,n=r.length;o<n;o++){var a=r[o],l=a.hidden;if(!l){var i=a.dataIndx,s=e[i],d=this._isValidCell({rowData:e,value:s,column:a,silent:t.silent});if(!d.valid)return d}}else{var a=this.getColumn({dataIndx:i}),s=void 0===t.value?e[i]:t.value,d=this._isValidCell({rowData:e,value:s,valueOrig:t.value,column:a,silent:t.silent});if(!d.valid)return d}return{valid:!0}},o.isEditableRow=function(t){var e=this.options,i=e.editable;if(null!=i){if("function"==typeof i){var r=t.rowIndx,o=e.dataModel.data[r];return i.call(this.element[0],{rowData:o,rowIndx:r})}return i}return!0},o.isEditableCell=function(t){var e=t.colIndx,i=t.dataIndx,e=null==e?this.getColIndx({dataIndx:i}):e,r=this.colModel[e],i=null==i?r.dataIndx:i,o=r.editable;if(t.checkVisible&&r.hidden)return!1;if(null!=o){if("function"==typeof o){var n=t.rowIndx,a=this.getRowData(t);return o.call(this.element[0],{rowIndx:n,rowData:a,column:r,dataIndx:i})}return o}return!0},o._getRowPQData=function(t,e,i){var i=null==i?this.data[t]:i;return i?i[e]:null},o._setRowPQData=function(t,e,i){var i=null==i?this.data[t]:i;if(i)for(var r in e)i[r]=e[r]},o._onContMouseDown=function(t){this.blurEditor({blurIfFocus:!0});var e=this,i={dataModel:e.options.dataModel};return e._trigger("contMouseDown",t,i)!==!1},o._onCellMouseDown=function(e){var i=this,r=t(e.currentTarget),o=i.getCellIndices({$td:r});return o.$td=r,o.dataModel=i.options.dataModel,0!=i._trigger("cellMouseDown",e,o)},o._onRowMouseDown=function(e){var i=this,r=t(e.currentTarget),o=i.getRowIndx({$tr:r});return o.$tr=r,o.dataModel=i.options.dataModel,0!=i._trigger("rowMouseDown",e,o)},o._onCellMouseEnter=function(t,e){var i=e,r=this.options,o=this.getCellIndices({$td:i}),n=this;return n._trigger("cellMouseEnter",t,o)!==!1&&("cell"==r.hoverMode&&n.highlightCell(i),!0)},o._onRowMouseEnter=function(t,e){var i=e,r=this.options,o=this,n=o.getRowIndx({$tr:i}),a=n.rowIndxPage;return o._trigger("rowMouseEnter",t,n)!==!1&&("row"==r.hoverMode&&o.highlightRow(a),!0)},o._onCellMouseLeave=function(t,e){var i=e,r=this;return"cell"==r.options.hoverMode&&r.unHighlightCell(i),!0},o._onRowMouseLeave=function(t,e){var i=e,r=this,o=r.getRowIndx({$tr:i}),n=o.rowIndxPage;return"row"==r.options.hoverMode&&r.unHighlightRow(n),!0},o._onCellMouseUp=function(e){var i=this,r=t(e.currentTarget),o=i.getCellIndices({$td:r});return o.$td=r,o.dataModel=i.options.dataModel,0!=i._trigger("cellMouseUp",e,o)},o._onRowMouseUp=function(e){var i=this,r=t(e.currentTarget),o=i.getRowIndx({$tr:r});return 0!=i._trigger("rowMouseUp",e,o)},o._onClickCell=function(e){var i=this,r=this.options,o=this.colModel,n=r.editModel,a=(r.selectionModel,t(e.currentTarget)),l=i.getCellIndices({$td:a}),s=l.rowIndxPage,d=i.rowIndxOffset,h=s+d,c=l.colIndx;if(l.rowIndx=h,null!=c){var u=o[c],f=u.dataIndx;return l.dataIndx=f,l.evt=e,0!=i._trigger("cellClick",e,{$td:a,rowIndxPage:s,rowIndx:h,colIndx:c,dataIndx:f,column:u,rowData:i.data[s]})&&(1==n.clicksToEdit&&this.isEditableRow({rowIndx:h})&&this.isEditableCell({colIndx:c,rowIndx:h})?void i.editCell(l):void 0)}},o._onRightClickCell=function(e){var i=t(e.currentTarget),r=this.getCellIndices({$td:i}),o=this,n=r.rowIndxPage,a=this.rowIndxOffset,l=n+a,s=r.colIndx,d=this.colModel,h=this.options;h.DM;if(null!=s){var c=d[s],u=c.dataIndx;return 0!=this._trigger("cellRightClick",e,{$td:i,rowIndxPage:n,rowIndx:l,colIndx:s,dataIndx:u,column:c,rowData:o.data[n]})&&void 0}},o.highlightCell=function(t){t.addClass("pq-grid-cell-hover ui-state-hover")},o.unHighlightCell=function(t){t.removeClass("pq-grid-cell-hover ui-state-hover")},o.highlightRow=function(t){if(isNaN(t));else{var e=this.getRow({rowIndxPage:t});e&&e.addClass("pq-grid-row-hover ui-state-hover")}},o.unHighlightRow=function(t){if(isNaN(t));else{var e=this.getRow({rowIndxPage:t});e&&e.removeClass("pq-grid-row-hover ui-state-hover")}},o._getCreateEventData=function(){return{dataModel:this.options.dataModel,data:this.data,colModel:this.options.colModel}},o._refreshOptions=function(){this._refreshDataOptions()},o._refreshDataOptions=function(){},o.enableSelection=function(){this.$cont.enableSelection()},o.disableSelection=function(){this.$cont.disableSelection(),this.$header_o.find("tr.pq-grid-title-row").disableSelection()},o._findCellFromEvt=function(e){var i=t(e.target),r=i.closest(".pq-grid-cell");if(null==r||0==r.length)return{rowIndxPage:null,colIndx:null,$td:null};var o=this.getCellIndices({$td:r});return o.$td=r,o},o._initPager=function(){var t=this.options.pageModel,e=this,i={change:function(t,i){e.blurEditor({force:!0});var r=e.options.pageModel;void 0!=i.curPage&&(r.prevPage=r.curPage,r.curPage=i.curPage),void 0!=i.rPP&&(r.rPP=i.rPP),"remote"==r.type?e.remoteRequest({callback:function(){e._onDataAvailable({apply:!0})}}):e.refreshView()},refresh:function(t){e.refreshDataAndView()}};t.type&&this.$footer.pqPager(i)},o._refreshHideArrHS=function(){for(var t=this,e=this.colModel,i=t.hidearrHS,r=t.initH,o=t.finalH,n=parseInt(this.options.freezeCols),a=0;a<n;a++)i[a]=!1;for(var a=n;a<r;a++)i[a]=!0;for(var a=r;a<=o;a++)i[a]=!1;for(var a=o+1,l=e.length;a<l;a++)i[a]=!0},o.generateLoading=function(){this.$loading&&this.$loading.remove(),this.$loading=t("<div class='pq-loading'></div>").appendTo(this.element),t(["<div class='pq-loading-bg'></div><div class='pq-loading-mask ui-state-highlight'><div>",this.options.strLoading,"...</div></div>"].join("")).appendTo(this.$loading),this.$loading.find("div.pq-loading-bg").css("opacity",.2)},o._refreshLoadingString=function(){this.$loading.find("div.pq-loading-mask").children("div").html(this.options.strLoading)},o.showLoading=function(){null==this.showLoadingCounter&&(this.showLoadingCounter=0),this.showLoadingCounter++,this.$loading.show()},o.hideLoading=function(){this.showLoadingCounter>0&&this.showLoadingCounter--,this.showLoadingCounter||this.$loading.hide()},o.refreshDataFromDataModel=function(){this._trigger("beforeRefreshData",null,{});var t=this.options,e=t.dataModel,i=t.pageModel,r=e.data,o=i.type;if(this.rowIndxOffset=0,null==r||0==r.length)return o&&(i.curPage=0,i.totalPages=0,i.totalRecords=0),void(this.data=r);if(o&&"local"==o){i.totalRecords=r.length,i.totalPages=Math.ceil(r.length/i.rPP),i.curPage>i.totalPages&&(i.curPage=i.totalPages),i.curPage<1&&i.totalPages>0&&(i.curPage=1);var n=(i.curPage-1)*i.rPP,a=i.curPage*i.rPP;a>r.length&&(a=r.length),this.data=r.slice(n,a)}else if("remote"==o){var l=Math.ceil(i.totalRecords/i.rPP);i.totalPages=l,l&&!i.curPage&&(i.curPage=1);var a=i.rPP;a>r.length&&(a=r.length),this.data=r.slice(0,a)}else this.data=r.slice(0);"local"!=o&&"remote"!=o||(this.rowIndxOffset=i.rPP*(i.curPage-1))},t.paramquery.filter=function(){var t={begin:{text:"Begins With",TR:!0,string:!0},between:{text:"Between",TR:!0,string:!0,date:!0,number:!0},notbegin:{text:"Does not begin with",TR:!0,string:!0},contain:{text:"Contains",TR:!0,string:!0},notcontain:{text:"Does not contain",TR:!0,string:!0},equal:{text:"Equal To",TR:!0,string:!0,bool:!0},notequal:{text:"Not Equal To",TR:!0,string:!0},empty:{text:"Empty",TR:!1,string:!0,bool:!0},notempty:{text:"Not Empty",TR:!1,string:!0,bool:!0},end:{text:"Ends With",TR:!0,string:!0},notend:{text:"Does not end with",TR:!0,string:!0},less:{text:"Less Than",TR:!0,number:!0,date:!0},lte:{text:"Less than or equal",TR:!0,number:!0,date:!0},range:{TR:!0,string:!0,number:!0,date:!0},regexp:{TR:!0,string:!0,number:!0,date:!0},great:{text:"Great Than",TR:!0,number:!0,date:!0},gte:{text:"Greater than or equal",TR:!0,number:!0,date:!0}};return{conditions:t,getAllConditions:function(){var e=[];for(var i in t)e.push(i);return e}(),getConditions:function(e){var i=[];for(var r in t)t[r][e]&&i.push(r);return i},getTRConditions:function(){var e=[];for(var i in t)t[i].TR&&e.push(i);return e}(),getWTRConditions:function(){var e=[];for(var i in t)t[i].TR||e.push(i);return e}()}}(),t.paramquery.filter.rules={},t.paramquery.filter.rules.en={begin:"Begins With",between:"Between",notbegin:"Does not begin with",contain:"Contains",notcontain:"Does not contain",equal:"Equal To",notequal:"Not Equal To",empty:"Empty",notempty:"Not Empty",end:"Ends With",notend:"Does not end with",less:"Less Than",lte:"Less than or equal",great:"Great Than",gte:"Greater than or equal"},o.getQueryStringSort=function(){var t=this.iSort.sorters,e="",i=this.options,r=i.sql,o=i.stringify;if(r){for(var n=0;n<t.length;n++){var a=t[n],l=a.dataIndx,s="up"==a.dir?"asc":"desc";e+=(n>0?", ":"")+l+" "+s}return e}return t.length?o===!1?t:JSON.stringify(t):""},o.getQueryStringCRUD=function(){return""},o.getQueryStringFilter=function(){var e=this.options,i=e.sql,r=e.stringify,o=e.filterModel,n=o.mode,a=this.colModel,l=this.getFilterData({CM:a,location:"remote"}),s="";if(o&&o.on&&l)if(i){s=[];for(var d=0;d<l.length;d++){var h=l[d],c=h.condition,u=h.dataIndx,f=t.trim(h.value);"contain"===c?s.push(u+" like '%"+f+"%'"):"notcontain"===c?s.push(u+" not like '%"+f+"%'"):"begin"===c?s.push(u+" like '"+f+"%'"):"end"===c?s.push(u+" like '%"+f+"'"):"equal"===c?s.push(u+"='"+f+"'"):"notequal"===c?s.push(u+"!='"+f+"'"):"empty"===c?s.push("isnull("+u+",'')=''"):"notempty"===c?s.push("isnull("+u+",'')!=''"):"less"===c?s.push(u+"<'"+f+"'"):"great"===c&&s.push(u+">'"+f+"'")}s=s.join(" "+n+" ")}else if(l.length){var p={mode:n,data:l};s=r===!1?p:JSON.stringify(p)}else s="";return s},o.remoteRequest=function(e){this.loading&&this.xhr.abort();var i=this,r="",o="",n=this.options,a=!1,l=this.colModel,s=n.dataModel,d=n.filterModel,h=n.pageModel;if("function"==typeof s.getUrl){var c={colModel:l,dataModel:s,groupModel:n.groupModel,pageModel:h,filterModel:d},u=s.getUrl.call(this.element[0],c);u&&u.url&&(r=u.url),u&&u.data&&(o=u.data)}else if("string"==typeof s.url){r=s.url;var f={},p={},g={};if("remote"==s.sorting){var v=this.getQueryStringSort();v&&(f={pq_sort:v})}"remote"==h.type&&(g={pq_curpage:h.curPage,pq_rpp:h.rPP});var w;"local"!=d.type&&(w=this.getQueryStringFilter(),w&&(a=!0,p={pq_filter:w}));var x=s.postData,m=s.postDataOnce;x&&"function"==typeof x&&(x=x.call(this.element[0],{colModel:l,dataModel:s})),o=t.extend({pq_datatype:s.dataType},p,g,f,x,m)}r&&(this.loading=!0,this.showLoading(),this.xhr=t.ajax({url:r,dataType:s.dataType,async:null==s.async||s.async,cache:s.cache,contentType:s.contentType,type:s.method,data:o,beforeSend:function(t,e){if("function"==typeof s.beforeSend)return s.beforeSend.call(i.element[0],t,e)},success:function(t,r,o){if("function"==typeof s.getData){var n=s.getData.call(i.element[0],t,r,o);s.data=n.data,h.type&&"remote"==h.type&&(n.curPage&&(h.curPage=n.curPage),n.totalRecords&&(h.totalRecords=n.totalRecords))}else s.data=t.data,h.type&&"remote"==h.type&&(t.curPage&&(h.curPage=t.curPage),t.totalRecords&&(h.totalRecords=t.totalRecords));i.hideLoading(),i.loading=!1,i._trigger("load",null,{dataModel:s,colModel:l}),a&&i._trigger("filter",null,{type:"remote",dataModel:s,colModel:l,filterModel:d}),e&&e.callback&&e.callback()},error:function(t,e,r){if(i.hideLoading(),i.loading=!1,"function"==typeof s.error)s.error.call(i.element[0],t,e,r);else if("abort"!=r)throw"Error : "+r}}))},o._fixFireFoxContentEditableIssue=function(){window.postMessage},o.setFlexWHCallback=function(t){var e=this;t.call(e);var i=this.options;i.flexHeight&&this._setGridHeightFromTable(),i.flexWidth&&this._setGridWidthFromTable()},o._refreshTitle=function(){this.$title.html(this.options.title)},o._destroyDraggable=function(){var t=this.element,e=t.parent(".pq-wrapper");e.length&&e.data("draggable")&&(e.draggable("destroy"),this.$title.removeClass("pq-draggable"),t.unwrap(".pq-wrapper"))},o._refreshDraggable=function(){var t=this.options,e=this.element,i=this.$title;if(t.draggable){i.addClass("pq-draggable");var r=e.parent(".pq-wrapper");r.length||e.wrap("<div class='pq-wrapper' />"),e.parent(".pq-wrapper").draggable({handle:i})}else this._destroyDraggable()},o._refreshResizable=function(){var e=this,i=this.element,r=this.options,o=(r.width+"").indexOf("%")>-1,n=(r.height+"").indexOf("%")>-1,a="auto"==r.width,l=r.flexWidth,s=r.flexHeight;if(!r.resizable||(s||n)&&(l||o||a))this._destroyResizable();else{var d="e,s,se";s||n?d="e":(l||o||a)&&(d="s");var h=!0;if(i.hasClass("ui-resizable")){var c=i.resizable("option","handles");d==c?h=!1:this._destroyResizable()}h&&i.resizable({helper:"ui-state-default",handles:d,minWidth:r.minWidth,minHeight:r.minHeight?r.minHeight:100,delay:0,start:function(e,i){t(i.helper).css({opacity:.5,background:"#ccc",border:"1px solid steelblue"})},resize:function(t,e){},stop:function(i,l){n||(r.height=e.element.height()),o||a||(r.width=e.element.width()),e.refresh(),e.element.css("position","relative"),t(window).trigger("resize")}})}},o._refreshAfterResize=function(){var t=this.options,e=t.width,i=t.height,r=(e+"").indexOf("%")!=-1,o="auto"===e,n=(i+"").indexOf("%")!=-1;(r||o||n)&&this.refresh()},o.refresh=function(t){this._refresh(t)},o._refreshDataIndices=function(){if(0!=this.options.getDataIndicesFromColIndices)for(var t=this.colModel,e=t.length,i=0;i<e;i++){var r=t[i];null==r.dataIndx&&(r.dataIndx=i)}},o.refreshView=function(t){null!=this.options.editModel.indices&&this.blurEditor({force:!0}),this.refreshDataFromDataModel(),this.refresh(t)},o._refresh=function(t){t=t||{};var e=t.header,i=t.table,r=this.element;if(r[0].offsetWidth){this.$grid_inner[0].scrollTop=0;var o=this.options;o.virtualX&&o.virtualY?this.pqpanes={v:!1,h:!1}:this.decidePanes(),o.collapsible._collapsed=!1;var n=this;this._refreshGridWidthAndHeight(),this._refreshDataIndices(),this.iRefreshColumn.refreshColumnWidths(),this._setScrollHNumEles(),this._bufferObj_calcInitFinalH(),this._refreshHideArrHS(),e!==!1&&this._createHeader(),this._refreshHeaderSortIcons(),this._refreshPager(),this._setInnerGridHeight(),this._setRightGridHeight(),r.height(""),this.setFlexWHCallback(function(){i!==!1?n.iGenerateView.generateView():(n._saveDims(),n.iGenerateView.scrollView())}),this._refreshScrollbars(),this._refreshFreezeLine(),this._createCollapse(),o.dataModel.postDataOnce=void 0}},o._refreshScrollbars=function(t){this._setScrollHLength(),this._setScrollVLength(),this._setScrollVNumEles(!0),this._setScrollHLength(),this._setScrollHVLength()},o._setScrollHVLength=function(){var t=this.options;(this.$hscroll.is(":hidden")||t.flexHeight||t.flexWidth)&&this.$hvscroll.css("visibility","hidden")},o._refreshPager=function(){var t=this.options,e=t.pageModel,i=this.$footer,r=!!e.type,o=e.rPP,n=e.totalRecords;if(r){var a=t.pageModel;0==i.hasClass("pq-pager")&&this._initPager(),i.pqPager("option",a),n>o&&this.$bottom.css("display","")}else i.hasClass("pq-pager")&&i.pqPager("destroy"),t.showBottom?this.$bottom.css("display",""):this.$bottom.css("display","none")},o.getThis=function(){return{that:this}},o._addRowsData=function(t){var e=t.data,i=this.options.dataModel.data,r=t.rowIndx;if(null==i&&(i=[]),null==r)for(var o=0,n=e.length;o<n;o++){var a=e[o];i.push(a)}else{if(!(r<i.length))return!1;for(var o=0,n=e.length;o<n;o++){var a=e[o];i.splice(r,0,a),r++}}return!0},o.addRows=function(t){return!!this._addRowsData(t)&&(this.refreshDataFromDataModel(),this.refresh(),!0)},o.refreshDataAndView=function(t){var e=this.options.dataModel;if(this.iSort._refreshSorters(),"remote"==e.location){var i=this;this.remoteRequest({callback:function(){i._onDataAvailable(t)}})}else this._onDataAvailable(t)},o.getColIndx=function(t){var e=t.dataIndx;if(void 0===e)throw"dataIndx NA";for(var i=this.colModel,r=0,o=i.length;r<o;r++)if(i[r].dataIndx==e)return r},o.getColumn=function(t){if(void 0===t.dataIndx)throw"dataIndx N/A";for(var e=t.dataIndx,i=this.colModel,r=0,o=i.length;r<o;r++){var n=i[r];if(n.dataIndx==e)return n}return null},o._onDataAvailable=function(){},o._setOption=function(t,e){var i=this.options;if("height"==t)this._super.call(this,t,e);else if("width"==t)this._super.call(this,t,e);else if("title"==t)this._super.call(this,t,e),this._refreshTitle();else if("roundCorners"==t)this._super.call(this,t,e),e?(this.element.addClass("ui-corner-all"),this.$top.addClass("ui-corner-top"),this.$bottom.addClass("ui-corner-bottom")):(this.element.removeClass("ui-corner-all"),this.$top.removeClass("ui-corner-top"),this.$bottom.removeClass("ui-corner-bottom"));else if("freezeCols"==t)e=parseInt(e),!isNaN(e)&&e>=0&&e<=this.colModel.length-2&&this._super.call(this,t,e);else if("freezeRows"==t)e=parseInt(e),!isNaN(e)&&e>=0&&this._super.call(this,t,e);else if("resizable"==t)this._super.call(this,t,e),this._refreshResizable();else if("draggable"==t)this._super.call(this,t,e),this._refreshDraggable();else if("scrollModel"==t)this._super.call(this,t,e);else if("dataModel"==t)this._super.call(this,t,e);else if("pageModel"==t)this._super.call(this,t,e);else if("selectionModel"===t)this._super.call(this,t,e);else if("colModel"===t||"columnTemplate"==t)this._super.call(this,t,e),this._calcThisColModel();else if("disabled"===t)this._super.call(this,t,e),e===!0?this._disable():this._enable();else if("numberCell"===t)this._super.call(this,t,e),this.decidePanes();else if("strLoading"===t)this._super.call(this,t,e),this._refreshLoadingString();else if("showTop"===t)this._super.call(this,t,e),e===!0?this.$top.css("display",""):this.$top.css("display","none");else if("showTitle"===t)this._super.call(this,t,e),e===!0?this.$title.css("display",""):this.$title.css("display","none");else if("showToolbar"===t)this._super.call(this,t,e),e===!0?this.$toolbar.css("display",""):this.$toolbar.css("display","none");else if("toolbar"==t)this._super.call(this,t,e),this.$toolbar.remove(),this._super.call(this,t,e),this._createToolbar();else if("collapsible"===t)this._super.call(this,t,e),this._createCollapse();else if("showBottom"===t)this._super.call(this,t,e),e===!0?this.$bottom.css("display",""):this.$bottom.css("display","none");else if("flexHeight"===t){this._super.call(this,t,e);var r=this.$vscroll;e&&r&&r.hasClass("pq-sb-vert")&&(i.virtualY?r.pqScrollBar("option","cur_pos",0):r.pqScrollBar("option","ratio",0))}else if("flexWidth"===t){this._super.call(this,t,e);var o=this.$hscroll;e&&o&&o.hasClass("pq-sb-horiz")&&(i.virtualX?o.pqScrollBar("option","cur_pos",0):o.pqScrollBar("option","ratio",0))}else this._super.call(this,t,e)},o._setOptions=function(){this._super.apply(this,arguments)},o._generateCellRowOutline=function(){var e=this.options,i=e.editModel;if(this.$div_focus){if(e.debug)throw"this.$div_focus already present assert failed"}else{var r=this.element;i.inline&&(r=this.getCell(i.indices),r.css("padding",0).empty()),this.$div_focus=t(["<div class='pq-editor-outer'>","<div class='pq-editor-inner'>","</div>","</div>"].join("")).appendTo(r);var o=t.extend({all:!0},i.indices),n=this.getCell(o);n.css("height",n.height()),n.empty(),this.refreshEditorPos()}},o._removeCellRowOutline=function(e){function i(t){t.hasClass("hasDatepicker")&&t.datepicker("hide").datepicker("destroy")}if(this.$div_focus){var r=this.$div_focus.find(".pq-editor-focus");if(i(r),r[0]==document.activeElement){var o=this._blurEditMode;this._blurEditMode=!0,r.blur(),this._blurEditMode=o}this.$div_focus.remove(),delete this.$div_focus;var n=this.options.editModel,a=t.extend({},n.indices);n.indices=null,this.refreshCell(a)}},o.refreshEditorPos=function(){var t=this.options,e=t.editModel,i=e.cellBorderWidth,r=this.$div_focus,o=this.getCell(e.indices),n=o[0].offsetWidth-(i?2*i:1),a=o[0].offsetHeight-(i?2*i:1),l=this.element.offset(),s=o.offset(),d=s.left-l.left-1,h=s.top-l.top-1;r.css({height:a,width:n,borderWidth:i,left:d,top:h})},o.setEditorPosTimer=function(){var t=this,e=this.options;this._refreshEditorPosTimer&&(window.clearInterval(this._refreshEditorPosTimer),this._refreshEditorPosTimer=null),this._refreshEditorPosTimer=window.setInterval(function(){var i=e.editModel;i.indices&&t.refreshEditorPos()},200)},o._onHeaderCellClick=function(t,e){var i=this,r=i.colModel[t],o=this.options,n=(o.dataModel,r.dataIndx);r.dataType;i._trigger("headerCellClick",e,{column:r,colIndx:t,dataIndx:n})!==!1&&o.sortable&&0!=r.sortable&&this.sort({colIndx:t,column:r,dataIndx:n})},o._selectRow=function(t,e){this.selectRow(t,e)},o._findfirstUnhiddenColIndx=function(){for(var t=0;t<this.colModel.length;t++)if(!this.colModel[t].hidden)return t},o.selectRow=function(t){var e=(t.rowIndx,t.evt);t.offset;if(!e||"keydown"!=e.type&&"keypress"!=e.type){if(0==this.iRows.add(t))return!1}else if(0==this.iRows.replace(t))return!1;return!0},o.get$Tbl=function(e,i){var r=this.$tbl,o=[];if(r&&r.length){var n=this.pqpanes,a=this.options,l=a.freezeRows,s=a.freezeCols;return n.h&&n.v?null==i?e>=l?o.push(r[2],r[3]):o.push(r[0],r[1]):o=i>=s&&e>=l?r[3]:i<s&&e>=l?r[2]:i>=s&&e<l?r[1]:r[0]:o=n.v?null==i?r:i>=s?r[1]:r[0]:n.h&&e>=l?r[1]:r[0],o?t(o):void 0}},o.scrollCell=function(t){this.scrollRow(t),this.scrollColumn(t)},o.scrollY=function(t){this.$vscroll.pqScrollBar("option","cur_pos",t).pqScrollBar("scroll")},o.scrollRow=function(t){var e=this.options;e.virtualY?this._scrollRowVirtualY(t):this._scrollRowNonVirtualY(t)},o._scrollRowNonVirtualY=function(t){var e=this.options,i=t.rowIndxPage,r=!!this.iHierarchy,o=t.rowIndx,n=this.$cont.data("offsetHeight")-this._getScollBarHorizontalHeight(),i=null==i?o-this.rowIndxOffset:i,a=parseInt(e.freezeRows);if(!(i<a)){var l=this.get$Tbl(i),s=this.getRow({rowIndxPage:i}),d=s[0],h=d.offsetTop+parseInt(l.css("marginTop")),c=d.offsetHeight;if(r){var u=s.next("tr.pq-detail-child");u&&u.length&&(c+=u[0].offsetHeight)}d.offsetTop+l[0].offsetTop;if(d.offsetTop<-1*l[0].offsetTop){var f=-1*d.offsetTop-parseInt(l.css("top"));l.css("marginTop",f),this._syncScrollBarVert()}else if(h+c>=n){var f=n-c-d.offsetTop;l.css("marginTop",f),this._syncScrollBarVert()}}},o._scrollRowVirtualY=function(t){var e=this.options,i=t.rowIndxPage,r=!!this.iHierarchy,o=t.rowIndx,n=this.scrollCurPos,i=null==i?o-this.rowIndxOffset:i,a=parseInt(e.freezeRows);if(!(i<a)){var l=this._calcCurPosFromRowIndxPage(i);if(null!=l){l<n&&this.$vscroll.pqScrollBar("option","cur_pos",l).pqScrollBar("scroll");var s=this.get$Tbl(i),d=s.children("tbody").children("tr[pq-row-indx="+i+"]"),h=d.last(),c=h;d.length>1&&(c=d.first());var u=h[0],f=parseInt(s.css("marginTop"));if(void 0==u)this.$vscroll.pqScrollBar("option","cur_pos",l).pqScrollBar("scroll");else{var p=u.offsetTop+u.offsetHeight,g=this.$cont[0].offsetHeight,v=f,w=this._getScollBarHorizontalHeight(),x=c.prev("tr");if(x.hasClass("pq-row-hidden")||x.hasClass("pq-last-freeze-row"))return;if(p>g-w-v){var m,I=p-(g-w-v),d=s.children().children("tr"),_=0,b=0;for(a?(m=d.filter("tr.pq-last-freeze-row").last().next(),0==m.length&&(m=d.filter("tr.pq-row-hidden").next())):m=d.filter("tr.pq-row-hidden").next();;){if(_+=m[0].offsetHeight,m[0]==h[0])break;if(r&&0!=m.hasClass("pq-detail-child")){if(_>=I)break}else if(b++,_>=I)break;m=m.next()}var q=n+b;q>l&&(q=l);var y=this.$vscroll.pqScrollBar("option","num_eles");y<q+1&&(y=q+1),this.$vscroll.pqScrollBar("option",{num_eles:y,cur_pos:q}).pqScrollBar("scroll")}}}}},o.getTableForVertScroll=function(){var e=this,i=e.pqpanes,r=e.$tbl;if(r&&r.length)return i.h&&i.v?r=t([r[2],r[3]]):i.v?r=t([r[0],r[1]]):i.h&&(r=t(r[1])),r},o.getTableForHorScroll=function(){var e=this,i=e.pqpanes,r=[],o=e.$tbl;if(o&&o.length){if(i.h&&i.v?r.push(o[1],o[3]):i.v?r.push(o[1]):i.h?r.push(o[0],o[1]):r.push(o[0]),this.tables.length){var n=this.tables[0].$tbl;i.v?r.push(n[1]):r.push(n[0])}return t(r)}},o.getTableHeaderForHorScroll=function(){var e=this,i=e.pqpanes,r=e.$tbl_header;if(r&&r.length)return r=t(i.v?r[1]:r[0]),r.parent()},o.blurEditor=function(t){if(this.$div_focus){var e=this.$div_focus.find(".pq-editor-focus");if(!t||!t.blurIfFocus)return e.triggerHandler("blur",t);document.activeElement==e[0]&&e.blur()}},o._syncViewWithScrollBarVert=function(t){if(null!=t){var e=this,i=e.getTableForVertScroll();if(i&&i.length){var r=this.options;r.editModel.indices&&this.blurEditor({force:!0});var o=i.data("offsetHeight"),n=e.$cont.data("offsetHeight")-e._getScollBarHorizontalHeight(),a=o-n,l=a*t,l=-1*l-1;if((!o||!n)&&r.debug)throw"_syncViewWithScrollBarVert !tblHt || !contHt";l>-1&&(l=-1),i.css({marginTop:l})}}},o._syncViewWithScrollBarHor=function(t){if(null!=t){var e=this,i=e.getTableForHorScroll(),r=e.getTableHeaderForHorScroll();if(i||r){var o=this.options;o.editModel.indices&&this.blurEditor({force:!0});var n=i?i:r,a=n.data("scrollWidth"),l=e.$cont.data("offsetWidth")-e._getSBWidth(),s=a-l,d=s*t,d=-1*d;if(!a||!l)return void o.debug;d>0&&(d=0),i&&i.css("marginLeft",d),r&&r.css("marginLeft",d)}}},o._syncScrollBarVert=function(){var t=this,e=t.getTableForVertScroll();if(e&&e.length){var i=e.data("offsetHeight"),r=t.$cont.data("offsetHeight")-t._getScollBarHorizontalHeight(),o=i-r,n=-1*parseInt(e.css("marginTop")),a=(n-1)/(o-1);a>=0&&a<=1&&t.$vscroll.hasClass("pq-sb-vert")&&t.$vscroll.pqScrollBar("option","ratio",a)}},o._syncScrollBarHor=function(){var t=this,e=t.getTableForHorScroll(),i=t.getTableHeaderForHorScroll();if(e||i){var r=e?e:i,o=r.data("scrollWidth"),n=t.$cont.data("offsetWidth")-t._getSBWidth(),a=o-n,l=-1*parseInt(r.css("marginLeft")),s=l/a;s>=0&&s<=1&&t.$hscroll.hasClass("pq-sb-horiz")&&t.$hscroll.pqScrollBar("option","ratio",s)}},o._scrollColumnNonVirtual=function(t){var e=t.colIndx,e=null==e?this.getColIndx({dataIndx:t.dataIndx}):e,i=this.options.freezeCols;if(!(e<i)){var r,o,n=this._calcRightEdgeCol(e).width,a=this._calcRightEdgeCol(e-1).width,l=this._calcRightEdgeCol(i-1).width,s=this._getSBWidth(),d=this.getTableForHorScroll(),h=this.getTableHeaderForHorScroll(),c=this.$cont[0].offsetWidth-s;
if(d)r=parseInt(d.css("marginLeft")),o=d[0].offsetLeft;else{if(!h)return;r=parseInt(h.css("marginLeft")),o=h[0].offsetLeft-l}n+r>c?(r=c-n,d&&d.css("marginLeft",r),h&&h.css("marginLeft",r),this._syncScrollBarHor()):a<-1*o&&(r=-1*a+l,d&&d.css("marginLeft",r),h&&h.css("marginLeft",r),this._syncScrollBarHor())}},o._scrollColumnVirtual=function(t){var e=t.colIndx,e=null==e?this.getColIndx({dataIndx:t.dataIndx}):e,i=this.options.freezeCols,r=this._calcRightEdgeCol(e).width,o=this._getSBWidth(),n=this.$cont[0].offsetWidth;if(r>n-o){for(var a=d.call(this,-1,e+1)-(n-o),l=this.colModel,s=l.length,h=0,c=0,u=i;u<s;u++){var f=l[u];if(f.hidden||(h+=f.outerWidth),u==e){c=u-i-this._calcNumHiddenUnFrozens(u);break}if(h>=a){c=u-i-this._calcNumHiddenUnFrozens(u)+1;break}}return this.$hscroll.pqScrollBar("option","cur_pos",c).pqScrollBar("scroll"),!0}if(this.hidearrHS[e]){this.hidearrHS[e]=!1;var p=e-i-this._calcNumHiddenUnFrozens(e);return this.$hscroll.pqScrollBar("option","cur_pos",p).pqScrollBar("scroll"),!0}return!1},o.scrollColumn=function(t){var e=this.options,i=e.virtualX;return i?this._scrollColumnVirtual(t):this._scrollColumnNonVirtual(t)},o.selection=function(t){var e=(t.rowIndx,t.colIndx,t.method),i=t.type;return"row"==i?this.iRows[e](t):"cell"==i?this.iCells[e](t):void 0},o._bringPageIntoView=function(t){var e=t.rowIndx,i=this.options.pageModel;if("local"==i.type&&e>=0){var r=i.curPage,o=i.rPP,n=(r-1)*o,a=r*o;e>=n&&e<a||(i.curPage=Math.ceil((e+1)/o),this.refreshDataFromDataModel(),this.refresh())}},o.goToPage=function(t){var e=this.options.pageModel;if("local"==e.type||"remote"==e.type){var i=t.rowIndx,r=e.rPP,o=null==t.page?Math.ceil((i+1)/r):t.page,n=e.curPage;o!=n&&(e.curPage=o,"local"==e.type?(this.refreshDataFromDataModel(),this.refresh()):this.refreshDataAndView())}},o.setSelection=function(t){if(null==t)return this.iRows.removeAll({raiseEvent:!0}),this.iCells.removeAll({raiseEvent:!0}),!1;var e,i,r=this.data;if(t.rowData){var o=this.getRowIndx(t);e=o.rowIndx}else var n=this.rowIndxOffset,e=t.rowIndx,i=t.rowIndxPage,e=null==e?i+n:e;var a=null==t.colIndx&&void 0!==t.dataIndx?this.getColIndx({dataIndx:t.dataIndx}):t.colIndx;t.evt;return!(e<0||a<0||a>=this.colModel.length)&&(null!=r&&0!=r.length&&(t.rowIndx=e,t.colIndx=a,this._bringPageIntoView(t),i=e-this.rowIndxOffset,t.rowIndxPage=i,this.scrollRow({rowIndxPage:i}),null==a?this._selectRow(t):(this.scrollColumn({colIndx:a}),this.selectCell(t))))},o.getColModel=function(){return this.colModel},o.saveEditCell=function(e){var i=this.options,r=i.editModel;if(!r.indices)return null;var o,n=t.extend({},r.indices),a=e?e.evt:null,l=this.rowIndxOffset,s=n.colIndx,d=n.rowIndxPage,h=d+l,c=this.colModel,u=c[s],f=u.dataIndx,p=this.data[d],g=i.dataModel;if(null==p)return null;if(o=p[f],null!=d){var v=this.getEditCellData();"<br>"==v&&(v=""),null==o&&""===v&&(v=null);var w={rowIndx:h,rowIndxPage:d,dataIndx:f,column:u,newVal:v,value:v,oldVal:o,rowData:p,dataModel:g};if(this._trigger("cellBeforeSave",a,w)===!1)return!1;if(v!=o){if(p[f]=v,i.track){var p=this.getRowData({rowIndx:h});this.iUCData.update({rowData:p,dataIndx:f,oldVal:o,newVal:v})}this._trigger("cellSave",a,w);var x=this;i.flexHeight?(x._setGridHeightFromTable(),x._fixIEFooterIssue()):e&&x.scrollRow({rowIndxPage:d})}return!0}},o._fixTableViewPort=function(){var t=this.element[0];t.scrollTop=0,t.scrollLeft=0;var e=this.$header_o[0];e.scrollLeft=0,e.scrollTop=0,this.iGenerateView.setPanes()},o._fixIEFooterIssue=function(){t(".pq-grid-footer").css({position:"absolute"}),t(".pq-grid-footer").css({position:"relative"})},o.refreshColumn=function(t){var e=this.colModel,i=t.colIndx,r=t.dataIndx,i=null==i?this.getColIndx({dataIndx:r}):i,r=null==r?e[i]:r,o=this.rowIndxOffset;t.colIndx=i;for(var n=this.initV,a=this.finalV,l=n;l<=a;l++){var s=l;t.rowIndx=s+o,t.rowIndxPage=s,t.colIndx=i,t.column=e[i],t.skip=!0,this.refreshCell(t)}this._fixTableViewPort(),this._refreshScrollbars(),this._trigger("refreshColumn",null,{dataModel:this.options.dataModel,colModel:e,initV:n,finalV:a,colIndx:i,dataIndx:r})},o.refreshCell=function(t){if(this.data){var e=this.rowIndxOffset,i=t.skip,r=t.rowIndx,o=t.rowIndxPage,r=t.rowIndx=null==r?o+e:r,o=t.rowIndxPage=null==o?r-e:o,n=t.dataIndx,a=t.colIndx,a=t.colIndx=null==a?this.getColIndx({dataIndx:n}):a,l=this.getCell({all:!0,rowIndxPage:o,colIndx:a}),s=t.column,d=this.colModel,s=t.column=s?s:d[a],h=this.options,c=h.treeModel,u=this.data[o];if(u){var f=t;if(f.tree=!!c.labelIndx,f.rowData=u,l&&l.length>0){var p=this.iGenerateView.renderCell(f);l.replaceWith(p),i||(this._fixTableViewPort(),this._refreshScrollbars(),this._trigger("refreshCell",null,{dataModel:this.options.dataModel,colModel:d,rowData:u,rowIndx:r,rowIndxPage:o,colIndx:a,dataIndx:n}))}}}},o.refreshRow=function(t){if(this.data){var e=this,i=this.rowIndxOffset,r=t.rowIndx,o=t.rowIndxPage,r=null==r?o+i:r,o=null==o?r-i:o,n=this.getRow({all:!0,rowIndxPage:o}),a=this.colModel,l=this.data[o];if(!l||!n||!n.length)return null;var s=[];e.iGenerateView.refreshRow(o,a,s);var d=s.join("");return n.replaceWith(d),this._fixTableViewPort(),this._refreshScrollbars(),this._trigger("refreshRow",null,{rowData:l,rowIndx:r,rowIndxPage:o}),!0}},o.quitEditMode=function(t){if(!this._quitEditMode){var e=this,i=!1,r=!1,o=!1,n=this.options,a=n.editModel,l=a.indices,s=void 0;e._quitEditMode=!0,t&&(i=t.old,r=t.silent,o=t.fireOnly,s=t.evt),l&&(r||i||this._trigger("editorEnd",s,l),o||(this._removeCellRowOutline(t),a.indices=null)),e._quitEditMode=null}},o._fixIE=function(){var t=this.$cont[0];t.scrollLeft=0,t.scrollTop=0},o.getData=function(){return this.data},o.getViewPortRowsIndx=function(){return{beginIndx:this.initV,endIndx:this.finalV}},o.getViewPortIndx=function(){return{initV:this.initV,finalV:this.finalV,initH:this.initH,finalH:this.finalH}},o.getRowIndxOffset=function(){return this.rowIndxOffset},o.selectCell=function(t){var e=(t.rowIndx,t.colIndx,t.evt);if(!e||"keydown"!=e.type&&"keypress"!=e.type){if(this.iCells.add(t)===!1)return!1}else if(0==this.iCells.replace(t))return!1;return!0},o.getEditCell=function(){var t=this.options.editModel;if(t.indices){var e=this.getCell(t.indices),i=this.$div_focus.children(".pq-editor-inner"),r=i.find(".pq-editor-focus");return{$td:e,$cell:i,$editor:r}}return null},o.editCell=function(t){return this.scrollRow(t),this.scrollColumn(t),this._editCell(t)},o.getFirstEditableColIndx=function(t){if(null==t.rowIndx)throw"rowIndx NA";if(!this.isEditableRow(t))return-1;for(var e=this.colModel,i=0;i<e.length;i++)if(t.colIndx=i,this.isEditableCell(t)&&!e[i].hidden)return i;return-1},o.editFirstCellInRow=function(t){var e=this.rowIndxOffset,i=t.rowIndx,r=t.rowIndxPage,i=null==i?r+e:i,r=null==r?i-e:r,o=this.getFirstEditableColIndx({rowIndx:i});o!=-1&&this.editCell({rowIndxPage:r,colIndx:o})},o._editCell=function(e){var i=this,r=e.evt,o=this.rowIndxOffset,n=e.rowIndxPage,a=e.rowIndx,a=null==a?n+o:a,n=null==n?a-o:n,l=e.colIndx,s=e.dataIndx,l=null==l?this.getColIndx({dataIndx:s}):l,d=this.colModel,h=d[l],s=h.dataIndx,c=h.editor,u=this.options,f=u.editModel,p=u.editor,g=c?t.extend({},p,c):p,v=i.data[n],w=!1;if(f.indices){var x=f.indices;if(x.rowIndxPage==n&&x.colIndx==l){this.refreshEditorPos();var m=this.$div_focus.find(".pq-editor-focus");return window.setTimeout(function(){m.focus()},0),!1}if(this.blurEditor({evt:r})===!1)return!1;this.quitEditMode({evt:r})}f.indices={rowIndxPage:n,rowIndx:a,colIndx:l,column:h,dataIndx:s},this._generateCellRowOutline();var I=this.$div_focus,_=I.children(".pq-editor-inner");"right"==h.align?_.addClass("pq-align-right"):"center"==h.align?_.addClass("pq-align-center"):_.addClass("pq-align-left");var b,q=v[s],y=g.type,C=g.select,M=g.init,D=g.cls?g.cls:"",P="pq-editor-focus "+D,R=P+" pq-cell-editor ",$=g.attr?g.attr:"",S=g.style,S=S?S:"",T=S?"style='"+S+"'":"",H=_.width()-8,k="style='width:"+H+"px;"+S+"'",E=S?"style='"+S+"'":"",V={rowIndx:a,rowIndxPage:n,$cell:_,cellData:q,rowData:v,cls:P,dataIndx:s,column:h};if("function"==typeof y)b=y.call(i.element[0],V);else if("checkbox"==y){var z=g.subtype,W=q?"checked='checked'":"";b="<input "+W+" class='"+R+"' "+$+" "+E+" type=checkbox name='"+s+"' />",_.html(b);var B=_.children("input");"triple"==z&&(B.pqval({val:q}),_.click(function(e){t(this).children("input").pqval({incr:!0})}))}else if("textarea"==y||"select"==y||"textbox"==y){if("textarea"==y)b="<textarea class='"+R+"' "+$+" "+k+" name='"+s+"' ></textarea>";else if("select"==y){var F=g.options,F=F?F:[];"function"==typeof F&&(F=F.call(i.element[0],{column:h,rowData:v}));var L=[$," class='",R,"' ",k," name='",s,"'"].join("");b=t.paramquery.select({options:F,attr:L,prepend:g.prepend,labelIndx:g.labelIndx,valueIndx:g.valueIndx,groupIndx:g.groupIndx})}else b="<input class='"+R+"' "+$+" "+k+" type=text name='"+s+"' />";t(b).appendTo(_).width(H).val(q)}else b="<div contenteditable='true' tabindx='0' "+T+" "+$+" class='pq-editor-default "+P+"'></div>",_.html(b),_.children().html(q),w=!0;"function"==typeof M&&M.call(i.element[0],V);var i=this,m=_.children(".pq-editor-focus"),O=f.filterKeys,A=h.editModel;A&&void 0!==A.filterKeys&&(O=A.filterKeys);var N={$cell:_,$editor:m,dataIndx:s,column:h,colIndx:l,rowIndx:a,rowIndxPage:n,rowData:v};if(f.indices=N,m.data({FK:O}).on("click",function(e){t(this).focus()}).on("keydown",function(t){i.iKeyNav._keyDownInEdit(t)}).on("keypress",function(t){return i.iKeyNav._keyPressInEdit(t,{FK:O})}).on("keyup",function(t){return i.iKeyNav._keyUpInEdit(t,{FK:O})}).on("blur",function(e,r){var o=i.options,n=o.editModel,a=n.onBlur,l="save"==a,s="validate"==a,d=n.cancelBlurCls,h=!!r&&r.force;if(i._quitEditMode||i._blurEditMode)return void(h&&o.debug);if(n.indices){var c=t(e.target);if(!h){if(i._trigger("editorBlur",e,N)===!1)return;if(!a)return;if(d&&c.hasClass(d))return;if(c.hasClass("hasDatepicker")){var u=c.datepicker("widget");if(u.is(":visible"))return!1}else if(c.hasClass("ui-autocomplete-input")&&c.autocomplete("widget").is(":visible"))return}i._blurEditMode=!0;var f=h||l||!s;if(!i.saveEditCell({evt:e,silent:f})&&!h&&s)return i._deleteBlurEditMode(),!1;i.quitEditMode({evt:e}),i._deleteBlurEditMode()}}).on("focus",function(t){i._trigger("editorFocus",t,N)}),i._trigger("editorBegin",r,N),m.focus(),window.setTimeout(function(){var e=t(document.activeElement);if(e.hasClass("pq-editor-focus")===!1){var r=i.element.find(".pq-editor-focus");r.focus()}},0),i.element[0].scrollLeft=0,i.element[0].scrollTop=0,C)if(w)try{var j=m[0],U=document.createRange();U.selectNodeContents(j);var G=window.getSelection();G.removeAllRanges(),G.addRange(U)}catch(t){}else m.select()},o._deleteBlurEditMode=function(t){var e=this,t=t?t:{};e._blurEditMode&&(t.timer?window.setTimeout(function(){delete e._blurEditMode},0):delete e._blurEditMode)},o.getRow=function(t){var e,i=t.rowIndxPage,r=t.rowIndx,o=this.rowIndxOffset,i=null==i?r-o:i,n=t.all?this.$tbl:this.get$Tbl(i);if(n&&n.length){var a=n.children("tbody");null!=i&&(e=a.children("tr[pq-row-indx="+i+"]"),e.length>n.length&&(e=e.filter(".pq-detail-master")))}return e},o.getCell=function(t){var e,i=t.rowIndxPage,r=t.rowIndx,i=null==i?r-this.rowIndxOffset:i,o=t.colIndx,n=t.dataIndx,o=null==o?this.getColIndx({dataIndx:n}):o,a=t.all?this.$tbl:this.get$Tbl(i,o);if(void 0!=a){var e=a.children().children("tr[pq-row-indx="+i+"]").children("td[pq-col-indx="+o+"]");if(0==e.length)return null}return e},o.getCellHeader=function(e){var i,r=e.colIndx,o=e.dataIndx,r=null==r?this.getColIndx({dataIndx:o}):r,n=this.$tbl_header,a=this.options,l=a.freezeCols;if(void 0!=n){n.length>1&&(n=t(r>=l?n[1]:n[0]));var i=n.children().children("tr:last").children("td[pq-col-indx="+r+"]")}return 0==i.length||"hidden"==i[0].style.visibility?null:i},o.getEditorIndices=function(){var e=this.options.editModel.indices;return e?t.extend({},e):null},o.getEditCellData=function(){var e=this.options,i=e.editModel.indices;if(!i)return null;var r,o=i.colIndx,n=i.rowIndxPage,a=i.rowIndx,l=this.colModel[o],s=l.editor,d=e.editor,h=s?t.extend({},d,s):d,c=l.dataIndx,u=this.$div_focus,f=u.children(".pq-editor-inner"),p=h.getData;if("function"==typeof p)r=h.getData.call(this.element[0],{$cell:f,dataIndx:c,rowIndx:a,rowIndxPage:n,column:l});else{var g=h.type;if("checkbox"==g){var v=f.children();r="triple"==h.subtype?v.pqval():!!v.is(":checked")}else if("contenteditable"==g)r=f.children().html();else{var w=f.find('*[name="'+c+'"]');if(w&&w.length)r=w.val();else{var w=f.find(".pq-editor-focus");w&&w.length&&(r=w.val())}}}return r},o.getCellIndices=function(t){var e=t.$td;if(null==e||0==e.length||e.closest(".pq-grid")[0]!=this.element[0])return{rowIndxPage:null,colIndx:null};var i,r=e.parent("tr"),o=r.attr("pq-row-indx");null!=o&&(o=parseInt(o),i=o+this.rowIndxOffset);var n,a=e.attr("pq-col-indx");return null!=a&&(a=parseInt(a),n=this.colModel[a].dataIndx),{rowIndxPage:o,rowIndx:i,colIndx:a,dataIndx:n}},o.getRowsByClass=function(t){var e=this.options,i=e.dataModel,r=e.pageModel,o=r.type,n="remote"==o,a=this.rowIndxOffset,l=i.data,s=[];if(null==l)return s;for(var d=0,h=l.length;d<h;d++){var c=l[d];if(t.rowData=c,this.hasClass(t)){var u={rowData:c};n?u.rowIndx=d+a:u.rowIndx=d,s.push(u)}}return s},o.getCellsByClass=function(t){var e=this.options,i=e.dataModel,r=e.pageModel,o=r.type,n="remote"==o,a=this.rowIndxOffset,l=i.data,s=this.colModel,d=s.length,h=[];if(null==l)return h;for(var c=0,u=l.length;c<u;c++){var f=l[c];t.rowData=f;for(var p=0;p<d;p++){var g=s[p],v=g.dataIndx;if(t.dataIndx=v,this.hasClass(t)){var w={rowData:f,dataIndx:v,colIndx:p};n?w.rowIndx=c+a:w.rowIndx=c,h.push(w)}}}return h},o.addClass=function(e){var i=e.rowIndx,r=e.dataIndx,o=e.cls,n=this.rowIndxOffset,a=this.getRowData(e);if(a){null==i&&(i=this.getRowIndx({rowData:a}).rowIndx);for(var l=o.split(" "),s=0;s<l.length;s++){var d=l[s];if(null==r&&this.hasClass({rowData:a,cls:d})===!1){var h=a.pq_rowcls;if(h?a.pq_rowcls=t.trim(h)+" "+d:a.pq_rowcls=d,null!=i&&e.refresh!==!1){var c=this.getRow({rowIndxPage:i-n});c&&c.addClass(d)}}else if(this.hasClass({rowData:a,dataIndx:r,cls:d})===!1){var u=a.pq_cellcls;if(u){var f=u[r];f?u[r]=t.trim(f)+" "+d:u[r]=d}else{var u={};u[r]=d,a.pq_cellcls=u}if(null!=i&&e.refresh!==!1){var p=this.getCell({rowIndxPage:i-n,dataIndx:r});p&&p.addClass(d)}}}}},o.removeClass=function(t){var e=t.rowIndx,i=this.getRowData(t),r=t.dataIndx,o=t.cls,n=null!=r&&i?i.pq_cellcls:null,a=i?i.pq_rowcls:null;if(null!=i)if(null==e&&(e=this.getRowIndx({rowData:i}).rowIndx),null==r){if(a&&(i.pq_rowcls=this._removeClass(a,o)),null!=e&&t.refresh!==!1){var l=this.getRow({rowIndx:e});l&&l.removeClass(o)}}else if(n){var s=n[r];if(s&&(i.pq_cellcls[r]=this._removeClass(s,o)),null!=e&&t.refresh!==!1){var d=this.getCell({rowIndx:e,dataIndx:r});d&&d.removeClass(o)}}},o.hasClass=function(t){var e,i=t.dataIndx,r=t.cls,o=this.getRowData(t),n=new RegExp("\\b"+r+"\\b");if(o){if(null==i)return e=o.pq_rowcls,!(!e||!n.test(e));var a=o.pq_cellcls;return!!(a&&a[i]&&n.test(a[i]))}return null},o._removeClass=function(t,e){if(t){for(var i=t.split(" "),r=e.split(" "),o=[],n=0,a=i.length;n<a;n++){for(var l=i[n],s=!1,d=0,h=r.length;d<h;d++){var c=r[d];if(l===c){s=!0;break}}s||o.push(l)}return o.length>1?o.join(" "):1===o.length?o[0]:null}},o.getRowIndx=function(t){var e=t.$tr,i=t.rowData;if(i){var r=this.options,o=r.dataModel,n=r.pageModel,a=n.type,l="remote"==a,s=o.data,d=!1;if(s)for(var h=0,c=s.length;h<c;h++)if(s[h]==i){d=!0;break}if(d){var u=this.rowIndxOffset,f=l?h:h-u,p=l?h+u:h;return{rowIndxPage:f,rowIndx:p}}return{}}if(null==e||0==e.length)return{rowIndxPage:null};var f=e.attr("pq-row-indx");return null==f?{rowIndxPage:null}:(f=parseInt(f),{rowIndxPage:f,rowIndx:f+this.rowIndxOffset})};var l=function(t){this.options=t.options,this.that=t;var e=this,i=t.widgetEventPrefix.toLowerCase(),r=t.eventNamespace;t.element.on(i+"celleditkeyup"+r,function(t,i){return e.filterKeys(t,i)})},s=l.prototype;s._incrRowIndx=function(t,e){for(var i=this.that,r=t,e=null==e?1:e,o=i.data,n=0,a=t+1,l=o.length;a<l;a++){var s=o[a].pq_hidden;if(!s&&(n++,r=a,n==e))return r}return r},s._decrRowIndx=function(t,e){for(var i=this.that,r=t,o=i.data,e=null==e?1:e,n=0,a=t-1;a>=0;a--){var l=o[a].pq_hidden;if(!l&&(n++,r=a,n==e))return r}return r},o.addColumn=function(t,e){var i=this.options,r=i.colModel,o=i.dataModel.data;r.push(t),this._calcThisColModel();for(var n=0;n<o.length;n++){var a=o[n];a.push("")}},o.rowNextSelect=function(){var t,e,i=this.selection({type:"row",method:"getSelection"}),r=this.rowIndxOffset;return i&&i[0]&&(t=i[0].rowIndx,e=t-r,e=this.iKeyNav._incrRowIndx(e)),null!=e&&(this.setSelection(null),this._setSelection({rowIndxPage:e})),e},o.rowPrevSelect=function(){var t,e,i=this.selection({type:"row",method:"getSelection"}),r=this.rowIndxOffset;return i&&i[0]&&(t=i[0].rowIndx,e=t-r,e=this.iKeyNav._decrRowIndx(e)),null!=e&&(this.setSelection(null),this.setSelection({rowIndxPage:e})),e},s._incrIndx=function(t,e){var i=this.that,r=i._getLastVisibleRowIndxPage(i.data),o=i.colModel,n=o.length;if(null==e)return t==r?null:(t=this._incrRowIndx(t),{rowIndxPage:t});var a;do{if(e++,e>=n){if(t==r)return null;t=this._incrRowIndx(t),e=0}a=o[e]}while(a&&a.hidden);return{rowIndxPage:t,colIndx:e}},s._decrIndx=function(t,e){var i=this.that,r=i.colModel,o=r.length,n=i._getFirstVisibleRowIndxPage(i.data);if(null==e)return t==n?null:(t=this._decrRowIndx(t),{rowIndxPage:t});var a;do{if(e--,e<0){if(t==n)return null;t=this._decrRowIndx(t),e=o-1}a=r[e]}while(a&&a.hidden);return{rowIndxPage:t,colIndx:e}},s._incrEditIndx=function(t,e){var i,r=this.that,o=r.colModel,n=o.length,a=r.rowIndxOffset,l=r._getLastVisibleRowIndxPage(r.data);do{if(e++,e>=n){if(t==l)return null;do{t=this._incrRowIndx(t);var s=t+a,d=r.isEditableRow({rowIndx:s});if(t==l&&0==d)return null}while(0==d);e=0}i=o[e];var s=t+a,h=r.isEditableCell({rowIndx:s,colIndx:e,checkVisible:!0})}while(i&&(i.hidden||0==h));return{rowIndxPage:t,colIndx:e}},s._decrEditIndx=function(t,e){var i,r=this.that,o=r.colModel,n=o.length,a=r.rowIndxOffset,l=r._getFirstVisibleRowIndxPage(r.data);do{if(e--,e<0){if(t==l)return null;do{t=this._decrRowIndx(t);var s=t+a,d=r.isEditableRow({rowIndx:s});if(t==l&&0==d)return null}while(0==d);e=n-1}i=o[e];var s=t+a,h=r.isEditableCell({rowIndx:s,colIndx:e,checkVisible:!0})}while(i&&(i.hidden||0==h));return{rowIndxPage:t,colIndx:e}},s._incrEditRowIndx=function(t,e){var i=this.that,r=i.rowIndxOffset,o=i._getLastVisibleRowIndxPage(i.data);if(t==o)return null;do{t=this._incrRowIndx(t);var n=t+r,a=i.isEditableRow({rowIndx:n}),l=i.isEditableCell({rowIndx:n,colIndx:e}),s=a&&l;if(t==o&&!s)return null}while(!s);return{rowIndxPage:t,colIndx:e}},s._decrEditRowIndx=function(t,e){var i=this.that,r=i.rowIndxOffset,o=i._getFirstVisibleRowIndxPage(i.data);if(t==o)return null;do{t=this._decrRowIndx(t);var n=t+r,a=i.isEditableRow({rowIndx:n}),l=i.isEditableCell({rowIndx:n,colIndx:e}),s=a&&l;if(t==o&&!s)return null}while(!s);return{rowIndxPage:t,colIndx:e}},o._onKeyPressDown=function(e){var i=t(e.target).closest(".pq-grid-header");if(i.length>0)return 0!=this._trigger("headerKeyDown",e,{dataModel:this.options.dataModel});var r=this.iKeyNav._bodyKeyPressDown(e);return r!==!1&&(0!=this._trigger("keyDown",e,{dataModel:this.options.dataModel})&&void 0)},s._saveAndMove=function(t,e){if(null==t)return e.preventDefault(),!1;var i=this.that,r=this.options,o=r.selectionModel,n=(r.editModel,i.colModel,t.rowIndxPage),a=t.colIndx;return i._blurEditMode=!0,i.saveEditCell({evt:e})===!1?(i._deleteBlurEditMode({timer:!0,msg:"_saveAndMove saveEditCell"}),e.preventDefault(),!1):(i.quitEditMode(e),"row"==o.type?(i.setSelection(null),i.setSelection({rowIndxPage:n}),i.scrollColumn({colIndx:a})):"cell"==o.type?(i.setSelection(null),i.setSelection({rowIndxPage:n,colIndx:a})):(i.scrollRow({rowIndxPage:n}),i.scrollColumn({colIndx:a})),i._editCell({rowIndxPage:n,colIndx:a}),i._deleteBlurEditMode({timer:!0,msg:"_saveAndMove"}),e.preventDefault(),!1)},s._keyPressInEdit=function(e,i){var r=this.that,o=r.options,n=o.editModel.indices,i=i?i:{},a=i.FK,l=n.column,s=l.dataType;if(r._trigger("editorKeyPress",e,t.extend({},n))===!1)return!1;if(a&&("float"==s||"integer"==s)){var d="float"==s?"0123456789.-":"0123456789-",h=e.charCode,h=h?h:e.keyCode,c=String.fromCharCode(h);if(c&&d.indexOf(c)==-1)return!1}},s.getValText=function(e){var i=e[0].nodeName.toLowerCase(),r=["input","textarea","select"],o="text";return t.inArray(i,r)!=-1&&(o="val"),o},s._keyUpInEdit=function(e,i){var r=this.that,o=r.options,i=i?i:{},n=i.FK,a=o.editModel,l=a.indices;r._trigger("editorKeyUp",e,t.extend({},l));var s=l.column,d=s.dataType;if(n&&("float"==d||"integer"==d)){var h=t(e.target),c="integer"==d?a.reInt:a.reFloat,u=this.getValText(h),f=h.data("oldVal"),p=h[u]();if(0==c.test(p))if(c.test(f))h[u](f);else{var g="float"==d?parseFloat(f):parseInt(f);isNaN(g)?h[u](0):h[u](g)}}},s._keyDownInEdit=function(e){var i=this.that,r=i.options,o=r.editModel.indices;if(o){var n=t(e.target),a=t.ui.keyCode,l=r.selectionModel,s=r.editModel,d=t.extend({},o),h=d.rowIndxPage,c=d.colIndx,u=d.column,f=u.editModel,p=f?t.extend({},s,f):s,g=this.getValText(n);if(n.data("oldVal",n[g]()),0==i._trigger("cellEditKeyDown",e,d))return!1;if(0==i._trigger("editorKeyDown",e,d))return!1;if(e.keyCode==a.TAB){var d;return d=e.shiftKey?this._decrEditIndx(h,c):this._incrEditIndx(h,c),this._saveAndMove(d,e)}if(e.keyCode==p.saveKey){var d=this._incrEditIndx(h,c);return this._saveAndMove(d,e)}if(e.keyCode==a.ESCAPE){if(i.quitEditMode({evt:e}),"cell"==l.type){var v=i.getCell({rowIndxPage:h,colIndx:c});v.attr("tabindex",0).focus()}else if("row"==l.type){var w=i.getRow({rowIndxPage:h});t(w[0]).attr("tabindex",0).focus()}return e.preventDefault(),!1}if(e.keyCode==a.PAGE_UP||e.keyCode==a.PAGE_DOWN)return e.preventDefault(),!1;if(p.keyUpDown){if(e.keyCode==a.DOWN){var d=this._incrEditRowIndx(h,c);return this._saveAndMove(d,e)}if(e.keyCode==a.UP){var d=this._decrEditRowIndx(h,c);return this._saveAndMove(d,e)}}}},s.select=function(t){var e=this.that,i=t.rowIndx,r=t.colIndx,o=e.options.selectionModel,n=t.evt;n.shiftKey&&"single"!=o.mode?"row"==o.type?(e.scrollRow({rowIndx:i}),e.iRows.extendSelection({rowIndx:i,evt:n})):"cell"==o.type&&(e.scrollCell({rowIndx:i,colIndx:r}),e.iCells.extendSelection({rowIndx:i,colIndx:r,evt:n})):e.setSelection({rowIndx:i,colIndx:r,evt:n,setFirst:!0})},s._bodyKeyPressDown=function(e){var i,r,o,n,a=this.that,l=a.rowIndxOffset,s=this.options,d=a.colModel,h=s.selectionModel,c=s.editModel,u=t.ui.keyCode;if(c.indices)return void a.$div_focus.find(".pq-cell-focus").focus();if("row"==h.type){if(r=e.ctrlKey?a.iRows.getFocusSelection({old:!0}):a.iRows.getFocusSelection({old:!1}),null==r)return;var o=r.rowIndx,f=o-l;if(null==o)return;if(0==a._trigger("rowKeyDown",e,{rowData:a.data[f],rowIndx:o,rowIndxPage:f}))return!1}else{if("cell"!=h.type)return;if(i=e.ctrlKey?a.iCells.getFocusSelection({old:!0}):a.iCells.getFocusSelection({old:!1}),null==i)return;var p=i,o=p.rowIndx,f=o-l,g=p.dataIndx,n=a.getColIndx({dataIndx:g});if(null==o||null==n)return;if(0==a._trigger("cellKeyDown",e,{rowData:a.data[f],rowIndx:o,rowIndxPage:f,colIndx:n,dataIndx:g,column:d[n]}))return!1;if(e.cancelBubble)return}if(e.keyCode==u.LEFT){var p=this._decrIndx(f,n);return p&&(o=p.rowIndxPage+l,this.select({rowIndx:o,colIndx:p.colIndx,evt:e})),void e.preventDefault()}if(e.keyCode==u.RIGHT){var p=this._incrIndx(f,n);return p&&(o=p.rowIndxPage+l,this.select({rowIndx:o,colIndx:p.colIndx,evt:e})),void e.preventDefault()}if(e.keyCode==u.UP)return f=this._decrRowIndx(f),null!=f&&(o=f+l,this.select({rowIndx:o,colIndx:n,evt:e})),void e.preventDefault();if(e.keyCode==u.DOWN)return f=this._incrRowIndx(f),null!=f&&(o=f+l,this.select({rowIndx:o,colIndx:n,evt:e})),void e.preventDefault();if(e.keyCode==u.PAGE_DOWN||e.keyCode==u.SPACE){var v=this.pageDown(f);return v&&(f=v.rowIndxPage,null!=f&&(o=f+l,this.select({rowIndx:o,colIndx:n,evt:e}))),void e.preventDefault()}if(e.keyCode==u.PAGE_UP){var w=this.pageUp(f);return w&&(f=w.rowIndxPage,null!=f&&(o=f+l,this.select({rowIndx:o,colIndx:n,evt:e}))),void e.preventDefault()}if(e.keyCode==u.HOME)return"row"==h.type||e.ctrlKey?(o=a._getFirstVisibleRowIndxPage(a.data)+l,this.select({rowIndx:o,colIndx:n,evt:e})):"cell"==h.type&&(n=a._getFirstVisibleColIndx(),this.select({rowIndx:o,colIndx:n,evt:e})),void e.preventDefault();if(e.keyCode==u.END)return"row"==h.type||e.ctrlKey?(o=a._getLastVisibleRowIndxPage(a.data)+l,this.select({rowIndx:o,colIndx:n,evt:e})):"cell"==h.type&&(n=a._getLastVisibleColIndx(),this.select({rowIndx:o,colIndx:n,evt:e})),void e.preventDefault();if(e.keyCode==u.ENTER){if("row"==h.type){var x;null!=r&&a.editFirstCellInRow({rowIndx:f+l})}else if(null!=i){var x=a.getCell({rowIndxPage:f,colIndx:n});if(x&&x.length>0){var o=f+l,m=a.isEditableRow({rowIndx:o}),I=a.isEditableCell({rowIndx:o,colIndx:n});m&&I&&a.editCell({rowIndxPage:f,colIndx:n})}}return void e.preventDefault()}return e.ctrlKey&&"65"==e.keyCode?("row"==h.type&&"single"!=h.mode?a.iRows.selectAll({all:h.all}):"cell"==h.type&&"single"!=h.mode&&a.iCells.selectAll({all:h.all}),void e.preventDefault()):void 0},s.incrPageSize=function(){for(var e=this.that,i=e.$tbl,r=i.children("tbody").children("tr.pq-grid-row").not(".pq-group-row,.pq-summary-row"),o=e.$cont[0].offsetHeight,n=parseInt(i.css("marginTop")),a=e._getScollBarHorizontalHeight(),l=o-a-n,s=r.length-1;s>=0;s--){var d=r[s];if(d.offsetTop<l)break}var h=e.getRowIndx({$tr:t(d)}).rowIndxPage;return{rowIndxPage:h}},s.pageNonVirtual=function(e,i){var r,o=this.that,n=o.$cont[0].offsetHeight-o._getScollBarHorizontalHeight(),a=o.getRow({rowIndxPage:e}),l=0,s=0,d=t(a[0])[i]("tr.pq-grid-row"),h=d.length;if(h>0){do{r=d[s];var c=r.offsetHeight;if(l+=c,l>=n)break;s++}while(s<h);s=s>0?s-1:s;do{var a=t(d[s]);if(e=o.getRowIndx({$tr:a}).rowIndxPage,null!=e)break;s--}while(s>=0)}return e},s.pageDown=function(t){var e=this.that,i=e.options,r=e.$vscroll.pqScrollBar("option"),o=r.cur_pos,n=r.num_eles,a=r.ratio;if(i.virtualY){if(o<n-1){var t=this.incrPageSize().rowIndxPage,l=e._calcCurPosFromRowIndxPage(t);if(null==l)return;e.$vscroll.pqScrollBar("option","cur_pos",l).pqScrollBar("scroll")}}else if(null!=t)t=this.pageNonVirtual(t,"nextAll");else if(a<1){var s=e.$cont.data("offsetHeight")-e._getScollBarHorizontalHeight();e.iMouseSelection.updateTableY(-1*s),e._syncScrollBarVert()}return{rowIndxPage:t,curPos:l}},s.pageUp=function(t){var e=this.that,i=e.options,r=e.$vscroll.pqScrollBar("option"),o=r.cur_pos,n=r.ratio;if(i.virtualY){if(o>0){var t=this.decrPageSize().rowIndxPage,a=e._calcCurPosFromRowIndxPage(t);if(null==a)return;e.$vscroll.pqScrollBar("option","cur_pos",a).pqScrollBar("scroll")}}else if(null!=t)t=this.pageNonVirtual(t,"prevAll");else if(n>0){var l=e.$cont[0].offsetHeight-e._getScollBarHorizontalHeight();e.iMouseSelection.updateTableY(l),e._syncScrollBarVert()}return{rowIndxPage:t,curPos:a}},s.decrPageSize=function(){var e=this.that,i=e.$tbl,r=i.children("tbody").children("tr.pq-grid-row").not(".pq-group-row,.pq-summary-row"),o=e.options.freezeRows,n=0;if(r.length){var a;if(o?(a=r.filter("tr.pq-last-freeze-row"),a.length&&(a=a.next())):r.length>=2&&(a=t(r[1])),a&&a.length){var n=e.getRowIndx({$tr:a}).rowIndxPage;n=n-e.pageSize+4,n<0&&(n=0)}}return{rowIndxPage:n}},o._calcNumHiddenFrozens=function(){for(var t=0,e=this.options.freezeCols,i=0;i<e;i++)this.colModel[i].hidden&&t++;return t},o._calcNumHiddenUnFrozens=function(t){for(var e=0,i=this.options.freezeCols,r=null!=t?t:this.colModel.length,o=i;o<r;o++)this.colModel[o].hidden&&e++;return e},o._setScrollHLength=function(){var t=this.options;if(!t.scrollModel.horizontal)return this.$hscroll.css("visibility","hidden"),void this.$hvscroll.css("visibility","hidden");this.$hscroll.css("visibility",""),this.$hvscroll.css("visibility","");var e=this.$cont[0].offsetWidth,i=(this.colModel,this._getSBWidth());0==i?this.$hscroll.css("right",0):this.$hscroll.css("right",""),e-=i,this.$hscroll.pqScrollBar("option","length",e)},o._setScrollHNumEles=function(){var t=this.options,e=t.scrollModel,i=0;t.flexWidth||(i="fullScroll"==e.lastColumn?this.colModel.length-t.freezeCols-this._calcNumHiddenUnFrozens():this.calcColsOutsideCont(this.colModel)+1),this.$hscroll.pqScrollBar("option","num_eles",i)},o.calcColsOutsideCont=function(t){var e=this.options.numberCell,i=this.$tbl?this.$tbl[this.$tbl.length-1]:null,r=i?i.scrollWidth:0,o=this.options.freezeCols,n=this.$cont[0].offsetWidth-this._getSBWidth();r=0,e.show&&(r+=e.outerWidth);for(var a=0;a<t.length;a++){var l=t[a];l.hidden||(r+=l.outerWidth)}var s=0,d=0,h=r;for(h>n&&d++,a=o;a<t.length;a++)if(l=t[a],!l.hidden){if(s+=l.outerWidth,h=r-s,!(h>n))break;d++}return d},o._getScollBarHorizontalHeight=function(){var t=17,e=this.$hscroll;return"hidden"!=e.css("visibility")&&0!=this.options.scrollModel.horizontal&&"none"!=e.css("display")||(t=0),t},o._getSBWidth=function(){var t=17,e=this.$vscroll;return(null==this.initV||"hidden"==e.css("visibility")||this.options.flexHeight||"none"==e.css("display"))&&(t=0),t},o._setScrollVNumEles=function(e){var i,r,o=this,n=this.$vscroll,a=!!this.iHierarchy,l=n.pqScrollBar("option"),s=parseInt(l.num_eles),d=parseInt(l.cur_pos),h=this.options,c=this._getScollBarHorizontalHeight(),u=this.$cont[0].offsetHeight,f=u-c+1,p=h.groupModel,g=p?this.dataGM:this.data,v=g?this.totalVisibleRows:0,w=0;if(this.$tbl&&this.$tbl.length>0&&(i=this.$tbl[this.$tbl.length-1],w=i.offsetHeight,r=t(i)),w>0&&w>f){for(var x=r.children().children("tr"),m=0,I=0,_=0;_<x.length;_++){var b=x[_];if(m+=b.offsetHeight,m>=f){a&&t(b).hasClass("pq-detail-child")?(I--,I=I>1?I-1:1):I=I>1?I-1:0;break}a?0==t(b).hasClass("pq-detail-child")&&I++:I++}0==I&&(I=x.length-1),s=v-I+1}else s=d+1;return s>v&&(s=v),e?o.$vscroll.pqScrollBar("option","num_eles",s):o.$vscroll.pqScrollBar("setNumEles",s),s},o._getFirstVisibleRowIndxPage=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e].pq_hidden;if(!r)return e}},o._getLastVisibleRowIndxPage=function(t){for(var e=t.length-1;e>=0;e--){var i=t[e].pq_hidden;if(!i)return e}return null},o._getFirstVisibleColIndx=function(){for(var t=this.colModel,e=t.length,i=0;i<e;i++){var r=t[i].hidden;if(!r)return i}return null},o._getLastVisibleColIndx=function(){for(var t=this.colModel,e=t.length,i=e-1;i>=0;i--){var r=t[i].hidden;if(!r)return i}return null},o.getTotalVisibleColumns=function(){for(var t=this.colModel,e=t.length,i=0,r=0;r<e;r++){var o=t[r],n=o.hidden;n||i++}return i},o._getTotalVisibleRows=function(t,e,i,r){var o=0,n=r?r.length:0,a=e,l=0,s=0,d=null,h=!1,c=!1,u=!!this.iHierarchy,f=this.options,p=f.detailModel.offset,g=0,v=22,w=u?this.$cont[0].offsetHeight:void 0;if(null==r||0==n)return{initV:d,finalV:d,tvRows:o,lastFrozenRow:d};for(var x=0,m=n>e?e:n;x<m;x++){var I=r[x],_=I.pq_hidden;if(!_&&(d=x,o++,u)){var b=I.pq_detail;if(b&&b.show){var q=b.height||0;q>p&&(q=p),g+=q+v}else g+=v}}if(n<e)return{initV:d,finalV:d,tvRows:o,lastFrozenRow:d};i-=o;for(var x=e,m=n;x<m;x++){var I=r[x],_=I.pq_hidden;if(h?c||(_?l++:s==i?c=!0:(l++,s++)):_?a++:s==t?(h=!0,l=a,s=0):(a++,s++),!_&&(o++,u&&h)){var b=I.pq_detail;if(b&&b.show){var q=b.height||0;q>p&&(q=p),g+=q+v}else g+=v;g>w&&(c=!0)}}return a>=n&&(a=n-1),l<a&&(l=a),{initV:a,finalV:l,tvRows:o,lastFrozenRow:d}},o._setScrollVLength=function(){var t=this.$cont.height(),e=this._getScollBarHorizontalHeight();this.$vscroll.css("bottom",e);var i=t-e;this.$vscroll.pqScrollBar("option","length",i)},o._setInnerGridHeight=function(){var t=this.options;if(!t.flexHeight){var e=this.element.height()-(t.showTop?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight;this.$grid_inner.height(e+"px")}},o._setRightGridHeight=function(){var t=this.options,e=this.$header,i=0;if(e?(i=e[0].offsetHeight,this.$header_o.height(i-2)):this.$header_o.height(0),!t.flexHeight){this.$vscroll.css("visibility",""),this.$tbl&&this.$tbl.css("marginBottom",0);var r=this.element.height()-this.$header_o[0].offsetHeight-(t.showTop?this.$top[0].offsetHeight:0)-this.$bottom[0].offsetHeight,o=0;this.$cont.height(r-o+"px")}},o._setGridHeightFromTable=function(){var t=0,e=this._getScollBarHorizontalHeight(),i=this.$tbl;i&&i.length?(t=i[0].offsetHeight-1,
i.css("marginBottom",e)):t=22;this.$cont.height(""),this.element.height(""),this.$grid_inner.height(""),this.$vscroll.css("visibility","hidden")},o._setGridWidthFromTable=function(){var t,e=this._getSBWidth();this.$tbl&&this.$tbl[0]&&this.$tbl[0].scrollWidth>0?(t=this.$tbl[0].scrollWidth,this.element.width(t+e+"px")):(t=d.call(this,-1,this.colModel.length),this.element.width(t+"px"))},o._bufferObj_minRowsPerGrid=function(){var t=this.$cont[0].offsetHeight;return Math.ceil(t/this.rowHeight)},o._calcCurPosFromRowIndxPage=function(t){var e=this.options,i=e.groupModel,r=i?this.dataGM:this.data,o=e.freezeRows;if(t<o)return 0;for(var n=0,a=o,l=o,s=r.length;l<s;l++){var d=r[l];if(i&&(d.groupSummary||d.groupTitle));else{if(a==t)break;a++}var h=d.pq_hidden;h||n++}return n>=s?null:n},o._calcCurPosFromColIndx=function(t){var e=this.options,i=(this.data,this.colModel),r=e.freezeCols;if(t<r)return 0;for(var o=0,n=r,a=r,l=i.length;a<l;a++){var s=i[a];if(n==t)break;n++;var d=s.hidden;d||o++}return o>=l?null:o},o._bufferObj_calcInitFinal=function(){var t=this.options,e=t.virtualY,i=t.freezeRows,r=t.flexHeight,o=t.groupModel,n=!!o,a=n?this.dataGM:this.data;t.treeModel;if(null==a||0==a.length){var l=this._getTotalVisibleRows(d,i,h,a);this.totalVisibleRows=l.tvRows,this.initV=l.initV,this.finalV=l.finalV,this.lastFrozenRow=l.lastFrozenRow}else{if(!e){var l=this._getTotalVisibleRows(0,i,h,a);return this.lastFrozenRow=l.lastFrozenRow,this.totalVisibleRows=l.tvRows,this.initV=0,void(this.finalV=a.length-1)}var s=this.$vscroll.pqScrollBar("option"),d=parseInt(s.cur_pos);if(isNaN(d)||d<0)throw"cur_pos NA";this.scrollCurPos=d;var h=this._bufferObj_minRowsPerGrid();this.pageSize=h;var l=this._getTotalVisibleRows(d,i,h,a);this.totalVisibleRows=l.tvRows,this.initV=l.initV,this.lastFrozenRow=l.lastFrozenRow,r?this.finalV=a.length-1:this.finalV=l.finalV}},o._bufferObj_calcInitFinalH=function(){var t=this.options,e=t.virtualX,i=this.colModel,r=i.length;if(!e)return this.initH=0,void(this.finalH=r-1);for(var o=parseInt(this.$hscroll.pqScrollBar("option","cur_pos")),n=parseInt(t.freezeCols),a=t.flexWidth,l=n,s=0,h=n;h<r;h++)if(i[h].hidden)l++;else{if(s==o)break;l++,s++}if(l>r-1&&(l=r-1),this.initH=l,a||!e)this.finalH=r-1;else{for(var c=d.call(this,-1,n),u=this.$cont[0].offsetWidth-this._getSBWidth(),h=l;h<r;h++){var f=i[h];if(!f.hidden){var p=f.outerWidth;if(!p&&t.debug)throw"outerwidth N/A";if(c+=p,c>u)break}}var g=h;g>r-1&&(g=r-1),this.finalH=g}};var d=function(t,e,i){var r=0,o=this.options,n=o.columnBorders,a=n?1:0,l=o.numberCell,s=this.colModel;if(t==-1&&(l.show&&(r+=i?parseInt(l.width)+1:l.outerWidth),t=0),i)for(var d=t;d<e;d++){var h=s[d],c=h.hidden;if(!c){if(!h._width)throw"assert failed";r+=h._width+a}}else for(var d=t;d<e;d++){var h=s[d];h.hidden||(r+=h.outerWidth)}return r};t.paramquery.pqgrid.calcWidthCols=d,o.calcHeightFrozenRows=function(){var e=this.$tbl,i=0;if(e&&e.length){var r=t(e[0]).find("tr.pq-last-freeze-row");if(r&&r.length){var o=r[0];i=o.offsetTop+o.offsetHeight}else i=0}return i},o._calcRightEdgeCol=function(t){var e=0,i=0,r=this.colModel,o=this.hidearrHS,n=this.options.numberCell;n.show&&(e+=n.outerWidth,i++);for(var a=0;a<=t;a++){var l=r[a];l.hidden||0!=o[a]||(e+=l.outerWidth,i++)}return{width:e,cols:i}},o._refreshFreezeLine=function(){var e=this.options,i=e.numberCell,r=this.$cont_o,o=e.freezeCols;if(this.$freezeLine&&this.$freezeLine.remove(),o){var n=d.call(this,-1,o)-1;if(isNaN(n)||0==n);else if(n>0&&i.show&&n==i.width);else{this.$freezeLine=t("<div class='pq-grid-vert-freezeline' ></div>").appendTo(r);var a=r[0].offsetHeight;this.$freezeLine.css({height:a,left:n})}}},o._getDragHelper=function(e){var i=this.options,r=parseInt(i.freezeCols),o=t(e.currentTarget);this.$cl=t("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner),this.$clleft=t("<div class='pq-grid-drag-bar'></div>").appendTo(this.$grid_inner);var n=parseInt(o.attr("pq-grid-col-indx")),a=this.$grid_inner.outerHeight();this.$cl.height(a),this.$clleft.height(a);var l=t("td[pq-grid-col-indx="+n+"]",this.$header)[0],s=l.offsetLeft;this.pqpanes.v?n>=r&&(s+=this.$header[1].offsetLeft):s+=this.$header[0].offsetLeft,this.$clleft.css({left:s}),s+=l.offsetWidth,this.$cl.css({left:s})},o._setDragLimits=function(t){var e=this,i=this.colModel,r=i[t],o=this.options,n=o.numberCell,a=e.$header_left;t>=o.freezeCols&&e.pqpanes.v&&(a=e.$header_right);var l=a.find("td[pq-grid-col-indx='"+t+"']"),s=l.offset().left+r._minWidth;t==-1&&(s=l.offset().left+n.minWidth);var d=s+r._maxWidth-r._minWidth,h=a.find("div.pq-grid-col-resize-handle[pq-grid-col-indx="+t+"]");h.draggable("option","containment",[s,0,d,0])},o.nestedCols=function(t,e,i){var r=t.length,o=[];null==e&&(e=1);for(var n=e,a=0,l=0,s=0,d=0;d<r;d++){var h=t[d];if(i!==!0&&i!==!1||(h.hidden=i),null!=h.colModel&&h.colModel.length>0){var c=this.nestedCols(h.colModel,e+1,h.hidden);o=o.concat(c.colModel),c.colSpan>0?(c.depth>n&&(n=c.depth),h.colSpan=c.colSpan,a+=c.colSpan):(h.colSpan=0,h.hidden=!0),h.childCount=c.childCount,s+=c.childCount}else h.hidden?h.colSpan=0:(h.colSpan=1,a++),h.childCount=0,s++,o.push(h)}return{depth:n,colModel:o,colSpan:a,width:l,childCount:s}},o.getHeadersCells=function(){for(var t=this.options.colModel,e=this.colModel.length,i=this.depth,r=[],o=0;o<i;o++){r[o]=[];for(var n=0,a=0,l=0;l<e;l++){var s;if(0==o)s=t[n];else{var d=r[o-1][l],h=d.colModel;if(null==h||0==h.length)s=d;else{for(var c=l-d.leftPos,u=0,f=0,p=0;p<h.length;p++)if(u+=h[p].childCount>0?h[p].childCount:1,c<u){f=p;break}s=h[f]}}var g=s.childCount?s.childCount:1;l==a?(s.leftPos=l,r[o][l]=s,a+=g,t[n+1]&&n++):r[o][l]=r[o][l-1]}}return this.headerCells=r,r},o.getDataType=function(){var t=this.colModel;if(t&&t[0]){var e=t[0].dataIndx;if("string"==typeof e)return"JSON";if("number"==typeof e)return"ARRAY"}throw"dataType unknown"},o.assignRowSpan=function(){for(var t=(this.options.colModel,this.colModel.length),e=this.headerCells,i=this.depth,r=0;r<t;r++)for(var o=0;o<i;o++){var n=e[o][r];if(!(r>0&&n==e[o][r-1]||o>0&&n==e[o-1][r])){for(var a=1,l=o+1;l<i;l++){var s=e[l][r];n==s&&a++}n.rowSpan=a}}return e},o._calcThisColModel=function(){var e=this.options,i=e.columnTemplate,r=e.colModel,o=this.nestedCols(r);if(this.colModel=o.colModel,this.depth=o.depth,i)for(var n=this.colModel,a=0,l=n.length;a<l;a++){var s=n[a];n[a]=t.extend({},i,s,!0)}this.getHeadersCells(),this.assignRowSpan()};var h=function(t){this.that=t},c=h.prototype;c._computeOuterWidths=function(){for(var t=this.that,e=t.options,i=e.columnBorders,r=i?1:0,o=e.numberCell,n=t.colModel,a=(t.outerWidths,n.length),l=0;l<a;l++){var s=n[l];s.outerWidth=s._width+r}o.show&&(o.outerWidth=o.width+1)},c.autoFit=function(){var t=this.that,e=t.options,i=(e.columnBorders?1:0,t.colModel),r=t.$cont,o=i.length,n=d.call(t,-1,o,!0),a=r[0].offsetWidth-t._getSBWidth();if(n!=a){for(var l,s=n-a,h=[],c=0;c<o;c++){var u=i[c],f=u._percent,p=(u.resizable!==!1,u._resized),g=u.hidden;if(!g&&!f&&!p){var v;s<0?(v=u._maxWidth-u._width,v&&h.push({availWd:-1*v,colIndx:c})):(v=u._width-u._minWidth,v&&h.push({availWd:v,colIndx:c}))}p&&(l=u,delete u._resized)}h.sort(function(t,e){return t.availWd>e.availWd?1:t.availWd<e.availWd?-1:0});for(var c=0,w=h.length;c<w;c++){var x,m=h[c],v=m.availWd,I=m.colIndx,_=Math.round(s/(w-c)),u=i[I],b=u._width;Math.abs(v)>Math.abs(_)?(x=b-_,s-=_):(x=b-v,s-=v),u.width=u._width=x}if(0!=s&&l){var x=l._width-s;x>l._maxWidth?x=l._maxWidth:x<l._minWidth&&(x=l._minWidth),l.width=l._width=x}}},c.autoLastColumn=function(){var t=this.that,e=t.options,i=e.columnBorders?1:0,r=t.colModel,o=r.length,n=e.freezeCols,a=t.$cont,l=a[0].offsetWidth-t._getSBWidth(),s=d.call(t,-1,n,!0),h=l-s,c=!1,u=t._getLastVisibleColIndx();if(null!=u){var f=r[u];if(!f._percent){for(var p,g=f._width,v=f._minWidth,w=f._maxWidth,x=o-1;x>=n;x--){var m=r[x];if(!m.hidden){var I=m._width+i;if(h-=I,h<0){c=!0,p=g+h>=v?g+h:g+I+h;break}}}c||(p=g+h),p>w?p=w:p<v&&(p=v),f.width=f._width=p}}},c.numericVal=function(t,e){return(t+"").indexOf("%")>-1?parseInt(t)*e/100:parseInt(t)},c.refreshColumnWidths=function(){var t=this.that,e=t.options,i=e.numberCell,r=e.flexWidth,o=e.columnBorders,n=o?1:0,a=t.colModel,l=e.scrollModel,s=l.lastColumn,d=l.autoFit,h=t.$cont,c=a.length,u=t._getSBWidth(),f=e._minColWidth,p=e._maxColWidth;if(h&&h[0].offsetWidth){var g=h[0].offsetWidth,v=0;i.show&&(i.width<i.minWidth&&(i.width=i.minWidth),i.outerWidth=i.width+1,v=i.outerWidth);var w=g-u-v,f=Math.floor(this.numericVal(f,w)),p=Math.ceil(this.numericVal(p,w)),x=0;if(w<5||isNaN(w)){if(e.debug)throw"availWidth N/A"}else{delete t.percentColumn;for(var m=0;m<c;m++){var I=a[m],_=I.hidden;if(!_){var b=I.width,q=(b+"").indexOf("%")>-1||null,y=I.minWidth,C=I.maxWidth,y=y?this.numericVal(y,w):f,C=C?this.numericVal(C,w):p;if(C<y&&(C=y),void 0!=b){var M,D=0;!r&&q?(t.percentColumn=!0,I.resizable=!1,I._percent=!0,M=this.numericVal(b,w)-n,D=Math.floor(M),x+=M-D,x>=1&&(D+=1,x-=1)):b&&(D=parseInt(b)),D<y?D=y:D>C&&(D=C),I._width=D}else I._width=y;q||(I.width=I._width),I._minWidth=y,I._maxWidth=C}}h&&0==r&&(d&&this.autoFit(),"auto"==s&&this.autoLastColumn()),this._computeOuterWidths()}}},o._createHeader=function(){var e=this,i=this.options,r=i.hwrap,o=parseInt(i.freezeCols),n=i.numberCell,a=this.colModel,l=(a.length,this.depth),s=i.virtualX,h=e.initH,c=e.finalH,u=(i.columnBorders,this.headerCells),f=(this.hidearrHS,this.$header),p=this.$header_o;if(i.showHeader===!1)return f&&f.empty(),void this.$header_o.css("display","none");this.$header_o.css("display","");var g="pq-grid-header-table ";g+=r?"pq-wrap ":"pq-no-wrap ";var v=["<table class='"+g+"' cellpadding=0 cellspacing=0 >"];if(l>=1){v.push("<tr>"),n.show&&v.push("<td style='width:"+(n.width+1)+"px;' ></td>");for(var w=0;w<=c;w++){if(w<h&&w>=o&&s&&(w=h,w>c))throw"initH>finalH";var x=a[w];if(!x.hidden){var m=x.outerWidth;v.push("<td style='width:"+m+"px;' pq-col-indx="+w+"></td>")}}v.push("</tr>")}for(var I="pq-grid-col ",_=0;_<l;_++){v.push("<tr class='pq-grid-title-row'>"),0==_&&n.show&&v.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='",l,"'>","<div class='pq-td-div'>",n.title?n.title:"&nbsp;","</div></td>"].join(""));for(var w=0;w<=c;w++){if(w<h&&w>=o&&s&&(w=h,w>c))throw"initH>finalH";this._createHeaderCell(_,w,u,v,I,o,h,l)}v.push("</tr>")}this.ovCreateHeader(v,I),v.push("</table>");var b=v.join("");p.empty(),this.pqpanes.v?p.append(["<span class='pq-grid-header pq-grid-header-left ui-state-default'>",b,"</span>","<span class='pq-grid-header ui-state-default'>",b,"</span>"].join("")):p.append(["<span class='pq-grid-header ui-state-default'>",b,"</span>"].join(""));var f=this.$header=t(".pq-grid-header",p);this.$tbl_header=f.children("table");var m=d.call(this,-1,o),q=this.$header_left=t(f[0]);if(this.pqpanes.v){var q=this.$header_left=t(f[0]),y=this.$header_right=t(f[1]);q.css({width:m,zIndex:10});var C=d.call(this,o,h);y.css({left:-1*C+"px"})}f.click(function(i){if(!e.iDragColumns||"stop"==e.iDragColumns.status){var r=t(i.target),o=r.closest(".pq-g-ficon");if(o.length){var n=o.attr("pq-col-indx");return i.stopImmediatePropagation(),e.iHeaderIconSearch.createDOM(n,o,i)}var a=r.closest("td.pq-grid-col");if(a.length){i.stopImmediatePropagation();var n=a.attr("pq-grid-col-indx");if(null!=n)return e._onHeaderCellClick(n,i)}}}),this._refreshResizeColumn(h,c,a),this._trigger("refreshHeader",null,null)},o._createHeaderCell=function(t,e,i,r,o,n,a,l){var s=i[t][e],d=s.colSpan,h=s.halign,c=s.align,u=s.title,u=u?u:"";if(!(t>0&&s==i[t-1][e]||e>0&&s==i[t][e-1]||s.hidden)){var f=o;null!=h?f+=" pq-align-"+h:null!=c&&(f+=" pq-align-"+c),e==n-1&&1==l&&(f+=" pq-last-freeze-col"),e<=n-1?f+=" pq-left-col":e>=a&&(f+=" pq-right-col");var p=s.cls;p&&(f=f+" "+p);var g="",v="";null!=s.colModel&&0!=s.colModel.length||(g="pq-grid-col-indx='"+e+"'");var w="pq-row-indx="+t,x="pq-col-indx="+e;r.push(["<td ",g," ",x," ",w," ",v," class='",f,"' rowspan=",s.rowSpan," colspan=",d,">","<div class='pq-td-div'>",u,"<span class='pq-col-sort-icon'>&nbsp;</span></div></td>"].join(""))}},o.ovCreateHeader=function(){},o._refreshResizeColumn=function(e,i,r){var o=this,n=this.options,a=(n.virtualX,!!n.filterModel.ficon),l=n.numberCell,s=o.$header.height(),d=parseInt(n.freezeCols),h=[],c=[];if(l.show&&l.resizable){var u=o.$header_left.find("td.pq-grid-number-col")[0];w=parseInt(u.offsetLeft)+(u.offsetWidth-10),h.push("<div pq-grid-col-indx='-1' style='left:",w,"px;height:",s,"px;' class='pq-grid-col-resize-handle'>&nbsp;</div>")}for(var f=0;f<=i;f++){if(f<e&&f>=d&&(f=e,f>i))throw"initH>finalH";var p=r[f];if(!p.hidden){var g,u,v,w,x=p.ficon,m=x||null==x&&a,I=h;(p.resizable!==!1||m)&&(g=o.$header_left,this.pqpanes.v&&f>=d&&(g=o.$header_right,I=c),u=g.find("td[pq-grid-col-indx="+f+"]")[0],v=parseInt(u.offsetLeft),w=v+(u.offsetWidth-5)),p.resizable!==!1&&I.push("<div pq-grid-col-indx='",f,"' style='left:",w,"px;height:",s,"px;' class='pq-grid-col-resize-handle'>&nbsp;</div>")}}o.$header_left.append(h.join("")),c.length&&o.$header_right.append(c.join(""));var _,b,q;o.$header.find(".pq-grid-col-resize-handle").draggable({axis:"x",helper:function(e,i){var r=t(e.target),n=parseInt(r.attr("pq-grid-col-indx"));return o._setDragLimits(n),o._getDragHelper(e,i),r},start:function(t,e){_=e.position.left,q=parseInt(o.$cl[0].style.left)},drag:function(t,e){b=e.position.left;var i=b-_;o.$cl[0].style.left=q+i+"px"},stop:function(t,e){return o._refreshResizeColumnStop(t,e,r,_)}})},o._refreshResizeColumnStop=function(e,i,r,o){var n=this,a=this.options,l=a.numberCell;n.$clleft.remove(),n.$cl.remove();var s,d=i.position.left,h=d-o,c=t(i.helper),u=parseInt(c.attr("pq-grid-col-indx"));if(u==-1){s=null;var f=parseInt(l.width),p=f+h;l.width=p}else{s=r[u];var f=parseInt(s.width),p=f+h;s.width=p,s._resized=!0}n.refresh(),n._trigger("columnResize",e,{colIndx:u,column:s,dataIndx:s?s.dataIndx:null,oldWidth:f,newWidth:s?s.width:l.width})},o._refreshHeaderSortIcons=function(){var t=this.options.dataModel;if(void 0!=t.sortIndx){var e=this.$header,i=e.find(".pq-grid-col");i.removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active"),e.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");var r=t.sortIndx,o=this.getColIndx({dataIndx:r}),n="ui-state-active pq-col-sort-"+("up"==t.sortDir?"asc":"desc"),a="ui-icon ui-icon-triangle-1-"+("up"==t.sortDir?"n":"s");e.find(".pq-grid-col[pq-grid-col-indx="+o+"]").addClass(n),e.find(".pq-grid-col[pq-grid-col-indx="+o+"] .pq-col-sort-icon").addClass(a)}},o.createTable=function(t){this.iGenerateView.generateView(t)},t.widget("paramquery._pqGrid",t.ui.mouse,o),t.measureTime=function(t,e){(new Date).getTime();t();(new Date).getTime()}}(jQuery),function(t){function e(e){var i=this;this.that=e,this.type="detail",this.refreshComplete=!0,this.detachView=!1;var r=e.widgetEventPrefix.toLowerCase(),o=e.eventNamespace;e.element.on(r+"cellclick"+o,function(t,e){if(i.belongs(t))return i.cellClick(t,e)}),e.element.on(r+"cellkeydown"+o,function(e,r){if(i.belongs(e)&&e.keyCode==t.ui.keyCode.ENTER)return i.cellClick(e,r)}),e.element.on(r+"aftertable"+o,function(t,e){if(i.belongs(t))return i.aftertable(t,e)}),e.element.on(r+"beforetableview"+o,function(t,e){if(i.belongs(t))return i.beforeTableView(t,e)}),e.element.on(r+"beforerefreshdata"+o,function(t,e){if(i.belongs(t))return i.beforeRefreshData(t,e)})}var i=t.paramquery.cClass,r=(t.paramquery.pqgrid.calcWidthCols,{});r.getFocusElement=function(){var e=document.activeElement;if(e){var i=t(e),r=i.closest(".pq-grid");if(r.length)return r[0]==this.element[0]?{$ae:i,$grid:r}:{$ae:i,$childGrid:r}}},r.inViewPort=function(e){var i=this,r=i.$cont[0],o=r.offsetHeight-i._getScollBarHorizontalHeight(),n=r.offsetWidth-i._getSBWidth()+1,a=e[0],l=t(a.offsetParent),s=parseInt(l.css("marginTop")),d=parseInt(l.css("marginLeft"));if(o>=a.offsetTop+a.offsetHeight+s){if("TD"!=a.nodeName.toUpperCase())return!0;if(n>=a.offsetLeft+a.offsetWidth+d)return!0}};var o=e.prototype=new i;o.aftertable=function(e,i){var r=this.that,o=r.options.detailModel.init,n=r.data;if(this.refreshComplete){this.refreshComplete=!1;for(var a=r.$tbl.children("tbody").children("tr.pq-detail-child"),l=0;l<a.length;l++){var s=a[l],d=t(s),h=d.attr("pq-row-indx"),c=n[h],u=c.pq_detail.child;u||"function"==typeof o&&(u=o.call(r.element[0],{rowData:c}),c.pq_detail.child=u);var f=u.find(".pq-header-outer");if(d.children("td.pq-detail-child").append(u),0==f.height())try{u.pqGrid("refresh")}catch(t){}}this.refreshComplete=!0,this.detachView=!1}},o.beforeTableView=function(t,e){this.detachView||this.detachInitView(t,e)},o.beforeRefreshData=function(t,e){this.detachView||this.detachInitView(t,e)},o.detachInitView=function(e,i){var r=this.that,o=r.data;if(o&&o.length){for(var n,a,l,s=r.$tbl.children("tbody").children("tr.pq-grid-row"),d=0;d<s.length;d++){var h=s[d],c=t(h),u=c.attr("pq-row-indx"),f=o[u];if(null!=u&&u!=n&&(n=u,f.pq_detail)){if(a=null,l=0,f.pq_detail.child){var p=c.next();if(p.hasClass("pq-detail-child")){var g=p.children("td.pq-detail-child").children();g.length&&(l=g[0].offsetHeight,a=g.detach())}}a&&a.length&&(f.pq_detail.child=a,f.pq_detail.height=l)}}this.detachView=!0}},o.cellClick=function(t,e){var i=this.that,r=e.column,o=e.rowData,n=e.rowIndx,a=this.type;if(r&&r.type===a){var l="pq_detail";null==o[l]?i.rowExpand({rowIndx:n,scrollRow:!0}):o[l].show===!1?i.rowExpand({rowIndx:n,scrollRow:!0}):i.rowCollapse({rowIndx:n,scrollRow:!0})}},r.rowExpand=function(t){var e=this.getRowData(t),i=this.options.detailModel,r="pq_detail";if(null!=e){if(null==e[r]?e[r]={show:!0}:e[r].show===!1&&(e[r].show=!0),!i.cache){var o=e[r].child;o&&(o.remove(),e[r].child=null,e[r].height=0)}if(this.refresh(),t.scrollRow){var n=t.rowIndx;this.scrollRow({rowIndx:n})}}},r.rowInvalidate=function(t){var e=this.getRowData(t),i="pq_detail",r=e[i].child;r.remove(),e[i].child=null},r.rowCollapse=function(t){var e=this.getRowData(t),i=this.options.detailModel,r="pq_detail";if(null!=e&&null!=e[r]&&e[r].show===!0){if(!i.cache){var o=e[r].child;o&&(o.remove(),e[r].child=null,e[r].height=0)}if(e[r].show=!1,this.refresh(),t.scrollRow){var n=t.rowIndx;this.scrollRow({rowIndx:n})}}};var n=function(e){function i(t,i,r){e.filter({data:[{dataIndx:t,value:i,value2:r}]})}this.that=e;var r=this;this.dataHS={};var o=e.widgetEventPrefix.toLowerCase(),n=e.eventNamespace;e.element.on(o+"headerkeydown"+n,function(e,i){if(r.belongs(e)){var o=t(e.originalEvent.target);return!o.hasClass("pq-search-hd-field")||r.onKeyDown(e,i,o)}}),e.element.on(o+"createheader"+n,function(t,e){if(r.belongs(t))return r._onCreateHeader()}),this.changeListener={change:function(t,e){i(e.dataIndx,e.value,e.value2)}},this.keyupListener={keyup:function(t,e){i(e.dataIndx,e.value,e.value2)}},this.clickListener={click:function(t,e){i(e.dataIndx,e.value)}}},a=n.prototype=new i;a.get$Ele=function(e,i){var r,o=this.that,n=o.options.freezeCols,a=t(o.$tbl_header[0]),l=".pq-search-hd-field[name='"+i+"']",s=t(o.$tbl_header[2==o.$tbl_header.length?1:0]);return r=e>=n?s.find(l):a.find(l)},a.onKeyDown=function(e,i,r){var o=this.that,n=e.keyCode,a=t.ui.keyCode;if(n!==a.TAB)return!0;var l,s=r.attr("name"),d=o.getColIndx({dataIndx:s}),h=o.colModel,c=e.shiftKey,u=h[d];if("between"==u.filter.condition){o.scrollColumn({colIndx:d});var f=this.get$Ele(d,s);if(f[0]==r[0]?c||(l=f[1]):c&&(l=f[0]),l)return l.focus(),e.preventDefault(),!1}for(;;){if(c?d--:d++,d<0||d>=h.length)break;var u=h[d],p=u.filter;if(!u.hidden&&p){o.scrollColumn({colIndx:d});var l,s=u.dataIndx,l=this.get$Ele(d,s);if("between"==p.condition&&(l=t(c?l[1]:l[0])),l)return l.focus(),e.preventDefault(),!1;break}}},a._bindFocus=function(){function e(e){r._fixTableViewPort();var i=t(e.target),n=i.attr("name");if(r.scrollColumn({dataIndx:n})){var a=r.getColIndx({dataIndx:n}),l=o.get$Ele(a,n);l.focus()}}function i(t){t.addEventListener?t.addEventListener("focus",e,!0):t.onfocusin=function(){var t=window.event;t.target=t.srcElement,e(t)}}for(var r=this.that,o=this,n=r.$header.find(".pq-grid-header-search"),a=0;a<n.length;a++)i(n[a])},a._onCreateHeader=function(){var e=this,i=this.that,r=i.options,o=r.columnBorders,n=r.filterModel;if(n.header){this._bindFocus();var a=i.colModel,l=i.initH,s=i.finalH,d=r.freezeCols,h=r.virtualX,c=i.$tbl_header,u=t(c[0]),f=t(c[1]),p="input,select";if(c.length>1){u.find(p).css("visibility","hidden");for(var g=0;g<d;g++){var v=a[g],w=v.dataIndx,p="*[name='"+w+"']";u.find(p).css("visibility","visible"),f.find(p).css("visibility","hidden")}}for(var g=0;g<=s;g++){if(g<l&&g>=d&&h&&(g=l,g>s))throw"initH>finalH";var v=a[g];if(!v.hidden){var x=v.filter;if(x){var m=v.dataIndx,I=u;g>=d&&c.length>1&&(I=f);var _=I.find("*[name='"+m+"']");if(0!=_.length){var b=x.type,q=x.value,y=x.value2;if("checkbox"==b&&"triple"==x.subtype)_.pqval({val:q});else if("select"==b){_.val(q);var C=this.getWidth(v,o);_.css({width:C})}var M=x.init;M&&M.call(_,{dataIndx:m,column:v});var D=x.listeners;if(D)for(var P=0;P<D.length;P++){var R=D[P];"string"==typeof R&&(R=e[R+"Listener"]);for(var $ in R){var S=R[$];!function(e,r,o){e.bind($,function(n){var a=i.getColumn({dataIndx:o}),l=a.filter;return"checkbox"==l.type?q="triple"==l.subtype?e.pqval({incr:!0}):!!e.is(":checked"):"between"==l.condition?(q=t(e[0]).val(),y=t(e[1]).val()):q=e.val(),r.call(this,n,{column:a,dataIndx:o,value:q,value2:y})})}(_,S,m)}}}}}}}},a.getWidth=function(t,e){var i=parseInt(t.width)+(e?1:0),i=i-15;return i},a.createDOM=function(e,i){var r=this.that,o=r.initH,n=r.finalH,a=r.options,l=a.freezeCols,s=a.virtualX,d=r.colModel,h=a.columnBorders,c=(this.dataHS,a.numberCell);e.push("<tr class='pq-grid-header-search'>"),c.show&&e.push(["<td pq-grid-col-indx='-1' class='pq-grid-number-col' rowspan='1'>","<div class='pq-grid-header-table-div'>&nbsp;</div></td>"].join(""));for(var u=0;u<=n;u++){if(u<o&&u>=l&&s&&(u=o,u>n))throw"initH>finalH";var f=d[u];if(!f.hidden){var p=i,g=f.halign;g||(g=f.align),"right"==g?p+=" pq-align-right":"center"==g&&(p+=" pq-align-center");var v=f.cls;v&&(p=p+" "+v);var w=f.filter;if(w){var x,m=f.dataIndx,I=w.type,_=w.value,b=w.condition,q=this.getWidth(f,h),y=w.cls,y="pq-search-hd-field "+(y?y:""),C=w.style,C=C?C:"",M=w.attr,M=M?M:"",D="";if("between"==b)var P=w.value2,P=null!=P?P:"",x=q/2-9;if("textbox"===I)_=_?_:"",y+=" ui-corner-all pq-search-txt","between"==b?(D=this._input(m,_,x,y+" pq-from",C,M),D+="-"+this._input(m,P,x,y+" pq-to",C,M)):D=this._input(m,_,q,y,C,M);else if("textarea"===I)_=_?_:"",y+=" ui-corner-all pq-search-txt","between"==b?(D=this._textarea(m,_,x,y,C,M),D+="-"+this._textarea(m,P,x,y,C,M)):D=this._textarea(m,_,q,y,C,M);else if("select"===I)if(w.cache)D=w.cache;else{var R=w.options;"function"==typeof R&&(R=R.call(r.element[0],{column:f,value:_,dataIndx:m,cls:y,style:C,attr:M})),y+=" ui-corner-all";var $=["name='",m,"' class='",y,"' style='width:",q,"px;",C,"' ",M].join("");D=t.paramquery.select({options:R,attr:$,prepend:w.prepend,valueIndx:w.valueIndx,labelIndx:w.labelIndx,groupIndx:w.groupIndx}),w.cache=D}else if("checkbox"==I){var S=null==_||0==_?"":"checked=checked";D=["<input ",S," name='",m,"' type=checkbox class='"+y+"' style='"+C+"' "+M+"/>"].join("")}else"string"==typeof I?D=I:"function"==typeof I&&(D=I.call(r.element[0],{width:q,value:_,value2:P,column:f,dataIndx:m,cls:y,attr:M,style:C}));e.push(["<td class='",p,"'><div class='pq-grid-header-table-div' style='padding:0px 2px;' >","",D,"</div></td>"].join(""))}else e.push(["<td class='",p,"'><div class='pq-grid-header-table-div' >","&nbsp;","</div></td>"].join(""))}}e.push("</tr>")},a._input=function(t,e,i,r,o,n){return['<input value="',e,"\" name='",t,"' type=text style='width:",i,"px;"+o+"' class='"+r+"' "+n+" />"].join("")},a._textarea=function(t,e,i,r,o,n){return["<textarea name='",t,"' style='width:",i,"px;"+o+"' class='"+r+"' "+n+" >",e,"</textarea>"].join("")},t.paramquery.select=function(t){var e,i,r=t.attr,o=t.options,n=t.groupIndx,a=t.labelIndx,l=t.valueIndx,s=t.prepend,d=["<select ",r," >"];if(s)for(var h in s)d.push('<option value="',h,'">',s[h],"</option>");if(n){if(o&&o.length){for(var c=0,u=o.length;c<u;c++){var f=o[c],p=f[l];if(null!=p)if(e=f[n],i!=e&&(null!=i&&d.push("</optgroup>"),d.push('<optgroup label="',e,'">'),i=e),l!=a){var g=f[a];d.push('<option value="',p,'">',g,"</option>")}else d.push("<option>",p,"</option>")}d.push("</optgroup>")}}else if(o&&o.length)for(var c=0,u=o.length;c<u;c++){var f=o[c];if(null!=a&&null!=l){var p=f[l];if(null==p)continue;if(a==l)d.push("<option>",p,"</option>");else{var g=f[a];d.push('<option value="',p,'">',g,"</option>")}}else if("object"==typeof f)for(var h in f)d.push('<option value="',h,'">',f[h],"</option>");else d.push("<option>",f,"</option>")}return d.push("</select>"),d.join("")},t.fn.pqval=function(t){if(t){if(t.incr){var e=this.data("pq_value");return this.prop("indeterminate",!1),e?(e=!1,this.removeAttr("checked")):e===!1?(e=null,this.prop("indeterminate",!0),this.removeAttr("checked")):(e=!0,this.attr("checked","checked")),this.data("pq_value",e),e}var e=t.val;return this.data("pq_value",e),this.prop("indeterminate",!1),null==e?(this.prop("indeterminate",!0),this.removeAttr("checked")):e?this.attr("checked","checked"):this.removeAttr("checked"),this}return this.data("pq_value")};var l={};l._generateTitleRow=function(t,e,i,r){var o=this.that,n=o.options,a=n.numberCell,l=e.groupTitle,s=t.title,d=e.level,h=e.GMRowIndx,c=t.icon,c=c?c[d]:null,c=c&&c.length&&2==c.length&&"function"==typeof c.push?c:["ui-icon-minus","ui-icon-plus"];if(s&&null!=s[d]){if(s[d]===!1)return;l=s[d].replace("{0}",l),l=l.replace("{1}",e.items)}else l=l+" - "+e.items+" item(s)";i.push(["<tr class='pq-group-row pq-grid-row",r?" pq-last-freeze-row":"","' title=\"",e.groupTitle,"\" level='",d,"' GMRowIndx='",h,"'>"].join("")),a.show&&i.push("<td class='pq-grid-number-cell ui-state-default'>&nbsp;</td>");var u=c[0];e.collapsed&&(u=c[1]),i.push("<td class='pq-grid-cell' colSpan='100' >","<div class='pq-td-div' style='margin-left:",16*d,"px;'>","<span class='ui-icon ",u,"'></span>",l,"</div></td>"),i.push("</tr>")},l._generateSummaryRow=function(t,e,i,r){var o="pq-summary-row pq-grid-row"+(r?" pq-last-freeze-row":""),n=this.that,a=n.options,l=a.virtualX,s=n.initH,d=n.finalH,h=a.freezeCols,c=a.numberCell,u=a.columnBorders,f=(a.wrap,this.offset,"pq-grid-cell "),p="<tr class='"+o+"'>";i.push(p),c.show&&i.push(["<td class='pq-grid-number-cell ui-state-default'>","&nbsp;</td>"].join(""));for(var g=0;g<=d;g++){if(g<s&&g>=h&&l&&(g=s,g>d))throw"initH>finalH";var v=e[g],w=v.dataIndx;if(!v.hidden){var x="",m=f;"right"==v.align?m+=" pq-align-right":"center"==v.align&&(m+=" pq-align-center"),g==h-1&&u&&(m+=" pq-last-freeze-col"),v.cls&&(m=m+" "+v.cls);var I=null==t[w]?"&nbsp;":t[w],_=["<td class='",m,"' style='",x,"' >",I,"</td>"].join("");i.push(_)}}return i.push("</tr>"),i},l._generateDetailRow=function(t,e,i,r,o,n){var a="pq-grid-row pq-detail-child";n&&(a+=" pq-last-freeze-row");var l=this.that,s=l.options,d=s.numberCell,h=(i.length,this.offset,"pq-grid-cell ");s.wrap&&!o||(h+="pq-wrap-text "),s.stripeRows&&e/2==parseInt(e/2)&&(a+=" pq-grid-oddRow"),t.pq_rowselect&&(a+=" pq-row-select ui-state-highlight");var c=t.pq_rowcls;return null!=c&&(a+=" "+c),r.push("<tr pq-row-indx='"+e+"' class='"+a+"' >"),d.show&&r.push(["<td class='pq-grid-number-cell ui-state-default'>","&nbsp;</td>"].join("")),r.push("<td class='"+h+" pq-detail-child' colSpan='20'></td>"),r.push("</tr>"),r};var s=function(t){this.that=t},d=s.prototype;d._refreshDataFromDataModel=function(){this._groupData(),this.initcollapsed()},d.bindEvents=function(){var t=this;this.that.$cont.on("click","tr.pq-group-row",function(e){return t.onClickGroupRow(e)})},d.showHideRows=function(t,e,i){for(var r=[],o=this.that,n=o.dataGM,a=t,l=n.length;a<l;a++){var s=n[a],d=s;if(d.groupSummary){if(s.level<e)break;s.pq_hidden=i}else if(d.groupTitle){if(s.collapsed&&r.push({indx:a,level:s.level}),s.level<=e)break;s.pq_hidden=i}else s.pq_hidden=i}return r},d.onClickGroupRow=function(e){var i=t(e.currentTarget),r=this.that,o=parseInt(i.attr("level")),n=parseInt(i.attr("GMRowIndx")),a=r.dataGM,l=!0,s=a[n];if(s.collapsed?(s.collapsed=!1,l=!1):(s.collapsed=!0,l=!0),l)this.showHideRows(n+1,o,!0);else for(var d=this.showHideRows(n+1,o,!1),h=0;h<d.length;h++){var c=d[h].indx,o=d[h].level;this.showHideRows(c+1,o,!0)}r.refresh()},d.initcollapsed=function(){var t=this.that,e=t.dataGM;if(e)for(var i=0,r=e.length;i<r;i++){var o=e[i],n=o.groupTitle;if(void 0!==n){var a=o.level,l=o.collapsed;l&&this.showHideRows(i+1,a,!0)}}},d.max=function(t,e){var i;return"integer"==e||"float"==e?(i=Math.max.apply(Math,t),"float"===e&&(i=i.toFixed(2))):"date"==e?(t=t.sort(function(t,e){return t=Date.parse(t),e=Date.parse(e),t-e}),i=t[t.length-1]):(t=t.sort(),i=t[t.length-1]),i},d.min=function(t,e){var i;return"integer"==e||"float"==e?(i=Math.min.apply(Math,t),"float"===e&&(i=i.toFixed(2))):"date"==e?(t=t.sort(function(t,e){return t=Date.parse(t),e=Date.parse(e),t-e}),i=t[0]):(t=t.sort(),i=t[0]),i},d.count=function(t){return t.length},d.sum=function(t,e){var i,r=0;i="float"===e?parseFloat:"integer"===e?parseInt:function(t){return t};for(var o=0,n=t.length;o<n;o++)r+=i(t[o]);return"float"===e&&(r=r.toFixed(2)),r},d._groupData=function(){for(var e=this.that,i=e.data,r=e.options,o=r.groupModel,n=r.pageModel,a=e.colModel,l=n.type?(n.curPage-1)*n.rPP:0,s=a.length,d=o.dataIndx,h=d.length,c=o.collapsed,u=[],f=0;f<h;f++){u[f]=!1;for(var p=0;p<s;p++){var g=a[p],v=g.summary;if(v){var w=v.type;if(w&&"function"==typeof w.push&&w[f]){u[f]=!0;break}}}}if(o&&i&&i.length>0){for(var x=[],m=[],I=[],_=[],b=[],f=0;f<h;f++)_[f]="",I[f]="",b[f]={};for(var q=0,y=i.length;q<=y;q++){for(var C=i[q],M=!1,D=null,f=0;f<h;f++)I[f]=q<y?t.trim(C[d[f]]):"",_[f]!=I[f]&&(M=!0),M&&null==D&&(D=f);if(M){for(var P=0;P<h;P++)_[P]=I[P];if(q>0){for(var f=h-1;f>=D;f--)if(u[f]){for(var R=[],$=0;$<s;$++){var g=a[$],v=g.summary,w=v&&v.type?v.type[f]:null;if(w){var S=g.dataIndx,T="",H=v.title?v.title[f]:null,k="{0}";"function"==typeof w?T=w(b[f][S],g.dataType):(k=w+": {0}",T=this[w](b[f][S],g.dataType)),H&&(k=H),R[S]=k.replace("{0}",T)}}x.push({groupSummary:!0,level:f,data:R})}for(var E=D;E<h;E++)x[m[E]].items=b[E][a[0].dataIndx].length}if(q==y)break;for(var V=h-1;V>=D;V--)for(var z=0;z<s;z++){var g=a[z];b[V][g.dataIndx]=[]}for(var E=D;E<h;E++)x.push({groupTitle:I[E],level:E,GMRowIndx:x.length,collapsed:!(!c||null==c[E])&&c[E]}),m[E]=x.length-1}C.rowIndx=q+l,C.pq_hidden=!1,x.push(C);for(var W=0;W<s;W++)for(var g=a[W],S=g.dataIndx,f=0;f<h;f++)b[f][S].push(C[S])}e.dataGM=x}else e.dataGM=null};var h=function(e){this.that=e,this.$drag_helper=null;var i=e.options.dragColumns,r=i.topIcon,o=i.bottomIcon,n=this;this.status="stop",this.$arrowTop=t("<div class='pq-arrow-down ui-icon "+r+"'></div>").appendTo(e.element),this.$arrowBottom=t("<div class='pq-arrow-up ui-icon "+o+"' ></div>").appendTo(e.element),this.hideArrows(),i&&i.enabled&&e.$header_o.on("mousedown","td.pq-grid-col",function(e,i){if(!t(e.target).is("input,select,textarea")&&!e.pq_composed){n.setDraggables(e,i),e.pq_composed=!0;var r=t.Event("mousedown",e);t(e.target).trigger(r)}})},c=h.prototype;c.showFeedback=function(t,e){var i=this.that,r=t[0],o=r.offsetParent.offsetParent,n=r.offsetLeft+o.offsetLeft+(e?0:r.offsetWidth)-8,a=i.$grid_inner[0].offsetTop+r.offsetTop-16,l=i.$grid_inner[0].offsetTop+i.$header[0].offsetHeight;this.$arrowTop.css({left:n,top:a,display:""}),this.$arrowBottom.css({left:n,top:l,display:""})},c.showArrows=function(){this.$arrowTop.show(),this.$arrowBottom.show()},c.hideArrows=function(){this.$arrowTop.hide(),this.$arrowBottom.hide()},c.updateDragHelper=function(t){var e=this.that,i=e.options.dragColumns,r=i.acceptIcon,o=i.rejectIcon,n=this.$drag_helper;n&&(t?(n.children("span.pq-drag-icon").addClass(r).removeClass(o),n.removeClass("ui-state-error")):(n.children("span.pq-drag-icon").removeClass(r).addClass(o),n.addClass("ui-state-error")))},c.setDraggables=function(e,i){var r=t(e.currentTarget),o=this.that,n=o.options.dragColumns,a=n.rejectIcon,l=this;r.hasClass("ui-draggable")||o.getHeaderColumnFromTD(r)&&r.draggable({
distance:10,cursorAt:{top:-18,left:-10},helper:function(){var e=t(this);l.status="helper",l._setupDroppables(e),o.$header.find(".pq-grid-col-resize-handle").hide();var i=e.attr("pq-col-indx"),r=e.attr("pq-row-indx");e.droppable("destroy");var n=o.headerCells[r][i],s=t("<div class='pq-col-drag-helper ui-widget-content ui-corner-all' ><span class='pq-drag-icon ui-icon "+a+"'></span>"+n.title+"</div>");return l.$drag_helper=s,s[0]},zIndex:"1000",appendTo:o.element,revert:"invalid",drag:function(e,i){l.status="drag";var r=t("td.pq-drop-hover",o.$header);if(r.length>0){l.showArrows(),l.updateDragHelper(!0);var n=r.width(),a=e.clientX-r.offset().left+t(document).scrollLeft();a<n/2?(l.leftDrop=!0,l.showFeedback(r,!0)):(l.leftDrop=!1,l.showFeedback(r,!1))}else l.hideArrows(),o.$toolbar.hasClass("pq-drop-hover")?l.updateDragHelper(!0):l.updateDragHelper()},stop:function(t,e){l.status="stop",o.$header.find(".pq-grid-col-resize-handle").show(),l.hideArrows()}})},c._columnIndexOf=function(t,e){for(var i=0,r=t.length;i<r;i++)if(t[i]==e)return i;return-1},c._setupDroppables=function(e){var i=this.that,r=(i.options,this),o={hoverClass:"pq-drop-hover ui-state-highlight",tolerance:"pointer",drop:function(e,o){if(!i.dropPending){var n,a,l=parseInt(o.draggable.attr("pq-col-indx")),s=parseInt(o.draggable.attr("pq-row-indx")),d=parseInt(t(this).attr("pq-col-indx")),h=t(this).attr("pq-row-indx"),c=i.options.colModel,u=i.headerCells,f=u[s][l];n=0==s?c:u[s-1][l].colModel,a=0==h?c:u[h-1][d].colModel;var p=u[h][d],g=r._columnIndexOf(n,f),v=n.splice(g,1)[0],w=r._columnIndexOf(a,p),x=r.leftDrop?1:0;a.splice(w+1-x,0,v),i.dropPending=!0,window.setTimeout(function(){i._calcThisColModel(),i.refresh(),i.dropPending=!1},0)}}},n=i.$header_left.find("td.pq-left-col"),a=i.pqpanes.v?i.$header_right.find("td.pq-right-col"):i.$header_left.find("td.pq-right-col");n=n.add(a),n.each(function(e,i){var r=t(i);r.hasClass("ui-droppable")||r.droppable(o)})},r.options={detailModel:{cache:!0,offset:100,expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},dragColumns:{enabled:!0,acceptIcon:"ui-icon-check",rejectIcon:"ui-icon-closethick",topIcon:"ui-icon-circle-arrow-s",bottomIcon:"ui-icon-circle-arrow-n"},track:!1,treeModel:{collapsed:!0,indent:15,leafIcon:"ui-icon-radio-off",expandIcon:"ui-icon-triangle-1-se",collapseIcon:"ui-icon-triangle-1-e"},filterModel:{on:!0,mode:"AND",header:!1}},r._create=function(){t.extend(t.paramquery.cGenerateView.prototype,l);var e=this;this.options;this.iGroupView=new s(this),this.iHeaderSearch=new n(this),this.iUCData=new t.paramquery.cUCData(this),this.iMouseSelection=new t.paramquery.cMouseSelection(this),this._super.apply(this),this.iGroupView.bindEvents(),this.iDragColumns=new h(this),this._createToolbar(),this.refreshHeader(),this.refreshDataAndView({header:!1}),this.refresh({table:!0});var i=e.widgetEventPrefix.toLowerCase(),r=e.widgetName;e.element.one(i+"load."+r,function(t,i){e.refresh({header:!1})})},r._createToolbar=function(){var e=this.options,i=e.toolbar;if(i){var r=i,o=r.cls,o=o?o:"",n=r.style,n=n?n:"",a=r.attr,a=a?a:"",l=r.items,s=t("<div class='"+o+"' style='"+n+"' "+a+" ></div>").appendTo(t(".pq-grid-top",this.element));s.pqToolbar({items:l,gridInstance:this}),e.showToolbar||s.css("display","none"),this.$toolbar=s}},r.isLeftOrRight=function(t){var e=(this.options,this.freezeCols);return t>e?"right":"left"},r.ovCreateHeader=function(t,e){this.options.filterModel.header&&this.iHeaderSearch.createDOM(t,e)},r._createHeader=function(){this._super.apply(this),this.options.showHeader&&this._trigger("createHeader")},r.exportExcel=function(e){return e.format="xml",t.paramquery.pqgrid.exportToExcel.call(this,e)},r.exportCsv=function(e){return e.format="csv",t.paramquery.pqgrid.exportToExcel.call(this,e)},r.filter=function(e){var i=this,r=this.options,o=void 0===e.apply||e.apply,n=void 0===e.sort||e.sort,a=r.dataModel,l=r.filterModel;if(void 0!=e)for(var s="replace"==e.oper,d=e.data,h=this.colModel,h=o?h:t.extend(!0,[],h),c=0,u=h.length,f=d.length,p=0;p<u;p++){for(var g=h[p],v=!1,w=0;w<f&&c!=f;w++){var x=d[w];if(x.dataIndx==g.dataIndx){v=!0,c++;var m=g.filter,I=x.condition,_=x.value;if(m?m.on=!0:m=g.filter={on:!0},I&&(m.condition=I),I=m.condition,m.value=_,"between"==I)m.value2=x.value2;else if("range"==I){var b=[];if(_)if("string"==typeof _){var q=m.options,y=_.indexOf('"'),C=_.lastIndexOf('"');if(_=_.substr(y,C+1),_=JSON.parse("["+_+"]"),q)for(var M=0,D=q.length;M<D;M++){var P=q[M];t.inArray(P,_)!=-1&&b.push(P)}else b=_.split(",s*")}else"function"==typeof _.push&&(b=_);m.value=b}break}}s&&!v&&g.filter&&(g.filter.on=!1)}var R={header:!1,apply:o,sort:n,CM:h};return"remote"!=a.location||"local"==l.type?i._onDataAvailable(R):void this.remoteRequest({apply:o,CM:h,callback:function(){return i._onDataAvailable(R)}})},r._initTypeColumns=function(){for(var i=this.colModel,r=0,o=i.length;r<o;r++){var n=i[r];"checkBoxSelection"===n.type?new t.paramquery.cCheckBoxColumn(this,n.dataIndx):"detail"===n.type&&(n.dataIndx="pq_detail",this.iHierarchy=new e(this))}},r.refreshHeader=function(){this._createHeader()},r.refreshDataFromDataModel=function(){this._super.apply(this);var t=this.options,e=t.groupModel,i=!!e;i&&this.iGroupView._refreshDataFromDataModel()};var u=t.paramquery.cSort=function(t){this.that=t},f=u.prototype;f._refreshSorters=function(e){var i=this.that,r=i.options,o=r.dataModel,n=o.sortIndx,a=t.isArray(n),l=r.groupModel,s=l?l.dataIndx:null,d=l?l.dir:null,h=-1,c=[];if(l)for(var u=0;u<s.length;u++){var f=s[u];f==e&&(h=u),c.push({dataIndx:f,dir:d&&d[u]?d[u]:"up"})}if(h!==-1){var p=c[h].dir,g="up"===p?"down":"up";c[h].dir=g,d[h]=g}else if(null!=e)if(a){var v=t.inArray(e,o.sortIndx);if(v!=-1)"up"==o.sortDir[v]?o.sortDir[v]="down":1==n.length?o.sortDir[v]="up":(o.sortIndx.splice(v,1),o.sortDir.splice(v,1));else{var w=o.sortIndx.length;o.sortIndx[w]=e,o.sortDir[w]="up"}}else o.sortIndx==e?o.sortDir="up"==o.sortDir?"down":"up":(o.sortIndx=e,o.sortDir="up");if(null!=o.sortIndx)if(a)for(var u=0;u<n.length;u++){var x=n[u];this.inSorters(c,x)==-1&&c.push({dataIndx:x,dir:o.sortDir[u]})}else this.inSorters(c,o.sortIndx)==-1&&c.push({dataIndx:o.sortIndx,dir:o.sortDir});this.sorters=c},f.inSorters=function(t,e){for(var i=-1,r=0;r<t.length;r++){var o=t[r];if(o.dataIndx==e){i=r;break}}return i},f._sortLocalData=function(t){for(var e=this.that,i=e.options,r=(i.dataModel,e.colModel),o=this.sorters,n=0;n<o.length;n++){var a=o[n],l=a.dataIndx,s=e.getColIndx({dataIndx:l}),d=r[s].dataType;a.dataType=d}return this.__sortLocalData(o,t)},f.__sortLocalData=function(e,i){function r(t,e,i,r){var o=t[i],n=e[i];return o=o?parseInt(o,10):0,n=n?parseInt(n,10):0,(o-n)*r}function o(t,e,i,r){var o=t[i],n=e[i];return o=o?Date.parse(o):0,n=n?Date.parse(n):0,(o-n)*r}function n(t,e,i,r,o){var n=t[i],a=e[i];return o(n,a)*r}function a(t,e,i,r){var o=(t[i]+"").replace(/,/g,""),n=(e[i]+"").replace(/,/g,"");return o=o?parseFloat(o):0,n=n?parseFloat(n):0,(o-n)*r}function l(t,e,i,r){var o=t[i],n=e[i];o=o?o:"",n=n?n:"";var a=0;return o>n?a=1:o<n&&(a=-1),a*r}function s(t,e,i,r){var o=t[i],n=e[i];o=o?o.toUpperCase():"",n=n?n.toUpperCase():"";var a=0;return o>n?a=1:o<n&&(a=-1),a*r}function d(t,e,i,r){var o=t[i],n=e[i],a=0;return o&&!n||o===!1&&null===n?a=1:(n&&!o||n===!1&&null===o)&&(a=-1),a*r}function h(){function t(t,e){for(var i=0,r=0;r<f&&(i=h[r](t,e,c[r],u[r]),0==i);r++);return i}for(var h=[],c=[],u=[],f=e.length,p=0;p<f;p++){var g=e[p],v=g.dataIndx,w="up"==g.dir?1:-1,x=g.dataType;c[p]=v,u[p]=w,"integer"==x?h[p]=r:"float"==x?h[p]=a:"function"==typeof x?h[p]=function(t){return function(e,i,r,o){return n(e,i,r,o,t)}}(x):"date"==x?h[p]=o:"stringi"==x?h[p]=s:"bool"==x?h[p]=d:h[p]=l}i=i.sort(t)}if(null!=i&&0!=i.length)return e&&e.length?(t.measureTime(h,"innerSort"),i):i},r._refreshHeaderSortIcons=function(){var t=this.options,e=(t.dataModel,this.iSort.sorters),i=(this.colModel,this.$header);if(i){var r=i.find(".pq-grid-col");r.removeClass("pq-col-sort-asc pq-col-sort-desc ui-state-active"),i.find(".pq-col-sort-icon").removeClass("ui-icon ui-icon-triangle-1-n ui-icon-triangle-1-s");for(var o=0;o<e.length;o++){var n=e[o],a=n.dataIndx,l=this.getColIndx({dataIndx:a}),s=n.dir,d="ui-state-active pq-col-sort-"+("up"==s?"asc":"desc"),h="ui-icon ui-icon-triangle-1-"+("up"==s?"n":"s");i.find(".pq-grid-col[pq-grid-col-indx="+l+"]").addClass(d),i.find(".pq-grid-col[pq-grid-col-indx="+l+"] .pq-col-sort-icon").addClass(h)}}},r.getHeaderColumnFromTD=function(t){var e=t.attr("pq-grid-col-indx");if(null!=e){var i=this.colModel[e];return i}},r.getIndxInSorters=function(t){for(var e=this.sorters,i=0,r=e.length;i<r;i++)if(e[i].dataIndx==t)return i;return-1},r.getLargestRowCol=function(t){for(var e,i=0;i<t.length;i++){var r=t[i],o=r.rowIndx;null==e?e=r.rowIndx:o>e&&(e=o),e=r.rowIndx}},r.bringCellToView=function(t){this._bringCellToView(t)},r._setUrl=function(t){this.options.dataModel.getUrl=function(){return{url:this.url+(null!=t?t:"")}}},r.getDataPage=function(){return this.data},r.getData=function(t){var e=t.dataIndx,i=e.length,r=t.data,o=this.options.dataModel,n=o.data,a=o.dataUF,l=[],s=function(t){for(var r=0,o=t.length;r<o;r++){for(var n=t[r],a={},s=0;s<i;s++){var d=e[s];a[d]=n[d]}l.push(a)}};r?s(r):(n&&s(n),a&&s(a));for(var d=[],h=0;h<i;h++){var c=e[h],u=this.getColumn({dataIndx:c});d.push({dataIndx:c,dir:"up",dataType:u.dataType})}l=this.iSort.__sortLocalData(d,l);for(var f=[],p=void 0,g=0;g<l.length;g++){var v=l[g],w=JSON.stringify(v);w!==p&&(f.push(v),p=w)}return f},r.getFilterData=function(e){var i=e.CM;if(!i)throw"CM N/A";for(var r=i.length,o=e.location,n=this.options.filterModel,a=n.multiple,l=t.paramquery.filter.getAllConditions,s=t.paramquery.filter.getTRConditions,d=[],h=function(e,i,r){return"between"==e?null!=i&&""!==i||null!=r&&""!==r:t.inArray(e,l)==-1||(null!=i&&""!==i||t.inArray(e,s)==-1)},c=function(t,e){return"remote"==o?(t=null==t?"":t,t.toString()):p.convert(t,e)},u=0;u<r;u++){var f=i[u],g=f.dataIndx,v=f.dataType,v=v&&"function"!=typeof v?v:"string",w=f.filter;if(a){var x=f.filterModel;if(x&&x.on){for(var m=[],I=x.mode,_=x.filters,b=0;b<_.length;b++){var w=_[b],q=w.value,y=w.condition;h(y,q)&&(q=c(q,v),m.push({value:q,condition:y}))}d.push({dataIndx:g,mode:I,dataType:v,filters:m})}}else if(w&&w.on){var q=w.value,C=w.value2,y=w.condition;if(h(y,q,C)){if("between"==y)""===q||null==q?(y="lte",q=c(C,v)):""===C||null==C?(y="gte",q=c(q,v)):(q=c(q,v),C=c(C,v));else if("regexp"==y){if("remote"==o)q=q.toString();else if("string"==typeof q)try{var M=w.modifiers,M=M?M:"gi";q=new RegExp(q,M)}catch(t){q=/.*/}}else if("range"==y){if(null==q)continue;if("string"==typeof q)q=c(q,v),q=q.split(/\s*,\s*/);else if(q&&"function"==typeof q.push){if(0==q.length)continue;q=q.slice();for(var b=0,D=q.length;b<D;b++)q[b]=c(q[b],v)}}else q=c(q,v);d.push({dataIndx:g,value:q,value2:C,condition:y,dataType:v,cbFn:"remote"==o?"":p.conditions[y]})}}}return d};var p=function(t){this.that=t},g=p.prototype;p.conditions={equal:function(t,e){if(t==e)return!0},contain:function(t,e){if(t.indexOf(e)!=-1)return!0},notcontain:function(t,e){if(t.indexOf(e)==-1)return!0},empty:function(t){if(0==t.length)return!0},notempty:function(t){if(t.length>0)return!0},begin:function(t,e){if(0==t.indexOf(e))return!0},notbegin:function(t,e){if(0!=t.indexOf(e))return!0},end:function(t,e){var i=t.lastIndexOf(e);if(i!=-1&&i+e.length==t.length)return!0},notend:function(t,e){var i=t.lastIndexOf(e);if(i==-1||i+e.length!=t.length)return!0},regexp:function(t,e){if(e.test(t))return e.lastIndex=0,!0},notequal:function(t,e){if(t!=e)return!0},great:function(t,e){if(t>e)return!0},gte:function(t,e){if(t>=e)return!0},between:function(t,e,i){if(t>=e&&t<=i)return!0},range:function(e,i){if(t.inArray(e,i)!=-1)return!0},less:function(t,e){if(t<e)return!0},lte:function(t,e){if(t<=e)return!0}},p.convert=function(e,i){return e=null==e?"":e,"string"==i?e=t.trim(e).toUpperCase():"date"==i?e=Date.parse(e):"integer"==i?e=parseInt(e):"float"==i?e=parseFloat(e):"bool"==i&&(e=String(e).toLowerCase()),e},g.isMatchCellSingle=function(t,e){var i=t.dataIndx,r=t.dataType,o=t.value,n=t.value2,a=t.condition,l=t.cbFn,s=e[i];s="regexp"==a?null==s?"":s:p.convert(s,r);var d=!!l(s,o,n);return d},g.isMatchCellMultiple=function(t,e){var i=t.dataIndx,r=t.dataType,o=t.mode,n=t.filters,a=n.length;if(0==a)return!0;for(var l=0;l<a;l++){var s=n[l],d=s.value,h=s.condition,c=e[i],u=this.isMatchRule(c,h,d,r);if("OR"==o&&u)return!0;if("AND"==o&&!u)return!1}return 1===a?u:"AND"==o||"OR"!=o&&void 0},g.isMatchRow=function(t,e,i){if(0==e.length)return!0;for(var r=0;r<e.length;r++){var o=e[r],n=this.isMatchCell(o,t);if("OR"==i&&n)return!0;if("AND"==i&&!n)return!1}return"AND"==i||"OR"!=i&&void 0},r.filterLocalData=function(t){t=t?t:{};var e=t.apply,i=e===!1?t.CM:this.colModel,r=this.getFilterData({CM:i}),o=this.options,n=o.dataModel,a=n.data,l=n.dataUF,s=[],d=[],h=o.filterModel,c=h.multiple,u=h?h.mode:null,f=new p;if(c?f.isMatchCell=f.isMatchCellMultiple:f.isMatchCell=f.isMatchCellSingle,h.on&&u){if(a)for(var g=0,v=a.length;g<v;g++){var w=a[g];f.isMatchRow(w,r,u)?s.push(w):d.push(w)}if(l)for(var g=0,v=l.length;g<v;g++){var w=l[g];f.isMatchRow(w,r,u)?s.push(w):d.push(w)}}else{if(a)for(var g=0,v=a.length;g<v;g++){var w=a[g];s.push(w)}if(l)for(var g=0,v=l.length;g<v;g++){var w=l[g];s.push(w)}}return e&&(n.data=s,n.dataUF=d,this._trigger("filter",null,{type:"local",dataModel:n,colModel:i,filterModel:h})),{data:s,dataUF:d}},r._onDataAvailable=function(t){t=t?t:{};var e=this.options,i=t.apply,r=t.sort,o=[],n=e.filterModel,a=e.dataModel,l=a.location;return i!==!1&&this._trigger("dataAvailable",t.evt,{dataModel:a}),o=n&&n.on&&("local"==l&&"remote"!=n.type||"remote"==l&&"local"==n.type)?this.filterLocalData(t).data:a.data,a.sorting&&"local"==a.sorting&&r!==!1&&(o=this.iSort._sortLocalData(o)),i===!1?o:(a.data=o,void this.refreshView(t))},r.sort=function(t){var e=this,i=this.options,r=t.colIndx,o=i.editModel,n=t.dataIndx,a=t.evt,l=i.dataModel;if(null!=r||null!=n||(n=l.sortIndx,null!=n)){r=null==r?this.getColIndx({dataIndx:n}):r;var s=this.colModel[r];n=null==n?s.dataIndx:n,0!=e._trigger("beforeSort",a,{dataModel:l,column:s,dataIndx:n})&&(o.indices&&e.blurEditor({force:!0}),this.iSort._refreshSorters(n),"local"==l.sorting?(this.iSort._sortLocalData(l.data),this.refreshView()):"remote"==l.sorting&&this.remoteRequest({callback:function(){e._trigger("sort",a,{dataModel:l,column:s,dataIndx:n}),e._onDataAvailable()}}))}},r._setScrollVLength=function(t){var e=this.options.groupModel;t=e?this.dataGM:t,this._super.call(this,t)},t.widget("paramquery.pqGrid",t.paramquery._pqGrid,r),t.paramquery.pqGrid.regional={},t.paramquery.pqGrid.regional.en=r._regional}(jQuery),function(t){t.paramquery=null==t.paramquery?{}:t.paramquery,t.paramquery.pqgrid=null==t.paramquery.pqgrid?{}:t.paramquery.pqgrid,t.paramquery.pqgrid.exportToExcel=function(e){var i=this,r=void 0===e.urlPost?e.url:e.urlPost,o=e.url,n=null==e.sheetName?"pqGrid":e.sheetName,a=e.format,l=function(){for(var t=i.colModel,e=t.length,r=i.options,o=r.dataModel,a=o.data,l=a.length,s=[],d=[],h=0;h<e;h++){var c=t[h];c.hidden||d.push('<Column ss:AutoFitWidth="1"  ss:Width="'+c._width+'" />')}d.push("<Row>");for(var h=0;h<e;h++){var c=t[h];c.hidden||d.push('<Cell><Data ss:Type="String">'+c.title+"</Data></Cell>")}d.push("</Row>"),d=d.join("\n");for(var h=0;h<l;h++){var u=a[h];s.push("<Row>");for(var f=0;f<e;f++){var c=t[f];if(!c.hidden){var p=c.dataIndx;s.push('<Cell><Data ss:Type="String"><![CDATA['+u[p]+"]]></Data></Cell>")}}s.push("</Row>")}s=s.join("\n");var g=['<?xml version="1.0"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"',' xmlns:o="urn:schemas-microsoft-com:office:office"',' xmlns:x="urn:schemas-microsoft-com:office:excel"',' xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"',' xmlns:html="http://www.w3.org/TR/REC-html40">','<Worksheet ss:Name="',n,'">',"<Table>",d,s,"</Table>","</Worksheet>","</Workbook>"];return g.join("\n")},s=function(){for(var t=i.colModel,e=t.length,r=i.options,o=r.dataModel,n=o.data,a=n.length,l=[],s=[],d=[],h=0;h<e;h++){var c=t[h];if(!c.hidden){var u=c.title.replace(/\"/g,'""');s.push('"'+u+'"')}}l.push(s.join(","));for(var h=0;h<a;h++){for(var f=n[h],p=0;p<e;p++){var c=t[p];if(!c.hidden){var g=c.dataIndx,v=f[g]+"";v=v.replace(/\"/g,'""'),d.push('"'+v+'"')}}l.push(d.join(",")),d=[]}return l.join("\n")},d="xml"==a?l():s();t.ajax({url:r,type:"POST",cache:!1,data:{extension:a,excel:d},success:function(e){var i=o+((o.indexOf("?")>0?"&":"?")+"filename="+e);t(document.body).append("<iframe height='0' width='0' frameborder='0'  src="+i+"></iframe>")}})}}(jQuery),function(t){var e=t.paramquery.cUCData=function(t){this.that=t,this.udata=[],this.ddata=[],this.adata=[];var e=this,i=t.eventNamespace,r=t.widgetEventPrefix.toLowerCase();t.element.on(r+"dataavailable"+i,function(t,i){e.belongs(t)&&(e.udata=[],e.ddata=[],e.adata=[])})},i=e.prototype=new t.paramquery.cClass;i.add=function(t){for(var e=this.that,i=this.adata,r=t.rowData,o=e.getRecId({rowData:r}),n=0,a=i.length;n<a;n++){var l=i[n];if(null!=o&&l.recId==o)throw"primary key violation";if(l.rowData==r)throw"same data can't be added twice."}var t={recId:o,rowData:r};i.push(t)},i.update=function(t){var e=this.that,i=e.getRowData(t),r=e.getRecId({rowData:i}),o=t.dataIndx,n=t.oldVal,a=t.newVal,l=this.udata,s=!1;if(null!=r){for(var d=0,h=l.length;d<h;d++){var c=l[d];if(c.rowData==i&&c.dataIndx==o){if(s=!0,c.oldVal==a){l.splice(d,1);var u={rowData:i,dataIndx:o,cls:"pq-cell-dirty"};e.removeClass(u)}else c.newVal=a;break}}if(!s){var u={rowData:i,recId:r,dataIndx:o,newVal:a,oldVal:n};l.push(u);var u={rowData:i,dataIndx:o,cls:"pq-cell-dirty"};e.addClass(u)}}},i.delete=function(t){for(var e=this.that,i=t.rowIndx,r=t.rowIndxPage,o=e.rowIndxOffset,i=null==i?r+o:i,r=null==r?i-o:r,n=e.options.pageModel.type,a="remote"==n?r:i,l=this.adata,s=this.ddata,d=e.getRowData(t),h=0,c=l.length;h<c;h++)if(l[h].rowData==d)return void l.splice(h,1);s.push({indx:a,rowData:d})},i.isDirty=function(){var t=(this.that,this.udata),e=this.adata,i=this.ddata;return!!(t.length||e.length||i.length)},i.getChangesValue=function(){for(var e=(this.that,this.udata),i=this.adata,r=this.ddata,o={updateList:[],addList:[],deleteList:[]},n=[],a=[],l=[],s=[],d=[],h=0,c=r.length;h<c;h++){var u=r[h],f=u.rowData,p={};s.push(f);for(var g in f)0!=g.indexOf("pq_")&&(p[g]=f[g]);d.push(p)}for(var h=0;h<e.length;h++){var u=e[h],f=u.rowData;if(t.inArray(f,s)==-1&&t.inArray(f,n)==-1){var p={};for(var g in f)0!=g.indexOf("pq_")&&(p[g]=f[g]);n.push(f),a.push(p)}}for(var h=0;h<i.length;h++){var u=i[h],f=u.rowData,p={};for(var g in f)0!=g.indexOf("pq_")&&(p[g]=f[g]);l.push(p)}return o.updateList=a,o.addList=l,o.deleteList=d,o},i.getChanges=function(){for(var e=(this.that,this.udata),i=this.adata,r=this.ddata,o={updateList:[],addList:[],deleteList:[]},n=[],a=[],l=[],s=0,d=r.length;s<d;s++){var h=r[s],c=h.rowData;l.push(c)}for(var s=0;s<e.length;s++){var h=e[s],c=h.rowData;t.inArray(c,l)==-1&&t.inArray(c,n)==-1&&n.push(c)}for(var s=0;s<i.length;s++){var h=i[s],c=h.rowData;a.push(c)}return o.updateList=n,o.addList=a,o.deleteList=l,o},i.getChangesRaw=function(){var t=(this.that,this.udata),e=this.adata,i=this.ddata,r={updateList:[],addList:[],deleteList:[]};return r.updateList=t,r.addList=e,r.deleteList=i,r},i.getVal=function(t,e){return"float"==e?t=null==t?null:parseFloat(t):"integer"==e?t=null==t?null:parseInt(t):"date"==e&&(t=null==t?null:Date.parse(t)),t},i.commitAdd=function(e,i){for(var r=this.that.colModel,o=r.length,n=this.adata,a=n.length,l=e.length,s=[],d=0;d<l;d++)for(var h=e[d],c=0;c<a;c++){for(var u=n[c].rowData,f=!0,p=0;p<o;p++){var g=r[p],v=g.hidden,w=g.dataType,x=g.dataIndx;if(!v&&x!=i){var m=u[x],m=this.getVal(m,w),I=h[x],I=this.getVal(I,w);if(m!=I){f=!1;break}}}f&&(u[i]=h[i],s.push(u))}for(var _=[],c=0;c<a;c++){var u=n[c].rowData;t.inArray(u,s)==-1&&_.push(n[c])}this.adata=_},i.commitUpdate=function(e,i){for(var r=this.that,o=r.colModel,n=o.length,a=this.udata,l=a.length,s=e.length,d=[],h=0;h<l;h++){var c=a[h].rowData;if(t.inArray(c,d)==-1)for(var u=0;u<s;u++){var f=e[u];if(c[i]==f[i]){d.push(c);for(var p=0;p<n;p++){var g=o[p],v=(g.hidden,g.dataIndx);void 0!==f[v]&&(c[v]=f[v]),r.removeClass({rowData:c,dataIndx:v,cls:"pq-cell-dirty",refresh:!1})}}}}for(var w=[],h=0;h<l;h++){var c=a[h].rowData;t.inArray(c,d)==-1&&w.push(a[h])}this.udata=w},i.commitDelete=function(e,i){for(var r=this.ddata,o=r.length,n=e.length,a=[],l=0;l<o;l++)for(var s=r[l].rowData,d=0;d<n;d++){var h=e[d];s[i]==h[i]&&a.push(s)}for(var c=[],l=0;l<o;l++){var s=r[l].rowData;t.inArray(s,a)==-1&&c.push(r[l])}this.ddata=c},i.commitUpdateAll=function(){for(var t=this.that,e=this.udata,i=0,r=e.length;i<r;i++){var o=e[i],n=o.dataIndx,a=o.rowData;t.removeClass({rowData:a,dataIndx:n,cls:"pq-cell-dirty"})}this.udata=[]},i.commitAddAll=function(){this.adata=[]},i.commitDeleteAll=function(){this.ddata=[]},i.commit=function(t){var e=this.that,i=e.options.dataModel,r=i.recIndx;if(null==t)this.commitAddAll(),this.commitUpdateAll(),this.commitDeleteAll();else{var o=t.type,n=t.rows;"add"==o?n?this.commitAdd(n,r):this.commitAddAll():"update"==o?n?this.commitUpdate(n,r):this.commitUpdateAll():"delete"==o&&(n?this.commitDelete(n,r):this.commitDeleteAll())}e.refreshView()},i.rollbackAdd=function(t,e){for(var i=this.adata,r=t.type,o=0,n=i.length;o<n;o++)for(var a=i[o],l=a.rowData,s=0,d=e.length;s<d;s++)if(e[s]==l){var h=e.splice(s,1);h&&h.length&&"remote"==r&&t.totalRecords--;break}this.adata=[]},i.rollbackDelete=function(t,e){for(var i=this.ddata,r=t.type,o=i.length-1;o>=0;o--){var n=i[o],a=n.indx,l=n.rowData;e.splice(a,0,l),"remote"==r&&t.totalRecords++}this.ddata=[]},i.rollbackUpdate=function(t,e){for(var i=this.that,r=this.udata,o=0,n=r.length;o<n;o++){var a=r[o],l=a.recId,s=a.rowData,d=a.dataIndx;null!=l&&(s[d]=a.oldVal,i.removeClass({rowData:s,dataIndx:d,cls:"pq-cell-dirty",refresh:!1}))}this.udata=[]},i.rollback=function(t){var e=this.that,i=e.options.dataModel,r=e.options.pageModel,o=!t||null==t.refresh||t.refresh,n=t&&null!=t.type?t.type:null,a=i.data;null!=n&&"update"!=n||this.rollbackUpdate(r,a),null!=n&&"delete"!=n||this.rollbackDelete(r,a),null!=n&&"add"!=n||this.rollbackAdd(r,a),o&&e.refreshView()};var r=t.paramquery.pqGrid.prototype;r.getChanges=function(t){if(this.blurEditor({force:!0}),t){var e=t.format;if(e){if("byVal"==e)return this.iUCData.getChangesValue();if("raw"==e)return this.iUCData.getChangesRaw()}}return this.iUCData.getChanges()},r.rollback=function(t){this.blurEditor({force:!0}),this.iUCData.rollback(t)},r.isDirty=function(){return this.iUCData.isDirty()},r.commit=function(t){this.blurEditor({force:!0}),this.iUCData.commit(t)},r._getRowIndx=function(){var t=this,e=t.selection({type:"row",method:"getSelection"});if(!(e&&e.length>0))return null;var i=e[0].rowIndx,r=t.rowIndxOffset,o=t.options.pageModel,n=o.type,a=i-r,l=o.rPP;return n?a>=0&&a<l?i:void 0:i},r.updateRow=function(t){var e=this,i=e.options,r=i.track,r=null!=t.track?t.track:r,o=t.rowIndx,n=t.row,a=!1,l=e.getRowData({rowIndx:o}),s={rowData:l};for(var d in n){var h=l[d],c=n[d];c!==h&&(a=!0,r&&(s.dataIndx=d,s.oldVal=h,s.newVal=c,this.iUCData.update(s)),l[d]=c)}a&&e.refreshRow({rowIndx:o})},r._fillForm=function(t){var e=this,i=e.options.dataModel,r=e.options.pageModel,o=r.type,n=i.data,a=e.colModel,l=e.rowIndxOffset,s=null==t.rowIndxPage?t.rowIndx-l:t.rowIndxPage,d=null==t.rowIndx?s+l:t.rowIndx,h="remote"==o?s:d,c=n[h];this.rowData=c,this.$crudDialog.dialog("option","title","Edit Record ("+(d+1)+")");for(var u=this.$crudForm,f=0;f<a.length;f++){var p=a[f],g=p.dataIndx,v=c[g];u.find("*[name='"+g+"']").val(v)}},r.getRecId=function(t){var e=this,i=e.options.dataModel;t.dataIndx=i.recIndx;var r=e.getCellData(t);return r},r.getCellData=function(t){var e=this.getRowData(t),i=t.dataIndx;return e[i]},r.getRowData=function(t){var e=t.rowData;if(null!=e)return e;var i=this.options,r=i.dataModel,o=i.pageModel,n=o.type,a=r.recIndx,l=t.recId,s=r.data;if(null==l){var d=t.rowIndx,h=t.rowIndxPage,c=this.rowIndxOffset,d=null!=d?d:h+c,h=null!=h?h:d-c,u="remote"==n?h:d,f=s[u];return f}for(var p=0,g=s.length;p<g;p++){var f=s[p];if(f[a]==l)return f}},r.deleteRow=function(t){var e=this,i=t.rowIndx,r=t.effect,o=e.options,n=o.dataModel,a=o.pageModel,l=a.type;if(null!=i){var s="remote"==l?i-this.rowIndxOffset:i,d=n.data,h=o.track,h=null!=t.track?t.track:h;if(h&&this.iUCData.delete({rowIndx:i}),r){var e=this,c=this.getRow({rowIndx:i});c&&c.effect("fade",null,350,function(){var i=t.complete;i&&"function"==typeof i&&i.call(e.element[0]);var r=d.splice(s,1);r&&r.length&&"remote"==l&&a.totalRecords--,e.refreshView()})}else{var u=d.splice(s,1);u&&u.length&&"remote"==l&&a.totalRecords--,this.refreshView()}}},r.addRow=function(t){var e=this;return e._addLocal(t)},r._addLocal=function(t){var e=this,i=t.rowData,r=t.rowIndx,o=t.rowIndxPage,n=e.options,a=n.dataModel,l=n.pageModel,s=l.type,d=n.track,d=null!=t.track?t.track:d,h=a.data;if(null==i)return null;if(null==h&&(a.data=[],h=a.data),d&&this.iUCData.add({rowData:i}),null==r&&null==o)h.push(i);else{var c=this.rowIndxOffset,r=null==r?o+c:r,o=null==o?r-c:o,u="remote"==s?o:r;h.splice(u,0,i)}return"remote"==s&&l.totalRecords++,!t.refresh!=!1&&this.refreshView(),null==r?h.length-1:r},r._addRemote=function(t){var e=this,i=t.rowData;i.pq_oper="add",e.options.dataModel.postDataOnce=i}}(jQuery),function(t){var e={};e.options={items:[],gridInstance:null},e._create=function(){var e=this.options,i=e.gridInstance,r=i.colModel,o=e.items,n=this.element;n.closest(".pq-grid");n.addClass("pq-toolbar");for(var a=0,l=o.length;a<l;a++){var s,d=o[a],h=d.type,c=d.icon,e=d.options,u=d.label,f=d.listeners,p=d.cls,g="ui-corner-all "+(p?p:""),v=d.style,w=v?'style="'+v+'"':"",x=d.attr,m=x?x:"";if("textbox"==h)s=t("<input type='text' class='"+g+"' "+m+" "+w+">").appendTo(n);else if("checkbox"==h)s=t("<input type='checkbox' class='"+g+"' "+m+" "+w+">").appendTo(n);else if("separator"==h)t("<span class='pq-separator '"+g+"' "+m+" "+w+"></span>").appendTo(n);else if("button"==h)s=t("<button type='button' class='"+g+"' "+m+" "+w+">"+u+"</button>").button({text:!!u,icons:{primary:c}}).appendTo(n);else if("select"==h){var e=d.options?d.options:[];"function"==typeof e&&(e=e.call(i.element[0],{colModel:r})),I=t.paramquery.select({options:e,attr:" class='"+g+"' "+m+" "+w,prepend:d.prepend,groupIndx:d.groupIndx,valueIndx:d.valueIndx,labelIndx:d.labelIndx}),s=t(I).appendTo(n)}else if("string"==typeof h)s=t(h).appendTo(n);else if("function"==typeof h){var I=h.call(i.element[0],{colModel:r,cls:g});s=t(I).appendTo(n)}if(f)for(var _=0;_<f.length;_++){var b=f[_];for(var q in b)s.bind(q,b[q])}}},e._destroy=function(){this.element.empty().removeClass("pq-toolbar").enableSelection()},e._disable=function(){null==this.$disable&&(this.$disable=t("<div class='pq-grid-disable'></div>").css("opacity",.2).appendTo(this.element))},e._enable=function(){this.$disable&&(this.element[0].removeChild(this.$disable[0]),this.$disable=null)},e._setOption=function(t,e){"disabled"==t&&(1==e?this._disable():this._enable())},t.widget("paramquery.pqToolbar",e)}(jQuery),function(t){var e=function(){this.focusSelection=null},i=e.prototype;i.getOldRowSel=function(){var t,e=this.that;if((t=this.focusSelection)&&this.isSelected(t)){var i=e.getRowIndx(t);return i.rowData=t.rowData,i}},i.getOldCellSel=function(){var t,e=this.that;if((t=this.focusSelection)&&this.isSelected(t)){var i=t.rowData,r=e.getRowIndx({rowData:i});return r.rowData=i,r.dataIndx=t.dataIndx,r}},i.getNewRowSel=function(){var e=this.that,i=document.activeElement?t(document.activeElement):null;if(i&&i.hasClass("pq-grid-row")){var r=i.closest(".pq-grid");if(r[0]==e.element[0]){var o=e.getRowIndx({$tr:i});return o.$tr=i,o}}},i.getNewCellSel=function(){var e=this.that,i=document.activeElement?t(document.activeElement):null;if(i&&i.hasClass("pq-grid-cell")){var r=i.closest(".pq-grid");if(r[0]==e.element[0]){var o=e.getCellIndices({$td:i});return o.$td=i,o}}},i.getFocusSelection=function(t){return this instanceof r?t&&t.old===!0?this.getOldRowSel():this.getNewRowSel():this instanceof o?t&&t.old===!0?this.getOldCellSel():this.getNewCellSel():void 0},i.getFirstSelection=function(){var t=this.firstSelection;if(t&&this.isSelected(t))return t;this.refresh();var e=this.selection;return e.length?(this.firstSelection=e[0],e[0]):void 0},i.getLastSelection=function(){var t=this.lastSelection;if(t){var e=this.that,i=t.rowData,r=e.getRowData({rowIndx:rowIndx});return!(i!=r||!this.isSelected(t))&&t}return null},i.getLastSelectionCurPage=function(){var t=this.lastSelection;if(t&&this.isSelected(t)){var e=t.rowIndx,i=this.that.options.pageModel;if(i.type){var r=i.curPage,o=i.rPP;return Math.ceil((e+1)/o)==r?t:null}return t}return null},i.getSelection=function(){return this.refresh(),this.selection},i.getSelectionCurPage=function(){var t=this.that,e=this.getSelection(),i=[],r=t.options,o=r.dataModel,n=r.pageModel;if(n.type){for(var a=o.curPage,l=o.rPP,s=0;s<e.length;s++){var d=e[s],h=d.rowIndx;Math.ceil((h+1)/l)==a&&i.push(d)}return i}return e},i.inViewRow=function(t){var e=this.that,i=this.options,r=i.groupModel,o=e.rowIndxOffset,n=i.freezeRows,a=e.initV,l=e.finalV;if(t<n)return!0;if(r){var s=e.dataGM;if(s&&s.length)for(var d=a;d<l;d++){var h=s[d],c=h.rowIndx-o;if(null!=c&&c==t)return!0}return!1}return t>=a&&t<=l},i.setDirty=function(){};var r=function(t){this.that=t,this.options=t.options,this.selection=[]};t.paramquery.cRows=r;var o=function(t){this.options=t.options,this.that=t,this.selection=[]};t.paramquery.cCells=o;var n=o.prototype=new e,a=r.prototype=new e;a.extendSelection=function(t){var e=this.that,i=t.rowIndx,r=e.options.selectionModel.mode,o=t.evt,n=this.getFirstSelection();if(null==n)return void e.setSelection({rowIndx:i});if("single"!=r){var a=n.rowIndx,l=a,s=i;a>i&&(l=i,s=a),this.selectRange({initRowIndx:l,finalRowIndx:s,evt:o}),this.add({rowIndx:i})}},a.refresh=function(){this.selection=[];var t=this.that,e=t.options,i=e.dataModel,r=e.pageModel,o=r.type,n="remote"==o,a=t.rowIndxOffset,l=i.data;if(l)for(var s=0,d=l.length;s<d;s++){var h=l[s];if(h.pq_rowselect){var c=n?s+a:s;this.selection.push({rowIndx:c,rowData:h})}}},a.replace=function(t){var e=t.rowIndx,i=null==t.offset?this.that.getRowIndxOffset():t.offset,r=e-i;t.$tr,t.evt;t.offset=i,t.rowIndxPage=r,this.removeAll({raiseEvent:!0}),this.add(t)},a.indexOf=function(t){this.refresh();for(var e=t.rowIndx,i=this.selection,r=0;r<i.length;r++)if(i[r].rowIndx==e)return r;return-1},a.isSelected=function(t){var e=this.that,i=e.getRowData(t);return i?null!=i.pq_rowselect&&i.pq_rowselect:null},a._boundRow=function(t){var e=t.rowIndxPage,i=this.that,r=null==t.$tr?i.getRow({rowIndxPage:e}):t.$tr;return null!=r&&0!=r.length&&(r.addClass("pq-row-select ui-state-highlight"),r)},a.selectRange=function(t){for(var e=(this.that,t.initRowIndx),i=t.finalRowIndx,r=(t.evt,this.getSelection()),o=r.slice(0),n=0;n<o.length;n++){var a=o[n],l=a.rowIndx;(l<e||l>i)&&this.remove({rowIndx:l})}if(e>i){var s=e;e=i,i=s}for(var l=e;l<=i;l++)this.add({rowIndx:l,focus:!1})},n._addToData=function(t){var e=t.dataIndx,i=this.that.getRowData(t);i.pq_cellselect||(i.pq_cellselect={}),i.pq_cellselect[e]=!0},n.extendSelection=function(t){var e=this.that,i=this.getFirstSelection(),r=t.rowIndx,o=t.colIndx,n=e.options.selectionModel.mode,a=t.evt;if(null==i)return void e.setSelection({rowIndx:r,colIndx:o});var l=i.rowIndx,s=e.getColIndx({dataIndx:i.dataIndx}),d=l,h=r,c=s,u=o;l>r&&(d=r,h=l),"range"==n?(l>r&&(c=o,u=s),r==l&&o<s&&(c=o,u=s),this.selectRange({initRowIndx:d,initColIndx:c,finalRowIndx:h,finalColIndx:u,evt:a}),this.add({rowIndx:r,colIndx:o})):"block"==n&&(s>o&&(c=o,u=s),this.selectBlock({initRowIndx:d,initColIndx:c,finalRowIndx:h,finalColIndx:u,evt:a}),this.add({rowIndx:r,colIndx:o}))},n._removeFromData=function(t){var e=t.rowData;e&&e.pq_cellselect&&delete e.pq_cellselect[t.dataIndx]},n.removeAll=function(){this.refresh();var t=this.selection.slice(0);this.remove({cells:t
}),this.lastSelection=null},a.removeAll=function(t){var e=this.that,i=!!t&&t.page;this.refresh();var r=this.selection.slice(0);if(i){for(var o=[],n=e.rowIndxOffset,a=e.data,l=a?a.length:0,s=0,d=r.length;s<d;s++){var h=r[s],c=h.rowIndx,u=c-n;if(u>=0){if(!(u<l))break;o.push(h)}}this.remove({rows:o})}else this.remove({rows:r}),this.lastSelection=null},n.isSelected=function(t){var e=this.that,i=e.getRowData(t),r=t.dataIndx,r=null==r?e.colModel[t.colIndx].dataIndx:r;return null==i?null:!(!i.pq_cellselect||!i.pq_cellselect[r])},n.refresh=function(){this.selection=[];var t=this.that,e=t.options.dataModel,i=t.options.pageModel,r=e.data,o=i.type,n="remote"==o,a=t.rowIndxOffset;if(r){for(var l=0,s=r.length;l<s;l++){var d=r[l],h=d.pq_cellselect;if(h){var c=n?l+a:l;for(var u in h)h[u]&&this.selection.push({rowIndx:c,rowData:d,dataIndx:u})}}this.isDirty=!1}},n.replace=function(t){var e=t.rowIndx,i=(t.colIndx,null==t.offset?this.that.getRowIndxOffset():t.offset),r=e-i;t.$td,t.evt;t.rowIndxPage=r,t.offset=i,this.removeAll({raiseEvent:!0}),this.add(t)},n.inViewCell=function(t,e){var i=this.that,r=this.options,o=r.freezeCols;return!!this.inViewRow(t)&&(e<o||e>=i.initH&&e<=i.finalH)},n._add=function(t){var e,i=this.that,r=t.rowIndx,o=t.rowIndxPage,n=t.rowData,a=i.rowIndxOffset,r=null==r?o+a:r,o=null==o?r-a:o,n=null==n?i.getRowData(t):n,l=t.colIndx,s=t.dataIndx,l=null==l?i.getColIndx({dataIndx:s}):l,d=i.colModel[l],s=null==s?d.dataIndx:s,h=t.evt,c=this.isSelected({rowData:n,dataIndx:s});if(null==c)return!1;var u=this.inViewCell(o,l);if(c===!1){if(u){var f=i.getCell({rowIndxPage:o,colIndx:l});f&&f.addClass("pq-cell-select ui-state-highlight")}this._addToData({rowData:n,dataIndx:s}),t.trigger!==!1&&i._trigger("cellSelect",h,{rowIndx:r,rowIndxPage:o,colIndx:l,dataIndx:s,column:d,rowData:n}),e=!0}return this.lastSelection={rowIndx:r,dataIndx:s,rowData:n},t.focus!==!1&&u&&(f&&f.length||(f=i.getCell({rowIndxPage:o,dataIndx:s})),f&&f.length&&(f.attr("tabindex","0"),f.focus(),i._fixTableViewPort(),this.focusSelection={rowData:n,rowIndx:r,dataIndx:s})),t.setFirst&&(this.firstSelection={rowIndx:r,rowData:n,dataIndx:s}),e?{rowIndx:r,rowData:n,dataIndx:s,colIndx:l,column:d}:void 0},a._add=function(e){var i,r=this.that,o=e.rowIndx,n=e.rowIndxPage,a=r.rowIndxOffset,o=null==o?n+a:o,n=null==n?o-a:n,l=null==l?r.getRowData(e):l,s=e.$tr,d=e.evt,h=this.isSelected({rowData:l});if(e.rowIndxPage=n,null==h)return!1;var c=this.inViewRow(n);if(h===!1){if(c)var u=this._boundRow(e),s=u;l.pq_rowselect=!0,e.trigger!==!1&&r._trigger("rowSelect",d,{rowIndx:o,rowIndxPage:n,rowData:l,$tr:s}),i=!0}return this.lastSelection={rowIndx:o,rowData:l},e.focus!==!1&&c&&(s&&s.length||(s=r.getRow({rowIndxPage:n})),s&&(s=t(s[0]),s.attr("tabindex","0"),s.focus(),r._fixTableViewPort(),this.focusSelection={rowData:l,rowIndx:o})),e.setFirst&&(this.firstSelection={rowIndx:o,rowData:l}),i?{rowIndx:o,rowData:l}:void 0},n.add=function(t){var e=this.that,i=t.evt,r=t.cells,o=[];if(r&&"function"==typeof r.push){for(var n=0,a=r.length;n<a;n++){var l=r[n];l.trigger=!1;var s=this._add(l);s&&o.push(s)}o.length&&e._trigger("cellSelect",i,{cells:o})}else this._add(t);e._fixIE()},a.add=function(t){var e=this.that,i=t.evt,r=t.rows,o=[];if(r&&"function"==typeof r.push){for(var n=0,a=r.length;n<a;n++){var l=r[n];l.trigger=!1;var s=this._add(l);s&&o.push(s)}o.length&&e._trigger("rowSelect",i,{rows:o})}else this._add(t)},n._remove=function(t){var e=this.that,i=t.rowIndx,r=t.rowIndxPage,o=e.rowIndxOffset,i=null==i?r+o:i,r=null==r?i-o:r,n=t.rowData,n=null==n?e.getRowData(t):n,a=t.colIndx,l=t.dataIndx,a=null==a?e.getColIndx({dataIndx:l}):a,s=e.colModel[a],l=null==l?s.dataIndx:l,d=t.evt,h=this.isSelected({rowData:n,dataIndx:l});if(h){if(this.inViewCell(r,a)){var c=e.getCell({rowIndxPage:r,colIndx:a,all:!0});c&&(c.removeClass("pq-cell-select ui-state-highlight"),c.removeAttr("tabindex"))}return this._removeFromData({rowData:n,dataIndx:l}),t.trigger!==!1&&e._trigger("cellUnSelect",d,{rowIndx:i,colIndx:a,dataIndx:l,rowData:n}),{rowIndx:i,rowData:n,dataIndx:l,colIndx:a,column:s}}},a._remove=function(t){var e=this.that,i=t.rowIndx,r=t.rowIndxPage,o=e.rowIndxOffset,i=null==i?r+o:i,r=null==r?i-o:r,n=t.rowData,n=null==n?e.getRowData(t):n,a=t.$tr,l=t.evt,s=this.isSelected({rowData:n});if(s){if(this.inViewRow(r)){var a=e.getRow({rowIndxPage:r});a&&(a.removeClass("pq-row-select ui-state-highlight"),a.removeAttr("tabindex"))}return n.pq_rowselect=!1,t.trigger!==!1&&e._trigger("rowUnSelect",l,{rowIndx:i,rowData:n,$tr:a}),{rowIndx:i,rowData:n}}},n.remove=function(t){var e=t.cells;if(e&&"function"==typeof e.push){for(var i=[],r=0,o=e.length;r<o;r++){var n=e[r];n.trigger=!1;var a=this._remove(n);a&&i.push(a)}i.length&&this.that._trigger("cellUnSelect",t.evt,{cells:i})}else this._remove(t)},a.remove=function(t){var e=t.rows;if(e&&"function"==typeof e.push){for(var i=[],r=0,o=e.length;r<o;r++){var n=e[r];n.trigger=!1;var a=this._remove(n);a&&i.push(a)}i.length&&this.that._trigger("rowUnSelect",t.evt,{rows:i})}else this._remove(t)},n.indexOf=function(t){this.refresh();var e=t.rowIndx,i=this.that,r=null==t.dataIndx?i.colModel[t.colIndx].dataIndx:t.dataIndx;t.dataIndx=r;for(var o=this.selection,n=0;n<o.length;n++){var a=o[n];if(a.rowIndx==e&&a.dataIndx==r)return n}return-1},n.selectAll=function(t){var e=this.that,i=!(!t||!t.all),r=i?this.options.dataModel.data:e.data,o=e.rowIndxOffset,n=e.colModel,a=n.length,l=[],s=function(t,e){for(var i=0;i<a;i++){var r=n[i];if(!r.hidden){var o={rowIndx:e,rowData:t,colIndx:i,dataIndx:r.dataIndx,focus:!1};l.push(o)}}};if(r){for(var d=0,h=r.length;d<h;d++)var c=r[d];if(i)for(var u=this.options.pageModel.type,f="remote"==u,d=0,h=r.length;d<h;d++){var c=r[d],p=d;f&&(p=d+o),s(c,p)}else for(var d=0,h=r.length;d<h;d++){var c=r[d],g=d,p=g+o;s(c,p)}this.add({cells:l})}},a.selectAll=function(t){var e=this.that,i=!(!t||!t.all),r=i?this.options.dataModel.data:e.data,o=[];if(r){if(i)for(var n=this.options.pageModel.type,a="remote"==n,l=0,s=r.length;l<s;l++){var d={rowData:r[l],focus:!1};a?d.rowIndxPage=l:d.rowIndx=l,o.push(d)}else for(var l=0,s=r.length;l<s;l++){var h=r[l];o.push({rowIndxPage:l,rowData:h,focus:!1})}this.add({rows:o})}},n.selectRange=function(t){for(var e=this.that,i=t.initRowIndx,r=t.initColIndx,o=t.finalRowIndx,n=t.finalColIndx,a=this.getSelection(),l=a.slice(0),s=0;s<l.length;s++){var d=l[s],h=d.rowIndx,c=d.dataIndx,u=e.getColIndx({dataIndx:c});h<i||h>o?this.remove({rowIndx:h,colIndx:u,dataIndx:c}):h==i&&u<r?this.remove({rowIndx:h,colIndx:u,dataIndx:c}):h==o&&u>n&&this.remove({rowIndx:h,colIndx:u,dataIndx:c})}for(var u=0;u<e.colModel.length;u++){var f=e.colModel[u];if(!f.hidden){var c=f.dataIndx,h=i;do{if(h==i&&u<r);else{if(h==o&&u>n)break;this.add({rowIndx:h,colIndx:u,dataIndx:c,focus:!1})}h++}while(h<=o)}}},n.selectBlock=function(t){for(var e=this.that,i=t.initRowIndx,r=t.initColIndx,o=t.finalRowIndx,n=t.finalColIndx,a=this.getSelection(),l=a.slice(0),s=0;s<l.length;s++){var d=l[s],h=d.rowIndx,c=d.dataIndx,u=e.getColIndx({dataIndx:c});u<r||u>n?this.remove({rowIndx:h,dataIndx:c,colIndx:u}):(h<i||h>o)&&this.remove({rowIndx:h,dataIndx:c,colIndx:u})}for(var f=[],p=e.colModel,u=r;u<=n;u++){var g=p[u],c=g.dataIndx;if(!g.hidden){var h=i;do f.push({rowIndx:h,colIndx:u,dataIndx:c,focus:!1}),h++;while(h<=o);this.add({cells:f})}}}}(jQuery),function(t){var e=t.paramquery.cCheckBoxColumn=function(t,e){var i=this;this.that=t,this.options=t.options,this.type="checkBoxSelection",this.cbDataIndx=e;var r=t.widgetEventPrefix.toLowerCase(),o=t.element,n=t.eventNamespace;o.on(r+"dataavailable"+n,function(t,e){if(i.belongs(t))return i._onDataAvailable(t,e)}),o.on(r+"cellclick"+n,function(t,e){if(i.belongs(t))return i.cellClick(t,e)}),o.on(r+"rowselect"+n,function(t,e){if(i.belongs(t))return i.rowSelect(t,e)}),o.on(r+"rowunselect"+n,function(t,e){if(i.belongs(t))return i.rowUnSelect(t,e)}),o.on(r+"cellkeydown"+n,function(t,e){if(i.belongs(t))return i.cellKeyDown(t,e)}),o.on(r+"refreshheader"+n,function(t,e){if(i.belongs(t))return i.refreshHeader(t,e)})},i=e.prototype=new t.paramquery.cClass;i.hasHeaderChkBox=function(){var t=this.options.selectionModel;return t.cbHeader!==!1},i.setValCBox=function(){if(this.hasHeaderChkBox()){for(var t=this.that,e=this.options,i=e.selectionModel.cbAll,r=i?e.dataModel.data:t.data,o=null,n=0,a=0,l=0,s=r.length;l<s;l++){var d=r[l];d.pq_rowselect?n++:a++}n==s?o=!0:a==s&&(o=!1),this.$inp.pqval({val:o})}},i.refreshHeader=function(e,i){if(this.hasHeaderChkBox()){var r=this.that,o=r.data;if(o){var n=this,a=r.getCellHeader({dataIndx:this.cbDataIndx});a.html("<input type='checkbox'/>");this.$inp=a.find("input").click(function(e){t(this).is(":checked")?n.selectAllRows():n.unSelectAllRows(),e.stopPropagation()});this.setValCBox()}}},i.selectAllRows=function(){var t=this.that,e=this.options.selectionModel.cbAll;t.iRows.selectAll({all:e})},i.unSelectAllRows=function(){var t=this.that,e=this.options.selectionModel.cbAll;e?t.iRows.removeAll():t.iRows.removeAll({page:!0})},i._onDataAvailable=function(){var t=(this.that,this.options.dataModel.data),e=this._findSelectionIndx();if(null!=e&&t)for(var i=0,r=t.length;i<r;i++){var o=t[i];o[e]&&(o.pq_rowselect=!0)}},i._findSelectionIndx=function(){if(this.cbDataIndx)return this.cbDataIndx},i.cellClick=function(t,e){var i=this.that,r=e.rowIndx,o=e.rowData,n=e.column,a=this.type;if(n&&n.type===a){var l=n.dataIndx;return o[l]?i.iRows.remove({rowIndx:r}):i.iRows.add({rowIndx:r}),t.stopPropagation(),!1}},i.rowSelect=function(t,e){var i=this.that,r=e.rows,o=e.rowData,n=this._findSelectionIndx();if(r)for(var a=0,l=r.length;a<l;a++){var s=r[a],d=s.rowIndx,o=s.rowData;o[n]=!0,i.refreshCell({rowIndx:d,dataIndx:n})}else o&&(o[n]=!0,d=e.rowIndx,i.refreshCell({rowIndx:d,dataIndx:n}));this.setValCBox()},i.rowUnSelect=function(t,e){var i=this.that,r=e.rows,o=e.rowData,n=this._findSelectionIndx();if(r)for(var a=0,l=r.length;a<l;a++){var s=r[a],d=s.rowIndx,o=s.rowData;o[n]=!1,i.refreshCell({rowIndx:d,dataIndx:n})}else o&&(o[n]=!1,d=e.rowIndx,i.refreshCell({rowIndx:d,dataIndx:n}));this.setValCBox()},i.cellKeyDown=function(t,e){var i=this.that,r=e.rowIndx,o=e.column,n=n,a=this.type;if(o&&o.type===a){var l=o.dataIndx,r=e.rowIndx;if(13==t.keyCode||32==t.keyCode)return n[l]?i.selection({type:"row",method:"remove",rowIndx:r}):i.selection({type:"row",method:"add",rowIndx:r}),t.stopPropagation(),t.preventDefault(),!1}}}(jQuery),function(t){function e(t){this.that=t;var e=this,i=t.element,r=t.widgetEventPrefix.toLowerCase(),o=t.eventNamespace;i.on(r+"contmousedown"+o,function(t,i){if(e.belongs(t))return e._onContMouseDown(t,i)}),i.on(r+"mousedrag"+o,function(t,i){if(e.belongs(t)&&e.swipedown)return e._onMouseDrag(t,i)}),i.on(r+"mousestop"+o,function(t,i){return e._onMouseStop(t,i)}),i.on(r+"rowmousedown"+o,function(t,i){if(e.belongs(t))return e._onRowMouseDown(t,i)}),i.on(r+"cellmousedown"+o,function(t,i){if(e.belongs(t))return e._onCellMouseDown(t,i)}),i.on(r+"beforetableview"+o,function(t,i){if(e.belongs(t))return e._beforeTableView(t,i)}),i.on(r+"refresh"+o,function(t,i){if(e.belongs(t))return e._onRefresh(t,i)})}t.paramquery.cMouseSelection=e;var i=e.prototype=new t.paramquery.cClass;i._beforeTableView=function(t,e){var i=this.that,r=i.getFocusElement();if(this.lastFocus=null,r&&r.$grid){var o=r.$ae;if(o.hasClass("pq-grid-row")){var n=i.getRowIndx({$tr:o});this.lastFocus=n}else if(o.hasClass("pq-grid-cell")){var n=i.getCellIndices({$td:o});this.lastFocus=n}}},i._onRefresh=function(t,e){var i,r=this.that,o=this.lastFocus;if(o&&(i=null!=o.dataIndx?r.getCell(o):r.getRow(o),i&&i.length))return void(r.inViewPort(i)&&i.attr("tabindex","0").focus())},i._onCellMouseDown=function(t,e){var i=this.that,r=e.rowIndx,o=e.colIndx,n=i.options.selectionModel,a=n.type,l=n.mode;if("cell"==a&&null!=o)return t.shiftKey?(i.iCells.extendSelection({rowIndx:r,colIndx:o,mode:l,evt:t}),t.preventDefault()):t.ctrlKey&&"single"!=l?i.iCells.isSelected({rowIndx:r,colIndx:o})?i.iCells.remove({rowIndx:r,colIndx:o}):i.setSelection({rowIndx:r,colIndx:o}):(this.mousedown={rowIndx:r,colIndx:o},i.setSelection(null),i.setSelection({rowIndx:r,colIndx:o,setFirst:!0})),!0},i._onRowMouseDown=function(t,e){var i=this.that,r=e.rowIndx,o=i.options.selectionModel,n=o.mode,a=o.type;if("row"==a&&null!=r)return t.shiftKey?(i.iRows.extendSelection({rowIndx:r,evt:t}),t.preventDefault()):t.ctrlKey&&"single"!=n?i.iRows.isSelected({rowIndx:r})?i.iRows.remove({rowIndx:r}):i.setSelection({rowIndx:r}):(this.mousedown={r1:r,y1:t.pageY,x1:t.pageX},i.setSelection(null),i.setSelection({rowIndx:r,setFirst:!0})),!0},i._onContMouseDown=function(t,e){var i=this.that,r=i.options.swipeModel,o=r.on;return o&&(this._stopSwipe(!0),this.swipedown={x:t.pageX,y:t.pageY}),!0},i._stopSwipe=function(t){var e=this;t&&(e.swipedown=null,e.swipedownPrev=null),window.clearInterval(e.intID),e.intID=null},i._onMouseStop=function(e,i){var r=this,o=this.that;t.paramquery;if(this.swipedownPrev){var n=o.options.swipeModel,a=this.swipedownPrev,l=a.ts,s=(new Date).getTime(),d=s-l,h=a.x,c=a.y,u=e.pageX,f=e.pageY,p=u-h,g=f-c,v=Math.sqrt(p*p+g*g),w=v/d;if(w>n.ratio){var x=0,m=n.repeat;r._stopSwipe(),r.intID=window.setInterval(function(){x+=n.speed,m--,m<=0&&r._stopSwipe(!0);var t=u+x*p/d,e=f+x*g/d;r._onMouseDrag({pageX:t,pageY:e})},50)}else r.swipedown=null,r.swipedownPrev=null}},i._onMouseDrag=function(e,i){var r=this.that,o=(t.paramquery,r.options);if(this.swipedown){var n=this.swipedown,a=n.x,l=n.y,s=e.pageX,d=e.pageY;this.swipedownPrev={x:a,y:l,ts:(new Date).getTime()},r.$td_edit&&r.quitEditMode({silent:!0}),o.virtualY||(this._scrollVertSmooth(l,d),r._syncScrollBarVert()),o.virtualX||(this._scrollHorSmooth(a,s),r._syncScrollBarHor()),n.x=s,n.y=d}return!0},i.updateTableY=function(t){if(0==t)return!1;var e=this.that,i=e.getTableForVertScroll(),r=e.$cont,o=e._getScollBarHorizontalHeight(),n=r.data("offsetHeight")-o;if(!i||!i.length)return!1;var a=i.data("offsetHeight"),l=parseInt(i.css("marginTop"))+t;if(l>=0)i.css({marginTop:-1});else if(t<0&&n-a-l>0)if(n-i[0].offsetHeight-l>0){var s=n-i[0].offsetHeight;s<0&&i.css({marginTop:s})}else i.css({marginTop:l});else i.css({marginTop:l});return!0},i._scrollVertSmooth=function(t,e){t!=e&&this.updateTableY(e-t)},i._scrollHorSmooth=function(t,e){if(t!=e){var i=this.that,r=e-t,o=i.getTableForHorScroll(),n=i.getTableHeaderForHorScroll(),a=i.$cont,l=i._getSBWidth(),s=a.data("offsetWidth")-l;if(o||n){var d=o?o:n,h=d.data("scrollWidth"),c=parseInt(d.css("marginLeft"))+r;c>0?(o&&o.css({marginLeft:0}),n&&n.css({marginLeft:0})):s-h-c>0?s-h<=0&&(o&&o.css("marginLeft",s-h),n&&n.css("marginLeft",s-h)):(o&&o.css("marginLeft",c),n&&n.css("marginLeft",c))}}}}(jQuery),function(t){var e=function(t,e){this.that=t,this.$ae=e},i=e.prototype;i.createClipBoard=function(){var e=this.$ae,i=t("textarea#pq-grid-excel");0==i.length&&(i=t("<textarea id='pq-grid-excel' />").appendTo(document.body));var r=e.offset(),o=r.left,n=r.top;i.css({position:"absolute",left:o,top:n,display:"",height:1,width:1,borderWidth:0}),i.focus()},i.destroyClipBoard=function(){var e=t("textarea#pq-grid-excel");if(e.length){var i=document.activeElement;i==e[0]&&this.$ae.focus(),e.css("display","none")}},i.clearClipBoard=function(){var e=t("textarea#pq-grid-excel");e.val("")},i.copy=function(){var e=t("textarea#pq-grid-excel"),i=this.that,r=i.colModel,o=r.length,n=(i.options.selectionModel.type,[]),a=[];n=i.iRows.getSelection();for(var l=0,s=n.length;l<s;l++){for(var d=n[l],h=i.getRowData(d),c=[],u=0;u<o;u++){var f=r[u];f.hidden||c.push(h[f.dataIndx])}var p=c.join("\t");a.push(p)}n=i.iCells.getSelection();for(var h=null,g=null,v=null,c=[],l=0,s=n.length;l<s;l++){var d=n[l],g=d.rowIndx;if(g!=v){for(var h=i.getRowData(d),u=0;u<o;u++){var f=r[u];if(!f.hidden){var w=f.dataIndx;i.iCells.isSelected({rowData:h,dataIndx:w})&&c.push(h[w])}}var p=c.join("\t");c=[],a.push(p),v=g}}e.val(a.join("\n")),e.select()};var r=null;t(window).unbind(".pqExcel").bind("keydown.pqExcel",function(i){if(i.ctrlKey){var o=t(document.activeElement);if(!o.hasClass("pq-grid-row")&&!o.hasClass("pq-grid-cell")&&!o.is("textarea#pq-grid-excel"))return;var n=o.closest(".pq-grid");if(r||o.length&&n.length){if(!r){try{var a=n.pqGrid("getThis").that}catch(t){return!0}r=new e(a,o),r.createClipBoard()}if("67"==i.keyCode||"99"==i.keyCode)r.copy();else{var l=t("textarea#pq-grid-excel");if(l.length){var s=document.activeElement;s==l[0]&&r.that._onKeyPressDown(i)}}}}}).bind("keyup.pqExcel",function(t){r&&!t.ctrlKey&&17==t.keyCode&&(r.destroyClipBoard(),r=null)})}(jQuery),function(t){var e=t.ui.autocomplete.prototype,i=e._renderMenu,r=e._renderItem;e._renderMenu=function(e,r){i.call(this,e,r);var o=this.options,n=o.selectItem;if(n&&n.on){var a=n.cls,a=void 0===a?"ui-state-highlight":a,l=this.element.val();l&&a&&t("a",e).filter(function(){return t(this).text()===l}).addClass(a)}},e._renderItem=function(t,e){var i=r.call(this,t,e),o=this.options,n=o.highlightText;if(n&&n.on){var a=this.element.val();if(a){var l=new RegExp("("+a+")","i"),s=e.label;if(l.test(s)){var d=n.style,d=void 0===d?"font-weight:bold;":d,h=n.cls,h=void 0===h?"":h;s=s.replace(l,"<span style='"+d+"' class='"+h+"'>$1</span>"),i.find("a").html(s)}}}return i}}(jQuery);
//# sourceMappingURL=pqgrid.dev.min.js.map