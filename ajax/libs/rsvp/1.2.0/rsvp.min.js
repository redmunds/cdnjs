"use strict";var browserGlobal="undefined"!=typeof window?window:{},MutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,async;if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))async=function(e,t){process.nextTick(function(){e.call(t)})};else if(MutationObserver){var queue=[],observer=new MutationObserver(function(){var e=queue.slice();queue=[],e.forEach(function(e){var t=e[0],i=e[1];t.call(i)})}),element=document.createElement("div");observer.observe(element,{attributes:!0}),async=function(e,t){queue.push([e,t]),element.setAttribute("drainQueue","drainQueue")}}else async=function(e,t){setTimeout(function(){e.call(t)},1)};var Event=function(e,t){this.type=e;for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])},indexOf=function(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i][0]===t)return i;return-1},callbacksFor=function(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t},EventTarget={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e},on:function(e,t,i){var n,r,o=callbacksFor(this);for(e=e.split(/\s+/),i=i||this;r=e.shift();)n=o[r],n||(n=o[r]=[]),-1===indexOf(n,t)&&n.push([t,i])},off:function(e,t){var i,n,r,o=callbacksFor(this);for(e=e.split(/\s+/);n=e.shift();)t?(i=o[n],r=indexOf(i,t),-1!==r&&i.splice(r,1)):o[n]=[]},trigger:function(e,t){var i,n,r,o,s,c=callbacksFor(this);if(i=c[e])for(var a=0,l=i.length;l>a;a++)n=i[a],r=n[0],o=n[1],"object"!=typeof t&&(t={detail:t}),s=new Event(e,t),r.call(o,s)}},Promise=function(){this.on("promise:resolved",function(e){this.trigger("success",{detail:e.detail})},this),this.on("promise:failed",function(e){this.trigger("error",{detail:e.detail})},this)},noop=function(){},invokeCallback=function(e,t,i,n){var r,o;if(i)try{r=i(n.detail)}catch(s){o=s}else r=n.detail;r instanceof Promise?r.then(function(e){t.resolve(e)},function(e){t.reject(e)}):i&&r?t.resolve(r):o?t.reject(o):t[e](r)};Promise.prototype={then:function(e,t){var i=new Promise;return this.on("promise:resolved",function(t){invokeCallback("resolve",i,e,t)}),this.on("promise:failed",function(e){invokeCallback("reject",i,t,e)}),i},resolve:function(e){async(function(){this.isResolved=e,this.trigger("promise:resolved",{detail:e})},this),this.resolve=noop,this.reject=noop},reject:function(e){async(function(){this.trigger("promise:failed",{detail:e}),this.isRejected=e},this),this.resolve=noop,this.reject=noop}},EventTarget.mixin(Promise.prototype),exports.async=async,exports.Event=Event,exports.EventTarget=EventTarget,exports.Promise=Promise;