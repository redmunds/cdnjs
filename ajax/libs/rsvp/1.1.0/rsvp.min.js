function resolve(e,t){RSVP.async(function(){e.trigger("promise:resolved",{detail:t}),e.isResolved=!0,e.resolvedValue=t})}function reject(e,t){RSVP.async(function(){e.trigger("promise:failed",{detail:t}),e.isRejected=!0,e.rejectedValue=t})}var browserGlobal="undefined"!=typeof window?window:{},MutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,RSVP,async;if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))async=function(e,t){process.nextTick(function(){e.call(t)})};else if(MutationObserver){var queue=[],observer=new MutationObserver(function(){var e=queue.slice();queue=[],e.forEach(function(e){var t=e[0],i=e[1];t.call(i)})}),element=document.createElement("div");observer.observe(element,{attributes:!0}),async=function(e,t){queue.push([e,t]),element.setAttribute("drainQueue","drainQueue")}}else async=function(e,t){setTimeout(function(){e.call(t)},1)};var Event=function(e,t){this.type=e;for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])},indexOf=function(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i][0]===t)return i;return-1},callbacksFor=function(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t},EventTarget={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e},on:function(e,t,i){var n,o,r=callbacksFor(this);for(e=e.split(/\s+/),i=i||this;o=e.shift();)n=r[o],n||(n=r[o]=[]),-1===indexOf(n,t)&&n.push([t,i])},off:function(e,t){var i,n,o,r=callbacksFor(this);for(e=e.split(/\s+/);n=e.shift();)t?(i=r[n],o=indexOf(i,t),-1!==o&&i.splice(o,1)):r[n]=[]},trigger:function(e,t){var i,n,o,r,s,c=callbacksFor(this);if(i=c[e])for(var a=0,l=i.length;l>a;a++)n=i[a],o=n[0],r=n[1],"object"!=typeof t&&(t={detail:t}),s=new Event(e,t),o.call(r,s)}},Promise=function(){this.on("promise:resolved",function(e){this.trigger("success",{detail:e.detail})},this),this.on("promise:failed",function(e){this.trigger("error",{detail:e.detail})},this)},noop=function(){},invokeCallback=function(e,t,i,n){var o,r,s,c,a="function"==typeof i;if(a)try{o=i(n.detail),s=!0}catch(l){c=!0,r=l}else o=n.detail,s=!0;o&&"function"==typeof o.then?o.then(function(e){t.resolve(e)},function(e){t.reject(e)}):a&&s?t.resolve(o):c?t.reject(r):t[e](o)};Promise.prototype={then:function(e,t){var i=new Promise;return this.isResolved&&RSVP.async(function(){invokeCallback("resolve",i,e,{detail:this.resolvedValue})},this),this.isRejected&&RSVP.async(function(){invokeCallback("reject",i,t,{detail:this.rejectedValue})},this),this.on("promise:resolved",function(t){invokeCallback("resolve",i,e,t)}),this.on("promise:failed",function(e){invokeCallback("reject",i,t,e)}),i},resolve:function(e){resolve(this,e),this.resolve=noop,this.reject=noop},reject:function(e){reject(this,e),this.resolve=noop,this.reject=noop}},EventTarget.mixin(Promise.prototype),RSVP={async:async,Promise:Promise,Event:Event,EventTarget:EventTarget},export=RSVP;