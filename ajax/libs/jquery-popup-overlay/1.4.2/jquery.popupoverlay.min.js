!function(t){var o=[],e=[];t.fn.popup=t.fn.popup=function(i){var n,a,c,d,r,p=t("body"),s=t(window),u=(t(document),{}),l={type:"overlay",action:"click",background:!0,color:"black",opacity:"0.4",horizontal:"center",vertical:"center",escape:!0,blur:!0,fade:250,opensufix:"_open",closesufix:"_close",keepfocus:!0,reposition:!1,autozindex:!1},f=function(d){if(t(d).attr("id")||t(d).attr("id","j-popup-"+parseInt(1e8*Math.random())),e[d.id]=!1,o[d.id]=0,n=t(d),u=t.extend({},l,i),u.reposition===!0)return a=n,n=c=t("#"+d.id+"_wrapper"),h(d),!1;if(n.attr("data-popup-initialized"))return!1;n.attr("data-popup-initialized","true");var r="."+d.id+u.opensufix;if("tooltip"==u.type&&(u.background=!1,u.keepfocus=!1),n.css({display:"none"}),p.prepend(d),u.background&&!t("#"+d.id+"_background").length){var s='<div id="'+d.id+'_background" class="popup_background"></div>';p.prepend(s),t("#"+d.id+"_background").css({backgroundColor:u.color,opacity:u.opacity,position:"fixed",top:"0",right:"0",bottom:"0",left:"0",display:"none"})}if("overlay"==u.type&&(n.css({display:"inline-block",textAlign:"left",position:"relative",verticalAlign:"middle"}).addClass("popup_content"),n.wrap('<div id="'+d.id+'_wrapper" class="popup_wrapper" />'),c=t("#"+d.id+"_wrapper"),c.css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none",textAlign:"center"}),c.append('<div class="popup_align" />'),t(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"}),"right"==u.horizontal?c.css("text-align","right"):"left"==u.horizontal&&c.css("text-align","left"),"bottom"==u.vertical?n.css("vertical-align","bottom"):"top"==u.vertical&&n.css("vertical-align","top"),a=n,n=c),t(r).each(function(o,e){t(e).attr("data-popup-order",o)}),"click"==u.action?(t(r).live("click",function(o){if(n.is(":hidden")){var e=t(this).attr("data-popup-order");g(d,e),o.preventDefault()}}),t("."+d.id+u.closesufix).click(function(t){b(d),t.preventDefault()})):"hover"==u.action?(t(r).mouseenter(function(){g(d,t(this).attr("data-popup-order"))}),t(r).mouseleave(function(){b(d)})):(t(r).mouseover(function(){g(d,t(this).attr("data-popup-order"))}),t(r).mouseout(function(){b(d)})),u.escape&&t(document).keydown(function(t){27==t.keyCode&&"block"==n.css("display")&&b(d)}),t(window).bind("resize",function(){"tooltip"!=u.type&&h(d)}),u.autozindex===!0){var f=Math.max(0,Math.max.apply(null,t.map(t.makeArray(document.getElementsByTagName("*")),function(o){return parseFloat(t(o).css("z-index"))||null})));o[d.id]=f,o[d.id]>0&&n.css({zIndex:o[d.id]+2}),u.background&&o[d.id]>0&&t("#"+d.id+"_background").css({zIndex:o[d.id]+1})}u.autoopen&&g(d,0)},g=function(o,i){var c=i;k(u.beforeopen,c),e[o.id]=c,u.fade?n.fadeIn(u.fade,function(){t(document).on("click",d),t(document).on("focusin",r)}):(n.show(),setTimeout(function(){t(document).on("click",d),t(document).on("focusin",r)},0)),h(o,c),u.background&&(u.fade?t("#"+o.id+"_background").fadeIn(u.fade):t("#"+o.id+"_background").show()),u.keepfocus&&(a.attr("tabindex",-1).focus(),r=function(e){t(e.target).parents().andSelf().is("#"+o.id)||a.focus()}),k(u.onOpen,c),u.blur&&(d=function(e){t(e.target).parents().andSelf().is("#"+o.id)||b(o)})},h=function(o,e){if(e=e||0,"tooltip"==u.type){n.css({position:"absolute"});var i=t("."+o.id+u.opensufix+'[data-popup-order="'+e+'"]'),c=i.offset();"right"==u.horizontal?n.css("left",c.left+i.outerWidth()):"left"==u.horizontal?n.css("right",t(window).width()-c.left):n.css("left",c.left+i.outerWidth()/2-t(o).outerWidth()/2-parseFloat(t(o).css("marginLeft"))),"bottom"==u.vertical?n.css("top",c.top+i.outerHeight()):"top"==u.vertical?n.css("bottom",t(window).height()-c.top):n.css("top",c.top+i.outerHeight()/2-t(o).outerHeight()/2-parseFloat(t(o).css("marginTop")))}else"overlay"==u.type&&(s.height()<a.outerHeight()+parseFloat(a.css("marginTop"))+parseFloat(a.css("marginBottom"))?n.css({position:"absolute",top:s.scrollTop()}):n.css({position:"fixed",top:"0"}))},b=function(o){u.background&&(u.fade?t("#"+o.id+"_background").fadeOut(u.fade):t("#"+o.id+"_background").hide()),u.blur&&t(document).off("click",d),u.keepfocus&&(t(document).off("focusin",r),t("."+o.id+u.opensufix).focus()),u.fade?n.fadeOut(u.fade):n.hide(),k(u.onClose,e[o.id])},k=function(o,e){var i=t("."+n.attr("id")+u.opensufix+'[data-popup-order="'+e+'"]');"function"==typeof o&&o(i)};return this.each(function(){f(this)}),b}}(jQuery);