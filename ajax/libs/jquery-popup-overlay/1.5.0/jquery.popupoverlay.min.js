!function(o){var t=[],e=[];o.fn.popup=o.fn.popup=function(i){var n,a,c,d,r,p=o("body"),s=o(window),u=(o(document),{}),l={type:"overlay",action:"click",background:!0,color:"black",opacity:"0.4",horizontal:"center",vertical:"center",escape:!0,blur:!0,fade:250,opensufix:"_open",closesufix:"_close",keepfocus:!0,reposition:!1,autozindex:!1},f=function(d){if(o(d).attr("id")||o(d).attr("id","j-popup-"+parseInt(1e8*Math.random())),e[d.id]=!1,t[d.id]=0,n=o(d),u=o.extend({},l,i),u.reposition===!0)return a=n,n=c=o("#"+d.id+"_wrapper"),h(d),!1;if(n.attr("data-popup-initialized"))return!1;n.attr("data-popup-initialized","true");var r="."+d.id+u.opensufix;if("tooltip"==u.type&&(u.background=!1,u.keepfocus=!1),n.css({display:"none"}),p.prepend(d),u.background&&!o("#"+d.id+"_background").length){var s='<div id="'+d.id+'_background" class="popup_background"></div>';p.prepend(s),o("#"+d.id+"_background").css({backgroundColor:u.color,opacity:u.opacity,position:"fixed",top:"0",right:"0",bottom:"0",left:"0",display:"none"})}if("overlay"==u.type&&(n.css({display:"inline-block",textAlign:"left",position:"relative",verticalAlign:"middle"}).addClass("popup_content"),n.wrap('<div id="'+d.id+'_wrapper" class="popup_wrapper" />'),c=o("#"+d.id+"_wrapper"),c.css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none",textAlign:"center"}),c.append('<div class="popup_align" />'),o(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"}),"right"==u.horizontal?c.css("text-align","right"):"left"==u.horizontal&&c.css("text-align","left"),"bottom"==u.vertical?n.css("vertical-align","bottom"):"top"==u.vertical&&n.css("vertical-align","top"),a=n,n=c),o(r).each(function(t,e){o(e).attr("data-popup-order",t)}),"click"==u.action?(o(r).on("click",function(t){if(n.is(":hidden")){var e=o(this).attr("data-popup-order");g(d,e),t.preventDefault()}}),o("."+d.id+u.closesufix).click(function(o){b(d),o.preventDefault()})):"hover"==u.action?(o(r).mouseenter(function(){g(d,o(this).attr("data-popup-order"))}),o(r).mouseleave(function(){b(d)})):(o(r).mouseover(function(){g(d,o(this).attr("data-popup-order"))}),o(r).mouseout(function(){b(d)})),u.escape&&o(document).keydown(function(o){27==o.keyCode&&"block"==n.css("display")&&b(d)}),o(window).bind("resize",function(){"tooltip"!=u.type&&h(d)}),u.autozindex===!0){for(var f=document.getElementsByTagName("*"),k=f.length,m=0,v=0;k>v;v++){var y=o(f[v]).css("z-index");"auto"!==y&&(y=parseInt(y),y>m&&(m=y))}t[d.id]=m,t[d.id]>0&&n.css({zIndex:t[d.id]+2}),u.background&&t[d.id]>0&&o("#"+d.id+"_background").css({zIndex:t[d.id]+1})}u.autoopen&&g(d,0)},g=function(t,i){var c=i;k(u.beforeopen,c),e[t.id]=c,u.fade?n.fadeIn(u.fade,function(){o(document).on("click",d),o(document).on("focusin",r)}):(n.show(),setTimeout(function(){o(document).on("click",d),o(document).on("focusin",r)},0)),h(t,c),u.background&&(u.fade?o("#"+t.id+"_background").fadeIn(u.fade):o("#"+t.id+"_background").show()),u.keepfocus&&(a.attr("tabindex",-1).focus(),r=function(e){o(e.target).parents().andSelf().is("#"+t.id)||a.focus()}),setTimeout(function(){window.scrollTo(document.body.scrollLeft,document.body.scrollTop)},0),k(u.onopen,c),u.blur&&(d=function(e){o(e.target).parents().andSelf().is("#"+t.id)||b(t)})},h=function(t,e){if(e=e||0,"tooltip"==u.type){n.css({position:"absolute"});var i=o("."+t.id+u.opensufix+'[data-popup-order="'+e+'"]'),c=i.offset();"right"==u.horizontal?n.css("left",c.left+i.outerWidth()):"left"==u.horizontal?n.css("right",o(window).width()-c.left):n.css("left",c.left+i.outerWidth()/2-o(t).outerWidth()/2-parseFloat(o(t).css("marginLeft"))),"bottom"==u.vertical?n.css("top",c.top+i.outerHeight()):"top"==u.vertical?n.css("bottom",o(window).height()-c.top):n.css("top",c.top+i.outerHeight()/2-o(t).outerHeight()/2-parseFloat(o(t).css("marginTop")))}else"overlay"==u.type&&(s.height()<a.outerHeight()+parseFloat(a.css("marginTop"))+parseFloat(a.css("marginBottom"))?n.css({position:"absolute",top:s.scrollTop()}):n.css({position:"fixed",top:"0"}))},b=function(t){u.background&&(u.fade?o("#"+t.id+"_background").fadeOut(u.fade):o("#"+t.id+"_background").hide()),u.blur&&o(document).off("click",d),u.keepfocus&&(o(document).off("focusin",r),o("."+t.id+u.opensufix).focus()),u.fade?n.fadeOut(u.fade):n.hide(),k(u.onclose,e[t.id])},k=function(t,e){var i=o("."+n.attr("id")+u.opensufix+'[data-popup-order="'+e+'"]');"function"==typeof t&&t(i)};return this.each(function(){f(this)}),b}}(jQuery);