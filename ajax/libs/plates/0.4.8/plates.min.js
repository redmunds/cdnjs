var Plates="undefined"!=typeof module&&"undefined"!=typeof module.exports&&"undefined"!=typeof exports?exports:{};!function(e,t,r){"use strict";function a(e,t,r,a,i){if(i=t.dataKey||i,t.dataKey&&"function"==typeof t.dataKey)return t.dataKey(e,r||"",a||"",i);if(!~i.indexOf("."))return e[i];for(var n=i,l=e,s=i.split("."),c=0,u=s.length;c<u&&l;c++)n=l[+s[c]||s[c]],l=n;return n||e[i]}function i(e){var t=e.slice(0);return t.sort(function(e,t){if(!e.attribute)return 1;if(!t.attribute)return-1;if(e.attribute!==t.attribute)return e.attribute<t.attribute?-1:1;if(e.value!==t.value)return e.value<t.value?-1:1;if(!("replace"in e||"replace"in t))throw new Error("Conflicting mappings for attribute "+e.attribute+" and value "+e.value);return e.replace?1:-1}),t}function n(e,t,r){var a,i,n,l="</"+t+">",s=new RegExp("< *"+t+"( *|>)","g"),c=0,u=-1;for(a=r.search(e),i=a;i>-1&&c!==u;)i=r.indexOf(l,i),i>-1&&(i+=t.length+3,c++,n=r.slice(a,i),u=n.match(s).length);if(i===-1)throw new Error("Unmatched tag "+t+" in "+r);return n}function l(e){return this instanceof l?(this.mappings=[],void(this.conf=e||{})):new l(e)}function s(e){e&&this.mappings.push({});var t=this.mappings[this.mappings.length-1];return t&&t.attribute&&t.value&&t.dataKey&&t.replace?t.re=new RegExp(t.attribute+"=(['\"]?)"+t.value+"\\1"):t&&delete t.re,t}var c=Object.prototype.toString;[].indexOf||(Array.prototype.indexOf=function(e,t,r){for(r=this.length,t=(r+~~t)%r;t<r&&(!(t in this)||this[t]!==e);t++);return t^r?t:-1}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===c.call(e)});var u=function(){};u.prototype={nest:[],tag:new RegExp(["<","(/?)","([-:\\w]+)","((?:[-\\w]+(?:","=","(?:\\w+|[\"|'](?:.*)[\"|']))?)*)","(/?)",">"].join("\\s*")),attr:/([\-\w]*)\s*=\s*(?:["\']([\-\.\w\s\/:;&#]*)["\'])/gi,selfClosing:/area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr/,hasClass:function(e,t){return~e.split(" ").indexOf(t)},iterate:function(e,t,r,a,i,l){var s="",c=n(r.input,a,e),u={};if(Array.isArray(t)){for(var o=0,p=t.length;o<p;o++)i?u[i]=t[o]:u=t[o],s+=this.bind(c,u,l);return s}return"object"==typeof t?(c=c.slice(r.input.length,-(a.length+3)),s+=this.bind(c,t,l)):t},bind:function(e,t,n){if(Array.isArray(t)){for(var l="",s=0,u=t.length;s<u;s++)l+=this.bind(e,t[s],n);return l}e=e||"",t=t||{};for(var o,p,f,h,d,y,g=this,v=0,b=0,m=n&&i(n.mappings),w=!1,A="",x=!1,P=!1,j=!1,K=!1,E=n&&n.conf&&n.conf.create,O="",s=0,u=e.length;s<u;s++)if(d=e.charAt(s),"!"===d&&w&&!K)w=!1,O+=e.slice(y,s+1);else if("<"!==d||w)if(">"===d&&w){if(w=!1,h=e.slice(y,s+1),o=this.tag.exec(h),!o){w=!0;continue}if(x=o[1],A=o[2],p=o[3],j=o[4],P=this.selfClosing.test(A),K&&(x?v<=0?K=!1:--v:P||++v),!x&&!K)if(m&&m.length>0)for(var C=m.length-1;C>=0;C--){var R=!1,k=m[C],q=k.re&&p.match(k.re);if("tag"in k&&!this.attr.test(h)&&k.tag===A)h+=a(t,k,"",h);else if(h=h.replace(this.attr,function(i,l,s,u){var p;if(q&&k.replace!==l||b)return i;if(q||"undefined"!=typeof k.replacePartial1)return R=!0,p="undefined"!=typeof k.replacePartial2?s.replace(k.replacePartial1,k.replacePartial2):"undefined"!=typeof k.replacePartial1&&k.dataKey?s.replace(k.replacePartial1,a(t,k,s,h,l)):a(t,k,s,h,l),l+'="'+(p||"")+'"';if(!k.replace&&k.attribute===l&&(k.value===s||g.hasClass(s,k.value||m.conf.where===l)||"[object RegExp]"===c.call(k.value)&&null!==k.value.exec(s)))if(k.remove)P||b++,K=!0;else if(k.plates){var f=g.bind(k.plates,"string"==typeof k.data?a(t,{dataKey:k.data}):k.data||t,k.mapper);O+=h+g.iterate(e,f,o,A,r,n),K=!0}else{var d=p=a(t,k,s,h,l);p=h+p,Array.isArray(d)?(p=g.iterate(e,d,o,A,s,n),g.nest.push(A)):"object"==typeof d&&(p=h+g.iterate(e,d,o,A,s,n)),O+=p||"",K=!0}return i}),E&&q&&!R){var B=j?2:1,I=j?"/>":">",y=h.substr(0,h.length-B);" "===y[y.length-1]&&(y=y.substr(0,y.length-1),j&&(I=" "+I)),h=[y," ",k.replace,'="',a(t,k),'"',I].join("")}}else h.replace(this.attr,function(r,a,i,l){if(a===n&&n.conf.where||t[i]){var s=t[i],c=Array.isArray(s),u=c||"object"==typeof s?g.iterate(e,s,o,A,i,n):s;c&&g.nest.push(A),O+=c?u:h+u,K=!0}});K||0!==g.nest.length?!K&&g.nest.length&&this.nest.pop():(b||(O+=h),b&&x&&--b)}else w||K||b||(O+=d);else f=!0,w=!0,y=s;return O}},l.prototype={replace:function(e,t){var r=s.call(this);return r.replacePartial1=e,r.replacePartial2=t,this},use:function(e){return s.call(this).dataKey=e,s.call(this)&&this},where:function(e){return s.call(this,!0).attribute=e,s.call(this)&&this},class:function(e){return this.where("class").is(e)},tag:function(e){return s.call(this,!0).tag=e,this},is:function(e){return s.call(this).value=e,s.call(this)&&this},has:function(e){return s.call(this).value=e,this.replace(e),s.call(this)&&this},insert:function(e){var t=s.call(this);return t.replace=t.attribute,t.dataKey=e,s.call(this)&&this},as:function(e){return s.call(this).replace=e,s.call(this)&&this},remove:function(){return s.call(this).remove=!0,s.call(this,!0)},append:function(a,i,n){var c=s.call(this);return i instanceof l&&(n=i,i=r),/<[^<]+?>/.test(a)||e.cache[a]||("document"in t&&"getElementById"in t.document?e.cache[a]=document.getElementById(a).innerHTML:e.cache[a]=require("fs").readFileSync(require("path").join(process.cwd(),a),"utf8")),c.plates=e.cache[a]||a,c.data=i,c.mapper=n,s.call(this,!0)}},l.prototype.className=l.prototype.class,l.prototype.partial=l.prototype.append,l.prototype.to=l.prototype.use,e.cache={},e.bind=function(e,t,r){var a=new u;return a.bind(e,t,r)},e.Map=l}(Plates,this);
//# sourceMappingURL=plates.min.js.map