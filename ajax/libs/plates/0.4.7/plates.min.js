var Plates="undefined"!=typeof module&&"undefined"!=typeof module.exports&&"undefined"!=typeof exports?exports:{};!function(e,t,r){"use strict";function a(e,t,r,a,i){if(i=t.dataKey||i,t.dataKey&&"function"==typeof t.dataKey)return t.dataKey(e,r||"",a||"",i);if(!~i.indexOf("."))return e[i];for(var n=i,l=e,s=i.split("."),c=0,u=s.length;c<u&&l;c++)n=l[+s[c]||s[c]],l=n;return n||e[i]}function i(e){var t=e.slice(0);return t.sort(function(e,t){if(e.attribute!==t.attribute)return e.attribute<t.attribute?-1:1;if(e.value!==t.value)return e.value<t.value?-1:1;if(!("replace"in e||"replace"in t))throw new Error("Conflicting mappings for attribute "+e.attribute+" and value "+e.value);return e.replace?1:-1}),t}function n(e){return this instanceof n?(this.mappings=[],void(this.conf=e||{})):new n(e)}function l(e){e&&this.mappings.push({});var t=this.mappings[this.mappings.length-1];return t&&t.attribute&&t.value&&t.dataKey&&t.replace?t.re=new RegExp(t.attribute+"=(['\"]?)"+t.value+"\\1"):t&&delete t.re,t}var s=Object.prototype.toString;[].indexOf||(Array.prototype.indexOf=function(e,t,r){for(r=this.length,t=(r+~~t)%r;t<r&&(!(t in this)||this[t]!==e);t++);return t^r?t:-1}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===s.call(e)});var c=function(){};c.prototype={nest:[],tag:new RegExp(["<","(/?)","([-:\\w]+)","((?:[-\\w]+(?:","=","(?:\\w+|[\"|'](?:.*)[\"|']))?)*)","(/?)",">"].join("\\s*")),attr:/([\-\w]*)\s*=\s*(?:["\']([\-\.\w\s\/:;&#]*)["\'])/gi,selfClosing:/area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr/,hasClass:function(e,t){return~e.split(" ").indexOf(t)},iterate:function(e,t,r,a,i,n){var l="",s=e.slice(e.search(r.input),e.lastIndexOf(a)+a.length+1),c={};if(Array.isArray(t)){for(var u=0,o=t.length;u<o;u++)i?c[i]=t[u]:c=t[u],l+=this.bind(s,c,n);return l}return"object"==typeof t?(s=s.slice(r.input.length,-(a.length+3)),l+=this.bind(s,t,n)):t},bind:function(e,t,n){if(Array.isArray(t)){for(var l="",c=0,u=t.length;c<u;c++)l+=this.bind(e,t[c],n);return l}e=e||"",t=t||{};for(var o,p,f,h,d,y,g=this,v=0,b=0,m=n&&i(n.mappings),w=!1,A="",x=!1,P=!1,j=!1,K=!1,E=n&&n.conf&&n.conf.create,O="",c=0,u=e.length;c<u;c++)if(d=e.charAt(c),"!"===d&&w&&!K)w=!1,O+=e.slice(y,c+1);else if("<"!==d||w)if(">"===d&&w){if(w=!1,h=e.slice(y,c+1),o=this.tag.exec(h),!o){w=!0;continue}if(x=o[1],A=o[2],p=o[3],j=o[4],P=this.selfClosing.test(A),K&&(x?v<=0?K=!1:--v:P||++v),!x&&!K)if(m&&m.length>0)for(var C=m.length-1;C>=0;C--){var k=!1,I=m[C],R=I.re&&p.match(I.re);if("tag"in I&&!this.attr.test(h)&&I.tag===A)h+=a(t,I,"",h);else if(h=h.replace(this.attr,function(i,l,c,u){var p;if(R&&I.replace!==l||b)return i;if(R||"undefined"!=typeof I.replacePartial1)return k=!0,p="undefined"!=typeof I.replacePartial2?c.replace(I.replacePartial1,I.replacePartial2):"undefined"!=typeof I.replacePartial1&&I.dataKey?c.replace(I.replacePartial1,a(t,I,c,h,l)):a(t,I,c,h,l),l+'="'+(p||"")+'"';if(!I.replace&&I.attribute===l&&(I.value===c||g.hasClass(c,I.value||m.conf.where===l)||"[object RegExp]"===s.call(I.value)&&null!==I.value.exec(c)))if(I.remove)P||b++,K=!0;else if(I.plates){var f=g.bind(I.plates,"string"==typeof I.data?t[I.data]:I.data||t,I.mapper);O+=h+g.iterate(e,f,o,A,r,n),K=!0}else{var d=p=a(t,I,c,h,l);p=h+p,Array.isArray(d)?(p=g.iterate(e,d,o,A,c,n),g.nest.push(A)):"object"==typeof d&&(p=h+g.iterate(e,d,o,A,c,n)),O+=p||"",K=!0}return i}),E&&R&&!k){var q=j?2:1,B=j?"/>":">",y=h.substr(0,h.length-q);" "===y[y.length-1]&&(y=y.substr(0,y.length-1),j&&(B=" "+B)),h=[y," ",I.replace,'="',a(t,I),'"',B].join("")}}else h.replace(this.attr,function(r,a,i,l){if(a===n&&n.conf.where||t[i]){var s=t[i],c=Array.isArray(s),u=c||"object"==typeof s?g.iterate(e,s,o,A,i,n):s;c&&g.nest.push(A),O+=c?u:h+u,K=!0}});K||0!==g.nest.length?!K&&g.nest.length&&this.nest.pop():(b||(O+=h),b&&x&&--b)}else w||K||b||(O+=d);else f=!0,w=!0,y=c;return O}},n.prototype={replace:function(e,t){var r=l.call(this);return r.replacePartial1=e,r.replacePartial2=t,this},use:function(e){return l.call(this).dataKey=e,l.call(this)&&this},where:function(e){return l.call(this,!0).attribute=e,l.call(this)&&this},class:function(e){return this.where("class").is(e)},tag:function(e){return l.call(this,!0).tag=e,this},is:function(e){return l.call(this).value=e,l.call(this)&&this},has:function(e){return l.call(this).value=e,this.replace(e),l.call(this)&&this},insert:function(e){var t=l.call(this);return t.replace=t.attribute,t.dataKey=e,l.call(this)&&this},as:function(e){return l.call(this).replace=e,l.call(this)&&this},remove:function(){return l.call(this).remove=!0,l.call(this,!0)},append:function(a,i,s){var c=l.call(this);return i instanceof n&&(s=i,i=r),/<[^<]+?>/.test(a)||e.cache[a]||("document"in t&&"getElementById"in t.document?e.cache[a]=document.getElementById(a).innerHTML:e.cache[a]=require("fs").readFileSync(require("path").join(process.cwd(),a),"utf8")),c.plates=e.cache[a]||a,c.data=i,c.mapper=s,l.call(this,!0)}},n.prototype.className=n.prototype.class,n.prototype.partial=n.prototype.append,n.prototype.to=n.prototype.use,e.cache={},e.bind=function(e,t,r){var a=new c;return a.bind(e,t,r)},e.Map=n}(Plates,this);
//# sourceMappingURL=plates.min.js.map