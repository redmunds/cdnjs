angular.module("angular-hal",[]).service("halClient",["$http","$q","$window",function(r,n,t){function e(r,t,e,o){function f(r){return n(function(n,t){t(new Error('link "'+r+'" is undefined'))})}function h(r,n,t){Object.defineProperty(r,n,{configurable:!1,enumerable:!1,value:t})}function c(r){if(Array.isArray(r))return r.map(function(r){return c(r)});var t=r.$href("self");y[t]=n.when(r)}function l(r,n){var t=r.templated?new s.UriTemplate(r.href).stringify(n):r.href;return t}function d(r,e,i,a,o){var f;if(Array.isArray(e))return n.all(e.map(function(n){if("GET"!==r)throw"method is not supported for arrays";return d(r,n,i,a,o)}));f=l(e,i);var s=angular.extend({},t,o);return"GET"===r&&f in y?y[f]:u(r,f,s,a)}function p(r,n){return Array.isArray(n)?n.map(function(n){return p(r,n)}):a(r,n&&n[v]&&n[v].self)}var v=t.linksAttribute||"_links",$=t.embeddedAttribute||"_embedded",g=t.ignoreAttributePrefixes||["_","$"],m={},y={};r=p(r,e).href,h(this,"$href",function(r,n){return this.$has(r)?l(m[r],n):null}),h(this,"$meta",function(r){for(var n=0;n<g.length;n++){var t=g[n]+r;if($!==t&&v!==t&&e.hasOwnProperty(t))return e[t]}return null}),h(this,"$has",function(r){return r in m}),h(this,"$get",function(r,n,t){if(!this.$has(r))return f(r);var e=m[r];return d("GET",e,n,void 0,t)}),h(this,"$post",function(r,n,t,e){if(!this.$has(r))return f(r);var i=m[r];return d("POST",i,n,t,e)}),h(this,"$put",function(r,n,t,e){if(!this.$has(r))return f(r);var i=m[r];return d("PUT",i,n,t,e)}),h(this,"$patch",function(r,n,t,e){if(!this.$has(r))return f(r);var i=m[r];return d("PATCH",i,n,t,e)}),h(this,"$del",function(r,n,t){if(!this.$has(r))return f(r);var e=m[r];return d("DELETE",e,n,void 0,t)}),h(this,"$response",function(){return o}),h(this,"$link",function(r,n,t,e){var i=m[r];return d("LINK",i,n,t,e)}),h(this,"$unlink",function(r,n,t,e){var i=m[r];return d("UNLINK",i,n,t,e)}),Object.keys(e).filter(function(r){return r!==v&&r!==$&&!~g.indexOf(r[0])}).forEach(function(r){Object.defineProperty(this,r,{configurable:!1,enumerable:!0,value:e[r],writable:!0})},this),e[v]&&Object.keys(e[v]).forEach(function(n){var t=e[v][n];t=a(r,t),m[n]=t},this),e[$]&&Object.keys(e[$]).forEach(function(n){var a=e[$][n],u=p(r,a);m[n]=u;var f=i(r,t,a,o);c(f)},this)}function i(r,n,t,a){if(Array.isArray(t))return t.map(function(t){return i(r,n,t,a)});var u=new e(r,n,t,a);return u}function a(r,n){return Array.isArray(n)?n.map(function(n){return a(r,n)}):(n?("string"==typeof n&&(n={href:n}),n.href=o(r,n.href)):n={href:r},n)}function u(t,e,a,u){a||(a={}),a.headers||(a.headers={}),a.headers["Content-Type"]||(a.headers["Content-Type"]="application/json"),a.headers.Accept||(a.headers.Accept="application/hal+json,application/json"),"LINK"!==t&&"UNLINK"!==t||(a.headers.Link||(a.headers.Link=[]),angular.forEach(u,function(r){a.headers.Link.push(r.toString())}));var o={method:t,url:a.transformUrl?a.transformUrl(e):e,headers:a.headers,data:u};a.httpConfig&&(o=angular.extend(o,a.httpConfig));var f=r(o).then(function(r){switch(Math.floor(r.status/100)){case 2:return r.data&&r.data?i(e,a,r.data,r):r.headers("Content-Location")?r.headers("Content-Location"):r.headers("Location")?r.headers("Location"):null;default:return n.reject(r.status)}});return f}function o(r,n){for(var t="",e=/^((?:\w+\:)?)((?:\/\/)?)([^\/]*)((?:\/.*)?)$/,i=e.exec(r),a=e.exec(n),u=1;5>u;u++)t+=a[u]?a[u]:i[u];return t}function f(r,n){var t=this;return function(){angular.merge(t,{uriReference:r,linkParams:angular.merge({rel:null,anchor:null,rev:null,hreflang:null,media:null,title:null,type:null},n)})}(),t.toString=function(){var r="<"+t.uriReference+">",n=[];return angular.forEach(t.linkParams,function(r,t){r&&n.push(t+'="'+r+'"')}),n.length<1?r:r=r+";"+n.join(";")},this}var s=t.rfc6570;this.$get=function(r,n){return u("GET",r,n)},this.$post=function(r,n,t){return u("POST",r,n,t)},this.$put=function(r,n,t){return u("PUT",r,n,t)},this.$patch=function(r,n,t){return u("PATCH",r,n,t)},this.$del=function(r,n){return u("DELETE",r,n)},this.$link=function(r,n,t){return u("LINK",r,n,t)},this.$unlink=function(r,n,t){return u("UNLINK",r,n,t)},this.LinkHeader=f}]);