angular.module("angular-hal",[]).service("halClient",["$http","$q","$window",function(n,r,t){function e(n,t,e,o){function f(n){return r(function(r,t){t(new Error('link "'+n+'" is undefined'))})}function h(n,r,t){Object.defineProperty(n,r,{configurable:!1,enumerable:!1,value:t})}function c(n){if(Array.isArray(n))return n.map(function(n){return c(n)});var t=n.$href("self");y[t]=r.when(n)}function l(n,r){var t=n.templated?new s.UriTemplate(n.href).stringify(r):n.href;return t}function d(n,e,i,u,o){var f;if(Array.isArray(e))return r.all(e.map(function(r){if("GET"!==n)throw"method is not supported for arrays";return d(n,r,i,u,o)}));f=l(e,i);var s=angular.extend({},t,o);return"GET"===n&&f in y?y[f]:a(n,f,s,u)}function p(n,r){return Array.isArray(r)?r.map(function(r){return p(n,r)}):u(n,r&&r[$]&&r[$].self)}var $=t.linksAttribute||"_links",v=t.embeddedAttribute||"_embedded",g=t.ignoreAttributePrefixes||["_","$"],m={},y={};n=p(n,e).href,h(this,"$links",function(n){return this.$has(n)?m[n]:null}),h(this,"$href",function(n,r){return this.$has(n)?l(m[n],r):null}),h(this,"$meta",function(n){for(var r=0;r<g.length;r++){var t=g[r]+n;if(v!==t&&$!==t&&e.hasOwnProperty(t))return e[t]}return null}),h(this,"$has",function(n){return n in m}),h(this,"$get",function(n,r,t){if(!this.$has(n))return f(n);var e=m[n];return d("GET",e,r,void 0,t)}),h(this,"$post",function(n,r,t,e){if(!this.$has(n))return f(n);var i=m[n];return d("POST",i,r,t,e)}),h(this,"$put",function(n,r,t,e){if(!this.$has(n))return f(n);var i=m[n];return d("PUT",i,r,t,e)}),h(this,"$patch",function(n,r,t,e){if(!this.$has(n))return f(n);var i=m[n];return d("PATCH",i,r,t,e)}),h(this,"$del",function(n,r,t){if(!this.$has(n))return f(n);var e=m[n];return d("DELETE",e,r,void 0,t)}),h(this,"$response",function(){return o}),h(this,"$link",function(n,r,t,e){var i=m[n];return d("LINK",i,r,t,e)}),h(this,"$unlink",function(n,r,t,e){var i=m[n];return d("UNLINK",i,r,t,e)}),Object.keys(e).filter(function(n){return n!==$&&n!==v&&!~g.indexOf(n[0])}).forEach(function(n){Object.defineProperty(this,n,{configurable:!1,enumerable:!0,value:e[n],writable:!0})},this),e[$]&&Object.keys(e[$]).forEach(function(r){var t=e[$][r];t=u(n,t),m[r]=t},this),e[v]&&Object.keys(e[v]).forEach(function(r){var u=e[v][r],a=p(n,u);m[r]=a;var f=i(n,t,u,o);c(f)},this)}function i(n,r,t,u){if(Array.isArray(t))return t.map(function(t){return i(n,r,t,u)});var a=new e(n,r,t,u);return a}function u(n,r){return Array.isArray(r)?r.map(function(r){return u(n,r)}):(r?("string"==typeof r&&(r={href:r}),r.href=o(n,r.href)):r={href:n},r)}function a(t,e,u,a){u||(u={}),u.headers||(u.headers={}),u.headers["Content-Type"]||(u.headers["Content-Type"]="application/json"),u.headers.Accept||(u.headers.Accept="application/hal+json,application/json"),"LINK"!==t&&"UNLINK"!==t||(u.headers.Link=[],angular.forEach(a,function(n){u.headers.Link.push(n.toString())}));var o={method:t,url:u.transformUrl?u.transformUrl(e):e,headers:u.headers,data:a};u.httpConfig&&(o=angular.extend(o,u.httpConfig));var f=n(o).then(function(n){switch(Math.floor(n.status/100)){case 2:return n.data&&n.data?i(e,u,n.data,n):n.headers("Content-Location")?n.headers("Content-Location"):n.headers("Location")?n.headers("Location"):null;default:return r.reject(n.status)}});return f}function o(n,r){for(var t="",e=/^((?:\w+\:)?)((?:\/\/)?)([^\/]*)((?:\/.*)?)$/,i=e.exec(n),u=e.exec(r),a=1;5>a;a++)t+=u[a]?u[a]:i[a];return t}function f(n,r){var t=this;return function(){angular.merge(t,{uriReference:n,linkParams:angular.merge({rel:null,anchor:null,rev:null,hreflang:null,media:null,title:null,type:null},r)})}(),t.toString=function(){var n="<"+t.uriReference+">",r=[];return angular.forEach(t.linkParams,function(n,t){n&&r.push(t+'="'+n+'"')}),r.length<1?n:n=n+";"+r.join(";")},this}var s=t.rfc6570;this.$get=function(n,r){return a("GET",n,r)},this.$post=function(n,r,t){return a("POST",n,r,t)},this.$put=function(n,r,t){return a("PUT",n,r,t)},this.$patch=function(n,r,t){return a("PATCH",n,r,t)},this.$del=function(n,r){return a("DELETE",n,r)},this.$link=function(n,r,t){return a("LINK",n,r,t)},this.$unlink=function(n,r,t){return a("UNLINK",n,r,t)},this.LinkHeader=f}]);