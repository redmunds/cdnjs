!function(t){"use strict";function e(t,i){function n(t){return s(n,r,i,this,t,h.call(arguments,1),arguments.length)}i||(i={});var r=t;return n.constructor=e,n}function i(t){return-1!=t.toString().indexOf("[native code]")}function n(t,e){function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t}var s,r=Object.prototype.hasOwnProperty,a=Object.prototype.toString,o=Array.prototype.push,h=Array.prototype.slice,l=Array.prototype.splice,u=Function("return this;")();"object"==typeof exports?"object"==typeof module?module.exports=e:exports.cellx=e:u.cellx=e;var c="__cellx_uid__",f="__cellx_cells__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(c=Symbol(c),f=Symbol(f)),e.KEY_UID=c,e.KEY_CELLS=f;var _,v=0;_=u.console?console.error?function(t){console.error(t===Object(t)&&t.stack||t)}:function(t){console.log("!!! "+(t===Object(t)&&t.stack||t))}:function(){},e.logError=_;var g=Object.create||function(t){function e(){}return e.prototype=t,new e},d=Object.assign||function(t,e){for(var i in e)r.call(e,i)&&(t[i]=e[i]);return t},p=Object.is||function(t,e){return t===e||t!=t&&e!=e},m=Array.isArray||function(t){return"[object Array]"==a.call(t)};!function(){var t;t=i(g)?function(){return g(null)}:function(){var e=document.createElement("iframe"),i=document.body||document.documentElement;e.style.display="none",i.appendChild(e),e.src="javascript:";var n=e.contentWindow.Object.prototype;return i.removeChild(e),e=null,delete n.constructor,delete n.isPrototypeOf,delete n.hasOwnProperty,delete n.propertyIsEnumerable,delete n.valueOf,delete n.toString,delete n.toLocaleString,t=function(){},t.prototype=n,new t},e.Dictionary=t}(),function(){var n=u.Map;if(!n){var s=e.Dictionary,a={value:t};n=function(t){if(this._entries=new s,this._objectStamps={},this._first=null,this._last=null,this.size=0,t)for(var e=0,i=t.length;i>e;e++)this.set(t[e][0],t[e][1])},d(n.prototype,{has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||a).value},set:function(t,e){var i=this._entries,n=this._getValueStamp(t);if(i[n])i[n].value=e;else{var s=i[n]={key:t,keyStamp:n,value:e,prev:this._last,next:null};this.size++?this._last.next=s:this._first=s,this._last=s}return this},"delete":function(t){var e=this._getValueStamp(t),i=this._entries[e];if(!i)return!1;if(--this.size){var n=i.prev,s=i.next;n?n.next=s:this._first=s,s?s.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(){function t(t){var e,i=this._objectStamps;for(e in i)if(i[e]==t)return e;return e=String(++v),i[e]=t,e}return Object.defineProperty&&i(Object.defineProperty)&&Object.isExtensible&&i(Object.isExtensible)?function(e){if(!r.call(e,c)){if(!Object.isExtensible(e))return t.call(this,e);Object.defineProperty(e,c,{value:String(++v)})}return e[c]}:t}(),forEach:function(t,e){null==e&&(e=u);for(var i=this._first;i;){t.call(e,i.value,i.key,this);do i=i.next;while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}});for(var o=[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]],h=0,l=o.length;l>h;h++)n.prototype[o[h][0]]=function(e){return function(){var i,n=this._entries,s=!1,r=this;return{next:function(){if(!s){if(i){do i=i.next;while(i&&!n[i.keyStamp])}else i=r._first;if(i)return{value:e(i),done:!1};s=!0}return{value:t,done:!0}}}}}(o[h][1])}e.Map=n}(),function(){var t;if(u.process&&"[object process]"==process.toString()&&process.nextTick)t=process.nextTick;else if(u.setImmediate)t=function(t){setImmediate(t)};else if(u.Promise&&i(Promise)){var n=Promise.resolve();t=function(t){n.then(function(){t()})}}else if(u.postMessage&&!u.ActiveXObject){var s;u.addEventListener("message",function(){if(s){var t=s;s=null;for(var i=0,n=t.length;n>i;i++)try{t[i]()}catch(r){e.logError(r)}}},!1),t=function(t){s?s.push(t):(s=[t],u.postMessage("__tic__","*"))}}else t=function(t){setTimeout(t,1)};e.nextTick=t}(),function(){function i(){this.parent=null,this._events=new n}var n=e.Dictionary,s="__cellx_EventEmitter_inner__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(s=Symbol(s)),i.KEY_INNER=s,d(i.prototype,{on:function(t,e,i){if("object"==typeof t){i=e;var n=t;for(t in n)this._on(t,n[t],i)}else this._on(t,e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t){i=e;var s=t;for(t in s)this._off(t,s[t],i)}else this._off(t,e,i);else this._events&&(this._events=new n);return this},_on:function(t,e,i){var s=(this._events||(this._events=new n))[t];s||(s=this._events[t]=[]),s.push({listener:e,context:i||this})},_off:function(t,e,i){var n=this._events&&this._events[t];if(n){i||(i=this);for(var r=n.length;r;)if(n[--r].context==i){var a=n[r].listener;if(a==e||a[s]===e){n.splice(r,1);break}}n.length||delete this._events[t]}},once:function(t,e,i){function n(){return this._off(t,n,i),e.apply(this,arguments)}return n[s]=e,this._on(t,n,i),this},emit:function(e){return"string"==typeof e?e={target:this,type:e}:e.target===t&&(e.target=this),this._handleEvent(e),e},_handleEvent:function(t){var e=this._events&&this._events[t.type];if(e){e=e.slice();for(var i=0,n=e.length;n>i;i++)try{e[i].listener.call(e[i].context,t)===!1&&(t.isPropagationStopped=!0)}catch(s){this._logError(s)}}this.parent&&t.bubbles!==!1&&!t.isPropagationStopped&&this.parent._handleEvent(t)},_logError:function(t){e.logError(t)}}),e.EventEmitter=i}();var y;!function(){var t=e.EventEmitter;y={_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(e){var i=this._valueCounts,n=i.get(e);n?i.set(e,n+1):(i.set(e,1),this.adoptsItemChanges&&e instanceof t&&e.on("change",this._onItemChange,this))},_unregisterValue:function(e){var i=this._valueCounts,n=i.get(e);n>1?i.set(e,n-1):(i["delete"](e),this.adoptsItemChanges&&e instanceof t&&e.off("change",this._onItemChange,this))},dispose:function(){if(this.adoptsItemChanges){var e=this._onItemChange;this._valueCounts.forEach(function(i){i instanceof t&&i.off("change",e,this)},this)}}}}(),function(){function i(t,e){if(this._entries=new r,this._valueCounts=new r,this.size=0,this.adoptsItemChanges=!e||e.adoptsItemChanges!==!1,t){var n=this._entries;if(t instanceof i)t._entries.forEach(function(t,e){n.set(e,t),this._registerValue(t)},this);else if(m(t))for(var s=0,a=t.length;a>s;s++){var o=t[s];n.set(o[0],o[1]),this._registerValue(o[1])}else for(var h in t)n.set(h,t[h]),this._registerValue(t[h]);this.size=n.size}}function s(t,e){return new i(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var r=e.Map;n(i,e.EventEmitter),d(i.prototype,y),d(i.prototype,{has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var i,n=this._entries,s=n.has(t);if(s){if(i=n.get(t),p(i,e))return this;this._unregisterValue(i)}return n.set(t,e),this._registerValue(e),s||this.size++,this.emit({type:"change",subtype:s?"update":"add",key:t,oldValue:i,value:e}),this},"delete":function(e){var i=this._entries;if(!i.has(e))return!1;var n=i.get(e);return i["delete"](e),this._unregisterValue(n),this.size--,this.emit({type:"change",subtype:"delete",key:e,oldValue:n,value:t}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(t,e){null==e&&(e=u),this._entries.forEach(function(i,n){t.call(e,i,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}}),e.ActiveMap=i,e.map=s}(),function(){function i(t,e){return e>t?-1:t>e?1:0}function s(t,e){var i=t._items;if(t.sorted)for(var n=t.comparator,s=0,r=e.length;r>s;s++){for(var a=e[s],h=0,l=i.length;h!=l;){var u=h+l>>1;n(a,i[u])<0?l=u:h=u+1}i.splice(h,0,a),t._registerValue(a)}else{o.apply(i,e);for(var c=e.length;c;)t._registerValue(e[--c])}t.length=i.length}function r(t,e){e||(e={}),this._items=[],this._valueCounts=new h,this.length=0,this.adoptsItemChanges=e.adoptsItemChanges!==!1,this.comparator=null,this.sorted=!1,(e.sorted||e.comparator&&e.sorted!==!1)&&(this.comparator=e.comparator||i,this.sorted=!0),t&&s(this,t instanceof r?t._items:t)}function a(t,e){return new r(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var h=e.Map,u=Array.prototype;n(r,e.EventEmitter),d(r.prototype,y),d(r.prototype,{_validateIndex:function(e,i){if(e===t)return e;if(0>e){if(e+=this.length,0>e)throw new RangeError("Index out of range")}else if(e>=this.length+(i?1:0))throw new RangeError("Index out of range");return e},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,this._validateIndex(e))},get:function(t){return this._items[this._validateIndex(t)]},getRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)return n.slice(e);if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');return n.slice(e,e+i)},set:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=this._items;return p(i[t],e)?this:(this._unregisterValue(i[t]),i[t]=e,this._registerValue(e),this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=e.length;if(!i)return this;if(t+i>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var n=this._items,s=!1,r=t+i;r>t;){var a=e[--r];p(n[r],a)||(this._unregisterValue(n[r]),n[r]=a,this._registerValue(a),s=!0)}return s&&this.emit("change"),this},add:function(t){return this.addRange([t]),this},addRange:function(t){return t.length?(s(this,t),this.emit("change"),this):this},insert:function(t,e){return this.insertRange(t,[e]),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Can't insert to sorted list");t=this._validateIndex(t,!0);var i=e.length;if(!i)return this;l.apply(this._items,[].concat(t,0,e));for(var n=i;n;)this._registerValue(e[--n]);return this.length+=i,this.emit("change"),this},remove:function(t,e){var i=this._items.indexOf(t,this._validateIndex(e));return-1==i?this:(this._items.splice(i,1),this._unregisterValue(t),this.length--,this.emit("change"),this)},removeAll:function(t,e){for(var i=this._items,n=this._validateIndex(e),s=!1;-1!=(n=i.indexOf(t,n));)i.splice(n,1),this._unregisterValue(t),s=!0;return s&&(this.length=i.length,this.emit("change")),this},removeAt:function(t){return this._unregisterValue(this._items.splice(this._validateIndex(t),1)[0]),this.length--,this.emit("change"),this},removeRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)i=n.length-e;else if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!i)return this;for(var s=e+i;s>e;)this._unregisterValue(n[--s]);return n.splice(e,i),this.length-=i,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});for(var c=["forEach","map","filter","every","some","reduce","reduceRight"],f=c.length;f;)!function(t){r.prototype[t]=function(){return u[t].apply(this._items,arguments)}}(c[--f]);e.ActiveList=r,e.list=a}(),function(){function i(){if(!(c>f)){l=!0;do{var t=u[c];if(t){var e=t.shift();if(c){var i=c;e._recalc(),u[i].length||(u[i]=null,c&&c++)}else{var n=e._changeEvent;e._fixedValue=e._value,e._changeEvent=null,e._changed=!0,e._events.change&&e._handleEvent(n);for(var s=e._slaves,r=s.length;r;){var a=s[--r];a._fixed&&((u[1]||(u[1]=[])).push(a),f||(f=1),a._fixed=!1)}u[0].length||c++}}else c++}while(f>=c);f=-1,v++,l=!1}}function s(e,i){a.call(this),i||(i={}),this.owner=i.owner||null,this.computed="function"==typeof e&&(i.computed!==t?i.computed:e.constructor==Function),this._value=t,this._fixedValue=t,this.initialValue=t,this._formula=null,this._read=i.read||null,this._write=i.write||null,this._validate=i.validate||null,this._masters=null,this._slaves=[],this._level=0,this._active=!this.computed,this._changeEvent=null,this._isChangeCancellable=!0,this._lastErrorEvent=null,this._fixed=!0,this._version=0,this._changed=!1,this._circularityCounter=0,this.computed?this._formula=e:(this._validate&&this._validate.call(this.owner||this,e),this._value=this._fixedValue=this.initialValue=e,e instanceof a&&e.on("change",this._onValueChange,this)),i.onchange&&this.on("change",i.onchange),i.onerror&&this.on("error",i.onerror)}var r=e.nextTick,a=e.EventEmitter,o=a.KEY_INNER,h={original:null},l=!1,u=[[]],c=0,f=-1,_=null,v=1;n(s,a),d(s.prototype,{changed:function(){return l||i(),this._changed},on:function(t,e,n){return l||i(),!this.computed||this._events.change||this._slaves.length||this._activate(),a.prototype.on.call(this,t,e,n),this},off:function(t,e,n){return l||i(),a.prototype.off.call(this,t,e,n),!this.computed||this._events.change||this._slaves.length||this._deactivate(),this},_on:function(t,e,i){a.prototype._on.call(this,t,e,i||this.owner)},_off:function(t,e,i){a.prototype._off.call(this,t,e,i||this.owner)},subscribe:function(t){function e(e){return t.call(this,e.error||null,e)}return e[o]=t,this.on("change",e).on("error",e),this},unsubscribe:function(t){return this.off("change",t).off("error",t),this},_registerSlave:function(t){!this.computed||this._events.change||this._slaves.length||this._activate(),this._slaves.push(t)},_unregisterSlave:function(t){this._slaves.splice(this._slaves.indexOf(t),1),!this.computed||this._events.change||this._slaves.length||this._deactivate()},_activate:function(){if(this._version!=v){this._masters=null,this._level=0;var t=this._tryFormula();t===h?this._handleError(h.original):p(this._value,t)||(this._value=t,this._changed=!0),this._version=v}for(var e=this._masters||[],i=e.length;i;)e[--i]._registerSlave(this);this._active=!0},_deactivate:function(){for(var t=this._masters||[],e=t.length;e;)t[--e]._unregisterSlave(this);this._active=!1},_onValueChange:function(t){this._changeEvent?(t.prev=this._changeEvent,this._changeEvent=t,this._value===this._fixedValue&&(this._isChangeCancellable=!1)):(u[0].push(this),c=0,-1==f&&(f=0),t.prev=null,this._changeEvent=t,this._isChangeCancellable=!1,l||r(i))},read:function(){if(_&&(_._masters?-1==_._masters.indexOf(this)&&(_._masters.push(this),_._level<=this._level&&(_._level=this._level+1)):(_._masters=[this],_._level=this._level+1)),l||i(),this.computed&&!this._active&&this._version!=v){this._masters=null,this._level=0;var t=this._tryFormula();if(t===h)this._handleError(h.original);else{var e=this._value;p(e,t)||(this._value=t,this._changed=!0)}this._version=v}return this._read?this._read.call(this.owner||this,this._value):this._value},write:function(t){if(this.computed&&!this._write)throw new TypeError("Cannot write to read-only cell");var e=this._value;return p(e,t)?!1:(this._validate&&this._validate.call(this.owner||this,t),this.computed?this._write.call(this.owner||this,t):(this._value=t,e instanceof a&&e.off("change",this._onValueChange,this),t instanceof a&&t.on("change",this._onValueChange,this),this._changeEvent?p(t,this._fixedValue)&&this._isChangeCancellable?(1==u[0].length?(u[0].pop(),f||(f=-1)):u[0].splice(u[0].indexOf(this),1),this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:e,value:t,prev:this._changeEvent}:(u[0].push(this),c=0,-1==f&&(f=0),this._changeEvent={target:this,type:"change",oldValue:e,value:t,prev:null},this._isChangeCancellable=!0,l||r(i))),!0)},_recalc:function(){if(this._version==v+1){if(10==++this._circularityCounter)return this._fixed=!0,this._version=v+1,void this._handleError(new RangeError("Circular dependency detected"))}else this._circularityCounter=1;var t=this._masters;this._masters=null;var e=this._level;this._level=0;for(var i=this._tryFormula(),n=this._masters||[],s=!1,r=t.length;r;){var o=t[--r];-1==n.indexOf(o)&&(o._unregisterSlave(this),s=!0)}if(s||t.length<n.length){for(var l=n.length;l;){var c=n[--l];-1==t.indexOf(c)&&c._registerSlave(this)}var _=this._level;if(_>e)return(u[_]||(u[_]=[])).push(this),void(_>f&&(f=_))}if(this._fixed=!0,this._version=v+1,i===h)this._handleError(h.original);else{var g=this._value;if(!p(g,i)||i instanceof a){this._value=i,this._changed=!0,this._events.change&&this.emit({type:"change",oldValue:g,value:i,prev:null});for(var d=this._slaves,m=d.length;m;){var y=d[--m];if(y._fixed){var E=y._level;(u[E]||(u[E]=[])).push(y),E>f&&(f=E),y._fixed=!1}}}}},_tryFormula:function(){var t=_;_=this;try{var e=this._formula.call(this.owner||this);return this._validate&&this._validate.call(this.owner||this,e),e}catch(i){return h.original=i,h}finally{_=t}},_handleError:function(t){this._logError(t),this._handleErrorEvent({type:"error",error:t})},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e=this._slaves,i=e.length;i&&!t.isPropagationStopped;)e[--i]._handleErrorEvent(t)}},dispose:function(){return l||i(),this._dispose(),this},_dispose:function(){if(this.off(),this._active)for(var t=this._slaves,e=t.length;e;)t[--e]._dispose()}}),e.Cell=s}(),function(){var t=e.Map,i=e.Cell,n=i.prototype;s=function(s,o,h,l,c,_,v){l&&l!=u||(l=s),r.call(l,f)||Object.defineProperty(l,f,{value:new t});var p=l[f].get(s);if(!p){if(null!=o&&"object"==typeof o)if("function"==typeof o.clone)o=o.clone();else if(m(o))o=o.slice();else if(o.constructor===Object)o=d({},o);else switch(a.call(o)){case"[object Date]":o=new Date(o);break;case"[object RegExp]":o=new RegExp(o)}h=g(h),h.owner=l,p=new i(o,h),l[f].set(s,p)}switch(v){case 0:return p.read();case 1:return p.write(c);default:return"bind"===c?(s=s.bind(l),s.constructor=e,s):"unwrap"===c?p:n[c].apply(p,_)}}}()}();