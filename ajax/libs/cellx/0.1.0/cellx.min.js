!function(t){"use strict";function e(t,n){function i(t){return r(i,s,n,this,t,l.call(arguments,1),arguments.length)}n||(n={});var s=t;return i.constructor=e,i}function n(t){return-1!=t.toString().indexOf("[native code]")}function i(t,e){return t===e||t!=t&&e!=e}function s(t,e){function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t}var r,o=Object.prototype.hasOwnProperty,a=Object.prototype.toString,h=Array.prototype.push,l=Array.prototype.slice,u=Array.prototype.splice,c=Function("return this;")();"undefined"!=typeof exports?"undefined"!=typeof module?module.exports=e:exports.cellx=e:c.cellx=e;var f="__cellx_uid__",_="__cellx_inner__",p="__cellx_used__",v="__cellx_cells__";c.Symbol&&"symbol"==typeof Symbol.iterator&&(f=Symbol(f),_=Symbol(_),p=Symbol(p),v=Symbol(v)),e.KEY_UID=f,e.KEY_INNER=_,e.KEY_USED=p,e.KEY_CELLS=v;var d,g=0;d=c.console?console.error?function(t){console.error(t===Object(t)&&t.stack||t)}:function(t){console.log("!!! "+(t===Object(t)&&t.stack||t))}:function(){},e.logError=d;var m=Object.create||function(t){function e(){}return e.prototype=t,new e},y=Object.assign||function(t,e){for(var n in e)o.call(e,n)&&(t[n]=e[n]);return t},w=Array.isArray||function(t){return"[object Array]"==a.call(t)},E=Date.now||function(){return+new Date};!function(){var t,i=Object.create;t=i&&n(i)?function(){return i(null)}:function(){var e=document.createElement("iframe"),n=document.body||document.documentElement;e.style.display="none",n.appendChild(e),e.src="javascript:";var i=e.contentWindow.Object.prototype;return n.removeChild(e),e=null,delete i.constructor,delete i.isPrototypeOf,delete i.hasOwnProperty,delete i.propertyIsEnumerable,delete i.valueOf,delete i.toString,delete i.toLocaleString,t=function(){},t.prototype=i,new t},e.Dictionary=t}(),function(){var i=c.Map;if(!i){var s=e.Dictionary,r={value:t};i=function(t){if(this._entries=new s,this._objectStamps={},t)for(var e=0,n=t.length;n>e;e++)this.set(t[e][0],t[e][1])},y(i.prototype,{_entries:null,_objectStamps:null,_first:null,_last:null,size:0,has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||r).value},set:function(t,e){var n=this._entries,i=this._getValueStamp(t);if(n[i])n[i].value=e;else{var s=n[i]={key:t,keyStamp:i,value:e,prev:this._last,next:null};this.size++?this._last.next=s:this._first=s,this._last=s}return this},"delete":function(t){var e=this._getValueStamp(t),n=this._entries[e];if(!n)return!1;if(--this.size){var i=n.prev,s=n.next;i?i.next=s:this._first=s,s?s.prev=i:this._last=i}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(){function t(t){var e,n=this._objectStamps;for(e in n)if(n[e]==t)return e;return e=String(++g),n[e]=t,e}return Object.defineProperty&&n(Object.defineProperty)&&Object.isExtensible&&n(Object.isExtensible)?function(e){if(!o.call(e,f)){if(!Object.isExtensible(e))return t.call(this,e);Object.defineProperty(e,f,{value:String(++g)})}return e[f]}:t}(),forEach:function(t,e){null==e&&(e=c);for(var n=this._first;n;){t.call(e,n.value,n.key,this);do n=n.next;while(n&&!this._entries[n.keyStamp])}},toString:function(){return"[object Map]"}});for(var a=[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]],h=0,l=a.length;l>h;h++)i.prototype[a[h][0]]=function(e){return function(){var n,i=this._entries,s=!1,r=this;return{next:function(){if(!s){if(n){do n=n.next;while(n&&!i[n.keyStamp])}else n=r._first;if(n)return{value:e(n),done:!1};s=!0}return{value:t,done:!0}}}}}(a[h][1])}e.Map=i}(),function(){var t=c.Set;if(!t){var n=e.Map;t=function(t){if(this._entries=new n,t)for(var e=0,i=t.length;i>e;e++)this.add(t[e])},y(t.prototype,{_entries:null,size:0,has:function(t){return this._entries.has(t)},add:function(t){return this._entries.set(t,t),this.size=this._entries.size,this},"delete":function(t){return this._entries["delete"](t)?(this.size--,!0):!1},clear:function(){this._entries.clear(),this.size=0},forEach:function(t,e){null==e&&(e=c),this._entries.forEach(function(n){t.call(e,n,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},toString:function(){return"[object Set]"}})}e.Set=t}(),function(){var t;if(c.process&&"[object process]"==process.toString()&&process.nextTick)t=process.nextTick;else if(c.setImmediate)t=function(t){setImmediate(t)};else if(c.Promise&&n(Promise)){var i=Promise.resolve();t=function(t){i.then(function(){t()})}}else if(c.postMessage&&!c.ActiveXObject){var s;c.addEventListener("message",function(){if(s){var t=s;s=null;for(var n=0,i=t.length;i>n;n++)try{t[n]()}catch(r){e.logError(r)}}},!1),t=function(t){s?s.push(t):(s=[t],c.postMessage("__tic__","*"))}}else t=function(t){setTimeout(t,1)};e.nextTick=t}(),function(){function n(t,e){this.type=t,e===!1&&(this.bubbles=!1)}y(n.prototype,{target:null,type:t,timestamp:t,detail:null,bubbles:!0,propagationStopped:!1,immediatePropagationStopped:!1,stopPropagation:function(){this.propagationStopped=!0},stopImmediatePropagation:function(){this.propagationStopped=!0,this.immediatePropagationStopped=!0}}),e.Event=n}(),function(){function t(){this._events=new n}var n=e.Map,i=e.Event;y(t.prototype,{_events:null,on:function(t,e,n){if("object"==typeof t){n=e;var i=t;for(t in i)this._on(t,i[t],n)}else this._on(t,e,n);return this},off:function(t,e,n){if(t)if("object"==typeof t){n=e;var i=t;for(t in i)this._off(t,i[t],n)}else this._off(t,e,n);else this._events&&this._events.clear();return this},_on:function(t,e,i){var s=(this._events||(this._events=new n)).get(t);s||(s=[],this._events.set(t,s)),s.push({listener:e,context:i||this})},_off:function(t,e,i){var s=this._events||(this._events=new n).get(t);if(s){i||(i=this);for(var r=s.length;r;)if(s[--r].context==i){var o=s[r].listener;if(o==e||o.hasOwnProperty(_)&&o[_]==e){s.splice(r,1);break}}s.length||this._events["delete"](t)}},once:function(t,e,n){function i(){this._off(t,i,n),e.apply(this,arguments)}return i[_]=e,this._on(t,i,n),this},emit:function(t,e){if("string"==typeof t)t=new i(t);else if(t.hasOwnProperty(p))throw new TypeError("Attempt to use an object that is no longer usable");return t[p]=!0,t.target=this,t.timestamp=E(),e&&(t.detail=e),this._handleEvent(t),t},_handleEvent:function(t){var e=t.type,n=(this._events&&this._events.get(e)||[]).slice(0);"function"==typeof this["on"+e]&&n.push({listener:this["on"+e],context:this});for(var i=0,s=n.length;s>i&&!t.immediatePropagationStopped;i++)try{n[i].listener.call(n[i].context,t)===!1&&t.stopPropagation()}catch(r){this._logError(r)}},_logError:function(t){e.logError(t)}}),e.EventEmitter=t}();var x;!function(){var t=e.EventEmitter;x={_valueCounts:null,adoptsItemChanges:!0,_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(e){var n=this._valueCounts,i=n.get(e);i?n.set(e,i+1):(n.set(e,1),this.adoptsItemChanges&&e instanceof t&&e.on("change",this._onItemChange,this))},_unregisterValue:function(e){var n=this._valueCounts,i=n.get(e);i>1?n.set(e,i-1):(n["delete"](e),this.adoptsItemChanges&&e instanceof t&&e.off("change",this._onItemChange,this))},dispose:function(){if(this.adoptsItemChanges){var e=this._onItemChange;this._valueCounts.forEach(function(n){n instanceof t&&n.off("change",e,this)},this)}}}}(),function(){function n(t,e){if(this._entries=new o,this._valueCounts=new o,e&&e.adoptsItemChanges===!1&&(this.adoptsItemChanges=!1),t){var i=this._entries;if(t instanceof n)t._entries.forEach(function(t,e){i.set(e,t),this._registerValue(t)},this);else if(w(t))for(var s=0,r=t.length;r>s;s++){var a=t[s];i.set(a[0],a[1]),this._registerValue(a[1])}else for(var h in t)i.set(h,t[h]),this._registerValue(t[h]);this.size=i.size}}function r(t,e){return new n(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var o=e.Map;s(n,e.EventEmitter),y(n.prototype,x),y(n.prototype,{_entries:null,size:0,has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var n,s=this._entries,r=s.has(t);if(r){if(n=s.get(t),i(n,e))return this;this._unregisterValue(n)}return s.set(t,e),this._registerValue(e),r||this.size++,this.emit("change",{type:r?"update":"add",key:t,oldValue:n,value:e}),this},"delete":function(e){var n=this._entries;if(!n.has(e))return!1;var i=n.get(e);return n["delete"](e),this._unregisterValue(i),this.size--,this.emit("change",{type:"delete",key:e,oldValue:i,value:t}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit("change",{type:"clear"}),this):this},forEach:function(t,e){null==e&&(e=c),this._entries.forEach(function(n,i){t.call(e,n,i,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}}),e.ActiveMap=n,e.map=r}(),function(){function n(t,e){return e>t?-1:t>e?1:0}function r(t,e){var n=t._items;if(t.sorted)for(var i=t.comparator,s=0,r=e.length;r>s;s++){for(var o=e[s],a=0,l=n.length;a!=l;){var u=a+l>>1;i(o,n[u])<0?l=u:a=u+1}n.splice(a,0,o),t._registerValue(o)}else{h.apply(n,e);for(var c=e.length;c;)t._registerValue(e[--c])}t.length=n.length}function o(t,e){e||(e={}),this._items=[],this._valueCounts=new Map,e.adoptsItemChanges===!1&&(this.adoptsItemChanges=!1),(e.sorted||e.comparator&&e.sorted!==!1)&&(this.comparator=e.comparator||n,this.sorted=!0),t&&r(this,t instanceof o?t._items:t)}function a(t,e){return new o(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var l=Array.prototype;s(o,e.EventEmitter),y(o.prototype,x),y(o.prototype,{_items:null,length:0,comparator:null,sorted:!1,_validateIndex:function(e,n){if(e===t)return e;if(0>e){if(e+=this.length,0>e)throw new RangeError("Index out of range")}else if(e>=this.length+(n?1:0))throw new RangeError("Index out of range");return e},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,this._validateIndex(e))},get:function(t){return this._items[this._validateIndex(t)]},getRange:function(e,n){e=this._validateIndex(e||0,!0);var i=this._items;if(n===t)return i.slice(e);if(e+n>i.length)throw new RangeError('"index" and "count" do not denote a valid range');return i.slice(e,e+n)},set:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var n=this._items;return i(n[t],e)?this:(this._unregisterValue(n[t]),n[t]=e,this._registerValue(e),this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var n=e.length;if(!n)return this;if(t+n>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var s=this._items,r=!1,o=t+n;o>t;){var a=e[--o];i(s[o],a)||(this._unregisterValue(s[o]),s[o]=a,this._registerValue(a),r=!0)}return r&&this.emit("change"),this},add:function(t){return this.addRange([t]),this},addRange:function(t){return t.length?(r(this,t),this.emit("change"),this):this},insert:function(t,e){return this.insertRange(t,[e]),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Can't insert to sorted list");t=this._validateIndex(t,!0);var n=e.length;if(!n)return this;u.apply(this._items,[].concat(t,0,e));for(var i=n;i;)this._registerValue(e[--i]);return this.length+=n,this.emit("change"),this},remove:function(t,e){var n=this._items.indexOf(t,this._validateIndex(e));return-1==n?this:(this._items.splice(n,1),this._unregisterValue(t),this.length--,this.emit("change"),this)},removeAll:function(t,e){for(var n=this._items,i=this._validateIndex(e),s=!1;-1!=(i=n.indexOf(t,i));)n.splice(i,1),this._unregisterValue(t),s=!0;return s&&(this.length=n.length,this.emit("change")),this},removeAt:function(t){return this._unregisterValue(this._items.splice(this._validateIndex(t),1)[0]),this.length--,this.emit("change"),this},removeRange:function(e,n){e=this._validateIndex(e||0,!0);var i=this._items;if(n===t)n=i.length-e;else if(e+n>i.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!n)return this;for(var s=e+n;s>e;)this._unregisterValue(i[--s]);return i.splice(e,n),this.length-=n,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice(0)},toString:function(){return this._items.join()}});for(var c=["forEach","map","filter","every","some","reduce","reduceRight"],f=c.length;f;)!function(t){o.prototype[t]=function(){return l[t].apply(this._items,arguments)}}(c[--f]);e.ActiveList=o,e.list=a}(),function(){function n(t,e){if(!e){if(I.has(t))return;I.add(t)}if(V.length){for(var n=t._maxMasterLevel,i=0,s=V.length;i!=s;){var r=i+s>>1;n<V[r]._maxMasterLevel?i=r+1:s=r}V.splice(i,0,t)}else V.push(t)}function r(){S=x;do for(var t,e=C.entries();!(t=e.next()).done;){var i=t.value[0];if(C["delete"](i),i._slaves.forEach(function(t){n(t,!1)}),i._fixedValue=i._value,i._changed=!0,i._handleEvent(t.value[1].event),S!=x)return}while(C.size)}function o(){if((S==w||S==x)&&C.size||S==b){if(r(),S!=x)return}else if(S==w)return;S=b;for(var t;t=V.length;){var e=V[t-1];if(e._recalc())n(V.pop(),!0);else{if(S!=b)return;V.pop(),I["delete"](e)}if(C.size){if(r(),S!=x)return;S=b}}S=w,j.clear(),z++}function a(t,e,n){var i;if(e instanceof f?i=e:(i=new f("change"),i.target=t,i.timestamp=E(),i.detail=e),C.size){if(e=C.get(t))return(i.detail||(i.detail={})).prevEvent=e.event,e.event=i,void(n===!1&&(e.cancellable=!1))}else S==w&&c(o);C.set(t,{event:i,cancellable:n!==!1})}function h(e,n){p.call(this),n||(n={});var i;n.owner&&(i=this.owner=n.owner);var s;"function"==typeof e&&(n.computed!==t?n.computed:e.constructor==Function)&&(s=this._formula=e),n.read&&(this._read=n.read),n.write&&(this._write=n.write),n.validate&&(this._validate=n.validate),this._slaves=new u,n.onchange&&this.on("change",n.onchange,i),n.onerror&&this.on("error",n.onerror,i),s?(this.computed=!0,this._events.size&&this._startUpdating()):(this._value=this._fixedValue=this.initialValue=e,e instanceof p&&e.on("change",this._onValueChange,this)),n.pureComputed&&(this.pureComputed=!0)}var l=e.Map,u=e.Set,c=e.nextTick,f=e.Event,p=e.EventEmitter,v=p.prototype.on,d=p.prototype.off,g=p.prototype._on,m=p.prototype._off,w=0,x=1,b=2,S=w,C=new l,V=[],I=new u,j=new l,z=0,O=[];s(h,p),y(h.prototype,{owner:null,_value:t,_fixedValue:t,initialValue:t,_formula:null,_read:null,_write:null,_validate:null,_masters:null,_slaves:null,_maxMasterLevel:t,_lastErrorEvent:null,_version:t,computed:!1,pureComputed:!1,_changed:!1,changed:function(){return C.size&&o(),this._changed},on:function(t,e,n){return C.size&&o(),!this.computed||this._events.size||this._slaves.size||this._startUpdating(),v.call(this,t,e,n)},off:function(t,e,n){return C.size&&o(),d.call(this,t,e,n),!this.computed||this._events.size||this._slaves.size||this._stopUpdating(),this},_on:function(t,e,n){g.call(this,t,e,n||this.owner)},_off:function(t,e,n){m.call(this,t,e,n||this.owner)},subscribe:function(t){function e(e){t.call(this,"change"==e.type?null:e.detail.error,e)}return e[_]=t,this.on("change",e).on("error",e),this},unsubscribe:function(t){return this.off("change",t).off("error",t),this},_registerSlave:function(t){!this.computed||this._events.size||this._slaves.size||this._startUpdating(),this._slaves.add(t)},_unregisterSlave:function(t){this._slaves["delete"](t),!this.computed||this._events.size||this._slaves.size||this._stopUpdating()},_onValueChange:function(t){a(this,t,this._value!==this._fixedValue)},read:function(){O.length&&O[0].add(this),(S==x||C.size)&&o();var t=this._value;if(this.computed&&this._version!=z&&!this._events.size){try{t=this._value=this._fixedValue=this._formula.call(this.owner||this)}catch(e){this._handleError(e)}this._version=z}return this._read?this.computed?this._read.call(this.owner||this,t):this._read(t):t},write:function(t){var e=this._value;if(i(e,t))return!1;if(this.computed&&!this._write)throw new TypeError("Cannot write to read-only cell");if(this._validate&&this._validate.call(this.owner||this,t),this.computed)this._write.call(this.owner||this,t);else{if(this._value=t,i(t,this._fixedValue)&&C.get(this).cancellable)return C["delete"](this),!0;e instanceof p&&e.off("change",this._onValueChange,this),t instanceof p&&t.on("change",this._onValueChange,this),a(this,{oldValue:e,value:t})}return!0},_startUpdating:function(){O.unshift(new u);try{this._value=this._fixedValue=this._formula.call(this.owner||this)}catch(t){this._handleError(t)}this._masters=O.shift();var e=1;this._masters.forEach(function(t){t._registerSlave(this),e<=t._maxMasterLevel&&(e=t._maxMasterLevel+1)},this),this._maxMasterLevel=e,this._version=z},_stopUpdating:function(){this._masters.forEach(function(t){t._unregisterSlave(this)},this),this._masters=null,this._maxMasterLevel=t},_recalc:function(){var t,e,n=this.pureComputed;if(!n){var s=j.get(this);if(10===s)return this._handleError(new RangeError("Circular dependency detected")),!1;j.set(this,(s||0)+1),O.unshift(new u)}try{if(t=this._formula.call(this.owner||this),S!=b)return n||O.shift(),!1;if(this._validate&&(this._validate(t),S!=b))return n||O.shift(),!1}catch(r){e=r}if(!n){var o=this._masters,h=this._masters=O.shift(),l=0;if(o.forEach(function(t){h.has(t)||(t._unregisterSlave(this),l++)},this),o.size-l<h.size){var c=1;if(h.forEach(function(t){o.has(t)||t._registerSlave(this),c<=t._maxMasterLevel&&(c=t._maxMasterLevel+1)},this),this._maxMasterLevel!=c){if(this._maxMasterLevel<c&&V.length>1&&c>V[V.length-2]._maxMasterLevel)return this._maxMasterLevel=c,!0;this._maxMasterLevel=c}}}if(e)this._handleError(e);else{var f=this._value;i(f,t)||(this._value=t,a(this,{oldValue:f,value:t}))}return this._version=z+1,!1},_handleError:function(t){var e=new f("error");e.target=this,e.timestamp=E(),e.detail={error:t},this._handleErrorEvent(e)},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e,n=this._slaves.values();!(e=n.next()).done&&!t.propagationStopped;)e.value._handleErrorEvent(t)}},dispose:function(){this._slaves.forEach(function(t){t.dispose()}),this.off()}}),e.Cell=h}(),function(){var t=e.Map,n=e.Cell,i=n.prototype;r=function(e,s,r,h,l,u,f){h&&h!=c||(h=e),o.call(h,v)||Object.defineProperty(h,v,{value:new t});var _=h[v].get(e);if(!_){if(s===Object(s))if("function"==typeof s.clone)("function"!=typeof s||s.constructor!=Function)&&(s=s.clone());else if("function"!=typeof s)if(w(s))s=s.slice(0);else switch(a.call(s)){case"[object Date]":s=new Date(s);break;case"[object RegExp]":s=new RegExp(s);break;default:s=y({},s)}r=m(r),r.owner=h,_=new n(s,r),h[v].set(e,_)}switch(f){case 0:return _.read();case 1:return _.write(l);default:return i[l].apply(_,u)}}}()}();