!function(t){"use strict";function e(t,i){function n(t){return s(n,r,i,this,t,l.call(arguments,1),arguments.length)}i||(i={});var r=t;return n.constructor=e,n}function i(t){return-1!=t.toString().indexOf("[native code]")}function n(t,e){return t===e||t!=t&&e!=e}function r(t,e){function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t}var s,a=Object.prototype.hasOwnProperty,o=Object.prototype.toString,h=Array.prototype.push,l=Array.prototype.slice,u=Array.prototype.splice,c=Function("return this;")();"undefined"!=typeof exports?"undefined"!=typeof module?module.exports=e:exports.cellx=e:c.cellx=e;var f="__cellx_uid__",_="__cellx_inner__",v="__cellx_used__",d="__cellx_cells__";c.Symbol&&"symbol"==typeof Symbol.iterator&&(f=Symbol(f),_=Symbol(_),v=Symbol(v),d=Symbol(d)),e.KEY_UID=f,e.KEY_INNER=_,e.KEY_USED=v,e.KEY_CELLS=d;var p,g=0;p=c.console?console.error?function(t){console.error(t===Object(t)&&t.stack||t)}:function(t){console.log("!!! "+(t===Object(t)&&t.stack||t))}:function(){},e.logError=p;var m=Object.create||function(t){function e(){}return e.prototype=t,new e},y=Object.assign||function(t,e){for(var i in e)a.call(e,i)&&(t[i]=e[i]);return t},w=Array.isArray||function(t){return"[object Array]"==o.call(t)},E=Date.now||function(){return+new Date};!function(){var t,n=Object.create;t=n&&i(n)?function(){return n(null)}:function(){var e=document.createElement("iframe"),i=document.body||document.documentElement;e.style.display="none",i.appendChild(e),e.src="javascript:";var n=e.contentWindow.Object.prototype;return i.removeChild(e),e=null,delete n.constructor,delete n.isPrototypeOf,delete n.hasOwnProperty,delete n.propertyIsEnumerable,delete n.valueOf,delete n.toString,delete n.toLocaleString,t=function(){},t.prototype=n,new t},e.Dictionary=t}(),function(){var n=c.Map;if(!n){var r=e.Dictionary,s={value:t};n=function(t){if(this._entries=new r,this._objectStamps={},t)for(var e=0,i=t.length;i>e;e++)this.set(t[e][0],t[e][1])},y(n.prototype,{_entries:null,_objectStamps:null,_first:null,_last:null,size:0,has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||s).value},set:function(t,e){var i=this._entries,n=this._getValueStamp(t);if(i[n])i[n].value=e;else{var r=i[n]={key:t,keyStamp:n,value:e,prev:this._last,next:null};this.size++?this._last.next=r:this._first=r,this._last=r}return this},"delete":function(t){var e=this._getValueStamp(t),i=this._entries[e];if(!i)return!1;if(--this.size){var n=i.prev,r=i.next;n?n.next=r:this._first=r,r?r.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(){function t(t){var e,i=this._objectStamps;for(e in i)if(i[e]==t)return e;return e=String(++g),i[e]=t,e}return Object.defineProperty&&i(Object.defineProperty)&&Object.isExtensible&&i(Object.isExtensible)?function(e){if(!a.call(e,f)){if(!Object.isExtensible(e))return t.call(this,e);Object.defineProperty(e,f,{value:String(++g)})}return e[f]}:t}(),forEach:function(t,e){null==e&&(e=c);for(var i=this._first;i;){t.call(e,i.value,i.key,this);do i=i.next;while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}});for(var o=[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]],h=0,l=o.length;l>h;h++)n.prototype[o[h][0]]=function(e){return function(){var i,n=this._entries,r=!1,s=this;return{next:function(){if(!r){if(i){do i=i.next;while(i&&!n[i.keyStamp])}else i=s._first;if(i)return{value:e(i),done:!1};r=!0}return{value:t,done:!0}}}}}(o[h][1])}e.Map=n}(),function(){var t=c.Set;if(!t){var i=e.Map;t=function(t){if(this._entries=new i,t)for(var e=0,n=t.length;n>e;e++)this.add(t[e])},y(t.prototype,{_entries:null,size:0,has:function(t){return this._entries.has(t)},add:function(t){return this._entries.set(t,t),this.size=this._entries.size,this},"delete":function(t){return this._entries["delete"](t)?(this.size--,!0):!1},clear:function(){this._entries.clear(),this.size=0},forEach:function(t,e){null==e&&(e=c),this._entries.forEach(function(i){t.call(e,i,i,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},toString:function(){return"[object Set]"}})}e.Set=t}(),function(){var t;if(c.process&&"[object process]"==process.toString()&&process.nextTick)t=process.nextTick;else if(c.setImmediate)t=function(t){setImmediate(t)};else if(c.Promise&&i(Promise)){var n=Promise.resolve();t=function(t){n.then(function(){t()})}}else if(c.postMessage&&!c.ActiveXObject){var r;c.addEventListener("message",function(){if(r){var t=r;r=null;for(var i=0,n=t.length;n>i;i++)try{t[i]()}catch(s){e.logError(s)}}},!1),t=function(t){r?r.push(t):(r=[t],c.postMessage("__tic__","*"))}}else t=function(t){setTimeout(t,1)};e.nextTick=t}(),function(){function i(t,e){this.type=t,e===!1&&(this.bubbles=!1)}y(i.prototype,{target:null,type:t,timestamp:t,detail:null,bubbles:!0,isPropagationStopped:!1,isImmediatePropagationStopped:!1,stopPropagation:function(){this.isPropagationStopped=!0},stopImmediatePropagation:function(){this.isPropagationStopped=!0,this.isImmediatePropagationStopped=!0}}),e.Event=i}(),function(){function t(){this._events=new i}var i=e.Map,n=e.Set,r=e.Event;y(t.prototype,{_events:null,on:function(t,e,i){if("object"==typeof t){i=e;var n=t;for(t in n)this._on(t,n[t],i)}else this._on(t,e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t){i=e;var n=t;for(t in n)this._off(t,n[t],i)}else this._off(t,e,i);else this._events&&this._events.clear();return this},_on:function(t,e,r){var s=(this._events||(this._events=new i)).get(t);s?s.add({listener:e,context:r||this}):this._events.set(t,new n([{listener:e,context:r||this}]))},_off:function(t,e,n){var r=this._events||(this._events=new i).get(t);if(r){n||(n=this);for(var s,a=r.values();!(s=a.next()).done;){var o=s.value;if(o.context==n){var h=o.listener;if(h==e||h.hasOwnProperty(_)&&h[_]==e){r["delete"](o);break}}}}},once:function(t,e,i){function n(){this._off(t,n,i),e.apply(this,arguments)}return n[_]=e,this._on(t,n,i),this},emit:function(t,e){if("string"==typeof t)t=new r(t);else if(t.hasOwnProperty(v))throw new TypeError("Attempt to use an object that is no longer usable");return t[v]=!0,t.target=this,t.timestamp=E(),e&&(t.detail=e),this._handleEvent(t),t},_handleEvent:function(t){var e=t.type,i=this._events&&this._events.get(e);if(i)for(var n,r=i.values();!(n=r.next()).done&&!t.isImmediatePropagationStopped;)try{n.value.listener.call(n.value.context,t)===!1&&t.stopPropagation()}catch(s){this._logError(s)}},_logError:function(t){e.logError(t)}}),e.EventEmitter=t}();var x;!function(){var t=e.EventEmitter;x={_valueCounts:null,adoptsItemChanges:!0,_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(e){var i=this._valueCounts,n=i.get(e);n?i.set(e,n+1):(i.set(e,1),this.adoptsItemChanges&&e instanceof t&&e.on("change",this._onItemChange,this))},_unregisterValue:function(e){var i=this._valueCounts,n=i.get(e);n>1?i.set(e,n-1):(i["delete"](e),this.adoptsItemChanges&&e instanceof t&&e.off("change",this._onItemChange,this))},dispose:function(){if(this.adoptsItemChanges){var e=this._onItemChange;this._valueCounts.forEach(function(i){i instanceof t&&i.off("change",e,this)},this)}}}}(),function(){function i(t,e){if(this._entries=new a,this._valueCounts=new a,e&&e.adoptsItemChanges===!1&&(this.adoptsItemChanges=!1),t){var n=this._entries;if(t instanceof i)t._entries.forEach(function(t,e){n.set(e,t),this._registerValue(t)},this);else if(w(t))for(var r=0,s=t.length;s>r;r++){var o=t[r];n.set(o[0],o[1]),this._registerValue(o[1])}else for(var h in t)n.set(h,t[h]),this._registerValue(t[h]);this.size=n.size}}function s(t,e){return new i(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var a=e.Map;r(i,e.EventEmitter),y(i.prototype,x),y(i.prototype,{_entries:null,size:0,has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var i,r=this._entries,s=r.has(t);if(s){if(i=r.get(t),n(i,e))return this;this._unregisterValue(i)}return r.set(t,e),this._registerValue(e),s||this.size++,this.emit("change",{type:s?"update":"add",key:t,oldValue:i,value:e}),this},"delete":function(e){var i=this._entries;if(!i.has(e))return!1;var n=i.get(e);return i["delete"](e),this._unregisterValue(n),this.size--,this.emit("change",{type:"delete",key:e,oldValue:n,value:t}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit("change",{type:"clear"}),this):this},forEach:function(t,e){null==e&&(e=c),this._entries.forEach(function(i,n){t.call(e,i,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}}),e.ActiveMap=i,e.map=s}(),function(){function i(t,e){return e>t?-1:t>e?1:0}function s(t,e){var i=t._items;if(t.sorted)for(var n=t.comparator,r=0,s=e.length;s>r;r++){for(var a=e[r],o=0,l=i.length;o!=l;){var u=o+l>>1;n(a,i[u])<0?l=u:o=u+1}i.splice(o,0,a),t._registerValue(a)}else{h.apply(i,e);for(var c=e.length;c;)t._registerValue(e[--c])}t.length=i.length}function a(t,e){e||(e={}),this._items=[],this._valueCounts=new Map,e.adoptsItemChanges===!1&&(this.adoptsItemChanges=!1),(e.sorted||e.comparator&&e.sorted!==!1)&&(this.comparator=e.comparator||i,this.sorted=!0),t&&s(this,t instanceof a?t._items:t)}function o(t,e){return new a(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var l=Array.prototype;r(a,e.EventEmitter),y(a.prototype,x),y(a.prototype,{_items:null,length:0,comparator:null,sorted:!1,_validateIndex:function(e,i){if(e===t)return e;if(0>e){if(e+=this.length,0>e)throw new RangeError("Index out of range")}else if(e>=this.length+(i?1:0))throw new RangeError("Index out of range");return e},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,this._validateIndex(e))},get:function(t){return this._items[this._validateIndex(t)]},getRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)return n.slice(e);if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');return n.slice(e,e+i)},set:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=this._items;return n(i[t],e)?this:(this._unregisterValue(i[t]),i[t]=e,this._registerValue(e),this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=e.length;if(!i)return this;if(t+i>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var r=this._items,s=!1,a=t+i;a>t;){var o=e[--a];n(r[a],o)||(this._unregisterValue(r[a]),r[a]=o,this._registerValue(o),s=!0)}return s&&this.emit("change"),this},add:function(t){return this.addRange([t]),this},addRange:function(t){return t.length?(s(this,t),this.emit("change"),this):this},insert:function(t,e){return this.insertRange(t,[e]),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Can't insert to sorted list");t=this._validateIndex(t,!0);var i=e.length;if(!i)return this;u.apply(this._items,[].concat(t,0,e));for(var n=i;n;)this._registerValue(e[--n]);return this.length+=i,this.emit("change"),this},remove:function(t,e){var i=this._items.indexOf(t,this._validateIndex(e));return-1==i?this:(this._items.splice(i,1),this._unregisterValue(t),this.length--,this.emit("change"),this)},removeAll:function(t,e){for(var i=this._items,n=this._validateIndex(e),r=!1;-1!=(n=i.indexOf(t,n));)i.splice(n,1),this._unregisterValue(t),r=!0;return r&&(this.length=i.length,this.emit("change")),this},removeAt:function(t){return this._unregisterValue(this._items.splice(this._validateIndex(t),1)[0]),this.length--,this.emit("change"),this},removeRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)i=n.length-e;else if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!i)return this;for(var r=e+i;r>e;)this._unregisterValue(n[--r]);return n.splice(e,i),this.length-=i,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice(0)},toString:function(){return this._items.join()}});for(var c=["forEach","map","filter","every","some","reduce","reduceRight"],f=c.length;f;)!function(t){a.prototype[t]=function(){return l[t].apply(this._items,arguments)}}(c[--f]);e.ActiveList=a,e.list=o}(),function(){function i(t){if(w.length){for(var e=t._maxMasterLevel,i=0,n=w.length;i!=n;){var r=i+n>>1;e<w[r]._maxMasterLevel?i=r+1:n=r}w.splice(i,0,t)}else w.push(t)}function n(){g=d;for(var t,e=m.entries();!(t=e.next()).done;){var n=t.value[0];if(m["delete"](n),n._slaves.forEach(function(t){t._outdated||(i(t),t._outdated=!0)}),x===n)return;var r=x;if(x=n,n._fixedValue=n._value,n._changed=!0,n._handleEvent(t.value[1].event),x=r,g!=d)return}}function s(){if(m.size){if(n(),g!=d)return}else if(g==v)return;for(g=p;w.length;){var t=w[w.length-1];if(t._recalc()?i(w.pop()):(w.pop(),t._outdated=!1),m.size){if(n(),g!=d)return;g=p}}C++,g=v}function a(t,e,i){var n;if(e instanceof c?n=e:(n=new c("change"),n.target=t,n.timestamp=E(),n.detail=e),m.size){if(e=m.get(t))return(n.detail||(n.detail={})).prevEvent=e.event,e.event=n,void(i===!1&&(e.cancellable=!1))}else g==v&&u(s);m.set(t,{event:n,cancellable:i!==!1})}function o(e,i){f.call(this),i||(i={}),i.owner&&(this.owner=i.owner),i.read&&(this._read=i.read),i.write&&(this._write=i.write),i.validate&&(this._validate=i.validate),this._slaves=new l,i.pureComputed&&(this.pureComputed=!0),"function"==typeof e&&(i.computed!==t?i.computed:e.constructor==Function)?(this._formula=e,this.computed=!0):(this._validate&&this._validate.call(this.owner||this,e),this._value=this._fixedValue=this.initialValue=e,e instanceof f&&e.on("change",this._onValueChange,this)),i.onchange&&this.on("change",i.onchange),i.onerror&&this.on("error",i.onerror)}var h=e.Map,l=e.Set,u=e.nextTick,c=e.Event,f=e.EventEmitter,v=0,d=1,p=2,g=v,m=new h,w=[],x=null,b=null,S=null,C=1;r(o,f),y(o.prototype,{owner:null,_value:t,_fixedValue:t,initialValue:t,_formula:null,_read:null,_write:null,_validate:null,_masters:null,_slaves:null,_maxMasterLevel:0,_version:0,_circularityDetectionCounter:0,_lastErrorEvent:null,computed:!1,pureComputed:!1,_active:!1,_outdated:!1,_changed:!1,changed:function(){return m.size&&s(),this._changed},on:function(t,e,i){return m.size&&s(),!this.computed||this._events.size||this._slaves.size||this._activate(),f.prototype.on.call(this,t,e,i),this},off:function(t,e,i){return m.size&&s(),f.prototype.off.call(this,t,e,i),!this.computed||this._events.size||this._slaves.size||this._deactivate(),this},_on:function(t,e,i){f.prototype._on.call(this,t,e,i||this.owner)},_off:function(t,e,i){f.prototype._off.call(this,t,e,i||this.owner)},subscribe:function(t){function e(e){t.call(this,"change"==e.type?null:e.detail.error,e)}return e[_]=t,this.on("change",e).on("error",e),this},unsubscribe:function(t){return this.off("change",t).off("error",t),this},_registerSlave:function(t){!this.computed||this._events.size||this._slaves.size||this._activate(),this._slaves.add(t)},_unregisterSlave:function(t){this._slaves["delete"](t),!this.computed||this._events.size||this._slaves.size||this._deactivate()},_activate:function(){if(this._version!=C){var t=S;S=new l;try{this._value=this._fixedValue=this._formula.call(this.owner||this)}catch(e){this._handleError(e)}this._masters=S,S=t,this._version=C}var i=0;this._masters.forEach(function(t){t._registerSlave(this),i<=t._maxMasterLevel&&(i=t._maxMasterLevel+1)},this),this._maxMasterLevel=i,this._active=!0},_deactivate:function(){this._masters.forEach(function(t){t._unregisterSlave(this)},this),this._maxMasterLevel=t,this._active=!1},_onValueChange:function(t){a(this,t,this._value!==this._fixedValue)},read:function(){S&&S.add(this),(m.size||g==d&&w.length)&&s();var t;if(this.computed&&!this._active&&this._version!=C){var e=S;S=new l;try{t=this._value=this._fixedValue=this._formula.call(this.owner||this)}catch(i){this._handleError(i)}this._masters=S,S=e,this._version=C}else t=this._value;return this._read?this._read.call(this.owner||this,t):t},write:function(t){if(this.computed&&!this._write)throw new TypeError("Cannot write to read-only cell");var e=this._value;return e===t||e!=e&&t!=t?!1:(this._validate&&this._validate.call(this.owner||this,t),this.computed?this._write.call(this.owner||this,t):(this._value=t,e instanceof f&&e.off("change",this._onValueChange,this),t instanceof f&&t.on("change",this._onValueChange,this),(t===this._fixedValue||t!=t&&this._fixedValue!=this._fixedValue)&&m.get(this).cancellable?m["delete"](this):a(this,{oldValue:e,value:t})),!0)},_recalc:function(){var t=this.pureComputed;if(!t)if(this._version==C){if(10==++this._circularityDetectionCounter)return this._handleError(new RangeError("Circular dependency detected")),!1}else this._circularityDetectionCounter=1;if(b===this)return!1;var e=b;b=this;var i;t||(i=S,S=new l);var n,r;try{n=this._formula.call(this.owner||this),this._validate&&this._validate.call(this.owner||this,n)}catch(s){r=s}if(b=e,!t){var o=this._masters,h=this._masters=S;S=i;var u=!1;if(o.forEach(function(t){h.has(t)||(t._unregisterSlave(this),u=!0)},this),u||o.size<h.size){var c=0;if(h.forEach(function(t){o.has(t)||t._registerSlave(this),c<=t._maxMasterLevel&&(c=t._maxMasterLevel+1)},this),this._maxMasterLevel!=c){if(this._maxMasterLevel<c&&w.length>1&&c>w[w.length-2]._maxMasterLevel)return this._maxMasterLevel=c,!0;this._maxMasterLevel=c}}}if(r)this._handleError(r);else{var f=this._value;f===n||f!=f&&n!=n||(this._value=n,a(this,{oldValue:f,value:n}))}return this._version=C+1,!1},_handleError:function(t){var e=new c("error");e.target=this,e.timestamp=E(),e.detail={error:t},this._handleErrorEvent(e)},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e,i=this._slaves.values();!(e=i.next()).done&&!t.isPropagationStopped;)e.value._handleErrorEvent(t)}},clear:function(){return m.size&&s(),this._clear(),this},_clear:function(){this.off(),this._active&&this._slaves.forEach(function(t){t._clear()})}}),e.Cell=o}(),function(){var t=e.Map,i=e.Cell,n=i.prototype;s=function(e,r,s,h,l,u,f){h&&h!=c||(h=e),a.call(h,d)||Object.defineProperty(h,d,{value:new t});var _=h[d].get(e);if(!_){if(null!=r&&"object"==typeof r)if("function"==typeof r.clone)r=r.clone();else if(w(r))r=r.slice(0);else if(r.constructor===Object)r=y({},r);else switch(o.call(r)){case"[object Date]":r=new Date(r);break;case"[object RegExp]":r=new RegExp(r)}s=m(s),s.owner=h,_=new i(r,s),h[d].set(e,_)}switch(f){case 0:return _.read();case 1:return _.write(l);default:return n[l].apply(_,u)}}}()}();