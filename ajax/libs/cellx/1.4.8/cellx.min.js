!function(t){"use strict";function e(t,i){function n(t){return s(n,r,i,this,t,o.call(arguments,1),arguments.length)}i||(i={});var r=t;if(n.constructor=e,i.onchange||i.onerror){if(!i.owner)throw new TypeError("Owner is required");n.call(i.owner)}return n}function i(t,e){for(var i=Object.getOwnPropertyNames(e),n=i.length;n;)Object.defineProperty(t,i[--n],Object.getOwnPropertyDescriptor(e,i[n]));return t}function n(t){var e;t.Extends?(e=t.Extends,delete t.Extends):e=Object;var n;r.call(t,"constructor")?(n=t.constructor,delete t.constructor):n=function(){},t.Static&&(i(n,t.Static),delete t.Static);var s=n.prototype=Object.create(e.prototype);return t.Implements&&(t.Implements.forEach(function(t){i(s,t.prototype)}),delete t.Implements),i(s,t),s.constructor=n,n}var s,r=Object.prototype.hasOwnProperty,a=Object.prototype.toString,h=Array.prototype.push,o=Array.prototype.slice,l=Array.prototype.splice,u=Function("return this;")();e.cellx=e;var c="__cellx_uid__",f="__cellx_cells__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(c=Symbol(c),f=Symbol(f)),e.KEY_CELLS=f;var _,v=0;_=u.console?console.error?function(t){console.error(t===Object(t)&&t.stack||t)}:function(t){console.log("Error: "+(t===Object(t)&&t.stack||t))}:function(){},e._logError=_;var g=Object.is||function(t,e){return 0===t&&0===e?1/t==1/e:t===e||t!=t&&e!=e},d=Array.isArray||function(t){return"[object Array]"==a.call(t)},p=function(){if(u.process&&"[object process]"==process.toString()&&process.nextTick)return process.nextTick;if(u.setImmediate)return function(t){setImmediate(t)};if(u.Promise&&-1!=Promise.toString().indexOf("[native code]")){var t=Promise.resolve();return function(e){t.then(function(){e()})}}if(u.postMessage&&!u.ActiveXObject){var i;return u.addEventListener("message",function(){if(i){var t=i;i=null;for(var n=0,s=t.length;s>n;n++)try{t[n]()}catch(r){e._logError(r)}}},!1),function(t){i?i.push(t):(i=[t],postMessage("__tic__","*"))}}return function(t){setTimeout(t,1)}}();!function(){var i=u.Map;if(!i){var s={value:t};i=n({constructor:function(t){if(this._entries=Object.create(null),this._objectStamps={},this._first=null,this._last=null,this.size=0,t)for(var e=0,i=t.length;i>e;e++)this.set(t[e][0],t[e][1])},has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||s).value},set:function(t,e){var i=this._entries,n=this._getValueStamp(t);if(i[n])i[n].value=e;else{var s=i[n]={key:t,keyStamp:n,value:e,prev:this._last,next:null};this.size++?this._last.next=s:this._first=s,this._last=s}return this},"delete":function(t){var e=this._getValueStamp(t),i=this._entries[e];if(!i)return!1;if(--this.size){var n=i.prev,s=i.next;n?n.next=s:this._first=s,s?s.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(t){if(!r.call(t,c)){if(!Object.isExtensible(t)){var e,i=this._objectStamps;for(e in i)if(i[e]==t)return e;return e=String(++v),i[e]=t,e}Object.defineProperty(t,c,{value:String(++v)})}return t[c]},forEach:function(t,e){null==e&&(e=u);for(var i=this._first;i;){t.call(e,i.value,i.key,this);do i=i.next;while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}}),[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]].forEach(function(e){var n=e[1];i.prototype[e[0]]=function(){var e,i=this._entries,s=!1,r=this;return{next:function(){if(!s){if(e){do e=e.next;while(e&&!i[e.keyStamp])}else e=r._first;if(e)return{value:n(e),done:!1};s=!0}return{value:t,done:!0}}}}})}e.Map=i}(),function(){var t="__cellx_EventEmitter_inner__";u.Symbol&&"symbol"==typeof Symbol.iterator&&(t=Symbol(t));var i=n({Static:{KEY_INNER:t},constructor:function(){this._events=Object.create(null)},on:function(t,e,i){if("object"==typeof t){i=e;var n=t;for(t in n)this._on(t,n[t],i)}else this._on(t,e,i);return this},off:function(t,e,i){if(t)if("object"==typeof t){i=e;var n=t;for(t in n)this._off(t,n[t],i)}else this._off(t,e,i);else this._events&&(this._events=Object.create(null));return this},_on:function(t,e,i){var n=t.indexOf(":");if(-1!=n)this["_"+t.slice(n+1)]("on",t.slice(0,n),e,i);else{var s=(this._events||(this._events=Object.create(null)))[t];s||(s=this._events[t]=[]),s.push({listener:e,context:i||this})}},_off:function(e,i,n){var s=e.indexOf(":");if(-1!=s)this["_"+e.slice(s+1)]("off",e.slice(0,s),i,n);else{var r=this._events&&this._events[e];if(!r)return;n||(n=this);for(var a=r.length;a;){var h=r[--a];if(h.context==n&&(h.listener==i||h.listener[t]===i)){r.splice(a,1);break}}r.length||delete this._events[e]}},once:function(e,i,n){function s(){return this._off(e,s,n),i.apply(this,arguments)}return s[t]=i,this._on(e,s,n),this},emit:function(t){return"string"==typeof t?t={target:this,type:t}:t.target||(t.target=this),this._handleEvent(t),t},_handleEvent:function(t){var e=this._events&&this._events[t.type];if(e){e=e.slice();for(var i=0,n=e.length;n>i;i++)try{e[i].listener.call(e[i].context,t)===!1&&(t.isPropagationStopped=!0)}catch(s){this._logError(s)}}},_logError:function(t){e._logError(t)}});e.EventEmitter=i}();var m;!function(){var t=e.Map,i=e.EventEmitter;m=n({Extends:i,constructor:function(){this._valueCounts=new t},_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(t){var e=this._valueCounts,n=e.get(t);n?e.set(t,n+1):(e.set(t,1),this.adoptsItemChanges&&t instanceof i&&t.on("change",this._onItemChange,this))},_unregisterValue:function(t){var e=this._valueCounts,n=e.get(t);n>1?e.set(t,n-1):(e["delete"](t),this.adoptsItemChanges&&t instanceof i&&t.off("change",this._onItemChange,this))},dispose:function(){this.adoptsItemChanges&&this._valueCounts.forEach(function(t){t instanceof i&&t.off("change",this._onItemChange,this)},this)}})}(),function(){function i(t,e){return new a(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var s=e.Map,r=e.EventEmitter,a=n({Extends:r,Implements:[m],constructor:function(t,e){if(r.call(this),m.call(this),this._entries=new s,this.size=0,this.adoptsItemChanges=!e||e.adoptsItemChanges!==!1,t){var i=this._entries;if(t instanceof a)t._entries.forEach(function(t,e){i.set(e,t),this._registerValue(t)},this);else if(d(t))for(var n=0,h=t.length;h>n;n++){var o=t[n];i.set(o[0],o[1]),this._registerValue(o[1])}else for(var l in t)i.set(l,t[l]),this._registerValue(t[l]);this.size=i.size}},has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var i,n=this._entries,s=n.has(t);if(s){if(i=n.get(t),g(i,e))return this;this._unregisterValue(i)}return n.set(t,e),this._registerValue(e),s||this.size++,this.emit({type:"change",subtype:s?"update":"add",key:t,oldValue:i,value:e}),this},"delete":function(e){var i=this._entries;if(!i.has(e))return!1;var n=i.get(e);return i["delete"](e),this._unregisterValue(n),this.size--,this.emit({type:"change",subtype:"delete",key:e,oldValue:n,value:t}),!0},clear:function(){return this.size?(this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(t,e){null==e&&(e=u),this._entries.forEach(function(i,n){t.call(e,i,n,this)},this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges})}});e.ObservableMap=a,e.map=i}(),function(){function i(t,e){return e>t?-1:t>e?1:0}function s(t,e){var i=t._items;if(t.sorted)for(var n=t.comparator,s=0,r=e.length;r>s;s++){for(var a=e[s],o=0,l=i.length;o!=l;){var u=o+l>>1;n(a,i[u])<0?l=u:o=u+1}i.splice(o,0,a),t._registerValue(a)}else{h.apply(i,e);for(var c=e.length;c;)t._registerValue(e[--c])}t.length=i.length}function r(t,e){return new o(t,"boolean"==typeof e?{adoptsItemChanges:e}:e)}var a=e.EventEmitter,o=n({Extends:a,Implements:[m],constructor:function(t,e){a.call(this),m.call(this),e||(e={}),this._items=[],this.length=0,this.adoptsItemChanges=e.adoptsItemChanges!==!1,this.comparator=null,this.sorted=!1,(e.sorted||e.comparator&&e.sorted!==!1)&&(this.comparator=e.comparator||i,this.sorted=!0),t&&s(this,t instanceof o?t._items:t)},_validateIndex:function(e,i){if(e===t)return e;if(0>e){if(e+=this.length,0>e)throw new RangeError("Index out of range")}else if(e>=this.length+(i?1:0))throw new RangeError("Index out of range");return e},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,this._validateIndex(e))},get:function(t){return this._items[this._validateIndex(t)]},getRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)return n.slice(e);if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');return n.slice(e,e+i)},set:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=this._items;return g(i[t],e)?this:(this._unregisterValue(i[t]),i[t]=e,this._registerValue(e),this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Can't set to sorted list");t=this._validateIndex(t);var i=e.length;if(!i)return this;if(t+i>this.length)throw new RangeError('"index" and length of "items" do not denote a valid range');for(var n=this._items,s=!1,r=t+i;r>t;){var a=e[--r];g(n[r],a)||(this._unregisterValue(n[r]),n[r]=a,this._registerValue(a),s=!0)}return s&&this.emit("change"),this},add:function(t){return this.addRange([t]),this},addRange:function(t){return t.length?(s(this,t),this.emit("change"),this):this},insert:function(t,e){return this.insertRange(t,[e]),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Can't insert to sorted list");t=this._validateIndex(t,!0);var i=e.length;if(!i)return this;l.apply(this._items,[].concat(t,0,e));for(var n=i;n;)this._registerValue(e[--n]);return this.length+=i,this.emit("change"),this},remove:function(t,e){var i=this._items.indexOf(t,this._validateIndex(e));return-1==i?this:(this._items.splice(i,1),this._unregisterValue(t),this.length--,this.emit("change"),this)},removeAll:function(t,e){for(var i=this._items,n=this._validateIndex(e),s=!1;-1!=(n=i.indexOf(t,n));)i.splice(n,1),this._unregisterValue(t),s=!0;return s&&(this.length=i.length,this.emit("change")),this},removeAt:function(t){return this._unregisterValue(this._items.splice(this._validateIndex(t),1)[0]),this.length--,this.emit("change"),this},removeRange:function(e,i){e=this._validateIndex(e||0,!0);var n=this._items;if(i===t)i=n.length-e;else if(e+i>n.length)throw new RangeError('"index" and "count" do not denote a valid range');if(!i)return this;for(var s=e+i;s>e;)this._unregisterValue(n[--s]);return n.splice(e,i),this.length-=i,this.emit("change"),this},clear:function(){return this.length&&(this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit("change")),this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsItemChanges:this.adoptsItemChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});["forEach","map","filter","every","some","reduce","reduceRight"].forEach(function(t){o.prototype[t]=function(){return Array.prototype[t].apply(this._items,arguments)}}),e.ObservableList=o,e.list=r}(),function(){function i(){if(!(l>u)){h=!0;do{var t=o[l];if(t){var e=t.shift();if(l){var i=l;e._active&&e._recalc(),o[i].length||(o[i]=null,l&&l++)}else{var n=e._changeEvent;e._fixedValue=e._value,e._changeEvent=null,e._changed=!0,e._events.change&&e._handleEvent(n);for(var s=e._slaves,r=0,a=s.length;a>r;r++){var c=s[r];c._fixed&&((o[1]||(o[1]=[])).push(c),u||(u=1),c._fixed=!1)}o[0].length||l++}}else l++}while(u>=l);u=-1,f++,h=!1}}var s=e.EventEmitter,r=s.KEY_INNER,a={original:null},h=!1,o=[[]],l=0,u=-1,c=null,f=1,_=n({Extends:s,constructor:function(e,i){s.call(this),i||(i={}),this.owner=i.owner||null,this.computed="function"==typeof e&&(i.computed!==t?i.computed:e.constructor==Function),this._value=t,this._fixedValue=t,this.initialValue=t,this._formula=null,this._get=i.get||null,this._set=i.set||null,this._validate=i.validate||null,this._masters=null,this._slaves=[],this._level=0,this._active=!this.computed,this._changeEvent=null,this._isChangeCancellable=!0,this._lastErrorEvent=null,this._fixed=!0,this._version=0,this._changed=!1,this._circularityCounter=0,this.computed?this._formula=e:(this._validate&&this._validate.call(this.owner||this,e),this._value=this._fixedValue=this.initialValue=e,e instanceof s&&e.on("change",this._onValueChange,this)),i.onchange&&this.on("change",i.onchange),i.onerror&&this.on("error",i.onerror)},get changed(){return h||i(),this._changed},on:function(t,e,n){return h||i(),!this.computed||this._events.change||this._slaves.length||this._activate(),s.prototype.on.call(this,t,e,n),this},off:function(t,e,n){return h||i(),s.prototype.off.call(this,t,e,n),!this.computed||this._events.change||this._slaves.length||this._deactivate(),this},_on:function(t,e,i){s.prototype._on.call(this,t,e,i||this.owner)},_off:function(t,e,i){s.prototype._off.call(this,t,e,i||this.owner)},subscribe:function(t){function e(e){return t.call(this,e.error||null,e)}return e[r]=t,this.on("change",e).on("error",e),this},unsubscribe:function(t){return this.off("change",t).off("error",t),this},_registerSlave:function(t){!this.computed||this._events.change||this._slaves.length||this._activate(),this._slaves.push(t)},_unregisterSlave:function(t){this._slaves.splice(this._slaves.indexOf(t),1),!this.computed||this._events.change||this._slaves.length||this._deactivate()},_activate:function(){if(this._version!=f){this._masters=null,this._level=0;var t=this._tryFormula();t===a?this._handleError(a.original):g(this._value,t)||(this._value=t,this._changed=!0),this._version=f}for(var e=this._masters||[],i=e.length;i;)e[--i]._registerSlave(this);this._active=!0},_deactivate:function(){for(var t=this._masters||[],e=t.length;e;)t[--e]._unregisterSlave(this);this._active=!1},_onValueChange:function(t){this._changeEvent?(t.prev=this._changeEvent,this._changeEvent=t,this._value===this._fixedValue&&(this._isChangeCancellable=!1)):(o[0].push(this),l=0,-1==u&&(u=0),t.prev=null,this._changeEvent=t,this._isChangeCancellable=!1,h||p(i))},get:function(){if(h||i(),this.computed&&!this._active&&this._version!=f){this._masters=null,this._level=0;var t=this._tryFormula();t===a?this._handleError(a.original):g(this._value,t)||(this._value=t,this._changed=!0),this._version=f}return c&&(c._masters?-1==c._masters.indexOf(this)&&(c._masters.push(this),c._level<=this._level&&(c._level=this._level+1)):(c._masters=[this],c._level=this._level+1)),this._get?this._get.call(this.owner||this,this._value):this._value},set:function(t){if(this.computed&&!this._set)throw new TypeError((this.debugKey?"["+this.debugKey+"] ":"")+"Cannot write to read-only cell");var e=this._value;return g(e,t)?!1:(this._validate&&this._validate.call(this.owner||this,t),this.computed?this._set.call(this.owner||this,t):(this._value=t,e instanceof s&&e.off("change",this._onValueChange,this),t instanceof s&&t.on("change",this._onValueChange,this),this._changeEvent?g(t,this._fixedValue)&&this._isChangeCancellable?(1==o[0].length?(o[0].pop(),u||(u=-1)):o[0].splice(o[0].indexOf(this),1),this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:e,value:t,prev:this._changeEvent}:(o[0].push(this),l=0,-1==u&&(u=0),this._changeEvent={target:this,type:"change",oldValue:e,value:t,prev:null},this._isChangeCancellable=!0,h||p(i))),!0)},recalc:function(){return this._recalc(!0)},_recalc:function(t){if(!t)if(this._version==f+1){if(10==++this._circularityCounter)return this._fixed=!0,this._version=f+1,this._handleError(new RangeError("Circular dependency detected")),!1}else this._circularityCounter=1;var e=this._masters;this._masters=null;var n=this._level;this._level=0;for(var r=this._tryFormula(),h=this._masters||[],l=!1,c=e.length;c;){var _=e[--c];-1==h.indexOf(_)&&(_._unregisterSlave(this),l=!0)}if(l||e.length<h.length){for(var v=h.length;v;){var d=h[--v];-1==e.indexOf(d)&&d._registerSlave(this)}var m=this._level;if(m>n)return(o[m]||(o[m]=[])).push(this),m>u&&(u=m),void(t&&p(i))}if(this._fixed=!0,this._version=f+1,r===a)this._handleError(a.original);else{var y=this._value;if(!g(y,r)||r instanceof s){this._value=r,this._changed=!0,this._events.change&&this.emit({type:"change",oldValue:y,value:r,prev:null});for(var E=this._slaves,b=0,x=E.length;x>b;b++){var w=E[b];if(w._fixed){var C=w._level;(o[C]||(o[C]=[])).push(w),C>u&&(u=C),w._fixed=!1}}return!0}}return!1},_tryFormula:function(){var t=c;c=this;try{var e=this._formula.call(this.owner||this);return this._validate&&this._validate.call(this.owner||this,e),e}catch(i){return a.original=i,a}finally{c=t}},_handleError:function(t){this._logError(t),this._handleErrorEvent({type:"error",error:t})},_logError:function(t){e._logError((this.debugKey?"["+this.debugKey+"] ":"")+t.stack)},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e=this._slaves,i=0,n=e.length;n>i&&!t.isPropagationStopped;i++)e[i]._handleErrorEvent(t)}},dispose:function(){return h||i(),this._dispose(),this},_dispose:function(){if(this.off(),this._active)for(var t=this._slaves,e=0,i=t.length;i>e;e++)t[e]._dispose()}});e.Cell=_}(),function(){var t=e.Map,i=e.Cell,n=i.prototype;s=function(s,a,h,o,l,c,_){o&&o!=u||(o=s),r.call(o,f)||Object.defineProperty(o,f,{value:new t});var v=o[f].get(s);if(!v){if(_>=2&&"dispose"===l)return;h.cloneValue&&(a=h.cloneValue(a)),h=Object.create(h),h.owner=o,v=new i(a,h),o[f].set(s,v)}switch(_){case 0:return v.get();case 1:return v.set(l);default:switch(l){case"bind":return s=s.bind(o),s.constructor=e,s;case"unwrap":return v;default:return n[l].apply(v,c)}}}}(),function(){function t(i,n,s,r){if(1==arguments.length)return r=i,function(e,i,n){return t(e,i,n,r)};r||(r={}),r.computed=!1;var a="_"+n;return i[a]=e(s.initializer.call(i),r),{configurable:s.configurable,enumerable:s.enumerable,get:function(){return this[a]()},set:function(t){this[a](t)}}}function i(t,n,s,r){if(1==arguments.length)return r=t,function(t,e,n){return i(t,e,n,r)};var a=s.initializer();if("function"!=typeof a)throw new TypeError("Property value must be a function");r||(r={}),r.computed=!0;var h="_"+n;t[h]=e(a,r);var o={configurable:s.configurable,enumerable:s.enumerable,get:function(){return this[h]()}};return r.set&&(o.set=function(t){this[h](t)}),o}e.d={observable:t,computed:i}}(),e.utils={logError:_,mixin:i,createClass:n,nextTick:p},"object"==typeof exports?"object"==typeof module?module.exports=e:exports.cellx=e:u.cellx=e}();