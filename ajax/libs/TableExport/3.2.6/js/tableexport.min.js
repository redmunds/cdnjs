/*!
 * TableExport.js v4.0.0-beta (http://www.clarketravis.com)
 * Copyright 2016 Travis Clarke
 * Licensed under the MIT license
 */
!function(t,e){"function"==typeof define&&define.amd?define(["jquery","file-saver","xlsx"],e):"object"==typeof exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n,require("file-saver"),require("xlsx"))}:t.TableExport=e(t.jQuery,t.saveAs,t.XLSX)}(this,function(t,e,n){"use strict";var o=function(e,n,i){var r=this;r.settings=i?n:t.extend({},o.prototype.defaults,n),r.selectors=e;var s,a,p,f=o.prototype.rowDel,l=r.settings.ignoreRows instanceof Array?r.settings.ignoreRows:[r.settings.ignoreRows],u=r.settings.ignoreCols instanceof Array?r.settings.ignoreCols:[r.settings.ignoreCols],c=r.settings.ignoreCSS instanceof Array?r.settings.ignoreCSS.join(", "):r.settings.ignoreCSS;return r.settings.bootstrap?(s=o.prototype.bootstrap[0]+" ",a=o.prototype.bootstrap[1]+" ",p=o.prototype.bootstrap[2]+" "):(s=o.prototype.defaultButton+" ",a=p=""),r.selectors.each(function(){function e(t){var e=x.find("caption:not(.head)");e.length?e.append(t):x.prepend('<caption class="'+p+r.settings.position+'">'+t+"</caption>")}function n(t,n,o){var i="<button data-fileblob='"+t+"' class='"+s+a+o+"'>"+n+"</button>";e(i)}var x=t(this);i&&x.find("caption:not(.head)").remove();var d=x.find("tbody").find("tr"),d=r.settings.headings?d.add(x.find("thead>tr")):d,d=r.settings.footers?d.add(x.find("tfoot>tr")):d,y=r.settings.headings?x.find("thead>tr").length:0,m="id"===r.settings.fileName?x.attr("id")?x.attr("id"):o.prototype.defaultFileName:r.settings.fileName,g={xlsx:function(e,i){var r=d.map(function(e,n){if(!~l.indexOf(e-y)&&!t(n).is(c)){var o=t(n).find("th, td");return[o.map(function(e,n){if(!~u.indexOf(e)&&!t(n).is(c))return t(n).text()}).get()]}}).get(),s=o.prototype.escapeHtml(JSON.stringify({data:r,fileName:i,mimeType:o.prototype.xlsx.mimeType,fileExtension:o.prototype.xlsx.fileExtension})),a=o.prototype.xlsx.buttonContent,p=o.prototype.xlsx.defaultClass;n(s,a,p)},xls:function(e,i){var r=o.prototype.xls.separator,s=d.map(function(e,n){if(!~l.indexOf(e-y)&&!t(n).is(c)){var o=t(n).find("th, td");return o.map(function(e,n){if(!~u.indexOf(e)&&!t(n).is(c))return t(n).text()}).get().join(r)}}).get().join(e),a=o.prototype.escapeHtml(JSON.stringify({data:s,fileName:i,mimeType:o.prototype.xls.mimeType,fileExtension:o.prototype.xls.fileExtension})),p=o.prototype.xls.buttonContent,f=o.prototype.xls.defaultClass;n(a,p,f)},csv:function(e,i){var r=o.prototype.csv.separator,s=d.map(function(e,n){if(!~l.indexOf(e-y)&&!t(n).is(c)){var o=t(n).find("th, td");return o.map(function(e,n){if(!~u.indexOf(e)&&!t(n).is(c))return t(n).text()}).get().join(r)}}).get().join(e),a=o.prototype.escapeHtml(JSON.stringify({data:s,fileName:i,mimeType:o.prototype.csv.mimeType,fileExtension:o.prototype.csv.fileExtension})),p=o.prototype.csv.buttonContent,f=o.prototype.csv.defaultClass;n(a,p,f)},txt:function(e,i){var r=o.prototype.txt.separator,s=d.map(function(e,n){if(!~l.indexOf(e-y)&&!t(n).is(c)){var o=t(n).find("th, td");return o.map(function(e,n){if(!~u.indexOf(e)&&!t(n).is(c))return t(n).text()}).get().join(r)}}).get().join(e),a=o.prototype.escapeHtml(JSON.stringify({data:s,fileName:i,mimeType:o.prototype.txt.mimeType,fileExtension:o.prototype.txt.fileExtension})),p=o.prototype.txt.buttonContent,f=o.prototype.txt.defaultClass;n(a,p,f)}};r.settings.formats.forEach(function(t){g[t](f,m)})}),t("button[data-fileblob]").off("click").on("click",function(){var e=t(this).data("fileblob"),n=e.data,i=e.fileName,r=e.mimeType,s=e.fileExtension;o.prototype.export2file(n,r,i,s)}),r};o.prototype={defaults:{headings:!0,footers:!0,formats:["xls","csv","txt"],fileName:"id",bootstrap:!0,position:"bottom",ignoreRows:null,ignoreCols:null,ignoreCSS:".tableexport-ignore"},charset:"charset=utf-8",defaultFileName:"myDownload",defaultButton:"button-default",bootstrap:["btn","btn-default","btn-toolbar"],rowDel:"\r\n",entityMap:{"&":"&#38;","<":"&#60;",">":"&#62;","'":"&#39;","/":"&#47"},xlsx:{defaultClass:"xlsx",buttonContent:"Export to xlsx",mimeType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",fileExtension:".xlsx"},xls:{defaultClass:"xls",buttonContent:"Export to xls",separator:"\t",mimeType:"application/vnd.ms-excel",fileExtension:".xls"},csv:{defaultClass:"csv",buttonContent:"Export to csv",separator:",",mimeType:"application/csv",fileExtension:".csv"},txt:{defaultClass:"txt",buttonContent:"Export to txt",separator:"  ",mimeType:"text/plain",fileExtension:".txt"},escapeHtml:function(t){return String(t).replace(/[&<>'\/]/g,function(t){return o.prototype.entityMap[t]})},dateNum:function(t,e){e&&(t+=1462);var n=Date.parse(t);return(n-new Date(Date.UTC(1899,11,30)))/864e5},createSheet:function(t){for(var e={},o={s:{c:1e7,r:1e7},e:{c:0,r:0}},i=0;i!=t.length;++i)for(var r=0;r!=t[i].length;++r){o.s.r>i&&(o.s.r=i),o.s.c>r&&(o.s.c=r),o.e.r<i&&(o.e.r=i),o.e.c<r&&(o.e.c=r);var s={v:t[i][r]};if(null!=s.v){var a=n.utils.encode_cell({c:r,r:i});"number"==typeof s.v?s.t="n":"boolean"==typeof s.v?s.t="b":s.v instanceof Date?(s.t="n",s.z=n.SSF._table[14],s.v=this.dateNum(s.v)):s.t="s",e[a]=s}}return o.s.c<1e7&&(e["!ref"]=n.utils.encode_range(o)),e},Workbook:function(){this.SheetNames=[],this.Sheets={}},string2ArrayBuffer:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0;o!=t.length;++o)n[o]=255&t.charCodeAt(o);return e},export2file:function(t,o,i,r){if(".xlsx"===r){var s=new this.Workbook,a=this.createSheet(t);s.SheetNames.push(i),s.Sheets[i]=a;var p={bookType:"xlsx",bookSST:!1,type:"binary"},f=n.write(s,p);t=this.string2ArrayBuffer(f)}e(new Blob([t],{type:o+";"+this.charset}),i+r)},update:function(e){return new o(this.selectors,t.extend({},this.settings,e),(!0))},reset:function(){return new o(this.selectors,settings,(!0))},remove:function(){this.selectors.each(function(){t(this).find("caption:not(.head)").remove()})}},t.fn.tableExport=function(t,e){return new o(this,t,e)};for(var i in o.prototype)t.fn.tableExport[i]=o.prototype[i];return o});