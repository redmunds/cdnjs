!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.reglInit=e()}}(function(){return function e(t,n,r){function i(o,f){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!f&&u)return u(o,!0);if(a)return a(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=i,this.offset=0,this.stride=0,this.divisor=0}var i=5126;t.exports=function(e,t,n,i,a){for(var o=n.maxAttributes,f=new Array(o),u=0;u<o;++u)f[u]=new r;return{Record:r,scope:{},state:f}}},{}],2:[function(e,t,n){function r(e){return 0|p[Object.prototype.toString.call(e)]}function i(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function a(e,t,n,r,i,a,o){for(var f=0,u=0;u<n;++u)for(var s=0;s<r;++s)e[f++]=t[i*u+a*s+o]}function o(e,t,n){for(var r=0,i=0;i<t.length;++i)for(var a=t[i],o=0;o<n;++o)e[r++]=a[o]}var f=e("./util/check"),u=e("./util/is-typed-array"),s=e("./util/is-ndarray"),c=e("./util/values"),l=e("./util/pool"),p=e("./constants/arraytypes.json"),d=e("./constants/dtypes.json"),m=e("./constants/usage.json"),h=35044,b=35040,g=5121,v=5126,y=[];y[5120]=1,y[5122]=2,y[5124]=4,y[5121]=1,y[5123]=2,y[5125]=4,y[5126]=4,t.exports=function(e,t,n){function p(t){this.id=E++,this.buffer=e.createBuffer(),this.type=t,this.usage=h,this.byteLength=0,this.dimension=1,this.dtype=g,n.profile&&(this.stats={size:0})}function x(e,t){var n=S.pop();return n||(n=new p(e)),n.bind(),A(n,t,b,0,1),n}function w(e){S.push(e)}function k(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function A(e,t,n,c,p){if(e.usage=n,Array.isArray(t)){if(e.dtype=c||v,t.length>0){var d;if(Array.isArray(t[0]))e.dimension=t[0].length,d=l.allocType(e.dtype,t.length*e.dimension),o(d,t,e.dimension),k(e,d,n),l.freeType(d);else if("number"==typeof t[0]){e.dimension=p;var m=l.allocType(e.dtype,t.length);i(m,t),k(e,m,n),l.freeType(m)}else u(t[0])?(e.dimension=t[0].length,e.dtype=c||r(t[0])||v,d=l.allocType(e.dtype,t.length*e.dimension),o(d,t,e.dimension),k(e,d,n),l.freeType(d)):f.raise("invalid buffer data")}}else if(u(t))e.dtype=c||r(t),e.dimension=p,k(e,t,n);else if(s(t)){var h=t.shape,b=t.stride,g=t.offset,y=0,x=0,w=0,A=0;1===h.length?(y=h[0],x=1,w=b[0],A=0):2===h.length?(y=h[0],x=h[1],w=b[0],A=b[1]):f.raise("invalid shape"),e.dtype=c||r(t.data)||v,e.dimension=x;var _=l.allocType(e.dtype,y*x);a(_,t.data,y,x,w,A,g),k(e,_,n),l.freeType(_)}else f.raise("invalid buffer data")}function _(n){t.bufferCount--;var r=n.buffer;f(r,"buffer must not be deleted already"),e.deleteBuffer(r),n.buffer=null,delete j[n.id]}function T(c,b,v){function x(t){var r=h,i=null,a=0,o=0,c=1;return Array.isArray(t)||u(t)||s(t)?i=t:"number"==typeof t?a=0|t:t&&(f.type(t,"object","buffer arguments must be an object, a number or an array"),"data"in t&&(f(null===i||Array.isArray(i)||u(i)||s(i),"invalid data for buffer"),i=t.data),"usage"in t&&(f.parameter(t.usage,m,"invalid buffer usage"),r=m[t.usage]),"type"in t&&(f.parameter(t.type,d,"invalid buffer type"),o=d[t.type]),"dimension"in t&&(f.type(t.dimension,"number","invalid dimension"),c=0|t.dimension),"length"in t&&(f.nni(a,"buffer length must be a nonnegative integer"),a=0|t.length)),T.bind(),i?A(T,i,r,o,c):(e.bufferData(T.type,a,r),T.dtype=o||g,T.usage=r,T.dimension=c,T.byteLength=a),n.profile&&(T.stats.size=T.byteLength*y[T.dtype]),x}function w(t,n){f(n+t.byteLength<=T.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+T.byteLength),e.bufferSubData(T.type,n,t)}function k(e,t){var n=0|(t||0);if(T.bind(),Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var c=l.allocType(T.dtype,e.length);i(c,e),w(c,n),l.freeType(c)}else if(Array.isArray(e[0])||u(e[0])){var p=e[0].length,d=l.allocType(T.dtype,e.length*p);o(d,e,p),w(d,n),l.freeType(d)}else f.raise("invalid buffer data")}else if(u(e))w(e,n);else if(s(e)){var m=e.shape,h=e.stride,b=0,g=0,v=0,y=0;1===m.length?(b=m[0],g=1,v=h[0],y=0):2===m.length?(b=m[0],g=m[1],v=h[0],y=h[1]):f.raise("invalid shape");var k=Array.isArray(e.data)?T.dtype:r(e.data),A=l.allocType(k,b*g);a(A,e.data,b,g,v,y,e.offset),w(A,n),l.freeType(A)}else f.raise("invalid data for buffer subdata");return x}t.bufferCount++;var T=new p(b);return j[T.id]=T,v||x(c),x._reglType="buffer",x._buffer=T,x.subdata=k,n.profile&&(x.stats=T.stats),x.destroy=function(){_(T)},x}var E=0,j={};p.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},p.prototype.destroy=function(){_(this)};var S=[];return n.profile&&(t.getTotalBufferSize=function(){var e=0;return Object.keys(j).forEach(function(t){e+=j[t].stats.size}),e}),{create:T,createStream:x,destroyStream:w,clear:function(){c(j).forEach(_),S.forEach(_)},getBuffer:function(e){return e&&e._buffer instanceof p?e._buffer:null},_initBuffer:A}}},{"./constants/arraytypes.json":3,"./constants/dtypes.json":4,"./constants/usage.json":6,"./util/check":20,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],3:[function(e,t,n){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],4:[function(e,t,n){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126}},{}],5:[function(e,t,n){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],6:[function(e,t,n){t.exports={static:35044,dynamic:35048,stream:35040}},{}],7:[function(e,t,n){function r(e){return Array.isArray(e)||p(e)||d(e)}function i(e){return e.sort(function(e,t){return e===Z?-1:t===Z?1:e<t?-1:1})}function a(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function o(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function f(e){return new a(!1,!1,!1,e)}function u(e,t){var n=e.type;if(n===k){var r=e.data.length;return new a(!0,r>=1,r>=2,t)}if(n===E){var i=e.data;return new a(i.thisDep,i.contextDep,i.propDep,t)}return new a(n===T,n===_,n===A,t)}var s=e("./util/check"),c=e("./util/codegen"),l=e("./util/loop"),p=e("./util/is-typed-array"),d=e("./util/is-ndarray"),m=e("./util/is-array-like"),h=e("./dynamic"),b=e("./constants/primitives.json"),g=e("./constants/dtypes.json"),v="xyzw".split(""),y=5121,x=1,w=2,k=0,A=1,_=2,T=3,E=4,j="dither",S="blend.enable",D="blend.color",C="blend.equation",O="blend.func",F="depth.enable",z="depth.func",P="depth.range",B="depth.mask",M="colorMask",L="cull.enable",R="cull.face",I="frontFace",H="lineWidth",W="polygonOffset.enable",U="polygonOffset.offset",N="sample.alpha",q="sample.enable",Q="sample.coverage",G="stencil.enable",V="stencil.mask",Y="stencil.func",X="stencil.opFront",$="stencil.opBack",K="scissor.enable",J="scissor.box",Z="viewport",ee="profile",te="framebuffer",ne="vert",re="frag",ie="elements",ae="primitive",oe="count",fe="offset",ue="instances",se="Width",ce="Height",le=te+se,pe=te+ce,de=Z+se,me=Z+ce,he="drawingBuffer",be=he+se,ge=he+ce,ve=[O,C,Y,X,$,Q,Z,J,U],ye=34962,xe=34963,we=35632,ke=35633,Ae=3553,_e=34067,Te=2884,Ee=3042,je=3024,Se=2960,De=2929,Ce=3089,Oe=32823,Fe=32926,ze=32928,Pe=5126,Be=35664,Me=35665,Le=35666,Re=5124,Ie=35667,He=35668,We=35669,Ue=35670,Ne=35671,qe=35672,Qe=35673,Ge=35674,Ve=35675,Ye=35676,Xe=35678,$e=35680,Ke=4,Je=1028,Ze=1029,et=2304,tt=2305,nt=32775,rt=32776,it=519,at=7680,ot=0,ft=1,ut=32774,st=513,ct=36160,lt=36064,pt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},dt={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},mt={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ht={frag:we,vert:ke},bt={cw:et,ccw:tt},gt=new a(!1,!1,!1,function(){});t.exports=function(e,t,n,p,d,se,ce,he,we,ke,vt,yt,xt,wt,kt){function At(e){return e.replace(".","_")}function _t(e,t,n){var r=At(e);cn.push(e),sn[r]=un[r]=!!n,ln[r]=t}function Tt(e,t,n){var r=At(e);cn.push(e),Array.isArray(n)?(un[r]=n.slice(),sn[r]=n.slice()):un[r]=sn[r]=n,pn[r]=t}function Et(){var e=c(),n=e.link,r=e.global;e.id=hn++,e.batchId="0";var i=n(dn),a=e.shared={props:"a0"};Object.keys(dn).forEach(function(e){a[e]=r.def(i,".",e)}),s.optional(function(){e.CHECK=n(s),e.commandStr=s.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")}});var o=e.next={},f=e.current={};Object.keys(pn).forEach(function(e){Array.isArray(un[e])&&(o[e]=r.def(a.next,".",e),f[e]=r.def(a.current,".",e))});var u=e.constants={};Object.keys(mn).forEach(function(e){u[e]=r.def(JSON.stringify(mn[e]))}),e.invoke=function(t,r){switch(r.type){case k:var i=["this",a.context,a.props,e.batchId];return t.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case A:return t.def(a.props,r.data);case _:return t.def(a.context,r.data);case T:return t.def("this",r.data);case E:return r.data.append(e,t),r.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in l)return l[r];var i=ke.scope[r];i||(i=ke.scope[r]=new rn);var a=l[r]=n(i);return a},e}function jt(e){var t,n=e.static,r=e.dynamic;if(ee in n){var i=!!n[ee];t=f(function(e,t){return i}),t.enable=i}else if(ee in r){var a=r[ee];t=u(a,function(e,t){return e.invoke(t,a)})}return t}function St(e){var t=e.static,n=e.dynamic;if(te in t){var r=t[te];return r?(r=he.getFramebuffer(r),s.command(r,"invalid framebuffer object"),f(function(e,t){var n=e.link(r),i=e.shared;t.set(i.framebuffer,".next",n);var a=i.context;return t.set(a,"."+le,n+".width"),t.set(a,"."+pe,n+".height"),n})):f(function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+le,r+"."+be),t.set(r,"."+pe,r+"."+ge),"null"})}if(te in n){var i=n[te];return u(i,function(e,t){var n=e.invoke(t,i),r=e.shared,a=r.framebuffer,o=t.def(a,".getFramebuffer(",n,")");s.optional(function(){e.assert(t,"!"+n+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var f=r.context;return t.set(f,"."+le,o+"?"+o+".width:"+f+"."+be),t.set(f,"."+pe,o+"?"+o+".height:"+f+"."+ge),o})}return null}function Dt(e,t){function n(e){if(e in r){var n=r[e];s.commandType(n,"object","invalid "+e);var o=!0,f=0|n.x,c=0|n.y;s.command(f>=0&&c>=0,"invalid "+e);var l,p;return"width"in n?(l=0|n.width,s.command(l>0,"invalid "+e)):o=!1,"height"in n?(p=0|n.height,s.command(p>0,"invalid "+e)):o=!1,new a(!o&&t&&t.thisDep,!o&&t&&t.contextDep,!o&&t&&t.propDep,function(t,r){var i=t.shared.context,a=l;"width"in n?s.command(l>0,"invalid "+e):a=r.def(i,".",le,"-",f);var o=p;return"height"in n?s.command(p>0,"invalid "+e):o=r.def(i,".",pe,"-",c),[f,c,a,o]})}if(e in i){var d=i[e],m=u(d,function(t,n){var r=t.invoke(n,d);s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=t.shared.context,a=n.def(r,".x|0"),o=n.def(r,".y|0"),f=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",le,"-",a,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",pe,"-",o,")");return s.optional(function(){t.assert(n,a+">=0&&"+o+">=0&&"+f+">0&&"+u+">0","invalid "+e)}),[a,o,f,u]});return t&&(m.thisDep=m.thisDep||t.thisDep,m.contextDep=m.contextDep||t.contextDep,m.propDep=m.propDep||t.propDep),m}return t?new a(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",le),t.def(n,".",pe)]}):null}var r=e.static,i=e.dynamic,o=n(Z);if(o){var f=o;o=new a(o.thisDep,o.contextDep,o.propDep,function(e,t){var n=f.append(e,t),r=e.shared.context;return t.set(r,"."+de,n[2]),t.set(r,"."+me,n[3]),n})}return{viewport:o,scissor_box:n(J)}}function Ct(e){function n(e){if(e in i){var n=t.id(i[e]);s.optional(function(){vt.shader(ht[e],n)});var r=f(function(){return n});return r.id=n,r}if(e in c){var a=c[e];return u(a,function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return s.optional(function(){n(t.shared.shader,".shader(",ht[e],",",i,",",t.command,");")}),i})}return null}var r,i=e.static,c=e.dynamic,l=n(re),p=n(ne),d=null;return o(l)&&o(p)?(d=vt.program(p.id,l.id),r=f(function(e,t){return e.link(d)})):r=new a(l&&l.thisDep||p&&p.thisDep,l&&l.contextDep||p&&p.contextDep,l&&l.propDep||p&&p.propDep,function(e,t){var n,r=e.shared.shader;n=l?l.append(e,t):t.def(r,".",re);var i;i=p?p.append(e,t):t.def(r,".",ne);var a=r+".program("+i+","+n;return s.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:l,vert:p,progVar:r,program:d}}function Ot(e){function t(){if(ie in l){var e=l[ie];r(e)?e=se.getElements(se.create(e)):e&&(e=se.getElements(e),s.command(e,"invalid elements"));var t=f(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return t.value=e,t}if(ie in p){var n=p[ie];return u(n,function(e,t){var r=e.shared,i=r.isBufferArgs,a=r.elements,o=e.invoke(t,n),f=t.def("null"),u=t.def(i,"(",o,")"),c=e.cond(u).then(f,"=",a,".createStream(",o,");").else(f,"=",a,".getElements(",o,");");return s.optional(function(){e.assert(c.else,"!"+o+"||"+f,"invalid elements")}),t.entry(c),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f})}return null}function n(){if(ae in l){var e=l[ae];return s.commandParameter(e,b,"invalid primitve"),f(function(t,n){return b[e]})}if(ae in p){var t=p[ae];return u(t,function(e,n){var r=e.constants.primTypes,i=e.invoke(n,t);return s.optional(function(){e.assert(n,i+" in "+r,"invalid primitive, must be one of "+Object.keys(b))}),n.def(r,"[",i,"]")})}return d?o(d)?f(d.value?function(e,t){return t.def(e.ELEMENTS,".primType")}:function(){return Ke}):new a(d.thisDep,d.contextDep,d.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Ke)}):null}function i(e,t){if(e in l){var n=0|l[e];return s.command(!t||n>=0,"invalid "+e),f(function(e,r){return t&&(e.OFFSET=n),n})}if(e in p){var r=p[e];return u(r,function(n,i){var a=n.invoke(i,r);return t&&(n.OFFSET=a,s.optional(function(){n.assert(i,a+">=0","invalid "+e)})),a})}return t&&d?f(function(e,t){return e.OFFSET="0",0}):null}function c(){if(oe in l){var e=0|l[oe];return s.command("number"==typeof e&&e>=0,"invalid vertex count"),f(function(){return e})}if(oe in p){var t=p[oe];return u(t,function(e,n){var r=e.invoke(n,t);return s.optional(function(){e.assert(n,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(d){if(o(d)){if(d)return m?new a(m.thisDep,m.contextDep,m.propDep,function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return s.optional(function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")}),n}):f(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var n=f(function(){return-1});return s.optional(function(){n.MISSING=!0}),n}var r=new a(d.thisDep||m.thisDep,d.contextDep||m.contextDep,d.propDep||m.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")});return s.optional(function(){r.DYNAMIC=!0}),r}return null}var l=e.static,p=e.dynamic,d=t(),m=i(fe,!0);return{elements:d,primitive:n(),count:c(),instances:i(ue,!1),offset:m}}function Ft(e){var t=e.static,n=e.dynamic,r={};return cn.forEach(function(e){function i(i,o){if(e in t){var s=i(t[e]);r[a]=f(function(){return s})}else if(e in n){var c=n[e];r[a]=u(c,function(e,t){return o(e,t,e.invoke(t,c))})}}var a=At(e);switch(e){case L:case S:case j:case G:case F:case K:case W:case N:case q:case B:return i(function(t){return s.commandType(t,"boolean",e),t},function(t,n,r){return s.optional(function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e)}),r});case z:return i(function(t){return s.commandParameter(t,dt,"invalid "+e),dt[t]},function(t,n,r){var i=t.constants.compareFuncs;return s.optional(function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(dt))}),n.def(i,"[",r,"]")});case P:return i(function(e){return s.command(m(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array"),e},function(e,t,n){s.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")});var r=t.def("+",n,"[0]"),i=t.def("+",n,"[1]");return[r,i]});case O:return i(function(e){s.commandType(e,"object","blend.func");var t="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,r="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return s.commandParameter(t,pt,a+".srcRGB"),s.commandParameter(n,pt,a+".srcAlpha"),s.commandParameter(r,pt,a+".dstRGB"),s.commandParameter(i,pt,a+".dstAlpha"),[pt[t],pt[r],pt[n],pt[i]]},function(t,n,r){function i(i,o){var f=n.def('"',i,o,'" in ',r,"?",r,".",i,o,":",r,".",i);return s.optional(function(){t.assert(n,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(pt))}),n.def(a,"[",f,"]")}var a=t.constants.blendFuncs;s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});var o=i("src","RGB"),f=i("src","Alpha"),u=i("dst","RGB"),c=i("dst","Alpha");return[o,u,f,c]});case C:return i(function(t){return"string"==typeof t?(s.commandParameter(t,an,"invalid "+e),[an[t],an[t]]):"object"==typeof t?(s.commandParameter(t.rgb,an,e+".rgb"),s.commandParameter(t.alpha,an,e+".alpha"),[an[t.rgb],an[t.alpha]]):void s.commandRaise("invalid blend.equation")},function(t,n,r){var i=t.constants.blendEquations,a=n.def(),o=n.def(),f=t.cond("typeof ",r,'==="string"');return s.optional(function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(an))}n(f.then,e,r),t.assert(f.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(f.else,e+".rgb",r+".rgb"),n(f.else,e+".alpha",r+".alpha")}),f.then(a,"=",o,"=",i,"[",r,"];"),f.else(a,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(f),[a,o]});case D:return i(function(e){return s.command(m(e)&&4===e.length,"blend.color must be a 4d array"),l(4,function(t){return+e[t]})},function(e,t,n){return s.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),l(4,function(e){return t.def("+",n,"[",e,"]")})});case V:return i(function(e){return s.commandType(e,"number",a),0|e},function(e,t,n){return s.optional(function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")}),t.def(n,"|0")});case Y:return i(function(t){s.commandType(t,"object",a);var n=t.cmp||"keep",r=t.ref||0,i="mask"in t?t.mask:-1;return s.commandParameter(n,dt,e+".cmp"),s.commandType(r,"number",e+".ref"),s.commandType(i,"number",e+".mask"),[dt[n],r,i]},function(e,t,n){var r=e.constants.compareFuncs;s.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")});var i=t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",at),a=t.def(n,".ref|0"),o=t.def('"mask" in ',n,"?",n,".mask|0:-1");return[i,a,o]});case X:case $:return i(function(t){s.commandType(t,"object",a);var n=t.fail||"keep",r=t.zfail||"keep",i=t.pass||"keep";return s.commandParameter(n,mt,e+".fail"),s.commandParameter(r,mt,e+".zfail"),s.commandParameter(i,mt,e+".pass"),[e===$?Ze:Je,mt[n],mt[r],mt[i]]},function(t,n,r){function i(i){return s.optional(function(){t.assert(n,'!("'+i+'" in '+r+")||("+r+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(mt))}),n.def('"',i,'" in ',r,"?",a,"[",r,".",i,"]:",at)}var a=t.constants.stencilOps;return s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[e===$?Ze:Je,i("fail"),i("zfail"),i("pass")]});case U:return i(function(e){s.commandType(e,"object",a);var t=0|e.factor,n=0|e.units;return s.commandType(t,"number",a+".factor"),s.commandType(n,"number",a+".units"),[t,n]},function(t,n,r){s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=n.def(r,".factor|0"),a=n.def(r,".units|0");return[i,a]});case R:return i(function(e){var t=0;return"front"===e?t=Je:"back"===e&&(t=Ze),s.command(!!t,a),t},function(e,t,n){return s.optional(function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),t.def(n,'==="front"?',Je,":",Ze)});case H:return i(function(e){return s.command("number"==typeof e&&e>=p.lineWidthDims[0]&&e<=p.lineWidthDims[1],"invalid line width, must positive number between "+p.lineWidthDims[0]+" and "+p.lineWidthDims[1]),e},function(e,t,n){return s.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+p.lineWidthDims[0]+"&&"+n+"<="+p.lineWidthDims[1],"invalid line width")}),n});case I:return i(function(e){return s.commandParameter(e,bt,a),bt[e]},function(e,t,n){return s.optional(function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(n+'==="cw"?'+et+":"+tt)});case M:return i(function(e){return s.command(m(e)&&4===e.length,"color.mask must be length 4 array"),e.map(function(e){return!!e})},function(e,t,n){return s.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),l(4,function(e){return"!!"+n+"["+e+"]"})});case Q:return i(function(e){s.command("object"==typeof e&&e,a);var t="value"in e?e.value:1,n=!!e.invert;return s.command("number"==typeof t&&t>=0&&t<=1,"sample.coverage.value must be a number between 0 and 1"),[t,n]},function(e,t,n){s.optional(function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")});var r=t.def('"value" in ',n,"?+",n,".value:1"),i=t.def("!!",n,".invert");return[r,i]})}}),r}function zt(e){function t(e){var t=a[e];t&&(f[e]=t)}var n=e.static,r=e.dynamic;s.optional(function(){function e(e){Object.keys(e).forEach(function(e){s.command(i.indexOf(e)>=0,'unknown parameter "'+e+'"',t)})}var t=s.guessCommand(),i=[te,ne,re,ie,ae,fe,oe,ue,ee].concat(cn);e(n),e(r)});var i=St(e),a=Dt(e,i),o=Ot(e),f=Ft(e),u=Ct(e);t(Z),t(At(J));var c=Object.keys(f).length>0;return{framebuffer:i,draw:o,shader:u,state:f,dirty:c}}function Pt(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n,i=t[e];"number"==typeof i||"boolean"==typeof i?n=f(function(){return i}):"function"!=typeof i||"texture2d"!==i._reglType&&"textureCube"!==i._reglType?m(i)?n=f(function(t){var n=t.global.def("[",l(i.length,function(t){return s.command("number"==typeof i[t]||"boolean"==typeof i[t],"invalid uniform "+e),i[t]}),"]");return n}):s.commandRaise("invalid uniform "+e):n=f(function(e){return e.link(i)}),n.value=i,r[e]=n}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=u(t,function(e,n){return e.invoke(n,t)})}),r}function Bt(e){var n=e.static,i=e.dynamic,a={};return Object.keys(n).forEach(function(e){var i=n[e],o=t.id(e),u=new rn;if(r(i))u.state=x,u.buffer=d.getBuffer(d.create(i,ye,!1)),u.type=u.buffer.dtype;else{var c=d.getBuffer(i);if(c)u.state=x,u.buffer=c,u.type=c.dtype;else if(s.command("object"==typeof i&&i,"invalid data for attribute "+e),i.constant){var l=i.constant;u.buffer="null",u.state=w,"number"==typeof l?u.x=l:(s.command(m(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e),v.forEach(function(e,t){t<l.length&&(u[e]=l[t])}))}else{c=d.getBuffer(i.buffer),s.command(!!c,'missing buffer for attribute "'+e+'"');var p=0|i.offset;s.command(p>=0,'invalid offset for attribute "'+e+'"');var h=0|i.stride;s.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]');var b=0|i.size;s.command(!("size"in i)||b>0&&b<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4');var y=!!i.normalized,k=0;"type"in i&&(s.commandParameter(i.type,g,"invalid type for attribute "+e),k=g[i.type]);var A=0|i.divisor;"divisor"in i&&(s.command(0===A||on,'cannot specify divisor for attribute "'+e+'", instancing not supported'),s.command(A>=0,'invalid divisor for attribute "'+e+'"')),s.optional(function(){var t=s.guessCommand(),n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach(function(r){s.command(n.indexOf(r)>=0,'unknown parameter "'+r+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",t)})}),u.buffer=c,u.state=x,u.size=b,u.normalized=y,u.type=k||c.dtype,u.offset=p,u.stride=h,u.divisor=A}}a[e]=f(function(e,t){var n=e.attribCache;if(o in n)return n[o];var r={isStream:!1};return Object.keys(u).forEach(function(e){r[e]=u[e]}),u.buffer&&(r.buffer=e.link(u.buffer)),n[o]=r,r})}),Object.keys(i).forEach(function(e){function t(t,r){function i(e){r(c[e],"=",a,".",e,"|0;")}var a=t.invoke(r,n),o=t.shared,f=o.isBufferArgs,u=o.buffer;s.optional(function(){t.assert(r,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+f+"("+a+")||"+u+".getBuffer("+a+")||"+u+".getBuffer("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+o.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')});var c={isStream:r.def(!1)},l=new rn;l.state=x,Object.keys(l).forEach(function(e){c[e]=r.def(""+l[e])});var p=c.buffer,d=c.type;return r("if(",f,"(",a,")){",c.isStream,"=true;",p,"=",u,".createStream(",ye,",",a,");",d,"=",p,".dtype;","}else{",p,"=",u,".getBuffer(",a,");","if(",p,"){",d,"=",p,".dtype;",'}else if("constant" in ',a,"){",c.state,"=",w,";","if(typeof "+a+'.constant === "number"){',c[v[0]],"=",a,".constant;",v.slice(1).map(function(e){return c[e]}).join("="),"=0;","}else{",v.map(function(e,t){return c[e]+"="+a+".constant.length>="+t+"?"+a+".constant["+t+"]:0;"}).join(""),"}}else{",p,"=",u,".getBuffer(",a,".buffer);",d,'="type" in ',a,"?",o.glTypes,"[",a,".type]:",p,".dtype;",c.normalized,"=!!",a,".normalized;"),i("size"),i("offset"),i("stride"),i("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",p,");","}"),c}var n=i[e];a[e]=u(n,t)}),a}function Mt(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=f(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=u(t,function(e,n){return e.invoke(n,t)})}),r}function Lt(e,t,n,r){var i=zt(e);return i.profile=jt(e),i.uniforms=Pt(n),i.attributes=Bt(t),i.context=Mt(r),i}function Rt(e,t,n){var r=e.shared,i=r.context,a=e.scope();Object.keys(n).forEach(function(r){t.save(i,"."+r);var o=n[r];a(i,".",r,"=",o.append(e,t),";")}),t(a)}function It(e,t,n){var r,i=e.shared,a=i.gl,o=i.framebuffer;fn&&(r=t.def(i.extensions,".webgl_draw_buffers"));var f,u=e.constants,s=u.drawBuffer,c=u.backBuffer;f=n?n.append(e,t):t.def(o,".next"),t("if(",o,".dirty||",f,"!==",o,".cur){","if(",f,"){",a,".bindFramebuffer(",ct,",",f,".framebuffer);"),fn&&t(r,".drawBuffersWEBGL(",s,"[",f,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",ct,",null);"),fn&&t(r,".drawBuffersWEBGL(",c,");"),t("}",o,".cur=",f,";",o,".dirty=false;","}")}function Ht(e,t,n){var r=e.shared,i=r.gl,a=e.current,o=e.next,f=r.current,u=r.next,s=e.cond(f,".dirty");cn.forEach(function(t){var r=At(t);if(!(r in n.state)){var c,p;if(r in o){c=o[r],p=a[r];var d=l(un[r].length,function(e){return s.def(c,"[",e,"]")});s(e.cond(d.map(function(e,t){return e+"!=="+p+"["+t+"]"}).join("||")).then(i,".",pn[r],"(",d,");",d.map(function(e,t){return p+"["+t+"]="+e}).join(";"),";"))}else{c=s.def(u,".",r);var m=e.cond(c,"!==",f,".",r);s(m),r in ln?m(e.cond(c).then(i,".enable(",ln[r],");").else(i,".disable(",ln[r],");"),f,".",r,"=",c,";"):m(i,".",pn[r],"(",c,");",f,".",r,"=",c,";")}}}),0===Object.keys(n.state).length&&s(f,".dirty=false;"),t(s)}function Wt(e,t,n,r){var a=e.shared,f=e.current,u=a.current,s=a.gl;i(Object.keys(n)).forEach(function(i){var a=n[i];if(!r||r(a)){var c=a.append(e,t);if(ln[i]){var l=ln[i];o(a)?c?t(s,".enable(",l,");"):t(s,".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(u,".",i,"=",c,";")}else if(m(c)){var p=f[i];t(s,".",pn[i],"(",c,");",c.map(function(e,t){return p+"["+t+"]="+e}).join(";"),";")}else t(s,".",pn[i],"(",c,");",u,".",i,"=",c,";")}})}function Ut(e,t){on&&!e.instancing&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function Nt(e,t,n,r,i){function a(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function f(e){c=t.def(),e(c,"=",a(),";"),"string"==typeof i?e(m,".count+=",i,";"):e(m,".count++;"),wt&&(r?(l=t.def(),e(l,"=",b,".getNumPendingQueries();")):e(b,".beginQuery(",m,");"))}function u(e){e(m,".cpuTime+=",a(),"-",c,";"),wt&&(r?e(b,".pushScopeStats(",l,",",b,".getNumPendingQueries(),",m,");"):e(b,".endQuery();"))}function s(e){var n=t.def(h,".profile");t(h,".profile=",e,";"),t.exit(h,".profile=",n,";")}var c,l,p,d=e.shared,m=e.stats,h=d.current,b=d.timer,g=n.profile;if(g){if(o(g))return void(g.enable?(f(t),u(t.exit),s("true")):s("false"));p=g.append(e,t),s(p)}else p=t.def(h,".profile");var v=e.block();f(v),t("if(",p,"){",v,"}");var y=e.block();u(y),t.exit("if(",p,"){",y,"}")}function qt(e,t,n,r,i){function a(e){switch(e){case Be:case Ie:case Ne:return 2;case Me:case He:case qe:return 3;case Le:case We:case Qe:return 4;default:return 1}}function o(n,r,i){function a(){t("if(!",c,".buffer){",u,".enableVertexAttribArray(",s,");}");var n,a=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",c,".type!==",a,"||",c,".size!==",n,"||",m.map(function(e){return c+"."+e+"!=="+i[e]}).join("||"),"){",u,".bindBuffer(",ye,",",p,".buffer);",u,".vertexAttribPointer(",[s,n,a,i.normalized,i.stride,i.offset],");",c,".type=",a,";",c,".size=",n,";",m.map(function(e){return c+"."+e+"="+i[e]+";"}).join(""),"}"),on){var o=i.divisor;t("if(",c,".divisor!==",o,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,o],");",c,".divisor=",o,";}")}}function o(){t("if(",c,".buffer){",u,".disableVertexAttribArray(",s,");","}if(",v.map(function(e,t){return c+"."+e+"!=="+d[t]}).join("||"),"){",u,".vertexAttrib4f(",s,",",d,");",v.map(function(e,t){return c+"."+e+"="+d[t]+";"}).join(""),"}")}var u=f.gl,s=t.def(n,".location"),c=t.def(f.attributes,"[",s,"]"),l=i.state,p=i.buffer,d=[i.x,i.y,i.z,i.w],m=["buffer","normalized","offset","stride"];l===x?a():l===w?o():(t("if(",l,"===",x,"){"),a(),t("}else{"),o(),t("}"))}var f=e.shared;r.forEach(function(r){var f,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;f=c.append(e,t)}else{if(!i(gt))return;var l=e.scopeAttrib(u);s.optional(function(){e.assert(t,l+".state","missing attribute "+u)}),f={},Object.keys(new rn).forEach(function(e){f[e]=t.def(l,".",e)})}o(e.link(r),a(r.info.type),f)})}function Qt(e,n,r,i,a){for(var f,u=e.shared,c=u.gl,p=0;p<i.length;++p){var d,h=i[p],b=h.name,g=h.info.type,v=r.uniforms[b],y=e.link(h),x=y+".location";if(v){if(!a(v))continue;if(o(v)){var w=v.value;if(g===Xe||g===$e){s.command("function"==typeof w&&("texture2d"===w._reglType&&g===Xe||"textureCube"===w._reglType&&g===$e),"invalid texture for uniform "+b);var k=e.link(w._texture);n(c,".uniform1i(",x,",",k+".bind());"),n.exit(k,".unbind();")}else if(g===Ge||g===Ve||g===Ye){s.optional(function(){s.command(m(w),"invalid matrix for uniform "+b),s.command(g===Ge&&4===w.length||g===Ve&&9===w.length||g===Ye&&16===w.length,"invalid length for matrix uniform "+b)});var A=e.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),_=2;g===Ve?_=3:g===Ye&&(_=4),n(c,".uniformMatrix",_,"fv(",x,",false,",A,");");
}else{switch(g){case Pe:s.commandType(w,"number","uniform "+b),f="1f";break;case Be:s.command(m(w)&&2===w.length,"uniform "+b),f="2f";break;case Me:s.command(m(w)&&3===w.length,"uniform "+b),f="3f";break;case Le:s.command(m(w)&&4===w.length,"uniform "+b),f="4f";break;case Ue:s.commandType(w,"boolean","uniform "+b),f="1i";break;case Re:s.commandType(w,"number","uniform "+b),f="1i";break;case Ne:s.command(m(w)&&2===w.length,"uniform "+b),f="2i";break;case Ie:s.command(m(w)&&2===w.length,"uniform "+b),f="2i";break;case qe:s.command(m(w)&&3===w.length,"uniform "+b),f="3i";break;case He:s.command(m(w)&&3===w.length,"uniform "+b),f="3i";break;case Qe:s.command(m(w)&&4===w.length,"uniform "+b),f="4i";break;case We:s.command(m(w)&&4===w.length,"uniform "+b),f="4i"}n(c,".uniform",f,"(",x,",",m(w)?Array.prototype.slice.call(w):w,");")}continue}d=v.append(e,n)}else{if(!a(gt))continue;d=n.def(u.uniforms,"[",t.id(b),"]")}s.optional(function(){function t(t){e.assert(n,t,'invalid or missing uniform "'+b+'"')}function r(e){t("typeof "+d+'==="'+e+'"')}function i(e,n){t(u.isArrayLike+"("+d+")&&"+d+".length==="+e)}function a(e){t("typeof "+d+'==="function"&&'+d+'._reglType==="texture'+(e===Ae?"2d":"Cube")+'"')}switch(g){case Re:r("number");break;case Ie:i(2,"number");break;case He:i(3,"number");break;case We:i(4,"number");break;case Pe:r("number");break;case Be:i(2,"number");break;case Me:i(3,"number");break;case Le:i(4,"number");break;case Ue:r("boolean");break;case Ne:i(2,"boolean");break;case qe:i(3,"boolean");break;case Qe:i(4,"boolean");break;case Ge:i(4,"number");break;case Ve:i(9,"number");break;case Ye:i(16,"number");break;case Xe:a(Ae);break;case $e:a(_e)}});var T=1;switch(g){case Xe:case $e:var E=n.def(d,"._texture");n(c,".uniform1i(",x,",",E,".bind());"),n.exit(E,".unbind();");continue;case Re:case Ue:f="1i";break;case Ie:case Ne:f="2i",T=2;break;case He:case qe:f="3i",T=3;break;case We:case Qe:f="4i",T=4;break;case Pe:f="1f";break;case Be:f="2f",T=2;break;case Me:f="3f",T=3;break;case Le:f="4f",T=4;break;case Ge:f="Matrix2fv";break;case Ve:f="Matrix3fv";break;case Ye:f="Matrix4fv"}if(n(c,".uniform",f,"(",x,","),"M"===f.charAt(0)){var j=Math.pow(g-Ge+2,2),S=e.global.def("new Float32Array(",j,")");n("false,(Array.isArray(",d,")||",d," instanceof Float32Array)?",d,":(",l(j,function(e){return S+"["+e+"]="+d+"["+e+"]"}),",",S,")")}else n(T>1?l(T,function(e){return d+"["+e+"]"}):d);n(");")}}function Gt(e,t,n,r){function i(){var i,a=m.elements,o=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(o=n),i=a.append(e,o)):i=o.def(d,".",ie),i&&o("if("+i+")"+p+".bindBuffer("+xe+","+i+".buffer.buffer);"),i}function a(){var i,a=m.count,o=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(o=n),i=a.append(e,o),s.optional(function(){a.MISSING&&e.assert(t,"false","missing vertex count"),a.DYNAMIC&&e.assert(o,i+">=0","missing vertex count")})):(i=o.def(d,".",oe),s.optional(function(){e.assert(o,i+">=0","missing vertex count")})),i}function f(i){var a=m[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(e,n):a.append(e,t):t.def(d,".",i)}function u(){function e(){n(w,".drawElementsInstancedANGLE(",[b,v,k,g+"<<(("+k+"-"+y+")>>1)",x],");")}function t(){n(w,".drawArraysInstancedANGLE(",[b,g,v,x],");")}h?A?e():(n("if(",h,"){"),e(),n("}else{"),t(),n("}")):t()}function c(){function e(){n(p+".drawElements("+[b,v,k,g+"<<(("+k+"-"+y+")>>1)"]+");")}function t(){n(p+".drawArrays("+[b,g,v]+");")}h?A?e():(n("if(",h,"){"),e(),n("}else{"),t(),n("}")):t()}var l=e.shared,p=l.gl,d=l.draw,m=r.draw,h=i(),b=f(ae),g=f(fe),v=a();if("number"==typeof v){if(0===v)return}else n("if(",v,"){"),n.exit("}");var x,w;on&&(x=f(ue),w=e.instancing);var k=h+".type",A=m.elements&&o(m.elements);on&&("number"!=typeof x||x>=0)?"string"==typeof x?(n("if(",x,">0){"),u(),n("}else if(",x,"<0){"),c(),n("}")):u():c()}function Vt(e,t,n,r,i){var a=Et(),o=a.proc("body",i);return s.optional(function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)}),on&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,n,r),a.compile().body}function Yt(e,t,n,r){Ut(e,t),qt(e,t,n,r.attributes,function(){return!0}),Qt(e,t,n,r.uniforms,function(){return!0}),Gt(e,t,t,n)}function Xt(e,t){var n=e.proc("draw",1);Ut(e,n),Rt(e,n,t.context),It(e,n,t.framebuffer),Ht(e,n,t),Wt(e,n,t.state),Nt(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Yt(e,n,t,t.shader.program);else{var i=e.global.def("{}"),a=n.def(r,".id"),o=n.def(i,"[",a,"]");n(e.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",e.link(function(n){return Vt(Yt,e,t,n,1)}),"(",r,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}function $t(e,t,n,r){function i(){return!0}e.batchId="a1",Ut(e,t),qt(e,t,n,r.attributes,i),Qt(e,t,n,r.uniforms,i),Gt(e,t,t,n)}function Kt(e,t,n,r){function i(e){return e.contextDep&&o||e.propDep}function a(e){return!i(e)}Ut(e,t);var o=n.contextDep,f=t.def(),u="a0",s="a1",c=t.def();e.shared.props=c,e.batchId=f;var l=e.scope(),p=e.scope();if(t(l.entry,"for(",f,"=0;",f,"<",s,";++",f,"){",c,"=",u,"[",f,"];",p,"}",l.exit),n.needsContext&&Rt(e,p,n.context),n.needsFramebuffer&&It(e,p,n.framebuffer),Wt(e,p,n.state,i),n.profile&&i(n.profile)&&Nt(e,p,n,!1,!0),r)qt(e,l,n,r.attributes,a),qt(e,p,n,r.attributes,i),Qt(e,l,n,r.uniforms,a),Qt(e,p,n,r.uniforms,i),Gt(e,l,p,n);else{var d=e.global.def("{}"),m=n.shader.progVar.append(e,p),h=p.def(m,".id"),b=p.def(d,"[",h,"]");p(e.shared.gl,".useProgram(",m,".program);","if(!",b,"){",b,"=",d,"[",h,"]=",e.link(function(t){return Vt($t,e,n,t,2)}),"(",m,");}",b,".call(this,a0[",f,"],",f,");")}}function Jt(e,t){function n(e){return e.contextDep&&i||e.propDep}var r=e.proc("batch",2);e.batchId="0",Ut(e,r);var i=!1,a=!0;Object.keys(t.context).forEach(function(e){i=i||t.context[e].propDep}),i||(Rt(e,r,t.context),a=!1);var o=t.framebuffer,f=!1;o?(o.propDep?i=f=!0:o.contextDep&&i&&(f=!0),f||It(e,r,o)):It(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(i=!0),Ht(e,r,t),Wt(e,r,t.state,function(e){return!n(e)}),t.profile&&n(t.profile)||Nt(e,r,t,!1,"a1"),t.contextDep=i,t.needsContext=a,t.needsFramebuffer=f;var u=t.shader.progVar;if(u.contextDep&&i||u.propDep)Kt(e,r,t,null);else{var s=u.append(e,r);if(r(e.shared.gl,".useProgram(",s,".program);"),t.shader.program)Kt(e,r,t,t.shader.program);else{var c=e.global.def("{}"),l=r.def(s,".id"),p=r.def(c,"[",l,"]");r(e.cond(p).then(p,".call(this,a0,a1);").else(p,"=",c,"[",l,"]=",e.link(function(n){return Vt(Kt,e,t,n,2)}),"(",s,");",p,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}function Zt(e,n){function r(t){var r=n.shader[t];r&&a.set(o.shader,"."+t,r.append(e,a))}var a=e.proc("scope",3);e.batchId="a2";var o=e.shared,f=o.current;Rt(e,a,n.context),n.framebuffer&&n.framebuffer.append(e,a),i(Object.keys(n.state)).forEach(function(t){var r=n.state[t],i=r.append(e,a);m(i)?i.forEach(function(n,r){a.set(e.next[t],"["+r+"]",n)}):a.set(o.next,"."+t,i)}),Nt(e,a,n,!0,!0),[ie,fe,oe,ue,ae].forEach(function(t){var r=n.draw[t];r&&a.set(o.draw,"."+t,""+r.append(e,a))}),Object.keys(n.uniforms).forEach(function(r){a.set(o.uniforms,"["+t.id(r)+"]",n.uniforms[r].append(e,a))}),Object.keys(n.attributes).forEach(function(t){var r=n.attributes[t].append(e,a),i=e.scopeAttrib(t);Object.keys(new rn).forEach(function(e){a.set(i,"."+e,r[e])})}),r(ne),r(re),Object.keys(n.state).length>0&&(a(f,".dirty=true;"),a.exit(f,".dirty=true;")),a("a1(",e.shared.context,",a0,",e.batchId,");")}function en(e){if("object"==typeof e){for(var t=Object.keys(e),n=0;n<t.length;++n)if(h.isDynamic(e[t[n]]))return!0;return!1}}function tn(e,t,n){function r(e,t){o.forEach(function(n){var r=i[n];if(h.isDynamic(r)){var a=e.invoke(t,r);t(l,".",n,"=",a,";")}})}var i=t.static[n];if(i&&en(i)){var a=e.global,o=Object.keys(i),f=!1,s=!1,c=!1,l=e.global.def("{}");o.forEach(function(t){var n=i[t];if(h.isDynamic(n)){var r=u(n,null);f=f||r.thisDep,c=c||r.propDep,s=s||r.contextDep}else{switch(a(l,".",t,"="),typeof n){case"number":a(n);break;case"string":a('"',n,'"');break;case"object":Array.isArray(n)&&a("[",n.join(),"]");break;default:a(e.link(n))}a(";")}}),t.dynamic[n]=new h.DynamicVariable(E,{thisDep:f,contextDep:s,propDep:c,ref:l,append:r}),delete t.static[n]}}function nn(e,t,n,r,i){var a=Et();a.stats=a.link(i),Object.keys(t.static).forEach(function(e){tn(a,t,e)}),ve.forEach(function(t){tn(a,e,t)});var o=Lt(e,t,n,r);return Xt(a,o),Zt(a,o),Jt(a,o),a.compile()}var rn=ke.Record,an={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(an.min=nt,an.max=rt);var on=n.angle_instanced_arrays,fn=n.webgl_draw_buffers,un={dirty:!0,profile:kt.profile},sn={},cn=[],ln={},pn={};_t(j,je),_t(S,Ee),Tt(D,"blendColor",[0,0,0,0]),Tt(C,"blendEquationSeparate",[ut,ut]),Tt(O,"blendFuncSeparate",[ft,ot,ft,ot]),_t(F,De,!0),Tt(z,"depthFunc",st),Tt(P,"depthRange",[0,1]),Tt(B,"depthMask",!0),Tt(M,M,[!0,!0,!0,!0]),_t(L,Te),Tt(R,"cullFace",Ze),Tt(I,I,tt),Tt(H,H,1),_t(W,Oe),Tt(U,"polygonOffset",[0,0]),_t(N,Fe),_t(q,ze),Tt(Q,"sampleCoverage",[1,!1]),_t(G,Se),Tt(V,"stencilMask",-1),Tt(Y,"stencilFunc",[it,0,-1]),Tt(X,"stencilOpSeparate",[Je,at,at,at]),Tt($,"stencilOpSeparate",[Ze,at,at,at]),_t(K,Ce),Tt(J,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),Tt(Z,Z,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var dn={gl:e,context:xt,strings:t,next:sn,current:un,draw:yt,elements:se,buffer:d,shader:vt,attributes:ke.state,uniforms:we,framebuffer:he,extensions:n,timer:wt,isBufferArgs:r},mn={primTypes:b,compareFuncs:dt,blendFuncs:pt,blendEquations:an,stencilOps:mt,glTypes:g,orientationType:bt};s.optional(function(){dn.isArrayLike=m}),fn&&(mn.backBuffer=[Ze],mn.drawBuffer=l(p.maxDrawbuffers,function(e){return 0===e?[0]:l(e,function(e){return lt+e})}));var hn=0;return{next:sn,current:un,procs:function(){var e=Et(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var i=e.shared,a=i.gl,o=i.next,f=i.current;return r(f,".dirty=false;"),It(e,t),n(i.framebuffer,".dirty=true;"),It(e,n),Object.keys(ln).forEach(function(i){var u=ln[i],s=r.def(o,".",i),c=e.block();c("if(",s,"){",a,".enable(",u,")}else{",a,".disable(",u,")}",f,".",i,"=",s,";"),n(c),t("if(",s,"!==",f,".",i,"){",c,"}")}),Object.keys(pn).forEach(function(i){var u,s,c=pn[i],p=un[i],d=e.block();if(d(a,".",c,"("),m(p)){var h=p.length;u=e.global.def(o,".",i),s=e.global.def(f,".",i),d(l(h,function(e){return u+"["+e+"]"}),");",l(h,function(e){return s+"["+e+"]="+u+"["+e+"];"}).join("")),t("if(",l(h,function(e){return u+"["+e+"]!=="+s+"["+e+"]"}).join("||"),"){",d,"}")}else u=r.def(o,".",i),s=r.def(f,".",i),d(u,");",f,".",i,"=",u,";"),t("if(",u,"!==",s,"){",d,"}");n(d)}),e.compile()}(),compile:nn}}},{"./constants/dtypes.json":4,"./constants/primitives.json":5,"./dynamic":8,"./util/check":20,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],8:[function(e,t,n){function r(e,t){this.id=c++,this.type=e,this.data=t}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function a(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+i(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return a(e.substr(0,r.index)).concat(a(r[1])).concat(a(e.substr(r.index+r[0].length)));var o=e.split(".");if(1===o.length)return['"'+i(e)+'"'];for(var f=[],u=0;u<o.length;++u)f=f.concat(a(o[u]));return f}function o(e){return"["+a(e).join("][")+"]"}function f(e,t){return new r(e,o(t+""))}function u(e){return"function"==typeof e&&!e._reglType||e instanceof r}function s(e,t){return"function"==typeof e?new r(l,e):e}var c=0,l=0;t.exports={DynamicVariable:r,define:f,isDynamic:u,unbox:s,accessor:o}},{}],9:[function(e,t,n){var r=e("./util/check"),i=e("./util/is-typed-array"),a=e("./util/is-ndarray"),o=e("./util/values"),f=e("./constants/primitives.json"),u=e("./constants/usage.json"),s=0,c=1,l=4,p=5120,d=5121,m=5122,h=5123,b=5124,g=5125,v=34963,y=35040,x=35044;t.exports=function(e,t,n,w){function k(e){this.id=D++,S[this.id]=this,this.buffer=e,this.primType=l,this.vertCount=0,this.type=0}function A(e){var t=O.pop();return t||(t=new k(n.create(null,v,!0)._buffer)),T(t,e,y,-1,-1,0,0),t}function _(e){O.push(e)}function T(e,o,f,u,v,y,x){var w=x;x||i(o)&&(!a(o)||i(o.data))||(w=t.oes_element_index_uint?g:h),e.buffer.bind(),n._initBuffer(e.buffer,o,f,w,3);var k=x;if(!x){switch(e.buffer.dtype){case d:case p:k=d;break;case h:case m:k=h;break;case g:case b:k=g;break;default:r.raise("unsupported type for element array")}e.buffer.dtype=k}e.type=k,r(k!==g||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var A=v;A<0&&(A=e.buffer.byteLength,k===h?A>>=1:k===g&&(A>>=2)),e.vertCount=A;var _=u;if(u<0){_=l;var T=e.buffer.dimension;1===T&&(_=s),2===T&&(_=c),3===T&&(_=l)}e.primType=_}function E(e){w.elementsCount--,r(null!==e.buffer,"must not double destroy elements"),delete S[e.id],e.buffer.destroy(),e.buffer=null}function j(t){function o(t){if(t)if("number"==typeof t)s(t),c.primType=l,c.vertCount=0|t,c.type=d;else{var n=null,p=x,m=-1,h=-1,b=0,g=0;if(Array.isArray(t)||i(t)||a(t)?n=t:(r.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,r(Array.isArray(n)||i(n)||a(n),"invalid data for element buffer")),"usage"in t&&(r.parameter(t.usage,u,"invalid element buffer usage"),p=u[t.usage]),"primitive"in t&&(r.parameter(t.primitive,f,"invalid element buffer primitive"),m=f[t.primitive]),"count"in t&&(r("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),h=0|t.count),"length"in t&&(b=0|t.length),"type"in t&&(r.parameter(t.type,C,"invalid buffer type"),g=C[t.type])),n)T(c,n,p,m,h,b,g);else{var y=c.buffer;y.bind(),e.bufferData(v,b,p),y.dtype=g||d,y.usage=p,y.dimension=3,y.byteLength=b,c.primType=m<0?l:m,c.vertCount=h<0?0:h,c.type=y.dtype}}else s(),c.primType=l,c.vertCount=0,c.type=d;return o}var s=n.create(null,v,!0),c=new k(s._buffer);return w.elementsCount++,o(t),o._reglType="elements",o._elements=c,o.subdata=function(e,t){return s.subdata(e,t),o},o.destroy=function(){E(c)},o}var S={},D=0,C={uint8:d,uint16:h};t.oes_element_index_uint&&(C.uint32=g),k.prototype.bind=function(){this.buffer.bind()};var O=[];return{create:j,createStream:A,destroyStream:_,getElements:function(e){return"function"==typeof e&&e._elements instanceof k?e._elements:null},clear:function(){o(S).forEach(E)}}}},{"./constants/primitives.json":5,"./constants/usage.json":6,"./util/check":20,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],10:[function(e,t,n){var r=e("./util/check");t.exports=function(e,t){function n(t){r.type(t,"string","extension name must be string");var n=t.toLowerCase();if(n in i)return!0;var a;try{a=i[n]=e.getExtension(n)}catch(e){}return!!a}for(var i={},a=0;a<t.extensions.length;++a){var o=t.extensions[a];if(!n(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:i,refresh:function(){t.extensions.forEach(n),t.optionalExtensions.forEach(n)}}}},{"./util/check":20}],11:[function(e,t,n){var r=e("./util/check"),i=e("./util/values"),a=e("./util/extend"),o=36160,f=36161,u=3553,s=34069,c=36064,l=36096,p=36128,d=33306,m=36053,h=36054,b=36055,g=36057,v=36061,y=36193,x=5121,w=5126,k=6408,A=6402,_=[k],T=[];T[k]=4;var E=[];E[x]=1,E[w]=4,E[y]=2;var j=32854,S=32855,D=36194,C=33189,O=36168,F=34041,z=35907,P=34836,B=34842,M=34843,L=[j,S,D,z,B,M,P],R={};R[m]="complete",R[h]="incomplete attachment",R[g]="incomplete dimensions",R[b]="incomplete, missing attachment",R[v]="unsupported",t.exports=function(e,t,n,h,b,g){function v(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function y(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function x(e,t,n){if(e)if(e.texture){var i=e.texture._texture,a=Math.max(1,i.width),o=Math.max(1,i.height);r(a===t&&o===n,"inconsistent width/height for supplied texture"),i.refCount+=1}else{var f=e.renderbuffer._renderbuffer;r(f.width===t&&f.height===n,"inconsistent width/height for renderbuffer"),f.refCount+=1}}function w(t,n){n?n.texture?e.framebufferTexture2D(o,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(o,t,f,n.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(o,t,u,null,0)}function k(e){var t=u,n=null,i=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),r.type(a,"function","invalid attachment data");var o=a._reglType;return"texture2d"===o?(n=a,r(t===u)):"textureCube"===o?(n=a,r(t>=s&&t<s+6,"invalid cube map target")):"renderbuffer"===o?(i=a,t=f):r.raise("invalid regl object for attachment"),new v(t,n,i)}function j(e,t,n,r,i){if(n){var a=h.create2D({width:e,height:t,format:r,type:i});return a._texture.refCount=0,new v(u,a,null)}var o=b.create({width:e,height:t,format:r});return o._renderbuffer.refCount=0,new v(f,null,o)}function S(e){return e&&(e.texture||e.renderbuffer)}function D(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n))}function z(){this.id=Q++,G[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function P(e){e.colorAttachments.forEach(y),y(e.depthAttachment),y(e.stencilAttachment),y(e.depthStencilAttachment)}function B(t){var n=t.framebuffer;r(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,g.framebufferCount--,delete G[t.id]}function M(t){var i;e.bindFramebuffer(o,t.framebuffer);var a=t.colorAttachments;for(i=0;i<a.length;++i)w(c+i,a[i]);for(i=a.length;i<n.maxColorAttachments;++i)w(c+i,null);w(l,t.depthAttachment),w(p,t.stencilAttachment),w(d,t.depthStencilAttachment);var f=e.checkFramebufferStatus(o);f!==m&&r.raise("framebuffer configuration not supported, status = "+R[f]),e.bindFramebuffer(o,W.next),W.current=W.next}function I(e,i){function o(e,i){var a;r(W.next!==u,"can not update framebuffer which is currently in use");var f=t.webgl_draw_buffers,s=0,c=0,l=!0,p=!0,d=null,m=!0,h="rgba",b="uint8",g=1,v=null,y=null,w=null,D=!1;if("number"==typeof e)s=0|e,c=0|i||s;else if(e){r.type(e,"object","invalid arguments for framebuffer");var z=e;if("shape"in z){var B=z.shape;r(Array.isArray(B)&&B.length>=2,"invalid shape for framebuffer"),s=B[0],c=B[1]}else"radius"in z&&(s=c=z.radius),"width"in z&&(s=z.width),"height"in z&&(c=z.height);("color"in z||"colors"in z)&&(d=z.color||z.colors,Array.isArray(d)&&r(1===d.length||f,"multiple render targets not supported")),d||("colorCount"in z&&(g=0|z.colorCount,r(g>0,"invalid color buffer count")),"colorTexture"in z&&(m=!!z.colorTexture,h="rgba4"),"colorType"in z&&(r.oneOf(z.colorType,q,"invalid color type"),b=z.colorType,m||("half float"===b?t.ext_color_buffer_half_float&&(h="rgba16f"):"float"===b&&t.webgl_color_buffer_float&&(h="rgba32f"))),"colorFormat"in z&&(h=z.colorFormat,U.indexOf(h)>=0?m=!0:N.indexOf(h)>=0?m=!1:m?r.oneOf(z.colorFormat,U,"invalid color format for texture"):r.oneOf(z.colorFormat,N,"invalid color format for renderbuffer"))),("depthTexture"in z||"depthStencilTexture"in z)&&(D=!(!z.depthTexture&&!z.depthStencilTexture),r(!D||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in z&&("boolean"==typeof z.depth?l=z.depth:(v=z.depth,p=!1)),"stencil"in z&&("boolean"==typeof z.stencil?p=z.stencil:(y=z.stencil,l=!1)),"depthStencil"in z&&("boolean"==typeof z.depthStencil?l=p=z.depthStencil:(w=z.depthStencil,l=!1,p=!1))}else s=c=1;var R=null,I=null,H=null,Q=null;if(Array.isArray(d))R=d.map(k);else if(d)R=[k(d)];else for(R=new Array(g),a=0;a<g;++a)R[a]=j(s,c,m,h,b);r(R.length<=n.maxColorAttachments,"too many color attachments, not supported"),s=s||R[0].width,c=c||R[0].height,v?I=k(v):l&&!p&&(I=j(s,c,D,"depth","uint32")),y?H=k(y):p&&!l&&(H=j(s,c,!1,"stencil","uint8")),w?Q=k(w):!v&&!y&&p&&l&&(Q=j(s,c,D,"depth stencil","depth stencil")),r(!!v+!!y+!!w<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var G=null;for(a=0;a<R.length;++a)if(x(R[a],s,c),r(!R[a]||R[a].texture&&_.indexOf(R[a].texture._texture.format)>=0||R[a].renderbuffer&&L.indexOf(R[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),R[a]&&R[a].texture){var V=T[R[a].texture._texture.format]*E[R[a].texture._texture.type];null===G?G=V:r(G===V,"all color attachments much have the same number of bits per pixel.")}return x(I,s,c),r(!I||I.texture&&I.texture._texture.format===A||I.renderbuffer&&I.renderbuffer._renderbuffer.format===C,"invalid depth attachment for framebuffer object"),x(H,s,c),r(!H||H.renderbuffer&&H.renderbuffer._renderbuffer.format===O,"invalid stencil attachment for framebuffer object"),x(Q,s,c),r(!Q||Q.texture&&Q.texture._texture.format===F||Q.renderbuffer&&Q.renderbuffer._renderbuffer.format===F,"invalid depth-stencil attachment for framebuffer object"),P(u),u.width=s,u.height=c,u.colorAttachments=R,u.depthAttachment=I,u.stencilAttachment=H,u.depthStencilAttachment=Q,o.color=R.map(S),o.depth=S(I),o.stencil=S(H),o.depthStencil=S(Q),o.width=u.width,o.height=u.height,M(u),o}function f(e,t){r(W.next!==u,"can not resize a framebuffer which is currently in use");var n=0|e,i=0|t||n;if(n===u.width&&i===u.height)return o;for(var a=u.colorAttachments,f=0;f<a.length;++f)D(a[f],n,i);return D(u.depthAttachment,n,i),D(u.stencilAttachment,n,i),D(u.depthStencilAttachment,n,i),u.width=o.width=n,u.height=o.height=i,M(u),o}var u=new z;return g.framebufferCount++,o(e,i),a(o,{resize:f,_reglType:"framebuffer",_framebuffer:u,destroy:function(){B(u),P(u)}})}function H(e){function n(e){var i;r(o.indexOf(W.next)<0,"can not update framebuffer which is currently in use");var f=t.webgl_draw_buffers,u={color:null},c=0,l=null,p="rgba",d="uint8",m=1;if("number"==typeof e)c=0|e;else if(e){r.type(e,"object","invalid arguments for framebuffer");var b=e;if("shape"in b){var g=b.shape;r(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),r(g[0]===g[1],"cube framebuffer must be square"),c=g[0]}else"radius"in b&&(c=0|b.radius),"width"in b?(c=0|b.width,"height"in b&&r(b.height===c,"must be square")):"height"in b&&(c=0|b.height);("color"in b||"colors"in b)&&(l=b.color||b.colors,Array.isArray(l)&&r(1===l.length||f,"multiple render targets not supported")),l||("colorCount"in b&&(m=0|b.colorCount,r(m>0,"invalid color buffer count")),"colorType"in b&&(r.oneOf(b.colorType,q,"invalid color type"),d=b.colorType),"colorFormat"in b&&(p=b.colorFormat,r.oneOf(b.colorFormat,U,"invalid color format for texture"))),"depth"in b&&(u.depth=b.depth),"stencil"in b&&(u.stencil=b.stencil),"depthStencil"in b&&(u.depthStencil=b.depthStencil)}else c=1;var v;if(l)if(Array.isArray(l))for(i=0;i<l.length;++i);else v=[l];else{v=Array(m);var y={radius:c,format:p,type:d};for(i=0;i<m;++i)v[i]=h.createCube(y)}for(u.color=Array(v.length),i=0;i<v.length;++i){var x=v[i];r("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),c=c||x.width,r(x.width===c&&x.height===c,"invalid cube map shape"),u.color[i]={target:s,data:v[i]}}for(i=0;i<6;++i){for(var w=0;w<v.length;++w)u.color[w].target=s+i;i>0&&(u.depth=o[0].depth,u.stencil=o[0].stencil,u.depthStencil=o[0].depthStencil),o[i]?o[i](u):o[i]=I(u)}return a(n,{width:c,height:c,color:v})}function i(e){for(var t=0;t<6;++t)o[t].resize(e);return n}var o=Array(6);return n(e),a(n,{faces:o,resize:i,_reglType:"framebufferCube",destroy:function(){o.forEach(function(e){e.destroy()})}})}var W={current:null,next:null,dirty:!1},U=["rgba"],N=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&N.push("srgba"),t.ext_color_buffer_half_float&&N.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&N.push("rgba32f");var q=["uint8"];t.oes_texture_half_float&&q.push("half float"),t.oes_texture_float&&q.push("float");var Q=0,G={};return a(W,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof z)return t}return null},create:I,createCube:H,clear:function(){i(G).forEach(B)}})}},{"./util/check":20,"./util/extend":23,"./util/values":31}],12:[function(e,t,n){var r=3408,i=3410,a=3411,o=3412,f=3413,u=3414,s=3415,c=33901,l=33902,p=3379,d=3386,m=34921,h=36347,b=36348,g=35661,v=35660,y=34930,x=36349,w=34076,k=34024,A=7936,_=7937,T=7938,E=35724,j=34047,S=36063,D=34852;t.exports=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(j));var C=1,O=1;return t.webgl_draw_buffers&&(C=e.getParameter(D),O=e.getParameter(S)),{colorBits:[e.getParameter(i),e.getParameter(a),e.getParameter(o),e.getParameter(f)],depthBits:e.getParameter(u),stencilBits:e.getParameter(s),subpixelBits:e.getParameter(r),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:C,maxColorAttachments:O,pointSizeDims:e.getParameter(c),lineWidthDims:e.getParameter(l),maxViewportDims:e.getParameter(d),maxCombinedTextureUnits:e.getParameter(g),maxCubeMapSize:e.getParameter(w),maxRenderbufferSize:e.getParameter(k),maxTextureUnits:e.getParameter(y),maxTextureSize:e.getParameter(p),maxAttributes:e.getParameter(m),maxVertexUniforms:e.getParameter(h),maxVertexTextureUnits:e.getParameter(v),maxVaryingVectors:e.getParameter(b),maxFragmentUniforms:e.getParameter(x),glsl:e.getParameter(E),renderer:e.getParameter(_),vendor:e.getParameter(A),version:e.getParameter(T)}}},{}],13:[function(e,t,n){var r=e("./util/check"),i=e("./util/is-typed-array"),a=6408,o=5121,f=3333,u=5126;t.exports=function(e,t,n,s,c,l){function p(p){var d;null===t.next?(r(c.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),d=o):(r(null!==t.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),d=t.next.colorAttachments[0].texture._texture.type,l.oes_texture_float?r(d===o||d===u,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):r(d===o,"Reading from a framebuffer is only allowed for the type 'uint8'"));var m=0,h=0,b=s.framebufferWidth,g=s.framebufferHeight,v=null;i(p)?v=p:p&&(r.type(p,"object","invalid arguments to regl.read()"),m=0|p.x,h=0|p.y,r(m>=0&&m<s.framebufferWidth,"invalid x offset for regl.read"),r(h>=0&&h<s.framebufferHeight,"invalid y offset for regl.read"),b=0|(p.width||s.framebufferWidth-m),g=0|(p.height||s.framebufferHeight-h),v=p.data||null),v&&(d===o?r(v instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):d===u&&r(v instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),r(b>0&&b+m<=s.framebufferWidth,"invalid width for read pixels"),r(g>0&&g+h<=s.framebufferHeight,"invalid height for read pixels"),n();var y=b*g*4;return v||(d===o?v=new Uint8Array(y):d===u&&(v=v||new Float32Array(y))),r.isTypedArray(v,"data buffer for regl.read() must be a typedarray"),r(v.byteLength>=y,"data buffer for regl.read() too small"),e.pixelStorei(f,4),e.readPixels(m,h,b,g,a,d,v),v}return p}},{"./util/check":20,"./util/is-typed-array":26}],14:[function(e,t,n){function r(e,t,n){return g[e]*t*n}var i=e("./util/check"),a=e("./util/values"),o=36161,f=32854,u=32855,s=36194,c=33189,l=36168,p=34041,d=35907,m=34836,h=34842,b=34843,g=[];g[f]=2,g[u]=2,g[s]=2,g[c]=2,g[l]=1,g[p]=4,g[d]=4,g[m]=16,g[h]=8,g[b]=6,t.exports=function(e,t,n,g,v){function y(e){this.id=A++,this.refCount=1,this.renderbuffer=e,this.format=f,this.width=0,this.height=0,v.profile&&(this.stats={size:0})}function x(t){var n=t.renderbuffer;i(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(o,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete _[t.id],g.renderbufferCount--}function w(t,a){function u(t,a){var s=0,l=0,p=f;if("object"==typeof t&&t){var d=t;if("shape"in d){var m=d.shape;i(Array.isArray(m)&&m.length>=2,"invalid renderbuffer shape"),s=0|m[0],l=0|m[1]}else"radius"in d&&(s=l=0|d.radius),"width"in d&&(s=0|d.width),"height"in d&&(l=0|d.height);"format"in d&&(i.parameter(d.format,k,"invalid renderbuffer format"),p=k[d.format])}else"number"==typeof t?(s=0|t,l="number"==typeof a?0|a:s):t?i.raise("invalid arguments to renderbuffer constructor"):s=l=1;if(i(s>0&&l>0&&s<=n.maxRenderbufferSize&&l<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||l!==c.height||p!==c.format)return u.width=c.width=s,u.height=c.height=l,c.format=p,e.bindRenderbuffer(o,c.renderbuffer),e.renderbufferStorage(o,p,s,l),v.profile&&(c.stats.size=r(c.format,c.width,c.height)),u}function s(t,a){var f=0|t,s=0|a||f;return f===c.width&&s===c.height?u:(i(f>0&&s>0&&f<=n.maxRenderbufferSize&&s<=n.maxRenderbufferSize,"invalid renderbuffer size"),u.width=c.width=f,u.height=c.height=s,e.bindRenderbuffer(o,c.renderbuffer),e.renderbufferStorage(o,c.format,f,s),v.profile&&(c.stats.size=r(c.format,c.width,c.height)),u)}var c=new y(e.createRenderbuffer());return _[c.id]=c,g.renderbufferCount++,u(t,a),u.resize=s,u._reglType="renderbuffer",u._renderbuffer=c,v.profile&&(u.stats=c.stats),u.destroy=function(){c.decRef()},u}var k={rgba4:f,rgb565:s,"rgb5 a1":u,depth:c,stencil:l,"depth stencil":p};t.ext_srgb&&(k.srgba=d),t.ext_color_buffer_half_float&&(k.rgba16f=h,k.rgb16f=b),t.webgl_color_buffer_float&&(k.rgba32f=m);var A=0,_={};return y.prototype.decRef=function(){--this.refCount<=0&&x(this)},v.profile&&(g.getTotalRenderbufferSize=function(){var e=0;return Object.keys(_).forEach(function(t){e+=_[t].stats.size}),e}),{create:w,clear:function(){a(_).forEach(x)}}}},{"./util/check":20,"./util/values":31}],15:[function(e,t,n){var r=e("./util/check"),i=e("./util/values"),a=35632,o=35633,f=35718,u=35721;t.exports=function(e,t,n,s){function c(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function l(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function p(n,i,o){var f=n===a?h:b,u=f[i];if(!u){var s=t.str(i);u=e.createShader(n),e.shaderSource(u,s),e.compileShader(u),r.shaderError(e,u,s,n,o),f[i]=u}return u}function d(e,t){this.id=y++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],s.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function m(n,i){var d,m,h=p(a,n.fragId),b=p(o,n.vertId),g=n.program=e.createProgram();e.attachShader(g,h),e.attachShader(g,b),e.linkProgram(g),r.linkError(e,g,t.str(n.fragId),t.str(n.vertId),i);var v=e.getProgramParameter(g,f);s.profile&&(n.stats.uniformsCount=v);var y=n.uniforms;for(d=0;d<v;++d)if(m=e.getActiveUniform(g,d))if(m.size>1)for(var x=0;x<m.size;++x){var w=m.name.replace("[0]","["+x+"]");l(y,new c(w,t.id(w),e.getUniformLocation(g,w),m))}else l(y,new c(m.name,t.id(m.name),e.getUniformLocation(g,m.name),m));var k=e.getProgramParameter(g,u);s.profile&&(n.stats.attributesCount=k);var A=n.attributes;for(d=0;d<k;++d)m=e.getActiveAttrib(g,d),m&&l(A,new c(m.name,t.id(m.name),e.getAttribLocation(g,m.name),m))}var h={},b={},g={},v=[],y=0;return s.profile&&(n.getMaxUniformsCount=function(){var e=0;return v.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return v.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);i(h).forEach(t),h={},i(b).forEach(t),b={},v.forEach(function(t){e.deleteProgram(t.program)}),v.length=0,g={},n.shaderCount=0},program:function(e,t,i){r(e>=0,"missing vertex shader"),r(t>=0,"missing fragment shader"),n.shaderCount++;var a=g[t];a||(a=g[t]={});var o=a[e];return o||(o=new d(t,e),m(o,i),a[e]=o,v.push(o)),o},shader:p,frag:null,vert:null}}},{"./util/check":20,"./util/values":31}],16:[function(e,t,n){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,
cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],17:[function(e,t,n){t.exports=function(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r?r:(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}},{}],18:[function(e,t,n){function r(e){return"[object "+e+"]"}function i(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function a(e){if(!Array.isArray(e))return!1;var t=e.length;return!(0===t||!j(e[0]))}function o(e){return Object.prototype.toString.call(e)}function f(e){return o(e)===We}function u(e){return o(e)===Ue}function s(e){return o(e)===Ne}function c(e){return o(e)===qe}function l(e){if(!e)return!1;var t=o(e);return Qe.indexOf(t)>=0||(i(e)||a(e)||_(e))}function p(e){return 0|D[Object.prototype.toString.call(e)]}function d(e,t){var n=e.width*e.height*e.channels;switch(x(t.length===n,"inconsistent array length for texture"),e.type){case se:case ce:case le:case pe:var r=T.allocType(e.type,n);r.set(t),e.data=r;break;case $:e.data=E(t);break;default:x.raise("unsupported texture type, must specify a typed array")}}function m(e,t){return T.allocType(e.type===$?pe:e.type,t)}function h(e,t){e.type===$?(e.data=E(t),T.freeType(t)):e.data=t}function b(e,t,n,r,i,a){for(var o=e.width,f=e.height,u=e.channels,s=o*f*u,c=m(e,s),l=0,p=0;p<f;++p)for(var d=0;d<o;++d)for(var b=0;b<u;++b)c[l++]=t[n*d+r*p+i*b+a];h(e,c)}function g(e,t,n,r){for(var i=n*r,a=m(e,i),o=0,f=0;f<r;++f)for(var u=t[f],s=0;s<n;++s)a[o++]=u[s];h(e,a)}function v(e,t,n,r,i){for(var a=n*r*i,o=m(e,a),f=0,u=0;u<r;++u)for(var s=t[u],c=0;c<n;++c)for(var l=s[c],p=0;p<i;++p)o[f++]=l[p];h(e,o)}function y(e,t,n,r,i,a){var o;if(o="undefined"!=typeof Ve[e]?Ve[e]:Ie[e]*Ge[t],a&&(o*=6),i){for(var f=0,u=n;u>=1;)f+=o*u*u,u/=2;return f}return o*n*r}var x=e("./util/check"),w=e("./util/extend"),k=e("./util/values"),A=e("./util/is-typed-array"),_=e("./util/is-ndarray"),T=e("./util/pool"),E=e("./util/to-half-float"),j=e("./util/is-array-like"),S=e("./constants/arraytypes.json"),D=e("./constants/arraytypes.json"),C=34467,O=3553,F=34067,z=34069,P=6408,B=6406,M=6407,L=6409,R=6410,I=32854,H=32855,W=36194,U=32819,N=32820,q=33635,Q=34042,G=6402,V=34041,Y=35904,X=35906,$=36193,K=33776,J=33777,Z=33778,ee=33779,te=35986,ne=35987,re=34798,ie=35840,ae=35841,oe=35842,fe=35843,ue=36196,se=5121,ce=5123,le=5125,pe=5126,de=10242,me=10243,he=10497,be=33071,ge=33648,ve=10240,ye=10241,xe=9728,we=9729,ke=9984,Ae=9985,_e=9986,Te=9987,Ee=33170,je=4352,Se=4353,De=4354,Ce=34046,Oe=3317,Fe=37440,ze=37441,Pe=37443,Be=37444,Me=33984,Le=[ke,_e,Ae,Te],Re=[0,L,R,M,P],Ie={};Ie[L]=Ie[B]=Ie[G]=1,Ie[V]=Ie[R]=2,Ie[M]=Ie[Y]=3,Ie[P]=Ie[X]=4;var He={};He[I]=U,He[W]=q,He[H]=N,He[G]=le,He[V]=Q;var We=r("HTMLCanvasElement"),Ue=r("CanvasRenderingContext2D"),Ne=r("HTMLImageElement"),qe=r("HTMLVideoElement"),Qe=Object.keys(S).concat([We,Ue,Ne,qe]),Ge=[];Ge[se]=1,Ge[pe]=4,Ge[$]=2,Ge[ce]=2,Ge[le]=4;var Ve=[];Ve[I]=2,Ve[H]=2,Ve[W]=2,Ve[V]=4,Ve[K]=.5,Ve[J]=.5,Ve[Z]=1,Ve[ee]=1,Ve[te]=.5,Ve[ne]=1,Ve[re]=1,Ve[ie]=.5,Ve[ae]=.25,Ve[oe]=.5,Ve[fe]=.25,Ve[ue]=.5,t.exports=function(e,t,n,r,o,m,h){function E(){this.internalformat=P,this.format=P,this.type=se,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=0,this.width=0,this.height=0,this.channels=4}function S(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function D(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(x.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(x.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(x.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(x.parameter(t.colorSpace,ht,"invalid colorSpace"),e.colorSpace=ht[t.colorSpace]),"type"in t){var r=t.type;x.parameter(r,bt,"invalid texture type"),e.type=bt[r]}var i=e.width,a=e.height,o=e.channels,f=!1;"shape"in t?(x(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],a=t.shape[1],3===t.shape.length&&(o=t.shape[2],x(o>0&&o<=4,"invalid number of channels"),f=!0),x(i>=0&&i<=n.maxTextureSize,"invalid width"),x(a>=0&&a<=n.maxTextureSize,"invalid height")):("radius"in t&&(i=a=t.radius,x(i>=0&&i<=n.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,x(i>=0&&i<=n.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,x(a>=0&&a<=n.maxTextureSize,"invalid height")),"channels"in t&&(o=t.channels,x(o>0&&o<=4,"invalid number of channels"),f=!0)),e.width=0|i,e.height=0|a,e.channels=0|o;var u=!1;if("format"in t){var s=t.format;x.parameter(s,gt,"invalid texture format");var c=e.internalformat=gt[s];e.format=wt[c],s in bt&&("type"in t||(e.type=bt[s])),s in vt&&(e.compressed=!0),u=!0}!f&&u?e.channels=Ie[e.format]:f&&!u?e.channels!==Re[e.format]&&(e.format=e.internalformat=Re[e.channels]):u&&f&&x(e.channels===Ie[e.format],"number of channels inconsistent with specified format")}}function He(t){e.pixelStorei(Fe,t.flipY),e.pixelStorei(ze,t.premultiplyAlpha),e.pixelStorei(Pe,t.colorSpace),e.pixelStorei(Oe,t.unpackAlignment)}function We(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Ue(e,t){var r=null;if(l(t)?r=t:t&&(x.type(t,"object","invalid pixel data type"),D(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),l(t.data)&&(r=t.data)),x(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),t.copy){x(!r,"can not specify copy and data field for the same texture");var m=o.viewportWidth,h=o.viewportHeight;e.width=e.width||m-e.xOffset,e.height=e.height||h-e.yOffset,e.needsCopy=!0,x(e.xOffset>=0&&e.xOffset<m&&e.yOffset>=0&&e.yOffset<h&&e.width>0&&e.width<=m&&e.height>0&&e.height<=h,"copy texture read out of bounds")}else if(r){if(A(r))e.data=r,"type"in t||e.type!==se||(e.type=p(r));else if(i(r))d(e,r),e.alignment=1,e.needsFree=!0;else if(_(r)){var y=r.data;Array.isArray(y)||e.type!==se||(e.type=p(y));var w,k,T,E,S,C,O=r.shape,F=r.stride;3===O.length?(T=O[2],C=F[2]):(x(2===O.length,"invalid ndarray pixel data, must be 2 or 3D"),T=1,C=1),w=O[0],k=O[1],E=F[0],S=F[1],e.alignment=1,e.width=w,e.height=k,e.channels=T,e.format=e.internalformat=Re[T],e.needsFree=!0,b(e,y,E,S,C,r.offset)}else if(f(r)||u(r))f(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height;else if(s(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight;else if(c(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.needsPoll=!0;else if(a(r)){var z=r[0].length,P=r.length,B=1;j(r[0][0])?(B=r[0][0].length,v(e,r,z,P,B)):g(e,r,z,P),e.alignment=1,e.width=z,e.height=P,e.channels=B,e.format=e.internalformat=Re[B],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1;e.type===pe?x(n.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===$&&x(n.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ne(t,n,i){var a=t.element,o=t.data,f=t.internalformat,u=t.format,s=t.type,c=t.width,l=t.height;He(t),a?e.texImage2D(n,i,u,u,s,a):t.compressed?e.compressedTexImage2D(n,i,f,c,l,0,o):t.needsCopy?(r(),e.copyTexImage2D(n,i,u,t.xOffset,t.yOffset,c,l,0)):e.texImage2D(n,i,u,c,l,0,u,s,o)}function qe(t,n,i,a,o){var f=t.element,u=t.data,s=t.internalformat,c=t.format,l=t.type,p=t.width,d=t.height;He(t),f?e.texSubImage2D(n,o,i,a,c,l,f):t.compressed?e.compressedTexSubImage2D(n,o,i,a,s,p,d,u):t.needsCopy?(r(),e.copyTexSubImage2D(n,o,i,a,t.xOffset,t.yOffset,p,d)):e.texSubImage2D(n,o,i,a,p,d,c,l,u)}function Qe(){return kt.pop()||new We}function Ge(e){e.needsFree&&T.freeType(e.data),We.call(e),kt.push(e)}function Ve(){E.call(this),this.genMipmaps=!1,this.mipmapHint=je,this.mipmask=0,this.images=Array(16)}function Ye(e,t,n){var r=e.images[0]=Qe();e.mipmask=1,r.width=e.width=t,r.height=e.height=n}function Xe(e,t){var n=null;if(l(t))n=e.images[0]=Qe(),S(n,e),Ue(n,t),e.mipmask=1;else if(D(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)n=e.images[i]=Qe(),S(n,e),n.width>>=i,n.height>>=i,Ue(n,r[i]),e.mipmask|=1<<i;else n=e.images[0]=Qe(),S(n,e),Ue(n,t),e.mipmask=1;S(e,e.images[0]),(e.compressed&&e.internalformat===K||e.internalformat===J||e.internalformat===Z||e.internalformat===ee)&&x(e.width%4===0&&e.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function $e(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;Ne(n[r],t,r)}}function Ke(){var e=At.pop()||new Ve;E.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Je(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&Ge(t[n]),t[n]=null;At.push(e)}function Ze(){this.minFilter=xe,this.magFilter=xe,this.wrapS=be,this.wrapT=be,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=je}function et(e,t){if("min"in t){var r=t.min;x.parameter(r,mt),e.minFilter=mt[r],Le.indexOf(e.minFilter)>=0&&(e.genMipmaps=!0)}if("mag"in t){var i=t.mag;x.parameter(i,dt),e.magFilter=dt[i]}var a=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(x.parameter(f,pt),a=o=pt[f]):Array.isArray(f)&&(x.parameter(f[0],pt),x.parameter(f[1],pt),a=pt[f[0]],o=pt[f[1]])}else{if("wrapS"in t){var u=t.wrapS;x.parameter(u,pt),a=pt[u]}if("wrapT"in t){var s=t.wrapT;x.parameter(s,pt),o=pt[s]}}if(e.wrapS=a,e.wrapT=o,"anisotropic"in t){var c=t.anisotropic;x("number"==typeof c&&c>=1&&c<=n.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var l=!1;switch(typeof t.mipmap){case"string":x.parameter(t.mipmap,lt,"invalid mipmap hint"),e.mipmapHint=lt[t.mipmap],e.genMipmaps=!0,l=!0;break;case"boolean":l=e.genMipmaps=t.mipmap;break;case"object":x(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,l=!0;break;default:x.raise("invalid mipmap type")}!l||"min"in t||(e.minFilter=ke)}}function tt(n,r){e.texParameteri(r,ye,n.minFilter),e.texParameteri(r,ve,n.magFilter),e.texParameteri(r,de,n.wrapS),e.texParameteri(r,me,n.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,Ce,n.anisotropic),n.genMipmaps&&(e.hint(Ee,n.mipmapHint),e.generateMipmap(r))}function nt(){var e=_t.pop()||new Ze;return Ze.call(e),e}function rt(e){_t.push(e)}function it(t){E.call(this),this.mipmask=0,this.internalformat=P,this.id=Tt++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,h.profile&&(this.stats={size:0})}function at(t){e.activeTexture(Me),e.bindTexture(t.target,t.texture)}function ot(){var t=St[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(O,null)}function ft(t){var n=t.texture;x(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(Me+r),e.bindTexture(i,null),St[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete Et[t.id],m.textureCount--}function ut(t,r){function i(e,t){var r=nt(),a=Ke();return"number"==typeof e?"number"==typeof t?Ye(a,0|e,0|t):Ye(a,0|e,0|e):e?(x.type(e,"object","invalid arguments to regl.texture"),et(r,e),Xe(a,e)):Ye(a,1,1),r.genMipmaps&&(a.mipmask=(a.width<<1)-1),f.mipmask=a.mipmask,S(f,a),x.texture2D(r,a,n),f.internalformat=a.internalformat,i.width=a.width,i.height=a.height,at(f),$e(a,O),tt(r,O),ot(),rt(r),Je(a),h.profile&&(f.stats.size=y(f.internalformat,f.type,a.width,a.height,r.genMipmaps,!1)),i}function a(e,t,n,r){x(!!e,"must specify image data");var a=0|t,o=0|n,u=0|r,s=Qe();return S(s,f),s.width>>=u,s.height>>=u,s.width-=a,s.height-=o,Ue(s,e),x(f.type===s.type&&f.format===s.format&&f.internalformat===s.internalformat,"incompatible format for texture.subimage"),x(a>=0&&o>=0&&a+s.width<=f.width&&o+s.height<=f.height,"texture.subimage write out of bounds"),x(f.mipmask&1<<u,"missing mipmap data"),x(s.data||s.element||s.needsCopy,"missing image data"),at(f),qe(s,O,a,o,u),ot(),Ge(s),i}function o(t,n){var r=0|t,a=0|n||r;if(r===f.width&&a===f.height)return i;i.width=f.width=r,i.height=f.height=a,at(f);for(var o=0;f.mipmask>>o;++o)e.texImage2D(O,o,f.format,r>>o,a>>o,0,f.format,f.type,null);return ot(),h.profile&&(f.stats.size=y(f.internalformat,f.type,r,a,!1,!1)),i}var f=new it(O);return Et[f.id]=f,m.textureCount++,i(t,r),i.subimage=a,i.resize=o,i._reglType="texture2d",i._texture=f,h.profile&&(i.stats=f.stats),i.destroy=function(){f.decRef()},i}function st(t,r,i,a,o,f){function u(e,t,r,i,a,o){var f,s=nt();for(f=0;f<6;++f)p[f]=Ke();if("number"!=typeof e&&e)if("object"==typeof e)if(t)Xe(p[0],e),Xe(p[1],t),Xe(p[2],r),Xe(p[3],i),Xe(p[4],a),Xe(p[5],o);else if(et(s,e),D(l,e),"faces"in e){var c=e.faces;for(x(Array.isArray(c)&&6===c.length,"cube faces must be a length 6 array"),f=0;f<6;++f)x("object"==typeof c[f]&&!!c[f],"invalid input for cube map face"),S(p[f],l),Xe(p[f],c[f])}else for(f=0;f<6;++f)Xe(p[f],e);else x.raise("invalid arguments to cube map");else{var d=0|e||1;for(f=0;f<6;++f)Ye(p[f],d,d)}for(S(l,p[0]),s.genMipmaps?l.mipmask=(p[0].width<<1)-1:l.mipmask=p[0].mipmask,x.textureCube(l,s,p,n),l.internalformat=p[0].internalformat,u.width=p[0].width,u.height=p[0].height,at(l),f=0;f<6;++f)$e(p[f],z+f);for(tt(s,F),ot(),h.profile&&(l.stats.size=y(l.internalformat,l.type,u.width,u.height,s.genMipmaps,!0)),rt(s),f=0;f<6;++f)Je(p[f]);return u}function s(e,t,n,r,i){x(!!t,"must specify image data"),x("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var a=0|n,o=0|r,f=0|i,s=Qe();return S(s,l),s.width>>=f,s.height>>=f,s.width-=a,s.height-=o,Ue(s,t),x(l.type===s.type&&l.format===s.format&&l.internalformat===s.internalformat,"incompatible format for texture.subimage"),x(a>=0&&o>=0&&a+s.width<=l.width&&o+s.height<=l.height,"texture.subimage write out of bounds"),x(l.mipmask&1<<f,"missing mipmap data"),x(s.data||s.element||s.needsCopy,"missing image data"),at(l),qe(s,z+e,a,o,f),ot(),Ge(s),u}function c(t){var n=0|t;if(n!==l.width){u.width=l.width=n,u.height=l.height=n,at(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)e.texImage2D(z+r,r,l.format,n>>r,n>>r,0,l.format,l.type,null);return ot(),h.profile&&(l.stats.size=y(l.internalformat,l.type,u.width,u.height,!1,!0)),u}}var l=new it(F);Et[l.id]=l,m.cubeCount++;var p=new Array(6);return u(t,r,i,a,o,f),u.subimage=s,u.resize=c,u._reglType="textureCube",u._texture=l,h.profile&&(u.stats=l.stats),u.destroy=function(){l.decRef()},u}function ct(){for(var t=0;t<jt;++t)e.activeTexture(Me+t),e.bindTexture(O,null),St[t]=null;k(Et).forEach(ft),m.cubeCount=0,m.textureCount=0}var lt={"don't care":je,"dont care":je,nice:De,fast:Se},pt={repeat:he,clamp:be,mirror:ge},dt={nearest:xe,linear:we},mt=w({"nearest mipmap nearest":ke,"linear mipmap nearest":Ae,"nearest mipmap linear":_e,"linear mipmap linear":Te,mipmap:Te},dt),ht={none:0,browser:Be},bt={uint8:se,rgba4:U,rgb565:q,"rgb5 a1":N},gt={alpha:B,luminance:L,"luminance alpha":R,rgb:M,rgba:P,rgba4:I,"rgb5 a1":H,rgb565:W},vt={};t.ext_srgb&&(gt.srgb=Y,gt.srgba=X),t.oes_texture_float&&(bt.float=pe),t.oes_texture_half_float&&(bt.float16=bt["half float"]=$),t.webgl_depth_texture&&(w(gt,{depth:G,"depth stencil":V}),w(bt,{uint16:ce,uint32:le,"depth stencil":Q})),t.webgl_compressed_texture_s3tc&&w(vt,{"rgb s3tc dxt1":K,"rgba s3tc dxt1":J,"rgba s3tc dxt3":Z,"rgba s3tc dxt5":ee}),t.webgl_compressed_texture_atc&&w(vt,{"rgb atc":te,"rgba atc explicit alpha":ne,"rgba atc interpolated alpha":re}),t.webgl_compressed_texture_pvrtc&&w(vt,{"rgb pvrtc 4bppv1":ie,"rgb pvrtc 2bppv1":ae,"rgba pvrtc 4bppv1":oe,"rgba pvrtc 2bppv1":fe}),t.webgl_compressed_texture_etc1&&(vt["rgb etc1"]=ue);var yt=Array.prototype.slice.call(e.getParameter(C));Object.keys(vt).forEach(function(e){var t=vt[e];yt.indexOf(t)>=0&&(gt[e]=t)});var xt=Object.keys(gt);n.textureFormats=xt;var wt=xt.reduce(function(e,t){var n=gt[t];return n===L||n===B||n===L||n===R||n===G||n===V?e[n]=n:n===H||t.indexOf("rgba")>=0?e[n]=P:e[n]=M,e},{}),kt=[],At=[],_t=[],Tt=0,Et={},jt=n.maxTextureUnits,St=Array(jt).map(function(){return null});return w(it.prototype,{bind:function(){var t=this;t.bindCount+=1;var n=t.unit;if(n<0){for(var r=0;r<jt;++r){var i=St[r];if(i){if(i.bindCount>0)continue;i.unit=-1}St[r]=t,n=r;break}n>=jt&&x.raise("insufficient number of texture units"),h.profile&&m.maxTextureUnits<n+1&&(m.maxTextureUnits=n+1),t.unit=n,e.activeTexture(Me+n),e.bindTexture(t.target,t.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ft(this)}}),h.profile&&(m.getTotalTextureSize=function(){var e=0;return Object.keys(Et).forEach(function(t){e+=Et[t].stats.size}),e}),{create2D:ut,createCube:st,clear:ct,getTexture:function(e){return null}}}},{"./constants/arraytypes.json":3,"./util/check":20,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],19:[function(e,t,n){var r=34918,i=34919,a=35007;t.exports=function(e,t){function n(){return h.pop()||m.createQueryEXT()}function o(e){h.push(e)}function f(e){var t=n();m.beginQueryEXT(a,t),b.push(t),p(b.length-1,b.length,e)}function u(){m.endQueryEXT(a)}function s(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}function c(){return g.pop()||new s}function l(e){g.push(e)}function p(e,t,n){var r=c();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,v.push(r)}function d(){var e,t,n=b.length;if(0!==n){x.length=Math.max(x.length,n+1),y.length=Math.max(y.length,n+1),y[0]=0,x[0]=0;var a=0;for(e=0,t=0;t<b.length;++t){var f=b[t];m.getQueryObjectEXT(f,i)?(a+=m.getQueryObjectEXT(f,r),o(f)):b[e++]=f,y[t+1]=a,x[t+1]=e}for(b.length=e,e=0,t=0;t<v.length;++t){var u=v[t],s=u.startQueryIndex,c=u.endQueryIndex;u.sum+=y[c]-y[s];var p=x[s],d=x[c];d===p?(u.stats.gpuTime+=u.sum/1e6,l(u)):(u.startQueryIndex=p,u.endQueryIndex=d,v[e++]=u)}v.length=e}}var m=t.ext_disjoint_timer_query;if(!m)return null;var h=[],b=[],g=[],v=[],y=[],x=[];return{beginQuery:f,endQuery:u,pushScopeStats:p,update:d,getNumPendingQueries:function(){return b.length},clear:function(){h.push.apply(h,b);for(var e=0;e<h.length;e++)m.deleteQueryEXT(h[e]);b.length=0,h.length=0}}}},{}],20:[function(e,t,n){function r(e){return"undefined"!=typeof btoa?btoa(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function a(e,t){e||i(t)}function o(e){return e?": "+e:""}function f(e,t,n){e in t||i("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())}function u(e,t){M(e)||i("invalid parameter type"+o(t)+". must be a typed array")}function s(e,t,n){typeof e!==t&&i("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)}function c(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")}function l(e,t,n){t.indexOf(e)<0&&i("invalid value"+o(n)+". must be one of: "+t)}function p(e){Object.keys(e).forEach(function(e){R.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+R)})}function d(e,t){for(e+="";e.length<t;)e=" "+e;return e}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function h(e,t){this.number=e,this.line=t,this.errors=[]}function b(e,t,n){this.file=e,this.line=t,this.message=n}function g(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function y(e,t){var n=e.split("\n"),i=1,a=0,o={unknown:new m,0:new m};o.unknown.name=o[0].name=t||g(),o.unknown.lines.push(new h(0,""));for(var f=0;f<n.length;++f){var u=n[f],s=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(u);if(s)switch(s[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(s[2]);c&&(i=0|c[1],c[2]&&(a=0|c[2],a in o||(o[a]=new m)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(s[2]);l&&(o[a].name=l[1]?r(l[2]):l[2])}o[a].lines.push(new h(i++,u))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function x(e){var t=[];return e.split("\n").forEach(function(e){var n=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);n?t.push(new b(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new b("unknown",0,e))}),t}function w(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}function k(e,t,n,r,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),f=r===e.FRAGMENT_SHADER?"fragment":"vertex",u=y(n,i),s=x(o);w(u,s),Object.keys(u).forEach(function(e){function t(e,t){r.push(e),i.push(t||"")}var n=u[e];if(n.hasErrors){var r=[""],i=[""];t("file number "+e+": "+n.name+"\n","color:red;text-decoration:underline;font-weight:bold"),n.lines.forEach(function(e){if(e.errors.length>0){t(d(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),t(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var n=0;e.errors.forEach(function(r){var i=r.message,a=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(i);if(a){var o=a[1];switch(i=a[2],o){case"assign":o="="}n=Math.max(e.line.indexOf(o,n),0)}else n=0;t(d("| ",6)),t(d("^^^",n+3)+"\n","font-weight:bold"),t(d("| ",6)),t(i+"\n","font-weight:bold")}),t(d("| ",6)+"\n")}else t(d(e.number,4)+"|  "),t(e.line+"\n","color:red")}),"undefined"!=typeof document?(i[0]=r.join("%c"),console.log.apply(console,i)):console.log(r.join(""))}}),a.raise("Error compiling "+f+" shader, "+u[0].name)}}function A(e,t,n,r,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),f=y(n,i),u=y(r,i),s='Error linking program with vertex shader, "'+u[0].name+'", and fragment shader "'+f[0].name+'"';"undefined"!=typeof document?console.log("%c"+s+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(s+"\n"+o),a.raise(s)}}function _(e){e._commandRef=g()}function T(e,t,n,r){function i(e){return e?r.id(e):0}function a(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}_(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var f=e._attributeSet={};a(f,n.static),a(f,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function E(e,t){var n=v();i(e+" in command "+(t||g())+("unknown"===n?"":" called from "+n))}function j(e,t,n){e||E(t,n||g())}function S(e,t,n,r){e in t||E("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||g())}function D(e,t,n,r){typeof e!==t&&E("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||g())}function C(e){e()}function O(e,t,n){e.texture?l(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):l(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}function F(e,t){return e===Z||e===J||e===ee?2:e===te?4:re[e]*t}function z(e){return!(e&e-1||!e)}function P(e,t,n){var r,i=t.width,o=t.height,f=t.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),e.wrapS===I&&e.wrapT===I||a(z(i)&&z(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&a(e.minFilter!==W&&e.minFilter!==N&&e.minFilter!==U&&e.minFilter!==q,"min filter requires mipmap"):(a(z(i)&&z(o),"texture must be a square power of 2 to support mipmapping"),a(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===K&&(n.extensions.indexOf("oes_texture_float_linear")<0&&a(e.minFilter===H&&e.magFilter===H,"filter not supported, must enable oes_texture_float_linear"),a(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var s=i>>r,c=o>>r;a(t.mipmask&1<<r,"missing mipmap data");var l=u[r];a(l.width===s&&l.height===c,"invalid shape for mip images"),a(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed||(l.data?a(l.data.byteLength===s*c*Math.max(F(l.type,f),l.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):l.element||l.copy)}else e.genMipmaps||a(0===(t.mipmask&1<<r),"extra mipmap data");t.compressed&&a(!e.genMipmaps,"mipmap generation for compressed images not supported")}function B(e,t,n,r){var i=e.width,o=e.height,f=e.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(t.wrapS===I&&t.wrapT===I,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var s=n[u];a(s.width===i&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(a(!s.compressed,"can not generate mipmap for compressed textures"),a(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var p=c[l];if(p){var d=i>>l,m=o>>l;a(s.mipmask&1<<l,"missing mipmap data"),a(p.width===d&&p.height===m,"invalid shape for mip images"),a(p.format===e.format&&p.internalformat===e.internalformat&&p.type===e.type,"incompatible type for mip image"),p.compressed||(p.data?a(p.data.byteLength===d*m*Math.max(F(p.type,f),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):p.element||p.copy)}}}}var M=e("./is-typed-array"),L=e("./extend"),R=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"],I=33071,H=9728,W=9984,U=9985,N=9986,q=9987,Q=5120,G=5121,V=5122,Y=5123,X=5124,$=5125,K=5126,J=32819,Z=32820,ee=33635,te=34042,ne=36193,re={};re[Q]=re[G]=1,re[V]=re[Y]=re[ne]=re[ee]=re[J]=re[Z]=2,re[X]=re[$]=re[K]=re[te]=4,t.exports=L(a,{optional:C,raise:i,commandRaise:E,command:j,parameter:f,commandParameter:S,constructor:p,type:s,commandType:D,isTypedArray:u,nni:c,oneOf:l,shaderError:k,linkError:A,callSite:v,saveCommandRef:_,saveDrawInfo:T,framebufferFormat:O,guessCommand:g,texture2D:P,textureCube:B})},{"./extend":23,"./is-typed-array":26}],21:[function(e,t,n){t.exports="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(e,t,n){function r(e){return Array.prototype.slice.call(e)}function i(e){return r(e).join("")}var a=e("./extend");t.exports=function(){function e(e){for(var t=0;t<l.length;++t)if(l[t]===e)return c[t];var n="g"+s++;return c.push(n),l.push(e),n}function t(){function e(){n.push.apply(n,r(arguments))}function t(){var e="v"+s++;return o.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,r(arguments)),n.push(";")),e}var n=[],o=[];return a(e,{def:t,toString:function(){return i([o.length>0?"var "+o+";":"",i(n)])}})}function n(){function e(e,t){i(e,t,"=",n.def(e,t),";")}var n=t(),i=t(),o=n.toString,f=i.toString;return a(function(){n.apply(n,r(arguments))},{def:n.def,entry:n,exit:i,save:e,set:function(t,r,i){e(t,r),n(t,r,"=",i,";")},toString:function(){return o()+f()}})}function o(){var e=i(arguments),t=n(),o=n(),f=t.toString,u=o.toString;return a(t,{then:function(){return t.apply(t,r(arguments)),this},else:function(){return o.apply(o,r(arguments)),this},toString:function(){var t=u();return t&&(t="else{"+t+"}"),i(["if(",e,"){",f(),"}",t])}})}function f(e,t){function r(){var e="a"+o.length;return o.push(e),e}var o=[];t=t||0;for(var f=0;f<t;++f)r();var u=n(),s=u.toString,c=d[e]=a(u,{arg:r,toString:function(){return i(["function(",o.join(),"){",s(),"}"])}});return c}function u(){var e=['"use strict";',p,"return {"];Object.keys(d).forEach(function(t){e.push('"',t,'":',d[t].toString(),",")}),e.push("}");var t=i(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),n=Function.apply(null,c.concat(t));return n.apply(null,l)}var s=0,c=[],l=[],p=t(),d={};return{global:p,link:e,block:t,proc:f,scope:n,cond:o,compile:u}}},{"./extend":23}],23:[function(e,t,n){t.exports=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e}},{}],24:[function(e,t,n){var r=e("./is-typed-array");t.exports=function(e){return Array.isArray(e)||r(e)}},{"./is-typed-array":26}],25:[function(e,t,n){var r=e("./is-typed-array");t.exports=function(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||r(e.data))}},{"./is-typed-array":26}],26:[function(e,t,n){var r=e("../constants/arraytypes.json");t.exports=function(e){return Object.prototype.toString.call(e)in r}},{"../constants/arraytypes.json":3}],27:[function(e,t,n){t.exports=function(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}},{}],28:[function(e,t,n){function r(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function i(e){var t,n;return t=(e>65535)<<4,e>>>=t,n=(e>255)<<3,e>>>=n,t|=n,n=(e>15)<<2,e>>>=n,t|=n,n=(e>3)<<1,e>>>=n,t|=n,t|e>>1}function a(e){var t=r(e),n=g[i(t)>>2];return n.length>0?n.pop():new ArrayBuffer(t)}function o(e){g[i(e.byteLength)>>2].push(e)}function f(e,t){var n=null;switch(e){case c:n=new Int8Array(a(t),0,t);break;case l:n=new Uint8Array(a(t),0,t);break;case p:n=new Int16Array(a(2*t),0,t);break;case d:n=new Uint16Array(a(2*t),0,t);break;case m:n=new Int32Array(a(4*t),0,t);break;case h:n=new Uint32Array(a(4*t),0,t);break;case b:n=new Float32Array(a(4*t),0,t);break;default:return null}return n.length!==t?n.subarray(0,t):n}function u(e){o(e.buffer)}var s=e("./loop"),c=5120,l=5121,p=5122,d=5123,m=5124,h=5125,b=5126,g=s(8,function(){return[]});t.exports={alloc:a,free:o,allocType:f,freeType:u}},{"./loop":27}],29:[function(e,t,n){"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?t.exports={next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:t.exports={next:function(e){return setTimeout(e,16)},cancel:clearTimeout}},{}],30:[function(e,t,n){var r=e("./pool"),i=new Float32Array(1),a=new Uint32Array(i.buffer),o=5123;t.exports=function(e){for(var t=r.allocType(o,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-(1/0))t[n]=64512;else{i[0]=e[n];var f=a[0],u=f>>>31<<15,s=(f<<1>>>24)-127,c=f>>13&1023;if(s<-24)t[n]=u;else if(s<-14){var l=-14-s;t[n]=u+(c+1024>>l)}else s>15?t[n]=u+31744:t[n]=u+(s+15<<10)+c}return t}},{"./pool":28}],31:[function(e,t,n){t.exports=function(e){return Object.keys(e).map(function(t){return e[t]})}},{}],32:[function(e,t,n){function r(e,t,n){function r(){var t=window.innerWidth,r=window.innerHeight;if(e!==document.body){var i=e.getBoundingClientRect();t=i.right-i.left,r=i.top-i.bottom}a.width=n*t,a.height=n*r,c(a.style,{width:t+"px",height:r+"px"})}function i(){window.removeEventListener("resize",r),e.removeChild(a)}var a=document.createElement("canvas");return c(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",c(e.style,{margin:0,padding:0})),window.addEventListener("resize",r,!1),r(),{canvas:a,onDestroy:i}}function i(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function a(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function o(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function f(e){return"string"==typeof e?e.split():(s(Array.isArray(e),"invalid extension array"),e)}function u(e){return"string"==typeof e?(s("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}var s=e("./util/check"),c=e("./util/extend");t.exports=function(e){var t,n,c,l,p=e||{},d={},m=[],h=[],b="undefined"==typeof window?1:window.devicePixelRatio,g=!1,v=function(e){e&&s.raise(e)},y=function(){};if("string"==typeof p?(s("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),
t=document.querySelector(p),s(t,"invalid query string for element")):"object"==typeof p?a(p)?t=p:o(p)?(l=p,c=l.canvas):(s.constructor(p),"gl"in p?l=p.gl:"canvas"in p?c=u(p.canvas):"container"in p&&(n=u(p.container)),"attributes"in p&&(d=p.attributes,s.type(d,"object","invalid context attributes")),"extensions"in p&&(m=f(p.extensions)),"optionalExtensions"in p&&(h=f(p.optionalExtensions)),"onDone"in p&&(s.type(p.onDone,"function","invalid or missing onDone callback"),v=p.onDone),"profile"in p&&(g=!!p.profile),"pixelRatio"in p&&(b=+p.pixelRatio,s(b>0,"invalid pixel ratio"))):s.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?c=t:n=t),!l){if(!c){s("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var x=r(n||document.body,v,b);if(!x)return null;c=x.canvas,y=x.onDestroy}l=i(c,d)}return l?{gl:l,canvas:c,container:n,extensions:m,optionalExtensions:h,pixelRatio:b,profile:g,onDone:v,onDestroy:y}:(y(),v("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":20,"./util/extend":23}],33:[function(e,t,n){function r(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}var i=e("./lib/util/check"),a=e("./lib/util/extend"),o=e("./lib/dynamic"),f=e("./lib/util/raf"),u=e("./lib/util/clock"),s=e("./lib/strings"),c=e("./lib/webgl"),l=e("./lib/extension"),p=e("./lib/limits"),d=e("./lib/buffer"),m=e("./lib/elements"),h=e("./lib/texture"),b=e("./lib/renderbuffer"),g=e("./lib/framebuffer"),v=e("./lib/attribute"),y=e("./lib/shader"),x=e("./lib/read"),w=e("./lib/core"),k=e("./lib/stats"),A=e("./lib/timer"),_=16384,T=256,E=1024,j=34962,S="webglcontextlost",D="webglcontextrestored",C=1,O=2,F=3;t.exports=function(e){function t(){if(0===he.length)return $&&$.update(),void(be=null);be=f.next(t),W();for(var e=he.length-1;e>=0;--e){var n=he[e];n&&n(ee,null,0)}q.flush(),$&&$.update()}function n(){!be&&he.length>0&&(be=f.next(t))}function z(){be&&(f.cancel(t),be=null)}function P(e){}function B(e){}function M(){he.length=0,z(),me&&(me.removeEventListener(S,P),me.removeEventListener(D,B)),fe.clear(),ce.clear(),se.clear(),ue.clear(),ae.clear(),ie.clear(),$&&$.clear(),N.onDestroy()}function L(e){function t(e){function t(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}var n=a({},e);return delete n.uniforms,delete n.attributes,delete n.context,t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),n}function n(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=e[r];o.isDynamic(i)?n[r]=o.unbox(i,r):t[r]=i}),{dynamic:n,static:t}}function r(e){for(;g.length<e;)g.push(null);return g}function f(e,t){var n;if("function"==typeof e)return b.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(n=0;n<e;++n)b.call(this,null,t,n);return}if(Array.isArray(e)){for(n=0;n<e.length;++n)b.call(this,e[n],t,n);return}return b.call(this,e,t,0)}if("number"==typeof e){if(e>0)return h.call(this,r(0|e),0|e)}else{if(!Array.isArray(e))return m.call(this,e);if(e.length)return h.call(this,e,e.length)}}i(!!e,"invalid args to regl({...})"),i.type(e,"object","invalid args to regl({...})");var u=n(e.context||{}),s=n(e.uniforms||{}),c=n(e.attributes||{}),l=n(t(e)),p={gpuTime:0,cpuTime:0,count:0},d=le.compile(l,c,s,u,p),m=d.draw,h=d.batch,b=d.scope,g=[];return a(f,{stats:p})}function R(e){i("object"==typeof e&&e,"regl.clear() takes an object as input");var t=0;le.procs.poll();var n=e.color;n&&(q.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),t|=_),"depth"in e&&(q.clearDepth(+e.depth),t|=T),"stencil"in e&&(q.clearStencil(0|e.stencil),t|=E),i(!!t,"called regl.clear with no buffer specified"),q.clear(t)}function I(e){function t(){function t(){var e=r(he,t);he[e]=he[he.length-1],he.length-=1,he.length<=0&&z()}var n=r(he,e);i(n>=0,"cannot cancel a frame twice"),he[n]=t}return i.type(e,"function","regl.frame() callback must be a function"),he.push(e),n(),{cancel:t}}function H(){var e=de.viewport,t=de.scissor_box;e[0]=e[1]=t[0]=t[1]=0,ee.viewportWidth=ee.framebufferWidth=ee.drawingBufferWidth=e[2]=t[2]=q.drawingBufferWidth,ee.viewportHeight=ee.framebufferHeight=ee.drawingBufferHeight=e[3]=t[3]=q.drawingBufferHeight}function W(){ee.tick+=1,ee.time=(u()-K)/1e3,H(),le.procs.poll()}function U(){H(),le.procs.refresh(),$&&$.update()}var N=c(e);if(!N)return null;var q=N.gl,Q=q.getContextAttributes(),G=l(q,N);if(!G)return null;var V=s(),Y=k(),X=G.extensions,$=A(q,X),K=u(),J=q.drawingBufferWidth,Z=q.drawingBufferHeight,ee={tick:0,time:0,viewportWidth:J,viewportHeight:Z,framebufferWidth:J,framebufferHeight:Z,drawingBufferWidth:J,drawingBufferHeight:Z,pixelRatio:N.pixelRatio},te={},ne={elements:null,primitive:4,count:-1,offset:0,instances:-1},re=p(q,X),ie=d(q,Y,N),ae=m(q,X,ie,Y),oe=v(q,X,re,ie,V),fe=y(q,V,Y,N),ue=h(q,X,re,function(){le.procs.poll()},ee,Y,N),se=b(q,X,re,Y,N),ce=g(q,X,re,ue,se,Y),le=w(q,V,X,re,ie,ae,ue,ce,te,oe,fe,ne,ee,$,N),pe=x(q,ce,le.procs.poll,ee,Q,X),de=le.next,me=q.canvas,he=[],be=null;me&&(me.addEventListener(S,P,!1),me.addEventListener(D,B,!1)),U();var ge=a(L,{clear:R,prop:o.define.bind(null,C),context:o.define.bind(null,O),this:o.define.bind(null,F),draw:L({}),buffer:function(e){return ie.create(e,j)},elements:ae.create,texture:ue.create2D,cube:ue.createCube,renderbuffer:se.create,framebuffer:ce.create,framebufferCube:ce.createCube,attributes:Q,frame:I,limits:re,hasExtension:function(e){return re.extensions.indexOf(e.toLowerCase())>=0},read:pe,destroy:M,_gl:q,_refresh:U,poll:function(){W(),$&&$.update()},stats:Y});return N.onDone(null,ge),ge}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/stats":16,"./lib/strings":17,"./lib/texture":18,"./lib/timer":19,"./lib/util/check":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[33])(33)});
//# sourceMappingURL=regl.min.js.map