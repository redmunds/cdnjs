!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.reglInit=e()}}(function(){return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var f="function"==typeof require&&require;if(!s&&f)return f(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=r[o]={exports:{}};t[o][0].call(c.exports,function(e){var r=t[o][1][e];return i(r?r:e)},c,c.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){function n(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=i,this.offset=0,this.stride=0,this.divisor=0}var i=5126;t.exports=function(e,t,r,i,a){for(var o=r.maxAttributes,s=new Array(o),f=0;f<o;++f)s[f]=new n;return{Record:n,scope:{},state:s}}},{}],2:[function(e,t,r){function n(e){return 0|c[Object.prototype.toString.call(e)]}function i(e,t){switch(e){case b:return new Uint8Array(t);case g:return new Uint16Array(t);case x:return new Uint32Array(t);case m:return new Int8Array(t);case v:return new Int16Array(t);case y:return new Int32Array(t);case w:return new Float32Array(t);default:return null}}function a(e,t,r){for(var n=0,i=0;i<t.length;++i)for(var a=t[i],o=0;o<r;++o)e[n++]=a[o]}function o(e,t,r,n,i,a,o){for(var s=0,f=0;f<r;++f)for(var u=0;u<n;++u)e[s++]=t[i*f+a*u+o];return e}var s=e("./util/check"),f=e("./util/is-typed-array"),u=e("./util/is-ndarray"),c=e("./constants/arraytypes.json"),l=e("./constants/dtypes.json"),d=e("./util/values"),p=35044,h=34962,m=5120,b=5121,v=5122,g=5123,y=5124,x=5125,w=5126,A={static:35044,dynamic:35048,stream:35040};t.exports=function(e){function t(e){this.id=y++,this.buffer=null,this.type=e,this.usage=p,this.byteLength=0,this.dimension=1,this.data=null,this.dtype=b}function r(t){e.isBuffer(t.buffer)||(t.buffer=e.createBuffer()),t.bind(),e.bufferData(t.type,t.data||t.byteLength,t.usage)}function c(t){var r=t.buffer;s(r,"buffer must not be deleted already"),e.isBuffer(r)&&e.deleteBuffer(r),t.buffer=null,delete x[t.id]}function m(e){var t=g({data:e,usage:"stream"},h,!1);return t._buffer}function v(e){c(e)}function g(e,d,h){function m(e){var t=e||{};if(Array.isArray(t)||f(t)||u(t)?t={data:t}:"number"==typeof t?t={length:0|t}:null!==t&&void 0!==t||(t={}),s.type(t,"object","buffer arguments must be an object, a number or an array"),"usage"in t){var c=t.usage;s.parameter(c,A,"invalid buffer usage"),v.usage=A[t.usage]}else v.usage=p;var d=0;"type"in t&&(s.parameter(t.type,l,"invalid buffer type"),d=l[t.type]);var h=0|t.dimension||1,g=0,y=null;if("data"in t)if(y=t.data,null===y)g=0|t.length;else{if(u(y)){var x=y.shape,k=y.stride,_=y.offset,E=0,j=0,S=0,T=0;1===x.length?(E=x[0],j=1,S=k[0],T=0):2===x.length?(E=x[0],j=x[1],S=k[0],T=k[1]):s.raise("invalid shape"),d=d||n(y.data)||w,h=j,y=o(i(d,E*j),y.data,E,j,S,T,_)}else if(Array.isArray(y))if(y.length>0&&Array.isArray(y[0])){h=y[0].length,d=d||w;var D=i(d,y.length*h);y=a(D,y,h),y=D}else d=d||w,y=i(d,y);else s.isTypedArray(y,"invalid data type buffer data"),d=d||n(y);g=y.byteLength}else"length"in t&&(g=0|t.length,s.nni(g,"buffer length must be a nonnegative integer"));return v.data=y,v.dtype=d||b,v.byteLength=g,v.dimension=h,r(v),m}var v=new t(d);return x[v.id]=v,h||m(e),m._reglType="buffer",m._buffer=v,m.destroy=function(){c(v)},m}var y=0,x={};return t.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},{create:g,createStream:m,destroyStream:v,clear:function(){d(x).forEach(c)},refresh:function(){d(x).forEach(r)},getBuffer:function(e){return e&&e._buffer instanceof t?e._buffer:null}}}},{"./constants/arraytypes.json":3,"./constants/dtypes.json":4,"./util/check":17,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/values":28}],3:[function(e,t,r){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],4:[function(e,t,r){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126}},{}],5:[function(e,t,r){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],6:[function(e,t,r){function n(e){return Array.isArray(e)||d(e)||p(e)}function i(e){return e.sort(function(e,t){return e===J?-1:t===J?1:e<t?-1:1})}function a(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function o(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function s(e){return new a(!1,!1,!1,e)}function f(e,t){var r=e.type;if(r===x){var n=e.data.length;return new a(!0,n>=1,n>=2,t)}return new a(r===k,r===A,r===w,t)}var u=e("./util/check"),c=e("./util/codegen"),l=e("./util/loop"),d=e("./util/is-typed-array"),p=e("./util/is-ndarray"),h=e("./constants/primitives.json"),m=e("./constants/dtypes.json"),b="xyzw".split(""),v=5121,g=1,y=2,x=0,w=1,A=2,k=3,_="dither",E="blend.enable",j="blend.color",S="blend.equation",T="blend.func",D="depth.enable",O="depth.func",F="depth.range",P="depth.mask",C="colorMask",B="cull.enable",L="cull.face",R="frontFace",M="lineWidth",I="polygonOffset.enable",z="polygonOffset.offset",U="sample.alpha",W="sample.enable",H="sample.coverage",N="stencil.enable",G="stencil.mask",q="stencil.func",V="stencil.opFront",Y="stencil.opBack",X="scissor.enable",$="scissor.box",J="viewport",K="framebuffer",Q="vert",Z="frag",ee="elements",te="primitive",re="count",ne="offset",ie="instances",ae="Width",oe="Height",se=K+ae,fe=K+oe,ue=J+ae,ce=J+oe,le="drawingBuffer",de=le+ae,pe=le+oe,he=34962,me=34963,be=35632,ve=35633,ge=3553,ye=34067,xe=2884,we=3042,Ae=3024,ke=2960,_e=2929,Ee=3089,je=32823,Se=32926,Te=32928,De=5126,Oe=35664,Fe=35665,Pe=35666,Ce=5124,Be=35667,Le=35668,Re=35669,Me=35670,Ie=35671,ze=35672,Ue=35673,We=35674,He=35675,Ne=35676,Ge=35678,qe=35680,Ve=4,Ye=1028,Xe=1029,$e=2304,Je=2305,Ke=32775,Qe=32776,Ze=519,et=7680,tt=0,rt=1,nt=32774,it=513,at=36160,ot=36064,st={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ft={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ut={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ct={frag:be,vert:ve},lt={cw:$e,ccw:Je},dt=new a(!1,!1,!1,function(){});t.exports=function(e,t,r,p,ae,oe,le,be,ve,pt,ht,mt,bt){function vt(e){return e.replace(".","_")}function gt(e,t,r){var n=vt(e);Zt.push(e),Qt[n]=Kt[n]=!!r,er[n]=t}function yt(e,t,r){var n=vt(e);Zt.push(e),Array.isArray(r)?(Kt[n]=r.slice(),Qt[n]=r.slice()):Kt[n]=Qt[n]=r,tr[n]=t}function xt(){var e=c(),r=e.link,n=e.global;e.id=ir++,e.batchId="0";var i=r(rr),a=e.shared={props:"a0"};Object.keys(rr).forEach(function(e){a[e]=n.def(i,".",e)}),u.optional(function(){var t=r(u),n=r(u.guessCommand());e.command=n,e.assert=function(e,i,a){e("if(!(",i,"))",t,".commandRaise(",r(a),",",n,");")}});var o=e.next={},s=e.current={};Object.keys(tr).forEach(function(e){Array.isArray(Kt[e])&&(o[e]=n.def(a.next,".",e),s[e]=n.def(a.current,".",e))});var f=e.constants={};Object.keys(nr).forEach(function(e){f[e]=n.def(JSON.stringify(nr[e]))}),e.invoke=function(t,n){switch(n.type){case x:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case w:return t.def(a.props,n.data);case A:return t.def(a.context,n.data);case k:return t.def("this",n.data)}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var n=t.id(e);if(n in l)return l[n];var i=pt.scope[n];i||(i=pt.scope[n]=new Yt);var a=l[n]=r(i);return a},e}function wt(e){var t=e.static,r=e.dynamic;if(K in t){var n=t[K];return n?(n=be.getFramebuffer(n),u.command(n,"invalid framebuffer object"),s(function(e,t){var r=e.link(n),i=e.shared;t.set(i.framebuffer,".next",r);var a=i.context;return t.set(a,"."+se,r+".width"),t.set(a,"."+fe,r+".height"),r})):s(function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+se,n+"."+de),t.set(n,"."+fe,n+"."+pe),null})}if(K in r){var i=r[K];return f(i,function(e,t){var r=e.invoke(t,i),n=e.shared,a=n.framebuffer,o=t.def(a,".getFramebuffer(",r,")");u.optional(function(){e.assert(t,"!"+r+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var s=n.context;return t.set(s,"."+se,o+"?"+o+".width:"+s+"."+de),t.set(s,"."+fe,o+"?"+o+".height:"+s+"."+pe),o})}return null}function At(e,t){function r(e){if(e in n){var r=n[e];u.commandType(r,"object","invalid "+e);var o,s,c=!0,l=0|r.x,d=0|r.y;return"w"in r?(o=0|r.w,u.command(o>0,"invalid "+e)):c=!1,"h"in r?(s=0|r.h,u.command(s>0,"invalid "+e)):c=!1,new a(c&&t&&t.thisDep,c&&t&&t.contextDep,c&&t&&t.propDep,function(e,t){var n=e.shared.context,i=o;"w"in r||(i=t.def(n,".",se,"-",l));var a=s;return"h"in r||(a=t.def(n,".",fe,"-",d)),[l,d,i,a]})}if(e in i){var p=i[e],h=f(p,function(t,r){var n=t.invoke(r,p);u.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});var i=t.shared.context,a=r.def(n,".x|0"),o=r.def(n,".y|0"),s=r.def('"w" in ',n,"?",n,".w|0:","(",i,".",se,"-",a,")"),f=r.def('"h" in ',n,"?",n,".h|0:","(",i,".",fe,"-",o,")");return u.optional(function(){t.assert(r,a+">=0&&"+o+">=0&&"+s+">0&&"+f+">0","invalid "+e)}),[a,o,s,f]});return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.prpoDep),h}return t?new a(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",se),t.def(r,".",fe)]}):null}var n=e.static,i=e.dynamic,o=r(J);if(o){var s=o;o=new a(o.thisDep,o.contextDep,o.propDep,function(e,t){var r=s.append(e,t),n=e.shared.context;return t.set(n,"."+ue,r[2]),t.set(n,"."+ce,r[3]),r})}return{viewport:o,scissor_box:r($)}}function kt(e){function r(e){if(e in i){var r=t.id(i[e]);u.optional(function(){ht.shader(ct[e],r)});var n=s(function(){return r});return n.id=r,n}if(e in c){var a=c[e];return f(a,function(t,r){var n=t.invoke(r,a),i=r.def(t.shared.strings,".id(",n,")");return u.optional(function(){r(t.shared.shader,".shader(",ct[e],",",i,",",t.command,");")}),i})}return null}var n,i=e.static,c=e.dynamic,l=r(Z),d=r(Q),p=null;return o(l)&&o(d)?(p=ht.program(d.id,l.id),n=s(function(e,t){return e.link(p)})):n=new a(l&&l.thisDep||d&&d.thisDep,l&&l.contextDep||d&&d.contextDep,l&&l.propDep||d&&d.propDep,function(e,t){var r,n=e.shared.shader;r=l?l.append(e,t):t.def(n,".",Z);var i;i=d?d.append(e,t):t.def(n,".",Q);var a=n+".program("+i+","+r;return u.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:l,vert:d,progVar:n,program:p}}function _t(e){function t(){if(ee in l){var e=l[ee];n(e)?e=oe.getElements(oe.create(e)):e&&(e=oe.getElements(e),u.command(e,"invalid elements"));var t=s(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null});return t.value=e,t}if(ee in d){var r=d[ee];return f(r,function(e,t){var n=e.shared,i=n.isBufferArgs,a=n.elements,o=e.invoke(t,r),s=t.def("null"),f=t.def(i,"(",o,")"),c=e.cond(f).then(s,"=",a,".createStream(",o,");").else(s,"=",a,".getElements(",o,");");return u.optional(function(){e.assert(c.else,"!"+o+"||"+s,"invalid elements")}),t.entry(c),t.exit(e.cond(f).then(a,".destroyStream(",s,");")),e.ELEMENTS=s,s})}return null}function r(){if(te in l){var e=l[te];return u.commandParameter(e,h,"invalid primitve"),s(function(t,r){return h[e]})}if(te in d){var t=d[te];return f(t,function(e,r){var n=e.constants.primTypes,i=e.invoke(r,t);return u.optional(function(){e.assert(r,i+" in "+n,"invalid primitive, must be one of "+Object.keys(h))}),r.def(n,"[",i,"]")})}return p?o(p)?s(p.value?function(e,t){return t.def(e.ELEMENTS,".primType")}:function(){return Ve}):new a(p.thisDep,p.contextDep,p.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",Ve)}):null}function i(e,t){if(e in l){var r=0|l[e];return u.command(!t||r>=0,"invalid "+e),s(function(e,n){return t&&(e.OFFSET=r),r})}if(e in d){var n=d[e];return f(n,function(r,i){var a=r.invoke(i,n);return t&&(r.OFFSET=a,u.optional(function(){r.assert(i,a+">=0","invalid "+e)})),a})}return t&&p?s(function(e,t){return e.OFFSET="0",0}):null}function c(){if(re in l){var e=0|l[re];return u.command("number"==typeof e&&e>=0,"invalid vertex count"),s(function(){return e})}if(re in d){var t=d[re];return f(t,function(e,r){var n=e.invoke(r,t);return u.optional(function(){e.assert(r,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")}),n})}if(p){if(o(p)){if(p)return m?new a(m.thisDep,m.contextDep,m.propDep,function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return u.optional(function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")}),r}):s(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var r=s(function(){return-1});return u.optional(function(){r.MISSING=!0}),r}var n=new a(p.thisDep||m.thisDep,p.contextDep||m.contextDep,p.propDep||m.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")});return u.optional(function(){n.DYNAMIC=!0}),n}return null}var l=e.static,d=e.dynamic,p=t(),m=i(ne,!0);return{elements:p,primitive:r(),count:c(),instances:i(ie,!1),offset:m}}function Et(e){var t=e.static,r=e.dynamic,n={};return Zt.forEach(function(e){function i(i,o){if(e in t){var u=i(t[e]);n[a]=s(function(){return u})}else if(e in r){var c=r[e];n[a]=f(c,function(e,t){return o(e,t,e.invoke(t,c))})}}var a=vt(e);switch(e){case B:case E:case _:case N:case D:case X:case I:case U:case W:case P:return i(function(t){return u.commandType(t,"boolean",e),t},function(t,r,n){return u.optional(function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e)}),n});case O:return i(function(t){return u.commandParameter(t,ft,"invalid "+e),ft[t]},function(t,r,n){var i=t.constants.compareFuncs;return u.optional(function(){t.assert(r,n+" in "+i,"invalid "+e+", must be one of "+Object.keys(ft))}),r.def(i,"[",n,"]")});case F:return i(function(e){return u.command(Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array"),e},function(e,t,r){u.optional(function(){e.assert(t,"Array.isArray("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")});var n=t.def("+",r,"[0]"),i=t.def("+",r,"[1]");return[n,i]});case T:return i(function(e){u.commandType(e,"object","blend.func");var t="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,n="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return u.commandParameter(t,st,a+".srcRGB"),u.commandParameter(r,st,a+".srcAlpha"),u.commandParameter(n,st,a+".dstRGB"),u.commandParameter(i,st,a+".dstAlpha"),[st[t],st[n],st[r],st[i]]},function(t,r,n){function i(i,o){var s=r.def('"',i,o,'" in ',n,"?",n,".",i,o,":",n,".",i);return u.optional(function(){t.assert(r,s+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(st))}),r.def(a,"[",s,"]")}var a=t.constants.blendFuncs;u.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")});var o=i("src","RGB"),s=i("src","Alpha"),f=i("dst","RGB"),c=i("dst","Alpha");return[o,f,s,c]});case S:return i(function(t){return"string"==typeof t?(u.commandParameter(t,Xt,"invalid "+e),[Xt[t],Xt[t]]):"object"==typeof t?(u.commandParameter(t.rgb,Xt,e+".rgb"),u.commandParameter(t.alpha,Xt,e+".alpha"),[Xt[t.rgb],Xt[t.alpha]]):void u.commandRaise("invalid blend.equation")},function(t,r,n){var i=t.constants.blendEquations,a=r.def(),o=r.def(),s=t.cond("typeof ",n,'==="string"');return u.optional(function(){function r(e,r,n){t.assert(e,n+" in "+i,"invalid "+r+", must be one of "+Object.keys(Xt))}r(s.then,e,n),t.assert(s.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(s.else,e+".rgb",n+".rgb"),r(s.else,e+".alpha",n+".alpha")}),s.then(a,"=",o,"=",i,"[",n,"];"),s.else(a,"=",i,"[",n,".rgb];",o,"=",i,"[",n,".alpha];"),r(s),[a,o]});case j:return i(function(e){return u.command(Array.isArray(e)&&4===e.length,"blend.color must be a 4d array"),l(4,function(t){return+e[t]})},function(e,t,r){return u.optional(function(){e.assert(t,"Array.isArray("+r+")&&"+r+".length===4","blend.color must be a 4d array")}),l(4,function(e){return t.def("+",r,"[",e,"]")})});case G:return i(function(e){return u.commandType(e,"number",a),0|e},function(e,t,r){return u.optional(function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")}),t.def(r,"|0")});case q:return i(function(t){u.commandType(t,"object",a);var r=t.cmp||"keep",n=t.ref||0,i="mask"in t?t.mask:-1;return u.commandParameter(r,ft,e+".cmp"),u.commandType(n,"number",e+".ref"),u.commandType(i,"number",e+".mask"),[ft[r],n,i]},function(e,t,r){var n=e.constants.compareFuncs;u.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(r+"&&typeof ",r,'==="object"'),i('!("cmp" in ',r,")||(",r,".cmp in ",n,")")});var i=t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",et),a=t.def(r,".ref|0"),o=t.def('"mask" in ',r,"?",r,".mask|0:-1");return[i,a,o]});case V:case Y:return i(function(t){u.commandType(t,"object",a);var r=t.fail||"keep",n=t.zfail||"keep",i=t.pass||"keep";return u.commandParameter(r,ut,e+".fail"),u.commandParameter(n,ut,e+".zfail"),u.commandParameter(i,ut,e+".pass"),[e===Y?Xe:Ye,ut[r],ut[n],ut[i]]},function(t,r,n){function i(i){return u.optional(function(){t.assert(r,'!("'+i+'" in '+n+")||("+n+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(ut))}),r.def('"',i,'" in ',n,"?",a,"[",n,".",i,"]:",et)}var a=t.constants.stencilOps;return u.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[e===Y?Xe:Ye,i("fail"),i("zfail"),i("pass")]});case z:return i(function(e){u.commandType(e,"object",a);var t=0|e.factor,r=0|e.units;return u.commandType(t,"number",a+".factor"),u.commandType(r,"number",a+".units"),[t,r]},function(t,r,n){u.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});var i=r.def(n,".factor|0"),a=r.def(n,".units|0");return[i,a]});case L:return i(function(e){var t=0;return"front"===e?t=Ye:"back"===e&&(t=Xe),u.command(!!t,a),t},function(e,t,r){return u.optional(function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")}),t.def(r,'==="front"?',Ye,":",Xe)});case M:return i(function(e){return u.command("number"==typeof e&&e>=p.lineWidthDims[0]&&e<=p.lineWidthDims[1],"invalid line width, must positive number between "+p.lineWidthDims[0]+" and "+p.lineWidthDims[1]),e},function(e,t,r){return u.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+p.lineWidthDims[0]+"&&"+r+"<="+p.lineWidthDims[1],"invalid line width")}),r});case R:return i(function(e){return u.commandParameter(e,lt,a),lt[e]},function(e,t,r){return u.optional(function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(r+'==="cw"?'+$e+":"+Je)});case C:return i(function(e){return u.command(Array.isArray(e)&&4===e.length,"color.mask must be length 4 array"),e.map(function(e){return!!e})},function(e,t,r){return u.optional(function(){e.assert(t,"Array.isArray("+r+")&&"+r+".length===4","invalid color.mask")}),l(4,function(e){return"!!"+r+"["+e+"]"})});case H:return i(function(e){u.command("object"==typeof e&&e,a);var t="value"in e?e.value:1,r=!!e.invert;return u.command("number"==typeof t&&t>=0&&t<=1,"sample.coverage.value must be a number between 0 and 1"),[t,r]},function(e,t,r){u.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")});var n=t.def('"value" in ',r,"?+",r,".value:1"),i=t.def("!!",r,".invert");return[n,i]})}}),n}function jt(e){function t(e){var t=a[e];t&&(s[e]=t)}var r=e.static,n=e.dynamic;u.optional(function(){function e(e){Object.keys(e).forEach(function(e){u.command(t.indexOf(e)>=0,"invalid option "+e)})}var t=[K,Q,Z,ee,te,ne,re,ie].concat(Zt);e(r),e(n)});var i=wt(e),a=At(e,i),o=_t(e),s=Et(e),f=kt(e);t(J),t(vt($));var c=Object.keys(s).length>0;return{framebuffer:i,draw:o,shader:f,state:s,dirty:c}}function St(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r,i=t[e];"number"==typeof i||"boolean"==typeof i?r=s(function(){return i}):"function"==typeof i&&"texture"===i._reglType?r=s(function(e){return e.link(i)}):Array.isArray(i)||d(i)?r=s(function(t){var r=t.global.def("[",l(i.length,function(t){return u.command("number"==typeof i[t]||"boolean"==typeof i[t],"invalid uniform "+e),i[t]}),"]");return r}):u.commandRaise("invalid uniform "+e),r.value=i,n[e]=r}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=f(t,function(e,r){return e.invoke(r,t)})}),n}function Tt(e){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach(function(e){var i=r[e],o=t.id(e),f=new Yt;if(n(i))f.state=g,f.buffer=ae.getBuffer(ae.create(i,he,!1)),f.type=f.buffer.dtype;else{var c=ae.getBuffer(i);if(c)f.state=g,f.buffer=c,f.type=c.dtype;else if(u.command("object"==typeof i&&i,"invalid data for attribute "+e),i.constant){var l=i.constant;f.state=y,"number"==typeof l?f.x=l:(u.command(Array.isArray(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e),b.forEach(function(e,t){t<l.length&&(f[e]=l[t])}))}else{c=ae.getBuffer(i.buffer),u.command(!!c,"missing buffer for attribute "+e);var d=0|i.offset;u.command(d===i.offset&&d>=0,"invalid offset for attribute "+e);var p=0|i.stride;u.command(p===i.stride&&p>=0&&p<256,"invalid stride for attribute "+e+", must be integer betweeen [0, 255]");var h=0|i.size;"size"in i&&u.command(h===i.size&&h>0&&h<=4,"invalid size for attribute "+e+", must be 1,2,3,4");var v=!!i.normalized;"normalized"in i&&u.commandType(i.normalized,"boolean","invalid normalized flag for attribute "+e);var x=0;"type"in i&&(u.commandParameter(i.type,m,"invalid type for attribute "+e),x=m[i.type]);var w=0|i.divisor;"divisor"in i&&(u.command($t,"instancing not supported"),u.command(w===i.divisor&&w>=0,"invalid divisor for attribute "+e)),f.buffer=c,f.state=g,f.size=h,f.normalized=v,f.type=x||c.dtype,f.offset=d,f.stride=p,f.divisor=w}}a[e]=s(function(e,t){var r=e.attribCache;if(o in r)return r[o];var n={isStream:!1};return Object.keys(f).forEach(function(e){n[e]=f[e]}),f.buffer&&(n.buffer=e.link(f.buffer)),r[o]=n,n})}),Object.keys(i).forEach(function(e){function t(t,n){function i(e){n(c[e],"=",a,".",e,"|0;")}var a=t.invoke(n,r),o=t.shared,s=o.isBufferArgs,f=o.buffer;u.optional(function(){t.assert(n,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+s+"("+a+")||"+f+".getBuffer("+a+")||"+f+".getBuffer("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||Array.isArray('+a+"))))",'invalid dynamic attribute "'+e+'"')});var c={isStream:n.def(!1)},l=new Yt;l.state=g,Object.keys(l).forEach(function(e){c[e]=n.def(""+l[e])});var d=c.buffer,p=c.type;return n("if(",s,"(",a,")){",c.isStream,"=true;",d,"=",f,".createStream(",a,");",p,"=",d,".dtype;","}else{",d,"=",f,".getBuffer(",a,");","if(",d,"){",p,"=",d,".dtype;","}else if(",a,".constant){",c.state,"=",y,";",b.map(function(e,t){return c[e]+"="+a+".length>="+t+"?"+a+"["+t+"]:0;"}).join(""),"}else{",d,"=",f,".getBuffer(",a,".buffer);",p,'="type" in ',a,"?",o.glTypes,"[",a,".type]:",d,".dtype;",c.normalized,"=!!",a,".normalized;"),i("size"),i("offset"),i("stride"),i("divisor"),n("}}"),c}var r=i[e];a[e]=f(r,t)}),a}function Dt(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r=t[e];n[e]=s(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=f(t,function(e,r){return e.invoke(r,t)})}),n}function Ot(e,t,r,n){var i=jt(e);return i.uniforms=St(r),i.attributes=Tt(t),i.context=Dt(n),i}function Ft(e,t,r){var n=e.shared,i=n.context,a=e.scope();Object.keys(r).forEach(function(n){t.save(i,"."+n);var o=r[n];a(i,".",n,"=",o.append(e,t),";")}),t(a)}function Pt(e,t,r){var n,i=e.shared,a=i.gl,o=i.framebuffer;Jt&&(n=t.def(i.extensions,".webgl_draw_buffers"));var s,f=e.constants,u=f.drawBuffers,c=f.backBuffer;s=r?r.append(e,t):t.def(o,".next"),t("if(",o,".dirty||",s,"!==",o,".cur){","if(",s,"){",a,".bindFramebuffer(",at,",",s,".framebuffer);"),Jt&&t(n,".drawBuffersWEBGL(",u,"[",s,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",at,",null);"),Jt&&t(n,".drawBuffersWEBGL(",c,");"),t("}",o,".cur=",s,";",o,".dirty=false;","}")}function Ct(e,t,r){var n=e.shared,i=n.gl,a=e.current,o=e.next,s=n.current,f=n.next,u=e.cond(s,".dirty");Zt.forEach(function(t){var n=vt(t);if(!(n in r.state)){var c,d;if(n in o){c=o[n],d=a[n];var p=l(Kt[n].length,function(e){return u.def(c,"[",e,"]")});u(e.cond(p.map(function(e,t){return e+"==="+d+"["+t+"]"}).join("&&")).then(i,".",tr[n],"(",p,");",p.map(function(e,t){return d+"["+t+"]="+e}).join(";"),";"))}else{c=u.def(f,".",n);var h=e.cond(c,"!==",s,".",n);u(h),n in er?h(e.cond(c).then(i,".enable(",er[n],");").else(i,".disable(",er[n],");"),s,".",n,"=",c,";"):h(i,".",tr[n],"(",c,");",s,".",n,"=",c,";")}}}),0===Object.keys(r.state).length&&u(s,".dirty=false;"),t(u)}function Bt(e,t,r,n){var a=e.shared,s=e.current,f=a.current,u=a.gl;i(Object.keys(r)).forEach(function(i){var a=r[i];if(!n||n(a)){var c=a.append(e,t);if(er[i]){var l=er[i];o(a)?c?t(u,".enable(",l,");"):t(u,".disable(",l,");"):t(e.cond(c).then(u,".enable(",l,");").else(u,".disable(",l,");")),t(f,".",i,"=",c,";")}else if(Array.isArray(c)){var d=s[i];t(u,".",tr[i],"(",c,");",c.map(function(e,t){return d+"["+t+"]="+e}).join(";"),";")}else t(u,".",tr[i],"(",c,");",f,".",i,"=",c,";")}})}function Lt(e,t){$t&&!e.instancing&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function Rt(e,t,r,n,i){function a(e){switch(e){case Oe:case Be:case Ie:return 2;case Fe:case Le:case ze:return 3;case Pe:case Re:case Ue:return 4;default:return 1}}function o(r,n,i){function a(){t("if(!",c,".pointer){",f,".enableVertexAttribArray(",u,");",c,".pointer=true;}");var r,a=i.type;if(r=i.size?t.def(i.size,"||",n):n,t("if(",c,".type!==",a,"||",c,".size!==",r,"||",h.map(function(e){return c+"."+e+"!=="+i[e]}).join("||"),"){",f,".bindBuffer(",he,",",d,".buffer);",f,".vertexAttribPointer(",[u,r,a,i.normalized,i.stride,i.offset],");",c,".type=",a,";",c,".size=",r,";",h.map(function(e){return c+"."+e+"="+i[e]+";"}).join(""),"}"),$t){var o=i.divisor;t("if(",c,".divisor!==",o,"){",e.instancing,".vertexAttribDivisorANGLE(",[u,o],");",c,".divisor=",o,";}")}}function o(){t("if(",c,".pointer){",f,".disableVertexAttribArray(",u,");",c,".pointer=false;","}if(",b.map(function(e,t){return c+"."+e+"!=="+p[t]}).join("||"),"){",f,".vertexAttrib4f(",u,",",p,");",b.map(function(e,t){return c+"."+e+"="+p[t]+";"}).join(""),"}")}var f=s.gl,u=t.def(r,".location"),c=t.def(s.attributes,"[",u,"]"),l=i.state,d=i.buffer,p=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];l===g?a():l===y?o():(t("if(",l,"===",g,"){"),a(),t("}else{"),o(),t("}"))}var s=e.shared;n.forEach(function(n){var s,f=n.name,c=r.attributes[f];if(c){if(!i(c))return;s=c.append(e,t)}else{if(!i(dt))return;var l=e.scopeAttrib(f);u.optional(function(){e.assert(t,l,".state","missing attribute "+f)}),s={},Object.keys(new Yt).forEach(function(e){s[e]=t.def(l,".",e)})}o(e.link(n),a(n.info.type),s)})}function Mt(e,r,n,i,a){for(var o,s=e.shared,f=s.gl,c=0;c<i.length;++c){var l,p=i[c],h=p.name,m=p.info.type,b=n.uniforms[h],v=e.link(p),g=v+".location";if(b){if(!a(b))continue;if(b.static){var y=b.value;if(m===Ge||m===qe){u.command("function"==typeof y&&"texture"===y._reglType&&(m===qe&&y._texture.target===ye||m===Ge&&y._texutre.target===ge),"invalid texture for uniform "+h);var x=e.link(y._texture);r(f,".uniform1i(",g,x+".bind());"),r.exit(x,".unbind()")}else if(m===We||m===He||m===Ne){u.optional(function(){u.command(d(y)||Array.isArray(y),"invalid matrix for uniform "+h),u.command(m===We&&4===y.length||m===He&&9===y.length||m===Ne&&16===y.length,"invalid length for matrix uniform "+h)});var w=e.global.def("["+y+"]"),A=2;m===He?A=3:m===Ne&&(A=4),r(f,".uniformMatrix",A,"fv(",g,",false,",w,");")}else{switch(m){case De:u.commandType(y,"number","uniform "+h),o="1f";break;case Oe:u.command((Array.isArray(y)||d(y))&&2===y.length&&"number"==typeof y[0]&&"number"==typeof y[1],"uniform "+h),o="2f";break;case Fe:u.command((Array.isArray(y)||d(y))&&3===y.length&&"number"==typeof y[0]&&"number"==typeof y[1]&&"number"==typeof y[2],"uniform "+h),o="3f";break;case Pe:u.command((Array.isArray(y)||d(y))&&4===y.length&&"number"==typeof y[0]&&"number"==typeof y[1]&&"number"==typeof y[2]&&"number"==typeof y[3],"uniform "+h),o="4f";break;case Me:u.commandType(y,"boolean","uniform "+h),o="1i";break;case Ce:u.command("number"==typeof y&&y===(0|y),"uniform "+h),o="1i";break;case Ie:u.command(Array.isArray(y)&&2===y.length&&"boolean"==typeof y[0]&&"boolean"==typeof y[1],"uniform "+h),o="2i";break;case Be:u.command((Array.isArray(y)||d(y))&&2===y.length&&"number"==typeof y[0]&&y[0]===(0|y[0])&&"number"==typeof y[1]&&y[1]===(0|y[1]),"uniform "+h),o="2i";break;case ze:u.command(Array.isArray(y)&&3===y.length&&"boolean"==typeof y[0]&&"boolean"==typeof y[1]&&"boolean"==typeof y[2],"uniform "+h),o="3i";break;case Le:u.command((Array.isArray(y)||d(y))&&3===y.length&&"number"==typeof y[0]&&y[0]===(0|y[0])&&"number"==typeof y[1]&&y[1]===(0|y[1])&&"number"==typeof y[2]&&y[2]===(0|y[2]),"uniform "+h),o="3i";break;case Ue:u.command(Array.isArray(y)&&4===y.length&&"boolean"==typeof y[0]&&"boolean"==typeof y[1]&&"boolean"==typeof y[2]&&"boolean"==typeof y[3],"uniform "+h),o="4i";break;case Re:u.command((Array.isArray(y)||d(y))&&4===y.length&&"number"==typeof y[0]&&y[0]===(0|y[0])&&"number"==typeof y[1]&&y[1]===(0|y[1])&&"number"==typeof y[2]&&y[2]===(0|y[2])&&"number"==typeof y[3]&&y[3]===(0|y[3]),"uniform "+h),o="4i";break;default:u.raise("unsupported uniform type")}r(f,".uniform",o,"(",g,",",y,");")}continue}l=b.append(e,r)}else{if(!a(dt))continue;l=r.def(s.uniforms,"[",t.id(h),"]")}u.optional(function(){function t(t){e.assert(r,t,o)}function n(e){t("typeof "+l+'==="'+e+'"')}function i(e,r){t(l+".length==="+e)}function a(e){t("typeof "+l+'==="function"&&'+l+'._reglType==="texture"&&'+l+"._texture.target==="+e)}var o=e.link("uniform "+h);switch(m){case Ce:n("number");break;case Be:i(2,"number");break;case Le:i(3,"number");break;case Re:i(4,"number");break;case De:n("number");break;case Oe:i(2,"number");break;case Fe:i(3,"number");break;case Pe:i(4,"number");break;case Me:n("boolean");break;case Ie:i(2,"boolean");break;case ze:i(3,"boolean");break;case Ue:i(4,"boolean");break;case We:i(4,"number");break;case He:i(9,"number");break;case Ne:i(16,"number");break;case Ge:a(ge);break;case qe:a(ye)}});var k=",";switch(m){case Ge:case qe:var _=r.def(l,"._texture");r(f,".uniform1i(",g,",",_,".bind());"),r.exit(_,".unbind();");continue;case Ce:case Me:o="1i";break;case Be:case Ie:o="2iv";break;case Le:case ze:o="3iv";break;case Re:case Ue:o="4iv";break;case De:o="1f";break;case Oe:o="2fv";break;case Fe:o="3fv";break;case Pe:o="4fv";break;case We:o="Matrix2fv",k=",false,";break;case He:o="Matrix3fv",k=",false,";break;case Ne:o="Matrix4fv",k=",false,"}r(f,".uniform",o,"(",g,k,l,");")}}function It(e,t,r,n){function i(){var n,i=h.elements,a=t;return i?(i.batchStatic||(a=r),n=i.append(e,a)):n=a.def(p,".",ee),n&&a("if("+n+")"+d+".bindBuffer("+me+","+n+".buffer.buffer);"),n}function a(){var n,i=h.count,a=t;return i?(i.batchStatic||(a=r),n=i.append(e,a),u.optional(function(){i.MISSING&&e.assert(t,"false","missing vertex count"),
i.DYNAMIC&&e.assert(a,n+">=0","missing vertex count")})):n=a.def(p,".",re),n}function s(n){var i=h[n];return i?i.batchStatic?i.append(e,t):i.append(e,r):t.def(p,".",n)}function f(){function e(){r(w,".drawElementsInstancedANGLE(",[b,y,A,g+"<<(("+A+"-"+v+")>>1)",x],");")}function t(){r(w,".drawArraysInstancedANGLE(",[b,g,y,x],");")}m?k?e():(r("if(",m,"){"),e(),r("}else{"),t(),r("}")):t()}function c(){function e(){r(d+".drawElements("+[b,y,A,g+"<<(("+A+"-"+v+")>>1)"]+");")}function t(){r(d+".drawArrays("+[b,g,y]+");")}m?k?e():(r("if(",m,"){"),e(),r("}else{"),t(),r("}")):t()}var l=e.shared,d=l.gl,p=l.draw,h=n.draw,m=i(),b=s(te),g=s(ne),y=a();if("number"==typeof y){if(0===y)return}else r("if(",y,"){"),r.exit("}");var x,w;$t&&(x=s(ie),w=e.instancing);var A=m+".type",k=h.elements&&o(h.elements);$t&&("number"!=typeof x||x>=0)?"string"==typeof x?(r("if(",x,">0){"),f(),r("}else if(",x,"<0){"),c(),r("}")):f():c()}function zt(e,t,r,n,i){var a=xt(),o=a.proc("body",i);return u.optional(function(){a.command=t.command,a.assert=t.assert}),$t&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,r,n),a.compile().body}function Ut(e,t,r,n){Lt(e,t),Rt(e,t,r,n.attributes,function(){return!0}),Mt(e,t,r,n.uniforms,function(){return!0}),It(e,t,t,r)}function Wt(e,t){var r=e.proc("draw",1);Lt(e,r),Ft(e,r,t.context),Pt(e,r,t.framebuffer),Ct(e,r,t),Bt(e,r,t.state);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)Ut(e,r,t,t.shader.program);else{var i=e.global.def("{}"),a=r.def(n,".id"),o=r.def(i,"[",a,"]");r(e.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",e.link(function(r){return zt(Ut,e,t,r,1)}),"(",n,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}function Ht(e,t,r,n){function i(){return!0}e.batchId="a1",Lt(e,t),Rt(e,t,r,n.attributes,i),Mt(e,t,r,n.uniforms,i),It(e,t,t,r)}function Nt(e,t,r,n){function i(e){return e.contextDep&&o||e.propDep}function a(e){return!i(e)}Lt(e,t);var o=r.contextDynamic,s=t.def(),f="a0",u="a1",c=t.def();e.shared.props=c,e.batchId=s;var l=e.scope(),d=e.scope();if(t(l.entry,"for(",s,"=0;",s,"<",u,";++",s,"){",c,"=",f,"[",s,"];",d,"}",l.exit),r.needsContext&&Ft(e,d,r.context),r.needsFramebuffer&&Pt(e,d,r.framebuffer),Bt(e,d,r.state,i),n)Rt(e,l,r,n.attributes,a),Rt(e,d,r,n.attributes,i),Mt(e,l,r,n.uniforms,a),Mt(e,d,r,n.uniforms,i),It(e,l,d,r);else{var p=e.global.def("{}"),h=r.shader.progVar.append(e,d),m=d.def(h,".id"),b=d.def(p,"[",m,"]");d(e.shared.gl,".useProgram(",h,".program);","if(!",b,"){",b,"=",p,"[",m,"]=",e.link(function(t){return zt(Ht,e,r,t,2)}),"(",h,");}",b,".call(this,a0[",s,"],",s,");")}}function Gt(e,t){var r=e.proc("batch",2);e.batchId="0",Lt(e,r);var n=!1,i=!0;Object.keys(t.context).forEach(function(e){n=n||t.context[e].propDep}),n||(Ft(e,r,t.context),i=!1);var a=t.framebuffer,o=!1;a&&(a.propDep?n=o=!0:a.contextDep&&n&&(o=!0),o||Pt(e,r,a)),t.state.viewport&&t.state.viewport.propDynamic&&(n=!0),Ct(e,r,t),Bt(e,r,t.state,function(e){return!(e.contextDep&&n||e.propDep)}),t.contextDep=n,t.needsContext=i,t.needsFramebuffer=o;var s=t.shader.progVar;if(s.contextDep&&n||s.propDep)Nt(e,r,t,null);else{var f=s.append(e,r);if(r(e.shared.gl,".useProgram(",f,".program);"),t.shader.program)Nt(e,r,t,t.shader.program);else{var u=e.global.def("{}"),c=r.def(f,".id"),l=r.def(u,"[",c,"]");r(e.cond(l).then(l,".call(this,a0,a1);").else(l,"=",u,"[",c,"]=",e.link(function(r){return zt(Nt,e,t,r,2)}),"(",f,");",l,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}function qt(e,r){function n(t){var n=r.shader[t];n&&a.set(o.shader,"."+t,n.append(e,a))}var a=e.proc("scope",3);e.batchId="a2";var o=e.shared,s=o.current;Ft(e,a,r.context),r.framebuffer&&r.framebuffer.append(e,a),i(Object.keys(r.state)).forEach(function(t){var n=r.state[t],i=n.append(e,a);Array.isArray(i)?i.forEach(function(r,n){a.set(e.next[t],"["+n+"]",r)}):a.set(o.next,"."+t,i)}),[ee,ne,re,ie,te].forEach(function(t){var n=r.draw[t];n&&a.set(o.draw,"."+t,""+n.append(e,a))}),Object.keys(r.uniforms).forEach(function(n){a.set(o.uniforms,"["+t.id(n)+"]",r.uniforms[n].append(e,a))}),Object.keys(r.attributes).forEach(function(t){var n=r.attributes[t].append(e,a),i=e.scopeAttrib(t);Object.keys(new Yt).forEach(function(e){a.set(i,"."+e,n[e])})}),n(Q),n(Z),Object.keys(r.state).length>0&&(a(s,".dirty=true;"),a.exit(s,".dirty=true;")),a("a1(",e.shared.context,",a0,0);")}function Vt(e,t,r,n){var i=xt(),a=Ot(e,t,r,n);return Wt(i,a),qt(i,a),Gt(i,a),i.compile()}var Yt=pt.Record,Xt={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(Xt.min=Ke,Xt.max=Qe);var $t=r.angle_instanced_arrays,Jt=r.webgl_draw_buffers,Kt={dirty:!0},Qt={},Zt=[],er={},tr={};gt(_,Ae),gt(E,we),yt(j,"blendColor",[0,0,0,0]),yt(S,"blendEquationSeparate",[nt,nt]),yt(T,"blendFuncSeparate",[rt,tt,rt,tt]),gt(D,_e,!0),yt(O,"depthFunc",it),yt(F,"depthRange",[0,1]),yt(P,"depthMask",!0),yt(C,C,[!0,!0,!0,!0]),gt(B,xe),yt(L,"cullFace",Xe),yt(R,R,Je),yt(M,M,1),gt(I,je),yt(z,"polygonOffset",[0,0]),gt(U,Se),gt(W,Te),yt(H,"sampleCoverage",[1,!1]),gt(N,ke),yt(G,"stencilMask",-1),yt(q,"stencilFunc",[Ze,0,-1]),yt(V,"stencilOpSeparate",[Ye,et,et,et]),yt(Y,"stencilOpSeparate",[Xe,et,et,et]),gt(X,Ee),yt($,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),yt(J,J,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var rr={gl:e,context:bt,strings:t,next:Qt,current:Kt,draw:mt,elements:oe,buffer:ae,shader:ht,attributes:pt.state,uniforms:ve,framebuffer:be,extensions:r,isBufferArgs:n},nr={primTypes:h,compareFuncs:ft,blendFuncs:st,blendEquations:Xt,stencilOps:ut,glTypes:m,orientationType:lt};Jt&&(nr.backBuffer=[Xe],nr.drawBuffer=l(p.maxDrawbuffers,function(e){return l(e,function(e){return ot+e})}));var ir=0;return{next:Qt,current:Kt,procs:function(){var e=xt(),t=e.proc("poll"),r=e.proc("refresh"),n=e.block();t(n),r(n);var i=e.shared,a=i.gl,o=i.next,s=i.current;return n(s,".dirty=false;"),Pt(e,t),r(i.framebuffer,".dirty=true;"),Pt(e,r),Object.keys(er).forEach(function(i){var f=er[i],u=n.def(o,".",i),c=e.block();c("if(",u,"){",a,".enable(",f,")}else{",a,".disable(",f,")}",s,".",i,"=",u,";"),r(c),t("if(",u,"!==",s,".",i,"){",c,"}")}),Object.keys(tr).forEach(function(i){var f,u,c=tr[i],d=Kt[i],p=e.block();if(p(a,".",c,"("),Array.isArray(d)){var h=d.length;f=e.global.def(o,".",i),u=e.global.def(s,".",i),p(l(h,function(e){return f+"["+e+"]"}),");",l(h,function(e){return u+"["+e+"]="+f+"["+e+"];"}).join("")),t("if(",l(h,function(e){return f+"["+e+"]!=="+u+"["+e+"]"}).join("||"),"){",p,"}")}else f=n.def(o,".",i),u=n.def(s,".",i),p(f,");",s,".",i,"=",f,";"),t("if(",f,"!==",u,"){",p,"}");r(p)}),e.compile()}(),compile:Vt}}},{"./constants/dtypes.json":4,"./constants/primitives.json":5,"./util/check":17,"./util/codegen":19,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/loop":24}],7:[function(e,t,r){function n(e,t){this.id=l++,this.type=e,this.data=t}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function a(e){if(0===e.length)return[];var t=e.charAt(0),r=e.charAt(e.length-1);if(e.length>1&&t===r&&('"'===t||"'"===t))return['"'+i(e.substr(1,e.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(n)return a(e.substr(0,n.index)).concat(a(n[1])).concat(a(e.substr(n.index+n[0].length)));var o=e.split(".");if(1===o.length)return['"'+i(e)+'"'];for(var s=[],f=0;f<o.length;++f)s=s.concat(a(o[f]));return s}function o(e){return"["+a(e).join("][")+"]"}function s(e,t){switch(typeof t){case"boolean":case"number":case"string":return new n(e,o(t+""));case"undefined":return new n(e|p,null);default:c.raise("invalid property type")}}function f(e){return"function"==typeof e&&!e._reglType||e instanceof n}function u(e,t){if(e instanceof n){if(e.type&p)return new n(e.type&~p,o(t))}else if("function"==typeof e)return new n(d,e);return e}var c=e("./util/check"),l=0,d=0,p=128;t.exports={define:s,isDynamic:f,unbox:u,accessor:o}},{"./util/check":17}],8:[function(e,t,r){var n=e("./util/check"),i=e("./util/is-typed-array"),a=e("./util/is-ndarray"),o=e("./constants/primitives.json"),s=0,f=1,u=4,c=5120,l=5121,d=5122,p=5123,h=5124,m=5125,b=34963;t.exports=function(e,t,r){function v(){this.buffer=null,this.primType=u,this.vertCount=0,this.type=0}function g(e){function g(e){var r=e,b=t.oes_element_index_uint;if(r)if("number"==typeof r)x(r);else{var v=null,w="static";Array.isArray(r)||i(r)||a(r)?v=r:(n.type(r,"object","invalid arguments for elements"),"data"in r&&(v=r.data),"usage"in r&&(w=r.usage)),x(Array.isArray(v)||a(v)&&Array.isArray(v.data)||"type"in r?{type:r.type||(b?"uint32":"uint16"),usage:w,data:v}:{usage:w,data:v}),(Array.isArray(v)||i(v))&&(x.dimension=3)}else x();var A=y.buffer.byteLength,k=0;switch(y.buffer.dtype){case l:case c:k=l;break;case p:case d:k=p,A>>=1;break;case m:case h:n(b,"32 bit element buffers not supported"),k=m,A>>=2;break;default:n.raise("invalid element buffer type")}var _=u,E=y.buffer.dimension;if(1===E&&(_=s),2===E&&(_=f),3===E&&(_=u),"object"==typeof r){if("primitive"in r){var j=r.primitive;n.parameter(j,o),_=o[j]}"count"in r&&(A=0|r.vertCount)}return y.primType=_,y.vertCount=A,y.type=k,g}var y=new v,x=r.create(null,b,!0);return y.buffer=x._buffer,g(e),g._reglType="elements",g._elements=y,g.destroy=function(){n(null!==y.buffer,"must not double destroy elements"),x.destroy(),y.buffer=null},g}function y(e){return g({usage:"stream",data:e})._elements}function x(e){r.destroyStream(e.buffer)}return v.prototype.bind=function(){this.buffer.bind()},{create:g,createStream:y,destroyStream:x,getElements:function(e){return"function"==typeof e&&e._elements instanceof v?e._elements:null}}}},{"./constants/primitives.json":5,"./util/check":17,"./util/is-ndarray":21,"./util/is-typed-array":22}],9:[function(e,t,r){t.exports=function(e){function t(){["oes_texture_float","oes_texture_float_linear","oes_texture_half_float","oes_texture_half_float_linear","oes_standard_derivatives","oes_element_index_uint","oes_fbo_render_mipmap","webgl_depth_texture","webgl_draw_buffers","webgl_color_buffer_float","ext_texture_filter_anisotropic","ext_frag_depth","ext_blend_minmax","ext_shader_texture_lod","ext_color_buffer_half_float","ext_srgb","angle_instanced_arrays","webgl_compressed_texture_s3tc","webgl_compressed_texture_atc","webgl_compressed_texture_pvrtc","webgl_compressed_texture_etc1"].forEach(function(t){try{r[t]=e.getExtension(t)}catch(e){}})}var r={};return t(),{extensions:r,refresh:t}}},{}],10:[function(e,t,r){var n=e("./util/check"),i=e("./util/values"),a=e("./util/extend"),o=36160,s=36161,f=3553,u=34067,c=34069,l=36064,d=36096,p=36128,h=33306,m=5121,b=5126,v=36193,g=6408,y=32854,x=32855,w=36194,A=33189,k=36168,_=6402,E=34041,j=35907,S=34836,T=34842,D=34843,O=36053,F=36054,P=36055,C=36057,B=36061;t.exports=function(e,t,r,L,R){function M(e,t,r,n){this.target=e,this.level=t,this.texture=r,this.renderbuffer=n}function I(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function z(e,t){var r=t.width,i=t.height;if(e.texture){var a=e.texture._texture,o=Math.max(1,a.params.width>>e.level),s=Math.max(1,a.params.height>>e.level);r=r||o,i=i||s,n(o===r&&s===i,"inconsistent width/height for supplied texture"),n(a.pollId<0,"polling fbo textures not supported"),a.refCount+=1}else{var f=e.renderbuffer._renderbuffer;r=r||f.width,i=i||f.height,n(f.width===r&&f.height===i,"inconsistent width/height for renderbuffer"),n(ue.indexOf(f.format)>=0,"renderbuffer format not compatible with color channels"),f.refCount+=1}t.width=r,t.height=i}function U(t,r){r?r.texture?e.framebufferTexture2D(o,t,r.target,r.texture._texture.texture,r.level):e.framebufferRenderbuffer(o,t,s,r.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(o,t,f,null,0)}function W(e,t,r,n,i,a){if(e.texture){var o=e.texture;if(t)return o({format:r,type:n,width:i,height:a}),o._texture.refCount+=1,!0}else{var s=e.renderbuffer;if(!t)return s({format:r,width:i,height:a}),s._renderbuffer.refCount+=1,!0}return I(e),!1}function H(e){var t=f,r=0,i=null,a=null,o=e;"object"==typeof e&&(o=e.data,"level"in e&&(r=0|e.level),"target"in e&&(t=0|e.target)),n.type(o,"function","invalid attachment data");var l=e._reglType;return"texture"===l?(i=e,i._texture.target===u?n(t>=c&&t<c+6,"invalid cube map target"):n(t===f)):"renderbuffer"===l?(a=e,t=s,r=0):n.raise("invalid regl object for attachment"),new M(t,r,i,a)}function N(e){return e&&(e.texture||e.renderbuffer)}function G(){this.id=pe++,he[this.id]=this,this.framebuffer=null,this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null,this.ownsColor=!1,this.ownsDepthStencil=!1}function q(i){e.isFramebuffer(i.framebuffer)||(i.framebuffer=e.createFramebuffer()),K.dirty=!0,e.bindFramebuffer(o,i.framebuffer);for(var a=i.colorAttachments,s=0;s<a.length;++s)U(l+s,a[s]);for(s=a.length;s<r.maxColorAttachments;++s)U(l+s,null);U(d,i.depthAttachment),U(p,i.stencilAttachment),U(h,i.depthStencilAttachment),t.webgl_draw_buffers&&t.webgl_draw_buffers.drawBuffersWEBGL(de[a.length]);var f=e.checkFramebufferStatus(o);f!==O&&n.raise("framebuffer configuration not supported, status = "+Q[f])}function V(e){e.colorAttachments.forEach(I),I(e.depthAttachment),I(e.stencilAttachment),I(e.depthStencilAttachment)}function Y(t){var r=t.framebuffer;n(r,"must not double destroy framebuffer"),e.isFramebuffer(r)&&e.deleteFramebuffer(r)}function X(r){function i(r){var o,u=r||{},c=t.webgl_draw_buffers,l=0,d=0;if("shape"in u){var p=u.shape;n(Array.isArray(p)&&p.length>=2,"invalid shape for framebuffer"),l=p[0],d=p[1]}else"radius"in u&&(l=d=u.radius),"width"in u&&(l=u.width),"height"in u&&(d=u.height);var h=null,m=!1;if("colorBuffers"in u||"colorBuffer"in u){var b=u.colorBuffers||u.colorBuffer;for(Array.isArray(b)||(b=[b]),a.width=l,a.height=d,b.length>1&&n(c,"multiple render targets not supported"),n(b.length>=0,"must specify at least one color attachment"),h=b.map(H),o=0;o<h.length;++o){var v=h[o];n.framebufferFormat(v,fe,ue),z(v,a)}l=a.width,d=a.height}else{var g=!0,y="rgba",x="uint8",w=1;if(m=!0,a.width=l=l||e.drawingBufferWidth,a.height=d=d||e.drawingBufferHeight,"format"in u&&(y=u.format,n.parameter(y,se,"invalid color format"),g=y in Z),"type"in u&&(n(g,"colorType can not be set for renderbuffer targets"),x=u.type,n.parameter(x,le,"invalid color type")),"colorCount"in u&&(w=0|u.colorCount,n(w>=0,"color count must be positive")),a.ownsColor)for(h=a.colorAttachments;h.length>w;)I(h.pop());else h=[];for(o=0;o<h.length;++o)W(h[o],g,y,x,l,d)||(h[o--]=h[h.length-1],h.pop());for(;h.length<w;)g?h.push(new M(f,0,L.create({format:y,type:x,width:l,height:d},f),null)):h.push(new M(s,0,null,R.create({format:y,width:l,height:d})))}n(h.length>0,"must specify at least one color buffer"),a.width=l,a.height=d;var A=null,k=null,_=null,E=!1,j=0;if("depthBuffer"in u&&(A=H(u.depthBuffer),n.framebufferFormat(A,ie,te),j+=1),"stencilBuffer"in u&&(k=H(u.stencilBuffer),n.framebufferFormat(k,ae,re),j+=1),"depthStencilBuffer"in u&&(_=H(u.depthStencilBuffer),n.framebufferFormat(_,oe,ne),j+=1),A||k||_)n(1===j,"can specify only one of depth, stencil or depthStencil attachment"),z(A||k||_,a);else{var S=!0,T=!1,D=!1;"depth"in u&&(S=!!u.depth),"stencil"in u&&(T=!!u.stencil),"depthTexture"in u&&(D=!!u.depthTexture);var O=a.depthAttachment||a.stencilAttachment||a.depthStencilAttachment,F=null;if(S||T){if(E=!0,D){n(t.webgl_depth_texture,"depth texture extension not supported");var P;n(S,"stencil only textures not supported"),P=T?"depth stencil":"depth",a.ownsDepthStencil&&O.texture?(O.texture({format:P,width:l,height:d}),O.texture._texture.refCount+=1,F=O):F=new M(f,0,L.create({format:P,width:l,height:d},f),null)}else{var C;C=S?T?"depth stencil":"depth":"stencil",a.ownsDepthStencil&&O.renderbuffer?(O.renderbuffer({format:C,width:l,height:d}),O.renderbuffer._renderbuffer.refCount+=1,F=O):F=new M(s,0,null,R.create({format:C,width:l,height:d}))}S?T?_=F:A=F:k=F}}return V(a),a.colorAttachments=h,a.depthAttachment=A,a.stencilAttachment=k,a.depthStencilAttachment=_,a.ownsColor=m,a.ownsDepthStencil=E,i.color=h.map(N),i.depth=N(A),i.stencil=N(k),i.depthStencil=N(_),q(a),i.width=a.width,i.height=a.height,i}var a=new G;return i(r),i._reglType="framebuffer",i._framebuffer=a,i._destroy=function(){Y(a)},i}function $(){i(he).forEach(q)}function J(){i(he).forEach(Y)}var K={current:null,next:null,dirty:!1},Q={};Q[O]="complete",Q[F]="incomplete attachment",Q[C]="incomplete dimensions",Q[P]="incomplete, missing attachment",Q[B]="unsupported";var Z={rgba:g},ee={rgba4:y,rgb565:w,"rgb5 a1":x};t.ext_srgb&&(ee.srgba=j),t.ext_color_buffer_half_float&&(ee.rgba16f=T,ee.rgb16f=D),t.webgl_color_buffer_float&&(ee.rgba32f=S);var te=[A],re=[k],ne=[E],ie=[],ae=[],oe=[];t.webgl_depth_texture&&(ie.push(_),oe.push(E));var se=a(a({},Z),ee),fe=i(Z),ue=i(ee),ce=m,le={uint8:m};t.oes_texture_half_float&&(ce=le["half float"]=v),t.oes_texture_float&&(ce=le.float=b),le.best=ce;var de=function(){for(var e=new Array(r.maxDrawbuffers),t=0;t<=r.maxDrawbuffers;++t)for(var n=e[t]=new Array(t),i=0;i<t;++i)n[i]=l+i;return e}(),pe=0,he={};return a(K,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof G)return t}return null},create:X,clear:J,refresh:$})}},{"./util/check":17,"./util/extend":20,"./util/values":28}],11:[function(e,t,r){var n=3408,i=3410,a=3411,o=3412,s=3413,f=3414,u=3415,c=33901,l=33902,d=3379,p=3386,h=34921,m=36347,b=36348,v=35661,g=35660,y=34930,x=36349,w=34076,A=34024,k=7936,_=7937,E=7938,j=35724,S=34047,T=36063,D=34852;t.exports=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(S));var O=1,F=1;return t.webgl_draw_buffers&&(O=e.getParameter(D),F=e.getParameter(T)),{colorBits:[e.getParameter(i),e.getParameter(a),e.getParameter(o),e.getParameter(s)],depthBits:e.getParameter(f),stencilBits:e.getParameter(u),subpixelBits:e.getParameter(n),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:O,maxColorAttachments:F,pointSizeDims:e.getParameter(c),lineWidthDims:e.getParameter(l),maxViewportDims:e.getParameter(p),maxCombinedTextureUnits:e.getParameter(v),maxCubeMapSize:e.getParameter(w),maxRenderbufferSize:e.getParameter(A),maxTextureUnits:e.getParameter(y),maxTextureSize:e.getParameter(d),maxAttributes:e.getParameter(h),maxVertexUniforms:e.getParameter(m),maxVertexTextureUnits:e.getParameter(g),maxVaryingVectors:e.getParameter(b),maxFragmentUniforms:e.getParameter(x),glsl:e.getParameter(j),renderer:e.getParameter(_),vendor:e.getParameter(k),version:e.getParameter(E)}}},{}],12:[function(e,t,r){var n=e("./util/check"),i=e("./util/is-typed-array"),a=6408,o=5121,s=3333;t.exports=function(e,t,r){function f(f){var u=f||{};i(f)?u={data:u}:2===arguments.length?u={width:0|arguments[0],height:0|arguments[1]}:"object"!=typeof f&&(u={}),t();var c=u.x||0,l=u.y||0,d=u.width||r.viewportWidth,p=u.height||r.viewportHeight,h=d*p*4,m=u.data||new Uint8Array(h);return n.isTypedArray(m,"data buffer for regl.read() must be a typedarray"),n(m.byteLength>=h,"data buffer for regl.read() too small"),e.pixelStorei(s,4),e.readPixels(c,l,d,p,a,o,m),m}return f}},{"./util/check":17,"./util/is-typed-array":22}],13:[function(e,t,r){var n=e("./util/check"),i=e("./util/values"),a=36161,o=32854,s=32855,f=36194,u=33189,c=36168,l=34041,d=35907,p=34836,h=34842,m=34843;t.exports=function(e,t,r){function b(){this.id=k++,this.refCount=1,this.renderbuffer=null,this.format=o,this.width=0,this.height=0}function v(t){e.isRenderbuffer(t.renderbuffer)||(t.renderbuffer=e.createRenderbuffer()),e.bindRenderbuffer(a,t.renderbuffer),e.renderbufferStorage(a,t.format,t.width,t.height)}function g(t){var r=t.renderbuffer;n(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(a,null),e.isRenderbuffer(r)&&e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete _[t.id]}function y(e){function t(e){var a=e||{},s=0,f=0;if("shape"in a){var u=a.shape;n(Array.isArray(u)&&u.length>=2,"invalid renderbuffer shape"),s=0|u[0],f=0|u[1]}else"radius"in a&&(s=f=0|a.radius),"width"in a&&(s=0|a.width),"height"in a&&(f=0|a.height);var c=r.maxRenderbufferSize;if(n(s>=0&&f>=0&&s<=c&&f<=c,"invalid renderbuffer size"),t.width=i.width=Math.max(s,1),t.height=i.height=Math.max(f,1),i.format=o,"format"in a){var l=a.format;n.parameter(l,A,"invalid render buffer format"),i.format=A[l]}return v(i),t}var i=new b;return _[i.id]=i,t(e),t._reglType="renderbuffer",t._renderbuffer=i,t.destroy=function(){i.decRef()},t}function x(){i(_).forEach(v)}function w(){i(_).forEach(g)}var A={rgba4:o,rgb565:f,"rgb5 a1":s,depth:u,stencil:c,"depth stencil":l};t.ext_srgb&&(A.srgba=d),t.ext_color_buffer_half_float&&(A.rgba16f=h,A.rgb16f=m),t.webgl_color_buffer_float&&(A.rgba32f=p);var k=0,_={};return b.prototype.decRef=function(){0===--this.refCount&&g(this)},{create:y,refresh:x,clear:w}}},{"./util/check":17,"./util/values":28}],14:[function(e,t,r){var n=e("./util/check"),i=e("./util/values"),a=35632,o=35633,s=35718,f=35721;t.exports=function(e,t){function r(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function u(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function c(r,i,o){var s=r===a?p:h,f=s[i];if(!f){var u=t.str(i);f=e.createShader(r),e.shaderSource(f,u),e.compileShader(f),n.shaderError(e,f,u,r,o),s[i]=f}return f}function l(e,t){this.id=v++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[]}function d(i,l){var d,p,h=c(a,i.fragId),m=c(o,i.vertId),b=i.program=e.createProgram();e.attachShader(b,h),e.attachShader(b,m),e.linkProgram(b),n.linkError(e,b,t.str(i.fragId),t.str(i.vertId),l);var v=e.getProgramParameter(b,s),g=i.uniforms;for(d=0;d<v;++d)if(p=e.getActiveUniform(b,d))if(p.size>1)for(var y=0;y<p.size;++y){var x=p.name.replace("[0]","["+y+"]");u(g,new r(x,t.id(x),e.getUniformLocation(b,x),p))}else u(g,new r(p.name,t.id(p.name),e.getUniformLocation(b,p.name),p));var w=e.getProgramParameter(b,f),A=i.attributes;for(d=0;d<w;++d)p=e.getActiveAttrib(b,d),p&&u(A,new r(p.name,t.id(p.name),e.getAttribLocation(b,p.name),p))}var p={},h={},m={},b=[],v=0;return{clear:function(){var t=e.deleteShader.bind(e);i(p).forEach(t),p={},i(h).forEach(t),h={},b.forEach(function(t){e.deleteProgram(t.program)}),b.length=0,m={}},refresh:function(){p={},h={},b.forEach(d)},program:function(e,t,r){n(e>=0,"missing vertex shader"),n(t>=0,"missing fragment shader");var i=m[t];i||(i=m[t]={});var a=i[e];return a||(a=new l(t,e),d(a,r),i[e]=a,b.push(a)),a},shader:c,frag:null,vert:null}}},{"./util/check":17,"./util/values":28}],15:[function(e,t,r){t.exports=function(){var e={"":0},t=[""];return{id:function(r){var n=e[r];return n?n:(n=e[r]=t.length,t.push(r),n)},str:function(e){return t[e]}}}},{}],16:[function(e,t,r){function n(e){return!(e&e-1||!e)}function i(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function a(e){if(!Array.isArray(e))return!1;var t=e.length;if(0===t||!Array.isArray(e[0]))return!1;for(var r=e[0].length,n=1;n<t;++n)if(!Array.isArray(e[n])||e[n].length!==r)return!1;return!0}function o(e){return Object.prototype.toString.call(e)}function s(e){return"[object HTMLCanvasElement]"===o(e)}function f(e){return"[object CanvasRenderingContext2D]"===o(e)}function u(e){return"[object HTMLImageElement]"===o(e)}function c(e){return"[object HTMLVideoElement]"===o(e)}function l(e){return"[object XMLHttpRequest]"===o(e)}function d(e){return"string"==typeof e||!!e&&(v(e)||i(e)||g(e)||s(e)||f(e)||u(e)||c(e)||a(e))}function p(e,t,r,n,i,a,o,s){for(var f=new e.constructor(t*r*n),u=0,c=0;c<r;++c)for(var l=0;l<t;++l)for(var d=0;d<n;++d)f[u++]=e[a*c+i*l+o*d+s];return f}var h=e("./util/check"),m=e("./util/extend"),b=e("./util/values"),v=e("./util/is-typed-array"),g=e("./util/is-ndarray"),y=e("./util/load-texture"),x=e("./util/to-half-float"),w=e("./util/parse-dds"),A=34467,k=3553,_=34067,E=34069,j=6408,S=6406,T=6407,D=6409,O=6410,F=32854,P=32855,C=36194,B=32819,L=32820,R=33635,M=34042,I=6402,z=34041,U=35904,W=35906,H=36193,N=33776,G=33777,q=33778,V=33779,Y=35986,X=35987,$=34798,J=35840,K=35841,Q=35842,Z=35843,ee=36196,te=5121,re=5123,ne=5125,ie=5126,ae=10242,oe=10243,se=10497,fe=33071,ue=33648,ce=10240,le=10241,de=9728,pe=9729,he=9984,me=9985,be=9986,ve=9987,ge=33170,ye=4352,xe=4353,we=4354,Ae=34046,ke=3317,_e=37440,Ee=37441,je=37443,Se=37444,Te=33984,De=[he,be,me,ve];t.exports=function(e,t,r,o,Oe){function Fe(e){this.target=e,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=1,this.colorSpace=0,this.width=0,this.height=0,this.channels=0,this.format=0,this.internalformat=0,this.type=0,this.compressed=!1,this.miplevel=0,this.strideX=0,this.strideY=0,this.strideC=0,this.offset=0,this.x=0,this.y=0,this.copy=!1,this.data=null,this.image=null,this.video=null,this.canvas=null,this.xhr=null,this.crossOrigin=null,this.needsPoll=!1,this.needsListeners=!1}function Pe(e){this.target=e,this.width=0,this.height=0,this.format=0,this.internalformat=0,this.type=0,this.wrapS=fe,this.wrapT=fe,this.minFilter=0,this.magFilter=de,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ye}function Ce(e,r){var i,a,o=0,s=0,f=0,u=0,c=0,l=0,d=!1,p=!1,m=!1,b=0,v=[0,0,0,0,0,0],g=0,y=!1;for(i=0;i<r.length;++i){a=r[i],u=u||a.width<<a.miplevel,c=c||a.height<<a.miplevel,o=o||a.type,s=s||a.format,f=f||a.internalformat,l=l||a.channels,p=p||a.needsPoll,m=m||a.needsListeners,d=d||a.compressed;var x=a.miplevel,w=a.target;if(y=y||x>0,w===k)b|=1<<x;else{var A=w-E;v[A]|=1<<x,g|=1<<A}}e.needsPoll=p,e.needsListeners=m,e.width=u,e.height=c,e.format=s,e.internalformat=f,e.type=o;var _=y?(u<<1)-1:1;if(e.target===k)h(0===g,"pixmap type must not contain cubemap faces"),h(b===_,"missing mip map data");else for(h(63===g,"missing cubemap faces"),i=0;i<6;++i)h(v[i]===_,"missing mip map data");var S=De.indexOf(e.minFilter)>=0;e.genMipmaps=!y&&(e.genMipmaps||S);var T=y||e.genMipmaps;for(e.minFilter?h(T===S,"min filter inconsistent with mipmap data"):e.minFilter=T?ve:de,T&&h(u===c&&n(u),"must be a square power of 2 to support mipmaps"),e.genMipmaps&&h(!d,"mipmap generation not supported for compressed textures"),e.wrapS=e.wrapS||fe,e.wrapT=e.wrapT||fe,e.wrapS===fe&&e.wrapT===fe||h(n(u)&&n(c)&&!g,"incompatible size for wrap mode, image must be a power of 2"),(o===ie&&!t.oes_texture_float_linear||o===H&&!t.oes_texture_half_float_linear)&&h(this.magFilter===de&&this.minFilter===de,"unsupported filter mode for float texture"),i=0;i<r.length;++i){a=r[i];var D=a.miplevel;a.width&&h(a.width<<D===u,"inconsistent width"),a.height&&h(a.height<<D===c,"inconsistent width"),a.channels?h(a.channels===l,"inconsistent channels"):a.channels=l,a.format?h(a.format===s,"inconsistent format"):a.format=s,a.internalformat?h(a.internalformat===f,"inconsistent internalformat"):a.internalformat=f,a.type?h(a.type===o,"inconsistent type"):a.type=o,a.copy&&h(a.type===te&&a.internalformat===j,"incompatible format/type for copyTexImage2D")}}function Be(e){this.id=rt++,this.refCount=1,this.target=e,this.texture=null,this.pollId=-1,this.unit=-1,this.bindCount=0,this.cancelPending=null,this.params=new Pe(e),this.pixels=[]}function Le(e,t){function r(e,r){var n,i=r.mipmap;if(Array.isArray(i))for(var o=0;o<i.length;++o)n=new Fe(e),n.parseFlags(t),n.parseFlags(r),n.parse(i[o],o),a.push(n);else n=new Fe(e),n.parseFlags(t),n.parse(r,0),a.push(n)}var n;Ie(e);var i=e.params;Pe.call(i,e.target);var a=e.pixels;if(a.length=0,i.parse(t),e.target===k)r(k,t);else{var o=t.faces||t;if(Array.isArray(o))for(h(6===o.length,"invalid number of faces in cube map"),n=0;n<6;++n)r(E+n,o[n]);else if("string"==typeof o);else for(n=0;n<6;++n)r(E+n,{})}Ce(i,a),i.needsListeners&&Me(e),i.needsPoll&&(e.pollId=it.length,it.push(e)),Re(e)}function Re(t){e.isTexture(t.texture)||(t.texture=e.createTexture());var r=t.target,n=t.unit;n>=0?(e.activeTexture(Te+n),tt=n):e.bindTexture(r,t.texture);for(var i=t.pixels,a=t.params,o=0;o<i.length;++o)i[o].upload(a);if(a.upload(),n<0){var s=ot[tt];s?e.bindTexture(s.target,s.texture):(t.unit=tt,ot[tt]=t)}}function Me(e){function t(t,r,n){var a=w(n);h(a.format in et,"unsupported dds texture format"),a.cube?(h(e.target===_),h.raise("cube map DDS not yet implemented")):h(e.target===k),r&&h(1===a.pixels.length,"number of mip levels inconsistent"),a.pixels.forEach(function(e){var n=new Fe(a.cube?e.target:t);n.channels=a.channels,n.compressed=a.compressed,n.type=a.type,n.internalformat=a.format,n.format=et[a.format],n.width=e.width,n.height=e.height,n.miplevel=e.miplevel||r,n.data=e.data,i.push(n)})}function r(){for(var r=0;r<i.length;++r){var a=i[r],o=a.image,s=a.video,f=a.xhr;o&&o.complete?(a.width=o.naturalWidth,a.height=o.naturalHeight):s&&s.readyState>2?(a.width=s.width,a.height=s.height):f&&4===f.readyState&&(i[r]=i[i.length-1],i.pop(),f.removeEventListener("readystatechange",Re),t(a.target,a.miplevel,f.response))}Ce(n,i),Re(e)}var n=e.params,i=e.pixels;i.forEach(function(e){e.image&&!e.image.complete?e.image.addEventListener("load",r):e.video&&e.readyState<1?e.video.addEventListener("progress",r):e.xhr&&e.xhr.addEventListener("readystatechange",r)}),e.cancelPending=function(){i.forEach(function(e){e.image?e.image.removeEventListener("load",r):e.video?e.video.removeEventListener("progress",r):e.xhr&&(e.xhr.removeEventListener("readystatechange",r),e.xhr.abort())})}}function Ie(e){var t=e.cancelPending;t&&(t(),e.cancelPending=null);var r=e.pollId;if(r>=0){var n=it[r]=it[it.length-1];n.id=r,it.pop(),e.pollId=-1}}function ze(t){var r=t.texture;h(r,"must not double destroy texture");var n=t.unit,i=t.target;n>=0&&(e.activeTexture(Te+n),tt=n,e.bindTexture(i,null),ot[n]=null),Ie(t),e.isTexture(r)&&e.deleteTexture(r),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete nt[t.id]}function Ue(e,t){function r(e,i,a,o,s,f){var u=e||{};return t===_&&6===arguments.length&&(u=[e,i,a,o,s,f]),Le(n,u),r.width=n.params.width,r.height=n.params.height,r}var n=new Be(t);return nt[n.id]=n,r(e),r._reglType="texture",r._texture=n,r.destroy=function(){n.decRef()},r}function We(){b(nt).forEach(Re);for(var t=0;t<at;++t)ot[t]=null;tt=0,e.activeTexture(Te)}function He(){for(var t=0;t<at;++t)e.activeTexture(Te+t),e.bindTexture(k,null),ot[t]=null;e.activeTexture(Te),tt=0,b(nt).forEach(ze)}function Ne(){it.forEach(Re)}var Ge={"don't care":ye,"dont care":ye,nice:we,fast:xe},qe={repeat:se,clamp:fe,mirror:ue},Ve={nearest:de,linear:pe},Ye=m({"nearest mipmap nearest":he,"linear mipmap nearest":me,"nearest mipmap linear":be,"linear mipmap linear":ve,mipmap:ve},Ve),Xe={none:0,browser:Se},$e={uint8:te,rgba4:B,rgb565:R,"rgb5 a1":L},Je={alpha:S,luminance:D,"luminance alpha":O,rgb:T,rgba:j,rgba4:F,"rgb5 a1":P,rgb565:C},Ke={};t.ext_srgb&&(Je.srgb=U,Je.srgba=W),t.oes_texture_float&&($e.float=ie),t.oes_texture_half_float&&($e["half float"]=H),t.webgl_depth_texture&&(m(Je,{depth:I,"depth stencil":z}),m($e,{uint16:re,uint32:ne,"depth stencil":M})),t.webgl_compressed_texture_s3tc&&m(Ke,{"rgb s3tc dxt1":N,"rgba s3tc dxt1":G,"rgba s3tc dxt3":q,"rgba s3tc dxt5":V}),t.webgl_compressed_texture_atc&&m(Ke,{"rgb arc":Y,"rgba atc explicit alpha":X,"rgba atc interpolated alpha":$}),t.webgl_compressed_texture_pvrtc&&m(Ke,{"rgb pvrtc 4bppv1":J,"rgb pvrtc 2bppv1":K,"rgba pvrtc 4bppv1":Q,"rgba pvrtc 2bppv1":Z}),t.webgl_compressed_texture_etc1&&(Ke["rgb etc1"]=ee);var Qe=Array.prototype.slice.call(e.getParameter(A));Object.keys(Ke).forEach(function(e){var t=Ke[e];Qe.indexOf(t)>=0&&(Je[e]=t)});var Ze=Object.keys(Je);r.textureFormats=Ze;var et=Ze.reduce(function(e,t){var r=Je[t];return r===D||r===S||r===D||r===O||r===I||r===z?e[r]=r:r===P||t.indexOf("rgba")>=0?e[r]=j:e[r]=T,e},{});m(Fe.prototype,{parseFlags:function(e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(h.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),this.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(h.type(e.flipY,"boolean","invalid texture flip"),this.flipY=e.flipY),"alignment"in e&&(h.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),
this.unpackAlignment=e.alignment),"colorSpace"in e&&(h.parameter(e.colorSpace,Xe,"invalid colorSpace"),this.colorSpace=Xe[e.colorSpace]),"format"in e){var t=e.format;h.parameter(t,Je,"invalid texture format"),this.internalformat=Je[t],t in $e&&(this.type=$e[t]),t in Ke&&(this.compressed=!0)}if("type"in e){var r=e.type;h.parameter(r,$e,"invalid texture type"),this.type=$e[r]}var n=this.width,i=this.height,a=this.channels;if("shape"in e?(h(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),n=e.shape[0],i=e.shape[1],3===e.shape.length&&(a=e.shape[2])):("radius"in e&&(n=i=e.radius),"width"in e&&(n=e.width),"height"in e&&(i=e.height),"channels"in e&&(a=e.channels)),this.width=0|n,this.height=0|i,this.channels=0|a,"stride"in e){var o=e.stride;h(Array.isArray(o)&&o.length>=2,"invalid stride vector"),this.strideX=o[0],this.strideY=o[1],3===o.length?this.strideC=o[2]:this.strideC=1,this.needsTranspose=!0}else this.strideC=1,this.strideX=this.strideC*a,this.strideY=this.strideX*n;"offset"in e&&(this.offset=0|e.offset,this.needsTranspose=!0),"crossOrigin"in e&&(this.crossOrigin=e.crossOrigin)}},parse:function(e,r){this.miplevel=r,this.width=this.width>>r,this.height=this.height>>r;var n=e;switch(typeof e){case"string":break;case"object":if(!e)return;this.parseFlags(e),d(e.data)&&(n=e.data);break;case"undefined":return;default:h.raise("invalid pixel data type")}"string"==typeof n&&(n=y(n,this.crossOrigin));var o=null,m=!1;if(this.compressed&&h(n instanceof Uint8Array||l(n),"compressed texture data must be stored in a uint8array"),null===n);else if(v(n))this.data=n;else if(i(n))o=n,m=!0;else if(g(n)){Array.isArray(n.data)?(o=n.data,m=!0):this.data=n.data;var b=n.shape;this.width=b[0],this.height=b[1],3===b.length?this.channels=b[2]:this.channels=1;var w=n.stride;this.strideX=n.stride[0],this.strideY=n.stride[1],3===w.length?this.strideC=n.stride[2]:this.strideC=1,this.offset=n.offset,this.needsTranspose=!0}else if(s(n)||f(n))s(n)?this.canvas=n:this.canvas=n.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if(u(n))this.image=n,n.complete?(this.width=n.naturalWidth,this.height=n.naturalHeight):(this.width=this.width||n.naturalWidth,this.height=this.height||n.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if(c(n))this.video=n,n.readyState>1?(this.width=n.width,this.height=n.height):(this.width=this.width||n.width,this.height=this.height||n.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if(l(n))this.xhr=n,this.needsListeners=!0;else if(a(n)){var A,k,_,E,F=n[0].length,P=n.length,C=1;if(Array.isArray(n[0][0]))for(C=n[0][0].length,h(C>=0&&C<=4,"invalid number of channels for image data"),o=Array(F*P*C),E=0,k=0;k<P;++k)for(A=0;A<F;++A)for(_=0;_<C;++_)o[E++]=n[k][A][_];else for(o=Array(F*P),E=0,k=0;k<P;++k)for(A=0;A<F;++A)o[E++]=n[k][A];this.width=F,this.height=P,this.channels=C,m=!0}else e.copy&&(this.copy=!0,this.x=0|this.x,this.y=0|this.y,this.width=0|(this.width||Oe.viewportWidth),this.height=0|(this.height||Oe.viewportHeight),this.setDefaultFormat());if(!this.type&&this.data&&(this.format===I?this.data instanceof Uint16Array?this.type=re:this.data instanceof Uint32Array&&(this.type=ne):this.data instanceof Float32Array&&(this.type=ie)),!this.internalformat){var U=this.channels=this.channels||4;this.internalformat=[D,O,T,j][U-1],h(this.internalformat,"invalid number of channels")}var W=this.internalformat;W!==I&&W!==z||(h(t.webgl_depth_texture,"depth/stencil texture not supported"),W===I&&h(this.type===re||ne,"depth texture type must be uint16 or uint32"),W===z&&h(this.type===M,"depth stencil texture format must match type"),h(!(this.data||o||this.image||this.video||this.canvas),"depth/stencil textures are for rendering only"));var N=this.format=et[W];if(!this.channels)switch(N){case D:case S:case I:this.channels=1;break;case z:case O:this.channels=2;break;case T:this.channels=3;break;default:this.channels=4}var G=this.type;if(G===ie?h(t.oes_texture_float,"float texture not supported"):G===H?h(t.oes_texture_half_float,"half float texture not supported"):G||(G=W===I?ne:te),this.type=G,m)switch(G){case te:this.data=new Uint8Array(o);break;case re:this.data=new Uint16Array(o);break;case ne:this.data=new Uint32Array(o);break;case ie:this.data=new Float32Array(o);break;case H:this.data=x(o);break;case R:case L:case B:case M:h.raise("unsupported format for automatic conversion");break;default:h.raise("unsupported type conversion")}if(this.data)switch(this.needsTranspose&&(this.data=p(this.data,this.width,this.height,this.channels,this.strideX,this.strideY,this.strideC,this.offset)),G){case te:h(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case R:case L:case B:case re:case H:h(this.data instanceof Uint16Array,"incompatible pixel type");break;case ne:h(this.data instanceof Uint32Array,"incompatible pixel type");break;case ie:h(this.data instanceof Float32Array,"incompatible pixel type");break;default:h.raise("bad or missing pixel type")}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=j,this.type=te,this.channels=4,this.compressed=!1},upload:function(t){e.pixelStorei(_e,this.flipY),e.pixelStorei(Ee,this.premultiplyAlpha),e.pixelStorei(je,this.colorSpace),e.pixelStorei(ke,this.unpackAlignment);var r=this.target,n=this.miplevel,i=this.image,a=this.canvas,s=this.video,f=this.data,u=this.internalformat,c=this.format,l=this.type,d=this.width||Math.max(1,t.width>>n),p=this.height||Math.max(1,t.height>>n);s&&s.readyState>2?e.texImage2D(r,n,c,c,l,s):i&&i.complete?e.texImage2D(r,n,c,c,l,i):a?e.texImage2D(r,n,c,c,l,a):this.compressed?e.compressedTexImage2D(r,n,u,d,p,0,f):this.copy?(o(),e.copyTexImage2D(r,n,c,this.x,this.y,d,p,0)):f?e.texImage2D(r,n,c,d,p,0,c,l,f):e.texImage2D(r,n,c,d||1,p||1,0,c,l,null)}}),m(Pe.prototype,{parse:function(e){if("object"==typeof e&&e){if("min"in e){var t=e.min;h.parameter(t,Ye),this.minFilter=Ye[t]}if("mag"in e){var n=e.mag;h.parameter(n,Ve),this.magFilter=Ve[n]}var i=this.wrapS,a=this.wrapT;if("wrap"in e){var o=e.wrap;"string"==typeof o?(h.parameter(o,qe),i=a=qe[o]):Array.isArray(o)&&(h.parameter(o[0],qe),h.parameter(o[1],qe),i=qe[o[0]],a=qe[o[1]])}else{if("wrapS"in e){var s=e.wrapS;h.parameter(s,qe),i=qe[s]}if("wrapT"in e){var f=e.wrapT;h.parameter(f,qe),a=qe[f]}}if(this.wrapS=i,this.wrapT=a,"anisotropic"in e){var u=e.anisotropic;h("number"==typeof u&&u>=1&&u<=r.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=e.anisotropic}if("mipmap"in e){var c=e.mipmap;switch(typeof c){case"string":h.parameter(c,Ge,"invalid mipmap hint"),this.mipmapHint=Ge[c],this.genMipmaps=!0;break;case"boolean":this.genMipmaps=!!c;break;case"object":break;default:h.raise("invalid mipmap type")}}}},upload:function(){var r=this.target;e.texParameteri(r,le,this.minFilter),e.texParameteri(r,ce,this.magFilter),e.texParameteri(r,ae,this.wrapS),e.texParameteri(r,oe,this.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,Ae,this.anisotropic),this.genMipmaps&&(e.hint(ge,this.mipmapHint),e.generateMipmap(r))}});var tt=0,rt=0,nt={},it=[],at=r.maxTextureUnits,ot=Array(at).map(function(){return null});return m(Be.prototype,{bind:function(){var t=this;t.bindCount+=1;var r=t.unit;if(r<0){for(var n=0;n<at;++n){var i=ot[n];if(i){if(i.bindCount>0)continue;i.unit=-1}ot[n]=t,r=n;break}r>=at&&h.raise("insufficient number of texture units"),t.unit=r,e.activeTexture(Te+r),e.bindTexture(t.target,t.texture),tt=r}return r},unbind:function(){this.bindCount-=1},decRef:function(){0===--this.refCount&&ze(this)}}),{create:Ue,refresh:We,clear:He,poll:Ne,getTexture:function(e){return null}}}},{"./util/check":17,"./util/extend":20,"./util/is-ndarray":21,"./util/is-typed-array":22,"./util/load-texture":23,"./util/parse-dds":25,"./util/to-half-float":27,"./util/values":28}],17:[function(e,t,r){function n(e){return"undefined"!=typeof btoa?btoa(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function a(e,t){e||i(t)}function o(e){return e?": "+e:""}function s(e,t,r){e in t||i("unknown parameter ("+e+")"+o(r)+". possible values: "+Object.keys(t).join())}function f(e,t){F(e)||i("invalid parameter type"+o(t)+". must be a typed array")}function u(e,t,r){typeof e!==t&&i("invalid parameter type"+o(r)+". expected "+t+", got "+typeof e)}function c(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")}function l(e,t,r){t.indexOf(e)<0&&i("invalid value"+o(r)+". must be one of: "+t)}function d(e,t){for(e+="";e.length<t;)e=" "+e;return e}function p(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function h(e,t){this.number=e,this.line=t,this.errors=[]}function m(e,t,r){this.file=e,this.line=t,this.message=r}function b(){var e=new Error,t=e.stack.toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function v(){var e=new Error,t=e.stack,r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function g(e,t){var r=e.split("\n"),i=1,a=0,o={unknown:new p,0:new p};o.unknown.name=o[0].name=t||b(),o.unknown.lines.push(new h(0,""));for(var s=0;s<r.length;++s){var f=r[s],u=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(f);if(u)switch(u[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(u[2]);c&&(i=0|c[1],c[2]&&(a=0|c[2],a in o||(o[a]=new p)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]);l&&(o[a].name=l[1]?n(l[2]):l[2])}o[a].lines.push(new h(i++,f))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function y(e){var t=[];return e.split("\n").forEach(function(e){var r=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);r?t.push(new m(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new m("unknown",0,e))}),t}function x(e,t){t.forEach(function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}function w(e,t,r,n,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),s=n===e.FRAGMENT_SHADER?"fragment":"vertex",f=g(r,i),u=y(o);x(f,u),Object.keys(f).forEach(function(e){function t(e,t){n.push(e),i.push(t||"")}var r=f[e];if(r.hasErrors){var n=[""],i=[""];t("file number "+e+": "+r.name+"\n","color:red;text-decoration:underline;font-weight:bold"),r.lines.forEach(function(e){if(e.errors.length>0){t(d(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),t(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var r=0;e.errors.forEach(function(n){var i=n.message,a=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(i);if(a){var o=a[1];switch(i=a[2],o){case"assign":o="="}r=Math.max(e.line.indexOf(o,r),0)}else r=0;t(d("| ",6)),t(d("^^^",r+3)+"\n","font-weight:bold"),t(d("| ",6)),t(i+"\n","font-weight:bold")}),t(d("| ",6)+"\n")}else t(d(e.number,4)+"|  "),t(e.line+"\n","color:red")}),"undefined"!=typeof document?(i[0]=n.join("%c"),console.log.apply(console,i)):console.log(n.join(""))}}),a.raise("Error compiling "+s+" shader, "+f[0].name)}}function A(e,t,r,n,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),s=g(r,i),f=g(n,i),u='Error linking program with vertex shader, "'+f[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+o),a.raise(u)}}function k(e){e._commandRef=b()}function _(e,t,r,n){function i(e){return e?n.id(e):0}function a(e,t){Object.keys(t).forEach(function(t){e[n.id(t)]=!0})}k(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var s=e._attributeSet={};a(s,r.static),a(s,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function E(e,t){var r=v();i(e+" in command "+(t||b())+("unknown"===r?"":" called from "+r))}function j(e,t,r){e||E(t,r||b())}function S(e,t,r,n){e in t||E("unknown parameter ("+e+")"+o(r)+". possible values: "+Object.keys(t).join(),n||b())}function T(e,t,r,n){typeof e!==t&&E("invalid parameter type"+o(r)+". expected "+t+", got "+typeof e,n||b())}function D(e){e()}function O(e,t,r){e.texture?l(e.texture._texture.params.internalformat,t,"unsupported texture format for attachment"):l(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")}var F=e("./is-typed-array"),P=e("./extend");t.exports=P(a,{optional:D,raise:i,commandRaise:E,command:j,parameter:s,commandParameter:S,type:u,commandType:T,isTypedArray:f,nni:c,oneOf:l,shaderError:w,linkError:A,callSite:v,saveCommandRef:k,saveDrawInfo:_,framebufferFormat:O,guessCommand:b})},{"./extend":20,"./is-typed-array":22}],18:[function(e,t,r){t.exports="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],19:[function(e,t,r){function n(e){return Array.prototype.slice.call(e)}function i(e){return n(e).join("")}var a=e("./extend");t.exports=function(){function e(e){for(var t=0;t<l.length;++t)if(l[t]===e)return c[t];var r="g"+u++;return c.push(r),l.push(e),r}function t(){function e(){r.push.apply(r,n(arguments))}function t(){var e="v"+u++;return o.push(e),arguments.length>0&&(r.push(e,"="),r.push.apply(r,n(arguments)),r.push(";")),e}var r=[],o=[];return a(e,{def:t,toString:function(){return i([o.length>0?"var "+o+";":"",i(r)])}})}function r(){function e(e,t){n(e,t,"=",r.def(e,t),";")}var r=t(),n=t(),i=r.toString,o=n.toString;return a(r,{entry:r,exit:n,save:e,set:function(t,n,i){e(t,n),r(t,n,"=",i,";")},toString:function(){return i()+o()}})}function o(){var e=i(arguments),t=r(),o=r(),s=t.toString,f=o.toString;return a(t,{then:function(){return t.apply(t,n(arguments)),this},else:function(){return o.apply(o,n(arguments)),this},toString:function(){var t=f();return t&&(t="else{"+t+"}"),i(["if(",e,"){",s(),"}",t])}})}function s(e,t){function n(){var e="a"+o.length;return o.push(e),e}var o=[];t=t||0;for(var s=0;s<t;++s)n();var f=r(),u=f.toString,c=p[e]=a(f,{arg:n,toString:function(){return i(["function(",o.join(),"){",u(),"}"])}});return c}function f(){var e=['"use strict";',d,"return {"];Object.keys(p).forEach(function(t){e.push('"',t,'":',p[t].toString(),",")}),e.push("}");var t=i(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),r=Function.apply(null,c.concat(t));return r.apply(null,l)}var u=0,c=[],l=[],d=t(),p={};return{global:d,link:e,block:t,proc:s,scope:r,cond:o,compile:f}}},{"./extend":20}],20:[function(e,t,r){t.exports=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e}},{}],21:[function(e,t,r){var n=e("./is-typed-array");t.exports=function(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||n(e.data))}},{"./is-typed-array":22}],22:[function(e,t,r){var n=e("../constants/arraytypes.json");t.exports=function(e){return Object.prototype.toString.call(e)in n}},{"../constants/arraytypes.json":3}],23:[function(e,t,r){function n(e){var t=/\.(\w+)(\?.*)?$/.exec(e);if(t&&t[1])return t[1].toLowerCase()}function i(e){return["avi","asf","gifv","mov","qt","yuv","mpg","mpeg","m2v","mp4","m4p","m4v","ogg","ogv","vob","webm","wmv"].indexOf(e)>=0}function a(e){return["dds"].indexOf(e)>=0}function o(e,t){var r=document.createElement("video");return r.autoplay=!0,r.loop=!0,t&&(r.crossOrigin=t),r.src=e,r}function s(e,t,r){var n=new XMLHttpRequest;return n.responseType="arraybuffer",n.open("GET",e,!0),n.send(),n}function f(e,t){var r=new Image;return t&&(r.crossOrigin=t),r.src=e,r}function u(e,t){if("undefined"!=typeof document){var r=n(e);return i(r)?o(e,t):a(r)?s(e,r,t):f(e,t)}return null}t.exports=u},{}],24:[function(e,t,r){t.exports=function(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}},{}],25:[function(e,t,r){function n(e){function t(t){for(var r=b,n=v,i=0;i<I;++i){var a=Math.max(1,r+3>>2)*Math.max(1,n+3>>2)*x;U.pixels.push({target:t,miplevel:i,width:r,height:n,data:new Uint8Array(e,z,a)}),z+=a,r>>=1,n>>=1}}var r=new Int32Array(e);i(r[0]===a,"invalid magic number for dds header");var n=r[O];i(n&k,"unsupported dds format");var b=r[P],v=r[F],g=p,y=0,x=0,w=4;switch(r[L]){case E:x=8,n&_?(w=3,y=f):y=u;break;case j:x=16,y=c;break;case S:x=16,y=l;break;case T:x=8,y=d;break;default:i.raise("unsupported dds texture format")}var M=r[B],I=1;M&h&&(I=Math.max(1,r[C]));var z=r[D]+4,U={width:b,height:v,channels:w,format:y,type:g,compressed:!0,cube:!1,pixels:[]},W=r[R],H=!!(W&m);if(H){i((W&A)===A,"missing cubemap faces"),U.cube=!0;for(var N=0;N<6;++N)t(s+N)}else t(o);return U}var i=e("./check");t.exports=n;var a=542327876,o=3553,s=34069,f=33776,u=33777,c=33778,l=33779,d=36196,p=5121,h=131072,m=512,b=1024,v=2048,g=4096,y=8192,x=16384,w=32768,A=b|v|g|y|x|w,k=4,_=64,E=827611204,j=861165636,S=894720068,T=826496069,D=1,O=2,F=3,P=4,C=7,B=20,L=21,R=28},{"./check":17}],26:[function(e,t,r){"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?t.exports={next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:t.exports={next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],27:[function(e,t,r){t.exports=function(e){for(var t=new Float32Array(e),r=new Uint32Array(t.buffer),n=new Uint16Array(e.length),i=0;i<e.length;++i)if(isNaN(e[i]))n[i]=65535;else if(e[i]===1/0)n[i]=31744;else if(e[i]===-(1/0))n[i]=64512;else{var a=r[i],o=a>>>31<<15,s=(a<<1>>>24)-127,f=a>>13&1023;if(s<-24)n[i]=o;else if(s<-14){var u=-14-s;n[i]=o+(f+1024>>u)}else s>15?n[i]=o+31744:n[i]=o+(s+15<<10)+f}return n}},{}],28:[function(e,t,r){t.exports=function(e){return Object.keys(e).map(function(t){return e[t]})}},{}],29:[function(e,t,r){function n(e,t){function r(){var t=window.innerWidth,r=window.innerHeight;if(e!==document.body){var i=e.getBoundingClientRect();t=i.right-i.left,r=i.top-i.bottom}n.width=s*t,n.height=s*r,o(n.style,{width:t+"px",height:r+"px"})}var n=document.createElement("canvas"),a=i(n,t);o(n.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(n),e===document.body&&(n.style.position="absolute",o(e.style,{margin:0,padding:0}));var s=+a.options.pixelRatio;window.addEventListener("resize",r,!1);var f=a.options.onDestroy;return a.options=o(o({},a.options),{onDestroy:function(){window.removeEventListener("resize",r),e.removeChild(n),f&&f()}}),r(),a}function i(e,t){function r(t){try{return e.getContext(t,n)}catch(e){return null}}var n=t.glOptions||{},i=r("webgl")||r("experimental-webgl")||r("webgl-experimental");return a(i,"webgl not supported"),{gl:i,options:o({pixelRatio:window.devicePixelRatio},t)}}var a=e("./util/check"),o=e("./util/extend");t.exports=function(e){if("undefined"==typeof document||"undefined"==typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var t=document.body,r=e[1]||{};if("string"==typeof e[0])t=document.querySelector(e[0])||document.body;else if("object"==typeof e[0])if(e[0]instanceof HTMLElement)t=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:o({pixelRatio:1},r)};r=e[0]}return t.nodeName&&"CANVAS"===t.nodeName.toUpperCase()?i(t,r):n(t,r)}},{"./util/check":17,"./util/extend":20}],30:[function(e,t,r){var n=e("./lib/util/check"),i=e("./lib/util/extend"),a=e("./lib/dynamic"),o=e("./lib/util/raf"),s=e("./lib/util/clock"),f=e("./lib/strings"),u=e("./lib/webgl"),c=e("./lib/extension"),l=e("./lib/limits"),d=e("./lib/buffer"),p=e("./lib/elements"),h=e("./lib/texture"),m=e("./lib/renderbuffer"),b=e("./lib/framebuffer"),v=e("./lib/attribute"),g=e("./lib/shader"),y=e("./lib/read"),x=e("./lib/core"),w=16384,A=256,k=1024,_=34962,E=3553,j=34067,S="webglcontextlost",T="webglcontextrestored",D=1,O=2,F=3;t.exports=function(){function e(){le=o.next(e),$.count+=1;var t=fe.viewport,r=fe.scissor_box;t[0]=t[1]=r[0]=r[1]=0,$.viewportWidth=$.frameBufferWidth=$.drawingBufferWidth=t[2]=r[2]=U.drawingBufferWidth,$.viewportHeight=$.frameBufferWidth=$.drawingBufferHeight=t[3]=r[3]=U.drawingBufferHeight;var n=s();$.deltaTime=(n-V)/1e3,$.time=(n-q)/1e3,V=n,se.procs.refresh(),ne.poll();for(var i=0;i<ce.length;++i){var a=ce[i];a($,null,0)}}function t(){!le&&ce.length>0&&e()}function r(){le&&(o.cancel(e),le=0)}function P(e){r(),e.preventDefault(),W.onContextLost&&W.onContextLost()}function C(t){U.getError(),N.refresh(),se.procs.refresh(),Z.refresh(),ne.refresh(),ie.refresh(),ae.refresh(),re.refresh(),W.onContextRestored&&W.onContextRestored(),e()}function B(){r(),ue&&(ue.removeEventListener(S,P),ue.removeEventListener(T,C)),re.clear(),ae.clear(),ie.clear(),ne.clear(),Z.clear(),W.onDestroy&&W.onDestroy()}function L(e){function t(e){function t(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}var r=i({},e);return delete r.uniforms,delete r.attributes,delete r.context,t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),r}function r(e){var t={},r={};return Object.keys(e).forEach(function(n){var i=e[n];a.isDynamic(i)?r[n]=a.unbox(i,n):t[n]=i}),{dynamic:r,static:t}}function o(e){for(;b.length<e;)b.push(null);return b}function s(e,t){var r;if("function"==typeof e)return m.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)m.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)m.call(this,e[r],t,r);return}return m.call(this,e,t,0)}if("number"==typeof e){if(e>0)return h.call(this,o(0|e),0|e)}else{if(!Array.isArray(e))return p.call(this,e);if(e.length)return h.call(this,e,e.length)}}n(!!e,"invalid args to regl({...})"),n.type(e,"object","invalid args to regl({...})");var f=r(e.context||{}),u=r(e.uniforms||{}),c=r(e.attributes||{}),l=r(t(e)),d=se.compile(l,c,u,f),p=d.draw,h=d.batch,m=d.scope,b=[];return s}function R(){se.procs.poll()}function M(e){var t=0;R();var r=e.color;r&&(U.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),t|=w),"depth"in e&&(U.clearDepth(+e.depth),t|=A),"stencil"in e&&(U.clearStencil(0|e.stencil),t|=k),n(!!t,"called regl.clear with no buffer specified"),U.clear(t)}function I(e){function n(){var t=ce.find(function(t){return t===e});t<0||(ce.splice(t,1),ce.length<=0&&r())}return ce.push(e),t(),{cancel:n}}var z=u(Array.prototype.slice.call(arguments)),U=z.gl,W=z.options,H=f(),N=c(U),G=N.extensions,q=s(),V=q,Y=U.drawingBufferWidth,X=U.drawingBufferHeight,$={count:0,deltaTime:0,time:0,viewportWidth:Y,viewportHeight:X,framebufferWidth:Y,framebufferHeight:X,drawingBufferWidth:Y,drawingBufferHeight:X,pixelRatio:W.pixelRatio},J={},K={elements:null,primitive:4,count:-1,offset:0,instances:-1},Q=l(U,G),Z=d(U),ee=p(U,G,Z),te=v(U,G,Q,Z,H),re=g(U,H),ne=h(U,G,Q,R,$),ie=m(U,G,Q),ae=b(U,G,Q,ne,ie),oe=y(U,R,$),se=x(U,H,G,Q,Z,ee,ne,ae,J,te,re,K,$),fe=se.next,ue=U.canvas,ce=[],le=0;return ue&&(ue.addEventListener(S,P,!1),ue.addEventListener(T,C,!1)),se.procs.refresh(),i(L,{clear:M,prop:a.define.bind(null,D),context:a.define.bind(null,O),this:a.define.bind(null,F),draw:L({}),elements:function(e){return ee.create(e)},buffer:function(e){return Z.create(e,_)},texture:function(e){return ne.create(e,E)},cube:function(e){return 6===arguments.length?ne.create(Array.prototype.slice.call(arguments),j):ne.create(e,j)},renderbuffer:function(e){return ie.create(e)},framebuffer:function(e){return ae.create(e)},framebufferCube:function(e){n.raise("framebuffer cube not yet implemented")},attributes:U.getContextAttributes(),frame:I,limits:Q,read:oe,destroy:B,_gl:U,_refresh:function(){se.procs.refresh()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/core":6,"./lib/dynamic":7,"./lib/elements":8,"./lib/extension":9,"./lib/framebuffer":10,"./lib/limits":11,"./lib/read":12,"./lib/renderbuffer":13,"./lib/shader":14,"./lib/strings":15,"./lib/texture":16,"./lib/util/check":17,"./lib/util/clock":18,"./lib/util/extend":20,"./lib/util/raf":26,"./lib/webgl":29}]},{},[30])(30)});
//# sourceMappingURL=regl.min.js.map