!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.reglInit=e()}}(function(){return function e(t,n,r){function i(o,f){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!f&&u)return u(o,!0);if(a)return a(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=i,this.offset=0,this.stride=0,this.divisor=0}var i=5126;t.exports=function(e,t,n,i,a){for(var o=n.maxAttributes,f=new Array(o),u=0;u<o;++u)f[u]=new r;return{Record:r,scope:{},state:f}}},{}],2:[function(e,t,n){function r(e){return 0|d[Object.prototype.toString.call(e)]}function i(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function a(e,t,n,r,i,a,o){for(var f=0,u=0;u<n;++u)for(var s=0;s<r;++s)e[f++]=t[i*u+a*s+o]}function o(e,t,n){for(var r=0,i=0;i<t.length;++i)for(var a=t[i],o=0;o<n;++o)e[r++]=a[o]}var f=e("./util/check"),u=e("./util/is-typed-array"),s=e("./util/is-ndarray"),c=e("./util/values"),l=e("./util/pool"),d=e("./constants/arraytypes.json"),p=e("./constants/dtypes.json"),m=e("./constants/usage.json"),h=35044,b=35040,g=5121,v=5126;t.exports=function(e,t){function n(t){this.id=A++,this.buffer=e.createBuffer(),this.type=t,this.usage=h,this.byteLength=0,this.dimension=1,this.dtype=g}function d(t,r){var i=E.pop();return i||(i=new n(t),i.buffer=e.createBuffer()),i.bind(),w(i,r,b,0,1),i}function y(e){E.push(e)}function x(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function w(e,t,n,c,d){if(e.usage=n,Array.isArray(t)){if(e.dtype=c||v,t.length>0){var p;if(Array.isArray(t[0]))e.dimension=t[0].length,p=l.allocType(e.dtype,t.length*e.dimension),o(p,t,e.dimension),x(e,p,n),l.freeType(p);else if("number"==typeof t[0]){e.dimension=d;var m=l.allocType(e.dtype,t.length);i(m,t),x(e,m,n),l.freeType(m)}else u(t[0])?(e.dimension=t[0].length,e.dtype=c||r(t[0])||v,p=l.allocType(e.dtype,t.length*e.dimension),o(p,t,e.dimension),x(e,p,n),l.freeType(p)):f.raise("invalid buffer data")}}else if(u(t))e.dtype=c||r(t),e.dimension=d,x(e,t,n);else if(s(t)){var h=t.shape,b=t.stride,g=t.offset,y=0,w=0,k=0,_=0;1===h.length?(y=h[0],w=1,k=b[0],_=0):2===h.length?(y=h[0],w=h[1],k=b[0],_=b[1]):f.raise("invalid shape"),e.dtype=c||r(t.data)||v,e.dimension=w;var A=l.allocType(e.dtype,y*w);a(A,t.data,y,w,k,_,g),x(e,A,n),l.freeType(A)}else f.raise("invalid buffer data")}function k(n){t.bufferCount--;var r=n.buffer;f(r,"buffer must not be deleted already"),e.deleteBuffer(r),n.buffer=null,delete T[n.id]}function _(c,d,b){function v(t){var n=h,r=null,i=0,a=0,o=1;return Array.isArray(t)||u(t)||s(t)?r=t:"number"==typeof t?i=0|t:t&&(f.type(t,"object","buffer arguments must be an object, a number or an array"),"data"in t&&(f(null===r||Array.isArray(r)||u(r)||s(r),"invalid data for buffer"),r=t.data),"usage"in t&&(f.parameter(t.usage,m,"invalid buffer usage"),n=m[t.usage]),"type"in t&&(f.parameter(t.type,p,"invalid buffer type"),a=p[t.type]),"dimension"in t&&(f.type(t.dimension,"number","invalid dimension"),o=0|t.dimension),"length"in t&&(f.nni(i,"buffer length must be a nonnegative integer"),i=0|t.length)),_.bind(),r?w(_,r,n,a,o):(e.bufferData(_.type,i,n),_.dtype=a||g,_.usage=n,_.dimension=o,_.byteLength=i),v}function y(t,n){f(n+t.byteLength<=_.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+_.byteLength),e.bufferSubData(_.type,n,t)}function x(e,t){var n=0|(t||0);if(_.bind(),Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var c=l.allocType(_.dtype,e.length);i(c,e),y(c,n),l.freeType(c)}else if(Array.isArray(e[0])||u(e[0])){var d=e[0].length,p=l.allocType(_.dtype,e.length*d);o(p,e,d),y(p,n),l.freeType(p)}else f.raise("invalid buffer data")}else if(u(e))y(e,n);else if(s(e)){var m=e.shape,h=e.stride,b=0,g=0,x=0,w=0;1===m.length?(b=m[0],g=1,x=h[0],w=0):2===m.length?(b=m[0],g=m[1],x=h[0],w=h[1]):f.raise("invalid shape");var k=Array.isArray(e.data)?_.dtype:r(e.data),A=l.allocType(k,b*g);a(A,e.data,b,g,x,w,e.offset),y(A,n),l.freeType(A)}else f.raise("invalid data for buffer subdata");return v}t.bufferCount++;var _=new n(d);return T[_.id]=_,b||v(c),v._reglType="buffer",v._buffer=_,v.subdata=x,v.destroy=function(){k(_)},v}var A=0,T={};n.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},n.prototype.destroy=function(){k(this)};var E=[];return{create:_,createStream:d,destroyStream:y,clear:function(){c(T).forEach(k)},getBuffer:function(e){return e&&e._buffer instanceof n?e._buffer:null},_initBuffer:w}}},{"./constants/arraytypes.json":3,"./constants/dtypes.json":4,"./constants/usage.json":6,"./util/check":20,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/values":31}],3:[function(e,t,n){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],4:[function(e,t,n){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126}},{}],5:[function(e,t,n){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],6:[function(e,t,n){t.exports={static:35044,dynamic:35048,stream:35040}},{}],7:[function(e,t,n){function r(e){return Array.isArray(e)||d(e)||p(e)}function i(e){return e.sort(function(e,t){return e===K?-1:t===K?1:e<t?-1:1})}function a(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function o(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function f(e){return new a(!1,!1,!1,e)}function u(e,t){var n=e.type;if(n===w){var r=e.data.length;return new a(!0,r>=1,r>=2,t)}return new a(n===A,n===_,n===k,t)}var s=e("./util/check"),c=e("./util/codegen"),l=e("./util/loop"),d=e("./util/is-typed-array"),p=e("./util/is-ndarray"),m=e("./util/is-array-like"),h=e("./constants/primitives.json"),b=e("./constants/dtypes.json"),g="xyzw".split(""),v=5121,y=1,x=2,w=0,k=1,_=2,A=3,T="dither",E="blend.enable",j="blend.color",S="blend.equation",D="blend.func",O="depth.enable",C="depth.func",F="depth.range",P="depth.mask",z="colorMask",L="cull.enable",B="cull.face",I="frontFace",R="lineWidth",M="polygonOffset.enable",H="polygonOffset.offset",N="sample.alpha",W="sample.enable",U="sample.coverage",Q="stencil.enable",q="stencil.mask",G="stencil.func",V="stencil.opFront",Y="stencil.opBack",X="scissor.enable",$="scissor.box",K="viewport",J="framebuffer",Z="vert",ee="frag",te="elements",ne="primitive",re="count",ie="offset",ae="instances",oe="Width",fe="Height",ue=J+oe,se=J+fe,ce=K+oe,le=K+fe,de="drawingBuffer",pe=de+oe,me=de+fe,he=34962,be=34963,ge=35632,ve=35633,ye=3553,xe=34067,we=2884,ke=3042,_e=3024,Ae=2960,Te=2929,Ee=3089,je=32823,Se=32926,De=32928,Oe=5126,Ce=35664,Fe=35665,Pe=35666,ze=5124,Le=35667,Be=35668,Ie=35669,Re=35670,Me=35671,He=35672,Ne=35673,We=35674,Ue=35675,Qe=35676,qe=35678,Ge=35680,Ve=4,Ye=1028,Xe=1029,$e=2304,Ke=2305,Je=32775,Ze=32776,et=519,tt=7680,nt=0,rt=1,it=32774,at=513,ot=36160,ft=36064,ut={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},st={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ct={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},lt={frag:ge,vert:ve},dt={cw:$e,ccw:Ke},pt=new a(!1,!1,!1,function(){});t.exports=function(e,t,n,d,p,oe,fe,de,ge,ve,mt,ht,bt,gt){function vt(e){return e.replace(".","_")}function yt(e,t,n){var r=vt(e);nn.push(e),tn[r]=en[r]=!!n,rn[r]=t}function xt(e,t,n){var r=vt(e);nn.push(e),Array.isArray(n)?(en[r]=n.slice(),tn[r]=n.slice()):en[r]=tn[r]=n,an[r]=t}function wt(){var e=c(),n=e.link,r=e.global;e.id=un++,e.batchId="0";var i=n(on),a=e.shared={props:"a0"};Object.keys(on).forEach(function(e){a[e]=r.def(i,".",e)}),s.optional(function(){e.CHECK=n(s),e.commandStr=s.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")}});var o=e.next={},f=e.current={};Object.keys(an).forEach(function(e){Array.isArray(en[e])&&(o[e]=r.def(a.next,".",e),f[e]=r.def(a.current,".",e))});var u=e.constants={};Object.keys(fn).forEach(function(e){u[e]=r.def(JSON.stringify(fn[e]))}),e.invoke=function(t,r){switch(r.type){case w:var i=["this",a.context,a.props,e.batchId];return t.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case k:return t.def(a.props,r.data);case _:return t.def(a.context,r.data);case A:return t.def("this",r.data)}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var r=t.id(e);if(r in l)return l[r];var i=ve.scope[r];i||(i=ve.scope[r]=new $t);var a=l[r]=n(i);return a},e}function kt(e){var t=e.static,n=e.dynamic;if(J in t){var r=t[J];return r?(r=de.getFramebuffer(r),s.command(r,"invalid framebuffer object"),f(function(e,t){var n=e.link(r),i=e.shared;t.set(i.framebuffer,".next",n);var a=i.context;return t.set(a,"."+ue,n+".width"),t.set(a,"."+se,n+".height"),n})):f(function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+ue,r+"."+pe),t.set(r,"."+se,r+"."+me),"null"})}if(J in n){var i=n[J];return u(i,function(e,t){var n=e.invoke(t,i),r=e.shared,a=r.framebuffer,o=t.def(a,".getFramebuffer(",n,")");s.optional(function(){e.assert(t,"!"+n+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var f=r.context;return t.set(f,"."+ue,o+"?"+o+".width:"+f+"."+pe),t.set(f,"."+se,o+"?"+o+".height:"+f+"."+me),o})}return null}function _t(e,t){function n(e){if(e in r){var n=r[e];s.commandType(n,"object","invalid "+e);var o=!0,f=0|n.x,c=0|n.y;s.command(f>=0&&c>=0,"invalid "+e);var l,d;return"width"in n?(l=0|n.width,s.command(l>0,"invalid "+e)):o=!1,"height"in n?(d=0|n.height,s.command(d>0,"invalid "+e)):o=!1,new a(!o&&t&&t.thisDep,!o&&t&&t.contextDep,!o&&t&&t.propDep,function(t,r){var i=t.shared.context,a=l;"width"in n?s.command(l>0,"invalid "+e):a=r.def(i,".",ue,"-",f);var o=d;return"height"in n?s.command(d>0,"invalid "+e):o=r.def(i,".",se,"-",c),[f,c,a,o]})}if(e in i){var p=i[e],m=u(p,function(t,n){var r=t.invoke(n,p);s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=t.shared.context,a=n.def(r,".x|0"),o=n.def(r,".y|0"),f=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",ue,"-",a,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",se,"-",o,")");return s.optional(function(){t.assert(n,a+">=0&&"+o+">=0&&"+f+">0&&"+u+">0","invalid "+e)}),[a,o,f,u]});return t&&(m.thisDep=m.thisDep||t.thisDep,m.contextDep=m.contextDep||t.contextDep,m.propDep=m.propDep||t.propDep),m}return t?new a(t.thisDep,t.contextDep,t.propDep,function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",ue),t.def(n,".",se)]}):null}var r=e.static,i=e.dynamic,o=n(K);if(o){var f=o;o=new a(o.thisDep,o.contextDep,o.propDep,function(e,t){var n=f.append(e,t),r=e.shared.context;return t.set(r,"."+ce,n[2]),t.set(r,"."+le,n[3]),n})}return{viewport:o,scissor_box:n($)}}function At(e){function n(e){if(e in i){var n=t.id(i[e]);s.optional(function(){mt.shader(lt[e],n)});var r=f(function(){return n});return r.id=n,r}if(e in c){var a=c[e];return u(a,function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return s.optional(function(){n(t.shared.shader,".shader(",lt[e],",",i,",",t.command,");")}),i})}return null}var r,i=e.static,c=e.dynamic,l=n(ee),d=n(Z),p=null;return o(l)&&o(d)?(p=mt.program(d.id,l.id),r=f(function(e,t){return e.link(p)})):r=new a(l&&l.thisDep||d&&d.thisDep,l&&l.contextDep||d&&d.contextDep,l&&l.propDep||d&&d.propDep,function(e,t){var n,r=e.shared.shader;n=l?l.append(e,t):t.def(r,".",ee);var i;i=d?d.append(e,t):t.def(r,".",Z);var a=r+".program("+i+","+n;return s.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:l,vert:d,progVar:r,program:p}}function Tt(e){function t(){if(te in l){var e=l[te];r(e)?e=oe.getElements(oe.create(e)):e&&(e=oe.getElements(e),s.command(e,"invalid elements"));var t=f(function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null});return t.value=e,t}if(te in d){var n=d[te];return u(n,function(e,t){var r=e.shared,i=r.isBufferArgs,a=r.elements,o=e.invoke(t,n),f=t.def("null"),u=t.def(i,"(",o,")"),c=e.cond(u).then(f,"=",a,".createStream(",o,");").else(f,"=",a,".getElements(",o,");");return s.optional(function(){e.assert(c.else,"!"+o+"||"+f,"invalid elements")}),t.entry(c),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f})}return null}function n(){if(ne in l){var e=l[ne];return s.commandParameter(e,h,"invalid primitve"),f(function(t,n){return h[e]})}if(ne in d){var t=d[ne];return u(t,function(e,n){var r=e.constants.primTypes,i=e.invoke(n,t);return s.optional(function(){e.assert(n,i+" in "+r,"invalid primitive, must be one of "+Object.keys(h))}),n.def(r,"[",i,"]")})}return p?o(p)?f(p.value?function(e,t){return t.def(e.ELEMENTS,".primType")}:function(){return Ve}):new a(p.thisDep,p.contextDep,p.propDep,function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Ve)}):null}function i(e,t){if(e in l){var n=0|l[e];return s.command(!t||n>=0,"invalid "+e),f(function(e,r){return t&&(e.OFFSET=n),n})}if(e in d){var r=d[e];return u(r,function(n,i){var a=n.invoke(i,r);return t&&(n.OFFSET=a,s.optional(function(){n.assert(i,a+">=0","invalid "+e)})),a})}return t&&p?f(function(e,t){return e.OFFSET="0",0}):null}function c(){if(re in l){var e=0|l[re];return s.command("number"==typeof e&&e>=0,"invalid vertex count"),f(function(){return e})}if(re in d){var t=d[re];return u(t,function(e,n){var r=e.invoke(n,t);return s.optional(function(){e.assert(n,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(p){if(o(p)){if(p)return m?new a(m.thisDep,m.contextDep,m.propDep,function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return s.optional(function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")}),n}):f(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var n=f(function(){return-1});return s.optional(function(){n.MISSING=!0}),n}var r=new a(p.thisDep||m.thisDep,p.contextDep||m.contextDep,p.propDep||m.propDep,function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")});return s.optional(function(){r.DYNAMIC=!0}),r}return null}var l=e.static,d=e.dynamic,p=t(),m=i(ie,!0);return{elements:p,primitive:n(),count:c(),instances:i(ae,!1),offset:m}}function Et(e){var t=e.static,n=e.dynamic,r={};return nn.forEach(function(e){function i(i,o){if(e in t){var s=i(t[e]);r[a]=f(function(){return s})}else if(e in n){var c=n[e];r[a]=u(c,function(e,t){return o(e,t,e.invoke(t,c))})}}var a=vt(e);switch(e){case L:case E:case T:case Q:case O:case X:case M:case N:case W:case P:return i(function(t){return s.commandType(t,"boolean",e),t},function(t,n,r){return s.optional(function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e)}),r});case C:return i(function(t){return s.commandParameter(t,st,"invalid "+e),st[t]},function(t,n,r){var i=t.constants.compareFuncs;return s.optional(function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(st))}),n.def(i,"[",r,"]")});case F:return i(function(e){return s.command(m(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array"),e},function(e,t,n){s.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")});var r=t.def("+",n,"[0]"),i=t.def("+",n,"[1]");return[r,i]});case D:return i(function(e){s.commandType(e,"object","blend.func");var t="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,r="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return s.commandParameter(t,ut,a+".srcRGB"),s.commandParameter(n,ut,a+".srcAlpha"),s.commandParameter(r,ut,a+".dstRGB"),s.commandParameter(i,ut,a+".dstAlpha"),[ut[t],ut[r],ut[n],ut[i]]},function(t,n,r){function i(i,o){var f=n.def('"',i,o,'" in ',r,"?",r,".",i,o,":",r,".",i);return s.optional(function(){t.assert(n,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(ut))}),n.def(a,"[",f,"]")}var a=t.constants.blendFuncs;s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});var o=i("src","RGB"),f=i("src","Alpha"),u=i("dst","RGB"),c=i("dst","Alpha");return[o,u,f,c]});case S:return i(function(t){return"string"==typeof t?(s.commandParameter(t,Kt,"invalid "+e),[Kt[t],Kt[t]]):"object"==typeof t?(s.commandParameter(t.rgb,Kt,e+".rgb"),s.commandParameter(t.alpha,Kt,e+".alpha"),[Kt[t.rgb],Kt[t.alpha]]):void s.commandRaise("invalid blend.equation")},function(t,n,r){var i=t.constants.blendEquations,a=n.def(),o=n.def(),f=t.cond("typeof ",r,'==="string"');return s.optional(function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(Kt))}n(f.then,e,r),t.assert(f.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(f.else,e+".rgb",r+".rgb"),n(f.else,e+".alpha",r+".alpha")}),f.then(a,"=",o,"=",i,"[",r,"];"),f.else(a,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(f),[a,o]});case j:return i(function(e){return s.command(m(e)&&4===e.length,"blend.color must be a 4d array"),l(4,function(t){return+e[t]})},function(e,t,n){return s.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")}),l(4,function(e){return t.def("+",n,"[",e,"]")})});case q:return i(function(e){return s.commandType(e,"number",a),0|e},function(e,t,n){return s.optional(function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")}),t.def(n,"|0")});case G:return i(function(t){s.commandType(t,"object",a);var n=t.cmp||"keep",r=t.ref||0,i="mask"in t?t.mask:-1;return s.commandParameter(n,st,e+".cmp"),s.commandType(r,"number",e+".ref"),s.commandType(i,"number",e+".mask"),[st[n],r,i]},function(e,t,n){var r=e.constants.compareFuncs;s.optional(function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")});var i=t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",tt),a=t.def(n,".ref|0"),o=t.def('"mask" in ',n,"?",n,".mask|0:-1");return[i,a,o]});case V:case Y:return i(function(t){s.commandType(t,"object",a);var n=t.fail||"keep",r=t.zfail||"keep",i=t.pass||"keep";return s.commandParameter(n,ct,e+".fail"),s.commandParameter(r,ct,e+".zfail"),s.commandParameter(i,ct,e+".pass"),[e===Y?Xe:Ye,ct[n],ct[r],ct[i]]},function(t,n,r){function i(i){return s.optional(function(){t.assert(n,'!("'+i+'" in '+r+")||("+r+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(ct))}),n.def('"',i,'" in ',r,"?",a,"[",r,".",i,"]:",tt)}var a=t.constants.stencilOps;return s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}),[e===Y?Xe:Ye,i("fail"),i("zfail"),i("pass")]});case H:return i(function(e){s.commandType(e,"object",a);var t=0|e.factor,n=0|e.units;return s.commandType(t,"number",a+".factor"),s.commandType(n,"number",a+".units"),[t,n]},function(t,n,r){s.optional(function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)});var i=n.def(r,".factor|0"),a=n.def(r,".units|0");return[i,a]});case B:return i(function(e){var t=0;return"front"===e?t=Ye:"back"===e&&(t=Xe),s.command(!!t,a),t},function(e,t,n){return s.optional(function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")}),t.def(n,'==="front"?',Ye,":",Xe)});case R:return i(function(e){return s.command("number"==typeof e&&e>=d.lineWidthDims[0]&&e<=d.lineWidthDims[1],"invalid line width, must positive number between "+d.lineWidthDims[0]+" and "+d.lineWidthDims[1]),e},function(e,t,n){return s.optional(function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+d.lineWidthDims[0]+"&&"+n+"<="+d.lineWidthDims[1],"invalid line width")}),n});case I:return i(function(e){return s.commandParameter(e,dt,a),dt[e]},function(e,t,n){return s.optional(function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(n+'==="cw"?'+$e+":"+Ke)});case z:return i(function(e){return s.command(m(e)&&4===e.length,"color.mask must be length 4 array"),e.map(function(e){return!!e})},function(e,t,n){return s.optional(function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")}),l(4,function(e){return"!!"+n+"["+e+"]"})});case U:return i(function(e){s.command("object"==typeof e&&e,a);var t="value"in e?e.value:1,n=!!e.invert;return s.command("number"==typeof t&&t>=0&&t<=1,"sample.coverage.value must be a number between 0 and 1"),[t,n]},function(e,t,n){s.optional(function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")});var r=t.def('"value" in ',n,"?+",n,".value:1"),i=t.def("!!",n,".invert");return[r,i]})}}),r}function jt(e){function t(e){var t=a[e];t&&(f[e]=t)}var n=e.static,r=e.dynamic;s.optional(function(){function e(e){Object.keys(e).forEach(function(e){s.command(i.indexOf(e)>=0,'unknown parameter "'+e+'"',t)})}var t=s.guessCommand(),i=[J,Z,ee,te,ne,ie,re,ae].concat(nn);e(n),e(r)});var i=kt(e),a=_t(e,i),o=Tt(e),f=Et(e),u=At(e);t(K),t(vt($));var c=Object.keys(f).length>0;return{framebuffer:i,draw:o,shader:u,state:f,dirty:c}}function St(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n,i=t[e];"number"==typeof i||"boolean"==typeof i?n=f(function(){return i}):"function"!=typeof i||"texture2d"!==i._reglType&&"textureCube"!==i._reglType?m(i)?n=f(function(t){var n=t.global.def("[",l(i.length,function(t){return s.command("number"==typeof i[t]||"boolean"==typeof i[t],"invalid uniform "+e),i[t]}),"]");return n}):s.commandRaise("invalid uniform "+e):n=f(function(e){return e.link(i)}),n.value=i,r[e]=n}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=u(t,function(e,n){return e.invoke(n,t)})}),r}function Dt(e){var n=e.static,i=e.dynamic,a={};return Object.keys(n).forEach(function(e){var i=n[e],o=t.id(e),u=new $t;if(r(i))u.state=y,u.buffer=p.getBuffer(p.create(i,he,!1)),u.type=u.buffer.dtype;else{var c=p.getBuffer(i);if(c)u.state=y,u.buffer=c,u.type=c.dtype;else if(s.command("object"==typeof i&&i,"invalid data for attribute "+e),i.constant){var l=i.constant;u.state=x,"number"==typeof l?u.x=l:(s.command(m(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e),g.forEach(function(e,t){t<l.length&&(u[e]=l[t])}))}else{c=p.getBuffer(i.buffer),s.command(!!c,'missing buffer for attribute "'+e+'"');var d=0|i.offset;s.command(d>=0,'invalid offset for attribute "'+e+'"');var h=0|i.stride;s.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]');var v=0|i.size;s.command(!("size"in i)||v>0&&v<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4');var w=!!i.normalized,k=0;"type"in i&&(s.commandParameter(i.type,b,"invalid type for attribute "+e),k=b[i.type]);var _=0|i.divisor;"divisor"in i&&(s.command(0===_||Jt,'cannot specify divisor for attribute "'+e+'", instancing not supported'),s.command(_>=0,'invalid divisor for attribute "'+e+'"')),s.optional(function(){var t=s.guessCommand(),n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach(function(r){s.command(n.indexOf(r)>=0,'unknown parameter "'+r+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",t)})}),u.buffer=c,u.state=y,u.size=v,u.normalized=w,u.type=k||c.dtype,u.offset=d,u.stride=h,u.divisor=_}}a[e]=f(function(e,t){var n=e.attribCache;if(o in n)return n[o];var r={isStream:!1};return Object.keys(u).forEach(function(e){r[e]=u[e]}),u.buffer&&(r.buffer=e.link(u.buffer)),n[o]=r,r})}),Object.keys(i).forEach(function(e){function t(t,r){function i(e){r(c[e],"=",a,".",e,"|0;")}var a=t.invoke(r,n),o=t.shared,f=o.isBufferArgs,u=o.buffer;s.optional(function(){t.assert(r,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+f+"("+a+")||"+u+".getBuffer("+a+")||"+u+".getBuffer("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+o.isArrayLike+"("+a+"))))",'invalid dynamic attribute "'+e+'"')});var c={isStream:r.def(!1)},l=new $t;l.state=y,Object.keys(l).forEach(function(e){c[e]=r.def(""+l[e])});var d=c.buffer,p=c.type;return r("if(",f,"(",a,")){",c.isStream,"=true;",d,"=",u,".createStream(",he,",",a,");",p,"=",d,".dtype;","}else{",d,"=",u,".getBuffer(",a,");","if(",d,"){",p,"=",d,".dtype;","}else if(",a,".constant){",c.state,"=",x,";",g.map(function(e,t){return c[e]+"="+a+".length>="+t+"?"+a+"["+t+"]:0;"}).join(""),"}else{",d,"=",u,".getBuffer(",a,".buffer);",p,'="type" in ',a,"?",o.glTypes,"[",a,".type]:",d,".dtype;",c.normalized,"=!!",a,".normalized;"),i("size"),i("offset"),i("stride"),i("divisor"),r("}}"),c}var n=i[e];a[e]=u(n,t)}),a}function Ot(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach(function(e){var n=t[e];r[e]=f(function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)})}),Object.keys(n).forEach(function(e){var t=n[e];r[e]=u(t,function(e,n){return e.invoke(n,t)})}),r}function Ct(e,t,n,r){var i=jt(e);return i.uniforms=St(n),i.attributes=Dt(t),i.context=Ot(r),i}function Ft(e,t,n){var r=e.shared,i=r.context,a=e.scope();Object.keys(n).forEach(function(r){t.save(i,"."+r);var o=n[r];a(i,".",r,"=",o.append(e,t),";")}),t(a)}function Pt(e,t,n){var r,i=e.shared,a=i.gl,o=i.framebuffer;Zt&&(r=t.def(i.extensions,".webgl_draw_buffers"));var f,u=e.constants,s=u.drawBuffer,c=u.backBuffer;f=n?n.append(e,t):t.def(o,".next"),t("if(",o,".dirty||",f,"!==",o,".cur){","if(",f,"){",a,".bindFramebuffer(",ot,",",f,".framebuffer);"),Zt&&t(r,".drawBuffersWEBGL(",s,"[",f,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",ot,",null);"),Zt&&t(r,".drawBuffersWEBGL(",c,");"),t("}",o,".cur=",f,";",o,".dirty=false;","}")}function zt(e,t,n){var r=e.shared,i=r.gl,a=e.current,o=e.next,f=r.current,u=r.next,s=e.cond(f,".dirty");nn.forEach(function(t){var r=vt(t);if(!(r in n.state)){var c,d;if(r in o){c=o[r],d=a[r];var p=l(en[r].length,function(e){return s.def(c,"[",e,"]")});s(e.cond(p.map(function(e,t){return e+"!=="+d+"["+t+"]"}).join("||")).then(i,".",an[r],"(",p,");",p.map(function(e,t){return d+"["+t+"]="+e}).join(";"),";"))}else{c=s.def(u,".",r);var m=e.cond(c,"!==",f,".",r);s(m),r in rn?m(e.cond(c).then(i,".enable(",rn[r],");").else(i,".disable(",rn[r],");"),f,".",r,"=",c,";"):m(i,".",an[r],"(",c,");",f,".",r,"=",c,";")}}}),0===Object.keys(n.state).length&&s(f,".dirty=false;"),t(s)}function Lt(e,t,n,r){var a=e.shared,f=e.current,u=a.current,s=a.gl;i(Object.keys(n)).forEach(function(i){var a=n[i];if(!r||r(a)){var c=a.append(e,t);if(rn[i]){var l=rn[i];o(a)?c?t(s,".enable(",l,");"):t(s,".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(u,".",i,"=",c,";")}else if(m(c)){var d=f[i];t(s,".",an[i],"(",c,");",c.map(function(e,t){return d+"["+t+"]="+e}).join(";"),";")}else t(s,".",an[i],"(",c,");",u,".",i,"=",c,";")}})}function Bt(e,t){Jt&&!e.instancing&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function It(e,t,n){var r=e.stats,i=e.shared;if(gt){var a=i.timer;t(a,".beginQuery(",r,");")}}function Rt(e,t,n){var r=e.shared;if(gt){var i=r.timer;t(i,".endQuery();")}}function Mt(e,t,n,r,i){function a(e){switch(e){case Ce:case Le:case Me:return 2;case Fe:case Be:case He:return 3;case Pe:case Ie:case Ne:return 4;default:return 1}}function o(n,r,i){function a(){t("if(!",c,".pointer){",u,".enableVertexAttribArray(",s,");",c,".pointer=true;}");var n,a=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",c,".type!==",a,"||",c,".size!==",n,"||",m.map(function(e){return c+"."+e+"!=="+i[e]}).join("||"),"){",u,".bindBuffer(",he,",",d,".buffer);",u,".vertexAttribPointer(",[s,n,a,i.normalized,i.stride,i.offset],");",c,".type=",a,";",c,".size=",n,";",m.map(function(e){return c+"."+e+"="+i[e]+";"}).join(""),"}"),Jt){var o=i.divisor;t("if(",c,".divisor!==",o,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,o],");",c,".divisor=",o,";}")}}function o(){t("if(",c,".pointer){",u,".disableVertexAttribArray(",s,");",c,".pointer=false;","}if(",g.map(function(e,t){return c+"."+e+"!=="+p[t]}).join("||"),"){",u,".vertexAttrib4f(",s,",",p,");",g.map(function(e,t){return c+"."+e+"="+p[t]+";"}).join(""),"}")}var u=f.gl,s=t.def(n,".location"),c=t.def(f.attributes,"[",s,"]"),l=i.state,d=i.buffer,p=[i.x,i.y,i.z,i.w],m=["buffer","normalized","offset","stride"];l===y?a():l===x?o():(t("if(",l,"===",y,"){"),a(),t("}else{"),o(),t("}"))}var f=e.shared;r.forEach(function(r){var f,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;f=c.append(e,t)}else{if(!i(pt))return;var l=e.scopeAttrib(u);s.optional(function(){e.assert(t,l+".state","missing attribute "+u)}),f={},Object.keys(new $t).forEach(function(e){f[e]=t.def(l,".",e)})}o(e.link(r),a(r.info.type),f)})}function Ht(e,n,r,i,a){for(var f,u=e.shared,c=u.gl,d=0;d<i.length;++d){var p,h=i[d],b=h.name,g=h.info.type,v=r.uniforms[b],y=e.link(h),x=y+".location";if(v){if(!a(v))continue;if(o(v)){var w=v.value;if(g===qe||g===Ge){s.command("function"==typeof w&&("texture2d"===w._reglType&&g===qe||"textureCube"===w._reglType&&g===Ge),"invalid texture for uniform "+b);var k=e.link(w._texture);n(c,".uniform1i(",x,",",k+".bind());"),n.exit(k,".unbind();")}else if(g===We||g===Ue||g===Qe){s.optional(function(){s.command(m(w),"invalid matrix for uniform "+b),s.command(g===We&&4===w.length||g===Ue&&9===w.length||g===Qe&&16===w.length,"invalid length for matrix uniform "+b)});var _=e.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),A=2;g===Ue?A=3:g===Qe&&(A=4),n(c,".uniformMatrix",A,"fv(",x,",false,",_,");")}else{switch(g){case Oe:s.commandType(w,"number","uniform "+b),f="1f";break;case Ce:s.command(m(w)&&2===w.length,"uniform "+b),f="2f";break;case Fe:s.command(m(w)&&3===w.length,"uniform "+b),f="3f";break;case Pe:s.command(m(w)&&4===w.length,"uniform "+b),f="4f";break;case Re:s.commandType(w,"boolean","uniform "+b),f="1i";break;case ze:s.commandType(w,"number","uniform "+b),f="1i";break;case Me:s.command(m(w)&&2===w.length,"uniform "+b),f="2i";break;case Le:s.command(m(w)&&2===w.length,"uniform "+b),f="2i";break;case He:s.command(m(w)&&3===w.length,"uniform "+b),f="3i";break;case Be:s.command(m(w)&&3===w.length,"uniform "+b),f="3i";break;case Ne:s.command(m(w)&&4===w.length,"uniform "+b),f="4i";break;case Ie:s.command(m(w)&&4===w.length,"uniform "+b),f="4i"}n(c,".uniform",f,"(",x,",",m(w)?Array.prototype.slice.call(w):w,");")}continue}p=v.append(e,n)}else{if(!a(pt))continue;p=n.def(u.uniforms,"[",t.id(b),"]")}s.optional(function(){function t(t){e.assert(n,t,'invalid or missing uniform "'+b+'"')}function r(e){t("typeof "+p+'==="'+e+'"')}function i(e,n){t(u.isArrayLike+"("+p+")&&"+p+".length==="+e)}function a(e){t("typeof "+p+'==="function"&&'+p+'._reglType==="texture'+(e===ye?"2d":"Cube")+'"')}switch(g){case ze:r("number");break;case Le:i(2,"number");break;case Be:i(3,"number");break;case Ie:i(4,"number");break;case Oe:r("number");break;case Ce:i(2,"number");break;case Fe:i(3,"number");break;case Pe:i(4,"number");break;case Re:r("boolean");break;case Me:i(2,"boolean");
break;case He:i(3,"boolean");break;case Ne:i(4,"boolean");break;case We:i(4,"number");break;case Ue:i(9,"number");break;case Qe:i(16,"number");break;case qe:a(ye);break;case Ge:a(xe)}});var T=1;switch(g){case qe:case Ge:var E=n.def(p,"._texture");n(c,".uniform1i(",x,",",E,".bind());"),n.exit(E,".unbind();");continue;case ze:case Re:f="1i";break;case Le:case Me:f="2i",T=2;break;case Be:case He:f="3i",T=3;break;case Ie:case Ne:f="4i",T=4;break;case Oe:f="1f";break;case Ce:f="2f",T=2;break;case Fe:f="3f",T=3;break;case Pe:f="4f",T=4;break;case We:f="Matrix2fv";break;case Ue:f="Matrix3fv";break;case Qe:f="Matrix4fv"}if(n(c,".uniform",f,"(",x,","),"M"===f.charAt(0)){var j=Math.pow(g-We+2,2),S=e.global.def("new Float32Array(",j,")");n("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",l(j,function(e){return S+"["+e+"]="+p+"["+e+"]"}),",",S,")")}else n(T>1?l(T,function(e){return p+"["+e+"]"}):p);n(");")}}function Nt(e,t,n,r){function i(){var i,a=m.elements,o=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(o=n),i=a.append(e,o)):i=o.def(p,".",te),i&&o("if("+i+")"+d+".bindBuffer("+be+","+i+".buffer.buffer);"),i}function a(){var i,a=m.count,o=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(o=n),i=a.append(e,o),s.optional(function(){a.MISSING&&e.assert(t,"false","missing vertex count"),a.DYNAMIC&&e.assert(o,i+">=0","missing vertex count")})):i=o.def(p,".",re),i}function f(i){var a=m[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(e,n):a.append(e,t):t.def(p,".",i)}function u(){function e(){n(w,".drawElementsInstancedANGLE(",[b,y,k,g+"<<(("+k+"-"+v+")>>1)",x],");")}function t(){n(w,".drawArraysInstancedANGLE(",[b,g,y,x],");")}h?_?e():(n("if(",h,"){"),e(),n("}else{"),t(),n("}")):t()}function c(){function e(){n(d+".drawElements("+[b,y,k,g+"<<(("+k+"-"+v+")>>1)"]+");")}function t(){n(d+".drawArrays("+[b,g,y]+");")}h?_?e():(n("if(",h,"){"),e(),n("}else{"),t(),n("}")):t()}var l=e.shared,d=l.gl,p=l.draw,m=r.draw,h=i(),b=f(ne),g=f(ie),y=a();if("number"==typeof y){if(0===y)return}else n("if(",y,"){"),n.exit("}");var x,w;Jt&&(x=f(ae),w=e.instancing);var k=h+".type",_=m.elements&&o(m.elements);Jt&&("number"!=typeof x||x>=0)?"string"==typeof x?(n("if(",x,">0){"),u(),n("}else if(",x,"<0){"),c(),n("}")):u():c()}function Wt(e,t,n,r,i){var a=wt(),o=a.proc("body",i);return s.optional(function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)}),Jt&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,n,r),a.compile().body}function Ut(e,t,n,r){Bt(e,t),Mt(e,t,n,r.attributes,function(){return!0}),Ht(e,t,n,r.uniforms,function(){return!0}),Nt(e,t,t,n)}function Qt(e,t){var n=e.proc("draw",1);Bt(e,n),Ft(e,n,t.context),Pt(e,n,t.framebuffer),zt(e,n,t),Lt(e,n,t.state),It(e,n,t);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Ut(e,n,t,t.shader.program);else{var i=e.global.def("{}"),a=n.def(r,".id"),o=n.def(i,"[",a,"]");n(e.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",e.link(function(n){return Wt(Ut,e,t,n,1)}),"(",r,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),Rt(e,n,t)}function qt(e,t,n,r){function i(){return!0}e.batchId="a1",Bt(e,t),Mt(e,t,n,r.attributes,i),Ht(e,t,n,r.uniforms,i),Nt(e,t,t,n)}function Gt(e,t,n,r){function i(e){return e.contextDep&&o||e.propDep}function a(e){return!i(e)}Bt(e,t);var o=n.contextDep,f=t.def(),u="a0",s="a1",c=t.def();e.shared.props=c,e.batchId=f;var l=e.scope(),d=e.scope();if(t(l.entry,"for(",f,"=0;",f,"<",s,";++",f,"){",c,"=",u,"[",f,"];",d,"}",l.exit),n.needsContext&&Ft(e,d,n.context),n.needsFramebuffer&&Pt(e,d,n.framebuffer),Lt(e,d,n.state,i),r)Mt(e,l,n,r.attributes,a),Mt(e,d,n,r.attributes,i),Ht(e,l,n,r.uniforms,a),Ht(e,d,n,r.uniforms,i),Nt(e,l,d,n);else{var p=e.global.def("{}"),m=n.shader.progVar.append(e,d),h=d.def(m,".id"),b=d.def(p,"[",h,"]");d(e.shared.gl,".useProgram(",m,".program);","if(!",b,"){",b,"=",p,"[",h,"]=",e.link(function(t){return Wt(qt,e,n,t,2)}),"(",m,");}",b,".call(this,a0[",f,"],",f,");")}}function Vt(e,t){var n=e.proc("batch",2);e.batchId="0",Bt(e,n);var r=!1,i=!0;Object.keys(t.context).forEach(function(e){r=r||t.context[e].propDep}),r||(Ft(e,n,t.context),i=!1);var a=t.framebuffer,o=!1;a?(a.propDep?r=o=!0:a.contextDep&&r&&(o=!0),o||Pt(e,n,a)):Pt(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),zt(e,n,t),Lt(e,n,t.state,function(e){return!(e.contextDep&&r||e.propDep)}),It(e,n,t),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=o;var f=t.shader.progVar;if(f.contextDep&&r||f.propDep)Gt(e,n,t,null);else{var u=f.append(e,n);if(n(e.shared.gl,".useProgram(",u,".program);"),t.shader.program)Gt(e,n,t,t.shader.program);else{var s=e.global.def("{}"),c=n.def(u,".id"),l=n.def(s,"[",c,"]");n(e.cond(l).then(l,".call(this,a0,a1);").else(l,"=",s,"[",c,"]=",e.link(function(n){return Wt(Gt,e,t,n,2)}),"(",u,");",l,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),Rt(e,n,t)}function Yt(e,n){function r(t){var r=n.shader[t];r&&a.set(u.shader,"."+t,r.append(e,a))}var a=e.proc("scope",3);e.batchId="a2";var o,f,u=e.shared,s=u.current,c=u.timer;if(gt&&(o=a.def(c,".getNumPendingQueries()")),Ft(e,a,n.context),n.framebuffer&&n.framebuffer.append(e,a),i(Object.keys(n.state)).forEach(function(t){var r=n.state[t],i=r.append(e,a);m(i)?i.forEach(function(n,r){a.set(e.next[t],"["+r+"]",n)}):a.set(u.next,"."+t,i)}),[te,ie,re,ae,ne].forEach(function(t){var r=n.draw[t];r&&a.set(u.draw,"."+t,""+r.append(e,a))}),Object.keys(n.uniforms).forEach(function(r){a.set(u.uniforms,"["+t.id(r)+"]",n.uniforms[r].append(e,a))}),Object.keys(n.attributes).forEach(function(t){var r=n.attributes[t].append(e,a),i=e.scopeAttrib(t);Object.keys(new $t).forEach(function(e){a.set(i,"."+e,r[e])})}),r(Z),r(ee),Object.keys(n.state).length>0&&(a(s,".dirty=true;"),a.exit(s,".dirty=true;")),a("a1(",e.shared.context,",a0,0);"),gt){var l=e.stats;f=a.def(c,".getNumPendingQueries()-1"),a(c,".pushScopeStats(",o,",",f,",",l,");")}}function Xt(e,t,n,r,i){var a=wt();a.stats=a.link(i);var o=Ct(e,t,n,r);return Qt(a,o),Yt(a,o),Vt(a,o),a.compile()}var $t=ve.Record,Kt={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(Kt.min=Je,Kt.max=Ze);var Jt=n.angle_instanced_arrays,Zt=n.webgl_draw_buffers,en={dirty:!0},tn={},nn=[],rn={},an={};yt(T,_e),yt(E,ke),xt(j,"blendColor",[0,0,0,0]),xt(S,"blendEquationSeparate",[it,it]),xt(D,"blendFuncSeparate",[rt,nt,rt,nt]),yt(O,Te,!0),xt(C,"depthFunc",at),xt(F,"depthRange",[0,1]),xt(P,"depthMask",!0),xt(z,z,[!0,!0,!0,!0]),yt(L,we),xt(B,"cullFace",Xe),xt(I,I,Ke),xt(R,R,1),yt(M,je),xt(H,"polygonOffset",[0,0]),yt(N,Se),yt(W,De),xt(U,"sampleCoverage",[1,!1]),yt(Q,Ae),xt(q,"stencilMask",-1),xt(G,"stencilFunc",[et,0,-1]),xt(V,"stencilOpSeparate",[Ye,tt,tt,tt]),xt(Y,"stencilOpSeparate",[Xe,tt,tt,tt]),yt(X,Ee),xt($,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),xt(K,K,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var on={gl:e,context:bt,strings:t,next:tn,current:en,draw:ht,elements:oe,buffer:p,shader:mt,attributes:ve.state,uniforms:ge,framebuffer:de,extensions:n,timer:gt,isBufferArgs:r},fn={primTypes:h,compareFuncs:st,blendFuncs:ut,blendEquations:Kt,stencilOps:ct,glTypes:b,orientationType:dt};s.optional(function(){on.isArrayLike=m}),Zt&&(fn.backBuffer=[Xe],fn.drawBuffer=l(d.maxDrawbuffers,function(e){return 0===e?[0]:l(e,function(e){return ft+e})}));var un=0;return{next:tn,current:en,procs:function(){var e=wt(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var i=e.shared,a=i.gl,o=i.next,f=i.current;return r(f,".dirty=false;"),Pt(e,t),n(i.framebuffer,".dirty=true;"),Pt(e,n),Object.keys(rn).forEach(function(i){var u=rn[i],s=r.def(o,".",i),c=e.block();c("if(",s,"){",a,".enable(",u,")}else{",a,".disable(",u,")}",f,".",i,"=",s,";"),n(c),t("if(",s,"!==",f,".",i,"){",c,"}")}),Object.keys(an).forEach(function(i){var u,s,c=an[i],d=en[i],p=e.block();if(p(a,".",c,"("),m(d)){var h=d.length;u=e.global.def(o,".",i),s=e.global.def(f,".",i),p(l(h,function(e){return u+"["+e+"]"}),");",l(h,function(e){return s+"["+e+"]="+u+"["+e+"];"}).join("")),t("if(",l(h,function(e){return u+"["+e+"]!=="+s+"["+e+"]"}).join("||"),"){",p,"}")}else u=r.def(o,".",i),s=r.def(f,".",i),p(u,");",f,".",i,"=",u,";"),t("if(",u,"!==",s,"){",p,"}");n(p)}),e.compile()}(),compile:Xt}}},{"./constants/dtypes.json":4,"./constants/primitives.json":5,"./util/check":20,"./util/codegen":22,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/loop":27}],8:[function(e,t,n){function r(e,t){this.id=l++,this.type=e,this.data=t}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function a(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+i(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return a(e.substr(0,r.index)).concat(a(r[1])).concat(a(e.substr(r.index+r[0].length)));var o=e.split(".");if(1===o.length)return['"'+i(e)+'"'];for(var f=[],u=0;u<o.length;++u)f=f.concat(a(o[u]));return f}function o(e){return"["+a(e).join("][")+"]"}function f(e,t){switch(typeof t){case"boolean":case"number":case"string":return new r(e,o(t+""));case"undefined":return new r(e|p,null);default:c.raise("invalid property type")}}function u(e){return"function"==typeof e&&!e._reglType||e instanceof r}function s(e,t){if(e instanceof r){if(e.type&p)return new r(e.type&~p,o(t))}else if("function"==typeof e)return new r(d,e);return e}var c=e("./util/check"),l=0,d=0,p=128;t.exports={define:f,isDynamic:u,unbox:s,accessor:o}},{"./util/check":20}],9:[function(e,t,n){var r=e("./util/check"),i=e("./util/is-typed-array"),a=e("./util/is-ndarray"),o=e("./util/values"),f=e("./constants/primitives.json"),u=e("./constants/usage.json"),s=0,c=1,l=4,d=5120,p=5121,m=5122,h=5123,b=5124,g=5125,v=34963,y=35040,x=35044;t.exports=function(e,t,n,w){function k(e){this.id=D++,S[this.id]=this,this.buffer=e,this.primType=l,this.vertCount=0,this.type=0}function _(e){var t=C.pop();return t||(t=new k(n.create(null,v,!0)._buffer)),T(t,e,y,-1,-1,0,0),t}function A(e){C.push(e)}function T(e,o,f,u,v,y,x){var w=x;x||i(o)&&(!a(o)||i(o.data))||(w=t.oes_element_index_uint?g:h),e.buffer.bind(),n._initBuffer(e.buffer,o,f,w,3);var k=x;if(!x){switch(e.buffer.dtype){case p:case d:k=p;break;case h:case m:k=h;break;case g:case b:k=g;break;default:r.raise("unsupported type for element array")}e.buffer.dtype=k}e.type=k,r(k!==g||!!t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var _=v;_<0&&(_=e.buffer.byteLength,k===h?_>>=1:k===g&&(_>>=2)),e.vertCount=_;var A=u;if(u<0){A=l;var T=e.buffer.dimension;1===T&&(A=s),2===T&&(A=c),3===T&&(A=l)}e.primType=A}function E(e){w.elementsCount--,r(null!==e.buffer,"must not double destroy elements"),delete S[e.id],e.buffer.destroy(),e.buffer=null}function j(t){function o(t){if(t)if("number"==typeof t)s(t),c.primType=l,c.vertCount=0|t,c.type=p;else{var n=null,d=x,m=-1,h=-1,b=0,g=0;if(Array.isArray(t)||i(t)||a(t)?n=t:(r.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,r(Array.isArray(n)||i(n)||a(n),"invalid data for element buffer")),"usage"in t&&(r.parameter(t.usage,u,"invalid element buffer usage"),d=u[t.usage]),"primitive"in t&&(r.parameter(t.primitive,f,"invalid element buffer primitive"),m=f[t.primitive]),"count"in t&&(r("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),h=0|t.count),"length"in t&&(b=0|t.length),"type"in t&&(r.parameter(t.type,O,"invalid buffer type"),g=O[t.type])),n)T(c,n,d,m,h,b,g);else{var y=c.buffer;y.bind(),e.bufferData(v,b,d),y.dtype=g||p,y.usage=d,y.dimension=3,y.byteLength=b,c.primType=m<0?l:m,c.vertCount=h<0?0:h,c.type=y.dtype}}else s(),c.primType=l,c.vertCount=0,c.type=p;return o}var s=n.create(null,v,!0),c=new k(s._buffer);return w.elementsCount++,o(t),o._reglType="elements",o._elements=c,o.subdata=function(e,t){return s.subdata(e,t),o},o.destroy=function(){E(c)},o}var S={},D=0,O={uint8:p,uint16:h};t.oes_element_index_uint&&(O.uint32=g),k.prototype.bind=function(){this.buffer.bind()};var C=[];return{create:j,createStream:_,destroyStream:A,getElements:function(e){return"function"==typeof e&&e._elements instanceof k?e._elements:null},clear:function(){o(S).forEach(E)}}}},{"./constants/primitives.json":5,"./constants/usage.json":6,"./util/check":20,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/values":31}],10:[function(e,t,n){t.exports=function(e){function t(){["oes_texture_float","oes_texture_float_linear","oes_texture_half_float","oes_texture_half_float_linear","oes_standard_derivatives","oes_element_index_uint","oes_fbo_render_mipmap","webgl_depth_texture","webgl_draw_buffers","webgl_color_buffer_float","ext_texture_filter_anisotropic","ext_frag_depth","ext_blend_minmax","ext_shader_texture_lod","ext_color_buffer_half_float","ext_srgb","ext_disjoint_timer_query","angle_instanced_arrays","webgl_compressed_texture_s3tc","webgl_compressed_texture_atc","webgl_compressed_texture_pvrtc","webgl_compressed_texture_etc1"].forEach(function(t){try{n[t]=e.getExtension(t)}catch(e){}})}var n={};return t(),{extensions:n,refresh:t}}},{}],11:[function(e,t,n){var r=e("./util/check"),i=e("./util/values"),a=e("./util/extend"),o=36160,f=36161,u=3553,s=34069,c=36064,l=36096,d=36128,p=33306,m=36053,h=36054,b=36055,g=36057,v=36061,y=6408,x=6406,w=6407,k=6409,_=6410,A=6402,T=[x,k,_,w,y],E=32854,j=32855,S=36194,D=33189,O=36168,C=34041,F=35907,P=34836,z=34842,L=34843,B=[E,j,S,F,z,L,P],I={};I[m]="complete",I[h]="incomplete attachment",I[g]="incomplete dimensions",I[b]="incomplete, missing attachment",I[v]="unsupported",t.exports=function(e,t,n,h,b,g){function v(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function y(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function x(e,t,n){if(e)if(e.texture){var i=e.texture._texture,a=Math.max(1,i.width),o=Math.max(1,i.height);r(a===t&&o===n,"inconsistent width/height for supplied texture"),i.refCount+=1}else{var f=e.renderbuffer._renderbuffer;r(f.width===t&&f.height===n,"inconsistent width/height for renderbuffer"),f.refCount+=1}}function w(t,n){n?n.texture?e.framebufferTexture2D(o,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(o,t,f,n.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(o,t,u,null,0)}function k(e){var t=u,n=null,i=null,a=e;"object"==typeof e&&(a=e.data),r.type(a,"function","invalid attachment data");var o=a._reglType;return"texture2d"===o?(n=a,r(t===u)):"textureCube"===o?(n=a,r(t>=s&&t<s+6,"invalid cube map target")):"renderbuffer"===o?(i=a,t=f):r.raise("invalid regl object for attachment"),new v(t,n,i)}function _(e,t,n,r,i){if(n){var a=h.create2D({width:e,height:t,format:r,type:i});return a._texture.refCount=0,new v(u,a,null)}var o=b.create({width:e,height:t,format:r});return o._renderbuffer.refCount=0,new v(f,null,o)}function E(e){return e&&(e.texture||e.renderbuffer)}function j(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n))}function S(){this.id=W++,U[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function F(e){e.colorAttachments.forEach(y),y(e.depthAttachment),y(e.stencilAttachment),y(e.depthStencilAttachment)}function P(t){var n=t.framebuffer;r(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,g.framebufferCount--,delete U[t.id]}function z(t){var i;e.bindFramebuffer(o,t.framebuffer);var a=t.colorAttachments;for(i=0;i<a.length;++i)w(c+i,a[i]);for(i=a.length;i<n.maxColorAttachments;++i)w(c+i,null);w(l,t.depthAttachment),w(d,t.stencilAttachment),w(p,t.depthStencilAttachment);var f=e.checkFramebufferStatus(o);f!==m&&r.raise("framebuffer configuration not supported, status = "+I[f]),e.bindFramebuffer(o,R.next),R.current=R.next}function L(e,i){function a(e,i){var o;r(R.next!==f,"can not update framebuffer which is currently in use");var u=t.webgl_draw_buffers,s=0,c=0,l=!0,d=!0,p=null,m=!0,h="rgba",b="uint8",g=1,v=null,y=null,w=null,j=!1;if("number"==typeof e)s=0|e,c=0|i||s;else if(e){r.type(e,"object","invalid arguments for framebuffer");var S=e;if("shape"in S){var P=S.shape;r(Array.isArray(P)&&P.length>=2,"invalid shape for framebuffer"),s=P[0],c=P[1]}else"radius"in S&&(s=c=S.radius),"width"in S&&(s=S.width),"height"in S&&(c=S.height);("color"in S||"colors"in S)&&(p=S.color||S.colors,Array.isArray(p)&&r(1===p.length||u,"multiple render targets not supported")),p||("colorCount"in S&&(g=0|S.colorCount,r(g>0,"invalid color buffer count")),"colorTexture"in S&&(m=!!S.colorTexture,h="rgba4"),"colorType"in S&&(r.oneOf(S.colorType,N,"invalid color type"),b=S.colorType,m||("half float"===b?t.ext_color_buffer_half_float&&(h="rgba16f"):"float"===b&&t.webgl_color_buffer_float&&(h="rgba32f"))),"colorFormat"in S&&(h=S.colorFormat,M.indexOf(h)>=0?m=!0:H.indexOf(h)>=0?m=!1:m?r.oneOf(S.colorFormat,M,"invalid color format for texture"):r.oneOf(S.colorFormat,H,"invalid color format for renderbuffer"))),("depthTexture"in S||"depthStencilTexture"in S)&&(j=!(!S.depthTexture&&!S.depthStencilTexture),r(!j||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in S&&("boolean"==typeof S.depth?l=S.depth:(v=S.depth,d=!1)),"stencil"in S&&("boolean"==typeof S.stencil?d=S.stencil:(y=S.stencil,l=!1)),"depthStencil"in S&&("boolean"==typeof S.depthStencil?l=d=S.depthStencil:(w=S.depthStencil,l=!1,d=!1))}else s=c=1;var L=null,I=null,W=null,U=null;if(Array.isArray(p))L=p.map(k);else if(p)L=[k(p)];else for(L=new Array(g),o=0;o<g;++o)L[o]=_(s,c,m,h,b);for(r(L.length<=n.maxColorAttachments,"too many color attachments, not supported"),s=s||L[0].width,c=c||L[0].height,v?I=k(v):l&&!d&&(I=_(s,c,j,"depth","uint32")),y?W=k(y):d&&!l&&(W=_(s,c,!1,"stencil","uint8")),w?U=k(w):!v&&!y&&d&&l&&(U=_(s,c,j,"depth stencil","depth stencil")),r(!!v+!!y+!!w<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment"),o=0;o<L.length;++o)x(L[o],s,c),r(!L[o]||L[o].texture&&T.indexOf(L[o].texture._texture.format)>=0||L[o].renderbuffer&&B.indexOf(L[o].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+o+" is invalid");return x(I,s,c),r(!I||I.texture&&I.texture._texture.format===A||I.renderbuffer&&I.renderbuffer._renderbuffer.format===D,"invalid depth attachment for framebuffer object"),x(W,s,c),r(!W||W.renderbuffer&&W.renderbuffer._renderbuffer.format===O,"invalid stencil attachment for framebuffer object"),x(U,s,c),r(!U||U.texture&&U.texture._texture.format===C||U.renderbuffer&&U.renderbuffer._renderbuffer.format===C,"invalid depth-stencil attachment for framebuffer object"),F(f),f.width=s,f.height=c,f.colorAttachments=L,f.depthAttachment=I,f.stencilAttachment=W,f.depthStencilAttachment=U,a.color=L.map(E),a.depth=E(I),a.stencil=E(W),a.depthStencil=E(U),a.width=f.width,a.height=f.height,z(f),a}function o(e,t){r(R.next!==f,"can not resize a framebuffer which is currently in use");var n=0|e,i=0|t||n;if(n===f.width&&i===f.height)return a;for(var o=f.colorAttachments,u=0;u<o.length;++u)j(o[u],n,i);return j(f.depthAttachment,n,i),j(f.stencilAttachment,n,i),j(f.depthStencilAttachment,n,i),f.width=a.width=n,f.height=a.height=i,z(f),a}var f=new S;return g.framebufferCount++,a(e,i),a.resize=o,a._reglType="framebuffer",a._framebuffer=f,a.destroy=function(){P(f),F(f)},a}var R={current:null,next:null,dirty:!1},M=["rgba"],H=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&H.push("srgba"),t.ext_color_buffer_half_float&&H.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&H.push("rgba32f");var N=["uint8"];t.oes_texture_half_float&&N.push("half float"),t.oes_texture_float&&N.push("float");var W=0,U={};return a(R,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof S)return t}return null},create:L,clear:function(){i(U).forEach(P)}})}},{"./util/check":20,"./util/extend":23,"./util/values":31}],12:[function(e,t,n){var r=3408,i=3410,a=3411,o=3412,f=3413,u=3414,s=3415,c=33901,l=33902,d=3379,p=3386,m=34921,h=36347,b=36348,g=35661,v=35660,y=34930,x=36349,w=34076,k=34024,_=7936,A=7937,T=7938,E=35724,j=34047,S=36063,D=34852;t.exports=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(j));var O=1,C=1;return t.webgl_draw_buffers&&(O=e.getParameter(D),C=e.getParameter(S)),{colorBits:[e.getParameter(i),e.getParameter(a),e.getParameter(o),e.getParameter(f)],depthBits:e.getParameter(u),stencilBits:e.getParameter(s),subpixelBits:e.getParameter(r),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:n,maxDrawbuffers:O,maxColorAttachments:C,pointSizeDims:e.getParameter(c),lineWidthDims:e.getParameter(l),maxViewportDims:e.getParameter(p),maxCombinedTextureUnits:e.getParameter(g),maxCubeMapSize:e.getParameter(w),maxRenderbufferSize:e.getParameter(k),maxTextureUnits:e.getParameter(y),maxTextureSize:e.getParameter(d),maxAttributes:e.getParameter(m),maxVertexUniforms:e.getParameter(h),maxVertexTextureUnits:e.getParameter(v),maxVaryingVectors:e.getParameter(b),maxFragmentUniforms:e.getParameter(x),glsl:e.getParameter(E),renderer:e.getParameter(A),vendor:e.getParameter(_),version:e.getParameter(T)}}},{}],13:[function(e,t,n){var r=e("./util/check"),i=e("./util/is-typed-array"),a=6408,o=5121,f=3333;t.exports=function(e,t,n){function u(u){var s=0,c=0,l=n.framebufferWidth,d=n.framebufferHeight,p=null;i(u)?p=u:2===arguments.length?(l=0|arguments[0],d=0|arguments[1]):u&&(r.type(u,"object","invalid arguments to regl.read()"),s=0|u.x,c=0|u.y,l=u.width||n.framebufferWidth,d=u.height||n.framebufferHeight,p=u.data||null),t();var m=l*d*4;return p=p||new Uint8Array(m),r.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),r(p.byteLength>=m,"data buffer for regl.read() too small"),e.pixelStorei(f,4),e.readPixels(s,c,l,d,a,o,p),p}return u}},{"./util/check":20,"./util/is-typed-array":26}],14:[function(e,t,n){var r=e("./util/check"),i=e("./util/values"),a=36161,o=32854,f=32855,u=36194,s=33189,c=36168,l=34041,d=35907,p=34836,m=34842,h=34843;t.exports=function(e,t,n,b){function g(e){this.id=w++,this.refCount=1,this.renderbuffer=e,this.format=o,this.width=0,this.height=0}function v(t){var n=t.renderbuffer;r(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(a,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete k[t.id],b.renderbufferCount--}function y(t,i){function f(t,i){var u=0,c=0,l=o;if("object"==typeof t&&t){var d=t;if("shape"in d){var p=d.shape;r(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),u=0|p[0],c=0|p[1]}else"radius"in d&&(u=c=0|d.radius),"width"in d&&(u=0|d.width),"height"in d&&(c=0|d.height);"format"in d&&(r.parameter(d.format,x,"invalid renderbuffer format"),l=x[d.format])}else"number"==typeof t?(u=0|t,c="number"==typeof i?0|i:u):t?r.raise("invalid arguments to renderbuffer constructor"):u=c=1;if(r(u>0&&c>0&&u<=n.maxRenderbufferSize&&c<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==s.width||c!==s.height||l!==s.format)return f.width=s.width=u,f.height=s.height=c,s.format=l,e.bindRenderbuffer(a,s.renderbuffer),e.renderbufferStorage(a,l,u,c),f}function u(t,i){var o=0|t,u=0|i||o;return o===s.width&&u===s.height?f:(r(o>0&&u>0&&o<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=s.width=o,f.height=s.height=u,e.bindRenderbuffer(a,s.renderbuffer),e.renderbufferStorage(a,s.format,o,u),f)}var s=new g(e.createRenderbuffer());return k[s.id]=s,b.renderbufferCount++,f(t,i),f.resize=u,f._reglType="renderbuffer",f._renderbuffer=s,f.destroy=function(){s.decRef()},f}var x={rgba4:o,rgb565:u,"rgb5 a1":f,depth:s,stencil:c,"depth stencil":l};t.ext_srgb&&(x.srgba=d),t.ext_color_buffer_half_float&&(x.rgba16f=m,x.rgb16f=h),t.webgl_color_buffer_float&&(x.rgba32f=p);var w=0,k={};return g.prototype.decRef=function(){--this.refCount<=0&&v(this)},{create:y,clear:function(){i(k).forEach(v)}}}},{"./util/check":20,"./util/values":31}],15:[function(e,t,n){var r=e("./util/check"),i=e("./util/values"),a=35632,o=35633,f=35718,u=35721;t.exports=function(e,t,n){function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function c(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function l(n,i,o){var f=n===a?m:h,u=f[i];if(!u){var s=t.str(i);u=e.createShader(n),e.shaderSource(u,s),e.compileShader(u),r.shaderError(e,u,s,n,o),f[i]=u}return u}function d(e,t){this.id=v++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[]}function p(n,i){var d,p,m=l(a,n.fragId),h=l(o,n.vertId),b=n.program=e.createProgram();e.attachShader(b,m),e.attachShader(b,h),e.linkProgram(b),r.linkError(e,b,t.str(n.fragId),t.str(n.vertId),i);var g=e.getProgramParameter(b,f),v=n.uniforms;for(d=0;d<g;++d)if(p=e.getActiveUniform(b,d))if(p.size>1)for(var y=0;y<p.size;++y){var x=p.name.replace("[0]","["+y+"]");c(v,new s(x,t.id(x),e.getUniformLocation(b,x),p))}else c(v,new s(p.name,t.id(p.name),e.getUniformLocation(b,p.name),p));var w=e.getProgramParameter(b,u),k=n.attributes;for(d=0;d<w;++d)p=e.getActiveAttrib(b,d),p&&c(k,new s(p.name,t.id(p.name),e.getAttribLocation(b,p.name),p))}var m={},h={},b={},g=[],v=0;return{clear:function(){var t=e.deleteShader.bind(e);i(m).forEach(t),m={},i(h).forEach(t),h={},g.forEach(function(t){e.deleteProgram(t.program)}),g.length=0,b={},n.shaderCount=0},program:function(e,t,i){r(e>=0,"missing vertex shader"),r(t>=0,"missing fragment shader"),n.shaderCount++;var a=b[t];a||(a=b[t]={});var o=a[e];return o||(o=new d(t,e),p(o,i),a[e]=o,g.push(o)),o},shader:l,frag:null,vert:null}}},{"./util/check":20,"./util/values":31}],16:[function(e,t,n){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0}}},{}],17:[function(e,t,n){t.exports=function(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r?r:(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}},{}],18:[function(e,t,n){function r(e){return"[object "+e+"]"}function i(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function a(e){if(!Array.isArray(e))return!1;var t=e.length;return!(0===t||!E(e[0]))}function o(e){return Object.prototype.toString.call(e)}function f(e){return o(e)===He}function u(e){return o(e)===Ne}function s(e){return o(e)===We}function c(e){return o(e)===Ue}function l(e){if(!e)return!1;var t=o(e);return Qe.indexOf(t)>=0||(i(e)||a(e)||_(e))}function d(e){return 0|S[Object.prototype.toString.call(e)]}function p(e,t){var n=e.width*e.height*e.channels;switch(y(t.length===n,"inconsistent array length for texture"),e.type){case ue:case se:case ce:case le:var r=A.allocType(e.type,n);r.set(t),e.data=r;break;case X:e.data=T(t);break;default:y.raise("unsupported texture type, must specify a typed array")}}function m(e,t){return A.allocType(e.type===X?le:e.type,t)}function h(e,t){e.type===X?(e.data=T(t),A.freeType(t)):e.data=t}function b(e,t,n,r,i,a){for(var o=e.width,f=e.height,u=e.channels,s=o*f*u,c=m(e,s),l=0,d=0;d<f;++d)for(var p=0;p<o;++p)for(var b=0;b<u;++b)c[l++]=t[n*p+r*d+i*b+a];h(e,c)}function g(e,t,n,r){for(var i=n*r,a=m(e,i),o=0,f=0;f<r;++f)for(var u=t[f],s=0;s<n;++s)a[o++]=u[s];h(e,a)}function v(e,t,n,r,i){for(var a=n*r*i,o=m(e,a),f=0,u=0;u<r;++u)for(var s=t[u],c=0;c<n;++c)for(var l=s[c],d=0;d<i;++d)o[f++]=l[d];h(e,o)}var y=e("./util/check"),x=e("./util/extend"),w=e("./util/values"),k=e("./util/is-typed-array"),_=e("./util/is-ndarray"),A=e("./util/pool"),T=e("./util/to-half-float"),E=e("./util/is-array-like"),j=e("./constants/arraytypes.json"),S=e("./constants/arraytypes.json"),D=34467,O=3553,C=34067,F=34069,P=6408,z=6406,L=6407,B=6409,I=6410,R=32854,M=32855,H=36194,N=32819,W=32820,U=33635,Q=34042,q=6402,G=34041,V=35904,Y=35906,X=36193,$=33776,K=33777,J=33778,Z=33779,ee=35986,te=35987,ne=34798,re=35840,ie=35841,ae=35842,oe=35843,fe=36196,ue=5121,se=5123,ce=5125,le=5126,de=10242,pe=10243,me=10497,he=33071,be=33648,ge=10240,ve=10241,ye=9728,xe=9729,we=9984,ke=9985,_e=9986,Ae=9987,Te=33170,Ee=4352,je=4353,Se=4354,De=34046,Oe=3317,Ce=37440,Fe=37441,Pe=37443,ze=37444,Le=33984,Be=[we,_e,ke,Ae],Ie=[0,B,I,L,P],Re={};Re[B]=Re[z]=Re[q]=1,Re[G]=Re[I]=2,Re[L]=3,Re[P]=4;var Me={};Me[R]=N,Me[H]=U,Me[M]=W,Me[q]=ce,Me[G]=Q;var He=r("HTMLCanvasElement"),Ne=r("CanvasRenderingContext2D"),We=r("HTMLImageElement"),Ue=r("HTMLVideoElement"),Qe=Object.keys(j).concat([He,Ne,We,Ue]);t.exports=function(e,t,n,r,o,m){function h(){this.internalformat=P,this.format=P,this.type=ue,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=0,this.width=0,this.height=0,this.channels=4}function T(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function j(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(y.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(y.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(y.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(y.parameter(t.colorSpace,pt,"invalid colorSpace"),e.colorSpace=pt[t.colorSpace]),"type"in t){var r=t.type;y.parameter(r,mt,"invalid texture type"),e.type=mt[r]}var i=e.width,a=e.height,o=e.channels,f=!1;"shape"in t?(y(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],a=t.shape[1],3===t.shape.length&&(o=t.shape[2],y(o>0&&o<=4,"invalid number of channels"),f=!0),y(i>0&&i<=n.maxTextureSize,"invalid width"),y(a>0&&a<=n.maxTextureSize,"invalid height")):("radius"in t&&(i=a=t.radius,y(i>0&&i<=n.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,y(i>0&&i<=n.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,y(a>0&&a<=n.maxTextureSize,"invalid height")),"channels"in t&&(o=t.channels,y(o>0&&o<=4,"invalid number of channels"),f=!0)),e.width=0|i,e.height=0|a,e.channels=0|o;var u=!1;if("format"in t){var s=t.format;y.parameter(s,ht,"invalid texture format");var c=e.internalformat=ht[s];e.format=yt[c],s in mt&&("type"in t||(e.type=mt[s])),s in bt&&(e.compressed=!0),u=!0}!f&&u?e.channels=Re[e.format]:f&&!u?e.channels!==Ie[e.format]&&(e.format=e.internalformat=Ie[e.channels]):u&&f&&y(e.channels===Re[e.format],"number of channels inconsistent with specified format")}}function S(t){e.pixelStorei(Ce,t.flipY),e.pixelStorei(Fe,t.premultiplyAlpha),e.pixelStorei(Pe,t.colorSpace),e.pixelStorei(Oe,t.unpackAlignment)}function Me(){h.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function He(e,t){var r=null;if(l(t)?r=t:t&&(y.type(t,"object","invalid pixel data type"),j(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),l(t.data)&&(r=t.data)),y(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),t.copy){y(!r,"can not specify copy and data field for the same texture");var m=o.viewportWidth,h=o.viewportHeight;e.width=e.width||m-e.xOffset,e.height=e.height||h-e.yOffset,e.needsCopy=!0,y(e.xOffset>=0&&e.xOffset<m&&e.yOffset>=0&&e.yOffset<h&&e.width>0&&e.width<=m&&e.height>0&&e.height<=h,"copy texture read out of bounds")}else if(r){if(k(r))e.data=r,"type"in t||e.type!==ue||(e.type=d(r));else if(i(r))p(e,r),e.alignment=1,e.needsFree=!0;else if(_(r)){var x=r.data;Array.isArray(x)||e.type!==ue||(e.type=d(x));var w,A,T,S,D,O,C=r.shape,F=r.stride;3===C.length?(T=C[2],O=F[2]):(y(2===C.length,"invalid ndarray pixel data, must be 2 or 3D"),T=1,O=1),w=C[0],A=C[1],S=F[0],
D=F[1],e.alignment=1,e.width=w,e.height=A,e.channels=T,e.format=e.internalformat=Ie[T],e.needsFree=!0,b(e,x,S,D,O,r.offset)}else if(f(r)||u(r))f(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height;else if(s(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight;else if(c(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.needsPoll=!0;else if(a(r)){var P=r[0].length,z=r.length,L=1;E(r[0][0])?(L=r[0][0].length,v(e,r,P,z,L)):g(e,r,P,z),e.alignment=1,e.width=P,e.height=z,e.channels=L,e.format=e.internalformat=Ie[L],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1;e.type===le?y(n.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===X&&y(n.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ne(t,n,i){var a=t.element,o=t.data,f=t.internalformat,u=t.format,s=t.type,c=t.width,l=t.height;S(t),a?e.texImage2D(n,i,u,u,s,a):t.compressed?e.compressedTexImage2D(n,i,f,c,l,0,o):t.needsCopy?(r(),e.copyTexImage2D(n,i,u,t.xOffset,t.yOffset,c,l,0)):e.texImage2D(n,i,u,c,l,0,u,s,o)}function We(t,n,i,a,o){var f=t.element,u=t.data,s=t.internalformat,c=t.format,l=t.type,d=t.width,p=t.height;S(t),f?e.texSubImage2D(n,o,i,a,c,l,f):t.compressed?e.compressedTexSubImage2D(n,o,i,a,s,d,p,u):t.needsCopy?(r(),e.copyTexSubImage2D(n,o,i,a,t.xOffset,t.yOffset,d,p)):e.texSubImage2D(n,o,i,a,d,p,c,l,u)}function Ue(){return xt.pop()||new Me}function Qe(e){e.needsFree&&A.freeType(e.data),Me.call(e),xt.push(e)}function qe(){h.call(this),this.genMipmaps=!1,this.mipmapHint=Ee,this.mipmask=0,this.images=Array(16)}function Ge(e,t,n){var r=e.images[0]=Ue();e.mipmask=1,r.width=e.width=t,r.height=e.height=n}function Ve(e,t){var n=null;if(l(t))n=e.images[0]=Ue(),T(n,e),He(n,t),e.mipmask=1;else if(j(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)n=e.images[i]=Ue(),T(n,e),n.width>>=i,n.height>>=i,He(n,r[i]),e.mipmask|=1<<i;else n=e.images[0]=Ue(),T(n,e),He(n,t),e.mipmask=1;T(e,e.images[0])}function Ye(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;Ne(n[r],t,r)}}function Xe(){var e=wt.pop()||new qe;h.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function $e(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&Qe(t[n]),t[n]=null;wt.push(e)}function Ke(){this.minFilter=ye,this.magFilter=ye,this.wrapS=he,this.wrapT=he,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ee}function Je(e,t){if("min"in t){var r=t.min;y.parameter(r,dt),e.minFilter=dt[r],Be.indexOf(e.minFilter)>=0&&(e.genMipmaps=!0)}if("mag"in t){var i=t.mag;y.parameter(i,lt),e.magFilter=lt[i]}var a=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(y.parameter(f,ct),a=o=ct[f]):Array.isArray(f)&&(y.parameter(f[0],ct),y.parameter(f[1],ct),a=ct[f[0]],o=ct[f[1]])}else{if("wrapS"in t){var u=t.wrapS;y.parameter(u,ct),a=ct[u]}if("wrapT"in t){var s=t.wrapT;y.parameter(s,ct),o=ct[s]}}if(e.wrapS=a,e.wrapT=o,"anisotropic"in t){var c=t.anisotropic;y("number"==typeof c&&c>=1&&c<=n.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var l=!1;switch(typeof t.mipmap){case"string":y.parameter(t.mipmap,st,"invalid mipmap hint"),e.mipmapHint=st[t.mipmap],e.genMipmaps=!0,l=!0;break;case"boolean":l=e.genMipmaps=t.mipmap;break;case"object":y(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,l=!0;break;default:y.raise("invalid mipmap type")}!l||"min"in t||(e.minFilter=we)}}function Ze(n,r){e.texParameteri(r,ve,n.minFilter),e.texParameteri(r,ge,n.magFilter),e.texParameteri(r,de,n.wrapS),e.texParameteri(r,pe,n.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,De,n.anisotropic),n.genMipmaps&&(e.hint(Te,n.mipmapHint),e.generateMipmap(r))}function et(){var e=kt.pop()||new Ke;return Ke.call(e),e}function tt(e){kt.push(e)}function nt(t){h.call(this),this.mipmask=0,this.internalformat=P,this.id=_t++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0}function rt(t){e.activeTexture(Le),e.bindTexture(t.target,t.texture)}function it(){var t=Et[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(O,null)}function at(t){var n=t.texture;y(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(Le+r),e.bindTexture(i,null),Et[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete At[t.id],m.textureCount--}function ot(t,r){function i(e,t){var r=et(),a=Xe();return"number"==typeof e?"number"==typeof t?Ge(a,0|e,0|t):Ge(a,0|e,0|e):e?(y.type(e,"object","invalid arguments to regl.texture"),Je(r,e),Ve(a,e)):Ge(a,1,1),r.genMipmaps&&(a.mipmask=(a.width<<1)-1),f.mipmask=a.mipmask,T(f,a),y.texture2D(r,a,n),f.internalformat=a.internalformat,i.width=a.width,i.height=a.height,rt(f),Ye(a,O),Ze(r,O),it(),tt(r),$e(a),i}function a(e,t,n,r){y(!!e,"must specify image data");var a=0|t,o=0|n,u=0|r,s=Ue();return T(s,f),s.width>>=u,s.height>>=u,s.width-=a,s.height-=o,He(s,e),y(f.type===s.type&&f.format===s.format&&f.internalformat===s.internalformat,"incompatible format for texture.subimage"),y(a>=0&&o>=0&&a+s.width<=f.width&&o+s.height<=f.height,"texture.subimage write out of bounds"),y(f.mipmask&1<<u,"missing mipmap data"),y(s.data||s.element||s.needsCopy,"missing image data"),rt(f),We(s,O,a,o,u),it(),Qe(s),i}function o(t,n){var r=0|t,a=0|n||r;return r===f.width&&a===f.height?i:(i.width=f.width=r,i.height=f.height=a,rt(f),e.texImage2D(O,0,f.format,r,a,0,f.format,f.type,null),it(),i)}var f=new nt(O);return At[f.id]=f,m.textureCount++,i(t,r),i.subimage=a,i.resize=o,i._reglType="texture2d",i._texture=f,i.destroy=function(){f.decRef()},i}function ft(t,r,i,a,o,f){function u(e,t,r,i,a,o){var f,s=et();for(f=0;f<6;++f)d[f]=Xe();if("number"!=typeof e&&e)if("object"==typeof e)if(t)Ve(d[0],e),Ve(d[1],t),Ve(d[2],r),Ve(d[3],i),Ve(d[4],a),Ve(d[5],o);else if(Je(s,e),j(l,e),"faces"in e){var c=e.faces;for(y(Array.isArray(c)&&6===c.length,"cube faces must be a length 6 array"),f=0;f<6;++f)y("object"==typeof c[f]&&!!c[f],"invalid input for cube map face"),T(d[f],l),Ve(d[f],c[f])}else for(f=0;f<6;++f)Ve(d[f],e);else y.raise("invalid arguments to cube map");else{var p=0|e||1;for(f=0;f<6;++f)Ge(d[f],p,p)}for(T(l,d[0]),s.genMipmaps?l.mipmask=(d[0].width<<1)-1:l.mipmask=d[0].mipmask,y.textureCube(l,s,d,n),l.internalformat=d[0].internalformat,u.width=d[0].width,u.height=d[0].height,rt(l),f=0;f<6;++f)Ye(d[f],F+f);for(Ze(s,C),it(),tt(s),f=0;f<6;++f)$e(d[f]);return u}function s(e,t,n,r,i){y(!!t,"must specify image data"),y("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var a=0|n,o=0|r,f=0|i,s=Ue();return T(s,l),s.width>>=f,s.height>>=f,s.width-=a,s.height-=o,He(s,t),y(l.type===s.type&&l.format===s.format&&l.internalformat===s.internalformat,"incompatible format for texture.subimage"),y(a>=0&&o>=0&&a+s.width<=l.width&&o+s.height<=l.height,"texture.subimage write out of bounds"),y(l.mipmask&1<<f,"missing mipmap data"),y(s.data||s.element||s.needsCopy,"missing image data"),rt(l),We(s,F+e,a,o,f),it(),Qe(s),u}function c(t,n){var r=0|t,i=0|n||r;if(r===l.width&&i===l.height)return u;u.width=l.width=r,u.height=l.height=i,rt(l);for(var a=0;a<6;++a)e.texImage2D(F+a,0,l.format,r,i,0,l.format,l.type,null);return it(),u}var l=new nt(C);At[l.id]=l,m.cubeCount++;var d=new Array(6);return u(t,r,i,a,o,f),u.subimage=s,u.resize=c,u._reglType="textureCube",u._texture=l,u.destroy=function(){l.decRef()},u}function ut(){for(var t=0;t<Tt;++t)e.activeTexture(Le+t),e.bindTexture(O,null),Et[t]=null;w(At).forEach(at),m.cubeCount=0,m.textureCount=0}var st={"don't care":Ee,"dont care":Ee,nice:Se,fast:je},ct={repeat:me,clamp:he,mirror:be},lt={nearest:ye,linear:xe},dt=x({"nearest mipmap nearest":we,"linear mipmap nearest":ke,"nearest mipmap linear":_e,"linear mipmap linear":Ae,mipmap:Ae},lt),pt={none:0,browser:ze},mt={uint8:ue,rgba4:N,rgb565:U,"rgb5 a1":W},ht={alpha:z,luminance:B,"luminance alpha":I,rgb:L,rgba:P,rgba4:R,"rgb5 a1":M,rgb565:H},bt={};t.ext_srgb&&(ht.srgb=V,ht.srgba=Y),t.oes_texture_float&&(mt.float=le),t.oes_texture_half_float&&(mt.float16=mt["half float"]=X),t.webgl_depth_texture&&(x(ht,{depth:q,"depth stencil":G}),x(mt,{uint16:se,uint32:ce,"depth stencil":Q})),t.webgl_compressed_texture_s3tc&&x(bt,{"rgb s3tc dxt1":$,"rgba s3tc dxt1":K,"rgba s3tc dxt3":J,"rgba s3tc dxt5":Z}),t.webgl_compressed_texture_atc&&x(bt,{"rgb arc":ee,"rgba atc explicit alpha":te,"rgba atc interpolated alpha":ne}),t.webgl_compressed_texture_pvrtc&&x(bt,{"rgb pvrtc 4bppv1":re,"rgb pvrtc 2bppv1":ie,"rgba pvrtc 4bppv1":ae,"rgba pvrtc 2bppv1":oe}),t.webgl_compressed_texture_etc1&&(bt["rgb etc1"]=fe);var gt=Array.prototype.slice.call(e.getParameter(D));Object.keys(bt).forEach(function(e){var t=bt[e];gt.indexOf(t)>=0&&(ht[e]=t)});var vt=Object.keys(ht);n.textureFormats=vt;var yt=vt.reduce(function(e,t){var n=ht[t];return n===B||n===z||n===B||n===I||n===q||n===G?e[n]=n:n===M||t.indexOf("rgba")>=0?e[n]=P:e[n]=L,e},{}),xt=[],wt=[],kt=[],_t=0,At={},Tt=n.maxTextureUnits,Et=Array(Tt).map(function(){return null});return x(nt.prototype,{bind:function(){var t=this;t.bindCount+=1;var n=t.unit;if(n<0){for(var r=0;r<Tt;++r){var i=Et[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Et[r]=t,n=r;break}n>=Tt&&y.raise("insufficient number of texture units"),t.unit=n,e.activeTexture(Le+n),e.bindTexture(t.target,t.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&at(this)}}),{create2D:ot,createCube:ft,clear:ut,getTexture:function(e){return null}}}},{"./constants/arraytypes.json":3,"./util/check":20,"./util/extend":23,"./util/is-array-like":24,"./util/is-ndarray":25,"./util/is-typed-array":26,"./util/pool":28,"./util/to-half-float":30,"./util/values":31}],19:[function(e,t,n){t.exports=function(e,t){function n(){return b.pop()||l.createQueryEXT()}function r(e){b.push(e)}function i(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.stats=null}function a(){return g.pop()||new i}function o(e){g.push(e)}function f(e){d=e,p=n(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,p)}function u(){l.endQueryEXT(l.TIME_ELAPSED_EXT);var e=a();e.startQueryIndex=m.length,e.endQueryIndex=e.startQueryIndex,e.stats=d,h.push(e),m.push(p)}function s(e,t,n){var r=a();r.startQueryIndex=e,r.endQueryIndex=t,r.stats=n,h.push(r)}function c(){if(0!==m.length){var e,t,n=[];for(e=0;e<m.length;e++)n[e]=1e-6*l.getQueryObjectEXT(m[e],l.QUERY_RESULT_EXT),r(m[e]);for(m=[],e=0;e<h.length;e++){var i=h[e];for(t=i.startQueryIndex;t<=i.endQueryIndex;t++)i.stats.gpuTime+=n[t];o(i)}h=[]}}var l=t.ext_disjoint_timer_query;if(!l)return null;var d,p,m=[],h=[],b=[],g=[];return{beginQuery:f,endQuery:u,update:c,getNumPendingQueries:function(){return m.length},pushScopeStats:s,clear:function(){for(var e=0;e<b.length;e++)l.deleteQueryEXT(b[e])}}}},{}],20:[function(e,t,n){function r(e){return"undefined"!=typeof btoa?btoa(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function a(e,t){e||i(t)}function o(e){return e?": "+e:""}function f(e,t,n){e in t||i("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())}function u(e,t){L(e)||i("invalid parameter type"+o(t)+". must be a typed array")}function s(e,t,n){typeof e!==t&&i("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)}function c(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")}function l(e,t,n){t.indexOf(e)<0&&i("invalid value"+o(n)+". must be one of: "+t)}function d(e,t){for(e+="";e.length<t;)e=" "+e;return e}function p(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function m(e,t){this.number=e,this.line=t,this.errors=[]}function h(e,t,n){this.file=e,this.line=t,this.message=n}function b(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function g(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function v(e,t){var n=e.split("\n"),i=1,a=0,o={unknown:new p,0:new p};o.unknown.name=o[0].name=t||b(),o.unknown.lines.push(new m(0,""));for(var f=0;f<n.length;++f){var u=n[f],s=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(u);if(s)switch(s[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(s[2]);c&&(i=0|c[1],c[2]&&(a=0|c[2],a in o||(o[a]=new p)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(s[2]);l&&(o[a].name=l[1]?r(l[2]):l[2])}o[a].lines.push(new m(i++,u))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function y(e){var t=[];return e.split("\n").forEach(function(e){var n=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);n?t.push(new h(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new h("unknown",0,e))}),t}function x(e,t){t.forEach(function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}function w(e,t,n,r,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),f=r===e.FRAGMENT_SHADER?"fragment":"vertex",u=v(n,i),s=y(o);x(u,s),Object.keys(u).forEach(function(e){function t(e,t){r.push(e),i.push(t||"")}var n=u[e];if(n.hasErrors){var r=[""],i=[""];t("file number "+e+": "+n.name+"\n","color:red;text-decoration:underline;font-weight:bold"),n.lines.forEach(function(e){if(e.errors.length>0){t(d(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),t(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var n=0;e.errors.forEach(function(r){var i=r.message,a=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(i);if(a){var o=a[1];switch(i=a[2],o){case"assign":o="="}n=Math.max(e.line.indexOf(o,n),0)}else n=0;t(d("| ",6)),t(d("^^^",n+3)+"\n","font-weight:bold"),t(d("| ",6)),t(i+"\n","font-weight:bold")}),t(d("| ",6)+"\n")}else t(d(e.number,4)+"|  "),t(e.line+"\n","color:red")}),"undefined"!=typeof document?(i[0]=r.join("%c"),console.log.apply(console,i)):console.log(r.join(""))}}),a.raise("Error compiling "+f+" shader, "+u[0].name)}}function k(e,t,n,r,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),f=v(n,i),u=v(r,i),s='Error linking program with vertex shader, "'+u[0].name+'", and fragment shader "'+f[0].name+'"';"undefined"!=typeof document?console.log("%c"+s+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(s+"\n"+o),a.raise(s)}}function _(e){e._commandRef=b()}function A(e,t,n,r){function i(e){return e?r.id(e):0}function a(e,t){Object.keys(t).forEach(function(t){e[r.id(t)]=!0})}_(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var f=e._attributeSet={};a(f,n.static),a(f,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function T(e,t){var n=g();i(e+" in command "+(t||b())+("unknown"===n?"":" called from "+n))}function E(e,t,n){e||T(t,n||b())}function j(e,t,n,r){e in t||T("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||b())}function S(e,t,n,r){typeof e!==t&&T("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||b())}function D(e){e()}function O(e,t,n){e.texture?l(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):l(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}function C(e,t){return e===K||e===$||e===J?2:e===Z?4:te[e]*t}function F(e){return!(e&e-1||!e)}function P(e,t,n){var r,i=t.width,o=t.height,f=t.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),e.wrapS===I&&e.wrapT===I||a(F(i)&&F(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&a(e.minFilter!==M&&e.minFilter!==N&&e.minFilter!==H&&e.minFilter!==W,"min filter requires mipmap"):(a(F(i)&&F(o),"texture must be a square power of 2 to support mipmapping"),a(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===X&&(n.extensions.indexOf("oes_texture_float_linear")<0&&a(e.minFilter===R&&e.magFilter===R,"filter not supported, must enable oes_texture_float_linear"),a(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var s=i>>r,c=o>>r;a(t.mipmask&1<<r,"missing mipmap data");var l=u[r];a(l.width===s&&l.height===c,"invalid shape for mip images"),a(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed||(l.data?a(l.data.byteLength===s*c*Math.max(C(l.type,f),l.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):l.element||l.copy)}else e.genMipmaps||a(0===(t.mipmask&1<<r),"extra mipmap data");t.compressed&&a(!e.genMipmaps,"mipmap generation for compressed images not supported")}function z(e,t,n,r){var i=e.width,o=e.height,f=e.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(t.wrapS===I&&t.wrapT===I,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var s=n[u];a(s.width===i&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(a(!s.compressed,"can not generate mipmap for compressed textures"),a(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var d=c[l];if(d){var p=i>>l,m=o>>l;a(s.mipmask&1<<l,"missing mipmap data"),a(d.width===p&&d.height===m,"invalid shape for mip images"),a(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?a(d.data.byteLength===p*m*Math.max(C(d.type,f),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}var L=e("./is-typed-array"),B=e("./extend"),I=33071,R=9728,M=9984,H=9985,N=9986,W=9987,U=5120,Q=5121,q=5122,G=5123,V=5124,Y=5125,X=5126,$=32819,K=32820,J=33635,Z=34042,ee=36193,te={};te[U]=te[Q]=1,te[q]=te[G]=te[ee]=te[J]=te[$]=te[K]=2,te[V]=te[Y]=te[X]=te[Z]=4,t.exports=B(a,{optional:D,raise:i,commandRaise:T,command:E,parameter:f,commandParameter:j,type:s,commandType:S,isTypedArray:u,nni:c,oneOf:l,shaderError:w,linkError:k,callSite:g,saveCommandRef:_,saveDrawInfo:A,framebufferFormat:O,guessCommand:b,texture2D:P,textureCube:z})},{"./extend":23,"./is-typed-array":26}],21:[function(e,t,n){t.exports="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(e,t,n){function r(e){return Array.prototype.slice.call(e)}function i(e){return r(e).join("")}var a=e("./extend");t.exports=function(){function e(e){for(var t=0;t<l.length;++t)if(l[t]===e)return c[t];var n="g"+s++;return c.push(n),l.push(e),n}function t(){function e(){n.push.apply(n,r(arguments))}function t(){var e="v"+s++;return o.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,r(arguments)),n.push(";")),e}var n=[],o=[];return a(e,{def:t,toString:function(){return i([o.length>0?"var "+o+";":"",i(n)])}})}function n(){function e(e,t){r(e,t,"=",n.def(e,t),";")}var n=t(),r=t(),i=n.toString,o=r.toString;return a(n,{entry:n,exit:r,save:e,set:function(t,r,i){e(t,r),n(t,r,"=",i,";")},toString:function(){return i()+o()}})}function o(){var e=i(arguments),t=n(),o=n(),f=t.toString,u=o.toString;return a(t,{then:function(){return t.apply(t,r(arguments)),this},else:function(){return o.apply(o,r(arguments)),this},toString:function(){var t=u();return t&&(t="else{"+t+"}"),i(["if(",e,"){",f(),"}",t])}})}function f(e,t){function r(){var e="a"+o.length;return o.push(e),e}var o=[];t=t||0;for(var f=0;f<t;++f)r();var u=n(),s=u.toString,c=p[e]=a(u,{arg:r,toString:function(){return i(["function(",o.join(),"){",s(),"}"])}});return c}function u(){var e=['"use strict";',d,"return {"];Object.keys(p).forEach(function(t){e.push('"',t,'":',p[t].toString(),",")}),e.push("}");var t=i(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),n=Function.apply(null,c.concat(t));return n.apply(null,l)}var s=0,c=[],l=[],d=t(),p={};return{global:d,link:e,block:t,proc:f,scope:n,cond:o,compile:u}}},{"./extend":23}],23:[function(e,t,n){t.exports=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e}},{}],24:[function(e,t,n){var r=e("./is-typed-array");t.exports=function(e){return Array.isArray(e)||r(e)}},{"./is-typed-array":26}],25:[function(e,t,n){var r=e("./is-typed-array");t.exports=function(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||r(e.data))}},{"./is-typed-array":26}],26:[function(e,t,n){var r=e("../constants/arraytypes.json");t.exports=function(e){return Object.prototype.toString.call(e)in r}},{"../constants/arraytypes.json":3}],27:[function(e,t,n){t.exports=function(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}},{}],28:[function(e,t,n){function r(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function i(e){var t,n;return t=(e>65535)<<4,e>>>=t,n=(e>255)<<3,e>>>=n,t|=n,n=(e>15)<<2,e>>>=n,t|=n,n=(e>3)<<1,e>>>=n,t|=n,t|e>>1}function a(e){var t=r(e),n=g[i(t)>>2];return n.length>0?n.pop():new ArrayBuffer(t)}function o(e){g[i(e.byteLength)>>2].push(e)}function f(e,t){var n=null;switch(e){case c:n=new Int8Array(a(t),0,t);break;case l:n=new Uint8Array(a(t),0,t);break;case d:n=new Int16Array(a(2*t),0,t);break;case p:n=new Uint16Array(a(2*t),0,t);break;case m:n=new Int32Array(a(4*t),0,t);break;case h:n=new Uint32Array(a(4*t),0,t);break;case b:n=new Float32Array(a(4*t),0,t);break;default:return null}return n.length!==t?n.subarray(0,t):n}function u(e){o(e.buffer)}var s=e("./loop"),c=5120,l=5121,d=5122,p=5123,m=5124,h=5125,b=5126,g=s(8,function(){return[]});t.exports={alloc:a,free:o,allocType:f,freeType:u}},{"./loop":27}],29:[function(e,t,n){"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?t.exports={next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:t.exports={next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],30:[function(e,t,n){var r=e("./pool"),i=new Float32Array(1),a=new Uint32Array(i.buffer),o=5123;t.exports=function(e){for(var t=r.allocType(o,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-(1/0))t[n]=64512;else{i[0]=e[n];var f=a[0],u=f>>>31<<15,s=(f<<1>>>24)-127,c=f>>13&1023;if(s<-24)t[n]=u;else if(s<-14){var l=-14-s;t[n]=u+(c+1024>>l)}else s>15?t[n]=u+31744:t[n]=u+(s+15<<10)+c}return t}},{"./pool":28}],31:[function(e,t,n){t.exports=function(e){return Object.keys(e).map(function(t){return e[t]})}},{}],32:[function(e,t,n){function r(e,t){function n(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=e.getBoundingClientRect();t=i.right-i.left,n=i.top-i.bottom}r.width=f*t,r.height=f*n,o(r.style,{width:t+"px",height:n+"px"})}var r=document.createElement("canvas"),a=i(r,t);o(r.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(r),e===document.body&&(r.style.position="absolute",o(e.style,{margin:0,padding:0}));var f=+a.options.pixelRatio;window.addEventListener("resize",n,!1);var u=a.options.onDestroy;return a.options=o(o({},a.options),{onDestroy:function(){window.removeEventListener("resize",n),e.removeChild(r),u&&u()}}),n(),a}function i(e,t){function n(t){try{return e.getContext(t,r)}catch(e){return null}}var r=t.glOptions||{},i=n("webgl")||n("experimental-webgl")||n("webgl-experimental");return a(i,"webgl not supported"),{gl:i,options:o({pixelRatio:window.devicePixelRatio},t)}}var a=e("./util/check"),o=e("./util/extend");t.exports=function(e){if("undefined"==typeof document||"undefined"==typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var t=document.body,n=e[1]||{};if("string"==typeof e[0])t=document.querySelector(e[0])||document.body;else if("object"==typeof e[0])if(e[0]instanceof HTMLElement)t=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:o({pixelRatio:1},n)};n=e[0]}return t.nodeName&&"CANVAS"===t.nodeName.toUpperCase()?i(t,n):r(t,n)}},{"./util/check":20,"./util/extend":23}],33:[function(e,t,n){var r=e("./lib/util/check"),i=e("./lib/util/extend"),a=e("./lib/dynamic"),o=e("./lib/util/raf"),f=e("./lib/util/clock"),u=e("./lib/strings"),s=e("./lib/webgl"),c=e("./lib/extension"),l=e("./lib/limits"),d=e("./lib/buffer"),p=e("./lib/elements"),m=e("./lib/texture"),h=e("./lib/renderbuffer"),b=e("./lib/framebuffer"),g=e("./lib/attribute"),v=e("./lib/shader"),y=e("./lib/read"),x=e("./lib/core"),w=e("./lib/stats"),k=e("./lib/timer"),_=16384,A=256,T=1024,E=34962,j="webglcontextlost",S="webglcontextrestored",D=1,O=2,C=3;t.exports=function(){function e(){me=o.next(e),J.tick+=1,J.time=(f()-X)/1e3,M();for(var t=0;t<pe.length;++t){var n=pe[t];n(J,null,0)}W.flush()}function t(){!me&&pe.length>0&&e()}function n(){me&&(o.cancel(e),me=0)}function F(e){}function P(e){}function z(){n(),de&&(de.removeEventListener(j,F),de.removeEventListener(S,P)),ae.clear(),ue.clear(),fe.clear(),oe.clear(),re.clear(),ne.clear(),Y&&Y.clear(),U.onDestroy&&U.onDestroy()}function L(e){function t(e){function t(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach(function(r){n[e+"."+r]=t[r]})}}var n=i({},e);return delete n.uniforms,delete n.attributes,delete n.context,t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),n}function n(e){var t={},n={};return Object.keys(e).forEach(function(r){var i=e[r];a.isDynamic(i)?n[r]=a.unbox(i,r):t[r]=i}),{dynamic:n,static:t}}function o(e){for(;g.length<e;)g.push(null);return g}function f(e,t){var n;if("function"==typeof e)return b.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(n=0;n<e;++n)b.call(this,null,t,n);return}if(Array.isArray(e)){for(n=0;n<e.length;++n)b.call(this,e[n],t,n);return}return b.call(this,e,t,0)}if("number"==typeof e){if(e>0)return h.call(this,o(0|e),0|e)}else{if(!Array.isArray(e))return m.call(this,e);if(e.length)return h.call(this,e,e.length)}}r(!!e,"invalid args to regl({...})"),r.type(e,"object","invalid args to regl({...})");var u=n(e.context||{}),s=n(e.uniforms||{}),c=n(e.attributes||{}),l=n(t(e)),d={gpuTime:0},p=ce.compile(l,c,s,u,d),m=p.draw,h=p.batch,b=p.scope,g=[];return i(f,{stats:d})}function B(e){r("object"==typeof e&&e,"regl.clear() takes an object as input");var t=0;ce.procs.poll();var n=e.color;n&&(W.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),t|=_),"depth"in e&&(W.clearDepth(+e.depth),t|=A),"stencil"in e&&(W.clearStencil(0|e.stencil),t|=T),r(!!t,"called regl.clear with no buffer specified"),W.clear(t)}function I(e){function i(){var t=pe.find(function(t){return t===e});t<0||(pe.splice(t,1),pe.length<=0&&n())}return r.type(e,"function","regl.frame() callback must be a function"),pe.push(e),t(),{cancel:i}}function R(){var e=le.viewport,t=le.scissor_box;e[0]=e[1]=t[0]=t[1]=0,J.viewportWidth=J.framebufferWidth=J.drawingBufferWidth=e[2]=t[2]=W.drawingBufferWidth,J.viewportHeight=J.framebufferHeight=J.drawingBufferHeight=e[3]=t[3]=W.drawingBufferHeight}function M(){R(),ce.procs.poll()}function H(){R(),ce.procs.refresh()}var N=s(Array.prototype.slice.call(arguments)),W=N.gl,U=N.options,Q=u(),q=w(),G=c(W),V=G.extensions,Y=k(W,V),X=f(),$=W.drawingBufferWidth,K=W.drawingBufferHeight,J={tick:0,time:0,viewportWidth:$,viewportHeight:K,framebufferWidth:$,framebufferHeight:K,drawingBufferWidth:$,drawingBufferHeight:K,pixelRatio:U.pixelRatio},Z={},ee={elements:null,primitive:4,count:-1,offset:0,instances:-1},te=l(W,V),ne=d(W,q),re=p(W,V,ne,q),ie=g(W,V,te,ne,Q),ae=v(W,Q,q),oe=m(W,V,te,M,J,q),fe=h(W,V,te,q),ue=b(W,V,te,oe,fe,q),se=y(W,M,J),ce=x(W,Q,V,te,ne,re,oe,ue,Z,ie,ae,ee,J,Y),le=ce.next,de=W.canvas,pe=[],me=0;return de&&(de.addEventListener(j,F,!1),de.addEventListener(S,P,!1)),H(),i(L,{clear:B,prop:a.define.bind(null,D),context:a.define.bind(null,O),this:a.define.bind(null,C),draw:L({}),buffer:function(e){return ne.create(e,E)},elements:re.create,texture:oe.create2D,cube:oe.createCube,renderbuffer:fe.create,framebuffer:ue.create,framebufferCube:function(e){r.raise("framebuffer cube not yet implemented")},attributes:W.getContextAttributes(),frame:I,limits:te,hasExtension:function(e){return te.extensions.indexOf(e.toLowerCase())>=0},read:se,destroy:z,_gl:W,_refresh:H,stats:q,updateTimer:function(){Y&&Y.update()}})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/core":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/stats":16,"./lib/strings":17,"./lib/texture":18,"./lib/timer":19,"./lib/util/check":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":29,"./lib/webgl":32}]},{},[33])(33)});
//# sourceMappingURL=regl.min.js.map