!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.reglInit=e()}}(function(){return function e(t,r,n){function a(s,o){if(!r[s]){if(!t[s]){var f="function"==typeof require&&require;if(!o&&f)return f(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return a(r?r:e)},u,u.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t,r){var n=e("./constants/dtypes.json"),a=e("./util/check"),i=5126;t.exports=function(e,t,r,s,o){function f(){this.pointer=!1,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=i,this.offset=0,this.stride=0,this.divisor=0}function c(e,t,r){return e.pointer?t.pointer&&e.buffer===t.buffer&&e.size===r&&e.normalized===t.normalized&&e.type===(t.type||t.buffer.dtype||i)&&e.offset===t.offset&&e.stride===t.stride&&e.divisor===t.divisor:!t.pointer&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}function u(e,t,r){var n=e.pointer=t.pointer;n?(e.buffer=t.buffer,e.size=r,e.normalized=t.normalized,e.type=t.type||t.buffer.dtype||i,e.offset=t.offset,e.stride=t.stride,e.divisor=t.divisor):(e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w)}function l(e){this.records=[],this.name=e}function p(e){var t=e.records;return t[t.length-1]}function h(r,n,a,s){var o=a.size||s;if(!c(n,a,o)){if(a.pointer){e.enableVertexAttribArray(r),a.buffer.bind(),e.vertexAttribPointer(r,o,a.type||a.buffer.dtype||i,a.normalized,a.stride,a.offset);var f=t.angle_instanced_arrays;f&&f.vertexAttribDivisorANGLE(r,a.divisor)}else e.disableVertexAttribArray(r),e.vertexAttrib4f(r,a.x,a.y,a.z,a.w);u(n,a,o)}}function d(e,t,r,n){h(e,t,p(r),n)}function m(e){var t=o.id(e),r=g[t];return r||(r=g[t]=new l(e)),r}function b(e){function t(t){var r;if(r=i.length<=0?new f:i.pop(),"number"==typeof t)r.pointer=!1,r.x=t,r.y=0,r.z=0,r.w=0;else if(Array.isArray(t))r.pointer=!1,r.x=t[0],r.y=t[1],r.z=t[2],r.w=t[3];else{var o=s.getBuffer(t),c=0,u=0,l=0,p=0,h=!1,d=0;o||(o=s.getBuffer(t.buffer),a(o,'missing or invalid buffer for attribute "'+e+'" called from command '+r._commandRef),c=t.size||0,u=t.stride||0,l=t.offset||0,p=t.divisor||0,h=t.normalized||!1,d=0,"type"in t&&(d=n[t.type])),r.pointer=!0,r.buffer=o,r.size=c,r.offset=l,r.stride=u,r.divisor=p,r.normalized=h,r.type=d}return r}function r(e){i.push(e)}var i=[new f];return a.saveCommandRef(i),{alloc:t,free:r}}for(var g={},v=r.maxAttributes,y=new Array(v),x=0;x<v;++x)y[x]=new f;return{bindings:y,bind:d,bindRecord:h,def:m,box:b,state:g}}},{"./constants/dtypes.json":5,"./util/check":20}],2:[function(e,t,r){function n(e){return 0|u[Object.prototype.toString.call(e)]}function a(e,t){switch(e){case m:return new Uint8Array(t);case g:return new Uint16Array(t);case y:return new Uint32Array(t);case d:return new Int8Array(t);case b:return new Int16Array(t);case v:return new Int32Array(t);case x:return new Float32Array(t);default:return null}}function i(e,t,r){for(var n=0,a=0;a<t.length;++a)for(var i=t[a],s=0;s<r;++s)e[n++]=i[s]}function s(e,t,r,n,a,i,s){for(var o=0,f=0;f<r;++f)for(var c=0;c<n;++c)e[o++]=t[a*f+i*c+s];return e}var o=e("./util/check"),f=e("./util/is-typed-array"),c=e("./util/is-ndarray"),u=e("./constants/arraytypes.json"),l=e("./constants/dtypes.json"),p=e("./util/values"),h=35044,d=5120,m=5121,b=5122,g=5123,v=5124,y=5125,x=5126,w={static:35044,dynamic:35048,stream:35040};t.exports=function(e,t){function r(e,t){this.id=g++,this.buffer=e,this.type=t,this.usage=h,this.byteLength=0,this.dimension=1,this.data=null,this.dtype=m}function u(r){t(r),e.isBuffer(r.buffer)||(r.buffer=e.createBuffer()),r.bind(),e.bufferData(r.type,r.data||r.byteLength,r.usage)}function d(r){var n=r.buffer;o(n,"buffer must not be deleted already"),t(r),e.isBuffer(n)&&e.deleteBuffer(n),r.buffer=null,delete v[r.id]}function b(t,p,b){function g(e){var t=e||{};if(Array.isArray(t)||f(t)||c(t)?t={data:t}:"number"==typeof t?t={length:0|t}:null!==t&&void 0!==t||(t={}),o.type(t,"object","buffer arguments must be an object, a number or an array"),"usage"in t){var r=t.usage;o.parameter(r,w,"invalid buffer usage"),k.usage=w[t.usage]}else k.usage=h;var p=0;"type"in t&&(o.parameter(t.type,l,"invalid buffer type"),p=l[t.type]);var d=0|t.dimension||1,b=0,v=null;if("data"in t)if(v=t.data,null===v)b=0|t.length;else{if(c(v)){var y=v.shape,_=v.stride,A=v.offset,E=0,j=0,S=0,T=0;1===y.length?(E=y[0],j=1,S=_[0],T=0):2===y.length?(E=y[0],j=y[1],S=_[0],T=_[1]):o.raise("invalid shape"),p=p||n(v)||x,d=j,v=s(a(p,E*j),v.data,E,j,S,T,A)}else if(Array.isArray(v))if(v.length>0&&Array.isArray(v[0])){d=v[0].length,p=p||x;var C=a(p,v.length*d);v=i(C,v,d),v=C}else p=p||x,v=a(p,v);else o.isTypedArray(v,"invalid data type buffer data"),p=p||n(v);b=v.byteLength}else"length"in t&&(b=0|t.length,o.nni(b,"buffer length must be a nonnegative integer"));return k.data=v,k.dtype=p||m,k.byteLength=b,k.dimension=d,u(k),g}var y=e.createBuffer(),k=new r(y,p);return v[k.id]=k,b||g(t),g._reglType="buffer",g._buffer=k,g.destroy=function(){d(k)},g}var g=0,v={};return r.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},{create:b,clear:function(){p(v).forEach(d)},refresh:function(){p(v).forEach(u)},getBuffer:function(e){return e&&e._buffer instanceof r?e._buffer:null}}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./util/check":20,"./util/is-ndarray":24,"./util/is-typed-array":25,"./util/values":31}],3:[function(e,t,r){function n(e){switch(e){case d:case v:case k:return 2;case m:case y:case _:return 3;case b:case x:case A:return 4;default:return 1}}function a(e,t,r,n){var a,i=",";switch(t){case h:a="1f";break;case d:a="2fv";break;case m:a="3fv";break;case b:a="4fv";break;case w:case g:a="1i";break;case k:case v:a="2iv";break;case _:case y:a="3iv";break;case A:case x:a="4iv";break;case E:a="Matrix2fv",i=",false,";break;case j:a="Matrix3fv",i=",false,";break;case S:a="Matrix4fv",i=",false,";break;default:o.raise("unsupported uniform type")}return e+".uniform"+a+"("+r+i+n+");"}function i(e){return e+"["+e+".length-1]"}function s(e,t){return"framebuffer"===e?-1:e<t?-1:e>t?1:0}var o=e("./util/check"),f=e("./util/codegen"),c=e("./constants/primitives.json"),u=34963,l=35632,p=35633,h=5126,d=35664,m=35665,b=35666,g=5124,v=35667,y=35668,x=35669,w=35670,k=35671,_=35672,A=35673,E=35674,j=35675,S=35676,T=35678,C=35680,O=4,B=2884,F=3042,D=3024,P=2960,R=2929,L=3089,I=32823,M=32926,z=32928,U=1028,H=1029,W=2304,q=2305,G=32775,N=32776,V=0,Y=1,X=2,$=3,K={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},J={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Q={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};t.exports=function(e,t,r,h,d,m,b,v,y,x,w,k,_,A,E){function j(t){var s=f(),o=s.link,c=s.proc("draw"),u=c.def,l=o(e),p=o(t.program),h=o(w.bind),d={count:o(_.count),offset:o(_.offset),instances:o(_.instances),primitive:o(_.primitive)},b=o(m.elements),v=[];c(l,".useProgram(",p,");"),t.attributes.forEach(function(e){var t=o(w.def(e.name));c(h,"(",e.location,",",o(w.bindings[e.location]),",",t,",",n(e.info.type),");")}),t.uniforms.forEach(function(e){var t=o(e.location),r=o(x.def(e.name)),n=r+"["+r+".length-1]",i=e.info.type;if(i===T||i===C){var s=u(n+"._texture");v.push(s),c(a(l,g,t,s+".bind()"))}else c(a(l,i,t,n))}),v.forEach(function(e){c(e,".unbind();")});var y=u(i(d.primitive)),k=u(i(d.count)),A=u(i(d.offset)),E=u(i(b));c("if(",k,"){");var j=r.angle_instanced_arrays;if(j){var S=u(i(d.instances)),O=o(j);c("if(",E,"){",E,".bind();","if(",S,">0){",O,".drawElementsInstancedANGLE(",y,",",k,",",E,".type,",A,",",S,");}else{",l,".drawElements(",y,",",k,",",E,".type,",A,");}","}else if(",S,">0){",O,".drawArraysInstancedANGLE(",y,",",A,",",k,",",S,");}else{",l,".drawArrays(",y,",",A,",",k,");}}")}else c("if(",E,"){",E,".bind();",l,".drawElements(",y,",",k,",",E,".type,",A,");","}else{",l,".drawArrays(",y,",",A,",",k,");}}");return s.compile().draw}function S(t,l,p,h,d){function b(e){var t=pe[e];return t?t:t=pe[e]=N(ee[e])}function y(e){var t=e.id,r=Ae[t];if(r)return r;switch(e.type){case V:r=Z.def(N(e.data),".call(this,",ke,",",ce,")");break;case Y:r=Z.def(ke,e.data);break;case X:r=Z.def(ce,e.data);break;case $:r=Z.def("this",e.data)}return Ae[t]=r,r}function k(e,t){for(var r=0;r<e.length;++r)if(e[r].name===t)return e[r];return null}function E(e){return ye&&!(e in l||e in d)}var j,S,G=f(),N=G.link,Z=G.proc("batch"),re=G.block(),ne=Z.def,ae=Z.arg,ie=N(e),se=N(t.program),oe=N(w.bind),fe=N(w.bindRecord),ce=N(A),ue=N(v),le={count:N(_.count),offset:N(_.offset),instances:N(_.instances),primitive:N(_.primitive)},pe={},he=N(m.elements),de=ne(i(le.count)),me=ne(i(le.offset)),be=ne(i(le.primitive)),ge=ne(i(he)),ve=r.angle_instanced_arrays;ve&&(j=ne(i(le.instances)),S=N(ve));var ye="elements"in l,xe=ae(),we=ae(),ke=ne(),_e=ne(),Ae={};Z(ie,".useProgram(",se,");"),t.uniforms.forEach(function(e){if(!(e.name in p)){var t=N(e.location),r=N(x.def(e.name)),n=r+"["+r+".length-1]",i=e.info.type;if(i===T||i===C){var s=ne(n+"._texture");Z(a(ie,g,t,s+".bind()")),re(s,".unbind();")}else Z(a(ie,i,t,n))}}),t.attributes.forEach(function(e){if(!(e.name in h)){var t=N(w.def(e.name));Z(oe,"(",e.location,",",N(w.bindings[e.location]),",",t,",",n(e.info.type),");")}}),ye||Z("if(",ge,")",ie,".bindBuffer(",u,",",ge,".buffer.buffer);"),Z("for(",_e,"=0;",_e,"<",xe,";++",_e,"){",ke,"=",we,"[",_e,"];",ce,".batchId=",_e,";"),Object.keys(l).sort(s).forEach(function(e){function t(e){Z("if(",r,"){",ie,".enable(",e,");}else{",ie,".disable(",e,");}")}var r=y(l[e]);switch(e){case"framebuffer":var n=b("viewport"),a=b("scissor.box");Z("if(",ue,".push(",r,"&&",r,"._framebuffer)){",ue,".poll();",n,".setDirty();",a,".setDirty();","}");break;case"cull.enable":t(B);break;case"blend.enable":t(F);break;case"dither":t(D);break;case"stencil.enable":t(P);break;case"depth.enable":t(R);break;case"scissor.enable":t(L);break;case"polygonOffset.enable":t(I);break;case"sample.alpha":t(M);break;case"sample.enable":t(z);break;case"depth.mask":Z(ie,".depthMask(",r,");");break;case"depth.func":var i=N(J);Z(ie,".depthFunc(",i,"[",r,"]);");break;case"depth.range":Z(ie,".depthRange(",r,"[0],",r,"[1]);");break;case"blend.color":Z(ie,".blendColor(",r,"[0],",r,"[1],",r,"[2],",r,"[3]);");break;case"blend.equation":var s=N(te);Z("if(typeof ",r,'==="string"){',ie,".blendEquation(",s,"[",r,"]);","}else{",ie,".blendEquationSeparate(",s,"[",r,".rgb],",s,"[",r,".alpha]);","}");break;case"blend.func":var f=N(K);Z(ie,".blendFuncSeparate(",f,'["srcRGB" in ',r,"?",r,".srcRGB:",r,".src],",f,'["dstRGB" in ',r,"?",r,".dstRGB:",r,".dst],",f,'["srcAlpha" in ',r,"?",r,".srcAlpha:",r,".src],",f,'["dstAlpha" in ',r,"?",r,".dstAlpha:",r,".dst]);");break;case"stencil.mask":Z(ie,".stencilMask(",r,");");break;case"stencil.func":var c=N(J);Z(ie,".stencilFunc(",c,"[",r,'.cmp||"always"],',r,".ref|0,",'"mask" in ',r,"?",r,".mask:-1);");break;case"stencil.opFront":case"stencil.opBack":var u=N(Q);Z(ie,".stencilOpSeparate(","stencil.opFront"===e?U:H,",",u,"[",r,'.fail||"keep"],',u,"[",r,'.zfail||"keep"],',u,"[",r,'.pass||"keep"]);');break;case"polygonOffset.offset":Z(ie,".polygonOffset(",r,".factor||0,",r,".units||0);");break;case"cull.face":Z(ie,".cullFace(",r,'==="front"?',U,":",H,");");break;case"lineWidth":Z(ie,".lineWidth(",r,");");break;case"frontFace":Z(ie,".frontFace(",r,'==="cw"?',W,":",q,");");break;case"colorMask":Z(ie,".colorMask(",r,"[0],",r,"[1],",r,"[2],",r,"[3]);");break;case"sample.coverage":Z(ie,".sampleCoverage(",r,".value,",r,".invert);");break;case"scissor.box":case"viewport":var p=b(e);Z(p,".push(",r,".x||0,",r,".y||0,",r,".w||-1,",r,".h||-1);");break;case"primitive":case"offset":case"count":case"elements":case"instances":break;default:o.raise("unsupported option for batch",e)}}),("viewport"in l||"framebuffer"in l)&&Z(b("viewport"),".poll();"),("scissor.box"in l||"framebuffer"in l)&&Z(b("scissor.box"),".poll();"),"framebuffer"in l&&Z(ue,".pop();");var Ee=t.uniforms,je=[];Object.keys(p).forEach(function(e){var t=k(Ee,e);if(t){var r=t.info.type,n=N(t.location),i=y(p[e]);if(t.info.type===T||t.info.type===C){var s=ne(i+"._texture");je.push(s),Z(a(ie,g,n,s+".bind()"))}else Z(a(ie,r,n,i))}}),je.forEach(function(e){Z(e,".unbind();")});var Se=t.attributes;if(Object.keys(h).forEach(function(e){var t=k(Se,e);if(t){var r=N(w.box(e)),a=y(h[e]),i=ne(r+".alloc("+a+")");Z(fe,"(",t.location,",",N(w.bindings[t.location]),",",i,",",n(t.info.type),");"),re(r,".free(",i,");")}}),l.count&&Z(de,"=",y(l.count),";"),l.offset&&Z(me,"=",y(l.offset),";"),l.primitive&&Z(be,"=",N(c),"[",y(l.primitive),"];"),ve&&l.instances&&Z(j,"=",y(l.instances),";"),ye){var Te=y(l.elements);Z(ge,"=",Te,"?",Te,"._elements:null;")}return E("offset")&&Z(me,"=0;"),Z("if(",ge,"){"),E("count")&&Z(de,"=",ge,".vertCount;"),Z("if(",de,">0){"),E("primitive")&&Z(be,"=",ge,".primType;"),ye&&Z(ie,".bindBuffer(",u,",",ge,".buffer.buffer);"),ve&&Z("if(",j,">0){",S,".drawElementsInstancedANGLE(",be,",",de,",",ge,".type,",me,",",j,");}else "),Z(ie,".drawElements(",be,",",de,",",ge,".type,",me,");"),Z("}}else if(",de,">0){"),E("count")||(E("primitive")&&Z(be,"=",O,";"),ve&&Z("if(",j,">0){",S,".drawArraysInstancedANGLE(",be,",",me,",",de,",",j,");}else{"),Z(ie,".drawArrays(",be,",",me,",",de,");"),ve&&Z("}")),Z("}}",re),G.compile().batch}function Z(e,r,n,a,i,u,d,b){function g(e){var t=ae[e];return t?t:t=ae[e]=B(ee[e])}function y(e,t){var r=g(e);ie(r,".push(",t,");"),se(r,".pop();")}function j(e){var t=e.id,r=ue[t];if(r)return r;switch(e.type){case V:r=fe.def(B(e.data),".call(this,",T,",",ne,")");break;case Y:r=fe.def(T,e.data);break;case X:r=fe.def(ne,e.data);break;case $:r=fe.def("this",e.data)}return ue[t]=r,r}var T,C=f(),B=C.link,F=C.block,D=C.proc,P=re++,R=B(E),L=B(k),I=B(v),M={count:B(_.count),offset:B(_.offset),instances:B(_.instances),primitive:B(_.primitive)},z=B(m.elements),G=B(c),N=B(J),Z=B(Q),ne=B(A),ae={},ie=F(),se=F();b&&(T=ie.def()),ie(ne,".batchId=0;");var oe=F();Object.keys(d.static).forEach(function(e){var t=ie.def(ne,".",e);oe(ne,".",e,"=",B(d.static[e]),";"),se(ne,".",e,"=",t,";")}),Object.keys(d.dynamic).forEach(function(e){var t=ie.def(ne,".",e),r=ie.def(),n=d.dynamic[e];switch(oe(ne,".",e,"=",r,";"),n.type){case V:ie(r,"=",B(n.data),".call(this,",T,",",ne,");");break;case Y:ie(r,"=",T,n.data,";");break;case X:ie(r,"=",ne,n.data,";");break;case $:ie(r,"=","this",n.data,";")}se(ne,".",e,"=",t,";")}),ie(oe),Object.keys(e).sort(s).forEach(function(r){var n=e[r];switch(r){case"frag":case"vert":var a=t.id(n);k.shader("frag"===r?l:p,a),ie(L,".",r,".push(",a,");"),se(L,".",r,".pop();");break;case"framebuffer":var i=v.getFramebuffer(n);o(null===n||i,"invalid framebuffer object");var s=g("viewport"),f=g("scissor.box");ie("if(",I,".push(",B(n&&n._framebuffer),")){",s,".setDirty();",f,".setDirty();","}"),se("if(",I,".pop()){",s,".setDirty();",f,".setDirty();","}");break;case"count":case"offset":case"instances":o.nni(n,r),ie(M[r],".push(",n,");"),se(M[r],".pop();");break;case"primitive":o.parameter(n,c,"not a valid drawing primitive");var u=c[n];ie(M.primitive,".push(",u,");"),se(M.primitive,".pop();");break;case"elements":var d=m.getElements(n),b=!("primitive"in e),x=!("count"in e);if(d){var w=B(d);ie(z,".push(",w,");"),b&&ie(M.primitive,".push(",w,".primType);"),x&&ie(M.count,".push(",w,".vertCount);")}else ie(z,".push(null);"),b&&ie(M.primitive,".push(",O,");"),x&&ie(M.count,".push(0);");b&&se(M.primitive,".pop();"),x&&se(M.count,".pop();"),"offset"in e||(ie(M.offset,".push(0);"),se(M.offset,".pop();")),se(z,".pop();");break;case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":o.type(n,"boolean",r),y(r,n);break;case"depth.func":o.parameter(n,J,r),y(r,J[n]);break;case"depth.range":o(Array.isArray(n)&&2===n.length&&n[0]<=n[1],"depth range is 2d array");var _=g(r);ie(_,".push(",n[0],",",n[1],");"),se(_,".pop();");break;case"blend.func":var A=g(r);o.type(n,"object","blend func must be an object");var E="srcRGB"in n?n.srcRGB:n.src,j="srcAlpha"in n?n.srcAlpha:n.src,S="dstRGB"in n?n.dstRGB:n.dst,T="dstAlpha"in n?n.dstAlpha:n.dst;o.parameter(E,K),o.parameter(j,K),o.parameter(S,K),o.parameter(T,K),ie(A,".push(",K[E],",",K[S],",",K[j],",",K[T],");"),se(A,".pop();");break;case"blend.equation":var C=g(r);"string"==typeof n?(o.parameter(n,te,"invalid blend equation"),ie(C,".push(",te[n],",",te[n],");")):"object"==typeof n?(o.parameter(n.rgb,te,"invalid blend equation rgb"),o.parameter(n.alpha,te,"invalid blend equation alpha"),ie(C,".push(",te[n.rgb],",",te[n.alpha],");")):o.raise("invalid blend equation"),se(C,".pop();");break;case"blend.color":o(Array.isArray(n)&&4===n.length,"blend color is a 4d array");var F=g(r);ie(F,".push(",n[0],",",n[1],",",n[2],",",n[3],");"),se(F,".pop();");break;case"stencil.mask":o.type(n,"number","stencil mask must be an integer");var D=g(r);ie(D,".push(",n,");"),se(D,".pop();");break;case"stencil.func":o.type(n,"object","stencil func must be an object");var P=n.cmp||"keep",R=n.ref||0,G="mask"in n?n.mask:-1;o.parameter(P,J,"invalid stencil func cmp"),o.type(R,"number","stencil func ref"),o.type(G,"number","stencil func mask");var N=g(r);ie(N,".push(",J[P],",",R,",",G,");"),se(N,".pop();");break;case"stencil.opFront":case"stencil.opBack":o.type(n,"object",r);var V=n.fail||"keep",Y=n.zfail||"keep",X=n.pass||"keep";o.parameter(V,Q,r),o.parameter(Y,Q,r),o.parameter(X,Q,r);var $=g(r);ie($,".push(",Q[V],",",Q[Y],",",Q[X],");"),se($,".pop();");break;case"polygonOffset.offset":o.type(n,"object",r);var Z=n.factor||0,ee=n.units||0;o.type(Z,"number","offset.factor"),o.type(ee,"number","offset.units");var re=g(r);ie(re,".push(",Z,",",ee,");"),se(re,".pop();");break;case"cull.face":var ne=0;"front"===n?ne=U:"back"===n&&(ne=H),o(!!ne,"cull.face");var ae=g(r);ie(ae,".push(",ne,");"),se(ae,".pop();");break;case"lineWidth":var oe=h.lineWidthDims;o("number"==typeof n&&n>=oe[0]&&n<=oe[1],"invalid line width, must positive number between "+oe[0]+" and "+oe[1]),y(r,n);break;case"frontFace":var fe=0;"cw"===n?fe=W:"ccw"===n&&(fe=q),o(!!fe,"frontFace");var ce=g(r);ie(ce,".push(",fe,");"),se(ce,".pop();");break;case"colorMask":o(Array.isArray(n)&&4===n.length,"color mask must be length 4 array");var ue=g(r);ie(ue,".push(",n.map(function(e){return!!e}).join(),");"),se(ue,".pop();");break;case"sample.coverage":o.type(n,"object",r);var le="value"in n?n.value:1,pe=!!n.invert;o("number"==typeof le&&le>=0&&le<=1,"sample value");var he=g(r);ie(he,".push(",le,",",pe,");"),se(he,".pop();");break;case"viewport":case"scissor.box":o("object"==typeof n&&n,r+" is an object");var de=n.x||0,me=n.y||0,be=-1,ge=-1;o("number"==typeof de&&de>=0,r+".x must be a positive int"),o("number"==typeof me&&me>=0,r+".y must be a positive int"),"w"in n&&(be=n.w,o("number"==typeof be&&be>=0,r+".w must be a positive int")),"h"in n&&(ge=n.h,o("number"==typeof ge&&ge>=0,r+".h must be a positive int"));var ve=g(r);ie(ve,".push(",de,",",me,",",be,",",ge,");"),se(ve,".pop();");break;default:o.raise("unsupported parameter "+r)}}),Object.keys(r).forEach(function(e){var t,n=B(x.def(e)),a=r[e];t="function"==typeof a&&a._reglType?B(a):Array.isArray(a)?B(a.slice()):+a,ie(n,".push(",t,");"),se(n,".pop();")}),Object.keys(n).forEach(function(e){var t=n[e],r=B(w.def(e)),a=B(w.box(e).alloc(t));ie(r,".records.push(",a,");"),se(r,".records.pop();")});var fe=C.block(),ce=C.block(),ue={};Object.keys(a).sort(s).forEach(function(t){var r=j(a[t]);switch(t){case"framebuffer":var n=g("viewport"),i=g("scissor.box");fe("if(",I,".push(",r,"&&",r,"._framebuffer)){",n,".setDirty();",i,".setDirty();","}"),ce("if(",I,".pop()){",n,".setDirty();",i,".setDirty();","}");break;case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"lineWidth":case"depth.mask":var s=g(t);fe(s,".push(",r,");"),ce(s,".pop();");break;case"count":case"offset":case"instances":var f=M[t];fe(f,".push(",r,");"),ce(f,".pop();");break;case"primitive":var c=M.primitive;fe(c,".push(",G,"[",r,"]);"),ce(c,".pop();");break;case"depth.func":var u=g(t);fe(u,".push(",N,"[",r,"]);"),ce(u,".pop();");break;case"blend.func":var l=g(t),p=B(K);fe(l,".push(",p,'["srcRGB" in ',r,"?",r,".srcRGB:",r,".src],",p,'["dstRGB" in ',r,"?",r,".dstRGB:",r,".dst],",p,'["srcAlpha" in ',r,"?",r,".srcAlpha:",r,".src],",p,'["dstAlpha" in ',r,"?",r,".dstAlpha:",r,".dst]);"),ce(l,".pop();");break;case"blend.equation":var h=g(t),d=B(te);fe("if(typeof ",r,'==="string"){',h,".push(",d,"[",r,"],",d,"[",r,"]);","}else{",h,".push(",d,"[",r,".rgb],",d,"[",r,".alpha]);","}"),ce(h,".pop();");break;case"blend.color":var m=g(t);fe(m,".push(",r,"[0],",r,"[1],",r,"[2],",r,"[3]);"),ce(m,".pop();");break;case"stencil.mask":var b=g(t);fe(b,".push(",r,");"),ce(b,".pop();");break;case"stencil.func":var v=g(t);fe(v,".push(",N,"[",r,".cmp],",r,".ref|0,",'"mask" in ',r,"?",r,".mask:-1);"),ce(v,".pop();");break;case"stencil.opFront":case"stencil.opBack":var y=g(t);fe(y,".push(",Z,"[",r,'.fail||"keep"],',Z,"[",r,'.zfail||"keep"],',Z,"[",r,'.pass||"keep"]);'),ce(y,".pop();");break;case"polygonOffset.offset":var x=g(t);fe(x,".push(",r,".factor||0,",r,".units||0);"),ce(x,".pop();");break;case"cull.face":var w=g(t);fe(w,".push(",r,'==="front"?',U,":",H,");"),ce(w,".pop();");break;case"frontFace":var k=g(t);fe(k,".push(",r,'==="cw"?',W,":",q,");"),ce(k,".pop();");break;case"colorMask":var _=g(t);fe(_,".push(",r,"[0],",r,"[1],",r,"[2],",r,"[3]);"),ce(_,".pop();");break;case"sample.coverage":var A=g(t);fe(A,".push(",r,".value,",r,".invert);"),ce(A,".pop();");break;case"scissor.box":case"viewport":var E=g(t);fe(E,".push(",r,".x||0,",r,".y||0,",'"w" in ',r,"?",r,".w:-1,",'"h" in ',r,"?",r,".h:-1);"),ce(E,".pop();");break;case"elements":var S=!("primitive"in a||"primitive"in e),T=!("count"in a||"count"in e),C=!("offset"in a||"offset"in e),O=fe.def();fe("if(",r,"){",O,"=",r,"._elements;",z,".push(",O,");",S?M.primitive+".push("+O+".primType);":"",T?M.count+".push("+O+".vertCount);":"",C?M.offset+".push("+O+".offset);":"","}else{",z,".push(null);","}"),ce(z,".pop();","if(",r,"){",S?M.primitive+".pop();":"",T?M.count+".pop();":"",C?M.offset+".pop();":"","}");break;default:o.raise("unsupported dynamic option: "+t)}}),Object.keys(i).forEach(function(e){var t=B(x.def(e)),r=j(i[e]);fe(t,".push(",r,");"),ce(t,".pop();")}),Object.keys(u).forEach(function(e){var t=B(w.def(e)),r=j(u[e]),n=B(w.box(e));fe(t,".records.push(",n,".alloc(",r,"));"),ce(n,".free(",t,".records.pop());")});var le=D("scope"),pe=le.arg(),he=le.arg();b&&le(T,"=",pe,";"),le(ie),b&&le(fe),le(he,"(",pe,",",ne,");",b?ce:"",se);var de=F(),me=de.def();if(e.frag&&e.vert){var be=e.frag,ge=e.vert;de(me,"=",B(k.program(t.id(ge),t.id(be))),";")}else de(me,"=",L,".program","(",L,".vert[",L,".vert.length-1]",",",L,".frag[",L,".frag.length-1]",");");var ve=D("draw");b&&ve(T,"=",ve.arg(),";"),ve(ie,de),b&&ve(fe),ve(R,"();","if(",me,")",me,".draw.call(this",b?","+T:"",");",b?ce:"",se);var ye=D("batch"),xe=ye.arg(),we=ye.arg();b&&ye(T,"=",we,"[0];"),ye(ie,de);var ke=B(function(t,r,n){var s=t.batchCache[P];return s||(s=t.batchCache[P]=S(t,a,i,u,e)),s.call(this,r,n)});return ye("if(",me,"){",R,"();",ke,".call(this,",me,",",xe,",",we,");"),Object.keys(a).forEach(function(e){var t=ae[e];t&&ye(t,".setDirty();")}),ye("}",se),C.compile()}var ee=y.contextState,te={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(te.min=G,te.max=N);var re=0;return{draw:j,command:Z}}},{"./constants/primitives.json":6,"./util/check":20,"./util/codegen":22}],4:[function(e,t,r){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(e,t,r){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126}},{}],6:[function(e,t,r){t.exports={points:0,lines:1,"line loop":2,"line strip":3,triangles:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(e,t,r){var n=4;t.exports=function(e){var t=[n],r=[-1],a=[0],i=[0];return{primitive:t,count:r,offset:a,instances:i}}},{}],8:[function(e,t,r){function n(e,t){this.id=l++,this.type=e,this.data=t}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function i(e){if(0===e.length)return[];var t=e.charAt(0),r=e.charAt(e.length-1);if(e.length>1&&t===r&&('"'===t||"'"===t))return['"'+a(e.substr(1,e.length-2))+'"'];var n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(n)return i(e.substr(0,n.index)).concat(i(n[1])).concat(i(e.substr(n.index+n[0].length)));var s=e.split(".");if(1===s.length)return['"'+a(e)+'"'];for(var o=[],f=0;f<s.length;++f)o=o.concat(i(s[f]));return o}function s(e){return"["+i(e).join("][")+"]"}function o(e,t){switch(typeof t){case"boolean":case"number":case"string":return new n(e,s(t+""));case"undefined":return new n(e|h,null);default:u.raise("invalid property type")}}function f(e){return"function"==typeof e&&!e._reglType||e instanceof n}function c(e,t){if(e instanceof n){if(e.type&h)return new n(e.type&~h,s(t))}else if("function"==typeof e)return new n(p,e);return e}var u=e("./util/check"),l=0,p=0,h=128;t.exports={define:o,isDynamic:f,unbox:c,accessor:s}},{"./util/check":20}],9:[function(e,t,r){var n=e("./util/check"),a=e("./util/is-typed-array"),i=e("./util/is-ndarray"),s=e("./constants/primitives.json"),o=0,f=1,c=4,u=5120,l=5121,p=5122,h=5123,d=5124,m=5125,b=34963;t.exports=function(e,t,r){function g(){this.buffer=null,this.primType=c,this.vertCount=0,this.type=0}function v(e){function v(e){var r=e,b=t.oes_element_index_uint;if(r)if("number"==typeof r)x(r);else{var g=null,w="static",k=0;Array.isArray(r)||a(r)||i(r)?g=r:(n.type(r,"object","invalid arguments for elements"),"data"in r&&(g=r.data),"usage"in r&&(w=r.usage),"length"in r&&(k=r.length)),x(Array.isArray(g)||i(g)&&"array"===g.dtype||"type"in r?{type:r.type||(b?"uint32":"uint16"),usage:w,data:g,length:k}:{usage:w,data:g,length:k}),(Array.isArray(g)||a(g))&&(x.dimension=3)}else x();var _=y.buffer.byteLength,A=0;switch(y.buffer.dtype){case l:case u:A=l;break;case h:case p:A=h,_>>=1;break;case m:case d:n(b,"32 bit element buffers not supported"),A=m,_>>=2;break;default:n.raise("invalid element buffer type")}var E=c,j=y.buffer.dimension;if(1===j&&(E=o),2===j&&(E=f),3===j&&(E=c),"object"==typeof r){if("primitive"in r){var S=r.primitive;n.parameter(S,s),E=s[S]}"count"in r&&(_=0|r.vertCount)}return y.primType=E,y.vertCount=_,y.type=A,v}var y=new g,x=r.create(null,b,!0);return y.buffer=x._buffer,v(e),v._reglType="elements",v._elements=y,v.destroy=function(){n(null!==y.buffer,"must not double destroy elements"),x.destroy(),y.buffer=null},v}var y=[null];return g.prototype.bind=function(){this.buffer.bind()},{create:v,elements:y,getElements:function(e){return e&&e._elements instanceof g?e._elements:null}}}},{"./constants/primitives.json":6,"./util/check":20,"./util/is-ndarray":24,"./util/is-typed-array":25}],10:[function(e,t,r){t.exports=function(e){function t(){["oes_texture_float","oes_texture_float_linear","oes_texture_half_float","oes_texture_half_float_linear","oes_standard_derivatives","oes_element_index_uint","oes_fbo_render_mipmap","webgl_depth_texture","webgl_draw_buffers","webgl_color_buffer_float","ext_texture_filter_anisotropic","ext_frag_depth","ext_blend_minmax","ext_shader_texture_lod","ext_color_buffer_half_float","ext_srgb","angle_instanced_arrays","webgl_compressed_texture_s3tc","webgl_compressed_texture_atc","webgl_compressed_texture_pvrtc","webgl_compressed_texture_etc1"].forEach(function(t){try{r[t]=e.getExtension(t)}catch(e){}})}var r={};return t(),{extensions:r,refresh:t}}},{}],11:[function(e,t,r){var n=e("./util/check"),a=e("./util/values"),i=e("./util/extend"),s=36160,o=36161,f=3553,c=34067,u=34069,l=36064,p=36096,h=36128,d=33306,m=5121,b=5126,g=36193,v=6408,y=32854,x=32855,w=36194,k=33189,_=36168,A=6402,E=34041,j=35907,S=34836,T=34842,C=34843,O=36053,B=36054,F=36055,D=36057,P=36061,R=1029,L=[R];t.exports=function(e,t,r,R,I){function M(e,t,r,n){this.target=e,this.level=t,this.texture=r,this.renderbuffer=n}function z(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function U(e,t,r){e.texture?n.oneOf(e.texture._texture.params.internalformat,t,"unsupported texture format for attachment"):n.oneOf(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")}function H(e,t){var r=t.width,a=t.height;if(e.texture){var i=e.texture._texture,s=Math.max(1,i.params.width>>e.level),o=Math.max(1,i.params.height>>e.level);r=r||s,a=a||o,n(s===r&&o===a,"inconsistent width/height for supplied texture"),n(i.pollId<0,"polling fbo textures not supported"),i.refCount+=1}else{var f=e.renderbuffer._renderbuffer;r=r||f.width,a=a||f.height,n(f.width===r&&f.height===a,"inconsistent width/height for renderbuffer"),n(pe.indexOf(f.format)>=0,"renderbuffer format not compatible with color channels"),f.refCount+=1}t.width=r,t.height=a}function W(t,r){r?r.texture?e.framebufferTexture2D(s,t,r.target,r.texture._texture.texture,r.level):e.framebufferRenderbuffer(s,t,o,r.renderbuffer._renderbuffer.renderbuffer):e.framebufferTexture2D(s,t,f,null,0)}function q(e,t,r,n,a,i){if(e.texture){var s=e.texture;if(t)return s({format:r,type:n,width:a,height:i}),s._texture.refCount+=1,!0}else{var o=e.renderbuffer;if(!t)return o({format:r,width:a,height:i}),o._renderbuffer.refCount+=1,!0}return z(e),!1}function G(e){var t=f,r=0,a=null,i=null,s=e;"object"==typeof e&&(s=e.data,"level"in e&&(r=0|e.level),"target"in e&&(t=0|e.target)),n.type(s,"function","invalid attachment data");var l=e._reglType;return"texture"===l?(a=e,a._texture.target===c?n(t>=u&&t<u+6,"invalid cube map target"):n(t===f)):"renderbuffer"===l?(i=e,t=o,r=0):n.raise("invalid regl object for attachment"),new M(t,r,a,i)}function N(e){return e&&(e.texture||e.renderbuffer)}function V(){this.id=be++,ge[this.id]=this,this.framebuffer=null,this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null,this.ownsColor=!1,this.ownsDepthStencil=!1}function Y(a){e.isFramebuffer(a.framebuffer)||(a.framebuffer=e.createFramebuffer()),ye=!0,e.bindFramebuffer(s,a.framebuffer);for(var i=a.colorAttachments,o=0;o<i.length;++o)W(l+o,i[o]);for(o=i.length;o<r.maxColorAttachments;++o)W(l+o,null);W(p,a.depthAttachment),W(h,a.stencilAttachment),W(d,a.depthStencilAttachment),t.webgl_draw_buffers&&t.webgl_draw_buffers.drawBuffersWEBGL(me[i.length]);var f=e.checkFramebufferStatus(s);f!==O&&n.raise("framebuffer configuration not supported, status = "+te[f])}function X(e){e.colorAttachments.forEach(z),z(e.depthAttachment),z(e.stencilAttachment),z(e.depthStencilAttachment)}function $(t){var r=t.framebuffer;n(r,"must not double destroy framebuffer"),e.isFramebuffer(r)&&e.deleteFramebuffer(r)}function K(r){function a(r){var s,c=r||{},u=t.webgl_draw_buffers,l=0,p=0;if("shape"in c){var h=c.shape;n(Array.isArray(h)&&h.length>=2,"invalid shape for framebuffer"),l=h[0],p=h[1]}else"radius"in c&&(l=p=c.radius),"width"in c&&(l=c.width),
"height"in c&&(p=c.height);var d=null,m=!1;if("colorBuffers"in c||"colorBuffer"in c){var b=c.colorBuffers||c.colorBuffer;for(Array.isArray(b)||(b=[b]),i.width=l,i.height=p,b.length>1&&n(u,"multiple render targets not supported"),n(b.length>=0,"must specify at least one color attachment"),d=b.map(G),s=0;s<d.length;++s){var g=d[s];U(g,le,pe),H(g,i)}l=i.width,p=i.height}else{var v=!0,y="rgba",x="uint8",w=1;if(m=!0,i.width=l=l||e.drawingBufferWidth,i.height=p=p||e.drawingBufferHeight,"format"in c&&(y=c.format,n.parameter(y,ue,"invalid color format"),v=y in re),"type"in c&&(n(v,"colorType can not be set for renderbuffer targets"),x=c.type,n.parameter(x,de,"invalid color type")),"colorCount"in c&&(w=0|c.colorCount,n(w>=0,"color count must be positive")),i.ownsColor)for(d=i.colorAttachments;d.length>w;)z(d.pop());else d=[];for(s=0;s<d.length;++s)q(d[s],v,y,x,l,p)||(d[s--]=d[d.length-1],d.pop());for(;d.length<w;)v?d.push(new M(f,0,R.create({format:y,type:x,width:l,height:p},f),null)):d.push(new M(o,0,null,I.create({format:y,width:l,height:p})))}n(d.length>0,"must specify at least one color buffer"),i.width=l,i.height=p;var k=null,_=null,A=null,E=!1,j=0;if("depthBuffer"in c&&(k=G(c.depthBuffer),U(k,oe,ae),j+=1),"stencilBuffer"in c&&(_=G(c.stencilBuffer),U(_,fe,ie),j+=1),"depthStencilBuffer"in c&&(A=G(c.depthStencilBuffer),U(A,ce,se),j+=1),k||_||A)n(1===j,"can specify only one of depth, stencil or depthStencil attachment"),H(k||_||A,i);else{var S=!0,T=!1,C=!1;"depth"in c&&(S=!!c.depth),"stencil"in c&&(T=!!c.stencil),"depthTexture"in c&&(C=!!c.depthTexture);var O=i.depthAttachment||i.stencilAttachment||i.depthStencilAttachment,B=null;if(S||T){if(E=!0,C){n(t.webgl_depth_texture,"depth texture extension not supported");var F;n(S,"stencil only textures not supported"),F=T?"depth stencil":"depth",i.ownsDepthStencil&&O.texture?(O.texture({format:F,width:l,height:p}),O.texture._texture.refCount+=1,B=O):B=new M(f,0,R.create({format:F,width:l,height:p},f),null)}else{var D;D=S?T?"depth stencil":"depth":"stencil",i.ownsDepthStencil&&O.renderbuffer?(O.renderbuffer({format:D,width:l,height:p}),O.renderbuffer._renderbuffer.refCount+=1,B=O):B=new M(o,0,null,I.create({format:D,width:l,height:p}))}S?T?A=B:k=B:_=B}}return X(i),i.colorAttachments=d,i.depthAttachment=k,i.stencilAttachment=_,i.depthStencilAttachment=A,i.ownsColor=m,i.ownsDepthStencil=E,a.color=d.map(N),a.depth=N(k),a.stencil=N(_),a.depthStencil=N(A),Y(i),a.width=i.width,a.height=i.height,a}var i=new V;return a(r),a._reglType="framebuffer",a._framebuffer=i,a._destroy=function(){$(i)},a}function J(){a(ge).forEach(Y)}function Q(){a(ge).forEach($)}function Z(){if(ye){var r=ve[ve.length-1],n=t.webgl_draw_buffers;r?(e.bindFramebuffer(s,r.framebuffer),n&&n.drawBuffersWEBGL(me[r.colorAttachments.length])):(e.bindFramebuffer(s,null),n&&n.drawBuffersWEBGL(L)),ye=!1}}function ee(){return ve[ve.length-1]}var te={};te[O]="complete",te[B]="incomplete attachment",te[D]="incomplete dimensions",te[F]="incomplete, missing attachment",te[P]="unsupported";var re={rgba:v},ne={rgba4:y,rgb565:w,"rgb5 a1":x};t.ext_srgb&&(ne.srgba=j),t.ext_color_buffer_half_float&&(ne.rgba16f=T,ne.rgb16f=C),t.webgl_color_buffer_float&&(ne.rgba32f=S);var ae=[k],ie=[_],se=[E],oe=[],fe=[],ce=[];t.webgl_depth_texture&&(oe.push(A),ce.push(E));var ue=i(i({},re),ne),le=a(re),pe=a(ne),he=m,de={uint8:m};t.oes_texture_half_float&&(he=de["half float"]=g),t.oes_texture_float&&(he=de.float=b),de.best=he;var me=function(){for(var e=new Array(r.maxDrawbuffers),t=0;t<=r.maxDrawbuffers;++t)for(var n=e[t]=new Array(t),a=0;a<t;++a)n[a]=l+a;return e}(),be=0,ge={},ve=[null],ye=!0;return{top:ee,dirty:function(){return ye},push:function(e){var t=e||null;return ye=ye||t!==ee(),ve.push(t),ye},pop:function(){var e=ee();return ve.pop(),ye=ye||e!==ee()},getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof V)return t}return null},poll:Z,create:K,clear:Q,refresh:J}}},{"./util/check":20,"./util/extend":23,"./util/values":31}],12:[function(e,t,r){var n=3408,a=3410,i=3411,s=3412,o=3413,f=3414,c=3415,u=33901,l=33902,p=3379,h=3386,d=34921,m=36347,b=36348,g=35661,v=35660,y=34930,x=36349,w=34076,k=34024,_=7936,A=7937,E=7938,j=35724,S=34047,T=36063,C=34852;t.exports=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(S));var O=1,B=1;return t.webgl_draw_buffers&&(O=e.getParameter(C),B=e.getParameter(T)),{colorBits:[e.getParameter(a),e.getParameter(i),e.getParameter(s),e.getParameter(o)],depthBits:e.getParameter(f),stencilBits:e.getParameter(c),subpixelBits:e.getParameter(n),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:O,maxColorAttachments:B,pointSizeDims:e.getParameter(u),lineWidthDims:e.getParameter(l),maxViewportDims:e.getParameter(h),maxCombinedTextureUnits:e.getParameter(g),maxCubeMapSize:e.getParameter(w),maxRenderbufferSize:e.getParameter(k),maxTextureUnits:e.getParameter(y),maxTextureSize:e.getParameter(p),maxAttributes:e.getParameter(d),maxVertexUniforms:e.getParameter(m),maxVertexTextureUnits:e.getParameter(v),maxVaryingVectors:e.getParameter(b),maxFragmentUniforms:e.getParameter(x),glsl:e.getParameter(j),renderer:e.getParameter(A),vendor:e.getParameter(_),version:e.getParameter(E)}}},{}],13:[function(e,t,r){var n=e("./util/check"),a=e("./util/is-typed-array"),i=6408,s=5121,o=3333;t.exports=function(e,t,r){function f(f){var c=f||{};a(f)?c={data:c}:2===arguments.length?c={width:0|arguments[0],height:0|arguments[1]}:"object"!=typeof f&&(c={}),t();var u=c.x||0,l=c.y||0,p=c.width||r.width,h=c.height||r.height,d=p*h*4,m=c.data||new Uint8Array(d);return n.isTypedArray(m),n(m.byteLength>=d,"data buffer too small"),e.pixelStorei(o,4),e.readPixels(u,l,p,h,i,s,m),m}return f}},{"./util/check":20,"./util/is-typed-array":25}],14:[function(e,t,r){var n=e("./util/check"),a=e("./util/values"),i=36161,s=32854,o=32855,f=36194,c=33189,u=36168,l=34041,p=35907,h=34836,d=34842,m=34843;t.exports=function(e,t,r){function b(){this.id=_++,this.refCount=1,this.renderbuffer=null,this.format=s,this.width=0,this.height=0}function g(t){e.isRenderbuffer(t.renderbuffer)||(t.renderbuffer=e.createRenderbuffer()),e.bindRenderbuffer(i,t.renderbuffer),e.renderbufferStorage(i,t.format,t.width,t.height)}function v(t){var r=t.renderbuffer;n(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(i,null),e.isRenderbuffer(r)&&e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete A[t.id]}function y(e){function t(e){var i=e||{},o=0,f=0;if("shape"in i){var c=i.shape;n(Array.isArray(c)&&c.length>=2,"invalid renderbuffer shape"),o=0|c[0],f=0|c[1]}else"radius"in i&&(o=f=0|i.radius),"width"in i&&(o=0|i.width),"height"in i&&(f=0|i.height);var u=r.maxRenderbufferSize;if(n(o>=0&&f>=0&&o<=u&&f<=u,"invalid renderbuffer size"),t.width=a.width=Math.max(o,1),t.height=a.height=Math.max(f,1),a.format=s,"format"in i){var l=i.format;n.parameter(l,k,"invalid render buffer format"),a.format=k[l]}return g(a),t}var a=new b;return A[a.id]=a,t(e),t._reglType="renderbuffer",t._renderbuffer=a,t.destroy=function(){a.decRef()},t}function x(){a(A).forEach(g)}function w(){a(A).forEach(v)}var k={rgba4:s,rgb565:f,"rgb5 a1":o,depth:c,stencil:u,"depth stencil":l};t.ext_srgb&&(k.srgba=p),t.ext_color_buffer_half_float&&(k.rgba16f=d,k.rgb16f=m),t.webgl_color_buffer_float&&(k.rgba32f=h);var _=0,A={};return b.prototype.decRef=function(){0===--this.refCount&&v(this)},{create:y,refresh:x,clear:w}}},{"./util/check":20,"./util/values":31}],15:[function(e,t,r){function n(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}var a=e("./util/check"),i=e("./util/values"),s=35632,o=35633,f=35718,c=35721;t.exports=function(e,t,r,u,l){function p(t,r){var n=t===s?m:b,i=n[r];if(!i){var o=l.str(r);i=e.createShader(t),e.shaderSource(i,o),e.compileShader(i),a.shaderError(e,i,o,t),n[r]=i}return i}function h(e,t){this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.draw=function(){},this.batchCache={}}function d(i){var h,d,m=p(s,i.fragId),b=p(o,i.vertId),g=i.program=e.createProgram();e.attachShader(g,m),e.attachShader(g,b),e.linkProgram(g),a.linkError(e,g,l.str(i.fragId),l.str(i.vertId));var v=e.getProgramParameter(g,f),y=i.uniforms=[];for(h=0;h<v;++h)if(d=e.getActiveUniform(g,h))if(d.size>1)for(var x=0;x<d.size;++x){var w=d.name.replace("[0]","["+x+"]");r.def(w),y.push(new n(w,l.id(w),e.getUniformLocation(g,w),d))}else r.def(d.name),y.push(new n(d.name,l.id(d.name),e.getUniformLocation(g,d.name),d));var k=e.getProgramParameter(g,c),_=i.attributes=[];for(h=0;h<k;++h)d=e.getActiveAttrib(g,h),d&&(t.def(d.name),_.push(new n(d.name,l.id(d.name),e.getAttribLocation(g,d.name),d)));i.draw=u(i),i.batchCache={}}var m={},b={},g={},v=[],y=[-1],x=[-1];return{clear:function(){var t=e.deleteShader.bind(e);i(m).forEach(t),m={},i(b).forEach(t),b={},v.forEach(function(t){e.deleteProgram(t.program)}),v.length=0,g={}},refresh:function(){m={},b={},v.forEach(d)},program:function(e,t){a(e>=0,"missing vertex shader"),a(t>=0,"missing fragment shader");var r=g[t];r||(r=g[t]={});var n=r[e];return n||(n=new h(t,e),d(n),r[e]=n,v.push(n)),n},shader:p,frag:y,vert:x}}},{"./util/check":20,"./util/values":31}],16:[function(e,t,r){var n=e("./util/stack"),a=e("./util/codegen"),i=2884,s=3042,o=3024,f=2960,c=2929,u=3089,l=32823,p=32926,h=32928,d=32774,m=0,b=1,g=1028,v=1029,y=513,x=2305,w=519,k=7680;t.exports=function(e,t,r){function _(t,r){var a=n([!!r],function(r){r?e.enable(t):e.disable(t)});return a.flag=t,a}var A={dither:_(o),"blend.enable":_(s),"blend.color":n([0,0,0,0],function(t,r,n,a){e.blendColor(t,r,n,a)}),"blend.equation":n([d,d],function(t,r){e.blendEquationSeparate(t,r)}),"blend.func":n([b,m,b,m],function(t,r,n,a){e.blendFuncSeparate(t,r,n,a)}),"depth.enable":_(c,!0),"depth.func":n([y],function(t){e.depthFunc(t)}),"depth.range":n([0,1],function(t,r){e.depthRange(t,r)}),"depth.mask":n([!0],function(t){e.depthMask(t)}),"cull.enable":_(i),"cull.face":n([v],function(t){e.cullFace(t)}),frontFace:n([x],function(t){e.frontFace(t)}),colorMask:n([!0,!0,!0,!0],function(t,r,n,a){e.colorMask(t,r,n,a)}),lineWidth:n([1],function(t){e.lineWidth(t)}),"polygonOffset.enable":_(l),"polygonOffset.offset":n([0,0],function(t,r){e.polygonOffset(t,r)}),"sample.alpha":_(p),"sample.enable":_(h),"sample.coverage":n([1,!1],function(t,r){e.sampleCoverage(t,r)}),"stencil.enable":_(f),"stencil.mask":n([-1],function(t){e.stencilMask(t)}),"stencil.func":n([w,0,-1],function(t,r,n){e.stencilFunc(t,r,n)}),"stencil.opFront":n([k,k,k],function(t,r,n){e.stencilOpSeparate(g,t,r,n)}),"stencil.opBack":n([k,k,k],function(t,r,n){e.stencilOpSeparate(v,t,r,n)}),"scissor.enable":_(u),"scissor.box":n([0,0,-1,-1],function(r,n,a,i){var s=a,o=t.top();a<0&&(s=o?o.width-r:e.drawingBufferWidth-r);var f=i;i<0&&(f=o?o.height-n:e.drawingBufferHeight-n),e.scissor(r,n,s,f)}),viewport:n([0,0,-1,-1],function(n,a,i,s){var o=i,f=t.top();i<0&&(o=f?f.width-n:e.drawingBufferWidth-n);var c=s;s<0&&(c=f?f.height-a:e.drawingBufferHeight-a),e.viewport(n,a,o,c),r.width=o,r.height=c})},E=a(),j=E.proc("poll"),S=E.proc("refresh");Object.keys(A).forEach(function(e){var t=E.link(A[e]);j(t,".poll();"),S(t,".setDirty();")});var T=E.compile();return{contextState:A,viewport:r,poll:T.poll,refresh:T.refresh,notifyViewportChanged:function(){A.viewport.setDirty(),A["scissor.box"].setDirty()}}}},{"./util/codegen":22,"./util/stack":29}],17:[function(e,t,r){t.exports=function(){var e={"":0},t=[""];return{id:function(r){var n=e[r];return n?n:(n=e[r]=t.length,t.push(r),n)},str:function(e){return t[e]}}}},{}],18:[function(e,t,r){function n(e){return!(e&e-1||!e)}function a(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function i(e){if(!Array.isArray(e))return!1;var t=e.length;if(0===t||!Array.isArray(e[0]))return!1;for(var r=e[0].length,n=1;n<t;++n)if(!Array.isArray(e[n])||e[n].length!==r)return!1;return!0}function s(e){return Object.prototype.toString.call(e)}function o(e){return"[object HTMLCanvasElement]"===s(e)}function f(e){return"[object CanvasRenderingContext2D]"===s(e)}function c(e){return"[object HTMLImageElement]"===s(e)}function u(e){return"[object HTMLVideoElement]"===s(e)}function l(e){return"[object XMLHttpRequest]"===s(e)}function p(e){return"string"==typeof e||!!e&&(g(e)||a(e)||v(e)||o(e)||f(e)||c(e)||u(e)||i(e))}function h(e,t,r,n,a,i,s,o){for(var f=new e.constructor(t*r*n),c=0,u=0;u<r;++u)for(var l=0;l<t;++l)for(var p=0;p<n;++p)f[c++]=e[i*u+a*l+s*p+o];return f}var d=e("./util/check"),m=e("./util/extend"),b=e("./util/values"),g=e("./util/is-typed-array"),v=e("./util/is-ndarray"),y=e("./util/load-texture"),x=e("./util/to-half-float"),w=e("./util/parse-dds"),k=34467,_=3553,A=34067,E=34069,j=6408,S=6406,T=6407,C=6409,O=6410,B=32854,F=32855,D=36194,P=32819,R=32820,L=33635,I=34042,M=6402,z=34041,U=35904,H=35906,W=36193,q=33776,G=33777,N=33778,V=33779,Y=35986,X=35987,$=34798,K=35840,J=35841,Q=35842,Z=35843,ee=36196,te=5121,re=5123,ne=5125,ae=5126,ie=10242,se=10243,oe=10497,fe=33071,ce=33648,ue=10240,le=10241,pe=9728,he=9729,de=9984,me=9985,be=9986,ge=9987,ve=33170,ye=4352,xe=4353,we=4354,ke=34046,_e=3317,Ae=37440,Ee=37441,je=37443,Se=37444,Te=33984,Ce=[de,be,me,ge];t.exports=function(e,t,r,s,Oe){function Be(e){this.target=e,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=1,this.colorSpace=0,this.width=0,this.height=0,this.channels=0,this.format=0,this.internalformat=0,this.type=0,this.compressed=!1,this.miplevel=0,this.strideX=0,this.strideY=0,this.strideC=0,this.offset=0,this.x=0,this.y=0,this.copy=!1,this.data=null,this.image=null,this.video=null,this.canvas=null,this.xhr=null,this.crossOrigin=null,this.needsPoll=!1,this.needsListeners=!1}function Fe(e){this.target=e,this.width=0,this.height=0,this.format=0,this.internalformat=0,this.type=0,this.wrapS=fe,this.wrapT=fe,this.minFilter=0,this.magFilter=pe,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ye}function De(e,r){var a,i,s=0,o=0,f=0,c=0,u=0,l=0,p=!1,h=!1,m=!1,b=0,g=[0,0,0,0,0,0],v=0,y=!1;for(a=0;a<r.length;++a){i=r[a],c=c||i.width<<i.miplevel,u=u||i.height<<i.miplevel,s=s||i.type,o=o||i.format,f=f||i.internalformat,l=l||i.channels,h=h||i.needsPoll,m=m||i.needsListeners,p=p||i.compressed;var x=i.miplevel,w=i.target;if(y=y||x>0,w===_)b|=1<<x;else{var k=w-E;g[k]|=1<<x,v|=1<<k}}e.needsPoll=h,e.needsListeners=m,e.width=c,e.height=u,e.format=o,e.internalformat=f,e.type=s;var A=y?(c<<1)-1:1;if(e.target===_)d(0===v,"pixmap type must not contain cubemap faces"),d(b===A,"missing mip map data");else for(d(63===v,"missing cubemap faces"),a=0;a<6;++a)d(g[a]===A,"missing mip map data");var S=Ce.indexOf(e.minFilter)>=0;e.genMipmaps=!y&&(e.genMipmaps||S);var T=y||e.genMipmaps;for(e.minFilter?d(T===S,"min filter inconsistent with mipmap data"):e.minFilter=T?ge:pe,T&&d(c===u&&n(c),"must be a square power of 2 to support mipmaps"),e.genMipmaps&&d(!p,"mipmap generation not supported for compressed textures"),e.wrapS=e.wrapS||fe,e.wrapT=e.wrapT||fe,e.wrapS===fe&&e.wrapT===fe||d(n(c)&&n(u)&&!v,"incompatible size for wrap mode, image must be a power of 2"),(s===ae&&!t.oes_texture_float_linear||s===W&&!t.oes_texture_half_float_linear)&&d(this.magFilter===pe&&this.minFilter===pe,"unsupported filter mode for float texture"),a=0;a<r.length;++a){i=r[a];var C=i.miplevel;i.width&&d(i.width<<C===c,"inconsistent width"),i.height&&d(i.height<<C===u,"inconsistent width"),i.channels?d(i.channels===l,"inconsistent channels"):i.channels=l,i.format?d(i.format===o,"inconsistent format"):i.format=o,i.internalformat?d(i.internalformat===f,"inconsistent internalformat"):i.internalformat=f,i.type?d(i.type===s,"inconsistent type"):i.type=s,i.copy&&d(i.type===te&&i.internalformat===j,"incompatible format/type for copyTexImage2D")}}function Pe(e){this.id=rt++,this.refCount=1,this.target=e,this.texture=null,this.pollId=-1,this.unit=-1,this.bindCount=0,this.cancelPending=null,this.params=new Fe(e),this.pixels=[]}function Re(e,t){function r(e,r){var n,a=r.mipmap;if(Array.isArray(a))for(var s=0;s<a.length;++s)n=new Be(e),n.parseFlags(t),n.parseFlags(r),n.parse(a[s],s),i.push(n);else n=new Be(e),n.parseFlags(t),n.parse(r,0),i.push(n)}var n;Me(e);var a=e.params;Fe.call(a,e.target);var i=e.pixels;if(i.length=0,a.parse(t),e.target===_)r(_,t);else{var s=t.faces||t;if(Array.isArray(s))for(d(6===s.length,"invalid number of faces in cube map"),n=0;n<6;++n)r(E+n,s[n]);else if("string"==typeof s);else for(n=0;n<6;++n)r(E+n,{})}De(a,i),a.needsListeners&&Ie(e),a.needsPoll&&(e.pollId=at.length,at.push(e)),Le(e)}function Le(t){e.isTexture(t.texture)||(t.texture=e.createTexture());var r=t.target,n=t.unit;n>=0?(e.activeTexture(Te+n),tt=n):e.bindTexture(r,t.texture);for(var a=t.pixels,i=t.params,s=0;s<a.length;++s)a[s].upload(i);if(i.upload(),n<0){var o=st[tt];o?e.bindTexture(o.target,o.texture):(t.unit=tt,st[tt]=t)}}function Ie(e){function t(t,r,n){var i=w(n);d(i.format in et,"unsupported dds texture format"),i.cube?(d(e.target===A),d.raise("cube map DDS not yet implemented")):d(e.target===_),r&&d(1===i.pixels.length,"number of mip levels inconsistent"),i.pixels.forEach(function(e){var n=new Be(i.cube?e.target:t);n.channels=i.channels,n.compressed=i.compressed,n.type=i.type,n.internalformat=i.format,n.format=et[i.format],n.width=e.width,n.height=e.height,n.miplevel=e.miplevel||r,n.data=e.data,a.push(n)})}function r(){for(var r=0;r<a.length;++r){var i=a[r],s=i.image,o=i.video,f=i.xhr;s&&s.complete?(i.width=s.naturalWidth,i.height=s.naturalHeight):o&&o.readyState>2?(i.width=o.width,i.height=o.height):f&&4===f.readyState&&(a[r]=a[a.length-1],a.pop(),f.removeEventListener("readystatechange",Le),t(i.target,i.miplevel,f.response))}De(n,a),Le(e)}var n=e.params,a=e.pixels;a.forEach(function(e){e.image&&!e.image.complete?e.image.addEventListener("load",r):e.video&&e.readyState<1?e.video.addEventListener("progress",r):e.xhr&&e.xhr.addEventListener("readystatechange",r)}),e.cancelPending=function(){a.forEach(function(e){e.image?e.image.removeEventListener("load",r):e.video?e.video.removeEventListener("progress",r):e.xhr&&(e.xhr.removeEventListener("readystatechange",r),e.xhr.abort())})}}function Me(e){var t=e.cancelPending;t&&(t(),e.cancelPending=null);var r=e.pollId;if(r>=0){var n=at[r]=at[at.length-1];n.id=r,at.pop(),e.pollId=-1}}function ze(t){var r=t.texture;d(r,"must not double destroy texture");var n=t.unit,a=t.target;n>=0&&(e.activeTexture(Te+n),tt=n,e.bindTexture(a,null),st[n]=null),Me(t),e.isTexture(r)&&e.deleteTexture(r),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete nt[t.id]}function Ue(e,t){function r(e,a,i,s,o,f){var c=e||{};return t===A&&6===arguments.length&&(c=[e,a,i,s,o,f]),Re(n,c),r.width=n.params.width,r.height=n.params.height,r}var n=new Pe(t);return nt[n.id]=n,r(e),r._reglType="texture",r._texture=n,r.destroy=function(){n.decRef()},r}function He(){b(nt).forEach(Le);for(var t=0;t<it;++t)st[t]=null;tt=0,e.activeTexture(Te)}function We(){for(var t=0;t<it;++t)e.activeTexture(Te+t),e.bindTexture(_,null),st[t]=null;e.activeTexture(Te),tt=0,b(nt).forEach(ze)}function qe(){at.forEach(Le)}var Ge={"don't care":ye,"dont care":ye,nice:we,fast:xe},Ne={repeat:oe,clamp:fe,mirror:ce},Ve={nearest:pe,linear:he},Ye=m({"nearest mipmap nearest":de,"linear mipmap nearest":me,"nearest mipmap linear":be,"linear mipmap linear":ge,mipmap:ge},Ve),Xe={none:0,browser:Se},$e={uint8:te,rgba4:P,rgb565:L,"rgb5 a1":R},Ke={alpha:S,luminance:C,"luminance alpha":O,rgb:T,rgba:j,rgba4:B,"rgb5 a1":F,rgb565:D},Je={};t.ext_srgb&&(Ke.srgb=U,Ke.srgba=H),t.oes_texture_float&&($e.float=ae),t.oes_texture_half_float&&($e["half float"]=W),t.webgl_depth_texture&&(m(Ke,{depth:M,"depth stencil":z}),m($e,{uint16:re,uint32:ne,"depth stencil":I})),t.webgl_compressed_texture_s3tc&&m(Je,{"rgb s3tc dxt1":q,"rgba s3tc dxt1":G,"rgba s3tc dxt3":N,"rgba s3tc dxt5":V}),t.webgl_compressed_texture_atc&&m(Je,{"rgb arc":Y,"rgba atc explicit alpha":X,"rgba atc interpolated alpha":$}),t.webgl_compressed_texture_pvrtc&&m(Je,{"rgb pvrtc 4bppv1":K,"rgb pvrtc 2bppv1":J,"rgba pvrtc 4bppv1":Q,"rgba pvrtc 2bppv1":Z}),t.webgl_compressed_texture_etc1&&(Je["rgb etc1"]=ee);var Qe=Array.prototype.slice.call(e.getParameter(k));Object.keys(Je).forEach(function(e){var t=Je[e];Qe.indexOf(t)>=0&&(Ke[e]=t)});var Ze=Object.keys(Ke);r.textureFormats=Ze;var et=Ze.reduce(function(e,t){var r=Ke[t];return r===C||r===S||r===C||r===O||r===M||r===z?e[r]=r:r===F||t.indexOf("rgba")>=0?e[r]=j:e[r]=T,e},{});m(Be.prototype,{parseFlags:function(e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(d.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),this.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(d.type(e.flipY,"boolean","invalid texture flip"),this.flipY=e.flipY),"alignment"in e&&(d.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),this.unpackAlignment=e.alignment),"colorSpace"in e&&(d.parameter(e.colorSpace,Xe,"invalid colorSpace"),this.colorSpace=Xe[e.colorSpace]),"format"in e){var t=e.format;d.parameter(t,Ke,"invalid texture format"),this.internalformat=Ke[t],t in $e&&(this.type=$e[t]),t in Je&&(this.compressed=!0)}if("type"in e){var r=e.type;d.parameter(r,$e,"invalid texture type"),this.type=$e[r]}var n=this.width,a=this.height,i=this.channels;if("shape"in e?(d(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),n=e.shape[0],a=e.shape[1],3===e.shape.length&&(i=e.shape[2])):("radius"in e&&(n=a=e.radius),"width"in e&&(n=e.width),"height"in e&&(a=e.height),"channels"in e&&(i=e.channels)),this.width=0|n,this.height=0|a,this.channels=0|i,"stride"in e){var s=e.stride;d(Array.isArray(s)&&s.length>=2,"invalid stride vector"),this.strideX=s[0],this.strideY=s[1],3===s.length?this.strideC=s[2]:this.strideC=1,this.needsTranspose=!0}else this.strideC=1,this.strideX=this.strideC*i,this.strideY=this.strideX*n;"offset"in e&&(this.offset=0|e.offset,this.needsTranspose=!0),"crossOrigin"in e&&(this.crossOrigin=e.crossOrigin)}},parse:function(e,r){this.miplevel=r,this.width=this.width>>r,this.height=this.height>>r;var n=e;switch(typeof e){case"string":break;case"object":if(!e)return;this.parseFlags(e),p(e.data)&&(n=e.data);break;case"undefined":return;default:d.raise("invalid pixel data type")}"string"==typeof n&&(n=y(n,this.crossOrigin));var s=null,m=!1;if(this.compressed&&d(n instanceof Uint8Array||l(n),"compressed texture data must be stored in a uint8array"),null===n);else if(g(n))this.data=n;else if(a(n))s=n,m=!0;else if(v(n)){Array.isArray(n.data)?(s=n.data,m=!0):this.data=n.data;var b=n.shape;this.width=b[0],this.height=b[1],3===b.length?this.channels=b[2]:this.channels=1;var w=n.stride;this.strideX=n.stride[0],this.strideY=n.stride[1],3===w.length?this.strideC=n.stride[2]:this.strideC=1,this.offset=n.offset,this.needsTranspose=!0}else if(o(n)||f(n))o(n)?this.canvas=n:this.canvas=n.canvas,this.width=this.canvas.width,this.height=this.canvas.height,this.setDefaultFormat();else if(c(n))this.image=n,n.complete?(this.width=n.naturalWidth,this.height=n.naturalHeight):(this.width=this.width||n.naturalWidth,this.height=this.height||n.naturalHeight,this.needsListeners=!0),this.setDefaultFormat();else if(u(n))this.video=n,n.readyState>1?(this.width=n.width,this.height=n.height):(this.width=this.width||n.width,this.height=this.height||n.height,this.needsListeners=!0),this.needsPoll=!0,this.setDefaultFormat();else if(l(n))this.xhr=n,this.needsListeners=!0;else if(i(n)){var k,_,A,E,B=n[0].length,F=n.length,D=1;if(Array.isArray(n[0][0]))for(D=n[0][0].length,d(D>=0&&D<=4,"invalid number of channels for image data"),s=Array(B*F*D),E=0,_=0;_<F;++_)for(k=0;k<B;++k)for(A=0;A<D;++A)s[E++]=n[_][k][A];else for(s=Array(B*F),E=0,_=0;_<F;++_)for(k=0;k<B;++k)s[E++]=n[_][k];this.width=B,this.height=F,this.channels=D,m=!0}else e.copy&&(this.copy=!0,this.x=0|this.x,this.y=0|this.y,this.width=0|(this.width||Oe.width),this.height=0|(this.height||Oe.height),this.setDefaultFormat());if(!this.type&&this.data&&(this.format===M?this.data instanceof Uint16Array?this.type=re:this.data instanceof Uint32Array&&(this.type=ne):this.data instanceof Float32Array&&(this.type=ae)),!this.internalformat){var U=this.channels=this.channels||4;this.internalformat=[C,O,T,j][U-1],d(this.internalformat,"invalid number of channels")}var H=this.internalformat;H!==M&&H!==z||(d(t.webgl_depth_texture,"depth/stencil texture not supported"),H===M&&d(this.type===re||ne,"depth texture type must be uint16 or uint32"),H===z&&d(this.type===I,"depth stencil texture format must match type"),d(!(this.data||s||this.image||this.video||this.canvas),"depth/stencil textures are for rendering only"));var q=this.format=et[H];if(!this.channels)switch(q){case C:case S:case M:this.channels=1;break;case z:case O:this.channels=2;break;case T:this.channels=3;break;default:this.channels=4}var G=this.type;if(G===ae?d(t.oes_texture_float,"float texture not supported"):G===W?d(t.oes_texture_half_float,"half float texture not supported"):G||(G=H===M?ne:te),this.type=G,m)switch(G){case te:this.data=new Uint8Array(s);break;case re:this.data=new Uint16Array(s);break;case ne:this.data=new Uint32Array(s);break;case ae:this.data=new Float32Array(s);break;case W:this.data=x(s);break;case L:case R:case P:case I:d.raise("unsupported format for automatic conversion");break;default:d.raise("unsupported type conversion")}if(this.data)switch(this.needsTranspose&&(this.data=h(this.data,this.width,this.height,this.channels,this.strideX,this.strideY,this.strideC,this.offset)),G){case te:d(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray,"incompatible pixel type");break;case L:case R:case P:case re:case W:d(this.data instanceof Uint16Array,"incompatible pixel type");break;case ne:d(this.data instanceof Uint32Array,"incompatible pixel type");break;case ae:d(this.data instanceof Float32Array,"incompatible pixel type");break;default:d.raise("bad or missing pixel type")}this.needsTranspose=!1},setDefaultFormat:function(){this.format=this.internalformat=j,this.type=te,this.channels=4,this.compressed=!1},upload:function(t){e.pixelStorei(Ae,this.flipY),e.pixelStorei(Ee,this.premultiplyAlpha),e.pixelStorei(je,this.colorSpace),e.pixelStorei(_e,this.unpackAlignment);var r=this.target,n=this.miplevel,a=this.image,i=this.canvas,o=this.video,f=this.data,c=this.internalformat,u=this.format,l=this.type,p=this.width||Math.max(1,t.width>>n),h=this.height||Math.max(1,t.height>>n);o&&o.readyState>2?e.texImage2D(r,n,u,u,l,o):a&&a.complete?e.texImage2D(r,n,u,u,l,a):i?e.texImage2D(r,n,u,u,l,i):this.compressed?e.compressedTexImage2D(r,n,c,p,h,0,f):this.copy?(s(),e.copyTexImage2D(r,n,u,this.x,this.y,p,h,0)):f?e.texImage2D(r,n,u,p,h,0,u,l,f):e.texImage2D(r,n,u,p||1,h||1,0,u,l,null)}}),m(Fe.prototype,{parse:function(e){if("object"==typeof e&&e){if("min"in e){var t=e.min;d.parameter(t,Ye),this.minFilter=Ye[t]}if("mag"in e){var n=e.mag;d.parameter(n,Ve),this.magFilter=Ve[n]}var a=this.wrapS,i=this.wrapT;if("wrap"in e){var s=e.wrap;"string"==typeof s?(d.parameter(s,Ne),a=i=Ne[s]):Array.isArray(s)&&(d.parameter(s[0],Ne),d.parameter(s[1],Ne),a=Ne[s[0]],i=Ne[s[1]])}else{if("wrapS"in e){var o=e.wrapS;d.parameter(o,Ne),a=Ne[o]}if("wrapT"in e){var f=e.wrapT;d.parameter(f,Ne),i=Ne[f]}}if(this.wrapS=a,this.wrapT=i,"anisotropic"in e){var c=e.anisotropic;d("number"==typeof c&&c>=1&&c<=r.maxAnisotropic,"aniso samples must be between 1 and "),this.anisotropic=e.anisotropic}if("mipmap"in e){var u=e.mipmap;switch(typeof u){case"string":d.parameter(u,Ge,"invalid mipmap hint"),this.mipmapHint=Ge[u],this.genMipmaps=!0;break;case"boolean":this.genMipmaps=!!u;break;case"object":break;default:d.raise("invalid mipmap type")}}}},upload:function(){var r=this.target;e.texParameteri(r,le,this.minFilter),e.texParameteri(r,ue,this.magFilter),e.texParameteri(r,ie,this.wrapS),e.texParameteri(r,se,this.wrapT),t.ext_texture_filter_anisotropic&&e.texParameteri(r,ke,this.anisotropic),this.genMipmaps&&(e.hint(ve,this.mipmapHint),e.generateMipmap(r))}});var tt=0,rt=0,nt={},at=[],it=r.maxTextureUnits,st=Array(it).map(function(){return null});return m(Pe.prototype,{bind:function(){var t=this;t.bindCount+=1;var r=t.unit;if(r<0){for(var n=0;n<it;++n){var a=st[n];if(a){if(a.bindCount>0)continue;a.unit=-1}st[n]=t,r=n;break}r>=it&&d.raise("insufficient number of texture units"),t.unit=r,e.activeTexture(Te+r),e.bindTexture(t.target,t.texture),tt=r}return r},unbind:function(){this.bindCount-=1},decRef:function(){0===--this.refCount&&ze(this)}}),{create:Ue,refresh:He,clear:We,poll:qe,getTexture:function(e){return null}}}},{"./util/check":20,"./util/extend":23,"./util/is-ndarray":24,"./util/is-typed-array":25,"./util/load-texture":26,"./util/parse-dds":27,"./util/to-half-float":30,"./util/values":31}],19:[function(e,t,r){t.exports=function(e){function t(t){var n=e.id(t),a=r[n];return a||(a=r[n]=[]),a}var r={};return{def:t,uniforms:r}}},{}],20:[function(e,t,r){function n(e){return"undefined"!=typeof btoa?btoa(e):"base64:"+e}function a(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||a(t)}function s(e){return e?": "+e:""}function o(e,t,r){e in t||a("unknown parameter ("+e+")"+s(r)+". possible values: "+Object.keys(t).join())}function f(e,t){j(e)||a("invalid parameter type"+s(t)+". must be a typed array")}function c(e,t,r){typeof e!==t&&a("invalid parameter type"+s(r)+". expected "+t+", got "+typeof e)}function u(e,t){e>=0&&(0|e)===e||a("invalid parameter type, ("+e+")"+s(t)+". must be a nonnegative integer")}function l(e,t,r){t.indexOf(e)<0&&a("invalid value"+s(r)+". must be one of: "+t)}function p(e,t){for(e+="";e.length<t;)e=" "+e;return e}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function d(e,t){this.number=e,this.line=t,this.errors=[]}function m(e,t,r){this.file=e,this.line=t,this.message=r}function b(){var e=new Error,t=e.stack,r=/at compileProcedure.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at compileProcedure.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function g(){var e=new Error,t=e.stack,r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function v(e){var t=e.split("\n"),r=1,a=0,i={unknown:new h,0:new h};i.unknown.name=i[0].name=b(),i.unknown.lines.push(new d(0,""));for(var s=0;s<t.length;++s){var o=t[s],f=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(o);if(f)switch(f[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(f[2]);c&&(r=0|c[1],c[2]&&(a=0|c[2],a in i||(i[a]=new h)));break;case"define":var u=/SHADER_NAME(_B64)?\s+(.*)$/.exec(f[2]);u&&(i[a].name=u[1]?n(u[2]):u[2])}i[a].lines.push(new d(r++,o))}return Object.keys(i).forEach(function(e){var t=i[e];t.lines.forEach(function(e){t.index[e.number]=e})}),i}function y(e){var t=[];return e.split("\n").forEach(function(e){var r=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);r?t.push(new m(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new m("unknown",0,e))}),t}function x(e,t){t.forEach(function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}function w(e,t,r,n){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t),s=n===e.FRAGMENT_SHADER?"fragment":"vertex",o=v(r),f=y(a);x(o,f),Object.keys(o).forEach(function(e){function t(e,t){n.push(e),a.push(t||"")}var r=o[e];if(r.hasErrors){var n=[""],a=[""];t("file number "+e+": "+r.name+"\n","color:red;text-decoration:underline;font-weight:bold"),r.lines.forEach(function(e){if(e.errors.length>0){t(p(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),t(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var r=0;e.errors.forEach(function(n){var a=n.message,i=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(a);if(i){var s=i[1];switch(a=i[2],s){case"assign":s="="}r=Math.max(e.line.indexOf(s,r),0)}else r=0;t(p("| ",6)),t(p("^^^",r+3)+"\n","font-weight:bold"),t(p("| ",6)),t(a+"\n","font-weight:bold")}),t(p("| ",6)+"\n")}else t(p(e.number,4)+"|  "),t(e.line+"\n","color:red")}),"undefined"!=typeof document?(a[0]=n.join("%c"),
console.log.apply(console,a)):console.log(n.join(""))}}),i.raise("Error compiling "+s+" shader, "+o[0].name)}}function k(e,t,r,n){if(!e.getProgramParameter(t,e.LINK_STATUS)){var a=e.getProgramInfoLog(t),s=v(r),o=v(n),f='Error linking program with vertex shader, "'+o[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+f+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+"\n"+a),i.raise(f)}}function _(e){e._commandRef=b()}function A(e,t,r,n){function a(e){return e?n.id(e):0}function i(e,t){Object.keys(t).forEach(function(t){e[n.id(t)]=!0})}_(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var s=e._uniformSet={};i(s,t.static),i(s,t.dynamic);var o=e._attributeSet={};i(o,r.static),i(o,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function E(e,t,r,n,i,s,o,f,c,u){var l,p;!u&&e.count[e.count.length-1]<0&&a("missing vertex count in command "+i+" - called from "+g());var h=t.program(o||t.vert[t.vert.length-1],s||t.frag[t.frag.length-1]),d=h.uniforms;for(l=0;l<d.length;++l)p=d[l].id,!f[p]&&r.uniforms[p].length<=0&&a('missing uniform "'+d[l].name+'" in command '+i+" called from "+g());var m=h.attributes;for(l=0;l<m.length;++l)p=m[l].id,!c[p]&&n.state[p].records.length<=0&&a('missing attribute "'+m[l].name+'" in command '+i+" called from "+g())}var j=e("./is-typed-array"),S=e("./extend");t.exports=S(i,{raise:a,parameter:o,type:c,isTypedArray:f,nni:u,oneOf:l,shaderError:w,linkError:k,callSite:g,saveCommandRef:_,drawOk:E,saveDrawInfo:A})},{"./extend":23,"./is-typed-array":25}],21:[function(e,t,r){t.exports="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],22:[function(e,t,r){function n(e){return Array.prototype.slice.call(e)}var a=e("./extend");t.exports=function(){function e(e){var t="g"+s++;return o.push(t),f.push(e),t}function t(){function e(){r.push.apply(r,n(arguments))}function t(){var e="v"+s++;return i.push(e),arguments.length>0&&(r.push(e,"="),r.push.apply(r,n(arguments)),r.push(";")),e}var r=[],i=[];return a(e,{def:t,toString:function(){return[i.length>0?"var "+i+";":"",r.join("")].join("")}})}function r(e){function r(){var e="a"+s++;return n.push(e),e}var n=[],i=t(),o=i.toString,f=c[e]=a(i,{arg:r,toString:function(){return["function(",n.join(),"){",o(),"}"].join("")}});return f}function i(){var e=['"use strict";return {'];Object.keys(c).forEach(function(t){e.push('"',t,'":',c[t].toString(),",")}),e.push("}");var t=Function.apply(null,o.concat([e.join("")]));return t.apply(null,f)}var s=0,o=[],f=[],c={};return{link:e,block:t,proc:r,compile:i}}},{"./extend":23}],23:[function(e,t,r){t.exports=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e}},{}],24:[function(e,t,r){var n=e("./is-typed-array");t.exports=function(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||n(e.data))}},{"./is-typed-array":25}],25:[function(e,t,r){var n=e("../constants/arraytypes.json");t.exports=function(e){return Object.prototype.toString.call(e)in n}},{"../constants/arraytypes.json":4}],26:[function(e,t,r){function n(e){var t=/\.(\w+)(\?.*)?$/.exec(e);if(t&&t[1])return t[1].toLowerCase()}function a(e){return["avi","asf","gifv","mov","qt","yuv","mpg","mpeg","m2v","mp4","m4p","m4v","ogg","ogv","vob","webm","wmv"].indexOf(e)>=0}function i(e){return["dds"].indexOf(e)>=0}function s(e,t){var r=document.createElement("video");return r.autoplay=!0,r.loop=!0,t&&(r.crossOrigin=t),r.src=e,r}function o(e,t,r){var n=new XMLHttpRequest;return n.responseType="arraybuffer",n.open("GET",e,!0),n.send(),n}function f(e,t){var r=new Image;return t&&(r.crossOrigin=t),r.src=e,r}function c(e,t){if("undefined"!=typeof document){var r=n(e);return a(r)?s(e,t):i(r)?o(e,r,t):f(e,t)}return null}t.exports=c},{}],27:[function(e,t,r){function n(e){function t(t){for(var r=b,n=g,a=0;a<M;++a){var i=Math.max(1,r+3>>2)*Math.max(1,n+3>>2)*x;U.pixels.push({target:t,miplevel:a,width:r,height:n,data:new Uint8Array(e,z,i)}),z+=i,r>>=1,n>>=1}}var r=new Int32Array(e);a(r[0]===i,"invalid magic number for dds header");var n=r[O];a(n&_,"unsupported dds format");var b=r[F],g=r[B],v=h,y=0,x=0,w=4;switch(r[R]){case E:x=8,n&A?(w=3,y=f):y=c;break;case j:x=16,y=u;break;case S:x=16,y=l;break;case T:x=8,y=p;break;default:a.raise("unsupported dds texture format")}var I=r[P],M=1;I&d&&(M=Math.max(1,r[D]));var z=r[C]+4,U={width:b,height:g,channels:w,format:y,type:v,compressed:!0,cube:!1,pixels:[]},H=r[L],W=!!(H&m);if(W){a((H&k)===k,"missing cubemap faces"),U.cube=!0;for(var q=0;q<6;++q)t(o+q)}else t(s);return U}var a=e("./check");t.exports=n;var i=542327876,s=3553,o=34069,f=33776,c=33777,u=33778,l=33779,p=36196,h=5121,d=131072,m=512,b=1024,g=2048,v=4096,y=8192,x=16384,w=32768,k=b|g|v|y|x|w,_=4,A=64,E=827611204,j=861165636,S=894720068,T=826496069,C=1,O=2,B=3,F=4,D=7,P=20,R=21,L=28},{"./check":20}],28:[function(e,t,r){"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?t.exports={next:function(e){return requestAnimationFrame(e)},cancel:function(e){return cancelAnimationFrame(e)}}:t.exports={next:function(e){setTimeout(e,30)},cancel:clearTimeout}},{}],29:[function(e,t,r){t.exports=function(e,t){function r(){var e=a.length-n;if(s||o){switch(n){case 1:t(a[e]);break;case 2:t(a[e],a[e+1]);break;case 3:t(a[e],a[e+1],a[e+2]);break;case 4:t(a[e],a[e+1],a[e+2],a[e+3]);break;case 5:t(a[e],a[e+1],a[e+2],a[e+3],a[e+4]);break;case 6:t(a[e],a[e+1],a[e+2],a[e+3],a[e+4],a[e+5]);break;default:t.apply(null,a.slice(e,a.length))}for(var r=0;r<n;++r)i[r]=a[e+r];o=s=!1}}var n=e.length,a=e.slice(),i=e.slice(),s=!1,o=!0;return{push:function(){s=!1;for(var e=0;e<n;++e){var t=arguments[e];s=s||t!==i[e],a.push(t)}},pop:function(){s=!1,a.length-=n;for(var e=0;e<n;++e)s=s||a[a.length-n+e]!==i[e]},poll:r,setDirty:function(){o=!0}}}},{}],30:[function(e,t,r){t.exports=function(e){for(var t=new Float32Array(e),r=new Uint32Array(t.buffer),n=new Uint16Array(e.length),a=0;a<e.length;++a)if(isNaN(e[a]))n[a]=65535;else if(e[a]===1/0)n[a]=31744;else if(e[a]===-(1/0))n[a]=64512;else{var i=r[a],s=i>>>31<<15,o=(i<<1>>>24)-127,f=i>>13&1023;if(o<-24)n[a]=s;else if(o<-14){var c=-14-o;n[a]=s+(f+1024>>c)}else o>15?n[a]=s+31744:n[a]=s+(o+15<<10)+f}return n}},{}],31:[function(e,t,r){t.exports=function(e){return Object.keys(e).map(function(t){return e[t]})}},{}],32:[function(e,t,r){function n(e,t){function r(){var t=window.innerWidth,r=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();t=a.right-a.left,r=a.top-a.bottom}n.width=o*t,n.height=o*r,s(n.style,{width:t+"px",height:r+"px"})}var n=document.createElement("canvas"),i=a(n,t);s(n.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(n),e===document.body&&(n.style.position="absolute",s(e.style,{margin:0,padding:0}));var o=+i.options.pixelRatio;window.addEventListener("resize",r,!1);var f=i.options.onDestroy;return i.options=s(s({},i.options),{onDestroy:function(){window.removeEventListener("resize",r),e.removeChild(n),f&&f()}}),r(),i}function a(e,t){function r(t){try{return e.getContext(t,n)}catch(e){return null}}var n=t.glOptions||{},a=r("webgl")||r("experimental-webgl")||r("webgl-experimental");return i(a,"webgl not supported"),{gl:a,options:s({pixelRatio:window.devicePixelRatio},t)}}var i=e("./util/check"),s=e("./util/extend");t.exports=function(e){if("undefined"==typeof document||"undefined"==typeof HTMLElement)return{gl:e[0],options:e[1]||{}};var t=document.body,r=e[1]||{};if("string"==typeof e[0])t=document.querySelector(e[0])||document.body;else if("object"==typeof e[0])if(e[0]instanceof HTMLElement)t=e[0];else{if(e[0]instanceof WebGLRenderingContext)return{gl:e[0],options:s({pixelRatio:1},r)};r=e[0]}return t.nodeName&&"CANVAS"===t.nodeName.toUpperCase()?a(t,r):n(t,r)}},{"./util/check":20,"./util/extend":23}],33:[function(e,t,r){var n=e("./lib/util/check"),a=e("./lib/util/extend"),i=e("./lib/webgl"),s=e("./lib/strings"),o=e("./lib/extension"),f=e("./lib/limits"),c=e("./lib/buffer"),u=e("./lib/elements"),l=e("./lib/texture"),p=e("./lib/renderbuffer"),h=e("./lib/framebuffer"),d=e("./lib/uniform"),m=e("./lib/attribute"),b=e("./lib/shader"),g=e("./lib/draw"),v=e("./lib/state"),y=e("./lib/compile"),x=e("./lib/read"),w=e("./lib/dynamic"),k=e("./lib/util/raf"),_=e("./lib/util/clock"),A=16384,E=256,j=1024,S=34962,T=3553,C=34067,O="webglcontextlost",B="webglcontextrestored",F=1,D=2,P=3;t.exports=function(){function e(e){for(var t=0;t<ee.bindings.length;++t){var r=ee.bindings[t];r.pointer&&r.buffer===e&&(r.pointer=!1,r.buffer=null,r.x=r.y=r.z=r.w=NaN,G.disableVertexAttribArray(t))}}function t(){de=k.next(t),oe.count+=1,fe.count=oe.count,oe.width===G.drawingBufferWidth&&oe.height===G.drawingBufferHeight||(fe.viewportWidth=fe.drawingBufferWidth=oe.width=G.drawingBufferWidth,fe.viewportHeight=fe.drawingBufferHeight=oe.height=G.drawingBufferHeight,ce.notifyViewportChanged());var e=_();oe.dt=e-oe.t,oe.t=e,fe.deltaTime=oe.dt/1e3,fe.time=(e-se)/1e3,ne.poll();for(var r=0;r<he.length;++r){var n=he[r];n(null,fe)}oe.renderTime=_()-e}function r(){!de&&he.length>0&&t()}function R(){de&&(k.cancel(t),de=0)}function L(e){R(),e.preventDefault(),N.onContextLost&&N.onContextLost()}function I(e){G.getError(),Y.refresh(),J.refresh(),ne.refresh(),ae.refresh(),ie.refresh(),te.refresh(),ce.refresh(),N.onContextRestored&&N.onContextRestored(),t()}function M(){R(),pe&&(pe.removeEventListener(O,L),pe.removeEventListener(B,I)),te.clear(),ie.clear(),ae.clear(),ne.clear(),J.clear(),N.onDestroy&&N.onDestroy()}function z(e){function t(e){function t(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}var r=a({},e);return delete r.uniforms,delete r.attributes,delete r.context,t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),r}function r(e){var t={},r={};return Object.keys(e).forEach(function(n){var a=e[n];w.isDynamic(a)?(o=!0,r[n]=w.unbox(a,n)):t[n]=a}),{dynamic:r,static:t}}function i(e){for(;b.length<e;)b.push(null);return b}function s(e,t){return"function"==typeof e?m.call(this,null,e):"function"==typeof t?m.call(this,e,t):(n.drawOk(re,te,Z,ee,l._commandRef,l._fragId,l._vertId,l._uniformSet,l._attributeSet,l._hasCount),"number"==typeof e?d.call(this,0|e,i(0|e)):Array.isArray(e)?d.call(this,e.length,e):h.call(this,e))}n(!!e,"invalid args to regl({...})"),n.type(e,"object","invalid args to regl({...})");var o=!1,f=r(e.context||{}),c=r(e.uniforms||{}),u=r(e.attributes||{}),l=r(t(e)),p=le.command(l.static,c.static,u.static,l.dynamic,c.dynamic,u.dynamic,f,o),h=p.draw,d=p.batch,m=p.scope,b=[];return n.saveDrawInfo(l,c,u,V),s}function U(){ie.poll(),ce.poll()}function H(e){var t=0;U();var r=e.color;r&&(G.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),t|=A),"depth"in e&&(G.clearDepth(+e.depth),t|=E),"stencil"in e&&(G.clearStencil(0|e.stencil),t|=j),n(!!t,"called regl.clear with no buffer specified"),G.clear(t)}function W(e){function t(){var t=he.find(function(t){return t===e});t<0||(he.splice(t,1),he.length<=0&&R())}return he.push(e),r(),{cancel:t}}var q=i(Array.prototype.slice.call(arguments)),G=q.gl,N=q.options,V=s(),Y=o(G),X=Y.extensions,$={width:G.drawingBufferWidth,height:G.drawingBufferHeight},K=f(G,X),J=c(G,e),Q=u(G,X,J),Z=d(V),ee=m(G,X,K,J,V),te=b(G,ee,Z,function(e){return le.draw(e)},V),re=g(G,X,J),ne=l(G,X,K,U,$),ae=p(G,X,K),ie=h(G,X,K,ne,ae),se=_(),oe={count:0,start:se,dt:0,t:se,renderTime:0,width:G.drawingBufferWidth,height:G.drawingBufferHeight,pixelRatio:N.pixelRatio},fe={count:0,batchId:0,deltaTime:0,time:0,viewportWidth:oe.width,viewportHeight:oe.height,drawingBufferWidth:oe.width,drawingBufferHeight:oe.height,pixelRatio:oe.pixelRatio},ce=v(G,ie,$),ue=x(G,U,$),le=y(G,V,X,K,J,Q,ne,ie,ce,Z,ee,te,re,fe,U),pe=G.canvas,he=[],de=0;return pe&&(pe.addEventListener(O,L,!1),pe.addEventListener(B,I,!1)),a(z,{clear:H,prop:w.define.bind(null,F),context:w.define.bind(null,D),this:w.define.bind(null,P),draw:z({}),elements:function(e){return Q.create(e)},buffer:function(e){return J.create(e,S)},texture:function(e){return ne.create(e,T)},cube:function(e){return 6===arguments.length?ne.create(Array.prototype.slice.call(arguments),C):ne.create(e,C)},renderbuffer:function(e){return ae.create(e)},framebuffer:function(e){return ie.create(e)},framebufferCube:function(e){n.raise("framebuffer cube not yet implemented")},frame:W,stats:oe,limits:K,read:ue,destroy:M})}},{"./lib/attribute":1,"./lib/buffer":2,"./lib/compile":3,"./lib/draw":7,"./lib/dynamic":8,"./lib/elements":9,"./lib/extension":10,"./lib/framebuffer":11,"./lib/limits":12,"./lib/read":13,"./lib/renderbuffer":14,"./lib/shader":15,"./lib/state":16,"./lib/strings":17,"./lib/texture":18,"./lib/uniform":19,"./lib/util/check":20,"./lib/util/clock":21,"./lib/util/extend":23,"./lib/util/raf":28,"./lib/webgl":32}]},{},[33])(33)});
//# sourceMappingURL=regl.min.js.map