// https://github.com/Gillardo/bootstrap-ui-datetime-picker
// Version: 1.0.13
// Released: 2015-03-24 
angular.module("ui.bootstrap.datetimepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).directive("datetimePicker",["$compile","$parse","$document","$timeout","$position","dateFilter","dateParser","datepickerPopupConfig",function(a,b,c,d,e,f,g,h){return{restrict:"A",require:"ngModel",scope:{isOpen:"=?",enableDate:"=?",enableTime:"=?",todayText:"@",nowText:"@",dateText:"@",timeText:"@",clearText:"@",closeText:"@",dateDisabled:"&"},link:function(i,j,k,l){function m(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function n(a){return k.dateDisabled&&angular.isDefined(a)&&i.dateDisabled({date:a,mode:i.watchData.datepickerMode})}function o(a){if(a){if(angular.isDate(a)&&!isNaN(a))return l.$setValidity("date",!0),a;if(angular.isString(a)){var b=g.parse(a,p)||new Date(a);if(i.enableTime&&!i.enableDate&&a.length==p.length){var c="EEE MMM dd yyyy "+p,d="Fri Mar 12 2015 "+a;b=g.parse(d,c)||new Date(d)}return isNaN(b)?void l.$setValidity("date",!1):(l.$setValidity("date",!0),b)}return void l.$setValidity("date",!1)}return l.$setValidity("date",!0),null}var p,q,r=angular.isDefined(k.closeOnDateSelection)?i.$parent.$eval(k.closeOnDateSelection):h.closeOnDateSelection,s=angular.isDefined(k.datepickerAppendToBody)?i.$parent.$eval(k.datepickerAppendToBody):h.appendToBody;i.showButtonBar=angular.isDefined(k.showButtonBar)?i.$parent.$eval(k.showButtonBar):h.showButtonBar,i.enableDate=!(0==i.enableDate),i.enableTime=!(0==i.enableTime),i.showPicker=i.enableDate?"date":"time",i.todayText=i.todayText||"Today",i.nowText=i.nowText||"Now",i.clearText=i.clearText||"Clear",i.closeText=i.closeText||"Close",i.dateText=i.dateText||"Date",i.timeText=i.timeText||"Time",i.getText=function(a){return i[a+"Text"]||h[a+"Text"]},k.$observe("datetimePicker",function(a){p=a||h.datepickerPopup,l.$render()});var t=angular.element('<div datetime-picker-popup><div collapse="!(showPicker == \'date\')" datepicker></div><div collapse="!(showPicker == \'time\')"><div timepicker style="margin:0 auto"></div></div></div>');t.attr({"ng-model":"date","ng-change":"dateSelection()"});var u=angular.element(t.children()[0]);k.datepickerOptions&&angular.forEach(i.$parent.$eval(k.datepickerOptions),function(a,b){u.attr(m(b),a)});var v=angular.element(t.children()[1].children[0]);k.timepickerOptions&&angular.forEach(i.$parent.$eval(k.timepickerOptions),function(a,b){v.attr(m(b),a)}),k.datepickerMode||(k.datepickerMode="day"),i.watchData={},angular.forEach(["minDate","maxDate","datepickerMode"],function(a){if(k[a]){var c=b(k[a]);if(i.$watch(c,function(b){i.watchData[a]=b}),u.attr(m(a),"watchData."+a),"datepickerMode"===a){var d=c.assign;i.$watch("watchData."+a,function(a,b){a!==b&&d(i.$parent,a)})}}}),k.dateDisabled&&u.attr("date-disabled","dateDisabled({ date: date, mode: mode })"),l.$parsers.unshift(o),i.dateSelection=function(a){i.enableDate&&i.enableTime&&"time"==i.showPicker&&q&&null!==q&&null!==i.date&&(q.setHours(i.date.getHours()),q.setMinutes(i.date.getMinutes()),q.setSeconds(i.date.getSeconds()),q.setMilliseconds(i.date.getMilliseconds()),a=q),angular.isDefined(a)&&(i.date=a),q=i.date,l.$setViewValue(i.date),l.$render(),"date"==i.showPicker&&d(function(){i.watchData.datepickerMode="month",d(function(){i.watchData.datepickerMode="day"},200)},400),r&&"time"!=i.showPicker&&(i.enableTime?i.showPicker="time":(i.isOpen=!1,j[0].focus()))},j.bind("input change keyup",function(){i.$apply(function(){i.date=l.$modelValue})}),l.$render=function(){var a=l.$viewValue?o(l.$viewValue):null,b=a?f(a,p):"";j.val(b),i.date=a};var w=function(a){i.isOpen&&a.target!==j[0]&&i.$apply(function(){i.isOpen=!1})},x=function(a){i.keydown(a)};j.bind("keydown",x),i.keydown=function(a){27===a.which?(a.preventDefault(),a.stopPropagation(),i.close()):40!==a.which||i.isOpen||(i.isOpen=!0)},i.$watch("isOpen",function(a){a?(i.$broadcast("datepicker.focus"),i.position=s?e.offset(j):e.position(j),i.position.top=i.position.top+j.prop("offsetHeight"),c.bind("click",w)):c.unbind("click",w)}),i.isTodayDisabled=function(){return n(new Date)},i.select=function(a){if("today"===a||"now"==a){var b=new Date;angular.isDate(l.$modelValue)?(a=new Date(l.$modelValue),a.setFullYear(b.getFullYear(),b.getMonth(),b.getDate()),a.setHours(b.getHours(),b.getMinutes(),b.getSeconds(),b.getMilliseconds())):a=b}i.dateSelection(a)},i.close=function(){i.isOpen=!1,j[0].focus()},i.changePicker=function(a){i.showPicker=a};var y=a(t)(i);t.remove(),s?c.find("body").append(y):j.after(y),i.$on("$destroy",function(){y.remove(),j.unbind("keydown",x),c.unbind("click",w)})}}}]).directive("datetimePickerPopup",function(){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:"template/datetime-picker.html",link:function(a,b){b.bind("click",function(a){a.preventDefault(),a.stopPropagation()})}}}),angular.module("ui.bootstrap.datetimepicker").run(["$templateCache",function(a){"use strict";a.put("template/datetime-picker.html",'<ul class="dropdown-menu dropdown-menu-right" ng-style="{display: (isOpen && \'block\') || \'none\', top: position.top+\'px\', right: position.right+\'px\'}" style=left:inherit ng-keydown=keydown($event)><li style="padding:0 5px 5px 5px" class=datetime-picker><div ng-transclude></div></li><li ng-if=showButtonBar style=padding:5px><span class="btn-group pull-left" style=margin-right:10px><button ng-if="showPicker == \'date\'" type=button class="btn btn-sm btn-info" ng-click="select(\'today\')" ng-disabled=isTodayDisabled()>{{ getText(\'today\') }}</button> <button ng-if="showPicker == \'time\'" type=button class="btn btn-sm btn-info" ng-click="select(\'now\')" ng-disabled=isTodayDisabled()>{{ getText(\'now\') }}</button> <button type=button class="btn btn-sm btn-danger" ng-click=select(null)>{{ getText(\'clear\') }}</button></span> <span class="btn-group pull-right"><button ng-if="showPicker == \'date\' && enableTime" type=button class="btn btn-sm btn-default" ng-click="changePicker(\'time\')">{{ getText(\'time\')}}</button> <button ng-if="showPicker == \'time\' && enableDate" type=button class="btn btn-sm btn-default" ng-click="changePicker(\'date\')">{{ getText(\'date\')}}</button> <button type=button class="btn btn-sm btn-success" ng-click=close()>{{ getText(\'close\') }}</button></span></li></ul>')}]);