!function(e){var t;if("function"==typeof define&&define.amd)define(["leaflet"],e);else if("undefined"!=typeof module)t=require("leaflet"),module.exports=e(t);else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";e(window.L)}}(function(e){return e.Control.Geocoder=e.Control.extend({options:{collapsed:!0,position:"topright",placeholder:"Search...",errorMessage:"Nothing found."},_callbackId:0,initialize:function(t,o){this.key=t,e.Util.setOptions(this,o),this.options.geocoder||(this.options.geocoder=new e.Control.Geocoder.Nominatim)},onAdd:function(t){this._map=t;var o="leaflet-control-geocoder",n=this._container=e.DomUtil.create("div",o);e.DomEvent.disableClickPropagation(n);var r=this._form=e.DomUtil.create("form",o+"-form"),i=this._input=document.createElement("input");i.type="text",i.placeholder=this.options.placeholder,e.DomEvent.addListener(i,"onkeydown",this._clearResults,this),e.DomEvent.addListener(i,"onpaste",this._clearResults,this),e.DomEvent.addListener(i,"oninput",this._clearResults,this),this._errorElement=document.createElement("div"),this._errorElement.className=o+"-form-no-error",this._errorElement.innerHTML=this.options.errorMessage;var s=e.DomUtil.create("table",o+"-alternatives");if(this._alts=document.createElement("tbody"),s.appendChild(this._alts),r.appendChild(i),r.appendChild(this._errorElement),r.appendChild(s),e.DomEvent.addListener(r,"submit",this._geocode,this),this.options.collapsed){e.DomEvent.addListener(n,"mouseover",this._expand,this),e.DomEvent.addListener(n,"mouseout",this._collapse,this);var l=this._layersLink=e.DomUtil.create("a",o+"-toggle",n);l.href="#",l.title="Geocoder",e.DomEvent.addListener(l,e.Browser.touch?"click":"focus",this._expand,this),this._map.on("movestart",this._collapse,this)}else this._expand();return n.appendChild(r),n},_geocodeResult:function(t){var o=document.getElementsByClassName("leaflet-control-geocoder-toggle")[0];if(o.className=o.className.replace(" leaflet-control-geocoder-throbber",""),1==t.length)this.markGeocode(t[0]);else if(t.length>0){this._results=t;for(var n=0;n<t.length;n++)this._alts.appendChild(this._createAltRow(t[n]))}else e.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(t){return this._map.fitBounds(t.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new e.Marker(t.center).bindPopup(t.name).addTo(this._map).openPopup(),this},_geocode:function(t){var o=document.getElementsByClassName("leaflet-control-geocoder-toggle")[0];o.className+=" leaflet-control-geocoder-throbber",this._clearResults(),e.DomEvent.preventDefault(t),this.options.geocoder.geocode(this._input.value,this._geocodeResult,this)},_expand:function(){e.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-geocoder-expanded","")},_clearResults:function(){this._alts.innerHTML="",e.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_createAltRow:function(e){var t=this,o=document.createElement("tr");return o.innerHTML='<td><a href="#">'+e.name+"</a></td>",o.onclick=function(){t.markGeocode.call(t,e)},o}}),e.Control.geocoder=function(t,o){return new e.Control.Geocoder(t,o)},e.Control.Geocoder.callbackId=0,e.Control.Geocoder.jsonp=function(t,o,n,r,i){var s="_l_geocoder_"+e.Control.Geocoder.callbackId++;o[i||"callback"]=s,window[s]=e.Util.bind(n,r),script=document.createElement("script"),script.type="text/javascript",script.src=t+e.Util.getParamString(o),script.id=s,document.getElementsByTagName("head")[0].appendChild(script)},e.Control.Geocoder.Nominatim=e.Class.extend({options:{serviceUrl:"http://nominatim.openstreetmap.org/search/"},initialize:function(t){e.Util.setOptions(this,t)},geocode:function(t,o,n){e.Control.Geocoder.jsonp(this.options.serviceUrl,{q:t,limit:5,format:"json"},function(t){for(var r=[],i=t.length-1;i>=0;i--){for(var s=t[i].boundingbox,l=0;l<4;l++)s[l]=parseFloat(s[l]);r[i]={name:t[i].display_name,bbox:e.latLngBounds([s[0],s[2]],[s[1],s[3]]),center:e.latLng((s[0]+s[1])/2,(s[2]+s[3])/2)}}o.call(n,r)},this,"json_callback")}}),e.Control.Geocoder.nominatim=function(t){return new e.Control.Geocoder.Nominatim(t)},e.Control.Geocoder.Bing=e.Class.extend({initialize:function(e){this.key=e},geocode:function(t,o,n){e.Control.Geocoder.jsonp("http://dev.virtualearth.net/REST/v1/Locations",{query:t,key:this.key},function(t){for(var r=[],i=t.resourceSets.resources.length-1;i>=0;i--){var s=t.resourceSets.resources[i];r[i]={name:s.name,bbox:e.latLngBounds(s.bbox),center:e.latLng(s.point.coordinates)}}o.call(n,r)},this,"jsonp")}}),e.Control.Geocoder.bing=function(){return new e.Control.Geocoder.Bing},e.Control.Geocoder});