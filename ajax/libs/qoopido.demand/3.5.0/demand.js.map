{"version":3,"sources":["demand.js"],"names":["global","document","JSON","XMLHttpRequest","setTimeout","clearTimeout","snippet","arrayPrototype","objectPrototype","XHR","undefined","emit","event","parameter","i","callback","pointer","listener","arrayPrototypeSlice","call","arguments","apply","NULL","log","error","isTypeOf","console","toString","assignModule","id","factory","provide","mockModules","module","pledge","pledges","match","regexMatchParameter","replace","mocks","Pledge","defer","slice","join","push","demand","all","escapeRegularExpression","value","regexMatchRegex","createRegularExpression","expression","modifier","RegExp","getTimestamp","Date","resolveUrl","url","resolver","href","resolvePath","path","context","regexIsAbsolutePath","test","regexIsAbsoluteUri","regexMatchBaseUrl","resolveDependency","dependency","definition","deferred","STRING_STRING","DEMAND_ID","PROVIDE_ID","PATH_ID","MODULE_PREFIX_LOCAL","key","scopedDemand","bind","MODULE_PREFIX_PATHS","registry","Loader","resolveParameter","isInstanceOf","resolve","pattern","settings","matches","weight","mock","cache","handler","version","lifetime","process","resolveLoader","loader","state","PLEDGE_PENDING","onPreProcess","queue","add","isArray","objectPrototypeToString","isObject","object","type","isPositiveInteger","isFinite","Math","floor","merge","properties","property","targetProperty","targetPropertyIsObject","sourceProperty","target","length","Pattern","self","this","regexMatchTrailingSlash","matchPattern","matchUrl","xhr","timeout","MODULE_PREFIX_HANDLER","then","onPreRequest","dependencies","reject","storage","get","XDR","onprogress","ontimeout","onerror","onabort","Reason","onload","getResponseHeader","status","matchType","source","responseText","onPostRequest","set","open","send","readyState","abort","executor","handle","PLEDGE_RESOLVED","PLEDGE_REJECTED","aState","aParameter","result","shift","resolved","rejected","aResolved","aRejected","message","stack","Queue","items","window","isFunction","current","STRING_FUNCTION","arrayPrototypeConcat","concat","MODULE_PREFIX","MODULE_PREFIX_STORAGE","MODULE_PREFIX_PLUGIN","MODULE_PREFIX_FUNCTION","MODULE_PREFIX_VALIDATOR","STRING_BOOLEAN","XDomainRequest","regexMatchEvent","modules","createElement","prototype","remove","aResolve","aReject","observePledge","index","countResolved","checkState","countTotal","race","traverse","depth","item","indention","Array","configure","temp","base","min","max","clean","on","events","split","indexOf","substr","list","keys","Object","isEnabled","Storage","clear","expired","STORAGE_PREFIX","STORAGE_SUFFIX_STATE","STORAGE_SUFFIX_VALUE","regexMatchState","localStorage","exception","hasRemainingSpace","parse","getItem","expires","spaceBefore","remainingSpace","setItem","stringify","removeItem","getElementsByTagName","regexMatchSourcemap","replacement","exec","protocol","host","script","async","text","setAttribute","appendChild","handlerModule","onPostConfigure","options","prefix","fn","generateHash","hash","charCodeAt","generateConfiguration","bundle","configuration","/demand/handler/bundle","getModule","bundles","dfd","/demand","location","main"],"mappings":"AAAA;AACA,CAaC,SAASA,EAAQC,EAAUC,EAAMC,EAAgBC,EAAYC,EAAcC,EAASC,EAAgBC,EAAiBC,EAAKC,GAC1H,YA8CC,SAASC,GAAKC,GACb,GACCC,GAAWC,EAAGC,EADXC,EAAUC,GAASL,EAGvB,IAAGI,EAGF,IAFAH,EAAYK,EAAoBC,KAAKC,UAAW,GAE5CN,EAAI,EAAIC,EAAWC,EAAQF,GAAKA,IACnCC,EAASM,MAAMC,GAAMT,GAKxB,QAASU,GAAIC,GAERC,EAASC,QAAS,cACrBA,QAAQF,MAAMA,EAAMG,YAKtB,QAASC,GAAaC,EAAIC,GACzBC,EAAQF,EAAI,WAAa,MAAOC,KAGjC,QAASE,KAIR,IAHA,GACQC,GAAQC,EAAQrB,EADpBsB,KACHrB,EAAI,EAEEmB,EAASb,UAAUN,GAAKA,IAC9BD,EAAeoB,EAAOG,MAAMC,IAC5BJ,EAAeA,EAAOK,QAAQD,GAAqB,IACnDH,GAAgBK,GAAMN,KAAYM,GAAMN,GAAUO,EAAOC,UAAUP,OACnEd,UAAUN,IAAMD,EAAY,QAAUA,EAAU6B,MAAM,GAAGC,KAAK,IAAO,SAAW,IAAMV,EAEtFE,EAAQS,KAAKV,EAKd,OAFAW,GAAOxB,MAAMC,GAAMF,WAEZoB,EAAOM,IAAIX,GAGnB,QAASY,GAAwBC,GAChC,MAAOA,GAAMV,QAAQW,GAAiB,QAGvC,QAASC,GAAwBC,EAAYC,GAC5C,MAAO,IAAIC,QAAOF,EAAYC,GAG/B,QAASE,KACR,OAAQ,GAAIC,MAGb,QAASC,GAAWC,GAGnB,MAFAC,IAASC,KAAOF,EAETC,GAASC,KAGjB,QAASC,GAAYC,EAAMC,GAO1B,MANAD,GAAOA,EAAKvB,QAAQD,GAAqB,IAErC0B,GAAoBC,KAAKH,IAAUI,GAAmBD,KAAKH,KAC9DA,EAAO,IAAML,GAAaM,GAAWN,EAAWM,EAAU,SAAY,KAAOD,GAAMvB,QAAQ4B,EAAmB,KAGxGL,EAGR,QAASM,GAAkBC,EAAYN,GACtC,GAAID,GAAMQ,EAAYC,CAEtB,IAAG7C,EAAS2C,EAAYG,IAAgB,CAGvC,GAFAV,EAAOD,EAAYQ,EAAYN,GAE5BA,IAAYM,IAAeI,GAAaJ,IAAeK,GAAcL,IAAeM,GAAU,CAChG,OAAON,GACN,IAAKI,GACJX,EAAac,EAAsBd,EACnCQ,EAAa,WACZ,GACCO,GADGC,EAAehC,EAAOiC,KAAKhB,EAG/B,KAAIc,IAAO/B,GACVgC,EAAaD,GAAO/B,EAAO+B,EAG5B,OAAOC,GAGR,MACD,KAAKJ,GACJZ,EAAac,EAAsBd,EACnCQ,EAAa,WACZ,MAAOtC,GAAQ+C,KAAKhB,GAGrB,MACD,KAAKY,GACJb,EAAakB,EAAsBjB,EACnCO,EAAa,WACZ,MAAOP,KAMTkB,GAASnB,IAAS9B,EAAQ8B,EAAMQ,GAGlC,OAAQW,GAASnB,KAAUmB,GAASnB,GAAQ,GAAIoB,GAAOpB,EAAMqB,EAAiBd,EAAYN,MAAY5B,OAEtG,MAAIiD,GAAaf,EAAY5B,GAOrB4B,GANPE,EAAW9B,EAAOC,QAElB6B,EAASc,QAAQhB,GAEVE,EAASpC,QAOnB,QAASgD,GAAiBrB,EAAMC,GAC/B,GAECc,GAAKxC,EAFFvB,EAAYgD,EAAKzB,MAAMC,IAC1BgD,EAAYC,GAASD,OAKtB,IAFAxB,EAAOD,EAAYC,EAAMC,IAErBG,GAAmBD,KAAKH,GAC3B,IAAIe,IAAOS,GACVA,EAAQT,GAAKW,QAAQ1B,MAAWzB,GAASA,EAAMoD,OAASH,EAAQT,GAAKY,UAAYpD,EAAQiD,EAAQT,GAInG,QACCa,QAAW5E,IAAaA,EAAU,IAClC6E,MAAW7E,GAAaA,EAAU,GAAuB,MAAjBA,EAAU,GAAaS,GAC/DqE,QAAW9E,GAAaA,EAAU,IAAOyE,GAASK,QAClDC,QAAW/E,GAAaA,EAAU,IAAOyE,GAASM,QAClDC,SAAWhF,GAAaA,EAAU,IAAqB,IAAfA,EAAU,IAAcyE,GAASO,SACzEpC,IAAUrB,EAAQoB,EAAWpB,EAAM0D,QAAQjC,IAASA,GAItD,QAASkC,GAAcC,GACtB,GAAIL,GAAUK,EAAOL,OAErBhF,GAAK,aAAcqF,GAEhBA,EAAO1B,SAASpC,OAAO+D,QAAUC,IACnCP,EAAQQ,cAAgBR,EAAQQ,aAAahF,KAAK6E,GAClDL,EAAQG,SAAWM,EAAMC,IAAIL,IAkB/B,QAASM,GAAQtD,GAChB,MAA+C,mBAAxCuD,EAAwBpF,KAAK6B,GAYrC,QAASwD,GAASC,GACjB,MAAOA,IAAUhF,EAASgF,EAAQ,UAanC,QAAShF,GAASgF,EAAQC,GACzB,aAAcD,KAAWC,EAa1B,QAASvB,GAAasB,EAAQxE,GAC7B,MAAOwE,aAAkBxE,GAY1B,QAAS0E,GAAkB3D,GAC1B,MAAOvB,GAASuB,EAAO,WAAa4D,SAAS5D,IAAU6D,KAAKC,MAAM9D,KAAWA,GAASA,GAAS,EAYhG,QAAS+D,KAIR,IAHA,GACQC,GAAYC,EAAUC,EAAgBC,EAAwBC,EADlEC,EAASjG,UAAU,GACtBN,EAAI,GAEEkG,EAAa5F,UAAUN,MAAQJ,EAAWI,IAChD,IAAImG,IAAYD,GACfE,EAAiBG,EAAOJ,GACxBG,EAAiBJ,EAAWC,GAEzBG,IAAmB1G,IAClB8F,EAASY,IACXD,EAAyBX,EAASU,GAGjCA,EADEE,EAAeE,SAAW5G,EACVyG,GAA0BD,EAAeI,SAAW5G,EAAawG,KAEjEC,GAA0BD,EAAeI,SAAW5G,EAAawG,KAGpFG,EAAOJ,GAAYF,EAAMG,EAAgBE,IAEzCC,EAAOJ,GAAYG,EAMvB,OAAOC,GAQR,QAASE,GAAQlC,EAAS5B,GACzB,GAAI+D,GAAOC,IAEXD,GAAKhC,OAAeH,EAAQiC,OAC5BE,EAAK/D,IAAeD,EAAWC,GAAKnB,QAAQoF,GAAyB,MACrEF,EAAKG,aAAezE,EAAwB,IAAMH,EAAwBsC,IAC1EmC,EAAKI,SAAe1E,EAAwB,IAAMH,EAAwBU,IAqB3E,QAASwB,GAAOpB,EAAMhD,GACrB,GAICgH,GAAKC,EAJFN,EAAWC,KACdnD,EAAW9B,EAAOC,QAClBP,EAAWoC,EAASpC,OACpByD,EAAW9E,EAAU8E,OAkFtB,OA/EA6B,GAAKlD,SAAWA,EAChBkD,EAAK3D,KAAWA,EAChB2D,EAAK/D,IAAW5C,EAAU4C,IAC1B+D,EAAK9B,MAAW7E,EAAU6E,MAC1B8B,EAAK5B,QAAW/E,EAAU+E,QAC1B4B,EAAK3B,SAAWhF,EAAUgF,SAE1BhD,EAAOkF,EAAwBpC,GAC7BqC,KACA,SAASrC,GACR6B,EAAK7B,QAAUA,EACf6B,EAAK/B,KAAU5E,EAAU4E,KAAOlD,GAAMiF,EAAK3D,MAAQvC,GAEnDqE,EAAQsC,cAAgBtC,EAAQsC,aAAa9G,KAAKqG,GAE9CA,EAAK/B,KAiDL+B,EAAK/B,KAAKyC,aACZV,EAAK/B,KAAKyC,aAAaF,KACtB,WACCR,EAAK/B,KAAKL,QAAQoC,IAEnBA,EAAK/B,KAAK0C,QAGXX,EAAK/B,KAAKL,QAAQoC,GAxDhBA,EAAK9B,SAAU,GAAU0C,EAAQC,IAAIb,GA2CvCpH,EAAW,WACV2F,EAAcyB,MA3Cf7G,EAAK,aAAc6G,GAEhBtF,EAAO+D,QAAUC,IACnB2B,EAAM3D,EAAkBF,KAAKwD,EAAK/D,KAAO,GAAIhD,GAAQ,GAAI6H,IAEzDT,EAAIU,WAAa,aACjBV,EAAIW,UAAYX,EAAIY,QAAUZ,EAAIa,QAAU,WAC3CpE,EAAS6D,OAAO,GAAIQ,GAAO,qBAAsBnB,EAAK3D,QAEvDgE,EAAIe,OAAS,WACZ,GAAIlC,GAAOmB,EAAIgB,mBAAqBhB,EAAIgB,kBAAkB,eAE1Df,GAAUzH,EAAayH,GAEjB,UAAYD,IAAuB,MAAfA,EAAIiB,QAAqBpC,GAASf,EAAQoD,YAAapD,EAAQoD,UAAU/E,KAAK0C,GAcvGpC,EAAS6D,OAAO,GAAIQ,GAAO,mBAAoBnB,EAAK3D,QAbpD2D,EAAKwB,OAASnB,EAAIoB,aAElBtI,EAAK,cAAe6G,GAEjBtF,EAAO+D,QAAUC,IACnBP,EAAQuD,eAAiBvD,EAAQuD,cAAc/H,KAAKqG,GACpDzB,EAAcyB,GAEXA,EAAK9B,SAAU,GACjBxD,EAAO8F,KAAK,WAAaI,EAAQe,IAAI3B,QAQzCK,EAAIuB,KAAK,MAAO5B,EAAK/D,KAAK,GAC1BoE,EAAIwB,OAEJvB,EAAU1H,EAAW,WACjByH,EAAIyB,WAAa,GACnBzB,EAAI0B,SAEHjE,GAASwC,YAoBhBxD,EAAS6D,QAGJ7D,EA8BR,QAAS9B,GAAOgH,GAIf,QAASpE,KACRqE,EAAOC,GAAiBtI,WAGzB,QAAS+G,KACRsB,EAAOE,GAAiBvI,WAGzB,QAASqI,GAAOG,EAAQC,GACvB,GAAI7I,GAAS8I,CAEb,IAAGtC,EAAKvB,QAAUC,EAAgB,CAIjC,IAHAsB,EAAKvB,MAAQ2D,EACbpC,EAAKxE,MAAQ6G,EAEP7I,EAAUC,EAAS2I,GAAQG,SAChCD,EAAS9I,EAAQ2E,QAAQtE,MAAMC,GAAMuI,GAElCC,GAAiC,kBAAhBA,GAAO9B,KAC1B8B,EAAO9B,KAAKhH,EAAQsD,SAASc,QAASpE,EAAQsD,SAAS6D,QAEvDnH,EAAQsD,SAASc,QAAQ0E,EAI3B7I,GAAWK,IA5Bb,GAAIkG,GAAWC,KACdxG,GAAa+I,YAAcC,YA+B5BzC,GAAKQ,KAAO,SAASkC,EAAWC,GAC/B,GAAI7F,GAAW9B,EAAOC,OAEtB,IAAG+E,EAAKvB,QAAUC,EACjBgE,GAAajJ,EAASyI,IAAiB9G,MAAO+C,QAASuE,EAAW5F,SAAUA,IAC5E6F,GAAalJ,EAAS0I,IAAiB/G,MAAO+C,QAASwE,EAAW7F,SAAUA,QAE5E,QAAOkD,EAAKvB,OACX,IAAKyD,IACJpF,EAASc,QAAQ8E,GAAaA,EAAU7I,MAAMC,GAAMkG,EAAKxE,OAEzD,MACD,KAAK2G,IACJrF,EAAS6D,OAAOgC,GAAaA,EAAU9I,MAAMC,GAAMkG,EAAKxE,QAM3D,MAAOsB,GAASpC,QAGjBsH,EAASpE,EAAS+C,GAmFnB,QAASQ,GAAOyB,EAASnI,EAAQoI,GAChC5C,KAAK2C,QAAUA,EAEfnI,IAAWwF,KAAKxF,OAASA,GACzBoI,IAAU5C,KAAK4C,MAAQnJ,EAAoBC,KAAKkJ,IAyCjD,QAASC,KACR7C,KAAK8C,MAAQ,EACb9C,KAAK4C,SAmCN,QAASxH,KACR,GAEQuB,GAFJ8D,EAAehH,EAAoBC,KAAKC,WAC3C0C,EAAe2D,OAAS+C,OAAS/C,KAAOnG,GACxCR,EAAI,CAIL,KAFAH,EAAK,aAAcuH,EAAcpE,GAE1BM,EAAa8D,EAAapH,GAAKA,IACrCoH,EAAapH,GAAKqD,EAAkBC,EAAYN,EAKjD,OAFAnD,GAAK,cAAeuH,EAAcpE,GAE3BtB,EAAOM,IAAIoF,GA0HnB,QAASnG,KACR,GAICuC,GAAUpC,EAAQuI,EAJf5J,EAAeO,UAClByC,EAAepC,EAASZ,EAAU,GAAI0D,IAAiB1D,EAAU,GAAKS,GACtE4G,EAAe5B,EAAQzF,EAAUgD,EAAO,EAAI,IAAMhD,EAAUgD,EAAO,EAAI,GAAKvC,GAC5E+C,EAAe6D,EAAerH,EAAUgD,EAAO,EAAI,GAAKhD,EAAUgD,EAAO,EAAI,EAW9E,KARIA,GAAQuC,EAAMsE,UACjB7G,EAAOuC,EAAMsE,QAAQ7G,KAErBuC,EAAMsE,QAAUpJ,GAEhB8E,EAAMmE,MAAQ,GAAKnE,EAAMN,YAGvBjC,EAmBF,KAAM,+BAlBNA,GAAaD,EAAYC,EAAM4D,MAC/BnD,EAAaU,GAASnB,KAAUmB,GAASnB,GAAQrB,EAAOC,SACxDP,EAAaoC,EAASpC,OACtBuI,EAAahJ,EAAS4C,EAAYsG,IAE/BzI,EAAO+D,QAAUC,IAChBgC,EACFrF,EACExB,MAAMwC,EAAMqE,GACZF,KACA,WAAa1D,EAASc,QAAQqF,EAAapG,EAAWhD,MAAMC,GAAMF,WAAaiD,IAC/E,WAAa9C,EAAI,GAAIoH,GAAO,kBAAmB9E,EAAMzC,cAGvDkD,EAASc,QAAQqF,EAAapG,IAAeA,IAh1BlD,GAqCEH,GAAmBkC,EAAOgC,EApC1BlH,EAA0BX,EAAemC,MACzCkI,EAA0BrK,EAAesK,OACzCtE,EAA0B/F,EAAgBmB,SAE1C6C,EAA0B,SAC1BC,EAA0B,UAC1BC,EAA0B,OAC1BoG,EAA0B,IAAMtG,EAAY,IAC5CuG,EAA0BD,EAAgB,WAC1C/C,EAA0B+C,EAAgB,WAC1CE,EAA0BF,EAAgB,UAC1CnG,EAA0BmG,EAAgB,QAC1C/F,EAA0B+F,EAAgB,QAC1CG,EAA0BH,EAAgB,YAC1CI,EAA0BJ,EAAgB,aAC1C5E,EAA0B,UAC1BwD,GAA0B,WAC1BC,GAA0B,WAC1BpF,GAA0B,SAC1B4G,GAA0B,UAC1BR,GAA0B,WAC1BrJ,GAA0B,KAC1BgH,GAA0B,kBAAoBtI,IAAWA,EAAOoL,gBAAkB3K,EAElFsD,GAA0B,MAC1BE,GAA0B,qBAC1ByD,GAA0B,UAC1BrF,GAA0B,oEAC1BY,GAA0B,sCAC1BoI,GAA0B,uFAE1B/F,IAA4BI,SAAWoC,QAAS,IAAUzC,WAAaiG,WAAa3F,QAAS,UAC7FjC,GAA0BzD,EAASsL,cAAc,KACjDvG,MACAzC,MACAtB,KAqSDsG,GAAQiE,WAOPjG,QAAS,SAAS1B,GACjB,MAAO4D,MAAKE,aAAa3D,KAAKH,IAE/B4H,OAAQ,SAAShI,GAChB,MAAOA,GAAInB,QAAQmF,KAAKG,SAAU,KAEnC9B,QAAS,SAASjC,GACjB,MAAOA,GAAKvB,QAAQmF,KAAKE,aAAcF,KAAKhE,OAkL9CjB,EAAOgJ,WACNvF,MAAQC,GAQT1D,EAAOC,MAAQ,WACd,GAAI+E,KAOJ,OALAA,GAAKtF,OAAS,GAAIM,GAAO,SAASkJ,EAAUC,GAC3CnE,EAAKpC,QAAUsG,EACflE,EAAKW,OAAUwD,IAGTnE,GAGRhF,EAAOM,IAAM,SAASX,GAQrB,QAASyJ,GAAcC,EAAO3J,GAC7BA,EAAO8F,KACN,WACCgC,EAAS6B,GAAS3K,EAAoBC,KAAKC,WAE3C0K,IAEAC,KAED,WACC9B,EAASrH,KAAK1B,EAAoBC,KAAKC,YAEvC2K,MAKH,QAASA,KACLD,IAAkBE,EACpB1H,EAASc,QAAQ/D,MAAMC,GAAMsJ,EAAqBvJ,SAAU2I,IACnDC,EAAS3C,OAASwE,IAAkBE,GAC7C1H,EAAS6D,OAAO9G,MAAMC,GAAMsJ,EAAqBvJ,SAAU4I,IAI7D,IAhCA,GAKQ/H,GALJoC,EAAgB9B,EAAOC,QAC1BuH,KACAC,KACA+B,EAAgB7J,EAAQmF,OACxBwE,EAAgB,EAChBhL,EAAI,EA2BCoB,EAASC,EAAQrB,GAAIA,IAC1B8K,EAAc9K,EAAGoB,EAGlB,OAAOoC,GAASpC,QAGjBM,EAAOyJ,KAAO,SAAS9J,GAItB,IAHA,GACQD,GADJoC,EAAW9B,EAAOC,QACrB3B,EAAI,EAECoB,EAASC,EAAQrB,GAAIA,IAC1BoB,EAAO8F,KAAK1D,EAASc,QAASd,EAAS6D,OAGxC,OAAO7D,GAASpC,QAmBjByG,EAAO6C,WAMN7J,SAAU,WACT,GAAI6F,GAASC,KACZqC,EAAStF,EAAY,KAAOgD,EAAK4C,QAAU,KAAO5C,EAAKvF,OAAS,IAAMuF,EAAKvF,OAAS,IAAM,GAM3F,OAJGuF,GAAK6C,QACPP,EAASnB,EAAOuD,SAAS1E,EAAK6C,MAAOP,EAAQ,IAGvCA,IAITnB,EAAOuD,SAAW,SAAS7B,EAAOrH,EAAOmJ,GAIxC,IAHA,GACQC,GADJC,EAAY,GAAIC,OAAMH,EAAQ,GAAGxJ,KAAK,KACzC7B,EAAI,EAECsL,EAAO/B,EAAMvJ,GAAIA,IACtBkC,GAAS,KAAOqJ,EAAY,KAAOD,EAAKhC,QAAU,KAAOgC,EAAKnK,OAAS,IAAMmK,EAAKnK,OAAS,IAAM,IAE9FmK,EAAK/B,QACPrH,EAAQ2F,EAAOuD,SAASE,EAAK/B,MAAOrH,EAAOmJ,EAAQ,GAIrD,OAAOnJ,IAaRsH,EAAMkB,WAMLnF,IAAK,WACJD,EAAMiE,MAASjE,EAAMiE,MAAMQ,OAAO3J,EAAoBC,KAAKC,YAC3DgF,EAAMmE,OAASnJ,UAAUkG,QAExBlB,EAAMsE,SAAWtE,EAAMN,WAEzBA,QAAS,WACR,GAAI4E,EAEDtE,GAAMmE,QACRnE,EAAMmE,QAENG,EAAUtE,EAAMsE,QAAUtE,EAAMiE,MAAMN,QAEtCW,EAAQ/E,QAAQG,QAAQ3E,KAAKuJ,GAC7B/J,EAAK,cAAe+J,MA2BvB7H,EAAO0J,UAAY,SAAS1L,GAC3B,GAQC+D,GAAK4H,EARF9G,EAAW7E,EAAU6E,MACxBE,EAAW/E,EAAU+E,QACrBkC,EAAWjH,EAAUiH,QACrBjC,EAAWhF,EAAUgF,SACrB4G,EAAW5L,EAAU4L,KACrBpH,EAAWxE,EAAUwE,QACrBiG,EAAWzK,EAAUyK,QACrBtK,EAAWsE,GAASgG,OAGrB,IAAG7J,EAASiE,EAAOyF,IAClB7F,GAASI,MAAM,KAAQF,OAAQ,EAAGS,MAAOP,OACnC,IAAGc,EAASd,GAClB,IAAId,IAAOc,GACVJ,GAASI,MAAMd,IAASY,OAAQZ,EAAI0C,OAAQrB,MAAOP,EAAMd,GAoB3D,IAhBGnD,EAASmE,EAASrB,MACpBe,GAASM,QAAUA,GAGjBe,EAAkBmB,KACpBxC,GAASwC,QAA+C,IAArCjB,KAAK6F,IAAI7F,KAAK8F,IAAI7E,EAAS,GAAI,KAGhDnB,EAAkBd,IAAaA,EAAW,IAC5CP,GAASO,SAAsB,IAAXA,GAGlBpE,EAASgL,EAAMlI,KAA2B,KAATkI,IACnCnH,GAASD,QAAQoH,KAAO,GAAIlF,GAAQ,GAAIkF,IAGtCjG,EAASnB,GACX,IAAIT,IAAOS,GACF,SAART,IAAmBU,GAASD,QAAQT,GAAO,GAAI2C,GAAQ3C,EAAKS,EAAQT,IAItE,IAAG4B,EAAS8E,GACX,IAAI1G,IAAO0G,GACP1G,IAAQmG,IACVyB,EAAOxL,EAAQ4D,GAAO5D,EAAQ4D,OAE9BjE,EAAK,gBAAkBiE,EAAK4H,GAE5BzF,EAAMyF,EAAMlB,EAAQ1G,IAEpBjE,EAAK,iBAAmBiE,EAAK4H,GAKhC,OAAO3J,IAGRA,EAAO4I,OAAS,SAAS5H,GAQxB,MAPGmB,IAASnB,OACTmB,GAASnB,GAAM6B,OAAS0C,EAAQwE,MAAM/I,KAAKA,SAEtCmB,IAASnB,SACTtB,IAAMsB,IAGPhB,GAGRA,EAAOgK,GAAK,SAASC,EAAQ/L,GAC5B,GAAIH,GAAOI,CAEX,IAAGS,EAASqL,EAAQvI,KAAkB9C,EAASV,EAAU4J,IAGxD,IAFAmC,EAASA,EAAOC,MAAM,KAEhBnM,EAAQkM,EAAO/C,SACjBsB,GAAgBrH,KAAKpD,MACtBK,GAASL,KAAWK,GAASL,QAAcgC,KAAK7B,GAEV,IAApCH,EAAMoM,QAAQ,oBAChBhM,EAAUsE,GAASgG,QAAQ1K,EAAMqM,OAAO,KAErCjM,IAAYN,GACdK,EAASC,IAOd,OAAO6B,IAGRA,EAAOqK,KAAO,SAASjH,GACtB,GAAIkH,GAAMtJ,EAAM3B,CAEhB,IAAG+D,EAAO,CACTkH,IAEA,KAAItJ,IAAQmB,IACX9C,EAAS8C,GAASnB,GAAM3B,OAErBA,EAAO+D,QAAUA,GAAS/D,EAAOwD,QAAUO,GAC7CkH,EAAKvK,KAAKiB,OAIZsJ,GAAOC,OAAOD,KAAKnI,GAGpB,OAAOmI,IAuDP,WACA,QAAS9I,KAQR,QAASgJ,GAAUrH,GAClB,GAAIpB,GAAK5D,EAASoB,CAElB,IAAG4D,EAAON,QAAUpE,GACnB,MAAO0E,GAAON,KAGf,KAAId,IAAOU,IAASI,MACnB1E,EAAUsE,GAASI,MAAMd,GAEO,IAA7BoB,EAAOnC,KAAKmJ,QAAQpI,MAAgBxC,GAASpB,EAAQwE,OAASpD,EAAMoD,UACtEpD,EAAQpB,EAIV,OAAOoB,GAAQA,EAAM6D,OAAQ,EAG9B,QAASqH,KACR7F,KAAK8F,MAAMC,UA1BZ,GAAIC,GAAuB,IAAMjJ,EAAY,IAC5CkJ,EAAuB,UACvBC,EAAuB,UACvBC,EAAuB1K,EAAwB,IAAMH,EAAwB0K,GAAkB,cAAgB1K,EAAwB2K,GAAwB,KAC/JG,EAAwB,WAAa,IAAM,MAAO,gBAAkB7N,IAAUA,EAAO6N,aAAgB,MAAMC,GAAa,OAAO,MAC/HC,EAAuBF,GAAgB,kBAAoBA,EA8H5D,OAtGAP,GAAQ9B,WACPnD,IAAK,SAASrC,GACb,GACCnE,GAAIoE,EAAO/D,EADR2B,EAAOmC,EAAOnC,IAGlB,IAAGgK,GAAgBR,EAAUrH,GAAS,CAKrC,GAJAnE,EAAS4L,EAAiB,IAAM5J,EAAO,IACvCoC,EAAS/F,EAAK8N,MAAMH,EAAaI,QAAQpM,EAAK6L,IAC9CxL,EAAS8D,EAAO1B,SAASpC,OAEtB+D,GAASA,EAAML,UAAYI,EAAOJ,SAAWK,EAAMxC,MAAQuC,EAAOvC,OAAUwC,EAAMiI,UAAYlI,EAAOH,UAAaI,EAAMiI,QAAU5K,KAMpI,MALApB,GAAOwD,MAAS,MAChBM,EAAOgD,OAAS6E,EAAaI,QAAQpM,EAAK8L,GAE1ChN,EAAK,WAAYqF,GAEVA,EAAOgD,MAEd9G,GAAOwD,MAAQ,OAEf/E,EAAK,YAAaqF,GAClByB,KAAK8F,MAAM1J,KAAKA,KAInBsF,IAAK,SAASnD,GACb,GACCH,GAAUhE,EAAIsM,EADXtK,EAAOmC,EAAOnC,IAGlB,IAAGgK,GAAgBR,EAAUrH,GAAS,CACrCrF,EAAK,WAAYqF,GAEjBH,EAAWG,EAAOH,SAClBhE,EAAW4L,EAAiB,IAAM5J,EAAO,IAEzCmC,EAAOC,OAAUL,QAASI,EAAOJ,QAASsI,QAASrI,EAAWvC,IAAiBuC,EAAWA,EAAUpC,IAAKuC,EAAOvC,IAEhH,KAOC,GANA0K,EAAcJ,EAAoBF,EAAaO,eAAiB9M,GAEhEuM,EAAaQ,QAAQxM,EAAK8L,EAAsB3H,EAAOgD,QACvD6E,EAAaQ,QAAQxM,EAAK6L,EAAsBxN,EAAKoO,UAAUtI,EAAOC,QAGnEkI,IAAgB7M,IAAQuM,EAAaO,iBAAmBD,EAC1D,KAAM,oBAGPxN,GAAK,YAAaqF,GACjB,MAAMxE,GACPb,EAAK,cAAeqF,MAIvBuH,OACC1J,KAAM,SAASA,GACd,GAAIhC,EAEDgM,KACFhM,EAAK4L,EAAiB,IAAM5J,EAAO,IAEnCgK,EAAaU,WAAW1M,EAAK6L,GAC7BG,EAAaU,WAAW1M,EAAK8L,GAE7BhN,EAAK,aAAckD,KAGrBf,IAAK,WACJ,GAAI8B,GAAKxC,CAET,IAAGyL,EACF,IAAIjJ,IAAOiJ,GACVzL,EAAQwC,EAAIxC,MAAMwL,GAEfxL,GACFqF,KAAK5D,KAAKzB,EAAM,KAKpBoL,QAAS,WACR,GAAI5I,GAAKxC,EAAO6D,CAEhB,IAAG4H,EACF,IAAIjJ,IAAOiJ,GACVzL,EAAQwC,EAAIxC,MAAMwL,GAEfxL,IACF6D,EAAQ/F,EAAK8N,MAAMH,EAAaI,QAAQR,EAAiB,IAAMrL,EAAM,GAAK,IAAMsL,IAE7EzH,GAASA,EAAMiI,QAAU,GAAKjI,EAAMiI,SAAW5K,KACjDmE,KAAK5D,KAAKzB,EAAM,QASvBS,EAAO0K,OAASnF,EAAU,GAAIkF,IAAWC,MAElCnF,EAGRrG,EAAQgJ,EAAuB1G,MAM/B,WACA,QAASA,KACR,GAAIgD,GAAsBpH,EAASuO,qBAAqB,QAAQ,GAC/DC,EAAsB,kEAEvB,QACC1F,UAAW,uCACXd,aAAc,WACb,GAAIxE,GAAOgE,KAAKhE,GAEhBgE,MAAKhE,IAAwB,QAAlBA,EAAIf,MAAM,IAAgBe,EAAM,MAAQA,GAEpDyF,cAAe,WACd,GAEC9G,GAAOsM,EAFJlH,EAASC,KACZuB,EAASxB,EAAKwB,MAGf,IAAGA,EAAQ,CACV,KAAM5G,EAAQqM,EAAoBE,KAAK3F,IACnCjF,GAAoBC,KAAK5B,EAAM,KACjCsB,GAASC,KAAO6D,EAAK/D,IAErBiL,EAAchL,GAASkL,SAAW,KAAOlL,GAASmL,KAAOzM,EAAM,IAE/DsM,EAAclL,EAAWgE,EAAK/D,IAAM,OAASrB,EAAM,IAGpD4G,EAASA,EAAO1G,QAAQF,EAAM,GAAI,wBAA0BsM,EAAc,OAG3ElH,GAAKwB,OAASA,IAGhBlD,QAAS,WACR,GACCgJ,GADG9F,EAASvB,KAAKuB,MAGfA,KACF8F,EAAe7O,EAASsL,cAAc,UACtCuD,EAAOC,OAAQ,EACfD,EAAOE,KAAQhG,EAEf8F,EAAOG,aAAa,cAAexH,KAAK5D,MAExCwD,EAAO6H,YAAYJ,MAMvB/M,EAAQgG,EAAwB,SAAU1D,MAM1C,WAIA,QAASA,GAAW8K,GACnB,QAASC,GAAgBC,GACxB/J,EAAWkB,EAAS6I,GAAWA,KAKhC,MAFAxM,GAAOgK,GAAG,iBAAmBhJ,EAAMuL,IAGlCrG,UAAeoG,EAAcpG,UAC7BG,cAAeiG,EAAcjG,cAC7B/C,aAAc,WACb,GAAIqB,GAAWC,KACdnD,EAAWkD,EAAKlD,SAChBgH,EAAWhG,EAASkC,EAAK3D,KAE1B7B,GAAYX,MAAMC,GAAMgK,GACtBtD,KACA,WACC5B,EAAMC,IAAIhF,MAAM,KAAMD,WACtB+N,EAAcrJ,QAAQ3E,KAAKqG,GAE3B3E,EACExB,MAAM,KAAMiK,GACZtD,KACA1D,EAASc,QACT,WACCd,EAAS6D,OAAO,GAAIQ,GAAO,kBAAmBnB,EAAK3D,KAAMzC,eAI7D,WACCkD,EAAS6D,OAAO,GAAIQ,GAAO,gBAAiB,KAAMvH,gBAlCxD,GACCkE,GADGzB,EAAOkE,EAAwB,QAyCnChG,GAAQ8B,GAAQ,0BAA4BQ,MAM5C,WAGA,QAASA,KAIR,QAAS+K,GAAgBC,GACxB,GAAG7I,EAAS6I,GAAU,CACrBhK,EAAQiC,OAAS,CAEjB,KAAI1C,IAAOyK,GACVhK,EAAQzC,MAAO0M,OAAQ1K,EAAKY,OAAQZ,EAAI0C,OAAQiI,GAAIF,EAAQzK,MAO/D,QAAS+C,GAAa9D,GAGrB,IAFA,GAAW7C,GAASoB,EAAhBtB,EAAI,EAEDE,EAAUqE,EAAQvE,GAAKA,IACO,IAAjC+C,EAAKmJ,QAAQhM,EAAQsO,WAAmBlN,GAASpB,EAAQwE,OAASpD,EAAMoD,UAC1EpD,EAAQpB,EAIV,OAAOoB,GAGR,QAASoN,GAAaxM,GAIrB,IAHA,GAAIyM,GAAO,KACV3O,EAAOkC,EAAMsE,OAERxG,GACL2O,EAAe,GAAPA,EAAazM,EAAM0M,aAAa5O,EAGzC,OAAO2O,KAAS,EAGjB,QAASE,GAAsBC,GAC9B,GAEQ5O,GAASoD,EAFbmB,EAAgBqK,EAAOrK,QAC1BsK,GAAkBxK,WAAaiG,SAAWwE,8BAC1ChP,EAAI,CAKL,KAHA+O,EAAcxK,QAAQuK,EAAO/N,IAAgC+N,EAAOL,GAAGhK,GACvEsK,EAAcvE,QAAQ,0BAA0BsE,EAAO/N,IAAMb,KAEtDoD,EAAamB,EAAQzE,GAAKA,IAChCE,EAAQ4B,KAAKwB,EAAWvC,GAGzB,OAAOgO,GAGR,QAASE,GAAUlM,GAClB,MAAQmB,IAASnB,IAASmB,GAASnB,GAAM3B,QAAYK,GAAMsB,IAAStB,GAAMsB,GAAM3B,OAtDjF,GACC0C,GADGS,IA2GJ,OA9FAxC,GAAOgK,GAAG,iBAAmBhJ,EAAMuL,GA4CnCvM,EAAOgK,GAAG,aAAc,SAAS3E,EAAcpE,GAC9C,GACChD,GAAGsD,EAAYvC,EAAIhB,EAAWwE,EAAS8H,EAAMmC,EAAQM,EAAQrK,EAD1DyK,IAGJ,KAAIlP,EAAI,EAAIsD,EAAa8D,EAAapH,GAAKA,IACvCW,EAAS2C,EAAY,YACvBvC,EAAK+B,EAAYQ,EAAYN,IAEzBiM,EAAUlO,KAAQhB,EAAYqE,EAAiBd,EAAYN,KAAmC,WAAtBjD,EAAU8E,UAAyBN,EAAUsC,EAAa9F,MACpImO,EAAQ3K,EAAQiK,UAAYU,EAAQ3K,EAAQiK,SAAYC,GAAIlK,EAAQkK,GAAIhK,cAAgBA,QAAQ3C,MAAOf,GAAIA,EAAIgC,KAAMO,EAAYyH,MAAO/K,EAAGmP,IAAK3O,KAOpJ,IAFA6L,EAAOC,OAAOD,KAAK6C,GAEhB7C,EAAK7F,OACP,IAAIgI,IAAUU,GAIb,GAHAJ,EAAYI,EAAQV,GACpB/J,EAAYqK,EAAOrK,QAEhBA,EAAQ+B,OAAS,EAAG,CAGtB,IAFAsI,EAAO/N,GAAK,UAAY2N,EAAatP,EAAKoO,UAAUsB,EAAOrK,UAEvDzE,EAAI,EAAIsD,EAAamB,EAAQzE,GAAKA,IACrCsD,EAAW6L,IAAsBzN,EAAOC,QACxCyF,EAAa9D,EAAWyH,OAASzH,EAAW6L,IAAI/N,OAEhDF,EAAYoC,EAAWvC,GAGxBgB,GAAO0J,UAAUoD,EAAsBC,IACvC/M,EAAO,UAAY+M,EAAO/N,IACxBmG,KACA,WACC,IAAIlH,EAAI,EAAIsD,EAAamB,EAAQzE,GAAKA,IACrCsD,EAAW6L,IAAI7K,QAAQhE,UAAUN,KAGnC,WACC,IAAIA,EAAI,EAAIsD,EAAamB,EAAQzE,GAAKA,IACrCsD,EAAW6L,IAAI9H,OAAO,GAAIQ,GAAO,kBAAmBvE,EAAWP,aAShE,EA9GR,GAAIA,GAAOmH,EAAuB,OAiHlCjJ,GAAQ8B,EAAMQ,MAQfH,EAAoBhB,EAAwB,IAAMH,EAAwBS,EAAW,OAErFX,EAAO0J,WAAY7G,OAAO,EAAM+G,KAAM,IAAKpH,SAAW6K,UAAW1M,GAAalD,GAAWA,EAAQmD,KAAQ0M,SAASxM,MAAQ,QAAQjB,MAAM,EAAG,OAC3IpC,GAAWA,EAAQgF,UAAYzC,EAAO0J,UAAUjM,EAAQgF,UAExD1D,EAAasJ,EAA0B,UAAW5E,GAClD1E,EAAasJ,EAA0B,WAAY1E,GACnD5E,EAAasJ,EAA0B,WAAYzJ,GACnDG,EAAasJ,EAA0B,eAAgB/F,GACvDvD,EAAasJ,EAA0B,oBAAqBvE,GAC5D/E,EAAaqJ,EAAyB,QAASlE,GAC/CnF,EAAakJ,EAAgB,SAAUtI,GACvCZ,EAAakJ,EAAgB,SAAUnC,GAEvCvC,EAAQ,GAAIkE,GAEZtK,EAAO6C,OAAUA,EACjB7C,EAAO+B,QAAUA,EAEdzB,GAAWA,EAAQ8P,MACrBvN,EAAOvC,EAAQ8P,OAEhB3I,KAAMxH,SAAUC,KAAMC,eAAgBC,WAAYC,aAAc,UAAYoH,OAAQ5E,OAAQyJ,MAAMd,UAAW4B,OAAO5B,UAAWrL","file":"demand.js","sourcesContent":["/**\n * Qoopido demand\n *\n * Promise like module loader (XHR) with localStorage caching\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(global, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, snippet, arrayPrototype, objectPrototype, XHR, undefined) {\n\t'use strict';\n\t\n\tvar /** pointer */\n\t\t\tarrayPrototypeSlice     = arrayPrototype.slice,\n\t\t\tarrayPrototypeConcat    = arrayPrototype.concat,\n\t\t\tobjectPrototypeToString = objectPrototype.toString,\n\t\t/** constants */\n\t\t\tDEMAND_ID               = 'demand',\n\t\t\tPROVIDE_ID              = 'provide',\n\t\t\tPATH_ID                 = 'path',\n\t\t\tMODULE_PREFIX           = '/' + DEMAND_ID + '/',\n\t\t\tMODULE_PREFIX_STORAGE   = MODULE_PREFIX + 'storage/',\n\t\t\tMODULE_PREFIX_HANDLER   = MODULE_PREFIX + 'handler/',\n\t\t\tMODULE_PREFIX_PLUGIN    = MODULE_PREFIX + 'plugin/',\n\t\t\tMODULE_PREFIX_LOCAL     = MODULE_PREFIX + 'local',\n\t\t\tMODULE_PREFIX_PATHS     = MODULE_PREFIX + 'paths',\n\t\t\tMODULE_PREFIX_FUNCTION  = MODULE_PREFIX + 'function/',\n\t\t\tMODULE_PREFIX_VALIDATOR = MODULE_PREFIX + 'validator/',\n\t\t\tPLEDGE_PENDING          = 'pending',\n\t\t\tPLEDGE_RESOLVED         = 'resolved',\n\t\t\tPLEDGE_REJECTED         = 'rejected',\n\t\t\tSTRING_STRING           = 'string',\n\t\t\tSTRING_BOOLEAN          = 'boolean',\n\t\t\tSTRING_FUNCTION         = 'function',\n\t\t\tNULL                    = null,\n\t\t\tXDR                     = 'XDomainRequest' in global &&  global.XDomainRequest || XHR,\n\t\t/** regular expressions */\n\t\t\tregexIsAbsolutePath     = /^\\//,\n\t\t\tregexIsAbsoluteUri      = /^(http(s?):)?\\/\\//i,\n\t\t\tregexMatchTrailingSlash = /(.+)\\/$/,\n\t\t\tregexMatchParameter     = /^(mock:)?([+-])?((?:[-\\w]+\\/?)+)?(?:@(\\d+\\.\\d+.\\d+))?(?:#(\\d+))?!/,\n\t\t\tregexMatchRegex         = /[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\n\t\t\tregexMatchEvent         = /^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Configure.*|Resolve|Request|Process|Cache)$/,\n\t\t/** other */\n\t\t\tsettings                = { cache: {}, timeout: 8 * 1000, pattern: {}, modules: {}, handler: 'module' },\n\t\t\tresolver                = document.createElement('a'),\n\t\t\tregistry                = {},\n\t\t\tmocks                   = {},\n\t\t\tlistener                = {},\n\t\t\tregexMatchBaseUrl, queue, storage;\n\t\n\t/**\n\t * --------------------------------\n\t * Utility functions (private)\n\t * --------------------------------\n\t */\n\t\tfunction emit(event) {\n\t\t\tvar pointer = listener[event],\n\t\t\t\tparameter, i, callback;\n\t\t\t\n\t\t\tif(pointer) {\n\t\t\t\tparameter = arrayPrototypeSlice.call(arguments, 1);\n\t\t\t\t\n\t\t\t\tfor(i = 0; (callback = pointer[i]); i++) {\n\t\t\t\t\tcallback.apply(NULL, parameter);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction log(error) {\n\t\t\t/* eslint-disable no-console */\n\t\t\tif(!isTypeOf(console, 'undefined')) {\n\t\t\t\tconsole.error(error.toString());\n\t\t\t}\n\t\t\t/* eslint-enable no-console */\n\t\t}\n\t\t\n\t\tfunction assignModule(id, factory) {\n\t\t\tprovide(id, function() { return factory; });\n\t\t}\n\t\n\t\tfunction mockModules() {\n\t\t\tvar pledges = [],\n\t\t\t\ti = 0, module, pledge, parameter;\n\t\t\t\n\t\t\tfor(; (module = arguments[i]); i++) {\n\t\t\t\tparameter    = module.match(regexMatchParameter);\n\t\t\t\tmodule       = module.replace(regexMatchParameter, '');\n\t\t\t\tpledge       = (mocks[module] || (mocks[module] = Pledge.defer())).pledge;\n\t\t\t\targuments[i] = (parameter ? 'mock:' + parameter.slice(1).join('')  : 'mock:') + '!' + module;\n\t\t\t\t\n\t\t\t\tpledges.push(pledge);\n\t\t\t}\n\t\t\t\n\t\t\tdemand.apply(NULL, arguments);\n\t\t\t\n\t\t\treturn Pledge.all(pledges);\n\t\t}\n\t\t\n\t\tfunction escapeRegularExpression(value) {\n\t\t\treturn value.replace(regexMatchRegex, '\\\\$&');\n\t\t}\n\t\t\n\t\tfunction createRegularExpression(expression, modifier) {\n\t\t\treturn new RegExp(expression, modifier);\n\t\t}\n\t\t\n\t\tfunction getTimestamp() {\n\t\t\treturn +new Date();\n\t\t}\n\t\t\n\t\tfunction resolveUrl(url) {\n\t\t\tresolver.href = url;\n\t\t\t\n\t\t\treturn resolver.href;\n\t\t}\n\t\t\n\t\tfunction resolvePath(path, context) {\n\t\t\tpath = path.replace(regexMatchParameter, '');\n\t\t\t\n\t\t\tif(!regexIsAbsolutePath.test(path) && !regexIsAbsoluteUri.test(path)) {\n\t\t\t\tpath = '/' + resolveUrl(((context && resolveUrl(context + '/../')) || '/') + path).replace(regexMatchBaseUrl, '');\n\t\t\t}\n\t\t\t\n\t\t\treturn path;\n\t\t}\n\t\t\n\t\tfunction resolveDependency(dependency, context) {\n\t\t\tvar path, definition, deferred;\n\t\t\t\n\t\t\tif(isTypeOf(dependency, STRING_STRING)) {\n\t\t\t\tpath = resolvePath(dependency, context);\n\t\t\t\t\n\t\t\t\tif(context && (dependency === DEMAND_ID || dependency === PROVIDE_ID || dependency === PATH_ID)) {\n\t\t\t\t\tswitch(dependency) {\n\t\t\t\t\t\tcase DEMAND_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\tvar scopedDemand = demand.bind(context),\n\t\t\t\t\t\t\t\t\tkey;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfor(key in demand) {\n\t\t\t\t\t\t\t\t\tscopedDemand[key] = demand[key];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn scopedDemand;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase PROVIDE_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\treturn provide.bind(context);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase PATH_ID:\n\t\t\t\t\t\t\tpath       = MODULE_PREFIX_PATHS + context;\n\t\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\t\treturn context;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t!registry[path] && provide(path, definition);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn (registry[path] || (registry[path] = new Loader(path, resolveParameter(dependency, context)))).pledge;\n\t\t\t} else {\n\t\t\t\tif(!isInstanceOf(dependency, Pledge)) {\n\t\t\t\t\tdeferred = Pledge.defer();\n\t\t\t\t\t\n\t\t\t\t\tdeferred.resolve(dependency);\n\t\t\t\t\t\n\t\t\t\t\treturn deferred.pledge;\n\t\t\t\t} else {\n\t\t\t\t\treturn dependency;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction resolveParameter(path, context) {\n\t\t\tvar parameter = path.match(regexMatchParameter),\n\t\t\t\tpattern   = settings.pattern,\n\t\t\t\tkey, match;\n\t\t\t\n\t\t\tpath = resolvePath(path, context);\n\t\t\t\n\t\t\tif(!regexIsAbsoluteUri.test(path)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tpattern[key].matches(path) && (!match || match.weight < pattern[key].weight) && (match = pattern[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn {\n\t\t\t\tmock:     (parameter && parameter[1]) ? true : false,\n\t\t\t\tcache:    (parameter && parameter[2]) ? parameter[2] === '+' : NULL,\n\t\t\t\thandler:  (parameter && parameter[3]) || settings.handler,\n\t\t\t\tversion:  (parameter && parameter[4]) || settings.version,\n\t\t\t\tlifetime: (parameter && parameter[5] && parameter[5] * 1000) || settings.lifetime,\n\t\t\t\turl:      match ? resolveUrl(match.process(path)) : path\n\t\t\t};\n\t\t}\n\t\t\n\t\tfunction resolveLoader(loader) {\n\t\t\tvar handler = loader.handler;\n\t\t\t\n\t\t\temit('preProcess', loader);\n\t\t\t\n\t\t\tif(loader.deferred.pledge.state === PLEDGE_PENDING) {\n\t\t\t\thandler.onPreProcess && handler.onPreProcess.call(loader);\n\t\t\t\thandler.process && queue.add(loader);\n\t\t\t}\n\t\t}\n\t\n\t/**\n\t * --------------------------------\n\t * Utility functions (public)\n\t * --------------------------------\n\t */\n\t\t/**\n\t\t * isArray\n\t\t *\n\t\t * Check whether a given value is of type array\n\t\t *\n\t\t * @param value\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isArray(value) {\n\t\t\treturn objectPrototypeToString.call(value) === '[object Array]';\n\t\t}\n\t\t\n\t\t/**\n\t\t * isObject\n\t\t *\n\t\t * Check whether a given object is of type object\n\t\t *\n\t\t * @param object\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isObject(object) {\n\t\t\treturn object && isTypeOf(object, 'object');\n\t\t}\n\t\t\n\t\t/**\n\t\t * isTypeOf\n\t\t *\n\t\t * Check whether a given object is of specified type\n\t\t *\n\t\t * @param object\n\t\t * @param {string} type\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isTypeOf(object, type) {\n\t\t\treturn typeof object === type;\n\t\t}\n\t\t\n\t\t/**\n\t\t * isInstanceOf\n\t\t *\n\t\t * Check whether a given object is an instance of specified type\n\t\t *\n\t\t * @param object\n\t\t * @param module\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isInstanceOf(object, module) {\n\t\t\treturn object instanceof module;\n\t\t}\n\t\t\n\t\t/**\n\t\t * isPositiveInteger\n\t\t *\n\t\t * Check whether a given value is a positive integer\n\t\t *\n\t\t * @param value\n\t\t *\n\t\t * @return {boolean}\n\t\t */\n\t\tfunction isPositiveInteger(value) {\n\t\t\treturn isTypeOf(value, 'number') && isFinite(value) && Math.floor(value) === value && value >= 0;\n\t\t}\n\t\n\t\t/**\n\t\t * merge\n\t\t *\n\t\t * Merge two or more objects into the first one passed in\n\t\t *\n\t\t * @param {...object} object\n\t\t *\n\t\t * @return {object}\n\t\t */\n\t\tfunction merge() {\n\t\t\tvar target = arguments[0],\n\t\t\t\ti = 1, properties, property, targetProperty, targetPropertyIsObject, sourceProperty;\n\t\t\t\n\t\t\tfor(; (properties = arguments[i]) !== undefined; i++) {\n\t\t\t\tfor(property in properties) {\n\t\t\t\t\ttargetProperty = target[property];\n\t\t\t\t\tsourceProperty = properties[property];\n\t\t\t\t\t\n\t\t\t\t\tif(sourceProperty !== undefined) {\n\t\t\t\t\t\tif(isObject(sourceProperty)) {\n\t\t\t\t\t\t\ttargetPropertyIsObject = isObject(targetProperty);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(sourceProperty.length !== undefined) {\n\t\t\t\t\t\t\t\ttargetProperty = (targetPropertyIsObject && targetProperty.length !== undefined) ? targetProperty : [];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ttargetProperty = (targetPropertyIsObject && targetProperty.length === undefined) ? targetProperty : {};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttarget[property] = merge(targetProperty, sourceProperty);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttarget[property] = sourceProperty;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn target;\n\t\t}\n\t\n\t/**\n\t * --------------------------------\n\t * Utility modules (private)\n\t * --------------------------------\n\t */\n\t\tfunction Pattern(pattern, url) {\n\t\t\tvar self = this;\n\t\t\t\n\t\t\tself.weight       = pattern.length;\n\t\t\tself.url          = resolveUrl(url).replace(regexMatchTrailingSlash, '$1');\n\t\t\tself.matchPattern = createRegularExpression('^' + escapeRegularExpression(pattern));\n\t\t\tself.matchUrl     = createRegularExpression('^' + escapeRegularExpression(url));\n\t\t}\n\t\t\n\t\tPattern.prototype = {\n\t\t\t/* only for reference\n\t\t\t weight:       0,\n\t\t\t url:          NULL,\n\t\t\t matchPattern: NULL,\n\t\t\t matchUrl:     NULL,\n\t\t\t */\n\t\t\tmatches: function(path) {\n\t\t\t\treturn this.matchPattern.test(path);\n\t\t\t},\n\t\t\tremove: function(url) {\n\t\t\t\treturn url.replace(this.matchUrl, '');\n\t\t\t},\n\t\t\tprocess: function(path) {\n\t\t\t\treturn path.replace(this.matchPattern, this.url);\n\t\t\t}\n\t\t};\n\t\t\n\t\tfunction Loader(path, parameter) {\n\t\t\tvar self     = this,\n\t\t\t\tdeferred = Pledge.defer(),\n\t\t\t\tpledge   = deferred.pledge,\n\t\t\t\thandler  = parameter.handler,\n\t\t\t\txhr, timeout;\n\t\t\t\n\t\t\tself.deferred = deferred;\n\t\t\tself.path     = path;\n\t\t\tself.url      = parameter.url;\n\t\t\tself.cache    = parameter.cache;\n\t\t\tself.version  = parameter.version;\n\t\t\tself.lifetime = parameter.lifetime;\n\t\t\t\n\t\t\tdemand(MODULE_PREFIX_HANDLER + handler)\n\t\t\t\t.then(\n\t\t\t\t\tfunction(handler) {\n\t\t\t\t\t\tself.handler = handler;\n\t\t\t\t\t\tself.mock    = parameter.mock ? mocks[self.path] : NULL;\n\t\t\t\t\t\t\n\t\t\t\t\t\thandler.onPreRequest && handler.onPreRequest.call(self);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!self.mock) {\n\t\t\t\t\t\t\tif(self.cache === false || !storage.get(self)) {\n\t\t\t\t\t\t\t\temit('preRequest', self);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\t\t\t\t\txhr = regexMatchBaseUrl.test(self.url) ? new XHR() : new XDR();\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\txhr.onprogress = function() {};\n\t\t\t\t\t\t\t\t\txhr.ontimeout = xhr.onerror = xhr.onabort = function() {\n\t\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('timeout requesting', self.path));\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\txhr.onload = function() {\n\t\t\t\t\t\t\t\t\t\tvar type = xhr.getResponseHeader && xhr.getResponseHeader('content-type');\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\ttimeout = clearTimeout(timeout);\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif((!('status' in xhr) || xhr.status === 200) && (!type || !handler.matchType || handler.matchType.test(type))) {\n\t\t\t\t\t\t\t\t\t\t\tself.source = xhr.responseText;\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\temit('postRequest', self);\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\t\t\t\t\t\t\t\thandler.onPostRequest && handler.onPostRequest.call(self);\n\t\t\t\t\t\t\t\t\t\t\t\tresolveLoader(self);\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\tif(self.cache !== false) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpledge.then(function() { storage.set(self); });\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error requesting', self.path));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\txhr.open('GET', self.url, true);\n\t\t\t\t\t\t\t\t\txhr.send();\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\t\t\t\t\tif(xhr.readyState < 4) {\n\t\t\t\t\t\t\t\t\t\t\txhr.abort();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, settings.timeout);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\tresolveLoader(self);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(self.mock.dependencies) {\n\t\t\t\t\t\t\t\tself.mock.dependencies.then(\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tself.mock.reject\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tdeferred.reject\n\t\t\t\t);\n\t\t\t\n\t\t\treturn deferred;\n\t\t}\n\t\t\n\t\t/* only for reference\n\t\t Loader.prototype = {\n\t\t\t deferred: NULL,\n\t\t\t path:     NULL,\n\t\t\t url:      NULL,\n\t\t\t handler:  NULL,\n\t\t\t source:   NULL,\n\t\t\t mock:     NULL,\n\t\t\t cache:    NULL,\n\t\t\t lifetime: NULL,\n\t\t\t version:  NULL,\n\t\t\t state:    { version: NULL, expires: NULL, url: NULL } // will only be set by storage\n\t\t };\n\t\t */\n\t\n\t/**\n\t * --------------------------------\n\t * Utility modules (public)\n\t * --------------------------------\n\t */\n\t\t/**\n\t\t * Pledge\n\t\t *\n\t\t * @param {function} executor\n\t\t *\n\t\t * @constructor\n\t\t */\n\t\tfunction Pledge(executor) {\n\t\t\tvar self     = this,\n\t\t\t\tlistener = { resolved: [], rejected: [] };\n\t\t\t\n\t\t\tfunction resolve() {\n\t\t\t\thandle(PLEDGE_RESOLVED, arguments);\n\t\t\t}\n\t\t\t\n\t\t\tfunction reject() {\n\t\t\t\thandle(PLEDGE_REJECTED, arguments);\n\t\t\t}\n\t\t\t\n\t\t\tfunction handle(aState, aParameter) {\n\t\t\t\tvar pointer, result;\n\t\t\t\t\n\t\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\t\tself.state = aState;\n\t\t\t\t\tself.value = aParameter;\n\t\t\t\t\t\n\t\t\t\t\twhile(pointer = listener[aState].shift()) {\n\t\t\t\t\t\tresult = pointer.handler.apply(NULL, aParameter);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(result && typeof result.then === 'function') {\n\t\t\t\t\t\t\tresult.then(pointer.deferred.resolve, pointer.deferred.reject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointer.deferred.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlistener = NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tself.then = function(aResolved, aRejected) {\n\t\t\t\tvar deferred = Pledge.defer();\n\t\t\t\t\n\t\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\t\taResolved && listener[PLEDGE_RESOLVED].push({ handler: aResolved, deferred: deferred });\n\t\t\t\t\taRejected && listener[PLEDGE_REJECTED].push({ handler: aRejected, deferred: deferred });\n\t\t\t\t} else {\n\t\t\t\t\tswitch(self.state) {\n\t\t\t\t\t\tcase PLEDGE_RESOLVED:\n\t\t\t\t\t\t\tdeferred.resolve(aResolved && aResolved.apply(NULL, self.value));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase PLEDGE_REJECTED:\n\t\t\t\t\t\t\tdeferred.reject(aRejected && aRejected.apply(NULL, self.value));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn deferred.pledge;\n\t\t\t};\n\t\t\t\n\t\t\texecutor(resolve, reject);\n\t\t}\n\t\t\n\t\tPledge.prototype = {\n\t\t\tstate:  PLEDGE_PENDING\n\t\t\t/* only for reference\n\t\t\t value:  NULL,\n\t\t\t then:   NULL,\n\t\t\t cache:  NULL, // will only be set by storage\n\t\t\t */\n\t\t};\n\t\t\n\t\tPledge.defer = function() {\n\t\t\tvar self = {};\n\t\t\t\n\t\t\tself.pledge = new Pledge(function(aResolve, aReject) {\n\t\t\t\tself.resolve = aResolve;\n\t\t\t\tself.reject  = aReject;\n\t\t\t});\n\t\t\t\n\t\t\treturn self;\n\t\t};\n\t\t\n\t\tPledge.all = function(pledges) {\n\t\t\tvar deferred      = Pledge.defer(),\n\t\t\t\tresolved      = [],\n\t\t\t\trejected      = [],\n\t\t\t\tcountTotal    = pledges.length,\n\t\t\t\tcountResolved = 0,\n\t\t\t\ti = 0, pledge;\n\t\t\t\n\t\t\tfunction observePledge(index, pledge) {\n\t\t\t\tpledge.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tresolved[index] = arrayPrototypeSlice.call(arguments);\n\t\t\t\t\t\t\n\t\t\t\t\t\tcountResolved++;\n\t\t\t\t\t\t\n\t\t\t\t\t\tcheckState();\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\trejected.push(arrayPrototypeSlice.call(arguments));\n\t\t\t\t\t\t\n\t\t\t\t\t\tcheckState();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\tfunction checkState() {\n\t\t\t\tif(countResolved === countTotal) {\n\t\t\t\t\tdeferred.resolve.apply(NULL, arrayPrototypeConcat.apply([], resolved));\n\t\t\t\t} else if(rejected.length + countResolved === countTotal) {\n\t\t\t\t\tdeferred.reject.apply(NULL, arrayPrototypeConcat.apply([], rejected));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfor(; pledge = pledges[i]; i++) {\n\t\t\t\tobservePledge(i, pledge);\n\t\t\t}\n\t\t\t\n\t\t\treturn deferred.pledge;\n\t\t};\n\t\t\n\t\tPledge.race = function(pledges) {\n\t\t\tvar deferred = Pledge.defer(),\n\t\t\t\ti = 0, pledge;\n\t\t\t\n\t\t\tfor(; pledge = pledges[i]; i++) {\n\t\t\t\tpledge.then(deferred.resolve, deferred.reject);\n\t\t\t}\n\t\t\t\n\t\t\treturn deferred.pledge;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Reason\n\t\t *\n\t\t * @param message\n\t\t * @param module\n\t\t * @param stack\n\t\t *\n\t\t * @constructor\n\t\t */\n\t\tfunction Reason(message, module, stack) {\n\t\t\tthis.message = message;\n\t\t\t\n\t\t\tmodule && (this.module = module);\n\t\t\tstack && (this.stack = arrayPrototypeSlice.call(stack));\n\t\t}\n\t\t\n\t\tReason.prototype = {\n\t\t\t/* only for reference\n\t\t\t message: NULL,\n\t\t\t module:  NULL,\n\t\t\t stack:   NULL,\n\t\t\t */\n\t\t\ttoString: function() {\n\t\t\t\tvar self   = this,\n\t\t\t\t\tresult = DEMAND_ID + ': ' + self.message + ' ' + (self.module ? '\"' + self.module + '\"' : '');\n\t\t\t\t\n\t\t\t\tif(self.stack) {\n\t\t\t\t\tresult = Reason.traverse(self.stack, result, 1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn result;\n\t\t\t}\n\t\t};\n\t\t\n\t\tReason.traverse = function(stack, value, depth) {\n\t\t\tvar indention = new Array(depth + 1).join(' '),\n\t\t\t\ti = 0, item;\n\t\t\t\n\t\t\tfor(; item = stack[i]; i++) {\n\t\t\t\tvalue += '\\n' + indention + '> ' + item.message + ' ' + (item.module ? '\"' + item.module + '\"' : '');\n\t\t\t\t\n\t\t\t\tif(item.stack) {\n\t\t\t\t\tvalue = Reason.traverse(item.stack, value, depth + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn value;\n\t\t};\n\t\t\n\t\t/**\n\t\t * Queue\n\t\t *\n\t\t * @constructor\n\t\t */\n\t\tfunction Queue() {\n\t\t\tthis.items = 0;\n\t\t\tthis.stack = [];\n\t\t}\n\t\t\n\t\tQueue.prototype = {\n\t\t\t/* only for reference\n\t\t\t items:   NULL,\n\t\t\t queue:   NULL,\n\t\t\t current: NULL,\n\t\t\t */\n\t\t\tadd: function() {\n\t\t\t\tqueue.stack  = queue.stack.concat(arrayPrototypeSlice.call(arguments));\n\t\t\t\tqueue.items += arguments.length;\n\t\t\t\t\n\t\t\t\t!queue.current && queue.process();\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar current;\n\t\t\t\t\n\t\t\t\tif(queue.items) {\n\t\t\t\t\tqueue.items--;\n\t\t\t\t\t\n\t\t\t\t\tcurrent = queue.current = queue.stack.shift();\n\t\t\t\t\t\n\t\t\t\t\tcurrent.handler.process.call(current);\n\t\t\t\t\temit('postProcess', current);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\n\t\n\t/**\n\t * --------------------------------\n\t * Demand\n\t * --------------------------------\n\t */\n\t\tfunction demand() {\n\t\t\tvar dependencies = arrayPrototypeSlice.call(arguments),\n\t\t\t\tcontext      = this !== window ? this : NULL,\n\t\t\t\ti = 0, dependency;\n\t\t\t\n\t\t\temit('preResolve', dependencies, context);\n\t\t\t\n\t\t\tfor(; (dependency = dependencies[i]); i++) {\n\t\t\t\tdependencies[i] = resolveDependency(dependency, context);\n\t\t\t}\n\t\t\t\n\t\t\temit('postResolve', dependencies, context);\n\t\t\t\n\t\t\treturn Pledge.all(dependencies);\n\t\t}\n\t\t\n\t\tdemand.configure = function(parameter) {\n\t\t\tvar cache    = parameter.cache,\n\t\t\t\tversion  = parameter.version,\n\t\t\t\ttimeout  = parameter.timeout,\n\t\t\t\tlifetime = parameter.lifetime,\n\t\t\t\tbase     = parameter.base,\n\t\t\t\tpattern  = parameter.pattern,\n\t\t\t\tmodules  = parameter.modules,\n\t\t\t\tpointer  = settings.modules,\n\t\t\t\tkey, temp;\n\t\t\t\n\t\t\tif(isTypeOf(cache, STRING_BOOLEAN)) {\n\t\t\t\tsettings.cache[''] = { weight: 0, state: cache };\n\t\t\t} else if(isObject(cache)) {\n\t\t\t\tfor(key in cache) {\n\t\t\t\t\tsettings.cache[key] = { weight: key.length, state: cache[key] };\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif(isTypeOf(version, STRING_STRING)) {\n\t\t\t\tsettings.version = version;\n\t\t\t}\n\t\t\t\n\t\t\tif(isPositiveInteger(timeout)) {\n\t\t\t\tsettings.timeout = Math.min(Math.max(timeout, 2), 12) * 1000;\n\t\t\t}\n\t\t\t\n\t\t\tif(isPositiveInteger(lifetime) && lifetime > 0) {\n\t\t\t\tsettings.lifetime = lifetime * 1000;\n\t\t\t}\n\t\t\t\n\t\t\tif(isTypeOf(base, STRING_STRING) && base !== '') {\n\t\t\t\tsettings.pattern.base = new Pattern('', base);\n\t\t\t}\n\t\t\t\n\t\t\tif(isObject(pattern)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tkey !== 'base' && (settings.pattern[key] = new Pattern(key, pattern[key]));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif(isObject(modules)) {\n\t\t\t\tfor(key in modules) {\n\t\t\t\t\tif(key !== MODULE_PREFIX_STORAGE) {\n\t\t\t\t\t\ttemp = pointer[key] = pointer[key] || {};\n\t\t\t\t\t\t\n\t\t\t\t\t\temit('preConfigure:' + key, temp);\n\t\t\t\t\t\t\n\t\t\t\t\t\tmerge(temp, modules[key]);\n\t\t\t\t\t\t\n\t\t\t\t\t\temit('postConfigure:' + key, temp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn demand;\n\t\t};\n\t\t\n\t\tdemand.remove = function(path) {\n\t\t\tif(registry[path]) {\n\t\t\t\t!!registry[path].cache && storage.clean.path(path);\n\t\t\t\t\n\t\t\t\tdelete registry[path];\n\t\t\t\tdelete mocks[path];\n\t\t\t}\n\t\t\t\n\t\t\treturn demand;\n\t\t};\n\t\t\n\t\tdemand.on = function(events, callback) {\n\t\t\tvar event, pointer;\n\t\t\t\n\t\t\tif(isTypeOf(events, STRING_STRING) && isTypeOf(callback, STRING_FUNCTION)) {\n\t\t\t\tevents = events.split(' ');\n\t\t\t\t\n\t\t\t\twhile(event = events.shift()) {\n\t\t\t\t\tif(regexMatchEvent.test(event)) {\n\t\t\t\t\t\t(listener[event] || (listener[event] = [])).push(callback);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(event.indexOf('postConfigure:') === 0) {\n\t\t\t\t\t\t\tpointer = settings.modules[event.substr(14)];\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(pointer !== undefined) {\n\t\t\t\t\t\t\t\tcallback(pointer);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\treturn demand;\n\t\t};\n\t\t\n\t\tdemand.list = function(state) {\n\t\t\tvar keys, path, pledge;\n\t\t\t\n\t\t\tif(state) {\n\t\t\t\tkeys = [];\n\t\t\t\t\n\t\t\t\tfor(path in registry) {\n\t\t\t\t\tpledge = registry[path].pledge;\n\t\t\t\t\t\n\t\t\t\t\tif(pledge.state === state || pledge.cache === state) {\n\t\t\t\t\t\tkeys.push(path);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tkeys = Object.keys(registry);\n\t\t\t}\n\t\t\t\n\t\t\treturn keys;\n\t\t};\n\n\t\t\n\t/**\n\t * --------------------------------\n\t * Provide\n\t * --------------------------------\n\t */\n\t\tfunction provide() {\n\t\t\tvar parameter    = arguments,\n\t\t\t\tpath         = isTypeOf(parameter[0], STRING_STRING) ? parameter[0] : NULL,\n\t\t\t\tdependencies = isArray(parameter[path ? 1 : 0]) ? parameter[path ? 1 : 0] : NULL,\n\t\t\t\tdefinition   = dependencies ? parameter[path ? 2 : 1] : parameter[path ? 1 : 0],\n\t\t\t\tdeferred, pledge, isFunction;\n\t\t\t\n\t\t\tif(!path && queue.current) {\n\t\t\t\tpath = queue.current.path;\n\t\t\t\t\n\t\t\t\tqueue.current = NULL;\n\t\t\t\t\n\t\t\t\tqueue.items > 0 && queue.process();\n\t\t\t}\n\t\t\t\n\t\t\tif(path) {\n\t\t\t\tpath       = resolvePath(path, this);\n\t\t\t\tdeferred   = registry[path] || (registry[path] = Pledge.defer());\n\t\t\t\tpledge     = deferred.pledge;\n\t\t\t\tisFunction = isTypeOf(definition, STRING_FUNCTION);\n\t\t\t\t\n\t\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\t\tif(dependencies) {\n\t\t\t\t\t\tdemand\n\t\t\t\t\t\t\t.apply(path, dependencies)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tfunction() { deferred.resolve(isFunction ? definition.apply(NULL, arguments) : definition); },\n\t\t\t\t\t\t\t\tfunction() { log(new Reason('error providing', path, arguments)); }\n\t\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdeferred.resolve(isFunction ? definition() : definition);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow 'unspecified anonymous provide';\n\t\t\t}\n\t\t}\n\t\n\t/**\n\t * --------------------------------\n\t * Inline modules\n\t * --------------------------------\n\t */\n\t\t/**\n\t\t * /demand/storage\n\t\t */\n\t\t(function(){\n\t\t\tfunction definition() {\n\t\t\t\tvar STORAGE_PREFIX       = '[' + DEMAND_ID + ']',\n\t\t\t\t\tSTORAGE_SUFFIX_STATE = '[state]',\n\t\t\t\t\tSTORAGE_SUFFIX_VALUE = '[value]',\n\t\t\t\t\tregexMatchState      = createRegularExpression('^' + escapeRegularExpression(STORAGE_PREFIX) + '\\\\[(.+?)\\\\]' + escapeRegularExpression(STORAGE_SUFFIX_STATE) + '$'),\n\t\t\t\t\tlocalStorage         = (function() { try { return 'localStorage' in global && global.localStorage; } catch(exception) { return false; } }()),\n\t\t\t\t\thasRemainingSpace    = localStorage && 'remainingSpace' in localStorage;\n\t\t\t\t\n\t\t\t\tfunction isEnabled(loader) {\n\t\t\t\t\tvar key, pointer, match;\n\t\t\t\t\t\n\t\t\t\t\tif(loader.cache !== NULL) {\n\t\t\t\t\t\treturn loader.cache;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfor(key in settings.cache) {\n\t\t\t\t\t\tpointer = settings.cache[key];\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(loader.path.indexOf(key) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\t\t\tmatch = pointer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn match ? match.state : false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction Storage() {\n\t\t\t\t\tthis.clear.expired();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tStorage.prototype = {\n\t\t\t\t\tget: function(loader) {\n\t\t\t\t\t\tvar path = loader.path,\n\t\t\t\t\t\t\tid, state, pledge;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(localStorage && isEnabled(loader)) {\n\t\t\t\t\t\t\tid     = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\t\tstate  = JSON.parse(localStorage.getItem(id + STORAGE_SUFFIX_STATE));\n\t\t\t\t\t\t\tpledge = loader.deferred.pledge;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(state && state.version === loader.version && state.url === loader.url && ((!state.expires && !loader.lifetime) || state.expires > getTimestamp())) {\n\t\t\t\t\t\t\t\tpledge.cache  = 'hit';\n\t\t\t\t\t\t\t\tloader.source = localStorage.getItem(id + STORAGE_SUFFIX_VALUE);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\temit('cacheHit', loader);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn loader.source;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpledge.cache = 'miss';\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\temit('cacheMiss', loader);\n\t\t\t\t\t\t\t\tthis.clear.path(path);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tset: function(loader) {\n\t\t\t\t\t\tvar path = loader.path,\n\t\t\t\t\t\t\tlifetime, id, spaceBefore;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(localStorage && isEnabled(loader)) {\n\t\t\t\t\t\t\temit('preCache', loader);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tlifetime = loader.lifetime;\n\t\t\t\t\t\t\tid       = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tloader.state = { version: loader.version, expires: lifetime ? getTimestamp() + lifetime : lifetime, url: loader.url };\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tspaceBefore = hasRemainingSpace ? localStorage.remainingSpace : NULL;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_VALUE, loader.source);\n\t\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_STATE, JSON.stringify(loader.state));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// strict equality check with \"===\" is required due to spaceBefore might be \"0\"\n\t\t\t\t\t\t\t\tif(spaceBefore !== NULL && localStorage.remainingSpace === spaceBefore) {\n\t\t\t\t\t\t\t\t\tthrow 'QUOTA_EXCEEDED_ERR';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\temit('postCache', loader);\n\t\t\t\t\t\t\t} catch(error) {\n\t\t\t\t\t\t\t\temit('cacheExceed', loader);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tclear: {\n\t\t\t\t\t\tpath: function(path) {\n\t\t\t\t\t\t\tvar id;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\t\tid = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_STATE);\n\t\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_VALUE);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\temit('cacheClear', path);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tall: function() {\n\t\t\t\t\t\t\tvar key, match;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpired: function() {\n\t\t\t\t\t\t\tvar key, match, state;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '[' + match[1] + ']' + STORAGE_SUFFIX_STATE));\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif(state && state.expires > 0 && state.expires <= getTimestamp()) {\n\t\t\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tdemand.clear = (storage = new Storage()).clear;\n\t\t\t\t\n\t\t\t\treturn storage;\n\t\t\t}\n\t\t\t\n\t\t\tprovide(MODULE_PREFIX_STORAGE, definition);\n\t\t}());\n\t\n\t\t/**\n\t\t * /demand/handler/module\n\t\t */\n\t\t(function() {\n\t\t\tfunction definition() {\n\t\t\t\tvar target              = document.getElementsByTagName('head')[0],\n\t\t\t\t\tregexMatchSourcemap = /\\/\\/#\\s+sourceMappingURL\\s*=\\s*(?!(?:http[s]?:)?\\/\\/)(.+?)\\.map/g;\n\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t\tmatchType: /^(application|text)\\/(x-)?javascript/,\n\t\t\t\t\tonPreRequest: function() {\n\t\t\t\t\t\tvar url  = this.url;\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.url = url.slice(-3) !== '.js' ? url + '.js' : url;\n\t\t\t\t\t},\n\t\t\t\t\tonPostRequest: function() {\n\t\t\t\t\t\tvar self   = this,\n\t\t\t\t\t\t\tsource = self.source,\n\t\t\t\t\t\t\tmatch, replacement;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(source) {\n\t\t\t\t\t\t\twhile(match = regexMatchSourcemap.exec(source)) {\n\t\t\t\t\t\t\t\tif(regexIsAbsolutePath.test(match[1])) {\n\t\t\t\t\t\t\t\t\tresolver.href = self.url;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\treplacement = resolver.protocol + '//' + resolver.host + match[1];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treplacement = resolveUrl(self.url + '/../' + match[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tsource = source.replace(match[0], '//# sourceMappingURL=' + replacement + '.map');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tself.source = source;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tprocess: function() {\n\t\t\t\t\t\tvar source = this.source,\n\t\t\t\t\t\t\tscript;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(source) {\n\t\t\t\t\t\t\tscript       = document.createElement('script');\n\t\t\t\t\t\t\tscript.async = true;\n\t\t\t\t\t\t\tscript.text  = source;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tscript.setAttribute('demand-path', this.path);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttarget.appendChild(script);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\t\n\t\t\tprovide(MODULE_PREFIX_HANDLER + 'module', definition);\n\t\t}());\n\t\t\n\t\t/**\n\t\t * /demand/handler/bundle\n\t\t */\n\t\t(function() {\n\t\t\tvar path = MODULE_PREFIX_HANDLER + 'bundle',\n\t\t\t\tsettings;\n\t\t\t\n\t\t\tfunction definition(handlerModule) {\n\t\t\t\tfunction onPostConfigure(options) {\n\t\t\t\t\tsettings = isObject(options) ? options : {};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdemand.on('postConfigure:' + path, onPostConfigure);\n\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t\tmatchType:     handlerModule.matchType,\n\t\t\t\t\tonPostRequest: handlerModule.onPostRequest,\n\t\t\t\t\tonPreProcess: function() {\n\t\t\t\t\t\tvar self     = this,\n\t\t\t\t\t\t\tdeferred = self.deferred,\n\t\t\t\t\t\t\tmodules  = settings[self.path];\n\t\t\t\t\t\t\n\t\t\t\t\t\tmockModules.apply(NULL, modules)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\tqueue.add.apply(null, arguments);\n\t\t\t\t\t\t\t\t\thandlerModule.process.call(self);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tdemand\n\t\t\t\t\t\t\t\t\t\t.apply(null, modules)\n\t\t\t\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\t\t\t\tdeferred.resolve,\n\t\t\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error resolving', self.path, arguments));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error mocking', null, arguments));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t\t\n\t\t\tprovide(path, [ '/demand/handler/module' ], definition);\n\t\t}());\n\t\t\n\t\t/**\n\t\t * /demand/plugin/genie\n\t\t */\n\t\t(function() {\n\t\t\tvar path = MODULE_PREFIX_PLUGIN + 'genie';\n\t\t\t\n\t\t\tfunction definition() {\n\t\t\t\tvar pattern = [],\n\t\t\t\t\tkey;\n\t\t\t\t\n\t\t\t\tfunction onPostConfigure(options) {\n\t\t\t\t\tif(isObject(options)) {\n\t\t\t\t\t\tpattern.length = 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor(key in options) {\n\t\t\t\t\t\t\tpattern.push({ prefix: key, weight: key.length, fn: options[key] });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdemand.on('postConfigure:' + path, onPostConfigure);\n\t\t\t\t\n\t\t\t\tfunction matchPattern(path) {\n\t\t\t\t\tvar i = 0, pointer, match;\n\t\t\t\t\t\n\t\t\t\t\tfor(; (pointer = pattern[i]); i++) {\n\t\t\t\t\t\tif(path.indexOf(pointer.prefix) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\t\t\tmatch = pointer;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction generateHash(value){\n\t\t\t\t\tvar hash = 5381,\n\t\t\t\t\t\ti    = value.length;\n\t\t\t\t\t\n\t\t\t\t\twhile(i) {\n\t\t\t\t\t\thash = (hash * 33) ^ value.charCodeAt(--i);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn hash >>> 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction generateConfiguration(bundle) {\n\t\t\t\t\tvar matches       = bundle.matches,\n\t\t\t\t\t\tconfiguration = { pattern: {}, modules: { '/demand/handler/bundle': {} } },\n\t\t\t\t\t\ti = 0, pointer, dependency;\n\t\t\t\t\t\n\t\t\t\t\tconfiguration.pattern[bundle.id]                           = bundle.fn(matches);\n\t\t\t\t\tconfiguration.modules['/demand/handler/bundle'][bundle.id] = pointer = [];\n\t\t\t\t\t\n\t\t\t\t\tfor(; (dependency = matches[i]); i++) {\n\t\t\t\t\t\tpointer.push(dependency.id);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn configuration;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction getModule(path) {\n\t\t\t\t\treturn (registry[path] && registry[path].pledge) || (mocks[path] && mocks[path].pledge);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tdemand.on('preResolve', function(dependencies, context) {\n\t\t\t\t\tvar bundles = {},\n\t\t\t\t\t\ti, dependency, id, parameter, pattern, keys, prefix, bundle, matches;\n\t\t\t\t\t\n\t\t\t\t\tfor(i = 0; (dependency = dependencies[i]); i++) {\n\t\t\t\t\t\tif(isTypeOf(dependency, 'string')) {\n\t\t\t\t\t\t\tid = resolvePath(dependency, context);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(!getModule(id) && (parameter = resolveParameter(dependency, context)) && parameter.handler === 'module' && (pattern = matchPattern(id))) {\n\t\t\t\t\t\t\t\t(bundles[pattern.prefix] || (bundles[pattern.prefix] = { fn: pattern.fn, matches: [] })).matches.push({ id: id, path: dependency, index: i, dfd: NULL });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tkeys = Object.keys(bundles);\n\t\t\t\t\t\n\t\t\t\t\tif(keys.length) {\n\t\t\t\t\t\tfor(prefix in bundles) {\n\t\t\t\t\t\t\tbundle    = bundles[prefix];\n\t\t\t\t\t\t\tmatches   = bundle.matches;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(matches.length > 1) {\n\t\t\t\t\t\t\t\tbundle.id = '/genie/' + generateHash(JSON.stringify(bundle.matches));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tfor(i = 0; (dependency = matches[i]); i++) {\n\t\t\t\t\t\t\t\t\tdependency.dfd                 = Pledge.defer();\n\t\t\t\t\t\t\t\t\tdependencies[dependency.index] = dependency.dfd.pledge;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tmockModules(dependency.id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdemand.configure(generateConfiguration(bundle));\n\t\t\t\t\t\t\t\tdemand('bundle!' + bundle.id)\n\t\t\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t\tfor(i = 0; (dependency = matches[i]); i++) {\n\t\t\t\t\t\t\t\t\t\t\t\tdependency.dfd.resolve(arguments[i]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t\tfor(i = 0; (dependency = matches[i]); i++) {\n\t\t\t\t\t\t\t\t\t\t\t\tdependency.dfd.reject(new Reason('error resolving', dependency.path));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\tprovide(path, definition);\n\t\t}());\n\t\t\n\t/**\n\t * --------------------------------\n\t * Initialization\n\t * --------------------------------\n\t */\n\t\tregexMatchBaseUrl = createRegularExpression('^' + escapeRegularExpression(resolveUrl('/')));\n\t\t\n\t\tdemand.configure({ cache: true, base: '/', pattern: { '/demand': resolveUrl(((snippet && snippet.url) || location.href) + '/../').slice(0, -1)} });\n\t\tsnippet && snippet.settings && demand.configure(snippet.settings);\n\t\t\n\t\tassignModule(MODULE_PREFIX_VALIDATOR + 'isArray', isArray);\n\t\tassignModule(MODULE_PREFIX_VALIDATOR + 'isObject', isObject);\n\t\tassignModule(MODULE_PREFIX_VALIDATOR + 'isTypeOf', isTypeOf);\n\t\tassignModule(MODULE_PREFIX_VALIDATOR + 'isInstanceOf', isInstanceOf);\n\t\tassignModule(MODULE_PREFIX_VALIDATOR + 'isPositiveInteger', isPositiveInteger);\n\t\tassignModule(MODULE_PREFIX_FUNCTION + 'merge', merge);\n\t\tassignModule(MODULE_PREFIX + 'pledge', Pledge);\n\t\tassignModule(MODULE_PREFIX + 'reason', Reason);\n\t\t\n\t\tqueue = new Queue();\n\t\t\n\t\tglobal.demand  = demand;\n\t\tglobal.provide = provide;\n\t\t\n\t\tif(snippet && snippet.main) {\n\t\t\tdemand(snippet.main);\n\t\t}\n}(this, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, 'demand' in this && demand, Array.prototype, Object.prototype, XMLHttpRequest));"],"sourceRoot":"/source/"}