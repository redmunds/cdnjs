{"version":3,"sources":["legacy.js","handler/legacy.js"],"names":["setTimeout","definition","path","Reason","handlerModule","isObject","onPostConfigure","options","settings","finalize","deferred","result","self","this","probe","process","call","pledge","state","provide","reject","demand","on","matchType","onPreRequest","dependencies","apply","then","arguments","mock","onPostRequest","resolve","bind"],"mappings":"AAAA;AACA,CCWC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAMC,EAAQC,EAAeC,GAGhD,QAASC,GAAgBC,GACxBC,EAAWH,EAASE,GAAWA,KAKhC,QAASE,KACR,GAECC,GAAUC,EAFPC,EAAQC,KACXC,EAAQN,EAASI,EAAKV,OAASM,EAASI,EAAKV,MAAMY,KAGpDV,GAAcW,QAAQC,KAAKJ,GAExBE,GACFd,EAAW,WACVU,EAAWE,EAAKF,SAEa,YAA1BA,EAASO,OAAOC,SACfP,EAASG,KACXK,QAAQ,WAAa,MAAOR,KAE5BD,EAASU,OAAO,GAAIjB,GAAO,gBAAiBS,EAAKV,UAvBtD,GAAIM,EA8BJ,OAxBAa,QAAOC,GAAG,iBAAmBpB,EAAMI,IAyBlCiB,UAAenB,EAAcmB,UAC7BC,aAAe,WACd,GAAIZ,GAAeC,KAClBH,EAAeE,EAAKF,SACpBe,EAAejB,EAASI,EAAKV,OAASM,EAASI,EAAKV,MAAMuB,YAExDA,KACFb,EAAKa,aAAeA,EAAeJ,OAAOK,MAAM,KAAMD,GAAcE,KACnE,KACA,WACCjB,EAASU,OAAO,GAAIjB,GAAO,kBAAmBS,EAAKV,KAAM0B,eAKzDH,GAAgBb,EAAKiB,OACvBjB,EAAKiB,KAAKJ,aAAeA,GAG1BrB,EAAcoB,aAAaR,KAAKH,OAEjCiB,cAAe1B,EAAc0B,cAC7Bf,QAAS,WACR,GAAIH,GAAUC,KACbkB,EAAUtB,EAASuB,KAAKpB,EAEtBA,GAAKa,aACPb,EAAKa,aAAaE,KACjBI,EACAnB,EAAKF,SAASU,QAGfW,MAMJZ,SAAU,OAAQ,iBAAkB,yBAA0B,8BAAgClB,IAC7FD","file":"handler/legacy.js","sourcesContent":["/**\n * Qoopido demand - legacy polyfills\n *\n * Polyfills required to provide IE8 compatibility\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(functionPrototype, objectPrototype, arrayPrototype, undefined) {\n\t'use strict';\n\n\tvar arrayPrototypeSlice = arrayPrototype.slice,\n\t\tNULL                = null,\n\t\tSTRING_FUNCTION     = 'function';\n\n\tfunction isTypeOf(object, type) {\n\t\treturn typeof object === type;\n\t}\n\n\tfunction isObject(object) {\n\t\treturn object && isTypeOf(object, 'object');\n\t}\n\n\tif(!functionPrototype.bind) {\n\t\tfunctionPrototype.bind = function(context) {\n\t\t\tvar self = this,\n\t\t\t\tparameter, target, Constructor, bound;\n\n\t\t\tif(isTypeOf(self, STRING_FUNCTION)) {\n\t\t\t\tparameter   = arrayPrototypeSlice.call(arguments, 1);\n\t\t\t\ttarget      = self;\n\t\t\t\tConstructor = function() {};\n\t\t\t\tbound       = function() {\n\t\t\t\t\treturn target.apply(self instanceof Constructor ? self : context, parameter.concat(arrayPrototypeSlice.call(arguments)));\n\t\t\t\t};\n\n\t\t\t\tConstructor.prototype = self.prototype;\n\t\t\t\tbound.prototype       = new Constructor();\n\n\t\t\t\treturn bound;\n\t\t\t} else {\n\t\t\t\tthrow new TypeError('Function.prototype.bind - what is trying to be bound is not callable');\n\t\t\t}\n\t\t};\n\t}\n\n\tif(!Object.keys) {\n\t\tObject.keys = (function() {\n\t\t\tvar hasOwnProperty = objectPrototype.hasOwnProperty,\n\t\t\t\thasEnumBug     = !({ toString: NULL }).propertyIsEnumerable('toString'),\n\t\t\t\tproperties     = [ 'toString', 'toLocaleString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf', 'propertyIsEnumerable', 'constructor' ];\n\n\t\t\treturn function(object) {\n\t\t\t\tvar keys = [],\n\t\t\t\t\ti = 0, property;\n\n\t\t\t\tif(!isObject(object) && !isTypeOf(object, STRING_FUNCTION)) {\n\t\t\t\t\tthrow new TypeError('Object.keys called on non-object');\n\t\t\t\t}\n\n\t\t\t\tfor(property in object) {\n\t\t\t\t\tif(hasOwnProperty.call(object, property)) {\n\t\t\t\t\t\tkeys.push(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(hasEnumBug) {\n\t\t\t\t\tfor(; (property = properties[i]) !== undefined; i++) {\n\t\t\t\t\t\tif(hasOwnProperty.call(object, property)) {\n\t\t\t\t\t\t\tkeys.push(property);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn keys;\n\t\t\t};\n\t\t}());\n\t}\n}(Function.prototype, Object.prototype, Array.prototype));","/**\n * Qoopido.demand handler/legacy\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(setTimeout) {\n\t'use strict';\n\n\tfunction definition(path, Reason, handlerModule, isObject) {\n\t\tvar settings;\n\t\t\n\t\tfunction onPostConfigure(options) {\n\t\t\tsettings = isObject(options) ? options : {};\n\t\t}\n\t\t\n\t\tdemand.on('postConfigure:' + path, onPostConfigure);\n\t\t\n\t\tfunction finalize() {\n\t\t\tvar self  = this,\n\t\t\t\tprobe = settings[self.path] && settings[self.path].probe,\n\t\t\t\tdeferred, result;\n\n\t\t\thandlerModule.process.call(self);\n\n\t\t\tif(probe) {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tdeferred = self.deferred;\n\n\t\t\t\t\tif(deferred.pledge.state === 'pending') {\n\t\t\t\t\t\tif(result = probe()) {\n\t\t\t\t\t\t\tprovide(function() { return result; });\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdeferred.reject(new Reason('error probing', self.path));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmatchType:     handlerModule.matchType,\n\t\t\tonPreRequest:  function() {\n\t\t\t\tvar self         = this,\n\t\t\t\t\tdeferred     = self.deferred,\n\t\t\t\t\tdependencies = settings[self.path] && settings[self.path].dependencies;\n\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tself.dependencies = dependencies = demand.apply(null, dependencies).then(\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\tdeferred.reject(new Reason('error resolving', self.path, arguments));\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif(dependencies && self.mock) {\n\t\t\t\t\tself.mock.dependencies = dependencies;\n\t\t\t\t}\n\n\t\t\t\thandlerModule.onPreRequest.call(this);\n\t\t\t},\n\t\t\tonPostRequest: handlerModule.onPostRequest,\n\t\t\tprocess: function() {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tresolve = finalize.bind(self);\n\t\t\t\t\n\t\t\t\tif(self.dependencies) {\n\t\t\t\t\tself.dependencies.then(\n\t\t\t\t\t\tresolve,\n\t\t\t\t\t\tself.deferred.reject\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprovide([ 'path', '/demand/reason', '/demand/handler/module', '/demand/validator/isObject' ], definition);\n}(setTimeout));"],"sourceRoot":"/source/"}