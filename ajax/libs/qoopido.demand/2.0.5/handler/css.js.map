{"version":3,"sources":["css.js","handler/css.js"],"names":["document","setTimeout","resolveUrl","url","resolver","href","definition","matchType","onPreRequest","self","this","slice","onPostRequest","match","base","host","source","regexMatchUrl","exec","regexIsAbsoluteUri","test","replace","regexIsAbsolutePath","regexMatchImport","regexMatchProtocol","process","style","createElement","type","styleSheet","cssText","innerHTML","setAttribute","path","target","appendChild","provide","getElementsByTagName"],"mappings":"AAAA;AACA,CCWC,SAASA,EAAUC,GACnB,YAUA,SAASC,GAAWC,GAGnB,MAFAC,GAASC,KAAOF,EAETC,EAGR,QAASE,KACR,OACCC,UAAW,aACXC,aAAc,WACb,GAAIC,GAAOC,KACVP,EAAOM,EAAKN,GAEbM,GAAKN,IAAwB,SAAlBA,EAAIQ,MAAM,IAAiBR,EAAM,OAASA,GAEtDS,cAAe,WAQd,IAPA,GAKCC,GALGJ,EAAUC,KACbP,EAAUD,EAAWO,EAAKN,IAAM,OAChCW,EAAUX,EAAIE,KACdU,EAAU,KAAOZ,EAAIY,KACrBC,EAAUP,EAAKO,OAGTH,EAAQI,EAAcC,KAAKF,IAC7BG,EAAmBC,KAAKP,EAAM,MACjCG,EAASA,EAAOK,QAAQR,EAAM,GAAI,QAAUX,EAAWoB,EAAoBF,KAAKP,EAAM,IAAME,EAAOF,EAAM,GAAKC,EAAOD,EAAM,IAAIR,KAAO,MAIxI,MAAOQ,EAAQU,EAAiBL,KAAKF,IAChCG,EAAmBC,KAAKP,EAAM,MACjCG,EAASA,EAAOK,QAAQR,EAAM,GAAI,YAAcX,EAAWoB,EAAoBF,KAAKP,EAAM,IAAME,EAAOF,EAAM,GAAKC,EAAOD,EAAM,IAAIR,KAAO,KAI5IW,GAASA,EAAOK,QAAQG,EAAoB,MAE5Cf,EAAKO,OAASA,GAEfS,QAAS,WACR,GAAIhB,GAASC,KACZgB,EAAS1B,EAAS2B,cAAc,SAChCX,EAASP,EAAKO,MAEfU,GAAME,KAAO,WAEVF,EAAMG,WACRH,EAAMG,WAAWC,QAAUd,EAE3BU,EAAMK,UAAYf,EAGnBU,EAAMM,aAAa,cAAevB,EAAKwB,MAEvCC,EAAOC,YAAYT,GAEnBzB,EAAW,WACVmC,QAAQ,WAAa,MAAOV,SAjEhC,GAAIQ,GAAsBlC,EAASqC,qBAAqB,QAAQ,GAC/DjC,EAAsBJ,EAAS2B,cAAc,KAC7CV,EAAsB,oCACtBM,EAAsB,4BACtBC,EAAsB,kBACtBF,EAAsB,OACtBH,EAAsB,wBAiEvBiB,SAAQ9B,IACPN,SAAUC","file":"handler/css.js","sourcesContent":[null,"/**\n * Qoopido.demand handler/css\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(document, setTimeout) {\n\t'use strict';\n\n\tvar target              = document.getElementsByTagName('head')[0],\n\t\tresolver            = document.createElement('a'),\n\t\tregexMatchUrl       = /url\\s*\\(\\s*[\"']?(.+?)[\"']?\\s*\\)/gi,\n\t\tregexMatchImport    = /@import\\s+[\"'](.+?)[\"']/gi,\n\t\tregexMatchProtocol  = /http(s?):\\/\\//gi,\n\t\tregexIsAbsolutePath = /^\\//i,\n\t\tregexIsAbsoluteUri  = /^data:|http(s?):|\\/\\//i;\n\n\tfunction resolveUrl(url) {\n\t\tresolver.href = url;\n\n\t\treturn resolver;\n\t}\n\n\tfunction definition() {\n\t\treturn {\n\t\t\tmatchType: /^text\\/css/,\n\t\t\tonPreRequest: function() {\n\t\t\t\tvar self = this,\n\t\t\t\t\turl  = self.url;\n\n\t\t\t\tself.url = url.slice(-4) !== '.css' ? url + '.css' : url;\n\t\t\t},\n\t\t\tonPostRequest: function() {\n\t\t\t\tvar self    = this,\n\t\t\t\t\turl     = resolveUrl(self.url + '/..'),\n\t\t\t\t\tbase    = url.href,\n\t\t\t\t\thost    = '//' + url.host,\n\t\t\t\t\tsource  = self.source,\n\t\t\t\t\tmatch;\n\n\t\t\t\twhile((match = regexMatchUrl.exec(source))) {\n\t\t\t\t\tif(!regexIsAbsoluteUri.test(match[1])) {\n\t\t\t\t\t\tsource = source.replace(match[0], 'url(\"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\")');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhile((match = regexMatchImport.exec(source))) {\n\t\t\t\t\tif(!regexIsAbsoluteUri.test(match[1])) {\n\t\t\t\t\t\tsource = source.replace(match[0], '@import \"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\"');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tsource = source.replace(regexMatchProtocol, '//');\n\n\t\t\t\tself.source = source;\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar self   = this,\n\t\t\t\t\tstyle  = document.createElement('style'),\n\t\t\t\t\tsource = self.source;\n\n\t\t\t\tstyle.type = 'text/css';\n\n\t\t\t\tif(style.styleSheet) {\n\t\t\t\t\tstyle.styleSheet.cssText = source;\n\t\t\t\t} else {\n\t\t\t\t\tstyle.innerHTML = source;\n\t\t\t\t}\n\n\t\t\t\tstyle.setAttribute('demand-path', self.path);\n\n\t\t\t\ttarget.appendChild(style);\n\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tprovide(function() { return style; });\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tprovide(definition);\n}(document, setTimeout));"],"sourceRoot":"/source/"}