{"version":3,"sources":["cookie.js","plugin/cookie.js"],"names":["document","definition","path","isObject","isTypeOf","onPostConfigure","options","pattern","length","key","push","weight","state","enabled","setCookie","value","expiration","cookie","encodeURIComponent","isEnabled","pointer","match","i","indexOf","demand","on","item","loader","JSON","stringify","provide"],"mappings":"AAAA;AACA,CCWC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAMC,EAAUC,GAInC,QAASC,GAAgBC,GACxB,GAAGH,EAASG,GAAU,CACrBC,EAAQC,OAAS,CAEjB,KAAIC,IAAOH,GACVC,EAAQG,MAAOH,QAASE,EAAKE,OAAQF,EAAID,OAAQI,MAAON,EAAQG,SAExDL,GAASE,EAAS,aAC3BO,EAAUP,GAMZ,QAASQ,GAAUZ,EAAMa,EAAOC,GAC/BhB,EAASiB,OAAS,UAAYf,EAAO,KAAOgB,mBAAmBH,GAAS,aAAeC,EAAa,WAGrG,QAASG,GAAUjB,GAGlB,IAFA,GAAWkB,GAASC,EAAhBC,EAAI,EAEDF,EAAUb,EAAQe,GAAKA,IACQ,IAAlCpB,EAAKqB,QAAQH,EAAQb,YAAoBc,GAASD,EAAQT,OAASU,EAAMV,UAC3EU,EAAQD,EAIV,SAAOC,GAAQA,EAAMT,MA9BtB,GACCC,GAASJ,EADNF,IA+CJ,OAhCAiB,QAAOC,GAAG,iBAAmBvB,EAAMG,GAkBnCmB,OACEC,GAAG,uBAAwB,SAASC,GACpCA,EAAuB,gBAATA,GAAoBA,EAAOA,EAAKxB,MAE3CW,GAAWM,EAAUO,KACvBZ,EAAUY,EAAM,GAAI,mCAGrBD,GAAG,YAAa,SAASE,IACtBd,GAAWM,EAAUQ,EAAOzB,QAC9BY,EAAUa,EAAOzB,KAAM0B,KAAKC,UAAUF,EAAOf,OAAQ,oCAIjD,EAGRkB,SAAU,OAAQ,6BAA8B,8BAAgC7B,IAC/ED","file":"plugin/cookie.js","sourcesContent":[null,"/**\n * Qoopido.demand plugin/cookie\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(document) {\n\t'use strict';\n\n\tfunction definition(path, isObject, isTypeOf) {\n\t\tvar pattern = [],\n\t\t\tenabled, key;\n\t\t\n\t\tfunction onPostConfigure(options) {\n\t\t\tif(isObject(options)) {\n\t\t\t\tpattern.length = 0;\n\t\t\t\t\n\t\t\t\tfor(key in options) {\n\t\t\t\t\tpattern.push({ pattern: key, weight: key.length, state: options[key] });\n\t\t\t\t}\n\t\t\t} else if(isTypeOf(options, 'boolean')) {\n\t\t\t\tenabled = options;\n\t\t\t}\n\t\t}\n\t\t\n\t\tdemand.on('postConfigure:' + path, onPostConfigure);\n\n\t\tfunction setCookie(path, value, expiration) {\n\t\t\tdocument.cookie = 'demand[' + path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t\t}\n\n\t\tfunction isEnabled(path) {\n\t\t\tvar i = 0, pointer, match;\n\n\t\t\tfor(; (pointer = pattern[i]); i++) {\n\t\t\t\tif(path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\tmatch = pointer;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn match ? match.state : false;\n\t\t}\n\n\t\tdemand\n\t\t\t.on('cacheMiss cacheClear', function(item) {\n\t\t\t\titem = typeof item === 'string' ? item : item.path;\n\n\t\t\t\tif(enabled || isEnabled(item)) {\n\t\t\t\t\tsetCookie(item, '', 'Thu, 01 Jan 1970 00:00:00 GMT');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('postCache', function(loader) {\n\t\t\t\tif(enabled || isEnabled(loader.path)) {\n\t\t\t\t\tsetCookie(loader.path, JSON.stringify(loader.state), 'Fri, 31 Dec 9999 23:59:59 GMT');\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn true;\n\t}\n\n\tprovide([ 'path', '/demand/validator/isObject', '/demand/validator/isTypeOf' ], definition);\n}(document));"],"sourceRoot":"/source/"}