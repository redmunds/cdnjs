{"version":3,"sources":["demand.js"],"names":["global","document","localStorage","JSON","XMLHttpRequest","setTimeout","clearTimeout","snippetParameter","undefined","demand","dependency","self","this","window","NULL","dependencies","arrayPrototypeSlice","call","arguments","i","resolve","Pledge","all","configure","parameter","key","cache","debug","cookie","version","timeout","lifetime","base","pattern","modules","settings","isTypeOf","STRING_BOOLEAN","STRING_STRING","isPositiveInteger","Math","min","max","Pattern","url","replace","regexMatchTrailingSlash","isObject","mock","module","pledges","match","regexMatchParameter","slice","join","push","mocks","defer","pledge","apply","list","state","keys","path","registry","Object","provide","deferred","isFunction","isArray","definition","queue","current","items","process","PLEDGE_PENDING","then","log","Reason","message","type","isInstanceOf","console","toString","assign","id","factory","escapeRegularExpression","value","regexMatchRegex","createRegularExpression","expression","modifier","RegExp","getTimestamp","Date","addTimestamp","resolver","href","search","param","DEMAND_ID","removeProtocol","regexMatchProtocol","setCookie","expiration","encodeURIComponent","objectPrototypeToString","object","isFinite","floor","executor","handle","PLEDGE_RESOLVED","reject","PLEDGE_REJECTED","aState","aParameter","listener","forEach","aHandler","resolved","rejected","aResolved","aRejected","weight","length","matchPattern","matchUrl","stack","Queue","Loader","xhr","handler","MODULE_PREFIX_HANDLER","onPreRequest","source","storage","get","onPreProcess","add","regexMatchBaseUrl","test","XHR","XDR","onprogress","ontimeout","onerror","onabort","onload","getResponseHeader","status","matchType","responseText","onPostRequest","set","open","send","readyState","abort","defaults","regexMatchState","arrayPrototype","Array","prototype","arrayPrototypeConcat","concat","objectPrototype","target","getElementsByTagName","createElement","PROVIDE_ID","SETTINGS_ID","MODULE_PREFIX","MODULE_PREFIX_LOCAL","MODULE_PREFIX_SETTINGS","MODULE_PREFIX_VALIDATOR","STORAGE_PREFIX","STORAGE_SUFFIX_STATE","STORAGE_SUFFIX_VALUE","XDomainRequest","regexIsAbsolutePath","regexIsAbsoluteUri","regexMatchSourcemap","hasRemainingSpace","context","scopedDemand","bind","matches","replacement","exec","script","async","text","setAttribute","appendChild","loader","parse","getItem","expires","clear","data","spaceBefore","stringify","remainingSpace","setItem","error","removeItem","expired","aResolve","aReject","checkState","countResolved","countTotal","index","race","remove","result","traverse","depth","indention","item","shift","/demand","location","main","exception"],"mappings":"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","file":"demand.js","sourcesContent":["/**\n * Qoopido demand\n *\n * Promise like module loader (XHR) with localStorage caching\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n;(function(global, document, localStorage, JSON, XMLHttpRequest, setTimeout, clearTimeout, snippetParameter, undefined) {\n\t'use strict';\n\n\tvar arrayPrototype          = Array.prototype,\n\t\tarrayPrototypeSlice     = arrayPrototype.slice,\n\t\tarrayPrototypeConcat    = arrayPrototype.concat,\n\t\tobjectPrototype         = Object.prototype,\n\t\tobjectPrototypeToString = objectPrototype.toString,\n\t\ttarget                  = document.getElementsByTagName('head')[0],\n\t\tresolver                = document.createElement('a'),\n\t\tDEMAND_ID               = 'demand',\n\t\tPROVIDE_ID              = 'provide',\n\t\tSETTINGS_ID             = 'settings',\n\t\tMODULE_PREFIX           = '/' + DEMAND_ID + '/',\n\t\tMODULE_PREFIX_HANDLER   = MODULE_PREFIX + 'handler/',\n\t\tMODULE_PREFIX_LOCAL     = MODULE_PREFIX + 'local',\n\t\tMODULE_PREFIX_SETTINGS  = MODULE_PREFIX + 'settings',\n\t\tMODULE_PREFIX_VALIDATOR = MODULE_PREFIX + 'validator/',\n\t\tSTORAGE_PREFIX          = '[' + DEMAND_ID + ']',\n\t\tSTORAGE_SUFFIX_STATE    = '[state]',\n\t\tSTORAGE_SUFFIX_VALUE    = '[value]',\n\t\tPLEDGE_PENDING          = 'pending',\n\t\tPLEDGE_RESOLVED         = 'resolved',\n\t\tPLEDGE_REJECTED         = 'rejected',\n\t\tSTRING_STRING           = 'string',\n\t\tSTRING_BOOLEAN          = 'boolean',\n\t\tNULL                    = null,\n\t\tXHR                     = XMLHttpRequest,\n\t\tXDR                     = 'XDomainRequest' in global &&  global.XDomainRequest || XHR,\n\t\tregexIsAbsolutePath     = /^\\//i,\n\t\tregexIsAbsoluteUri      = /^(http(s?):)?\\/\\//i,\n\t\tregexMatchTrailingSlash = /\\/$/,\n\t\tregexMatchParameter     = /^(mock:)?(!)?((?:[-\\w]+\\/?)+)?(?:@(\\d+\\.\\d+.\\d+))?(?:#(\\d+))?(\\+cookie)?!/,\n\t\tregexMatchProtocol      = /^http(s?):/,\n\t\tregexMatchSourcemap     = /\\/\\/#\\s+sourceMappingURL\\s*=\\s*(.+?)\\.map/g,\n\t\tregexMatchRegex         = /[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\n\t\thasRemainingSpace       = localStorage && 'remainingSpace' in localStorage,\n\t\tsettings                = { cache: true, debug: false, cookie: false, timeout: 8 * 1000, pattern: {}, modules: {}, handler: 'module', storage: 'localstorage' },\n\t\tregistry                = {},\n\t\tmocks                   = {},\n\t\tresolve, defaults, regexMatchBaseUrl, regexMatchState, queue, storage;\n\n\tfunction demand() {\n\t\tvar self         = this !== window ? this : NULL,\n\t\t\tdependencies = arrayPrototypeSlice.call(arguments),\n\t\t\ti = 0, dependency;\n\n\t\tfor(; (dependency = dependencies[i]) !== undefined; i++) {\n\t\t\tdependencies[i] = resolve.dependency(dependency, self);\n\t\t}\n\n\t\treturn Pledge.all(dependencies);\n\t}\n\n\tfunction configure(parameter) {\n\t\tvar cache    = parameter.cache,\n\t\t\tdebug    = parameter.debug,\n\t\t\tcookie   = parameter.cookie,\n\t\t\tversion  = parameter.version,\n\t\t\ttimeout  = parameter.timeout,\n\t\t\tlifetime = parameter.lifetime,\n\t\t\tbase     = parameter.base,\n\t\t\tpattern  = parameter.pattern,\n\t\t\tmodules  = parameter.modules,\n\t\t\tkey;\n\n\t\tsettings.cache  = isTypeOf(cache, STRING_BOOLEAN)  ? cache  : settings.cache;\n\t\tsettings.debug  = isTypeOf(debug, STRING_BOOLEAN)  ? debug  : settings.debug;\n\t\tsettings.cookie = isTypeOf(cookie, STRING_BOOLEAN) ? cookie : settings.cookie;\n\n\t\tif(isTypeOf(version, STRING_STRING)) {\n\t\t\tsettings.version = version;\n\t\t}\n\n\t\tif(isPositiveInteger(timeout)) {\n\t\t\tsettings.timeout = Math.min(Math.max(timeout, 2), 12) * 1000;\n\t\t}\n\n\t\tif(isPositiveInteger(lifetime) && lifetime > 0) {\n\t\t\tsettings.lifetime = lifetime * 1000;\n\t\t}\n\n\t\tif(isTypeOf(base, STRING_STRING)) {\n\t\t\tsettings.pattern.base = new Pattern('', resolve.url(base.replace(regexMatchTrailingSlash, '')));\n\t\t}\n\n\t\tif(isObject(pattern)) {\n\t\t\tfor(key in pattern) {\n\t\t\t\tkey !== 'base' && (settings.pattern[key] = new Pattern(key, pattern[key]));\n\t\t\t}\n\t\t}\n\n\t\tif(isObject(modules)) {\n\t\t\tfor(key in modules) {\n\t\t\t\tsettings.modules[key] = modules[key];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction mock(modules) {\n\t\tvar pledges = [],\n\t\t\ti = 0, module, parameter;\n\n\t\tfor(; (module  = modules[i]) !== undefined; i++) {\n\t\t\tparameter  = module.match(regexMatchParameter);\n\t\t\tmodule     = module.replace(regexMatchParameter, '');\n\t\t\tmodules[i] = (parameter ? 'mock:' + parameter.slice(1).join('')  : 'mock:') + '!' + module;\n\n\t\t\tpledges.push((mocks[module] = Pledge.defer()).pledge);\n\t\t}\n\n\t\tdemand.apply(NULL, modules);\n\n\t\treturn Pledge.all(pledges);\n\t}\n\n\tfunction list(state) {\n\t\tvar keys, path, pledge;\n\n\t\tif(state) {\n\t\t\tkeys = [];\n\n\t\t\tfor(path in registry) {\n\t\t\t\tpledge = registry[path].pledge;\n\n\t\t\t\tif(pledge.state === state || pledge.cache === state) {\n\t\t\t\t\tkeys.push(path);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tkeys = Object.keys(registry);\n\t\t}\n\n\t\treturn keys;\n\t}\n\n\tfunction provide() {\n\t\tvar parameter    = arguments,\n\t\t\tpath         = isTypeOf(parameter[0], STRING_STRING) ? parameter[0] : NULL,\n\t\t\tdependencies = isArray(parameter[path ? 1 : 0]) ? parameter[path ? 1 : 0] : NULL,\n\t\t\tdefinition   = dependencies ? parameter[path ? 2 : 1] : parameter[path ? 1 : 0],\n\t\t\tdeferred, pledge, isFunction;\n\n\t\tif(!path && queue.current) {\n\t\t\tpath = queue.current.path;\n\n\t\t\tqueue.current = NULL;\n\n\t\t\tqueue.items > 0 && queue.process();\n\t\t}\n\n\t\tif(path) {\n\t\t\tpath       = resolve.path(path, this);\n\t\t\tdeferred   = registry[path] || (registry[path] = Pledge.defer());\n\t\t\tpledge     = deferred.pledge;\n\t\t\tisFunction = isTypeOf(definition, 'function');\n\n\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tdemand\n\t\t\t\t\t\t.apply(path, dependencies)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tfunction() { deferred.resolve(isFunction ? definition.apply(NULL, arguments) : definition); },\n\t\t\t\t\t\t\tfunction() { log(new Reason('error providing', path, arguments)); }\n\t\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.resolve(isFunction ? definition() : definition);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow 'unspecified anonymous provide';\n\t\t}\n\t}\n\n\tresolve = {\n\t\turl: function(url) {\n\t\t\tresolver.href = url;\n\n\t\t\treturn resolver.href;\n\t\t},\n\t\tpath: function(path, context) {\n\t\t\tpath = path.replace(regexMatchParameter, '');\n\n\t\t\tif(!regexIsAbsolutePath.test(path) && !regexIsAbsoluteUri.test(path)) {\n\t\t\t\tpath = '/' + resolve.url(((context && resolve.url(context + '/../')) || '/') + path).replace(regexMatchBaseUrl, '');\n\t\t\t}\n\n\t\t\treturn path;\n\t\t},\n\t\tdependency: function(dependency, context) {\n\t\t\tvar path = resolve.path(dependency, context),\n\t\t\t\tdefinition;\n\n\t\t\tif(context && (dependency === DEMAND_ID || dependency === PROVIDE_ID || dependency === SETTINGS_ID)) {\n\t\t\t\tswitch(dependency) {\n\t\t\t\t\tcase DEMAND_ID:\n\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\tvar scopedDemand = demand.bind(context),\n\t\t\t\t\t\t\t\tkey;\n\n\t\t\t\t\t\t\tfor(key in demand) {\n\t\t\t\t\t\t\t\tscopedDemand[key] = demand[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn scopedDemand;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PROVIDE_ID:\n\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\treturn provide.bind(context);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SETTINGS_ID:\n\t\t\t\t\t\tpath       = MODULE_PREFIX_SETTINGS + context;\n\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\treturn settings.modules[context] || NULL;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t!registry[path] && provide(path, definition);\n\t\t\t}\n\n\t\t\treturn (registry[path] || (registry[path] = new Loader(path, resolve.parameter(dependency, context)))).pledge;\n\t\t},\n\t\tparameter: function(path, context) {\n\t\t\tvar parameter = path.match(regexMatchParameter),\n\t\t\t\tpattern   = settings.pattern,\n\t\t\t\tkey, match;\n\n\t\t\tpath = resolve.path(path, context);\n\n\t\t\tif(!regexIsAbsoluteUri.test(path)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tpattern[key].matches(path) && (!match || match.weight < pattern[key].weight) && (match = pattern[key]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmock:     (parameter && parameter[1]) ? true : false,\n\t\t\t\tcache:    (parameter && parameter[2]) ? false : settings.cache,\n\t\t\t\thandler:  (parameter && parameter[3]) || settings.handler,\n\t\t\t\tversion:  (parameter && parameter[4]) || settings.version,\n\t\t\t\tlifetime: (parameter && parameter[5] && parameter[5] * 1000) || settings.lifetime,\n\t\t\t\tcookie:   (parameter && parameter[6]) ? true : settings.cookie,\n\t\t\t\turl:      match ? removeProtocol(resolve.url(match.process(path))) : path\n\t\t\t};\n\t\t}\n\t};\n\n\tdefaults = {\n\t\thandler: {\n\t\t\tmatchType: /^(application|text)\\/javascript/,\n\t\t\tonPreRequest: function() {\n\t\t\t\tvar self = this,\n\t\t\t\t\turl  = self.url;\n\n\t\t\t\tself.url = url.slice(-3) !== '.js' ? url + '.js' : url;\n\t\t\t},\n\t\t\tonPostRequest: function() {\n\t\t\t\tvar self   = this,\n\t\t\t\t\turl    = self.url,\n\t\t\t\t\tsource = self.source,\n\t\t\t\t\tmatch, replacement;\n\n\t\t\t\tif(source) {\n\t\t\t\t\twhile(match = regexMatchSourcemap.exec(source)) {\n\t\t\t\t\t\treplacement = removeProtocol(resolve.url(url + '/../' + match[1]));\n\t\t\t\t\t\tsource      = source.replace(match[0], '//# sourcemap=' + replacement + '.map');\n\t\t\t\t\t}\n\n\t\t\t\t\tself.source = source;\n\t\t\t\t}\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar self   = this,\n\t\t\t\t\tsource = self.source,\n\t\t\t\t\tscript;\n\n\t\t\t\tif(source) {\n\t\t\t\t\tscript       = document.createElement('script');\n\t\t\t\t\tscript.async = true;\n\t\t\t\t\tscript.text  = source;\n\n\t\t\t\t\tscript.setAttribute('demand-path', self.path);\n\n\t\t\t\t\ttarget.appendChild(script);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tstorage: {\n\t\t\tget: function(loader) {\n\t\t\t\tvar path, id, state;\n\n\t\t\t\tif(localStorage) {\n\t\t\t\t\tpath  = loader.path;\n\t\t\t\t\tid    = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\tstate = JSON.parse(localStorage.getItem(id + STORAGE_SUFFIX_STATE));\n\n\t\t\t\t\tif(state && state.version === loader.version && state.url === loader.url && ((!state.expires && !loader.lifetime) || state.expires > getTimestamp())) {\n\t\t\t\t\t\treturn localStorage.getItem(id + STORAGE_SUFFIX_VALUE);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdefaults.storage.clear.path(path);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tset: function(loader) {\n\t\t\t\tvar path, lifetime, id, data, spaceBefore;\n\n\t\t\t\tif(localStorage) {\n\t\t\t\t\tpath     = loader.path;\n\t\t\t\t\tlifetime = loader.lifetime;\n\t\t\t\t\tid       = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\tdata     = JSON.stringify({ version: loader.version, expires: lifetime ? getTimestamp() + lifetime : lifetime, url: loader.url });\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tspaceBefore = hasRemainingSpace ? localStorage.remainingSpace : NULL;\n\n\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_VALUE, loader.source);\n\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_STATE, data);\n\n\t\t\t\t\t\t// strict equality check with \"===\" is required due to spaceBefore might be \"0\"\n\t\t\t\t\t\tif(spaceBefore !== NULL && localStorage.remainingSpace === spaceBefore) {\n\t\t\t\t\t\t\tthrow 'QUOTA_EXCEEDED_ERR';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif(loader.cookie) {\n\t\t\t\t\t\t\tsetCookie(path, data, 'Fri, 31 Dec 9999 23:59:59 GMT');\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(error) {\n\t\t\t\t\t\tlog('error caching \"' + path + '\"');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tclear: {\n\t\t\t\tpath: function(path) {\n\t\t\t\t\tvar id;\n\n\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\tid = STORAGE_PREFIX + '[' + path + ']';\n\n\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_STATE);\n\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_VALUE);\n\n\t\t\t\t\t\tsetCookie(path, '', 'Thu, 01 Jan 1970 00:00:00 GMT');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tall: function() {\n\t\t\t\t\tvar key, match;\n\n\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\n\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\tdefaults.storage.clear.path(match[1]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\texpired: function() {\n\t\t\t\t\tvar key, match, state;\n\n\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\n\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '[' + match[1] + ']' + STORAGE_SUFFIX_STATE));\n\n\t\t\t\t\t\t\t\tif(state && state.expires > 0 && state.expires <= getTimestamp()) {\n\t\t\t\t\t\t\t\t\tdefaults.storage.clear.path(match[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction log(message) {\n\t\tvar type = (isInstanceOf(message, Reason)) ? 'error' : 'warn';\n\n\t\t/* jshint ignore:start */\n\t\tif(!isTypeOf(console, 'undefined') && (settings.debug || type !== 'warn')) {\n\t\t\tconsole[type](message.toString());\n\t\t}\n\t\t/* jshint ignore:end */\n\t}\n\n\tfunction assign(id, factory) {\n\t\tprovide(id, function() { return factory; });\n\t}\n\n\tfunction escapeRegularExpression(value) {\n\t\treturn value.replace(regexMatchRegex, '\\\\$&');\n\t}\n\n\tfunction createRegularExpression(expression, modifier) {\n\t\treturn new RegExp(expression, modifier);\n\t}\n\n\tfunction getTimestamp() {\n\t\treturn +new Date();\n\t}\n\n\tfunction addTimestamp(url) {\n\t\tresolver.href = url;\n\n\t\tvar value = resolver.search,\n\t\t\tparam = DEMAND_ID + '[timestamp]=' + getTimestamp();\n\n\t\tresolver.search += (value && value !== '?') ? '&' + param : '?' + param;\n\n\t\treturn resolver.href;\n\t}\n\n\tfunction removeProtocol(url) {\n\t\treturn url.replace(regexMatchProtocol, '');\n\t}\n\n\tfunction setCookie(path, value, expiration) {\n\t\tdocument.cookie = DEMAND_ID + '[' + path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t}\n\n\tfunction isArray(value) {\n\t\treturn objectPrototypeToString.call(value) === '[object Array]';\n\t}\n\n\tfunction isObject(object) {\n\t\treturn object && isTypeOf(object, 'object');\n\t}\n\n\tfunction isTypeOf(object, type) {\n\t\treturn typeof object === type;\n\t}\n\n\tfunction isInstanceOf(object, module) {\n\t\treturn object instanceof module;\n\t}\n\n\tfunction isPositiveInteger(value) {\n\t\treturn isTypeOf(value, 'number') && isFinite(value) && Math.floor(value) === value && value >= 0;\n\t}\n\n\tfunction Pledge(executor) {\n\t\tvar self     = this,\n\t\t\tlistener = { resolved: [], rejected: [] };\n\n\t\tfunction resolve() {\n\t\t\thandle(PLEDGE_RESOLVED, arguments);\n\t\t}\n\n\t\tfunction reject() {\n\t\t\thandle(PLEDGE_REJECTED, arguments);\n\t\t}\n\n\t\tfunction handle(aState, aParameter) {\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\tself.state = aState;\n\t\t\t\tself.value = aParameter;\n\n\t\t\t\tlistener[aState].forEach(function(aHandler) {\n\t\t\t\t\taHandler.apply(NULL, aParameter);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tself.then = function(aResolved, aRejected) {\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\taResolved && listener[PLEDGE_RESOLVED].push(aResolved);\n\t\t\t\taRejected && listener[PLEDGE_REJECTED].push(aRejected);\n\t\t\t} else {\n\t\t\t\tswitch(self.state) {\n\t\t\t\t\tcase PLEDGE_RESOLVED:\n\t\t\t\t\t\taResolved && aResolved.apply(NULL, self.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PLEDGE_REJECTED:\n\t\t\t\t\t\taRejected && aRejected.apply(NULL, self.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\texecutor(resolve, reject);\n\t}\n\n\tPledge.prototype = {\n\t\tstate:  PLEDGE_PENDING,\n\t\tvalue:  NULL,\n\t\tthen:   NULL\n\t};\n\n\tPledge.defer = function() {\n\t\tvar self = {};\n\n\t\tself.pledge = new Pledge(function(aResolve, aReject) {\n\t\t\tself.resolve = aResolve;\n\t\t\tself.reject  = aReject;\n\t\t});\n\n\t\treturn self;\n\t};\n\n\tPledge.all = function(pledges) {\n\t\tvar deferred      = Pledge.defer(),\n\t\t\tresolved      = [],\n\t\t\trejected      = [],\n\t\t\tcountTotal    = pledges.length,\n\t\t\tcountResolved = 0;\n\n\t\tfunction checkState() {\n\t\t\tif(countResolved === countTotal) {\n\t\t\t\tdeferred.resolve.apply(NULL, arrayPrototypeConcat.apply([], resolved));\n\t\t\t} else if(rejected.length + countResolved === countTotal) {\n\t\t\t\tdeferred.reject.apply(NULL, arrayPrototypeConcat.apply([], rejected));\n\t\t\t}\n\t\t}\n\n\t\tpledges.forEach(function(pledge, index) {\n\t\t\tpledge.then(\n\t\t\t\tfunction() {\n\t\t\t\t\tresolved[index] = arrayPrototypeSlice.call(arguments);\n\n\t\t\t\t\tcountResolved++;\n\n\t\t\t\t\tcheckState();\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\trejected.push(arrayPrototypeSlice.call(arguments));\n\n\t\t\t\t\tcheckState();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\treturn deferred.pledge;\n\t};\n\n\tPledge.race = function(pledges) {\n\t\tvar deferred = Pledge.defer();\n\n\t\tpledges.forEach(function(pledge) {\n\t\t\tpledge.then(\n\t\t\t\tdeferred.resolve,\n\t\t\t\tdeferred.reject\n\t\t\t);\n\t\t});\n\n\t\treturn deferred.pledge;\n\t};\n\n\tfunction Pattern(pattern, url) {\n\t\tvar self = this;\n\n\t\tself.weight       = pattern.length;\n\t\tself.url          = resolve.url(url);\n\t\tself.matchPattern = createRegularExpression('^' + escapeRegularExpression(pattern));\n\t\tself.matchUrl     = createRegularExpression('^' + escapeRegularExpression(url));\n\t}\n\n\tPattern.prototype = {\n\t\tweight:       0,\n\t\turl:          NULL,\n\t\tmatchPattern: NULL,\n\t\tmatchUrl:     NULL,\n\t\tmatches: function(path) {\n\t\t\treturn this.matchPattern.test(path);\n\t\t},\n\t\tremove: function(url) {\n\t\t\treturn url.replace(this.matchUrl, '');\n\t\t},\n\t\tprocess: function(path) {\n\t\t\tvar self = this;\n\n\t\t\treturn path.replace(self.matchPattern, self.url);\n\t\t}\n\t};\n\n\tfunction Reason(message, module, stack) {\n\t\tvar self = this;\n\n\t\tself.message = message;\n\n\t\tmodule && (self.module = module);\n\t\tstack && (self.stack = arrayPrototypeSlice.call(stack));\n\t}\n\n\tReason.prototype = {\n\t\tmessage: NULL,\n\t\tmodule:  NULL,\n\t\tstack:   NULL,\n\t\ttoString: function() {\n\t\t\tvar self   = this,\n\t\t\t\tresult = DEMAND_ID + ': ' + self.message + ' ' + (self.module ? '\"' + self.module + '\"' : '');\n\n\t\t\tif(self.stack) {\n\t\t\t\tresult = Reason.traverse(self.stack, result, 1);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t};\n\n\tReason.traverse = function(stack, value, depth) {\n\t\tvar indention = new Array(depth + 1).join(' ');\n\n\t\tstack.forEach(function(item) {\n\t\t\tvalue += '\\n' + indention + '> ' + item.message + ' ' + (item.module ? '\"' + item.module + '\"' : '');\n\n\t\t\tif(item.stack) {\n\t\t\t\tvalue = Reason.traverse(item.stack, value, depth + 1);\n\t\t\t}\n\t\t});\n\n\t\treturn value;\n\t};\n\n\tfunction Queue() {\n\t\tvar self = this;\n\n\t\tself.items = 0;\n\t\tself.stack = [];\n\t}\n\n\tQueue.prototype = {\n\t\titems:   NULL,\n\t\tqueue:   NULL,\n\t\tcurrent: NULL,\n\t\tadd: function() {\n\t\t\tqueue.stack  = queue.stack.concat(arrayPrototypeSlice.call(arguments));\n\t\t\tqueue.items += arguments.length;\n\n\t\t\t!queue.current && queue.process();\n\t\t},\n\t\tprocess: function() {\n\t\t\tvar current;\n\n\t\t\tif(queue.items) {\n\t\t\t\tqueue.items--;\n\n\t\t\t\tcurrent = queue.current = queue.stack.shift();\n\n\t\t\t\tcurrent.handler.process.call(current);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction Loader(path, parameter) {\n\t\tvar self     = this,\n\t\t\tdeferred = Pledge.defer(),\n\t\t\thandler  = parameter.handler,\n\t\t\txhr, timeout;\n\n\t\tself.deferred = deferred;\n\t\tself.path     = path;\n\t\tself.url      = parameter.url;\n\t\tself.cache    = parameter.cache;\n\t\tself.version  = parameter.version;\n\t\tself.lifetime = parameter.lifetime;\n\t\tself.cookie   = parameter.cookie;\n\n\t\tdemand(MODULE_PREFIX_HANDLER + handler)\n\t\t\t.then(\n\t\t\t\tfunction(handler) {\n\t\t\t\t\tself.handler = handler;\n\n\t\t\t\t\thandler.onPreRequest && handler.onPreRequest.call(self);\n\n\t\t\t\t\tif(!parameter.mock) {\n\t\t\t\t\t\tif(!self.cache || !(self.source = storage.get(self))) {\n\t\t\t\t\t\t\tdeferred.pledge.cache = 'miss';\n\n\t\t\t\t\t\t\txhr = regexMatchBaseUrl.test(self.url) ? new XHR() : new XDR();\n\t\t\t\t\t\t\txhr.onprogress = function() {};\n\t\t\t\t\t\t\txhr.ontimeout = xhr.onerror = xhr.onabort = function() {\n\t\t\t\t\t\t\t\tdeferred.reject(new Reason('timeout requesting', self.path));\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\txhr.onload = function() {\n\t\t\t\t\t\t\t\tvar type = xhr.getResponseHeader && xhr.getResponseHeader('content-type');\n\n\t\t\t\t\t\t\t\ttimeout = clearTimeout(timeout);\n\n\t\t\t\t\t\t\t\tif((!('status' in xhr) || xhr.status === 200) && (!type || !handler.matchType || handler.matchType.test(type))) {\n\t\t\t\t\t\t\t\t\tself.source = xhr.responseText;\n\n\t\t\t\t\t\t\t\t\thandler.onPostRequest && handler.onPostRequest.call(self);\n\n\t\t\t\t\t\t\t\t\tself.cache && storage.set(self);\n\n\t\t\t\t\t\t\t\t\thandler.onPreProcess && handler.onPreProcess.call(self);\n\t\t\t\t\t\t\t\t\thandler.process && queue.add(self);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error requesting', self.path));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\txhr.open('GET', addTimestamp(self.url), true);\n\t\t\t\t\t\t\txhr.send();\n\n\t\t\t\t\t\t\ttimeout = setTimeout(function() { if(xhr.readyState < 4) { xhr.abort(); } }, settings.timeout);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdeferred.pledge.cache = 'hit';\n\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\thandler.onPreProcess && handler.onPreProcess.call(self);\n\t\t\t\t\t\t\t\thandler.process && queue.add(self);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmocks[self.path].resolve(self);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdeferred.reject\n\t\t\t);\n\n\t\treturn deferred;\n\t}\n\n\tLoader.prototype = {\n\t\tdeferred: NULL,\n\t\tpath:     NULL,\n\t\turl:      NULL,\n\t\thandler:  NULL,\n\t\tsource:   NULL,\n\t\tcache:    NULL,\n\t\tlifetime: NULL,\n\t\tversion:  NULL,\n\t\tcookie:   NULL\n\t};\n\n\tregexMatchBaseUrl = createRegularExpression('^' + escapeRegularExpression(resolve.url('/')));\n\tregexMatchState   = createRegularExpression('^' + escapeRegularExpression(STORAGE_PREFIX) + '\\\\[(.+?)\\\\]' + escapeRegularExpression(STORAGE_SUFFIX_STATE) + '$');\n\n\tconfigure({ base: '/', pattern: { '/demand': resolve.url(((snippetParameter && snippetParameter.url) || location.href) + '/../').slice(0, -1)} });\n\tsnippetParameter && snippetParameter.settings && configure(snippetParameter.settings);\n\n\tassign(MODULE_PREFIX + 'queue', (queue = new Queue()).add);\n\tassign(MODULE_PREFIX + 'pledge', Pledge);\n\tassign(MODULE_PREFIX + 'reason', Reason);\n\tassign(MODULE_PREFIX + 'handler/' + settings.handler, defaults.handler);\n\tassign(MODULE_PREFIX + 'storage/' + settings.storage, (storage = defaults.storage));\n\tassign(MODULE_PREFIX + 'function/resolveUrl', resolve.url);\n\tassign(MODULE_PREFIX + 'modifier/removeProtocol', removeProtocol);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isArray', isArray);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isObject', isObject);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isTypeOf', isTypeOf);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isInstanceOf', isInstanceOf);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isPositiveInteger', isPositiveInteger);\n\n\tdemand.configure = configure;\n\tdemand.clear     = storage.clear;\n\tdemand.mock      = mock;\n\tdemand.list      = list;\n\tglobal.demand    = demand;\n\tglobal.provide   = provide;\n\n\tstorage.clear.expired();\n\n\tif(snippetParameter && snippetParameter.main) {\n\t\tdemand(snippetParameter.main);\n\t}\n}(this, document, (function() { try { return 'localStorage' in this && localStorage; } catch(exception) { return false; } }()), JSON, XMLHttpRequest, setTimeout, clearTimeout, 'demand' in this && demand));"],"sourceRoot":"/source/"}