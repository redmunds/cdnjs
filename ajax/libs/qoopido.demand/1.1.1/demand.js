/*! Qoopido.demand 1.1.1 | https://github.com/dlueth/qoopido.demand | (c) 2015 Dirk Lueth */
!function(e,t,r,n,a,o,u,i){"use strict";function s(){var e=this,t=w(e,S)||w(e,I)?e:fe,r=G.call(arguments);return r.forEach(p,t),E.all(r)}function c(){var e,t,r,n,a,i,s=this,c=w(s,S)||w(s,I)?s:fe,l=P(arguments[0],ue)?arguments[0]:fe,p=l?arguments[1]:arguments[0];if(!A.current||l&&l!==A.current.path||(e=A.current,l=e.type+"!"+e.path),l)return r=D.path(l,c),n=r.type,l=r.path,a=Ee[n]||(Ee[n]={}),i=je[n]||(je[n]={}),!i[l]||e?(e||(a[l]=E.defer(),i[l]=a[l].pledge),o(function(){new S(n+"!"+l,p,t),e&&(e.timeout=u(e.timeout),!e.cached&&e.store(),A.items>0&&A.process())}),{when:function(){t=arguments}}):(m("duplicate found for module "+r.path),{when:pe});throw new q("unspecified anonymous provide")}function l(e){var t,r=e.cache,n=e.storage,a=e.debug,o=e.version,u=e.timeout,i=e.lifetime,s=e.base,c=e.pattern,l=e.probes,p=e.modules;if(C=P(r,ie)?r:C,L=P(n,ue)?n:L,N=P(a,ie)?a:N,B=P(o,ue)?o:B,j(u)&&(_=1e3*Math.min(Math.max(u,2),10)),j(i)&&(F=1e3*i),P(s,ue)&&($=qe.base=new R("",D.url(s))),x(c))for(t in c)"base"!==t&&(qe[t]=new R(t,c[t]));if(x(l))for(t in l)Re[t]=l[t];if(x(p))for(t in p)ke[t]=p[t];return!0}function p(e,t,r){var n,a=this,o=D.path(e,a),u=o.type,i=o.path,l=je[u]||(je[u]={});if(Ee[u]||(Ee[u]={}),a&&(e===K||e===z||e===V)&&!l[i]){switch(e){case K:i=Y+K+i,n=function(){var e=s.bind(a);return e.configure=s.configure,e.clear=s.clear,e.list=s.list,e};break;case z:i=Y+z+i,n=function(){return c.bind(a)};break;case V:i=Y+V+a.path,n=function(){return ke[a.path]||fe}}c(i,n)}r[t]=l[i]||(l[i]=new I(e,a).pledge)}function f(e,t){c(e,function(){return t})}function h(){return+new Date}function d(e){Q.href=e;var t=Q.search,r="demand[timestamp]="+h();return Q.search+=t&&"?"!==t?"&"+r:"?"+r,Q.href}function m(e){var t=w(e,q)?"error":"warn";P(console,oe)||!N&&"warn"===t||console[t](e.toString())}function g(e,t){return new RegExp(e,t)}function v(e){return e.replace(ve,"\\$&")}function y(e){return e.replace(be,"")}function b(e){return me.test(e)}function w(e,t){return e instanceof t}function P(e,t){return typeof e===t}function x(e){return e&&P(e,"object")}function j(e){return P(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function E(e){function t(){n(ce,arguments)}function r(){n(le,arguments)}function n(e,t){a.state===se&&(a.state=e,a.value=t,o[e].forEach(function(e){e.apply(fe,t)}))}var a=this,o={resolved:[],rejected:[]};a.then=function(e,t){if(a.state===se)e&&o[ce].push(e),t&&o[le].push(t);else switch(a.state){case ce:e&&e.apply(fe,a.value);break;case le:t&&t.apply(fe,a.value)}},e(t,r)}function q(e,t,r){var n=this;n.message=e,t&&(n.module=t),r&&(n.stack=G.call(r))}function R(e,t){var r=this;r.weight=e.length,r.url=D.url(t),r.regexPattern=g("^"+v(e)),r.regexUrl=g("^"+v(t))}function k(){var e=this;e.current=fe,e.queue=[]}function I(e,t){var r,n,a=this;D.path.call(a,e,t),r=a.defered=Ee[a.type][a.path]||(Ee[a.type][a.path]=E.defer()),n=a.pledge=r.pledge,t&&n.then(fe,m),s(Z+a.type).then(a.process.bind(a),r.reject)}function S(e,t,r){var n,a,o,u=this;D.path.call(u,e),n=u.path,a=Ee[u.type][n],o=u.pledge=a.pledge,o.then(fe,function(){m(new q("unable to resolve module",n,arguments))}),r&&r.length>0?s.apply(u,r).then(function(){a.resolve(t.apply(fe,arguments))},function(){a.reject(new q("unable to resolve dependencies for",n,arguments))}):a.resolve(t())}var O,T,A,D,M,U,X,$,C,L,N,_,B,F,G=Array.prototype.slice,H=Array.prototype.concat,J=t.getElementsByTagName("head")[0],Q=t.createElement("a"),z="provide",K="demand",V="settings",W="/"+K+"/",Y=W+"scoped/",Z=W+"handler/",ee=W+"storage/",te=W+"validator/",re="["+K+"]",ne="[state]",ae="[value]",oe="undefined",ue="string",ie="boolean",se="pending",ce="resolved",le="rejected",pe=function(){},fe=null,he=a,de="XDomainRequest"in e&&e.XDomainRequest||he,me=/^\//i,ge=/^([-\w]+\/?)+!/,ve=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,ye=/\/\/#\s+sourceMappingURL\s*=\s*(.+?)\.map/g,be=/^http(s?):/,we=/^(http(s?):|)\/\//,Pe=r&&"remainingSpace"in r,xe={cache:!0,storage:"localstorage",handler:"js",debug:!1,version:"1.0.0",lifetime:0,timeout:5,base:"/"},je={},Ee={},qe={},Re={},ke={};D={url:function(e){return Q.href=e,Q.href},path:function(e,t){var r,n,a=this,o=e.match(ge)||xe.handler,u=w(a,I);if(P(o,ue)||(e=e.replace(g("^"+v(o[0])),""),o=o[0].slice(0,-1)),!we.test(e)){b(e)||(e="/"+D.url((t&&t.path&&D.url(t.path+"/../")||"/")+e).replace(O,""));for(r in qe)qe[r].matches(e)&&(!n||n.weight<qe[r].weight)&&(n=qe[r])}return u||w(a,S)?(a.type=o,a.path=e,u&&(a.url=n?y(D.url(n.process(e))):e),void 0):{type:o,path:e}}},X={get:function(e,t){var a,o;if(r){if(a=re+"["+e+"]",o=n.parse(r.getItem(a+ne)),o&&o.version===B&&o.url===t&&(0===o.expires||o.expires>h()))return r.getItem(a+ae);X.clear.path(e)}},set:function(e,t,a){var o,u;if(r){o=re+"["+e+"]";try{if(u=Pe?r.remainingSpace:fe,r.setItem(o+ae,t),r.setItem(o+ne,n.stringify({version:B,expires:F>0?h()+F:0,url:a})),u!==fe&&r.remainingSpace===u)throw"QUOTA_EXCEEDED_ERR"}catch(i){m("unable to cache module "+e)}}},clear:{path:function(e){var t;r&&(t=re+"["+e+"]",r.removeItem(t+ne),r.removeItem(t+ae))},all:function(){var e;if(r)for(e in r)0===e.indexOf(re)&&r.removeItem(e)},expired:function(){var e,t,a;if(r)for(e in r)t=e.match(T),t&&(a=n.parse(r.getItem(re+"["+t[1]+"]"+ne)),a&&a.expires>0&&a.expires<=h()&&X.clear.path(t[1]))}}},U={onPreRequest:function(){var e=this,t=e.url;e.url=".js"!==t.slice(-3)?t+".js":t},onPostRequest:function(){for(var e,t,r=this,n=r.url,a=r.source;e=ye.exec(a);)t=y(D.url(n+"/../"+e[1])),a=a.replace(e[0],"//# sourcemap="+t+".map");r.source=a},onPostProcess:function(){var e,r=this,n=r.source;e=t.createElement("script"),e.async=!0,e.text=n,e.setAttribute("demand-type",r.type),e.setAttribute("demand-path",r.path),J.appendChild(e)}},E.prototype={state:se,value:fe,then:fe},E.defer=function(){var e={};return e.pledge=new E(function(t,r){e.resolve=t,e.reject=r}),e},E.all=function(e){function t(){i===u?r.resolve.apply(fe,H.apply([],a)):o.length+i===u&&r.reject.apply(fe,H.apply([],o))}var r=E.defer(),n=r.pledge,a=[],o=[],u=e.length,i=0;return e.forEach(function(e,r){e.then(function(){a[r]=G.call(arguments),i++,t()},function(){o.push(G.call(arguments)),t()})}),n},E.race=function(e){var t=E.defer();return e.forEach(function(e){e.then(t.resolve,t.reject)}),t.pledge},q.prototype={message:fe,module:fe,stack:fe,toString:function(){var e=this,t=re+" "+e.message+" "+(e.module||"");return e.stack&&(t=q.traverse(e.stack,t,1)),t}},q.traverse=function(e,t,r){var n=new Array(r+1).join(" ");return e.forEach(function(e){t+="\n"+n+"> "+e.message+" "+e.module,e.stack&&(t=q.traverse(e.stack,t,r+1))}),t},R.prototype={weight:0,url:fe,regexPattern:fe,regexUrl:fe,matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},k.prototype={current:fe,queue:fe,items:0,add:function(e){var t=this,r=t.queue,n=e.handler;n.onPreProcess&&n.onPreProcess(e),r.push(e),t.items++,1===t.items&&t.process()},process:function(){var e,t,r,n,a=this,o=a.current,u=a.queue;o&&(a.current=fe,u.shift(),a.items--),a.items&&(o=a.current=a.queue[0],e=o.defered,t=o.path,r=o.handler,r.onPostProcess&&r.onPostProcess.call(o),o.probe&&o.pledge.state===se&&((n=o.probe())?c(function(){return n}):e.reject(new q("probe failed for module",t))))}},I.prototype={handler:fe,url:fe,defered:fe,pledge:fe,cached:fe,source:fe,timeout:fe,probe:fe,process:function(e){var t,r=this,n=r.defered;e.onPreRequest&&e.onPreRequest.call(r),r.retrieve(),r.handler=e,r.probe=Re[r.path],r.cached||!r.url?A.add(r):(t=O.test(r.url)?new he:new de,t.onprogress=pe,t.ontimeout=t.onerror=t.onabort=function(){n.reject(new q("unable to load module",r.path))},t.onload=function(){r.timeout=u(r.timeout),"status"in t&&200!==t.status?n.reject(new q("unable to load module",r.path)):(r.source=t.responseText,e.onPostRequest&&e.onPostRequest.call(r),A.add(r))},t.open("GET",d(r.url),!0),t.send(),r.timeout=o(function(){t.readyState<4&&t.abort()},_))},store:function(){var e=this;C&&e.source&&M.set(e.path,e.source,e.url)},retrieve:function(){var e=this,t=C&&M.get(e.path,e.url),r=e.cached=!!t;r&&(e.source=t)}},S.prototype={type:fe,path:fe,pledge:fe},O=g("^"+v(D.url("/"))),T=g("^"+v(re+"[(.+?)]"+ne+"$")),A=new k,qe["/"+K]=new R("/"+K,D.url((i&&i.url||location.href)+"/../").slice(0,-1)),l(xe)&&i&&i.settings&&l(i.settings),s.configure=l,s.list=function(e){var t,r,n,a,o={};for(t in je)if(e){r=o[t]=[],n=je[t];for(a in n)n[a].state===e&&r.push(a)}else o[t]=Object.keys(je[t]);return o},e.demand=s,e.provide=c,f(W+"pledge",E),f(W+"function/resolve/url",D.url),f(W+"modifier/removeProtocol",y),f(te+"isObject",x),f(te+"isTypeOf",P),f(te+"isInstanceOf",w),f(te+"isPositiveInteger",j),f(ee+xe.storage,X),f(Z+xe.handler,U),s(ee+L).then(function(e){M=e,s.clear=M.clear,M.clear.expired(),i&&i.main&&s(i.main)})}(this,document,function(){try{return"localStorage"in this&&localStorage}catch(e){return!1}}(),JSON,XMLHttpRequest,setTimeout,clearTimeout,"demand"in this&&demand);
//# sourceMappingURL=demand.js.map