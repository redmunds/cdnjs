{"version":3,"sources":["plugin/cookie.js"],"names":["document","definition","path","iterate","isObject","isTypeOf","onPostConfigure","options","pattern","length","key","value","push","weight","state","enabled","setCookie","expiration","cookie","encodeURIComponent","isEnabled","pointer","match","i","indexOf","demand","on","item","loader","JSON","stringify","provide"],"mappings":";CAYC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAMC,EAASC,EAAUC,GAI5C,QAASC,GAAgBC,GACrBH,EAASG,IACXC,EAAQC,OAAS,EAEjBN,EAAQI,EAAS,SAASG,EAAKC,GAC9BH,EAAQI,MAAOJ,QAASE,EAAKG,OAAQH,EAAID,OAAQK,MAAOH,OAEhDN,EAASE,EAAS,aAC3BQ,EAAUR,GAMZ,QAASS,GAAUd,EAAMS,EAAOM,GAC/BjB,EAASkB,OAAS,UAAYhB,EAAO,KAAOiB,mBAAmBR,GAAS,aAAeM,EAAa,WAGrG,QAASG,GAAUlB,GAGlB,IAFA,GAAWmB,GAASC,EAAhBC,EAAI,EAEDF,EAAUb,EAAQe,GAAKA,IACQ,IAAlCrB,EAAKsB,QAAQH,EAAQb,YAAoBc,GAASD,EAAQR,OAASS,EAAMT,UAC3ES,EAAQD,EAIV,SAAOC,GAAQA,EAAMR,MA9BtB,GACCC,GADGP,IA+CJ,OAhCAiB,QAAOC,GAAG,iBAAmBxB,EAAMI,GAkBnCmB,OACEC,GAAG,uBAAwB,SAASC,GACpCA,EAAuB,gBAATA,GAAoBA,EAAOA,EAAKzB,MAE3Ca,GAAWK,EAAUO,KACvBX,EAAUW,EAAM,GAAI,mCAGrBD,GAAG,YAAa,SAASE,IACtBb,GAAWK,EAAUQ,EAAO1B,QAC9Bc,EAAUY,EAAO1B,KAAM2B,KAAKC,UAAUF,EAAOd,OAAQ,oCAIjD,EAGRiB,SAAU,OAAQ,2BAA4B,6BAA8B,8BAAgC9B,IAC3GD","file":"cookie.js","sourcesContent":["/**\n * Qoopido.demand plugin/cookie\n *\n * Copyright (c) 2016 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(document) {\n\t'use strict';\n\n\tfunction definition(path, iterate, isObject, isTypeOf) {\n\t\tvar pattern = [],\n\t\t\tenabled;\n\t\t\n\t\tfunction onPostConfigure(options) {\n\t\t\tif(isObject(options)) {\n\t\t\t\tpattern.length = 0;\n\t\t\t\t\n\t\t\t\titerate(options, function(key, value) {\n\t\t\t\t\tpattern.push({ pattern: key, weight: key.length, state: value });\n\t\t\t\t});\n\t\t\t} else if(isTypeOf(options, 'boolean')) {\n\t\t\t\tenabled = options;\n\t\t\t}\n\t\t}\n\t\t\n\t\tdemand.on('postConfigure:' + path, onPostConfigure);\n\n\t\tfunction setCookie(path, value, expiration) {\n\t\t\tdocument.cookie = 'demand[' + path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t\t}\n\n\t\tfunction isEnabled(path) {\n\t\t\tvar i = 0, pointer, match;\n\n\t\t\tfor(; (pointer = pattern[i]); i++) {\n\t\t\t\tif(path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\tmatch = pointer;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn match ? match.state : false;\n\t\t}\n\n\t\tdemand\n\t\t\t.on('cacheMiss cacheClear', function(item) {\n\t\t\t\titem = typeof item === 'string' ? item : item.path;\n\n\t\t\t\tif(enabled || isEnabled(item)) {\n\t\t\t\t\tsetCookie(item, '', 'Thu, 01 Jan 1970 00:00:00 GMT');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('postCache', function(loader) {\n\t\t\t\tif(enabled || isEnabled(loader.path)) {\n\t\t\t\t\tsetCookie(loader.path, JSON.stringify(loader.state), 'Fri, 31 Dec 9999 23:59:59 GMT');\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn true;\n\t}\n\n\tprovide([ 'path', '/demand/function/iterate', '/demand/validator/isObject', '/demand/validator/isTypeOf' ], definition);\n}(document));"]}