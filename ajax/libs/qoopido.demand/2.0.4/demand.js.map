{"version":3,"sources":["demand.js"],"names":["global","document","JSON","XMLHttpRequest","setTimeout","clearTimeout","snippetParameter","demand","dependency","self","this","window","NULL","dependencies","arrayPrototypeSlice","call","arguments","i","resolve","Pledge","all","configure","parameter","key","cache","debug","version","timeout","lifetime","base","pattern","modules","settings","isTypeOf","STRING_BOOLEAN","STRING_STRING","isPositiveInteger","Math","min","max","Pattern","url","replace","regexMatchTrailingSlash","isObject","on","events","callback","event","STRING_FUNCTION","split","shift","regexMatchEvent","test","listener","push","emit","pointer","apply","list","state","keys","path","pledge","registry","Object","provide","deferred","isFunction","isArray","definition","queue","current","items","process","defer","PLEDGE_PENDING","then","log","Reason","message","type","isInstanceOf","console","toString","mock","module","pledges","match","regexMatchParameter","slice","join","mocks","assign","id","factory","escapeRegularExpression","value","regexMatchRegex","createRegularExpression","expression","modifier","RegExp","getTimestamp","Date","addTimestamp","resolver","href","search","param","DEMAND_ID","removeProtocol","regexMatchProtocol","objectPrototypeToString","object","isFinite","floor","executor","handle","PLEDGE_RESOLVED","reject","PLEDGE_REJECTED","aState","aParameter","forEach","aHandler","resolved","rejected","aResolved","aRejected","weight","length","matchPattern","matchUrl","stack","Queue","Loader","xhr","handler","MODULE_PREFIX_HANDLER","onPreRequest","storage","get","loader","regexMatchBaseUrl","XHR","XDR","onprogress","ontimeout","onerror","onabort","onload","getResponseHeader","status","matchType","source","responseText","onPostRequest","set","open","send","readyState","abort","arrayPrototype","Array","prototype","arrayPrototypeConcat","concat","objectPrototype","createElement","PROVIDE_ID","SETTINGS_ID","MODULE_PREFIX","MODULE_PREFIX_LOCAL","MODULE_PREFIX_SETTINGS","MODULE_PREFIX_VALIDATOR","XDomainRequest","regexIsAbsolutePath","regexIsAbsoluteUri","context","scopedDemand","bind","matches","onPreProcess","add","aResolve","aReject","checkState","countResolved","countTotal","index","race","remove","result","traverse","depth","indention","item","target","getElementsByTagName","regexMatchSourcemap","replacement","exec","host","script","async","text","setAttribute","appendChild","Storage","STORAGE_PREFIX","STORAGE_SUFFIX_STATE","STORAGE_SUFFIX_VALUE","regexMatchState","localStorage","exception","hasRemainingSpace","parse","getItem","expires","clear","data","spaceBefore","stringify","remainingSpace","setItem","error","removeItem","expired","/demand","location","main"],"mappings":"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","file":"demand.js","sourcesContent":["/**\n * Qoopido demand\n *\n * Promise like module loader (XHR) with localStorage caching\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(global, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, snippetParameter) {\n\t'use strict';\n\n\tvar arrayPrototype          = Array.prototype,\n\t\tarrayPrototypeSlice     = arrayPrototype.slice,\n\t\tarrayPrototypeConcat    = arrayPrototype.concat,\n\t\tobjectPrototype         = Object.prototype,\n\t\tobjectPrototypeToString = objectPrototype.toString,\n\t\tresolver                = document.createElement('a'),\n\t\tDEMAND_ID               = 'demand',\n\t\tPROVIDE_ID              = 'provide',\n\t\tSETTINGS_ID             = 'settings',\n\t\tMODULE_PREFIX           = '/' + DEMAND_ID + '/',\n\t\tMODULE_PREFIX_HANDLER   = MODULE_PREFIX + 'handler/',\n\t\tMODULE_PREFIX_LOCAL     = MODULE_PREFIX + 'local',\n\t\tMODULE_PREFIX_SETTINGS  = MODULE_PREFIX + 'settings',\n\t\tMODULE_PREFIX_VALIDATOR = MODULE_PREFIX + 'validator/',\n\t\tPLEDGE_PENDING          = 'pending',\n\t\tPLEDGE_RESOLVED         = 'resolved',\n\t\tPLEDGE_REJECTED         = 'rejected',\n\t\tSTRING_STRING           = 'string',\n\t\tSTRING_BOOLEAN          = 'boolean',\n\t\tSTRING_FUNCTION         = 'function',\n\t\tNULL                    = null,\n\t\tXHR                     = XMLHttpRequest,\n\t\tXDR                     = 'XDomainRequest' in global &&  global.XDomainRequest || XHR,\n\t\tregexIsAbsolutePath     = /^\\//,\n\t\tregexIsAbsoluteUri      = /^(http(s?):)?\\/\\//i,\n\t\tregexMatchTrailingSlash = /\\/$/,\n\t\tregexMatchParameter     = /^(mock:)?(!)?((?:[-\\w]+\\/?)+)?(?:@(\\d+\\.\\d+.\\d+))?(?:#(\\d+))?!/,\n\t\tregexMatchProtocol      = /^http(s?):/i,\n\t\tregexMatchRegex         = /[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\n\t\tregexMatchEvent         = /^cache(Miss|Hit|Clear|Exceed)|(pre|post)(Request|Process|Cache)$/,\n\t\tsettings                = { cache: true, debug: false, timeout: 8 * 1000, pattern: {}, modules: {}, handler: 'module' },\n\t\tregistry                = {},\n\t\tmocks                   = {},\n\t\tlistener                = {},\n\t\tresolve, regexMatchBaseUrl, queue, storage;\n\n\tfunction demand() {\n\t\tvar self         = this !== window ? this : NULL,\n\t\t\tdependencies = arrayPrototypeSlice.call(arguments),\n\t\t\ti = 0, dependency;\n\n\t\tfor(; (dependency = dependencies[i]); i++) {\n\t\t\tdependencies[i] = resolve.dependency(dependency, self);\n\t\t}\n\n\t\treturn Pledge.all(dependencies);\n\t}\n\n\tfunction configure(parameter) {\n\t\tvar cache    = parameter.cache,\n\t\t\tdebug    = parameter.debug,\n\t\t\tversion  = parameter.version,\n\t\t\ttimeout  = parameter.timeout,\n\t\t\tlifetime = parameter.lifetime,\n\t\t\tbase     = parameter.base,\n\t\t\tpattern  = parameter.pattern,\n\t\t\tmodules  = parameter.modules,\n\t\t\tkey;\n\n\t\tsettings.cache = isTypeOf(cache, STRING_BOOLEAN) ? cache : settings.cache;\n\t\tsettings.debug = isTypeOf(debug, STRING_BOOLEAN) ? debug : settings.debug;\n\n\t\tif(isTypeOf(version, STRING_STRING)) {\n\t\t\tsettings.version = version;\n\t\t}\n\n\t\tif(isPositiveInteger(timeout)) {\n\t\t\tsettings.timeout = Math.min(Math.max(timeout, 2), 12) * 1000;\n\t\t}\n\n\t\tif(isPositiveInteger(lifetime) && lifetime > 0) {\n\t\t\tsettings.lifetime = lifetime * 1000;\n\t\t}\n\n\t\tif(isTypeOf(base, STRING_STRING)) {\n\t\t\tsettings.pattern.base = new Pattern('', resolve.url(base.replace(regexMatchTrailingSlash, '')));\n\t\t}\n\n\t\tif(isObject(pattern)) {\n\t\t\tfor(key in pattern) {\n\t\t\t\tkey !== 'base' && (settings.pattern[key] = new Pattern(key, pattern[key]));\n\t\t\t}\n\t\t}\n\n\t\tif(isObject(modules)) {\n\t\t\tfor(key in modules) {\n\t\t\t\tsettings.modules[key] = modules[key];\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction on(events, callback) {\n\t\tvar event;\n\n\t\tif(isTypeOf(events, STRING_STRING) && isTypeOf(callback, STRING_FUNCTION)) {\n\t\t\tevents = events.split(' ');\n\n\t\t\twhile(event = events.shift()) {\n\t\t\t\tif(regexMatchEvent.test(event)) {\n\t\t\t\t\t(listener[event] || (listener[event] = [])).push(callback);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn demand;\n\t}\n\n\tfunction emit(event) {\n\t\tvar pointer = listener[event],\n\t\t\tparameter, i = 0, callback;\n\n\t\tif(pointer) {\n\t\t\tfor(; (callback = pointer[i]); i++) {\n\t\t\t\tparameter = arrayPrototypeSlice.call(arguments, 1);\n\n\t\t\t\tcallback.apply(NULL, parameter);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction list(state) {\n\t\tvar keys, path, pledge;\n\n\t\tif(state) {\n\t\t\tkeys = [];\n\n\t\t\tfor(path in registry) {\n\t\t\t\tpledge = registry[path].pledge;\n\n\t\t\t\tif(pledge.state === state || pledge.cache === state) {\n\t\t\t\t\tkeys.push(path);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tkeys = Object.keys(registry);\n\t\t}\n\n\t\treturn keys;\n\t}\n\n\tfunction provide() {\n\t\tvar parameter    = arguments,\n\t\t\tpath         = isTypeOf(parameter[0], STRING_STRING) ? parameter[0] : NULL,\n\t\t\tdependencies = isArray(parameter[path ? 1 : 0]) ? parameter[path ? 1 : 0] : NULL,\n\t\t\tdefinition   = dependencies ? parameter[path ? 2 : 1] : parameter[path ? 1 : 0],\n\t\t\tdeferred, pledge, isFunction;\n\n\t\tif(!path && queue.current) {\n\t\t\tpath = queue.current.path;\n\n\t\t\tqueue.current = NULL;\n\n\t\t\tqueue.items > 0 && queue.process();\n\t\t}\n\n\t\tif(path) {\n\t\t\tpath       = resolve.path(path, this);\n\t\t\tdeferred   = registry[path] || (registry[path] = Pledge.defer());\n\t\t\tpledge     = deferred.pledge;\n\t\t\tisFunction = isTypeOf(definition, STRING_FUNCTION);\n\n\t\t\tif(pledge.state === PLEDGE_PENDING) {\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tdemand\n\t\t\t\t\t\t.apply(path, dependencies)\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tfunction() { deferred.resolve(isFunction ? definition.apply(NULL, arguments) : definition); },\n\t\t\t\t\t\t\tfunction() { log(new Reason('error providing', path, arguments)); }\n\t\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tdeferred.resolve(isFunction ? definition() : definition);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthrow 'unspecified anonymous provide';\n\t\t}\n\t}\n\n\tresolve = {\n\t\turl: function(url) {\n\t\t\tresolver.href = url;\n\n\t\t\treturn resolver.href;\n\t\t},\n\t\tpath: function(path, context) {\n\t\t\tpath = path.replace(regexMatchParameter, '');\n\n\t\t\tif(!regexIsAbsolutePath.test(path) && !regexIsAbsoluteUri.test(path)) {\n\t\t\t\tpath = '/' + resolve.url(((context && resolve.url(context + '/../')) || '/') + path).replace(regexMatchBaseUrl, '');\n\t\t\t}\n\n\t\t\treturn path;\n\t\t},\n\t\tdependency: function(dependency, context) {\n\t\t\tvar path = resolve.path(dependency, context),\n\t\t\t\tdefinition;\n\n\t\t\tif(context && (dependency === DEMAND_ID || dependency === PROVIDE_ID || dependency === SETTINGS_ID)) {\n\t\t\t\tswitch(dependency) {\n\t\t\t\t\tcase DEMAND_ID:\n\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\tvar scopedDemand = demand.bind(context),\n\t\t\t\t\t\t\t\tkey;\n\n\t\t\t\t\t\t\tfor(key in demand) {\n\t\t\t\t\t\t\t\tscopedDemand[key] = demand[key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn scopedDemand;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PROVIDE_ID:\n\t\t\t\t\t\tpath       = MODULE_PREFIX_LOCAL + path;\n\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\treturn provide.bind(context);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase SETTINGS_ID:\n\t\t\t\t\t\tpath       = MODULE_PREFIX_SETTINGS + context;\n\t\t\t\t\t\tdefinition = function() {\n\t\t\t\t\t\t\treturn settings.modules[context] || NULL;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t!registry[path] && provide(path, definition);\n\t\t\t}\n\n\t\t\treturn (registry[path] || (registry[path] = new Loader(path, resolve.parameter(dependency, context)))).pledge;\n\t\t},\n\t\tparameter: function(path, context) {\n\t\t\tvar parameter = path.match(regexMatchParameter),\n\t\t\t\tpattern   = settings.pattern,\n\t\t\t\tkey, match;\n\n\t\t\tpath = resolve.path(path, context);\n\n\t\t\tif(!regexIsAbsoluteUri.test(path)) {\n\t\t\t\tfor(key in pattern) {\n\t\t\t\t\tpattern[key].matches(path) && (!match || match.weight < pattern[key].weight) && (match = pattern[key]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmock:     (parameter && parameter[1]) ? true : false,\n\t\t\t\tcache:    (parameter && parameter[2]) ? false : settings.cache,\n\t\t\t\thandler:  (parameter && parameter[3]) || settings.handler,\n\t\t\t\tversion:  (parameter && parameter[4]) || settings.version,\n\t\t\t\tlifetime: (parameter && parameter[5] && parameter[5] * 1000) || settings.lifetime,\n\t\t\t\turl:      match ? removeProtocol(resolve.url(match.process(path))) : path\n\t\t\t};\n\t\t},\n\t\tloader: function(loader) {\n\t\t\tvar handler = loader.handler;\n\n\t\t\temit('preProcess', loader);\n\n\t\t\thandler.onPreProcess && handler.onPreProcess.call(loader);\n\t\t\thandler.process && queue.add(loader);\n\t\t}\n\t};\n\n\tfunction log(message) {\n\t\tvar type = (isInstanceOf(message, Reason)) ? 'error' : 'warn';\n\n\t\t/* eslint-disable no-console */\n\t\tif(!isTypeOf(console, 'undefined') && (settings.debug || type !== 'warn')) {\n\t\t\tconsole[type](message.toString());\n\t\t}\n\t\t/* eslint-enable no-console */\n\t}\n\n\tfunction mock(modules) {\n\t\tvar pledges = [],\n\t\t\ti = 0, module, parameter;\n\n\t\tfor(; (module  = modules[i]); i++) {\n\t\t\tparameter  = module.match(regexMatchParameter);\n\t\t\tmodule     = module.replace(regexMatchParameter, '');\n\t\t\tmodules[i] = (parameter ? 'mock:' + parameter.slice(1).join('')  : 'mock:') + '!' + module;\n\n\t\t\tpledges.push((mocks[module] = Pledge.defer()).pledge);\n\t\t}\n\n\t\tdemand.apply(NULL, modules);\n\n\t\treturn Pledge.all(pledges);\n\t}\n\n\tfunction assign(id, factory) {\n\t\tprovide(id, function() { return factory; });\n\t}\n\n\tfunction escapeRegularExpression(value) {\n\t\treturn value.replace(regexMatchRegex, '\\\\$&');\n\t}\n\n\tfunction createRegularExpression(expression, modifier) {\n\t\treturn new RegExp(expression, modifier);\n\t}\n\n\tfunction getTimestamp() {\n\t\treturn +new Date();\n\t}\n\n\tfunction addTimestamp(url) {\n\t\tresolver.href = url;\n\n\t\tvar value = resolver.search,\n\t\t\tparam = DEMAND_ID + '[time]=' + getTimestamp();\n\n\t\tresolver.search += (value && value !== '?') ? '&' + param : '?' + param;\n\n\t\treturn resolver.href;\n\t}\n\n\tfunction removeProtocol(url) {\n\t\treturn url.replace(regexMatchProtocol, '');\n\t}\n\n\tfunction isArray(value) {\n\t\treturn objectPrototypeToString.call(value) === '[object Array]';\n\t}\n\n\tfunction isObject(object) {\n\t\treturn object && isTypeOf(object, 'object');\n\t}\n\n\tfunction isTypeOf(object, type) {\n\t\treturn typeof object === type;\n\t}\n\n\tfunction isInstanceOf(object, module) {\n\t\treturn object instanceof module;\n\t}\n\n\tfunction isPositiveInteger(value) {\n\t\treturn isTypeOf(value, 'number') && isFinite(value) && Math.floor(value) === value && value >= 0;\n\t}\n\n\tfunction Pledge(executor) {\n\t\tvar self     = this,\n\t\t\tlistener = { resolved: [], rejected: [] };\n\n\t\tfunction resolve() {\n\t\t\thandle(PLEDGE_RESOLVED, arguments);\n\t\t}\n\n\t\tfunction reject() {\n\t\t\thandle(PLEDGE_REJECTED, arguments);\n\t\t}\n\n\t\tfunction handle(aState, aParameter) {\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\tself.state = aState;\n\t\t\t\tself.value = aParameter;\n\n\t\t\t\tlistener[aState].forEach(function(aHandler) {\n\t\t\t\t\taHandler.apply(NULL, aParameter);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tself.then = function(aResolved, aRejected) {\n\t\t\tif(self.state === PLEDGE_PENDING) {\n\t\t\t\taResolved && listener[PLEDGE_RESOLVED].push(aResolved);\n\t\t\t\taRejected && listener[PLEDGE_REJECTED].push(aRejected);\n\t\t\t} else {\n\t\t\t\tswitch(self.state) {\n\t\t\t\t\tcase PLEDGE_RESOLVED:\n\t\t\t\t\t\taResolved && aResolved.apply(NULL, self.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase PLEDGE_REJECTED:\n\t\t\t\t\t\taRejected && aRejected.apply(NULL, self.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn self;\n\t\t};\n\n\t\texecutor(resolve, reject);\n\t}\n\n\tPledge.prototype = {\n\t\tstate:  PLEDGE_PENDING\n\t\t/* only for reference\n\t\tvalue:  NULL,\n\t\tthen:   NULL\n\t\t*/\n\t};\n\n\tPledge.defer = function() {\n\t\tvar self = {};\n\n\t\tself.pledge = new Pledge(function(aResolve, aReject) {\n\t\t\tself.resolve = aResolve;\n\t\t\tself.reject  = aReject;\n\t\t});\n\n\t\treturn self;\n\t};\n\n\tPledge.all = function(pledges) {\n\t\tvar deferred      = Pledge.defer(),\n\t\t\tresolved      = [],\n\t\t\trejected      = [],\n\t\t\tcountTotal    = pledges.length,\n\t\t\tcountResolved = 0;\n\n\t\tfunction checkState() {\n\t\t\tif(countResolved === countTotal) {\n\t\t\t\tdeferred.resolve.apply(NULL, arrayPrototypeConcat.apply([], resolved));\n\t\t\t} else if(rejected.length + countResolved === countTotal) {\n\t\t\t\tdeferred.reject.apply(NULL, arrayPrototypeConcat.apply([], rejected));\n\t\t\t}\n\t\t}\n\n\t\tpledges.forEach(function(pledge, index) {\n\t\t\tpledge.then(\n\t\t\t\tfunction() {\n\t\t\t\t\tresolved[index] = arrayPrototypeSlice.call(arguments);\n\n\t\t\t\t\tcountResolved++;\n\n\t\t\t\t\tcheckState();\n\t\t\t\t},\n\t\t\t\tfunction() {\n\t\t\t\t\trejected.push(arrayPrototypeSlice.call(arguments));\n\n\t\t\t\t\tcheckState();\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\n\t\treturn deferred.pledge;\n\t};\n\n\tPledge.race = function(pledges) {\n\t\tvar deferred = Pledge.defer();\n\n\t\tpledges.forEach(function(pledge) {\n\t\t\tpledge.then(\n\t\t\t\tdeferred.resolve,\n\t\t\t\tdeferred.reject\n\t\t\t);\n\t\t});\n\n\t\treturn deferred.pledge;\n\t};\n\n\tfunction Pattern(pattern, url) {\n\t\tvar self = this;\n\n\t\tself.weight       = pattern.length;\n\t\tself.url          = resolve.url(url);\n\t\tself.matchPattern = createRegularExpression('^' + escapeRegularExpression(pattern));\n\t\tself.matchUrl     = createRegularExpression('^' + escapeRegularExpression(url));\n\t}\n\n\tPattern.prototype = {\n\t\t/* only for reference\n\t\tweight:       0,\n\t\turl:          NULL,\n\t\tmatchPattern: NULL,\n\t\tmatchUrl:     NULL,\n\t\t*/\n\t\tmatches: function(path) {\n\t\t\treturn this.matchPattern.test(path);\n\t\t},\n\t\tremove: function(url) {\n\t\t\treturn url.replace(this.matchUrl, '');\n\t\t},\n\t\tprocess: function(path) {\n\t\t\tvar self = this;\n\n\t\t\treturn path.replace(self.matchPattern, self.url);\n\t\t}\n\t};\n\n\tfunction Reason(message, module, stack) {\n\t\tvar self = this;\n\n\t\tself.message = message;\n\n\t\tmodule && (self.module = module);\n\t\tstack && (self.stack = arrayPrototypeSlice.call(stack));\n\t}\n\n\tReason.prototype = {\n\t\t/* only for reference\n\t\tmessage: NULL,\n\t\tmodule:  NULL,\n\t\tstack:   NULL,\n\t\t*/\n\t\ttoString: function() {\n\t\t\tvar self   = this,\n\t\t\t\tresult = DEMAND_ID + ': ' + self.message + ' ' + (self.module ? '\"' + self.module + '\"' : '');\n\n\t\t\tif(self.stack) {\n\t\t\t\tresult = Reason.traverse(self.stack, result, 1);\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t};\n\n\tReason.traverse = function(stack, value, depth) {\n\t\tvar indention = new Array(depth + 1).join(' ');\n\n\t\tstack.forEach(function(item) {\n\t\t\tvalue += '\\n' + indention + '> ' + item.message + ' ' + (item.module ? '\"' + item.module + '\"' : '');\n\n\t\t\tif(item.stack) {\n\t\t\t\tvalue = Reason.traverse(item.stack, value, depth + 1);\n\t\t\t}\n\t\t});\n\n\t\treturn value;\n\t};\n\n\tfunction Queue() {\n\t\tvar self = this;\n\n\t\tself.items = 0;\n\t\tself.stack = [];\n\t}\n\n\tQueue.prototype = {\n\t\t/* only for reference\n\t\titems:   NULL,\n\t\tqueue:   NULL,\n\t\tcurrent: NULL,\n\t\t*/\n\t\tadd: function() {\n\t\t\tqueue.stack  = queue.stack.concat(arrayPrototypeSlice.call(arguments));\n\t\t\tqueue.items += arguments.length;\n\n\t\t\t!queue.current && queue.process();\n\t\t},\n\t\tprocess: function() {\n\t\t\tvar current;\n\n\t\t\tif(queue.items) {\n\t\t\t\tqueue.items--;\n\n\t\t\t\tcurrent = queue.current = queue.stack.shift();\n\n\t\t\t\tcurrent.handler.process.call(current);\n\t\t\t\temit('postProcess', current);\n\t\t\t}\n\t\t}\n\t};\n\n\tfunction Loader(path, parameter) {\n\t\tvar self     = this,\n\t\t\tdeferred = Pledge.defer(),\n\t\t\thandler  = parameter.handler,\n\t\t\txhr, timeout;\n\n\t\tself.deferred = deferred;\n\t\tself.path     = path;\n\t\tself.url      = parameter.url;\n\t\tself.cache    = parameter.cache;\n\t\tself.version  = parameter.version;\n\t\tself.lifetime = parameter.lifetime;\n\n\t\tdemand(MODULE_PREFIX_HANDLER + handler)\n\t\t\t.then(\n\t\t\t\tfunction(handler) {\n\t\t\t\t\tself.handler = handler;\n\t\t\t\t\tself.mock    = parameter.mock ? mocks[self.path] : NULL;\n\n\t\t\t\t\thandler.onPreRequest && handler.onPreRequest.call(self);\n\n\t\t\t\t\tif(!self.mock) {\n\t\t\t\t\t\tif(!self.cache || !storage.get(self)) {\n\t\t\t\t\t\t\temit('preRequest', self);\n\n\t\t\t\t\t\t\txhr            = regexMatchBaseUrl.test(self.url) ? new XHR() : new XDR();\n\t\t\t\t\t\t\txhr.onprogress = function() {};\n\t\t\t\t\t\t\txhr.ontimeout  = xhr.onerror = xhr.onabort = function() {\n\t\t\t\t\t\t\t\tdeferred.reject(new Reason('timeout requesting', self.path));\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\txhr.onload = function() {\n\t\t\t\t\t\t\t\tvar type = xhr.getResponseHeader && xhr.getResponseHeader('content-type');\n\n\t\t\t\t\t\t\t\ttimeout = clearTimeout(timeout);\n\n\t\t\t\t\t\t\t\tif((!('status' in xhr) || xhr.status === 200) && (!type || !handler.matchType || handler.matchType.test(type))) {\n\t\t\t\t\t\t\t\t\tself.source = xhr.responseText;\n\n\t\t\t\t\t\t\t\t\temit('postRequest', self);\n\n\t\t\t\t\t\t\t\t\thandler.onPostRequest && handler.onPostRequest.call(self);\n\t\t\t\t\t\t\t\t\tresolve.loader(self);\n\n\t\t\t\t\t\t\t\t\tif(self.cache) {\n\t\t\t\t\t\t\t\t\t\tdeferred.pledge.then(function() { storage.set(self); });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdeferred.reject(new Reason('error requesting', self.path));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\txhr.open('GET', addTimestamp(self.url), true);\n\t\t\t\t\t\t\txhr.send();\n\n\t\t\t\t\t\t\ttimeout = setTimeout(function() { if(xhr.readyState < 4) { xhr.abort(); } }, settings.timeout);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tresolve.loader(self);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(self.mock.dependencies) {\n\t\t\t\t\t\t\tself.mock.dependencies.then(\n\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tself.mock.reject\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.mock.resolve(self);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdeferred.reject\n\t\t\t);\n\n\t\treturn deferred;\n\t}\n\n\t/* only for reference\n\tLoader.prototype = {\n\t\tdeferred: NULL,\n\t\tpath:     NULL,\n\t\turl:      NULL,\n\t\thandler:  NULL,\n\t\tsource:   NULL,\n\t\tmock:     NULL,\n\t\tcache:    NULL,\n\t\tlifetime: NULL,\n\t\tversion:  NULL\n\t};\n\t*/\n\n\t(function() {\n\t\tfunction definition() {\n\t\t\tvar target              = document.getElementsByTagName('head')[0],\n\t\t\t\tregexMatchSourcemap = /\\/\\/#\\s+sourceMappingURL\\s*=\\s*(?!(?:http[s]?:)?\\/\\/)(.+?)\\.map/g;\n\n\n\t\t\treturn {\n\t\t\t\tmatchType: /^(application|text)\\/javascript/,\n\t\t\t\tonPreRequest: function() {\n\t\t\t\t\tvar self = this,\n\t\t\t\t\t\turl  = self.url;\n\n\t\t\t\t\tself.url = url.slice(-3) !== '.js' ? url + '.js' : url;\n\t\t\t\t},\n\t\t\t\tonPostRequest: function() {\n\t\t\t\t\tvar self   = this,\n\t\t\t\t\t\tsource = self.source,\n\t\t\t\t\t\tmatch, replacement;\n\n\t\t\t\t\tif(source) {\n\t\t\t\t\t\twhile(match = regexMatchSourcemap.exec(source)) {\n\t\t\t\t\t\t\tif(regexIsAbsolutePath.test(match[1])) {\n\t\t\t\t\t\t\t\tresolver.href = self.url;\n\n\t\t\t\t\t\t\t\treplacement = '//' + resolver.host + match[1];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\treplacement = removeProtocol(resolve.url(self.url + '/../' + match[1]));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tsource = source.replace(match[0], '//# sourceMappingURL=' + replacement + '.map');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tself.source = source;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprocess: function() {\n\t\t\t\t\tvar self   = this,\n\t\t\t\t\t\tsource = self.source,\n\t\t\t\t\t\tscript;\n\n\t\t\t\t\tif(source) {\n\t\t\t\t\t\tscript       = document.createElement('script');\n\t\t\t\t\t\tscript.async = true;\n\t\t\t\t\t\tscript.text  = source;\n\n\t\t\t\t\t\tscript.setAttribute('demand-path', self.path);\n\n\t\t\t\t\t\ttarget.appendChild(script);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tprovide(MODULE_PREFIX_HANDLER + 'module', definition);\n\t}());\n\n\t(function(){\n\t\tfunction definition() {\n\t\t\tvar STORAGE_PREFIX       = '[' + DEMAND_ID + ']',\n\t\t\t\tSTORAGE_SUFFIX_STATE = '[state]',\n\t\t\t\tSTORAGE_SUFFIX_VALUE = '[value]',\n\t\t\t\tregexMatchState      = createRegularExpression('^' + escapeRegularExpression(STORAGE_PREFIX) + '\\\\[(.+?)\\\\]' + escapeRegularExpression(STORAGE_SUFFIX_STATE) + '$'),\n\t\t\t\tlocalStorage         = (function() { try { return 'localStorage' in global && global.localStorage; } catch(exception) { return false; } }()),\n\t\t\t\thasRemainingSpace    = localStorage && 'remainingSpace' in localStorage;\n\n\t\t\tfunction Storage() {}\n\n\t\t\tStorage.prototype = {\n\t\t\t\tget: function(loader) {\n\t\t\t\t\tvar path, id, state;\n\n\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\tpath  = loader.path;\n\t\t\t\t\t\tid    = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(id + STORAGE_SUFFIX_STATE));\n\n\t\t\t\t\t\tif(state && state.version === loader.version && state.url === loader.url && ((!state.expires && !loader.lifetime) || state.expires > getTimestamp())) {\n\t\t\t\t\t\t\tloader.deferred.pledge.cache = 'hit';\n\t\t\t\t\t\t\tloader.source                = localStorage.getItem(id + STORAGE_SUFFIX_VALUE);\n\n\t\t\t\t\t\t\temit('cacheHit', loader);\n\n\t\t\t\t\t\t\treturn loader.source;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tloader.deferred.pledge.cache = 'miss';\n\n\t\t\t\t\t\t\temit('cacheMiss', loader);\n\t\t\t\t\t\t\tthis.clear.path(path);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tset: function(loader) {\n\t\t\t\t\tvar path, lifetime, id, data, spaceBefore;\n\n\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\temit('preCache', loader);\n\n\t\t\t\t\t\tpath     = loader.path;\n\t\t\t\t\t\tlifetime = loader.lifetime;\n\t\t\t\t\t\tid       = STORAGE_PREFIX + '[' + path + ']';\n\t\t\t\t\t\tdata     = loader.state = JSON.stringify({ version: loader.version, expires: lifetime ? getTimestamp() + lifetime : lifetime, url: loader.url });\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tspaceBefore = hasRemainingSpace ? localStorage.remainingSpace : NULL;\n\n\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_VALUE, loader.source);\n\t\t\t\t\t\t\tlocalStorage.setItem(id + STORAGE_SUFFIX_STATE, data);\n\n\t\t\t\t\t\t\t// strict equality check with \"===\" is required due to spaceBefore might be \"0\"\n\t\t\t\t\t\t\tif(spaceBefore !== NULL && localStorage.remainingSpace === spaceBefore) {\n\t\t\t\t\t\t\t\tthrow 'QUOTA_EXCEEDED_ERR';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\temit('postCache', loader);\n\t\t\t\t\t\t} catch(error) {\n\t\t\t\t\t\t\temit('cacheExceed', loader);\n\n\t\t\t\t\t\t\tlog('error caching \"' + path + '\"');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclear: {\n\t\t\t\t\tpath: function(path) {\n\t\t\t\t\t\tvar id;\n\n\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\tid = STORAGE_PREFIX + '[' + path + ']';\n\n\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_STATE);\n\t\t\t\t\t\t\tlocalStorage.removeItem(id + STORAGE_SUFFIX_VALUE);\n\n\t\t\t\t\t\t\temit('cacheClear', path);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tall: function() {\n\t\t\t\t\t\tvar key, match;\n\n\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\n\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\texpired: function() {\n\t\t\t\t\t\tvar key, match, state;\n\n\t\t\t\t\t\tif(localStorage) {\n\t\t\t\t\t\t\tfor(key in localStorage) {\n\t\t\t\t\t\t\t\tmatch = key.match(regexMatchState);\n\n\t\t\t\t\t\t\t\tif(match) {\n\t\t\t\t\t\t\t\t\tstate = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '[' + match[1] + ']' + STORAGE_SUFFIX_STATE));\n\n\t\t\t\t\t\t\t\t\tif(state && state.expires > 0 && state.expires <= getTimestamp()) {\n\t\t\t\t\t\t\t\t\t\tthis.path(match[1]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tstorage = new Storage();\n\t\t\tstorage.clear.expired();\n\n\t\t\tdemand.clear = storage.clear;\n\n\t\t\treturn storage;\n\t\t}\n\n\t\tprovide(MODULE_PREFIX + 'storage', definition);\n\t}());\n\n\tregexMatchBaseUrl = createRegularExpression('^' + escapeRegularExpression(resolve.url('/')));\n\n\tconfigure({ base: '/', pattern: { '/demand': resolve.url(((snippetParameter && snippetParameter.url) || location.href) + '/../').slice(0, -1)} });\n\tsnippetParameter && snippetParameter.settings && configure(snippetParameter.settings);\n\n\tassign(MODULE_PREFIX + 'queue', (queue = new Queue()).add);\n\tassign(MODULE_PREFIX + 'mock', mock);\n\tassign(MODULE_PREFIX + 'pledge', Pledge);\n\tassign(MODULE_PREFIX + 'reason', Reason);\n\tassign(MODULE_PREFIX + 'function/resolveUrl', resolve.url);\n\tassign(MODULE_PREFIX + 'modifier/removeProtocol', removeProtocol);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isArray', isArray);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isObject', isObject);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isTypeOf', isTypeOf);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isInstanceOf', isInstanceOf);\n\tassign(MODULE_PREFIX_VALIDATOR + 'isPositiveInteger', isPositiveInteger);\n\n\tdemand.configure = configure;\n\tdemand.on        = on;\n\tdemand.list      = list;\n\tglobal.demand    = demand;\n\tglobal.provide   = provide;\n\n\tif(snippetParameter && snippetParameter.main) {\n\t\tdemand(snippetParameter.main);\n\t}\n}(this, document, JSON, XMLHttpRequest, setTimeout, clearTimeout, 'demand' in this && demand));"],"sourceRoot":"/source/"}