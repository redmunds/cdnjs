{"version":3,"sources":["cookie.js","plugin/cookie.js"],"names":["document","definition","settings","setCookie","path","value","expiration","cookie","encodeURIComponent","isEnabled","i","pointer","match","storage","pattern","indexOf","weight","state","Pattern","length","key","push","demand","on","loader","item","provide"],"mappings":"AAAA;AACA,CCcC,SAASA,GACT,YAEA,SAASC,GAAWC,GAKnB,QAASC,GAAUC,EAAMC,EAAOC,GAC/BN,EAASO,OAAS,UAAYH,EAAO,KAAOI,mBAAmBH,GAAS,aAAeC,EAAa,WAGrG,QAASG,GAAUL,GAClB,GAAIM,GAAGC,EAASC,CAEhB,KAAIC,EAAQT,GAAO,CAClB,IAAIM,EAAI,EAAIC,EAAUG,EAAQJ,GAAKA,IACG,IAAlCN,EAAKW,QAAQJ,EAAQG,YAAoBF,GAASD,EAAQK,OAASJ,EAAMI,UAC3EJ,EAAQD,EAIVE,GAAQT,GAAQQ,EAAQA,EAAMK,OAAQ,EAGvC,MAAOJ,GAAQT,GAGhB,QAASc,GAAQJ,EAASG,GACzB,OACCH,QAASA,EACTE,OAASF,EAAQK,OACjBF,MAASA,GA5BX,GAECG,GAFGN,KACHD,IA+BD,KAAIO,IAAOlB,GACVY,EAAQO,KAAK,GAAIH,GAAQE,EAAKlB,EAASkB,IAiBxC,OAdAE,QACEC,GAAG,YAAa,SAASC,GACtBf,EAAUe,EAAOpB,OACnBD,EAAUqB,EAAOpB,KAAMoB,EAAOP,MAAO,mCAGtCM,GAAG,wBAAyB,SAASE,GACrCA,EAAuB,gBAATA,GAAoBA,EAAOA,EAAKrB,KAE3CK,EAAUgB,IACZtB,EAAUsB,EAAM,GAAI,oCAIhB,EAGRC,SAAU,YAAczB,IACvBD","file":"plugin/cookie.js","sourcesContent":[null,"/**\n * Qoopido.demand plugin/cookie\n *\n * Improved from:\n * https://github.com/pieroxy/lz-string\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n */\n\n(function(document) {\n\t'use strict';\n\n\tfunction definition(settings) {\n\t\tvar pattern = [],\n\t\t\tstorage = {},\n\t\t\tkey;\n\n\t\tfunction setCookie(path, value, expiration) {\n\t\t\tdocument.cookie = 'demand[' + path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t\t}\n\n\t\tfunction isEnabled(path) {\n\t\t\tvar i, pointer, match;\n\n\t\t\tif(!storage[path]) {\n\t\t\t\tfor(i = 0; (pointer = pattern[i]); i++) {\n\t\t\t\t\tif(path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\t\tmatch = pointer;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstorage[path] = match ? match.state : false;\n\t\t\t}\n\n\t\t\treturn storage[path];\n\t\t}\n\n\t\tfunction Pattern(pattern, state) {\n\t\t\treturn {\n\t\t\t\tpattern: pattern,\n\t\t\t\tweight:  pattern.length,\n\t\t\t\tstate:   state\n\t\t\t};\n\t\t}\n\n\t\tfor(key in settings) {\n\t\t\tpattern.push(new Pattern(key, settings[key]));\n\t\t}\n\n\t\tdemand\n\t\t\t.on('postCache', function(loader) {\n\t\t\t\tif(isEnabled(loader.path)) {\n\t\t\t\t\tsetCookie(loader.path, loader.state, 'Fri, 31 Dec 9999 23:59:59 GMT');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('preRequest cacheClear', function(item) {\n\t\t\t\titem = typeof item === 'string' ? item : item.path;\n\n\t\t\t\tif(isEnabled(item)) {\n\t\t\t\t\tsetCookie(item, '', 'Thu, 01 Jan 1970 00:00:00 GMT');\n\t\t\t\t}\n\t\t\t});\n\n\t\treturn true;\n\t}\n\n\tprovide([ 'settings' ], definition);\n}(document));"],"sourceRoot":"/source/"}