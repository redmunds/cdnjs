/*! Qoopido.demand 1.0.9 | https://github.com/dlueth/qoopido.demand | (c) 2015 Dirk Lueth */
!function(e,t,r,n,a,o,u,i){"use strict";function c(){var e=this,t=q.defer(),r=w(e,k)||w(e,S)?e:ce,n=H.call(arguments);return o(function(){n.forEach(p,r),q.all(n).then(t.resolve,t.reject)}),t.pledge}function s(){var e,t,r=this,n=w(r,k)||w(r,S)?r:ce,a=x(arguments[0],ne)?arguments[0]:ce,i=a?arguments[1]:arguments[0];if(!a&&O.current&&(e=O.current,a=e.type+"!"+e.path),a)return o(function(){var r,o,c,s=A.path(a,n),l=be[s.type]||(be[s.type]={});e||!l[s.path]?(r=new k(s.path,i,t),o=be[r.type][r.path]=r.pledge,e&&(e.timeout=u(e.timeout),c=e.defered,o.then(c.resolve,function(){c.reject(new R("unable to resolve module",a,arguments))}),!e.cached&&e.store(),O.length>0&&O.process())):g("duplicate found for module "+s.path)}),{when:function(){t=arguments}};throw new R("unspecified anonymous provide")}function l(e){var t,r=e.cache,n=e.storage,a=e.debug,o=e.version,u=e.timeout,i=e.lifetime,c=e.base,s=e.pattern,l=e.probes;if(C=x(r,ae)?r:C,F=x(n,ne)?n:F,L=x(a,ae)?a:L,B=x(o,ne)?o:B,E(u)&&(N=1e3*Math.min(Math.max(u,2),10),_=Math.min(Math.max(N/5,1e3),5e3)),E(i)&&(G=1e3*i),x(c,ne)&&($=we.base=new P("",A.url(c))),j(s))for(t in s)"base"!==t&&(we[t]=new P(t,s[t]));if(j(l))for(t in l)xe[t]=l[t];return!0}function p(e,t,r){var n=this,a=A.path(e,n),o=a.type,u=a.path,i=be[o]||(be[o]={});r[t]=i[u]||(i[u]=new S(e,n).pledge)}function h(e,t){s(e,function(){return t})}function f(){return+new Date}function d(e){z.href=e;var t=z.search,r="demand[timestamp]="+f();return z.search+=t&&"?"!==t?"&"+r:"?"+r,z.href}function g(e){var t=w(e,R)?"error":"warn";x(console,re)||!L&&"warn"===t||console[t](e.toString())}function m(e,t){return new RegExp(e,t)}function v(e){return e.replace(fe,"\\$&")}function y(e){return e.replace(ge,"")}function b(e){return pe.test(e)}function w(e,t){return e instanceof t}function x(e,t){return typeof e===t}function j(e){return e&&x(e,"object")}function E(e){return x(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function q(e){function t(){n(ue,arguments)}function r(){n(ie,arguments)}function n(e,t){a.state===oe&&(a.state=e,a.value=t,o[e].forEach(function(e){e.apply(ce,t)}))}var a=this,o={resolved:[],rejected:[]};a.then=q.prototype.then.bind(a,o),e(t,r)}function R(e,t,r){var n=this;n.message=e,t&&(n.module=t),r&&(n.stack=H.call(r))}function P(e,t){var r=this;r.weight=e.length,r.url=A.url(t),r.regexPattern=m("^"+v(e)),r.regexUrl=m("^"+v(t))}function I(){var e=this;e.current=ce,e.queue=[]}function S(e,t){var r=this,n=q.defer();A.path.call(r,e,t),r.defered=n,r.pledge=n.pledge,t||r.pledge.then(ce,g),c(Z+r.type).then(r.process.bind(r),n.reject)}function k(e,t,r){var n=this,a=q.defer();A.path.call(n,e),(n.pledge=a.pledge).then(ce,function(){g(new R("unable to resolve module",n.path,arguments))}),r&&r.length>0?c.apply(n,r).then(function(){a.resolve(t.apply(ce,arguments))},function(){a.reject(new R("unable to resolve dependencies for",n.path,arguments))}):a.resolve(t())}var M,T,O,A,D,U,X,$,C,F,L,N,_,B,G,H=Array.prototype.slice,J=Array.prototype.concat,Q=t.getElementsByTagName("head")[0],z=t.createElement("a"),K="demand",V="["+K+"]",W="[state]",Y="[value]",Z="/"+K+"/handler/",ee="/"+K+"/storage/",te="/validator/",re="undefined",ne="string",ae="boolean",oe="pending",ue="resolved",ie="rejected",ce=null,se=a,le="XDomainRequest"in e&&e.XDomainRequest||se,pe=/^\//i,he=/^([-\w]+\/?)+!/,fe=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,de=/\/\/#\s+sourceMappingURL\s*=\s*(.+?)\.map/g,ge=/^http(s?):/,me=/^(http(s?):|)\/\//,ve=r&&"remainingSpace"in r,ye={cache:!0,storage:"localstorage",handler:"js",debug:!1,version:"1.0.0",lifetime:0,timeout:5,base:"/"},be={},we={},xe={};A={url:function(e){return z.href=e,z.href},path:function(e,t){var r,n,a=this,o=e.match(he)||ye.handler,u=w(a,S);if(x(o,ne)||(e=e.replace(m("^"+v(o[0])),""),o=o[1]),!me.test(e)){b(e)||(e="/"+A.url((t&&t.path&&A.url(t.path+"/../")||"/")+e).replace(M,""));for(r in we)we[r].matches(e)&&(!n||n.weight<we[r].weight)&&(n=we[r])}return u||w(a,k)?(a.type=o,a.path=e,u&&(a.url=n?y(A.url(n.process(e))):e),void 0):{type:o,path:e}}},X={get:function(e,t){var a,o;if(r){if(a=V+"["+e+"]",o=n.parse(r.getItem(a+W)),o&&o.version===B&&o.url===t&&(0===o.expires||o.expires>f()))return r.getItem(a+Y);X.clear.path(e)}},set:function(e,t,a){var o,u;if(r){o=V+"["+e+"]";try{if(u=ve?r.remainingSpace:ce,r.setItem(o+Y,t),r.setItem(o+W,n.stringify({version:B,expires:G>0?f()+G:0,url:a})),u!==ce&&r.remainingSpace===u)throw"QUOTA_EXCEEDED_ERR"}catch(i){g("unable to cache module "+e)}}},clear:{path:function(e){var t;r&&(t=V+"["+e+"]",r.removeItem(t+W),r.removeItem(t+Y))},all:function(){var e;if(r)for(e in r)0===e.indexOf(V)&&r.removeItem(e)},expired:function(){var e,t,a;if(r)for(e in r)t=e.match(T),t&&(a=n.parse(r.getItem(V+"["+t[1]+"]"+W)),a&&a.expires>0&&a.expires<=f()&&X.clear.path(t[1]))}}},U={onPreRequest:function(){var e=this,t=e.url;e.url=".js"!==t.slice(-3)?t+".js":t},onPostRequest:function(){var e,t,r=this,n=r.url,a=r.source;if(r.probe)for(;e=de.exec(a);)t=y(A.url(n+"/../"+e[1])),a=a.replace(e[0],"//# sourcemap="+t+".map");r.source=a},process:function(){var r,n,a=this,o=a.source;a.probe?(n=t.createElement("script"),n.async=!0,n.text=o,n.setAttribute("demand-path",a.path),Q.appendChild(n)):(r=c.bind(a),r.configure=c.configure,r.clear=c.clear,new Function("demand","provide",o).call(e,r,s.bind(a)))}},q.prototype={state:oe,value:ce,then:function(e,t,r){var n=this;if(n.state===oe)t&&e[ue].push(t),r&&e[ie].push(r);else switch(n.state){case ue:t.apply(ce,n.value);break;case ie:r.apply(ce,n.value)}}},q.defer=function(){var e={};return e.pledge=new q(function(t,r){e.resolve=t,e.reject=r}),e},q.all=function(e){var t=q.defer(),r=t.pledge,n=[],a=[],o=e.length,u=0;return e.forEach(function(e,r){e.then(function(){n[r]=H.call(arguments),u++,u===o&&t.resolve.apply(ce,J.apply([],n))},function(){a.push(H.call(arguments)),a.length+u===o&&t.reject.apply(ce,J.apply([],a))})}),r},q.race=function(e){var t=q.defer();return e.forEach(function(e){e.then(t.resolve,t.reject)}),t.pledge},R.prototype={message:ce,module:ce,stack:ce,toString:function(){var e=this,t=V+" "+e.message+" "+e.module;return e.stack&&(t=R.traverse(e.stack,t,1)),t}},R.traverse=function(e,t,r){var n=new Array(r+1).join(" ");return e.forEach(function(e){t+="\n"+n+"> "+e.message+" "+e.module,e.stack&&(t=R.traverse(e.stack,t,r+1))}),t},P.prototype={weight:0,url:ce,regexPattern:ce,regexUrl:ce,matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},I.prototype={current:ce,queue:ce,length:0,add:function(e){var t=this,r=t.queue;r.push(e),t.length++,1===r.length&&t.process()},process:function(){var e,t,r,n=this,a=n.current,u=n.queue;a&&(n.current=ce,u.shift(),n.length--),u.length&&(a=n.current=n.queue[0],e=a.defered,t=a.path,r=a.handler,!a.cached&&r.onPostRequest&&r.onPostRequest.call(a),r.process.call(a),a.probe&&n.probe(),a.timeout=o(function(){e.reject(new R("timeout resolving module",t))},_))},probe:function(){var e,t=this,r=t.current;r.pledge.state===oe&&((e=r.probe())?s(function(){return e}):o(t.probe,10))}},S.prototype={handler:ce,url:ce,defered:ce,pledge:ce,cached:ce,source:ce,timeout:ce,probe:ce,process:function(e){var t,r=this,n=r.defered;e.onPreRequest&&e.onPreRequest.call(r),r.retrieve(),r.handler=e,r.probe=xe[r.path],r.cached?O.add(r):(t=M.test(r.url)?new se:new le,t.onprogress=function(){},t.ontimeout=t.onerror=t.onabort=function(){n.reject(new R("unable to load module",r.path))},t.onload=function(){r.timeout=u(r.timeout),"status"in t&&200!==t.status?n.reject(new R("unable to load module",r.path)):(r.source=t.responseText,O.add(r))},t.open("GET",d(r.url),!0),t.send(),r.timeout=o(function(){t.readyState<4&&t.abort()},N))},store:function(){var e=this;C&&D.set(e.path,e.source,e.url)},retrieve:function(){var e=this,t=C&&D.get(e.path,e.url),r=e.cached=!!t;r&&(e.source=t)}},k.prototype={type:ce,path:ce,pledge:ce},M=m("^"+v(A.url("/"))),T=m("^"+v(V+"[(.+?)]"+W+"$")),O=new I,we["/"+K]=new P("/"+K,A.url((i&&i.url||location.href)+"/../").slice(0,-1)),l(ye)&&i&&i.settings&&l(i.settings),c.configure=l,e.demand=c,e.provide=s,h("/"+K,c),h("/provide",s),h("/pledge",q),h("/resolve/url",A.url),h(te+"isObject",j),h(te+"isTypeOf",x),h(te+"isInstanceOf",w),h(te+"isPositiveInteger",E),h(ee+ye.storage,X),h(Z+ye.handler,U),c(ee+F).then(function(e){D=e,c.clear=D.clear,D.clear.expired(),i&&i.main&&c(i.main)})}(this,document,function(){try{return"localStorage"in this&&localStorage}catch(e){return!1}}(),JSON,XMLHttpRequest,setTimeout,clearTimeout,"demand"in this&&demand);
//# sourceMappingURL=demand.js.map