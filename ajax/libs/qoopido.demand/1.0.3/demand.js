/*! Qoopido.demand 1.0.3 | https://github.com/dlueth/qoopido.demand | (c) 2015 Dirk Lueth */
!function(e,t,r,n,a,o,u,i,c){"use strict";function s(){var e=this||{},t=b(e,A)?e:ae,r=J.call(arguments);return r.forEach(function(e,r){var n=U.path(e,t),a=n.handler,o=n.path,u=me[a]||(me[a]={});this[r]=u[o]||(u[o]=new T(e,t).pledge)},r),k.all(r)}function l(){var e,t,r=j(arguments[0],_)?arguments[0]:ae,n=r?arguments[1]:arguments[0];if(!r&&R.current&&(e=R.current,r=e.handler+"!"+e.path),!r)throw new S("unspecified anonymous provide");return o(function(){var a,o,i,c=U.path(r),s=me[c.handler];!e&&s[c.path]?g("duplicate found for module "+c.path):(a=new A(r,n,t||[]),o=me[a.handler][a.path]=a.pledge,e&&(e.timeout=u(e.timeout),i=e.defered,!e.cached&&e.store(),o.then(function(){i.resolve.apply(ae,arguments)},function(){i.reject(new S("unable to resolve module",r,arguments))}),R.length>0&&R.next()))}),{when:function(){t=J.call(arguments)}}}function p(e){var t,r=e.cache,n=e.debug,a=e.version,o=e.timeout,u=e.lifetime,i=e.base,c=e.pattern,s=e.probes;if($=j(r,ee)?r:$,C=j(n,ee)?n:C,F=j(a,_)?a:F,I(o)&&(N=1e3*Math.min(Math.max(o,2),10),B=Math.min(Math.max(N/5,1e3),5e3)),I(u)&&(G=1e3*u),j(i,_)&&(X=ge.base=new q("",U.url(i))),E(c))for(t in c)"base"!==t&&(ge[t]=new q(t,c[t]));if(E(s))for(t in s)ve[t]=s[t];return!0}function f(e,t,r){ye[e]||(ye[e]={suffix:t,resolve:r.resolve,modify:r.modify},me[e]={})}function h(e,t){l(e,function(){return t})}function d(){return+new Date}function m(e){K.href=e;var t=K.search,r="demand[timestamp]="+d();return K.search+=t&&"?"!==t?"&"+r:"?"+r,K.href}function g(e){var t=b(e,S)?"error":"warn";j(console,Z)||!C&&"warn"===t||console[t](e.toString())}function v(e,t){return new RegExp(e,t)}function y(e){return e.replace(se,"\\$&")}function w(e){return e.replace(fe,"")}function x(e){return ie.test(e)}function b(e,t){return e instanceof t}function j(e,t){return typeof e===t}function E(e){return e&&j(e,"object")}function I(e){return j(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function k(e){function t(){n(re,arguments)}function r(){n(ne,arguments)}function n(e,t){a.state===te&&(a.state=e,a.value=t,o[e].forEach(function(e){e.apply(ae,a.value)}))}var a=this,o={resolved:[],rejected:[]};a.then=function(e,t){if(a.state===te)e&&o[re].push(e),t&&o[ne].push(t);else switch(a.state){case re:e.apply(ae,a.value);break;case ne:t.apply(ae,a.value)}},e(t,r)}function S(e,t,r){var n=this;n.message=e,t&&(n.module=t),r&&(n.stack=J.call(r))}function q(e,t){var r=this;r.weight=e.length,r.url=U.url(t),r.regexPattern=v("^"+y(e)),r.regexUrl=v("^"+y(t))}function M(){var e=this;e.current=ae,e.queue=[]}function T(e,t){var r,n,a=this,i=k.defer();U.path.call(a,e,t),a.defered=i,a.pledge=i.pledge,n=ye[a.handler],t||a.pledge.then(ae,g),n?(a.retrieve(),a.cached?R.add(a):(r=O.test(a.url)?new oe:new ue,r.onprogress=function(){},r.ontimeout=r.onerror=r.onabort=function(){i.reject(new S("unable to load module",a.path))},r.onload=function(){a.timeout=u(a.timeout),a.source=r.responseText,R.add(a)},r.open("GET",m(a.url+n.suffix),!0),r.send(),a.timeout=o(function(){r.readyState<4&&r.abort()},N))):i.reject(new S('no handler "'+a.handler+'" for',a.path))}function A(e,t,r){var n=this,a=k.defer();U.path.call(n,e),(n.pledge=a.pledge).then(ae,function(){g(new S("unable to resolve module",n.path,arguments))}),r.length>0?s.apply(n,r).then(function(){a.resolve(t.apply(ae,arguments))},function(){a.reject(new S("unable to resolve dependencies for",n.path,arguments))}):a.resolve(t())}var O,P,R,U,D,H,L,X,$,C,N,B,F,G,J=Array.prototype.slice,Q=Array.prototype.concat,z=t.getElementsByTagName("head")[0],K=t.createElement("a"),V="[demand]",W="[state]",Y="[value]",Z="undefined",_="string",ee="boolean",te="pending",re="resolved",ne="rejected",ae=null,oe=a,ue="XDomainRequest"in e&&e.XDomainRequest||oe,ie=/^\//i,ce=/^([-\w]+\/[-\w]+)!/,se=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,le=/\/\/#\s+sourceMappingURL\s*=\s*(.+?)\.map/g,pe=/url\(\s*(?:"|'|)(?!data:|http:|https:|\/)(.+?)(?:"|'|)\)/g,fe=/^http(s?):/,he=r&&"remainingSpace"in r,de={cache:!0,debug:!1,version:"1.0.0",lifetime:0,timeout:5,base:"/"},me={},ge={},ve={},ye={};U={url:function(e){return K.href=e,K.href},path:function(e,t){var r,n,a=this,o=e.match(ce)||"application/javascript",u=b(a,T);j(o,_)||(e=e.replace(v("^"+y(o[0])),""),o=o[1]),x(e)||(e="/"+U.url((t&&t.path&&U.url(t.path+"/../")||"/")+e).replace(O,""));for(r in ge)ge[r].matches(e)&&(!n||n.weight<ge[r].weight)&&(n=ge[r]);return u||b(a,A)?(a.handler=o,a.path=e,u&&(a.url=w(U.url(n.process(e)))),void 0):{handler:o,path:e}}},D={get:function(e,t){var a,o;if(r&&$){if(a=V+"["+e+"]",o=n.parse(r.getItem(a+W)),o&&o.version===F&&o.url===t&&(0===o.expires||o.expires>d))return r.getItem(a+Y);D.clear(e)}},set:function(e,t,a){var o,u;if(r&&$){o=V+"["+e+"]";try{if(u=he?r.remainingSpace:ae,r.setItem(o+Y,t),r.setItem(o+W,n.stringify({version:F,expires:G>0?d+G:0,url:a})),u!==ae&&r.remainingSpace===u)throw"QuotaExceedError"}catch(i){g("unable to cache module "+e)}}},clear:function(e){var t,a,o,u;if(r)switch(typeof e){case _:t=V+"["+e+"]",r.removeItem(t+W),r.removeItem(t+Y);break;case ee:if(e)for(a in r)o=a.match(P),o&&(u=n.parse(r.getItem(V+"["+o[1]+"]"+W)),u&&u.expires>0&&u.expires<=d&&D.clear(o[1]));break;case Z:for(a in r)0===a.indexOf(V)&&r.removeItem(a)}}},H={resolve:function(e,r){var n=t.createElement("script");n.defer=n.async=!0,n.text=r,n.setAttribute("demand-path",e),z.appendChild(n)},modify:function(e,t){for(var r,n;r=le.exec(t);)n=w(U.url(e+"/../"+r[1])),t=t.replace(r[0],"//# sourcemap="+n+".map");return t}},L={resolve:function(e,r){var n=t.createElement("style"),a=n.styleSheet;n.type="text/css",n.media="only x",a&&(a.cssText=r)||(n.innerHTML=r),n.setAttribute("demand-path",e),z.appendChild(n),o(function(){l(function(){return n})})},modify:function(e,t){for(var r,n=U.url(e+"/..");r=pe.exec(t);)t=t.replace(r[0],"url("+U.url(n+r[1])+")");return t}},k.prototype={constructor:k,state:te,value:ae,listener:ae,then:ae},k.defer=function(){var e={};return e.pledge=new k(function(t,r){e.resolve=t,e.reject=r}),e},k.all=function(e){var t=k.defer(),r=t.pledge,n=[],a=[],o=e.length,u=0;return e.forEach(function(e,r){e.then(function(){n[r]=J.call(arguments),u++,u===o&&t.resolve.apply(ae,Q.apply([],n))},function(){a.push(J.call(arguments)),a.length+u===o&&t.reject.apply(ae,Q.apply([],a))})}),r},k.race=function(e){var t=k.defer();return e.forEach(function(e){e.then(t.resolve,t.reject)}),t.pledge},S.prototype={message:ae,module:ae,stack:ae,toString:function(){var e=this,t=V+" "+e.message+" "+e.module;return e.stack&&(t=S.traverse(e.stack,t,1)),t}},S.traverse=function(e,t,r){var n=new Array(r+1).join(" ");return e.forEach(function(e){t+="\n"+n+"> "+e.message+" "+e.module,e.stack&&(t=S.traverse(e.stack,t,r+1))}),t},q.prototype={weight:0,url:ae,regexPattern:ae,regexUrl:ae,matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},M.prototype={current:ae,queue:ae,length:0,add:function(e){var t=this,r=t.queue;r.push(e),t.length++,1===r.length&&t.next()},next:function(){var e,t,r,n=this,a=n.current,u=n.queue;a&&(n.current=ae,u.shift(),n.length--),u.length&&(a=n.current=n.queue[0],e=a.defered,t=a.path,r=ye[a.handler],!a.cached&&r.modify&&(a.source=r.modify(a.url,a.source)),r.resolve(t,a.source),ve[t]&&a.probe(),a.timeout=o(function(){e.reject(new S("timeout resolving module",t))},B))}},T.prototype={handler:ae,path:ae,url:ae,defered:ae,pledge:ae,cached:ae,source:ae,timeout:ae,probe:function(){var e,t=this,r=t.path,n=t.pledge.state===te;n&&((e=ve[r]())?l(function(){return e}):o(t.probe,100))},store:function(){var e=this;D.set(e.path,e.source,e.url)},retrieve:function(){var e=this,t=D.get(e.path,e.url),r=e.cached=!!t;r&&(e.source=t)}},A.prototype={handler:ae,path:ae,pledge:ae},O=v("^"+y(U.url("/"))),P=v("^"+y(V+"[(.+?)]"+W+"$")),R=new M,D.clear(!0),f("application/javascript",".js",H),f("text/css",".css",L),p(de)&&c&&p(c),s.configure=p,s.addHandler=f,s.clear=D.clear,e.demand=s,e.provide=l,h("/demand",s),h("/provide",l),h("/pledge",k),h("/validator/isTypeOf",j),h("/validator/isInstanceOf",b),h("/validator/isObject",E),h("/validator/isPositiveInteger",I),i&&s(i)}(this,document,localStorage,JSON,XMLHttpRequest,setTimeout,clearTimeout,demand.main,demand.settings);
//# sourceMappingURL=demand.js.map