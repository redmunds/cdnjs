/**! Qoopido.demand 4.0.5 (MIT OR GPL-3.0+) | https://github.com/dlueth/qoopido.demand | (c) 2017 Dirk Lueth */
!function(e,t,n,r,i){"use strict";function o(e,t,n,r){return{__proto__:K,value:e,enumerable:!!r,configurable:!!n,writable:!!t}}function u(e,t){return typeof e===t}function a(e){return e&&u(e,ne)}function c(e){return u(e,ie)&&isFinite(e)&&Math.floor(e)===e&&e>=0}function s(e,t){return e instanceof t}function l(e,t,n){for(var r,i=Object.keys(e),o=0;(r=i[o])!==V&&t.call(n,r,e[r])!==W;o++);}function f(){return+new Date}function d(e){return _.href=e,_.href}function h(e,t){var n=e.replace(Je,"");return Le.test(n)||He.test(n)||(n="/"+d((t&&d(t+"/../")||"/")+n).replace(Xe,"")),n}function p(e,t){var n=e.match(Je);return(n&&n[1]?"mock:":"")+(n&&n[3]||k.handler)+"!"+h(e,t)}function v(){return u(this.uuid,Z)&&D(this,"uuid",new o(Te())),this}function m(){this.parent.constructor.call(this),E[this.uuid]={},e.storage=E[this.uuid]}function g(e,t,n){this.message=e,t&&(this.module=t),n&&(this.stack=P.call(n))}function y(e){function t(t,n){n&&e.handler.validate&&!e.handler.validate(n)?e.deferred.reject(new g(Ce+" (content-type)",e.id)):(e.source=t,Ne.emit(qe,e.type,e))}function n(t){e.deferred.reject(new g(Ce+(t?" (status)":""),e.id))}function r(e,t,n){var r;return _.href=e,_.search=(r=(_.search||"").replace(u,""))+(r?"&":"?")+t+"="+n,_.href}function i(u){u=u||0,e.url=o?d(o.process(e.path,u)):e.path,Ne.emit(je,e.type,e),new Ke(r(e.url,H,+new Date)).then(t,o?function(){u++,o.location[u]?i(u):n()}:n)}var o,u=/^\?/;He.test(e.path)||l(k.pattern,function(t,n){n.matches(e.path)&&(!o||o.weight<n.weight)&&(o=n)}),i()}function x(e){return"[object Array]"===I.call(e)}function w(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function b(){this.parent.constructor.call(this),E[this.uuid]=[]}function j(e){var t=this.parent.constructor.call(this),n=E[t.uuid]={queue:e,current:K};demand.on(Oe+":"+e.uuid,function(){!n.current&&t.process()})}function g(e,t,n){this.message=e,t&&(this.module=t),n&&(this.stack=P.call(n))}function q(e,t){provide(e,function(){return t})}var R,S,k={cache:{},timeout:8e3,pattern:{},modules:{},handler:"module"},E={},O=Array.prototype,P=O.slice,C=O.concat,M=Object.prototype,I=M.toString,A=Object.create,D=Object.defineProperty,T=Object.getOwnPropertyNames,$=Object.getOwnPropertyDescriptor,N=Function.prototype,_=t.createElement("a"),H="demand",L="provide",U="path",X="/"+H+"/",F=X+"abstract/",J=X+"handler/",B=X+"plugin/",G=X+"function/",Q=X+"validator/",z="mock:",K=null,V=void 0,W=!1,Y=!0,Z="undefined",ee="string",te="boolean",ne="object",re="function",ie="number",oe=function(){},ue="pre",ae="post",ce="Configure",se=ue+ce,le=ae+ce,fe="cache",de=fe+"Miss",he=fe+"Hit",pe=fe+"Clear",ve=fe+"Exceed",me=ue+"Cache",ge=ae+"Cache",ye="Resolve",xe=ue+ye,we=ae+ye,be="Request",je=ue+be,qe=ae+be,Re="Process",Se=ue+Re,ke=ae+Re,Ee="queue",Oe=Ee+"Enqueue",Pe=Ee+"Dequeue",Ce="error loading",Me="error providing",Ie="error resolving",Ae="unspecified anonymous provide";!function(){function e(e){var t,n=this,r=n.prototype,i={},u=T(r),a=0;for(e=e.prototype||e;t=u[a];a++)i[t]=$(r,t);return i.constructor=new o(n),i.parent=new o(e),n.prototype=A(e,i),n}D(N,"extends",new o(e))}();var De=function(){function e(e,t){var n,r=this[e];t!==V&&(a(t)?(n=a(r),r=t.length!==V?n&&r.length!==V?r:[]:n&&r.length===V?r:{},this[e]=De(r,t)):this[e]=t)}return function(){for(var t,n=arguments[0],r=1;(t=arguments[r])!==V;r++)l(t,e,n);return n}}(),Te=function(){function e(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}var t=new RegExp("[xy]","g"),n={};return function(){var r;do r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(t,e);while(n[r]);return n[r]=1,r}}(),$e=function(){var n,i,o="setImmediate"in e;return"MutationObserver"in e?function(e){n=t.createElement("div"),new MutationObserver(function(){e()}).observe(n,{attributes:Y}),n.setAttribute("i","1")}:!o&&"postMessage"in e&&!("importScripts"in e)&&"addEventListener"in e?function(){function t(t){t.source===e&&t.data&&E[t.data]&&(E[t.data](),delete E[t.data])}return e.addEventListener("message",t,W),function(t){var n=Te();E[n]=t,e.postMessage(n,"*")}}():!o&&"onreadystatechange"in(n=t.createElement("script"))?function(e){n.onreadystatechange=function(){n.onreadystatechange=K,n.parentNode.removeChild(n),e()},t.body.appendChild(n)}:(i=o?setImmediate:r,function(e){i(e)})}(),Ne=function(){function e(e,t,r){var a,c;if(u(t,ee)&&u(r,re))for(t=t.split(" ");a=t.shift();)a=a.split(":"),i.test(a[0])&&((o[a[0]]||(o[a[0]]={on:[],after:[]}))[e].push({callback:r,filter:a[1]}),e===n&&a[0]===le&&(c=k.modules[a[1]])&&r(c))}function t(){}var n="on",r="after",i=/^cache(Miss|Hit|Clear|Exceed)|queue(En|De)queue|(pre|post)(Resolve|Configure|Request|Process|Cache)$/,o={};return t.prototype={emit:function(e,t){var i,u,a,c=o[e];if(c){for(i=P.call(arguments,2),u=0;a=c[n][u];u++)a.filter&&a.filter!==t||a.callback.apply(K,i);for(u=0;a=c[r][u];u++)a.filter&&a.filter!==t||a.callback.apply(K,i)}return this},on:function(t,r){return e(n,t,r),this},after:function(t,n){return e(r,t,n),this}},new t}(),_e=function(){var e=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;return function(t){return t.replace(e,"\\$&")}}(),He=/^(http(s?):)?\/\//i,Le=/^\//,Ue=/\/\/#\s+sourceMappingURL\s*=\s*(?!(?:http[s]?:)?\/\/)(.+?)\.map/g,Xe=new RegExp("^"+_e(d("/"))),Fe=new RegExp("^"+H+"|"+L+"|"+U+"$"),Je=/^(mock:)?([+-])?((?:[-\w]+\/?)+)?(?:@(\d+\.\d+.\d+))?(?:#(\d+))?!/,Be=function(t){function n(e){var t;return e.cache!==K?e.cache:(l(k.cache,function(n,r){0===e.path.indexOf(n)&&(!t||r.weight>t.weight)&&(t=r)}),t?t.state:W)}function r(e,t,n){Ne.emit(e,t.id,t,n)}function i(){$e(this.clear.expired.bind(this.clear))}var o,u="["+H+"]",a="[state]",c="[value]",s=new RegExp("^"+_e(u)+"\\[(.+?)\\]"+_e(a)+"$"),d=function(){try{return"localStorage"in e&&e.localStorage}catch(e){return W}}(),h=d&&"remainingSpace"in localStorage,v={};return Ne.on(de,function(e){$e(function(){o.clear.path(e.id)})}).on(qe,function(e){e.source&&n(e)&&(v[e.id]=Y)}).after(ke,function(e){v[e.id]&&$e(function(){o.set(e)})}),i.prototype={get:function(){return d?function(e){var r,i;if(n(e)&&(r=u+"["+e.id+"]",i=t.parse(localStorage.getItem(r+a)),i&&i.version===e.version&&(!i.expires&&!e.lifetime||i.expires>f())))return e.source=localStorage.getItem(r+c),Y}:oe}(),resolve:function(){return d?function(e){var t=this;t.get(e)?r(he,e):r(de,e)}:function(e){r(de,e)}}(),set:function(){return d?function(e){var i,o,s;if(n(e)){i={version:e.version,expires:e.lifetime?f()+e.lifetime:e.lifetime},o=u+"["+e.id+"]",r(me,e,i);try{if(s=h?localStorage.remainingSpace:K,localStorage.setItem(o+c,e.source),localStorage.setItem(o+a,t.stringify(i)),s!==K&&localStorage.remainingSpace===s)throw new Error("QUOTA_EXCEEDED_ERR");r(ge,e,i)}catch(t){r(ve,e)}}}:oe}(),clear:{path:function(){return d?function e(e){var t=p(e),n=u+"["+t+"]";localStorage[n+a]&&(localStorage.removeItem(n+a),localStorage.removeItem(n+c),r(pe,Qe.get(t)||new Qe(t,K,W)))}:oe}(),all:function(){return d?function(){var e;l(localStorage,function(t){e=t.match(s),e&&this.path(e[1])},this)}:oe}(),expired:function(){return d?function(){var e,n,r=this;l(localStorage,function(i){e=i.match(s),e&&(n=t.parse(localStorage.getItem(u+"["+e[1]+"]"+a)),n&&n.expires>0&&n.expires<=f()&&r.path(e[1]))},this)}:oe}()}},o=new i}(JSON),Ge=function(){function e(){s[this.uuid].handle(a,arguments)}function t(){s[this.uuid].handle(c,arguments)}function n(e,t){var n,r,i=s[this.uuid];for(i.state===u&&(i.state=e,i.value=t);n=i[i.state].shift();)r=n.handler.apply(K,i.value),r&&"function"==typeof r.then?r.then(n.deferred.resolve,n.deferred.reject):n.deferred[i.state===a?"resolve":"reject"].apply(K,i.value);i[a].length=0,i[c].length=0}function r(e,t,n){e.then(function(){n.resolved[t]=P.call(arguments),n.count++,i(n)},function(){n.rejected.push(P.call(arguments)),i(n)})}function i(e){e.count===e.total?e.deferred.resolve.apply(K,C.apply([],e.resolved)):e.rejected.length+e.count===e.total&&e.deferred.reject.apply(K,C.apply([],e.rejected))}function o(r){var i=this.parent.constructor.call(this);s[i.uuid]={state:u,handle:n.bind(i),value:K,resolved:[],rejected:[],count:0},r(e.bind(i),t.bind(i))}var u="pending",a="resolved",c="rejected",s={};return o.prototype={catch:function(e){return this.then(oe,e)},always:function(e){return this.then(e,e)},then:function(e,t){var n=s[this.uuid],r=o.defer();return e&&n[a].push({handler:e,deferred:r}),t&&n[c].push({handler:t,deferred:r}),n.state!==u&&$e(n.handle),r.pledge},isPending:function(){return s[this.uuid].state===u},isResolved:function(){return s[this.uuid].state===a},isRejected:function(){return s[this.uuid].state===c}},o.defer=function(){var e={};return e.pledge=new o(function(t,n){e.resolve=t,e.reject=n}),e},o.all=function(e){var t,n,i=o.defer(),u=0;if(e.length)for(t=s[Te()]={deferred:i,resolved:[],rejected:[],total:e.length,count:0};n=e[u];u++)r(n,u,t);else i.resolve();return i.pledge},o.race=function(e){for(var t,n=o.defer(),r=0;t=e[r];r++)t.then(n.resolve,n.reject);return e.length||n.resolve(),n.pledge},o.extends(v)}();m.prototype={get:function(e){return e?E[this.uuid][e]:E[this.uuid]},set:function(e,t){E[this.uuid][e]=t},remove:function(e){delete E[this.uuid][e]}},m.extends(v),g.prototype={toString:function(){var e=this,t=H+": "+e.message+" "+(e.module?'"'+e.module+'"':"");return e.stack&&(t=g.traverse(e.stack,t,1)),t}},g.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=g.traverse(r.stack,t,n+1));return t};var Qe=function(){function e(e,t,n){var o=this,u=e.match(Je)||i;return o.path=h(e,t),o.mock=u[1]?Y:W,o.cache=u[2]?"+"===u[1]:K,o.type=u[3]||k.handler,o.version=u[4]||k.version,o.lifetime=u[5]&&1e3*u[5]||k.lifetime,o.id=(o.mock?z:"")+o.type+"!"+o.path,o.uri=(o.mock?z:"")+o.type+"@"+o.version+(c(o.lifetime)&&o.lifetime>0?"#"+o.lifetime:"")+"!"+o.path,o.deferred=Ge.defer(),o.pledge=o.deferred.pledge,n!==W&&r.set(o.id,o),o}var n="internal!",r=new m,i=[];return e.prototype={enqueue:!0},e.get=function(e,t){return r.get(p(e,t))},e.resolve=function(t,r){var i=r&&Fe.test(t),o=i?this.get(n+r+"/"+t):this.get(t,r);if(!o)if(i)switch(o=new e(n+r+"/"+t),t){case H:o.deferred.resolve(function(){var e=demand.bind(r);return l(demand,function(t,n){e[t]=n}),e}());break;case L:o.deferred.resolve(provide.bind(r));break;case U:o.deferred.resolve(r)}else o=new e(t,r),demand(J+o.type).then(function(e){o.handler=e,o.mock?o.deferred.resolve(e):Be.resolve(o)},function(){o.deferred.reject(new g(Ce+" (handler)",self.id))});return o},e.remove=function(e,n,i){var o=p(e,n),u=t.querySelector("["+H+'-id="'+o+'"]');r.remove(o),r.remove(z+o),u&&u.parentNode.removeChild(u),i!==W&&Be.clear.path(o)},e.list={all:function(){return Object.keys(r.get())},pending:function(){var e=[];return l(r.get(),function(t,n){n.pledge.isPending()&&e.push(t)}),e},resolved:function(){var e=[];return l(r.get(),function(t,n){n.pledge.isResolved()&&e.push(t)}),e},rejected:function(){var e=[];return l(r.get(),function(t,n){n.pledge.isRejected()&&e.push(t)}),e}},e}(),ze=function(){function e(e,n){var r=this;r.weight=e.length,r.match=new RegExp("^"+_e(e)),r.location=[].concat(n),l(r.location,function(e,n){r.location[e]={url:d(n).replace(t,"$1"),match:new RegExp("^"+_e(n))}})}var t=/(.+)\/$/;return e.prototype={matches:function(e){return this.match.test(e)},process:function(e,t){var n=this.location[t];if(n)return e.replace(this.match,n.url)}},e}(),Ke=function(t){function n(){this.readyState<4&&this.abort()}var o="XDomainRequest"in e&&e.XDomainRequest||t;return function(e){var u,a=n.bind(this),c=Ge.defer(),s=Xe.test(e)?new t:new o,l=k.timeout;return s.ontimeout=s.onerror=s.onabort=function(){c.reject(s.status)},s.onprogress=s.onreadystatechange=function(){i(u),u=r(a,k.timeout)},s.onload=function(){l=i(l),"status"in s&&200!==s.status?c.reject(s.status):c.resolve(s.responseText,s.getResponseHeader&&s.getResponseHeader("content-type"))},s.open("GET",e,Y),s.send(),u=r(a,k.timeout),c.pledge}}(XMLHttpRequest);e.demand=function(){function t(){var t,n,r=P.call(arguments),i=this!==e?this:K,o=0;for(Ne.emit(xe,K,r,i);t=r[o];o++)r[o]=Qe.resolve(t,i).pledge;return n=r.length>1?Ge.all(r):r[0],n.always(function(){Ne.emit(we,K,r,i)})}return t.configure=function(e){var n,r=e.cache,i=e.version,o=e.timeout,s=e.lifetime,f=e.base,d=e.pattern,h=e.modules,p=k.modules;return u(r,te)?k.cache[""]={weight:0,state:r}:a(r)&&l(r,function(e,t){k.cache[e]={weight:e.length,state:t}}),u(i,ee)&&(k.version=i),c(o)&&(k.timeout=1e3*Math.min(Math.max(o,2),12)),c(s)&&s>0&&(k.lifetime=1e3*s),u(f,ee)&&""!==f&&(k.pattern.base=new ze("",f)),a(d)&&l(d,function(e,t){"base"!==e&&(k.pattern[e]=new ze(e,t))}),a(h)&&l(h,function(e,t){n=p[e]=p[e]||{},Ne.emit(se,e,n),De(n,t),Ne.emit(le,e,n)}),t},t.on=Ne.on.bind(t),t.remove=Qe.remove,t.list=Qe.list,t.clear=Be.clear,Ne.after(de,function(e){new y(e)}).after(he+" "+qe,function(e){Ne.emit(Se,e.id,e)}).after(je,function(e){var t=e.handler.onPreRequest;t&&t.call(e)}).after(qe,function(e){var t=e.handler.onPostRequest;t&&t.call(e)}).after(Se,function(e){var t=e.handler.onPreProcess;t&&t.call(e),e.pledge.then(function(){Ne.emit(ke,e.id,e)}),e.enqueue===!0?R.enqueue(e):s(e.enqueue,Ge)&&e.enqueue.then(function(){R.enqueue(e)})}),t}(),e.provide=function(){var t,n,r=u(arguments[0],ee)?arguments[0]:K,i=this!==e?this:K,o=x(arguments[r?1:0])?arguments[r?1:0]:K,a=o?arguments[r?2:1]:arguments[r?1:0];!r&&S.current&&(t=S.current,r=t.uri,S.process()),r?(t=t||new Qe(r,i),n=u(a,re),o?demand.apply(t.path,o).then(function(){t.deferred.resolve(n?a.apply(K,arguments):a)},function(){t.deferred.reject(new g(Me,t.id,arguments))}):t.deferred.resolve(n?a():a)):!u(console,Z)&&console.error(new g(Ae))},demand.configure({cache:Y,base:"/",pattern:{"/demand":d((n&&n.url||location.href)+"/../").slice(0,-1)}}),n&&n.settings&&demand.configure(n.settings),b.prototype={enqueue:function(){E[this.uuid]=E[this.uuid].concat(P.call(arguments)),Ne.emit(Oe,this.uuid)},dequeue:function(){return Ne.emit(Pe,this.uuid),E[this.uuid].shift()},get current(){return E[this.uuid][0]},get length(){return E[this.uuid].length}},b.extends(v),j.prototype={process:function(){var e,t=E[this.uuid];t.queue.length?(e=t.current=t.queue.dequeue(),e.handler.process&&e.handler.process.call(e)):t.current=K},get current(){return E[this.uuid].current}},j.extends(v);var Ve=function(){function e(){}return e.prototype={validate:K,onPreRequest:K,onPostRequest:K,onPreProcess:K,process:K},new e}(),We=function(){function e(){}var n=t.getElementsByTagName("head")[0],r=/^(application|text)\/(x-)?javascript/;return e.prototype={validate:function(e){return r.test(e)},onPreRequest:function(){var e=this.url;this.url=".js"!==e.slice(-3)?e+".js":e},onPostRequest:function(){for(var e,t,n=this;e=Ue.exec(n.source);)He.test(e[1])?(_.href=n.url,t=_.protocol+"//"+_.host+e[1]):t=d(n.url+"/../"+e[1]),n.source=n.source.replace(e[0],"//# sourceMappingURL="+t+".map")},process:function(){var e,r=this;r.source&&(e=t.createElement("script"),e.async=Y,e.text=r.source,e.setAttribute("demand-id",r.id),n.appendChild(e))}},new(e.extends(Ve))}();g.prototype={toString:function(){var e=this,t=H+": "+e.message+" "+(e.module?'"'+e.module+'"':"");return e.stack&&(t=g.traverse(e.stack,t,1)),t}},g.traverse=function(e,t,n){for(var r,i=new Array(n+1).join(" "),o=0;r=e[o];o++)t+="\n"+i+"> "+r.message+" "+(r.module?'"'+r.module+'"':""),r.stack&&(t=g.traverse(r.stack,t,n+1));return t};var Ye=function(){function e(e){for(var t,n,i=0;n=e[i];i++)if(n=n.match(Je),n=n&&n[3]||r.handler,t){if(n!==t)return W}else t=n;return t}function t(){}var n=J+"bundle",r={};return demand.on(le+":"+n,function(e){var t,n;a(e)&&(r=e,l(r,function(e,r){for(t=0;n=r[t];t++)u(n,ee)&&(r[t]=p(n))}))}),t.prototype={validate:We.validate,onPreProcess:function(){function t(){l.reject(new g(Ie,c.id,arguments))}var n,i,o,u,a,c=this,s=c.source,l=c.deferred,f=r[c.path];if(c.enqueue=!1,f&&(n=e(f))){for(;i=Ue.exec(s);)s=s.replace(i[0],"");for(c.source=s,o=[],a=0;u=f[a];a++)o.push(Qe.resolve(z+u).pledge);Ge.all(o).then(function(){for(o.length=0,a=0;u=f[a];a++)u=f[a]=Qe.get(u)||new Qe(u),u.handler=arguments[a],o.push(u.pledge);"module"===n?(R.enqueue.apply(R,f),We.process.call(c)):(We.process.call(c),R.enqueue.apply(R,f)),Ge.all(o).then(l.resolve,t)},t)}else t()}},new(t.extends(Ve))}(),Ze=function(){function e(e){for(var t,n,r=0;t=o[r];r++)0===e.indexOf(t.prefix)&&(!n||t.weight>n.weight)&&(n=t);return n}function t(e){var t,n,r=e.matches,i={pattern:{},modules:{"/demand/handler/bundle":{}}},o=0;for(i.pattern[e.id]=e.fn(r),i.modules[J+"bundle"][e.id]=t=[];n=r[o];o++)t.push(n.path);return i}function n(){for(var e,t=0;e=this[t];t++)e.deferred.resolve(arguments[t])}function r(){for(var e,t=0;e=this[t];t++)e.deferred.reject(new g(Ie,e.id))}var i=B+"genie",o=[];return demand.on(le+":"+i,function(e){a(e)&&(o.length=0,l(e,function(e,t){o.push({prefix:e,weight:e.length,fn:t})}))}).on(xe,function(o,a){var c,s,f,d,h={};for(c=0;s=o[c];c++)!u(s,ee)||Fe.test(s)||Qe.get(s,a)||(s=new Qe(s,a,W),"module"===s.type&&(f=e(s.path))&&!Be.get(s)&&(h[f.prefix]||(h[f.prefix]={fn:f.fn,matches:[]})).matches.push(s));l(h,function(e,o){if(d=o.matches,d.length>1){for(o.id=i+"/"+w(JSON.stringify(o.matches)),c=0;s=d[c];c++)d[c]=new Qe(s.uri);demand.configure(t(o)),demand("bundle!"+o.id).then(n.bind(d),r.bind(d))}})}),Y}();if(R=new b,S=new j(R),q(F+"handler",Ve),q(J+"module",We),q(J+"bundle",Ye),q(B+"genie",Ze),q(Q+"isTypeOf",u),q(Q+"isArray",x),q(Q+"isObject",a),q(Q+"isInstanceOf",s),q(G+"resolveUrl",d),q(G+"merge",De),q(G+"iterate",l),q(G+"hash",w),q(G+"defer",$e),q(X+"descriptor",o),q(X+"pledge",Ge),q(X+"queue",b),q(X+"xhr",Ke),q(X+"failure",g),n&&n.main)switch(typeof n.main){case ee:demand(n.main);break;case re:provide("main",n.main())}}(this,document,"demand"in this&&demand,setTimeout,clearTimeout);
//# sourceMappingURL=demand.js.map
