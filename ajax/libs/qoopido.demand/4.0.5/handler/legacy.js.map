{"version":3,"sources":["/extras/handler/legacy.js"],"names":["definition","path","Failure","handlerModule","isObject","resolve","result","self","this","deferred","probe","settings","process","call","provide","reject","HandlerLegacy","demand","on","options","prototype","onPreProcess","dependencies","enqueue","apply","boundResolve","bind","then","arguments","extends"],"mappings":";CAAC,WACA,YAEA,SAASA,GAAWC,EAAMC,EAASC,EAAeC,GAQjD,QAASC,KACR,GAGCC,GAHGC,EAAWC,KACdC,EAAWF,EAAKE,SAChBC,EAAWC,EAASJ,EAAKN,OAASU,EAASJ,EAAKN,MAAMS,KAGvDP,GAAcS,QAAQC,KAAKN,GAExBG,IAAUJ,EAASI,KACrBI,QAAQ,WAAa,MAAOR,KAE5BG,EAASM,OAAO,GAAIb,GAAQ,gBAAiBK,EAAKN,OAIpD,QAASe,MAtBT,GAAIL,KAmDJ,OAjDAM,QACEC,GAAG,iBAAmBjB,EAAM,SAASkB,GACrCR,EAAWP,EAASe,GAAWA,OAoBjCH,EAAcI,WACbC,aAAc,WACb,GAAId,GAAeC,KAClBc,EAAeX,EAASJ,EAAKN,OAASU,EAASJ,EAAKN,MAAMqB,YAExDA,KACFf,EAAKgB,QAAUN,OAAOO,MAAM,KAAMF,KAGpCV,QAAS,WACR,GAAIL,GAAeC,KAClBiB,EAAepB,EAAQqB,KAAKnB,EAE1BA,GAAKgB,WAAY,EACnBE,IAEAlB,EAAKgB,QACHI,KACAF,EACA,WACClB,EAAKE,SAASM,OAAO,GAAIb,GAAQ,kBAAmBK,EAAKN,KAAM2B,gBAO9D,IAAKZ,EAAca,QAAQ1B,IAGnCW,SAAU,OAAQ,kBAAmB,yBAA0B,8BAAgCd","file":"legacy.js","sourcesContent":["(function() {\n\t'use strict';\n\n\tfunction definition(path, Failure, handlerModule, isObject) {\n\t\tvar settings = {};\n\n\t\tdemand\n\t\t\t.on('postConfigure:' + path, function(options) {\n\t\t\t\tsettings = isObject(options) ? options : {};\n\t\t\t});\n\n\t\tfunction resolve() {\n\t\t\tvar self     = this,\n\t\t\t\tdeferred = self.deferred,\n\t\t\t\tprobe    = settings[self.path] && settings[self.path].probe,\n\t\t\t\tresult;\n\n\t\t\thandlerModule.process.call(self);\n\n\t\t\tif(probe && (result = probe())) {\n\t\t\t\tprovide(function() { return result; });\n\t\t\t} else {\n\t\t\t\tdeferred.reject(new Failure('error probing', self.path));\n\t\t\t}\n\t\t}\n\n\t\tfunction HandlerLegacy() {}\n\n\t\tHandlerLegacy.prototype = {\n\t\t\tonPreProcess: function() {\n\t\t\t\tvar self         = this,\n\t\t\t\t\tdependencies = settings[self.path] && settings[self.path].dependencies;\n\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tself.enqueue = demand.apply(null, dependencies);\n\t\t\t\t}\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar self         = this,\n\t\t\t\t\tboundResolve = resolve.bind(self);\n\n\t\t\t\tif(self.enqueue === true) {\n\t\t\t\t\tboundResolve();\n\t\t\t\t} else {\n\t\t\t\t\tself.enqueue\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tboundResolve,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tself.deferred.reject(new Failure('error resolving', self.path, arguments));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn new (HandlerLegacy.extends(handlerModule));\n\t}\n\n\tprovide([ 'path', '/demand/failure', '/demand/handler/module', '/demand/validator/isObject' ], definition);\n}());"]}