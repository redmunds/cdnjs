{"version":3,"sources":["/extras/handler/legacy.js"],"names":["definition","path","Failure","handlerModule","isObject","resolve","result","self","this","deferred","probe","settings","process","call","provide","reject","demand","on","options","validate","onPreRequest","dependencies","delay","apply","onPostRequest","boundResolve","bind","then","arguments"],"mappings":";CAAC,WACA,YAEA,SAASA,GAAWC,EAAMC,EAASC,EAAeC,GAQjD,QAASC,KACR,GAGCC,GAHGC,EAAWC,KACdC,EAAWF,EAAKE,SAChBC,EAAWC,EAASJ,EAAKN,OAASU,EAASJ,EAAKN,MAAMS,KAGvDP,GAAcS,QAAQC,KAAKN,GAExBG,IAAUJ,EAASI,KACrBI,QAAQ,WAAa,MAAOR,KAE5BG,EAASM,OAAO,GAAIb,GAAQ,gBAAiBK,EAAKN,OAlBpD,GAAIU,KAsBJ,OApBAK,QACEC,GAAG,iBAAmBhB,EAAM,SAASiB,GACrCP,EAAWP,EAASc,GAAWA,QAmBhCC,SAAUhB,EAAcgB,SACxBC,aAAc,WACb,GAAIb,GAAeC,KAClBa,EAAeV,EAASJ,EAAKN,OAASU,EAASJ,EAAKN,MAAMoB,YAExDA,KACFd,EAAKe,MAAQN,OAAOO,MAAM,KAAMF,IAGjClB,EAAciB,aAAaP,KAAKN,IAEjCiB,cAAerB,EAAcqB,cAC7BZ,QAAS,WACR,GAAIL,GAAeC,KAClBiB,EAAepB,EAAQqB,KAAKnB,EAE1BA,GAAKe,MACPf,EAAKe,MACHK,KACAF,EACA,WACClB,EAAKE,SAASM,OAAO,GAAIb,GAAQ,kBAAmBK,EAAKN,KAAM2B,cAIlEH,MAMJX,SAAU,OAAQ,kBAAmB,yBAA0B,8BAAgCd","file":"legacy.js","sourcesContent":["(function() {\n\t'use strict';\n\n\tfunction definition(path, Failure, handlerModule, isObject) {\n\t\tvar settings = {};\n\n\t\tdemand\n\t\t\t.on('postConfigure:' + path, function(options) {\n\t\t\t\tsettings = isObject(options) ? options : {};\n\t\t\t});\n\n\t\tfunction resolve() {\n\t\t\tvar self     = this,\n\t\t\t\tdeferred = self.deferred,\n\t\t\t\tprobe    = settings[self.path] && settings[self.path].probe,\n\t\t\t\tresult;\n\n\t\t\thandlerModule.process.call(self);\n\n\t\t\tif(probe && (result = probe())) {\n\t\t\t\tprovide(function() { return result; });\n\t\t\t} else {\n\t\t\t\tdeferred.reject(new Failure('error probing', self.path));\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tvalidate: handlerModule.validate,\n\t\t\tonPreRequest: function() {\n\t\t\t\tvar self         = this,\n\t\t\t\t\tdependencies = settings[self.path] && settings[self.path].dependencies;\n\n\t\t\t\tif(dependencies) {\n\t\t\t\t\tself.delay = demand.apply(null, dependencies);\n\t\t\t\t}\n\n\t\t\t\thandlerModule.onPreRequest.call(self);\n\t\t\t},\n\t\t\tonPostRequest: handlerModule.onPostRequest,\n\t\t\tprocess: function() {\n\t\t\t\tvar self         = this,\n\t\t\t\t\tboundResolve = resolve.bind(self);\n\n\t\t\t\tif(self.delay) {\n\t\t\t\t\tself.delay\n\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\tboundResolve,\n\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\tself.deferred.reject(new Failure('error resolving', self.path, arguments));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\tboundResolve();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tprovide([ 'path', '/demand/failure', '/demand/handler/module', '/demand/validator/isObject' ], definition);\n}());"]}