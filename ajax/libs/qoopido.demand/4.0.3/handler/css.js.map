{"version":3,"sources":["/extras/handler/css.js"],"names":["document","definition","resolveUrl","url","resolver","href","replaceUri","source","match","replacement","regexIsAbsoluteUri","test","replace","target","getElementsByTagName","createElement","regexMatchUrl","regexMatchImport","regexIsAbsolutePath","regexMatchType","validate","type","onPreRequest","this","slice","onPostRequest","base","host","exec","process","element","querySelector","id","setAttribute","appendChild","tagName","styleSheet","cssText","textContent","provide"],"mappings":";CAAC,SAASA,GACT,YAEA,SAASC,KASR,QAASC,GAAWC,GAGnB,MAFAC,GAASC,KAAOF,EAETC,EAGR,QAASE,GAAWC,EAAQC,EAAOC,GAKlC,MAJIC,GAAmBC,KAAKH,EAAM,MACjCD,EAASA,EAAOK,QAAQJ,EAAM,GAAIC,IAG5BF,EAnBR,GAAIM,GAAsBb,EAASc,qBAAqB,QAAQ,GAC/DV,EAAsBJ,EAASe,cAAc,KAC7CC,EAAsB,oCACtBC,EAAsB,4BACtBC,EAAsB,OACtBR,EAAsB,yBACtBS,EAAsB,YAgBvB,QACCC,SAAU,SAASC,GAClB,MAAOF,GAAeR,KAAKU,IAE5BC,aAAc,WACb,GAAInB,GAAOoB,KAAKpB,GAEhBoB,MAAKpB,IAAwB,SAAlBA,EAAIqB,OAAM,GAAiBrB,EAAM,OAASA,GAEtDsB,cAAe,WAOd,IANA,GAICjB,GAJGL,EAAUD,EAAWqB,KAAKpB,IAAM,OACnCuB,EAAUvB,EAAIE,KACdsB,EAAU,KAAOxB,EAAIwB,KACrBpB,EAAUgB,KAAKhB,OAGTC,EAAQQ,EAAcY,KAAKrB,IACjCA,EAASD,EAAWC,EAAQC,EAAO,QAAUN,EAAWgB,EAAoBP,KAAKH,EAAM,IAAMmB,EAAOnB,EAAM,GAAKkB,EAAOlB,EAAM,IAAIH,KAAO,KAGxI,MAAOG,EAAQS,EAAiBW,KAAKrB,IACpCA,EAASD,EAAWC,EAAQC,EAAO,YAAcN,EAAWgB,EAAoBP,KAAKH,EAAM,IAAMmB,EAAOnB,EAAM,GAAKkB,EAAOlB,EAAM,IAAIH,KAAO,IAG5IkB,MAAKhB,OAASA,GAEfsB,QAAS,WACR,GAAIC,GAAU9B,EAAS+B,cAAc,eAAiBR,KAAKS,GAAK,KAE5DF,KACHA,EAAe9B,EAASe,cAAc,SACtCe,EAAQT,KAAO,WAEfS,EAAQG,aAAa,YAAaV,KAAKS,IACvCnB,EAAOqB,YAAYJ,IAGG,UAApBA,EAAQK,UACPL,EAAQM,WACVN,EAAQM,WAAWC,QAAUd,KAAKhB,OAElCuB,EAAQQ,YAAcf,KAAKhB,QAI7BgC,QAAQ,WAAa,MAAOT,OAK/BS,QAAQtC,IACPD","file":"css.js","sourcesContent":["(function(document) {\n\t'use strict';\n\n\tfunction definition() {\n\t\tvar target              = document.getElementsByTagName('head')[0],\n\t\t\tresolver            = document.createElement('a'),\n\t\t\tregexMatchUrl       = /url\\s*\\(\\s*[\"']?(.+?)[\"']?\\s*\\)/gi,\n\t\t\tregexMatchImport    = /@import\\s+[\"'](.+?)[\"']/gi,\n\t\t\tregexIsAbsolutePath = /^\\//i,\n\t\t\tregexIsAbsoluteUri  = /^data:|http(s?):|\\/\\//i,\n\t\t\tregexMatchType      = /^text\\/css/;\n\n\t\tfunction resolveUrl(url) {\n\t\t\tresolver.href = url;\n\n\t\t\treturn resolver;\n\t\t}\n\n\t\tfunction replaceUri(source, match, replacement) {\n\t\t\tif(!regexIsAbsoluteUri.test(match[1])) {\n\t\t\t\tsource = source.replace(match[0], replacement);\n\t\t\t}\n\n\t\t\treturn source;\n\t\t}\n\n\t\treturn {\n\t\t\tvalidate: function(type) {\n\t\t\t\treturn regexMatchType.test(type);\n\t\t\t},\n\t\t\tonPreRequest: function() {\n\t\t\t\tvar url  = this.url;\n\n\t\t\t\tthis.url = url.slice(-4) !== '.css' ? url + '.css' : url;\n\t\t\t},\n\t\t\tonPostRequest: function() {\n\t\t\t\tvar url     = resolveUrl(this.url + '/..'),\n\t\t\t\t\tbase    = url.href,\n\t\t\t\t\thost    = '//' + url.host,\n\t\t\t\t\tsource  = this.source,\n\t\t\t\t\tmatch;\n\n\t\t\t\twhile((match = regexMatchUrl.exec(source))) {\n\t\t\t\t\tsource = replaceUri(source, match, 'url(\"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\")');\n\t\t\t\t}\n\n\t\t\t\twhile((match = regexMatchImport.exec(source))) {\n\t\t\t\t\tsource = replaceUri(source, match, '@import \"' + resolveUrl(regexIsAbsolutePath.test(match[1]) ? host + match[1] : base + match[1]).href + '\"');\n\t\t\t\t}\n\n\t\t\t\tthis.source = source;\n\t\t\t},\n\t\t\tprocess: function() {\n\t\t\t\tvar element = document.querySelector('[demand-id=\"' + this.id + '\"]');\n\n\t\t\t\tif(!element) {\n\t\t\t\t\telement      = document.createElement('style');\n\t\t\t\t\telement.type = 'text/css';\n\n\t\t\t\t\telement.setAttribute('demand-id', this.id);\n\t\t\t\t\ttarget.appendChild(element);\n\t\t\t\t}\n\n\t\t\t\tif(element.tagName === 'STYLE') {\n\t\t\t\t\tif(element.styleSheet) {\n\t\t\t\t\t\telement.styleSheet.cssText = this.source;\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.textContent = this.source;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tprovide(function() { return element; });\n\t\t\t}\n\t\t};\n\t}\n\n\tprovide(definition);\n}(document));"]}