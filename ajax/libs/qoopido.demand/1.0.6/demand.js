/*! Qoopido.demand 1.0.6 | https://github.com/dlueth/qoopido.demand | (c) 2015 Dirk Lueth */
!function(e,t,r,n,a,o,u,i){"use strict";function c(){var e=this||{},t=I.defer(),r=b(e,R)?e:ce,n=H.call(arguments);return o(function(){n.forEach(p,r),I.all(n).then(t.resolve,t.reject)}),t.pledge}function s(){var e,t,r=x(arguments[0],ne)?arguments[0]:ce,n=r?arguments[1]:arguments[0];if(!r&&A.current&&(e=A.current,r=e.type+"!"+e.path),r)return o(function(){var a,o,i,c=D.path(r),s=we[c.type]||(we[c.type]={});e||!s[c.path]?(a=new R(r,n,t),o=we[a.type][a.path]=a.pledge,e&&(e.timeout=u(e.timeout),i=e.defered,o.then(i.resolve,function(){i.reject(new S("unable to resolve module",r,arguments))}),!e.cached&&e.store(),A.length>0&&A.next())):m("duplicate found for module "+c.path)}),{when:function(){t=arguments}};throw new S("unspecified anonymous provide")}function l(e){var t,r=e.cache,n=e.storage,a=e.debug,o=e.version,u=e.timeout,i=e.lifetime,c=e.base,s=e.pattern,l=e.probes;if(C=x(r,ae)?r:C,L=x(n,ne)?n:L,N=x(a,ae)?a:N,F=x(o,ne)?o:F,E(u)&&(_=1e3*Math.min(Math.max(u,2),10),B=Math.min(Math.max(_/5,1e3),5e3)),E(i)&&(G=1e3*i),x(c,ne)&&($=be.base=new q("",D.url(c))),j(s))for(t in s)"base"!==t&&(be[t]=new q(t,s[t]));if(j(l))for(t in l)xe[t]=l[t];return!0}function p(e,t,r){var n=this,a=D.path(e,n),o=a.type,u=a.path,i=we[o]||(we[o]={});r[t]=i[u]||(i[u]=new M(e,n).pledge)}function f(e,t){s(e,function(){return t})}function h(){return+new Date}function d(e){z.href=e;var t=z.search,r="demand[timestamp]="+h();return z.search+=t&&"?"!==t?"&"+r:"?"+r,z.href}function m(e){var t=b(e,S)?"error":"warn";x(console,re)||!N&&"warn"===t||console[t](e.toString())}function g(e,t){return new RegExp(e,t)}function v(e){return e.replace(he,"\\$&")}function y(e){return e.replace(me,"")}function w(e){return pe.test(e)}function b(e,t){return e instanceof t}function x(e,t){return typeof e===t}function j(e){return e&&x(e,"object")}function E(e){return x(e,"number")&&isFinite(e)&&Math.floor(e)===e&&e>=0}function I(e){function t(){n(ue,arguments)}function r(){n(ie,arguments)}function n(e,t){a.state===oe&&(a.state=e,a.value=t,o[e].forEach(function(e){e.apply(ce,t)}))}var a=this,o={resolved:[],rejected:[]};a.then=function(e,t){if(a.state===oe)e&&o[ue].push(e),t&&o[ie].push(t);else switch(a.state){case ue:e.apply(ce,a.value);break;case ie:t.apply(ce,a.value)}},e(t,r)}function S(e,t,r){var n=this;n.message=e,t&&(n.module=t),r&&(n.stack=H.call(r))}function q(e,t){var r=this;r.weight=e.length,r.url=D.url(t),r.regexPattern=g("^"+v(e)),r.regexUrl=g("^"+v(t))}function k(){var e=this;e.current=ce,e.queue=[]}function M(e,t){var r,n=this,a=I.defer();D.path.call(n,e,t),n.defered=a,n.pledge=a.pledge,t||n.pledge.then(ce,m),c(Z+n.type).then(function(e){n.retrieve(),n.handler=e,n.cached?A.add(n):(r=T.test(n.url)?new se:new le,r.onprogress=function(){},r.ontimeout=r.onerror=r.onabort=function(){a.reject(new S("unable to load module",n.path))},r.onload=function(){n.timeout=u(n.timeout),n.source=r.responseText,A.add(n)},r.open("GET",d(e.prepare(n.url)),!0),r.send(),n.timeout=o(function(){r.readyState<4&&r.abort()},_))},a.reject)}function R(e,t,r){var n=this,a=I.defer();D.path.call(n,e),(n.pledge=a.pledge).then(ce,function(){m(new S("unable to resolve module",n.path,arguments))}),r&&r.length>0?c.apply(n,r).then(function(){a.resolve(t.apply(ce,arguments))},function(){a.reject(new S("unable to resolve dependencies for",n.path,arguments))}):a.resolve(t())}var T,O,A,D,P,U,X,$,C,L,N,_,B,F,G,H=Array.prototype.slice,J=Array.prototype.concat,Q=t.getElementsByTagName("head")[0],z=t.createElement("a"),K="demand",V="["+K+"]",W="[state]",Y="[value]",Z="/"+K+"/handler/",ee="/"+K+"/storage/",te="/validator/",re="undefined",ne="string",ae="boolean",oe="pending",ue="resolved",ie="rejected",ce=null,se=a,le="XDomainRequest"in e&&e.XDomainRequest||se,pe=/^\//i,fe=/^([-\w]+\/?)+!/,he=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,de=/\/\/#\s+sourceMappingURL\s*=\s*(.+?)\.map/g,me=/^http(s?):/,ge=/^(http(s?):|)\/\//,ve=r&&"remainingSpace"in r,ye={cache:!0,storage:"localstorage",handler:"js",debug:!1,version:"1.0.0",lifetime:0,timeout:5,base:"/"},we={},be={},xe={};D={url:function(e){return z.href=e,z.href},path:function(e,t){var r,n,a=this,o=e.match(fe)||ye.handler,u=b(a,M);if(x(o,ne)||(e=e.replace(g("^"+v(o[0])),""),o=o[1]),!ge.test(e)){w(e)||(e="/"+D.url((t&&t.path&&D.url(t.path+"/../")||"/")+e).replace(T,""));for(r in be)be[r].matches(e)&&(!n||n.weight<be[r].weight)&&(n=be[r])}return u||b(a,R)?(a.type=o,a.path=e,u&&(a.url=n?y(D.url(n.process(e))):e),void 0):{type:o,path:e}}},X={get:function(e,t){var a,o;if(r){if(a=V+"["+e+"]",o=n.parse(r.getItem(a+W)),o&&o.version===F&&o.url===t&&(0===o.expires||o.expires>h))return r.getItem(a+Y);X.clear.path(e)}},set:function(e,t,a){var o,u;if(r){o=V+"["+e+"]";try{if(u=ve?r.remainingSpace:ce,r.setItem(o+Y,t),r.setItem(o+W,n.stringify({version:F,expires:G>0?h+G:0,url:a})),u!==ce&&r.remainingSpace===u)throw"QUOTA_EXCEEDED_ERR"}catch(i){m("unable to cache module "+e)}}},clear:{path:function(e){var t;r&&(t=V+"["+e+"]",r.removeItem(t+W),r.removeItem(t+Y))},all:function(){var e;if(r)for(e in r)0===e.indexOf(V)&&r.removeItem(e)},expired:function(){var e,t,a;if(r)for(e in r)t=e.match(O),t&&(a=n.parse(r.getItem(V+"["+t[1]+"]"+W)),a&&a.expires>0&&a.expires<=h&&X.clear.path(t[1]))}}},U={prepare:function(e){return".js"!==e.slice(-3)?e+".js":e},resolve:function(e,r){var n=t.createElement("script");n.defer=n.async=!0,n.text=r,n.setAttribute("demand-path",e),Q.appendChild(n)},modify:function(e,t){for(var r,n;r=de.exec(t);)n=y(D.url(e+"/../"+r[1])),t=t.replace(r[0],"//# sourcemap="+n+".map");return t}},I.prototype={constructor:I,state:oe,value:ce,listener:ce,then:ce},I.defer=function(){var e={};return e.pledge=new I(function(t,r){e.resolve=t,e.reject=r}),e},I.all=function(e){var t=I.defer(),r=t.pledge,n=[],a=[],o=e.length,u=0;return e.forEach(function(e,r){e.then(function(){n[r]=H.call(arguments),u++,u===o&&t.resolve.apply(ce,J.apply([],n))},function(){a.push(H.call(arguments)),a.length+u===o&&t.reject.apply(ce,J.apply([],a))})}),r},I.race=function(e){var t=I.defer();return e.forEach(function(e){e.then(t.resolve,t.reject)}),t.pledge},S.prototype={message:ce,module:ce,stack:ce,toString:function(){var e=this,t=V+" "+e.message+" "+e.module;return e.stack&&(t=S.traverse(e.stack,t,1)),t}},S.traverse=function(e,t,r){var n=new Array(r+1).join(" ");return e.forEach(function(e){t+="\n"+n+"> "+e.message+" "+e.module,e.stack&&(t=S.traverse(e.stack,t,r+1))}),t},q.prototype={weight:0,url:ce,regexPattern:ce,regexUrl:ce,matches:function(e){return this.regexPattern.test(e)},remove:function(e){return e.replace(this.regexUrl,"")},process:function(e){var t=this;return e.replace(t.regexPattern,t.url)}},k.prototype={current:ce,queue:ce,length:0,add:function(e){var t=this,r=t.queue;r.push(e),t.length++,1===r.length&&t.next()},next:function(){var e,t,r,n=this,a=n.current,u=n.queue;a&&(n.current=ce,u.shift(),n.length--),u.length&&(a=n.current=n.queue[0],e=a.defered,t=a.path,r=a.handler,!a.cached&&r.modify&&(a.source=r.modify(a.url,a.source)),r.resolve(t,a.source),xe[t]&&a.probe(),a.timeout=o(function(){e.reject(new S("timeout resolving module",t))},B))}},M.prototype={type:ce,handler:ce,path:ce,url:ce,defered:ce,pledge:ce,cached:ce,source:ce,timeout:ce,probe:function(){var e,t=this,r=t.path,n=t.pledge.state===oe;n&&((e=xe[r]())?s(function(){return e}):o(t.probe.bind(t),10))},store:function(){var e=this;C&&P.set(e.path,e.source,e.url)},retrieve:function(){var e=this,t=C&&P.get(e.path,e.url),r=e.cached=!!t;r&&(e.source=t)}},R.prototype={type:ce,path:ce,pledge:ce},T=g("^"+v(D.url("/"))),O=g("^"+v(V+"[(.+?)]"+W+"$")),A=new k,be["/"+K]=new q("/"+K,D.url((i&&i.url||location.href)+"/../").slice(0,-1)),l(ye)&&i&&i.settings&&l(i.settings),c.configure=l,e.demand=c,e.provide=s,f("/"+K,c),f("/provide",s),f("/pledge",I),f("/resolve/url",D.url),f(te+"isObject",j),f(te+"isTypeOf",x),f(te+"isInstanceOf",b),f(te+"isPositiveInteger",E),f(ee+ye.storage,X),f(Z+ye.handler,U),c(ee+L).then(function(e){P=e,c.clear=P.clear,P.clear.expired(),i&&i.main&&c(i.main)})}(this,document,function(){try{return"localStorage"in this&&localStorage}catch(e){return!1}}(),JSON,XMLHttpRequest,setTimeout,clearTimeout,"demand"in this&&demand);
//# sourceMappingURL=demand.js.map