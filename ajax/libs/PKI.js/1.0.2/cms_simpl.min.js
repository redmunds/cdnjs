!function(e){if("undefined"==typeof e.org)e.org={};else if("object"!=typeof e.org)throw new Error("Name org already exists and it's not an object");if("undefined"==typeof e.org.pkijs)e.org.pkijs={};else if("object"!=typeof e.org.pkijs)throw new Error("Name org.pkijs already exists and it's not an object but "+typeof e.org.pkijs);if("undefined"==typeof e.org.pkijs.simpl)e.org.pkijs.simpl={};else if("object"!=typeof e.org.pkijs.simpl)throw new Error("Name org.pkijs.simpl already exists and it's not an object but "+typeof e.org.pkijs.simpl);if("undefined"==typeof e.org.pkijs.simpl.cms)e.org.pkijs.simpl.cms={};else if("object"!=typeof e.org.pkijs.simpl.cms)throw new Error("Name org.pkijs.simpl.cms already exists and it's not an object but "+typeof e.org.pkijs.simpl.cms);e.org.pkijs.simpl.CMS_CONTENT_INFO=function(){this.contentType="",this.content=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.contentType=arguments[0].contentType||"",this.content=arguments[0].content||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_CONTENT_INFO());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_CONTENT_INFO");this.contentType=i.result.contentType.value_block.toString(),this.content=i.result.content},e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.contentType}),new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.content]})]})},e.org.pkijs.simpl.CMS_CONTENT_INFO.prototype.toJSON=function(){var t={contentType:this.contentType};return this.content instanceof e.org.pkijs.asn1.ANY||(t.content=this.content.toJSON()),t},e.org.pkijs.simpl.cms.OtherCertificateFormat=function(){this.otherCertFormat="",this.otherCert=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.otherCertFormat=arguments[0].contentType||"",this.otherCert=arguments[0].content||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherCertificateFormat());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherCertificateFormat");this.otherCertFormat=i.result.otherCertFormat.value_block.toString(),this.otherCert=i.result.otherCert},e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.otherCertFormat}),this.otherCert]})},e.org.pkijs.simpl.cms.OtherCertificateFormat.prototype.toJSON=function(){var t={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof e.org.pkijs.asn1.ANY||(t.otherCert=this.otherCert.toJSON()),t},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat=function(){this.otherRevInfoFormat="",this.otherRevInfo=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.otherRevInfoFormat=arguments[0].contentType||"",this.otherRevInfo=arguments[0].content||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherRevocationInfoFormat());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherRevocationInfoFormat");this.otherRevInfoFormat=i.result.otherRevInfoFormat.value_block.toString(),this.otherRevInfo=i.result.otherRevInfo},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.otherRevInfoFormat}),this.otherRevInfo]})},e.org.pkijs.simpl.cms.OtherRevocationInfoFormat.prototype.toJSON=function(){var t={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof e.org.pkijs.asn1.ANY||(t.otherRevInfo=this.otherRevInfo.toJSON()),t},e.org.pkijs.simpl.CMS_CERTIFICATE_SET=function(){this.certificates=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.certificates=arguments[0].certificates||new Array)},e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_CERTIFICATE_SET());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_CERTIFICATE_SET");for(var s=i.result.certificates,r=0;s>r;r++)1===s.id_block.tag_class?this.certificates.push(new e.org.pkijs.simpl.CERT({schema:s[r]})):this.certificates.push(s[r])},e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.certificates.length;i++)this.certificates[i]instanceof e.org.pkijs.simpl.CERT?t.push(this.certificates[i].toSchema()):t.push(this.certificates[i]);return new e.org.pkijs.asn1.SET({value:t})},e.org.pkijs.simpl.CMS_CERTIFICATE_SET.prototype.toJSON=function(){var e={};e.certificates=new Array;for(var t=0;t<this.certificates.length;t++)e.certificates.push(this.certificates[t].toJSON());return e},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES=function(){this.crls=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.crls=arguments[0].crls||new Array)},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CSM_REVOCATION_INFO_CHOICES());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CSM_REVOCATION_INFO_CHOICES");for(var s=i.result.crls,r=0;s>r;r++)1===s.id_block.tag_class?this.crls.push(new e.org.pkijs.simpl.CRL({schema:s[r]})):this.crls.push(s[r])},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.crls.length;i++)this.crls[i]instanceof e.org.pkijs.simpl.CRL?t.push(this.crls[i].toSchema()):t.push(this.crls[i]);return new e.org.pkijs.asn1.SET({value:t})},e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES.prototype.toJSON=function(){var e={};e.crls=new Array;for(var t=0;t<this.crls.length;t++)e.crls.push(this.crls[t].toJSON());return e},e.org.pkijs.simpl.cms.IssuerAndSerialNumber=function(){this.issuer=new e.org.pkijs.simpl.RDN,this.serialNumber=new e.org.pkijs.asn1.INTEGER,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.issuer=arguments[0].issuer||new e.org.pkijs.simpl.RDN,this.serialNumber=arguments[0].serialNumber||new e.org.pkijs.asn1.INTEGER)},e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.IssuerAndSerialNumber({names:{issuer:{names:{block_name:"issuer"}},serialNumber:"serialNumber"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for IssuerAndSerialNumber");this.issuer=new e.org.pkijs.simpl.RDN({schema:i.result.issuer}),this.serialNumber=i.result.serialNumber},e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[this.issuer.toSchema(),this.serialNumber]})},e.org.pkijs.simpl.cms.IssuerAndSerialNumber.prototype.toJSON=function(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}},e.org.pkijs.simpl.cms.Attribute=function(){this.attrType="",this.attrValues=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.Attribute.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.attrType=arguments[0].attrType||"",this.attrValues=arguments[0].attrValues||new Array)},e.org.pkijs.simpl.cms.Attribute.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.Attribute({names:{attrType:"attrType",attrValues:"attrValues"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for Attribute");this.attrType=i.result.attrType.value_block.toString(),this.attrValues=i.result.attrValues},e.org.pkijs.simpl.cms.Attribute.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.attrType}),new e.org.pkijs.asn1.SET({value:this.attrValues})]})},e.org.pkijs.simpl.cms.Attribute.prototype.toJSON=function(){var e={attrType:this.attrType};e.attrValues=new Array;for(var t=0;t<this.attrValues.length;t++)e.attrValues.push(this.attrValues[t].toJSON());return e},e.org.pkijs.simpl.cms.SignedUnsignedAttributes=function(){this.type=0,this.attributes=new Array,this.encoded_value=new ArrayBuffer(0),arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.type=arguments[0].type||0,this.attributes=arguments[0].attributes||new Array)},e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.SignedUnsignedAttributes({names:{attributes:"attributes"}},this.type));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for SignedUnsignedAttributes");this.type=i.result.id_block.tag_number,this.encoded_value=i.result.value_before_decode;var s=new Uint8Array(this.encoded_value);if(s[0]=49,"attributes"in i.result!=!1)for(var r=i.result.attributes,n=0;n<r.length;n++)this.attributes.push(new e.org.pkijs.simpl.cms.Attribute({schema:r[n]}));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")},e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.attributes.length;i++)t.push(this.attributes[i].toSchema());return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:this.type},value:t})},e.org.pkijs.simpl.cms.SignedUnsignedAttributes.prototype.toJSON=function(){var e={type:this.type};e.attributes=new Array;for(var t=0;t<this.attributes.length;t++)e.attributes.push(this.attributes[t].toJSON());return e},e.org.pkijs.simpl.CMS_SIGNER_INFO=function(){this.version=0,this.sid=new e.org.pkijs.asn1.ANY,this.digestAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signatureAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.sid=arguments[0].sid||new e.org.pkijs.asn1.ANY,this.digestAlgorithm=arguments[0].digestAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,"signedAttrs"in arguments[0]&&(this.signedAttrs=arguments[0].signedAttrs),this.signatureAlgorithm=arguments[0].signatureAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.signature=arguments[0].signature||new e.org.pkijs.asn1.OCTETSTRING,"unsignedAttrs"in arguments[0]&&(this.unsignedAttrs=arguments[0].unsignedAttrs))},e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_SIGNER_INFO());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_SIGNER_INFO");this.version=i.result["SignerInfo.version"].value_block.value_dec;var s=i.result["SignerInfo.sid"];1===s.id_block.tag_class?this.sid=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:s}):this.sid=s,this.digestAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result["SignerInfo.digestAlgorithm"]}),"SignerInfo.signedAttrs"in i.result&&(this.signedAttrs=new e.org.pkijs.simpl.cms.SignedUnsignedAttributes({schema:i.result["SignerInfo.signedAttrs"]})),this.signatureAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result["SignerInfo.signatureAlgorithm"]}),this.signature=i.result["SignerInfo.signature"],"SignerInfo.unsignedAttrs"in i.result&&(this.unsignedAttrs=new e.org.pkijs.simpl.cms.SignedUnsignedAttributes,this.unsignedAttrs.type=1,this.unsignedAttrs.fromSchema(i.result["SignerInfo.unsignedAttrs"]))},e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),this.sid instanceof e.org.pkijs.simpl.cms.IssuerAndSerialNumber?t.push(this.sid.toSchema()):t.push(this.sid),t.push(this.digestAlgorithm.toSchema()),"signedAttrs"in this&&t.push(this.signedAttrs.toSchema()),t.push(this.signatureAlgorithm.toSchema()),t.push(this.signature),"unsignedAttrs"in this&&t.push(this.unsignedAttrs.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.CMS_SIGNER_INFO.prototype.toJSON=function(){var t={version:this.version};return this.sid instanceof e.org.pkijs.asn1.ANY||(t.sid=this.sid.toJSON()),t.digestAlgorithm=this.digestAlgorithm.toJSON(),"signedAttrs"in this&&(t.signedAttrs=this.signedAttrs.toJSON()),t.signatureAlgorithm=this.signatureAlgorithm.toJSON(),t.signature=this.signature.toJSON(),"unsignedAttrs"in this&&(t.unsignedAttrs=this.unsignedAttrs.toJSON()),t},e.org.pkijs.simpl.cms.EncapsulatedContentInfo=function(){if(this.eContentType="",arguments[0]instanceof Object&&"schema"in arguments[0])e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.fromSchema.call(this,arguments[0].schema);else if(arguments[0]instanceof Object&&(this.eContentType=arguments[0].eContentType||"","eContent"in arguments[0]&&(this.eContent=arguments[0].eContent,1===this.eContent.id_block.tag_class&&4===this.eContent.id_block.tag_number&&this.eContent.id_block.is_constructed===!1))){for(var t=new e.org.pkijs.asn1.OCTETSTRING({id_block:{is_constructed:!0},is_constructed:!0}),i=0,s=this.eContent.value_block.value_hex.byteLength;s>0;){for(var r=new Uint8Array(this.eContent.value_block.value_hex,i,i+65536>this.eContent.value_block.value_hex.byteLength?this.eContent.value_block.value_hex.byteLength-i:65536),n=new ArrayBuffer(r.length),o=new Uint8Array(n),a=0;a<o.length;a++)o[a]=r[a];t.value_block.value.push(new e.org.pkijs.asn1.OCTETSTRING({value_hex:n})),s-=r.length,i+=r.length}this.eContent=t}},e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.EncapsulatedContentInfo({names:{eContentType:"eContentType",eContent:"eContent"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for EncapsulatedContentInfo");this.eContentType=i.result.eContentType.value_block.toString(),"eContent"in i.result&&(this.eContent=i.result.eContent)},e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.OID({value:this.eContentType})),"eContent"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:[this.eContent]})),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.EncapsulatedContentInfo.prototype.toJSON=function(){var e={eContentType:this.eContentType};return"eContent"in this&&(e.eContent=this.eContent.toJSON()),e},e.org.pkijs.simpl.CMS_SIGNED_DATA=function(){this.version=0,this.digestAlgorithms=new Array,this.encapContentInfo=new e.org.pkijs.simpl.cms.EncapsulatedContentInfo,this.signerInfos=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.digestAlgorithms=arguments[0].digestAlgorithms||new Array,this.encapContentInfo=arguments[0].encapContentInfo||new e.org.pkijs.simpl.cms.EncapsulatedContentInfo,"certificates"in arguments[0]&&(this.certificates=arguments[0].certificates),"crls"in arguments[0]&&(this.crls=arguments[0].crls),this.signerInfos=arguments[0].signerInfos||new Array)},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_SIGNED_DATA());if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_SIGNED_DATA");this.version=i.result["SignedData.version"].value_block.value_dec;for(var s=i.result["SignedData.digestAlgorithms"],r=0;r<s.length;r++)this.digestAlgorithms.push(new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:s[r]}));if(this.encapContentInfo=new e.org.pkijs.simpl.cms.EncapsulatedContentInfo({schema:i.result["SignedData.encapContentInfo"]}),"SignedData.certificates"in i.result){this.certificates=new Array;for(var n=i.result["SignedData.certificates"],o=0;o<n.length;o++)1===n[o].id_block.tag_class?this.certificates.push(new e.org.pkijs.simpl.CERT({schema:n[o]})):this.certificates.push(new e.org.pkijs.simpl.cms.OtherCertificateFormat({schema:n[o]}))}if("SignedData.crls"in i.result){this.crls=new Array;for(var a=i.result["SignedData.crls"],c=0;c<a.length;c++)1===a[c].id_block.tag_class?this.crls.push(new e.org.pkijs.simpl.CRL({schema:a[c]})):this.crls.push(new e.org.pkijs.simpl.cms.OtherRevocationInfoFormat({schema:a[c]}))}for(var p=i.result["SignedData.signerInfos"],h=0;h<p.length;h++)this.signerInfos.push(new e.org.pkijs.simpl.CMS_SIGNER_INFO({schema:p[h]}))},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.toSchema=function(t){"undefined"==typeof t&&(t=!1);var i=new Array;i.push(new e.org.pkijs.asn1.INTEGER({value:this.version}));for(var s=new Array,r=0;r<this.digestAlgorithms.length;r++)s.push(this.digestAlgorithms[r].toSchema(t));if(i.push(new e.org.pkijs.asn1.SET({value:s})),i.push(this.encapContentInfo.toSchema()),"certificates"in this){for(var n=new Array,o=0;o<this.certificates.length;o++)n.push(this.certificates[o].toSchema(t));i.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:n}))}if("crls"in this){for(var a=new Array,c=0;c<this.crls.length;c++)a.push(this.crls[c].toSchema(t));i.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:a}))}for(var p=new Array,h=0;h<this.signerInfos.length;h++)p.push(this.signerInfos[h].toSchema(t));return i.push(new e.org.pkijs.asn1.SET({value:p})),new e.org.pkijs.asn1.SEQUENCE({value:i})},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.verify=function(){function t(e){if(e.issuer.isEqual(p.issuer)===!0&&e.serialNumber.isEqual(p.serialNumber)===!0)return null;for(var t=!1,i=0;i<e.extensions.length;i++)"2.5.29.19"===e.extensions[i].extnID&&"cA"in e.extensions[i].parsedValue&&e.extensions[i].parsedValue.cA===!0&&(t=!0);return t?e:null}var i=Promise.resolve(),s=this.certificates,r=this.signerInfos,n=this.encapContentInfo,o=new ArrayBuffer(0),a="",c=-1,p={},h=new Array,m=this,l=e.org.pkijs.getCrypto();if("undefined"==typeof l)return new Promise(function(e,t){t("Unable to create WebCrypto object")});if(arguments[0]instanceof Object&&("signer"in arguments[0]&&(c=arguments[0].signer),"data"in arguments[0]&&(o=arguments[0].data),"trusted_certs"in arguments[0]&&(h=arguments[0].trusted_certs)),-1===c)return new Promise(function(e,t){t("Unable to get signer index from input parameters")});if("certificates"in this==!1)return new Promise(function(e,t){t("No certificates attached to this signed data")});i=this.signerInfos[c].sid instanceof e.org.pkijs.simpl.cms.IssuerAndSerialNumber?i.then(function(){for(var e=0;s.length;e++)if(s[e].issuer.isEqual(r[c].sid.issuer)&&s[e].serialNumber.isEqual(r[c].sid.serialNumber))return p=s[e],new Promise(function(e,t){e()});return new Promise(function(e,t){t("Unable to find signer certificate")})}):i.then(function(){for(var t=new Array,i=0;i<s.length;i++)t.push(l.digest({name:"sha-1"},new Uint8Array(s[i].subjectPublicKeyInfo.subjectPublicKey.value_block.value_hex)));return Promise.all(t).then(function(t){for(var i=0;i<s.length;i++)if(e.org.pkijs.isEqual_buffer(t[i],r[c].sid.value_block.value_hex))return p=s[i],new Promise(function(e,t){e()});return new Promise(function(e,t){t("Unable to find signer certificate")})},function(e){return new Promise(function(e,t){t("Unable to find signer certificate")})})});for(var u=new Array,g=0;g<this.certificates.length;g++)u.push(t(this.certificates[g]));return i=i.then(function(e){return Promise.all(u).then(function(e){var t=new Array;t.push(p);for(var i=0;i<e.length;i++)null!==e[i]&&t.push(e[i]);var s=new org.pkijs.simpl.CERT_CHAIN({certs:t,trusted_certs:h});return"crls"in m&&(s.crls=m.crls),s.verify().then(function(e){return e.result===!0?new Promise(function(e,t){e()}):new Promise(function(e,t){t("Validation of signer's certificate failed")})},function(e){return new Promise(function(t,i){i("Validation of signer's certificate failed with error: "+(e instanceof Object?e.result_message:e))})})},function(e){return new Promise(function(t,i){i("Error during checking certificates for CA flag: "+e)})})}),i=i.then(function(){switch(r[c].digestAlgorithm.algorithm_id){case"1.3.14.3.2.26":a="sha-1";break;case"2.16.840.1.101.3.4.2.1":a="sha-256";break;case"2.16.840.1.101.3.4.2.2":a="sha-384";break;case"2.16.840.1.101.3.4.2.3":a="sha-512";break;default:return new Promise(function(e,t){t("Unsupported signature algorithm: "+m.signerInfos[c].digestAlgorithm.algorithm_id)})}return new Promise(function(e,t){e()})}),i=i.then(function(){if("signedAttrs"in r[c])o=r[c].signedAttrs.encoded_value;else if("eContent"in n)if(1===n.eContent.id_block.tag_class&&4===n.eContent.id_block.tag_number)if(n.eContent.id_block.is_constructed===!1)o=n.eContent.value_block.value_hex;else for(var t=0;t<n.eContent.value_block.value.length;t++)o=e.org.pkijs.concat_buffers(o,n.eContent.value_block.value[t].value_block.value_hex);else o=n.eContent.value_block.value_hex;else if(0===o.byteLength)return new Promise(function(e,t){t("Missed detached data input array")})}),i=i.then(function(){var e=p.subjectPublicKeyInfo.toSchema(),t=e.toBER(!1),i=new Uint8Array(t);return l.importKey("spki",i,{name:"RSASSA-PKCS1-v1_5",hash:{name:a}},!0,["verify"])}),i=i.then(function(e){return l.verify({name:e.algorithm.name,hash:{name:a}},e,new Uint8Array(r[c].signature.value_block.value_hex),new Uint8Array(o))})},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.sign=function(t,i){var s=this,r=new ArrayBuffer(0),n="";if("undefined"==typeof t)return new Promise(function(e,t){t("Need to provide a private key for signing")});switch(s.signerInfos[i].digestAlgorithm.algorithm_id){case"1.3.14.3.2.26":n="sha-1";break;case"2.16.840.1.101.3.4.2.1":n="sha-256";break;case"2.16.840.1.101.3.4.2.2":n="sha-384";break;case"2.16.840.1.101.3.4.2.3":n="sha-512";break;default:return new Promise(function(e,t){t("Unsupported signature algorithm: "+this.signature.signatureAlgorithm.algorithm_id)})}if("signedAttrs"in s.signerInfos[i])if(0!==s.signerInfos[i].signedAttrs.encoded_value.byteLength)r=s.signerInfos[i].signedAttrs.encoded_value;else{r=s.signerInfos[i].signedAttrs.toSchema(!0).toBER(!1);var o=new Uint8Array(r);o[0]=49}else if("eContent"in s.encapContentInfo)if(1===s.encapContentInfo.eContent.id_block.tag_class&&4===s.encapContentInfo.eContent.id_block.tag_number)if(s.encapContentInfo.eContent.id_block.is_constructed===!1)r=s.encapContentInfo.eContent.value_block.value_hex;else for(var a=0;a<s.encapContentInfo.eContent.value_block.value.length;a++)r=e.org.pkijs.concat_buffers(r,s.encapContentInfo.eContent.value_block.value[a].value_block.value_hex);else r=s.encapContentInfo.eContent.value_block.value_hex;else if(0===r.byteLength)return new Promise(function(e,t){t("Missed detached data input array")});var c=e.org.pkijs.getCrypto();return"undefined"==typeof c?new Promise(function(e,t){t("Unable to create WebCrypto object")}):c.sign({name:t.algorithm.name,hash:{name:n}},t,new Uint8Array(r)).then(function(t){return s.signerInfos[i].signature=new e.org.pkijs.asn1.OCTETSTRING({value_hex:t}),new Promise(function(e,i){e(t)})},function(e){return new Promise(function(t,i){i("Signing error: "+e)})})},e.org.pkijs.simpl.CMS_SIGNED_DATA.prototype.toJSON=function(){var e={version:this.version};e.digestAlgorithms=new Array;for(var t=0;t<this.digestAlgorithms.length;t++)e.digestAlgorithms.push(this.digestAlgorithms[t].toJSON());if(e.encapContentInfo=this.encapContentInfo.toJSON(),"certificates"in this){e.certificates=new Array;for(var t=0;t<this.certificates.length;t++)e.certificates.push(this.certificates[t].toJSON())}if("crls"in this){e.crls=new Array;for(var t=0;t<this.crls.length;t++)e.crls.push(this.crls[t].toJSON())}e.signerInfos=new Array;for(var t=0;t<this.signerInfos.length;t++)e.signerInfos.push(this.signerInfos[t].toJSON());return e},e.org.pkijs.simpl.cms.RecipientIdentifier=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientIdentifier({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientIdentifier");1===i.result.block_name.id_block.tag_class?(this.variant=1,this.value=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.block_name})):(this.variant=2,this.value=i.result.block_name.value_block.value[0])},e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.value]});default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.cms.RecipientIdentifier.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.KeyTransRecipientInfo=function(){this.version=-1,this.rid={toJSON:function(){return{}}},this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||-1,this.rid=arguments[0].rid||{},this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING)},e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KeyTransRecipientInfo({names:{version:"version",rid:{names:{block_name:"rid"}},keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KeyTransRecipientInfo");this.version=i.result.version.value_block.value_dec,3===i.result.rid.id_block.tag_class?this.rid=i.result.rid.value_block.value[0]:this.rid=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.rid}),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),this.rid instanceof e.org.pkijs.simpl.cms.IssuerAndSerialNumber?t.push(this.rid.toSchema()):t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.rid]})),t.push(this.keyEncryptionAlgorithm.toSchema()),t.push(this.encryptedKey),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.KeyTransRecipientInfo.prototype.toJSON=function(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.OriginatorPublicKey=function(){this.algorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.publicKey=new e.org.pkijs.asn1.BITSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.algorithm=arguments[0].algorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.publicKey=arguments[0].publicKey||new e.org.pkijs.asn1.BITSTRING)},e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OriginatorPublicKey({names:{algorithm:{names:{block_name:"algorithm"}},publicKey:"publicKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OriginatorPublicKey");this.algorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.algorithm}),this.publicKey=i.result.publicKey},e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[this.algorithm.toSchema(),this.publicKey]})},e.org.pkijs.simpl.cms.OriginatorPublicKey.prototype.toJSON=function(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OriginatorIdentifierOrKey({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OriginatorIdentifierOrKey");1===i.result.block_name.id_block.tag_class?(this.variant=1,this.value=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.block_name})):0===i.result.block_name.id_block.tag_number?(this.variant=2,this.value=i.result.block_name.value_block.value[0]):(this.variant=3,this.value=new e.org.pkijs.simpl.cms.OriginatorPublicKey({schema:i.result.block_name.value_block.value[0]}))},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.value]});case 3:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:1},value:[this.value.toSchema()]});default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.OtherKeyAttribute=function(){this.keyAttrId="",arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.keyAttrId=arguments[0].keyAttrId||new e.org.pkijs.asn1.OID,
"keyAttr"in arguments[0]&&(this.keyAttr=arguments[0].keyAttr))},e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherKeyAttribute({names:{keyAttrId:"keyAttrId",keyAttr:"keyAttr"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherKeyAttribute");this.keyAttrId=i.result.keyAttrId.value_block.toString(),"keyAttr"in i.result&&(this.keyAttr=i.result.keyAttr)},e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.OID({value:this.keyAttrId})),"keyAttr"in this&&t.push(this.keyAttr.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.OtherKeyAttribute.prototype.toJSON=function(){var e={keyAttrId:this.keyAttrId};return"keyAttr"in this&&(e.keyAttr=this.keyAttr.toJSON()),e},e.org.pkijs.simpl.cms.RecipientKeyIdentifier=function(){this.subjectKeyIdentifier=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.subjectKeyIdentifier=arguments[0].subjectKeyIdentifier||new e.org.pkijs.asn1.OCTETSTRING,"date"in arguments[0]&&(this.date=arguments[0].date),"other"in arguments[0]&&(this.other=arguments[0].other))},e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientKeyIdentifier({names:{subjectKeyIdentifier:"subjectKeyIdentifier",date:"date",other:{names:{block_name:"other"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientKeyIdentifier");this.subjectKeyIdentifier=i.result.subjectKeyIdentifier,"date"in i.result&&(this.date=i.result.date),"other"in i.result&&(this.other=new e.org.pkijs.simpl.cms.OtherKeyAttribute({schema:i.result.other}))},e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.toSchema=function(){var t=new Array;return t.push(this.subjectKeyIdentifier),"date"in this&&t.push(this.date),"other"in this&&t.push(this.other.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.RecipientKeyIdentifier.prototype.toJSON=function(){var e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KeyAgreeRecipientIdentifier({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientIdentifier");1===i.result.block_name.id_block.tag_class?(this.variant=1,this.value=new e.org.pkijs.simpl.cms.IssuerAndSerialNumber({schema:i.result.block_name})):(this.variant=2,i.result.block_name.id_block.tag_class=1,i.result.block_name.id_block.tag_number=16,this.value=new e.org.pkijs.simpl.cms.RecipientKeyIdentifier({schema:i.result.block_name}))},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:this.value.toSchema().value_block.value});default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.RecipientEncryptedKey=function(){this.rid=new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.rid=arguments[0].rid||new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING)},e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientEncryptedKey({names:{rid:{block_name:"rid"},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKey");this.rid=new new e.org.pkijs.simpl.cms.KeyAgreeRecipientIdentifier({schema:i.result.rid}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[this.rid.toSchema(),this.encryptedKey]})},e.org.pkijs.simpl.cms.RecipientEncryptedKey.prototype.toJSON=function(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.RecipientEncryptedKeys=function(){this.encryptedKeys=new Array,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.encryptedKeys=arguments[0].encryptedKeys||new Array)},e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.RecipientEncryptedKeys({names:{RecipientEncryptedKeys:"RecipientEncryptedKeys"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKeys");for(var s=i.result.RecipientEncryptedKeys,r=0;r<s.length;r++)this.encryptedKeys.push(new e.org.pkijs.simpl.cms.RecipientEncryptedKey({schema:s[r]}))},e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.toSchema=function(){for(var t=new Array,i=0;i<this.encryptedKeys.length;i++)t.push(this.encryptedKeys[i].toSchema());return new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.RecipientEncryptedKeys.prototype.toJSON=function(){var e={};e.encryptedKeys=new Array;for(var t=0;t<this.encryptedKeys.length;t++)e.encryptedKeys.push(this.encryptedKeys[t].toJSON());return e},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo=function(){this.version=0,this.originator=new e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey,this.ukm=new e.org.pkijs.asn1.OCTETSTRING,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.recipientEncryptedKeys=new e.org.pkijs.simpl.cms.RecipientEncryptedKeys,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=0,this.originator=new e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey,this.ukm=new e.org.pkijs.asn1.OCTETSTRING,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.recipientEncryptedKeys=new e.org.pkijs.simpl.cms.RecipientEncryptedKeys)},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KeyAgreeRecipientInfo({names:{version:"version",originator:{names:{block_name:"originator"}},ukm:"ukm",keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},recipientEncryptedKeys:{names:{block_name:"recipientEncryptedKeys"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientInfo");this.version=i.result.version.value_block.value_dec,this.originator=new e.org.pkijs.simpl.cms.OriginatorIdentifierOrKey({schema:i.result.originator}),this.ukm=i.result.ukm,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new e.org.pkijs.simpl.cms.RecipientEncryptedKeys({schema:i.result.recipientEncryptedKeys})},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.INTEGER({value:this.version}),new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.originator.toSchema()]}),new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:[this.ukm]}),this.keyEncryptionAlgorithm.toSchema(),this.recipientEncryptedKeys.toSchema()]})},e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo.prototype.toJSON=function(){return{version:this.version,originator:this.originator.toJSON(),ukm:this.ukm.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()}},e.org.pkijs.simpl.cms.KEKIdentifier=function(){this.keyIdentifier=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KEKIdentifier.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.keyIdentifier=arguments[0].keyIdentifier||new e.org.pkijs.asn1.OCTETSTRING,"date"in arguments[0]&&(this.date=arguments[0].date),"other"in arguments[0]&&(this.other=arguments[0].other))},e.org.pkijs.simpl.cms.KEKIdentifier.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KEKIdentifier({names:{keyIdentifier:"keyIdentifier",date:"date",other:{names:{block_name:"other"}}}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KEKIdentifier");this.keyIdentifier=i.result.keyIdentifier,"date"in i.result&&(this.date=i.result.date),"other"in i.result&&(this.other=new e.org.pkijs.simpl.cms.OtherKeyAttribute({schema:i.result.other}))},e.org.pkijs.simpl.cms.KEKIdentifier.prototype.toSchema=function(){var t=new Array;return t.push(this.keyIdentifier),"date"in this&&t.push(this.date),"other"in this&&t.push(this.other.toSchema()),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.KEKIdentifier.prototype.toJSON=function(){var e={keyIdentifier:this.keyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e},e.org.pkijs.simpl.cms.KEKRecipientInfo=function(){this.version=0,this.kekid=new e.org.pkijs.simpl.cms.KEKIdentifier,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,this.kekid=arguments[0].kekid||new e.org.pkijs.simpl.cms.KEKIdentifier,this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING)},e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.KEKRecipientInfo({names:{version:"version",kekid:{names:{block_name:"kekid"}},keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for KEKRecipientInfo");this.version=i.result.version.value_block.value_dec,this.kekid=new e.org.pkijs.simpl.cms.KEKIdentifier({schema:i.result.kekid}),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.INTEGER({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})},e.org.pkijs.simpl.cms.KEKRecipientInfo.prototype.toJSON=function(){return{version:this.version,kekid:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.PasswordRecipientinfo=function(){this.version=-1,this.keyDerivationAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=new e.org.pkijs.asn1.OCTETSTRING,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||-1,this.keyDerivationAlgorithm=arguments[0].keyDerivationAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.keyEncryptionAlgorithm=arguments[0].keyEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,this.encryptedKey=arguments[0].encryptedKey||new e.org.pkijs.asn1.OCTETSTRING)},e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.PasswordRecipientinfo({names:{version:"version",keyDerivationAlgorithm:{names:{block_name:"keyDerivationAlgorithm"}},keyEncryptionAlgorithm:{names:{block_name:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for PasswordRecipientinfo");this.version=i.result.version.value_block.value_dec,this.keyDerivationAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyDerivationAlgorithm}),this.keyEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.keyEncryptionAlgorithm}),this.encryptedKey=i.result.encryptedKey},e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.INTEGER({value:this.version}),this.keyDerivationAlgorithm.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})},e.org.pkijs.simpl.cms.PasswordRecipientinfo.prototype.toJSON=function(){return{version:this.version,keyDerivationAlgorithm:this.keyDerivationAlgorithm.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}},e.org.pkijs.simpl.cms.OtherRecipientInfo=function(){this.oriType="",this.oriValue=new e.org.pkijs.asn1.ANY,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.oriType=arguments[0].oriType||"",this.oriValue=arguments[0].oriValue||new e.org.pkijs.asn1.ANY)},e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OtherRecipientInfo({names:{oriType:"oriType",oriValue:"oriValue"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OtherRecipientInfo");this.oriType=i.result.oriType.value_block.toString(),this.oriValue=i.result.oriValue},e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.OID({value:this.oriType}),this.oriValue]})},e.org.pkijs.simpl.cms.OtherRecipientInfo.prototype.toJSON=function(){var t={oriType:this.oriType};return this.oriValue instanceof e.org.pkijs.asn1.ANY||(t.oriValue=this.oriValue.toJSON()),t},e.org.pkijs.simpl.CMS_RECIPIENT_INFO=function(){this.variant=-1,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.variant=arguments[0].variant||-1,"value"in arguments[0]&&(this.value=arguments[0].value))},e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_RECIPIENT_INFO({names:{block_name:"block_name"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_RECIPIENT_INFO");if(1===i.result.block_name.id_block.tag_class)this.variant=1,this.value=new e.org.pkijs.simpl.cms.KeyTransRecipientInfo({schema:i.result.block_name});else{switch(i.result.block_name.id_block.tag_number){case 1:this.variant=2,this.value=new e.org.pkijs.simpl.cms.KeyAgreeRecipientInfo({schema:i.result.block_name.value_block.value[0]});break;case 2:this.variant=3,this.value=new e.org.pkijs.simpl.cms.KEKRecipientInfo({schema:i.result.block_name.value_block.value[0]});break;case 3:this.variant=4,this.value=new e.org.pkijs.simpl.cms.PasswordRecipientinfo({schema:i.result.block_name.value_block.value[0]});break;case 4:this.variant=5,this.value=new e.org.pkijs.simpl.cms.OtherRecipientInfo({schema:i.result.block_name.value_block.value[0]})}this.variant=2,this.value=i.result.block_name.value_block.value[0]}},e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.toSchema=function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:this.variant-1},value:[this.value.toSchema()]});default:return new e.org.pkijs.asn1.ANY}return new e.org.pkijs.asn1.ANY},e.org.pkijs.simpl.CMS_RECIPIENT_INFO.prototype.toJSON=function(){var e={variant:this.variant};return 1!=this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e},e.org.pkijs.simpl.cms.OriginatorInfo=function(){this.certs=new e.org.pkijs.simpl.CMS_CERTIFICATE_SET,this.crls=new e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.OriginatorInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.certs=arguments[0].certs||new e.org.pkijs.simpl.CMS_CERTIFICATE_SET,this.crls=arguments[0].crls||new e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES)},e.org.pkijs.simpl.cms.OriginatorInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.OriginatorInfo({names:{certs:"certs",crls:"crls"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for OriginatorInfo");i.result.certs.id_block.tag_class=1,i.result.certs.id_block.tag_number=17,this.certs=new e.org.pkijs.simpl.CMS_CERTIFICATE_SET({schema:i.result.certs}),i.result.crls.id_block.tag_class=1,i.result.crls.id_block.tag_number=17,this.crls=new e.org.pkijs.simpl.CSM_REVOCATION_INFO_CHOICES({schema:i.result.crls})},e.org.pkijs.simpl.cms.OriginatorInfo.prototype.toSchema=function(){return new e.org.pkijs.asn1.SEQUENCE({value:[new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:this.certs.toSchema().value_block.value}),new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:this.crls.toSchema().value_block.value})]})},e.org.pkijs.simpl.cms.OriginatorInfo.prototype.toJSON=function(){return{certs:this.certs.toJSON(),crls:this.crls.toJSON()}},e.org.pkijs.simpl.cms.EncryptedContentInfo=function(){this.contentType="",this.contentEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.contentType=arguments[0].contentType||"",this.contentEncryptionAlgorithm=arguments[0].contentEncryptionAlgorithm||new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER,"encryptedContent"in arguments[0]&&(this.encryptedContent=arguments[0].encryptedContent))},e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.cms.EncryptedContentInfo({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{block_name:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=i.result.contentType.value_block.toString(),this.contentEncryptionAlgorithm=new e.org.pkijs.simpl.ALGORITHM_IDENTIFIER({schema:i.result.contentEncryptionAlgorithm}),"encryptedContent"in i.result&&(this.encryptedContent=i.result.encryptedContent.value_block.value[0])},e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.toSchema=function(){var t=new Array;return t.push(new e.org.pkijs.asn1.OID({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[this.encryptedContent]})),new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.cms.EncryptedContentInfo.prototype.toJSON=function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e},e.org.pkijs.simpl.CMS_ENVELOPED_DATA=function(){this.version=0,this.recipientInfos=new Array,this.encryptedContentInfo=new e.org.pkijs.simpl.cms.EncryptedContentInfo,arguments[0]instanceof Object&&"schema"in arguments[0]?e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.fromSchema.call(this,arguments[0].schema):arguments[0]instanceof Object&&(this.version=arguments[0].version||0,"originatorInfo"in arguments[0]&&(this.originatorInfo=arguments[0].originatorInfo),this.recipientInfos=arguments[0].recipientInfos||new Array,this.encryptedContentInfo=arguments[0].encryptedContentInfo||new e.org.pkijs.simpl.cms.EncryptedContentInfo,"unprotectedAttrs"in arguments[0]&&(this.unprotectedAttrs=arguments[0].unprotectedAttrs))},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.fromSchema=function(t){var i=e.org.pkijs.compareSchema(t,t,e.org.pkijs.schema.CMS_ENVELOPED_DATA({names:{version:"version",originatorInfo:"originatorInfo",recipientInfos:"recipientInfos",encryptedContentInfo:{names:{block_name:"encryptedContentInfo"}},unprotectedAttrs:"unprotectedAttrs"}}));if(i.verified===!1)throw new Error("Object's schema was not verified against input data for CMS_ENVELOPED_DATA");this.version=i.result.version.value_block.value_dec,"originatorInfo"in i.result&&(i.result.originatorInfo.id_block.tag_class=1,i.result.originatorInfo.id_block.tag_number=16,this.originatorInfo=new e.org.pkijs.simpl.cms.OriginatorInfo({schema:i.result.originatorInfo}));for(var s=i.result.recipientInfos,r=0;r<s.length;r++)this.recipientInfos.push(new e.org.pkijs.simpl.CMS_RECIPIENT_INFO({schema:s[r]}));if(this.encryptedContentInfo=new e.org.pkijs.simpl.cms.EncryptedContentInfo({schema:i.result.encryptedContentInfo}),"unprotectedAttrs"in i.result){this.unprotectedAttrs=new Array;for(var n=i.result.unprotectedAttrs,o=0;o<n.length;o++)this.unprotectedAttrs.push(new e.org.pkijs.simpl.ATTRIBUTE({schema:n[o]}))}},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.toSchema=function(){var t=new Array;t.push(new e.org.pkijs.asn1.INTEGER({value:this.version})),"originatorInfo"in this&&t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:0},value:this.originatorInfo.toSchema().value_block.value}));for(var i=new Array,s=0;s<this.recipientInfos.length;s++)i.push(this.recipientInfos[s].toSchema());if(t.push(new e.org.pkijs.asn1.SET({value:i})),t.push(this.encryptedContentInfo.toSchema()),"unprotectedAttrs"in this){for(var r=new Array,n=0;n<this.unprotectedAttrs.length;n++)r.push(this.unprotectedAttrs[n].toSchema());t.push(new e.org.pkijs.asn1.ASN1_CONSTRUCTED({optional:!0,id_block:{tag_class:3,tag_number:1},value:r}))}return new e.org.pkijs.asn1.SEQUENCE({value:t})},e.org.pkijs.simpl.CMS_ENVELOPED_DATA.prototype.toJSON=function(){var e={version:this.version};"originatorInfo"in this&&(e.originatorInfo=this.originatorInfo.toJSON()),e.recipientInfos=new Array;for(var t=0;t<this.recipientInfos.length;t++)e.recipientInfos.push(this.recipientInfos[t].toJSON());if(e.encryptedContentInfo=this.encryptedContentInfo.toJSON(),"unprotectedAttrs"in this){e.unprotectedAttrs=new Array;for(var t=0;t<this.unprotectedAttrs.length;t++)e.unprotectedAttrs.push(this.unprotectedAttrs[t].toJSON())}return e}}("undefined"!=typeof exports?exports:window);