/**
 * sp-pnp-js v1.0.3 - A reusable JavaScript library targeting SharePoint client-side development.
 * MIT (https://github.com/OfficeDev/PnP-JS-Core/blob/master/LICENSE)
 * Copyright (c) 2016 Microsoft
 * docs: http://officedev.github.io/PnP-JS-Core
 * source: https://github.com/OfficeDev/PnP-JS-Core
 * bugs: https://github.com/OfficeDev/PnP-JS-Core/issues
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.$pnp||(t.$pnp={})).Provisioning=e()}}(function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";var r=e("../utils/util"),o=function(){function e(){this.keys=[],this.values=[]}return e.prototype.get=function(e){var t=this.keys.indexOf(e);return t<0?null:this.values[t]},e.prototype.add=function(e,t){var n=this.keys.indexOf(e);n>-1?this.values[n]=t:(this.keys.push(e),this.values.push(t))},e.prototype.merge=function(e){if(r.Util.isFunction(e.getKeys))for(var t=e,n=t.getKeys(),o=n.length,i=0;i<o;i++)this.add(n[i],t.get(n[i]));else{var s=e;for(var a in s)s.hasOwnProperty(a)&&this.add(a,e[a])}},e.prototype.remove=function(e){var t=this.keys.indexOf(e);if(t<0)return null;var n=this.values[t];return this.keys.splice(t,1),this.values.splice(t,1),n},e.prototype.getKeys=function(){return this.keys},e.prototype.getValues=function(){return this.values},e.prototype.clear=function(){this.keys=[],this.values=[]},e.prototype.count=function(){return this.keys.length},e}();n.Dictionary=o},{"../utils/util":24}],2:[function(e,t,n){"use strict";function r(e){i.set(e)}var o=function(){function e(){this._headers=null,this._defaultCachingStore="session",this._defaultCachingTimeoutSeconds=30,this._globalCacheDisable=!1,this._useSPRequestExecutor=!1}return e.prototype.set=function(e){e.hasOwnProperty("headers")&&(this._headers=e.headers),e.hasOwnProperty("globalCacheDisable")&&(this._globalCacheDisable=e.globalCacheDisable),e.hasOwnProperty("defaultCachingStore")&&(this._defaultCachingStore=e.defaultCachingStore),e.hasOwnProperty("defaultCachingTimeoutSeconds")&&(this._defaultCachingTimeoutSeconds=e.defaultCachingTimeoutSeconds),e.hasOwnProperty("useSPRequestExecutor")&&(this._useSPRequestExecutor=e.useSPRequestExecutor),e.hasOwnProperty("nodeClientOptions")&&(this._useNodeClient=!0,this._useSPRequestExecutor=!1,this._nodeClientData=e.nodeClientOptions)},Object.defineProperty(e.prototype,"headers",{get:function(){return this._headers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultCachingStore",{get:function(){return this._defaultCachingStore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultCachingTimeoutSeconds",{get:function(){return this._defaultCachingTimeoutSeconds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalCacheDisable",{get:function(){return this._globalCacheDisable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useSPRequestExecutor",{get:function(){return this._useSPRequestExecutor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useNodeFetchClient",{get:function(){return this._useNodeClient},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodeRequestOptions",{get:function(){return this._nodeClientData},enumerable:!0,configurable:!0}),e}();n.RuntimeConfigImpl=o;var i=new o;n.RuntimeConfig=i,n.setRuntimeConfig=r},{}],3:[function(e,t,n){"use strict";var r=e("./fetchclient"),o=e("./digestcache"),i=e("../utils/util"),s=e("../configuration/pnplibconfig"),a=e("./sprequestexecutorclient"),c=e("./nodefetchclient"),u=function(){function e(){this._impl=this.getFetchImpl(),this._digestCache=new o.DigestCache(this)}return e.prototype.fetch=function(e,t){void 0===t&&(t={});var n=this,r=i.Util.extend(t,{cache:"no-cache",credentials:"same-origin"},!0),o=new Headers;if(this.mergeHeaders(o,s.RuntimeConfig.headers),this.mergeHeaders(o,t.headers),o.has("Accept")||o.append("Accept","application/json"),o.has("Content-Type")||o.append("Content-Type","application/json;odata=verbose;charset=utf-8"),o.has("X-ClientService-ClientTag")||o.append("X-ClientService-ClientTag","SharePoint.PnP.JavaScriptCore"),r=i.Util.extend(r,{headers:o}),r.method&&"GET"!==r.method.toUpperCase()&&!o.has("X-RequestDigest")){var a=e.indexOf("_api/");if(a<0)throw new Error("Unable to determine API url");var c=e.substr(0,a);return this._digestCache.getDigest(c).then(function(t){return o.append("X-RequestDigest",t),n.fetchRaw(e,r)})}return n.fetchRaw(e,r)},e.prototype.fetchRaw=function(e,t){var n=this;void 0===t&&(t={});var r=new Headers;this.mergeHeaders(r,t.headers),t=i.Util.extend(t,{headers:r});var o=function(r){n._impl.fetch(e,t).then(function(e){return r.resolve(e)})["catch"](function(e){var t=r.delay;429!==e.status&&503!==e.status&&r.reject(e),r.delay*=2,r.attempts++,r.retryCount<=r.attempts&&r.reject(e),setTimeout(i.Util.getCtxCallback(n,o,r),t)})};return new Promise(function(e,t){var r={attempts:0,delay:100,reject:t,resolve:e,retryCount:7};o.call(n,r)})},e.prototype.get=function(e,t){void 0===t&&(t={});var n=i.Util.extend(t,{method:"GET"});return this.fetch(e,n)},e.prototype.post=function(e,t){void 0===t&&(t={});var n=i.Util.extend(t,{method:"POST"});return this.fetch(e,n)},e.prototype.getFetchImpl=function(){if(s.RuntimeConfig.useSPRequestExecutor)return new a.SPRequestExecutorClient;if(s.RuntimeConfig.useNodeFetchClient){var e=s.RuntimeConfig.nodeRequestOptions;return new c.NodeFetchClient(e.siteUrl,e.clientId,e.clientSecret)}return new r.FetchClient},e.prototype.mergeHeaders=function(e,t){if("undefined"!=typeof t&&null!==t){var n=new Request("",{headers:t});n.headers.forEach(function(t,n){e.append(n,t)})}},e}();n.HttpClient=u},{"../configuration/pnplibconfig":2,"../utils/util":24,"./digestcache":4,"./fetchclient":5,"./nodefetchclient":7,"./sprequestexecutorclient":8}],4:[function(e,t,n){"use strict";var r=e("../collections/collections"),o=e("../utils/util"),i=e("../sharepoint/rest/odata"),s=function(){function e(){}return e}();n.CachedDigest=s;var a=function(){function e(e,t){void 0===t&&(t=new r.Dictionary),this._httpClient=e,this._digests=t}return e.prototype.getDigest=function(e){var t=this,n=this._digests.get(e);if(null!==n){var r=new Date;if(r<n.expiration)return Promise.resolve(n.value)}var a=o.Util.combinePaths(e,"/_api/contextinfo");return t._httpClient.fetchRaw(a,{cache:"no-cache",credentials:"same-origin",headers:{Accept:"application/json;odata=verbose","Content-type":"application/json;odata=verbose;charset=utf-8"},method:"POST"}).then(function(e){var t=new i.ODataDefaultParser;return t.parse(e).then(function(e){return e.GetContextWebInformation})}).then(function(n){var r=new s;r.value=n.FormDigestValue;var o=n.FormDigestTimeoutSeconds,i=new Date;return i.setTime(i.getTime()+1e3*o),r.expiration=i,t._digests.add(e,r),r.value})},e.prototype.clear=function(){this._digests.clear()},e}();n.DigestCache=a},{"../collections/collections":1,"../sharepoint/rest/odata":22,"../utils/util":24}],5:[function(e,t,n){(function(e){"use strict";var t=function(){function t(){}return t.prototype.fetch=function(t,n){return e.fetch(t,n)},t}();n.FetchClient=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){arguments[4][3][0].apply(n,arguments)},{"../configuration/pnplibconfig":2,"../utils/util":24,"./digestcache":4,"./fetchclient":5,"./nodefetchclient":7,"./sprequestexecutorclient":8,dup:3}],7:[function(e,t,n){"use strict";var r=function(){function e(e,t,n,r){void 0===r&&(r=""),this.siteUrl=e,this._clientId=t,this._clientSecret=n,this._realm=r}return e.prototype.fetch=function(e,t){throw new Error("Using NodeFetchClient in the browser is not supported.")},e}();n.NodeFetchClient=r},{}],8:[function(e,t,n){"use strict";var r=function(){function e(){this.convertToResponse=function(e){var t=new Headers;for(var n in e.headers)e.headers[n]&&t.append(n,e.headers[n]);return new Response(e.body,{headers:t,status:e.statusCode,statusText:e.statusText})}}return e.prototype.fetch=function(e,t){var n=this;if("undefined"==typeof SP||"undefined"==typeof SP.RequestExecutor)throw new Error("SP.RequestExecutor is undefined. Load the SP.RequestExecutor.js library (/_layouts/15/SP.RequestExecutor.js) before loading the PnP JS Core library.");var r,o,i=e.substring(0,e.indexOf("/_api")),s=new SP.RequestExecutor(i),a={};if(t.headers&&t.headers instanceof Headers)for(r=t.headers.entries(),o=r.next();!o.done;)a[o.value[0]]=o.value[1],o=r.next();else a=t.headers;return new Promise(function(r,o){s.executeAsync({body:t.body,error:function(e){o(n.convertToResponse(e))},headers:a,method:t.method,success:function(e){r(n.convertToResponse(e))},url:e})})},e}();n.SPRequestExecutorClient=r},{}],9:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../util"),i=e("./ObjectHandlerBase"),s=function(e){function t(){e.call(this,"ComposedLook")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,i){var s=SP.ClientContext.get_current(),a=s.get_web(),c=t.ColorPaletteUrl?o.Util.replaceUrlTokens(t.ColorPaletteUrl):"",u=t.FontSchemeUrl?o.Util.replaceUrlTokens(t.FontSchemeUrl):"",l=t.BackgroundImageUrl?o.Util.replaceUrlTokens(t.BackgroundImageUrl):null;a.applyTheme(o.Util.getRelativeUrl(c),o.Util.getRelativeUrl(u),l,!0),a.update(),s.executeQueryAsync(function(){e.prototype.scope_ended.call(n),r()},function(){e.prototype.scope_ended.call(n),r()})})},t}(i.ObjectHandlerBase);n.ObjectComposedLook=s},{"../util":21,"./ObjectHandlerBase":13}],10:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("./ObjectHandlerBase"),i=function(e){function t(){e.call(this,"CustomActions")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,o){var i=SP.ClientContext.get_current(),s=i.get_web().get_userCustomActions();i.load(s),i.executeQueryAsync(function(){t.forEach(function(e){var t=s.get_data().filter(function(t){return t.get_title()===e.Title}).length>0;if(!t){var n=s.add();e.Description&&n.set_description(e.Description),e.CommandUIExtension&&n.set_commandUIExtension(e.CommandUIExtension),e.Group&&n.set_group(e.Group),e.Title&&n.set_title(e.Title),e.Url&&n.set_url(e.Url),e.ScriptBlock&&n.set_scriptBlock(e.ScriptBlock),e.ScriptSrc&&n.set_scriptSrc(e.ScriptSrc),e.Location&&n.set_location(e.Location),e.ImageUrl&&n.set_imageUrl(e.ImageUrl),e.Name&&n.set_name(e.Name),e.RegistrationId&&n.set_registrationId(e.RegistrationId),e.RegistrationType&&n.set_registrationType(e.RegistrationType),e.Rights&&n.set_rights(e.Rights),e.Sequence&&n.set_sequence(e.Sequence),n.update()}}),i.executeQueryAsync(function(){e.prototype.scope_ended.call(n),r()},function(){e.prototype.scope_ended.call(n),r()})},function(){e.prototype.scope_ended.call(n),r()})})},t}(o.ObjectHandlerBase);n.ObjectCustomActions=i},{"./ObjectHandlerBase":13}],11:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("./ObjectHandlerBase"),i=function(e){function t(){e.call(this,"Features")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,o){var i=SP.ClientContext.get_current(),s=i.get_web(),a=s.get_features();t.forEach(function(e){e.Deactivate===!0?a.remove(new SP.Guid(e.ID),!0):a.add(new SP.Guid(e.ID),!0,SP.FeatureDefinitionScope.none)}),s.update(),i.load(a),i.executeQueryAsync(function(){e.prototype.scope_ended.call(n),r()},function(){e.prototype.scope_ended.call(n),r()})})},t}(o.ObjectHandlerBase);n.ObjectFeatures=i},{"./ObjectHandlerBase":13}],12:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../../../utils/util"),i=e("../util"),s=e("./ObjectHandlerBase"),a=function(e){function t(){e.call(this,"Files")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,s){var a=SP.ClientContext.get_current(),c=a.get_web(),u=[],l=[];t.forEach(function(e,t){l.push(n.httpClient.fetchRaw(i.Util.replaceUrlTokens(e.Src)).then(function(e){return e.text()}))}),Promise.all(l).then(function(e){e.forEach(function(e,r){var i=t[r],s=n.GetFilenameFromFilePath(i.Dest),l=_spPageContextInfo.webServerRelativeUrl,p=c.getFolderByServerRelativeUrl(l+"/"+n.GetFolderFromFilePath(i.Dest)),f={Contents:e,Dest:i.Dest,Filename:s,Folder:p,Instance:null,Overwrite:!1,Properties:[],RemoveExistingWebParts:!0,ServerRelativeUrl:i.Dest,Src:i.Src,Views:[],WebParts:[]};if(o.Util.extend(f,i),f.Filename.indexOf("Form.aspx")===-1){var d=new SP.FileCreationInformation;d.set_overwrite(f.Overwrite),d.set_url(f.Filename),d.set_content(new SP.Base64EncodedByteArray);for(var h=0;h<f.Contents.length;h++)d.get_content().append(f.Contents.charCodeAt(h));a.load(f.Folder.get_files().add(d)),u.push(f)}})}),a.executeQueryAsync(function(){l=[],u.forEach(function(e){e.Properties&&Object.keys(e.Properties).length>0&&l.push(n.ApplyFileProperties(e.Dest,e.Properties)),e.WebParts&&e.WebParts.length>0&&l.push(n.AddWebPartsToWebPartPage(e.Dest,e.Src,e.WebParts,e.RemoveExistingWebParts))}),Promise.all(l).then(function(){n.ModifyHiddenViews(t).then(function(t){e.prototype.scope_ended.call(n),r(t)},function(t){e.prototype.scope_ended.call(n),s(t)})})},function(t){e.prototype.scope_ended.call(n),s(t)})})},t.prototype.RemoveWebPartsFromFileIfSpecified=function(e,t,n){return new Promise(function(r,o){n||r();var i=t.get_webParts();e.load(i),e.executeQueryAsync(function(){i.get_data().forEach(function(e){e.deleteWebPart()}),e.load(i),e.executeQueryAsync(r,o)},o)})},t.prototype.GetWebPartXml=function(e){var t=this;return new Promise(function(n,r){var o=[];e.forEach(function(e,n){if(e.Contents.FileUrl){var r=i.Util.replaceUrlTokens(e.Contents.FileUrl);o.push(t.httpClient.fetchRaw(r).then(function(e){return e.text()}))}else o.push(function(){return new Promise(function(e,t){e()})}())}),Promise.all(o).then(function(t){t.forEach(function(t,n){var r=e[n];null!==r&&t&&t.length>0&&(r.Contents.Xml=t)}),n(e)})})},t.prototype.AddWebPartsToWebPartPage=function(e,t,n,r){var o=this;return new Promise(function(t,s){var a=SP.ClientContext.get_current(),c=a.get_web(),u=_spPageContextInfo.webServerRelativeUrl+"/"+e,l=c.getFileByServerRelativeUrl(u);a.load(l),a.executeQueryAsync(function(){var e=l.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared);o.RemoveWebPartsFromFileIfSpecified(a,e,r).then(function(){o.GetWebPartXml(n).then(function(n){n.forEach(function(t){if(t.Contents.Xml){var n=e.importWebPart(i.Util.replaceUrlTokens(t.Contents.Xml)),r=n.get_webPart();e.addWebPart(r,t.Zone,t.Order)}}),a.executeQueryAsync(t,t)})})},t)})},t.prototype.ApplyFileProperties=function(e,t){return new Promise(function(n,r){var o=SP.ClientContext.get_current(),i=o.get_web(),s=_spPageContextInfo.webServerRelativeUrl+"/"+e,a=i.getFileByServerRelativeUrl(s),c=a.get_listItemAllFields();Object.keys(t).forEach(function(e){c.set_item(e,t[e])}),c.update(),o.executeQueryAsync(n,n)})},t.prototype.GetViewFromCollectionByUrl=function(e,t){for(var n=_spPageContextInfo.webServerRelativeUrl+"/"+t,r=e.getEnumerator();r.moveNext();){var o=r.get_current();if(o.get_serverRelativeUrl().toString().toLowerCase()===n.toLowerCase())return o}return null},t.prototype.ModifyHiddenViews=function(e){var t=this;return new Promise(function(n,r){var i=SP.ClientContext.get_current(),s=i.get_web(),a={},c=[],u=[];e.forEach(function(e){e.Views&&e.Views.forEach(function(t){a[t.List]=a[t.List]||[],a[t.List].push(o.Util.extend(t,{Url:e.Dest}))})}),Object.keys(a).forEach(function(e,t){c.push(s.get_lists().getByTitle(e)),u.push(s.get_lists().getByTitle(e).get_views()),i.load(c[t]),i.load(u[t])}),i.executeQueryAsync(function(){Object.keys(a).forEach(function(e,n){var r=a[e],o=c[n],s=u[n];r.forEach(function(e){var n=t.GetViewFromCollectionByUrl(s,e.Url);if(null!=n){if(e.Paged&&n.set_paged(e.Paged),e.Query&&n.set_viewQuery(e.Query),e.RowLimit&&n.set_rowLimit(e.RowLimit),e.ViewFields&&e.ViewFields.length>0){var r=n.get_viewFields();r.removeAll(),e.ViewFields.forEach(function(e){r.add(e)})}n.update()}}),i.load(s),o.update()}),i.executeQueryAsync(n,n)},n)})},t.prototype.GetFolderFromFilePath=function(e){var t=e.split("/");return t.splice(0,t.length-1).join("/")},t.prototype.GetFilenameFromFilePath=function(e){var t=e.split("/");return t[t.length-1]},t}(s.ObjectHandlerBase);n.ObjectFiles=a},{"../../../utils/util":24,"../util":21,"./ObjectHandlerBase":13}],13:[function(e,t,n){"use strict";var r=e("../../../net/HttpClient"),o=e("../../../utils/logging"),i=function(){function e(e){this.name=e,this.httpClient=new r.HttpClient}return e.prototype.ProvisionObjects=function(e,t){return new Promise(function(e,t){e("Not implemented.")})},e.prototype.scope_started=function(){o.Logger.write(this.name+": Code execution scope started")},e.prototype.scope_ended=function(){o.Logger.write(this.name+": Code execution scope stopped")},e}();n.ObjectHandlerBase=i},{"../../../net/HttpClient":3,"../../../utils/logging":23}],14:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../Sequencer/Sequencer"),i=e("./ObjectHandlerBase"),s=function(e){function t(){e.call(this,"Lists")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,i){var s=SP.ClientContext.get_current(),a=s.get_web().get_lists(),c=[];s.load(a),s.executeQueryAsync(function(){t.forEach(function(e,t){var n=a.get_data().filter(function(t){return t.get_title()===e.Title})[0];if(n)e.Description&&n.set_description(e.Description),void 0!==e.EnableVersioning&&n.set_enableVersioning(e.EnableVersioning),void 0!==e.EnableMinorVersions&&n.set_enableMinorVersions(e.EnableMinorVersions),void 0!==e.EnableModeration&&n.set_enableModeration(e.EnableModeration),void 0!==e.EnableFolderCreation&&n.set_enableFolderCreation(e.EnableFolderCreation),void 0!==e.EnableAttachments&&n.set_enableAttachments(e.EnableAttachments),void 0!==e.NoCrawl&&n.set_noCrawl(e.NoCrawl),e.DefaultDisplayFormUrl&&n.set_defaultDisplayFormUrl(e.DefaultDisplayFormUrl),e.DefaultEditFormUrl&&n.set_defaultEditFormUrl(e.DefaultEditFormUrl),e.DefaultNewFormUrl&&n.set_defaultNewFormUrl(e.DefaultNewFormUrl),e.DraftVersionVisibility&&n.set_draftVersionVisibility(SP.DraftVisibilityType[e.DraftVersionVisibility]),e.ImageUrl&&n.set_imageUrl(e.ImageUrl),void 0!==e.Hidden&&n.set_hidden(e.Hidden),void 0!==e.ForceCheckout&&n.set_forceCheckout(e.ForceCheckout),n.update(),c.push(n),s.load(c[t]);else{var r=new SP.ListCreationInformation;if(e.Description&&r.set_description(e.Description),void 0!==e.OnQuickLaunch){var o=e.OnQuickLaunch?SP.QuickLaunchOptions.on:SP.QuickLaunchOptions.off;r.set_quickLaunchOption(o)}e.TemplateType&&r.set_templateType(e.TemplateType),e.Title&&r.set_title(e.Title),e.Url&&r.set_url(e.Url);var i=a.add(r);if(void 0!==e.EnableVersioning&&i.set_enableVersioning(e.EnableVersioning),void 0!==e.EnableMinorVersions&&i.set_enableMinorVersions(e.EnableMinorVersions),void 0!==e.EnableModeration&&i.set_enableModeration(e.EnableModeration),void 0!==e.EnableFolderCreation&&i.set_enableFolderCreation(e.EnableFolderCreation),void 0!==e.EnableAttachments&&i.set_enableAttachments(e.EnableAttachments),void 0!==e.NoCrawl&&i.set_noCrawl(e.NoCrawl),e.DefaultDisplayFormUrl&&i.set_defaultDisplayFormUrl(e.DefaultDisplayFormUrl),e.DefaultEditFormUrl&&i.set_defaultEditFormUrl(e.DefaultEditFormUrl),e.DefaultNewFormUrl&&i.set_defaultNewFormUrl(e.DefaultNewFormUrl),e.DraftVersionVisibility){var o=SP.DraftVisibilityType[e.DraftVersionVisibility.toLocaleLowerCase()];i.set_draftVersionVisibility(o)}e.ImageUrl&&i.set_imageUrl(e.ImageUrl),void 0!==e.Hidden&&i.set_hidden(e.Hidden),void 0!==e.ForceCheckout&&i.set_forceCheckout(e.ForceCheckout),c.push(i),s.load(c[t])}}),s.executeQueryAsync(function(){var i=new o.Sequencer([n.ApplyContentTypeBindings,n.ApplyListInstanceFieldRefs,n.ApplyFields,n.ApplyLookupFields,n.ApplyListSecurity,n.CreateViews,n.InsertDataRows,n.CreateFolders],{ClientContext:s,ListInstances:c,Objects:t},n);i.execute().then(function(){e.prototype.scope_ended.call(n),r()})},function(){e.prototype.scope_ended.call(n),r()})},function(){e.prototype.scope_ended.call(n),r()})})},t.prototype.EnsureLocationBasedMetadataDefaultsReceiver=function(e,t){var n=t.get_eventReceivers(),r=new SP.EventReceiverDefinitionCreationInformation;r.set_receiverName("LocationBasedMetadataDefaultsReceiver ItemAdded"),r.set_synchronization(1),r.set_sequenceNumber(1e3),r.set_receiverAssembly("Microsoft.Office.DocumentManagement, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"),r.set_receiverClass("Microsoft.Office.DocumentManagement.LocationBasedMetadataDefaultsReceiver"),r.set_eventType(SP.EventReceiverType.itemAdded),n.add(r),t.update()},t.prototype.CreateFolders=function(e){var t=this;return new Promise(function(n,r){e.ListInstances.forEach(function(n,r){var o=e.Objects[r];if(o.Folders){var i=_spPageContextInfo.webServerRelativeUrl+"/"+o.Url,s=n.get_rootFolder(),a="<MetadataDefaults>",c=!1;if(o.Folders.forEach(function(e){var t=i+"/"+e.Name;if(s.get_folders().add(t),e.DefaultValues){var n=Object.keys(e.DefaultValues).length;n>0&&(a+="<a href='"+t+"'>",Object.keys(e.DefaultValues).forEach(function(t){a+='<DefaultValue FieldName="'+t+'">'+e.DefaultValues[t]+"</DefaultValue>"}),a+="</a>"),c=!0}}),a+="</MetadataDefaults>",c){var u=new SP.FileCreationInformation;u.set_url(i+"/Forms/client_LocationBasedDefaults.html"),u.set_content(new SP.Base64EncodedByteArray),u.set_overwrite(!0);for(var l=0;l<a.length;l++)u.get_content().append(a.charCodeAt(l));s.get_files().add(u),t.EnsureLocationBasedMetadataDefaultsReceiver(e.ClientContext,n)}}}),e.ClientContext.executeQueryAsync(n,n)})},t.prototype.ApplyContentTypeBindings=function(e){return new Promise(function(t,n){var r=e.ClientContext.get_site().get_rootWeb().get_contentTypes(),o=[];e.ListInstances.forEach(function(t,n){o.push(t.get_contentTypes()),e.ClientContext.load(o[n],"Include(Name,Id)"),e.Objects[n].ContentTypeBindings&&(t.set_contentTypesEnabled(!0),t.update())}),e.ClientContext.load(r),e.ClientContext.executeQueryAsync(function(){e.ListInstances.forEach(function(t,n){var i=e.Objects[n];if(i.ContentTypeBindings){var s=o[n],a=new Array;if(i.RemoveExistingContentTypes&&i.ContentTypeBindings.length>0&&s.get_data().forEach(function(e){a.push(e)}),i.ContentTypeBindings.forEach(function(e){s.addExistingContentType(r.getById(e.ContentTypeId))}),i.RemoveExistingContentTypes&&i.ContentTypeBindings.length>0)for(var c=0;c<a.length;c++){var u=a[c];u.deleteObject()}t.update()}}),e.ClientContext.executeQueryAsync(t,t)},t)})},t.prototype.ApplyListInstanceFieldRefs=function(e){return new Promise(function(t,n){var r=e.ClientContext.get_site().get_rootWeb().get_fields();e.ListInstances.forEach(function(t,n){var o=e.Objects[n];o.FieldRefs&&(o.FieldRefs.forEach(function(e){var n=r.getByInternalNameOrTitle(e.Name);t.get_fields().add(n)}),t.update())}),e.ClientContext.executeQueryAsync(t,t)})},t.prototype.ApplyFields=function(e){var t=this;return new Promise(function(n,r){e.ListInstances.forEach(function(n,r){var o=e.Objects[r];o.Fields&&(o.Fields.forEach(function(r){var o=t.GetFieldXml(r,e.ListInstances,n),i=t.GetFieldXmlAttr(o,"Type");"Lookup"!==i&&"LookupMulti"!==i&&n.get_fields().addFieldAsXml(o,!0,SP.AddFieldOptions.addToAllContentTypes)}),n.update())}),e.ClientContext.executeQueryAsync(n,n)})},t.prototype.ApplyLookupFields=function(e){var t=this;return new Promise(function(n,r){e.ListInstances.forEach(function(n,r){var o=e.Objects[r];o.Fields&&(o.Fields.forEach(function(r){var o=t.GetFieldXml(r,e.ListInstances,n);if(o){var i=t.GetFieldXmlAttr(o,"Type");"Lookup"!==i&&"LookupMulti"!==i||n.get_fields().addFieldAsXml(o,!0,SP.AddFieldOptions.addToAllContentTypes)}}),n.update())}),e.ClientContext.executeQueryAsync(n,n)})},t.prototype.GetFieldXmlAttr=function(e,t){var n=new RegExp(t+"=['|\"](?:(.+?))['|\"]"),r=n.exec(e);return r[1]},t.prototype.GetFieldXml=function(e,t,n){var r="";if(!e.SchemaXml){var o=[];Object.keys(e).forEach(function(n){var r=e[n];if("List"===n){var i=t.filter(function(e){return e.get_title()===r});if(!(i.length>0))return null;r="{"+i[0].get_id().toString()+"}",o.push(n+'="'+r+'"')}}),r="<Field "+o.join(" ")+">","Calculated"===e.Type&&(r+="<Formula>"+e.Formula+"</Formula>"),r+="</Field>"}return r},t.prototype.ApplyListSecurity=function(e){return new Promise(function(t,n){e.ListInstances.forEach(function(t,n){var r=e.Objects[n];r.Security&&r.Security.BreakRoleInheritance&&(t.breakRoleInheritance(r.Security.CopyRoleAssignments,r.Security.ClearSubscopes),t.update(),e.ClientContext.load(t.get_roleAssignments()))});var r=e.ClientContext.get_web(),o=r.get_allProperties(),i=r.get_siteGroups(),s=r.get_roleDefinitions();e.ClientContext.load(o),e.ClientContext.load(s),e.ClientContext.executeQueryAsync(function(){e.ListInstances.forEach(function(t,n){var r=e.Objects[n];r.Security&&(r.Security.RoleAssignments.forEach(function(n){var r=null;r="number"==typeof n.RoleDefinition?s.getById(n.RoleDefinition):s.getByName(n.RoleDefinition);var a=SP.RoleDefinitionBindingCollection.newObject(e.ClientContext);a.add(r);var c=null;if(n.Principal.match(/\{[A-Za-z]*\}+/g)){var u=n.Principal.substring(1,n.Principal.length-1),l=o.get_fieldValues()["vti_"+u];c=i.getById(l)}else c=i.getByName(c);t.get_roleAssignments().add(c,a)}),t.update())}),e.ClientContext.executeQueryAsync(t,t)},t)})},t.prototype.CreateViews=function(e){return new Promise(function(t,n){var r=[];e.ListInstances.forEach(function(t,n){r.push(t.get_views()),e.ClientContext.load(r[n])}),e.ClientContext.executeQueryAsync(function(){e.ListInstances.forEach(function(t,n){var o=e.Objects[n];o.Views&&(r.push(t.get_views()),e.ClientContext.load(r[n]),o.Views.forEach(function(i){var s=r[n].get_data().filter(function(e){return o.RemoveExistingViews&&o.Views.length>0?(e.deleteObject(),!1):e.get_title()===i.Title}).length>0;if(s){var a=r[n].getByTitle(i.Title);if(i.Paged&&a.set_paged(i.Paged),i.Query&&a.set_viewQuery(i.Query),i.RowLimit&&a.set_rowLimit(i.RowLimit),i.ViewFields&&i.ViewFields.length>0){var c=a.get_viewFields();c.removeAll(),i.ViewFields.forEach(function(e){c.add(e)})}i.Scope&&a.set_scope(i.Scope),a.update()}else{var u=new SP.ViewCreationInformation;i.Title&&u.set_title(i.Title),i.PersonalView&&u.set_personalView(i.PersonalView),i.Paged&&u.set_paged(i.Paged),i.Query&&u.set_query(i.Query),i.RowLimit&&u.set_rowLimit(i.RowLimit),i.SetAsDefaultView&&u.set_setAsDefaultView(i.SetAsDefaultView),i.ViewFields&&u.set_viewFields(i.ViewFields),i.ViewTypeKind&&u.set_viewTypeKind(SP.ViewType.html);var a=t.get_views().add(u);i.Scope&&(a.set_scope(i.Scope),a.update()),t.update()}e.ClientContext.load(t.get_views())}))}),e.ClientContext.executeQueryAsync(t,t)},t)})},t.prototype.InsertDataRows=function(e){return new Promise(function(t,n){e.ListInstances.forEach(function(t,n){var r=e.Objects[n];r.DataRows&&r.DataRows.forEach(function(n){var r=t.addItem(new SP.ListItemCreationInformation);Object.keys(n).forEach(function(e){r.set_item(e,n[e])}),r.update(),e.ClientContext.load(r)})}),e.ClientContext.executeQueryAsync(t,t)})},t}(i.ObjectHandlerBase);n.ObjectLists=s},{"../Sequencer/Sequencer":19,"./ObjectHandlerBase":13}],15:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../util"),i=e("./ObjectHandlerBase"),s=function(e){function t(){e.call(this,"Navigation")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;e.prototype.scope_started.call(this);var r=SP.ClientContext.get_current(),o=r.get_web().get_navigation();return new Promise(function(i,s){n.ConfigureQuickLaunch(t.QuickLaunch,r,n.httpClient,o).then(function(){e.prototype.scope_ended.call(n),i()},function(){e.prototype.scope_ended.call(n),s()})})},t.prototype.getNodeFromCollectionByTitle=function(e,t){var n=e.filter(function(e){return e.get_title()===t});return n[0]||null},t.prototype.ConfigureQuickLaunch=function(e,t,n,r){var i=this;return new Promise(function(s,a){if(0===e.length)s();else{var c=r.get_quickLaunch();t.load(c),t.executeQueryAsync(function(){for(var a=[],u=c.get_count()-1;u>=0;){var l=c.itemAt(u);a.push(l),l.deleteObject(),u--}t.executeQueryAsync(function(){e.forEach(function(e){var t=i.getNodeFromCollectionByTitle(a,e.Title),n=new SP.NavigationNodeCreationInformation;n.set_title(e.Title),n.set_url(t?t.get_url():o.Util.replaceUrlTokens(e.Url)),n.set_asLastNode(!0),c.add(n)}),t.executeQueryAsync(function(){n.get(_spPageContextInfo.webAbsoluteUrl+"/_api/web/Navigation/QuickLaunch").then(function(n){n.json().then(function(n){n.value.forEach(function(t){var n=r.getNodeById(t.Id),s=n.get_children(),c=e.filter(function(e){return e.Title===t.Title})[0];c&&c.Children&&c.Children.forEach(function(e){var t=i.getNodeFromCollectionByTitle(a,e.Title),n=new SP.NavigationNodeCreationInformation;n.set_title(e.Title),n.set_url(t?t.get_url():o.Util.replaceUrlTokens(e.Url)),n.set_asLastNode(!0),s.add(n)})}),t.executeQueryAsync(s,s)})})},s)})})}})},t}(i.ObjectHandlerBase);n.ObjectNavigation=s},{"../util":21,"./ObjectHandlerBase":13}],16:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("../util"),i=e("./ObjectHandlerBase"),s=function(e){function t(){e.call(this,"PropertyBagEntries")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,i){if(t&&0!==t.length){for(var s=SP.ClientContext.get_current(),a=s.get_web(),c=a.get_allProperties(),u=[],l=0;l<t.length;l++){var p=t[l];c.set_item(p.Key,p.Value),p.Indexed&&u.push(o.Util.encodePropertyKey(p.Key))}a.update(),s.load(c),s.executeQueryAsync(function(){u.length>0?(c.set_item("vti_indexedpropertykeys",u.join("|")),a.update(),s.executeQueryAsync(function(){e.prototype.scope_ended.call(n),r()},function(){e.prototype.scope_ended.call(n),r()})):(e.prototype.scope_ended.call(n),r())},function(){e.prototype.scope_ended.call(n),r()})}else r()})},t}(i.ObjectHandlerBase);n.ObjectPropertyBagEntries=s},{"../util":21,"./ObjectHandlerBase":13}],17:[function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},o=e("./ObjectHandlerBase"),i=function(e){function t(){e.call(this,"WebSettings")}return r(t,e),t.prototype.ProvisionObjects=function(t){var n=this;return e.prototype.scope_started.call(this),new Promise(function(r,o){var i=SP.ClientContext.get_current(),s=i.get_web();t.WelcomePage&&(s.get_rootFolder().set_welcomePage(t.WelcomePage),s.get_rootFolder().update()),
t.MasterUrl&&s.set_masterUrl(t.MasterUrl),t.CustomMasterUrl&&s.set_customMasterUrl(t.CustomMasterUrl),void 0!==t.SaveSiteAsTemplateEnabled&&s.set_saveSiteAsTemplateEnabled(t.SaveSiteAsTemplateEnabled),void 0!==t.QuickLaunchEnabled&&s.set_saveSiteAsTemplateEnabled(t.QuickLaunchEnabled),void 0!==t.TreeViewEnabled&&s.set_treeViewEnabled(t.TreeViewEnabled),s.update(),i.load(s),i.executeQueryAsync(function(){e.prototype.scope_ended.call(n),r()},function(){e.prototype.scope_ended.call(n),r()})})},t}(o.ObjectHandlerBase);n.ObjectWebSettings=i},{"./ObjectHandlerBase":13}],18:[function(e,t,n){"use strict";var r=function(){function e(e,t,n,r,o){this.name=e,this.index=t,this.objects=n,this.parameters=r,this.handler=o}return e.prototype.execute=function(e){var t=this,n=new this.handler;return e?new Promise(function(r,o){e.then(function(){return n.ProvisionObjects(t.objects,t.parameters).then(r,r)})}):n.ProvisionObjects(this.objects,this.parameters)},e}();n.ProvisioningStep=r},{}],19:[function(e,t,n){"use strict";var r=function(){function e(e,t,n){this.functions=e,this.parameter=t,this.scope=n}return e.prototype.execute=function(e){var t=Promise.resolve();return this.functions.forEach(function(n,r){t=t.then(function(){return n.call(this.scope,this.parameter)}).then(function(t){e&&e.call(this,r,this.functions)})},this),t},e}();n.Sequencer=r},{}],20:[function(e,t,n){"use strict";var r=e("./ProvisioningStep"),o=e("./ObjectHandlers/ObjectNavigation"),i=e("./ObjectHandlers/ObjectPropertyBagEntries"),s=e("./ObjectHandlers/ObjectFeatures"),a=e("./ObjectHandlers/ObjectWebSettings"),c=e("./ObjectHandlers/ObjectComposedLook"),u=e("./ObjectHandlers/ObjectCustomActions"),l=e("./ObjectHandlers/ObjectFiles"),p=e("./ObjectHandlers/ObjectLists"),f=e("./util"),d=e("../../utils/logging"),h=e("../../net/HttpClient"),g=function(){function e(){this.handlers={Navigation:o.ObjectNavigation,PropertyBagEntries:i.ObjectPropertyBagEntries,Features:s.ObjectFeatures,WebSettings:a.ObjectWebSettings,ComposedLook:c.ObjectComposedLook,CustomActions:u.ObjectCustomActions,Files:l.ObjectFiles,Lists:p.ObjectLists},this.httpClient=new h.HttpClient}return e.prototype.applyTemplate=function(e){var t=this,n=f.Util.replaceUrlTokens(e);return new Promise(function(e,r){t.httpClient.get(n).then(function(n){n.ok?n.json().then(function(n){t.start(n,Object.keys(n)).then(e,r)}):r(n.statusText)},function(e){d.Logger.write("Provisioning: The provided template is invalid",d.Logger.LogLevel.Error)})})},e.prototype.start=function(e,t){var n=this;return new Promise(function(o,i){n.startTime=(new Date).getTime(),n.queueItems=[],t.forEach(function(t,o){n.handlers[t]&&n.queueItems.push(new r.ProvisioningStep(t,o,e[t],e.Parameters,n.handlers[t]))});var s=[];s.push(new Promise(function(e){d.Logger.write("Provisioning: Code execution scope started",d.Logger.LogLevel.Info),e()}));for(var a=1;void 0!==n.queueItems[a-1];){var c=s.length-1;s.push(n.queueItems[a-1].execute(s[c])),a++}Promise.all(s).then(function(e){d.Logger.write("Provisioning: Code execution scope ended",d.Logger.LogLevel.Info),o(e)},function(e){d.Logger.write("Provisioning: Code execution scope ended"+JSON.stringify(e),d.Logger.LogLevel.Error),i(e)})})},e}();n.Provisioning=g},{"../../net/HttpClient":3,"../../utils/logging":23,"./ObjectHandlers/ObjectComposedLook":9,"./ObjectHandlers/ObjectCustomActions":10,"./ObjectHandlers/ObjectFeatures":11,"./ObjectHandlers/ObjectFiles":12,"./ObjectHandlers/ObjectLists":14,"./ObjectHandlers/ObjectNavigation":15,"./ObjectHandlers/ObjectPropertyBagEntries":16,"./ObjectHandlers/ObjectWebSettings":17,"./ProvisioningStep":18,"./util":21}],21:[function(e,t,n){"use strict";var r=function(){function e(){}return e.getRelativeUrl=function(e){return e.replace(document.location.protocol+"//"+document.location.hostname,"")},e.replaceUrlTokens=function(e){return e.replace(/{site}/g,_spPageContextInfo.webAbsoluteUrl).replace(/{sitecollection}/g,_spPageContextInfo.siteAbsoluteUrl).replace(/{themegallery}/g,_spPageContextInfo.siteAbsoluteUrl+"/_catalogs/theme/15")},e.encodePropertyKey=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n)),t.push(0);var r=window.btoa(String.fromCharCode.apply(null,t));return r},e}();n.Util=r},{}],22:[function(e,t,n){"use strict";function r(e){if(e.hasOwnProperty("odata.id"))return e["odata.id"];if(e.hasOwnProperty("__metadata")&&e.__metadata.hasOwnProperty("id"))return e.__metadata.id;throw l.Logger.log({data:e,level:l.Logger.LogLevel.Error,message:"Could not extract odata id in object, you may be using nometadata. Object data logged to logger."}),new Error("Could not extract odata id in object, you may be using nometadata. Object data logged to logger.")}function o(e){return e.hasOwnProperty("__metadata")?e.__metadata.uri:e.hasOwnProperty("odata.editLink")?u.Util.combinePaths("_api",e["odata.editLink"]):(l.Logger.write("No uri information found in ODataEntity parsing, chaining will fail for this object.",l.Logger.LogLevel.Warning),"")}function i(){return new y}function s(e){return new v(e)}function a(e){return new b(e)}var c=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},u=e("../../utils/util"),l=e("../../utils/logging"),p=e("../../net/httpclient"),f=e("../../configuration/pnplibconfig");n.extractOdataId=r;var d=function(){function e(){}return e.prototype.parse=function(e){return e.json().then(function(e){var t=e;return e.hasOwnProperty("d")?t=e.d.hasOwnProperty("results")?e.d.results:e.d:e.hasOwnProperty("value")&&(t=e.value),t})},e}();n.ODataParserBase=d;var h=function(e){function t(){e.apply(this,arguments)}return c(t,e),t}(d);n.ODataDefaultParser=h;var g=function(){function e(){}return e.prototype.parse=function(e){return e.json()},e}();n.ODataRawParserImpl=g;var y=function(e){function t(){e.apply(this,arguments)}return c(t,e),t.prototype.parse=function(t){return e.prototype.parse.call(this,t).then(function(e){return e})},t}(d),v=function(e){function t(t){e.call(this),this.factory=t}return c(t,e),t.prototype.parse=function(t){var n=this;return e.prototype.parse.call(this,t).then(function(e){var t=new n.factory(o(e),null);return u.Util.extend(t,e)})},t}(d),b=function(e){function t(t){e.call(this),this.factory=t}return c(t,e),t.prototype.parse=function(t){var n=this;return e.prototype.parse.call(this,t).then(function(e){return e.map(function(e){var t=new n.factory(o(e),null);return u.Util.extend(t,e)})})},t}(d);n.ODataRaw=new g,n.ODataValue=i,n.ODataEntity=s,n.ODataEntityArray=a;var m=function(){function e(e){void 0===e&&(e=u.Util.getGUID()),this._batchId=e,this._requests=[],this._batchDepCount=0}return e.prototype.add=function(e,t,n,r){var o={method:t.toUpperCase(),options:n,parser:r,reject:null,resolve:null,url:e},i=new Promise(function(e,t){o.resolve=e,o.reject=t});return this._requests.push(o),i},e.prototype.incrementBatchDep=function(){this._batchDepCount++},e.prototype.decrementBatchDep=function(){this._batchDepCount--},e.prototype.execute=function(){var e=this;this._batchDepCount>0?setTimeout(function(){return e.execute()},100):this.executeImpl()},e.prototype.executeImpl=function(){var e=this;if(!(this._requests.length<1)){var t=[],n="";this._requests.forEach(function(r,o){"GET"===r.method?(n.length>0&&(t.push("--changeset_"+n+"--\n\n"),n=""),t.push("--batch_"+e._batchId+"\n")):(n.length<1&&(n=u.Util.getGUID(),t.push("--batch_"+e._batchId+"\n"),t.push('Content-Type: multipart/mixed; boundary="changeset_'+n+'"\n\n')),t.push("--changeset_"+n+"\n")),t.push("Content-Type: application/http\n"),t.push("Content-Transfer-Encoding: binary\n\n");var i={Accept:"application/json;"};if("GET"!==r.method){var s=r.method;r.options&&r.options.headers&&"undefined"!==r.options.headers["X-HTTP-Method"]&&(s=r.options.headers["X-HTTP-Method"],delete r.options.headers["X-HTTP-Method"]),t.push(s+" "+r.url+" HTTP/1.1\n"),i=u.Util.extend(i,{"Content-Type":"application/json;odata=verbose;charset=utf-8"})}else t.push(r.method+" "+r.url+" HTTP/1.1\n");"undefined"!=typeof f.RuntimeConfig.headers&&(i=u.Util.extend(i,f.RuntimeConfig.headers)),r.options&&r.options.headers&&(i=u.Util.extend(i,r.options.headers));for(var a in i)i.hasOwnProperty(a)&&t.push(a+": "+i[a]+"\n");t.push("\n"),r.options.body&&t.push(r.options.body+"\n\n")}),n.length>0&&(t.push("--changeset_"+n+"--\n\n"),n=""),t.push("--batch_"+this._batchId+"--\n");var r=new Headers;r.append("Content-Type","multipart/mixed; boundary=batch_"+this._batchId);var o={body:t.join(""),headers:r},i=new p.HttpClient;i.post(u.Util.makeUrlAbsolute("/_api/$batch"),o).then(function(e){return e.text()}).then(this._parseResponse).then(function(t){if(t.length!==e._requests.length)throw new Error("Could not properly parse responses to match requests in batch.");for(var n=0;n<t.length;n++){var r=e._requests[n],o=t[n];o.ok||r.reject(new Error(o.statusText)),r.parser.parse(o).then(r.resolve)["catch"](r.reject)}})}},e.prototype._parseResponse=function(e){return new Promise(function(t,n){for(var r,o,i=[],s="--batchresponse_",a=new RegExp("^HTTP/[0-9.]+ +([0-9]+) +(.*)","i"),c=e.split("\n"),u="batch",l=0;l<c.length;++l){var p=c[l];switch(u){case"batch":if(p.substr(0,s.length)===s)u="batchHeaders";else if(""!==p.trim())throw new Error("Invalid response, line "+l);break;case"batchHeaders":""===p.trim()&&(u="status");break;case"status":var f=a.exec(p);if(3!==f.length)throw new Error("Invalid status, line "+l);r=parseInt(f[1],10),o=f[2],u="statusHeaders";break;case"statusHeaders":""===p.trim()&&(u="body");break;case"body":var d=void 0;d=204===r?new Response:new Response(p,{status:r,statusText:o}),i.push(d),u="batch"}}"status"!==u&&n(new Error("Unexpected end of input")),t(i)})},e}();n.ODataBatch=m},{"../../configuration/pnplibconfig":2,"../../net/httpclient":6,"../../utils/logging":23,"../../utils/util":24}],23:[function(e,t,n){"use strict";var r=function(){function e(){}return Object.defineProperty(e,"activeLogLevel",{get:function(){return e.instance.activeLogLevel},set:function(t){e.instance.activeLogLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return"undefined"!=typeof e._instance&&null!==e._instance||(e._instance=new o),e._instance},enumerable:!0,configurable:!0}),e.subscribe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];for(var r=0;r<t.length;r++)e.instance.subscribe(t[r])},e.clearSubscribers=function(){return e.instance.clearSubscribers()},Object.defineProperty(e,"count",{get:function(){return e.instance.count},enumerable:!0,configurable:!0}),e.write=function(t,n){void 0===n&&(n=e.LogLevel.Verbose),e.instance.log({level:n,message:t})},e.log=function(t){e.instance.log(t)},e.measure=function(t,n){return e.instance.measure(t,n)},e}();n.Logger=r;var r,o=function(){function e(e,t){void 0===e&&(e=r.LogLevel.Warning),void 0===t&&(t=[]),this.activeLogLevel=e,this.subscribers=t}return e.prototype.subscribe=function(e){this.subscribers.push(e)},e.prototype.clearSubscribers=function(){var e=this.subscribers.slice(0);return this.subscribers.length=0,e},Object.defineProperty(e.prototype,"count",{get:function(){return this.subscribers.length},enumerable:!0,configurable:!0}),e.prototype.write=function(e,t){void 0===t&&(t=r.LogLevel.Verbose),this.log({level:t,message:e})},e.prototype.log=function(e){if(!("undefined"==typeof e||e.level<this.activeLogLevel))for(var t=0;t<this.subscribers.length;t++)this.subscribers[t].log(e)},e.prototype.measure=function(e,t){console.profile(e);try{return t()}finally{console.profileEnd()}},e}();!function(e){!function(e){e[e.Verbose=0]="Verbose",e[e.Info=1]="Info",e[e.Warning=2]="Warning",e[e.Error=3]="Error",e[e.Off=99]="Off"}(e.LogLevel||(e.LogLevel={}));var t=e.LogLevel,n=function(){function e(){}return e.prototype.log=function(e){var n=this.format(e);switch(e.level){case t.Verbose:case t.Info:console.log(n);break;case t.Warning:console.warn(n);break;case t.Error:console.error(n)}},e.prototype.format=function(e){return"Message: "+e.message+". Data: "+JSON.stringify(e.data)},e}();e.ConsoleListener=n;var r=function(){function e(e){this.azureInsightsInstrumentationKey=e;var t=window.appInsights||function(e){function t(e){o[e]=function(){var t=arguments;o.queue.push(function(){o[e].apply(o,t)})}}var n,r,o={config:e},i=document,s=window,a="script",c=i.createElement(a);for(c.src=e.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",i.getElementsByTagName(a)[0].parentNode.appendChild(c),o.cookie=i.cookie,o.queue=[],n=["Event","Exception","Metric","PageView","Trace"];n.length;)t("track"+n.pop());return t("setAuthenticatedUserContext"),t("clearAuthenticatedUserContext"),e.disableExceptionTracking||(n="onerror",t("_"+n),r=s[n],s[n]=function(e,t,i,s,a){var c=r&&r(e,t,i,s,a);return c!==!0&&o["_"+n](e,t,i,s,a),c}),o}({instrumentationKey:this.azureInsightsInstrumentationKey});window.appInsights=t}return e.prototype.log=function(e){var n=window.appInsights,r=this.format(e);e.level===t.Error?n.trackException(r):n.trackEvent(r)},e.prototype.format=function(e){return"Message: "+e.message+". Data: "+JSON.stringify(e.data)},e}();e.AzureInsightsListener=r;var o=function(){function e(e){this.method=e}return e.prototype.log=function(e){this.method(e)},e}();e.FunctionListener=o}(r=n.Logger||(n.Logger={}))},{}],24:[function(e,t,n){(function(e){"use strict";var t=function(){function t(){}return t.getCtxCallback=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return function(){t.apply(e,n)}},t.urlParamExists=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)");return t.test(location.search)},t.getUrlParamByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},t.getUrlParamBoolByName=function(e){var t=this.getUrlParamByName(e),n=""===t||/false|0/i.test(t);return!n},t.stringInsert=function(e,t,n){return t>0?e.substring(0,t)+n+e.substring(t,e.length):n+e},t.dateAdd=function(e,t,n){var r=new Date(e.toLocaleString());switch(t.toLowerCase()){case"year":r.setFullYear(r.getFullYear()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"day":r.setDate(r.getDate()+n);break;case"hour":r.setTime(r.getTime()+36e5*n);break;case"minute":r.setTime(r.getTime()+6e4*n);break;case"second":r.setTime(r.getTime()+1e3*n);break;default:r=void 0}return r},t.loadStylesheet=function(e,t){t&&(e+="?"+encodeURIComponent((new Date).getTime().toString()));var n=document.getElementsByTagName("head");if(n.length>0){var r=document.createElement("link");n[0].appendChild(r),r.setAttribute("type","text/css"),r.setAttribute("rel","stylesheet"),r.setAttribute("href",e)}},t.combinePaths=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var n=[],r=0;r<e.length;r++)"undefined"!=typeof e[r]&&null!==e[r]&&n.push(e[r].replace(/^[\\|\/]/,"").replace(/[\\|\/]$/,""));return n.join("/").replace(/\\/,"/")},t.getRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},t.getGUID=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)});return t},t.isFunction=function(e){return"function"==typeof e},t.isArray=function(e){return Array.isArray?Array.isArray(e):e&&"number"==typeof e.length&&e.constructor===Array},t.stringIsNullOrEmpty=function(e){return"undefined"==typeof e||null===e||""===e},t.extend=function(e,t,n){void 0===n&&(n=!1);var r={};for(var o in e)r[o]=e[o];var i=n?function(e,t){return!e.hasOwnProperty(t)}:function(e,t){return!0};for(var o in t)i(r,o)&&(r[o]=t[o]);return r},t.applyMixins=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})},t.isUrlAbsolute=function(e){return/^https?:\/\/|^\/\//i.test(e)},t.makeUrlAbsolute=function(n){return t.isUrlAbsolute(n)?n:"undefined"==typeof e._spPageContextInfo?n:e._spPageContextInfo.hasOwnProperty("webAbsoluteUrl")?t.combinePaths(e._spPageContextInfo.webAbsoluteUrl,n):e._spPageContextInfo.hasOwnProperty("webServerRelativeUrl")?t.combinePaths(e._spPageContextInfo.webServerRelativeUrl,n):void 0},t}();n.Util=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[20])(20)});
//# sourceMappingURL=pnp-provisioning.min.js.map
