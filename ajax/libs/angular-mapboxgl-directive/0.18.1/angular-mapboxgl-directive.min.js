/*!
*  angular-mapboxgl-directive 0.18.1 2016-11-21
*  An AngularJS directive for Mapbox GL
*  git: git+https://github.com/Naimikan/angular-mapboxgl-directive.git
*/
!function(a,b,c){"use strict";a.module("mapboxgl-directive",[]).directive("mapboxgl",["$q","mapboxglUtils","mapboxglConstants","mapboxglEventsUtils","mapboxglMapsData",function(c,d,e,f,g){function h(a){this._mapboxGlMap=c.defer(),this._geojsonObjects=[],this._imageObjects=[],this._videoObjects=[],this._markerObjects=[],this._persistentGeojson=e.map.defaultPersistentGeojson,this._persistentImage=e.map.defaultPersistentImage,this._persistentVideo=e.map.defaultPersistentVideo,this._elementDOM=null,this.getMap=function(){return this._mapboxGlMap.promise},this.getMapboxGlScope=function(){return a},this.getDOMElement=function(){return this._elementDOM},this.setDOMElement=function(a){this._elementDOM=a},this.getGeojsonObjects=function(){return this._geojsonObjects},this.addGeojsonObject=function(a){this._geojsonObjects.push(a)},this.removeGeojsonObjects=function(){this._geojsonObjects=[]},this.getImageObjects=function(){return this._imageObjects},this.addImageObject=function(a){this._imageObjects.push(a)},this.removeImageObjects=function(){this._imageObjects=[]},this.getVideoObjects=function(){return this._videoObjects},this.addVideoObject=function(a){this._videoObjects.push(a)},this.removeVideoObjects=function(){this._videoObjects=[]},this.getMarkerObjects=function(){return this._markerObjects},this.addMarkerObject=function(a){this._markerObjects.push(a)},this.removeMarkerObjects=function(){this._markerObjects=[]},this.isGeojsonPersistent=function(){return this._persistentGeojson},this.setPersistentGeojson=function(a){this._persistentGeojson=a},this.isImagePersistent=function(){return this._persistentImage},this.setPersistentImage=function(a){this._persistentImage=a},this.isVideoPersistent=function(){return this._persistentVideo},this.setPersistentVideo=function(a){this._persistentVideo=a},this.changeLoadingMap=function(a){a?this._elementDOM.hasClass("angular-mapboxgl-map-loading")||(this.getMap().then(function(a){a.getCanvas().style.opacity=.25}),this._elementDOM.addClass("angular-mapboxgl-map-loading")):this._elementDOM.hasClass("angular-mapboxgl-map-loading")&&(this.getMap().then(function(a){a.getCanvas().style.opacity=1}),this._elementDOM.removeClass("angular-mapboxgl-map-loading"))}}function i(c,h,i,j){if(!b)throw new Error("Mapbox GL does not included");if(!b.accessToken){if(!(a.isDefined(i.accessToken)&&i.accessToken.length>0))throw new Error("Mapbox access token does not defined");b.accessToken=i.accessToken}if(!b.supported())throw new Error("Your browser does not support Mapbox GL");j.setDOMElement(h),c.mapboxglMapId=i.id?i.id:d.generateMapId(),h.attr("id",c.mapboxglMapId);var k=function(a){isNaN(i.width)?h.css("width",i.width):h.css("width",i.width+"px"),a.resize()},l=function(a){isNaN(i.height)?h.css("height",i.height):h.css("height",i.height+"px"),a.resize()},m=function(b){a.isDefined(i.language)&&b.setLayoutProperty("country-label-lg","text-field","{name_"+i.language+"}")};a.isDefined(c.persistentGeojson)&&"boolean"==typeof c.persistentGeojson&&(j.setPersistentGeojson(c.persistentGeojson),c.$watch(function(){return c.persistentGeojson},function(){if("boolean"!=typeof c.persistentGeojson)throw new Error("Invalid parameter");j.setPersistentGeojson(c.persistentGeojson)})),a.isDefined(c.persistentImage)&&"boolean"==typeof c.persistentImage&&(j.setPersistentImage(c.persistentImage),c.$watch(function(){return c.persistentImage},function(){if("boolean"!=typeof c.persistentImage)throw new Error("Invalid parameter");j.setPersistentImage(c.persistentImage)})),a.isDefined(c.persistentVideo)&&"boolean"==typeof c.persistentVideo&&(j.setPersistentVideo(c.persistentVideo),c.$watch(function(){return c.persistentVideo},function(){if("boolean"!=typeof c.persistentVideo)throw new Error("Invalid parameter");j.setPersistentVideo(c.persistentVideo)}));var n=new b.Map({container:c.mapboxglMapId,style:c.glStyle||e.map.defaultStyle,center:e.map.defaultCenter,hash:a.isDefined(i.hash)&&"boolean"==typeof i.hash?i.hash:e.map.defaultHash,bearingSnap:a.isDefined(i.bearingSnap)&&a.isNumber(i.bearingSnap)?i.bearingSnap:e.map.defaultBearingSnap,failIfMajorPerformanceCaveat:a.isDefined(i.failIfMajorPerformanceCaveat)&&"boolean"==typeof i.failIfMajorPerformanceCaveat?i.failIfMajorPerformanceCaveat:e.map.defaultFailIfMajorPerformanceCaveat,preserveDrawingBuffer:a.isDefined(i.preserveDrawingBuffer)&&"boolean"==typeof i.preserveDrawingBuffer?i.preserveDrawingBuffer:e.map.defaultPreserveDrawingBuffer,trackResize:a.isDefined(i.trackResize)&&"boolean"==typeof i.trackResize?i.trackResize:e.map.defaultTrackResize,attributionControl:!1});g.addMap(c.mapboxglMapId,n),j._mapboxGlMap.resolve(n),f.exposeMapEvents(n),j.getMap().then(function(b){c.$watch(function(){return i.language},function(){b.loaded()?m(b):b.on("load",function(){m(b)})}),c.$watch(function(){return i.showCollisionBoxes},function(){"boolean"==typeof i.showCollisionBoxes&&(b.showCollisionBoxes=i.showCollisionBoxes)}),c.$watch(function(){return i.showTileBoundaries},function(){"boolean"==typeof i.showTileBoundaries&&(b.showTileBoundaries=i.showTileBoundaries)}),c.$watch(function(){return i.repaint},function(){"boolean"==typeof i.repaint&&(b.repaint=i.repaint)}),a.isDefined(i.width)&&(k(b),c.$watch(function(){return h[0].getAttribute("width")},function(){k(b)})),a.isDefined(i.height)?(l(b),c.$watch(function(){return h[0].getAttribute("height")},function(){l(b)})):(h.css("height",e.map.defaultHeight),b.resize())}),c.$on("mapboxglMap:styleChanged",function(){j.getMap().then(function(a){m(a)})}),c.$on("$destroy",function(){n.remove()})}var j={restrict:"EA",replace:!0,scope:{glStyle:"=",glCenter:"=",glMinZoom:"=",glMaxZoom:"=",glZoom:"=",glBearing:"=",glPitch:"=",glControls:"=",glFilter:"=",glClasses:"=",glGeojson:"=",glInteractive:"=",glHandlers:"=",glImage:"=",glVideo:"=",glPopups:"=",glMarkers:"=",glLights:"=",persistentGeojson:"=",persistentImage:"=",persistentVideo:"="},template:'<div class="angular-mapboxgl-map"><div class="loader" ng-if="isLoading"></div></div>',controller:h,link:i};return h.$inject=["$scope"],j}]),a.module("mapboxgl-directive").directive("mapboxglCompare",["mapboxglMapsData",function(c){function d(d,e,f){if(!b)throw new Error("Mapbox GL does not included");if(!b.accessToken){if(!(a.isDefined(f.accessToken)&&f.accessToken.length>0))throw new Error("Mapbox access token does not defined");b.accessToken=f.accessToken}if(!b.Compare)throw new Error("mapboxgl.Compare plugin does not included");if(!b.supported())throw new Error("Your browser does not support Mapbox GL");if(a.isDefined(d.compareSettings)&&Object.prototype.toString.call(d.compareSettings)!==Object.prototype.toString.call({}))throw new Error("Invalid mapboxgl.Compare parameters");e.ready(function(){var f=e.children();if(2!==f.length)throw new Error("Only two maps can be compared");var g=a.element(f[0]);g.addClass("compare-map");var h=a.element(f[1]);h.addClass("compare-map");var i=c.getMapById(f[0].id),j=c.getMapById(f[1].id);new b.Compare(i,j,d.compareSettings);e.css("height",g.css("height")),d.$watch(function(){return g[0].getAttribute("height")},function(){e.css("height",g.css("height"))})})}var e={restrict:"EA",replace:!0,scope:{compareSettings:"="},transclude:!0,template:'<div class="angular-mapboxgl-compare" ng-transclude></div>',link:d};return e}]),a.module("mapboxgl-directive").factory("mapboxglEventsUtils",["$rootScope",function(a){function b(b){c.map(function(c){b.on(c,function(b){a.$broadcast("mapboxglMap:"+c,b)})})}var c=["resize","webglcontextlost","webglcontextrestored","remove","dataloading","render","mouseout","mousedown","load","data","mouseup","mousemove","touchstart","touchend","touchmove","touchcancel","click","dblclick","contextmenu","error","movestart","move","moveend","zoomstart","zoomend","zoom","boxzoomcancel","boxzoomend","boxzoomstart","rotatestart","rotate","rotateend","dragstart","dragend","drag","pitch"],d={exposeMapEvents:b};return d}]),a.module("mapboxgl-directive").factory("mapboxglGeojsonUtils",["mapboxglUtils","mapboxglConstants",function(b,d){function e(b,c){if(a.isUndefined(c.id))throw new Error("Source ID Required");var d={};for(var e in c)"id"!==e&&(d[e]=c[e]);b.addSource(c.id,d)}function f(b,d){if(a.isUndefined(d.id))throw new Error("Layer ID Required");var e={type:"mapboxgl:geojson",popup:!!(a.isDefined(d.popup)&&a.isDefined(d.popup.enabled)&&d.popup.enabled)&&d.popup.enabled},f={};for(var g in d)"before"!==g&&"popup"!==g&&(f[g]=d[g]);f.metadata=a.isDefined(d.metadata)?d.metadata:{},a.extend(f.metadata,e);var h=a.isDefined(d.before)&&a.isDefined(d.before)?d.before:c;j.push({layerId:d.id,popup:d.popup}),b.addLayer(f,h)}function g(){j=[]}function h(a){var b=j.filter(function(b){return b.layerId===a});return b.length>0&&b[0].popup}function i(b,c){if(a.isUndefined(b)||null===b)throw new Error("Map is undefined");if(a.isUndefined(c)||null===c)throw new Error("Object definition is undefined");if(a.isUndefined(c.sources)||a.isUndefined(c.layers))throw new Error("Object sources and layers must be defined");if(Object.prototype.toString.call(c.sources)===Object.prototype.toString.call([]))c.sources.map(function(a){e(b,a)});else{if(Object.prototype.toString.call(c.sources)!==Object.prototype.toString.call({}))throw new Error("Invalid sources parameter");e(b,c.sources)}if(Object.prototype.toString.call(c.layers)===Object.prototype.toString.call([]))c.layers.map(function(a){f(b,a)});else{if(Object.prototype.toString.call(c.layers)!==Object.prototype.toString.call({}))throw new Error("Invalid layers parameter");f(b,c.layers)}}var j=[],k={createGeojsonByObject:i,getPopupByLayerId:h,removeAllRelations:g};return k}]),a.module("mapboxgl-directive").factory("mapboxglImageUtils",["mapboxglUtils","mapboxglConstants",function(b,c){function d(b,c){if(a.isUndefined(b)||null===b)throw new Error("Map is undefined");if(a.isUndefined(c)||null===c)throw new Error("Object definition is undefined");if(a.isUndefined(c.url)||null===c.url)throw new Error("Object url is undefined");if(a.isUndefined(c.coordinates)||null===c.coordinates)throw new Error("Object coordinates are undefined");c.id="image_"+Date.now(),b.addSource(c.id,{type:"image",url:c.url,coordinates:c.coordinates}),b.addLayer({id:c.id,source:c.id,type:"raster",layout:a.isDefined(c.layer)&&a.isDefined(c.layer.layout)?c.layer.layout:{},paint:a.isDefined(c.layer)&&a.isDefined(c.layer.paint)?c.layer.paint:{}})}var e={createImageByObject:d};return e}]),a.module("mapboxgl-directive").factory("mapboxglMapsData",["mapboxglUtils",function(a){function b(a,b){g.push({id:a,mapInstance:b})}function c(b){var c=a.arrayObjectIndexOf(g,b,"id");if(c!==-1){var d=g[c];d.mapInstance.remove(),g.splice(c,1)}}function d(){g.map(function(a){a.mapInstance.remove()}),g=[]}function e(){return g}function f(b){var c=a.arrayObjectIndexOf(g,b,"id");return c!==-1?g[c].mapInstance:null}var g=[],h={addMap:b,removeMapById:c,removeAllMaps:d,getMaps:e,getMapById:f};return h}]),a.module("mapboxgl-directive").factory("mapboxglMarkerUtils",["mapboxglUtils","mapboxglConstants","mapboxglPopupUtils",function(c,d,e){function f(c,d){if(a.isUndefined(c)||null===c)throw new Error("Map is undefined");if(a.isUndefined(d)||null===d)throw new Error("Object definition is undefined");if(a.isUndefined(d.coordinates)||null===d.coordinates)throw new Error("Object coordinates are undefined");if(a.isUndefined(d.element)||null===d.element)throw new Error("Object element is undefined");var f=d.options||{},g=new b.Marker(d.element,f).setLngLat(d.coordinates);if(a.isDefined(d.popup)){var h=e.createPopupByObject(c,d.popup);g.setPopup(h)}return g.addTo(c),g}var g={createMarkerByObject:f};return g}]),a.module("mapboxgl-directive").factory("mapboxglPopupUtils",["mapboxglUtils","mapboxglConstants","$rootScope","$compile",function(c,d,e,f){function g(c,d){if(a.isUndefined(c)||null===c)throw new Error("Map is undefined");if(a.isUndefined(d)||null===d)throw new Error("Object definition is undefined");if(a.isUndefined(d.coordinates)||null===d.coordinates)throw new Error("Object coordinates are undefined");if(a.isUndefined(d.html)||null===d.html)throw new Error("Object html is undefined");var g=d.options||{},h=new b.Popup(g).setLngLat(c.unproject(d.coordinates));if(d.html instanceof HTMLElement)h.setDOMContent(d.html);else{var i=a.isDefined(d.getScope)&&a.isFunction(d.getScope)?d.getScope():e;try{var j=f(d.html)(i)[0];h.setDOMContent(j)}catch(a){h.setHTML(d.html)}}return h.addTo(c),h}var h={createPopupByObject:g};return h}]),a.module("mapboxgl-directive").factory("mapboxglUtils",["$window","$q",function(b,c){function d(){return"mapbox-gl-map-"+Date.now()}function e(d){var e=c.defer();return a.isDefined(d)&&(a.isDefined(d.autodiscover)&&d.autodiscover?b.navigator.geolocation.getCurrentPosition(function(a){var b=a.coords;e.resolve([b.longitude,b.latitude])},function(a){e.reject(a)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):a.isNumber(d.lat)&&a.isNumber(d.lng)&&(d.lng>-180||d.lng<180)&&(d.lat>-90||d.lat<90)?e.resolve([d.lng,d.lat]):a.isArray(d)&&2===d.length&&a.isNumber(d[0])&&a.isNumber(d[1])&&(d[0]>-180||d[0]<180)&&(d[1]>-90||d[1]<90)?e.resolve(d):e.resolve(!1)),e.promise}function f(a,b,c){for(var d=0,e=a.length;d<e;d++)if(a[d][c]===b)return d;return-1}var g={generateMapId:d,validateAndFormatCenter:e,arrayObjectIndexOf:f};return g}]),a.module("mapboxgl-directive").factory("mapboxglVideoUtils",["mapboxglUtils","mapboxglConstants",function(b,c){function d(b,c){if(a.isUndefined(b)||null===b)throw new Error("Map is undefined");if(a.isUndefined(c)||null===c)throw new Error("Object definition is undefined");if(a.isUndefined(c.urls)||!a.isArray(c.urls)||null===c.urls)throw new Error("Object urls is undefined");if(a.isUndefined(c.coordinates)||null===c.coordinates)throw new Error("Object coordinates are undefined");c.id="video_"+Date.now(),b.addSource(c.id,{type:"video",urls:c.url,coordinates:c.coordinates}),b.addLayer({id:c.id,source:c.id,type:"raster",layout:a.isDefined(c.layer)&&a.isDefined(c.layer.layout)?c.layer.layout:{},paint:a.isDefined(c.layer)&&a.isDefined(c.layer.paint)?c.layer.paint:{}})}var e={createVideoByObject:d};return e}]),a.module("mapboxgl-directive").constant("mapboxglConstants",{map:{defaultHeight:"450px",defaultStyle:"mapbox://styles/mapbox/streets-v9",defaultCenter:[0,0],defaultHash:!1,defaultBearingSnap:7,defaultFailIfMajorPerformanceCaveat:!1,defaultPreserveDrawingBuffer:!1,defaultTrackResize:!0,defaultPersistentGeojson:!1,defaultPersistentImage:!1,defaultPersistentVideo:!1},source:{defaultMaxZoom:18,defaultBuffer:128,defaultTolerance:.375,defaultCluster:!1,defaultClusterRadius:50}}),a.module("mapboxgl-directive").directive("glBearing",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glBearing",function(c){if(!a.isNumber(c))throw new Error("Invalid bearing");b.setBearing(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glCenter",["mapboxglUtils","mapboxglConstants",function(b,c){function d(d,e,f,g){if(!g)throw new Error("Invalid angular-mapboxgl-directive controller");var h=g.getMapboxGlScope();g.getMap().then(function(d){h.$watch("glCenter",function(e,f){b.validateAndFormatCenter(e).then(function(b){if(!b)throw new Error("Invalid center");a.isDefined(f)&&e!==f?d.flyTo({center:b}):d.setCenter(b)}).catch(function(a){throw d.setCenter(c.map.defaultCenter),new Error(a.code+" / "+a.message)})},!0)})}var e={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:d};return e}]),a.module("mapboxgl-directive").directive("glClasses",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glClasses",function(c){if(a.isDefined(c))a.isArray(c)&&b.setClasses(c);else{var d=b.getClasses();d.map(function(a){b.removeClass(a)})}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glControls",["$rootScope",function(d){function e(e,f,g,h){if(!h)throw new Error("Invalid angular-mapboxgl-directive controller");var i=h.getMapboxGlScope(),j={custom:[]},k=function(b,c,d,e,f){d?j.custom.push({name:b||"customControl_"+Date.now(),control:c,isEventsListenedByMap:!!a.isDefined(f)&&f,events:a.isDefined(e)&&a.isArray(e)?e:[]}):j[b]={control:c,isEventsListenedByMap:!!a.isDefined(f)&&f,events:a.isDefined(e)&&a.isArray(e)?e:[]}},l=function(a,b,c,d){c?b.map(function(a){d.off(a)}):b.map(function(b){a.off(b)})},m=function(a){for(var b in j)if("custom"!==b){var c=j[b];l(c.control,c.events,c.isEventsListenedByMap,a),a.removeControl(c.control)}else for(var d=j[b],e=0,f=d.length;e<f;e++){var g=d[e];l(g.control,g.events,g.isEventsListenedByMap,a),a.removeControl(g.control)}j={custom:[]}},n=[{name:"navigation",constructor:b.Navigation||b.NavigationControl,pluginName:"mapboxgl."+(b.Navigation?b.Navigation.name:b.NavigationControl.name)},{name:"scale",constructor:b.Scale||b.ScaleControl,pluginName:"mapboxgl."+(b.Scale?b.Scale.name:b.ScaleControl.name)},{name:"attribution",constructor:b.Attribution||b.AttributionControl,pluginName:"mapboxgl."+(b.Attribution?b.Attribution.name:b.AttributionControl.name)},{name:"geolocate",constructor:b.Geolocate||b.GeolocateControl,pluginName:"mapboxgl."+(b.Geolocate?b.Geolocate.name:b.GeolocateControl.name),eventsExposedName:"mapboxglGeolocate",eventsAvailables:["geolocate","error"]},{name:"geocoder",constructor:b.Geocoder,pluginName:"mapboxgl.Geocoder",eventsExposedName:"mapboxglGeocoder",eventsAvailables:["clear","loading","results","result","error"]},{name:"directions",constructor:b.Directions,pluginName:"mapboxgl.Directions",eventsExposedName:"mapboxglDirections",eventsAvailables:["clear","loading","profile","origin","destination","route","error"]},{name:"draw",constructor:b.Draw,pluginName:"mapboxgl.Draw",eventsExposedName:"mapboxglDraw",listenInMap:!0,eventsAvailables:["draw.create","draw.delete","draw.update","draw.selectionchange","draw.modechange","draw.render"]}];h.getMap().then(function(b){i.$watch("glControls",function(e){if(a.isDefined(e)&&(m(b),n.map(function(f){if(a.isDefined(e[f.name])&&a.isDefined(e[f.name].enabled)&&e[f.name].enabled){if(!a.isDefined(f.constructor)||!a.isFunction(f.constructor))throw new Error(f.pluginName+" plugin is not included.");var g=f.constructor.bind.apply(f.constructor,e[f.name].options),h=new g(e[f.name].options);if(k(f.name,h,!1,f.eventsAvailables,f.listenInMap),a.isDefined(f.eventsAvailables)&&a.isDefined(f.eventsExposedName)){var i=f.listenInMap?b:h;f.eventsAvailables.map(function(a){i.on(a,function(b){var c=f.eventsExposedName+":"+a;d.$broadcast(c,b)})})}var j=e[f.name].options&&e[f.name].options.position?e[f.name].options.position:c;b.addControl(h,j)}}),a.isDefined(e.custom))){if(!a.isArray(e.custom))throw new Error("'custom' must be an array");e.custom.map(function(e){if(a.isDefined(e.constructor)){var f=e.constructor.bind.apply(e.constructor,e.options),g=new f(e.options),h=a.isArray(e.events)?e.events:[];k(e.name,g,!0,h,e.listenInMap);var i=e.listenInMap?b:g;h.map(function(a){i.on(a,function(b){var c="mapboxgl:"+e.name+":"+a;d.$broadcast(c,b)})});var j=e.options&&e.options.position?e.options.position:c;b.addControl(g,j)}})}})})}var f={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:e};return f}]),a.module("mapboxgl-directive").directive("glFilter",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glFilter",function(c){if(a.isDefined(c))if(Object.prototype.toString.call(c)===Object.prototype.toString.call({})){if(!(a.isDefined(c.layerId)&&a.isDefined(c.filter)&&a.isArray(c.filter)))throw new Error("Invalid filter parameter");b.setFilter(c.layerId,c.filter)}else{if(Object.prototype.toString.call(c)!==Object.prototype.toString.call([]))throw new Error("Invalid filter parameter");c.map(function(c){if(!(a.isDefined(c.layerId)&&a.isDefined(c.filter)&&a.isArray(c.filter)))throw new Error("Invalid filter parameter");b.setFilter(c.layerId,c.filter)})}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glGeojson",["mapboxglGeojsonUtils","mapboxglPopupUtils","$timeout",function(b,c,d){function e(e,f,g,h){if(!h)throw new Error("Invalid angular-mapboxgl-directive controller");var i=h.getMapboxGlScope(),j=function(a){a.off("click"),a.off("mousemove")},k=function(d){d.on("click",function(e){var f=d.getStyle(),g=f.layers.filter(function(b){if(a.isDefined(b.metadata)&&a.isDefined(b.metadata.type))return"mapboxgl:geojson"===b.metadata.type&&a.isDefined(b.metadata.popup)&&b.metadata.popup}).map(function(a){return a.id}),h=d.queryRenderedFeatures(e.point,{layers:g});if(h.length>0){var i=h[0],j=b.getPopupByLayerId(i.layer.id);c.createPopupByObject(d,{coordinates:e.point,options:j.options,html:j.message,getScope:j.getScope})}}),d.on("mousemove",function(b){var c=d.getStyle(),e=c.layers.filter(function(b){if(a.isDefined(b.metadata)&&a.isDefined(b.metadata.type))return"mapboxgl:geojson"===b.metadata.type}).map(function(a){return a.id}),f=d.queryRenderedFeatures(b.point,{layers:e});d.getCanvas().style.cursor=f.length?"pointer":""})},l=function(c,d,e){if(a.isDefined(e)){if(j(c),b.removeAllRelations(),Object.prototype.toString.call(e)!==Object.prototype.toString.call({}))throw new Error("Invalid geojson parameter");b.createGeojsonByObject(c,e),d.addGeojsonObject(e),k(c)}};e.$on("mapboxglMap:styleChanged",function(){if(h.isGeojsonPersistent()){var b=a.copy(h.getGeojsonObjects());h.removeGeojsonObjects(),h.getMap().then(function(a){l(a,h,b)})}else h.removeGeojsonObjects()}),h.getMap().then(function(b){i.$watchCollection("glGeojson",function(c){a.isDefined(c)&&null!==c&&d(function(){l(b,h,c)},500,!0)})})}var f={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:e};return f}]),a.module("mapboxgl-directive").directive("glHandlers",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glHandlers",function(c){if(a.isDefined(c)&&Object.prototype.toString.call(c)===Object.prototype.toString.call({}))for(var d in c){var e=c[d]?"enable":"disable";b[d][e]()}},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glImage",["mapboxglImageUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=function(c,d,e){if(a.isDefined(e))if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))b.createImageByObject(c,e),d.addImageObject(e);else{if(Object.prototype.toString.call(e)!==Object.prototype.toString.call([]))throw new Error("Invalid image parameter");e.map(function(a){b.createImageByObject(c,a),d.addImageObject(a)})}};c.$on("mapboxglMap:styleChanged",function(){if(f.isImagePersistent()){var b=a.copy(f.getImageObjects());f.removeImageObjects(),f.getMap().then(function(a){h(a,f,b)})}else f.removeImageObjects()}),f.getMap().then(function(a){g.$watchCollection("glImage",function(b){a.style.loaded()?h(a,f,b):a.once("style.load",function(){h(a,f,b)})})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glInteractive",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=["touchZoomRotate","scrollZoom","boxZoom","dragRotate","dragPan","doubleClickZoom","keyboard"],g=e.getMapboxGlScope();e.getMap().then(function(b){g.$watch("glInteractive",function(c){if(a.isDefined(c)&&"boolean"==typeof c){var d=c?"enable":"disable";f.map(function(a){b[a][d]()})}})})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glLights",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glLights",function(c){a.isDefined(c)&&b.setLight(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMarkers",["mapboxglMarkerUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=[],i=function(){h.map(function(a){a.remove()}),h=[]},j=function(c,d){if(a.isDefined(d))if(i(),Object.prototype.toString.call(d)===Object.prototype.toString.call({})){var e=b.createMarkerByObject(c,d);h.push(e)}else{if(Object.prototype.toString.call(d)!==Object.prototype.toString.call([]))throw new Error("Invalid marker parameter");d.map(function(a){var d=b.createMarkerByObject(c,a);h.push(d)})}};f.getMap().then(function(a){g.$watchCollection("glMarkers",function(b){j(a,b)})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glMaxBounds",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMaxBounds",function(c){if(!a.isArray(c)||2!==c.length)throw new Error("Invalid max bounds");b.setMaxBounds(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMaxZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMaxZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid max zoom");b.setMaxZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glMinZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glMinZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid min zoom");b.setMinZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glPitch",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glPitch",function(c){if(!a.isNumber(c)||!(c>=0||c<=60))throw new Error("Invalid pitch");b.setPitch(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}]),a.module("mapboxgl-directive").directive("glPopups",["mapboxglPopupUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=[],i=function(){h.map(function(a){a.remove()}),h=[]},j=function(c,d){if(a.isDefined(d))if(i(),Object.prototype.toString.call(d)===Object.prototype.toString.call({})){var e=b.createPopupByObject(c,d);h.push(e)}else{if(Object.prototype.toString.call(d)!==Object.prototype.toString.call([]))throw new Error("Invalid popup parameter");d.map(function(a){var d=b.createPopupByObject(c,a);h.push(d)})}};f.getMap().then(function(a){g.$watchCollection("glPopups",function(b){j(a,b)})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glStyle",["$rootScope",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope();f.getMap().then(function(c){g.$watch("glStyle",function(d,e){if(a.isDefined(d)&&null!==d&&d!==e){var f=!1;c.setStyle(d),c.on("data",function(a){"style"!==a.dataType||f||(b.$broadcast("mapboxglMap:styleChanged",{map:c,newStyle:d,oldStyle:e}),f=!0)})}},!0)})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glVideo",["mapboxglVideoUtils",function(b){function c(c,d,e,f){if(!f)throw new Error("Invalid angular-mapboxgl-directive controller");var g=f.getMapboxGlScope(),h=function(c,d,e){if(a.isDefined(e))if(Object.prototype.toString.call(e)===Object.prototype.toString.call({}))b.createVideoByObject(c,e),d.addVideoObject(e);else{if(Object.prototype.toString.call(e)!==Object.prototype.toString.call([]))throw new Error("Invalid video parameter");e.map(function(a){b.createVideoByObject(c,a),d.addVideoObject(a)})}};f.getMap().then(function(a){g.$watchCollection("glVideo",function(b){a.loaded()?h(a,f,b):a.on("load",function(){h(a,f,b)})})})}var d={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:c};return d}]),a.module("mapboxgl-directive").directive("glZoom",[function(){function b(b,c,d,e){if(!e)throw new Error("Invalid angular-mapboxgl-directive controller");var f=e.getMapboxGlScope();e.getMap().then(function(b){f.$watch("glZoom",function(c){if(!a.isNumber(c)||!(c>=0||c<=20))throw new Error("Invalid zoom");b.setZoom(c)},!0)})}var c={restrict:"A",scope:!1,replace:!1,require:"?^mapboxgl",link:b};return c}])}(angular,mapboxgl);