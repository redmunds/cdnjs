/**
 * elasticlunr - http://weixsong.github.io
 * Lightweight full-text search engine in Javascript for browser search and offline search. - 0.6.1
 *
 * Copyright (C) 2015 Oliver Nightingale
 * Copyright (C) 2015 Wei Song
 * MIT Licensed
 * @license
 */
!function(){var e=function(t){var n=new e.Index;return n.pipeline.add(e.trimmer,e.stopWordFilter,e.stemmer),t&&t.call(n,n),n};e.version="0.6.1",e.utils={},e.utils.warn=function(e){return function(t){e.console&&console.warn&&console.warn(t)}}(this),e.EventEmitter=function(){this.events={}},e.EventEmitter.prototype.addListener=function(){var e=Array.prototype.slice.call(arguments),t=e.pop(),n=e;if("function"!=typeof t)throw new TypeError("last argument must be a function");n.forEach(function(e){this.hasHandler(e)||(this.events[e]=[]),this.events[e].push(t)},this)},e.EventEmitter.prototype.removeListener=function(e,t){if(this.hasHandler(e)){var n=this.events[e].indexOf(t);this.events[e].splice(n,1),this.events[e].length||delete this.events[e]}},e.EventEmitter.prototype.emit=function(e){if(this.hasHandler(e)){var t=Array.prototype.slice.call(arguments,1);this.events[e].forEach(function(e){e.apply(void 0,t)})}},e.EventEmitter.prototype.hasHandler=function(e){return e in this.events},e.tokenizer=function(e){return arguments.length&&null!=e&&void 0!=e?Array.isArray(e)?e.map(function(e){return e.toLowerCase()}):e.toString().trim().toLowerCase().split(/[\s\-]+/):[]},e.Pipeline=function(){this._stack=[]},e.Pipeline.registeredFunctions={},e.Pipeline.registerFunction=function(t,n){n in this.registeredFunctions&&e.utils.warn("Overwriting existing registered function: "+n),t.label=n,e.Pipeline.registeredFunctions[t.label]=t},e.Pipeline.warnIfFunctionNotRegistered=function(t){var n=t.label&&t.label in this.registeredFunctions;n||e.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",t)},e.Pipeline.load=function(t){var n=new e.Pipeline;return t.forEach(function(t){var i=e.Pipeline.registeredFunctions[t];if(!i)throw new Error("Cannot load un-registered function: "+t);n.add(i)}),n},e.Pipeline.prototype.add=function(){var t=Array.prototype.slice.call(arguments);t.forEach(function(t){e.Pipeline.warnIfFunctionNotRegistered(t),this._stack.push(t)},this)},e.Pipeline.prototype.after=function(t,n){e.Pipeline.warnIfFunctionNotRegistered(n);var i=this._stack.indexOf(t);if(-1==i)throw new Error("Cannot find existingFn");i+=1,this._stack.splice(i,0,n)},e.Pipeline.prototype.before=function(t,n){e.Pipeline.warnIfFunctionNotRegistered(n);var i=this._stack.indexOf(t);if(-1==i)throw new Error("Cannot find existingFn");this._stack.splice(i,0,n)},e.Pipeline.prototype.remove=function(e){var t=this._stack.indexOf(e);-1!=t&&this._stack.splice(t,1)},e.Pipeline.prototype.run=function(e){for(var t=[],n=e.length,i=this._stack.length,r=0;n>r;r++){for(var o=e[r],s=0;i>s&&(o=this._stack[s](o,r,e),void 0!==o);s++);void 0!==o&&t.push(o)}return t},e.Pipeline.prototype.reset=function(){this._stack=[]},e.Pipeline.prototype.toJSON=function(){return this._stack.map(function(t){return e.Pipeline.warnIfFunctionNotRegistered(t),t.label})},e.SortedSet=function(){this.length=0,this.elements=[]},e.SortedSet.load=function(e){var t=new this;return t.elements=e,t.length=e.length,t},e.SortedSet.prototype.add=function(){var e,t;for(e=0;e<arguments.length;e++)t=arguments[e],~this.indexOf(t)||this.elements.splice(this.locationFor(t),0,t);this.length=this.elements.length},e.SortedSet.prototype.toArray=function(){return this.elements.slice()},e.SortedSet.prototype.map=function(e,t){return this.elements.map(e,t)},e.SortedSet.prototype.forEach=function(e,t){return this.elements.forEach(e,t)},e.SortedSet.prototype.indexOf=function(e){for(var t=0,n=this.elements.length-1;n>=t;){var i=t+Math.floor((n-t+1)/2),r=this.elements[i];if(r===e)return i;e>r?t=i+1:n=i-1}return-1},e.SortedSet.prototype.locationFor=function(e){for(var t=0,n=this.elements.length-1;n>=t;){var i=t+Math.floor((n-t+1)/2),r=this.elements[i];if(r===e)return i;e>r?t=i+1:n=i-1}return r>e?i:e>r?i+1:void 0},e.SortedSet.prototype.intersect=function(t){for(var n=new e.SortedSet,i=0,r=0,o=this.length,s=t.length,a=this.elements,l=t.elements;;){if(i>o-1||r>s-1)break;a[i]!==l[r]?a[i]<l[r]?i++:a[i]>l[r]&&r++:(n.add(a[i]),i++,r++)}return n},e.SortedSet.prototype.clone=function(){var t=new e.SortedSet;return t.elements=this.toArray(),t.length=t.elements.length,t},e.SortedSet.prototype.union=function(e){var t,n,i;return this.length>=e.length?(t=this,n=e):(t=e,n=this),i=t.clone(),i.add.apply(i,n.toArray()),i},e.SortedSet.prototype.toJSON=function(){return this.toArray()},e.Index=function(){this._fields=[],this._ref="id",this.pipeline=new e.Pipeline,this.documentStore=new e.DocumentStore,this.index={},this.eventEmitter=new e.EventEmitter,this._idfCache={},this.on("add","remove","update",function(){this._idfCache={}}.bind(this))},e.Index.prototype.on=function(){var e=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,e)},e.Index.prototype.off=function(e,t){return this.eventEmitter.removeListener(e,t)},e.Index.load=function(t){t.version!==e.version&&e.utils.warn("version mismatch: current "+e.version+" importing "+t.version);var n=new this;n._fields=t.fields,n._ref=t.ref,n.documentStore=e.DocumentStore.load(t.documentStore),n.pipeline=e.Pipeline.load(t.pipeline),n.index={};for(var i in t.index)n.index[i]=e.InvertedIndex.load(t.index[i]);return n},e.Index.prototype.addField=function(t){return this._fields.push(t),this.index[t]=new e.InvertedIndex,this},e.Index.prototype.setRef=function(e){return this._ref=e,this},e.Index.prototype.addDoc=function(t,n){if(t){var n=void 0===n?!0:n,i=t[this._ref];this.documentStore.addDoc(i,t),this._fields.forEach(function(n){var r=this.pipeline.run(e.tokenizer(t[n])),o=(r.length,{});r.forEach(function(e){e in o?o[e]+=1:o[e]=1},this);for(var s in o){var a=o[s];a=Math.sqrt(a),this.index[n].addToken(s,{ref:i,tf:a})}},this),n&&this.eventEmitter.emit("add",t,this)}},e.Index.prototype.removeDoc=function(t,n){if(t){var n=void 0===n?!0:n,i=t[this._ref];this.documentStore.hasDoc(i)&&(this.documentStore.removeDoc(i),this._fields.forEach(function(n){var i=this.pipeline.run(e.tokenizer(t[n]));for(var r in i)this.index[n].removeToken(r)},this),n&&this.eventEmitter.emit("remove",t,this))}},e.Index.prototype.update=function(e,t){var t=void 0===t?!0:t;this.removeDoc(e[this._ref],!1),this.addDoc(e,!1),t&&this.eventEmitter.emit("update",e,this)},e.Index.prototype.idf=function(e,t){var n="@"+t+"/"+e;if(Object.prototype.hasOwnProperty.call(this._idfCache,n))return this._idfCache[n];var i=this.index[t].getDocFreq(e),r=1+Math.log(this.documentStore.length/(i+1));return this._idfCache[n]=r,r},e.Index.prototype.search=function(t,n){if(!t)return[];var i=this.pipeline.run(e.tokenizer(t)),r={};null==n||null==n.fields?this._fields.forEach(function(e){r[e]={boost:1}},this):r=n.fields;var o={},s=this.computeSquaredWeight(i,r);for(var a in r){var l=this.fieldSearch(i,a,n),c={},h=r[a].boost||1,u=1/Math.sqrt(1/(h*h)*s);console.log("queryNorm: "+u+" in field:"+a);for(var d in l){var f=this.computeScore(i,d,a);f=u*f,c[d]=f}for(var d in c)d in o?o[d]+=c[d]:o[d]=c[d]}var p=[];for(var d in o)p.push({ref:d,score:o[d]});return p.sort(function(e,t){return t.score-e.score}),p},e.Index.prototype.computeScore=function(t,n,i){var r=this.documentStore.getDoc(n),o=0,s=this.pipeline.run(e.tokenizer(r[i]));t.forEach(function(e){-1!=s.indexOf(e)&&(o+=1)},this),o/=t.length;var a=0;return t.forEach(function(e){var t=this.index[i].getTF(e,n),r=this.idf(e,i),o=1/Math.sqrt(s.length);a+=t*r*o},this),a*=o},e.Index.prototype.computeSquaredWeight=function(e,t){var n=0;return e.forEach(function(e){var i=0;for(var r in t){var o=t[r].boost||1,s=this.idf(e,r);i+=s*s*o*o}n+=i},this),n},e.Index.prototype.fieldSearch=function(e,t,n){var i=null==n||null==n["boolean"]?"OR":n["boolean"],r={};e.forEach(function(e){var n=this.index[t].getDocs(e);r[e]=n},this);var o={};return"OR"==i?o=this.union(r):"AND"==i&&(o=this.intersect(r,e)),o},e.Index.prototype.union=function(e){var t={};for(var n in e)for(var i in e[n])t[i]=!0;return t},e.Index.prototype.intersect=function(e,t){var n={},i=t[0];for(var r in e[i]){var o=!0;for(var s in e)if(!(r in e[s])){o=!1;break}1==o&&(n[r]=!0)}return n},e.Index.prototype.toJSON=function(){var t={};for(var n in this._fields){var i=this._fields[n];t[i]=this.index[i].toJSON()}return{version:e.version,fields:this._fields,ref:this._ref,documentStore:this.documentStore.toJSON(),index:t,pipeline:this.pipeline.toJSON()}},e.Index.prototype.use=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this),e.apply(this,t)},e.DocumentStore=function(){this.docs={},this.length=0},e.DocumentStore.load=function(e){var t=new this;return t.length=e.length,t.docs=e.docs,t},e.DocumentStore.prototype.addDoc=function(e,t){this.hasDoc(e)||this.length++,this.docs[e]=t},e.DocumentStore.prototype.getDoc=function(e){return this.docs[e]},e.DocumentStore.prototype.hasDoc=function(e){return e in this.docs},e.DocumentStore.prototype.removeDoc=function(e){this.hasDoc(e)&&(delete this.docs[e],this.length--)},e.DocumentStore.prototype.toJSON=function(){return{docs:this.docs,length:this.length}},e.stemmer=function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},n="[^aeiou]",i="[aeiouy]",r=n+"[^aeiouy]*",o=i+"[aeiou]*",s="^("+r+")?"+o+r,a="^("+r+")?"+o+r+"("+o+")?$",l="^("+r+")?"+o+r+o+r,c="^("+r+")?"+i,h=new RegExp(s),u=new RegExp(l),d=new RegExp(a),f=new RegExp(c),p=/^(.+?)(ss|i)es$/,v=/^(.+?)([^s])s$/,m=/^(.+?)eed$/,g=/^(.+?)(ed|ing)$/,y=/.$/,x=/(at|bl|iz)$/,w=new RegExp("([^aeiouylsz])\\1$"),S=new RegExp("^"+r+i+"[^aeiouwxy]$"),I=/^(.+?[^aeiou])y$/,E=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,b=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,_=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,F=/^(.+?)(s|t)(ion)$/,k=/^(.+?)e$/,D=/ll$/,P=new RegExp("^"+r+i+"[^aeiouwxy]$"),$=function(n){var i,r,o,s,a,l,c;if(n.length<3)return n;if(o=n.substr(0,1),"y"==o&&(n=o.toUpperCase()+n.substr(1)),s=p,a=v,s.test(n)?n=n.replace(s,"$1$2"):a.test(n)&&(n=n.replace(a,"$1$2")),s=m,a=g,s.test(n)){var $=s.exec(n);s=h,s.test($[1])&&(s=y,n=n.replace(s,""))}else if(a.test(n)){var $=a.exec(n);i=$[1],a=f,a.test(i)&&(n=i,a=x,l=w,c=S,a.test(n)?n+="e":l.test(n)?(s=y,n=n.replace(s,"")):c.test(n)&&(n+="e"))}if(s=I,s.test(n)){var $=s.exec(n);i=$[1],n=i+"i"}if(s=E,s.test(n)){var $=s.exec(n);i=$[1],r=$[2],s=h,s.test(i)&&(n=i+e[r])}if(s=b,s.test(n)){var $=s.exec(n);i=$[1],r=$[2],s=h,s.test(i)&&(n=i+t[r])}if(s=_,a=F,s.test(n)){var $=s.exec(n);i=$[1],s=u,s.test(i)&&(n=i)}else if(a.test(n)){var $=a.exec(n);i=$[1]+$[2],a=u,a.test(i)&&(n=i)}if(s=k,s.test(n)){var $=s.exec(n);i=$[1],s=u,a=d,l=P,(s.test(i)||a.test(i)&&!l.test(i))&&(n=i)}return s=D,a=u,s.test(n)&&a.test(n)&&(s=y,n=n.replace(s,"")),"y"==o&&(n=o.toLowerCase()+n.substr(1)),n};return $}(),e.Pipeline.registerFunction(e.stemmer,"stemmer"),e.stopWordFilter=function(t){return-1===e.stopWordFilter.stopWords.indexOf(t)?t:void 0},e.stopWordFilter.stopWords=new e.SortedSet,e.stopWordFilter.stopWords.length=119,e.stopWordFilter.stopWords.elements=["","a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"],e.Pipeline.registerFunction(e.stopWordFilter,"stopWordFilter"),e.trimmer=function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"")},e.Pipeline.registerFunction(e.trimmer,"trimmer"),e.InvertedIndex=function(){this.root={docs:{},df:0},this.length=0},e.InvertedIndex.load=function(e){var t=new this;return t.root=e.root,t.length=e.length,t},e.InvertedIndex.prototype.addToken=function(e,t,n){for(var n=n||this.root,i=0;i<=e.length-1;){var r=e[i];r in n||(n[r]={docs:{},df:0}),i+=1,n=n[r]}var o=t.ref;n.docs[o]?n.docs[o]={tf:t.tf}:(n.docs[o]={tf:t.tf},n.df+=1,this.length+=1)},e.InvertedIndex.prototype.hasToken=function(e){if(!e)return!1;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return!1;t=t[e[n]]}return!0},e.InvertedIndex.prototype.getNode=function(e){if(!e)return null;for(var t=this.root,n=0;n<e.length;n++){if(!t[e[n]])return null;t=t[e[n]]}return t},e.InvertedIndex.prototype.getDocs=function(e){var t=this.getNode(e);return null==t?{}:t.docs},e.InvertedIndex.prototype.getTF=function(e,t){var n=this.getNode(e);return null==n?0:t in n.docs?n.docs[t].tf:0},e.InvertedIndex.prototype.getDocFreq=function(e){var t=this.getNode(e);return null==t?0:t.df},e.InvertedIndex.prototype.removeToken=function(e,t){if(e){for(var n=this.root,i=0;i<e.length;i++){if(!(e[i]in n))return;n=n[e[i]]}t in n.docs&&(delete n.docs[t],n.df-=1)}},e.InvertedIndex.prototype.expandToken=function(e,t,n){if(null==e||""==e)return[];if(void 0==n&&(n=this.getNode(e),null==n))return[];var t=t||[];n.df>0&&t.push(e);for(var i in n)"docs"!==i&&"df"!==i&&t.concat(this.expandToken(e+i,t,n[i]));return t},e.InvertedIndex.prototype.toJSON=function(){return{root:this.root,length:this.length}},function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.elasticlunr=t()}(this,function(){return e})}();