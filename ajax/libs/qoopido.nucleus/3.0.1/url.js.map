{"version":3,"sources":["url.js"],"names":["global","document","definition","abstractUuid","Descriptor","iterate","resolveCurrent","resolver","createElement","href","slice","getLinkProperty","uuid","property","properties","storage","link","setLinkProperty","value","Parameter","self","this","objectDefineProperties","update","Url","url","parent","constructor","call","parameter","toString","valueOf","Object","defineProperties","regexMatchLeadingSlash","regexMatchParameter","regexMatchSpaces","regexMatchOpeningBrackets","regexMatchClosingBrackets","regexMatchLocal","RegExp","regexMatchDefaults","http:","https:","ftp:","prototype","get","name","set","serialize","remove","context","tokens","search","split","join","exec","decodeURIComponent","result","encodeURIComponent","replace","local","test","origin","protocol","host","username","password","hostname","port","pathname","hash","extends","provide"],"mappings":"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","file":"url.js","sourcesContent":["/**\n * @use /demand/abstract/uuid\n */\n\n(function(global, document) {\n\t'use strict';\n\n\tfunction definition(abstractUuid, Descriptor, iterate) {\n\t\tvar objectDefineProperties    = Object.defineProperties,\n\t\t\tstorage                   = {},\n\t\t\tregexMatchLeadingSlash    = /^\\//,\n\t\t\tregexMatchParameter       = /[?&]?([^=]+)=([^&]*)/g,\n\t\t\tregexMatchSpaces          = /%20/g,\n\t\t\tregexMatchOpeningBrackets = /%5B/g,\n\t\t\tregexMatchClosingBrackets = /%5D/g,\n\t\t\tregexMatchLocal           = new RegExp('^' + resolveCurrent(), 'i'),\n\t\t\tregexMatchDefaults        = {\n\t\t\t\t'http:':  /:80$/,\n\t\t\t\t'https:': /:443$/,\n\t\t\t\t'ftp:':   /:21$/\n\t\t\t};\n\n\t\tfunction resolveCurrent() {\n\t\t\tvar resolver = document.createElement('a');\n\n\t\t\tresolver.href = '/';\n\n\t\t\treturn resolver.href.slice(0, -1);\n\t\t}\n\n\t\tfunction getLinkProperty(uuid, property) {\n\t\t\tvar properties;\n\n\t\t\tif(properties = storage[uuid]) {\n\t\t\t\treturn properties.link[property];\n\t\t\t}\n\t\t}\n\n\t\tfunction setLinkProperty(uuid, property, value) {\n\t\t\tvar properties;\n\n\t\t\tif(properties = storage[uuid]) {\n\t\t\t\tproperties.link[property] = value;\n\t\t\t}\n\t\t}\n\n\t\tfunction Parameter(uuid) {\n\t\t\tvar self = this;\n\n\t\t\tobjectDefineProperties(self, { uuid: new Descriptor(uuid) });\n\n\t\t\tParameter.update(self);\n\t\t}\n\n\t\tParameter.prototype = {\n\t\t\t/* only for reference\n\t\t\tuuid: null\n\t\t\t*/\n\t\t\tget: function(name) {\n\t\t\t\treturn storage[this.uuid].parameter[name];\n\t\t\t},\n\t\t\tset: function(name, value) {\n\t\t\t\tstorage[this.uuid].parameter[name] = value;\n\n\t\t\t\tParameter.serialize(this);\n\t\t\t},\n\t\t\tremove: function(name) {\n\t\t\t\tdelete storage[this.uuid].parameter[name];\n\n\t\t\t\tParameter.serialize(this);\n\t\t\t}\n\t\t};\n\n\t\tParameter.update = function(context) {\n\t\t\tvar properties = storage[context.uuid],\n\t\t\t\tparameter  = properties.parameter,\n\t\t\t\tsearch     = properties.link.search.split('+').join(' '),\n\t\t\t\ttokens;\n\n\t\t\titerate(parameter, function(property) {\n\t\t\t\tdelete parameter[property];\n\t\t\t});\n\n\t\t\twhile(tokens = regexMatchParameter.exec(search)) {\n\t\t\t\tparameter[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);\n\t\t\t}\n\t\t};\n\n\t\tParameter.serialize = function(context) {\n\t\t\tvar properties = storage[context.uuid],\n\t\t\t\tparameter  = properties.parameter,\n\t\t\t\tresult     = '';\n\n\t\t\titerate(parameter, function(property, value) {\n\t\t\t\tresult += (!result ? '?' : '&') + encodeURIComponent(property) + '=' + encodeURIComponent(value);\n\t\t\t});\n\n\t\t\tproperties.link.search = result\n\t\t\t\t.replace(regexMatchSpaces, '+')\n\t\t\t\t.replace(regexMatchOpeningBrackets, '[')\n\t\t\t\t.replace(regexMatchClosingBrackets, ']');\n\t\t};\n\n\t\tfunction Url(url) {\n\t\t\tvar self = this.parent.constructor.call(this),\n\t\t\t\tlink = document.createElement('a');\n\n\t\t\tlink.href = url;\n\n\t\t\tstorage[self.uuid] = {\n\t\t\t\tlink:      link,\n\t\t\t\tparameter: {}\n\t\t\t};\n\n\t\t\tobjectDefineProperties(self, {\n\t\t\t\ttoString:  new Descriptor(function() { return link.toString(); }),\n\t\t\t\tvalueOf:   new Descriptor(function() { return link.valueOf(); }),\n\t\t\t\tparameter: new Descriptor(new Parameter(self.uuid))\n\t\t\t});\n\t\t}\n\n\t\tUrl.prototype = {\n\t\t\tget local() {\n\t\t\t\tvar value;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'href')) {\n\t\t\t\t\treturn regexMatchLocal.test(value);\n\t\t\t\t}\n\t\t\t},\n\t\t\tget href() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'href');\n\t\t\t},\n\t\t\tset href(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'href', value);\n\t\t\t},\n\t\t\tget origin() {\n\t\t\t\tvar self = this;\n\n\t\t\t\treturn getLinkProperty(self.uuid, 'origin') || self.protocol + '//' + self.host;\n\t\t\t},\n\t\t\tget protocol() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'protocol');\n\t\t\t},\n\t\t\tset protocol(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'protocol', value);\n\t\t\t},\n\t\t\tget username() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'username');\n\t\t\t},\n\t\t\tset username(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'username', value);\n\t\t\t},\n\t\t\tget password() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'password');\n\t\t\t},\n\t\t\tset password(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'password', value);\n\t\t\t},\n\t\t\tget host() {\n\t\t\t\tvar value, protocol;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'host')) {\n\t\t\t\t\tprotocol = getLinkProperty(this.uuid, 'protocol');\n\n\t\t\t\t\treturn regexMatchDefaults[protocol] ? value.replace(regexMatchDefaults[protocol], '') : value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset host(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'host', value);\n\t\t\t},\n\t\t\tget hostname() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'hostname');\n\t\t\t},\n\t\t\tset hostname(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'hostname', value);\n\t\t\t},\n\t\t\tget port() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'port');\n\t\t\t},\n\t\t\tset port(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'port', value);\n\t\t\t},\n\t\t\tget pathname() {\n\t\t\t\tvar value;\n\n\t\t\t\tif(value = getLinkProperty(this.uuid, 'pathname')) {\n\t\t\t\t\treturn regexMatchLeadingSlash.test(value) ? value : '/' + value;\n\t\t\t\t}\n\t\t\t},\n\t\t\tset pathname(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'pathname', value);\n\t\t\t},\n\t\t\tget search() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'search');\n\t\t\t},\n\t\t\tset search(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'search', value);\n\n\t\t\t\tParameter.update.call(this);\n\t\t\t},\n\t\t\tget hash() {\n\t\t\t\treturn getLinkProperty(this.uuid, 'hash');\n\t\t\t},\n\t\t\tset hash(value) {\n\t\t\t\tsetLinkProperty(this.uuid, 'hash', value);\n\t\t\t}\n\t\t};\n\n\t\treturn Url.extends(abstractUuid);\n\t}\n\n\tprovide([ '/demand/abstract/uuid', '/demand/descriptor', '/demand/function/iterate' ], definition);\n}(this, document));"]}