{"version":3,"sources":["emitter.js"],"names":["undefined","definition","base","functionDescriptorGenerate","functionUniqueUuid","conceal","self","this","prototype","constructor","properties","objectGetOwnPropertyNames","forEach","property","event","descriptor","regexMatchExcludedMethods","test","objectGetOwnPropertyDescriptor","writable","charAt","toUpperCase","slice","value","result","emit","arguments","apply","objectDefineProperty","Emitter","uuid","storage","objectGetPrototypeOf","call","Object","defineProperty","getOwnPropertyNames","getOwnPropertyDescriptor","getPrototypeOf","on","events","fn","pointer","i","split","push","one","each","listener","off","j","splice","length","temp","extend","provide"],"mappings":"AAAA;AACA,CAgBC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAMC,EAA4BC,GAQrD,QAASC,KACR,GAAIC,GAAaC,KAChBC,EAAaF,EAAKG,YAAYD,UAC9BE,EAAaC,EAA0BH,EAExCE,GAAWE,QAAQ,SAASC,GAC3B,GAAIC,GAAOC,CAEkB,mBAAnBT,GAAKO,IAA4BG,EAA0BC,KAAKJ,MAAc,GAASK,EAA+BV,EAAWK,GAAUM,WACpJL,EAAaD,EAASO,OAAO,GAAGC,cAAgBR,EAASS,MAAM,GAC/DP,EAAaG,EAA+BV,EAAWK,GAEvDE,EAAWQ,MAAQ,WAClB,GAAIC,EAQJ,OANAlB,GAAKmB,KAAK,MAAQX,EAAOY,WAEzBF,EAAShB,EAAUK,GAAUc,MAAMrB,EAAMoB,WAEzCpB,EAAKmB,KAAK,OAASX,EAAOY,UAAWF,GAE9BA,GAGRI,EAAqBtB,EAAMO,EAAUE,MAKxC,QAASc,KACR,GAAIvB,GAAOC,KACVuB,EAAOxB,EAAKwB,IAUb,QARCA,IAASA,EAAO1B,MAAyBwB,EAAqBtB,EAAM,OAAQH,EAA2B2B,IAExGC,EAAQD,MAELE,EAAqB1B,KAAUuB,EAAQrB,WACzCH,EAAQ4B,KAAK3B,GAGPA,EAhDR,GAAIU,GAAiC,+BACpCY,EAAiCM,OAAOC,eACxCxB,EAAiCuB,OAAOE,oBACxClB,EAAiCgB,OAAOG,yBACxCL,EAAiCE,OAAOI,eACxCP,IA8HD,OAhFAF,GAAQrB,WAIP+B,GAAI,SAASC,EAAQC,GACpB,GAEQ3B,GAFJR,EAAUC,KACbmC,EAAUX,EAAQzB,EAAKwB,MACvBa,EAAI,CAIL,KAFAH,EAASA,EAAOI,MAAM,MAEf9B,EAAQ0B,EAAOG,MAAQ3C,EAAW2C,KACvCD,EAAQ5B,GAAS4B,EAAQ5B,QAAc+B,KAAKJ,EAG9C,OAAOnC,IAERwC,IAAK,SAASN,EAAQC,EAAIM,GACzB,GAAIzC,GAAOC,IAUX,OARAwC,GAAQA,KAAS,EAEjBzC,EAAKiC,GAAGC,EAAQ,QAASQ,GAASlC,GACjCR,EAAK2C,IAAMF,KAAS,EAAQjC,EAAQ0B,EAASQ,GAE7CP,EAAGd,MAAMpB,KAAMmB,aAGTpB,GAER2C,IAAK,SAAST,EAAQC,GACrB,GAEQ3B,GAAOoC,EAAGF,EAFd1C,EAAUC,KACbmC,EAAUX,EAAQzB,EAAKwB,MACvBa,EAAI,CAEL,IAAGH,EAGF,IAFAA,EAASA,EAAOI,MAAM,MAEf9B,EAAQ0B,EAAOG,MAAQ3C,EAAW2C,IAGxC,GAFAD,EAAQ5B,GAAS4B,EAAQ5B,OAEtB2B,EACF,IAAIS,EAAI,GAAIF,EAAWN,EAAQ5B,GAAOoC,MAAQlD,EAAWkD,IACrDF,IAAaP,IACfC,EAAQ5B,GAAOqC,OAAOD,EAAG,GAEzBA,SAIFR,GAAQ5B,GAAOsC,OAAS,MAI1B,KAAItC,IAASR,GAAK0C,SACjBN,EAAQ5B,GAAOsC,OAAS,CAI1B,OAAO9C,IAERmB,KAAM,SAASX,GACd,GACC4B,GAASW,EAAaL,EADnB1C,EAAOC,KACKoC,EAAI,CAEpB,IAAG7B,EAMF,IALA4B,EAAUX,EAAQzB,EAAKwB,MAEvBY,EAAQ5B,GAAS4B,EAAQ5B,OACzBuC,EAAiBX,EAAQ5B,GAAOQ,SAEzB0B,EAAWK,EAAKV,MAAQ3C,EAAW2C,IACzCK,EAASrB,MAAMrB,EAAMoB,UAIvB,OAAOpB,KAIFJ,EAAKoD,OAAOzB,GAGpB0B,SAAU,SAAU,iCAAkC,0BAA4BtD","file":"emitter.js","sourcesContent":["/**\n * Qoopido emitter\n *\n * Provides mechanism to emit events and register listeners\n *\n * Copyright (c) 2015 Dirk Lueth\n *\n * Dual licensed under the MIT and GPL licenses.\n *  - http://www.opensource.org/licenses/mit-license.php\n *  - http://www.gnu.org/copyleft/gpl.html\n *\n * @author Dirk Lueth <info@qoopido.com>\n *\n * @require ./base\n * @require ./function/unique/uuid\n */\n\n(function(undefined) {\n\t'use strict';\n\n\tfunction definition(base, functionDescriptorGenerate, functionUniqueUuid) {\n\t\tvar regexMatchExcludedMethods      = /^(_|((get|has|is)([A-Z]|$)))/,\n\t\t\tobjectDefineProperty           = Object.defineProperty,\n\t\t\tobjectGetOwnPropertyNames      = Object.getOwnPropertyNames,\n\t\t\tobjectGetOwnPropertyDescriptor = Object.getOwnPropertyDescriptor,\n\t\t\tobjectGetPrototypeOf           = Object.getPrototypeOf,\n\t\t\tstorage                        = {};\n\n\t\tfunction conceal() {\n\t\t\tvar self       = this,\n\t\t\t\tprototype  = self.constructor.prototype,\n\t\t\t\tproperties = objectGetOwnPropertyNames(prototype); // might have to be changed to Object.keys + further checks\n\n\t\t\tproperties.forEach(function(property) {\n\t\t\t\tvar event, descriptor;\n\n\t\t\t\tif(typeof self[property] === 'function' && regexMatchExcludedMethods.test(property) === false && objectGetOwnPropertyDescriptor(prototype, property).writable) {\n\t\t\t\t\tevent      = property.charAt(0).toUpperCase() + property.slice(1);\n\t\t\t\t\tdescriptor = objectGetOwnPropertyDescriptor(prototype, property);\n\n\t\t\t\t\tdescriptor.value = function() {\n\t\t\t\t\t\tvar result;\n\n\t\t\t\t\t\tself.emit('pre' + event, arguments);\n\n\t\t\t\t\t\tresult = prototype[property].apply(self, arguments);\n\n\t\t\t\t\t\tself.emit('post' + event, arguments, result);\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\tobjectDefineProperty(self, property, descriptor);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfunction Emitter() {\n\t\t\tvar self = this,\n\t\t\t\tuuid = self.uuid;\n\n\t\t\t!uuid && (uuid = functionUniqueUuid()) && objectDefineProperty(self, 'uuid', functionDescriptorGenerate(uuid));\n\n\t\t\tstorage[uuid] = {};\n\n\t\t\tif(objectGetPrototypeOf(self) !== Emitter.prototype) {\n\t\t\t\tconceal.call(self);\n\t\t\t}\n\n\t\t\treturn self;\n\t\t}\n\n\t\tEmitter.prototype = {\n\t\t\t/* only for reference\n\t\t\tuuid: null,\n\t\t\t*/\n\t\t\ton: function(events, fn) {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tpointer = storage[self.uuid],\n\t\t\t\t\ti = 0, event;\n\n\t\t\t\tevents = events.split(' ');\n\n\t\t\t\tfor(; (event = events[i]) !== undefined; i++) {\n\t\t\t\t\t(pointer[event] = pointer[event] || []).push(fn);\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\tone: function(events, fn, each) {\n\t\t\t\tvar self = this;\n\n\t\t\t\teach = (each !== false);\n\n\t\t\t\tself.on(events, function listener(event) {\n\t\t\t\t\tself.off(((each === true) ? event : events), listener);\n\n\t\t\t\t\tfn.apply(this, arguments);\n\t\t\t\t});\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\toff: function(events, fn) {\n\t\t\t\tvar self    = this,\n\t\t\t\t\tpointer = storage[self.uuid],\n\t\t\t\t\ti = 0, event, j, listener;\n\n\t\t\t\tif(events) {\n\t\t\t\t\tevents = events.split(' ');\n\n\t\t\t\t\tfor(; (event = events[i]) !== undefined; i++) {\n\t\t\t\t\t\tpointer[event] = pointer[event] || [];\n\n\t\t\t\t\t\tif(fn) {\n\t\t\t\t\t\t\tfor(j = 0; (listener = pointer[event][j]) !== undefined; j++) {\n\t\t\t\t\t\t\t\tif(listener === fn) {\n\t\t\t\t\t\t\t\t\tpointer[event].splice(j, 1);\n\n\t\t\t\t\t\t\t\t\tj--;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpointer[event].length = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor(event in self.listener) {\n\t\t\t\t\t\tpointer[event].length = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t},\n\t\t\temit: function(event) {\n\t\t\t\tvar self = this,\n\t\t\t\t\tpointer, temp, i = 0, listener;\n\n\t\t\t\tif(event) {\n\t\t\t\t\tpointer = storage[self.uuid];\n\n\t\t\t\t\tpointer[event] = pointer[event] || [];\n\t\t\t\t\ttemp           = pointer[event].slice();\n\n\t\t\t\t\tfor(; (listener = temp[i]) !== undefined; i++) {\n\t\t\t\t\t\tlistener.apply(self, arguments);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn self;\n\t\t\t}\n\t\t};\n\n\t\treturn base.extend(Emitter);\n\t}\n\n\tprovide([ './base', './function/descriptor/generate', './function/unique/uuid' ], definition);\n}());"],"sourceRoot":"/source/"}