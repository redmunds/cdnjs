"use strict";window.elFinderSupportVer1=function(e){var r,t,a,i=this,n=function(e){return e.replace("Today",t).replace("Yesterday",a)};r=new Date,t=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate(),r=new Date(Date.now()-864e5),a=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate(),this.upload=e||"auto",this.init=function(e){this.fm=e,this.fm.parseUploadData=function(e){var r;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{r=JSON.parse(e)}catch(e){return{error:["errResponse","errDataNotJSON"]}}return i.normalize("upload",r)}},this.send=function(e){var r,t,a=this,i=this.fm,n=$.Deferred(),d=e.data.cmd,s={};switch(n.abort=function(){"pending"==t.state()&&(t.quiet=!0,t.abort())},d){case"open":e.data.tree=1;break;case"parents":case"tree":return n.resolve({tree:[]});case"get":e.data.cmd="read",e.data.current=i.file(e.data.target).phash;break;case"put":e.data.cmd="edit",e.data.current=i.file(e.data.target).phash;break;case"archive":case"rm":e.data.current=i.file(e.data.targets[0]).phash;break;case"extract":case"rename":case"resize":e.data.current=i.file(e.data.target).phash;break;case"duplicate":return s=$.extend(!0,{},e),$.each(e.data.targets,function(e,r){$.ajax($.extend(s,{data:{cmd:"duplicate",target:r,current:i.file(r).phash}})).error(function(e){i.error(i.res("error","connect"))}).done(function(e){e=a.normalize("duplicate",e),e.error?i.error(e.error):e.added&&i.trigger("add",{added:e.added})})}),n.resolve({});case"mkdir":case"mkfile":e.data.current=e.data.target;break;case"paste":e.data.current=e.data.dst,e.data.tree||$.each(e.data.targets,function(r,t){if(i.file(t)&&"directory"===i.file(t).mime)return e.data.tree="1",!1});break;case"size":return n.resolve({error:i.res("error","cmdsupport")});case"search":return n.resolve({error:i.res("error","cmdsupport")});case"file":e.data.cmd="open",e.data.current=i.file(e.data.target).phash}return t=$.ajax(e).fail(function(e){n.reject(e)}).done(function(t){r=a.normalize(d,t),"paste"==d&&(r.error||r.added.length||r.removed.length||r.changed.length||(r.error=[e.data.cut?"errMove":"errCopy",i.i18n("items"),"errExists",i.file(e.data.targets[0]).name]),r.error||i.sync()),n.resolve(r)}),n},this.normalize=function(e,r){var t,a,i,d,s=this,o=this.fm,c={},m=function(e){return e&&e.hash&&e.name&&e.mime?e:null},h=function(e){return $.map(e,function(e){return e&&e.mime&&"directory"===e.mime?e:null})},l=function(e){var r=h(e);if(d=o.diff(r,null,["date","ts"]),d.added.length&&(d.added=h(d.added)),d.changed.length&&(d.changed=h(d.changed)),d.removed.length){var t=[];$.each(d.removed,function(e,r){var a;(a=o.file(r))&&"directory"===a.mime&&t.push(r)}),d.removed=t}return d};return"tmb"==e||"get"==e?r:("upload"==e&&r.error&&r.cwd&&(r.warning=$.extend({},r.error),r.error=!1),r.error?r:"put"==e?(t=o.file(r.target.hash).phash,{changed:[this.normalizeFile(r.target,t)]}):(t=r.cwd.hash,i=t==o.cwd().hash,r.tree&&$.each(this.normalizeTree(r.tree),function(e,r){c[r.hash]=r}),$.each(r.cdc||[],function(e,a){var i,d=a.hash;c[d]?(a.date&&(i=Date.parse(n(a.date)),i&&!isNaN(i)?c[d].ts=Math.floor(i/1e3):c[d].date=a.date||o.formatDate(a)),c[d].locked=a.hash==t||void 0!==a.rm&&!a.rm):c[d]=s.normalizeFile(a,t,r.tmb)}),r.tree||$.each(o.files(),function(e,r){c[e]||r.phash==t||"directory"!=r.mime||(c[e]=r)}),"open"==e?{cwd:c[t]||this.normalizeFile(r.cwd),files:$.map(c,function(e){return e}),options:s.normalizeOptions(r),init:!!r.params,debug:r.debug}:(a=i?o.diff($.map(c,m)):r.tree?l(c):{added:[],removed:[],changed:[]},$.extend({current:r.cwd.hash,error:r.error,warning:r.warning,options:{tmb:!!r.tmb}},a))))},this.normalizeTree=function(e){var r=this,t=[],a=function(e,i){var n,d;for(n=0;n<e.length;n++)d=e[n],t.push(r.normalizeFile(d,i)),d.dirs.length&&a(d.dirs,d.hash)};return a([e]),t},this.normalizeFile=function(e,r,t){var a=e.mime||"directory",i="directory"!=a||e.linkTo?e.size:0,d=e.date?Date.parse(n(e.date)):void 0,s={url:e.url,hash:e.hash,phash:r,name:e.name,mime:a,ts:e.ts,size:i,read:e.read,write:e.write,locked:!r||void 0!==e.rm&&!e.rm};return s.ts||(d&&!isNaN(d)?s.ts=Math.floor(d/1e3):s.date=e.date||this.fm.formatDate(e)),"application/x-empty"!=e.mime&&"inode/x-empty"!=e.mime||(s.mime="text/plain"),e.linkTo&&(s.alias=e.linkTo),e.linkTo&&(s.linkTo=e.linkTo),e.tmb?s.tmb=e.tmb:0===s.mime.indexOf("image/")&&t&&(s.tmb=1),e.dirs&&e.dirs.length&&(s.dirs=!0),e.dim&&(s.dim=e.dim),e.resize&&(s.resize=e.resize),s},this.normalizeOptions=function(e){var r={path:e.cwd.rel,disabled:$.merge(e.disabled||[],["search","netmount","zipdl"]),tmb:!!e.tmb,copyOverwrite:!0};return e.params&&(r.api=1,r.url=e.params.url,r.archivers={create:e.params.archives||[],extract:e.params.extract||[]}),r.path.indexOf("/")!==-1?r.separator="/":r.path.indexOf("\\")!==-1&&(r.separator="\\"),r}};
//# sourceMappingURL=elFinderSupportVer1.min.js.map