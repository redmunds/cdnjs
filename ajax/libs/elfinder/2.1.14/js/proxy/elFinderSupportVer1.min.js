"use strict";window.elFinderSupportVer1=function(e){var r=this;this.upload=e||"auto",this.init=function(e){this.fm=e,this.fm.parseUploadData=function(e){var a;if(!$.trim(e))return{error:["errResponse","errDataEmpty"]};try{a=$.parseJSON(e)}catch(t){return{error:["errResponse","errDataNotJSON"]}}return r.normalize("upload",a)}},this.send=function(e){var r,a,t=this,i=this.fm,n=$.Deferred(),d=e.data.cmd,s={};switch(n.abort=function(){"pending"==a.state()&&(a.quiet=!0,a.abort())},d){case"open":e.data.tree=1;break;case"parents":case"tree":return n.resolve({tree:[]});case"get":e.data.cmd="read",e.data.current=i.file(e.data.target).phash;break;case"put":e.data.cmd="edit",e.data.current=i.file(e.data.target).phash;break;case"archive":case"rm":e.data.current=i.file(e.data.targets[0]).phash;break;case"extract":case"rename":case"resize":e.data.current=i.file(e.data.target).phash;break;case"duplicate":return s=$.extend(!0,{},e),$.each(e.data.targets,function(e,r){$.ajax($.extend(s,{data:{cmd:"duplicate",target:r,current:i.file(r).phash}})).error(function(e){i.error(i.res("error","connect"))}).done(function(e){e=t.normalize("duplicate",e),e.error?i.error(e.error):e.added&&i.trigger("add",{added:e.added})})}),n.resolve({});case"mkdir":case"mkfile":e.data.current=e.data.target;break;case"paste":e.data.current=e.data.dst;break;case"size":return n.resolve({error:i.res("error","cmdsupport")});case"search":return n.resolve({error:i.res("error","cmdsupport")});case"file":e.data.cmd="open",e.data.current=i.file(e.data.target).phash}return a=$.ajax(e).fail(function(e){n.reject(e)}).done(function(a){r=t.normalize(d,a),"paste"==d&&(r.error||r.added.length||r.removed.length||r.changed.length||(r.error=[e.data.cut?"errMove":"errCopy",i.i18n("items"),"errExists",i.file(e.data.targets[0]).name]),r.error||i.sync()),n.resolve(r)}),n},this.normalize=function(e,r){var a,t,i,n,d=this,s=this.fm,o={},c=function(e){return e&&e.hash&&e.name&&e.mime?e:null},m=function(e){return $.map(e,function(e){return e&&e.mime&&"directory"===e.mime?e:null})},h=function(e){var r=m(e);if(n=s.diff(r,null,["date"]),n.added.length&&(n.added=m(n.added)),n.changed.length&&(n.changed=m(n.changed)),n.removed.length){var a=[];$.each(n.removed,function(e,r){var t;(t=s.file(r))&&"directory"===t.mime&&a.push(r)}),n.removed=a}return n};return"tmb"==e||"get"==e?r:("upload"==e&&r.error&&r.cwd&&(r.warning=$.extend({},r.error),r.error=!1),r.error?r:"put"==e?(a=s.file(r.target.hash).phash,{changed:[this.normalizeFile(r.target,a)]}):(a=r.cwd.hash,i=a==s.cwd().hash,r.tree&&$.each(this.normalizeTree(r.tree),function(e,r){o[r.hash]=r}),$.each(r.cdc||[],function(e,t){var i=t.hash;o[i]?(o[i].date=t.date,o[i].locked=t.hash==a?!0:void 0===t.rm?!1:!t.rm):o[i]=d.normalizeFile(t,a,r.tmb)}),r.tree||$.each(s.files(),function(e,r){o[e]||r.phash==a||"directory"!=r.mime||(o[e]=r)}),"open"==e?{cwd:o[a]||this.normalizeFile(r.cwd),files:$.map(o,function(e){return e}),options:d.normalizeOptions(r),init:!!r.params,debug:r.debug}:(t=i?s.diff($.map(o,c)):r.tree?h(o):{added:[],removed:[],changed:[]},$.extend({current:r.cwd.hash,error:r.error,warning:r.warning,options:{tmb:!!r.tmb}},t))))},this.normalizeTree=function(e){var r=this,a=[],t=function(e,i){var n,d;for(n=0;n<e.length;n++)d=e[n],a.push(r.normalizeFile(d,i)),d.dirs.length&&t(d.dirs,d.hash)};return t([e]),a},this.normalizeFile=function(e,r,a){var t=e.mime||"directory",i="directory"!=t||e.linkTo?e.size:0,n={url:e.url,hash:e.hash,phash:r,name:e.name,mime:t,date:e.date||this.fm.formatDate(e),size:i,read:e.read,write:e.write,locked:r?void 0===e.rm?!1:!e.rm:!0};return"application/x-empty"!=e.mime&&"inode/x-empty"!=e.mime||(n.mime="text/plain"),e.linkTo&&(n.alias=e.linkTo),e.linkTo&&(n.linkTo=e.linkTo),e.tmb?n.tmb=e.tmb:0===n.mime.indexOf("image/")&&a&&(n.tmb=1),e.dirs&&e.dirs.length&&(n.dirs=!0),e.dim&&(n.dim=e.dim),e.resize&&(n.resize=e.resize),n},this.normalizeOptions=function(e){var r={path:e.cwd.rel,disabled:$.merge(e.disabled||[],["search","netmount","zipdl"]),tmb:!!e.tmb,copyOverwrite:!0};return e.params&&(r.api=1,r.url=e.params.url,r.archivers={create:e.params.archives||[],extract:e.params.extract||[]}),-1!==r.path.indexOf("/")?r.separator="/":-1!==r.path.indexOf("\\")&&(r.separator="\\"),r}};
//# sourceMappingURL=elFinderSupportVer1.min.js.map