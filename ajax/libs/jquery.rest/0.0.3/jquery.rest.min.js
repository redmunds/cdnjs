/*! jQuery REST Client - v0.0.2 - 2013-01-19
* https://github.com/jpillora/jquery.rest
* Copyright (c) 2013 Jaime Pillora; Licensed MIT */
(function(){"use strict";var e,t,n,r,i,s,o,u,a;s=function(e){throw"ERROR: jquery.rest: "+e},u=function(e){var t;t="",e*=2;while(e-->0)t+=" ";return t},i=function(e){return window.btoa||s("You need a polyfill for 'btoa' to use basic auth."),window.btoa(e)},a=function(e){return window.JSON||s("You need a polyfill for 'JSON' to use stringify."),window.JSON.stringify(e)},o=function(e,t){var n;return n=function(){},n.prototype=e,$.extend(!0,new n,t)},r={url:"",cache:0,cachableTypes:["GET"],stringifyData:!1,password:null,username:null,verbs:{create:"POST",read:"GET",update:"PUT","delete":"DELETE"},ajax:{dataType:"json"}},e=function(){function e(e){this.parent=e,this.c={}}return e.prototype.valid=function(e){var t;return t=(new Date).getTime()-e.getTime(),t<=this.parent.opts.cache*1e3},e.prototype.key=function(e){return a(e)},e.prototype.get=function(e){var t;t=this.c[e];if(!t)return;if(this.valid(t.entry))return t.data},e.prototype.put=function(e,t){return this.c[e]={entry:new Date,data:t}},e.prototype.clear=function(e){var t=this;return e?$.each(this.c,function(n,r){if(n.match(e))return delete t.c[n]}):this.c={}},e}(),n=function(){function e(e){var t;this.name=e.name,t=e.type,this.parent=e.parent,this.url=e.url,this.name||s("name required"),t||s("type required"),this.parent||s("parent required"),this.parent[this.name]&&s("Cannot add Verb: '"+name+"' already exists"),this.type=t.toUpperCase(),this.opts=o(this.parent.opts,e),this.root=this.parent.root,this.custom=!r.verbs[this.name],this.call=$.proxy(this.call,this),this.call.instance=this}return e.prototype.call=function(){var e;return e=this.parent.extractUrlData(this.type,arguments),this.custom&&(e.url+=this.url||this.name),this.parent.ajax.call(this,this.type,e.url,e.data)},e.prototype.show=function(e){return console.log(u(e)+this.name+": "+this.type)},e}(),t=function(){function t(e){e==null&&(e={}),e.parent?this.constructChild(e):this.constructRoot(e)}return t.prototype.constructRoot=function(t){return t==null&&(t={}),"string"===$.type(t)&&(this.url=t,t={}),this.opts=o(r,t),this.url||(this.url=this.opts.url),this.urlNoId=this.url,this.cache=new e(this),this.numParents=0,this.root=this,this.name=t.name||"ROOT"},t.prototype.constructChild=function(e){this.parent=e.parent,this.name=e.name,this.parent instanceof t||this.error("Invalid parent"),this.name||this.error("name required"),this.parent[this.name]&&this.error("'"+name+"' already exists"),this.root=this.parent.root,this.opts=o(this.parent.opts,e),this.numParents=this.parent.numParents+1,this.urlNoId=this.parent.url+(""+(e.url||this.name)+"/"),this.url=this.urlNoId+(":ID_"+this.numParents+"/"),$.each(this.opts.verbs,$.proxy(this.addVerb,this));if(this["delete"])return this.del=this["delete"]},t.prototype.add=function(e){return"string"===$.type(e)&&(e={name:e}),$.isPlainObject(e)||s("Invalid data. Must be an object or string."),e.parent=this,this[e.name]=new t(e)},t.prototype.addVerb=function(e,t){if(t===null)return;return"string"===$.type(e)&&(e={name:e}),$.isPlainObject(e)||s("Invalid data. Must be an object or string."),t&&(e.type=t),e.parent=this,this[e.name]=(new n(e)).call},t.prototype.error=function(e){return s("Cannot add Resource: "+e)},t.prototype.show=function(e){var r=this;return e==null&&(e=0),e>15&&s("Recurrsion Fail"),this.name&&console.log(u(e)+this.name+": "+this.url),$.each(this,function(t,r){if(r.instance instanceof n&&t!=="del")return r.instance.show(e+1)}),$.each(this,function(n,r){if(n!=="parent"&&n!=="root"&&r instanceof t)return r.show(e+1)}),null},t.prototype.toString=function(){return this.name},t.prototype.extractUrlData=function(e,t){var n,r,i,o,u,a,f,l,c,h,p,d,v,m,g;f=[],o=null;for(d=0,m=t.length;d<m;d++)n=t[d],h=$.type(n),h==="string"||h==="number"?f.push(n):$.isPlainObject(n)&&o===null?o=n:s("Invalid parameter: "+n+" ("+h+")."+" Must be strings or ints (IDs) followed by one optional plain object (data).");c=f.length,r=e!=="create",i=e!=="update"&&e!=="delete",p=null,r&&c===this.numParents&&(p=this.url),i&&c===this.numParents-1&&(p=this.urlNoId),p===null&&(i&&(l=this.numParents-1),r&&(l=(l?l+" or ":"")+this.numParents),s("Invalid number of ID parameters, required "+l+", provided "+c));for(u=v=0,g=f.length;v<g;u=++v)a=f[u],p=p.replace(new RegExp("/:ID_"+(u+1)+"/"),"/"+a+"/");return{url:p,data:o}},t.prototype.ajax=function(e,t,n,r){var o,u,f,l,c,h=this;r==null&&(r={}),e||s("type missing"),t||s("url missing"),this.opts.username&&this.opts.password&&(u=i(this.opts.username+":"+this.opts.password),r.Authorization="Basic "+u),n&&this.opts.stringifyData&&(n=a(n)),o={url:t,type:e,headers:r},n&&(o.data=n),o=$.extend(!0,{},this.opts.ajax,o),c=this.opts.cache&&$.inArray(e,this.opts.cachableTypes)>=0;if(c){f=this.root.cache.key(o),l=this.root.cache.get(f);if(l)return l}return l=$.ajax(o),c&&l.complete(function(){return h.root.cache.put(f,l)}),l},t}(),t.defaults=r,$.RestClient=t}).call(this);