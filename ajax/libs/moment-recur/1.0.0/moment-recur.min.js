!function(t,e){"object"==typeof exports?module.exports=e(require("moment")):"function"==typeof define&&define.amd?define("moment-recur",["moment"],e):t.moment=e(t.moment)}(this,function(t){var e;if(e="undefined"!=typeof module&&null!==module&&null!=module.exports,"undefined"==typeof t)throw Error("Can't find moment");var r=function(){function t(t,e){for(var r in t)if(t.hasOwnProperty(r)&&parseInt(r,10)<=0)throw Error("Intervals must be greater than zero");return{measure:e.toLowerCase(),units:t}}function e(t,e,r,n){var s=r.diff(n,t,!0);for(var i in e)if(e.hasOwnProperty(i)&&(i=parseInt(i,10),s%i===0))return!0;return!1}return{create:t,match:e}}(),n=function(){function e(t,e,r){r.forEach(function(r){if(r<t||r>e)throw Error("Value should be in range "+t+" to "+e)})}function r(e,r){var n,s,i,a={};for(n in e)e.hasOwnProperty(n)&&(s=parseInt(n,10),isNaN(s)&&(s=n),i=t().set(r,s).get(r),a[i]=e[n]);return a}function n(t,n){var s=[];"daysOfWeek"===n&&(t=r(t,"days")),"monthsOfYear"===n&&(t=r(t,"months"));for(var i in t)hasOwnProperty.call(t,i)&&s.push(i);return e(a[n].low,a[n].high,s),{measure:n,units:t}}function s(t,e,r){var n=i[t],s=r[n]();return!!e[s]}var i={daysOfMonth:"date",daysOfWeek:"day",weeksOfMonth:"monthWeek",weeksOfYear:"weeks",monthsOfYear:"months"},a={daysOfMonth:{low:1,high:31},daysOfWeek:{low:0,high:6},weeksOfMonth:{low:0,high:4},weeksOfYear:{low:0,high:52},monthsOfYear:{low:0,high:11}};return{create:n,match:s}}(),s=function(){function e(){var t,e=l[this.measure];if(!(this instanceof d))throw Error("Private method trigger() was called directly or not called as instance of Recur!");if("undefined"==typeof this.units||null===this.units||!this.measure)return this;if("calendar"!==e&&"interval"!==e)throw Error("Invlid measure provided: "+this.measure);if("interval"===e){if(!this.start)throw Error("Must have a start date set to set an interval!");t=r.create(this.units,this.measure)}"calendar"===e&&(t=n.create(this.units,this.measure)),this.units=null,this.measure=null;for(var s=0;s<this.rules.length;s++)this.rules[s].measure===t.measure&&this.rules.splice(s,1);return this.rules.push(t),this}function s(t,e,r){var n,s,i=[];if(!(this instanceof d))throw Error("Private method trigger() was called directly or not called as instance of Recur!");if(!this.start&&!this.from)throw Error("Cannot get occurances without start or from date.");for(n=(this.from||this.start).clone();i.length<t;)"next"===r?n.add(1,"day"):n.subtract(1,"day"),console.log("Match: "+n.format("L")+" - "+this.matches(n,!0)),this.matches(n,!0)&&(s=e?n.format(e):n.clone(),i.push(s));return i}function i(t,e,r){return(!t||!r.isBefore(t))&&(!e||!r.isAfter(e))}function a(t){var e={};if("[object Array]"==toString.call(t))t.forEach(function(t){e[t]=!0});else if(t===Object(t))e=t;else{if("[object Number]"!=toString.call(t)&&"[object String]"!=toString.call(t))throw Error("Provide an array, object, string or number when passing units!");e[t]=!0}return e}function o(e,r){for(var n=0,s=e.length;n<s;n++)if(t(e[n]).isSame(r))return!0;return!1}function u(t){switch(t){case"day":return"days";case"week":return"weeks";case"month":return"months";case"year":return"years";case"dayOfWeek":return"daysOfWeek";case"dayOfMonth":return"daysOfMonth";case"weekOfMonth":return"weeksOfMonth";case"weekOfYear":return"weeksOfYear";case"monthOfYear":return"monthsOfYear";default:return t}}function h(t,e,s){var i,a,o,u;for(i=0,a=t.length;i<a;i++)if(o=t[i],u=l[o.measure],"interval"===u){if(!r.match(o.measure,o.units,s,e))return!1}else{if("calendar"!==u)return!1;if(!n.match(o.measure,o.units,e))return!1}return!0}function f(t){return function(e){return this.every.call(this,e,t),this}}var l={days:"interval",weeks:"interval",months:"interval",years:"interval",daysOfWeek:"calendar",daysOfMonth:"calendar",weeksOfMonth:"calendar",weeksOfYear:"calendar",monthsOfYear:"calendar"},c={days:"day",weeks:"week",months:"month",years:"year",daysOfWeek:"dayOfWeek",daysOfMonth:"dayOfMonth",weeksOfMonth:"weekOfMonth",weeksOfYear:"weekOfYear",monthsOfYear:"monthOfYear"},d=function(e){return e.start&&(this.start=t(e.start).dateOnly()),e.end&&(this.end=t(e.end).dateOnly()),this.rules=e.rules||[],this.exceptions=e.exceptions||[],this.units=null,this.measure=null,this.from=null,this};d.prototype.startDate=function(e){return null===e?(this.start=null,this):e?(this.start=t(e).dateOnly(),this):this.start},d.prototype.endDate=function(e){return null===e?(this.end=null,this):e?(this.end=t(e).dateOnly(),this):this.end},d.prototype.fromDate=function(e){return null===e?(this.from=null,this):e?(this.from=t(e).dateOnly(),this):this.from},d.prototype.save=function(){var e={};this.start&&t(this.start).isValid()&&(e.start=this.start.format("L")),this.end&&t(this.end).isValid()&&(e.end=this.end.format("L")),e.exceptions=[];for(var r=0,n=this.exceptions.length;r<n;r++)e.exceptions.push(this.exceptions[r].format("L"));return e.rules=this.rules,e},d.prototype.repeats=function(){return this.rules.length>0},d.prototype.every=function(t,r){return"undefined"!=typeof t&&null!==t&&(this.units=a(t)),"undefined"!=typeof r&&null!==r&&(this.measure=u(r)),e.call(this)},d.prototype.except=function(e){return e=t(e).dateOnly(),this.exceptions.push(e),this},d.prototype.forget=function(e){var r,n,s=t(e);if(s.isValid()){for(r=0,n=this.exceptions.length;r<n;r++)if(s.isSame(this.exceptions[r]))return this.exceptions.splice(r,1),this;return this}for(r=0,n=this.rules.length;r<n;r++)this.rules[r].measure===u(e)&&this.rules.splice(r,1)},d.prototype.matches=function(e,r){var n=t(e).dateOnly();if(!n.isValid())throw Error("Invalid date supplied to match method: "+e);return!(!r&&!i(this.start,this.end,n))&&(!o(this.exceptions,n)&&!!h(this.rules,n,this.start))},d.prototype.next=function(t,e){return s.call(this,t,e,"next")},d.prototype.previous=function(t,e){return s.call(this,t,e,"previous")};for(var m in c)l.hasOwnProperty(m)&&(d.prototype[m]=d.prototype[c[m]]=f(m));return d}();return t.recur=function(t,e){return new s(t===Object(t)?t:{start:t,end:e})},t.fn.recur=function(t,e){return t===Object(t)?("undefined"==typeof t.start&&(t.start=this),new s(t)):(e||(e=t,t=void 0),t||(t=this),new s({start:t,end:e,moment:this}))},t.fn.monthWeek=function(){var t=this.clone().startOf("month").startOf("week"),e=this.clone().startOf("week");return e.diff(t,"weeks")},t.fn.dateOnly=function(){return this.hours(0).minutes(0).seconds(0).milliseconds(0)},t});