!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vl=e()}}(function(){var e;return function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return a(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var s="boolean"==typeof t.cycles&&t.cycles,u=t.replacer||function(e,t){return t},l=t.cmp&&function(e){return function(t){return function(n,r){var a={key:n,value:t[n]},i={key:r,value:t[r]};return e(a,i)}}}(t.cmp),c=[];return function e(t,f,d,p){var m=n?"\n"+new Array(p+1).join(n):"",g=n?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),d=u.call(t,f,d),void 0!==d){if("object"!==("undefined"==typeof d?"undefined":r(d))||null===d)return a.stringify(d);if(i(d)){for(var h=[],v=0;v<d.length;v++){var y=e(d,v,d[v],p+1)||a.stringify(null);h.push(m+n+y)}return"["+h.join(",")+m+"]"}if(c.indexOf(d)!==-1){if(s)return a.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}c.push(d);for(var b=o(d).sort(l&&l(d)),h=[],v=0;v<b.length;v++){var f=b[v],S=e(d,f,d[f],p+1);if(S){var E=a.stringify(f)+g+S;h.push(m+n+E)}}return c.splice(c.indexOf(d),1),"{"+h.join(",")+m+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:2}],2:[function(e,t,n){"use strict";n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){"use strict";var r,a,i,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},l=function(e){throw{name:"SyntaxError",message:e,at:r,text:i}},c=function(e){return e&&e!==a&&l("Expected '"+e+"' instead of '"+a+"'"),a=i.charAt(r),r+=1,a},f=function e(){var e,t="";for("-"===a&&(t="-",c("-"));a>="0"&&a<="9";)t+=a,c();if("."===a)for(t+=".";c()&&a>="0"&&a<="9";)t+=a;if("e"===a||"E"===a)for(t+=a,c(),"-"!==a&&"+"!==a||(t+=a,c());a>="0"&&a<="9";)t+=a,c();return e=+t,isFinite(e)?e:void l("Bad number")},d=function e(){var t,n,r,e="";if('"'===a)for(;c();){if('"'===a)return c(),e;if("\\"===a)if(c(),"u"===a){for(r=0,n=0;n<4&&(t=parseInt(c(),16),isFinite(t));n+=1)r=16*r+t;e+=String.fromCharCode(r)}else{if("string"!=typeof u[a])break;e+=u[a]}else e+=a}l("Bad string")},p=function(){for(;a&&a<=" ";)c()},m=function(){switch(a){case"t":return c("t"),c("r"),c("u"),c("e"),!0;case"f":return c("f"),c("a"),c("l"),c("s"),c("e"),!1;case"n":return c("n"),c("u"),c("l"),c("l"),null}l("Unexpected '"+a+"'")},g=function e(){var e=[];if("["===a){if(c("["),p(),"]"===a)return c("]"),e;for(;a;){if(e.push(o()),p(),"]"===a)return c("]"),e;c(","),p()}}l("Bad array")},h=function e(){var t,e={};if("{"===a){if(c("{"),p(),"}"===a)return c("}"),e;for(;a;){if(t=d(),p(),c(":"),Object.hasOwnProperty.call(e,t)&&l('Duplicate key "'+t+'"'),e[t]=o(),p(),"}"===a)return c("}"),e;c(","),p()}}l("Bad object")};o=function(){switch(p(),a){case"{":return h();case"[":return g();case'"':return d();case"-":return f();default:return a>="0"&&a<="9"?f():m()}},t.exports=function(e,t){var n;return i=e,r=0,a=" ",n=o(),p(),a&&l("Syntax error"),"function"==typeof t?function e(n,r){var a,i,o=n[r];if(o&&"object"===("undefined"==typeof o?"undefined":s(o)))for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(i=e(o,a),void 0!==i?o[a]=i:delete o[a]);return t.call(n,r,o)}({"":n},""):n}},{}],4:[function(e,t,n){"use strict";function r(e){return l.lastIndex=0,l.test(e)?'"'+e.replace(l,function(e){var t=c[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function a(e,t){var n,l,c,f,d,p=i,m=t[e];switch(m&&"object"===("undefined"==typeof m?"undefined":u(m))&&"function"==typeof m.toJSON&&(m=m.toJSON(e)),"function"==typeof s&&(m=s.call(t,e,m)),"undefined"==typeof m?"undefined":u(m)){case"string":return r(m);case"number":return isFinite(m)?String(m):"null";case"boolean":case"null":return String(m);case"object":if(!m)return"null";if(i+=o,d=[],"[object Array]"===Object.prototype.toString.apply(m)){for(f=m.length,n=0;n<f;n+=1)d[n]=a(n,m)||"null";return c=0===d.length?"[]":i?"[\n"+i+d.join(",\n"+i)+"\n"+p+"]":"["+d.join(",")+"]",i=p,c}if(s&&"object"===("undefined"==typeof s?"undefined":u(s)))for(f=s.length,n=0;n<f;n+=1)l=s[n],"string"==typeof l&&(c=a(l,m),c&&d.push(r(l)+(i?": ":":")+c));else for(l in m)Object.prototype.hasOwnProperty.call(m,l)&&(c=a(l,m),c&&d.push(r(l)+(i?": ":":")+c));return c=0===d.length?"{}":i?"{\n"+i+d.join(",\n"+i)+"\n"+p+"}":"{"+d.join(",")+"}",i=p,c}}var i,o,s,u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(i="",o="","number"==typeof n)for(r=0;r<n;r+=1)o+=" ";else"string"==typeof n&&(o=n);if(s=t,t&&"function"!=typeof t&&("object"!==("undefined"==typeof t?"undefined":u(t))||"number"!=typeof t.length))throw new Error("JSON.stringify");return a("",{"":e})}},{}],5:[function(t,n,r){(function(t){"use strict";var r,a,i,o,s,u,l,c,f,d,p,m,g,h,v,y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(r){function a(e,t){return function(n,r){return e[n]=t?t(n,r):r}}var i="object"===("undefined"==typeof t?"undefined":y(t))?t:"object"===("undefined"==typeof self?"undefined":y(self))?self:"object"===y(this)?this:{};"function"==typeof e&&e.amd?e("tslib",["exports"],function(e){r(a(i,a(e)))}):r("object"===("undefined"==typeof n?"undefined":y(n))&&"object"===y(n.exports)?a(i,a(n.exports)):a(i))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};r=function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&(n[r[a]]=e[r[a]]);return n},o=function(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":y(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},s=function(e,t){return function(n,r){t(n,r,e)}},u=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":y(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})},c=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,i=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=t.call(e,u)}catch(e){n=[6,e],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},f=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},d=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},p=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,a,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(a)throw a.error}}return o},m=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},g=function(e,t,n){function r(e){return function(t){return new Promise(function(n,r){m.push([e,t,n,r]),a()})}}function a(){!f&&m.length&&i((f=m.shift())[0],f[1])}function i(e,t){try{o(p[e](t))}catch(e){c(f[3],e)}}function o(e){e.done?c(f[2],e):"yield"===e.value[0]?c(f[2],{value:e.value[1],done:!1}):Promise.resolve(e.value[1]).then("delegate"===e.value[0]?s:u,l)}function s(e){o(e.done?e:{value:["yield",e.value],done:!1})}function u(e){i("next",e)}function l(e){i("throw",e)}function c(e,t){f=void 0,e(t),a()}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var f,d,p=n.apply(e,t||[]),m=[];return d={next:r("next"),throw:r("throw"),return:r("return")},d[Symbol.asyncIterator]=function(){return this},d},h=function(e){function t(t,n){return function(r){return{value:["delegate",(e[t]||n).call(e,r)],done:!1}}}var n={next:t("next"),throw:t("throw",function(e){throw e}),return:t("return",function(e){return{value:e,done:!0}})};return e=v(e),n[Symbol.iterator]=function(){return this},n},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof d?d(e):e[Symbol.iterator]()},e("__extends",r),e("__assign",a),e("__rest",i),e("__decorate",o),e("__param",s),e("__metadata",u),e("__awaiter",l),e("__generator",c),e("__exportStar",f),e("__values",d),e("__read",p),e("__spread",m),e("__asyncGenerator",g),e("__asyncDelegator",h),e("__asyncValues",v)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){"use strict";function r(e,t,n,r,a){for(var i,o=0,s=e.length;t<s;++t){if(i=e[t],!o&&i===n)return t;a&&a.indexOf(i)>=0?--o:r&&r.indexOf(i)>=0&&++o}return t}function a(e){for(var t=[],n=0,a=e.length,i=0;i<a;)i=r(e,i,v,d+m,p+g),t.push(e.substring(n,i).trim()),n=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function i(e){return"["===e[0]?o(e):s(e)}function o(e){var t,n,o=1,s=e.length,u=1;if(u=r(e,u,p,d,p),u===s)throw"Empty between selector: "+e;if(t=a(e.substring(o,u)),2!==t.length)throw"Between selector must have two elements: "+e;if(e=e.slice(u+1).trim(),e[0]!==b)throw"Expected '>' after between selector: "+e;return t=t.map(i),n=i(e.slice(1).trim()),n.between?{between:t,stream:n}:(n.between=t,n)}function s(e){var t,n,a={source:l},i=[],o=[0,0],s=0,f=0,v=e.length,b=0;if(e[v-1]===g){if(b=e.lastIndexOf(m),!(b>=0))throw"Unmatched right brace: "+e;try{o=u(e.substring(b+1,v-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,b).trim(),v=e.length,b=0}if(!v)throw e;if(e[0]===y&&(s=++b),t=r(e,b,h),t<v&&(i.push(e.substring(f,t).trim()),f=b=++t),b=r(e,b,d),b===v)i.push(e.substring(f,v).trim());else if(i.push(e.substring(f,b).trim()),n=[],f=++b,f===v)throw"Unmatched left bracket: "+e;for(;b<v;){if(b=r(e,b,p),b===v)throw"Unmatched left bracket: "+e;if(n.push(e.substring(f,b).trim()),b<v-1&&e[++b]!==d)throw"Expected left bracket: "+e;f=++b}if(!(v=i.length)||S.test(i[v-1]))throw"Invalid event selector: "+e;return v>1?(a.type=i[1],s?a.markname=i[0].slice(1):(0,c.isMarkType)(i[0])?a.marktype=i[0]:a.source=i[0]):a.type=i[0],"!"===a.type.slice(-1)&&(a.consume=!0,a.type=a.type.slice(0,-1)),null!=n&&(a.filter=n),o[0]&&(a.throttle=o[0]),o[1]&&(a.debounce=o[1]),a}function u(e){var t=e.split(v);if(!e.length||t.length>2)throw e;return t.map(function(t){var n=+t;if(n!==n)throw e;return n})}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t){return l=t||f,a(e.trim()).map(i)};var l,c=e("./marks/marktypes"),f="view",d="[",p="]",m="{",g="}",h=":",v=",",y="@",b=">",S=/[\[\]\{\}]/},{"./marks/marktypes":7}],7:[function(e,t,n){"use strict";function r(e){return i.hasOwnProperty(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.marktypes=n.TextMark=n.SymbolMark=n.ShapeMark=n.RuleMark=n.RectMark=n.PathMark=n.LineMark=n.ImageMark=n.GroupMark=n.AreaMark=n.ArcMark=void 0,n.isMarkType=r;var a=e("vega-util"),i=(n.ArcMark="arc",n.AreaMark="area",n.GroupMark="group",n.ImageMark="image",n.LineMark="line",n.PathMark="path",n.RectMark="rect",n.RuleMark="rule",n.ShapeMark="shape",n.SymbolMark="symbol",n.TextMark="text",n.marktypes=(0,a.toSet)(["*","arc","area","group","image","line","path","rect","rule","shape","symbol","text"]))},{"vega-util":8}],8:[function(t,n,r){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(t,i){"object"===("undefined"==typeof r?"undefined":a(r))&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(void 0,function(e){function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return u(e)?"["+e.map(r)+"]":l(e)||c(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function a(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var i=function(e,t,n){return e.fields=t||[],e.fname=n,e},o=function(e){throw Error(e)},s=function(e){function t(){i.push(c+e.substring(n,r)),c="",n=r+1}var n,r,a,i=[],s=null,u=0,l=e.length,c="";for(e+="",n=r=0;r<l;++r)if(a=e[r],"\\"===a)c+=e.substring(n,r),n=++r;else if(a===s)t(),s=null,u=-1;else{if(s)continue;n===u&&'"'===a?(n=r+1,s=a):n===u&&"'"===a?(n=r+1,s=a):"."!==a||u?"["===a?(r>n&&t(),u=n=r+1):"]"===a&&(u||o("Access path missing open bracket: "+e),u>0&&t(),u=0,n=r+1):r>n?t():n=r+1}return u&&o("Access path missing closing bracket: "+e),s&&o("Access path missing closing quote: "+e),r>n&&(++r,t()),i},u=Array.isArray,l=function(e){return e===Object(e)},c=function(e){return"string"==typeof e},f=function(e,t){var n=s(e),a="return _["+n.map(r).join("][")+"];";return i(Function("_",a),[e=1===n.length?n[0]:e],t||e)},d=[],p=f("id"),m=i(function(e){return e},d,"identity"),g=i(function(){return 0},d,"zero"),h=i(function(){return 1},d,"one"),v=i(function(){return!0},d,"true"),y=i(function(){return!1},d,"false"),b=0,S=1,E=2,O=3,_=function(e){var t=e||b;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=S&&a("warn","WARN",arguments),this},info:function(){return t>=E&&a("log","INFO",arguments),this},debug:function(){return t>=O&&a("log","DEBUG",arguments),this}}},N=function(e){return null!=e?u(e)?e:[e]:[]},x=function(e,t){var n,a,o,u,l,c,f,d,p=[],m=(e=N(e)).map(function(e,t){return null==e?null:(p.push(t),s(e).map(r).join("]["))}),g=p.length-1,h=N(t),v="var u,v;return ";if(g<0)return null;for(a=0;a<=g;++a)n=p[a],o=m[n],u="(u=a["+o+"])",l="(v=b["+o+"])",c="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",f="descending"!==h[n]?(d=1,-1):(d=-1,1),v+="("+u+"<"+l+"||u==null)&&v!=null?"+f+":(u>v||v==null)&&u!=null?"+d+":"+c+"!==u&&v===v?"+f+":v!==v&&u===u?"+d+(n<g?":":":0");return i(Function("a","b",v+";"),e.filter(function(e){return null!=e}))},T=function(e){return"function"==typeof e},A=function(e){return T(e)?e:function(){return e}},k=function(e){for(var t,n,r=1,a=arguments.length;r<a;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},M=function(e,t){var n,r,a,i,o,s=-1,u=e.length;if(null==t){for(;++s<u;)if(null!=(r=e[s])&&r>=r){n=a=r;break}for(i=o=s;++s<u;)null!=(r=e[s])&&(n>r&&(n=r,i=s),a<r&&(a=r,o=s))}else{for(;++s<u;)if(null!=(r=t(e[s],s,e))&&r>=r){n=a=r;break}for(i=o=s;++s<u;)null!=(r=t(e[s],s,e))&&(n>r&&(n=r,i=s),a<r&&(a=r,o=s))}return[i,o]},D={},R=function(e){function t(e){return a.hasOwnProperty(e)&&a[e]!==D}var n,r,a={};return n={size:0,empty:0,object:a,has:t,get:function(e){return t(e)?a[e]:void 0},set:function(e,r){return t(e)||(++n.size,a[e]===D&&--n.empty),a[e]=r,this},delete:function(e){return t(e)&&(--n.size,++n.empty,a[e]=D),this},clear:function(){n.size=n.empty=0,n.object=a={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,i={},o=0;for(e in a)t=a[e],t===D||r&&r(t)||(i[e]=t,++o);n.size=o,n.empty=0,n.object=a=i}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},L=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},I=function(e){return"number"==typeof e},P=function(e){e=e?N(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+s(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return i(t,e,"key")},w=function(e,t,n,r){var a=t.length,i=n.length;if(!i)return t;if(!a)return n;for(var o=r||new t.constructor(a+i),s=0,u=0,l=0;s<a&&u<i;++l)o[l]=e(t[s],n[u])>0?n[u++]:t[s++];for(;s<a;++s,++l)o[l]=t[s];for(;u<i;++u,++l)o[l]=n[u];return o},C=function(e,t){for(var n="";--t>=0;)n+=e;return n},U=function(e,t,n,r){var a=n||" ",i=e+"",o=t-i.length;return o<=0?i:"left"===r?C(a,o)+i:"center"===r?C(a,~~(o/2))+i+C(a,Math.ceil(o/2)):i+C(a,o)},F=function(e){return e[e.length-1]},j=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},H=function(e,t,n,r){var a=null!=r?r:"…",i=e+"",o=i.length,s=Math.max(0,t-a.length);return o<=t?i:"left"===n?a+i.slice(o-s):"center"===n?i.slice(0,Math.ceil(s/2))+a+i.slice(o-~~(s/2)):i.slice(0,s)+a},Y=function(e,t,n){if(e){var r,a=0,i=e.length;if(t)for(;a<i;++a)(r=t(e[a]))&&n(r,a,e);else e.forEach(n)}};e.accessor=i,e.accessorName=t,e.accessorFields=n,e.id=p,e.identity=m,e.zero=g,e.one=h,e.truthy=v,e.falsy=y,e.logger=_,e.None=b,e.Warn=S,e.Info=E,e.Debug=O,e.array=N,e.compare=x,e.constant=A,e.error=o,e.extend=k,e.extentIndex=M,e.fastmap=R,e.field=f,e.inherits=L,e.isArray=u,e.isFunction=T,e.isNumber=I,e.isObject=l,e.isString=c,e.key=P,e.merge=w,e.pad=U,e.peek=F,e.repeat=C,e.splitAccessPath=s,e.stringValue=r,e.toSet=j,e.truncate=H,e.visitArray=Y,Object.defineProperty(e,"__esModule",{value:!0})})},{}],9:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.0.0-alpha.3",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"src/vl.js",types:"src/vl.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{build:"browserify src/vl.ts -p tsify -g [ babelify ] -d -s vl | exorcist vega-lite.js.map > vega-lite.js ",postbuild:"uglifyjs vega-lite.js -cm --in-source-map vega-lite.js.map --source-map vega-lite.min.js.map > vega-lite.min.js && npm run schema","build:all":"npm run clean && npm run build && npm run test:noschema && npm run build:images","build:images":"npm run data && scripts/generate-images.sh","build:toc":"bundle exec jekyll build --incremental -q && scripts/generate-toc","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > test-gallery/main.js",checkschema:"scripts/check-schema.sh",clean:"rm -f vega-lite.* & find -E src test site -regex '.*\\.(js|js.map|d.ts)' -delete & rm -rf examples/_diff examples/_original examples/_output examples/images && rm -rf data",data:"rsync -r node_modules/vega-datasets/data/* data",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",lint:"tslint -c tslint.json 'src/**/*.ts' 'test/**/*.ts' --exclude '**/*.d.ts'",prestart:"npm run data && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",schema:"typescript-json-schema --required true --noExtraProps true src/spec.ts ExtendedSpec > vega-lite-schema.json",presite:"tsc && npm run build && npm run data && npm run build:toc && npm run build:versions",site:"bundle exec jekyll serve --incremental",pretest:"tsc && npm run data",test:"nyc --reporter=html --reporter=text-summary --require ./test/babel.ts mocha",posttest:"npm run lint && npm run test:examples","test:examples":"npm run schema && mocha --require ./test/babel.ts examples","test:noschema":"npm run pretest && nyc --reporter=html --reporter=text-summary --require ./test/babel.ts mocha && npm run lint && mocha --require ./test/babel.ts examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","test:debug":"npm run schema && mocha --debug-brk test examples","watch:build":"watchify src/vl.ts -p tsify -v -d -s vl -o 'exorcist vega-lite.js.map > vega-lite.js'","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:noschema' # already run schema in build","x-compile":"./scripts/examples-compile.sh","x-diff":"./scripts/examples-diff.sh"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^3.4.35","@types/d3":"^4.5.0","@types/json-stable-stringify":"^1.0.30","@types/mocha":"^2.2.39","@types/node":"^7.0.5",ajv:"5.0.1-beta.1","babel-preset-es2015":"^6.22.0",babelify:"^7.3.0","browser-sync":"~2.18.8",browserify:"~14.1.0",chai:"~3.5.0",cheerio:"~0.22.0",codecov:"~1.0.1",d3:"^4.6.0",exorcist:"~0.4.0",mocha:"~3.2.0",nodemon:"~1.11.0",nyc:"~10.1.2","source-map-support":"~0.4.11",tsify:"~3.0.1",tslint:"~4.5.0","tslint-eslint-rules":"^3.4.0",typescript:"^2.2.1","typescript-json-schema":"^0.9.2","uglify-js":"~2.7.5",vega:"3.0.0-beta.22","vega-datasets":"vega/vega-datasets#gh-pages","vega-embed":"3.0.0-beta.4","vega-parser":"^1.0.0-beta.33",watchify:"~3.9.0","yaml-front-matter":"~3.4.0"},dependencies:{"json-stable-stringify":"~1.0.1",tslib:"^1.6.0","vega-util":"~1.1.4",yargs:"~6.6.0"}}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"],n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"]},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultAxisConfig={labelMaxLength:25},n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"],n.VL_ONLY_AXIS_PROPERTIES=["labelMaxLength"]},{}],12:[function(e,t,n){"use strict";function r(e){switch(e){case a.ROW:case a.COLUMN:case a.SIZE:case a.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./channel");n.autoMaxBins=r},{"./channel":13}],13:[function(e,t,n){"use strict";function r(e,t){return t in a(e)}function a(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}return{}}function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.OPACITY:case n.ORDER:case n.DETAIL:return{measure:!0,dimension:!0};case n.ROW:case n.COLUMN:case n.SHAPE:return{measure:!1,dimension:!0};case n.X2:case n.Y2:case n.SIZE:case n.TEXT:return{measure:!0,dimension:!1}}throw new Error("Invalid encoding channel "+e)}function o(e){return!f.contains([n.DETAIL,n.TEXT,n.ORDER],e)}function s(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in d;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function u(e){switch(e){case n.X:case n.Y:case n.ROW:case n.COLUMN:case n.SIZE:case n.OPACITY:return"continuous";case n.SHAPE:return"discrete";case n.COLOR:return"flexible";case n.X2:case n.Y2:case n.DETAIL:case n.TEXT:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var l,c=e("./scale"),f=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail"}(l=n.Channel||(n.Channel={})),n.X=l.X,n.Y=l.Y,n.X2=l.X2,n.Y2=l.Y2,n.ROW=l.ROW,n.COLUMN=l.COLUMN,n.SHAPE=l.SHAPE,n.SIZE=l.SIZE,n.COLOR=l.COLOR,n.TEXT=l.TEXT,n.DETAIL=l.DETAIL,n.ORDER=l.ORDER,n.OPACITY=l.OPACITY,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.ROW,n.COLUMN],n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.STACK_GROUP_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=r,n.getSupportedMark=a,n.getSupportedRole=i,n.hasScale=o;var d=f.toSet(f.without(c.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=s,n.getRangeType=u},{"./scale":81,"./util":89}],14:[function(e,t,n){"use strict";function r(e,t,n,r){var u=e.fieldDef(t),l=e.axis(t),c=e.config;return o.contains([i.NOMINAL,i.ORDINAL],u.type)&&l.labelMaxLength?n=o.extend({text:{signal:"truncate(datum.value, "+l.labelMaxLength+")"}},n||{}):u.type===i.TEMPORAL&&(n=o.extend({text:{signal:s.timeFormatExpression("datum.value",u.timeUnit,l.format,c.axis.shortTimeLabels,c.timeFormat)}},n)),void 0!==l.labelAngle?n.angle={value:l.labelAngle}:t===a.X&&(o.contains([i.NOMINAL,i.ORDINAL],u.type)||u.bin||u.type===i.TEMPORAL)&&(n.angle={value:270}),n.angle&&(270===n.angle.value?n.align={value:"top"===r.orient?"left":t===a.X||t===a.COLUMN?"right":"center"}:90===n.angle.value&&(n.align={value:"center"})),n.angle&&(270===n.angle.value?n.baseline={value:t===a.X||t===a.COLUMN?"middle":"bottom"}:90===n.angle.value&&(n.baseline={value:"bottom"})),0===o.keys(n).length?void 0:n}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),i=e("../../type"),o=e("../../util"),s=e("../common");n.labels=r},{"../../channel":13,"../../type":88,"../../util":89,"../common":17}],15:[function(e,t,n){"use strict";function r(e,t){return t.reduce(function(t,n){var r=[];if(e.axis(n)){var a=u(n,e);a&&i(a)&&r.push(a);var o=s(n,e);o&&i(o)&&r.push(o),r.length>0&&(t[n]=r)}return t},{})}function a(e){return e===!1||null===e}function i(e){return m.some(g,function(t){return o(e,t)})}function o(e,t){return"grid"===t||"title"===t?!!e[t]:!a(e[t])}function s(e,t){return l(e,t,!0)}function u(e,t){return l(e,t,!1)}function l(e,t,n){var r=t.axis(e),a={scale:t.scaleName(e)};f.AXIS_PROPERTIES.forEach(function(i){var o=c(i,r,e,t,n);void 0!==o&&(a[i]=o)});var i=c("gridScale",r,e,t,n);void 0!==i&&(a.gridScale=i);var s=r.encode||{};return g.forEach(function(n){if(o(a,n)){var r;r="labels"===n?d.labels(t,e,s.labels||{},a):s[n]||{},void 0!==r&&m.keys(r).length>0&&(a.encode=a.encode||{},a.encode[n]={update:r})}}),a}function c(e,t,n,r,a){var i=r.fieldDef(n);switch(e){case"labels":return!a&&t[e];case"domain":return p.domain(e,t,a,n);case"ticks":return p.ticks(e,t,a,n);case"format":return p.format(t,n,i,r.config);case"grid":return p.grid(r,n,a);case"gridScale":return p.gridScale(r,n,a);case"orient":return p.orient(t,n);case"tickCount":return p.tickCount(t,n,i);case"title":return p.title(t,i,r.config,a);case"values":return p.values(t);case"zindex":return p.zindex(t,a)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var f=e("../../axis"),d=e("./encode"),p=e("./rules"),m=e("../../util"),g=["domain","grid","labels","ticks","title"];n.parseAxisComponent=r,n.parseGridAxis=s,n.parseMainAxis=u},{"../../axis":11,"../../util":89,"./encode":14,"./rules":16}],16:[function(e,t,n){"use strict";function r(e,t,n,r){return y.numberFormat(n,e.format,r,t)}function a(e,t){var n=e.axis(t).grid;return void 0!==n?n:!e.hasDiscreteScale(t)&&!e.fieldDef(t).bin}function i(e,t,n){if(t===m.ROW||t===m.COLUMN)return!1;if(n)return a(e,t)}function o(e,t,n){if(n){var r="x"===t?"y":"x";if(e.scale(r))return e.scaleName(r)}}function s(e,t){var n=e.orient;if(n)return n;switch(t){case m.COLUMN:return"top";case m.X:return"bottom";case m.ROW:case m.Y:return"left"}throw new Error(p.message.INVALID_CHANNEL_FOR_AXIS)}function u(e,t,n){var r=e.tickCount;return void 0!==r?r:t!==m.X||n.bin?void 0:5}function l(e,t,n,r){if(!r){if(void 0!==e.title)return e.title;var a=h.title(t,n),i=e.titleMaxLength;return i?v.truncate(a,i):a}}function c(e){var t=e.values;return e.values&&g.isDateTime(t[0])?t.map(function(e){return g.timestamp(e,!0)}):t}function f(e,t){var n=e.zindex;return void 0!==n?n:t?0:1}function d(e,t,n,r){return!n&&r!==m.ROW&&r!==m.COLUMN&&t[e]}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../log"),m=e("../../channel"),g=e("../../datetime"),h=e("../../fielddef"),v=e("../../util"),y=e("../common");n.format=r,n.gridShow=a,n.grid=i,n.gridScale=o,n.orient=s,n.tickCount=u,n.title=l,n.values=c,n.zindex=f,n.domainAndTicks=d,n.domain=d,n.ticks=d},{"../../channel":13,"../../datetime":73,"../../fielddef":76,"../../log":79,"../../util":89,"../common":17}],17:[function(e,t,n){"use strict";function r(e,t,n){if(b.isFacetSpec(e))return new g.FacetModel(e,t,n);if(b.isLayerSpec(e))return new h.LayerModel(e,t,n);if(b.isUnitSpec(e))return new y.UnitModel(e,t,n);throw new Error(c.message.INVALID_SPEC)}
function a(e,t,n){return n.forEach(function(n){var r=t[n];void 0!==r&&(e[n]={value:r})}),e}function i(e,t,n){return n.forEach(function(n){var r=o(n,t.mark(),t.config);void 0!==r&&(e[n]={value:r})}),e}function o(e,t,n){var r=n[t];return void 0!==r[e]?r[e]:n.mark[e]}function s(e,t,n,r){if(e.type===p.QUANTITATIVE&&!e.bin)return t?t:"count"===e.aggregate&&r===f.TEXT?"d":n.numberFormat}function u(e,t,n,r,a){if(!t||n){var i=n||a;return"timeFormat("+e+", '"+i+"')"}return v.formatExpression(t,e,r)}function l(e){return(m.isArray(e)?e:[e]).reduce(function(e,t){return e.field.push(d.field(t,{binSuffix:"start"})),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../log"),f=e("../channel"),d=e("../fielddef"),p=e("../type"),m=e("../util"),g=e("./facet"),h=e("./layer"),v=e("../timeunit"),y=e("./unit"),b=e("../spec");n.buildModel=r,n.applyConfig=a,n.applyMarkConfig=i,n.getMarkConfig=o,n.numberFormat=s,n.timeFormatExpression=u,n.sortParams=l},{"../channel":13,"../fielddef":76,"../log":79,"../spec":84,"../timeunit":86,"../type":88,"../util":89,"./facet":31,"./layer":32,"./unit":69}],18:[function(e,t,n){"use strict";function r(e,t){t&&u.set(t);try{var n=l.normalize(e),r=d.buildModel(n,null,"");return r.parse(),a(r)}finally{t&&u.reset()}}function a(e){var t=c.extend({$schema:"http://vega.github.io/schema/vega/v3.0.json"},i(e),{signals:[{name:"width",update:"data('layout')[0].width"},{name:"height",update:"data('layout')[0].height"}].concat(f.assembleTopLevelSignals(e))},{data:[].concat(e.assembleData([]),e.assembleLayout([]),e.assembleSelectionData([])),marks:[o(e)]});return{spec:t}}function i(e){var t=e.config;return c.extend({padding:e.padding||t.padding},{autosize:"pad"},t.viewport?{viewport:t.viewport}:{},t.background?{background:t.background}:{})}function o(e){var t=c.extend({name:e.getName("main"),type:"group"},e.description?{description:e.description}:{},{from:{data:e.getName(s.LAYOUT+"")},encode:{update:c.extend({width:{field:e.getName("width")},height:{field:e.getName("height")}},e.assembleParentGroupProperties(e.config.cell))}});return c.extend(t,e.assembleGroup())}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../data"),u=e("../log"),l=e("../spec"),c=e("../util"),f=e("./selection/selection"),d=e("./common");n.compile=r,n.topLevelBasicProperties=i,n.assembleRootGroup=o},{"../data":72,"../log":79,"../spec":84,"../util":89,"./common":17,"./selection/selection":59}],19:[function(e,t,n){"use strict";function r(e,t){return"format("+e+", '"+t+"')"}function a(e){return e.reduceFieldDef(function(t,n,a){var l=e.fieldDef(a).bin;if(l){var c=s.extend({type:"bin",field:n.field,as:[o.field(n,{binSuffix:"start"}),o.field(n,{binSuffix:"end"})]},"boolean"==typeof l?{}:l),f=[];if(!c.extent){var d=e.getName(n.field+"_extent");f.push({type:"extent",field:n.field,signal:d}),c.extent={signal:d}}c.maxbins||c.step||(c.maxbins=i.autoMaxBins(a)),f.push(c);var p=u.hasDiscreteDomain(e.scale(a).type)||e.legend(a);if(p){var m=(e.axis(a)||e.legend(a)||{}).format||e.config.numberFormat,g=o.field(n,{datum:!0,binSuffix:"start"}),h=o.field(n,{datum:!0,binSuffix:"end"});f.push({type:"formula",as:o.field(n,{binSuffix:"range"}),expr:r(g,m)+" + ' - ' + "+r(h,m)})}var v=s.hash(l)+"_"+n.field+"oc:"+p;t[v]=f}return t},{})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../bin"),o=e("../../fielddef"),s=e("../../util"),u=e("../../scale");n.bin={parseUnit:a,parseFacet:function(e){var t=a(e),n=e.child.component.data;return n.source||(s.extend(t,n.bin),delete n.bin),t},parseLayer:function(e){var t=a(e);return e.children.forEach(function(e){var n=e.component.data;n.source||(s.extend(t,n.bin),delete n.bin)}),t},assemble:function(e){return s.flatten(s.vals(e))}}},{"../../bin":12,"../../fielddef":76,"../../scale":81,"../../util":89}],20:[function(e,t,n){"use strict";function r(e){return{formatParse:l.formatParse.parseUnit(e),nullFilter:c.nullFilter.parseUnit(e),filter:f.filter.parseUnit(e),nonPositiveFilter:g.nonPositiveFilter.parseUnit(e),pathOrder:m.pathOrder.parseUnit(e),source:u.source.parseUnit(e),bin:d.bin.parseUnit(e),calculate:p.formula.parseUnit(e),timeUnit:y.timeUnit.parseUnit(e),summary:h.summary.parseUnit(e),stack:v.stack.parseUnit(e)}}function a(e){return{formatParse:l.formatParse.parseFacet(e),nullFilter:c.nullFilter.parseFacet(e),filter:f.filter.parseFacet(e),nonPositiveFilter:g.nonPositiveFilter.parseFacet(e),pathOrder:m.pathOrder.parseFacet(e),source:u.source.parseFacet(e),bin:d.bin.parseFacet(e),calculate:p.formula.parseFacet(e),timeUnit:y.timeUnit.parseFacet(e),summary:h.summary.parseFacet(e),stack:v.stack.parseFacet(e)}}function i(e){return{filter:f.filter.parseLayer(e),formatParse:l.formatParse.parseLayer(e),nullFilter:c.nullFilter.parseLayer(e),nonPositiveFilter:g.nonPositiveFilter.parseLayer(e),pathOrder:m.pathOrder.parseLayer(e),source:u.source.parseLayer(e),bin:d.bin.parseLayer(e),calculate:p.formula.parseLayer(e),timeUnit:y.timeUnit.parseLayer(e),summary:h.summary.parseLayer(e),stack:v.stack.parseLayer(e)}}function o(e,t){var n=e.component.data,r=u.source.assemble(n);r&&t.push(r),h.summary.assemble(n.summary||[],e.dataName(s.SOURCE)).forEach(function(e){t.push(e)});var a=g.nonPositiveFilter.assemble(n.nonPositiveFilter);if(a.length>0){if(!(t.length>0))throw new Error("Invalid nonPositiveFilter not merged");var i=t[t.length-1];i.transform=(i.transform||[]).concat(a)}var o=v.stack.assemble(n.stack);o&&t.push(o);var l=m.pathOrder.assemble(n.pathOrder);if(l){var i=t[t.length-1];if(!(t.length>0))throw new Error("Invalid path order collect transform not added");i.transform=(i.transform||[]).concat([l])}return t}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../data"),u=e("./source"),l=e("./formatparse"),c=e("./nullfilter"),f=e("./filter"),d=e("./bin"),p=e("./formula"),m=e("./pathorder"),g=e("./nonpositivefilter"),h=e("./summary"),v=e("./stack"),y=e("./timeunit");n.parseUnitData=r,n.parseFacetData=a,n.parseLayerData=i,n.assembleData=o},{"../../data":72,"./bin":19,"./filter":21,"./formatparse":22,"./formula":23,"./nonpositivefilter":24,"./nullfilter":25,"./pathorder":26,"./source":27,"./stack":28,"./summary":29,"./timeunit":30}],21:[function(e,t,n){"use strict";function r(e){var t=e.filter();return i.isArray(t)?"("+t.map(function(e){return a.expression(e)}).filter(function(e){return void 0!==e}).join(") && (")+")":t?a.expression(t):void 0}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../filter"),i=e("../../util");n.filter={parseUnit:r,parseFacet:function(e){var t=r(e),n=e.child.component.data;return!n.source&&n.filter&&(t=(t?t+" && ":"")+n.filter,delete n.filter),t},parseLayer:function(e){var t=r(e);return e.children.forEach(function(n){var r=n.component.data;e.compatibleSource(n)&&r.filter&&r.filter===t&&delete r.filter}),t},assemble:function(e){return e?[{type:"filter",expr:e}]:[]}}},{"../../filter":77,"../../util":89}],22:[function(e,t,n){"use strict";function r(e){var t=(e.calculate()||[]).reduce(function(e,t){return e[t.as]=!0,e},{}),n={},r=e.filter();l.isArray(r)||(r=[r]),r.forEach(function(e){var t=null;s.isEqualFilter(e)?t=e.equal:s.isRangeFilter(e)?t=e.range[0]:s.isOneOfFilter(e)&&(t=(e.oneOf||e.in)[0]),t&&(a.isDateTime(t)?n[e.field]="date":l.isNumber(t)?n[e.field]="number":l.isString(t)&&(n[e.field]="string"))}),e.forEachFieldDef(function(e){if(e.type===u.TEMPORAL)n[e.field]="date";else if(e.type===u.QUANTITATIVE){if(o.isCount(e)||t[e.field])return;n[e.field]="number"}});var c=e.data;if(c&&i.isUrlData(c)&&c.format&&c.format.parse){var f=c.format.parse;l.keys(f).forEach(function(e){n[e]=f[e]})}return n}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../datetime"),i=e("../../data"),o=e("../../fielddef"),s=e("../../filter"),u=e("../../type"),l=e("../../util");n.formatParse={parseUnit:r,parseFacet:function(e){var t=r(e),n=e.child.component.data;return!n.source&&n.formatParse&&(l.extend(t,n.formatParse),delete n.formatParse),t},parseLayer:function(e){var t=r(e);return e.children.forEach(function(n){var r=n.component.data;e.compatibleSource(n)&&!l.differ(r.formatParse,t)&&(l.extend(t,r.formatParse),delete r.formatParse)}),t},assemble:function(e){return e}}},{"../../data":72,"../../datetime":73,"../../fielddef":76,"../../filter":77,"../../type":88,"../../util":89}],23:[function(e,t,n){"use strict";function r(e){return(e.calculate()||[]).reduce(function(e,t){return e[a.hash(t)]=t,e},{})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../util");n.formula={parseUnit:r,parseFacet:function(e){var t=r(e),n=e.child.component.data;return n.source||(a.extend(t,n.calculate),delete n.calculate),t},parseLayer:function(e){var t=r(e);return e.children.forEach(function(e){var n=e.component.data;!n.source&&n.calculate&&(a.extend(t||{},n.calculate),delete n.calculate)}),t},assemble:function(e){return a.vals(e).reduce(function(e,t){return e.push(a.extend({type:"formula"},t)),e},[])}}},{"../../util":89}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../scale"),a=e("../../util");n.nonPositiveFilter={parseUnit:function(e){return e.channels().reduce(function(t,n){var a=e.scale(n);return e.field(n)&&a?(t[e.field(n)]=a.type===r.ScaleType.LOG,t):t},{})},parseFacet:function(e){var t=e.child.component.data;if(!t.source){var n=t.nonPositiveFilter;return delete t.nonPositiveFilter,n}return{}},parseLayer:function(e){var t={};return e.children.forEach(function(n){var r=n.component.data;e.compatibleSource(n)&&!a.differ(r.nonPositiveFilter,t)&&(a.extend(t,r.nonPositiveFilter),delete r.nonPositiveFilter)}),t},assemble:function(e){return e?a.keys(e).filter(function(t){return e[t]}).map(function(e){return{type:"filter",expr:'datum["'+e+'"] > 0'}}):[]}}},{"../../scale":81,"../../util":89}],25:[function(e,t,n){"use strict";function r(e){var t=e.filterInvalid();return e.reduceFieldDef(function(e,n){return"*"!==n.field&&(t||void 0===t&&n.field&&o[n.type]?e[n.field]=n:e[n.field]=null),e},{})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../type"),i=e("../../util"),o={nominal:!1,ordinal:!1,quantitative:!0,temporal:!0};n.nullFilter={parseUnit:r,parseFacet:function(e){var t=r(e),n=e.child.component.data;return n.source||(i.extend(t,n.nullFilter),delete n.nullFilter),t},parseLayer:function(e){var t=r(e);return e.children.forEach(function(n){var r=n.component.data;e.compatibleSource(n)&&!i.differ(r.nullFilter,t)&&(i.extend(t,r.nullFilter),delete r.nullFilter)}),t},assemble:function(e){var t=i.keys(e).reduce(function(t,n){var r=e[n];return null!==r&&(t.push('datum["'+r.field+'"] !== null'),i.contains([a.QUANTITATIVE,a.TEMPORAL],r.type)&&t.push('!isNaN(datum["'+r.field+'"])')),t},[]);return t.length>0?[{type:"filter",expr:t.join(" && ")}]:[]}}},{"../../type":88,"../../util":89}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("json-stable-stringify"),a=e("../../encoding"),i=e("../../fielddef"),o=e("../../sort"),s=e("../../util"),u=e("../common");n.pathOrder={parseUnit:function(e){if(s.contains(["line","area"],e.mark())){if("line"===e.mark()&&e.channelHasField("order"))return u.sortParams(e.encoding.order);var t="horizontal"===e.markDef.orient?"y":"x",n=e.sort(t),r=o.isSortField(n)?i.field({aggregate:a.isAggregate(e.encoding)?n.op:void 0,field:n.field}):e.field(t,{binSuffix:"start"});return{field:r,order:"descending"}}return null},parseFacet:function(e){var t=e.child.component.data;if(!t.source){var n=t.pathOrder;return delete t.pathOrder,n}return null},parseLayer:function(e){for(var t=null,n=null,a=0,i=e.children;a<i.length;a++){var o=i[a],s=o.component.data;if(e.compatibleSource(o)&&null!==s.pathOrder)if(null===t)t=s.pathOrder,n=r(t);else if(n!==r(s.pathOrder)){t=null;break}}if(null!==t)for(var u=0,l=e.children;u<l.length;u++){var o=l[u];delete o.component.data.pathOrder}return t},assemble:function(e){return e?{type:"collect",sort:e}:null}}},{"../../encoding":74,"../../fielddef":76,"../../sort":83,"../../util":89,"../common":17,"json-stable-stringify":1}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,a=e("../../data"),i=e("../../util"),o=e("./nullfilter"),s=e("./filter"),u=e("./bin"),l=e("./formula"),c=e("./timeunit");!function(e){function t(e){var t=e.data;if(t){var n={name:e.dataName(a.SOURCE)};if(a.isInlineData(t))n.values=t.values,n.format={type:"json"};else if(a.isUrlData(t)){n.url=t.url;var r=/(?:\.([^.]+))?$/.exec(n.url)[1];i.contains(["json","csv","tsv","topojson"],r)||(r="json");var o=t.format||{},s=o.type||t.formatType;n.format=i.extend({type:s?s:r},o.property?{property:o.property}:{},o.feature?{feature:o.feature}:o.mesh?{mesh:o.mesh}:{})}return n}if(!e.parent)return{name:e.dataName(a.SOURCE)}}function n(e){var n=t(e);return e.child.component.data.source||e.child.renameData(e.child.dataName(a.SOURCE),e.dataName(a.SOURCE)),n}function r(e){var n=t(e);return e.children.forEach(function(t){var n=t.component.data;if(e.compatibleSource(t)){var r=!n.filter&&!n.formatParse&&!n.nullFilter;r?(t.renameData(t.dataName(a.SOURCE),e.dataName(a.SOURCE)),delete n.source):n.source={name:t.dataName(a.SOURCE),source:e.dataName(a.SOURCE)}}}),n}function f(e){if(e.source){var t=e.source;return e.formatParse&&(e.source.format=e.source.format||{},e.source.format.parse=e.formatParse),t.transform=[].concat(l.formula.assemble(e.calculate),o.nullFilter.assemble(e.nullFilter),s.filter.assemble(e.filter),u.bin.assemble(e.bin),c.timeUnit.assemble(e.timeUnit)),t}return null}e.parseUnit=t,e.parseFacet=n,e.parseLayer=r,e.assemble=f}(r=n.source||(n.source={}))},{"../../data":72,"../../util":89,"./bin":19,"./filter":21,"./formula":23,"./nullfilter":25,"./timeunit":30}],28:[function(e,t,n){"use strict";function r(e){return e.stack.stackBy.reduce(function(t,n){var r=n.channel,a=n.fieldDef,i=e.scale(r),u=o.field(a,{binSuffix:i&&s.hasDiscreteDomain(i.type)?"range":"start"});return u&&t.push(u),t},[])}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../common"),i=e("../../data"),o=e("../../fielddef"),s=e("../../scale"),u=e("../../util");n.stack={parseUnit:function(e){var t=e.stack;if(t){var n=[];if(t.groupbyChannel){var o=e.fieldDef(t.groupbyChannel);o.bin?(n.push(e.field(t.groupbyChannel,{binSuffix:"start"})),n.push(e.field(t.groupbyChannel,{binSuffix:"end"}))):n.push(e.field(t.groupbyChannel))}var s,l=r(e),c=e.encoding.order;return s=c?a.sortParams(c):l.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),{name:e.dataName(i.STACKED),source:e.dataName(i.SUMMARY),groupby:n,field:e.field(t.fieldChannel),stackby:l,sort:s,offset:t.offset,impute:u.contains(["area","line"],e.mark())}}},parseLayer:function(e){},parseFacet:function(e){var t=e.child,n=t.component.data;if(n.stack){var r=n.stack,a=e.dataName(i.STACKED);return t.renameData(r.name,a),r.name=a,r.source=e.dataName(i.SUMMARY),r.groupby=e.reduceFieldDef(function(e,t){var n=o.field(t,{binSuffix:"start"});return u.contains(e,n)||e.push(n),e},r.groupby),delete n.stack,r}},assemble:function(e){if(e){var t=[];return e.impute&&t.push({type:"impute",field:e.field,groupby:e.stackby,orderby:e.groupby,method:"value",value:0}),t.push({type:"stack",groupby:e.groupby,field:e.field,sort:e.sort,as:[e.field+"_start",e.field+"_end"],offset:e.offset}),{name:e.name,source:e.source,transform:t}}}}},{"../../data":72,"../../fielddef":76,"../../scale":81,"../../util":89,"../common":17}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r,a=e("../../data"),i=e("../../fielddef"),o=e("../../util");!function(e){function t(e,t){return t.bin?(e[i.field(t,{binSuffix:"start"})]=!0,e[i.field(t,{binSuffix:"end"})]=!0,e[i.field(t,{binSuffix:"range"})]=!0):e[i.field(t)]=!0,e}function n(e){var n={},r={};return e.forEachFieldDef(function(a,i){if(a.aggregate)if("count"===a.aggregate)r["*"]=r["*"]||{},r["*"].count=!0;else{r[a.field]=r[a.field]||{},r[a.field][a.aggregate]=!0;var o=e.scale(i);o&&"unaggregated"===o.domain&&(r[a.field].min=!0,r[a.field].max=!0)}else t(n,a)}),[{name:e.dataName(a.SUMMARY),dimensions:n,measures:r}]}function r(e){var n=e.child.component.data;if(!n.source&&n.summary){var r=n.summary.map(function(n){n.dimensions=e.reduceFieldDef(t,n.dimensions);var r=n.name.substr(e.child.getName("").length);return e.child.renameData(n.name,r),n.name=r,n});return delete n.summary,r}return[]}function s(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];for(var a in r)r.hasOwnProperty(a)&&(n in e?e[n][a]=!0:e[n]={op:!0})}}function u(e){var t={};return e.children.forEach(function(n){var r=n.component.data;!r.source&&r.summary&&r.summary.forEach(function(i){var u=o.hash(i.dimensions);u in t?s(t[u].measures,i.measures):(i.name=e.dataName(a.SUMMARY)+"_"+o.keys(t).length,t[u]=i),n.renameData(n.dataName(a.SUMMARY),t[u].name),delete r.summary})}),o.vals(t)}function l(e,t){return e.reduce(function(e,n){var r=n.dimensions,a=n.measures;if(o.keys(a).length>0){var i=o.keys(r),s=o.reduce(a,function(e,t,n){for(var r=o.keys(t),a=0,i=r;a<i.length;a++){var s=i[a];e.fields.push(n),e.ops.push(s)}return e},{type:"aggregate",groupby:i,fields:[],ops:[]});e.push({name:n.name,source:t,transform:[s]})}return e},[])}e.parseUnit=n,e.parseFacet=r,e.parseLayer=u,e.assemble=l}(r=n.summary||(n.summary={}))},{"../../data":72,"../../fielddef":76,"../../util":89}],30:[function(e,t,n){"use strict";function r(e){return e.reduceFieldDef(function(e,t){if(t.type===o.TEMPORAL&&t.timeUnit){var n=a.field(t);e[n]={type:"formula",as:n,expr:i.fieldExpr(t.timeUnit,t.field)}}return e},{})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../fielddef"),i=e("../../timeunit"),o=e("../../type"),s=e("../../util");n.timeUnit={parseUnit:r,parseFacet:function(e){var t=r(e),n=e.child.component.data;return n.source||(s.extend(t,n.timeUnit),delete n.timeUnit),t},parseLayer:function(e){var t=r(e);return e.children.forEach(function(e){var n=e.component.data;n.source||(s.extend(t,n.timeUnit),delete n.timeUnit)}),t},assemble:function(e){return s.vals(e)}}},{"../../fielddef":76,"../../timeunit":86,"../../type":88,"../../util":89}],31:[function(e,t,n){"use strict";function r(e){return e.hasDescendantWithFieldOnChannel("x")||e.hasDescendantWithFieldOnChannel("y")}function a(e,t,n){return void 0!==e.spacing?e.spacing:r(t)?n.scale.facetSpacing:0}function i(e){var t=e.child,n=y.extend({},t.config.cell,t.config.facet.cell);return y.extend({x:e.channelHasField(m.COLUMN)?{scale:e.scaleName(m.COLUMN),field:e.field(m.COLUMN),offset:e.spacing(m.COLUMN)/2}:{value:e.config.scale.facetSpacing/2},y:e.channelHasField(m.ROW)?{scale:e.scaleName(m.ROW),field:e.field(m.ROW),offset:e.spacing(m.ROW)/2}:{value:e.config.scale.facetSpacing/2},width:{field:{parent:e.child.sizeName("width")}},height:{field:{parent:e.child.sizeName("height")}}},r(e)?t.assembleParentGroupProperties(n):{})}function o(e,t){return e.facet.column&&t.push({name:n.COLUMN_AXES_DATA_PREFIX+e.dataTable(),source:e.dataTable(),transform:[{type:"aggregate",groupby:[e.field(m.COLUMN)]}]}),e.facet.row&&t.push({name:n.ROW_AXES_DATA_PREFIX+e.dataTable(),source:e.dataTable(),transform:[{type:"aggregate",groupby:[e.field(m.ROW)]}]}),t}function s(e,t){var n=null,r=e.child;return r.channelHasField(t)&&r.axis(t)&&(n=u(e,t),r.axis(t)&&S.gridShow(r,t)?r.component.axes[t]=[b.parseGridAxis(t,r)]:delete r.component.axes[t]),n}function u(e,t){var r="x"===t,a=r?"column":"row",i=!!e.facet[a],o=r?n.COLUMN_AXES_DATA_PREFIX:n.ROW_AXES_DATA_PREFIX,s={name:e.getName(t+"-axes"),type:"group"};return i&&(s.from={data:o+e.dataTable()}),r?s.encode={update:{width:{field:{parent:e.child.sizeName("width")}},height:{field:{group:"height"}},x:i?{scale:e.scaleName(m.COLUMN),field:e.field(m.COLUMN),offset:e.spacing(m.COLUMN)/2}:{value:e.config.scale.facetSpacing/2}}}:s.encode={update:{width:{field:{group:"width"}},height:{field:{parent:e.child.sizeName("height")}},y:i?{scale:e.scaleName(m.ROW),field:e.field(m.ROW),offset:e.spacing(m.ROW)/2}:{value:e.config.scale.facetSpacing/2}}},s.axes=[b.parseMainAxis(t,e.child)],s}function l(e){var t=e.config.facet.grid,r={name:e.getName("row-grid"),type:"rule",from:{data:n.ROW_AXES_DATA_PREFIX+e.dataTable()},encode:{update:{y:{scale:e.scaleName(m.ROW),field:e.field(m.ROW)},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}};return[r,{name:e.getName("row-grid-end"),type:"rule",encode:{update:{y:{field:{group:"height"}},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}function c(e){var t=e.config.facet.grid,r={name:e.getName("column-grid"),type:"rule",from:{data:n.COLUMN_AXES_DATA_PREFIX+e.dataTable()},encode:{update:{x:{scale:e.scaleName(m.COLUMN),field:e.field(m.COLUMN)},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}};return[r,{name:e.getName("column-grid-end"),type:"rule",encode:{update:{x:{field:{group:"width"}},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}Object.defineProperty(n,"__esModule",{value:!0});var f=e("tslib"),d=e("../log"),p=e("../axis"),m=e("../channel"),g=e("../config"),h=e("../encoding"),v=e("../fielddef"),y=e("../util"),b=e("./axis/parse"),S=e("./axis/rules"),E=e("./common"),O=e("./data/data"),_=e("./layout"),N=e("./model"),x=e("./scale/init"),T=e("./scale/parse");n.COLUMN_AXES_DATA_PREFIX="column-",n.ROW_AXES_DATA_PREFIX="row-";var A=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;a.scales={},a.axes={},a.legends={},a.stack=null,a._spacing={};var i=a.config=a.initConfig(t.config,n),o=a.child=E.buildModel(t.spec,a,a.getName("child"));a.children=[o];var s=a.facet=a.initFacet(t.facet);return a.scales=a.initScalesAndSpacing(s,i),a.axes=a.initAxis(s,i,o),a.legends={},a}return f.__extends(t,e),t.prototype.initConfig=function(e,t){return y.mergeDeep(y.duplicate(g.defaultConfig),t?t.config:{},e)},t.prototype.initFacet=function(e){return e=y.duplicate(e),h.forEach(e,function(t,n){return y.contains([m.ROW,m.COLUMN],n)?void 0===t.field?(d.warn(d.message.emptyFieldDef(t,n)),void delete e[n]):(v.normalize(t,n),void(v.isDimension(t)||d.warn(d.message.facetChannelShouldBeDiscrete(n)))):(d.warn(d.message.incompatibleChannel(n,"facet")),void delete e[n])}),e},t.prototype.initScalesAndSpacing=function(e,t){var n=this;return[m.ROW,m.COLUMN].reduce(function(r,i){return e[i]&&(r[i]=x.default(i,e[i],t,void 0,void 0,[]),n._spacing[i]=a(e[i].scale||{},n,t)),r},{})},t.prototype.initAxis=function(e,t,n){var r=this;return[m.ROW,m.COLUMN].reduce(function(a,i){if(e[i]){var o=e[i].axis;if(o!==!1){var s={};p.VL_ONLY_AXIS_PROPERTIES.forEach(function(e){void 0!==t.facet.axis[e]&&(s[e]=t.facet.axis[e])});var u=a[i]=f.__assign({},s,o);if(i===m.ROW){var l=n.axis(m.Y);l&&"right"!==l.orient&&!u.orient&&(u.orient="right"),r.hasDescendantWithFieldOnChannel(m.X)&&!u.labelAngle&&(u.labelAngle="right"===u.orient?90:270)}}}return a},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.hasSummary=function(){for(var e=this.component.data.summary,t=0,n=e;t<n.length;t++){var r=n[t];if(y.keys(r.measures).length>0)return!0}return!1},t.prototype.facetedTable=function(){return"faceted-"+this.getName("data")},t.prototype.dataTable=function(){return this.component.data.stack?"stacked":this.hasSummary()?"summary":"source"},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.child.parseData(),this.component.data=O.parseFacetData(this)},t.prototype.parseSelection=function(){},t.prototype.parseLayoutData=function(){this.child.parseLayoutData(),this.component.layout=_.parseFacetLayout(this)},t.prototype.parseScale=function(){var e=this.child,t=this;e.parseScale();var n=this.component.scales=T.default(this);y.keys(e.component.scales).forEach(function(r){n[r]=e.component.scales[r],y.vals(n[r]).forEach(function(n){var r=n.name.substr(e.getName("").length),a=t.scaleName(r,!0);e.renameScale(n.name,a),n.name=a}),delete e.component.scales[r]})},t.prototype.parseMark=function(){this.child.parseMark(),this.component.mark=y.extend({name:this.getName("cell"),type:"group",from:y.extend({facet:{name:this.facetedTable(),data:this.dataTable(),groupby:[].concat(this.channelHasField(m.ROW)?[this.field(m.ROW)]:[],this.channelHasField(m.COLUMN)?[this.field(m.COLUMN)]:[])}}),encode:{update:i(this)}},this.child.assembleGroup())},t.prototype.parseAxis=function(){this.child.parseAxis(),this.component.axes=b.parseAxisComponent(this,[m.ROW,m.COLUMN])},t.prototype.parseAxisGroup=function(){var e=s(this,m.X),t=s(this,m.Y);this.component.axisGroups=y.extend(e?{x:e}:{},t?{y:t}:{})},t.prototype.parseGridGroup=function(){var e=this.child;this.component.gridGroups=y.extend(!e.channelHasField(m.X)&&this.channelHasField(m.COLUMN)?{column:c(this)}:{},!e.channelHasField(m.Y)&&this.channelHasField(m.ROW)?{row:l(this)}:{})},t.prototype.parseLegend=function(){this.child.parseLegend(),this.component.legends=this.child.component.legends,this.child.component.legends={}},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleSignals=function(e){return[]},t.prototype.assembleSelectionData=function(e){return[]},t.prototype.assembleData=function(e){return O.assembleData(this,e),this.child.assembleData(e),o(this,e),e},t.prototype.assembleLayout=function(e){return this.child.assembleLayout(e),_.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return[].concat(y.vals(this.component.axisGroups),y.flatten(y.vals(this.component.gridGroups)),this.component.mark)},t.prototype.channels=function(){return[m.ROW,m.COLUMN]},t.prototype.getMapping=function(){return this.facet},t.prototype.spacing=function(e){return this._spacing[e]},t.prototype.isFacet=function(){return!0},t}(N.Model);n.FacetModel=A,n.hasSubPlotWithXy=r,n.spacing=a,n.assembleAxesGroupData=o,n.getSharedAxisGroup=u},{"../axis":11,"../channel":13,"../config":71,"../encoding":74,"../fielddef":76,"../log":79,"../util":89,"./axis/parse":15,"./axis/rules":16,"./common":17,"./data/data":20,"./layout":33,"./model":49,"./scale/init":51,"./scale/parse":52,tslib:5}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../config"),i=e("../mark"),o=e("../util"),s=e("../data"),u=e("./data/data"),l=e("./common"),c=e("./layout"),f=e("./model"),d=e("./scale/domain"),p=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;return a.scales={},a.axes={},a.legends={},a.stack=null,a.width=t.width,a.height=t.height,a.config=a.initConfig(t.config,n),a.children=t.layer.map(function(e,t){return l.buildModel(e,a,a.getName("layer_"+t))}),a}return r.__extends(t,e),t.prototype.initConfig=function(e,t){return o.mergeDeep(o.duplicate(a.defaultConfig),e,t?t.config:{})},t.prototype.channelHasField=function(e){return!1},t.prototype.hasDiscreteScale=function(e){return this.children[0].hasDiscreteScale(e)},t.prototype.dataTable=function(){return this.children[0].dataTable()},t.prototype.fieldDef=function(e){return null},t.prototype.parseData=function(){this.children.forEach(function(e){e.parseData()}),this.component.data=u.parseLayerData(this)},t.prototype.parseSelection=function(){},t.prototype.parseLayoutData=function(){this.children.forEach(function(e){e.parseLayoutData()}),this.component.layout=c.parseLayerLayout(this)},t.prototype.parseScale=function(){var e=this,t=this.component.scales={};this.children.forEach(function(n){n.parseScale(),o.keys(n.component.scales).forEach(function(r){var a=n.component.scales[r];if(a){var i=t[r];i&&i.main?(i.main.domain=d.unionDomains(i.main.domain,a.main.domain),i.binLegend=i.binLegend?i.binLegend:a.binLegend,i.binLegendLabel=i.binLegendLabel?i.binLegendLabel:a.binLegendLabel):t[r]=a,o.vals(a).forEach(function(t){var r=t.name.substr(n.getName("").length),a=e.scaleName(r,!0);n.renameScale(t.name,a),t.name=a}),delete a[r]}})})},t.prototype.parseMark=function(){this.children.forEach(function(e){e.parseMark()})},t.prototype.parseAxis=function(){var e=this.component.axes={};this.children.forEach(function(t){t.parseAxis(),o.keys(t.component.axes).forEach(function(n){e[n]||(e[n]=t.component.axes[n])})})},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){var e=this.component.legends={};this.children.forEach(function(t){t.parseLegend(),o.keys(t.component.legends).forEach(function(n){e[n]||(e[n]=t.component.legends[n])})})},t.prototype.assembleParentGroupProperties=function(e){return l.applyConfig({},e,i.FILL_STROKE_CONFIG.concat(["clip"]))},t.prototype.assembleSignals=function(e){return[]},t.prototype.assembleSelectionData=function(e){return[]},t.prototype.assembleData=function(e){return u.assembleData(this,e),this.children.forEach(function(t){t.assembleData(e)}),e},t.prototype.assembleLayout=function(e){return this.children.forEach(function(t){t.assembleLayout(e)}),c.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return o.flatten(this.children.map(function(e){return e.assembleMarks()}))},t.prototype.channels=function(){return[]},t.prototype.getMapping=function(){return null},t.prototype.isLayer=function(){return!0},t.prototype.compatibleSource=function(e){var t=this.data,n=e.component.data,r=!n.source||t&&s.isUrlData(t)&&t.url===n.source.url;return r},t}(f.Model);n.LayerModel=p},{"../config":71,"../data":72,"../mark":80,"../util":89,"./common":17,"./data/data":20,"./layout":33,"./model":49,"./scale/domain":50,tslib:5}],33:[function(e,t,n){"use strict";function r(e,t){var n=e.component.layout;if(!n.width&&!n.height)return t;var r=v.keys(v.extend(n.width.distinct,n.height.distinct)),a=n.width.formula.concat(n.height.formula).map(function(e){return v.extend({type:"formula"},e)});return[r.length>0?{name:e.dataName(g.LAYOUT),source:e.dataTable(),transform:[{type:"aggregate",fields:r,ops:r.map(function(){return"distinct"})}].concat(a)}:{name:e.dataName(g.LAYOUT),values:[{}],transform:a}]}function a(e){return{width:i(e,m.X),height:i(e,m.Y)}}function i(e,t){return{distinct:d(e,t),formula:[{as:e.channelSizeName(t),expr:o(e,t)}]}}function o(e,t){var n=e.scale(t);if(n&&h.hasDiscreteDomain(n.type)&&n.rangeStep){var r=p(e,t),a=void 0!==n.paddingOuter?n.paddingOuter:n.padding,i="band"===n.type?void 0!==n.paddingInner?n.paddingInner:n.padding:1,o=r+(i?" - "+i:"")+(a?" + 2*"+a:"");return"max("+o+", 0) * "+n.rangeStep}return(t===m.X?e.width:e.height)+""}function s(e){return{width:u(e,m.COLUMN),height:u(e,m.ROW)}}function u(e,t){var n=e.child.component.layout,r=t===m.ROW?"height":"width",a=n[r],i=v.extend(d(e,t),a.distinct),o=a.formula.concat([{as:e.channelSizeName(t),expr:l(e,t,e.child.channelSizeName(t))}]);return delete n[r],{distinct:i,formula:o}}function l(e,t,n){return e.channelHasField(t)?'(datum["'+n+'"] + '+e.spacing(t)+") * "+p(e,t):'datum["'+n+'"] + '+e.config.scale.facetSpacing}function c(e){return{width:f(e,m.X),height:f(e,m.Y)}}function f(e,t){var n=e.children[0].component.layout,r=t===m.Y?"height":"width",a=n[r],i=a.distinct,o=[{as:e.channelSizeName(t),expr:a.formula[0].expr}];return e.children.forEach(function(e){delete e.component.layout[r]}),{distinct:i,formula:o}}function d(e,t){if(e.channelHasField(t)&&e.hasDiscreteScale(t)){var n=e.scale(t);if(h.hasDiscreteDomain(n.type)&&!(n.domain instanceof Array)){var r=e.field(t),a={};return a[r]=!0,a}}return{}}function p(e,t){var n=e.scale(t);return n.domain instanceof Array?n.domain.length+"":e.field(t,{datum:!0,prefix:"distinct"})}Object.defineProperty(n,"__esModule",{value:!0});var m=e("../channel"),g=e("../data"),h=e("../scale"),v=e("../util");n.assembleLayout=r,n.parseUnitLayout=a,n.unitSizeExpr=o,n.parseFacetLayout=s,n.parseLayerLayout=c,n.cardinalityExpr=p},{"../channel":13,"../data":72,"../scale":81,"../util":89
}],34:[function(e,t,n){"use strict";function r(e,t,n,r){var a={},l=n.mark();switch(l){case s.BAR:case s.TICK:case s.TEXT:a.shape={value:"square"};break;case s.CIRCLE:case s.SQUARE:a.shape={value:l};break;case s.POINT:case s.LINE:case s.AREA:}var d=n.config,p=n.markDef.filled,m=r===i.COLOR?c.without(s.FILL_STROKE_CONFIG,[p?"fill":"stroke","strokeDash","strokeDashOffset"]):s.FILL_STROKE_CONFIG;m=c.without(m,["strokeDash","strokeDashOffset"]),f.applyMarkConfig(a,n,m),p&&(a.strokeWidth={value:0}),r===i.OPACITY&&delete a.opacity;var g,h=n.encoding.color;o.isValueDef(h)&&(g={value:h.value}),void 0!==g?p?a.fill=g:a.stroke=g:r!==i.COLOR&&(a[p?"fill":"stroke"]=a[p?"fill":"stroke"]||{value:d.mark.color}),void 0===a.fill&&(void 0!==d.mark.fill?a.fill={value:d.mark.fill}:void 0!==d.mark.stroke&&(a.stroke={value:d.mark.stroke}));var v=n.encoding.shape;if(r!==i.SHAPE&&o.isValueDef(v)&&(a.shape={value:v.value}),e.bin&&u.hasContinuousDomain(n.scale(r).type)){var y={scale:n.scaleName(r),field:"value"};switch(r){case i.OPACITY:a.opacity=y;break;case i.SIZE:a.size=y;break;case i.COLOR:a[p?"fill":"stroke"]=y;break;default:throw Error("Legend for channel "+r+" not implemented")}}return a=c.extend(a,t||{}),c.keys(a).length>0?a:void 0}function a(e,t,n,r){var a=n.legend(r),i=n.config,o={};return e.bin&&u.hasContinuousDomain(n.scale(r).type)?t=c.extend({text:{scale:n.scaleName(r)+d.BIN_LEGEND_LABEL_SUFFIX,field:"value"}},t||{}):e.type===l.TEMPORAL&&(t=c.extend({text:{signal:f.timeFormatExpression("datum.value",e.timeUnit,a.format,i.legend.shortTimeLabels,i.timeFormat)}},t||{})),o=c.extend(o,t||{}),c.keys(o).length>0?o:void 0}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../channel"),o=e("../../fielddef"),s=e("../../mark"),u=e("../../scale"),l=e("../../type"),c=e("../../util"),f=e("../common"),d=e("../scale/scale");n.symbols=r,n.labels=a},{"../../channel":13,"../../fielddef":76,"../../mark":80,"../../scale":81,"../../type":88,"../../util":89,"../common":17,"../scale/scale":55}],35:[function(e,t,n){"use strict";function r(e){return[s.COLOR,s.SIZE,s.SHAPE,s.OPACITY].reduce(function(t,n){return e.legend(n)&&(t[n]=i(e,n)),t},{})}function a(e,t){var n=e.fieldDef(t).bin&&u.hasContinuousDomain(e.scale(t).type)?d.BIN_LEGEND_SUFFIX:"";switch(t){case s.COLOR:var r=e.scaleName(s.COLOR)+n;return e.markDef.filled?{fill:r}:{stroke:r};case s.SIZE:return{size:e.scaleName(s.SIZE)+n};case s.SHAPE:return{shape:e.scaleName(s.SHAPE)+n};case s.OPACITY:return{opacity:e.scaleName(s.OPACITY)+n}}return null}function i(e,t){var n=e.fieldDef(t),r=e.legend(t),i=a(e,t);c.LEGEND_PROPERTIES.forEach(function(n){var a=o(n,r,t,e);void 0!==a&&(i[n]=a)});var s=r.encode||{};return["labels","legend","title","symbols"].forEach(function(r){var a=p[r]?p[r](n,s[r],e,t):s[r];void 0!==a&&l.keys(a).length>0&&(i.encode=i.encode||{},i.encode[r]={update:a})}),i}function o(e,t,n,r){var a=r.fieldDef(n);switch(e){case"format":return f.numberFormat(a,t.format,r.config,n);case"title":return m.title(t,a,r.config);case"values":return m.values(t);case"type":m.type(t,a,n)}return t[e]}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../channel"),u=e("../../scale"),l=e("../../util"),c=e("../../legend"),f=e("../common"),d=e("../scale/scale"),p=e("./encode"),m=e("./rules");n.parseLegendComponent=r,n.parseLegend=i},{"../../channel":13,"../../legend":78,"../../scale":81,"../../util":89,"../common":17,"../scale/scale":55,"./encode":34,"./rules":36}],36:[function(e,t,n){"use strict";function r(e,t,n){return void 0!==e.title?e.title:u.title(t,n)}function a(e){var t=e.values;return t&&s.isDateTime(t[0])?t.map(function(e){return s.timestamp(e,!0)}):t}function i(e,t,n){return e.type?e.type:n!==o.COLOR||t.bin||t.timeUnit||!c.contains([l.QUANTITATIVE,l.TEMPORAL],t.type)?void 0:"gradient"}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../channel"),s=e("../../datetime"),u=e("../../fielddef"),l=e("../../type"),c=e("../../util");n.title=r,n.values=a,n.type=i},{"../../channel":13,"../../datetime":73,"../../fielddef":76,"../../type":88,"../../util":89}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("./mixins");n.area={vgMark:"area",role:void 0,encodeEntry:function(e){e.markDef.orient;return r.__assign({},a.pointPosition("x",e,"zeroOrMin"),a.pointPosition("y",e,"zeroOrMin"),a.pointPosition2(e,"zeroOrMin"),a.color(e),a.nonPosition("opacity",e),a.markDefProperties(e.markDef,["orient","interpolate","tension"]))}}},{"./mixins":42,tslib:5}],38:[function(e,t,n){"use strict";function r(e,t){var n=e.config,r=e.markDef.orient,a=e.encoding.size,c=e.encoding.x,p=e.scaleName(s.X),m=e.scale(s.X);if("horizontal"===r)return o.__assign({},f.pointPosition("x",e,"zeroOrMin"),f.pointPosition2(e,"zeroOrMin"));if(u.isFieldDef(c)){if(c.bin&&!a)return f.binnedPosition("x",e,n.bar.binSpacing);if(m.type===l.ScaleType.BAND)return f.bandPosition("x",e)}return f.centeredBandPosition("x",e,o.__assign({},d.midX(n),{offset:1}),i(p,e.scale(s.X),n))}function a(e,t){var n=e.config,r=e.encoding,a=e.markDef.orient,c=r.size,p=r.y,m=e.scaleName(s.Y),g=e.scale(s.Y);if("vertical"===a)return o.__assign({},f.pointPosition("y",e,"zeroOrMin"),f.pointPosition2(e,"zeroOrMin"));if(u.isFieldDef(p)){if(p.bin&&!c)return f.binnedPosition("y",e,n.bar.binSpacing);if(g.type===l.ScaleType.BAND)return f.bandPosition("y",e)}return f.centeredBandPosition("y",e,d.midY(n),i(m,e.scale(s.Y),n))}function i(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){if(t.type!==l.ScaleType.POINT)return t.type===l.ScaleType.BAND?d.band(e):{value:n.bar.continuousBandSize};if(null!==t.rangeStep)return{value:t.rangeStep-1};c.warn(c.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("../../channel"),u=e("../../fielddef"),l=e("../../scale"),c=e("../../log"),f=e("./mixins"),d=e("./valueref");n.bar={vgMark:"rect",role:"bar",encodeEntry:function(e){var t=e.stack;return o.__assign({},r(e,t),a(e,t),f.color(e),f.nonPosition("opacity",e))}}},{"../../channel":13,"../../fielddef":76,"../../log":79,"../../scale":81,"./mixins":42,"./valueref":48,tslib:5}],39:[function(e,t,n){"use strict";function r(e,t,n,r){var a=l.isMarkDef(e)?e:{type:e},i=a.orient||h.getMarkConfig("orient",a.type,r);return a.orient=s(a.type,t,n,i),void 0!==i&&i!==a.orient&&f.warn(f.message.orientOverridden(a.orient,i)),u.__assign({},a,{filled:o(a.type,r)})}function a(e,t,n,r){var a=h.getMarkConfig("opacity",e,r);if(!t.opacity&&void 0===a){var o=i(e,t,n);void 0!==o&&(t.opacity={value:o})}return t}function i(e,t,n){return!d.contains([l.POINT,l.TICK,l.CIRCLE,l.SQUARE],e)||c.isAggregate(t)&&!c.channelHasField(t,"detail")?e===l.BAR&&!n&&(c.channelHasField(t,"color")||c.channelHasField(t,"detail")||c.channelHasField(t,"size"))?.7:e===l.AREA?.7:void 0:.7}function o(e,t){var n=h.getMarkConfig("filled",e,t);return void 0!==n?n:e!==l.POINT&&e!==l.LINE&&e!==l.RULE}function s(e,t,n,r){switch(e){case l.POINT:case l.CIRCLE:case l.SQUARE:case l.TEXT:case l.RECT:return}var a=t.y&&t.y2,i=t.x&&t.x2;switch(e){case l.TICK:var o=n.x?n.x.type:null,s=n.y?n.y.type:null;return!p.hasDiscreteDomain(o)&&(!t.y||p.hasDiscreteDomain(s)||m.isFieldDef(t.y)&&t.y.bin)?"vertical":"horizontal";case l.RULE:case l.BAR:case l.AREA:if(a)return"vertical";if(i)return"horizontal";if(e===l.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case l.LINE:var u=m.isMeasure(t.x)||m.isMeasure(t.x2),c=m.isMeasure(t.y)||m.isMeasure(t.y2);if(u&&!c)return"horizontal";if(!u&&c)return"vertical";if(u&&c){var d=t.x,h=t.y;return d.type===g.TEMPORAL?"vertical":h.type===g.TEMPORAL?"horizontal":r?r:(e===l.LINE&&t.order||f.warn(f.message.unclearOrientContinuous(e)),"vertical")}return void f.warn(f.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),l=e("../../mark"),c=e("../../encoding"),f=e("../../log"),d=e("../../util"),p=e("../../scale"),m=e("../../fielddef"),g=e("../../type"),h=e("../common");n.initMarkDef=r,n.initEncoding=a},{"../../encoding":74,"../../fielddef":76,"../../log":79,"../../mark":80,"../../scale":81,"../../type":88,"../../util":89,"../common":17,tslib:5}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("./mixins");n.line={vgMark:"line",role:void 0,encodeEntry:function(e){return r.__assign({},a.pointPosition("x",e,"zeroOrMin"),a.pointPosition("y",e,"zeroOrMin"),a.color(e),a.nonPosition("opacity",e),a.nonPosition("size",e,{vgChannel:"strokeWidth"}),a.markDefProperties(e.markDef,["interpolate","tension"]))}}},{"./mixins":42,tslib:5}],41:[function(e,t,n){"use strict";function r(e){return f.contains([c.LINE,c.AREA],e.mark())?i(e):o(e)}function a(e){var t=e.parent;return t&&t.isFacet()?t.facetedTable():e.stack?e.dataName("stacked"):e.dataTable()}function i(e){var t=e.mark(),n=s(e),r=[{name:e.getName("marks"),type:S[t].vgMark,from:{data:(n.length>0?E:"")+a(e)},encode:{update:S[t].encodeEntry(e)}}];return n.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:E+a(e),data:a(e),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:r}]:r}function o(e){var t=e.mark(),n=S[t].role,r=[];return r.push(u.__assign({name:e.getName("marks"),type:S[t].vgMark},n?{role:n}:{},{from:{data:a(e)},encode:{update:S[t].encodeEntry(e)}})),r}function s(e){return O.reduce(function(t,n){return e.channelHasField(n)&&!e.fieldDef(n).aggregate&&t.push(e.field(n)),t},[])}Object.defineProperty(n,"__esModule",{value:!0});var u=e("tslib"),l=e("../../channel"),c=e("../../mark"),f=e("../../util"),d=e("./area"),p=e("./bar"),m=e("./line"),g=e("./point"),h=e("./rect"),v=e("./rule"),y=e("./text"),b=e("./tick"),S={area:d.area,bar:p.bar,line:m.line,point:g.point,text:y.text,tick:b.tick,rect:h.rect,rule:v.rule,circle:g.circle,square:g.square};n.parseMark=r;var E="faceted-path-",O=f.without(l.NONSPATIAL_CHANNELS,["order"])},{"../../channel":13,"../../mark":80,"../../util":89,"./area":37,"./bar":38,"./line":40,"./point":43,"./rect":44,"./rule":45,"./text":46,"./tick":47,tslib:5}],42:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.markDef.filled,r=o("color",e,{vgChannel:n?"fill":"stroke",defaultValue:v.getMarkConfig("color",e.mark(),t)});return!r.fill&&h.contains(["bar","point","circle","square"],e.mark())&&(r.fill={value:"transparent"}),r}function a(e,t){return t.reduce(function(t,n){return e[n]&&(t[n]={value:e[n]}),t},{})}function i(e,t){if(void 0!==t)return n={},n[e]={value:t},n;return;var n}function o(e,t,n){void 0===n&&(n={});var r=n.defaultValue,a=n.vgChannel,i=n.defaultRef||(void 0!==r?{value:r}:void 0),o=t.encoding[e],u=y.midPoint(e,o,t.scaleName(e),t.scale(e),i);return s(t,o&&o.condition,a||e,u)}function s(e,t,n,r){if(t){var a=t.selection,i=t.value;return o={},o[n]=[{test:u(e,a),value:i}].concat(void 0!==r?[r]:[]),o}return void 0!==r?(s={},s[n]=r,s):{};var o,s}function u(e,t){var n="!"===t.charAt(0),r=n?t.slice(1):t;return(n?"!":"")+b.predicate(e.component.selection[r])}function l(e){var t=e.encoding.text;return s(e,t&&t.condition,"text",y.text(t,e.config))}function c(e,t){var n=t.encoding[e],r=t.scaleName(e),a="x"===e?"width":"height";return i={},i[e]=y.fieldRef(n,r,{}),i[a]=y.band(r),i;var i}function f(e,t,n,r){var a="x"===e?"xc":"yc",i="x"===e?"width":"height";return g.__assign({},p(e,t,n,a),o("size",t,{defaultRef:r,vgChannel:i}))}function d(e,t,n){var r=t.encoding[e],a=t.scaleName(e);return"x"===e?{x2:y.bin(r,a,"start",n),x:y.bin(r,a,"end")}:{y2:y.bin(r,a,"start"),y:y.bin(r,a,"end",n)}}function p(e,t,n,r){var a=t.encoding,i=t.stack,o=y.stackable(e,a[e],t.scaleName(e),t.scale(e),i,n);return s={},s[r||e]=o,s;var s}function m(e,t,n){var r=e.encoding,a=e.markDef,i=e.stack;n=n||("horizontal"===a.orient?"x2":"y2");var o="x2"===n?"x":"y",s=y.stackable2(n,r[o],r[n],e.scaleName(o),e.scale(o),i,t);return u={},u[n]=s,u;var u}Object.defineProperty(n,"__esModule",{value:!0});var g=e("tslib"),h=e("../../util"),v=e("../common"),y=e("./valueref"),b=e("../selection/selection");n.color=r,n.markDefProperties=a,n.valueIfDefined=i,n.nonPosition=o,n.text=l,n.bandPosition=c,n.centeredBandPosition=f,n.binnedPosition=d,n.pointPosition=p,n.pointPosition2=m},{"../../util":89,"../common":17,"../selection/selection":59,"./valueref":48,tslib:5}],43:[function(e,t,n){"use strict";function r(e,t){var n=e.config;return i.__assign({},o.pointPosition("x",e,s.midX(n)),o.pointPosition("y",e,s.midY(n)),o.color(e),o.nonPosition("size",e),a(e,n,t),o.nonPosition("opacity",e))}function a(e,t,n){return n?{shape:{value:n}}:o.nonPosition("shape",e,{defaultValue:u.getMarkConfig("shape","point",t)})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),o=e("./mixins"),s=e("./valueref"),u=e("../common");n.shapeMixins=a,n.point={vgMark:"symbol",role:"point",encodeEntry:function(e){return r(e)}},n.circle={vgMark:"symbol",role:"circle",encodeEntry:function(e){return r(e,"circle")}},n.square={vgMark:"symbol",role:"square",encodeEntry:function(e){return r(e,"square")}}},{"../common":17,"./mixins":42,"./valueref":48,tslib:5}],44:[function(e,t,n){"use strict";function r(e){var t=e.encoding.x,n=e.encoding.x2,r=e.scale(o.X);if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition("x",e,0);if(r&&u.hasDiscreteDomain(r.type)){if(r.type===u.ScaleType.BAND)return f.bandPosition("x",e);throw new Error(c.message.scaleTypeNotWorkWithMark(l.RECT,r.type))}return i.__assign({},f.pointPosition("x",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","x2"))}function a(e){var t=e.encoding.y,n=e.encoding.y2,r=e.scale(o.Y);if(s.isFieldDef(t)&&t.bin&&!n)return f.binnedPosition("y",e,0);if(r&&u.hasDiscreteDomain(r.type)){if(r.type===u.ScaleType.BAND)return f.bandPosition("y",e);throw new Error(c.message.scaleTypeNotWorkWithMark(l.RECT,r.type))}return i.__assign({},f.pointPosition("y",e,"zeroOrMax"),f.pointPosition2(e,"zeroOrMin","y2"))}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),o=e("../../channel"),s=e("../../fielddef"),u=e("../../scale"),l=e("../../mark"),c=e("../../log"),f=e("./mixins");n.rect={vgMark:"rect",role:void 0,encodeEntry:function(e){return i.__assign({},r(e),a(e),f.color(e),f.nonPosition("opacity",e))}}},{"../../channel":13,"../../fielddef":76,"../../log":79,"../../mark":80,"../../scale":81,"./mixins":42,tslib:5}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("./mixins");n.rule={vgMark:"rule",role:void 0,encodeEntry:function(e){return r.__assign({},a.pointPosition("x",e,"zeroOrMin"),a.pointPosition("y",e,"zeroOrMin"),a.pointPosition2(e,"zeroOrMax"),a.color(e),a.nonPosition("opacity",e),a.nonPosition("size",e,{vgChannel:"strokeWidth"}))}}},{"./mixins":42,tslib:5}],46:[function(e,t,n){"use strict";function r(e,t){return l.isFieldDef(t)&&t.type===c.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:e.scale.textXRangeStep/2}}function a(e,t){var n=s.getMarkConfig("align","text",t);if(void 0===n)return d.channelHasField(e,o.X)?"center":"right"}Object.defineProperty(n,"__esModule",{value:!0});var i=e("tslib"),o=e("../../channel"),s=e("../common"),u=e("./mixins"),l=e("../../fielddef"),c=e("../../type"),f=e("./valueref"),d=e("../../encoding");n.text={vgMark:"text",role:void 0,encodeEntry:function(e){var t=e.config,n=e.encoding,o=n.text;return i.__assign({},u.pointPosition("x",e,r(t,o)),u.pointPosition("y",e,f.midY(t)),u.text(e),u.color(e),u.nonPosition("opacity",e),u.nonPosition("size",e,{vgChannel:"fontSize"}),u.valueIfDefined("align",a(n,t)))}}},{"../../channel":13,"../../encoding":74,"../../fielddef":76,"../../type":88,"../common":17,"./mixins":42,"./valueref":48,tslib:5}],47:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.markDef.orient,r=(e.scale("horizontal"===n?"x":"y")||{}).rangeStep;if(void 0!==t.tick.bandSize)return t.tick.bandSize;var a=void 0!==r?r:t.scale.rangeStep;if("number"!=typeof a)throw new Error("Function does not handle non-numeric rangeStep");return a/1.5}Object.defineProperty(n,"__esModule",{value:!0});var a=e("tslib"),i=e("./mixins"),o=e("./valueref");n.tick={vgMark:"rect",role:"tick",encodeEntry:function(e){var t=e.config,n=e.markDef,s=n.orient,u="horizontal"===s?"width":"height",l="horizontal"===s?"height":"width";return a.__assign({},i.pointPosition("x",e,o.midX(t),"xc"),i.pointPosition("y",e,o.midY(t),"yc"),i.nonPosition("size",e,{defaultValue:r(e),vgChannel:u}),(c={},c[l]={value:t.tick.thickness},c),i.color(e),i.nonPosition("opacity",e));var c}}},{"./mixins":42,"./valueref":48,tslib:5}],48:[function(e,t,n){"use strict";function r(e,t,n,r,a,i){return t&&a&&e===a.fieldChannel?o(t,n,{suffix:"end"}):l(e,t,n,r,i)}function a(e,t,n,r,a,i,s){return t&&i&&e.charAt(0)===i.fieldChannel.charAt(0)?o(t,r,{suffix:"start"}):l(e,n,r,a,s)}function i(e,t,n,r){return o(e,t,{binSuffix:n},r)}function o(e,t,n,r){var a={scale:t,field:y.field(e,n)};return r&&(a.offset=r),a}function s(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function u(e,t){return{scale:t,signal:"("+y.field(e,{binSuffix:"start",datum:!0})+"+"+y.field(e,{binSuffix:"end",datum:!0})+")/2"}}function l(e,t,n,r,a){if(t){if(y.isFieldDef(t))return b.hasDiscreteDomain(r.type)?"band"===r.type?o(t,n,{binSuffix:"range"},s(n,.5)):o(t,n,{binSuffix:"range"}):t.bin?u(t,n):o(t,n,{});if(t.value)return{value:t.value};throw new Error("FieldDef without field or value.")}if("zeroOrMin"===a){if(e===v.X||e===v.X2)return p(n,r);if(e===v.Y||e===v.Y2)return g(n,r);throw new Error("Unsupported channel "+e+" for base function")}if("zeroOrMax"===a){if(e===v.X||e===v.X2)return m(n,r);if(e===v.Y||e===v.Y2)return h(n,r);throw new Error("Unsupported channel "+e+" for base function")}return a}function c(e,t){if(e){if(y.isFieldDef(e)){if("quantitative"===e.type){var n=E.numberFormat(e,e.format,t,"text");return{signal:"format("+y.field(e,{datum:!0})+", '"+n+"')"}}return"temporal"===e.type?{signal:E.timeFormatExpression(y.field(e,{datum:!0}),e.timeUnit,e.format,t.text.shortTimeLabels,t.timeFormat)}:{field:e.field}}if(e.value)return{value:e.value}}return{value:t.text.text}}function f(e){if("string"==typeof e.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:e.scale.rangeStep/2}}function d(e){if("string"==typeof e.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:e.scale.rangeStep/2}}function p(e,t){return e&&!S.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{value:0}}function m(e,t){return e&&!S.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{field:{group:"width"}}}function g(e,t){return e&&!S.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{field:{group:"height"}}}function h(e,t){return e&&!S.contains([b.ScaleType.LOG,b.ScaleType.TIME,b.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{value:0}}Object.defineProperty(n,"__esModule",{value:!0});var v=e("../../channel"),y=e("../../fielddef"),b=e("../../scale"),S=e("../../util"),E=e("../common");n.stackable=r,n.stackable2=a,n.bin=i,n.fieldRef=o,n.band=s,n.binMidSignal=u,n.midPoint=l,n.text=c,n.midX=f,n.midY=d},{"../../channel":13,"../../fielddef":76,"../../scale":81,"../../util":89,"../common":17}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../log"),a=e("../channel"),i=e("../encoding"),o=e("../fielddef"),s=e("../scale"),u=e("../util"),l=e("./scale/scale"),c=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e];)e=this.nameMap[e];return e},e}();n.NameMap=c;var f=function(){function e(e,t,n){this.scales={},this.axes={},this.legends={},this.children=[],this.parent=t,this.name=e.name||n,this.dataNameMap=t?t.dataNameMap:new c,this.scaleNameMap=t?t.scaleNameMap:new c,this.sizeNameMap=t?t.sizeNameMap:new c,this.data=e.data,this.description=e.description,this.padding=e.padding,this.transform=e.transform,e.transform&&void 0===e.transform.filterInvalid&&void 0!==e.transform.filterNull&&(e.transform.filterInvalid=e.transform.filterNull,r.warn(r.message.DEPRECATED_FILTER_NULL)),this.component={data:null,layout:null,mark:null,scales:null,axes:null,axisGroups:null,gridGroups:null,legends:null,selection:null}}return e.prototype.parse=function(){this.parseData(),this.parseLayoutData(),this.parseScale(),this.parseSelection(),this.parseAxis(),this.parseLegend(),this.parseAxisGroup(),this.parseGridGroup(),this.parseMark()},e.prototype.assembleScales=function(){return u.flatten(u.vals(this.component.scales).map(function(e){var t=[e.main];return e.binLegend&&t.push(e.binLegend),e.binLegendLabel&&t.push(e.binLegendLabel),t}))},e.prototype.assembleAxes=function(){return[].concat.apply([],u.vals(this.component.axes))},e.prototype.assembleLegends=function(){return u.vals(this.component.legends)},e.prototype.assembleGroup=function(){var e={},t=this.assembleSignals(e.signals||[]);t.length>0&&(e.signals=t),e.marks=this.assembleMarks();var n=this.assembleScales();n.length>0&&(e.scales=n);var r=this.assembleAxes();r.length>0&&(e.axes=r);var a=this.assembleLegends();return a.length>0&&(e.legends=a),e},e.prototype.reduceFieldDef=function(e,t,n){return i.reduce(this.getMapping(),function(t,n,r){return o.isFieldDef(n)?e(t,n,r):t},t,n)},e.prototype.forEachFieldDef=function(e,t){i.forEach(this.getMapping(),function(t,n){o.isFieldDef(t)&&e(t,n)},t)},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var r=n[t];if(r.isUnit()){if(r.channelHasField(e))return!0}else if(r.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e,t){return void 0===t&&(t="_"),(this.name?this.name+t:"")+e},e.prototype.renameData=function(e,t){this.dataNameMap.rename(e,t)},e.prototype.dataName=function(e){return this.dataNameMap.get(this.getName(String(e)))},e.prototype.renameSize=function(e,t){this.sizeNameMap.rename(e,t)},e.prototype.channelSizeName=function(e){return this.sizeName(e===a.X||e===a.COLUMN?"width":"height")},e.prototype.sizeName=function(e){return this.sizeNameMap.get(this.getName(e,"_"))},e.prototype.calculate=function(){return this.transform?this.transform.calculate:void 0},e.prototype.filterInvalid=function(){var e=this.transform||{};return void 0===e.filterInvalid?this.parent?this.parent.filterInvalid():void 0:e.filterInvalid},e.prototype.filter=function(){return this.transform?this.transform.filter:void 0},e.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=u.extend({binSuffix:s.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),o.field(n,t)},e.prototype.scale=function(e){return this.scales[e]},e.prototype.hasDiscreteScale=function(e){var t=this.scale(e);return t&&s.hasDiscreteDomain(t.type)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){var n=e.replace(l.BIN_LEGEND_SUFFIX,"").replace(l.BIN_LEGEND_LABEL_SUFFIX,"");return t?this.getName(e+""):this.scale&&this.scales[n]||this.scaleNameMap.has(this.getName(e+""))?this.scaleNameMap.get(this.getName(e+"")):void 0},e.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},e.prototype.axis=function(e){return this.axes[e]},e.prototype.legend=function(e){return this.legends[e]},e.prototype.isUnit=function(){return!1},e.prototype.isFacet=function(){return!1},e.prototype.isLayer=function(){return!1},e}();n.Model=f},{"../channel":13,"../encoding":74,"../fielddef":76,"../log":79,"../scale":81,"../util":89,"./scale/scale":55}],50:[function(e,t,n){"use strict";function r(e,t,n,r){if("unaggregated"===e){var a=s(t,n),i=a.valid,o=a.reason;if(!i)return void c.warn(o)}else if(void 0===e&&r.useUnaggregatedDomain){var i=s(t,n).valid;if(i)return"unaggregated"}return e}function a(e,t){var n=e.scale(t);return"x"===t&&e.channelHasField("x2")?e.channelHasField("x")?l(i(n,e,"x"),i(n,e,"x2")):i(n,e,"x2"):"y"===t&&e.channelHasField("y2")?e.channelHasField("y")?l(i(n,e,"y"),i(n,e,"y2")):i(n,e,"y2"):i(n,e,t)}function i(e,t,n){var r=t.fieldDef(n);if(e.domain&&"unaggregated"!==e.domain)return p.isDateTime(e.domain[0])?e.domain.map(function(e){return p.timestamp(e,!0)}):e.domain;if("temporal"===r.type)return{data:t.dataTable(),field:t.field(n),sort:{field:t.field(n),op:"min"}};var a=t.stack;if(a&&n===a.fieldChannel)return"normalize"===a.offset?[0,1]:{data:t.dataName("stacked"),fields:[t.field(n,{suffix:"start"}),t.field(n,{suffix:"end"})]};var i=o(t,n,e.type);return"unaggregated"===e.domain?{data:t.dataTable(),fields:[t.field(n,{aggregate:"min"}),t.field(n,{aggregate:"max"})]}:r.bin?m.hasDiscreteDomain(e.type)?{data:t.dataTable(),field:t.field(n,{binSuffix:"range"}),sort:{field:t.field(n,{binSuffix:"start"}),op:"min"}}:"x"===n||"y"===n?{data:t.dataTable(),fields:[t.field(n,{binSuffix:"start"}),t.field(n,{binSuffix:"end"})]}:{data:t.dataTable(),field:t.field(n,{binSuffix:"start"})}:i?{data:v.isBoolean(i)?t.dataTable():d.SOURCE,field:t.field(n),sort:i}:{data:t.dataTable(),field:t.field(n)}}function o(e,t,n){if(m.hasDiscreteDomain(n)){var r=e.sort(t);return g.isSortField(r)?{op:r.op,field:r.field}:!!v.contains(["ascending","descending",void 0],r)||void 0}}function s(e,t){return e.aggregate?f.SHARED_DOMAIN_OPS.indexOf(e.aggregate)===-1?{valid:!1,reason:c.message.unaggregateDomainWithNonSharedDomainOp(e.aggregate)}:"quantitative"===e.type&&"log"===t?{valid:!1,reason:c.message.unaggregatedDomainWithLogScale(e)}:{valid:!0}:{valid:!1,reason:c.message.unaggregateDomainHasNoEffectForRawField(e)}}function u(e){if(v.isArray(e))return[e];if(h.isDataRefDomain(e))return delete e.sort,[e];if(h.isFieldRefUnionDomain(e))return e.fields.map(function(t){return{data:e.data,field:t}});if(h.isDataRefUnionedDomain(e))return e.fields.map(function(e){return v.isArray(e)?e:{field:e.field,data:e.data}});throw new Error(c.message.INVAID_DOMAIN)}function l(e,t){var n=u(e),r=u(t),a=n.concat(r);if(a=v.unique(a,v.hash),a.length>1){var i=a.map(function(e){return h.isDataRefDomain(e)?e.data:null});return 1===v.unique(i,function(e){return e}).length&&null!==i[0]?{data:i[0],fields:a.map(function(e){return e.field})}:{fields:a,sort:!0}}return a[0]}Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../log"),f=e("../../aggregate"),d=e("../../data"),p=e("../../datetime"),m=e("../../scale"),g=e("../../sort"),h=e("../../vega.schema"),v=e("../../util");n.initDomain=r,n.parseDomain=a,n.domainSort=o,n.canUseUnaggregatedDomain=s,n.unionDomains=l},{"../../aggregate":10,"../../data":72,"../../datetime":73,"../../log":79,"../../scale":81,"../../sort":83,"../../util":89,"../../vega.schema":91}],51:[function(e,t,n){"use strict";function r(e,t,r,i,u,c){var p=(t||{}).scale||{},m={type:f.default(p.type,t.type,e,t.timeUnit,i,void 0!==u,p.rangeStep,r.scale)};return n.NON_TYPE_RANGE_SCALE_PROPERTIES.forEach(function(n){var i=p[n],u=s.scaleTypeSupportProperty(m.type,n),l=s.channelScalePropertyIncompatability(e,n);if(void 0!==i&&(u?l&&o.warn(l):o.warn(o.message.scalePropertyNotWorkWithScaleType(m.type,n,e))),u&&void 0===l){var c=a(i,n,m,e,t,r.scale);void 0!==c&&(m[n]=c)}}),d.extend(m,l.default(e,m.type,t.type,p,r,m.zero,i,u,c))}function a(e,t,n,r,a,o){return"domain"===t?u.initDomain(e,a,n.type,o):void 0!==e?e:i(t,n,r,a,o)}function i(e,t,n,r,a){switch(e){case"nice":return c.nice(t.type,n,r);case"padding":return c.padding(n,t.type,a);case"paddingInner":return c.paddingInner(t.padding,n,a);case"paddingOuter":return c.paddingOuter(t.padding,n,t.type,t.paddingInner,a);case"round":return c.round(n,a);case"zero":return c.zero(t,n,r)}return a[e]}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../log"),s=e("../../scale"),u=e("./domain"),l=e("./range"),c=e("./rules"),f=e("./type"),d=e("../../util");n.NON_TYPE_RANGE_SCALE_PROPERTIES=["domain","round","clamp","nice","exponent","zero","interpolate","padding","paddingInner","paddingOuter"],n.default=r},{"../../log":79,"../../scale":81,"../../util":89,"./domain":50,"./range":53,"./rules":54,"./type":56}],52:[function(e,t,n){"use strict";function r(e){return e.channels().reduce(function(t,n){var r=a(e,n);return r&&(t[n]=r),t},{})}function a(e,t){if(e.scale(t)){var n=e.fieldDef(t),r={main:i(e,t)};return e.legend(t)&&n.bin&&l.hasContinuousDomain(e.scale(t).type)&&(r.binLegend=o(t,e),r.binLegendLabel=s(t,e,n)),r}return null}function i(e,t){var r=e.scale(t),a=e.sort(t),i={name:e.scaleName(t+"",!0),type:r.type,domain:d.parseDomain(e,t),range:p.parseRange(r)};return n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES.forEach(function(e){i[e]=r[e]}),a&&"descending"===(c.isSortField(a)?a.order:a)&&(i.reverse=!0),i}function o(e,t){return{name:t.scaleName(e,!0)+f.BIN_LEGEND_SUFFIX,type:l.ScaleType.POINT,domain:{data:t.dataTable(),field:t.field(e),sort:!0},range:[0,1]}}function s(e,t,n){return{name:t.scaleName(e,!0)+f.BIN_LEGEND_LABEL_SUFFIX,type:l.ScaleType.ORDINAL,domain:{data:t.dataTable(),field:t.field(e),sort:!0},range:{data:t.dataTable(),field:u.field(n,{binSuffix:"range"}),sort:{field:t.field(e,{binSuffix:"start"}),op:"min"}}}}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../fielddef"),l=e("../../scale"),c=e("../../sort"),f=e("./scale"),d=e("./domain"),p=e("./range");n.default=r,n.parseScale=a,n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=["round","clamp","nice","exponent","interpolate","zero","padding","paddingInner","paddingOuter"]},{"../../fielddef":76,"../../scale":81,"../../sort":83,"./domain":50,"./range":53,"./scale":55}],53:[function(e,t,n){"use strict";function r(e){if(e.rangeStep)return{step:e.rangeStep};if(e.scheme){var t=e.scheme;if(f.isExtendedScheme(t)){var n={scheme:t.name};return t.count&&(n.count=t.count),t.extent&&(n.extent=t.extent),n}return{scheme:t}}return e.range}function a(e,t,r,a,u,p,m,g,h){for(var v=!1,y=0,b=n.RANGE_PROPERTIES;y<b.length;y++){var S=b[y];if(void 0!==a[S]){var E=f.scaleTypeSupportProperty(t,S),O=f.channelScalePropertyIncompatability(e,S);if(E)if(O)l.warn(O);else switch(S){case"range":return{range:a[S]};case"scheme":return{scheme:a[S]};case"rangeStep":if(void 0===g){var _=a[S];if(null!==_)return{rangeStep:_};v=!0}else l.warn(l.message.rangeStepDropped(e))}else l.warn(l.message.scalePropertyNotWorkWithScaleType(t,S,e))}}switch(e){case c.ROW:return{range:"height"};case c.COLUMN:return{range:"width"};case c.X:case c.Y:if(void 0===g){if(d.contains(["point","band"],t)&&!v)if(e===c.X&&"text"===m){if(u.scale.textXRangeStep)return{rangeStep:u.scale.textXRangeStep}}else if(u.scale.rangeStep)return{rangeStep:u.scale.rangeStep};g=e===c.X?u.cell.width:u.cell.height}return{range:e===c.X?[0,g]:[g,0]};case c.SIZE:var N=o(m,p,u),x=s(m,h,u);return{range:[N,x]};case c.SHAPE:case c.COLOR:return{range:i(e,t,r,m)};case c.OPACITY:return{range:[u.scale.minOpacity,u.scale.maxOpacity]}}throw new Error("Scale range undefined for channel "+e)}function i(e,t,n,r){switch(e){case c.SHAPE:return"symbol";case c.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===r?"heatmap":"ramp"}}function o(e,t,n){if(t)return 0;switch(e){case"bar":return void 0!==n.scale.minBandSize?n.scale.minBandSize:n.bar.continuousBandSize;case"tick":return n.scale.minBandSize;case"line":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":if(n.scale.minSize)return n.scale.minSize}throw new Error(l.message.incompatibleChannel("size",e))}function s(e,t,n){var r=n.scale;switch(e){case"bar":case"tick":return void 0!==n.scale.maxBandSize?n.scale.maxBandSize:u(t,n.scale)-1;case"line":case"rule":return n.scale.maxStrokeWidth;case"text":return n.scale.maxFontSize;case"point":case"square":case"circle":if(n.scale.maxSize)return n.scale.maxSize;var a=u(t,r);return(a-2)*(a-2)}throw new Error(l.message.incompatibleChannel("size",e))}function u(e,t){
return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../log"),c=e("../../channel"),f=e("../../scale"),d=e("../../util");n.parseRange=r,n.RANGE_PROPERTIES=["range","rangeStep","scheme"],n.default=a},{"../../channel":13,"../../log":79,"../../scale":81,"../../util":89}],54:[function(e,t,n){"use strict";function r(e,t,n){return d.contains([c.ScaleType.TIME,c.ScaleType.UTC],e)?f.smallestUnit(n.timeUnit):d.contains([l.X,l.Y],t)}function a(e,t,n){if(d.contains([l.X,l.Y],e)&&t===c.ScaleType.POINT)return n.pointPadding}function i(e,t,n){if(void 0===e)return d.contains([l.X,l.Y],t)?n.bandPaddingInner:void 0}function o(e,t,n,r,a){if(void 0===e)return d.contains([l.X,l.Y],t)&&n===c.ScaleType.BAND?void 0!==a.bandPaddingOuter?a.bandPaddingOuter:r/2:void 0}function s(e,t){if(d.contains(["x","y","row","column"],e))return t.round}function u(e,t,n){return"size"===t&&"quantitative"===n.type||!(e.domain||n.bin||!d.contains([l.X,l.Y],t))}Object.defineProperty(n,"__esModule",{value:!0});var l=e("../../channel"),c=e("../../scale"),f=e("../../timeunit"),d=e("../../util");n.nice=r,n.padding=a,n.paddingInner=i,n.paddingOuter=o,n.round=s,n.zero=u},{"../../channel":13,"../../scale":81,"../../timeunit":86,"../../util":89}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BIN_LEGEND_SUFFIX="_bin_legend",n.BIN_LEGEND_LABEL_SUFFIX="_bin_legend_label"},{}],56:[function(e,t,n){"use strict";function r(e,t,n,r,i,o,l,c){if(!u.hasScale(n))return null;if(void 0!==e){if(u.supportScaleType(n,e))return e;var f=a(t,n,r,i,o,l,c);return s.warn(s.message.scaleTypeNotWorkWithChannel(n,e,f)),f}return a(t,n,r,i,o,l,c)}function a(e,t,n,r,a,o,f){if(c.contains(["row","column"],t))return l.ScaleType.BAND;switch(e){case"nominal":return"color"===t||"discrete"===u.getRangeType(t)?l.ScaleType.ORDINAL:i(t,r,a,o,f);case"ordinal":return"color"===t?l.ScaleType.ORDINAL:"discrete"===u.getRangeType(t)?(s.warn(s.message.discreteChannelCannotEncode(t,"ordinal")),l.ScaleType.ORDINAL):i(t,r,a,o,f);case"temporal":if("color"===t)return"sequential";if("discrete"===u.getRangeType(t))return s.warn(s.message.discreteChannelCannotEncode(t,"temporal")),l.ScaleType.ORDINAL;switch(n){case"hours":case"day":case"month":case"quarter":return i(t,r,a,o,f)}return l.ScaleType.TIME;case"quantitative":return"color"===t?"sequential":"discrete"===u.getRangeType(t)?(s.warn(s.message.discreteChannelCannotEncode(t,"quantitative")),l.ScaleType.ORDINAL):l.ScaleType.LINEAR}throw new Error(s.message.invalidFieldType(e))}function i(e,t,n,r,a){if(c.contains(["x","y"],e)){if("rect"===t)return l.ScaleType.BAND;if("bar"===t)return o(n,r,a)?l.ScaleType.POINT:l.ScaleType.BAND}return l.ScaleType.POINT}function o(e,t,n){return!e&&(void 0!==t?null!==t:!!n.rangeStep)}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../log"),u=e("../../channel"),l=e("../../scale"),c=e("../../util");n.default=r},{"../../channel":13,"../../log":79,"../../scale":81,"../../util":89}],57:[function(e,t,n){"use strict";function r(e){var t=null,n=null;return e.project.forEach(function(e,r){e.encoding===s.X?t=r:e.encoding===s.Y&&(n=r)}),{x:t,y:n}}function a(e,t,n){var r=o.channelSignalName(t,n),a=n===s.X?"width":"height",u=n+"(unit)",l=o.invert.bind(null,e,t,n);return{name:r,value:[],on:c.default.has(t)?[]:i(t,function(e,t){return e.push({events:t.between[0],update:l("["+u+", "+u+"]")}),e.push({events:t,update:"["+r+"[0], "+l("clamp("+u+", 0, "+a+")")+"]"}),e})}}function i(e,t){return e.events.reduce(function(e,n){return n.between?t(e,n):(l.warn(n+" is not an ordered event stream for interval selections"),e)},[])}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./selection"),s=e("../../channel"),u=e("../../util"),l=e("../../log"),c=e("./transforms/scales");n.BRUSH="_brush",n.SIZE="_size";var f={predicate:"vlInterval",signals:function(e,t){var r=[],o=[],f=t.name,d=f+n.SIZE;return t.translate&&!c.default.has(t)&&i(t,function(e,t){var r=t.between[0].filter||(t.between[0].filter=[]);r.push("!event.item || (event.item && "+("event.item.mark.name !== "+u.stringValue(f+n.BRUSH)+")"))}),t.project.forEach(function(n){if(n.encoding!==s.X&&n.encoding!==s.Y)return void l.warn("Interval selections only support x and y encoding channels.");var i=a(e,t,n.encoding);r.push(i),o.push("{field: "+u.stringValue(n.field)+", extent: "+i.name+"}")}),r.push({name:d,value:[],on:i(t,function(e,t){return e.push({events:t.between[0],update:"{x: x(unit), y: y(unit), width: 0, height: 0}"}),e.push({events:t,update:"{x: "+d+".x, y: "+d+".y, "+("width: abs(x(unit) - "+d+".x), height: abs(y(unit) - "+d+".y)}")}),e})},{name:f,update:"["+o.join(", ")+"]"}),r},tupleExpr:function(e,t){return"intervals: "+t.name},modifyExpr:function(e,t){var n=t.name+o.TUPLE;return n+", {unit: "+n+".unit}"},marks:function(e,t,a){var i=t.name,o=r(t),l=o.x,f=o.y;if(c.default.has(t))return a;var d={x:u.extend({},null!==l?{scale:e.scaleName(s.X),signal:i+"["+l+"].extent[0]"}:{value:0}),x2:u.extend({},null!==l?{scale:e.scaleName(s.X),signal:i+"["+l+"].extent[1]"}:{field:{group:"width"}}),y:u.extend({},null!==f?{scale:e.scaleName(s.Y),signal:i+"["+f+"].extent[0]"}:{value:0}),y2:u.extend({},null!==f?{scale:e.scaleName(s.Y),signal:i+"["+f+"].extent[1]"}:{field:{group:"height"}})};return[{name:void 0,type:"rect",encode:{enter:{fill:{value:"#eee"}},update:d}}].concat(a,{name:i+n.BRUSH,type:"rect",encode:{enter:{fill:{value:"transparent"}},update:d}})}};n.default=f,n.projections=r},{"../../channel":13,"../../log":79,"../../util":89,"./selection":59,"./transforms/scales":64}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./selection"),a=e("../../util"),i={predicate:"vlPoint",signals:function(e,t){var n=t.project,r="(item().isVoronoi ? datum.datum : datum)",i=n.map(function(e){return a.stringValue(e.field)}).join(", "),o=n.map(function(e){return r+"["+a.stringValue(e.field)+"]"}).join(", ");return[{name:t.name,value:{},on:[{events:t.events,update:"{fields: ["+i+"], values: ["+o+"]}"}]}]},tupleExpr:function(e,t){var n=t.name;return"fields: "+n+".fields, values: "+n+".values"},modifyExpr:function(e,t){return t.name+r.TUPLE}};n.default=i},{"../../util":89,"./selection":59}],59:[function(e,t,n){"use strict";function r(e,t){var n={},r=e.config.selection,a=function(a){if(!t.hasOwnProperty(a))return"continue";var i=t[a],o=r[i.type];for(var s in o)"encodings"===s&&i.fields||"fields"===s&&i.encodings||void 0!==i[s]&&i[s]!==!0||(i[s]=o[s]||i[s]);var u=n[a]=p.extend({},i,{name:e.getName(a),events:p.isString(i.on)?g.default(i.on,"scope"):i.on,domain:"data",resolve:"union"});m.forEachTransform(u,function(t){t.parse&&t.parse(e,i,u)})};for(var i in t)a(i);return n}function a(e,t){return l(e,function(r,a){var i=r.name,o=a.tupleExpr(e,r),s=a.modifyExpr(e,r);t.push.apply(t,a.signals(e,r)),m.forEachTransform(r,function(n){n.signals&&(t=n.signals(e,r,t)),n.modifyExpr&&(s=n.modifyExpr(e,r,s))}),t.push({name:i+n.TUPLE,on:[{events:{signal:i},update:"{unit: unit.datum && unit.datum._id, "+o+"}"}]},{name:i+n.MODIFY,on:[{events:{signal:i},update:"modify("+p.stringValue(i+n.STORE)+", "+s+")"}]})}),t}function i(e){var t=[{name:"unit",value:{},on:[{events:"mousemove",update:"group()._id ? group() : unit"}]}];return l(e,function(n,r){r.topLevelSignals&&t.push.apply(t,r.topLevelSignals(e,n)),m.forEachTransform(n,function(r){r.topLevelSignals&&(t=r.topLevelSignals(e,n,t))})}),t}function o(e,t){return t.concat(Object.keys(e.component.selection).map(function(e){return{name:e+n.STORE}}))}function s(e,t){var n=!1,r=t;return l(e,function(a,i){r=i.marks?i.marks(e,a,r):r,m.forEachTransform(a,function(i){n=n||i.clippedGroup,i.marks&&(r=i.marks(e,a,t,r))})}),n&&(r=[{type:"group",encode:{enter:{width:{field:{group:"width"}},height:{field:{group:"height"}},fill:{value:"transparent"},clip:{value:!0}}},marks:r}]),r}function u(e,t){var r=p.stringValue(e.name+n.STORE),a=b[e.resolve];return t=t||"datum",c(e).predicate+("("+r+", parent._id, "+t+", "+a+")")}function l(e,t){var n=e.component.selection;for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];t(a,c(a))}}function c(e){switch(e.type){case"single":return h.default;case"multi":return v.default;case"interval":return y.default}return null}function f(e,t,n,r){var a=p.stringValue(e.scaleName(n));return"data"===t.domain?"invert("+a+", "+r+")":r}function d(e,t){return e.name+"_"+t}Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../util"),m=e("./transforms/transforms"),g=e("vega-parser/src/parsers/event-selector"),h=e("./single"),v=e("./multi"),y=e("./interval");n.STORE="_store",n.TUPLE="_tuple",n.MODIFY="_modify",n.parseUnitSelection=r,n.assembleUnitSignals=a,n.assembleTopLevelSignals=i,n.assembleUnitData=o,n.assembleUnitMarks=s;var b={single:'"intersect", "all"',independent:'"intersect", "unit"',union:'"union", "all"',union_others:'"union", "others"',intersect:'"intersect", "all"',intersect_others:'"intersect", "others'};n.predicate=u,n.invert=f,n.channelSignalName=d},{"../../util":89,"./interval":57,"./multi":58,"./single":60,"./transforms/transforms":66,"vega-parser/src/parsers/event-selector":6}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./selection"),a=e("./multi"),i=e("../../util"),o={predicate:a.default.predicate,signals:a.default.signals,topLevelSignals:function(e,t){var n=t.name;return[{name:n,update:"data("+i.stringValue(n+r.STORE)+")[0]"}]},tupleExpr:function(e,t){var n=t.name,r=n+".values";return"fields: "+n+".fields, values: "+r+", "+t.project.map(function(e,t){return e.field+": "+r+"["+t+"]"}).join(", ")},modifyExpr:function(e,t){return t.name+r.TUPLE+", true"}};n.default=o},{"../../util":89,"./multi":58,"./selection":59}],61:[function(e,t,n){"use strict";function r(e){return"_"+e.replace(/\W/g,"_")}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../util"),i={has:function(e){return"single"===e.type&&e.bind&&"scales"!==e.bind},topLevelSignals:function(e,t,n){var i=t.name,o=t.project,s=t.bind,u="(item().isVoronoi ? datum.datum : datum)";return o.forEach(function(e){n.unshift({name:i+r(e.field),value:"",on:[{events:t.events,update:u+"["+a.stringValue(e.field)+"]"}],bind:s[e.field]||s[e.encoding]||s})}),n},signals:function(e,t,n){var i=t.name,o=t.project,s=n.filter(function(e){return e.name===i})[0],u=o.map(function(e){return a.stringValue(e.field)}).join(", "),l=o.map(function(e){return i+r(e.field)}).join(", ");return s.update="{fields: ["+u+"], values: ["+l+"]}",delete s.value,delete s.on,n}};n.default=i},{"../../../util":89}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="voronoi",a={has:function(e){return void 0!==e.nearest&&e.nearest!==!1},marks:function(e,t,n,a){var i=n[0],o=a.indexOf(i),s=i.name===e.getName("pathgroup"),u=function(e){return e.name&&e.name.indexOf(r)>=0},l={name:e.getName(r),type:"path",from:{data:e.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:"datum.x",y:"datum.y",size:[{signal:"width"},{signal:"height"}]}]};return s&&!i.marks.filter(u).length?(i.marks.push(l),a.splice(o,1,i)):s||a.filter(u).length||a.splice(o+1,0,l),a}};n.default=a},{}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r={has:function(e){return void 0!==e.fields||void 0!==e.encodings},parse:function(e,t,n){var r={};(t.fields||[]).forEach(function(e){return r[e]=null}),(t.encodings||[]).forEach(function(t){return r[e.field(t)]=t});var a=n.project||(n.project=[]);for(var i in r)r.hasOwnProperty(i)&&a.push({field:i,encoding:r[i]})}};n.default=r},{}],64:[function(e,t,n){"use strict";function r(e,t){var n=u.stringValue(e.scaleName(t));return"domain("+n+")"}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../log"),i=e("../../../scale"),o=e("../selection"),s=e("../interval"),u=e("../../../util"),l={clippedGroup:!0,has:function(e){return"interval"===e.type&&e.bind&&"scales"===e.bind},parse:function(e,t,n){var r=e.component.scales,s=n.scales=[];n.project.forEach(function(e){var t=e.encoding,u=r[t]&&r[t].main;return u&&i.hasContinuousDomain(u.type)?(u.domainRaw={signal:o.channelSignalName(n,t)},void s.push(t)):void a.warn("Scale bindings are currently only supported for scales with continuous domains.")})},topLevelSignals:function(e,t,n){return n.concat(t.scales.map(function(e){return{name:o.channelSignalName(t,e)}}))},signals:function(e,t,n){var r=t.name;return n=n.filter(function(e){return e.name!==r+s.SIZE&&e.name!==r+o.TUPLE&&e.name!==o.MODIFY}),t.scales.forEach(function(e){var t=n.filter(function(t){return t.name===r+"_"+e})[0];t.push="outer",delete t.value,delete t.update}),n}};n.default=l,n.domain=r},{"../../../log":79,"../../../scale":81,"../../../util":89,"../interval":57,"../selection":59}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../selection"),a="_toggle",i={has:function(e){return void 0!==e.toggle&&e.toggle!==!1},signals:function(e,t,n){return n.concat({name:t.name+a,value:!1,on:[{events:t.events,update:t.toggle}]})},modifyExpr:function(e,t,n){var i=t.name+r.TUPLE,o=t.name+a;return o+" ? null : "+i+", "+(o+" ? null : true, ")+(o+" ? "+i+" : null")}};n.default=i},{"../selection":59}],66:[function(e,t,n){"use strict";function r(e,t){for(var n in f)f[n].has(e)&&t(f[n])}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./project"),i=e("./toggle"),o=e("./translate"),s=e("./zoom"),u=e("./scales"),l=e("./inputs"),c=e("./nearest"),f={project:a.default,toggle:i.default,scales:u.default,translate:o.default,zoom:s.default,inputs:l.default,nearest:c.default};n.forEachTransform=r},{"./inputs":61,"./nearest":62,"./project":63,"./scales":64,"./toggle":65,"./translate":67,"./zoom":68}],67:[function(e,t,n){"use strict";function r(e,t){var n=t===o.X?"+":"-";return u.default.has(e)&&(n="+"===n?"-":"+"),n}function a(e,t,n,a,i){var l=t.name,d=i.filter(function(e){return e.name===l+"_"+n})[0],p=l+c,m=l+f,g=s.stringValue(e.scaleName(n)),h=".extent_"+n,v=r(t,n),y=v+" abs(span("+p+h+")) * "+(m+"."+n+" / "+p+"."+a),b="["+p+h+"[0] "+y+", "+(""+p+h+"[1] "+y+"]"),S="invert("+g+(n===o.X?", 0":", unit."+a)+")",E="invert("+g+(n===o.X?", unit."+a:", 0")+")";d.on.push({events:{signal:m},update:u.default.has(t)?b:"clampRange("+b+", "+S+", "+E+")"})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-parser/src/parsers/event-selector"),o=e("../../../channel"),s=e("../../../util"),u=e("./scales"),l=e("../interval"),c="_translate_anchor",f="_translate_delta",d={has:function(e){return"interval"===e.type&&void 0!==e.translate&&e.translate!==!1},signals:function(e,t,n){var r=t.name,s=u.default.has(t),d=s?"unit":r+l.SIZE,p=r+c,m=i.default(t.translate,"scope"),g=l.projections(t),h=g.x,v=g.y;return s||(m=m.map(function(e){return e.between[0].markname=r+l.BRUSH,e})),n.push({name:p,value:{},on:[{events:m.map(function(e){return e.between[0]}),update:"{x: x(unit), y: y(unit), "+("width: "+d+".width, height: "+d+".height, ")+(null!==h?"extent_x: "+(s?u.domain(e,o.X):"slice("+r+"_x)")+", ":"")+(null!==v?"extent_y: "+(s?u.domain(e,o.Y):"slice("+r+"_y)")+", ":"")+"}"}]},{name:r+f,value:{},on:[{events:m,update:"{x: x(unit) - "+p+".x, y: y(unit) - "+p+".y}"}]}),null!==h&&a(e,t,o.X,"width",n),null!==v&&a(e,t,o.Y,"height",n),n}};n.default=d},{"../../../channel":13,"../../../util":89,"../interval":57,"./scales":64,"vega-parser/src/parsers/event-selector":6}],68:[function(e,t,n){"use strict";function r(e,t,n,r,a){var u=t.name,f=a.filter(function(e){return e.name===u+"_"+n})[0],d=s.default.has(t),p=d?s.domain(e,n):f.name,m=""+u+l+"."+n,g=u+c,h=o.stringValue(e.scaleName(n)),v="["+m+" + ("+p+"[0] - "+m+") * "+g+", "+(m+" + ("+p+"[1] - "+m+") * "+g+"]"),y="invert("+h+(n===i.X?", 0":", unit."+r)+")",b="invert("+h+(n===i.X?", unit."+r:", 0")+")";f.on.push({events:{signal:g},update:d?v:"clampRange("+v+", "+y+", "+b+")"})}Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-parser/src/parsers/event-selector"),i=e("../../../channel"),o=e("../../../util"),s=e("./scales"),u=e("../interval"),l="_zoom_anchor",c="_zoom_delta",f={has:function(e){return"interval"===e.type&&void 0!==e.zoom&&e.zoom!==!1},signals:function(e,t,n){var f=t.name,d=f+c,p=a.default(t.zoom,"scope"),m=u.projections(t),g=m.x,h=m.y,v=o.stringValue(e.scaleName(i.X)),y=o.stringValue(e.scaleName(i.Y));s.default.has(t)||(p=p.map(function(e){return e.markname=f+u.BRUSH,e})),n.push({name:f+l,on:[{events:p,update:"{x: invert("+v+", x(unit)), y: invert("+y+", y(unit))}"}]},{name:d,on:[{events:p,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==g&&r(e,t,"x","width",n),null!==h&&r(e,t,"y","height",n);var b=n.filter(function(e){return e.name===f+u.SIZE});if(b.length){var S=b[0].name;b[0].on.push({events:{signal:d},update:"{x: "+S+".x, y: "+S+".y, "+("width: "+S+".width * "+d+" , ")+("height: "+S+".height * "+d+"}")})}return n}};n.default=f},{"../../../channel":13,"../../../util":89,"../interval":57,"./scales":64,"vega-parser/src/parsers/event-selector":6}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("tslib"),a=e("../axis"),i=e("../channel"),o=e("../config"),s=e("../data"),u=e("../encoding"),l=e("../encoding"),c=e("../fielddef"),f=e("../mark"),d=e("../scale"),p=e("../util"),m=e("./axis/parse"),g=e("./common"),h=e("./data/data"),v=e("./legend/parse"),y=e("./layout"),b=e("./model"),S=e("./mark/mark"),E=e("./scale/init"),O=e("./scale/parse"),_=e("../stack"),N=e("./selection/selection"),x=e("./mark/init"),T=function(e){function t(t,n,r){var a=e.call(this,t,n,r)||this;a.selection={},a.scales={},a.axes={},a.legends={},a.children=[];var i=void 0!==t.width?t.width:n?n.width:void 0,o=void 0!==t.height?t.height:n?n.height:void 0,s=f.isMarkDef(t.mark)?t.mark.type:t.mark,l=a.encoding=u.dropInvalidFieldDefs(s,t.encoding||{}),c=a.config=a.initConfig(t.config,n);a.stack=_.stack(s,l,c.stack),a.scales=a.initScales(s,l,c,i,o),a.markDef=x.initMarkDef(t.mark,l,a.scales,c),a.encoding=x.initEncoding(s,l,a.stack,c),a.axes=a.initAxes(l,c),a.legends=a.initLegend(l,c),a.selection=t.selection;var d=a.initSize(s,a.scales,i,o,c.cell,c.scale),p=d.width,m=void 0===p?a.width:p,g=d.height,h=void 0===g?a.height:g;return a.width=m,a.height=h,a}return r.__extends(t,e),t.prototype.initConfig=function(e,t){for(var n=p.mergeDeep(p.duplicate(o.defaultConfig),t?t.config:{},e),r=!1;null!==t;){if(t.isFacet()){r=!0;break}t=t.parent}return r&&(n.cell=p.extend({},n.cell,n.facet.cell)),n},t.prototype.initScales=function(e,t,n,r,a){var o=[];return i.UNIT_SCALE_CHANNELS.reduce(function(s,u){if(l.channelHasField(t,u)||u===i.X&&l.channelHasField(t,i.X2)||u===i.Y&&l.channelHasField(t,i.Y2)){var c=s[u]=E.default(u,t[u],n,e,u===i.X?r:u===i.Y?a:void 0,o);u!==i.X&&u!==i.Y||c.rangeStep&&o.push(c.rangeStep)}return s},{})},t.prototype.initSize=function(e,t,n,r,a,o){if(void 0===n)if(t[i.X])d.hasDiscreteDomain(t[i.X].type)&&t[i.X].rangeStep||(n=a.width);else if(e===f.TEXT)n=o.textXRangeStep;else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");n=o.rangeStep}if(void 0===r)if(t[i.Y])d.hasDiscreteDomain(t[i.Y].type)&&t[i.Y].rangeStep||(r=a.height);else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");r=o.rangeStep}return{width:n,height:r}},t.prototype.initAxes=function(e,t){return[i.X,i.Y].reduce(function(n,o){var s=e[o];if(c.isFieldDef(s)||o===i.X&&c.isFieldDef(e.x2)||o===i.Y&&c.isFieldDef(e.y2)){var u=c.isFieldDef(s)?s.axis:null;if(null!==u&&u!==!1){var l={};a.VL_ONLY_AXIS_PROPERTIES.forEach(function(e){void 0!==t.axis[e]&&(l[e]=t.axis[e])}),n[o]=r.__assign({},l,u)}}return n},{})},t.prototype.initLegend=function(e,t){return i.NONSPATIAL_SCALE_CHANNELS.reduce(function(t,n){var a=e[n];if(c.isFieldDef(a)){var i=a.legend;null!==i&&i!==!1&&(t[n]=r.__assign({},i))}return t},{})},t.prototype.parseData=function(){this.component.data=h.parseUnitData(this)},t.prototype.parseSelection=function(){this.component.selection=N.parseUnitSelection(this,this.selection)},t.prototype.parseLayoutData=function(){this.component.layout=y.parseUnitLayout(this)},t.prototype.parseScale=function(){this.component.scales=O.default(this)},t.prototype.parseMark=function(){this.component.mark=S.parseMark(this)},t.prototype.parseAxis=function(){this.component.axes=m.parseAxisComponent(this,[i.X,i.Y])},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){this.component.legends=v.parseLegendComponent(this)},t.prototype.assembleSignals=function(e){return N.assembleUnitSignals(this,e)},t.prototype.assembleSelectionData=function(e){return N.assembleUnitData(this,e)},t.prototype.assembleData=function(e){return h.assembleData(this,e)},t.prototype.assembleLayout=function(e){return y.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return N.assembleUnitMarks(this,this.component.mark)},t.prototype.assembleParentGroupProperties=function(e){return g.applyConfig({},e,f.FILL_STROKE_CONFIG.concat(["clip"]))},t.prototype.channels=function(){return i.UNIT_CHANNELS},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,r=p.duplicate(this.encoding);return n={mark:this.markDef,encoding:r},e||(n.config=p.duplicate(this.config)),t||(n.data=p.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return l.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){return this.encoding[e]||{}},t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=p.extend({binSuffix:d.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),c.field(n,t)},t.prototype.dataTable=function(){return this.dataName(l.isAggregate(this.encoding)?s.SUMMARY:s.SOURCE)},t.prototype.isUnit=function(){return!0},t}(b.Model);n.UnitModel=T},{"../axis":11,"../channel":13,"../config":71,"../data":72,"../encoding":74,"../fielddef":76,"../mark":80,"../scale":81,"../stack":85,"../util":89,"./axis/parse":15,"./common":17,"./data/data":20,"./layout":33,"./legend/parse":35,"./mark/init":39,"./mark/mark":41,"./model":49,"./scale/init":51,"./scale/parse":52,"./selection/selection":59,tslib:5}],70:[function(e,t,n){"use strict";function r(e,t){u[e]=t}function a(e){delete u[e]}function i(e){var t=s.isMarkDef(e.mark)?e.mark.type:e.mark,n=u[t];if(n)return n(e);throw new Error("Unregistered composite mark "+t)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("tslib"),s=e("./mark");n.ERRORBAR="error-bar";var u={};n.add=r,n.remove=a,n.normalize=i,r(n.ERRORBAR,function(e){var t=(e.mark,e.encoding),n=o.__rest(e,["mark","encoding"]),r=(t.size,o.__rest(t,["size"])),a=(t.x2,t.y2,o.__rest(t,["x2","y2"]));return o.__assign({},n,{layer:[{mark:"rule",encoding:r},{mark:"tick",encoding:a},{mark:"tick",encoding:o.__assign({},a,t.x2?{x:t.x2}:{},t.y2?{y:t.y2}:{})}]})})},{"./mark":80,tslib:5}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./axis"),a=e("./legend"),i=e("./mark"),o=e("./scale"),s=e("./selection");n.defaultCellConfig={width:200,height:200,fill:"transparent"},n.defaultFacetCellConfig={stroke:"#ccc",strokeWidth:1};var u={color:"#000000",opacity:.4,offset:0};n.defaultFacetConfig={axis:{},grid:u,cell:n.defaultFacetCellConfig},n.defaultOverlayConfig={line:!1,pointStyle:{filled:!0},lineStyle:{}},n.defaultConfig={padding:5,numberFormat:"s",timeFormat:"%b %d, %Y",countTitle:"Number of Records",cell:n.defaultCellConfig,mark:i.defaultMarkConfig,area:{},bar:i.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{},square:{},text:i.defaultTextConfig,tick:i.defaultTickConfig,overlay:n.defaultOverlayConfig,scale:o.defaultScaleConfig,axis:r.defaultAxisConfig,legend:a.defaultLegendConfig,facet:n.defaultFacetConfig,selection:s.defaultConfig}},{"./axis":11,"./legend":78,"./mark":80,"./scale":81,"./selection":82}],72:[function(e,t,n){"use strict";function r(e){return!!e.url}function a(e){return!!e.values}Object.defineProperty(n,"__esModule",{value:!0}),n.isUrlData=r,n.isInlineData=a,n.SUMMARY="summary",n.SOURCE="source",n.STACKED="stacked",n.LAYOUT="layout"},{}],73:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function a(e){if(l.isNumber(e))return e>4&&c.warn(c.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(c.message.invalidTimeUnit("quarter",e))}function i(e){if(l.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(r!==-1)return r+"";var a=t.substr(0,3),i=n.SHORT_MONTHS.indexOf(a);if(i!==-1)return i+"";throw new Error(c.message.invalidTimeUnit("month",e))}function o(e){if(l.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(r!==-1)return r+"";var a=t.substr(0,3),i=n.SHORT_DAYS.indexOf(a);if(i!==-1)return i+"";throw new Error(c.message.invalidTimeUnit("day",e))}function s(e,t){var n=new Date(0,0,1,0,0,0,0);if(void 0!==e.day)if(l.keys(e).length>1)c.warn(c.message.droppedDay(e)),e=l.duplicate(e),delete e.day;else{n.setFullYear(f);var r=t?o(e.day):e.day;n.setDate(+r+1)}if(void 0!==e.year&&n.setFullYear(e.year),void 0!==e.quarter){var s=t?a(e.quarter):e.quarter;n.setMonth(3*+s)}if(void 0!==e.month){var u=t?i(e.month):e.month;n.setMonth(+u)}return void 0!==e.date&&n.setDate(e.date),void 0!==e.hours&&n.setHours(e.hours),void 0!==e.minutes&&n.setMinutes(e.minutes),void 0!==e.seconds&&n.setSeconds(e.seconds),void 0!==e.milliseconds&&n.setMilliseconds(e.milliseconds),n.getTime()}function u(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&l.keys(e).length>1&&(c.warn(c.message.droppedDay(e)),e=l.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(f):n.push(0),void 0!==e.month){var r=t?i(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var s=t?a(e.quarter):e.quarter;n.push(s+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var u=t?o(e.day):e.day;n.push(u+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var m=p[d];void 0!==e[m]?n.push(e[m]):n.push(0)}return"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./util"),c=e("./log"),f=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.timestamp=s,n.dateTimeExpr=u},{"./log":79,"./util":89}],74:[function(e,t,n){"use strict";function r(e,t){var n=e&&e[t];return!!n&&(d.isArray(n)?d.some(n,function(e){return!!e.field}):c.isFieldDef(n))}function a(e){return d.some(f.CHANNELS,function(t){if(r(e,t)){var n=e[t];return d.isArray(n)?d.some(n,function(e){return!!e.aggregate}):c.isFieldDef(n)&&!!n.aggregate}return!1})}function i(e,t){return t=d.duplicate(t),Object.keys(t).forEach(function(n){if(!f.supportMark(n,e))return p.warn(p.message.incompatibleChannel(n,e)),void delete t[n];if("size"===n&&"line"===e){var r=t[n];return void(c.isFieldDef(r)&&r.aggregate&&(p.warn(p.message.incompatibleChannel(n,e,"when the field is aggregated.")),delete t[n]))}if(d.isArray(t[n]))t[n]=t[n].reduce(function(e,t){return c.isFieldDef(t)||c.isValueDef(t)?e.push(c.normalize(t,n)):p.warn(p.message.emptyFieldDef(t,n)),e},[]);else{var a=t[n];if(void 0===a.field&&void 0===a.value)return p.warn(p.message.emptyFieldDef(a,n)),void delete t[n];c.normalize(a,n)}}),t}function o(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function s(e){var t=[];return f.CHANNELS.forEach(function(n){if(r(e,n)){var a=e[n];(d.isArray(a)?a:[a]).forEach(function(e){t.push(e)})}}),t}function u(e,t,n){e&&Object.keys(e).forEach(function(r){var a=r;d.isArray(e[a])?e[a].forEach(function(e){t.call(n,e,a)}):t.call(n,e[a],a)})}function l(e,t,n,r){return e?Object.keys(e).reduce(function(n,a){var i=a;return d.isArray(e[i])?e[i].reduce(function(e,n){return t.call(r,e,n,i)},n):t.call(r,n,e[i],i)},n):n}Object.defineProperty(n,"__esModule",{value:!0});var c=e("./fielddef"),f=e("./channel"),d=e("./util"),p=e("./log");n.channelHasField=r,n.isAggregate=a,n.dropInvalidFieldDefs=i,n.isRanged=o,n.fieldDefs=s,n.forEach=u,n.reduce=l},{"./channel":13,"./fielddef":76,"./log":79,"./util":89}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],76:[function(e,t,n){"use strict";function r(e){return e&&!!e.field}function a(e){return e&&"value"in e&&void 0!==e.value}function i(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,a=t.suffix;if(c(e))n="count_*";else{var i=void 0;t.nofn||(e.bin?(i="bin",a=t.binSuffix):e.aggregate?i=String(t.aggregate||e.aggregate):e.timeUnit&&(i=String(e.timeUnit))),i&&(n=i+"_"+n)}return a&&(n=n+"_"+a),r&&(n=r+"_"+n),t.datum&&(n='datum["'+n+'"]'),n}function o(e){return!!v.contains([h.NOMINAL,h.ORDINAL],e.type)||(!!e.bin||e.type===h.TEMPORAL&&!!e.timeUnit)}function s(e){return e&&r(e)&&o(e)}function u(e){return e&&r(e)&&!o(e)}function l(){return{field:"*",aggregate:"count",type:h.QUANTITATIVE}}function c(e){return"count"===e.aggregate}function f(e,t){if(null!=e.title)return e.title;if(c(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toString().toUpperCase()+"("+e.field+")":e.field}function d(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";var n=m.getSupportedRole(t).measure;return n?"quantitative":"nominal"}function p(e,t){if(e.field){var n=h.getFullName(e.type);if(n)e.type=n;else{var r=d(e,t);g.warn(g.message.emptyOrInvalidFieldType(e.type,t,r)),e.type=r}}return e}Object.defineProperty(n,"__esModule",{value:!0});var m=e("./channel"),g=e("./log"),h=e("./type"),v=e("./util");n.isFieldDef=r,n.isValueDef=a,n.field=i,n.isDimension=s,n.isMeasure=u,n.count=l,n.isCount=c,n.title=f,n.defaultType=d,n.normalize=p},{"./channel":13,"./log":79,"./type":88,"./util":89}],77:[function(e,t,n){"use strict";function r(e){return e&&!!e.field&&void 0!==e.equal}function a(e){return!!(e&&e.field&&f.isArray(e.range)&&2===e.range.length)}function i(e){return e&&!!e.field&&(f.isArray(e.oneOf)||f.isArray(e.in))}function o(e){if(f.isString(e))return e;var t=e.timeUnit?"time("+c.fieldExpr(e.timeUnit,e.field)+")":l.field(e,{datum:!0});if(r(e))return t+"==="+s(e.equal,e.timeUnit);if(i(e)){var n=e.oneOf||e.in;return"indexof(["+n.map(function(t){return s(t,e.timeUnit)}).join(",")+"], "+t+") !== -1"}if(a(e)){var o=e.range[0],u=e.range[1];if(null!==o&&null!==u)return"inrange("+t+", "+s(o,e.timeUnit)+", "+s(u,e.timeUnit)+")";if(null!==o)return t+" >= "+o;if(null!==u)return t+" <= "+u}}function s(e,t){if(u.isDateTime(e)){var n=u.dateTimeExpr(e,!0);return"time("+n+")"}if(c.isSingleTimeUnit(t)){var r={};r[t]=e;var n=u.dateTimeExpr(r,!0);return"time("+n+")"}return JSON.stringify(e)}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./datetime"),l=e("./fielddef"),c=e("./timeunit"),f=e("./util");n.isEqualFilter=r,n.isRangeFilter=a,n.isOneOfFilter=i,n.expression=o},{"./datetime":73,"./fielddef":76,"./timeunit":86,"./util":89}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"]},{}],79:[function(e,t,n){"use strict";function r(e){var t=p=new m;e(t),o()}function a(e){return function(){var t=p=new m;e(t),o()}}function i(e){return p=e}function o(){return p=d}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.warn.apply(p,arguments)}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.info.apply(p,arguments)}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];
p.debug.apply(p,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var c=e("vega-util"),f=e("./channel"),d=c.logger(c.Warn),p=d,m=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=m,n.runLocalLogger=r,n.wrap=a,n.set=i,n.reset=o,n.warn=s,n.info=u,n.debug=l;var g;!function(e){function t(e){return'Invalid field type "'+e+'"'}function n(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function r(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function a(e,t,n){return e+" dropped as it is incompatible with "+t+n?"when "+n:""}function i(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function o(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function s(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function u(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function l(e,t){return"Specified orient "+e+" overridden with "+t}function c(e){return"Cannot use "+e+" with non-color channel."}function d(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function p(e){return"Unaggregated domain not applicable for "+e+" since it produces values outside the origin domain of the source data."}function m(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function g(e){return"Cannot use custom "+e+" with row or column channel. Please use width, height, or spacing instead."}function h(e){return"rangeStep for "+e+" is dropped as top-level "+(e===f.X?"width":"height")+" is provided."}function v(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function y(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function b(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function S(e){return"Cannot stack "+e+" if there is already "+e+"2"}function E(e){return"Cannot stack non-linear scale ("+e+")"}function O(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function _(e,t){return"Invalid "+e+": "+t}function N(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+(e+"").replace("day","date")+"."}function x(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.DEPRECATED_FILTER_NULL="filterNull is deprecated. Please use filterInvalid instead.",e.invalidFieldType=t,e.emptyOrInvalidFieldType=n,e.emptyFieldDef=r,e.incompatibleChannel=a,e.facetChannelShouldBeDiscrete=i,e.discreteChannelCannotEncode=o,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=s,e.unclearOrientDiscreteOrEmpty=u,e.orientOverridden=l,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=c,e.unaggregateDomainHasNoEffectForRawField=d,e.unaggregateDomainWithNonSharedDomainOp=p,e.unaggregatedDomainWithLogScale=m,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.CANNOT_USE_PADDING_WITH_FACET="Cannot use padding with facet's scale.  Please use spacing instead.",e.cannotUseRangePropertyWithFacet=g,e.rangeStepDropped=h,e.scaleTypeNotWorkWithChannel=v,e.scalePropertyNotWorkWithScaleType=y,e.scaleTypeNotWorkWithMark=b,e.INVAID_DOMAIN="Invalid scale domain",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=S,e.cannotStackNonLinearScale=E,e.cannotStackNonSummativeAggregate=O,e.invalidTimeUnit=_,e.dayReplacedWithDate=N,e.droppedDay=x}(g=n.message||(n.message={}))},{"./channel":13,"vega-util":8}],80:[function(e,t,n){"use strict";function r(e){return e.type}function a(e){var t=r(e)?e.type:e;return t in s}Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(i=n.Mark||(n.Mark={})),n.AREA=i.AREA,n.BAR=i.BAR,n.LINE=i.LINE,n.POINT=i.POINT,n.TEXT=i.TEXT,n.TICK=i.TICK,n.RECT=i.RECT,n.RULE=i.RULE,n.CIRCLE=i.CIRCLE,n.SQUARE=i.SQUARE,n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=r;var s=o.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=a,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTextConfig={baseline:"middle"},n.defaultTickConfig={thickness:1}},{"./util":89}],81:[function(e,t,n){"use strict";function r(e){return e in m}function a(e){return e in p}function i(e){return e in d}function o(e){return e&&!!e.name}function s(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return"linear"===e;case"round":return i(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return f.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return i(e)||"sequential"===e;case"nice":return i(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return!r(e)&&!f.contains(["log","time","utc"],e)}throw new Error("Invalid scale property "+t+".")}function u(e,t){switch(t){case"range":if("x"===e||"y"===e)return c.message.CANNOT_USE_RANGE_WITH_POSITION;if("row"===e||"column"===e)return c.message.cannotUseRangePropertyWithFacet("range");return;case"rangeStep":if("row"===e||"column"===e)return c.message.cannotUseRangePropertyWithFacet("rangeStep");return;case"padding":case"paddingInner":case"paddingOuter":if("row"===e||"column"===e)return c.message.CANNOT_USE_PADDING_WITH_FACET;return;case"interpolate":case"scheme":if("color"!==e)return c.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":return}throw new Error('Invalid scale property "${propName}".')}Object.defineProperty(n,"__esModule",{value:!0});var l,c=e("./log"),f=e("./util");!function(e){e.LINEAR="linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.POINT="point",e.BAND="band"}(l=n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","log","pow","sqrt","time","utc","sequential","ordinal","point","band"],n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","log","pow","sqrt","time","utc"];var d=f.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var p=f.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","point","band"];var m=f.toSet(n.DISCRETE_DOMAIN_SCALES);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=r,n.hasContinuousDomain=a,n.isContinuousToContinuous=i,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]},n.isExtendedScheme=o,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate"],n.scaleTypeSupportProperty=s,n.channelScalePropertyIncompatability=u},{"./log":79,"./util":89}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultConfig={single:{on:"click",fields:["_id"]},multi:{on:"click",fields:["_id"],toggle:"event.shiftKey"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel"}}},{}],83:[function(e,t,n){"use strict";function r(e){return!!e&&!!e.field&&!!e.op}Object.defineProperty(n,"__esModule",{value:!0}),n.isSortField=r},{}],84:[function(e,t,n){"use strict";function r(e){return void 0!==e.facet}function a(e){if(i(e)){var t=_.channelHasField(e.encoding,A.ROW),n=_.channelHasField(e.encoding,A.COLUMN);return t||n}return!1}function i(e){return!!e.mark}function o(e){return void 0!==e.layer}function s(e){if(r(e))return l(e);if(o(e))return c(e);if(a(e))return f(e);if(i(e))return p(e);throw new Error(N.message.INVALID_SPEC)}function u(e){return o(e)?c(e):p(e)}function l(e){var t=e.spec,n=S.__rest(e,["spec"]);return S.__assign({},n,{spec:u(t)})}function c(e){var t=e.layer,n=S.__rest(e,["layer"]);return S.__assign({},n,{layer:t.map(u)})}function f(e){var t=e.encoding,n=t.row,r=t.column,a=S.__rest(t,["row","column"]),i=e.mark,o=(e.encoding,S.__rest(e,["mark","encoding"]));return S.__assign({},o,{facet:S.__assign({},n?{row:n}:{},r?{column:r}:{}),spec:p({mark:i,encoding:a})})}function d(e){return x.isPrimitiveMark(e.mark)}function p(e){var t=e.config,n=t&&t.overlay,r=n&&e.mark===x.AREA&&M.contains(["linepoint","line"],n.area),a=n&&(n.line&&e.mark===x.LINE||"linepoint"===n.area&&e.mark===x.AREA);return d(e)?_.isRanged(e.encoding)?m(e):a||r?g(e,a,r):e:O.normalize(e)}function m(e){var t=_.channelHasField(e.encoding,A.X),n=_.channelHasField(e.encoding,A.Y),r=_.channelHasField(e.encoding,A.X2),a=_.channelHasField(e.encoding,A.Y2);if(r&&!t||a&&!n){var i=M.duplicate(e);return r&&!t&&(i.encoding.x=i.encoding.x2,delete i.encoding.x2),a&&!n&&(i.encoding.y=i.encoding.y2,delete i.encoding.y2),i}return e}function g(e,t,n){var r=["name","description","data","transform"],a=M.omit(e,r.concat("config")),i=M.duplicate(e.config);delete i.overlay;var o=T.stack(e.mark,e.encoding,e.config?e.config.stack:void 0),s=S.__assign({},M.pick(e,r),{layer:[a]},M.keys(i).length>0?{config:i}:{});if(n){var u=M.duplicate(a);u.mark=x.LINE;var l=M.extend({},E.defaultOverlayConfig.lineStyle,e.config.overlay.lineStyle,o?{stacked:o.offset}:null);M.keys(l).length>0&&(u.config={mark:l}),s.layer.push(u)}if(t){var c=M.duplicate(a);c.mark=x.POINT;var l=M.extend({},E.defaultOverlayConfig.pointStyle,e.config.overlay.pointStyle,o?{stacked:o.offset}:null);M.keys(l).length>0&&(c.config={mark:l}),s.layer.push(c)}return s}function h(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),r=M.hash(n);e[r]=e[r]||t}),e}function v(e,t){return void 0===t&&(t={}),o(e)?e.layer.forEach(function(e){i(e)?h(t,k.fieldDefs(e.encoding)):v(e,t)}):r(e)?(h(t,k.fieldDefs(e.facet)),v(e.spec,t)):h(t,k.fieldDefs(e.encoding)),t}function y(e){return M.vals(v(e))}function b(e){return!!x.isPrimitiveMark(e.mark)&&null!==T.stack(e.mark,e.encoding,e.config?e.config.stack:void 0)}Object.defineProperty(n,"__esModule",{value:!0});var S=e("tslib"),E=e("./config"),O=e("./compositemark"),_=e("./encoding"),N=e("./log"),x=e("./mark"),T=e("./stack"),A=e("./channel"),k=e("./encoding"),M=e("./util");n.isFacetSpec=r,n.isFacetedUnitSpec=a,n.isUnitSpec=i,n.isLayerSpec=o,n.normalize=s,n.fieldDefs=y,n.isStacked=b},{"./channel":13,"./compositemark":70,"./config":71,"./encoding":74,"./log":79,"./mark":80,"./stack":85,"./util":89,tslib:5}],85:[function(e,t,n){"use strict";function r(e,t,r){var d=l.isMarkDef(e)?e.type:e;if(!f.contains(n.STACKABLE_MARKS,d))return null;if(!s.isAggregate(t))return null;var p=o.STACK_GROUP_CHANNELS.reduce(function(e,n){if(s.channelHasField(t,n)){var r=t[n];(f.isArray(r)?r:[r]).forEach(function(t){u.isFieldDef(t)&&!t.aggregate&&e.push({channel:n,fieldDef:t})})}return e},[]);if(0===p.length)return null;var m=u.isFieldDef(t.x),g=u.isFieldDef(t.y),h=u.isFieldDef(t.x)&&!!t.x.aggregate,v=u.isFieldDef(t.y)&&!!t.y.aggregate;if(h!==v){var y=h?o.X:o.Y,b=t[y],S=b.aggregate,E=b.scale,O=null;return O=void 0!==b.stack?b.stack:f.contains(n.STACK_BY_DEFAULT_MARKS,d)&&void 0===r?"zero":r,O&&"none"!==O?E&&E.type&&E.type!==c.ScaleType.LINEAR?(a.warn(a.message.cannotStackNonLinearScale(E.type)),null):s.channelHasField(t,y===o.X?o.X2:o.Y2)?(a.warn(a.message.cannotStackRangedMark(y)),null):f.contains(i.SUM_OPS,S)?{groupbyChannel:h?g?o.Y:null:m?o.X:null,fieldChannel:y,stackBy:p,offset:O}:(a.warn(a.message.cannotStackNonSummativeAggregate(S)),null):null}return null}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./log"),i=e("./aggregate"),o=e("./channel"),s=e("./encoding"),u=e("./fielddef"),l=e("./mark"),c=e("./scale"),f=e("./util");n.STACKABLE_MARKS=[l.BAR,l.AREA,l.RULE,l.POINT,l.CIRCLE,l.SQUARE,l.LINE,l.TEXT,l.TICK],n.STACK_BY_DEFAULT_MARKS=[l.BAR,l.AREA],n.stack=r},{"./aggregate":10,"./channel":13,"./encoding":74,"./fielddef":76,"./log":79,"./mark":80,"./scale":81,"./util":89}],86:[function(e,t,n){"use strict";function r(e){return!!m[e]}function a(e,t){var r=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(o(e,n))switch(n){case c.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case c.YEAR:r.setFullYear(t.getFullYear());break;case c.QUARTER:r.setMonth(3*Math.floor(t.getMonth()/3));break;case c.MONTH:r.setMonth(t.getMonth());break;case c.DATE:r.setDate(t.getDate());break;case c.HOURS:r.setHours(t.getHours());break;case c.MINUTES:r.setMinutes(t.getMinutes());break;case c.SECONDS:r.setSeconds(t.getSeconds());break;case c.MILLISECONDS:r.setMilliseconds(t.getMilliseconds())}}),r}function i(e){return!!g[e]}function o(e,t){var n=e.toString(),r=t.toString(),a=n.indexOf(r);return a>-1&&(t!==c.SECONDS||0===a||"i"!==n.charAt(a-1))}function s(e,t){function r(e){return e===c.QUARTER?"(quarter("+a+")-1)":e+"("+a+")"}var a='datum["'+t+'"]',i=n.SINGLE_TIMEUNITS.reduce(function(t,n){return o(e,n)&&(t[n]=r(n)),t},{});return i.day&&d.keys(i).length>1&&(p.warn(p.message.dayReplacedWithDate(e)),delete i.day,i.date=r(c.DATE)),f.dateTimeExpr(i)}function u(e){if(e)return o(e,c.SECONDS)?"second":o(e,c.MINUTES)?"minute":o(e,c.HOURS)?"hour":o(e,c.DAY)||o(e,c.DATE)?"day":o(e,c.MONTH)?"month":o(e,c.YEAR)?"year":void 0}function l(e,t,n){if(e){var r=[],a="",i=o(e,c.YEAR);o(e,c.QUARTER)&&(a="'Q' + quarter("+t+")"),o(e,c.MONTH)&&r.push(n!==!1?"%b":"%B"),o(e,c.DAY)?r.push(n?"%a":"%A"):o(e,c.DATE)&&r.push("%d"+(i?",":"")),i&&r.push(n?"%y":"%Y");var s=[];o(e,c.HOURS)&&s.push("%H"),o(e,c.MINUTES)&&s.push("%M"),o(e,c.SECONDS)&&s.push("%S"),o(e,c.MILLISECONDS)&&s.push("%L");var u=[];return r.length>0&&u.push(r.join(" ")),s.length>0&&u.push(s.join(":")),u.length>0&&(a&&(a+=" + ' ' + "),a+="timeFormat("+t+", '"+u.join(" ")+"')"),a||void 0}}Object.defineProperty(n,"__esModule",{value:!0});var c,f=e("./datetime"),d=e("./util"),p=e("./log");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth"}(c=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[c.YEAR,c.QUARTER,c.MONTH,c.DAY,c.DATE,c.HOURS,c.MINUTES,c.SECONDS,c.MILLISECONDS];var m=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=r,n.convert=a,n.MULTI_TIMEUNITS=[c.YEARQUARTER,c.YEARQUARTERMONTH,c.YEARMONTH,c.YEARMONTHDATE,c.YEARMONTHDATEHOURS,c.YEARMONTHDATEHOURSMINUTES,c.YEARMONTHDATEHOURSMINUTESSECONDS,c.QUARTERMONTH,c.HOURSMINUTES,c.HOURSMINUTESSECONDS,c.MINUTESSECONDS,c.SECONDSMILLISECONDS];var g=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=i,n.TIMEUNITS=[c.YEAR,c.QUARTER,c.MONTH,c.DAY,c.DATE,c.HOURS,c.MINUTES,c.SECONDS,c.MILLISECONDS,c.YEARQUARTER,c.YEARQUARTERMONTH,c.YEARMONTH,c.YEARMONTHDATE,c.YEARMONTHDATEHOURS,c.YEARMONTHDATEHOURSMINUTES,c.YEARMONTHDATEHOURSMINUTESSECONDS,c.QUARTERMONTH,c.HOURSMINUTES,c.HOURSMINUTESSECONDS,c.MINUTESSECONDS,c.SECONDSMILLISECONDS],n.containsTimeUnit=o,n.fieldExpr=s,n.smallestUnit=u,n.formatExpression=l},{"./datetime":73,"./log":79,"./util":89}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],88:[function(e,t,n){"use strict";function r(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var a;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(a=n.Type||(n.Type={})),n.QUANTITATIVE=a.QUANTITATIVE,n.ORDINAL=a.ORDINAL,n.TEMPORAL=a.TEMPORAL,n.NOMINAL=a.NOMINAL,n.getFullName=r},{}],89:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function a(e,t){var n=y(e);return t.forEach(function(e){delete n[e]}),n}function i(e){return O.isString(e)||O.isNumber(e)||b(e)?String(e):S(e)}function o(e,t){return e.indexOf(t)>-1}function s(e,t){return e.filter(function(e){return!o(t,e)})}function u(e,t){return e.concat(s(t,e))}function l(e,t,n,r){if(e.reduce)return e.reduce.call(r,t,n);for(var a in e)e.hasOwnProperty(a)&&(n=t.call(r,n,e[a],a,e));return n}function c(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function f(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function d(e){return[].concat.apply([],e)}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,a=t;r<a.length;r++){var i=a[r];e=m(e,i)}return e}function m(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||O.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=p(t[n].constructor===Array?[]:{},t[n]):p(e[n],t[n]));return e}function g(e,t){for(var n,r=[],a={},i=0,o=e;i<o.length;i++){var s=o[i];n=t(s),n in a||(a[n]=1,r.push(s))}return r}function h(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function v(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function y(e){return JSON.parse(JSON.stringify(e))}function b(e){return e===!0||e===!1}Object.defineProperty(n,"__esModule",{value:!0});var S=e("json-stable-stringify"),E=e("vega-util");n.extend=E.extend,n.isArray=E.isArray,n.isObject=E.isObject,n.isNumber=E.isNumber,n.isString=E.isString,n.truncate=E.truncate,n.toSet=E.toSet,n.stringValue=E.stringValue;var O=e("vega-util");n.pick=r,n.omit=a,n.hash=i,n.contains=o,n.without=s,n.union=u,n.reduce=l,n.some=c,n.every=f,n.flatten=d,n.mergeDeep=p,n.unique=g,n.differ=h,n.keys=Object.keys,n.vals=v,n.duplicate=y,n.isBoolean=b},{"json-stable-stringify":1,"vega-util":8}],90:[function(e,t,n){"use strict";function r(e,t,r){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===r&&(r=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var i=a.isMarkDef(e.mark)?e.mark.type:e.mark,s=e.encoding,u=t[i],l=r[i];for(var c in u)if(!(u[c]in s))return'Missing encoding channel "'+u[c]+'" for mark "'+i+'"';for(var f in s)if(!l[f])return'Encoding channel "'+f+'" is not supported by mark type "'+i+'"';return i!==o.BAR||s.x||s.y?null:"Missing both x and y for bar"}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./mark"),i=e("./util"),o=e("./mark");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:i.toSet(["row","column","x","y","size","color","detail"]),line:i.toSet(["row","column","x","y","color","detail"]),area:i.toSet(["row","column","x","y","color","detail"]),tick:i.toSet(["row","column","x","y","color","detail"]),circle:i.toSet(["row","column","x","y","color","size","detail"]),square:i.toSet(["row","column","x","y","color","size","detail"]),point:i.toSet(["row","column","x","y","color","size","detail","shape"]),text:i.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=r},{"./mark":80,"./util":89}],91:[function(e,t,n){"use strict";function r(e){return!o.isArray(e)&&("fields"in e&&!("data"in e))}function a(e){return!o.isArray(e)&&("fields"in e&&"data"in e)}function i(e){return!o.isArray(e)&&!("fields"in e)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./util");n.isDataRefUnionedDomain=r,n.isFieldRefUnionDomain=a,n.isDataRefDomain=i},{"./util":89}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.axis=e("./axis"),n.aggregate=e("./aggregate"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var r=e("./compile/compile");n.compile=r.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":9,"./aggregate":10,"./axis":11,"./bin":12,"./channel":13,"./compile/compile":18,"./compositemark":70,"./config":71,"./data":72,"./datetime":73,"./encoding":74,"./facet":75,"./fielddef":76,"./legend":78,"./mark":80,"./scale":81,"./sort":83,"./spec":84,"./stack":85,"./timeunit":86,"./transform":87,"./type":88,"./util":89,"./validate":90}]},{},[92])(92)});
//# sourceMappingURL=vega-lite.min.js.map
