!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vl=e()}}(function(){var e;return function e(t,n,a){function r(o,s){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n?n:e)},u,u.exports,e,t,n,a)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}({1:[function(e,t,n){var a="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var o="boolean"==typeof t.cycles&&t.cycles,s=t.replacer||function(e,t){return t},c=t.cmp&&function(e){return function(t){return function(n,a){var r={key:n,value:t[n]},i={key:a,value:t[a]};return e(r,i)}}}(t.cmp),l=[];return function e(t,u,f,d){var p=n?"\n"+new Array(d+1).join(n):"",m=n?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),f=s.call(t,u,f),void 0!==f){if("object"!=typeof f||null===f)return a.stringify(f);if(r(f)){for(var g=[],h=0;h<f.length;h++){var y=e(f,h,f[h],d+1)||a.stringify(null);g.push(p+n+y)}return"["+g.join(",")+p+"]"}if(l.indexOf(f)!==-1){if(o)return a.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}l.push(f);for(var v=i(f).sort(c&&c(f)),g=[],h=0;h<v.length;h++){var u=v[h],S=e(f,u,f[u],d+1);if(S){var E=a.stringify(u)+m+S;g.push(p+n+E)}}return l.splice(l.indexOf(f),1),"{"+g.join(",")+p+"}"}}({"":e},"",e,0)};var r=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},i=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var a in e)t.call(e,a)&&n.push(a);return n}},{jsonify:2}],2:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(e,t,n){var a,r,i,o,s={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},c=function(e){throw{name:"SyntaxError",message:e,at:a,text:i}},l=function(e){return e&&e!==r&&c("Expected '"+e+"' instead of '"+r+"'"),r=i.charAt(a),a+=1,r},u=function(){var e,t="";for("-"===r&&(t="-",l("-"));r>="0"&&r<="9";)t+=r,l();if("."===r)for(t+=".";l()&&r>="0"&&r<="9";)t+=r;if("e"===r||"E"===r)for(t+=r,l(),"-"!==r&&"+"!==r||(t+=r,l());r>="0"&&r<="9";)t+=r,l();return e=+t,isFinite(e)?e:void c("Bad number")},f=function(){var e,t,n,a="";if('"'===r)for(;l();){if('"'===r)return l(),a;if("\\"===r)if(l(),"u"===r){for(n=0,t=0;t<4&&(e=parseInt(l(),16),isFinite(e));t+=1)n=16*n+e;a+=String.fromCharCode(n)}else{if("string"!=typeof s[r])break;a+=s[r]}else a+=r}c("Bad string")},d=function(){for(;r&&r<=" ";)l()},p=function(){switch(r){case"t":return l("t"),l("r"),l("u"),l("e"),!0;case"f":return l("f"),l("a"),l("l"),l("s"),l("e"),!1;case"n":return l("n"),l("u"),l("l"),l("l"),null}c("Unexpected '"+r+"'")},m=function(){var e=[];if("["===r){if(l("["),d(),"]"===r)return l("]"),e;for(;r;){if(e.push(o()),d(),"]"===r)return l("]"),e;l(","),d()}}c("Bad array")},g=function(){var e,t={};if("{"===r){if(l("{"),d(),"}"===r)return l("}"),t;for(;r;){if(e=f(),d(),l(":"),Object.hasOwnProperty.call(t,e)&&c('Duplicate key "'+e+'"'),t[e]=o(),d(),"}"===r)return l("}"),t;l(","),d()}}c("Bad object")};o=function(){switch(d(),r){case"{":return g();case"[":return m();case'"':return f();case"-":return u();default:return r>="0"&&r<="9"?u():p()}},t.exports=function(e,t){var n;return i=e,a=0,r=" ",n=o(),d(),r&&c("Syntax error"),"function"==typeof t?function e(n,a){var r,i,o=n[a];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=e(o,r),void 0!==i?o[r]=i:delete o[r]);return t.call(n,a,o)}({"":n},""):n}},{}],4:[function(e,t,n){function a(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=l[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function r(e,t){var n,c,l,u,f,d=i,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof s&&(p=s.call(t,e,p)),typeof p){case"string":return a(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(i+=o,f=[],"[object Array]"===Object.prototype.toString.apply(p)){for(u=p.length,n=0;n<u;n+=1)f[n]=r(n,p)||"null";return l=0===f.length?"[]":i?"[\n"+i+f.join(",\n"+i)+"\n"+d+"]":"["+f.join(",")+"]",i=d,l}if(s&&"object"==typeof s)for(u=s.length,n=0;n<u;n+=1)c=s[n],"string"==typeof c&&(l=r(c,p),l&&f.push(a(c)+(i?": ":":")+l));else for(c in p)Object.prototype.hasOwnProperty.call(p,c)&&(l=r(c,p),l&&f.push(a(c)+(i?": ":":")+l));return l=0===f.length?"{}":i?"{\n"+i+f.join(",\n"+i)+"\n"+d+"}":"{"+f.join(",")+"}",i=d,l}}var i,o,s,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var a;if(i="",o="","number"==typeof n)for(a=0;a<n;a+=1)o+=" ";else"string"==typeof n&&(o=n);if(s=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return r("",{"":e})}},{}],5:[function(t,n,a){(function(t){var a,r,i,o,s,c,l,u;!function(a){function r(e,t){return function(n,a){return e[n]=t?t(n,a):a}}var i="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:{};"function"==typeof e&&e.amd?e("tslib",["exports"],function(e){a(r(i,r(e)))}):a("object"==typeof n&&"object"==typeof n.exports?r(i,r(n.exports)):r(i))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};a=function(e,n){function a(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)},r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&(n[a[r]]=e[a[r]]);return n},o=function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(i<3?r(o):i>3?r(t,n,o):r(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o},s=function(e,t){return function(n,a){t(n,a,e)}},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}c((a=a.apply(e,t||[])).next())})},u=function(e,t){function n(e){return function(t){return a([e,t])}}function a(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return{next:n(0),throw:n(1),return:n(2)}},e("__extends",a),e("__assign",r),e("__rest",i),e("__decorate",o),e("__param",s),e("__metadata",c),e("__awaiter",l),e("__generator",u)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(t,n,a){!function(t,r){"object"==typeof a&&"undefined"!=typeof n?r(a):"function"==typeof e&&e.amd?e(["exports"],r):r(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function a(e){return c(e)?"["+e.map(a)+"]":l(e)||u(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function r(e,t,n){var a=[t].concat([].slice.call(n));console[e].apply(console,a)}var i=function(e,t,n){return e.fields=t||[],e.fname=n,e},o=function(e){throw Error(e)},s=function(e){function t(){i.push(u+e.substring(n,a)),u="",n=a+1}var n,a,r,i=[],s=null,c=0,l=e.length,u="";for(e+="",n=a=0;a<l;++a)if(r=e[a],"\\"===r)u+=e.substring(n,a),n=++a;else if(r===s)t(),s=null,c=-1;else{if(s)continue;n===c&&'"'===r?(n=a+1,s=r):n===c&&"'"===r?(n=a+1,s=r):"."!==r||c?"["===r?(a>n&&t(),c=n=a+1):"]"===r&&(c||o("Access path missing open bracket: "+e),c>0&&t(),c=0,n=a+1):a>n?t():n=a+1}return c&&o("Access path missing closing bracket: "+e),s&&o("Access path missing closing quote: "+e),a>n&&(++a,t()),i},c=Array.isArray,l=function(e){return e===Object(e)},u=function(e){return"string"==typeof e},f=function(e,t){var n=s(e),r="return _["+n.map(a).join("][")+"];";return i(Function("_",r),[e=1===n.length?n[0]:e],t||e)},d=[],p=f("id"),m=i(function(e){return e},d,"identity"),g=i(function(){return 0},d,"zero"),h=i(function(){return 1},d,"one"),y=i(function(){return!0},d,"true"),v=i(function(){return!1},d,"false"),S=0,E=1,b=2,O=3,N=function(e){var t=e||S;return{level:function(e){return arguments.length?(t=+e,this):t},warn:function(){return t>=E&&r("warn","WARN",arguments),this},info:function(){return t>=b&&r("log","INFO",arguments),this},debug:function(){return t>=O&&r("log","DEBUG",arguments),this}}},T=function(e){return null!=e?c(e)?e:[e]:[]},A=function(e,t){if(null==e)return null;e=T(e);var n,r,o,c,l,u,f,d=e.map(function(e){return s(e).map(a).join("][")}),p=T(t),m=d.length-1,g="var u,v;return ";for(n=0;n<=m;++n)r=d[n],o="(u=a["+r+"])",c="(v=b["+r+"])",l="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))",u="descending"!==p[n]?(f=1,-1):(f=-1,1),g+="("+o+"<"+c+"||u==null)&&v!=null?"+u+":(u>v||v==null)&&u!=null?"+f+":"+l+"!==u&&v===v?"+u+":v!==v&&u===u?"+f+(n<m?":":":0");return i(Function("a","b",g+";"),e)},k=function(e){return"function"==typeof e},x=function(e){return k(e)?e:function(){return e}},C=function(e){for(var t,n,a=1,r=arguments.length;a<r;++a){t=arguments[a];for(n in t)e[n]=t[n]}return e},R=function(e,t){var n,a,r,i,o,s=-1,c=e.length;if(null==t){for(;++s<c;)if(null!=(a=e[s])&&a>=a){n=r=a;break}for(i=o=s;++s<c;)null!=(a=e[s])&&(n>a&&(n=a,i=s),r<a&&(r=a,o=s))}else{for(;++s<c;)if(null!=(a=t(e[s],s,e))&&a>=a){n=r=a;break}for(i=o=s;++s<c;)null!=(a=t(e[s],s,e))&&(n>a&&(n=a,i=s),r<a&&(r=a,o=s))}return[i,o]},D={},I=function(e){function t(e){return r.hasOwnProperty(e)&&r[e]!==D}var n,a,r={};return n={size:0,empty:0,object:r,has:t,get:function(e){return t(e)?r[e]:void 0},set:function(e,a){return t(e)||(++n.size,r[e]===D&&--n.empty),r[e]=a,this},delete:function(e){return t(e)&&(--n.size,++n.empty,r[e]=D),this},clear:function(){n.size=n.empty=0,n.object=r={}},test:function(e){return arguments.length?(a=e,n):a},clean:function(){var e,t,i={},o=0;for(e in r)t=r[e],t===D||a&&a(t)||(i[e]=t,++o);n.size=o,n.empty=0,n.object=r=i}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},L=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},_=function(e){return"number"==typeof e},M=function(e){e=e?T(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+s(e).map(a).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return i(t,e,"key")},w=function(e,t,n,a){var r=t.length,i=n.length;if(!i)return t;if(!r)return n;for(var o=a||new t.constructor(r+i),s=0,c=0,l=0;s<r&&c<i;++l)o[l]=e(t[s],n[c])>0?n[c++]:t[s++];for(;s<r;++s,++l)o[l]=t[s];for(;c<i;++c,++l)o[l]=n[c];return o},U=function(e,t){for(var n="";--t>=0;)n+=e;return n},P=function(e,t,n,a){var r=n||" ",i=e+"",o=t-i.length;return o<=0?i:"left"===a?U(r,o)+i:"center"===a?U(r,~~(o/2))+i+U(r,Math.ceil(o/2)):i+U(r,o)},F=function(e){return e[e.length-1]},Y=function(e){for(var t={},n=0,a=e.length;n<a;++n)t[e[n]]=1;return t},X=function(e,t,n,a){var r=null!=a?a:"…",i=e+"",o=i.length,s=Math.max(0,t-r.length);return o<=t?i:"left"===n?r+i.slice(o-s):"center"===n?i.slice(0,Math.ceil(s/2))+r+i.slice(o-~~(s/2)):i.slice(0,s)+r},H=function(e,t,n){if(e){var a,r=0,i=e.length;if(t)for(;r<i;++r)(a=t(e[r]))&&n(a,r,e);else e.forEach(n)}};e.accessor=i,e.accessorName=t,e.accessorFields=n,e.id=p,e.identity=m,e.zero=g,e.one=h,e.truthy=y,e.falsy=v,e.logger=N,e.None=S,e.Warn=E,e.Info=b,e.Debug=O,e.array=T,e.compare=A,e.constant=x,e.error=o,e.extend=C,e.extentIndex=R,e.fastmap=I,e.field=f,e.inherits=L,e.isArray=c,e.isFunction=k,e.isNumber=_,e.isObject=l,e.isString=u,e.key=M,e.merge=w,e.pad=P,e.peek=F,e.repeat=U,e.splitAccessPath=s,e.stringValue=a,e.toSet=Y,e.truncate=X,e.visitArray=H,Object.defineProperty(e,"__esModule",{value:!0})})},{}],7:[function(e,t,n){t.exports={name:"vega-lite",author:'Jeffrey Heer, Dominik Moritz, Kanit "Ham" Wongsuphasawat',version:"2.0.0-alpha.2",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"src/vl.js",types:"src/vl.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{build:"browserify src/vl.ts -p tsify -d -s vl | exorcist vega-lite.js.map > vega-lite.js ",postbuild:"uglifyjs vega-lite.js -cm --in-source-map vega-lite.js.map --source-map vega-lite.min.js.map > vega-lite.min.js && npm run schema","build:all":"npm run clean && npm run build && npm run test:noschema && npm run build:images","build:images":"npm run data && scripts/generate-images.sh","build:toc":"bundle exec jekyll build --incremental -q && scripts/generate-toc","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > test-gallery/main.js",checkschema:"./scripts/check-schema.sh",clean:"rm -f vega-lite.* & find -E src test site -regex '.*\\.(js|js.map|d.ts)' -delete & rm -rf examples/_diff examples/_original examples/_output examples/images && rm -rf data",data:"rsync -r node_modules/vega-datasets/data/* data",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",lint:"tslint -c tslint.json 'src/**/*.ts' 'test/**/*.ts' --exclude '**/*.d.ts'",prestart:"npm run data && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",schema:"typescript-json-schema --required true --noExtraProps true src/spec.ts ExtendedSpec > vega-lite-schema.json",presite:"tsc && npm run build && bower install && npm run data && npm run build:toc",site:"bundle exec jekyll serve --incremental",pretest:"tsc && npm run data",test:"nyc --reporter=html --reporter=text-summary mocha",posttest:"npm run lint && npm run test:examples","test:examples":"npm run schema && mocha examples","test:noschema":"npm run pretest && nyc --reporter=html --reporter=text-summary mocha && npm run lint && mocha examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","test:debug":"npm run schema && mocha --debug-brk test examples","watch:build":"watchify src/vl.ts -p tsify -v -d -s vl -o 'exorcist vega-lite.js.map > vega-lite.js'","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:noschema' # already run schema in build","x-compile":"./scripts/examples-compile.sh","x-diff":"./scripts/examples-diff.sh"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^3.4.34","@types/d3":"^4.4.1","@types/json-stable-stringify":"^1.0.29","@types/mocha":"^2.2.38","@types/node":"^7.0.4",ajv:"5.0.1-beta.1","browser-sync":"~2.18.6",browserify:"~14.0.0",chai:"~3.5.0",cheerio:"~0.22.0",codecov:"~1.0.1",d3:"^4.4.4",exorcist:"~0.4.0",mocha:"~3.2.0",nodemon:"~1.11.0",nyc:"~10.1.2","source-map-support":"~0.4.10",tsify:"~3.0.0",tslint:"~4.4.2","tslint-eslint-rules":"^3.3.0",typescript:"^2.1.5","typescript-json-schema":"^0.9.0","uglify-js":"~2.7.5",vega:"3.0.0-beta.20","vega-datasets":"vega/vega-datasets#gh-pages",watchify:"~3.9.0","yaml-front-matter":"~3.4.0"},dependencies:{"json-stable-stringify":"~1.0.1",tslib:"^1.5.0","vega-util":"~1.1.3",yargs:"~6.6.0"}}},{}],8:[function(e,t,n){"use strict";n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"],n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"]},{}],9:[function(e,t,n){"use strict";n.defaultAxisConfig={labelMaxLength:25},n.defaultFacetAxisConfig={axisWidth:0,domain:!1,grid:!1,ticks:!1},n.AXIS_PROPERTIES=["domain","format","labels","grid","orient","ticks","tickSize","tickCount","title","values","zindex","labelPadding","maxExtent","minExtent","offset","position","subdivide","tickPadding","tickSize","tickSizeEnd","tickSizeMajor","tickSizeMinor","titleOffset","titlePadding"]},{}],10:[function(e,t,n){"use strict";function a(e){switch(e){case r.ROW:case r.COLUMN:case r.SIZE:case r.SHAPE:return 6;default:return 10}}var r=e("./channel");n.autoMaxBins=a},{"./channel":11}],11:[function(e,t,n){"use strict";function a(e,t){return t in r(e)}function r(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}return{}}function i(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.OPACITY:case n.ORDER:case n.DETAIL:return{measure:!0,dimension:!0};case n.ROW:case n.COLUMN:case n.SHAPE:return{measure:!1,dimension:!0};case n.X2:case n.Y2:case n.SIZE:case n.TEXT:return{measure:!0,dimension:!1}}throw new Error("Invalid encoding channel "+e)}function o(e){return!f.contains([n.DETAIL,n.TEXT,n.ORDER],e)}function s(e,t){switch(e){case n.ROW:case n.COLUMN:return"band"===t;case n.X:case n.Y:case n.SIZE:case n.OPACITY:return t in d;case n.COLOR:return"band"!==t;case n.SHAPE:return"ordinal"===t}return!1}function c(e){switch(e){case n.X:case n.Y:case n.ROW:case n.COLUMN:case n.SIZE:case n.OPACITY:return"continuous";case n.SHAPE:return"discrete";case n.COLOR:return"flexible";case n.X2:case n.Y2:case n.DETAIL:case n.TEXT:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}var l,u=e("./scale"),f=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail"}(l=n.Channel||(n.Channel={})),n.X=l.X,n.Y=l.Y,n.X2=l.X2,n.Y2=l.Y2,n.ROW=l.ROW,n.COLUMN=l.COLUMN,n.SHAPE=l.SHAPE,n.SIZE=l.SIZE,n.COLOR=l.COLOR,n.TEXT=l.TEXT,n.DETAIL=l.DETAIL,n.ORDER=l.ORDER,n.OPACITY=l.OPACITY,n.CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_CHANNELS=[n.X,n.Y,n.X2,n.Y2,n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.UNIT_SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.SCALE_CHANNELS=[n.X,n.Y,n.SIZE,n.SHAPE,n.COLOR,n.OPACITY,n.ROW,n.COLUMN],n.NONSPATIAL_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.ORDER,n.OPACITY,n.TEXT,n.DETAIL],n.NONSPATIAL_SCALE_CHANNELS=[n.SIZE,n.SHAPE,n.COLOR,n.OPACITY],n.STACK_GROUP_CHANNELS=[n.COLOR,n.DETAIL,n.ORDER,n.OPACITY,n.SIZE],n.supportMark=a,n.getSupportedMark=r,n.getSupportedRole=i,n.hasScale=o;var d=f.toSet(f.without(u.SCALE_TYPES,["ordinal","sequential"]));n.supportScaleType=s,n.getRangeType=c},{"./scale":67,"./util":74}],12:[function(e,t,n){"use strict";function a(e,t,n,a){var r=e.axis(t);return u.extend(void 0!==r.axisColor?{stroke:{value:r.axisColor}}:{},void 0!==r.axisWidth?{strokeWidth:{value:r.axisWidth}}:{},n||{})}function r(e,t,n,a){var r=e.axis(t);return u.extend(void 0!==r.gridColor?{stroke:{value:r.gridColor}}:{},void 0!==r.gridOpacity?{strokeOpacity:{value:r.gridOpacity}}:{},void 0!==r.gridWidth?{strokeWidth:{value:r.gridWidth}}:{},void 0!==r.gridDash?{strokeDashOffset:{value:r.gridDash}}:{},n||{})}function i(e,t,n,a){var r=e.fieldDef(t),i=e.axis(t),o=e.config;return u.contains([l.NOMINAL,l.ORDINAL],r.type)&&i.labelMaxLength?n=u.extend({text:{signal:"truncate(datum.value, "+i.labelMaxLength+")"}},n||{}):r.type===l.TEMPORAL&&(n=u.extend({text:{signal:f.timeFormatExpression("datum.value",r.timeUnit,i.format,i.shortTimeLabels,o)}},n)),void 0!==i.labelAngle?n.angle={value:i.labelAngle}:t===c.X&&(u.contains([l.NOMINAL,l.ORDINAL],r.type)||r.bin||r.type===l.TEMPORAL)&&(n.angle={value:270}),void 0!==i.labelAlign?n.align={value:i.labelAlign}:n.angle&&(270===n.angle.value?n.align={value:"top"===a.orient?"left":t===c.X||t===c.COLUMN?"right":"center"}:90===n.angle.value&&(n.align={value:"center"})),void 0!==i.labelBaseline?n.baseline={value:i.labelBaseline}:n.angle&&(270===n.angle.value?n.baseline={value:t===c.X||t===c.COLUMN?"middle":"bottom"}:90===n.angle.value&&(n.baseline={value:"bottom"})),void 0!==i.tickLabelColor&&(n.fill={value:i.tickLabelColor}),void 0!==i.tickLabelFont&&(n.font={value:i.tickLabelFont}),void 0!==i.tickLabelFontSize&&(n.fontSize={value:i.tickLabelFontSize}),0===u.keys(n).length?void 0:n}function o(e,t,n,a){var r=e.axis(t);return u.extend(void 0!==r.tickColor?{stroke:{value:r.tickColor}}:{},void 0!==r.tickWidth?{strokeWidth:{value:r.tickWidth}}:{},n||{})}function s(e,t,n,a){var r=e.axis(t);return u.extend(void 0!==r.titleColor?{fill:{value:r.titleColor}}:{},void 0!==r.titleFont?{font:{value:r.titleFont}}:{},void 0!==r.titleFontSize?{fontSize:{value:r.titleFontSize}}:{},void 0!==r.titleFontWeight?{fontWeight:{value:r.titleFontWeight}}:{},n||{})}var c=e("../../channel"),l=e("../../type"),u=e("../../util"),f=e("../common");n.domain=a,n.grid=r,n.labels=i,n.ticks=o,n.title=s},{"../../channel":11,"../../type":73,"../../util":74,"../common":15}],13:[function(e,t,n){"use strict";function a(e,t){return t.reduce(function(t,n){var a=[];if(e.axis(n)){var r=c(n,e);r&&i(r)&&a.push(r);var o=s(n,e);o&&i(o)&&a.push(o),a.length>0&&(t[n]=a)}return t},{})}function r(e){return e===!1||null===e}function i(e){return m.some(g,function(t){return o(e,t)})}function o(e,t){return"grid"===t||"title"===t?!!e[t]:!r(e[t])}function s(e,t){return l(e,t,!0)}function c(e,t){return l(e,t,!1)}function l(e,t,n){var a=t.axis(e),r={scale:t.scaleName(e)};f.AXIS_PROPERTIES.forEach(function(i){var o=u(i,a,e,t,n);void 0!==o&&(r[i]=o)});var i=u("gridScale",a,e,t,n);void 0!==i&&(r.gridScale=i);var s=a.encode||{};return g.forEach(function(n){if(o(r,n)){var a=d[n](t,e,s.labels||{},r);void 0!==a&&m.keys(a).length>0&&(r.encode=r.encode||{},r.encode[n]={update:a})}}),r}function u(e,t,n,a,r){var i=a.fieldDef(n);switch(e){case"domain":case"labels":case"ticks":return!r&&t[e];case"format":return p.format(t,n,i,a.config);case"grid":return p.grid(a,n,r);case"gridScale":return p.gridScale(a,n,r);case"orient":return p.orient(t,n);case"tickCount":return p.tickCount(t,n,i);case"title":return p.title(t,i,a.config,r);case"values":return p.values(t);case"zindex":return p.zindex(t,r)}return t[e]}var f=e("../../axis"),d=e("./encode"),p=e("./rules"),m=e("../../util"),g=["domain","grid","labels","ticks","title"];n.parseAxisComponent=a,n.parseGridAxis=s,n.parseMainAxis=c},{"../../axis":9,"../../util":74,"./encode":12,"./rules":14}],14:[function(e,t,n){"use strict";function a(e,t,n,a){return y.numberFormat(n,e.format,a,t)}function r(e,t){var n=e.axis(t).grid;return void 0!==n?n:!e.hasDiscreteScale(t)&&!e.fieldDef(t).bin}function i(e,t,n){if(t!==p.ROW&&t!==p.COLUMN&&n)return r(e,t)}function o(e,t,n){if(n){var a="x"===t?"y":"x";if(e.scale(a))return e.scaleName(a)}}function s(e,t){var n=e.orient;if(n)return n;switch(t){case p.COLUMN:return"top";case p.X:return"bottom";case p.ROW:case p.Y:return"left"}throw new Error(d.message.INVALID_CHANNEL_FOR_AXIS)}function c(e,t,n){var a=e.tickCount;return void 0!==a?a:t!==p.X||n.bin?void 0:5}function l(e,t,n,a){if(!a){if(void 0!==e.title)return e.title;var r=g.title(t,n),i=e.titleMaxLength;return i?h.truncate(r,i):r}}function u(e){var t=e.values;return e.values&&m.isDateTime(t[0])?t.map(function(e){return m.timestamp(e,!0)}):t}function f(e,t){var n=e.zindex;return void 0!==n?n:t?0:1}var d=e("../../log"),p=e("../../channel"),m=e("../../datetime"),g=e("../../fielddef"),h=e("../../util"),y=e("../common");n.format=a,n.gridShow=r,n.grid=i,n.gridScale=o,n.orient=s,n.tickCount=c,n.title=l,n.values=u,n.zindex=f},{"../../channel":11,"../../datetime":59,"../../fielddef":62,"../../log":65,"../../util":74,"../common":15}],15:[function(e,t,n){"use strict";function a(e,t,n){if(v.isFacetSpec(e))return new m.FacetModel(e,t,n);if(v.isLayerSpec(e))return new g.LayerModel(e,t,n);if(v.isUnitSpec(e))return new y.UnitModel(e,t,n);throw new Error(l.message.INVALID_SPEC)}function r(e,t,n){return n.forEach(function(n){var a=t[n];void 0!==a&&(e[n]={value:a})}),e}function i(e,t,n){return r(e,t.config.mark,n)}function o(e,t,n,a){if(e.type===d.QUANTITATIVE&&!e.bin)return t?t:"count"===e.aggregate&&a===u.TEXT?"d":n.numberFormat}function s(e,t,n,a,r){if(!t||n){var i=n||r.timeFormat;return"timeFormat("+e+", '"+i+"')"}return h.formatExpression(t,e,a)}function c(e){return(p.isArray(e)?e:[e]).reduce(function(e,t){return e.field.push(f.field(t,{binSuffix:"start"})),e.order.push(t.sort||"ascending"),e},{field:[],order:[]})}var l=e("../log"),u=e("../channel"),f=e("../fielddef"),d=e("../type"),p=e("../util"),m=e("./facet"),g=e("./layer"),h=e("../timeunit"),y=e("./unit"),v=e("../spec");n.buildModel=a,n.applyConfig=r,n.applyMarkConfig=i,n.numberFormat=o,n.timeFormatExpression=s,n.sortParams=c},{"../channel":11,"../fielddef":62,"../log":65,"../spec":69,"../timeunit":71,"../type":73,"../util":74,"./facet":30,"./layer":31,"./unit":55}],16:[function(e,t,n){"use strict";function a(e,t){t&&c.set(t);try{var n=l.normalize(e),a=f.buildModel(n,null,"");return a.parse(),r(a)}finally{t&&c.reset()}}function r(e){var t=u.extend({$schema:"http://vega.github.io/schema/vega/v3.0.json"},i(e),{signals:[{name:"width",update:"data('layout')[0].width"},{name:"height",update:"data('layout')[0].height"}]},{data:[].concat(e.assembleData([]),e.assembleLayout([])),marks:[o(e)]});return{spec:t}}function i(e){var t=e.config;return u.extend({padding:e.padding||t.padding},{autosize:"pad"},t.viewport?{viewport:t.viewport}:{},t.background?{background:t.background}:{})}function o(e){var t=u.extend({name:e.getName("main"),type:"group"},e.description?{description:e.description}:{},{from:{data:e.getName(s.LAYOUT+"")},encode:{update:u.extend({width:{field:e.getName("width")},height:{field:e.getName("height")}},e.assembleParentGroupProperties(e.config.cell))}});return u.extend(t,e.assembleGroup())}var s=e("../data"),c=e("../log"),l=e("../spec"),u=e("../util"),f=e("./common");n.compile=a,n.topLevelBasicProperties=i,n.assembleRootGroup=o},{"../data":58,"../log":65,"../spec":69,"../util":74,"./common":15}],17:[function(e,t,n){"use strict";function a(e,t,n,a,r){var c=m.extend({},r.mark,r[e]);if(void 0===c.filled&&(c.filled=e!==f.POINT&&e!==f.LINE&&e!==f.RULE),void 0===c.opacity){var l=i(e,t,a);l&&(c.opacity=l)}return c.orient=o(e,t,n,r.mark),void 0!==r.mark.orient&&c.orient!==r.mark.orient&&s.warn(s.message.orientOverridden(r.mark.orient,c.orient)),c}function r(e,t){var n=m.extend({},t.text);return void 0===n.align&&(n.align=l.channelHasField(e,c.X)?"center":"right"),n}function i(e,t,n){return!m.contains([f.POINT,f.TICK,f.CIRCLE,f.SQUARE],e)||l.isAggregate(t)&&!l.channelHasField(t,c.DETAIL)?e===f.BAR&&!n&&(l.channelHasField(t,c.COLOR)||l.channelHasField(t,c.DETAIL)||l.channelHasField(t,c.SIZE))?.7:e===f.AREA?.7:void 0:.7}function o(e,t,n,a){switch(void 0===a&&(a={}),e){case f.POINT:case f.CIRCLE:case f.SQUARE:case f.TEXT:case f.RECT:return}var r=t.y&&t.y2,i=t.x&&t.x2;switch(e){case f.TICK:var o=n.x?n.x.type:null,c=n.y?n.y.type:null;return!d.hasDiscreteDomain(o)&&(!t.y||d.hasDiscreteDomain(c)||u.isFieldDef(t.y)&&t.y.bin)?"vertical":"horizontal";case f.RULE:case f.BAR:case f.AREA:if(r)return"vertical";if(i)return"horizontal";if(e===f.RULE){if(t.x&&!t.y)return"vertical";if(t.y&&!t.x)return"horizontal"}case f.LINE:var l=u.isMeasure(t.x)||u.isMeasure(t.x2),m=u.isMeasure(t.y)||u.isMeasure(t.y2);if(l&&!m)return"horizontal";if(!l&&m)return"vertical";if(l&&m){var g=t.x,h=t.y;return g.type===p.TEMPORAL?"vertical":h.type===p.TEMPORAL?"horizontal":a.orient?a.orient:(e===f.LINE&&t.order||s.warn(s.message.unclearOrientContinuous(e)),"vertical")}return void s.warn(s.message.unclearOrientDiscreteOrEmpty(e))}return"vertical"}var s=e("../log"),c=e("../channel"),l=e("../encoding"),u=e("../fielddef"),f=e("../mark"),d=e("../scale"),p=e("../type"),m=e("../util");n.initMarkConfig=a,n.initTextConfig=r,n.opacity=i,n.orient=o},{"../channel":11,"../encoding":60,"../fielddef":62,"../log":65,"../mark":66,"../scale":67,"../type":73,"../util":74}],18:[function(e,t,n){"use strict";function a(e,t){return"format("+e+", '"+t+"')"}function r(e){return e.reduce(function(t,n,r){var l=e.fieldDef(r).bin;if(l){var u=s.extend({type:"bin",field:n.field,as:[o.field(n,{binSuffix:"start"}),o.field(n,{binSuffix:"end"})]},"boolean"==typeof l?{}:l),f=[];if(!u.extent){var d=e.getName(n.field+"_extent");f.push({type:"extent",field:n.field,signal:d}),u.extent={signal:d}}u.maxbins||u.step||(u.maxbins=i.autoMaxBins(r)),f.push(u);var p=c.hasDiscreteDomain(e.scale(r).type)||e.legend(r);if(p){var m=(e.axis(r)||e.legend(r)||{}).format||e.config.numberFormat,g=o.field(n,{datum:!0,binSuffix:"start"}),h=o.field(n,{datum:!0,binSuffix:"end"});f.push({type:"formula",as:o.field(n,{binSuffix:"range"}),expr:a(g,m)+" + ' - ' + "+a(h,m)})}var y=s.hash(l)+"_"+n.field+"oc:"+p;t[y]=f}return t},{})}var i=e("../../bin"),o=e("../../fielddef"),s=e("../../util"),c=e("../../scale");n.bin={parseUnit:r,parseFacet:function(e){var t=r(e),n=e.child.component.data;return n.source||(s.extend(t,n.bin),delete n.bin),t},parseLayer:function(e){var t=r(e);return e.children.forEach(function(e){var n=e.component.data;n.source||(s.extend(t,n.bin),delete n.bin)}),t},assemble:function(e){return s.flatten(s.vals(e))}}},{"../../bin":10,"../../fielddef":62,"../../scale":67,"../../util":74}],19:[function(e,t,n){"use strict";function a(e){return{formatParse:l.formatParse.parseUnit(e),nullFilter:u.nullFilter.parseUnit(e),filter:f.filter.parseUnit(e),nonPositiveFilter:g.nonPositiveFilter.parseUnit(e),pathOrder:m.pathOrder.parseUnit(e),source:c.source.parseUnit(e),bin:d.bin.parseUnit(e),calculate:p.formula.parseUnit(e),timeUnit:v.timeUnit.parseUnit(e),summary:h.summary.parseUnit(e),stack:y.stack.parseUnit(e)}}function r(e){
return{formatParse:l.formatParse.parseFacet(e),nullFilter:u.nullFilter.parseFacet(e),filter:f.filter.parseFacet(e),nonPositiveFilter:g.nonPositiveFilter.parseFacet(e),pathOrder:m.pathOrder.parseFacet(e),source:c.source.parseFacet(e),bin:d.bin.parseFacet(e),calculate:p.formula.parseFacet(e),timeUnit:v.timeUnit.parseFacet(e),summary:h.summary.parseFacet(e),stack:y.stack.parseFacet(e)}}function i(e){return{filter:f.filter.parseLayer(e),formatParse:l.formatParse.parseLayer(e),nullFilter:u.nullFilter.parseLayer(e),nonPositiveFilter:g.nonPositiveFilter.parseLayer(e),pathOrder:m.pathOrder.parseLayer(e),source:c.source.parseLayer(e),bin:d.bin.parseLayer(e),calculate:p.formula.parseLayer(e),timeUnit:v.timeUnit.parseLayer(e),summary:h.summary.parseLayer(e),stack:y.stack.parseLayer(e)}}function o(e,t){var n=e.component.data,a=c.source.assemble(n);a&&t.push(a),h.summary.assemble(n.summary||[],e.dataName(s.SOURCE)).forEach(function(e){t.push(e)});var r=g.nonPositiveFilter.assemble(n.nonPositiveFilter);if(r.length>0){if(!(t.length>0))throw new Error("Invalid nonPositiveFilter not merged");var i=t[t.length-1];i.transform=(i.transform||[]).concat(r)}var o=y.stack.assemble(n.stack);o&&t.push(o);var l=m.pathOrder.assemble(n.pathOrder);if(l){var i=t[t.length-1];if(!(t.length>0))throw new Error("Invalid path order collect transform not added");i.transform=(i.transform||[]).concat([l])}return t}var s=e("../../data"),c=e("./source"),l=e("./formatparse"),u=e("./nullfilter"),f=e("./filter"),d=e("./bin"),p=e("./formula"),m=e("./pathorder"),g=e("./nonpositivefilter"),h=e("./summary"),y=e("./stack"),v=e("./timeunit");n.parseUnitData=a,n.parseFacetData=r,n.parseLayerData=i,n.assembleData=o},{"../../data":58,"./bin":18,"./filter":20,"./formatparse":21,"./formula":22,"./nonpositivefilter":23,"./nullfilter":24,"./pathorder":25,"./source":26,"./stack":27,"./summary":28,"./timeunit":29}],20:[function(e,t,n){"use strict";function a(e){var t=e.filter();return i.isArray(t)?"("+t.map(function(e){return r.expression(e)}).filter(function(e){return void 0!==e}).join(") && (")+")":t?r.expression(t):void 0}var r=e("../../filter"),i=e("../../util");n.filter={parseUnit:a,parseFacet:function(e){var t=a(e),n=e.child.component.data;return!n.source&&n.filter&&(t=(t?t+" && ":"")+n.filter,delete n.filter),t},parseLayer:function(e){var t=a(e);return e.children.forEach(function(n){var a=n.component.data;e.compatibleSource(n)&&a.filter&&a.filter===t&&delete a.filter}),t},assemble:function(e){return e?[{type:"filter",expr:e}]:[]}}},{"../../filter":63,"../../util":74}],21:[function(e,t,n){"use strict";function a(e){var t=(e.calculate()||[]).reduce(function(e,t){return e[t.as]=!0,e},{}),n={},a=e.filter();l.isArray(a)||(a=[a]),a.forEach(function(e){var t=null;s.isEqualFilter(e)?t=e.equal:s.isRangeFilter(e)?t=e.range[0]:s.isOneOfFilter(e)&&(t=(e.oneOf||e.in)[0]),t&&(r.isDateTime(t)?n[e.field]="date":l.isNumber(t)?n[e.field]="number":l.isString(t)&&(n[e.field]="string"))}),e.forEach(function(e){if(e.type===c.TEMPORAL)n[e.field]="date";else if(e.type===c.QUANTITATIVE){if(o.isCount(e)||t[e.field])return;n[e.field]="number"}});var u=e.data;if(u&&i.isUrlData(u)&&u.format&&u.format.parse){var f=u.format.parse;l.keys(f).forEach(function(e){n[e]=f[e]})}return n}var r=e("../../datetime"),i=e("../../data"),o=e("../../fielddef"),s=e("../../filter"),c=e("../../type"),l=e("../../util");n.formatParse={parseUnit:a,parseFacet:function(e){var t=a(e),n=e.child.component.data;return!n.source&&n.formatParse&&(l.extend(t,n.formatParse),delete n.formatParse),t},parseLayer:function(e){var t=a(e);return e.children.forEach(function(n){var a=n.component.data;e.compatibleSource(n)&&!l.differ(a.formatParse,t)&&(l.extend(t,a.formatParse),delete a.formatParse)}),t},assemble:function(e){return e}}},{"../../data":58,"../../datetime":59,"../../fielddef":62,"../../filter":63,"../../type":73,"../../util":74}],22:[function(e,t,n){"use strict";function a(e){return(e.calculate()||[]).reduce(function(e,t){return e[r.hash(t)]=t,e},{})}var r=e("../../util");n.formula={parseUnit:a,parseFacet:function(e){var t=a(e),n=e.child.component.data;return n.source||(r.extend(t,n.calculate),delete n.calculate),t},parseLayer:function(e){var t=a(e);return e.children.forEach(function(e){var n=e.component.data;!n.source&&n.calculate&&(r.extend(t||{},n.calculate),delete n.calculate)}),t},assemble:function(e){return r.vals(e).reduce(function(e,t){return e.push(r.extend({type:"formula"},t)),e},[])}}},{"../../util":74}],23:[function(e,t,n){"use strict";var a=e("../../scale"),r=e("../../util");n.nonPositiveFilter={parseUnit:function(e){return e.channels().reduce(function(t,n){var r=e.scale(n);return e.field(n)&&r?(t[e.field(n)]=r.type===a.ScaleType.LOG,t):t},{})},parseFacet:function(e){var t=e.child.component.data;if(!t.source){var n=t.nonPositiveFilter;return delete t.nonPositiveFilter,n}return{}},parseLayer:function(e){var t={};return e.children.forEach(function(n){var a=n.component.data;e.compatibleSource(n)&&!r.differ(a.nonPositiveFilter,t)&&(r.extend(t,a.nonPositiveFilter),delete a.nonPositiveFilter)}),t},assemble:function(e){return e?r.keys(e).filter(function(t){return e[t]}).map(function(e){return{type:"filter",expr:'datum["'+e+'"] > 0'}}):[]}}},{"../../scale":67,"../../util":74}],24:[function(e,t,n){"use strict";function a(e){var t=e.filterInvalid();return e.reduce(function(e,n){return"*"!==n.field&&(t||void 0===t&&n.field&&o[n.type]?e[n.field]=n:e[n.field]=null),e},{})}var r=e("../../type"),i=e("../../util"),o={nominal:!1,ordinal:!1,quantitative:!0,temporal:!0};n.nullFilter={parseUnit:a,parseFacet:function(e){var t=a(e),n=e.child.component.data;return n.source||(i.extend(t,n.nullFilter),delete n.nullFilter),t},parseLayer:function(e){var t=a(e);return e.children.forEach(function(n){var a=n.component.data;e.compatibleSource(n)&&!i.differ(a.nullFilter,t)&&(i.extend(t,a.nullFilter),delete a.nullFilter)}),t},assemble:function(e){var t=i.keys(e).reduce(function(t,n){var a=e[n];return null!==a&&(t.push('datum["'+a.field+'"] !== null'),i.contains([r.QUANTITATIVE,r.TEMPORAL],a.type)&&t.push('!isNaN(datum["'+a.field+'"])')),t},[]);return t.length>0?[{type:"filter",expr:t.join(" && ")}]:[]}}},{"../../type":73,"../../util":74}],25:[function(e,t,n){"use strict";var a=e("json-stable-stringify"),r=e("../../encoding"),i=e("../../fielddef"),o=e("../../sort"),s=e("../../util"),c=e("../common");n.pathOrder={parseUnit:function(e){if(s.contains(["line","area"],e.mark())){if("line"===e.mark()&&e.channelHasField("order"))return c.sortParams(e.encoding.order);var t="horizontal"===e.config.mark.orient?"y":"x",n=e.sort(t),a=o.isSortField(n)?i.field({aggregate:r.isAggregate(e.encoding)?n.op:void 0,field:n.field}):e.field(t,{binSuffix:"start"});return{field:a,order:"descending"}}return null},parseFacet:function(e){var t=e.child.component.data;if(!t.source){var n=t.pathOrder;return delete t.pathOrder,n}return null},parseLayer:function(e){for(var t=null,n=null,r=0,i=e.children;r<i.length;r++){var o=i[r],s=o.component.data;if(e.compatibleSource(o)&&null!==s.pathOrder)if(null===t)t=s.pathOrder,n=a(t);else if(n!==a(s.pathOrder)){t=null;break}}if(null!==t)for(var c=0,l=e.children;c<l.length;c++){var o=l[c];delete o.component.data.pathOrder}return t},assemble:function(e){return e?{type:"collect",sort:e}:null}}},{"../../encoding":60,"../../fielddef":62,"../../sort":68,"../../util":74,"../common":15,"json-stable-stringify":1}],26:[function(e,t,n){"use strict";var a,r=e("../../data"),i=e("../../util"),o=e("./nullfilter"),s=e("./filter"),c=e("./bin"),l=e("./formula"),u=e("./timeunit");!function(e){function t(e){var t=e.data;if(t){var n={name:e.dataName(r.SOURCE)};if(r.isInlineData(t))n.values=t.values,n.format={type:"json"};else if(r.isUrlData(t)){n.url=t.url;var a=/(?:\.([^.]+))?$/.exec(n.url)[1];i.contains(["json","csv","tsv","topojson"],a)||(a="json");var o=t.format||{},s=o.type||t.formatType;n.format=i.extend({type:s?s:a},o.property?{property:o.property}:{},o.feature?{feature:o.feature}:o.mesh?{mesh:o.mesh}:{})}return n}if(!e.parent)return{name:e.dataName(r.SOURCE)}}function n(e){var n=t(e);return e.child.component.data.source||e.child.renameData(e.child.dataName(r.SOURCE),e.dataName(r.SOURCE)),n}function a(e){var n=t(e);return e.children.forEach(function(t){var n=t.component.data;if(e.compatibleSource(t)){var a=!n.filter&&!n.formatParse&&!n.nullFilter;a?(t.renameData(t.dataName(r.SOURCE),e.dataName(r.SOURCE)),delete n.source):n.source={name:t.dataName(r.SOURCE),source:e.dataName(r.SOURCE)}}}),n}function f(e){if(e.source){var t=e.source;return e.formatParse&&(e.source.format=e.source.format||{},e.source.format.parse=e.formatParse),t.transform=[].concat(l.formula.assemble(e.calculate),o.nullFilter.assemble(e.nullFilter),s.filter.assemble(e.filter),c.bin.assemble(e.bin),u.timeUnit.assemble(e.timeUnit)),t}return null}e.parseUnit=t,e.parseFacet=n,e.parseLayer=a,e.assemble=f}(a=n.source||(n.source={}))},{"../../data":58,"../../util":74,"./bin":18,"./filter":20,"./formula":22,"./nullfilter":24,"./timeunit":29}],27:[function(e,t,n){"use strict";function a(e){return e.stack.stackBy.reduce(function(t,n){var a=n.channel,r=n.fieldDef,i=e.scale(a),c=o.field(r,{binSuffix:i&&s.hasDiscreteDomain(i.type)?"range":"start"});return c&&t.push(c),t},[])}var r=e("../common"),i=e("../../data"),o=e("../../fielddef"),s=e("../../scale"),c=e("../../util");n.stack={parseUnit:function(e){var t=e.stack;if(t){var n=[];if(t.groupbyChannel){var o=e.fieldDef(t.groupbyChannel);o.bin?(n.push(e.field(t.groupbyChannel,{binSuffix:"start"})),n.push(e.field(t.groupbyChannel,{binSuffix:"end"}))):n.push(e.field(t.groupbyChannel))}var s,l=a(e),u=e.encoding.order;return s=u?r.sortParams(u):l.reduce(function(e,t){return e.field.push(t),e.order.push("descending"),e},{field:[],order:[]}),{name:e.dataName(i.STACKED),source:e.dataName(i.SUMMARY),groupby:n,field:e.field(t.fieldChannel),stackby:l,sort:s,offset:t.offset,impute:c.contains(["area","line"],e.mark())}}},parseLayer:function(e){},parseFacet:function(e){var t=e.child,n=t.component.data;if(n.stack){var a=n.stack,r=e.dataName(i.STACKED);return t.renameData(a.name,r),a.name=r,a.source=e.dataName(i.SUMMARY),a.groupby=e.reduce(function(e,t){var n=o.field(t,{binSuffix:"start"});return c.contains(e,n)||e.push(n),e},a.groupby),delete n.stack,a}},assemble:function(e){if(e){var t=[];return e.impute&&t.push({type:"impute",field:e.field,groupby:e.stackby,orderby:e.groupby,method:"value",value:0}),t.push({type:"stack",groupby:e.groupby,field:e.field,sort:e.sort,as:[e.field+"_start",e.field+"_end"],offset:e.offset}),{name:e.name,source:e.source,transform:t}}}}},{"../../data":58,"../../fielddef":62,"../../scale":67,"../../util":74,"../common":15}],28:[function(e,t,n){"use strict";var a,r=e("../../data"),i=e("../../fielddef"),o=e("../../util");!function(e){function t(e,t){return t.bin?(e[i.field(t,{binSuffix:"start"})]=!0,e[i.field(t,{binSuffix:"end"})]=!0,e[i.field(t,{binSuffix:"range"})]=!0):e[i.field(t)]=!0,e}function n(e){var n={},a={};return e.forEach(function(e){e.aggregate?"count"===e.aggregate?(a["*"]=a["*"]||{},a["*"].count=!0):(a[e.field]=a[e.field]||{},a[e.field][e.aggregate]=!0):t(n,e)}),[{name:e.dataName(r.SUMMARY),dimensions:n,measures:a}]}function a(e){var n=e.child.component.data;if(!n.source&&n.summary){var a=n.summary.map(function(n){n.dimensions=e.reduce(t,n.dimensions);var a=n.name.substr(e.child.getName("").length);return e.child.renameData(n.name,a),n.name=a,n});return delete n.summary,a}return[]}function s(e,t){for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];for(var r in a)a.hasOwnProperty(r)&&(n in e?e[n][r]=!0:e[n]={op:!0})}}function c(e){var t={};return e.children.forEach(function(n){var a=n.component.data;!a.source&&a.summary&&a.summary.forEach(function(i){var c=o.hash(i.dimensions);c in t?s(t[c].measures,i.measures):(i.name=e.dataName(r.SUMMARY)+"_"+o.keys(t).length,t[c]=i),n.renameData(n.dataName(r.SUMMARY),t[c].name),delete a.summary})}),o.vals(t)}function l(e,t){return e.reduce(function(e,n){var a=n.dimensions,r=n.measures;if(o.keys(r).length>0){var i=o.keys(a),s=o.reduce(r,function(e,t,n){for(var a=o.keys(t),r=0,i=a;r<i.length;r++){var s=i[r];e.fields.push(n),e.ops.push(s)}return e},{type:"aggregate",groupby:i,fields:[],ops:[]});e.push({name:n.name,source:t,transform:[s]})}return e},[])}e.parseUnit=n,e.parseFacet=a,e.parseLayer=c,e.assemble=l}(a=n.summary||(n.summary={}))},{"../../data":58,"../../fielddef":62,"../../util":74}],29:[function(e,t,n){"use strict";function a(e){return e.reduce(function(e,t){if(t.type===o.TEMPORAL&&t.timeUnit){var n=r.field(t);e[n]={type:"formula",as:r.field(t),expr:i.fieldExpr(t.timeUnit,t.field)}}return e},{})}var r=e("../../fielddef"),i=e("../../timeunit"),o=e("../../type"),s=e("../../util");n.timeUnit={parseUnit:a,parseFacet:function(e){var t=a(e),n=e.child.component.data;return n.source||(s.extend(t,n.timeUnit),delete n.timeUnit),t},parseLayer:function(e){var t=a(e);return e.children.forEach(function(e){var n=e.component.data;n.source||(s.extend(t,n.timeUnit),delete n.timeUnit)}),t},assemble:function(e){return s.vals(e)}}},{"../../fielddef":62,"../../timeunit":71,"../../type":73,"../../util":74}],30:[function(e,t,n){"use strict";function a(e){return e.hasDescendantWithFieldOnChannel("x")||e.hasDescendantWithFieldOnChannel("y")}function r(e,t,n){return void 0!==e.spacing?e.spacing:a(t)?n.scale.facetSpacing:0}function i(e){var t=e.child,n=y.extend({},t.config.cell,t.config.facet.cell);return y.extend({x:e.channelHasField(p.COLUMN)?{scale:e.scaleName(p.COLUMN),field:e.field(p.COLUMN),offset:e.spacing(p.COLUMN)/2}:{value:e.config.scale.facetSpacing/2},y:e.channelHasField(p.ROW)?{scale:e.scaleName(p.ROW),field:e.field(p.ROW),offset:e.spacing(p.ROW)/2}:{value:e.config.scale.facetSpacing/2},width:{field:{parent:e.child.sizeName("width")}},height:{field:{parent:e.child.sizeName("height")}}},a(e)?t.assembleParentGroupProperties(n):{})}function o(e,t){return e.facet.column&&t.push({name:n.COLUMN_AXES_DATA_PREFIX+e.dataTable(),source:e.dataTable(),transform:[{type:"aggregate",groupby:[e.field(p.COLUMN)]}]}),e.facet.row&&t.push({name:n.ROW_AXES_DATA_PREFIX+e.dataTable(),source:e.dataTable(),transform:[{type:"aggregate",groupby:[e.field(p.ROW)]}]}),t}function s(e,t){var n=null,a=e.child;return a.channelHasField(t)&&a.axis(t)&&(n=c(e,t),a.axis(t)&&S.gridShow(a,t)?a.component.axes[t]=[v.parseGridAxis(t,a)]:delete a.component.axes[t]),n}function c(e,t){var a="x"===t,r=a?"column":"row",i=!!e.facet[r],o=a?n.COLUMN_AXES_DATA_PREFIX:n.ROW_AXES_DATA_PREFIX,s={name:e.getName(t+"-axes"),type:"group"};return i&&(s.from={data:o+e.dataTable()}),a?s.encode={update:{width:{field:{parent:e.child.sizeName("width")}},height:{field:{group:"height"}},x:i?{scale:e.scaleName(p.COLUMN),field:e.field(p.COLUMN),offset:e.spacing(p.COLUMN)/2}:{value:e.config.scale.facetSpacing/2}}}:s.encode={update:{width:{field:{group:"width"}},height:{field:{parent:e.child.sizeName("height")}},y:i?{scale:e.scaleName(p.ROW),field:e.field(p.ROW),offset:e.spacing(p.ROW)/2}:{value:e.config.scale.facetSpacing/2}}},s.axes=[v.parseMainAxis(t,e.child)],s}function l(e){var t=e.config.facet.grid,a={name:e.getName("row-grid"),type:"rule",from:{data:n.ROW_AXES_DATA_PREFIX+e.dataTable()},encode:{update:{y:{scale:e.scaleName(p.ROW),field:e.field(p.ROW)},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}};return[a,{name:e.getName("row-grid-end"),type:"rule",encode:{update:{y:{field:{group:"height"}},x:{value:0,offset:-t.offset},x2:{field:{group:"width"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}function u(e){var t=e.config.facet.grid,a={name:e.getName("column-grid"),type:"rule",from:{data:n.COLUMN_AXES_DATA_PREFIX+e.dataTable()},encode:{update:{x:{scale:e.scaleName(p.COLUMN),field:e.field(p.COLUMN)},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}};return[a,{name:e.getName("column-grid-end"),type:"rule",encode:{update:{x:{field:{group:"width"}},y:{value:0,offset:-t.offset},y2:{field:{group:"height"},offset:t.offset},stroke:{value:t.color},strokeOpacity:{value:t.opacity},strokeWidth:{value:.5}}}}]}var f=e("tslib"),d=e("../log"),p=e("../channel"),m=e("../config"),g=e("../encoding"),h=e("../fielddef"),y=e("../util"),v=e("./axis/parse"),S=e("./axis/rules"),E=e("./common"),b=e("./data/data"),O=e("./layout"),N=e("./model"),T=e("./scale/init"),A=e("./scale/parse");n.COLUMN_AXES_DATA_PREFIX="column-",n.ROW_AXES_DATA_PREFIX="row-";var k=function(e){function t(t,n,a){var r=e.call(this,t,n,a)||this;r.scales={},r.axes={},r.legends={},r.stack=null,r._spacing={};var i=r.config=r.initConfig(t.config,n),o=r.child=E.buildModel(t.spec,r,r.getName("child"));r.children=[o];var s=r.facet=r.initFacet(t.facet);return r.scales=r.initScalesAndSpacing(s,i),r.axes=r.initAxis(s,i,o),r.legends={},r}return f.__extends(t,e),t.prototype.initConfig=function(e,t){return y.mergeDeep(y.duplicate(m.defaultConfig),t?t.config:{},e)},t.prototype.initFacet=function(e){return e=y.duplicate(e),g.forEach(e,function(t,n){return y.contains([p.ROW,p.COLUMN],n)?void 0===t.field?(d.warn(d.message.emptyFieldDef(t,n)),void delete e[n]):(h.normalize(t,n),void(h.isDimension(t)||d.warn(d.message.facetChannelShouldBeDiscrete(n)))):(d.warn(d.message.incompatibleChannel(n,"facet")),void delete e[n])}),e},t.prototype.initScalesAndSpacing=function(e,t){var n=this;return[p.ROW,p.COLUMN].reduce(function(a,i){return e[i]&&(a[i]=T.default(i,e[i],t,void 0,void 0,[]),n._spacing[i]=r(e[i].scale||{},n,t)),a},{})},t.prototype.initAxis=function(e,t,n){var a=this;return[p.ROW,p.COLUMN].reduce(function(r,i){if(e[i]){var o=e[i].axis;if(o!==!1){var s=r[i]=y.extend({},t.facet.axis,o===!0?{}:o||{});if(i===p.ROW){var c=n.axis(p.Y);c&&"right"!==c.orient&&!s.orient&&(s.orient="right"),a.hasDescendantWithFieldOnChannel(p.X)&&!s.labelAngle&&(s.labelAngle="right"===s.orient?90:270)}}}return r},{})},t.prototype.channelHasField=function(e){return!!this.facet[e]},t.prototype.hasSummary=function(){for(var e=this.component.data.summary,t=0,n=e;t<n.length;t++){var a=n[t];if(y.keys(a.measures).length>0)return!0}return!1},t.prototype.facetedTable=function(){return"faceted-"+this.getName("data")},t.prototype.dataTable=function(){return this.component.data.stack?"stacked":this.hasSummary()?"summary":"source"},t.prototype.fieldDef=function(e){return this.facet[e]},t.prototype.parseData=function(){this.child.parseData(),this.component.data=b.parseFacetData(this)},t.prototype.parseSelectionData=function(){},t.prototype.parseLayoutData=function(){this.child.parseLayoutData(),this.component.layout=O.parseFacetLayout(this)},t.prototype.parseScale=function(){var e=this.child,t=this;e.parseScale();var n=this.component.scales=A.default(this);y.keys(e.component.scales).forEach(function(a){n[a]=e.component.scales[a],y.vals(n[a]).forEach(function(n){var a=n.name.substr(e.getName("").length),r=t.scaleName(a,!0);e.renameScale(n.name,r),n.name=r}),delete e.component.scales[a]})},t.prototype.parseMark=function(){this.child.parseMark(),this.component.mark=y.extend({name:this.getName("cell"),type:"group",from:y.extend({facet:{name:this.facetedTable(),data:this.dataTable(),groupby:[].concat(this.channelHasField(p.ROW)?[this.field(p.ROW)]:[],this.channelHasField(p.COLUMN)?[this.field(p.COLUMN)]:[])}}),encode:{update:i(this)}},this.child.assembleGroup())},t.prototype.parseAxis=function(){this.child.parseAxis(),this.component.axes=v.parseAxisComponent(this,[p.ROW,p.COLUMN])},t.prototype.parseAxisGroup=function(){var e=s(this,p.X),t=s(this,p.Y);this.component.axisGroups=y.extend(e?{x:e}:{},t?{y:t}:{})},t.prototype.parseGridGroup=function(){var e=this.child;this.component.gridGroups=y.extend(!e.channelHasField(p.X)&&this.channelHasField(p.COLUMN)?{column:u(this)}:{},!e.channelHasField(p.Y)&&this.channelHasField(p.ROW)?{row:l(this)}:{})},t.prototype.parseLegend=function(){this.child.parseLegend(),this.component.legends=this.child.component.legends,this.child.component.legends={}},t.prototype.assembleParentGroupProperties=function(){return null},t.prototype.assembleData=function(e){return b.assembleData(this,e),this.child.assembleData(e),o(this,e),e},t.prototype.assembleLayout=function(e){return this.child.assembleLayout(e),O.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return[].concat(y.vals(this.component.axisGroups),y.flatten(y.vals(this.component.gridGroups)),this.component.mark)},t.prototype.channels=function(){return[p.ROW,p.COLUMN]},t.prototype.getMapping=function(){return this.facet},t.prototype.spacing=function(e){return this._spacing[e]},t.prototype.isFacet=function(){return!0},t}(N.Model);n.FacetModel=k,n.hasSubPlotWithXy=a,n.spacing=r,n.assembleAxesGroupData=o,n.getSharedAxisGroup=c},{"../channel":11,"../config":57,"../encoding":60,"../fielddef":62,"../log":65,"../util":74,"./axis/parse":13,"./axis/rules":14,"./common":15,"./data/data":19,"./layout":32,"./model":47,"./scale/init":49,"./scale/parse":50,tslib:5}],31:[function(e,t,n){"use strict";var a=e("tslib"),r=e("../config"),i=e("../mark"),o=e("../util"),s=e("../data"),c=e("./data/data"),l=e("./common"),u=e("./layout"),f=e("./model"),d=e("./scale/domain"),p=function(e){function t(t,n,a){var r=e.call(this,t,n,a)||this;return r.scales={},r.axes={},r.legends={},r.stack=null,r.width=t.width,r.height=t.height,r.config=r.initConfig(t.config,n),r.children=t.layer.map(function(e,t){return l.buildModel(e,r,r.getName("layer_"+t))}),r}return a.__extends(t,e),t.prototype.initConfig=function(e,t){return o.mergeDeep(o.duplicate(r.defaultConfig),e,t?t.config:{})},t.prototype.channelHasField=function(e){return!1},t.prototype.hasDiscreteScale=function(e){return this.children[0].hasDiscreteScale(e)},t.prototype.dataTable=function(){return this.children[0].dataTable()},t.prototype.fieldDef=function(e){return null},t.prototype.parseData=function(){this.children.forEach(function(e){e.parseData()}),this.component.data=c.parseLayerData(this)},t.prototype.parseSelectionData=function(){},t.prototype.parseLayoutData=function(){this.children.forEach(function(e){e.parseLayoutData()}),this.component.layout=u.parseLayerLayout(this)},t.prototype.parseScale=function(){var e=this,t=this.component.scales={};this.children.forEach(function(n){n.parseScale(),o.keys(n.component.scales).forEach(function(a){var r=n.component.scales[a];if(r){var i=t[a];i&&i.main?(i.main.domain=d.unionDomains(i.main.domain,r.main.domain),i.binLegend=i.binLegend?i.binLegend:r.binLegend,i.binLegendLabel=i.binLegendLabel?i.binLegendLabel:r.binLegendLabel):t[a]=r,o.vals(r).forEach(function(t){var a=t.name.substr(n.getName("").length),r=e.scaleName(a,!0);n.renameScale(t.name,r),t.name=r}),delete r[a]}})})},t.prototype.parseMark=function(){this.children.forEach(function(e){e.parseMark()})},t.prototype.parseAxis=function(){var e=this.component.axes={};this.children.forEach(function(t){t.parseAxis(),o.keys(t.component.axes).forEach(function(n){e[n]||(e[n]=t.component.axes[n])})})},t.prototype.parseAxisGroup=function(){return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){var e=this.component.legends={};this.children.forEach(function(t){t.parseLegend(),o.keys(t.component.legends).forEach(function(n){e[n]||(e[n]=t.component.legends[n])})})},t.prototype.assembleParentGroupProperties=function(e){return l.applyConfig({},e,i.FILL_STROKE_CONFIG.concat(["clip"]))},t.prototype.assembleData=function(e){return c.assembleData(this,e),this.children.forEach(function(t){t.assembleData(e)}),e},t.prototype.assembleLayout=function(e){return this.children.forEach(function(t){t.assembleLayout(e)}),u.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return o.flatten(this.children.map(function(e){return e.assembleMarks()}))},t.prototype.channels=function(){return[]},t.prototype.getMapping=function(){return null},t.prototype.isLayer=function(){return!0},t.prototype.compatibleSource=function(e){var t=this.data,n=e.component.data,a=!n.source||t&&s.isUrlData(t)&&t.url===n.source.url;return a},t}(f.Model);n.LayerModel=p},{"../config":57,"../data":58,"../mark":66,"../util":74,"./common":15,"./data/data":19,"./layout":32,"./model":47,"./scale/domain":48,tslib:5}],32:[function(e,t,n){"use strict";function a(e,t){var n=e.component.layout;if(!n.width&&!n.height)return t;var a=y.keys(y.extend(n.width.distinct,n.height.distinct)),r=n.width.formula.concat(n.height.formula).map(function(e){return y.extend({type:"formula"},e)});return[a.length>0?{name:e.dataName(g.LAYOUT),source:e.dataTable(),transform:[{type:"aggregate",fields:a,ops:a.map(function(){return"distinct"})}].concat(r)}:{name:e.dataName(g.LAYOUT),values:[{}],transform:r}]}function r(e){return{width:i(e,m.X),height:i(e,m.Y)}}function i(e,t){return{distinct:d(e,t),formula:[{as:e.channelSizeName(t),expr:o(e,t)}]}}function o(e,t){var n=e.scale(t);if(n&&h.hasDiscreteDomain(n.type)&&n.rangeStep){var a=p(e,t),r=void 0!==n.paddingOuter?n.paddingOuter:n.padding,i="band"===n.type?void 0!==n.paddingInner?n.paddingInner:n.padding:1,o=a+(i?" - "+i:"")+(r?" + 2*"+r:"");return"max("+o+", 0) * "+n.rangeStep}return(t===m.X?e.width:e.height)+""}function s(e){return{width:c(e,m.COLUMN),height:c(e,m.ROW)}}function c(e,t){var n=e.child.component.layout,a=t===m.ROW?"height":"width",r=n[a],i=y.extend(d(e,t),r.distinct),o=r.formula.concat([{as:e.channelSizeName(t),expr:l(e,t,e.child.channelSizeName(t))}]);return delete n[a],{distinct:i,formula:o}}function l(e,t,n){return e.channelHasField(t)?'(datum["'+n+'"] + '+e.spacing(t)+") * "+p(e,t):'datum["'+n+'"] + '+e.config.scale.facetSpacing}function u(e){return{width:f(e,m.X),height:f(e,m.Y)}}function f(e,t){var n=e.children[0].component.layout,a=t===m.Y?"height":"width",r=n[a],i=r.distinct,o=[{as:e.channelSizeName(t),expr:r.formula[0].expr}];return e.children.forEach(function(e){delete e.component.layout[a]}),{distinct:i,formula:o}}function d(e,t){if(e.channelHasField(t)&&e.hasDiscreteScale(t)){var n=e.scale(t);if(h.hasDiscreteDomain(n.type)&&!(n.domain instanceof Array)){var a=e.field(t),r={};return r[a]=!0,r}}return{}}function p(e,t){var n=e.scale(t);return n.domain instanceof Array?n.domain.length+"":e.field(t,{datum:!0,prefix:"distinct"})}var m=e("../channel"),g=e("../data"),h=e("../scale"),y=e("../util");n.assembleLayout=a,n.parseUnitLayout=r,n.unitSizeExpr=o,n.parseFacetLayout=s,n.parseLayerLayout=u,n.cardinalityExpr=p},{"../channel":11,"../data":58,"../scale":67,"../util":74}],33:[function(e,t,n){"use strict";function a(e,t,n,a){var r={},i=n.mark(),u=n.legend(a);switch(i){case c.BAR:case c.TICK:case c.TEXT:r.shape={value:"square"};break;case c.CIRCLE:case c.SQUARE:r.shape={value:i};break;case c.POINT:case c.LINE:case c.AREA:}var p=n.config,m=p.mark.filled,g=a===o.COLOR?f.without(c.FILL_STROKE_CONFIG,[m?"fill":"stroke","strokeDash","strokeDashOffset"]):f.without(c.FILL_STROKE_CONFIG,["strokeDash","strokeDashOffset"]);g=f.without(g,["strokeDash","strokeDashOffset"]),d.applyMarkConfig(r,n,g),m&&(r.strokeWidth={value:0}),a===o.OPACITY&&delete r.opacity;var h,y=n.encoding.color;if(s.isValueDef(y)&&(h={value:y.value}),void 0!==h?m?r.fill=h:r.stroke=h:a!==o.COLOR&&(r[m?"fill":"stroke"]=r[m?"fill":"stroke"]||{value:p.mark.color}),void 0!==u.symbolColor?r.fill={value:u.symbolColor}:void 0===r.fill&&(void 0!==p.mark.fill?r.fill={value:p.mark.fill}:void 0!==p.mark.stroke&&(r.stroke={value:p.mark.stroke})),a!==o.SHAPE&&(void 0!==u.symbolShape?r.shape={value:u.symbolShape}:void 0!==p.point.shape&&(r.shape={value:p.point.shape})),a!==o.SIZE&&void 0!==u.symbolSize&&(r.size={value:u.symbolSize}),e.bin&&l.hasContinuousDomain(n.scale(a).type)){var v={scale:n.scaleName(a),field:"value"};switch(a){case o.OPACITY:r.opacity=v;break;case o.SIZE:r.size=v;break;case o.COLOR:r[m?"fill":"stroke"]=v;break;default:throw Error("Legend for channel "+a+" not implemented")}}return void 0!==u.symbolStrokeWidth&&(r.strokeWidth={value:u.symbolStrokeWidth}),r=f.extend(r,t||{}),f.keys(r).length>0?r:void 0}function r(e,t,n,a){var r=n.legend(a),i=n.config,o={};return e.bin&&l.hasContinuousDomain(n.scale(a).type)?t=f.extend({text:{scale:n.scaleName(a)+p.BIN_LEGEND_LABEL_SUFFIX,field:"value"}},t||{}):e.type===u.TEMPORAL&&(t=f.extend({text:{signal:d.timeFormatExpression("datum.value",e.timeUnit,r.format,r.shortTimeLabels,i)}},t||{})),void 0!==r.labelAlign&&(o.align={value:r.labelAlign}),void 0!==r.labelColor&&(o.fill={value:r.labelColor}),void 0!==r.labelFont&&(o.font={value:r.labelFont}),void 0!==r.labelFontSize&&(o.fontSize={value:r.labelFontSize}),void 0!==r.labelBaseline&&(o.baseline={value:r.labelBaseline}),o=f.extend(o,t||{}),f.keys(o).length>0?o:void 0}function i(e,t,n,a){var r=n.legend(a),i={};return void 0!==r.titleColor&&(i.fill={value:r.titleColor}),void 0!==r.titleFont&&(i.font={value:r.titleFont}),void 0!==r.titleFontSize&&(i.fontSize={value:r.titleFontSize}),void 0!==r.titleFontWeight&&(i.fontWeight={value:r.titleFontWeight}),i=f.extend(i,t||{}),f.keys(i).length>0?i:void 0}var o=e("../../channel"),s=e("../../fielddef"),c=e("../../mark"),l=e("../../scale"),u=e("../../type"),f=e("../../util"),d=e("../common"),p=e("../scale/scale");n.symbols=a,n.labels=r,n.title=i},{"../../channel":11,"../../fielddef":62,"../../mark":66,"../../scale":67,"../../type":73,"../../util":74,"../common":15,"../scale/scale":53}],34:[function(e,t,n){"use strict";function a(e){return[s.COLOR,s.SIZE,s.SHAPE,s.OPACITY].reduce(function(t,n){return e.legend(n)&&(t[n]=i(e,n)),t},{})}function r(e,t){var n=e.fieldDef(t).bin&&c.hasContinuousDomain(e.scale(t).type)?d.BIN_LEGEND_SUFFIX:"";switch(t){case s.COLOR:var a=e.scaleName(s.COLOR)+n;return e.config.mark.filled?{fill:a}:{stroke:a};case s.SIZE:return{size:e.scaleName(s.SIZE)+n};case s.SHAPE:return{shape:e.scaleName(s.SHAPE)+n};case s.OPACITY:return{opacity:e.scaleName(s.OPACITY)+n}}return null}function i(e,t){var n=e.fieldDef(t),a=e.legend(t),i=r(e,t);u.LEGEND_PROPERTIES.forEach(function(n){var r=o(n,a,t,e);void 0!==r&&(i[n]=r)});var s=a.encode||{};return["labels","legend","title","symbols"].forEach(function(a){var r=p[a]?p[a](n,s[a],e,t):s[a];void 0!==r&&l.keys(r).length>0&&(i.encode=i.encode||{},i.encode[a]={update:r})}),i}function o(e,t,n,a){var r=a.fieldDef(n);switch(e){case"format":return f.numberFormat(r,t.format,a.config,n);case"title":return m.title(t,r,a.config);case"values":return m.values(t);case"type":m.type(t,r,n)}return t[e]}var s=e("../../channel"),c=e("../../scale"),l=e("../../util"),u=e("../../legend"),f=e("../common"),d=e("../scale/scale"),p=e("./encode"),m=e("./rules");n.parseLegendComponent=a,n.parseLegend=i},{"../../channel":11,"../../legend":64,"../../scale":67,"../../util":74,"../common":15,"../scale/scale":53,"./encode":33,"./rules":35}],35:[function(e,t,n){"use strict";function a(e,t,n){return void 0!==e.title?e.title:c.title(t,n)}function r(e){var t=e.values;return t&&s.isDateTime(t[0])?t.map(function(e){return s.timestamp(e,!0)}):t}function i(e,t,n){return e.type?e.type:n!==o.COLOR||t.bin||t.timeUnit||!u.contains([l.QUANTITATIVE,l.TEMPORAL],t.type)?void 0:"gradient"}var o=e("../../channel"),s=e("../../datetime"),c=e("../../fielddef"),l=e("../../type"),u=e("../../util");n.title=a,n.values=r,n.type=i},{"../../channel":11,"../../datetime":59,"../../fielddef":62,"../../type":73,"../../util":74}],36:[function(e,t,n){"use strict";var a=e("../../channel"),r=e("../common"),i=e("./common"),o=e("./valueref");n.area={vgMark:"area",role:void 0,encodeEntry:function(e){var t={},n=e.config,s=e.encoding,c=e.stack,l=n.mark.orient;t.orient={value:l},t.x=o.stackable(a.X,s.x,e.scaleName(a.X),e.scale(a.X),c,"base"),t.y=o.stackable(a.Y,s.y,e.scaleName(a.Y),e.scale(a.Y),c,"base"),"horizontal"===l?t.x2=o.stackable2(a.X2,s.x,s.x2,e.scaleName(a.X),e.scale(a.X),c,"base"):t.y2=o.stackable2(a.Y2,s.y,s.y2,e.scaleName(a.Y),e.scale(a.Y),c,"base");var u=o.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),n.mark.opacity&&{
value:n.mark.opacity});return void 0!==u&&(t.opacity=u),i.applyColor(t,e),r.applyMarkConfig(t,e,["interpolate","tension"]),t}}},{"../../channel":11,"../common":15,"./common":38,"./valueref":46}],37:[function(e,t,n){"use strict";function a(e,t){var n={},a=e.config,r=e.encoding,u=e.config.mark.orient,f=e.encoding.size,p=e.encoding.x,m=e.scaleName(o.X),g=e.scale(o.X);if("horizontal"===u)return n.x=d.stackable(o.X,p,m,e.scale(o.X),t,"base"),n.x2=d.stackable2(o.X2,p,r.x2,m,e.scale(o.X),t,"base"),n;if(s.isFieldDef(p)){if(p.bin&&!f)return n.x2=d.bin(p,m,"start",a.bar.binSpacing),n.x=d.bin(p,m,"end"),n;if(g.type===c.ScaleType.BAND)return n.x=d.fieldRef(p,m,{}),n.width=d.band(m),n}return n.xc=d.midPoint(o.X,p,m,e.scale(o.X),l.extend(d.midX(a),{offset:1})),n.width=d.midPoint(o.SIZE,r.size,e.scaleName(o.SIZE),e.scale(o.SIZE),i(m,e.scale(o.X),a)),n}function r(e,t){var n={},a=e.config,r=e.encoding,l=e.config.mark.orient,u=r.size,f=r.y,p=e.scaleName(o.Y),m=e.scale(o.Y);if("vertical"===l)return n.y=d.stackable(o.Y,f,p,e.scale(o.Y),t,"base"),n.y2=d.stackable2(o.Y2,f,r.y2,p,e.scale(o.Y),t,"base"),n;if(s.isFieldDef(f)){if(f.bin&&!u)return n.y2=d.bin(f,p,"start"),n.y=d.bin(f,p,"end",a.bar.binSpacing),n;if(m.type===c.ScaleType.BAND)return n.y=d.fieldRef(f,p,{}),n.height=d.band(p),n}return n.yc=d.midPoint(o.Y,f,p,e.scale(o.Y),d.midY(a)),n.height=d.midPoint(o.SIZE,r.size,e.scaleName(o.SIZE),e.scale(o.SIZE),i(p,e.scale(o.Y),a)),n}function i(e,t,n){if(n.bar.discreteBandSize)return{value:n.bar.discreteBandSize};if(t){if(t.type!==c.ScaleType.POINT)return t.type===c.ScaleType.BAND?d.band(e):{value:n.bar.continuousBandSize};if(null!==t.rangeStep)return{value:t.rangeStep-1};u.warn(u.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return n.scale.rangeStep&&null!==n.scale.rangeStep?{value:n.scale.rangeStep-1}:{value:20}}var o=e("../../channel"),s=e("../../fielddef"),c=e("../../scale"),l=e("../../util"),u=e("../../log"),f=e("./common"),d=e("./valueref");n.bar={vgMark:"rect",role:"bar",encodeEntry:function(e){var t=e.stack,n=l.extend(a(e,t),r(e,t)),i=d.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),e.config.mark.opacity&&{value:e.config.mark.opacity});return void 0!==i&&(n.opacity=i),f.applyColor(n,e),n}}},{"../../channel":11,"../../fielddef":62,"../../log":65,"../../scale":67,"../../util":74,"./common":38,"./valueref":46}],38:[function(e,t,n){"use strict";function a(e,t){var n=t.config,a=n.mark.filled;a?o.applyMarkConfig(e,t,r.FILL_CONFIG):o.applyMarkConfig(e,t,r.STROKE_CONFIG);var c=s.midPoint("color",t.encoding.color,t.scaleName("color"),t.scale("color"),void 0);void 0!==c?a?e.fill=c:e.stroke=c:e[a?"fill":"stroke"]=e[a?"fill":"stroke"]||{value:t.config.mark.color},!e.fill&&i.contains(["bar","point","circle","square"],t.mark())&&(e.fill={value:"transparent"})}var r=e("../../mark"),i=e("../../util"),o=e("../common"),s=e("./valueref");n.applyColor=a},{"../../mark":66,"../../util":74,"../common":15,"./valueref":46}],39:[function(e,t,n){"use strict";function a(e,t){return i.isValueDef(e)?{value:e.value}:{value:t.mark.strokeWidth}}var r=e("../../channel"),i=e("../../fielddef"),o=e("../common"),s=e("./common"),c=e("./valueref");n.line={vgMark:"line",role:void 0,encodeEntry:function(e){var t={};t.x=c.stackable(r.X,e.encoding.x,e.scaleName(r.X),e.scale(r.X),e.stack,"base"),t.y=c.stackable(r.Y,e.encoding.y,e.scaleName(r.Y),e.scale(r.Y),e.stack,"base");var n=a(e.encoding.size,e.config);n&&(t.strokeWidth=n);var i=c.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),e.config.mark.opacity&&{value:e.config.mark.opacity});return void 0!==i&&(t.opacity=i),s.applyColor(t,e),o.applyMarkConfig(t,e,["interpolate","tension"]),t}}},{"../../channel":11,"../../fielddef":62,"../common":15,"./common":38,"./valueref":46}],40:[function(e,t,n){"use strict";function a(e){return f.contains([u.LINE,u.AREA],e.mark())?i(e):o(e)}function r(e){var t=e.parent;return t&&t.isFacet()?t.facetedTable():e.stack?e.dataName("stacked"):e.dataTable()}function i(e){var t=e.mark(),n=s(e),a=[{name:e.getName("marks"),type:E[t].vgMark,from:{data:(n.length>0?b:"")+r(e)},encode:{update:E[t].encodeEntry(e)}}];return n.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:b+r(e),data:r(e),groupby:n}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:a}]:a}function o(e){var t=e.mark(),n=E[t].role,a=[];return a.push(c.__assign({name:e.getName("marks"),type:E[t].vgMark},n?{role:n}:{},{from:{data:r(e)},encode:{update:E[t].encodeEntry(e)}})),a}function s(e){return O.reduce(function(t,n){return e.channelHasField(n)&&!e.fieldDef(n).aggregate&&t.push(e.field(n)),t},[])}var c=e("tslib"),l=e("../../channel"),u=e("../../mark"),f=e("../../util"),d=e("./area"),p=e("./bar"),m=e("./line"),g=e("./point"),h=e("./rect"),y=e("./rule"),v=e("./text"),S=e("./tick"),E={area:d.area,bar:p.bar,line:m.line,point:g.point,text:v.text,tick:S.tick,rect:h.rect,rule:y.rule,circle:g.circle,square:g.square};n.parseMark=a;var b="faceted-path-",O=f.without(l.NONSPATIAL_CHANNELS,["order"])},{"../../channel":11,"../../mark":66,"../../util":74,"./area":36,"./bar":37,"./line":39,"./point":41,"./rect":42,"./rule":43,"./text":44,"./tick":45,tslib:5}],41:[function(e,t,n){"use strict";function a(e,t){var n={},a=e.config,c=e.encoding,l=e.stack,u=t?a[t]:a.point;n.x=s.stackable(i.X,c.x,e.scaleName(i.X),e.scale(i.X),l,s.midX(a)),n.y=s.stackable(i.Y,c.y,e.scaleName(i.Y),e.scale(i.Y),l,s.midY(a)),n.size=s.midPoint(i.SIZE,c.size,e.scaleName(i.SIZE),e.scale(i.SIZE),{value:u.size}),n.shape=r(c.shape,e.scaleName(i.SHAPE),e.scale(i.SHAPE),a.point,t);var f=s.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),a.mark.opacity&&{value:a.mark.opacity});return void 0!==f&&(n.opacity=f),o.applyColor(n,e),n}function r(e,t,n,a,r){return r?{value:r}:s.midPoint(i.SHAPE,e,t,n,{value:a.shape})}var i=e("../../channel"),o=e("./common"),s=e("./valueref");n.point={vgMark:"symbol",role:"point",encodeEntry:function(e){return a(e)}},n.circle={vgMark:"symbol",role:"circle",encodeEntry:function(e){return a(e,"circle")}},n.square={vgMark:"symbol",role:"square",encodeEntry:function(e){return a(e,"square")}}},{"../../channel":11,"./common":38,"./valueref":46}],42:[function(e,t,n){"use strict";function a(e){var t={},n=e.encoding.x,a=e.encoding.x2,r=e.scaleName(i.X),l=e.scale(i.X);if(o.isFieldDef(n)&&n.bin&&!a)t.x2=d.bin(n,r,"start"),t.x=d.bin(n,r,"end");else if(l&&s.hasDiscreteDomain(l.type)){if(l.type!==s.ScaleType.BAND)throw new Error(u.message.scaleTypeNotWorkWithMark(c.RECT,l.type));t.x=d.fieldRef(n,r,{}),t.width=d.band(r)}else t.x=d.midPoint(i.X,n,r,l,"baseOrMax"),t.x2=d.midPoint(i.X2,a,r,l,"base");return t}function r(e){var t={},n=e.encoding.y,a=e.encoding.y2,r=e.scaleName(i.Y),l=e.scale(i.Y);if(o.isFieldDef(n)&&n.bin&&!a)t.y2=d.bin(n,r,"start"),t.y=d.bin(n,r,"end");else if(l&&s.hasDiscreteDomain(l.type)){if(l.type!==s.ScaleType.BAND)throw new Error(u.message.scaleTypeNotWorkWithMark(c.RECT,l.type));t.y=d.fieldRef(n,r,{}),t.height=d.band(r)}else t.y=d.midPoint(i.Y,n,r,l,"baseOrMax"),t.y2=d.midPoint(i.Y2,a,r,l,"base");return t}var i=e("../../channel"),o=e("../../fielddef"),s=e("../../scale"),c=e("../../mark"),l=e("../../util"),u=e("../../log"),f=e("./common"),d=e("./valueref");n.rect={vgMark:"rect",role:void 0,encodeEntry:function(e){var t=l.extend(a(e),r(e)),n=d.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),e.config.mark.opacity&&{value:e.config.mark.opacity});return void 0!==n&&(t.opacity=n),f.applyColor(t,e),t}}},{"../../channel":11,"../../fielddef":62,"../../log":65,"../../mark":66,"../../scale":67,"../../util":74,"./common":38,"./valueref":46}],43:[function(e,t,n){"use strict";var a=e("../../channel"),r=e("./common"),i=e("./valueref");n.rule={vgMark:"rule",role:void 0,encodeEntry:function(e){var t={},n=e.config.mark.orient,o=e.config,s=e.encoding,c=e.stack;t.x=i.stackable(a.X,s.x,e.scaleName(a.X),e.scale(a.X),c,"base"),t.y=i.stackable(a.Y,s.y,e.scaleName(a.Y),e.scale(a.Y),c,"base"),"vertical"===n?t.y2=i.stackable2(a.Y2,s.y,s.y2,e.scaleName(a.Y),e.scale(a.Y),c,"baseOrMax"):t.x2=i.stackable2(a.X2,s.x,s.x2,e.scaleName(a.X),e.scale(a.X),c,"baseOrMax");var l=i.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),o.mark.opacity&&{value:o.mark.opacity});return void 0!==l&&(t.opacity=l),r.applyColor(t,e),t.strokeWidth=i.midPoint(a.SIZE,s.size,e.scaleName(a.SIZE),e.scale(a.SIZE),{value:o.rule.strokeWidth}),t}}},{"../../channel":11,"./common":38,"./valueref":46}],44:[function(e,t,n){"use strict";function a(e,t){return c.isFieldDef(t)&&t.type===l.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:e.scale.textXRangeStep/2}}function r(e,t){if(e){if(c.isFieldDef(e)){if(l.QUANTITATIVE===e.type){var n=o.numberFormat(e,e.format,t,i.TEXT);return{signal:"format("+c.field(e,{datum:!0})+", '"+n+"')"}}return l.TEMPORAL===e.type?{signal:o.timeFormatExpression(c.field(e,{datum:!0}),e.timeUnit,e.format,t.text.shortTimeLabels,t)}:{field:e.field}}if(e.value)return{value:e.value}}return{value:t.text.text}}var i=e("../../channel"),o=e("../common"),s=e("./common"),c=e("../../fielddef"),l=e("../../type"),u=e("./valueref");n.text={vgMark:"text",role:void 0,encodeEntry:function(e){var t={};o.applyConfig(t,e.config.text,["angle","align","baseline","dx","dy","font","fontWeight","fontStyle","radius","theta","text"]);var n=e.config,c=e.encoding,l=e.stack,f=c.text;t.x=u.stackable(i.X,c.x,e.scaleName(i.X),e.scale(i.X),l,a(n,f)),t.y=u.stackable(i.Y,c.y,e.scaleName(i.Y),e.scale(i.Y),l,u.midY(n)),t.fontSize=u.midPoint(i.SIZE,c.size,e.scaleName(i.SIZE),e.scale(i.SIZE),{value:n.text.fontSize}),t.text=r(f,n);var d=u.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),n.mark.opacity&&{value:n.mark.opacity});return void 0!==d&&(t.opacity=d),s.applyColor(t,e),t}}},{"../../channel":11,"../../fielddef":62,"../../type":73,"../common":15,"./common":38,"./valueref":46}],45:[function(e,t,n){"use strict";function a(e,t,n,a,i){var s;if(void 0!==a.tick.bandSize)s=a.tick.bandSize;else{var c=void 0!==i?i:a.scale.rangeStep;if("number"!=typeof c)throw new Error("Function does not handle non-numeric rangeStep");s=c/1.5}return o.midPoint(r.SIZE,e,t,n,{value:s})}var r=e("../../channel"),i=e("./common"),o=e("./valueref");n.tick={vgMark:"rect",role:"tick",encodeEntry:function(e){var t={},n=e.config,s=e.encoding,c=e.stack;t.xc=o.stackable(r.X,s.x,e.scaleName(r.X),e.scale(r.X),c,o.midX(n)),t.yc=o.stackable(r.Y,s.y,e.scaleName(r.Y),e.scale(r.Y),c,o.midY(n)),"horizontal"===n.mark.orient?(t.width=a(s.size,e.scaleName(r.SIZE),e.scale(r.SIZE),n,(e.scale(r.X)||{}).rangeStep),t.height={value:n.tick.thickness}):(t.width={value:n.tick.thickness},t.height=a(s.size,e.scaleName(r.SIZE),e.scale(r.SIZE),n,(e.scale(r.Y)||{}).rangeStep));var l=o.midPoint("opacity",e.encoding.opacity,e.scaleName("opacity"),e.scale("opacity"),n.mark.opacity&&{value:n.mark.opacity});return void 0!==l&&(t.opacity=l),i.applyColor(t,e),t}}},{"../../channel":11,"./common":38,"./valueref":46}],46:[function(e,t,n){"use strict";function a(e,t,n,a,r,i){return t&&r&&e===r.fieldChannel?o(t,n,{suffix:"end"}):l(e,t,n,a,i)}function r(e,t,n,a,r,i,s){return t&&i&&e.charAt(0)===i.fieldChannel.charAt(0)?o(t,a,{suffix:"start"}):l(e,n,a,r,s)}function i(e,t,n,a){return o(e,t,{binSuffix:n},a)}function o(e,t,n,a){var r={scale:t,field:y.field(e,n)};return a&&(r.offset=a),r}function s(e,t){return void 0===t&&(t=!0),{scale:e,band:t}}function c(e,t){return{scale:t,signal:"("+y.field(e,{binSuffix:"start",datum:!0})+"+"+y.field(e,{binSuffix:"end",datum:!0})+")/2"}}function l(e,t,n,a,r){if(t){if(y.isFieldDef(t))return v.hasDiscreteDomain(a.type)?"band"===a.type?o(t,n,{binSuffix:"range"},s(n,.5)):o(t,n,{binSuffix:"range"}):t.bin?c(t,n):o(t,n,{});if(t.value)return{value:t.value};throw new Error("FieldDef without field or value.")}if("base"===r){if(e===h.X||e===h.X2)return d(n,a);if(e===h.Y||e===h.Y2)return m(n,a);throw new Error("Unsupported channel "+e+" for base function")}if("baseOrMax"===r){if(e===h.X||e===h.X2)return p(n,a);if(e===h.Y||e===h.Y2)return g(n,a);throw new Error("Unsupported channel "+e+" for base function")}return r}function u(e){if("string"==typeof e.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:e.scale.rangeStep/2}}function f(e){if("string"==typeof e.scale.rangeStep)throw new Error("midX can not handle string rangeSteps");return{value:e.scale.rangeStep/2}}function d(e,t){return e&&!S.contains([v.ScaleType.LOG,v.ScaleType.TIME,v.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{value:0}}function p(e,t){return e&&!S.contains([v.ScaleType.LOG,v.ScaleType.TIME,v.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{field:{group:"width"}}}function m(e,t){return e&&!S.contains([v.ScaleType.LOG,v.ScaleType.TIME,v.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{field:{group:"height"}}}function g(e,t){return e&&!S.contains([v.ScaleType.LOG,v.ScaleType.TIME,v.ScaleType.UTC],t.type)&&t.zero!==!1?{scale:e,value:0}:{value:0}}var h=e("../../channel"),y=e("../../fielddef"),v=e("../../scale"),S=e("../../util");n.stackable=a,n.stackable2=r,n.bin=i,n.fieldRef=o,n.band=s,n.binMidSignal=c,n.midPoint=l,n.midX=u,n.midY=f},{"../../channel":11,"../../fielddef":62,"../../scale":67,"../../util":74}],47:[function(e,t,n){"use strict";var a=e("../log"),r=e("../channel"),i=e("../encoding"),o=e("../fielddef"),s=e("../scale"),c=e("../util"),l=e("./scale/scale"),u=function(){function e(){this.nameMap={}}return e.prototype.rename=function(e,t){this.nameMap[e]=t},e.prototype.has=function(e){return void 0!==this.nameMap[e]},e.prototype.get=function(e){for(;this.nameMap[e];)e=this.nameMap[e];return e},e}(),f=function(){function e(e,t,n){this.scales={},this.axes={},this.legends={},this.children=[],this.parent=t,this.name=e.name||n,this.dataNameMap=t?t.dataNameMap:new u,this.scaleNameMap=t?t.scaleNameMap:new u,this.sizeNameMap=t?t.sizeNameMap:new u,this.data=e.data,this.description=e.description,this.padding=e.padding,this.transform=e.transform,e.transform&&void 0===e.transform.filterInvalid&&void 0!==e.transform.filterNull&&(e.transform.filterInvalid=e.transform.filterNull,a.warn(a.message.DEPRECATED_FILTER_NULL)),this.component={data:null,layout:null,mark:null,scales:null,axes:null,axisGroups:null,gridGroups:null,legends:null}}return e.prototype.parse=function(){this.parseData(),this.parseSelectionData(),this.parseLayoutData(),this.parseScale(),this.parseAxis(),this.parseLegend(),this.parseAxisGroup(),this.parseGridGroup(),this.parseMark()},e.prototype.assembleScales=function(){return c.flatten(c.vals(this.component.scales).map(function(e){var t=[e.main];return e.binLegend&&t.push(e.binLegend),e.binLegendLabel&&t.push(e.binLegendLabel),t}))},e.prototype.assembleAxes=function(){return[].concat.apply([],c.vals(this.component.axes))},e.prototype.assembleLegends=function(){return c.vals(this.component.legends)},e.prototype.assembleGroup=function(){var e={};e.marks=this.assembleMarks();var t=this.assembleScales();t.length>0&&(e.scales=t);var n=this.assembleAxes();n.length>0&&(e.axes=n);var a=this.assembleLegends();return a.length>0&&(e.legends=a),e},e.prototype.reduce=function(e,t,n){return i.reduce(this.getMapping(),e,t,n)},e.prototype.forEach=function(e,t){i.forEach(this.getMapping(),e,t)},e.prototype.hasDescendantWithFieldOnChannel=function(e){for(var t=0,n=this.children;t<n.length;t++){var a=n[t];if(a.isUnit()){if(a.channelHasField(e))return!0}else if(a.hasDescendantWithFieldOnChannel(e))return!0}return!1},e.prototype.getName=function(e,t){return void 0===t&&(t="_"),(this.name?this.name+t:"")+e},e.prototype.renameData=function(e,t){this.dataNameMap.rename(e,t)},e.prototype.dataName=function(e){return this.dataNameMap.get(this.getName(String(e)))},e.prototype.renameSize=function(e,t){this.sizeNameMap.rename(e,t)},e.prototype.channelSizeName=function(e){return this.sizeName(e===r.X||e===r.COLUMN?"width":"height")},e.prototype.sizeName=function(e){return this.sizeNameMap.get(this.getName(e,"_"))},e.prototype.calculate=function(){return this.transform?this.transform.calculate:void 0},e.prototype.filterInvalid=function(){var e=this.transform||{};return void 0===e.filterInvalid?this.parent?this.parent.filterInvalid():void 0:e.filterInvalid},e.prototype.filter=function(){return this.transform?this.transform.filter:void 0},e.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=c.extend({binSuffix:s.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),o.field(n,t)},e.prototype.scale=function(e){return this.scales[e]},e.prototype.hasDiscreteScale=function(e){var t=this.scale(e);return t&&s.hasDiscreteDomain(t.type)},e.prototype.renameScale=function(e,t){this.scaleNameMap.rename(e,t)},e.prototype.scaleName=function(e,t){var n=e.replace(l.BIN_LEGEND_SUFFIX,"").replace(l.BIN_LEGEND_LABEL_SUFFIX,"");return t?this.getName(e+""):this.scale&&this.scales[n]||this.scaleNameMap.has(this.getName(e+""))?this.scaleNameMap.get(this.getName(e+"")):void 0},e.prototype.sort=function(e){return(this.getMapping()[e]||{}).sort},e.prototype.axis=function(e){return this.axes[e]},e.prototype.legend=function(e){return this.legends[e]},e.prototype.isUnit=function(){return!1},e.prototype.isFacet=function(){return!1},e.prototype.isLayer=function(){return!1},e}();n.Model=f},{"../channel":11,"../encoding":60,"../fielddef":62,"../log":65,"../scale":67,"../util":74,"./scale/scale":53}],48:[function(e,t,n){"use strict";function a(e,t,n){var a=t.fieldDef(n);if(e.domain)return f.isDateTime(e.domain[0])?e.domain.map(function(e){return f.timestamp(e,!0)}):e.domain;if("temporal"===a.type)return{data:t.dataTable(),field:t.field(n),sort:{field:t.field(n),op:"min"}};var o=t.stack;if(o&&n===o.fieldChannel)return"normalize"===o.offset?[0,1]:{data:t.dataName("stacked"),fields:[t.field(n,{suffix:"start"}),t.field(n,{suffix:"end"})]};var s=i(e,t,n),c=r(t,n,e.type);return s?{data:u.SOURCE,field:t.field(n,{noAggregate:!0})}:a.bin?d.hasDiscreteDomain(e.type)?{data:t.dataTable(),field:t.field(n,{binSuffix:"range"}),sort:{field:t.field(n,{binSuffix:"start"}),op:"min"}}:"x"===n||"y"===n?{data:t.dataTable(),fields:[t.field(n,{binSuffix:"start"}),t.field(n,{binSuffix:"end"})]}:{data:t.dataTable(),field:t.field(n,{binSuffix:"start"})}:c?{data:g.isBoolean(c)?t.dataTable():u.SOURCE,field:t.field(n),sort:c}:{data:t.dataTable(),field:t.field(n)}}function r(e,t,n){if(d.hasDiscreteDomain(n)){var a=e.sort(t);return p.isSortField(a)?{op:a.op,field:a.field}:!!g.contains(["ascending","descending",void 0],a)||void 0}}function i(e,t,n){var a=t.fieldDef(n);return e.useRawDomain&&a.aggregate&&l.SHARED_DOMAIN_OPS.indexOf(a.aggregate)>=0&&("quantitative"===a.type&&!a.bin&&e.type!==d.ScaleType.LOG||"temporal"===a.type&&g.contains([d.ScaleType.TIME,d.ScaleType.UTC],e.type))}function o(e){if(g.isArray(e))return[e];if(m.isDataRefDomain(e))return delete e.sort,[e];if(m.isFieldRefUnionDomain(e))return e.fields.map(function(t){return{data:e.data,field:t}});if(m.isDataRefUnionedDomain(e))return e.fields.map(function(e){return g.isArray(e)?e:{field:e.field,data:e.data}});throw new Error(c.message.INVAID_DOMAIN)}function s(e,t){var n=o(e),a=o(t),r=n.concat(a);if(r=g.unique(r,g.hash),r.length>1){var i=r.map(function(e){return m.isDataRefDomain(e)?e.data:null});return 1===g.unique(i,function(e){return e}).length&&null!==i[0]?{data:i[0],fields:r.map(function(e){return e.field})}:{fields:r,sort:!0}}return r[0]}var c=e("../../log"),l=e("../../aggregate"),u=e("../../data"),f=e("../../datetime"),d=e("../../scale"),p=e("../../sort"),m=e("../../vega.schema"),g=e("../../util");Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,n.domainSort=r,n.unionDomains=s},{"../../aggregate":8,"../../data":58,"../../datetime":59,"../../log":65,"../../scale":67,"../../sort":68,"../../util":74,"../../vega.schema":76}],49:[function(e,t,n){"use strict";function a(e,t,a,c,f,d){var p=(t||{}).scale||{},m={type:l.default(p.type,t.type,e,t.timeUnit,c,void 0!==f,p.rangeStep,a.scale)};return n.NON_TYPE_RANGE_SCALE_PROPERTIES.forEach(function(n){var s=p[n],c=o.scaleTypeSupportProperty(m.type,n),l=o.channelScalePropertyIncompatability(e,n);if(void 0!==s)return void(c?l?i.warn(l):m[n]=s:i.warn(i.message.scalePropertyNotWorkWithScaleType(m.type,n,e)));if(c&&void 0===l){var u=r(n,m,e,t,a.scale);void 0!==u&&(m[n]=u)}}),u.extend(m,s.default(e,m.type,t.type,p,a,m.zero,c,f,d))}function r(e,t,n,a,r){switch(e){case"nice":return c.nice(t.type,n,a);case"padding":return c.padding(n,t.type,r);case"paddingInner":return c.paddingInner(t.padding,n,r);case"paddingOuter":return c.paddingOuter(t.padding,n,t.type,t.paddingInner,r);case"round":return c.round(n,r);case"zero":return c.zero(t,n,a)}return r[e]}var i=e("../../log"),o=e("../../scale"),s=e("./range"),c=e("./rules"),l=e("./type"),u=e("../../util");n.NON_TYPE_RANGE_SCALE_PROPERTIES=["domain","round","clamp","nice","exponent","zero","interpolate","padding","paddingInner","paddingOuter","useRawDomain"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=a},{"../../log":65,"../../scale":67,"../../util":74,"./range":51,"./rules":52,"./type":54}],50:[function(e,t,n){"use strict";function a(e){return e.channels().reduce(function(t,n){var a=r(e,n);return a&&(t[n]=a),t},{})}function r(e,t){if(e.scale(t)){var n=e.fieldDef(t),a={main:i(e,t)};return e.legend(t)&&n.bin&&f.hasContinuousDomain(e.scale(t).type)&&(a.binLegend=s(t,e),a.binLegendLabel=c(t,e,n)),a}return null}function i(e,t){var a=e.scale(t),r=e.sort(t),i={name:e.scaleName(t+"",!0),type:a.type,domain:o(e,t),range:g.parseRange(a)};return n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES.forEach(function(e){i[e]=a[e]}),r&&"descending"===(d.isSortField(r)?r.order:r)&&(i.reverse=!0),i}function o(e,t){var n=e.scale(t);return t===l.X&&e.channelHasField(l.X2)?e.channelHasField(l.X)?m.unionDomains(m.default(n,e,l.X),m.default(n,e,l.X2)):m.default(n,e,l.X2):t===l.Y&&e.channelHasField(l.Y2)?e.channelHasField(l.Y)?m.unionDomains(m.default(n,e,l.Y),m.default(n,e,l.Y2)):m.default(n,e,l.Y2):m.default(n,e,t)}function s(e,t){return{name:t.scaleName(e,!0)+p.BIN_LEGEND_SUFFIX,type:f.ScaleType.POINT,domain:{data:t.dataTable(),field:t.field(e),sort:!0},range:[0,1]}}function c(e,t,n){return{name:t.scaleName(e,!0)+p.BIN_LEGEND_LABEL_SUFFIX,type:f.ScaleType.ORDINAL,domain:{data:t.dataTable(),field:t.field(e),sort:!0},range:{data:t.dataTable(),field:u.field(n,{binSuffix:"range"}),sort:{field:t.field(e,{binSuffix:"start"}),op:"min"}}}}var l=e("../../channel"),u=e("../../fielddef"),f=e("../../scale"),d=e("../../sort"),p=e("./scale"),m=e("./domain"),g=e("./range");Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,n.parseScale=r,n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=["round","clamp","nice","exponent","interpolate","zero","padding","paddingInner","paddingOuter"],n.parseDomain=o},{"../../channel":11,"../../fielddef":62,"../../scale":67,"../../sort":68,"./domain":48,"./range":51,"./scale":53}],51:[function(e,t,n){"use strict";function a(e){if(e.rangeStep)return{step:e.rangeStep};if(e.scheme){var t=e.scheme;if(f.isExtendedScheme(t)){var n={scheme:t.name};return t.count&&(n.count=t.count),t.extent&&(n.extent=t.extent),n}return{scheme:t}}return e.range}function r(e,t,a,r,c,p,m,g,h){for(var y=!1,v=0,S=n.RANGE_PROPERTIES;v<S.length;v++){var E=S[v];if(void 0!==r[E]){var b=f.scaleTypeSupportProperty(t,E),O=f.channelScalePropertyIncompatability(e,E);if(b)if(O)l.warn(O);else switch(E){case"range":return{range:r[E]};case"scheme":return{scheme:r[E]};case"rangeStep":if(void 0===g){var N=r[E];if(null!==N)return{rangeStep:N};y=!0}else l.warn(l.message.rangeStepDropped(e))}else l.warn(l.message.scalePropertyNotWorkWithScaleType(t,E,e))}}switch(e){case u.ROW:return{range:"height"};case u.COLUMN:return{range:"width"};case u.X:case u.Y:if(void 0===g){if(d.contains(["point","band"],t)&&!y)if(e===u.X&&"text"===m){if(c.scale.textXRangeStep)return{rangeStep:c.scale.textXRangeStep}}else if(c.scale.rangeStep)return{rangeStep:c.scale.rangeStep};g=e===u.X?c.cell.width:c.cell.height}return{range:e===u.X?[0,g]:[g,0]};case u.SIZE:var T=o(m,p,c),A=s(m,h,c);return{range:[T,A]};case u.SHAPE:case u.COLOR:return{range:i(e,t,a,m)};case u.OPACITY:return{range:[c.mark.minOpacity,c.mark.maxOpacity]}}throw new Error("Scale range undefined for channel "+e)}function i(e,t,n,a){switch(e){case u.SHAPE:return"symbol";case u.COLOR:return"ordinal"===t?"nominal"===n?"category":"ordinal":"rect"===a?"heatmap":"ramp"}}function o(e,t,n){if(t)return 0;switch(e){case"bar":return void 0!==n.bar.minBandSize?n.bar.minBandSize:n.bar.continuousBandSize;case"tick":return n.tick.minBandSize;case"rule":return n.rule.minStrokeWidth;case"text":return n.text.minFontSize;case"point":return n.point.minSize;case"square":return n.square.minSize;case"circle":return n.circle.minSize}throw new Error(l.message.incompatibleChannel("size",e))}function s(e,t,n){var a=n.scale;switch(e){case"bar":return void 0!==n.bar.maxBandSize?n.bar.maxBandSize:c(t,n.mark)-1;case"tick":return void 0!==n.tick.maxBandSize?n.tick.maxBandSize:c(t,n.mark)-1;case"rule":return n.rule.maxStrokeWidth;case"text":return n.text.maxFontSize;case"point":case"square":case"circle":if(n[e].maxSize)return n[e].maxSize;var r=c(t,a);return(r-2)*(r-2)}throw new Error(l.message.incompatibleChannel("size",e))}function c(e,t){return e.length>0?Math.min.apply(null,e):t.rangeStep?t.rangeStep:21}var l=e("../../log"),u=e("../../channel"),f=e("../../scale"),d=e("../../util");n.parseRange=a,n.RANGE_PROPERTIES=["range","rangeStep","scheme"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{"../../channel":11,"../../log":65,"../../scale":67,"../../util":74}],52:[function(e,t,n){"use strict";function a(e,t,n){return d.contains([u.ScaleType.TIME,u.ScaleType.UTC],e)?f.smallestUnit(n.timeUnit):d.contains([l.X,l.Y],t)}function r(e,t,n){if(d.contains([l.X,l.Y],e)&&t===u.ScaleType.POINT)return n.pointPadding}function i(e,t,n){if(void 0===e)return d.contains([l.X,l.Y],t)?n.bandPaddingInner:void 0}function o(e,t,n,a,r){if(void 0===e)return d.contains([l.X,l.Y],t)&&n===u.ScaleType.BAND?void 0!==r.bandPaddingOuter?r.bandPaddingOuter:a/2:void 0}function s(e,t){if(d.contains(["x","y","row","column"],e))return t.round}function c(e,t,n){return"size"===t&&"quantitative"===n.type||!(e.domain||n.bin||!d.contains([l.X,l.Y],t))}var l=e("../../channel"),u=e("../../scale"),f=e("../../timeunit"),d=e("../../util");n.nice=a,n.padding=r,n.paddingInner=i,n.paddingOuter=o,n.round=s,n.zero=c},{"../../channel":11,"../../scale":67,"../../timeunit":71,"../../util":74}],53:[function(e,t,n){"use strict";n.BIN_LEGEND_SUFFIX="_bin_legend",n.BIN_LEGEND_LABEL_SUFFIX="_bin_legend_label"},{}],54:[function(e,t,n){"use strict";function a(e,t,n,a,i,o,l,u){if(!c.hasScale(n))return null;if(void 0!==e){if(c.supportScaleType(n,e))return e;var f=r(t,n,a,i,o,l,u);return s.warn(s.message.scaleTypeNotWorkWithChannel(n,e,f)),f}return r(t,n,a,i,o,l,u)}function r(e,t,n,a,r,o,f){if(u.contains(["row","column"],t))return l.ScaleType.BAND;switch(e){case"nominal":return"color"===t||"discrete"===c.getRangeType(t)?l.ScaleType.ORDINAL:i(t,a,r,o,f);case"ordinal":return"color"===t?l.ScaleType.ORDINAL:"discrete"===c.getRangeType(t)?(s.warn(s.message.discreteChannelCannotEncode(t,"ordinal")),l.ScaleType.ORDINAL):i(t,a,r,o,f);case"temporal":if("color"===t)return"sequential";if("discrete"===c.getRangeType(t))return s.warn(s.message.discreteChannelCannotEncode(t,"temporal")),l.ScaleType.ORDINAL;switch(n){case"hours":case"day":case"month":case"quarter":return i(t,a,r,o,f)}return l.ScaleType.TIME;case"quantitative":return"color"===t?"sequential":"discrete"===c.getRangeType(t)?(s.warn(s.message.discreteChannelCannotEncode(t,"quantitative")),l.ScaleType.ORDINAL):l.ScaleType.LINEAR}throw new Error(s.message.invalidFieldType(e))}function i(e,t,n,a,r){if(u.contains(["x","y"],e)){if("rect"===t)return l.ScaleType.BAND;if("bar"===t)return o(n,a,r)?l.ScaleType.POINT:l.ScaleType.BAND}return l.ScaleType.POINT}function o(e,t,n){return!e&&(void 0!==t?null!==t:!!n.rangeStep)}var s=e("../../log"),c=e("../../channel"),l=e("../../scale"),u=e("../../util");Object.defineProperty(n,"__esModule",{value:!0}),n.default=a},{"../../channel":11,"../../log":65,"../../scale":67,"../../util":74}],55:[function(e,t,n){"use strict";var a=e("tslib"),r=e("../log"),i=e("../channel"),o=e("../config"),s=e("../data"),c=e("../encoding"),l=e("../fielddef"),u=e("../mark"),f=e("../scale"),d=e("../util"),p=e("./axis/parse"),m=e("./common"),g=e("./config"),h=e("./data/data"),y=e("./legend/parse"),v=e("./layout"),S=e("./model"),E=e("./mark/mark"),b=e("./scale/init"),O=e("./scale/parse"),N=e("../stack"),T=function(e){function t(t,n,a){var r=e.call(this,t,n,a)||this;r.scales={},r.axes={},r.legends={},r.children=[];var i=void 0!==t.width?t.width:n?n.width:void 0,o=void 0!==t.height?t.height:n?n.height:void 0,s=r.markDef=r.initMarkDef(t.mark),c=s.type,l=r.encoding=r.initEncoding(c,t.encoding||{}),u=r.config=r.initConfig(t.config,n);r.stack=N.stack(c,l,u.stack),r.scales=r.initScales(c,l,u,i,o),u.mark=g.initMarkConfig(c,l,r.scales,r.stack,u),"text"===c&&(u.text=g.initTextConfig(l,u)),r.axes=r.initAxes(l,u),r.legends=r.initLegend(l,u);var f=r.initSize(c,r.scales,i,o,u.cell,u.scale),d=f.width,p=void 0===d?r.width:d,m=f.height,h=void 0===m?r.height:m;return r.width=p,r.height=h,r}return a.__extends(t,e),t.prototype.initMarkDef=function(e){return u.isMarkDef(e)?e:{type:e}},t.prototype.initEncoding=function(e,t){return t=d.duplicate(t),Object.keys(t).forEach(function(n){if(!i.supportMark(n,e))return r.warn(r.message.incompatibleChannel(n,e)),void delete t[n];if(d.isArray(t[n]))t[n]=t[n].reduce(function(e,t){return l.isFieldDef(t)||l.isValueDef(t)?e.push(l.normalize(t,n)):r.warn(r.message.emptyFieldDef(t,n)),e},[]);else{var a=t[n];if(void 0===a.field&&void 0===a.value)return r.warn(r.message.emptyFieldDef(a,n)),void delete t[n];l.normalize(a,n)}}),t},t.prototype.initConfig=function(e,t){for(var n=d.mergeDeep(d.duplicate(o.defaultConfig),t?t.config:{},e),a=!1;null!==t;){if(t.isFacet()){a=!0;break}t=t.parent}return a&&(n.cell=d.extend({},n.cell,n.facet.cell)),n},t.prototype.initScales=function(e,t,n,a,r){var o=[];return i.UNIT_SCALE_CHANNELS.reduce(function(s,l){if(c.channelHasField(t,l)||l===i.X&&c.channelHasField(t,i.X2)||l===i.Y&&c.channelHasField(t,i.Y2)){var u=s[l]=b.default(l,t[l],n,e,l===i.X?a:l===i.Y?r:void 0,o);l!==i.X&&l!==i.Y||u.rangeStep&&o.push(u.rangeStep)}return s},{})},t.prototype.initSize=function(e,t,n,a,r,o){if(void 0===n)if(t[i.X])f.hasDiscreteDomain(t[i.X].type)&&t[i.X].rangeStep||(n=r.width);else if(e===u.TEXT)n=o.textXRangeStep;else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");n=o.rangeStep}if(void 0===a)if(t[i.Y])f.hasDiscreteDomain(t[i.Y].type)&&t[i.Y].rangeStep||(a=r.height);else{if("string"==typeof o.rangeStep)throw new Error("_initSize does not handle string rangeSteps");a=o.rangeStep}return{width:n,height:a}},t.prototype.initAxes=function(e,t){return[i.X,i.Y].reduce(function(n,a){var r=e[a];if(l.isFieldDef(r)||a===i.X&&l.isFieldDef(e.x2)||a===i.Y&&l.isFieldDef(e.y2)){var o=l.isFieldDef(r)?r.axis:null;null!==o&&o!==!1&&(n[a]=d.extend({},t.axis,o===!0?{}:o||{}))}return n},{})},t.prototype.initLegend=function(e,t){return i.NONSPATIAL_SCALE_CHANNELS.reduce(function(n,a){var r=e[a];if(l.isFieldDef(r)){var i=r.legend;null!==i&&i!==!1&&(n[a]=d.extend({},t.legend,i===!0?{}:i||{}))}return n},{})},t.prototype.parseData=function(){this.component.data=h.parseUnitData(this)},t.prototype.parseSelectionData=function(){},t.prototype.parseLayoutData=function(){this.component.layout=v.parseUnitLayout(this)},t.prototype.parseScale=function(){this.component.scales=O.default(this)},t.prototype.parseMark=function(){this.component.mark=E.parseMark(this)},t.prototype.parseAxis=function(){this.component.axes=p.parseAxisComponent(this,[i.X,i.Y])},t.prototype.parseAxisGroup=function(){
return null},t.prototype.parseGridGroup=function(){return null},t.prototype.parseLegend=function(){this.component.legends=y.parseLegendComponent(this)},t.prototype.assembleData=function(e){return h.assembleData(this,e)},t.prototype.assembleLayout=function(e){return v.assembleLayout(this,e)},t.prototype.assembleMarks=function(){return this.component.mark},t.prototype.assembleParentGroupProperties=function(e){return m.applyConfig({},e,u.FILL_STROKE_CONFIG.concat(["clip"]))},t.prototype.channels=function(){return i.UNIT_CHANNELS},t.prototype.getMapping=function(){return this.encoding},t.prototype.toSpec=function(e,t){var n,a=d.duplicate(this.encoding);return n={mark:this.markDef,encoding:a},e||(n.config=d.duplicate(this.config)),t||(n.data=d.duplicate(this.data)),n},t.prototype.mark=function(){return this.markDef.type},t.prototype.channelHasField=function(e){return c.channelHasField(this.encoding,e)},t.prototype.fieldDef=function(e){return this.encoding[e]||{}},t.prototype.field=function(e,t){void 0===t&&(t={});var n=this.fieldDef(e);return n.bin&&(t=d.extend({binSuffix:f.hasDiscreteDomain(this.scale(e).type)?"range":"start"},t)),l.field(n,t)},t.prototype.dataTable=function(){return this.dataName(c.isAggregate(this.encoding)?s.SUMMARY:s.SOURCE)},t.prototype.isUnit=function(){return!0},t}(S.Model);n.UnitModel=T},{"../channel":11,"../config":57,"../data":58,"../encoding":60,"../fielddef":62,"../log":65,"../mark":66,"../scale":67,"../stack":70,"../util":74,"./axis/parse":13,"./common":15,"./config":17,"./data/data":19,"./layout":32,"./legend/parse":34,"./mark/mark":40,"./model":47,"./scale/init":49,"./scale/parse":50,tslib:5}],56:[function(e,t,n){"use strict";function a(e,t){c[e]=t}function r(e){delete c[e]}function i(e){var t=s.isMarkDef(e.mark)?e.mark.type:e.mark,n=c[t];if(n)return n(e);throw new Error("Unregistered composite mark "+t)}var o=e("tslib"),s=e("./mark");n.ERRORBAR="error-bar";var c={};n.add=a,n.remove=r,n.normalize=i,a(n.ERRORBAR,function(e){var t=(e.mark,e.encoding),n=o.__rest(e,["mark","encoding"]),a=(t.size,o.__rest(t,["size"])),r=(t.x2,t.y2,o.__rest(t,["x2","y2"]));return o.__assign({},n,{layer:[{mark:"rule",encoding:a},{mark:"tick",encoding:r},{mark:"tick",encoding:o.__assign({},r,t.x2?{x:t.x2}:{},t.y2?{y:t.y2}:{})}]})})},{"./mark":66,tslib:5}],57:[function(e,t,n){"use strict";var a=e("./axis"),r=e("./legend"),i=e("./mark"),o=e("./scale");n.defaultCellConfig={width:200,height:200},n.defaultFacetCellConfig={stroke:"#ccc",strokeWidth:1};var s={color:"#000000",opacity:.4,offset:0};n.defaultFacetConfig={axis:a.defaultFacetAxisConfig,grid:s,cell:n.defaultFacetCellConfig},n.defaultOverlayConfig={line:!1,pointStyle:{filled:!0},lineStyle:{}},n.defaultConfig={padding:5,numberFormat:"s",timeFormat:"%b %d, %Y",countTitle:"Number of Records",cell:n.defaultCellConfig,mark:i.defaultMarkConfig,area:i.defaultAreaConfig,bar:i.defaultBarConfig,circle:i.defaultCircleConfig,line:i.defaultLineConfig,point:i.defaultPointConfig,rect:i.defaultRectConfig,rule:i.defaultRuleConfig,square:i.defaultSquareConfig,text:i.defaultTextConfig,tick:i.defaultTickConfig,overlay:n.defaultOverlayConfig,scale:o.defaultScaleConfig,axis:a.defaultAxisConfig,legend:r.defaultLegendConfig,facet:n.defaultFacetConfig}},{"./axis":9,"./legend":64,"./mark":66,"./scale":67}],58:[function(e,t,n){"use strict";function a(e){return!!e.url}function r(e){return!!e.values}n.isUrlData=a,n.isInlineData=r,n.SUMMARY="summary",n.SOURCE="source",n.STACKED="stacked",n.LAYOUT="layout"},{}],59:[function(e,t,n){"use strict";function a(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function r(e){if(l.isNumber(e))return e>4&&u.warn(u.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(u.message.invalidTimeUnit("quarter",e))}function i(e){if(l.isNumber(e))return e-1+"";var t=e.toLowerCase(),a=n.MONTHS.indexOf(t);if(a!==-1)return a+"";var r=t.substr(0,3),i=n.SHORT_MONTHS.indexOf(r);if(i!==-1)return i+"";throw new Error(u.message.invalidTimeUnit("month",e))}function o(e){if(l.isNumber(e))return e%7+"";var t=e.toLowerCase(),a=n.DAYS.indexOf(t);if(a!==-1)return a+"";var r=t.substr(0,3),i=n.SHORT_DAYS.indexOf(r);if(i!==-1)return i+"";throw new Error(u.message.invalidTimeUnit("day",e))}function s(e,t){var n=new Date(0,0,1,0,0,0,0);if(void 0!==e.day)if(l.keys(e).length>1)u.warn(u.message.droppedDay(e)),e=l.duplicate(e),delete e.day;else{n.setFullYear(f);var a=t?o(e.day):e.day;n.setDate(+a+1)}if(void 0!==e.year&&n.setFullYear(e.year),void 0!==e.quarter){var s=t?r(e.quarter):e.quarter;n.setMonth(3*+s)}if(void 0!==e.month){var c=t?i(e.month):e.month;n.setMonth(+c)}return void 0!==e.date&&n.setDate(e.date),void 0!==e.hours&&n.setHours(e.hours),void 0!==e.minutes&&n.setMinutes(e.minutes),void 0!==e.seconds&&n.setSeconds(e.seconds),void 0!==e.milliseconds&&n.setMilliseconds(e.milliseconds),n.getTime()}function c(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&l.keys(e).length>1&&(u.warn(u.message.droppedDay(e)),e=l.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(f):n.push(0),void 0!==e.month){var a=t?i(e.month):e.month;n.push(a)}else if(void 0!==e.quarter){var s=t?r(e.quarter):e.quarter;n.push(s+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var c=t?o(e.day):e.day;n.push(c+"+1")}else n.push(1);for(var d=0,p=["hours","minutes","seconds","milliseconds"];d<p.length;d++){var m=p[d];void 0!==e[m]?n.push(e[m]):n.push(0)}return"datetime("+n.join(", ")+")"}var l=e("./util"),u=e("./log"),f=2006;n.isDateTime=a,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.timestamp=s,n.dateTimeExpr=c},{"./log":65,"./util":74}],60:[function(e,t,n){"use strict";function a(e,t){var n=e&&e[t];return!!n&&(f.isArray(n)?f.some(n,function(e){return!!e.field}):l.isFieldDef(n))}function r(e){return f.some(u.CHANNELS,function(t){if(a(e,t)){var n=e[t];return f.isArray(n)?f.some(n,function(e){return!!e.aggregate}):l.isFieldDef(n)&&!!n.aggregate}return!1})}function i(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function o(e){var t=[];return u.CHANNELS.forEach(function(n){if(a(e,n)){var r=e[n];(f.isArray(r)?r:[r]).forEach(function(e){t.push(e)})}}),t}function s(e,t,n){e&&Object.keys(e).forEach(function(a){var r=a;f.isArray(e[r])?e[r].forEach(function(e){t.call(n,e,r)}):t.call(n,e[r],r)})}function c(e,t,n,a){return e?Object.keys(e).reduce(function(n,r){var i=r;return f.isArray(e[i])?e[i].reduce(function(e,n){return t.call(a,e,n,i)},n):t.call(a,n,e[i],i)},n):n}var l=e("./fielddef"),u=e("./channel"),f=e("./util");n.channelHasField=a,n.isAggregate=r,n.isRanged=i,n.fieldDefs=o,n.forEach=s,n.reduce=c},{"./channel":11,"./fielddef":62,"./util":74}],61:[function(e,t,n){"use strict"},{}],62:[function(e,t,n){"use strict";function a(e){return e&&!!e.field}function r(e){return e&&"value"in e&&void 0!==e.value}function i(e,t){void 0===t&&(t={});var n=e.field,a=t.prefix,r=t.suffix;if(u(e))n="count_*";else{var i=void 0;t.nofn||(e.bin?(i="bin",r=t.binSuffix):!t.noAggregate&&e.aggregate?i=String(e.aggregate):e.timeUnit&&(i=String(e.timeUnit))),i&&(n=i+"_"+n)}return r&&(n=n+"_"+r),a&&(n=a+"_"+n),t.datum&&(n='datum["'+n+'"]'),n}function o(e){return!!y.contains([h.NOMINAL,h.ORDINAL],e.type)||(!!e.bin||e.type===h.TEMPORAL&&!!e.timeUnit)}function s(e){return e&&a(e)&&o(e)}function c(e){return e&&a(e)&&!o(e)}function l(){return{field:"*",aggregate:"count",type:h.QUANTITATIVE}}function u(e){return"count"===e.aggregate}function f(e,t){if(null!=e.title)return e.title;if(u(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toString().toUpperCase()+"("+e.field+")":e.field}function d(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";var n=m.getSupportedRole(t).measure;return n?"quantitative":"nominal"}function p(e,t){if(e.field){var n=h.getFullName(e.type);if(n)e.type=n;else{var a=d(e,t);g.warn(g.message.emptyOrInvalidFieldType(e.type,t,a)),e.type=a}}return e}var m=e("./channel"),g=e("./log"),h=e("./type"),y=e("./util");n.isFieldDef=a,n.isValueDef=r,n.field=i,n.isDimension=s,n.isMeasure=c,n.count=l,n.isCount=u,n.title=f,n.defaultType=d,n.normalize=p},{"./channel":11,"./log":65,"./type":73,"./util":74}],63:[function(e,t,n){"use strict";function a(e){return e&&!!e.field&&void 0!==e.equal}function r(e){return!!(e&&e.field&&f.isArray(e.range)&&2===e.range.length)}function i(e){return e&&!!e.field&&(f.isArray(e.oneOf)||f.isArray(e.in))}function o(e){if(f.isString(e))return e;var t=e.timeUnit?"time("+u.fieldExpr(e.timeUnit,e.field)+")":l.field(e,{datum:!0});if(a(e))return t+"==="+s(e.equal,e.timeUnit);if(i(e)){var n=e.oneOf||e.in;return"indexof(["+n.map(function(t){return s(t,e.timeUnit)}).join(",")+"], "+t+") !== -1"}if(r(e)){var o=e.range[0],c=e.range[1];if(null!==o&&null!==c)return"inrange("+t+", "+s(o,e.timeUnit)+", "+s(c,e.timeUnit)+")";if(null!==o)return t+" >= "+o;if(null!==c)return t+" <= "+c}}function s(e,t){if(c.isDateTime(e)){var n=c.dateTimeExpr(e,!0);return"time("+n+")"}if(u.isSingleTimeUnit(t)){var a={};a[t]=e;var n=c.dateTimeExpr(a,!0);return"time("+n+")"}return JSON.stringify(e)}var c=e("./datetime"),l=e("./fielddef"),u=e("./timeunit"),f=e("./util");n.isEqualFilter=a,n.isRangeFilter=r,n.isOneOfFilter=i,n.expression=o},{"./datetime":59,"./fielddef":62,"./timeunit":71,"./util":74}],64:[function(e,t,n){"use strict";n.defaultLegendConfig={orient:void 0},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","titlePadding","type","values","zindex"]},{}],65:[function(e,t,n){"use strict";function a(e){var t=p=new m;e(t),o()}function r(e){return function(){var t=p=new m;e(t),o()}}function i(e){return p=e}function o(){return p=d}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.warn.apply(p,arguments)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.info.apply(p,arguments)}function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];p.debug.apply(p,arguments)}var u=e("vega-util"),f=e("./channel"),d=u.logger(u.Warn),p=d,m=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=m,n.runLocalLogger=a,n.wrap=r,n.set=i,n.reset=o,n.warn=s,n.info=c,n.debug=l;var g;!function(e){function t(e){return'Invalid field type "'+e+'"'}function n(e,t,n){return"Invalid field type ("+e+") for channel "+t+", using "+n+" instead."}function a(e,t){return"Dropping "+JSON.stringify(e)+" from channel "+t+" since it does not contain data field or value."}function r(e,t){return e+" dropped as it is incompatible with "+t}function i(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function o(e,t){return"Using discrete channel "+e+" to encode "+t+" field can be misleading as it does not encode "+("ordinal"===t?"order":"magnitude")+"."}function s(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode continous fields. In this case, we use vertical by default"}function c(e){return"Cannot clearly determine orientation for "+e+" since both x and y channel encode discrete or empty fields."}function l(e,t){return"Specified orient "+e+" overridden with "+t}function u(e){return"Cannot use "+e+" with non-color channel."}function d(e){return"Cannot use custom "+e+" with row or column channel. Please use width, height, or spacing instead."}function p(e){return"rangeStep for "+e+" is dropped as top-level "+(e===f.X?"width":"height")+" is provided."}function m(e,t,n){return"Channel "+e+" does not work with "+t+" scale. We are using "+n+" scale instead."}function g(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function h(e,t){return'Scale type "'+t+'" does not work with mark '+e+"."}function y(e){return"Cannot stack "+e+" if there is already "+e+"2"}function v(e){return"Cannot stack non-linear scale ("+e+")"}function S(e){return"Cannot stack when the aggregate function is non-summative ("+e+")"}function E(e,t){return"Invalid "+e+": "+t}function b(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+(e+"").replace("day","date")+"."}function O(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.DEPRECATED_FILTER_NULL="filterNull is deprecated. Please use filterInvalid instead.",e.invalidFieldType=t,e.emptyOrInvalidFieldType=n,e.emptyFieldDef=a,e.incompatibleChannel=r,e.facetChannelShouldBeDiscrete=i,e.discreteChannelCannotEncode=o,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=s,e.unclearOrientDiscreteOrEmpty=c,e.orientOverridden=l,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.CANNOT_USE_SCALE_PROPERTY_WITH_NON_COLOR=u,e.CANNOT_USE_RANGE_WITH_POSITION="Cannot use custom range with x or y channel.  Please customize width, height, padding, or rangeStep instead.",e.CANNOT_USE_PADDING_WITH_FACET="Cannot use padding with facet's scale.  Please use spacing instead.",e.cannotUseRangePropertyWithFacet=d,e.rangeStepDropped=p,e.scaleTypeNotWorkWithChannel=m,e.scalePropertyNotWorkWithScaleType=g,e.scaleTypeNotWorkWithMark=h,e.INVAID_DOMAIN="Invalid scale domain",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=y,e.cannotStackNonLinearScale=v,e.cannotStackNonSummativeAggregate=S,e.invalidTimeUnit=E,e.dayReplacedWithDate=b,e.droppedDay=O}(g=n.message||(n.message={}))},{"./channel":11,"vega-util":6}],66:[function(e,t,n){"use strict";function a(e){return e.type}function r(e){var t=a(e)?e.type:e;return t in o}var i=e("./util");n.AREA="area",n.BAR="bar",n.LINE="line",n.POINT="point",n.RECT="rect",n.RULE="rule",n.TEXT="text",n.TICK="tick",n.CIRCLE="circle",n.SQUARE="square",n.ERRORBAR="error-bar",n.PRIMITIVE_MARKS=[n.AREA,n.BAR,n.LINE,n.POINT,n.TEXT,n.TICK,n.RECT,n.RULE,n.CIRCLE,n.SQUARE],n.isMarkDef=a;var o=i.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=r,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.defaultMarkConfig={color:"#4682b4",minOpacity:.3,maxOpacity:.8,minStrokeWidth:1,maxStrokeWidth:4},n.defaultAreaConfig={},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultLineConfig={strokeWidth:2},n.defaultSymbolConfig={size:30,minSize:9,strokeWidth:2},n.defaultPointConfig=i.extend({},n.defaultSymbolConfig,{shape:"circle",shapes:["circle","square","cross","diamond","triangle-up","triangle-down"]}),n.defaultCircleConfig=n.defaultSymbolConfig,n.defaultSquareConfig=n.defaultSymbolConfig,n.defaultRectConfig={},n.defaultRuleConfig={strokeWidth:1},n.defaultTextConfig={fontSize:10,minFontSize:8,maxFontSize:40,baseline:"middle",text:"Abc"},n.defaultTickConfig={minBandSize:3,thickness:1}},{"./util":74}],67:[function(e,t,n){"use strict";function a(e){return e in m}function r(e){return e in p}function i(e){return e in d}function o(e){return e&&!!e.name}function s(e,t){switch(t){case"type":case"domain":case"range":case"scheme":return!0;case"interpolate":return"linear"===e;case"round":return i(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return f.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return i(e)||"sequential"===e;case"nice":return i(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e||"log"===e;case"zero":return!a(e)&&!f.contains(["log","time","utc"],e);case"useRawDomain":return i(e)||f.contains(["quantize","quantile","threshold"],e)}throw new Error("Invalid scale property "+t+".")}function c(e,t){switch(t){case"range":if("x"===e||"y"===e)return u.message.CANNOT_USE_RANGE_WITH_POSITION;if("row"===e||"column"===e)return u.message.cannotUseRangePropertyWithFacet("range");return;case"rangeStep":if("row"===e||"column"===e)return u.message.cannotUseRangePropertyWithFacet("rangeStep");return;case"padding":case"paddingInner":case"paddingOuter":if("row"===e||"column"===e)return u.message.CANNOT_USE_PADDING_WITH_FACET;return;case"interpolate":case"scheme":if("color"!==e)return u.message.CANNOT_USE_SCALE_PROPERTY_WITH_NON_COLOR(e);return;case"type":case"domain":case"round":case"clamp":case"exponent":case"nice":case"zero":case"useRawDomain":return}throw new Error('Invalid scale property "${propName}".')}var l,u=e("./log"),f=e("./util");!function(e){e.LINEAR="linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.POINT="point",e.BAND="band"}(l=n.ScaleType||(n.ScaleType={})),n.SCALE_TYPES=["linear","log","pow","sqrt","time","utc","sequential","ordinal","point","band"],n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","log","pow","sqrt","time","utc"];var d=f.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var p=f.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","point","band"];var m=f.toSet(n.DISCRETE_DOMAIN_SCALES);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=a,n.hasContinuousDomain=r,n.isContinuousToContinuous=i,n.defaultScaleConfig={round:!0,textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,useRawDomain:!1},n.isExtendedScheme=o,n.SCALE_PROPERTIES=["type","domain","range","round","rangeStep","scheme","padding","paddingInner","paddingOuter","clamp","nice","exponent","zero","interpolate","useRawDomain"],n.scaleTypeSupportProperty=s,n.channelScalePropertyIncompatability=c},{"./log":65,"./util":74}],68:[function(e,t,n){"use strict";function a(e){return!!e&&!!e.field&&!!e.op}n.isSortField=a},{}],69:[function(e,t,n){"use strict";function a(e){return void 0!==e.facet}function r(e){if(i(e)){var t=N.channelHasField(e.encoding,x.ROW),n=N.channelHasField(e.encoding,x.COLUMN);return t||n}return!1}function i(e){return!!e.mark}function o(e){return void 0!==e.layer}function s(e){if(a(e))return l(e);if(o(e))return u(e);if(r(e))return f(e);if(i(e))return p(e);throw new Error(T.message.INVALID_SPEC)}function c(e){return o(e)?u(e):p(e)}function l(e){var t=e.spec,n=E.__rest(e,["spec"]);return E.__assign({},n,{spec:c(t)})}function u(e){var t=e.layer,n=E.__rest(e,["layer"]);return E.__assign({},n,{layer:t.map(c)})}function f(e){var t=e.encoding,n=t.row,a=t.column,r=E.__rest(t,["row","column"]),i=e.mark,o=(e.encoding,E.__rest(e,["mark","encoding"]));return E.__assign({},o,{facet:E.__assign({},n?{row:n}:{},a?{column:a}:{}),spec:p({mark:i,encoding:r})})}function d(e){return A.isPrimitiveMark(e.mark)}function p(e){var t=e.config,n=t&&t.overlay,a=n&&e.mark===A.AREA&&R.contains(["linepoint","line"],n.area),r=n&&(n.line&&e.mark===A.LINE||"linepoint"===n.area&&e.mark===A.AREA);return d(e)?N.isRanged(e.encoding)?m(e):r||a?g(e,r,a):e:O.normalize(e)}function m(e){var t=N.channelHasField(e.encoding,x.X),n=N.channelHasField(e.encoding,x.Y),a=N.channelHasField(e.encoding,x.X2),r=N.channelHasField(e.encoding,x.Y2);if(a&&!t||r&&!n){var i=R.duplicate(e);return a&&!t&&(i.encoding.x=i.encoding.x2,delete i.encoding.x2),r&&!n&&(i.encoding.y=i.encoding.y2,delete i.encoding.y2),i}return e}function g(e,t,n){var a=["name","description","data","transform"],r=R.omit(e,a.concat("config")),i=R.duplicate(e.config);delete i.overlay;var o=k.stack(e.mark,e.encoding,e.config?e.config.stack:void 0),s=E.__assign({},R.pick(e,a),{layer:[r]},R.keys(i).length>0?{config:i}:{});if(n){var c=R.duplicate(r);c.mark=A.LINE;var l=R.extend({},b.defaultOverlayConfig.lineStyle,e.config.overlay.lineStyle,o?{stacked:o.offset}:null);R.keys(l).length>0&&(c.config={mark:l}),s.layer.push(c)}if(t){var u=R.duplicate(r);u.mark=A.POINT;var l=R.extend({},b.defaultOverlayConfig.pointStyle,e.config.overlay.pointStyle,o?{stacked:o.offset}:null);R.keys(l).length>0&&(u.config={mark:l}),s.layer.push(u)}return s}function h(e,t){return t.forEach(function(t){var n=["field","type","value","timeUnit","bin","aggregate"].reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{}),a=R.hash(n);e[a]=e[a]||t}),e}function y(e,t){return void 0===t&&(t={}),o(e)?e.layer.forEach(function(e){i(e)?h(t,C.fieldDefs(e.encoding)):y(e,t)}):a(e)?(h(t,C.fieldDefs(e.facet)),y(e.spec,t)):h(t,C.fieldDefs(e.encoding)),t}function v(e){return R.vals(y(e))}function S(e){return!!A.isPrimitiveMark(e.mark)&&null!==k.stack(e.mark,e.encoding,e.config?e.config.stack:void 0)}var E=e("tslib"),b=e("./config"),O=e("./compositemark"),N=e("./encoding"),T=e("./log"),A=e("./mark"),k=e("./stack"),x=e("./channel"),C=e("./encoding"),R=e("./util");n.isFacetSpec=a,n.isFacetedUnitSpec=r,n.isUnitSpec=i,n.isLayerSpec=o,n.normalize=s,n.fieldDefs=v,n.isStacked=S},{"./channel":11,"./compositemark":56,"./config":57,"./encoding":60,"./log":65,"./mark":66,"./stack":70,"./util":74,tslib:5}],70:[function(e,t,n){"use strict";function a(e,t,a){var d=l.isMarkDef(e)?e.type:e;if(!f.contains(n.STACKABLE_MARKS,d))return null;if(!s.isAggregate(t))return null;var p=o.STACK_GROUP_CHANNELS.reduce(function(e,n){if(s.channelHasField(t,n)){var a=t[n];(f.isArray(a)?a:[a]).forEach(function(t){c.isFieldDef(t)&&!t.aggregate&&e.push({channel:n,fieldDef:t})})}return e},[]);if(0===p.length)return null;var m=c.isFieldDef(t.x),g=c.isFieldDef(t.y),h=c.isFieldDef(t.x)&&!!t.x.aggregate,y=c.isFieldDef(t.y)&&!!t.y.aggregate;if(h!==y){var v=h?o.X:o.Y,S=t[v],E=S.aggregate,b=S.scale,O=null;return O=void 0!==S.stack?S.stack:f.contains(n.STACK_BY_DEFAULT_MARKS,d)&&void 0===a?"zero":a,O&&"none"!==O?b&&b.type&&b.type!==u.ScaleType.LINEAR?(r.warn(r.message.cannotStackNonLinearScale(b.type)),null):s.channelHasField(t,v===o.X?o.X2:o.Y2)?(r.warn(r.message.cannotStackRangedMark(v)),null):f.contains(i.SUM_OPS,E)?{groupbyChannel:h?g?o.Y:null:m?o.X:null,fieldChannel:v,stackBy:p,offset:O}:(r.warn(r.message.cannotStackNonSummativeAggregate(E)),null):null}return null}var r=e("./log"),i=e("./aggregate"),o=e("./channel"),s=e("./encoding"),c=e("./fielddef"),l=e("./mark"),u=e("./scale"),f=e("./util");n.STACKABLE_MARKS=[l.BAR,l.AREA,l.RULE,l.POINT,l.CIRCLE,l.SQUARE,l.LINE,l.TEXT,l.TICK],n.STACK_BY_DEFAULT_MARKS=[l.BAR,l.AREA],n.stack=a},{"./aggregate":8,"./channel":11,"./encoding":60,"./fielddef":62,"./log":65,"./mark":66,"./scale":67,"./util":74}],71:[function(e,t,n){"use strict";function a(e){return!!m[e]}function r(e,t){var a=new Date(0,0,1,0,0,0,0);return n.SINGLE_TIMEUNITS.forEach(function(n){if(o(e,n))switch(n){case u.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case u.YEAR:a.setFullYear(t.getFullYear());break;case u.QUARTER:a.setMonth(3*Math.floor(t.getMonth()/3));break;case u.MONTH:a.setMonth(t.getMonth());break;case u.DATE:a.setDate(t.getDate());break;case u.HOURS:a.setHours(t.getHours());break;case u.MINUTES:a.setMinutes(t.getMinutes());break;case u.SECONDS:a.setSeconds(t.getSeconds());break;case u.MILLISECONDS:a.setMilliseconds(t.getMilliseconds())}}),a}function i(e){return!!g[e]}function o(e,t){var n=e.toString(),a=t.toString(),r=n.indexOf(a);return r>-1&&(t!==u.SECONDS||0===r||"i"!==n.charAt(r-1))}function s(e,t){function a(e){return e===u.QUARTER?"(quarter("+r+")-1)":e+"("+r+")"}var r='datum["'+t+'"]',i=n.SINGLE_TIMEUNITS.reduce(function(t,n){return o(e,n)&&(t[n]=a(n)),t},{});return i.day&&d.keys(i).length>1&&(p.warn(p.message.dayReplacedWithDate(e)),delete i.day,i.date=a(u.DATE)),f.dateTimeExpr(i)}function c(e){if(e)return o(e,u.SECONDS)?"second":o(e,u.MINUTES)?"minute":o(e,u.HOURS)?"hour":o(e,u.DAY)||o(e,u.DATE)?"day":o(e,u.MONTH)?"month":o(e,u.YEAR)?"year":void 0}function l(e,t,n){if(e){var a=[],r="",i=o(e,u.YEAR);o(e,u.QUARTER)&&(r="'Q' + quarter("+t+")"),o(e,u.MONTH)&&a.push(n!==!1?"%b":"%B"),o(e,u.DAY)?a.push(n?"%a":"%A"):o(e,u.DATE)&&a.push("%d"+(i?",":"")),i&&a.push(n?"%y":"%Y");var s=[];o(e,u.HOURS)&&s.push("%H"),o(e,u.MINUTES)&&s.push("%M"),o(e,u.SECONDS)&&s.push("%S"),o(e,u.MILLISECONDS)&&s.push("%L");var c=[];return a.length>0&&c.push(a.join(" ")),s.length>0&&c.push(s.join(":")),c.length>0&&(r&&(r+=" + ' ' + "),r+="timeFormat("+t+", '"+c.join(" ")+"')"),r||void 0}}var u,f=e("./datetime"),d=e("./util"),p=e("./log");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth"}(u=n.TimeUnit||(n.TimeUnit={})),n.SINGLE_TIMEUNITS=[u.YEAR,u.QUARTER,u.MONTH,u.DAY,u.DATE,u.HOURS,u.MINUTES,u.SECONDS,u.MILLISECONDS];var m=n.SINGLE_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isSingleTimeUnit=a,n.convert=r,n.MULTI_TIMEUNITS=[u.YEARQUARTER,u.YEARQUARTERMONTH,u.YEARMONTH,u.YEARMONTHDATE,u.YEARMONTHDATEHOURS,u.YEARMONTHDATEHOURSMINUTES,u.YEARMONTHDATEHOURSMINUTESSECONDS,u.QUARTERMONTH,u.HOURSMINUTES,u.HOURSMINUTESSECONDS,u.MINUTESSECONDS,u.SECONDSMILLISECONDS];var g=n.MULTI_TIMEUNITS.reduce(function(e,t){return e[t]=!0,e},{});n.isMultiTimeUnit=i,n.TIMEUNITS=[u.YEAR,u.QUARTER,u.MONTH,u.DAY,u.DATE,u.HOURS,u.MINUTES,u.SECONDS,u.MILLISECONDS,u.YEARQUARTER,u.YEARQUARTERMONTH,u.YEARMONTH,u.YEARMONTHDATE,u.YEARMONTHDATEHOURS,u.YEARMONTHDATEHOURSMINUTES,u.YEARMONTHDATEHOURSMINUTESSECONDS,u.QUARTERMONTH,u.HOURSMINUTES,u.HOURSMINUTESSECONDS,u.MINUTESSECONDS,u.SECONDSMILLISECONDS],n.containsTimeUnit=o,n.fieldExpr=s,n.smallestUnit=c,n.formatExpression=l},{"./datetime":59,"./log":65,"./util":74}],72:[function(e,t,n){"use strict"},{}],73:[function(e,t,n){"use strict";function a(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}var r;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(r=n.Type||(n.Type={})),n.QUANTITATIVE=r.QUANTITATIVE,n.ORDINAL=r.ORDINAL,n.TEMPORAL=r.TEMPORAL,n.NOMINAL=r.NOMINAL,n.getFullName=a},{}],74:[function(e,t,n){"use strict";function a(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function r(e,t){var n=v(e);return t.forEach(function(e){delete n[e]}),n}function i(e){return O.isString(e)||O.isNumber(e)||S(e)?String(e):E(e)}function o(e,t){return e.indexOf(t)>-1}function s(e,t){return e.filter(function(e){return!o(t,e)})}function c(e,t){return e.concat(s(t,e))}function l(e,t,n,a){if(e.reduce)return e.reduce.call(a,t,n);for(var r in e)e.hasOwnProperty(r)&&(n=t.call(a,n,e[r],r,e));return n}function u(e,t){for(var n=0,a=0;a<e.length;a++)if(t(e[a],a,n++))return!0;return!1}function f(e,t){for(var n=0,a=0;a<e.length;a++)if(!t(e[a],a,n++))return!1;return!0}function d(e){return[].concat.apply([],e)}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var a=0,r=t;a<r.length;a++){var i=r[a];e=m(e,i)}return e}function m(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=p(t[n].constructor===Array?[]:{},t[n]):p(e[n],t[n]));return e}function g(e,t){for(var n,a=[],r={},i=0,o=e;i<o.length;i++){var s=o[i];n=t(s),n in r||(r[n]=1,a.push(s))}return a}function h(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function y(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function v(e){return JSON.parse(JSON.stringify(e))}function S(e){return e===!0||e===!1}var E=e("json-stable-stringify"),b=e("vega-util");n.extend=b.extend,n.isArray=b.isArray,n.isObject=b.isObject,n.isNumber=b.isNumber,n.isString=b.isString,n.truncate=b.truncate,n.toSet=b.toSet;var O=e("vega-util");n.pick=a,n.omit=r,n.hash=i,n.contains=o,n.without=s,n.union=c,n.reduce=l,n.some=u,n.every=f,n.flatten=d,n.mergeDeep=p,n.unique=g,n.differ=h,n.keys=Object.keys,n.vals=y,n.duplicate=v,n.isBoolean=S},{"json-stable-stringify":1,"vega-util":6}],75:[function(e,t,n){"use strict";function a(e,t,a){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===a&&(a=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var i=r.isMarkDef(e.mark)?e.mark.type:e.mark,s=e.encoding,c=t[i],l=a[i];for(var u in c)if(!(c[u]in s))return'Missing encoding channel "'+c[u]+'" for mark "'+i+'"';for(var f in s)if(!l[f])return'Encoding channel "'+f+'" is not supported by mark type "'+i+'"';return i!==o.BAR||s.x||s.y?null:"Missing both x and y for bar"}var r=e("./mark"),i=e("./util"),o=e("./mark");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:i.toSet(["row","column","x","y","size","color","detail"]),line:i.toSet(["row","column","x","y","color","detail"]),area:i.toSet(["row","column","x","y","color","detail"]),tick:i.toSet(["row","column","x","y","color","detail"]),circle:i.toSet(["row","column","x","y","color","size","detail"]),square:i.toSet(["row","column","x","y","color","size","detail"]),point:i.toSet(["row","column","x","y","color","size","detail","shape"]),text:i.toSet(["row","column","size","color","text"])},n.getEncodingMappingError=a},{"./mark":66,"./util":74}],76:[function(e,t,n){"use strict";function a(e){return!o.isArray(e)&&("fields"in e&&!("data"in e))}function r(e){return!o.isArray(e)&&("fields"in e&&"data"in e)}function i(e){return!o.isArray(e)&&!("fields"in e)}var o=e("./util");n.isDataRefUnionedDomain=a,n.isFieldRefUnionDomain=r,n.isDataRefDomain=i},{"./util":74}],77:[function(e,t,n){"use strict";n.axis=e("./axis"),n.aggregate=e("./aggregate"),n.bin=e("./bin"),n.channel=e("./channel"),n.compositeMark=e("./compositemark");var a=e("./compile/compile");n.compile=a.compile,n.config=e("./config"),n.data=e("./data"),n.datetime=e("./datetime"),n.encoding=e("./encoding"),n.facet=e("./facet"),n.fieldDef=e("./fielddef"),n.legend=e("./legend"),n.mark=e("./mark"),n.scale=e("./scale"),n.sort=e("./sort"),n.spec=e("./spec"),n.stack=e("./stack"),n.timeUnit=e("./timeunit"),n.transform=e("./transform"),n.type=e("./type"),n.util=e("./util"),n.validate=e("./validate"),n.version=e("../package.json").version},{"../package.json":7,"./aggregate":8,"./axis":9,"./bin":10,"./channel":11,"./compile/compile":16,"./compositemark":56,"./config":57,"./data":58,"./datetime":59,"./encoding":60,"./facet":61,"./fielddef":62,"./legend":64,"./mark":66,"./scale":67,"./sort":68,"./spec":69,"./stack":70,"./timeunit":71,"./transform":72,"./type":73,"./util":74,"./validate":75}]},{},[77])(77)});
//# sourceMappingURL=vega-lite.min.js.map
