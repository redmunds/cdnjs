/*!
 * Pretty Date v0.0.1
 * https://github.com/fengyuanchen/prettydate
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(c,d){d=a.isPlainObject(d)?d:{},this.$element=a(c),this.defaults=a.extend({},b.defaults,this.$element.data(),d),this.init()},c=1e3,d=60*c,e=60*d,f=24*e,g=7*f,h=31*f,i=365*f;b.prototype={constructor:b,number:{s:c,m:d,h:e,D:f,w:g,M:h,Y:i},init:function(){var a=this.defaults,c=a.date||this.$element.text();this.format=b.fn.parseFormat(a.dateFormat),this.date=b.fn.parseDate(c,this.format),this.date&&(this.prettify(),a.autoUpdate?this.update():this.destory())},prettify:function(){var a,b=(new Date).getTime()-this.date.getTime(),c=b>0?!0:!1,d=this.number,e=this.defaults.messages;b=Math.abs(b),a=b<2*d.s?e.second:b<d.m?e.seconds.replace("%s",Math.floor(b/d.s)):b<2*d.m?e.minute:b<d.h?e.minutes.replace("%s",Math.floor(b/d.m)):b<2*d.h?e.hour:b<d.D?e.hours.replace("%s",Math.floor(b/d.h)):b<2*d.D?c?e.yesterday:e.tomorrow:b<3*d.D?c?e.beforeYesterday:e.afterTomorrow:b<d.w?e.days.replace("%s",Math.floor(b/d.D)):b<2*d.w?e.week:b<4*d.w?e.weeks.replace("%s",Math.floor(b/d.w)):b<2*d.M?e.month:b<d.Y?e.months.replace("%s",Math.floor(b/d.M)):b<2*d.Y?e.year:e.years.replace("%s",Math.floor(b/d.Y)),a=a.replace("%s",c?this.defaults.beforeSuffix:this.defaults.afterSuffix),this.$element.data({date:this.date,prettydate:a}).text(a),this.prettydate=a},destory:function(){var b=this;this.defaults.autoUpdate&&this.autoUpdate&&clearInterval(this.autoUpdate),a.each(this,function(a){b[a]=null})},update:function(){var a=this.defaults.duration,b=this;"number"==typeof a&&a>0&&(this.autoUpdate=setInterval(function(){b.prettify()},a))}},b.fn={parseFormat:function(b){var c="string"==typeof b?b.match(/(\w+)/g):[],d=!1;if(!c||0===c.length)throw new Error("Invalid date format.");return b=a.map(c,function(a){var b=a.substr(0,1);switch(b){case"S":case"s":b="s";break;case"m":b=d?"m":"M",d=!0;break;case"H":case"h":b="h";break;case"D":case"d":b="D";break;case"M":b="M",d=!0;break;case"Y":case"y":b="Y"}return b})},parseDate:function(b,c){var d="string"==typeof b?b.match(/(\d+)/g):[],e={Y:0,M:0,D:0,h:0,m:0,s:0};return d.length===c.length?(a.each(c,function(a,b){e[b]=parseInt(d[a],10)||0}),b=new Date(e.Y,e.M-1,e.D,e.h,e.m,e.s)):b=new Date(b),b.getTime()?b:null}},b.defaults={afterSuffix:"later",beforeSuffix:"ago",autoUpdate:!1,date:void 0,dateFormat:"YYYY-MM-DD hh:mm:ss",duration:6e4,messages:{second:"Just now",seconds:"%s seconds %s",minute:"One minute %s",minutes:"%s minutes %s",hour:"One hour %s",hours:"%s hours %s",day:"One day %s",days:"%s days %s",week:"One week %s",weeks:"%s weeks %s",month:"One month %s",months:"%s months %s",year:"One year %s",years:"%s years %s",yesterday:"Yesterday",beforeYesterday:"The day before yesterday",tomorrow:"Tomorrow",afterTomorrow:"The day after tomorrow"}},b.setDefaults=function(c){a.extend(b.defaults,c)},a.fn.prettydate=function(c){return this.each(function(){a(this).data("prettydate",new b(this,c))})},a.fn.prettydate.Constructor=b,a.fn.prettydate.setDefaults=b.setDefaults,a(function(){a("[prettydate]").prettydate()})});