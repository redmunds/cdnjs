/**
 * Autotab - jQuery plugin 1.4
 * https://github.com/Mathachew/jquery-autotab
 * 
 * Copyright (c) 2013 Matthew Miller
 * 
 * Licensed under the MIT licensing:
 *   http://www.opensource.org/licenses/mit-license.php
 */

(function(e){var h={tabPause:800,focusChange:null},m=function(b,c){if(null!==c&&"undefined"!==typeof c)for(var a in c)"format"==a||"target"==a||"previous"==a?e(b).data("autotab-"+a,c[a]):b.setAttribute("data-autotab-"+a,c[a])},l=function(b){var c=navigator.platform,a={loaded:!1,disabled:!1,pattern:null,uppercase:!1,lowercase:!1,nospace:!1,maxlength:2147483647},d;for(d in a)a[d]=b.getAttribute("data-autotab-"+d)||a[d];a.format=e(b).data("autotab-format")||"all";a.target=e(b).data("autotab-target")||
a.target;a.previous=e(b).data("autotab-previous")||a.previous;a.iOS=b.getAttribute("data-autotab-iOS")||"iPad"===c||"iPhone"===c||"iPod"===c;a.firefox=b.getAttribute("data-autotab-Firefox")||"undefined"!==typeof InstallTrigger;"true"!=a.loaded&&!0!==a.loaded&&m(b,a);return a};e.autotab={next:function(){var b=e(document.activeElement);b.length&&setTimeout(function(){b.trigger("autotab-next")},1)},previous:function(){var b=e(document.activeElement);b.length&&setTimeout(function(){b.trigger("autotab-previous")},
1)}};e.fn.autotab=function(b,c){if(!this.length)return this;if("filter"==b){if("string"===typeof c||"function"===typeof c)c={format:c};for(var a=0,d=this.length;a<d;a++){var g=l(this[a]),k=c;k.target=g.target;k.previous=g.previous;e.extend(g,k);m(this[a],g)}}else if("remove"==b||"destroy"==b||"disable"==b)for(a=0,d=this.length;a<d;a++)g=l(this[a]),g.disabled=!0,m(this[a],g);else if("restore"==b||"enable"==b)for(a=0,d=this.length;a<d;a++)g=l(this[a]),g.disabled=!1,m(this[a],g);else if(null===b||"undefined"===
typeof b?c={}:"string"===typeof b||"function"===typeof b?c={format:b}:"object"===typeof b&&(c=b),1<this.length)for(a=0,d=this.length;a<d;a++){var g=a+1,p=a-1,k=c;0<a&&g<d?(k.target=this[g],k.previous=this[p]):0<a?(k.target=null,k.previous=this[p]):(k.target=this[g],k.previous=null);q(this[a],k)}else q(this[0],c);return this};var n=function(b,c,a){if("function"===typeof a.format)return a.format(c,b);b=null;switch(a.format){case "text":b=RegExp("[0-9]+","g");break;case "alpha":b=RegExp("[^a-zA-Z]+",
"g");break;case "number":case "numeric":b=RegExp("[^0-9]+","g");break;case "alphanumeric":b=RegExp("[^0-9a-zA-Z]+","g");break;case "hex":case "hexadecimal":b=RegExp("[^0-9A-Fa-f]+","g");break;case "custom":b=RegExp(a.pattern,"g")}null!==b&&(c=c.replace(b,""));if("true"==a.nospace||!0===a.nospace)b=RegExp("[ ]+","g"),c=c.replace(b,"");if("true"==a.uppercase||!0===a.uppercase)c=c.toUpperCase();if("true"==a.lowercase||!0===a.lowercase)c=c.toLowerCase();return c},q=function(b,c){var a=l(b);if("true"==
a.disabled||!0===a.disabled)a.disabled=!1,a.target=null,a.previous=null;e.extend(a,c);"string"!==typeof a.target&&a.target instanceof jQuery||(a.target=e(a.target));"string"!==typeof a.previous&&a.previous instanceof jQuery||(a.previous=e(a.previous));var d=b.maxLength;2147483647==a.maxlength&&2147483647!=d?a.maxlength=d:0<a.maxlength?b.maxLength=a.maxlength:a.target=null;"true"!=h.loaded&&!0!==h.loaded?(a.loaded=!0,m(b,a),e(b).on("autotab-next",function(a,b){b||(b=l(this));"true"!=b.disabled&&!0!==
b.disabled&&b.target.length&&"true"!=b.iOS&&!0!==b.iOS&&(b.target.focus().select(),h.focusChange=new Date)}).on("autotab-previous",function(a,b){b||(b=l(this));if("true"!=b.disabled&&!0!==b.disabled&&b.previous.length){b.previous.focus();if("true"==b.firefox||!0===b.firefox){var c=b.previous.val().length;b.previous[0].setSelectionRange(c,c)}else b.previous.val(b.previous.val());h.focusChange=null}}).on("keydown",function(a){var b=l(this);if(!b||"true"==b.disabled||!0===b.disabled)return!0;var c=a.which||
a.charCode;if(8==c&&0===this.value.length&&b.previous.length)e(this).trigger("autotab-previous",b);else if(9==c&&null!==h.focusChange)if(a.shiftKey)h.focusChange=null;else{if((new Date).getTime()-h.focusChange.getTime()<h.tabPause)return h.focusChange=null,!1}else h.focusChange=null}).on("keypress",function(a){var b=l(this);if(!b||"true"==b.disabled||!0===b.disabled||("true"==b.firefox||!0===b.firefox)&&0===a.charCode||a.ctrlKey||a.altKey)return!0;var c=n(this,String.fromCharCode(a.which||a.keyCode),
b);if((a=document.selection&&document.selection.createRange?!0:0<a.charCode)&&(null===c||""===c))return!1;if(a&&this.value.length<=this.maxLength){var f;if("number"===typeof this.selectionStart&&"number"===typeof this.selectionEnd){f=this.selectionStart;a=this.selectionEnd;if(0===f&&a==this.value.length)this.value=c;else{if(this.value.length==this.maxLength)return e(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,f)+c+this.value.slice(a)}this.selectionStart=this.selectionEnd=f+1}else if(document.selection&&
document.selection.createRange){a=document.selection.createRange();var d=this.createTextRange();f=this.createTextRange();var h=a.getBookmark();d.moveToBookmark(h);f.setEndPoint("EndToStart",d);f=f.text.length;a=f+a.text.length;if(0===f&&a==this.value.length)this.value=c;else{if(this.value.length==this.maxLength)return e(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,f)+c+this.value.slice(a)}f++;d=this.createTextRange();d.collapse(!0);d.move("character",f-(this.value.slice(0,f).split("\r\n").length-
1));d.select()}}this.value.length==b.maxlength&&e(this).trigger("autotab-next",b);return!1}).on("paste",function(a){var b=l(this);if(!b)return!0;this.maxLength=2147483647;(function(a,c){setTimeout(function(){var d=-1,g=document.createElement("input");g.type="hidden";g.value=a.value.toLowerCase();a.maxLength=c.maxlength;a.value=n(a,a.value,c).substr(0,c.maxlength);var h=function(a,b){if(a){for(var c=0,f=b.length;c<f;c++)d=g.value.indexOf(b.charAt(c),d)+1;c=l(a);f=g.value.substr(d);(f=n(a,f,c).substr(0,
c.maxlength))?(a.value=f,f.length==c.maxlength&&(e(a).trigger("autotab-next",c),"true"!=c.iOS&&!0!==c.iOS&&h(c.target[0],f))):a.value=""}};a.value.length==c.maxlength&&(e(a).trigger("autotab-next",b),"true"!=b.iOS&&!0!==b.iOS&&h(c.target[0],a.value.toLowerCase()))},1)})(this,b)})):m(b,a)};e.fn.autotab_magic=function(b){e(this).autotab()};e.fn.autotab_filter=function(b){var c={};"string"===typeof b||"function"===typeof b?c.format=b:e.extend(c,b);e(this).autotab("filter",c)}})(jQuery);
