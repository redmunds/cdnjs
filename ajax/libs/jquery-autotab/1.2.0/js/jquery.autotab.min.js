/**
 * Autotab - jQuery plugin 1.2
 * http://www.mathachew.com/sandbox/jquery-autotab
 * 
 * Copyright (c) 2013 Matthew Miller
 * 
 * Licensed under the MIT licensing:
 *   http://www.opensource.org/licenses/mit-license.php
 */

(function(c){var f=null,p=function(){var b=navigator.platform;return{loaded:!1,format:"all",pattern:null,uppercase:!1,lowercase:!1,nospace:!1,maxlength:2147483647,target:null,previous:null,iOS:"iPad"===b||"iPhone"===b||"iPod"===b}};c.autotab=function(){};c.autotab.next=function(){var b=c(document.activeElement);b.length&&b.trigger("autotab-next")};c.autotab.previous=function(){var b=c(document.activeElement);b.length&&b.trigger("autotab-previous")};c.fn.autotab=function(b,d){if("filter"==b){if("string"==
typeof d||"function"==typeof d)d={format:d};for(var a=0,f=this.length;a<f;a++){var h=c(this[a]).data("autotab-defaults");d.target=h.target;d.previous=h.previous;c.extend(h,d);c(this[a]).data("autotab-defaults",h)}}else if(null==b?d={}:"string"==typeof b?d={format:b}:"object"==typeof b&&(d=b),1<this.length)for(a=0,f=this.length;a<f;a++){var h=a+1,n=a-1,g=d;0<a&&h<f?(g.target=this[h],g.previous=this[n]):0<a?(g.target=null,g.previous=this[n]):(g.target=this[h],g.previous=null);k(this[a],g)}else k(this,
d);return this};var m=function(b,c){if("function"==typeof c.format)return c.format(b);switch(c.format){case "text":var a=RegExp("[0-9]+","g");b=b.replace(a,"");break;case "alpha":a=RegExp("[^a-zA-Z]+","g");b=b.replace(a,"");break;case "number":case "numeric":a=RegExp("[^0-9]+","g");b=b.replace(a,"");break;case "alphanumeric":a=RegExp("[^0-9a-zA-Z]+","g");b=b.replace(a,"");break;case "custom":a=RegExp(c.pattern,"g"),b=b.replace(a,"")}c.nospace&&(a=RegExp("[ ]+","g"),b=b.replace(a,""));c.uppercase&&
(b=b.toUpperCase());c.lowercase&&(b=b.toLowerCase());return b},k=function(b,d){var a=c(b).data("autotab-defaults")||p();c.extend(a,d);"string"!=typeof a.target&&a.target instanceof jQuery||(a.target=c(a.target));"string"!=typeof a.previous&&a.previous instanceof jQuery||(a.previous=c(a.previous));var k=b.maxLength;2147483647==a.maxlength&&2147483647!=k?a.maxlength=k:0<a.maxlength?b.maxLength=a.maxlength:a.target=null;c(b).data("autotab-defaults",a);if(c(b).data("autotab-defaults").loaded)return c(b);
a.loaded=!0;c(b).data("autotab-defaults",a);return c(b).on("autotab-next",function(b,a){a||(a=c(this).data("autotab-defaults"));a.target.length&&!a.iOS&&(a.target.focus().select(),f=new Date)}).on("autotab-previous",function(b,a){a||(a=c(this).data("autotab-defaults"));if(a.previous.length){a.previous.focus();if(this.setSelectionRange){var g=a.previous.val().length;a.previous[0].setSelectionRange(g,g)}else a.previous.val(a.previous.val());f=null}}).on("keydown",function(a){var b=c(this).data("autotab-defaults"),
g=a.which||a.charCode;if(8==g&&0==this.value.length&&b.previous.length)c(this).trigger("autotab-previous",b);else if(9==g&&null!=f)if(a.shiftKey)f=null;else{if(800>(new Date).getTime()-f.getTime())return f=null,!1}else f=null}).on("keypress",function(a){var b=c(this).data("autotab-defaults"),g=a.which||a.keyCode,d=m(String.fromCharCode(g),b),l=document.selection&&document.selection.createRange?!0:0<a.charCode;if(a.ctrlKey||a.altKey)return!0;if(l&&(null==d||""==d))return a.ctrlKey;if(l&&this.value.length<=
this.maxLength){var e;if("number"==typeof this.selectionStart&&"number"==typeof this.selectionEnd){e=this.selectionStart;a=this.selectionEnd;if(0==e&&a==this.value.length)this.value=d;else{if(this.value.length==this.maxLength)return c(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,e)+d+this.value.slice(a)}this.selectionStart=this.selectionEnd=e+1}else if(document.selection&&document.selection.createRange){a=document.selection.createRange();l=this.createTextRange();e=this.createTextRange();
var f=a.getBookmark();l.moveToBookmark(f);e.setEndPoint("EndToStart",l);e=e.text.length;a=e+a.text.length;if(0==e&&a==this.value.length)this.value=d;else{if(this.value.length==this.maxLength)return c(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,e)+d+this.value.slice(a)}e++;l=this.createTextRange();l.collapse(!0);l.move("character",e-(this.value.slice(0,e).split("\r\n").length-1));l.select()}}if(-1=="8,9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,144,145".indexOf(g)&&void 0!=
g)return this.value=m(this.value,b),this.value.length==b.maxlength&&c(this).trigger("autotab-next",b),!1}).on("paste",function(a){var b=function(a,d,f){if(a){var e=c(a).data("autotab-defaults"),h=a.maxLength;c(a).data("autotab-defaults",e);a.maxLength=2147483647;setTimeout(function(){null==d&&(d=a.value);var k;k=null!=f?m(d.substr(d.indexOf(f)+f.length),e).substr(0,h):m(d,e).substr(0,h);a.maxLength=h;k?(a.value=k,k.length==h&&(c(a).trigger("autotab-next",e),e.iOS||b(e.target[0],d,k))):a.value=""},
1)}};b(this,null,null)})};c.fn.autotab_magic=function(b){c(this).autotab()};c.fn.autotab_filter=function(b){var d={};"string"==typeof b||"function"==typeof b?d.format=b:c.extend(d,b);c(this).autotab("filter",d)}})(jQuery);
