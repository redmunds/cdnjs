/**
 * Autotab - jQuery plugin 1.3
 * https://github.com/Mathachew/jquery-autotab
 * 
 * Copyright (c) 2013 Matthew Miller
 * 
 * Licensed under the MIT licensing:
 *   http://www.opensource.org/licenses/mit-license.php
 */

(function(f){var l=null,m=function(b,c){if(null!==c&&"undefined"!==typeof c)for(var a in c)"format"==a||"target"==a||"previous"==a?f(b).data("autotab-"+a,c[a]):b.setAttribute("data-autotab-"+a,c[a])},k=function(b){var c=navigator.platform,a={loaded:!1,disabled:!1,pattern:null,uppercase:!1,lowercase:!1,nospace:!1,maxlength:2147483647},e;for(e in a)a[e]=b.getAttribute("data-autotab-"+e)||a[e];a.format=f(b).data("autotab-format")||"all";a.target=f(b).data("autotab-target")||a.target;a.previous=f(b).data("autotab-previous")||
a.previous;a.iOS=b.getAttribute("data-autotab-iOS")||"iPad"===c||"iPhone"===c||"iPod"===c;a.firefox=b.getAttribute("data-autotab-Firefox")||"undefined"!==typeof InstallTrigger;a.loaded||m(b,a);return a};f.autotab={next:function(){var b=f(document.activeElement);b.length&&setTimeout(function(){b.trigger("autotab-next")},1)},previous:function(){var b=f(document.activeElement);b.length&&setTimeout(function(){b.trigger("autotab-previous")},1)}};f.fn.autotab=function(b,c){if(!this.length)return this;if("filter"==
b){if("string"===typeof c||"function"===typeof c)c={format:c};for(var a=0,e=this.length;a<e;a++){var g=k(this[a]),d=c;d.target=g.target;d.previous=g.previous;f.extend(g,d);m(this[a],g)}}else if("remove"==b||"destroy"==b||"disable"==b)for(a=0,e=this.length;a<e;a++)g=k(this[a]),g.disabled=!0,m(this[a],g);else if("restore"==b||"enable"==b)for(a=0,e=this.length;a<e;a++)g=k(this[a]),g.disabled=!1,m(this[a],g);else if(null===b||"undefined"===typeof b?c={}:"string"===typeof b||"function"===typeof b?c={format:b}:
"object"===typeof b&&(c=b),1<this.length)for(a=0,e=this.length;a<e;a++){var g=a+1,q=a-1,d=c;0<a&&g<e?(d.target=this[g],d.previous=this[q]):0<a?(d.target=null,d.previous=this[q]):(d.target=this[g],d.previous=null);r(this[a],d)}else r(this[0],c);return this};var p=function(b,c,a){if("function"===typeof a.format)return a.format(c,b);b=null;switch(a.format){case "text":b=RegExp("[0-9]+","g");break;case "alpha":b=RegExp("[^a-zA-Z]+","g");break;case "number":case "numeric":b=RegExp("[^0-9]+","g");break;
case "alphanumeric":b=RegExp("[^0-9a-zA-Z]+","g");break;case "hex":case "hexadecimal":b=RegExp("[^0-9A-Fa-f]+","g");break;case "custom":b=RegExp(a.pattern,"g")}null!==b&&(c=c.replace(b,""));a.nospace&&(b=RegExp("[ ]+","g"),c=c.replace(b,""));a.uppercase&&(c=c.toUpperCase());a.lowercase&&(c=c.toLowerCase());return c},r=function(b,c){var a=k(b);if("true"==a.disabled||!0===a.disabled)a.disabled=!1,a.target=null,a.previous=null;f.extend(a,c);"string"!==typeof a.target&&a.target instanceof jQuery||(a.target=
f(a.target));"string"!==typeof a.previous&&a.previous instanceof jQuery||(a.previous=f(a.previous));var e=b.maxLength;2147483647==a.maxlength&&2147483647!=e?a.maxlength=e:0<a.maxlength?b.maxLength=a.maxlength:a.target=null;a.loaded?m(b,a):(a.loaded=!0,m(b,a),f(b).on("autotab-next",function(a,d){d||(d=k(this));"true"!=d.disabled&&!0!==d.disabled&&d.target.length&&"true"!=d.iOS&&!0!==d.iOS&&(d.target.focus().select(),l=new Date)}).on("autotab-previous",function(a,d){d||(d=k(this));if("true"!=d.disabled&&
!0!==d.disabled&&d.previous.length){d.previous.focus();if(d.firefox){var b=d.previous.val().length;d.previous[0].setSelectionRange(b,b)}else d.previous.val(d.previous.val());l=null}}).on("keydown",function(a){var d=k(this);if(!d||"true"==d.disabled)return!0;var b=a.which||a.charCode;if(8==b&&0===this.value.length&&d.previous.length)f(this).trigger("autotab-previous",d);else if(9==b&&null!==l)if(a.shiftKey)l=null;else{if(800>(new Date).getTime()-l.getTime())return l=null,!1}else l=null}).on("keypress",
function(a){var b=k(this);if(!b||"true"==b.disabled||!0===b.disabled)return!0;var c=a.which||a.keyCode,n=p(this,String.fromCharCode(c),b),e=document.selection&&document.selection.createRange?!0:0<a.charCode;if(a.ctrlKey||a.altKey)return!0;if(e&&(null===n||""===n))return a.ctrlKey;if(e&&this.value.length<=this.maxLength){var h;if("number"===typeof this.selectionStart&&"number"===typeof this.selectionEnd){h=this.selectionStart;a=this.selectionEnd;if(0===h&&a==this.value.length)this.value=n;else{if(this.value.length==
this.maxLength)return f(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,h)+n+this.value.slice(a)}this.selectionStart=this.selectionEnd=h+1}else if(document.selection&&document.selection.createRange){a=document.selection.createRange();e=this.createTextRange();h=this.createTextRange();var l=a.getBookmark();e.moveToBookmark(l);h.setEndPoint("EndToStart",e);h=h.text.length;a=h+a.text.length;if(0===h&&a==this.value.length)this.value=n;else{if(this.value.length==this.maxLength)return f(this).trigger("autotab-next",
b),!1;this.value=this.value.slice(0,h)+n+this.value.slice(a)}h++;e=this.createTextRange();e.collapse(!0);e.move("character",h-(this.value.slice(0,h).split("\r\n").length-1));e.select()}}if("true"==b.firefox||!0===b.firefox)return-1=="8,9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,144,145".indexOf(c)&&"undefined"!==typeof c?(this.value.length==b.maxlength&&f(this).trigger("autotab-next",b),!1):!0;this.value.length==b.maxlength&&f(this).trigger("autotab-next",b);return!1}).on("paste",function(a){var b=
k(this);if(!b)return!0;var c=function(a,e,h){if(a){k(a);var g=a.maxLength;if(!b||"true"==b.disabled||!0===b.disabled)return!0;m(a,b);a.maxLength=2147483647;setTimeout(function(){null===e&&(e=a.value);var k;k=null!==h?p(a,e.substr(e.indexOf(h)+h.length),b).substr(0,g):p(a,e,b).substr(0,g);a.maxLength=g;k?(a.value=k,k.length==g&&(f(a).trigger("autotab-next",b),"true"!=b.iOS&&!0!==b.iOS&&c(b.target[0],e,k))):a.value=""},1)}};c(this,null,null)}))};f.fn.autotab_magic=function(b){f(this).autotab()};f.fn.autotab_filter=
function(b){var c={};"string"===typeof b||"function"===typeof b?c.format=b:f.extend(c,b);f(this).autotab("filter",c)}})(jQuery);
