/*! task.js - 0.0.11 - clientside/minified */
var task=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(1),s=r(i),o=n(3),a=r(o),u=n(5),l=r(u),c={maxWorkers:navigator.hardwareConcurrency},f=n((0,s["default"])()?6:7);t.exports=new a["default"](c,f),t.exports.defaults=(0,l["default"])(c,f,a["default"])},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(2),s=r(i);t.exports=function(){if("undefined"!=typeof Worker&&(window.URL||window.webkitURL))try{var t=new Worker((0,s["default"])(function(){}));return t.terminate(),!0}catch(e){}return!1}},function(t,e){"use strict";t.exports=function(t){var e,n=t.toString();n=n.substring(n.indexOf("{")+1,n.lastIndexOf("}"));try{e=new Blob([n],{type:"text/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,e=new BlobBuilder,e.append(n),e=e.getBlob()}return(window.URL||window.webkitURL).createObjectURL(e)}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(4),u=r(a),l=function(){function t(e,n){var r=this;i(this,t),this._next=function(){if(r._queue.length){var t=r._getWorker();if(!t)return void setTimeout(r._next,0);var e=r._queue.shift();t.run(e)}},this._onWorkerTaskComplete=function(){r._next()},this._onWorkerExit=function(t){r._workers=r._workers.filter(function(e){return e!=t}),t.tasks.forEach(function(t){r._queue.push(t.$options)}),r._next()},e=e||{},this._WorkerProxy=n,this._maxWorkers=e.maxWorkers||4,this._idleTimeout=e.idleTimeout!==!1&&e.idleTimeout,this._idleCheckInterval=e.idleCheckInterval||1e3,this._globals=e.globals,this._globalsInitializationFunction=e.initialize,this._workers=[],this._workersInitializing=[],this._queue=[],this._onWorkerTaskComplete=this._onWorkerTaskComplete.bind(this),this._flushIdleWorkers=this._flushIdleWorkers.bind(this)}return o(t,[{key:"run",value:function(t){if(this._idleTimeout&&"number"!=typeof this._idleCheckIntervalID&&(this._idleCheckIntervalID=setInterval(this._flushIdleWorkers,this._idleCheckInterval)),!t.arguments||"undefined"==typeof t.arguments.length)throw new Error('task.js: "arguments" is required property, and it must be an array/array-like');if(!t["function"]&&("function"!=typeof t["function"]||"string"!=typeof t["function"]))throw new Error('task.js: "function" is required property, and it must be a string or a function');return"object"===s(t.arguments)&&(t.arguments=Array.prototype.slice.call(t.arguments)),t.callback?(this._queue.push(t),void this._next()):new Promise(function(e,n){t.resolve=e,t.reject=n,this._queue.push(t),this._next()}.bind(this))}},{key:"_runOnWorker",value:function(t,e,n){return new Promise(function(r,i){t.run({arguments:e,"function":n,resolve:r,reject:i})})}},{key:"wrap",value:function(t){return function(){var e=Array.from(arguments),n=null;return"function"==typeof e[e.length-1]&&(n=e.slice(-1).pop(),e=e.slice(0,-1)),this.run({arguments:e,"function":t,callback:n})}.bind(this)}},{key:"terminate",value:function(){this._idleTimeout&&"number"==typeof this._idleCheckIntervalID&&(clearInterval(this._idleCheckIntervalID),this._idleCheckIntervalID=null),this._workers.forEach(function(t){t.terminate()}),this._workers=[]}},{key:"_flushIdleWorkers",value:function(){this._workers=this._workers.filter(function(t){return!(0===t.tasks.length&&new Date-t.lastTaskTimestamp>this._idleTimeout)||(t.terminate(),!1)},this)}},{key:"_getWorker",value:function(){var t=this._workers.filter(function(t){return 0===t.tasks.length});return t.length?t[0]:this._workers.length<this._maxWorkers&&0===this._workersInitializing.length?this._createWorker():null}},{key:"_createWorker",value:function(){var t=new u["default"]({onTaskComplete:this._onWorkerTaskComplete,onExit:this._onWorkerExit},this._WorkerProxy);if(this._globalsInitializationFunction||this._globals){var e=("\n\t\t\t\tfunction (_globals) {\n\t\t\t\t\tglobals = ("+(this._globalsInitializationFunction||function(t){return t}).toString()+")(_globals || {});\n\t\t\t\t}\n\t\t\t").trim();return this._workersInitializing.push(t),this._runOnWorker(t,[this._globals||{}],e).then(function(){this._workersInitializing=this._workersInitializing.filter(function(e){return e!=t}),this._workers.push(t)}.bind(this)),null}return this._workers.push(t),t}}]),t}();t.exports=l},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,r){var i=this;n(this,t),this._onWorkerExit=function(){i._onExit(i)},this._onWorkerMessage=function(t){var e=null;if(i.tasks.some(function(n,r){if(t.id===n.id)return e=r,!0}),null!==e){var n=i.tasks[e];t.error?n.callback?n.callback(new Error("task.js: "+t.error)):n.reject(new Error("task.js: "+t.error)):n.callback?n.callback(null,t.result):n.resolve(t.result),i._onTaskComplete(i),i.tasks.splice(e,1)}},this.worker=new r,this.worker.addEventListener("message",this._onWorkerMessage),this.worker.addEventListener("exit",this._onWorkerExit),this.tasks=[],this.lastTaskTimestamp=null,this._onTaskComplete=e.onTaskComplete,this._onExit=e.onExit}return r(t,[{key:"_generateTaskID",value:function(){var t=Math.random(),e=!1;return this.tasks.some(function(t){if(t.id===!0)return e=!0,!0}),e?this._generateTaskID():t}},{key:"run",value:function(t){var e=this._generateTaskID();this.lastTaskTimestamp=new Date,this.tasks.push({id:e,resolve:t.resolve,reject:t.reject,callback:t.callback,$options:t});var n={id:e,func:String(t["function"])};Object.keys(t.arguments).forEach(function(e,r){n["argument"+r]=t.arguments[r]}),this.worker.postMessage(n,t.transferables)}},{key:"_purgeTasks",value:function(t){this.tasks.forEach(function(e){e.callback?e.callback(t):e.reject(t)}),this.tasks=[]}},{key:"terminate",value:function(){this._purgeTasks(),this.worker.terminate()}}]),t}();t.exports=i},function(t,e){"use strict";t.exports=function(t,e,n){return function(r,i){var s={};return Object.keys(t).forEach(function(e){return s[e]=t[e]}),Object.keys(r).forEach(function(t){return s[t]=r[t]}),new n(s,i||e)}}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(2),a=r(o),u=function(){function t(){var e=this;i(this,t),this.WORKER_SOURCE="function () {\n\t\tonmessage = function (event) {\n\t\t\tvar message = event.data;\n\n\t\t\tvar args = Object.keys(message).filter(function (key) {\n\t\t\t\treturn key.match(/^argument/);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn parseInt(a.slice(8), 10) - parseInt(b.slice(8), 10);\n\t\t\t}).map(function (key) {\n\t\t\t\treturn message[key];\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tpostMessage({id: message.id, result: eval('(' + message.func + ')').apply(null, args)});\n\t\t\t} catch (error) {\n\t\t\t\tpostMessage({id: message.id, error: error.message});\n\t\t\t}\n\t\t}\n\t}",this._onMessage=function(t){var n=t.data,r=e._listeners.message;r&&r.forEach(function(t){return t(n)})},this._listeners={},this._worker=new Worker((0,a["default"])(this.WORKER_SOURCE)),this._worker.addEventListener("message",this._onMessage)}return s(t,[{key:"addEventListener",value:function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e)}},{key:"postMessage",value:function(t,e){this._worker.postMessage(t,e)}},{key:"terminate",value:function(){this._worker.terminate()}}]),t}();t.exports=u},function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function(){function t(){var e=this;r(this,t),this._onMessage=function(t){var n=t,r=e._listeners.message;r&&r.forEach(function(t){return t(n)})},this._listeners={},this._setTimeoutID=null}return i(t,[{key:"addEventListener",value:function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e)}},{key:"postMessage",value:function(t,e){var r=this;this._setTimeoutID=setTimeout(function(){var e=Object.keys(t).filter(function(t){return t.match(/^argument/)}).sort(function(t,e){return parseInt(t.slice(8),10)-parseInt(e.slice(8),10)}).map(function(e){return t[e]}),i=t.func.substring(t.func.indexOf("{")+1,t.func.lastIndexOf("}")),s=t.func.substring(t.func.indexOf("(")+1,t.func.indexOf(")")).split(","),o=new(Function.prototype.bind.apply(Function,[null].concat(n(s),[i])));try{var a=o.apply(void 0,n(e));r._onMessage({id:t.id,result:a})}catch(u){r._onMessage({id:t.id,error:u.message})}},1)}},{key:"terminate",value:function(){clearTimeout(this._setTimeoutID),this._setTimeoutID=null}}]),t}();t.exports=s}]);
//# sourceMappingURL=task.min.js.map