/*! task.js - 0.0.14 - clientside/minified */
var task=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(1),o=r(i),s=n(3),a=r(s),u=n(4),l=r(u),c={maxWorkers:navigator.hardwareConcurrency},f=n((0,o["default"])()?5:7);t.exports=new a["default"](c,f),t.exports.defaults=(0,l["default"])(c,f,a["default"])},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}var i=n(2),o=r(i);t.exports=function(){if("undefined"!=typeof Worker&&(window.URL||window.webkitURL))try{var t=new Worker((0,o["default"])(function(){}));return t.terminate(),!0}catch(e){}return!1}},function(t,e){"use strict";t.exports=function(t){var e,n=t.toString();n=n.substring(n.indexOf("{")+1,n.lastIndexOf("}"));try{e=new Blob([n],{type:"text/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,e=new BlobBuilder,e.append(n),e=e.getBlob()}return(window.URL||window.webkitURL).createObjectURL(e)}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e,r){var i=this;if(n(this,t),this._next=function(){if(i._queue.length){var t=i._getWorker();if(!t)return void setTimeout(i._next,0);var e=i._queue.shift();i._log("sending tid("+e.id+") to wid("+t.id+")"),t.run(e)}},this._onWorkerTaskComplete=function(){i._next()},this._onWorkerExit=function(t){i._log("worker died, reissuing task"),i._workers=i._workers.filter(function(e){return e!=t}),t.tasks.forEach(function(t){i._queue.push(t.$options)}),i._next()},e=e||{},this.id=++t.managerCount,this._WorkerProxy=r,this._maxWorkers=e.maxWorkers||4,this._idleTimeout=e.idleTimeout!==!1&&e.idleTimeout,this._idleCheckInterval=e.idleCheckInterval||1e3,this._warmStart=e.warmStart||!1,this._globals=e.globals,this._globalsInitializationFunction=e.initialize,this._debug=e.debug,this._log("creating new pool : "+JSON.stringify(e)),this._workers=[],this._workersInitializing=[],this._queue=[],this._onWorkerTaskComplete=this._onWorkerTaskComplete.bind(this),this._flushIdleWorkers=this._flushIdleWorkers.bind(this),this._totalWorkersCreated=0,this._warmStart){this._log("warm starting workers");for(var o=0;o<this._maxWorkers;o++)this._createWorker()}}return i(t,[{key:"_log",value:function(t){this._debug&&console.log("task.js:manager[mid("+this.id+")] "+t)}},{key:"getActiveWorkerCount",value:function(){return this._workersInitializing.length+this._workers.length}},{key:"run",value:function(e){if(this._idleTimeout&&"number"!=typeof this._idleCheckIntervalID&&(this._idleCheckIntervalID=setInterval(this._flushIdleWorkers,this._idleCheckInterval)),!e.arguments||"undefined"==typeof e.arguments.length)throw new Error('task.js: "arguments" is required property, and it must be an array/array-like');if(!e["function"]&&("function"!=typeof e["function"]||"string"!=typeof e["function"]))throw new Error('task.js: "function" is required property, and it must be a string or a function');return"object"===r(e.arguments)&&(e.arguments=Array.prototype.slice.call(e.arguments)),e.id=++t.taskCount,this._log("added tid("+e.id+") to the queue"),e.callback?(this._queue.push(e),void this._next()):new Promise(function(t,n){e.resolve=t,e.reject=n,this._queue.push(e),this._next()}.bind(this))}},{key:"_runOnWorker",value:function(e,n,r){return new Promise(function(i,o){e.run({id:++t.taskCount,arguments:n,"function":r,resolve:i,reject:o})})}},{key:"wrap",value:function(t){return function(){var e=Array.from(arguments),n=null;return"function"==typeof e[e.length-1]&&(n=e.slice(-1).pop(),e=e.slice(0,-1)),this.run({arguments:e,"function":t,callback:n})}.bind(this)}},{key:"terminate",value:function(){this._log("terminated"),this._idleTimeout&&"number"==typeof this._idleCheckIntervalID&&(clearInterval(this._idleCheckIntervalID),this._idleCheckIntervalID=null),this._workers.forEach(function(t){t.terminate()}),this._workers=[]}},{key:"_flushIdleWorkers",value:function(){this._log("flushing idle workers"),this._workers=this._workers.filter(function(t){return!(0===t.tasks.length&&new Date-t.lastTaskTimestamp>this._idleTimeout)||(t.terminate(),!1)},this)}},{key:"_getWorker",value:function(){var t=this._workers.filter(function(t){return 0===t.tasks.length});return t.length?t[0]:this._workers.length<this._maxWorkers&&0===this._workersInitializing.length?this._createWorker():null}},{key:"_createWorker",value:function(){var t=++this._totalWorkersCreated,e=new this._WorkerProxy({debug:this._debug,id:t,managerId:this.id,onTaskComplete:this._onWorkerTaskComplete,onExit:this._onWorkerExit});if(this._globalsInitializationFunction||this._globals){this._log("running global initialization code");var n=("\n\t\t\t\tfunction (_globals) {\n\t\t\t\t\tglobals = ("+(this._globalsInitializationFunction||function(t){return t}).toString()+")(_globals || {});\n\t\t\t\t}\n\t\t\t").trim();return this._workersInitializing.push(e),this._runOnWorker(e,[this._globals||{}],n).then(function(){this._workersInitializing=this._workersInitializing.filter(function(t){return t!=e}),this._workers.push(e)}.bind(this)),null}return this._workers.push(e),e}}]),t}();o.managerCount=0,o.taskCount=0,t.exports=o},function(t,e){"use strict";t.exports=function(t,e,n){return function(r,i){var o={};return Object.keys(t).forEach(function(e){return o[e]=t[e]}),Object.keys(r).forEach(function(t){return o[t]=r[t]}),new n(o,i||e)}}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(2),l=r(u),c=n(6),f=r(c),h=function(t){function e(t){i(this,e);var n=o(this,Object.getPrototypeOf(e).apply(this,arguments));return n.WORKER_SOURCE="function () {\n\t\tonmessage = function (event) {\n\t\t\tvar message = event.data;\n\n\t\t\tvar args = Object.keys(message).filter(function (key) {\n\t\t\t\treturn key.match(/^argument/);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn parseInt(a.slice(8), 10) - parseInt(b.slice(8), 10);\n\t\t\t}).map(function (key) {\n\t\t\t\treturn message[key];\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tpostMessage({id: message.id, result: eval('(' + message.func + ')').apply(null, args)});\n\t\t\t} catch (error) {\n\t\t\t\tpostMessage({id: message.id, error: error.message});\n\t\t\t}\n\t\t}\n\t}",n._onMessage=function(t){var e=t.data;n.handleWorkerMessage(e)},n.postMessage=function(t,e){n._log("sending tid("+t.id+") to worker process"),n._worker.postMessage(t,e)},n.terminate=function(){n._log("terminated"),n._worker.terminate()},n._worker=new Worker((0,l["default"])(n.WORKER_SOURCE)),n._worker.addEventListener("message",n._onMessage),n._log("initialized"),n}return s(e,t),a(e,[{key:"_log",value:function(t){this._debug&&console.log("task.js:worker-proxy[mid("+this.managerId+") wid("+this.id+")]: "+t)}}]),e}(f["default"]);t.exports=h},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e){var r=this;n(this,t),this.handleWorkerExit=function(){r._log("killed"),r._onExit(r)},this.handleWorkerMessage=function(t){var e=null;if(r.tasks.some(function(n,r){if(t.id===n.id)return e=r,!0}),null!==e){var n=r.tasks[e];t.error?(r._log("tid("+n.id+") has thrown an error "+t.error),n.callback?n.callback(new Error("task.js: "+t.error)):n.reject(new Error("task.js: "+t.error))):(r._log("tid("+n.id+") has completed"),n.callback?n.callback(null,t.result):n.resolve(t.result)),r._onTaskComplete(r),r.tasks.splice(e,1)}},this.id=e.id,this.managerId=e.managerId,this._debug=e.debug,this.tasks=[],this.lastTaskTimestamp=null,this._onTaskComplete=e.onTaskComplete,this._onExit=e.onExit}return r(t,[{key:"run",value:function(t){this.lastTaskTimestamp=new Date;var e={id:t.id,resolve:t.resolve,reject:t.reject,callback:t.callback,$options:t};this.tasks.push(e);var n={id:e.id,func:String(t["function"])};Object.keys(t.arguments).forEach(function(e,r){n["argument"+r]=t.arguments[r]}),this._log("sending tid("+e.id+") to worker"),this.postMessage(n,t.transferables)}},{key:"_purgeTasks",value:function(t){this.tasks.forEach(function(e){e.callback?e.callback(t):e.reject(t)}),this.tasks=[]}}]),t}();t.exports=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(6),c=r(l),f=function(t){function e(){o(this,e);var t=s(this,Object.getPrototypeOf(e).apply(this,arguments));return t.postMessage=function(e,n){t._setTimeoutID=setTimeout(function(){var n=Object.keys(e).filter(function(t){return t.match(/^argument/)}).sort(function(t,e){return parseInt(t.slice(8),10)-parseInt(e.slice(8),10)}).map(function(t){return e[t]}),r=e.func.substring(e.func.indexOf("{")+1,e.func.lastIndexOf("}")),o=e.func.substring(e.func.indexOf("(")+1,e.func.indexOf(")")).split(","),s=new(Function.prototype.bind.apply(Function,[null].concat(i(o),[r])));try{var a=s.apply(void 0,i(n));t.handleWorkerMessage({id:e.id,result:a})}catch(u){t.handleWorkerMessage({id:e.id,error:u.message})}},1)},t.terminate=function(){clearTimeout(t._setTimeoutID),t._setTimeoutID=null},t._setTimeoutID=null,t}return a(e,t),u(e,[{key:"_log",value:function(t){this._debug&&console.log("task.js:worker[mid("+this.managerId+") wid("+this.id+")]: "+t)}}]),e}(c["default"]);t.exports=f}]);
//# sourceMappingURL=task.min.js.map