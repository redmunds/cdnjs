/*! task.js - 0.0.7 - clientside/minified */
var task=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(1),s=r(i),o=n(3),a=r(o),u={maxWorkers:navigator.hardwareConcurrency},l=n((0,s["default"])()?5:6);e.exports=new a["default"](u,l),e.exports.defaults=function(e,t){var n={};return Object.keys(u).forEach(function(e){return n[e]=u[e]}),Object.keys(e).forEach(function(t){return n[t]=e[t]}),new a["default"](n,t||l)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var i=n(2),s=r(i);e.exports=function(){if("undefined"!=typeof Worker&&(window.URL||window.webkitURL))try{var e=new Worker((0,s["default"])(function(){}));return e.terminate(),!0}catch(t){}return!1}},function(e,t){"use strict";e.exports=function(e){var t=void 0,n=e.toString();n=n.substring(n.indexOf("{")+1,n.lastIndexOf("}"));try{t=new Blob([n],{type:"text/javascript"})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,t=new BlobBuilder,t.append(n),t=t.getBlob()}return(window.URL||window.webkitURL).createObjectURL(t)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),u=r(a),l=function(){function e(t,n){var r=this;i(this,e),this._next=function(){if(r._queue.length){var e=r._getWorker();if(!e)return void setTimeout(r._next,0);var t=r._queue.shift();e.run(t)}},t=t||{},this._WorkerProxy=n,this._maxWorkers=t.maxWorkers||4,this._idleTimeout=t.idleTimeout!==!1&&(t.idleTimeout||1e4),this._idleCheckInterval=t.idleCheckInterval||1e3,this._workers=[],this._queue=[],this._onWorkerTaskComplete=this._onWorkerTaskComplete.bind(this),this._flushIdleWorkers=this._flushIdleWorkers.bind(this)}return o(e,[{key:"run",value:function(e){if(this._idleTimeout&&"number"!=typeof this._idleCheckIntervalID&&(this._idleCheckIntervalID=setInterval(this._flushIdleWorkers,this._idleCheckInterval)),!e.arguments||"undefined"==typeof e.arguments.length)throw new Error('task.js: "arguments" is required property, and it must be an array/array-like');if(!e["function"]&&("function"!=typeof e["function"]||"string"!=typeof e["function"]))throw new Error('task.js: "function" is required property, and it must be a string or a function');return"object"===s(e.arguments)&&(e.arguments=Array.prototype.slice.call(e.arguments)),e.callback?(this._queue.push(e),void this._next()):new Promise(function(t,n){e.resolve=t,e.reject=n,this._queue.push(e),this._next()}.bind(this))}},{key:"wrap",value:function(e){return function(){var t=Array.from(arguments),n=null;return"function"==typeof t[t.length-1]&&(n=t.splice(-1).pop()),this.run({arguments:t,"function":e,callback:n})}.bind(this)}},{key:"terminate",value:function(){this._idleTimeout&&"number"==typeof this._idleCheckIntervalID&&(clearInterval(this._idleCheckIntervalID),this._idleCheckIntervalID=null),this._workers.forEach(function(e){e.terminate()}),this._workers=[]}},{key:"_onWorkerTaskComplete",value:function(){this._next()}},{key:"_flushIdleWorkers",value:function(){this._workers=this._workers.filter(function(e){return!(0===e.tasks.length&&new Date-e.lastTaskTimestamp>this._idleTimeout)||(e.terminate(),!1)},this)}},{key:"_getWorker",value:function(){var e=this._workers.filter(function(e){return 0===e.tasks.length});return e.length?e[0]:this._workers.length<this._maxWorkers?this._createWorker():null}},{key:"_createWorker",value:function(){var e=new u["default"]({onTaskComplete:this._onWorkerTaskComplete},this._WorkerProxy);return this._workers.push(e),e}}]),e}();e.exports=l},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r){n(this,e),this.worker=new r,this.worker.addEventListener("message",this._onWorkerMessage.bind(this)),this.tasks=[],this.lastTaskTimestamp=null,this._onTaskComplete=t.onTaskComplete}return r(e,[{key:"_generateTaskID",value:function(){var e=Math.random(),t=!1;return this.tasks.some(function(e){if(e.id===!0)return t=!0,!0}),t?this._generateTaskID():e}},{key:"_onWorkerMessage",value:function(e){var t=null;if(this.tasks.some(function(n,r){if(e.id===n.id)return t=r,!0}),null!==t){var n=this.tasks[t];e.error?n.callback?n.callback(new Error("task.js: "+e.error)):n.reject(new Error("task.js: "+e.error)):n.callback?callback(null,e.result):n.resolve(e.result),this._onTaskComplete(this),this.tasks.splice(t,1)}}},{key:"run",value:function(e){var t=this._generateTaskID();this.lastTaskTimestamp=new Date,this.tasks.push({id:t,resolve:e.resolve,reject:e.reject,callback:e.callback});var n={id:t,func:String(e["function"])};Object.keys(e.arguments).forEach(function(t,r){n["argument"+r]=e.arguments[r]}),this.worker.postMessage(n,e.transferables)}},{key:"terminate",value:function(){this.tasks.forEach(function(e){e.callback?e.callback("terminated"):e.reject("terminated")}),this.tasks=[],this.worker.terminate()}}]),e}();e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),a=r(o),u=function(){function e(){var t=this;i(this,e),this.WORKER_SOURCE="function () {\n\t\tonmessage = function (event) {\n\t\t\tvar message = event.data;\n\n\t\t\tvar args = Object.keys(message).filter(function (key) {\n\t\t\t\treturn key.match(/^argument/);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn parseInt(a.slice(8), 10) - parseInt(b.slice(8), 10);\n\t\t\t}).map(function (key) {\n\t\t\t\treturn message[key];\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tpostMessage({id: message.id, result: eval('(' + message.func + ')').apply(null, args)});\n\t\t\t} catch (error) {\n\t\t\t\tpostMessage({id: message.id, error: error.message});\n\t\t\t}\n\t\t}\n\t}",this._onMessage=function(e){var n=e.data,r=t._listeners.message;r&&r.forEach(function(e){return e(n)})},this._listeners={},this._worker=new Worker((0,a["default"])(this.WORKER_SOURCE)),this._worker.addEventListener("message",this._onMessage)}return s(e,[{key:"addEventListener",value:function(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)}},{key:"postMessage",value:function(e,t){this._worker.postMessage(e,t)}},{key:"terminate",value:function(){this._worker.terminate()}}]),e}();e.exports=u},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=this;r(this,e),this._onMessage=function(e){var n=e,r=t._listeners.message;r&&r.forEach(function(e){return e(n)})},this._listeners={},this._setTimeoutID=null}return i(e,[{key:"addEventListener",value:function(e,t){this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)}},{key:"postMessage",value:function(e,t){var r=this;this._setTimeoutID=setTimeout(function(){var t=Object.keys(e).filter(function(e){return e.match(/^argument/)}).sort(function(e,t){return parseInt(e.slice(8),10)-parseInt(t.slice(8),10)}).map(function(t){return e[t]}),i=e.func.substring(e.func.indexOf("{")+1,e.func.lastIndexOf("}")),s=e.func.substring(e.func.indexOf("(")+1,e.func.indexOf(")")).split(","),o=(new(Function.prototype.bind.apply(Function,[null].concat(n(s),[i])))).apply(void 0,n(t));r._onMessage({id:e.id,result:o})},1)}},{key:"terminate",value:function(){clearTimeout(this._setTimeoutID),this._setTimeoutID=null}}]),e}();e.exports=s}]);
//# sourceMappingURL=task.min.js.map