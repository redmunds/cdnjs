//dna.js v0.2.0 ~~ dnajs.org/license.html
var dna={};dna.util={toCamel:function(a){function b(a,b){return b.toUpperCase()}return(""+a).replace(/\-(.)/g,b)},toCode:function(a){function b(a){return"-"+a.toLowerCase()}return(""+a).replace(/([A-Z])/g,b).replace(/\s|^-/g,"")},value:function(a,b){return"string"==typeof b&&(b=b.split(".")),null===a||void 0===a||void 0===b?null:1===b.length?a[b[0]]:this.value(a[b[0]],b.slice(1))},realTruth:function(a){function b(){return/^(f|false|0)$/i.test(a)}function c(){return a instanceof Array&&0===a.length}return a?!c()&&!b():!1},call:function(a,b){function c(d,e){d?1==e.length?d[e[0]](b):c(d[e[0]],e.slice(1)):dna.core.berserk('Invalid name before "'+e[0]+'" in: '+a)}return"string"==typeof a?c(window,a.split(".")):a instanceof Function&&a(b),b},apply:function(a,b,c){return a.find(b).addBack(b).each(c)},deleteElem:function(){return $(this).remove()},slideFadeIn:function(a){var b={opacity:0,transition:"opacity 0s ease 0s"},c={opacity:1,transition:"opacity 0.4s ease-in"};return a.css(b).hide().slideDown().css(c)},slideFadeOut:function(a,b){var c={opacity:0,transition:"opacity 0.4s ease-in"};return a.css(c).slideUp({complete:b})},slideFadeToggle:function(a,b){return dna.util[a.is(":visible")?"slideFadeOut":"slideFadeIn"](a,b)},slideFadeDelete:function(a){return dna.util.slideFadeOut(a,dna.util.deleteElem)}},dna.compile={regexDnaField:/^[\s]*(~~|\{\{).*(~~|\}\})[\s]*$/,regexDnaBasePair:/~~|{{|}}/,regexDnaBasePairs:/~~|\{\{|\}\}/g,isDnaField:function(){var a=$(this)[0].childNodes[0];return a&&a.nodeValue&&a.nodeValue.match(dna.compile.regexDnaField)},field:function(){var a=$(this);return a.addClass("dna-field").data("dna-field",$.trim(a.text()).replace(dna.compile.regexDnaBasePairs,"")).empty(),a},attrs:function(){function a(){3===this.value.split(dna.compile.regexDnaBasePair).length&&c.push(this.name.replace(/^data-dna-attr-/,""),this.value.split(dna.compile.regexDnaBasePair))}var b=$(this),c=[];return $.each(b.get(0).attributes,a),c.length>0&&b.addClass("dna-attr").data("dna",c),b},getDataField:function(a,b){return $.trim(a.data("dna-"+b).replace(dna.compile.regexDnaBasePairs,""))},addDataToElems:function(a,b){function c(){var a=$(this),c=a.data("dna-rules")?a.data("dna-rules"):{};c[b]=dna.compile.getDataField(a,b),a.data("dna-rules",c).addClass("dna-data")}return a.filter("[data-dna-"+b+"]").each(c)},template:function(a){var b=a.elem.find("*").addBack();return b.filter(dna.compile.isDnaField).each(dna.compile.field),b.each(dna.compile.attrs),dna.compile.addDataToElems(b,"class"),dna.compile.addDataToElems(b,"require"),dna.compile.addDataToElems(b,"missing"),dna.compile.addDataToElems(b,"truthy"),dna.compile.addDataToElems(b,"falsey"),a.elem.removeClass("dna-template").addClass("dna-clone").addClass(a.name),a.compiled=!0,a}},dna.store={templates:{},stash:function(a,b){function c(){var b=$(this),c=b.parent(),d=c.data("dna-rules")?b.data("dna-rules"):{};d.array=dna.compile.getDataField(b,"array"),c.data("dna-rules",d).addClass("dna-data"),c.data("dna-array-index",b.index()),b.attr("id",a+"-"+d.array+"-instance")}var d=$("#"+a);return b||(d.find("[data-dna-array]").addClass("dna-template").each(c),d.find(".dna-template").each(dna.store.stashNested)),d.hasClass("dna-template")&&(dna.store.templates[a]={name:a,elem:d,container:d.parent().addClass("dna-contains-"+a).data("dna-contains",a),compiled:!1,clones:0}),d.removeAttr("id").detach(),dna.store.templates[a]},stashNested:function(){return dna.store.stash($(this).attr("id"),!0)},getTemplate:function(a){var b=dna.store.templates[a]||dna.store.stash(a);return b||dna.core.berserk("Template not found: "+a),b.compiled||dna.compile.template(b),b}},dna.core={getClone:function(a){var b=a.hasClass("dna-clone")?a:a.closest(".dna-clone");return b||dna.core.berserk("Cannot find clone from element: "+a.prop("tagName")),b},inject:function(a,b,c,d){function e(){function a(a){return-1!==["string","number","boolean"].indexOf(typeof a)}var e=$(this),f=e.data("dna-field"),g="object"==typeof b?dna.util.value(b,f):"[count]"===f?c:"[value]"===f?b:null;a(g)&&(e=d.html?e.html(g):e.text(g))}function f(){var a=$(this);g=$(this).data("dna");for(var c=0;c<g.length/2;c++)h=g[2*c],i=g[2*c+1],j=[i[0],dna.util.value(b,i[1]),i[2]].join(""),a.attr(h,j),"value"===h&&a.val(j)}a.data("dna-model",b),dna.util.apply(a,".dna-field",e);var g,h,i,j;dna.util.apply(a,".dna-attr",f)},cloneSubTemplate:function(a,b){var c=a.data("dna-contains");a.find("."+c).remove(),b&&dna.clone(c,b,{holder:a})},processElem:function(a,b){function c(){a.addClass(dna.util.value(b,this))}var d=a.data("dna-rules");return d["class"]&&$.each((""+d["class"]).split(","),c),d.require&&a.toggle(void 0!==dna.util.value(b,d.require)),d.missing&&a.toggle(void 0===dna.util.value(b,d.missing)),d.truthy&&a.toggle(dna.util.realTruth(dna.util.value(b,d.truthy))),d.falsey&&a.toggle(!dna.util.realTruth(dna.util.value(b,d.falsey))),d.array&&dna.core.cloneSubTemplate(a,b[a.data("dna-rules").array]),a},replicate:function(a,b,c,d){function e(){dna.core.processElem($(this),b)}var f=a.elem.clone(!0,!0);a.clones++,dna.core.inject(f,b,c,d),f.find(".dna-data").addBack(".dna-data").each(e);var g=".dna-contains-"+a.name,h=d.holder?d.holder.find(g).addBack(g):a.container;return h[d.top?"prepend":"append"](f),d.callback&&d.callback(f,b),d.fade&&dna.util.slideFadeIn(f),f},unload:function(a,b,c){b.error||dna.api.clone(a,b,c)},berserk:function(a){throw"dna.js error -> "+a}},dna.api={clone:function(a,b,c){var d={fade:!1,top:!1,holder:null,empty:!1,html:!1,callback:null};$.extend(d,c);var e=dna.store.getTemplate(a);d.empty&&dna.api.empty(a);for(var f=b instanceof Array?b:[b],g=$(),h=0;h<f.length;h++)g=g.add(dna.core.replicate(e,f[h],h+1,d));return g},load:function(a,b,c){function d(b){dna.core.unload(a,b,c)}return $.getJSON(b,d)},getModel:function(a){return dna.core.getClone(a).data("dna-model")},empty:function(a,b){var c={fade:!1};$.extend(c,b);var d=dna.store.getTemplate(a).container.find(".dna-clone");return c.fade?dna.util.slideFadeDelete(d):d.remove()},mutate:function(a,b,c){function d(){dna.core.processElem($(this),b)}var e={html:!1};return $.extend(e,c),a=dna.core.getClone(a),b||(b=dna.getModel(a)),dna.core.inject(a,b,null,e),a.find(".dna-data").addBack(".dna-data").each(d),a},destroy:function(a,b){var c={fade:!1};return $.extend(c,b),a=dna.core.getClone(a),c.fade?dna.util.slideFadeDelete(a):a.remove()},info:function(){return console.log("~~ dns.js v0.2.0 ~~"),console.log("count:",Object.keys(dna.store.templates).length),console.log("names:",Object.keys(dna.store.templates)),console.log("templates:",dna.store.templates),navigator.appVersion}},dna.clone=dna.api.clone,dna.load=dna.api.load,dna.getModel=dna.api.getModel,dna.empty=dna.api.empty,dna.mutate=dna.api.mutate,dna.destroy=dna.api.destroy,dna.info=dna.api.info;