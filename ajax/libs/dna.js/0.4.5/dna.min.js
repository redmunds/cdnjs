//dna.js v0.4.5 ~~ dnajs.org/license
window.dna={clone:function(e,n,a){var t=$.extend({fade:!1,top:!1,container:null,empty:!1,html:!1,callback:null},a),d=dna.store.getTemplate(e);d.nested&&!t.container&&dna.core.berserk("Container missing for nested template: "+e),t.empty&&dna.empty(e);for(var i=n instanceof Array?n:[n],l=$(),r=0;r<i.length;r++)l=l.add(dna.core.replicate(d,i[r],r,t));return dna.placeholder.setup(),l.first().closest(".dna-menu, .dna-panels").length&&dna.panels.refresh(),l},cloneSubTemplate:function(e,n,a,t){function d(){o.push(this)}var i=dna.compile.subTemplateName(e,n),l=".dna-contains-"+i,r=$.extend({container:e.find(l).addBack(l)},t);dna.clone(i,a,r);var o=dna.getModel(e)[n];return $.each(a instanceof Array?a:[a],d),e},createTemplate:function(e,n,a){return $(n).attr({id:e}).addClass("dna-template").appendTo(a),dna.store.getTemplate(e)},rest:{get:function(e,n,a){function t(n){n.error||dna.clone(e,n,a)}return $.getJSON(n,t)}},getModel:function(e,n){function a(e){return dna.getClone(e,n).data("dnaModel")}function t(e){function n(){a.push(dna.getModel($(this)))}var a=[];return dna.getClones(e).each(n),a}return(e instanceof jQuery?a:t)(e)},empty:function(e,n){var a=$.extend({fade:!1},n),t=dna.store.getTemplate(e).container.find(".dna-clone");return a.fade?dna.ui.slideFadeDelete(t):dna.core.remove(t)},refresh:function(e,n){var a=$.extend({html:!1},n),t=dna.getClone(e,n),d=a.data?a.data:dna.getModel(t);return dna.core.inject(t,d,null,a)},refreshAll:function(e){function n(){dna.refresh($(this))}return dna.getClones(e).each(n)},destroy:function(e,n){function a(n){dna.getModel(e.parent())[n].splice(dna.getIndex(e),1)}var t=$.extend({fade:!1},n);return e=dna.getClone(e,n),e.hasClass("dna-sub-clone")&&a(e.data().dnaRules.array),t.fade?dna.ui.slideFadeDelete(e):dna.core.remove(e)},getClone:function(e,n){var a=$.extend({main:!1},n),t=a.main?".dna-clone:not(.dna-sub-clone)":".dna-clone";return e instanceof jQuery?e.closest(t):$()},getClones:function(e){return dna.store.getTemplate(e).container.children().filter(".dna-clone")},getIndex:function(e,n){var a=dna.getClone(e,n);return a.parent().children(".dna-clone").index(a)},up:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!0)},down:function(e){return dna.ui.smoothMove(dna.getClone(dna.ui.toElem(e,this)),!1)},bye:function(e){return dna.destroy(dna.ui.toElem(e,this),{fade:!0})},registerInitializer:function(e,n){var a=$.extend({onDocumentLoad:!0},n);return a.onDocumentLoad&&dna.util.apply(e,[a.selector?$(a.selector).not(".dna-template "+a.selector).addClass("dna-initialized"):$(document)].concat(a.params)),dna.events.initializers.push({func:e,selector:a.selector,params:a.params})},clearInitializers:function(){dna.events.initializers=[]},info:function(){var e=Object.keys(dna.store.templates);return console.log("~~ dna.js v0.4.4 ~~"),console.log("templates:",e.length),console.log("names:",e),console.log("store:",dna.store.templates),console.log("initializers:",dna.events.initializers.length),navigator.appVersion}},dna.array={find:function(e,n){function a(e){return e.code===n}var t=e.filter(a);return t.length?t[0]:null},last:function(e){return e&&e.length?e[e.length-1]:void 0},toMap:function(e,n){function a(e){t[e[n]]=e}n=n?n:"code";var t={};return e.forEach(a),t}},dna.browser={getParams:function(){function e(e){n[e.split("=")[0]]=e.split("=")[1]}var n={};return window.location.search.slice(1).split("&").forEach(e),n}},dna.util={toCamel:function(e){function n(e,n){return n.toUpperCase()}return(""+e).replace(/\-(.)/g,n)},toKebab:function(e){function n(e){return"-"+e.toLowerCase()}return(""+e).replace(/([A-Z]+)/g,n).replace(/\s|^-/g,"")},toCode:function(e){return dna.util.toKebab(e)},value:function(e,n){return"string"==typeof n&&(n=n.split(".")),null===e||void 0===e||void 0===n?null:1===n.length?e[n[0]]:this.value(e[n[0]],n.slice(1))},realTruth:function(e){function n(){return/^(f|false|0)$/i.test(e)}function a(){return e instanceof Array&&0===e.length}return!!e&&(!a()&&!n())},printf:function(e){function n(e,n){return e.replace(/%s/,n)}var a=Array.prototype.slice.call(arguments,1);return a.reduce(n,e)},apply:function(e,n){function a(n,l){!n||1==l.length&&"function"!=typeof n[l[0]]?dna.core.berserk("Callback function not found: "+e):1==l.length?t=n[l[0]].apply(i,d):a(n[l[0]],l.slice(1))}var t,d=void 0===n?[]:[].concat(n),i=d[0];return i instanceof jQuery&&0===i.length?t=i:"function"==typeof e?t=e.apply(i,d):i&&i[e]?t=i[e](d[1],d[2],d[3]):""===e||{number:!0,boolean:!0}[typeof e]?dna.core.berserk("Invalid callback function: "+e):"string"==typeof e&&e.length>0&&a(window,e.split(".")),t}},dna.ui={toElem:function(e,n){return e instanceof jQuery?e:e?$(e.target):$(n)},deleteElem:function(e){var n=dna.ui.toElem(e,this);return dna.core.remove(n),n},slideFade:function(e,n,a){function t(){e.css(r)}var d={opacity:0,transition:"opacity 0s ease 0s"},i={opacity:1,transition:"opacity 0.4s ease-in"},l={opacity:0,transition:"opacity 0.4s ease-out"},r={transition:"opacity 0s ease 0s"};return window.setTimeout(t,1e3),a?e.css(d).hide().slideDown({complete:n}).css(i):e.css(l).slideUp({complete:n}),e},slideFadeIn:function(e,n){return dna.ui.slideFade(e,n,!0)},slideFadeOut:function(e,n){return dna.ui.slideFade(e,n,!1)},slideFadeToggle:function(e,n){return dna.ui.slideFade(e,n,e.is(":hidden"))},slideFadeDelete:function(e){return dna.ui.slideFadeOut(e,dna.ui.deleteElem)},slidingFlasher:function(e,n){return e.is(":hidden")?dna.ui.slideFadeIn(e,n):e.hide().fadeIn()},smoothMove:function(e,n){function a(){var a=t.clone();n?e.after(t.hide()).before(a):e.before(t.hide()).after(a),dna.ui.slideFadeIn(t),dna.ui.slideFadeDelete(a)}var t=n?e.prev():e.next();t.length&&a()},focus:function(e){return e.focus()}},dna.placeholder={setup:function(){function e(){var e=$(this).stop();return dna.getClones(e.data().placeholder).length?e.fadeOut():e.fadeIn()}$("[data-placeholder]").each(e)}},$(dna.placeholder.setup),dna.pageToken={put:function(e,n){return window.sessionStorage[e+window.location.pathname]=JSON.stringify(n),n},get:function(e,n){var a=window.sessionStorage[e+window.location.pathname];return void 0===a?n:JSON.parse(a)}},dna.panels={key:function(e){return"#"+e.attr("id")+"-panels"},display:function(e,n,a){function t(){dna.pageToken.put(l,n),a&&i.data().hash&&window.history.pushState(null,null,"#"+i.data().hash)}var d,i,l=dna.panels.key(e),r=e.find(".menu-item");void 0===n&&(n=dna.pageToken.get(l,0)),n=Math.max(0,Math.min(n,r.length-1)),r.removeClass("selected").eq(n).addClass("selected"),d=$(l).children().hide().removeClass("displayed"),i=d.eq(n).fadeIn().addClass("displayed"),t(),dna.util.apply(e.data().callback,i)},rotate:function(e){var n=$(e.target).closest(".menu-item"),a=n.closest(".dna-menu");dna.panels.display(a,a.find(".menu-item").index(n),!0)},reload:function(e){dna.panels.display($("#"+e))},refresh:function(){function e(e){return e.filter("[data-hash="+t+"]").index()}function n(e){return e.first().closest(".dna-template").length>0}function a(){var a=$(this),d=dna.panels.key(a),i=$(d).children().addClass("panel");if(0===a.find(".menu-item").length&&a.children().addClass("menu-item"),!n(i)&&!n(a.children())){var l=t&&i.first().data().hash?e(i):dna.pageToken.get(d,0);dna.panels.display(a,l)}}var t=window.location.hash.slice(1);$(".dna-menu").each(a)},setup:function(){dna.panels.refresh(),$(document).on({click:dna.panels.rotate},".dna-menu .menu-item")}},$(dna.panels.setup),dna.compile={regexDnaField:/^[\s]*(~~|\{\{).*(~~|\}\})[\s]*$/,regexDnaBasePair:/~~|{{|}}/,regexDnaBasePairs:/~~|\{\{|\}\}/g,setupNucleotide:function(e){return void 0===e.data().dnaRules&&(e.data().dnaRules={}),e.addClass("dna-nucleotide")},isDnaField:function(){var e=$(this)[0].childNodes[0];return e&&e.nodeValue&&e.nodeValue.match(dna.compile.regexDnaField)},field:function(){var e=dna.compile.setupNucleotide($(this));return e.data().dnaRules.text=$.trim(e.text()).replace(dna.compile.regexDnaBasePairs,""),e.empty()},propsAndAttrs:function(){function e(e,n){l.push(e),e=e.replace(/^data-prop-/,"").toLowerCase(),n=n.replace(dna.compile.regexDnaBasePairs,""),d.push(e,n),"checked"===e&&t.is("input")?t.addClass("dna-update-model").data().dnaField=n:"selected"===e&&t.is("option")&&(t.parent().addClass("dna-update-model").end().data().dnaField=n)}function n(e,n){var a=n.split(dna.compile.regexDnaBasePair);"[value]"===a[1]&&(a[1]=!0),i.push(e.replace(/^data-attr-/,""),a),l.push(e);var d="input:not(:checkbox, :radio)";"value"===e&&t.is(d)&&""===a[0]&&""===a[2]&&(t.addClass("dna-update-model").data().dnaField=a[1])}function a(){/^data-prop-/.test(this.name)?e(this.name,this.value):3===this.value.split(dna.compile.regexDnaBasePair).length&&n(this.name,this.value)}var t=$(this),d=[],i=[],l=[];return $.each(t.get(0).attributes,a),d.length>0&&(dna.compile.setupNucleotide(t).data().dnaRules.props=d),i.length>0&&(dna.compile.setupNucleotide(t).data().dnaRules.attrs=i),t.data().transform&&(dna.compile.setupNucleotide(t).data().dnaRules.transform=t.data().transform),t.data().callback&&(dna.compile.setupNucleotide(t).data().dnaRules.callback=t.data().callback),t.removeAttr(l.join(" "))},getDataField:function(e,n){return $.trim(e.data(n).replace(dna.compile.regexDnaBasePairs,""))},subTemplateName:function(e,n){var a=e instanceof jQuery?dna.getClone(e).data().dnaRules.template:e;return a+"-"+n+"-instance"},rules:function(e,n,a){function t(){var e=dna.compile.setupNucleotide($(this)),t=dna.compile.getDataField(e,n);e.data().dnaRules[n]=a?t.split(","):t}return e.filter("[data-"+n+"]").each(t).removeAttr("data-"+n)},separators:function(e){function n(){return 3===this.nodeType&&!/\S/.test(this.nodeValue)}function a(e,a,t){a&&(e.contents().last().filter(n).remove(),e.append($("<span>").addClass(t).html(a)))}function t(){var e=$(this);a(e,e.data().separator,"dna-separator"),a(e,e.data().lastSeparator,"dna-last-separator")}e.find(".dna-template, .dna-sub-clone").addBack().each(t)},template:function(e){function n(){$(this).data().dnaRules={template:$(this).attr("id")}}function a(){$(this).attr({type:$(this).data().attrType})}var t=$("#"+e);t.length||dna.core.berserk("Template not found: "+e),t.find(".dna-template").addBack().each(n).removeAttr("id");var d=t.find("*").addBack();return d.filter(dna.compile.isDnaField).each(dna.compile.field),dna.compile.rules(d,"array").addClass("dna-sub-clone"),dna.compile.rules(d,"class",!0),dna.compile.rules(d,"require"),dna.compile.rules(d,"missing"),dna.compile.rules(d,"truthy"),dna.compile.rules(d,"falsey"),dna.compile.rules(d.filter("select"),"option").addClass("dna-update-model"),d.each(dna.compile.propsAndAttrs),dna.compile.separators(t),$("input[data-attr-type]").each(a),dna.store.stash(t)}},dna.store={templates:{},stash:function(e){function n(){var e=$(this),n=e.data().dnaRules.template,a={name:n,elem:e,container:e.parent().addClass("dna-container").addClass("dna-contains-"+n),nested:0!==e.parent().closest(".dna-clone").length,separators:e.find(".dna-separator, .dna-last-separator").length,index:e.index(),elemsAbove:e.index()>0,elemsBelow:e.nextAll().length>0,clones:0};dna.store.templates[n]=a,e.removeClass("dna-template").addClass("dna-clone").addClass(n).detach()}function a(){var e=$(this),n=e.data().dnaRules.array,a=dna.compile.subTemplateName(t,n);dna.compile.setupNucleotide(e.parent().addClass("dna-array")).data().dnaRules.loop={name:a,field:n},e.data().dnaRules.template=a}var t=e.data().dnaRules.template;return e.find(".dna-template").addBack().each(n),e.find(".dna-sub-clone").each(a).each(n),dna.store.templates[t]},getTemplate:function(e){return dna.store.templates[e]||dna.compile.template(e)}},dna.events={initializers:[],elementSetup:function(e,n){function a(){dna.util.apply($(this).data().onLoad,[$(this),n])}var t="[data-on-load]",d=e?e.find(t).addBack(t):$(t);return d.not(".dna-initialized").each(a).addClass("dna-initialized")},runInitializers:function(e,n){function a(){var n=this.selector?e.find(this.selector).addBack(this.selector):e;dna.util.apply(this.func,[n.addClass("dna-initialized")].concat(this.params))}return dna.events.elementSetup(e,n),$.each(dna.events.initializers,a),e},setup:function(){function e(e,n,a){e=e.closest("[data-"+n+"]");var t=e.data(n);return"click"===n&&"A"===e.prop("tagName")&&t&&t.match(/^dna[.]/)&&a.preventDefault(),dna.util.apply(t,[e,a])}function n(n){function a(e){return e.dnaRules&&e.dnaRules.option||e.dnaField}function t(e,n){dna.getModel(e)[a(e.data())]=n(e)}function d(e){return e.val()}function i(e){return e.is(":checked")}function l(){t($(this),i)}function r(){var e=dna.getClone(o,{main:!0});0!==e.length&&(o.is("input:checkbox")?t(o,i):o.is("input:radio")?$("input:radio[name="+o.attr("name")+"]").each(l):o.is("input")||o.data().dnaRules.option?t(o,d):o.is("select")&&o.find("option").each(l),dna.refresh(e))}var o=$(n.target);return o.hasClass("dna-update-model")&&r(),e(o,n.type.replace("key","key-"),n)}function a(n){13===n.which&&e($(n.target),"enter-key",n)}function t(n){function a(){function a(){i.dnaLastUpdated=Date.now(),i.dnaTimeoutId=void 0,e(d,"smart-update",n)}var l=i.smartThrottle?Number(i.smartThrottle):t;i.dnaLastValue=d.val(),i.dnaTimeoutId||(Date.now()<i.dnaLastUpdated+l?i.dnaTimeoutId=window.setTimeout(a,l):a())}var t=2e3,d=$(n.target),i=d.data();i.smartUpdate&&d.val()!==i.dnaLastValue&&a()}function d(){function e(e){return e.closest(".external-site").length?"_blank":"_self"}function n(){window.open($(this).data().href,e($(this)))}$(document).on({click:n},"[data-href]")}$(document).click(n).change(n).keyup(n).keyup(a).keyup(t).keydown(n).keypress(n),d(),dna.events.elementSetup()}},$(dna.events.setup),dna.core={inject:function(e,n,a,t){function d(e,d){var i="[count]"===d?a+1:"[value]"===d?n:dna.util.value(n,d),l={string:!0,number:!0,boolean:!0};l[typeof i]&&(e=t.html?e.html(i):e.text(i))}function i(e,a){for(var t=0;t<a.length/2;t++)e.prop(a[2*t],dna.util.realTruth(dna.util.value(n,a[2*t+1])))}function l(e,a){for(var t=0;t<a.length/2;t++){var d=a[2*t],i=a[2*t+1],l=i[1]===!0?n:dna.util.value(n,i[1]),r=[i[0],l,i[2]].join("");e.attr(d,r),/^data-./.test(d)&&e.data(d.substring(5),r),"value"===d&&r!==e.val()&&e.val(r)}}function r(e,n){null!==n&&e.val(n)}function o(e,a){var t=dna.util.value(n,a[0]),d=dna.util.realTruth(t);1===a.length?e.addClass(t):a.length>1&&(e.toggleClass(a[1],d),a[2]&&e.toggleClass(a[2],!d))}function s(e,a){function d(e){dna.core.inject($(this),l[e],e,t)}function i(){r.remove(),dna.clone(a.name,l,{container:e,html:t.html})}var l=dna.util.value(n,a.field),r=e.children("."+a.name.replace(/[.]/g,"\\."));l?l.length===r.length?r.each(d):i():n[a.field]=[]}function u(){var e=$(this),a=e.data().dnaRules;a.transform&&dna.util.apply(a.transform,n),a.text&&d(e,a.text),a.props&&i(e,a.props),a.attrs&&l(e,a.attrs),a.class&&o(e,a.class),a.require&&e.toggle(void 0!==dna.util.value(n,a.require)),a.missing&&e.toggle(void 0===dna.util.value(n,a.missing)),a.truthy&&e.toggle(dna.util.realTruth(dna.util.value(n,a.truthy))),a.falsey&&e.toggle(!dna.util.realTruth(dna.util.value(n,a.falsey))),a.loop&&s(e,a.loop),a.option&&r(e,dna.util.value(n,a.option)),a.callback&&dna.util.apply(a.callback,e)}function c(e){e.filter(".dna-nucleotide").each(u),e.length&&c(e.children().not(".dna-sub-clone"))}return c(e),e.data().dnaModel=n,e},replicate:function(e,n,a,t){function d(){var n=r.children("."+e.name);n.find(".dna-separator").show().end().last().find(".dna-separator").hide(),n.find(".dna-last-separator").hide().end().eq(-2).find(".dna-last-separator").show().closest(".dna-clone").find(".dna-separator").hide()}var i=e.elem.clone(!0,!0);e.clones++,dna.core.inject(i,n,a,t);var l=".dna-contains-"+e.name.replace(/[.]/g,"\\."),r=t.container?t.container.find(l).addBack(l):e.container;return t.top&&!e.elemsAbove?r.prepend(i):t.top||e.elemsBelow?t.top?r.children().eq(e.index-1).after(i):r.children().eq(e.index+r.children().filter(".dna-clone").length).before(i):r.append(i),e.separators&&d(),dna.events.runInitializers(i,n),t.callback&&t.callback(i,n),t.fade&&dna.ui.slideFadeIn(i),i},remove:function(e){return e.remove(),dna.placeholder.setup(),e},berserk:function(e){throw new Error("dna.js -> "+e)}};