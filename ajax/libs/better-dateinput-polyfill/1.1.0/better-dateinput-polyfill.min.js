!function(e){"use strict";"orientation"in window||e.extend("input[type=date]",["div[hidden].%CLS%>p.%CLS%-header+a.%CLS%-prev+a.%CLS%-next+table.%CLS%-days>thead>tr>th[data-i18n=calendar.weekday.$]*7+tbody>tr*6>td*7".replace(/%CLS%/g,"better-dateinput-calendar")],{constructor:function(t){this.set({type:"text",autocomplete:"off"}).addClass("better-dateinput").on("focus",this,"_syncInputWithCalendar",[t]).on("keydown(keyCode,shiftKey)",this,"_handleCalendarKeyDown",[t]),t.findAll("a").on("click(target)",this,"_handleCalendarNavClick",[t]),t.on("click(target) td",this,"_handleCalendarDayClick",[t]),e.on("click",this,"_handleDocumentClick",[t]),this.bind("setCalendarDate",t.find(".better-dateinput-calendar-header"),t.findAll("td")),this.after(t),this.isFocused()&&this.fire("focus")},getCalendarDate:function(){return this.getData("calendarDate")},setCalendarDate:function(e,t,a){var n=new Date(a.getFullYear(),a.getMonth(),0);return e.set("<span data-i18n='calendar.month."+a.getMonth()+"'> "+(isNaN(a.getFullYear())?"":a.getFullYear())),isNaN(n.getTime())||(n.setDate(n.getDate()-n.getDay()),t.each(function(e){n.setDate(n.getDate()+1);var t=a.getMonth()-n.getMonth(),l=a.getDate()-n.getDate();a.getFullYear()!==n.getFullYear()&&(t*=-1),e.set("className",t?t>0?"prev-calendar-day":"next-calendar-day":l?"calendar-day":"current-calendar-day"),e.set(n.getDate().toString())}),this.setData("calendarDate",a)),this},_handleCalendarDayClick:function(e,t){var a=this.getCalendarDate(),n=a.getFullYear(),l=a.getMonth(),r=new Date(n,l,7*e.parent().get("rowIndex")+e.get("cellIndex")-5-new Date(n,l,1).getDay());return this.setCalendarDate(r),this._syncCalendarWithInput(t),!1},_handleCalendarNavClick:function(e,t){var a=e.hasClass("better-dateinput-calendar-next"),n=this.getCalendarDate(),l=new Date(n.getFullYear(),n.getMonth()+(a?1:-1),1);return this.setCalendarDate(l)._syncCalendarWithInput(t,!0),this.fire("focus"),!1},_handleCalendarKeyDown:function(e,t,a){var n=this.getCalendarDate(),l=0;return 13===e?a.toggle():27===e||9===e?a.hide():8===e||46===e?this.set("")._syncInputWithCalendar(a,!0):(74===e||40===e?l=7:75===e||38===e?l=-7:76===e||39===e?l=1:72!==e&&37!==e||(l=-1),l&&(!t||40!==e&&38!==e?!t||37!==e&&39!==e?n.setDate(n.getDate()+l):n.setMonth(n.getMonth()+(l>0?1:-1)):n.setFullYear(n.getFullYear()+(l>0?1:-1)),this.setCalendarDate(n)._syncCalendarWithInput(a,!0))),9===e},_syncInputWithCalendar:function(e,t){var a=(this.get("value")||"").split("-");this.setCalendarDate(a.length>1?new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10)):new Date),t||e.show()},_syncCalendarWithInput:function(e,t){var a=this.getCalendarDate(),n=("00"+(a.getMonth()+1)).slice(-2),l=("00"+a.getDate()).slice(-2);this.set(a.getFullYear()+"-"+n+"-"+l),t||e.hide()},_handleDocumentClick:function(e){this.isFocused()||e.hide()}})}(window.DOM);