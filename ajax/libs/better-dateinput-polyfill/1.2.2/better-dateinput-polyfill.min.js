!function(t){"use strict";var e="en-US"===t.find("html").get("lang"),a="better-dateinput",n=a+"-calendar",d="date-input",i="date-picker",l=t.template("div.$c>p.$c-header+button+button+table.$c-days>thead>tr>th[data-i18n=calendar.weekday.$]*7+tbody>tr*6>td*7",{c:n}),r=function(t){return("00"+t).slice(-2)};t.extend("input[type=date]","orientation"in window?function(){this.addClass(a)}:{constructor:function(){var a=t.create(l).hide(),n=t.create("input[type=hidden]",{name:this.get("name")});e&&a.find("th").before(a.findAll("th")[6]),this.set({type:"text",name:null}).addClass("better-dateinput").on("focus","handleCalendarFocus").on("keydown",["which","shiftKey"],"handleCalendarKeyDown"),a.on("click button",this,"handleCalendarNavClick").on("click td",this,"handleCalendarDayClick"),t.on("click",this,"handleDocumentClick"),this.data(i,a).data(d,n).after(a,n),this.matches(":focus")&&this.fire("focus")},getCalendarDate:function(){var t=(this.data(d).get()||"").split("-");return new Date(parseFloat(t[0]),parseFloat(t[1])-1,parseFloat(t[2]))},setCalendarDate:function(a){var n=this.data(i).find("p")||t.mock(),l=this.data(i).findAll("td")||t.mock(),s=new Date,h=(a||s).getFullYear(),c=(a||s).getMonth(),o=(a||s).getDate(),u=new Date(h,c,0);return n.i18n("calendar.month."+c,{year:h}),u.setDate(u.getDate()-u.getDay()-(e?1:0)),l.each(function(t){u.setDate(u.getDate()+1);var e=c-u.getMonth(),a=o-u.getDate();h!==u.getFullYear()&&(e*=-1),t.set("class",e?e>0?"prev-calendar-day":"next-calendar-day":a?"calendar-day":"current-calendar-day"),t.set(u.getDate().toString()).data("ts",u.getTime())}),this.data(d).set(h+"-"+r(c+1)+"-"+r(o)),a&&this.set((e?c+1:o)+"/"+(e?o:c+1)+"/"+h),this},handleCalendarDayClick:function(t){return this.setCalendarDate(new Date(t.data("ts"))),!1},handleCalendarNavClick:function(t){var e=!t.next("button").length,a=this.getCalendarDate(),n=new Date(a.getFullYear(),a.getMonth()+(e?1:-1),1);return this.setCalendarDate(n),this.fire("focus"),!1},handleCalendarKeyDown:function(t,e){var a=this.data(i),n=this.getCalendarDate(),d=0;return 13===t?a.hide():32===t?a.toggle():27===t||9===t?a.hide():8===t||46===t?this.set("").handleCalendarFocus():(74===t||40===t?d=7:75===t||38===t?d=-7:76===t||39===t?d=1:72!==t&&37!==t||(d=-1),d&&(!e||40!==t&&38!==t?!e||37!==t&&39!==t?n.setDate(n.getDate()+d):n.setMonth(n.getMonth()+(d>0?1:-1)):n.setFullYear(n.getFullYear()+(d>0?1:-1)),this.setCalendarDate(n))),9===t||13===t},handleDocumentClick:function(){var t=this.data(i);this.matches(":focus")||t.hide()},handleCalendarFocus:function(){var t,a,n,d,l=this.data(i),r=this.get().split("/");3===r.length&&(d=parseFloat(r[e?1:0]),n=parseFloat(r[e?0:1])-1,a=parseFloat(r[2]),t=new Date(a,n,d)),this.setCalendarDate(t),l.show()}})}(window.DOM);