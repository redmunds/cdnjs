!function(e,t){window.MockAjax=t(e,getJasmineRequireObj)}("undefined"!=typeof window?window:global,function(e,t){t().ajax=function(e){var t={};return t.RequestStub=e.AjaxRequestStub(),t.RequestTracker=e.AjaxRequestTracker(),t.StubTracker=e.AjaxStubTracker(),t.ParamParser=e.AjaxParamParser(),t.event=e.AjaxEvent(),t.eventBus=e.AjaxEventBus(t.event),t.fakeRequest=e.AjaxFakeRequest(t.eventBus),t.MockAjax=e.MockAjax(t),t.MockAjax},t().AjaxEvent=function(){function e(){return(new Date).getTime()}function t(){}function s(t,s){this.type=s,this.bubbles=!1,this.cancelable=!1,this.timeStamp=e(),this.isTrusted=!1,this.defaultPrevented=!1,this.eventPhase=2,this.target=t,this.currentTarget=t}function n(){s.apply(this,arguments),this.lengthComputable=!1,this.loaded=0,this.total=0}return s.prototype.preventDefault=t,s.prototype.stopPropagation=t,s.prototype.stopImmediatePropagation=t,n.prototype=s.prototype,{event:function(e,t){return new s(e,t)},progressEvent:function(e,t){return new n(e,t)}}},t().AjaxEventBus=function(e){function t(e){this.eventList={},this.source=e}function s(e,t){return e[t]=e[t]||[],e[t]}function n(e,t){if(e.indexOf)return e.indexOf(t);for(var s=0;s<e.length;s++)if(t===e[s])return s;return-1}return t.prototype.addEventListener=function(e,t){s(this.eventList,e).push(t)},t.prototype.removeEventListener=function(e,t){var s=n(this.eventList[e],t);s>=0&&this.eventList[e].splice(s,1)},t.prototype.trigger=function(t){var s;s="readystatechange"===t?e.event(this.source,t):e.progressEvent(this.source,t);var n=this.eventList[t];if(n)for(var r=0;r<n.length;r++)n[r].call(this.source,s)},function(e){return new t(e)}},t().AjaxFakeRequest=function(e){function t(e,t,n){n=n||[];for(var r in t)s(n,r)||(e[r]=t[r]);return e}function s(e,t){for(var s=0;s<e.length;s++)if(e[s]===t)return!0;return!1}function n(e,t){return function(){e[t]&&e[t].apply(e,arguments)}}function r(e){e.eventBus.addEventListener("readystatechange",n(e,"onreadystatechange")),e.eventBus.addEventListener("loadstart",n(e,"onloadstart")),e.eventBus.addEventListener("load",n(e,"onload")),e.eventBus.addEventListener("loadend",n(e,"onloadend")),e.eventBus.addEventListener("progress",n(e,"onprogress")),e.eventBus.addEventListener("error",n(e,"onerror")),e.eventBus.addEventListener("abort",n(e,"onabort")),e.eventBus.addEventListener("timeout",n(e,"ontimeout"))}function i(e){var t=["Can't build XHR.response for XHR.responseType of '",e,"'.","XHR.response must be explicitly stubbed"];return t.join(" ")}function o(n,o,a,u){function h(){o.track(this),this.eventBus=e(this),r(this),this.requestHeaders={},this.overriddenMimeType=null}function c(e,t){e=e.toLowerCase();for(var s in t)if(s.toLowerCase()===e)return t[s]}function p(e,t){var s=[];if(e)if(e instanceof Array)s=e;else for(var n in e)e.hasOwnProperty(n)&&s.push({name:n,value:e[n]});else s.push({name:"Content-Type",value:t||"application/json"});return s}function d(e,t){if(n.DOMParser)return(new n.DOMParser).parseFromString(e,"text/xml");var s=new n.ActiveXObject("Microsoft.XMLDOM");return s.async="false",s.loadXML(e),s}function l(e,t){return s(f,t.toLowerCase())?d(e,t):t.match(/\+xml$/)?d(e,"text/xml"):null}var f=["text/xml","application/xml"];t(h,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});var v=["responseBody","responseText","responseXML","status","statusText","responseTimeout","responseURL"];return t(h.prototype,new n.XMLHttpRequest,v),t(h.prototype,{open:function(){this.method=arguments[0],this.url=arguments[1],this.username=arguments[3],this.password=arguments[4],this.readyState=h.OPENED,this.requestHeaders={},this.eventBus.trigger("readystatechange")},setRequestHeader:function(e,t){if(0===this.readyState)throw new Error('DOMException: Failed to execute "setRequestHeader" on "XMLHttpRequest": The object\'s state must be OPENED.');this.requestHeaders.hasOwnProperty(e)?this.requestHeaders[e]=[this.requestHeaders[e],t].join(", "):this.requestHeaders[e]=t},overrideMimeType:function(e){this.overriddenMimeType=e},abort:function(){this.readyState=h.UNSENT,this.status=0,this.statusText="abort",this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("abort"),this.eventBus.trigger("loadend")},readyState:h.UNSENT,onloadstart:null,onprogress:null,onabort:null,onerror:null,onload:null,ontimeout:null,onloadend:null,onreadystatechange:null,addEventListener:function(){this.eventBus.addEventListener.apply(this.eventBus,arguments)},removeEventListener:function(e,t){this.eventBus.removeEventListener.apply(this.eventBus,arguments)},status:null,send:function(e){this.params=e,this.eventBus.trigger("loadstart");var t=a.findStub(this.url,e,this.method);this.dispatchStub(t)},dispatchStub:function(e){e&&(e.isReturn()?this.respondWith(e):e.isError()?this.responseError():e.isTimeout()?this.responseTimeout():e.isCallFunction()&&this.responseCallFunction(e))},contentType:function(){return c("content-type",this.requestHeaders)},data:function(){return this.params?u.findParser(this).parse(this.params):{}},getResponseHeader:function(e){var t=null;if(!this.responseHeaders)return t;e=e.toLowerCase();for(var s=0;s<this.responseHeaders.length;s++){var n=this.responseHeaders[s];e===n.name.toLowerCase()&&(t=t?[t,n.value].join(", "):n.value)}return t},getAllResponseHeaders:function(){if(!this.responseHeaders)return null;for(var e=[],t=0;t<this.responseHeaders.length;t++)e.push(this.responseHeaders[t].name+": "+this.responseHeaders[t].value);return e.join("\r\n")+"\r\n"},responseText:null,response:null,responseType:null,responseURL:null,responseValue:function(){switch(this.responseType){case null:case"":case"text":return this.readyState>=h.LOADING?this.responseText:"";case"json":return JSON.parse(this.responseText);case"arraybuffer":throw i("arraybuffer");case"blob":throw i("blob");case"document":return this.responseXML}},respondWith:function(e){if(this.readyState===h.DONE)throw new Error("FakeXMLHttpRequest already completed");this.status=e.status,this.statusText=e.statusText||"",this.responseHeaders=p(e.responseHeaders,e.contentType),this.readyState=h.HEADERS_RECEIVED,this.eventBus.trigger("readystatechange"),this.responseText=e.responseText||"",this.responseType=e.responseType||"",this.responseURL=e.responseURL||null,this.readyState=h.DONE,this.responseXML=l(e.responseText,this.getResponseHeader("content-type")||""),this.responseXML&&(this.responseType="document"),"response"in e?this.response=e.response:this.response=this.responseValue(),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("load"),this.eventBus.trigger("loadend")},responseTimeout:function(){if(this.readyState===h.DONE)throw new Error("FakeXMLHttpRequest already completed");this.readyState=h.DONE,jasmine.clock().tick(3e4),this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("timeout"),this.eventBus.trigger("loadend")},responseError:function(){if(this.readyState===h.DONE)throw new Error("FakeXMLHttpRequest already completed");this.readyState=h.DONE,this.eventBus.trigger("readystatechange"),this.eventBus.trigger("progress"),this.eventBus.trigger("error"),this.eventBus.trigger("loadend")},responseCallFunction:function(e){e.action=void 0,e.functionToCall(e,this),this.dispatchStub(e)}}),h}return o},t().MockAjax=function(e){function t(t){var s=new e.RequestTracker,n=new e.StubTracker,r=new e.ParamParser,i=t.XMLHttpRequest,o=e.fakeRequest(t,s,n,r);this.install=function(){if(t.XMLHttpRequest===o)throw"MockAjax is already installed.";t.XMLHttpRequest=o},this.uninstall=function(){if(t.XMLHttpRequest!==o)throw"MockAjax not installed.";t.XMLHttpRequest=i,this.stubs.reset(),this.requests.reset(),r.reset()},this.stubRequest=function(t,s,r){var i=new e.RequestStub(t,s,r);return n.addStub(i),i},this.withMock=function(e){this.install();try{e()}finally{this.uninstall()}},this.addCustomParamParser=function(e){r.add(e)},this.requests=s,this.stubs=n}return t},t().AjaxParamParser=function(){function e(){var e=[{test:function(e){return/^application\/json/.test(e.contentType())},parse:function(e){return JSON.parse(e)}},{test:function(e){return!0},parse:function(e){for(var t={},s=e.split("&"),n=0;n<s.length;++n){var r=s[n].replace(/\+/g," ").split("="),i=decodeURIComponent(r[0]);t[i]=t[i]||[],t[i].push(decodeURIComponent(r[1]))}return t}}],t=[];this.add=function(e){t.unshift(e)},this.findParser=function(e){for(var s in t){var n=t[s];if(n.test(e))return n}},this.reset=function(){t=[];for(var s in e)t.push(e[s])},this.reset()}return e},t().AjaxRequestStub=function(){function e(e,i,o){var a=function(e){return e?e.split("&").sort().join("&"):void 0};if(e instanceof RegExp)this.url=e,this.query=void 0;else{var u=e.split("?");this.url=u[0],this.query=u.length>1?a(u[1]):void 0}this.data=i instanceof RegExp?i:a(i),this.method=o,this.andReturn=function(e){this.action=t,this.status=e.status||200,this.contentType=e.contentType,this.response=e.response,this.responseText=e.responseText,this.responseHeaders=e.responseHeaders,this.responseURL=e.responseURL},this.isReturn=function(){return this.action===t},this.andError=function(){this.action=s},this.isError=function(){return this.action===s},this.andTimeout=function(){this.action=n},this.isTimeout=function(){return this.action===n},this.andCallFunction=function(e){this.action=r,this.functionToCall=e},this.isCallFunction=function(){return this.action===r},this.matches=function(e,t,s){var n=!1;if(e=e.toString(),this.url instanceof RegExp)n=this.url.test(e);else{var r=e.split("?"),i=r[0],o=r[1];n=this.url===i&&this.query===a(o)}var u=!1;return u=this.data instanceof RegExp?this.data.test(t):!this.data||this.data===a(t),n&&u&&(!this.method||this.method===s)}}var t=0,s=1,n=2,r=3;return e},t().AjaxRequestTracker=function(){function e(){var e=[];this.track=function(t){e.push(t)},this.first=function(){return e[0]},this.count=function(){return e.length},this.reset=function(){e=[]},this.mostRecent=function(){return e[e.length-1]},this.at=function(t){return e[t]},this.filter=function(t){for(var s=[],n=0;n<e.length;n++)t instanceof RegExp&&t.test(e[n].url)?s.push(e[n]):t instanceof Function&&t(e[n])?s.push(e[n]):e[n].url===t&&s.push(e[n]);return s}}return e},t().AjaxStubTracker=function(){function e(){var e=[];this.addStub=function(t){e.push(t)},this.reset=function(){e=[]},this.findStub=function(t,s,n){for(var r=e.length-1;r>=0;r--){var i=e[r];if(i.matches(t,s,n))return i}}}return e};var s=t(),n=s.ajax(s);return jasmine.Ajax=new n(e),n});
//# sourceMappingURL=mock-ajax.min.js.map