!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],e):"object"==typeof exports?exports.DashShakaPlayback=e(require("Clappr")):t.DashShakaPlayback=e(t.Clappr)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(t,e,i){for(var n=!0;n;){var r=t,a=e,s=i;n=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(s)}var h=Object.getPrototypeOf(r);if(null===h)return;t=h,e=a,i=s,n=!0,o=h=void 0}},u=i(2),h=i(1),c=n(h),l=3e4,f=-1,d=function(t){function e(t){r(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.isReadyState=!1,this._levels=[],t.autoPlay&&this.play()}return a(e,t),s(e,[{key:"name",get:function(){return"dash_shaka_playback"}},{key:"shakaVersion",get:function(){return c["default"].player.Player.version}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(t){var e=this;this._currentLevelId=t;var i=this._currentLevelId===f;this._player.configure({abr:{enable:!i}}),this.trigger(u.Events.PLAYBACK_LEVEL_SWITCH_START),i||this.selectTrack(this.videoTracks.filter(function(t){return t.id===e._currentLevelId})[0]),this.trigger(u.Events.PLAYBACK_LEVEL_SWITCH_END)},get:function(){return this._currentLevelId||f}}]),s(e,[{key:"play",value:function(){return!this._player&&this._setup(),this.isReady?void o(Object.getPrototypeOf(e.prototype),"play",this).call(this):void this.once(u.Events.PLAYBACK_READY,this.play)}},{key:"setupSrc",value:function(){}},{key:"ready",value:function(){}},{key:"error",value:function(t){u.Log.error("an error was raised support=",e.support),u.Log.error("an error was raised by the video tag",t,this.el.error)}},{key:"isHighDefinitionInUse",value:function(){return!!this.highDefinition}},{key:"stop",value:function(){var t=this;clearInterval(this.sendStatsId),this.trigger(u.Events.PLAYBACK_STOP,this.name),this._sendStats(),this._player.unload().then(function(){t._player=null,t.isReadyState=!1})["catch"](function(){u.Log.error("shaka could not be unloaded")})}},{key:"getPlaybackType",value:function(){return(this._player&&this._player.isLive()?"live":"vod")||""}},{key:"selectTrack",value:function(t){this._player.selectTrack(t),this._onAdaptation()}},{key:"destroy",value:function(){var t=this;clearInterval(this.sendStatsId),this._player.destroy().then(function(){return t._destroy()})["catch"](function(){t._destroy(),u.Log.error("shaka could not be destroyed")})}},{key:"_setup",value:function(){var t=this;this._player=this._createPlayer(),this._options.shakaConfiguration&&this._player.configure(this._options.shakaConfiguration);var e=this._player.load(this._options.src);e.then(function(){return t._loaded()})["catch"](function(e){return t._setupError(e)})}},{key:"_createPlayer",value:function(){var t=this,e=new c["default"].Player(this.el);return e.addEventListener("error",function(e,i){return t._error(e,i)}),e.addEventListener("adaptation",function(){return t._onAdaptation()}),e.addEventListener("buffering",function(e){return t._onBuffering(e)}),e}},{key:"_onBuffering",value:function(t){var e=t.buffering?u.Events.PLAYBACK_BUFFERING:u.Events.PLAYBACK_BUFFERFULL;this.trigger(e)}},{key:"_loaded",value:function(){this._ready(),this._startToSendStats(),this._fillLevels()}},{key:"_fillLevels",value:function(){0===this._levels.length&&(this._levels=this.videoTracks.map(function(t){return{id:t.id,label:t.height+"p"}}).reverse(),this.trigger(u.Events.PLAYBACK_LEVELS_AVAILABLE,this.levels))}},{key:"_startToSendStats",value:function(){var t=this;this.sendStatsId=setInterval(function(){return t._sendStats()},l)}},{key:"_sendStats",value:function(){this.trigger(u.Events.PLAYBACK_STATS_ADD,this._player.getStats())}},{key:"_setupError",value:function(t){this._error("error",{detail:t.detail})}},{key:"_error",value:function(t,i){u.Log.error("an error was raised support=",e.support),u.Log.error("an error was raised by shaka player",i.detail),this.trigger(u.Events.PLAYBACK_ERROR,i.detail,this.name)}},{key:"_onAdaptation",value:function(){var t=this.videoTracks.filter(function(t){return t.active===!0})[0];this._fillLevels(),u.Log.debug("an adaptation has happened:",t),this.highDefinition=t.height>=720,this.trigger(u.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(u.Events.PLAYBACK_BITRATE,{bandwidth:t.bandwidth,width:t.width,height:t.height,level:t.id})}},{key:"_destroy",value:function(){o(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.isReadyState=!1,u.Log.debug("shaka was destroyed")}},{key:"_ready",value:function(){o(Object.getPrototypeOf(e.prototype),"_ready",this).call(this)}},{key:"isReady",get:function(){return this.isReadyState}},{key:"textTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"text"===t.type})}},{key:"audioTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"audio"===t.type})}},{key:"videoTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"video"===t.type})}}]),e}(u.HTML5Video);e["default"]=d,d.canPlay=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];c["default"].polyfill.installAll(),c["default"].Player.support().then(function(t){d.support=t});var i=!!window.Promise&&!!window.Uint8Array&&!!Array.prototype.forEach,n=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=i&&n,a=t.split("?")[0].match(/.*\.(.*)$/)||[];return r&&("mpd"===a[1]||e.indexOf("application/dash+xml")>-1)},t.exports=e["default"]},function(t,e,i){var n;!function(){var r={};(function(t){function e(t,e){var i=t.split("."),n=Tn;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||void 0===e?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t){function e(){}var i=Mt;e.prototype=i.prototype,t.Ob=i.prototype,t.prototype=new e,t.prototype.constructor=t,t.Mb=function(t,e,n){return i.prototype[e].apply(t,Array.prototype.slice.call(arguments,2))}}function n(t){this.c=Math.exp(Math.log(.5)/t),this.a=this.b=0}function r(t,e,i){var n=Math.pow(t.c,e);t.b=i*(1-n)+n*t.b,t.a+=e}function a(t){return t.b/(1-Math.pow(t.c,t.a))}function s(){this.a=new n(3),this.c=new n(10),this.b=5e5}function o(t){return.5>t.a.a?t.b:Math.min(a(t.a),a(t.c))}function u(){this.h=null,this.c=!1,this.b=new s,this.g={},this.a={},this.i=!1,this.f=null}function h(t){var e,i={};if((e=t.g.audio)?(e=c(e),e=e[Math.floor(e.length/2)]):e=null,e&&(i.audio=e,t.a.audio=e),e=t.g.video){e=c(e);for(var n=t.a.audio,n=n&&n.bandwidth||0,r=o(t.b),a=e[0],s=0;s<e.length;++s){var u=e[s],h=s+1<e.length?e[s+1]:{bandwidth:Number.POSITIVE_INFINITY};u.bandwidth&&(h=(h.bandwidth+n)/.85,r>=(u.bandwidth+n)/.95&&h>=r&&(a=u))}e=a}else e=null;return e&&(i.video=e,t.a.video=e),t.f=Date.now(),i}function c(t){return t.streams.slice(0).filter(function(t){return t.allowedByApplication&&t.allowedByKeySystem}).sort(function(t,e){return t.bandwidth-e.bandwidth})}function l(){var t,e={basic:!0};for(t in Sn)e[t]=!0;for(t in En)e[t]=!0;return["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"].forEach(function(t){e[t]=!!Sn[t]}),["mpd","m3u8","ism"].forEach(function(t){e[t]=!!En[t]}),e}function f(t){this.h=t,this.c=this.a=Number.POSITIVE_INFINITY,this.b=1,this.g=this.f=0}function d(t,e,i){0!=i.length&&(t.b=i.reduce(function(t,e){return Math.max(t,e.a-e.startTime)},t.b),0==e&&(t.f=Math.max(t.f,i[0].startTime)))}function p(t){return Math.max(Math.min(t.f,b(t)),m(t))}function m(t){return t.c==Number.POSITIVE_INFINITY?0:Math.max(0,b(t)-t.c)}function b(t){return null!=t.h&&t.aa()?Math.min(Math.max(0,(Date.now()+t.g)/1e3-t.b-t.h),t.a):t.a}function y(t,e,i){this.uris=t,this.c=e,this.b=i}function g(t,e,i,n,r,a){this.position=t,this.startTime=e,this.a=i,this.uris=n,this.c=r,this.b=a}function v(t,e){if(!t)return 0;for(var i=0;i<t.length;++i)if(e+1e-4>=t.start(i)&&e<t.end(i))return t.end(i)-e;return 0}function w(t){In.push(t)}function T(t){var e=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),e=new Event(e,t);t.target.dispatchEvent(e)}function S(){return Promise.reject(Error("The key system specified is not supported."))}function E(t){return null==t?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function I(){throw new TypeError("Illegal constructor.")}function k(){throw new TypeError("Illegal constructor.")}function P(t){if(this.c=[],this.b=[],this.X=kn,t)try{t(this.N.bind(this),this.a.bind(this))}catch(e){this.a(e)}}function _(t){var e=new P;return e.N(t),e}function A(t){var e=new P;return e.a(t),e}function N(t){function e(t,e,i){t.X==kn&&(r[e]=i,n++,n==r.length&&t.N(r))}var i=new P;if(!t.length)return i.N([]),i;for(var n=0,r=Array(t.length),a=i.a.bind(i),s=0;s<t.length;++s)t[s]&&t[s].then?t[s].then(e.bind(null,i,s),a):e(i,s,t[s]);return i}function M(t){for(var e=new P,i=e.N.bind(e),n=e.a.bind(e),r=0;r<t.length;++r)t[r]&&t[r].then?t[r].then(i,n):i(t[r]);return e}function R(t,e,i){_n.push(function(){if(i&&"function"==typeof i){try{var t=i(this.ra)}catch(n){return void e.a(n)}var r;try{r=t&&t.then}catch(n){return void e.a(n)}t instanceof P?t==e?e.a(new TypeError("Chaining cycle detected")):t.then(e.N.bind(e),e.a.bind(e)):r?O(t,r,e):e.N(t)}else 1==this.X?e.N(this.ra):e.a(this.ra)}.bind(t)),null==Pn&&(Pn=D(x))}function O(t,e,i){try{var n=!1;e.call(t,function(t){if(!n){n=!0;var e;try{e=t&&t.then}catch(r){return void i.a(r)}e?O(t,e,i):i.N(t)}},i.a.bind(i))}catch(r){i.a(r)}}function x(){for(;_n.length;){null!=Pn&&(C(Pn),Pn=null);var t=_n;_n=[];for(var e=0;e<t.length;++e)t[e]()}}function D(){return 0}function C(){}function L(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function j(t,e,i){for(var n=0;n<t.length;++n)if(i(t[n],e))return n;return-1}function U(t,e,i){this.category=t,this.code=e,this.data=Array.prototype.slice.call(arguments,2)}function B(t){this.b=t,this.c=0==Nn,this.a=0}function F(t){return t.a<t.b.byteLength}function K(t){try{var e=t.b.getUint8(t.a)}catch(i){G()}return t.a+=1,e}function V(t){try{var e=t.b.getUint32(t.a,t.c)}catch(i){G()}return t.a+=4,e}function q(t){var e,i;try{t.c?(e=t.b.getUint32(t.a,!0),i=t.b.getUint32(t.a+4,!0)):(i=t.b.getUint32(t.a,!1),e=t.b.getUint32(t.a+4,!1))}catch(n){G()}if(i>2097151)throw new U(3,3001);return t.a+=8,i*Math.pow(2,32)+e}function H(t){t.a+16>t.b.byteLength&&G();var e=new Uint8Array(t.b.buffer,t.a,16);return t.a+=16,e}function Y(t,e){t.a+e>t.b.byteLength&&G(),t.a+=e}function G(){throw new U(3,3e3)}function z(t){this.b=t,this.a=new B(t),An||(An=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function W(t){var e;if(e=$(t),7<e.length)throw new U(3,3002);for(var i=0,n=0;n<e.length;n++)i=256*i+e[n];e=i,i=$(t);t:{for(n=0;n<An.length;n++)if(ne(i,An[n])){n=!0;break t}n=!1}if(n)i=t.b.byteLength-t.a.a;else{if(8==i.length&&224&i[1])throw new U(3,3001);for(var n=i[0]&(1<<8-i.length)-1,r=1;r<i.length;r++)n=256*n+i[r];i=n}return i=t.a.a+i<=t.b.byteLength?i:t.b.byteLength-t.a.a,n=new DataView(t.b.buffer,t.b.byteOffset+t.a.a,i),Y(t.a,i),new J(e,n)}function $(t){var e,i=K(t.a);for(e=1;8>=e&&!(i&1<<8-e);e++);if(e>8)throw new U(3,3002);var n=new Uint8Array(e);for(n[0]=i,i=1;e>i;i++)n[i]=K(t.a);return n}function J(t,e){this.id=t,this.a=e}function X(t){if(8<t.a.byteLength)throw new U(3,3002);if(8==t.a.byteLength&&224&t.a.getUint8(0))throw new U(3,3001);for(var e=0,i=0;i<t.a.byteLength;i++)var n=t.a.getUint8(i),e=256*e+n;return e}function Z(e,i){var n,r=i||{};for(n in r)this[n]=r[n];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=t.performance?t.performance.now():Date.now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function Q(t,e){return t.reduce(function(t,e,i){return e["catch"](t.bind(null,i))}.bind(null,e),Promise.reject())}function tt(t,e){return t.concat(e)}function et(){}function it(t){return null!=t}function nt(t){return function(e){return e!=t}}function rt(t){this.a=t}function at(t,e){for(var i=[],n=0,r=0;n<t.a.length&&r<e.length;){var a=t.a[n],s=e[r];a.startTime<s.startTime?(i.push(a),n++):(a.startTime>s.startTime||(.1<Math.abs(a.a-s.a)?i.push(s):i.push(a),n++),r++)}for(;n<t.a.length;)i.push(t.a[n++]);if(i.length)for(n=i[i.length-1].position+1;r<e.length;)s=e[r++],s=new g(n++,s.startTime,s.a,s.uris,s.c,s.b),i.push(s);else i=e;t.a=i}function st(t,e){for(var i=0;i<t.a.length&&!(t.a[i].a>e);++i);t.a.splice(0,i)}function ot(t,e){this.g=Mn[e],this.c=t,this.h=0,this.f=Number.POSITIVE_INFINITY,this.a=this.b=null}function ut(t,e,i,n){var r=t.h;return i+=r,n+=r,Promise.resolve().then(function(){for(var t=this.g(e),a=0;a<t.length&&(t[a].startTime+=r,t[a].endTime+=r,!(t[a].startTime>=this.f));++a)this.c.addCue(t[a]);null==this.b&&(this.b=i),this.a=Math.min(n,this.f)}.bind(t))}function ht(t,e,i){return Promise.resolve().then(function(){lt(this,function(t){return!(t.startTime>=i||t.endTime<=e)}),null==this.b||i<=this.b||e>=this.a||(e<=this.b&&i>=this.a?this.b=this.a=null:e<=this.b&&i<this.a?this.b=i:e>this.b&&i>=this.a&&(this.a=e))}.bind(t))}function ct(t,e){return null==t.a||t.a<e||e<t.b?0:t.a-e}function lt(t,e){for(var i=t.c.cues,n=[],r=0;r<i.length;++r)e(i[r])&&n.push(i[r]);for(r=0;r<n.length;++r)t.c.removeCue(n[r])}function ft(t){t=t.toLowerCase().split("-");var e=Rn[t[0]];return e&&(t[0]=e),t.join("-")}function dt(t){return Object.keys(t).map(function(e){return t[e]})}function pt(t,e){return Object.keys(t).reduce(function(i,n){return i[n]=e(t[n],n),i},{})}function mt(t,e){return Object.keys(t).reduce(function(i,n){return e(n,t[n])&&(i[n]=t[n]),i},{})}function bt(){this.a={}}function yt(t,e,i){if(t=t.a[e])for(e=0;e<t.length;++e)t[e]==i&&(t.splice(e,1),--e)}function gt(){this.a=new bt}function vt(t,e,i,n){e=new Tt(e,i,n),t.a.push(i,e)}function wt(t){var e,i=t.a,n=[];for(e in i.a)n.push.apply(n,i.a[e]);for(i=0;i<n.length;++i)n[i].Y();t.a.clear()}function Tt(t,e,i){this.target=t,this.type=e,this.a=i,this.target.addEventListener(e,i,!1)}function St(t,e,i,n,r,a){this.a=t,this.c=e,this.i=i,this.o=n,this.l=r,this.m=a,this.b=new gt,this.h=!1,this.g=1,this.f=null,0<t.readyState?this.Ia():vt(this.b,t,"loadedmetadata",this.Ia.bind(this)),vt(this.b,t,"ratechange",this.cb.bind(this))}function Et(t){return 0<t.a.readyState?Nt(t,t.a.currentTime):It(t)}function It(t){return t.o?Nt(t,t.o):t.c.a<Number.POSITIVE_INFINITY?p(t.c):Math.max(b(t.c)-t.i,p(t.c))}function kt(t,e){e!=t.h&&(t.h=e,Pt(t,t.g),t.l(e))}function Pt(e,i){null!=e.f&&(t.clearInterval(e.f),e.f=null),e.g=i,e.a.playbackRate=e.h||0>i?0:i,!e.h&&0>i&&(e.f=t.setInterval(function(){this.a.currentTime+=i/4}.bind(e),250))}function _t(t,e){var i=t.c,n=p(i),r=b(i);return i.aa()&&i.c!=Number.POSITIVE_INFINITY?(i=n+1,n=i+t.i,e>=n&&r>=e||0!=v(t.a.buffered,e)&&e>=i&&r>=e?e:e>r?r:n>r&&e>=i&&r>=e?e:Math.min(n+2,r)):n>e?n:e>r?r:e}function At(t,e,i){t.a.currentTime=i;var n=0,r=function(){!this.a||10<=n++||this.a.currentTime!=e||(this.a.currentTime=i,setTimeout(r,100))}.bind(t);setTimeout(r,100)}function Nt(t,e){var i=p(t.c);return i>e?i:(i=b(t.c),e>i?i:e)}function Mt(){this.w=new bt}function Rt(){var t,e,i=new Promise(function(i,n){t=i,e=n});return i.resolve=t,i.reject=e,i}function Ot(t,e,i){this.i=t,this.f=e,this.l=i,this.c={},this.b=null,this.a={},this.g=new gt,this.h=!1}function xt(){var e={basic:!!t.MediaSource},i=navigator.vendor,n=navigator.appVersion;return i&&0<=i.indexOf("Apple")&&n&&0<=n.indexOf("Version/8")&&(e.basic=!1),e.basic&&'video/mp4; codecs="avc1.42E01E",audio/mp4; codecs="mp4a.40.2",video/webm; codecs="vp8",video/webm; codecs="vp9",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="mp4a.40.2",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").forEach(function(t){e[t]=!!Mn[t]||MediaSource.isTypeSupported(t);var i=t.split(";")[0];e[i]=e[i]||e[t]}),e}function Dt(t,e){var i;return i="text"==e?t.b.b:(i=t.c[e].buffered)&&i.length?i.start(0):null}function Ct(t,e,i){return"text"==e?(e=ct(t.b,i),e||(e=ct(t.b,i+.1))&&(e+=.1)):(t=t.c[e].buffered,e=v(t,i),e||(e=v(t,i+.1))&&(e+=.1)),e}function Lt(t,e,i,n,r){return"text"==e?ut(t.b,i,n,r):Kt(t,e,t.Fb.bind(t,e,i))}function jt(t,e,i,n){return"text"==e?ht(t.b,i,n):Kt(t,e,t.La.bind(t,e,i,n))}function Ut(t,e,i){return"text"==e?(t.b.h=i,Promise.resolve()):Kt(t,e,t.yb.bind(t,e,i))}function Bt(t,e,i){return"text"==e?(t.b.f=i,Promise.resolve()):Kt(t,e,t.wb.bind(t,e,i))}function Ft(t,e){Vt(t,function(){this.f.duration=e}.bind(t))}function Kt(t,e,i){if(t.h)return Promise.reject();if(i={start:i,p:new Rt},t.a[e].push(i),1==t.a[e].length)try{i.start()}catch(n){i.p.reject(new U(3,3015,n)),qt(t,e)}return i.p}function Vt(t,e){if(t.h)return Promise.reject();var i,n=[];for(i in t.c){var r=new Rt,a={start:function(t){t.resolve()}.bind(null,r),p:r};t.a[i].push(a),n.push(r),1==t.a[i].length&&a.start()}return Promise.all(n).then(function(){var t,i;try{e()}catch(n){i=Promise.reject(new U(3,3015,n))}for(t in this.c)qt(this,t);return i}.bind(t),function(){return Promise.reject()}.bind(t))}function qt(t,e){t.a[e].shift();var i=t.a[e][0];if(i)try{i.start()}catch(n){i.p.reject(new U(3,3015,n)),qt(t,e)}}function Ht(t){if(!t)return"";t=Wt(new Uint8Array(t)),t=escape(t);try{return decodeURIComponent(t)}catch(e){throw new U(2,2004)}}function Yt(t,e){if(!t)return"";if(0!=t.byteLength%2)throw new U(2,2004);var i;if(t instanceof ArrayBuffer)i=t;else{var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(t)),i=n.buffer}var n=t.byteLength/2,r=new Uint16Array(n);i=new DataView(i);for(var a=0;n>a;a++)r[a]=i.getUint16(2*a,e);return Wt(r)}function Gt(t){var e=new Uint8Array(t);if(239==e[0]&&187==e[1]&&191==e[2])return Ht(e.subarray(3));if(254==e[0]&&255==e[1])return Yt(e.subarray(2),!1);if(255==e[0]&&254==e[1])return Yt(e.subarray(2),!0);var i=function(t,e){return t.byteLength<=e||32<=t[e]&&126>=t[e]}.bind(null,e);if(0==e[0]&&0==e[2])return Yt(t,!1);if(0==e[1]&&0==e[3])return Yt(t,!0);if(i(0)&&i(1)&&i(2)&&i(3))return Ht(t);throw new U(2,2003)}function zt(t){t=unescape(encodeURIComponent(t));for(var e=new Uint8Array(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e.buffer}function Wt(t){for(var e="",i=0;i<t.length;i+=16e3)e+=String.fromCharCode.apply(null,t.subarray(i,i+16e3));return e}function $t(t){this.b=t,this.a=0}function Jt(t,e){var i;return e.lastIndex=t.a,i=e.exec(t.b),i=null==i?null:{position:i.index,length:i[0].length,tb:i},t.a==t.b.length||null==i||i.position!=t.a?null:(t.a+=i.length,i.tb)}function Xt(t){return t.a==t.b.length?null:(t=Jt(t,/[^ \t\n]*/gm))?t[0]:null}function Zt(t){if(t=Gt(t),t=t.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n"),t=t.split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(t[0]))throw new U(2,2e3);for(var e=[],i=1;i<t.length;i++){var n=Zt.b(t[i].split("\n"));n&&e.push(n)}return e}function Qt(e){return t.btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=*$/,"")}function te(e){e=t.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var i=new Uint8Array(e.length),n=0;n<e.length;++n)i[n]=e.charCodeAt(n);return i}function ee(e){for(var i=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)i[n/2]=t.parseInt(e.substr(n,2),16);return i}function ie(t){for(var e="",i=0;i<t.length;++i){var n=t[i].toString(16);1==n.length&&(n="0"+n),e+=n}return e}function ne(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!=e[i])return!1;return!0}function re(t,e,i){this.l="",this.m=null,this.o=[],this.h=this.i=null,this.u=!1,this.c=new gt,this.w="",this.a=[],this.A=t,this.f=null,this.g=e,this.F=i,this.b=!1}function ae(t,e){if(!t.i)return vt(t.c,e,"encrypted",function(){this.c.Y(e,"encrypted"),this.g(new U(6,6010))}.bind(t)),Promise.resolve();var i=[],n=[],r=[];ce(t,i,n,r),t.w=i[0],t.h=e;var i=t.h.setMediaKeys(t.i),i=i["catch"](function(t){return Promise.reject(new U(6,6003,t.message))}),a=null;return n.length&&(a=t.i.setServerCertificate(n[0]),a=a["catch"](function(t){return Promise.reject(new U(6,6004,t.message))})),vt(t.c,t.h,"waitingforkey",t.hb.bind(t)),Promise.all([i,a]).then(function(){return this.b?Promise.reject():void(r.length?r.forEach(function(t){le(this,t.initDataType,t.initData)}.bind(this)):vt(this.c,this.h,"encrypted",this.Ya.bind(this)))}.bind(t))["catch"](function(t){return this.b?Promise.resolve():Promise.reject(t)}.bind(t))}function se(t,e,i,n,r){var a=he(t);e.periods.forEach(function(t){t.streamSets.forEach(function(t){"text"!=t.type&&(a&&(t.drmInfos=[a]),t.drmInfos.forEach(function(e){ue(this,e);var a=n[e.keySystem];a||(a={initDataTypes:void 0,audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:i?"required":"optional",sessionTypes:[i?"persistent-license":"temporary"],label:e.keySystem,drmInfos:[]},n[e.keySystem]=a,r.push(e.keySystem)),a.drmInfos.push(e),e.distinctiveIdentifierRequired&&(a.distinctiveIdentifier="required"),e.persistentStateRequired&&(a.persistentState="required");var s="video"==t.type?a.videoCapabilities:a.audioCapabilities,o=("video"==t.type?e.videoRobustness:e.audioRobustness)||"";t.streams.forEach(function(t){var i=t.mimeType;t.codecs&&(i+='; codecs="'+t.codecs+'"'),"com.microsoft.playready"==e.keySystem&&s.length||s.push({robustness:o,contentType:i})}.bind(this))}.bind(this)))}.bind(this))}.bind(t))}function oe(t,e,i){var n=new Rt,r=n;return 1==i.length&&""==i[0]?Promise.reject(new U(6,6e3)):(i.forEach(function(t){var i=e[t];i.drmInfos.some(function(t){return!!t.licenseServerUri})&&(0==i.audioCapabilities.length&&(i.audioCapabilities=void 0),0==i.videoCapabilities.length&&(i.videoCapabilities=void 0),r=r["catch"](function(){return this.b?Promise.reject():navigator.requestMediaKeySystemAccess(t,[i])}.bind(this)))}.bind(t)),r=r["catch"](function(){return Promise.reject(new U(6,6001))}),r=r.then(function(t){if(this.b)return Promise.reject();var i=t.getConfiguration();return this.m=(i.audioCapabilities||[]).concat(i.videoCapabilities||[]).map(function(t){return t.contentType}),0==this.m.length&&(this.m=null),this.o=e[t.keySystem].drmInfos,this.l=t.keySystem,t.createMediaKeys()}.bind(t)).then(function(t){return this.b?Promise.reject():(this.i=t,void(this.u=!0))}.bind(t))["catch"](function(t){return this.b?Promise.resolve():t instanceof U?Promise.reject(t):(this.l="",this.o=[],this.m=null,Promise.reject(new U(6,6002,t.message)))}.bind(t)),n.reject(),r)}function ue(t,e){var i=e.keySystem;if(i){if(!e.licenseServerUri){var n=t.f.servers[i];n&&(e.licenseServerUri=n)}(i=t.f.advanced[i])&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=i.persistentStateRequired),e.videoRobustness||(e.videoRobustness=i.videoRobustness),e.audioRobustness||(e.audioRobustness=i.audioRobustness),e.serverCertificate||(e.serverCertificate=i.serverCertificate))}}function he(e){var i=e.f.clearKeys;if(!i||0==Object.keys(i).length)return null;var n,r=[],i=[];for(n in e.f.clearKeys){var a=e.f.clearKeys[n],s=ee(n),a=ee(a),s={kty:"oct",kid:Qt(s),k:Qt(a)};r.push(s),i.push(s.kid)}return e=JSON.stringify({keys:r}),i=JSON.stringify({kids:i}),i=[{initData:new Uint8Array(zt(i)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+t.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:i}}function ce(t,e,i,n){function r(t,e){return t.initDataType==e.initDataType&&ne(t.initData,e.initData)}t.o.forEach(function(t){-1==e.indexOf(t.licenseServerUri)&&e.push(t.licenseServerUri),t.serverCertificate&&-1==j(i,t.serverCertificate,ne)&&i.push(t.serverCertificate),t.initData&&t.initData.forEach(function(t){-1==j(n,t,r)&&n.push(t)})})}function le(t,e,i){var n;try{n=t.i.createSession()}catch(r){return void t.g(new U(6,6005,r.message))}vt(t.c,n,"message",t.fb.bind(t)),vt(t.c,n,"keystatuseschange",t.Za.bind(t)),e=n.generateRequest(e,i.buffer),t.a.push({initData:i,pa:n,loaded:!1}),e["catch"](function(t){if(!this.b){for(var e=0;e<this.a.length;++e)if(this.a[e].pa==n){this.a.splice(e,1);break}this.g(new U(6,6006,t.message))}}.bind(t))}function fe(t){for(var e=Yt(t.body,!0),e=(new DOMParser).parseFromString(e,"application/xml"),i=e.getElementsByTagName("HttpHeader"),n=0;n<i.length;++n)t.headers[i[n].querySelector("name").textContent]=i[n].querySelector("value").textContent;t.body=te(e.querySelector("Challenge").textContent).buffer}function de(){var e={basic:!!(t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration)},i=[];return e.basic&&"org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").forEach(function(t){var n=navigator.requestMediaKeySystemAccess(t,[{}]).then(function(){e[t]=!0},function(){e[t]=!1});i.push(n)}),Promise.all(i).then(function(){return e})}function pe(t,e){try{var i=new be(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function me(t){var e=this.mediaKeys;return e&&e!=t&&ge(e,null),delete this.mediaKeys,(this.mediaKeys=t)&&ge(t,this),Promise.resolve()}function be(t,e){this.a=this.keySystem=t;var i=!0;"org.w3.clearkey"==t&&(this.a="webkit-org.w3.clearkey",i=!1);var n,r=!1;n=document.getElementsByTagName("video"),n=n.length?n[0]:document.createElement("video");for(var a=0;a<e.length;++a){var s=e[a],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:s.initDataTypes,sessionTypes:["temporary"],label:s.label},u=!1;if(s.audioCapabilities)for(var h=0;h<s.audioCapabilities.length;++h){var c=s.audioCapabilities[h];c.contentType&&(u=!0,n.canPlayType(c.contentType.split(";")[0],this.a)&&(o.audioCapabilities.push(c),r=!0))}if(s.videoCapabilities)for(h=0;h<s.videoCapabilities.length;++h)c=s.videoCapabilities[h],c.contentType&&(u=!0,n.canPlayType(c.contentType,this.a)&&(o.videoCapabilities.push(c),r=!0));if(u||(r=n.canPlayType("video/mp4",this.a)||n.canPlayType("video/webm",this.a)),"required"==s.persistentState&&(i?(o.persistentState="required",o.sessionTypes=["persistent-license"]):r=!1),r)return void(this.b=o)}throw i="Unsupported keySystem","org.w3.clearkey"!=t&&"com.widevine.alpha"!=t||(i="None of the requested configurations were supported."),i=Error(i),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function ye(t){this.g=t,this.b=null,this.a=new gt,this.c=[],this.f={}}function ge(t,e){t.b=e,wt(t.a),e&&(vt(t.a,e,"webkitneedkey",t.lb.bind(t)),vt(t.a,e,"webkitkeymessage",t.kb.bind(t)),vt(t.a,e,"webkitkeyadded",t.ib.bind(t)),vt(t.a,e,"webkitkeyerror",t.jb.bind(t)))}function ve(t,e){var i=t.f[e];return i?i:(i=t.c.shift())?(i.sessionId=e,t.f[e]=i):null}function we(t,e,i){this.w=new bt,this.f=t,this.h=!1,this.a=this.b=null,this.c=e,this.g=i,this.sessionId="",this.expiration=NaN,this.closed=new Rt,this.keyStatuses=new Ee}function Te(t,e,i){if(t.h)return Promise.reject(Error("The session is already initialized."));t.h=!0;var n;try{if("persistent-license"==t.g)if(i)n=new Uint8Array(zt("LOAD_SESSION|"+i));else{var r=zt("PERSISTENT|"),a=new Uint8Array(r.byteLength+e.byteLength);a.set(new Uint8Array(r),0),a.set(new Uint8Array(e),r.byteLength),n=a}else n=new Uint8Array(e)}catch(s){return Promise.reject(s)}t.b=new Rt;try{t.f.webkitGenerateKeyRequest(t.c,n)}catch(s){if("InvalidStateError"!=s.name)return t.b=null,Promise.reject(s);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,n)}catch(t){this.b.reject(t),this.b=null}}.bind(t),10)}return t.b}function Se(t,e){t.keyStatuses.Aa(e),t.dispatchEvent(new Z("keystatuseschange"))}function Ee(){this.size=0,this.a=void 0}function Ie(t){for(this.systemIds=[],this.cencKeyIds=[],this.a=[],t=new B(new DataView(t.buffer));F(t);){var e=t.a,i=V(t),n=V(t);if(1==i?i=q(t):0==i&&(i=t.b.byteLength-e),1886614376!=n)Y(t,i-(t.a-e));else{var r=K(t);if(r>1)Y(t,i-(t.a-e));else{Y(t,3);var n=ie(H(t)),a=[];if(r>0)for(var r=V(t),s=0;r>s;++s){var o=ie(H(t));a.push(o)}r=V(t),Y(t,r),this.cencKeyIds.push.apply(this.cencKeyIds,a),this.systemIds.push(n),this.a.push({start:e,end:t.a-1}),t.a!=e+i&&Y(t,i-(t.a-e))}}}}function ke(t,e){try{var i=new Pe(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function Pe(t,e){this.keySystem=t;for(var i=!1,n=0;n<e.length;++n){var r=e[n],a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label},s=!1;if(r.audioCapabilities)for(var o=0;o<r.audioCapabilities.length;++o){var u=r.audioCapabilities[o];if(u.contentType){var s=!0,h=u.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,h)&&(a.audioCapabilities.push(u),i=!0)}}if(r.videoCapabilities)for(o=0;o<r.videoCapabilities.length;++o)u=r.videoCapabilities[o],u.contentType&&(s=!0,h=u.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,h)&&(a.videoCapabilities.push(u),i=!0));if(s||(i=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(a.persistentState="required",a.sessionTypes=["persistent-license"]),i)return void(this.a=a)}throw i=Error("Unsupported keySystem"),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function _e(t){var e=this.mediaKeys;return e&&e!=t&&Ne(e,null),delete this.mediaKeys,(this.mediaKeys=t)?Ne(t,this):Promise.resolve()}function Ae(t){this.a=new MSMediaKeys(t),this.b=new gt}function Ne(t,e){function i(){e.msSetMediaKeys(n.a),e.removeEventListener("loadedmetadata",i)}if(wt(t.b),!e)return Promise.resolve();vt(t.b,e,"msneedkey",Re);var n=t;try{return 1<=e.readyState?e.msSetMediaKeys(t.a):e.addEventListener("loadedmetadata",i),Promise.resolve()}catch(r){return Promise.reject(r)}}function Me(t){this.w=new bt,this.c=null,this.g=t,this.b=this.a=null,this.f=new gt,this.sessionId="",this.expiration=NaN,this.closed=new Rt,this.keyStatuses=new De}function Re(t){var e=document.createEvent("CustomEvent");if(e.initCustomEvent("encrypted",!1,!1,null),e.initDataType="cenc",t=t.initData){var i=new Ie(t);if(!(1>=i.a.length)){for(var n=[],r=0;r<i.a.length;r++)n.push(t.subarray(i.a[r].start,i.a[r].end+1));for(r=Oe,t=[],i=0;i<n.length;++i){for(var a=!1,s=0;s<t.length&&!(a=r?r(n[i],t[s]):n[i]===t[s]);++s);a||t.push(n[i])}for(r=n=0;r<t.length;r++)n+=t[r].length;for(n=new Uint8Array(n),r=i=0;r<t.length;r++)n.set(t[r],i),i+=t[r].length;t=n}}e.initData=t,this.dispatchEvent(e)}function Oe(t,e){return ne(t,e)}function xe(t,e){t.keyStatuses.Aa(e),
t.dispatchEvent(new Z("keystatuseschange"))}function De(){this.size=0,this.a=void 0}function Ce(t,e){var i=Le(t,e);return 1!=i.length?null:i[0]}function Le(t,e){return Array.prototype.filter.call(t.childNodes,function(t){return t.tagName==e})}function je(t){return(t=t.firstChild)&&t.nodeType==Node.TEXT_NODE?t.nodeValue.trim():null}function Ue(t,e,i,n){var r=null;return t=t.getAttribute(e),null!=t&&(r=i(t)),null==r?void 0!==n?n:null:r}function Be(t){return t?(t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null}function Fe(t){return t&&(t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(t))?(t=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(t)?t:null):null}function Ke(t){var e=/([0-9]+)-([0-9]+)/.exec(t);return e?(t=Number(e[1]),isFinite(t)?(e=Number(e[2]),isFinite(e)?{start:t,end:e}:null):null):null}function Ve(t){return t=Number(t),0===t%1?t:null}function qe(t){return t=Number(t),0===t%1&&t>0?t:null}function He(t){return t=Number(t),0===t%1&&t>=0?t:null}function Ye(t,e){var i=$e(t),n=null,r=i.filter(function(t){return"urn:mpeg:dash:mp4protection:2011"==t.Ma?(n=t.init||n,!1):!0}),a=i.map(function(t){return t.keyId}).filter(it),s=null;if(0<a.length&&(s=a[0],a.some(nt(s))))throw new U(4,4010);return a=[],0<r.length?(a=We(n,e,r),0==a.length&&(a=[ze("",n)])):0<i.length&&(a=dt(Dn).map(function(t){return ze(t,n)})),{Ga:s,Nb:n,drmInfos:a,Ha:!0}}function Ge(t,e,i){var n=Ye(t,e);if(i.Ha)t=1==i.drmInfos.length&&!i.drmInfos[0].keySystem,e=0==n.drmInfos.length,(0==i.drmInfos.length||t&&!e)&&(i.drmInfos=n.drmInfos),i.Ha=!1;else if(0<n.drmInfos.length&&(i.drmInfos=i.drmInfos.filter(function(t){return n.drmInfos.some(function(e){return e.keySystem==t.keySystem})}),0==i.drmInfos.length))throw new U(4,4008);return n.Ga||i.Ga}function ze(t,e){return{keySystem:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:e||[]}}function We(t,e,i){return i.map(function(i){var n=Dn[i.Ma];return n?[ze(n,i.init||t)]:e(i.node)||[]}).reduce(tt,[])}function $e(t){return t.map(function(t){var e=t.getAttribute("schemeIdUri"),i=t.getAttribute("cenc:default_KID"),n=Le(t,"cenc:pssh").map(je);if(!e)return null;if(e=e.toLowerCase(),i&&(i=i.replace(/-/g,"").toLowerCase(),0<=i.indexOf(" ")))throw new U(4,4009);var r=[];try{r=n.map(function(t){return{initDataType:"cenc",initData:te(t)}})}catch(a){throw new U(4,4007)}return{node:t,Ma:e,keyId:i,init:0<r.length?r:null}}).filter(it)}function Je(t){var e;t instanceof Je?(Xe(this,t.K),this.Z=t.Z,this.M=t.M,Ze(this,t.ca),this.H=t.H,ti(this,ai(t.a)),this.V=t.V):t&&(e=String(t).match(Cn))?(Xe(this,e[1]||"",!0),this.Z=ei(e[2]||""),this.M=ei(e[3]||"",!0),Ze(this,e[4]),this.H=ei(e[5]||"",!0),ti(this,e[6]||"",!0),this.V=ei(e[7]||"")):this.a=new ri(null)}function Xe(t,e,i){t.K=i?ei(e,!0):e,t.K&&(t.K=t.K.replace(/:$/,""))}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.ca=e}else t.ca=null}function Qe(t){return t.H}function ti(t,e,i){e instanceof ri?t.a=e:(i||(e=ii(e,Bn)),t.a=new ri(e))}function ei(t,e){return t?e?decodeURI(t):decodeURIComponent(t):""}function ii(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,ni),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ni(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(15&t).toString(16)}function ri(t){this.b=t||null}function ai(t){var e=new ri;if(e.b=t.b,t.a){var i,n={};for(i in t.a)n[i]=t.a[i].concat();e.a=n,e.c=t.c}return e}function si(e,i,n,r,a){null!==a&&(a=Math.round(a));var s={RepresentationID:i,Number:n,Bandwidth:r,Time:a};return e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(e,i,n){if("$$"==e)return"$";var r=s[i];return null==r?e:("RepresentationID"==i&&n&&(n=void 0),e=r.toString(),n=t.parseInt(n,10)||1,Array(Math.max(0,n-e.length)+1).join("0")+e)})}function oi(t,e){if(0!=e.length){var i=e[0];i.startTime<=Kn&&(e[0]=new g(i.position,0,i.a,i.uris,i.c,i.b)),null!=t&&t!=Number.POSITIVE_INFINITY&&(i=e[e.length-1],i.startTime>t||(e[e.length-1]=new g(i.position,i.startTime,t,i.uris,i.c,i.b)))}}function ui(t,e){if(0==e.length)return t;var i=e.map(function(t){return new Je(t)});return t.map(function(t){return new Je(t)}).map(function(t){return i.map(t.resolve.bind(t))}).reduce(tt,[]).map(function(t){return t.toString()})}function hi(t,e){var i=ci(t,e,"timescale"),n=1;i&&(n=qe(i)||1),i=ci(t,e,"duration"),(i=qe(i||""))&&(i/=n);var r=ci(t,e,"startNumber"),a=ci(t,e,"presentationTimeOffset"),s=He(r||"");null!=r&&null!=s||(s=1);var o=li(t,e,"SegmentTimeline"),r=null;if(o){for(var r=n,u=Number(a),h=t.C.duration||Number.POSITIVE_INFINITY,o=Le(o,"S"),c=[],l=0,f=0;f<o.length;++f){var d=o[f],p=Ue(d,"t",He),m=Ue(d,"d",He),d=Ue(d,"r",Ve);if(null!=p&&(p-=u),!m)break;if(p=null!=p?p:l,d=d||0,0>d)if(f+1<o.length){if(d=Ue(o[f+1],"t",He),null==d)break;if(p>=d)break;d=Math.ceil((d-p)/m)-1}else{if(h==Number.POSITIVE_INFINITY)break;if(p/r>=h)break;d=Math.ceil((h*r-p)/m)-1}0<c.length&&p!=l&&(c[c.length-1].end=p/r);for(var b=0;d>=b;++b)l=p+m,c.push({start:p/r,end:l/r}),p=l}r=c}return{qa:n,L:i,ja:s,presentationTimeOffset:Number(a)/n||0,I:r}}function ci(t,e,i){return[e(t.j),e(t.v),e(t.B)].filter(it).map(function(t){return t.getAttribute(i)}).reduce(function(t,e){return t||e})}function li(t,e,i){return[e(t.j),e(t.v),e(t.B)].filter(it).map(function(t){return Ce(t,i)}).reduce(function(t,e){return t||e})}function fi(t,e){var i=li(t,e,"Initialization");if(!i)return null;var n=t.j.G,r=i.getAttribute("sourceURL");r&&(n=ui(t.j.G,[r]));var r=0,a=null;return(i=Ue(i,"range",Ke))&&(r=i.start,a=i.end),new y(n,r,a)}function di(t,e){var i,n=ci(t,mi,"presentationTimeOffset"),r=fi(t,mi);i=Number(n);var a=t.j.mimeType.split("/")[1];if("text"!=t.j.contentType&&"mp4"!=a&&"webm"!=a)throw new U(4,4006);if("webm"==a&&!r)throw new U(4,4005);var s=li(t,mi,"RepresentationIndex"),o=ci(t,mi,"indexRange"),u=t.j.G,o=Ke(o||"");if(s){var h=s.getAttribute("sourceURL");h&&(u=ui(t.j.G,[h])),o=Ue(s,"range",Ke,o)}if(!o)throw new U(4,4002);return i=pi(t,e,r,u,o.start,o.end,a,i),{createSegmentIndex:i.createSegmentIndex,findSegmentPosition:i.findSegmentPosition,getSegmentReference:i.getSegmentReference,initSegmentReference:r,presentationTimeOffset:Number(n)||0}}function pi(t,e,i,n,r,a,s,o){var u=t.presentationTimeline,h=t.C.start,c=t.C.duration,l=e,f=null;return{createSegmentIndex:function(){var t=[l(n,r,a),"webm"==s?l(i.uris,i.c,i.b):null];return l=null,Promise.all(t).then(function(t){var e,i,a,l=t[0];t=t[1]||null;var p=null;if("mp4"==s){t=[];var p=new B(new DataView(l)),m=V(p);if(1936286840!=V(p))throw new U(3,3004);if(1==m&&(m=q(p)),l=K(p),Y(p,3),Y(p,4),e=V(p),0==e)throw new U(3,3005);var b;0==l?(i=V(p),b=V(p)):(i=q(p),b=q(p)),Y(p,2);try{var y=p.b.getUint16(p.a,p.c)}catch(v){G()}for(p.a+=2,l=y,y=i-o,m=r+m+b,b=0;l>b;b++){a=V(p),i=(2147483648&a)>>>31,a&=2147483647;var w=V(p);if(Y(p,4),1==i)throw new U(3,3006);t.push(new g(t.length,y/e,(y+w)/e,n,m,m+a-1)),y+=w,m+=a}p=t}else{if(t=new z(new DataView(t)),440786851!=W(t).id)throw new U(3,3008);if(p=W(t),408125543!=p.id)throw new U(3,3009);for(t=p.a.byteOffset,p=new z(p.a),e=null;F(p.a);)if(y=W(p),357149030==y.id){e=y;break}if(!e)throw new U(3,3010);for(p=new z(e.a),e=1e6,y=null;F(p.a);)if(m=W(p),2807729==m.id)e=X(m);else if(17545==m.id)if(y=m,4==y.a.byteLength)y=y.a.getFloat32(0);else{if(8!=y.a.byteLength)throw new U(3,3003);y=y.a.getFloat64(0)}if(null==y)throw new U(3,3011);if(p=e/1e9,e=y*p,y=W(new z(new DataView(l))),475249515!=y.id)throw new U(3,3007);for(l=[],y=new z(y.a),b=m=-1;F(y.a);)if(i=W(y),187==i.id){if(a=new z(i.a),i=W(a),179!=i.id)throw new U(3,3013);if(i=X(i),a=W(a),183!=a.id)throw new U(3,3012);for(w=new z(a.a),a=0;F(w.a);){var T=W(w);if(241==T.id){a=X(T);break}}i=p*(i-o),a=t+a,m>=0&&l.push(new g(l.length,m,i,n,b,a-1)),m=i,b=a}m>=0&&l.push(new g(l.length,m,e,n,b,null)),p=l}oi(c,p),d(u,h,p),f=new rt(p)})},findSegmentPosition:function(t){return f.b(t)},getSegmentReference:function(t){return f.get(t)}}}function mi(t){return t.ha}function bi(t,e){var i,n,r,a,s,o=fi(t,yi),u=gi(t);if(s=hi(t,yi),r=s.ja,0===r&&(r=1),a=0,s.L?a=s.L*(r-1)-s.presentationTimeOffset:s.I&&0<s.I.length&&(a=s.I[0].start),i=s.L,n=a,a=s.presentationTimeOffset,s=s.I,!i&&!s&&1<u.length)throw new U(4,4002);if(!i&&!t.C.duration&&!s&&1==u.length)throw new U(4,4002);if(s&&0==s.length)throw new U(4,4002);var h=null,c=null;t.B.id&&t.j.id&&(c=t.B.id+","+t.j.id,h=e[c]);var l=t.C.duration,f=t.j.G,p=u.length;s&&s.length!=u.length&&(p=Math.min(s.length,u.length));var b=[],y=n;for(n=0;p>n;n++){var v,w=u[n],T=ui(f,[w.Xa]);v=null!=i?y+i:s?s[n].end:y+l,b.push(new g(n+r,y,v,T,w.start,w.end)),y=v}return oi(t.C.duration,b),h?(at(h,b),st(h,m(t.presentationTimeline))):(d(t.presentationTimeline,t.C.start,b),h=new rt(b),c&&(e[c]=h)),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:h.b.bind(h),getSegmentReference:h.get.bind(h),initSegmentReference:o,presentationTimeOffset:a}}function yi(t){return t.S}function gi(t){return[t.j.S,t.v.S,t.B.S].filter(it).map(function(t){return Le(t,"SegmentURL")}).reduce(function(t,e){return 0<t.length?t:e}).map(function(t){var e=t.getAttribute("media");return t=Ue(t,"mediaRange",Ke,{start:0,end:null}),{Xa:e,start:t.start,end:t.end}})}function vi(t,e,i,n){var r;(r=ci(t,wi,"initialization"))?(r=si(r,t.j.id,null,t.bandwidth||null,null),r=ui(t.j.G,[r]),r=new y(r,0,null)):r=null;var a;a=hi(t,wi);var s=ci(t,wi,"media"),o=ci(t,wi,"index");if(a={L:a.L,qa:a.qa,ja:a.ja,presentationTimeOffset:a.presentationTimeOffset,I:a.I,xa:s,fa:o},s=0+(a.fa?1:0),s+=a.I?1:0,s+=a.L?1:0,0==s)throw new U(4,4002);if(1!=s&&(a.fa&&(a.I=null),a.L=null),!a.fa&&!a.xa)throw new U(4,4002);if(s=null,a.fa){if(i=r,n=t.j.mimeType.split("/")[1],"mp4"!=n&&"webm"!=n)throw new U(4,4006);if("webm"==n&&!i)throw new U(4,4005);s=si(a.fa,t.j.id,null,t.bandwidth||null,null),s=ui(t.j.G,[s]),s=pi(t,e,i,s,0,null,n,a.presentationTimeOffset)}else if(a.L)n||(i=t.presentationTimeline,i.b=Math.max(i.b,a.L)),s=Ti(t,a);else{for(n=e=null,t.B.id&&t.j.id&&(n=t.B.id+","+t.j.id,e=i[n]),s=[],o=0;o<a.I.length;o++){var u=a.I[o].start,h=a.I[o].end,c=o+a.ja,l=si(a.xa,t.j.id,c,t.bandwidth||null,(u+a.presentationTimeOffset)*a.qa),l=ui(t.j.G,[l]);s.push(new g(c,u,h,l,0,null))}oi(t.C.duration,s),e?(at(e,s),st(e,m(t.presentationTimeline))):(d(t.presentationTimeline,t.C.start,s),e=new rt(s),n&&(i[n]=e)),s={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:e.b.bind(e),getSegmentReference:e.get.bind(e)}}return{createSegmentIndex:s.createSegmentIndex,findSegmentPosition:s.findSegmentPosition,getSegmentReference:s.getSegmentReference,initSegmentReference:r,presentationTimeOffset:a.presentationTimeOffset}}function wi(t){return t.ia}function Ti(t,e){var i=t.C.duration,n=e.L,r=e.ja,a=e.qa,s=e.xa,o=t.bandwidth||null,u=t.j.id,h=t.j.G;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return 0>t||i&&t>=i?null:Math.floor(t/n)},getSegmentReference:function(t){var e=t*n,i=si(s,u,t+r,o,e*a),i=ui(h,[i]);return new g(t,e,e+n,i,0,null)}}}function Si(t){this.f=!1,this.a=[],this.b=[],this.c=[],this.h=t||null}function Ei(){return{maxAttempts:1,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}}function Ii(t,e){return{uris:t,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:e}}function ki(){this.m=this.l=this.c=this.a=null,this.g=[],this.b=null,this.h=[],this.u=1,this.i={},this.o=0,this.f=null}function Pi(t){return t.a.request(0,Ii(t.g,t.c.retryParameters)).then(function(t){return this.a?_i(this,t.data,t.uri):void 0}.bind(t))}function _i(t,e,i){var n=Gt(e),r=new DOMParser,a=null;e=null;try{a=r.parseFromString(n,"text/xml")}catch(s){}if(a&&"MPD"==a.documentElement.tagName&&(e=a.documentElement),!e)throw new U(4,4001);i=[i],n=Le(e,"Location").map(je).filter(it),0<n.length&&(i=t.g=n);var n=Le(e,"BaseURL").map(je),r=ui(i,n),o=Ue(e,"minBufferTime",Fe);t.o=Ue(e,"minimumUpdatePeriod",Fe,-1),a=Ue(e,"availabilityStartTime",Be),i=Ue(e,"timeShiftBufferDepth",Fe);var u,h=Ue(e,"suggestedPresentationDelay",Fe),n=Ue(e,"maxSegmentDuration",Fe);t.b?u=t.b.presentationTimeline:(null!=a&&(a+=null!=h?h:5),u=new f(a));var r=Ai(t,{presentationTimeline:u,B:null,C:null,v:null,j:null,bandwidth:void 0},r,e),c=r.periods;return u.a=r.duration||Number.POSITIVE_INFINITY,u.c=null!=i?i:Number.POSITIVE_INFINITY,u.b=Math.max(u.b,n||1),t.b?Promise.resolve():(e=Le(e,"UTCTiming"),Di(t,e,u.aa()).then(function(t){this.a&&(u.g=t,this.b={presentationTimeline:u,periods:c,minBufferTime:o||0})}.bind(t)))}function Ai(t,e,i,n){var r=Ue(n,"mediaPresentationDuration",Fe),a=[],s=0;n=Le(n,"Period");for(var o=0;o<n.length;o++){var u=n[o],s=Ue(u,"start",Fe,s),h=Ue(u,"duration",Fe);if(null==h)if(o+1!=n.length){var c=Ue(n[o+1],"start",Fe);null!=c&&(h=c-s)}else null!=r&&(h=r-s);var c=t,l=e,u={start:s,duration:h,node:u};if(l.B=Mi(u.node,null,i),l.C=u,l.B.id||(l.B.id="__shaka_period_"+u.start),c=Le(u.node,"AdaptationSet").map(c.mb.bind(c,l)),0==c.length)throw new U(4,4004);if(c=Ri(c),u={startTime:u.start,streamSets:c},a.push(u),c=e.B.id,t.h.every(nt(c))&&(t.l(u),t.h.push(c),t.b&&t.b.periods.push(u)),null==h){s=null;break}s+=h}return null!=r?{periods:a,duration:r}:{periods:a,duration:s}}function Ni(e,i){0>e.o||(e.f=t.setTimeout(e.Eb.bind(e),1e3*Math.max(Math.max(3,e.o)-i,0)))}function Mi(t,e,i){e=e||{contentType:"",mimeType:"",ua:""},i=i||e.G;var n=Le(t,"BaseURL").map(je);return{G:ui(i,n),ha:Ce(t,"SegmentBase")||e.ha,S:Ce(t,"SegmentList")||e.S,ia:Ce(t,"SegmentTemplate")||e.ia,width:Ue(t,"width",He)||e.width,height:Ue(t,"height",He)||e.height,contentType:t.getAttribute("contentType")||e.contentType,mimeType:t.getAttribute("mimeType")||e.mimeType,ua:t.getAttribute("codecs")||e.ua,id:t.getAttribute("id")}}function Ri(t){var e={};t.forEach(function(t){e[t.id]=[t]}),t.forEach(function(t){var i=e[t.id];t.Hb.forEach(function(t){(t=e[t])&&t!=i&&(i.push.apply(i,t),t.forEach(function(t){e[t.id]=i}))})});var i=[],n=[];return dt(e).forEach(function(t){if(!(0<=n.indexOf(t))){n.push(t);var e=new bt;t.forEach(function(t){e.push(t.contentType||"",t)}),e.keys().forEach(function(t){var n=new bt;e.get(t).forEach(function(t){n.push(t.language,t)}),n.keys().forEach(function(e){var r=n.get(e);e={language:e,type:t,primary:r.some(function(t){return t.Wa}),drmInfos:r.map(function(t){return t.drmInfos}).reduce(tt,[]),streams:r.map(function(t){return t.streams}).reduce(tt,[])},i.push(e)})})}}),i}function Oi(t){var e;if(e=0+(t.ha?1:0),e+=t.S?1:0,e+=t.ia?1:0,0==e)throw new U(4,4002);1!=e&&(t.ha&&(t.S=null),t.ia=null)}function xi(t,e,i){return e=Ii([e],t.c.retryParameters),e.method=i,t.a.request(0,e).then(function(t){if("HEAD"==i){if(!t.headers||!t.headers.date)return 0;t=t.headers.date}else t=Gt(t.data);return t=Date.parse(t),isNaN(t)?0:t-Date.now()})}function Di(t,e,i){e=e.map(function(t){return{scheme:t.getAttribute("schemeIdUri"),value:t.getAttribute("value")}});var n=t.c.dash.clockSyncUri;return i&&!e.length&&n&&e.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:n}),Q(e,function(t){var e=t.value;switch(t.scheme){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return xi(this,e,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return xi(this,e,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return t=Date.parse(e),isNaN(t)?0:t-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return Promise.reject();default:return Promise.reject()}}.bind(t))["catch"](function(){return 0})}function Ci(t,e,i,n,r,a,s,o,u){this.h=t,this.c=e,this.R=i,this.a=n,this.O=r,this.u=a,this.m=s,this.w=o||null,this.A=u||null,this.l=null,this.F=Promise.resolve(),this.g=[],this.i={},this.b={},this.f=this.o=!1}function Li(t){return t.a.periods[Qi(t,Et(t.h))]}function ji(t){return pt(t.b,function(t){return t.stream})}function Ui(t,e){var i={};return i.text=e,Fi(t,i)}function Bi(t,e,i,n){if(e=t.b[e]){var r=t.g[tn(t,i)];r&&r.da&&(r=t.i[i.id])&&r.da&&e.stream!=i&&(e.stream=i,e.ya=!0,!n||e.P||e.U||(e.ba?e.P=!0:(an(e),nn(t,e))))}}function Fi(t,e){var i=Qi(t,Et(t.h)),n=pt(e,function(t){return t.mimeType+(t.codecs?'; codecs="'+t.codecs+'"':"")});return t.c.init(n),qi(t),n=dt(e),Vi(t,n).then(function(){for(var t in e){var n=e[t];this.b[t]||(this.b[t]={stream:n,type:t,W:null,J:null,ya:!0,ga:!1,oa:i,endOfStream:!1,ba:!1,T:null,P:!1,U:!1},rn(this,this.b[t],0))}}.bind(t))}function Ki(t,e){var i=t.g[e];if(i)return i.D;i={D:new Rt,da:!1},t.g[e]=i;var n=t.a.periods[e].streamSets.map(function(t){return t.streams}).reduce(tt,[]);return t.F=t.F.then(function(){return this.f?void 0:Vi(this,n)}.bind(t)).then(function(){this.f||(this.g[e].D.resolve(),this.g[e].da=!0)}.bind(t))["catch"](function(t){this.f||(this.g[e].D.reject(),delete this.g[e],this.m(t))}.bind(t)),i.D}function Vi(t,e){for(var i=[],n=0;n<e.length;++n){var r=e[n],a=t.i[r.id];a?i.push(a.D):(t.i[r.id]={D:new Rt,da:!1},i.push(r.createSegmentIndex()))}return Promise.all(i).then(function(){if(!this.f)for(var t=0;t<e.length;++t){var i=this.i[e[t].id];i.da||(i.D.resolve(),i.da=!0)}}.bind(t))["catch"](function(t){return this.f?void 0:(this.i[r.id].D.reject(),delete this.i[r.id],Promise.reject(t))}.bind(t))}function qi(t){var e=t.a.presentationTimeline.a;e<Number.POSITIVE_INFINITY?Ft(t.c,e):Ft(t.c,Math.pow(2,32))}function Hi(t,e){var i=Et(t.h),n=Ct(t.c,e.type,i),r=Math.max(t.a.minBufferTime||0,t.l.rebufferingGoal);if(n>=Math.max(r,t.l.bufferingGoal))return e.ga=!1,.5;var a=t.c,s=e.type;if(a="text"==s?a.b.a:(a=a.c[s].buffered)&&a.length?a.end(a.length-1):null,0==n&&null==a){if(null!=e.W||e.J)throw new U(5,5e3,e.type);a=i}else{if(null==e.W||null==e.J)throw new U(5,5e3,e.type);a=t.a.periods[tn(t,e.W)].startTime+e.J.a}return a>=t.a.presentationTimeline.a?(e.ga=!1,e.endOfStream=!0,null):(e.endOfStream=!1,!t.o&&r>n||1>=n?e.ga=!0:n>=r&&(e.ga=!1),n=tn(t,e.stream),r=Qi(t,a),r!=n?(e.oa=r,null):(e.J&&e.stream==e.W?(r=e.J.position+1,r=Yi(t,e,n,r)):(r=e.J?e.stream.findSegmentPosition(Math.max(0,t.a.periods[tn(t,e.W)].startTime+e.J.a-t.a.periods[n].startTime)):e.stream.findSegmentPosition(Math.max(0,i-t.a.periods[n].startTime)),r=null==r?null:Yi(t,e,n,Math.max(0,r-1))||Yi(t,e,n,r)),r?(Gi(t,e,i,n,r),null):1))}function Yi(t,e,i,n){return i=t.a.periods[i],(e=e.stream.getSegmentReference(n))?(t=t.a.presentationTimeline,n=b(t),i.startTime+e.a<m(t)||i.startTime+e.startTime>n?null:e):null}function Gi(t,e,i,n,r){var a=e.stream,s=t.a.periods[n+1],o=null,o=s?s.startTime:t.a.presentationTimeline.a;n=zi(t,e,n,o),e.ba=!0,e.ya=!1,s=en(t,r),Promise.all([n,s]).then(function(t){return this.f?void 0:Wi(this,e,i,a,r,t[1])}.bind(t)).then(function(){e.ba=!1,rn(this,e,0),this.f||Ji(this,a)}.bind(t))["catch"](function(t){this.f||this.m(t)}.bind(t))}function zi(t,e,i,n){return e.ya?(i=Ut(t.c,e.type,t.a.periods[i].startTime-e.stream.presentationTimeOffset),n=null!=n?Bt(t.c,e.type,n):Promise.resolve(),e.stream.initSegmentReference?(t=en(t,e.stream.initSegmentReference).then(function(t){return this.f?void 0:Lt(this.c,e.type,t,null,null)}.bind(t)),Promise.all([i,n,t])):Promise.all([i,n])):Promise.resolve()}function Wi(t,e,i,n,r,a){return $i(t,e,i).then(function(){return this.f?void 0:Lt(this.c,e.type,a,r.startTime,r.a)}.bind(t)).then(function(){return this.f?void 0:(e.W=n,e.J=r,Promise.resolve())}.bind(t))}function $i(t,e,i){var n=Dt(t.c,e.type);return null==n?Promise.resolve():(i=i-n-t.l.bufferBehind,0>=i?Promise.resolve():jt(t.c,e.type,n,n+i).then(function(){}.bind(t)))}function Ji(t,e){if(!t.o&&(t.o=dt(t.b).every(function(t){return!t.P&&!t.U&&t.J}),t.o)){var i=tn(t,e);for(t.g[i]||Ki(t,i).then(function(){this.u()}.bind(t))["catch"](et),i=0;i<t.a.periods.length;++i)Ki(t,i)["catch"](et);t.A&&t.A()}}function Xi(t,e){if(e.oa!=tn(t,e.stream)){var i=e.oa,n=dt(t.b);n.every(function(t){return t.oa==i})&&n.every(Zi)&&Ki(t,i).then(function(){if(!this.f){var t,e=this.O(this.a.periods[i]);for(t in this.b)if(!e[t])return void this.m(new U(5,5005));for(t in e)if(!this.b[t])return void this.m(new U(5,5005));for(t in this.b){Bi(this,t,e[t]);var n=this.b[t];Zi(n)&&rn(this,n,0)}this.u()}}.bind(t))["catch"](et)}}function Zi(t){return!t.ba&&null==t.T&&!t.P&&!t.U}function Qi(t,e){for(var i=t.a.periods.length-1;i>0;--i)if(e>=t.a.periods[i].startTime)return i;return 0}function tn(t,e){for(var i=0;i<t.a.periods.length;++i)for(var n=t.a.periods[i],r=0;r<n.streamSets.length;++r)if(0<=n.streamSets[r].streams.indexOf(e))return i;return-1}function en(t,e){var i=Ii(e.uris,t.l.retryParameters);if(0!=e.c||null!=e.b){var n="bytes="+e.c+"-";null!=e.b&&(n+=e.b),i.headers.Range=n}return t.R.request(1,i).then(function(t){return t.data})}function nn(t,e){e.P=!1,e.U=!0,t.c.clear(e.type).then(function(){this.f||(e.W=null,e.J=null,e.U=!1,rn(this,e,0))}.bind(t))}function rn(e,i,n){i.T=t.setTimeout(e.$.bind(e,i),1e3*n)}function an(e){null!=e.T&&(t.clearTimeout(e.T),e.T=null)}function sn(t,e){return new Promise(function(i,n){var r=new XMLHttpRequest;r.open(e.method,t,!0),r.responseType="arraybuffer",r.timeout=e.retryParameters.timeout,r.withCredentials=e.allowCrossSiteCredentials,r.onload=function(e){if(e=e.target,200<=e.status&&299>=e.status){var r=e.getAllResponseHeaders().split("\r\n").reduce(function(t,e){var i=e.split(": ");return t[i[0].toLowerCase()]=i.slice(1).join(": "),t},{});e.sb&&(t=e.sb),i({uri:t,data:e.response,headers:r})}else{r=null;try{r=Gt(e.response)}catch(a){}n(new U(1,1001,t,e.status,r))}},r.onerror=function(){n(new U(1,1002,t))},r.ontimeout=function(){n(new U(1,1003,t))};for(var a in e.headers)r.setRequestHeader(a,e.headers[a]);r.send(e.body)})}function on(t){for(this.w=new bt,this.c=t,this.i=null,this.u=new gt,this.Ea=new u,this.m=new Si(this.Db.bind(this)),this.f=this.o=this.b=this.h=this.la=this.O=this.A=this.g=null,this.Oa=1e9,this.sa=!1,this.F=!0,this.na=!1,this.l={},this.a=dn(this),this.R=[],this.ka=this.$=this.ma=0,this.la=un(this),t=0;t<this.c.textTracks.length;++t){var e=this.c.textTracks[t];e.mode="disabled","Shaka Player TextTrack"==e.label&&(this.i=e)}this.i||(this.i=this.c.addTextTrack("subtitles","Shaka Player TextTrack")),this.i.mode="hidden",vt(this.u,this.c,"error",this.gb.bind(this))}function un(e){e.A=new MediaSource;var i=new Rt;return vt(e.u,e.A,"sourceopen",i.resolve),e.c.src=t.URL.createObjectURL(e.A),i}function hn(t,e,i){if(t.o&&t.o.configure(t.a.manifest),t.g&&t.g.configure(t.a.drm),t.b){t.b.configure(t.a.streaming),t.f.periods.forEach(t.Fa.bind(t));var n=bn(t,Li(t.b)),r=ji(t.b),n=mt(n,function(t){return"audio"==t&&e||"text"==t&&i||r[t]&&(!r[t].allowedByApplication||!r[t].allowedByKeySystem)});pn(t,n,!0)}t.a.abr.enabled&&!t.F?t.a.abr.manager.enable():t.a.abr.manager.disable(),t.a.abr.manager.setDefaultEstimate(t.a.abr.defaultBandwidthEstimate)}function cn(t){t.u&&t.u.Y(t.A,"sourceopen"),t.c&&(t.c.removeAttribute("src"),t.c.load());var e=Promise.all([t.a.abr.manager.stop(),t.g?t.g.s():null,t.O?t.O.s():null,t.h?t.h.s():null,t.b?t.b.s():null,t.o?t.o.stop():null]);return t.g=null,t.O=null,t.h=null,t.b=null,t.o=null,t.f=null,t.la=null,t.A=null,t.l={},t.R=[],t.ma=0,t.$=0,e}function ln(t){return t.streams.some(function(t){return t.allowedByApplication&&t.allowedByKeySystem})}function fn(t,e,i,n,r){var a,s=!!{".drm.servers":!0,".drm.clearKeys":!0,".drm.advanced":!0}[r],o={".drm.servers":"string",".drm.clearKeys":"string"}[r]||"",u={".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:null}}[r];for(a in i){var h=r+"."+a,c=n[a];u&&(c=u);var l=!!{".abr.manager":!0}[h];(s||a in e)&&(void 0===i[a]?void 0===c?delete e[a]:e[a]=c:l?e[a]=i[a]:"object"==typeof e[a]&&"object"==typeof i[a]?fn(t,e[a],i[a],c,h):(s||typeof i[a]==typeof e[a])&&(o&&typeof i[a]!=o||"function"==typeof e[a]&&e[a].length!=i[a].length||(e[a]=i[a])))}}function dn(t){return{drm:{retryParameters:Ei(),servers:{},clearKeys:{},advanced:{}},manifest:{retryParameters:Ei(),dash:{customScheme:function(t){return t?null:void 0},clockSyncUri:""}},streaming:{retryParameters:Ei(),rebufferingGoal:2,bufferingGoal:30,bufferBehind:30},abr:{manager:t.Ea,enabled:!0,defaultBandwidthEstimate:5e5},preferredAudioLanguage:"",preferredTextLanguage:"",restrictions:{minWidth:0,maxWidth:Number.POSITIVE_INFINITY,minHeight:0,maxHeight:Number.POSITIVE_INFINITY,minPixels:0,maxPixels:Number.POSITIVE_INFINITY,minAudioBandwidth:0,maxAudioBandwidth:Number.POSITIVE_INFINITY,minVideoBandwidth:0,maxVideoBandwidth:Number.POSITIVE_INFINITY}}}function pn(t,e,i){for(var n in e){var r=e[n],a=i||"text"==n;t.F?t.l[n]={stream:r,clear:a}:Bi(t.b,n,r,a)}}function mn(t){if(t.f){var e=Date.now()/1e3;t.sa?t.$+=e-t.ka:t.ma+=e-t.ka,t.ka=e}}function bn(t,e){var i={};e.streamSets.forEach(function(t){!ln(t)||t.type in i||(i[t.type]=t)}),e.streamSets.forEach(function(t){ln(t)&&t.primary&&(i[t.type]=t)});var n={audio:!1,text:!1};[2,1,0].forEach(function(t){e.streamSets.forEach(function(e){if(ln(e)){var r;if("audio"==e.type?r=this.a.preferredAudioLanguage:"text"==e.type&&(r=this.a.preferredTextLanguage),r){r=ft(r);var a=ft(e.language);(a==r||t>=1&&a==r.split("-")[0]||t>=2&&a.split("-")[0]==r.split("-")[0])&&(n[e.type]=!0,i[e.type]=e)}}}.bind(this))}.bind(t)),dt(i).some(ln)||t.ea(new U(4,4012));var r=t.a.abr.manager.chooseStreams(i);return i.text&&(r.text=i.text.streams[0],i.audio&&n.text&&i.text.language!=i.audio.language&&(t.i.mode="showing",vn(t))),r}function yn(t){Promise.resolve().then(function(){this.c&&this.dispatchEvent(new Z("adaptation"))}.bind(t))}function gn(t){Promise.resolve().then(function(){this.c&&this.dispatchEvent(new Z("trackschanged"))}.bind(t))}function vn(t){t.dispatchEvent(new Z("texttrackvisibility"))}var wn,Tn=this;Tn.Lb=!0,e("shaka.abr.SimpleAbrManager",u),wn=u.prototype,wn.stop=function(){this.h=null,this.c=!1,this.g={},this.a={},this.f=null},wn.init=function(t){this.h=t},wn.chooseStreams=function(t){return this.g=t,this.a={},h(this)},wn.enable=function(){this.c=!0},wn.disable=function(){this.c=!1},wn.segmentDownloaded=function(t,e,i){var n=this.b;if(t=e-t,65536>i||200>t||(t=Math.max(t,50),i=8e3*i/t,t/=1e3,r(n.a,t,i),r(n.c,t,i)),null!=this.f&&this.c)t:{if(n=Date.now()-this.f,this.i){if(8e3>n)break t}else{if(4e3>n)break t;this.i=!0}n=this.a.audio,i=this.a.video,t=h(this),t.audio==n&&t.video==i||this.h(t)}},wn.getBandwidthEstimate=function(){return o(this.b)},wn.setDefaultEstimate=function(t){this.b.b=t};var Sn={},En={};e("shaka.media.ManifestParser.registerParserByExtension",function(t,e){En[t]=e}),e("shaka.media.ManifestParser.registerParserByMime",function(t,e){Sn[t]=e}),e("shaka.media.PresentationTimeline",f),f.prototype.aa=function(){return this.a==Number.POSITIVE_INFINITY||this.c<Number.POSITIVE_INFINITY},e("shaka.media.InitSegmentReference",y),e("shaka.media.SegmentReference",g),e("shaka.polyfill.installAll",function(){for(var t=0;t<In.length;++t)In[t]()});var In=[];e("shaka.polyfill.register",w),w(function(){if(t.Document){var e=Element.prototype;e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,e=Document.prototype,e.exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitExitFullscreen,"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),document.addEventListener("webkitfullscreenchange",T),document.addEventListener("webkitfullscreenerror",T),document.addEventListener("mozfullscreenchange",T),document.addEventListener("mozfullscreenerror",T),document.addEventListener("MSFullscreenChange",T),document.addEventListener("MSFullscreenError",T)}}),I.prototype.createSession=function(){},I.prototype.setServerCertificate=function(){},k.prototype.getConfiguration=function(){},k.prototype.createMediaKeys=function(){};var kn=0;P.prototype.then=function(t,e){var i=new P;switch(this.X){case 1:R(this,i,t);break;case 2:R(this,i,e);break;case kn:this.c.push({D:i,ta:t}),this.b.push({D:i,ta:e})}return i},P.prototype.then=P.prototype.then,P.prototype["catch"]=function(t){return this.then(void 0,t)},P.prototype["catch"]=P.prototype["catch"],P.prototype.N=function(t){if(this.X==kn){for(this.ra=t,this.X=1,t=0;t<this.c.length;++t)R(this,this.c[t].D,this.c[t].ta);this.c=[],this.b=[]}},P.prototype.a=function(t){if(this.X==kn){for(this.ra=t,this.X=2,t=0;t<this.b.length;++t)R(this,this.b[t].D,this.b[t].ta);this.c=[],this.b=[]}};var Pn=null,_n=[];w(function(){t.Promise||(t.Promise=P,t.Promise.resolve=_,t.Promise.reject=A,t.Promise.all=N,t.Promise.race=M,t.setImmediate?(D=function(e){return t.setImmediate(e)},C=function(e){return t.clearImmediate(e)}):(D=function(e){return t.setTimeout(e,0)},C=function(e){return t.clearTimeout(e)}))}),w(function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;!e.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in e&&(e.getVideoPlaybackQuality=L)}}),e("shaka.util.Error",U),U.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},U.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6},U.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,INVALID_TEXT_SETTINGS:2002,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,ALL_STREAMS_RESTRICTED:4012,INCONSISTENT_BUFFER_STATE:5e3,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEMS_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,WRONG_KEYS:6011};var An,Nn=1;Z.prototype.preventDefault=function(){},Z.prototype.stopImmediatePropagation=function(){this.a=!0},Z.prototype.stopPropagation=function(){},e("shaka.media.SegmentIndex",rt),rt.prototype.s=function(){return this.a=null,Promise.resolve()},rt.prototype.b=function(t){for(var e=this.a.length-1;e>=0;--e){var i=this.a[e];if(t>=i.startTime&&t<i.a)return i.position}return null},rt.prototype.get=function(t){return 0==this.a.length?null:(t-=this.a[0].position,0>t||t>=this.a.length?null:this.a[t])};var Mn={};e("shaka.media.TextEngine.registerParser",function(t,e){Mn[t]=e}),e("shaka.media.TextEngine.unregisterParser",function(t){delete Mn[t]}),ot.prototype.s=function(){return this.c&&lt(this,function(){return!0}),this.c=this.g=null,Promise.resolve()};var Rn={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",
cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};bt.prototype.push=function(t,e){this.a.hasOwnProperty(t)?this.a[t].push(e):this.a[t]=[e]},bt.prototype.get=function(t){return(t=this.a[t])?t.slice():null},bt.prototype.keys=function(){var t,e=[];for(t in this.a)e.push(t);return e},bt.prototype.clear=function(){this.a={}},gt.prototype.s=function(){return wt(this),this.a=null,Promise.resolve()},gt.prototype.Y=function(t,e){for(var i=this.a.get(e)||[],n=0;n<i.length;++n){var r=i[n];r.target==t&&(r.Y(),yt(this.a,e,r))}},Tt.prototype.Y=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)},wn=St.prototype,wn.s=function(){var e=this.b.s();return this.b=null,null!=this.f&&(t.clearInterval(this.f),this.f=null),this.m=this.l=this.c=this.a=null,e},wn.va=function(){return this.g},wn.cb=function(){this.a.playbackRate!=(this.h||0>this.g?0:this.g)&&Pt(this,this.a.playbackRate)},wn.Ia=function(){this.b.Y(this.a,"loadedmetadata");var t=It(this);this.a.currentTime.toFixed(3)==t.toFixed(3)?(vt(this.b,this.a,"seeking",this.Ka.bind(this)),vt(this.b,this.a,"playing",this.Ja.bind(this))):(vt(this.b,this.a,"seeking",this.eb.bind(this)),this.a.currentTime=t)},wn.eb=function(){this.b.Y(this.a,"seeking"),vt(this.b,this.a,"seeking",this.Ka.bind(this)),vt(this.b,this.a,"playing",this.Ja.bind(this))},wn.Ka=function(){var t=this.a.currentTime,e=_t(this,t);e!=t?At(this,t,e):this.m()},wn.Ja=function(){var t=this.a.currentTime,e=_t(this,t);e!=t&&At(this,t,e)},Mt.prototype.addEventListener=function(t,e){this.w.push(t,e)},Mt.prototype.removeEventListener=function(t,e){yt(this.w,t,e)},Mt.prototype.dispatchEvent=function(t){for(var e=this.w.get(t.type)||[],i=0;i<e.length;++i){t.target=this,t.currentTarget=this;var n=e[i];try{n.handleEvent?n.handleEvent(t):n.call(this,t)}catch(r){}if(t.a)break}return t.defaultPrevented},wn=Ot.prototype,wn.s=function(){this.h=!0;var t,e=[];for(t in this.a){var i=this.a[t],n=i[0];for(this.a[t]=i.slice(0,1),n&&e.push(n.p["catch"](et)),n=1;n<i.length;++n)i[n].p["catch"](et),i[n].p.reject()}return this.b&&e.push(this.b.s()),Promise.all(e).then(function(){this.g.s(),this.b=this.l=this.f=this.i=this.g=null,this.c={},this.a={}}.bind(this))},wn.init=function(t){for(var e in t){var i=t[e];"text"==e?this.b=new ot(this.l,i):(i=this.f.addSourceBuffer(i),vt(this.g,i,"error",this.Gb.bind(this,e)),vt(this.g,i,"updateend",this.za.bind(this,e)),this.c[e]=i,this.a[e]=[])}},wn.clear=function(t){return"text"==t?ht(this.b,0,Number.POSITIVE_INFINITY):Kt(this,t,this.La.bind(this,t,0,this.f.duration))},wn.endOfStream=function(t){return Vt(this,function(){t?this.f.endOfStream(t):this.f.endOfStream()}.bind(this))},wn.Fb=function(t,e){this.c[t].appendBuffer(e)},wn.La=function(t,e,i){this.c[t].remove(e,i)},wn.yb=function(t,e){this.c[t].timestampOffset=e,this.za(t)},wn.wb=function(t,e){this.c[t].appendWindowEnd=e+1/15,this.za(t)},wn.Gb=function(t){this.a[t][0].p.reject(new U(3,3014,this.i.error?this.i.error.code:0))},wn.za=function(t){var e=this.a[t][0];e&&(e.p.resolve(),qt(this,t))},Zt.b=function(e){if(1==e.length&&!e[0]||/^NOTE($|[ \t])/.test(e[0]))return null;var i=null;0>e[0].indexOf("-->")&&(i=e[0],e.splice(0,1));var n=new $t(e[0]),r=Zt.a(n),a=Jt(n,/[ \t]+--\x3e[ \t]+/g),s=Zt.a(n);if(null==r||null==a||null==s)throw new U(2,2001);if(e=e.slice(1).join("\n"),t.VTTCue)for(r=new VTTCue(r,s,e),Jt(n,/[ \t]+/gm),s=Xt(n);s;){if(!Zt.c(r,s))throw new U(2,2002);Jt(n,/[ \t]+/gm),s=Xt(n)}else r=new TextTrackCue(r,s,e);return null!=i&&(r.id=i),r},Zt.c=function(t,e){var i=null;if(i=/^align:(start|middle|end)$/.exec(e))t.align=i[1];else if(i=/^vertical:(lr|rl)$/.exec(e))t.c=i[1];else if(i=/^size:(\d{1,2}|100)%$/.exec(e))t.size=Number(i[1]);else if(i=/^position:(\d{1,2}|100)%$/.exec(e))t.position=Number(i[1]);else if(i=/^line:(\d{1,2}|100)%$/.exec(e))t.b=!1,t.a=Number(i[1]);else{if(!(i=/^line:(-?\d+)$/.exec(e)))return!1;t.b=!0,t.a=Number(i[1])}return!0},Zt.a=function(t){if(t=Jt(t,/(?:(\d{2,}):)?(\d{2}):(\d{2})\.(\d{3})/g),null==t)return null;var e=Number(t[2]),i=Number(t[3]);return e>59||i>59?null:Number(t[4])/1e3+i+60*e+3600*(Number(t[1])||0)},Mn["text/vtt"]=Zt,wn=re.prototype,wn.s=function(){this.b=!0,this.a.forEach(function(t){t.pa.close()["catch"](et)});var t=[];return this.c&&t.push(this.c.s()),this.h&&t.push(this.h.setMediaKeys(null)["catch"](et)),this.o=[],this.c=this.h=this.i=this.m=null,this.a=[],this.g=this.f=this.A=null,Promise.all(t)},wn.configure=function(t){this.f=t},wn.init=function(t,e){var i={},n=[];return se(this,t,e,i,n),n.length?oe(this,i,n):(this.u=!0,Promise.resolve())},wn.keySystem=function(){return this.l},wn.hb=function(){this.a.some(function(t){return!t.loaded})||this.g(new U(6,6011))},wn.Ya=function(t){for(var e=new Uint8Array(t.initData),i=0;i<this.a.length;++i)if(ne(e,this.a[i].initData))return;le(this,t.initDataType,e)},wn.fb=function(t){var e=t.target,i=Vn,n=Ii([this.w],this.f.retryParameters);n.body=t.message,n.method="POST","com.microsoft.playready"==this.l&&fe(n),this.A.request(i,n).then(function(t){return this.b?Promise.reject():e.update(t.data)}.bind(this),function(t){return this.b?Promise.resolve():void this.g(new U(6,6007,t))}.bind(this))["catch"](function(t){return this.b?Promise.resolve():void this.g(new U(6,6008,t.message))}.bind(this))},wn.Za=function(t){var e=t.target;t=e.keyStatuses,void 0===t.forEach&&(t=[]);var i={};if(t.forEach(function(t,n){if("string"==typeof t){var r=t;t=n,n=r}if("com.microsoft.playready"==this.l&&16==t.byteLength){var r=new DataView(t),a=r.getUint32(0,!0),s=r.getUint16(4,!0),o=r.getUint16(6,!0);r.setUint32(0,a,!1),r.setUint16(4,s,!1),r.setUint16(6,o,!1)}"com.microsoft.playready"==this.l&&"status-pending"==n&&(n="usable"),"status-pending"!=n&&"internal-error"!=n&&(this.a.filter(function(t){return t.pa==e})[0].loaded=!0),r=ie(new Uint8Array(t)),i[r]=n}.bind(this)),e.expiration<Date.now()){for(t=0;t<this.a.length;++t)if(this.a[t].pa==e){this.a.splice(t,1);break}e.close()}this.F(i)},be.prototype.createMediaKeys=function(){var t=new ye(this.a);return Promise.resolve(t)},be.prototype.getConfiguration=function(){return this.b},wn=ye.prototype,wn.createSession=function(t){var e=t||"temporary";if("temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+t+" is unsupported on this platform.");return t=this.b||document.createElement("video"),t.src||(t.src="about:blank"),e=new we(t,this.g,e),this.c.push(e),e},wn.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},wn.lb=function(t){this.b.dispatchEvent(new Z("encrypted",{initDataType:"webm",initData:t.initData}))},wn.kb=function(t){var e=ve(this,t.sessionId);e&&(t=new Z("message",{messageType:void 0==e.keyStatuses.wa()?"licenserequest":"licenserenewal",message:t.message}),e.b&&(e.b.resolve(),e.b=null),e.dispatchEvent(t))},wn.ib=function(t){(t=ve(this,t.sessionId))&&(Se(t,"usable"),t.a&&t.a.resolve(),t.a=null)},wn.jb=function(t){var e=ve(this,t.sessionId);if(e){var i=Error("EME v0.1b key error");i.errorCode=t.errorCode,i.errorCode.systemCode=t.systemCode,!t.sessionId&&e.b?(i.method="generateRequest",45==t.systemCode&&(i.message="Unsupported session type."),e.b.reject(i),e.b=null):t.sessionId&&e.a?(i.method="update",e.a.reject(i),e.a=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Se(e,"output-restricted"):1==i?Se(e,"expired"):Se(e,"internal-error"))}},i(we),wn=we.prototype,wn.Da=function(t,e){if(this.a)this.a.then(this.Da.bind(this,t,e))["catch"](this.Da.bind(this,t,e));else{this.a=t;var i,n;"webkit-org.w3.clearkey"==this.c?(i=Ht(e),n=JSON.parse(i),"oct"!=n.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),i=te(n.keys[0].k),n=te(n.keys[0].kid)):(i=new Uint8Array(e),n=null);try{this.f.webkitAddKey(this.c,i,n,this.sessionId)}catch(r){this.a.reject(r),this.a=null}}},wn.generateRequest=function(t,e){return Te(this,e,null)},wn.load=function(t){return"persistent-license"==this.g?Te(this,null,t):Promise.reject(Error("Not a persistent session."))},wn.update=function(t){var e=new Rt;return this.Da(e,t),e},wn.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}return this.closed.resolve(),this.closed},wn.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};var On;wn=Ee.prototype,wn.Aa=function(t){this.size=void 0==t?0:1,this.a=t},wn.wa=function(){return this.a},wn.forEach=function(t){this.a&&t(On,this.a)},wn.get=function(t){return this.has(t)?this.a:void 0},wn.has=function(t){var e=On;return!(!this.a||!ne(new Uint8Array(t),new Uint8Array(e)))},Pe.prototype.createMediaKeys=function(){var t=new Ae(this.keySystem);return Promise.resolve(t)},Pe.prototype.getConfiguration=function(){return this.a},Ae.prototype.createSession=function(t){if("temporary"!=(t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new Me(this.a)},Ae.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},i(Me),wn=Me.prototype,wn.generateRequest=function(t,e){this.a=new Rt;try{this.c=this.g.createSession("video/mp4",new Uint8Array(e),null),vt(this.f,this.c,"mskeymessage",this.bb.bind(this)),vt(this.f,this.c,"mskeyadded",this.$a.bind(this)),vt(this.f,this.c,"mskeyerror",this.ab.bind(this)),xe(this,"status-pending")}catch(i){this.a.reject(i)}return this.a},wn.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},wn.update=function(t){this.b=new Rt;try{this.c.update(new Uint8Array(t))}catch(e){this.b.reject(e)}return this.b},wn.close=function(){try{this.c.close(),this.closed.resolve(),wt(this.f)}catch(t){this.closed.reject(t)}return this.closed},wn.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},wn.bb=function(t){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new Z("message",{messageType:void 0==this.keyStatuses.wa()?"licenserequest":"licenserenewal",message:t.message.buffer}))},wn.$a=function(){this.a?(xe(this,"usable"),this.a.resolve(),this.a=null):this.b&&(xe(this,"usable"),this.b.resolve(),this.b=null)},wn.ab=function(){var t=Error("EME v20140218 key error");if(t.errorCode=this.c.error,null!=this.a)this.a.reject(t),this.a=null;else if(null!=this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:xe(this,"output-not-allowed");default:xe(this,"internal-error")}};var xn;wn=De.prototype,wn.Aa=function(t){this.size=void 0==t?0:1,this.a=t},wn.wa=function(){return this.a},wn.forEach=function(t){this.a&&t(xn,this.a)},wn.get=function(t){return this.has(t)?this.a:void 0},wn.has=function(t){var e=xn;return!(!this.a||!ne(new Uint8Array(t),new Uint8Array(e)))},w(function(){!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(On=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=pe,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=me,t.MediaKeys=ye,t.MediaKeySystemAccess=be):t.MSMediaKeys?(xn=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=_e,t.MediaKeys=Ae,t.MediaKeySystemAccess=Pe,navigator.requestMediaKeySystemAccess=ke):(navigator.requestMediaKeySystemAccess=S,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=E,t.MediaKeys=I,t.MediaKeySystemAccess=k))});var Dn={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Cn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;wn=Je.prototype,wn.K="",wn.Z="",wn.M="",wn.ca=null,wn.H="",wn.V="",wn.toString=function(){var t=[],e=this.K;if(e&&t.push(ii(e,Ln,!0),":"),e=this.M){t.push("//");var i=this.Z;i&&t.push(ii(i,Ln,!0),"@"),t.push(encodeURIComponent(e).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.ca,null!=e&&t.push(":",String(e))}return(e=this.H)&&(this.M&&"/"!=e.charAt(0)&&t.push("/"),t.push(ii(e,"/"==e.charAt(0)?Un:jn,!0))),(e=this.a.toString())&&t.push("?",e),(e=this.V)&&t.push("#",ii(e,Fn)),t.join("")},wn.resolve=function(t){var e=new Je(this);"data"===e.K&&(e=new Je);var i=!!t.K;i?Xe(e,t.K):i=!!t.Z,i?e.Z=t.Z:i=!!t.M,i?e.M=t.M:i=null!=t.ca;var n=t.H;if(i)Ze(e,t.ca);else if(i=!!t.H){if("/"!=n.charAt(0))if(this.M&&!this.H)n="/"+n;else{var r=e.H.lastIndexOf("/");-1!=r&&(n=e.H.substr(0,r+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){for(var r=0==n.lastIndexOf("/",0),n=n.split("/"),a=[],s=0;s<n.length;){var o=n[s++];"."==o?r&&s==n.length&&a.push(""):".."==o?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),r&&s==n.length&&a.push("")):(a.push(o),r=!0)}n=a.join("/")}}return i?e.H=n:i=""!==t.a.toString(),i?ti(e,ai(t.a)):i=!!t.V,i&&(e.V=t.V),e};var Ln=/[#\/\?@]/g,jn=/[\#\?:]/g,Un=/[\#\?]/g,Bn=/[\#\?@]/g,Fn=/#/g;ri.prototype.a=null,ri.prototype.c=null,ri.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var t,e=[];for(t in this.a)for(var i=encodeURIComponent(t),n=this.a[t],r=0;r<n.length;r++){var a=i;""!==n[r]&&(a+="="+encodeURIComponent(n[r])),e.push(a)}return this.b=e.join("&")};var Kn=1/15,Vn=2;e("shaka.net.NetworkingEngine.RequestType",{MANIFEST:0,SEGMENT:1,LICENSE:Vn});var qn={};e("shaka.net.NetworkingEngine.registerScheme",function(t,e){qn[t]=e}),e("shaka.net.NetworkingEngine.unregisterScheme",function(t){delete qn[t]}),Si.prototype.ob=function(t){this.b.push(t)},Si.prototype.registerRequestFilter=Si.prototype.ob,Si.prototype.Jb=function(t){var e=this.b;t=e.indexOf(t),t>=0&&e.splice(t,1)},Si.prototype.unregisterRequestFilter=Si.prototype.Jb,Si.prototype.Ra=function(){this.b=[]},Si.prototype.clearAllRequestFilters=Si.prototype.Ra,Si.prototype.pb=function(t){this.c.push(t)},Si.prototype.registerResponseFilter=Si.prototype.pb,Si.prototype.Kb=function(t){var e=this.c;t=e.indexOf(t),t>=0&&e.splice(t,1)},Si.prototype.unregisterResponseFilter=Si.prototype.Kb,Si.prototype.Sa=function(){this.c=[]},Si.prototype.clearAllResponseFilters=Si.prototype.Sa,Si.prototype.s=function(){this.f=!0,this.b=[],this.c=[];for(var t=[],e=0;e<this.a.length;++e)t.push(this.a[e]["catch"](et));return Promise.all(t)},Si.prototype.request=function(t,e){if(this.f)return Promise.reject();for(var i=Date.now(),n=this.b,r=0;r<n.length;r++)try{n[r](t,e)}catch(a){return Promise.reject(a)}for(var r=e.retryParameters||{},n=r.maxAttempts||1,s=r.backoffFactor||2,o=null==r.baseDelay?1e3:r.baseDelay,u=this.g(t,e,0),r=1;n>r;r++)u=u["catch"](this.i.bind(this,t,e,o,r%e.uris.length)),o*=s;return this.a.push(u),u.then(function(e){this.a.splice(this.a.indexOf(u),1);var n=Date.now();return this.h&&1==t&&this.h(i,n,e.data.byteLength),e}.bind(this))["catch"](function(t){return this.a.splice(this.a.indexOf(u),1),Promise.reject(t)}.bind(this))},Si.prototype.request=Si.prototype.request,Si.prototype.g=function(t,e,i){if(this.f)return Promise.reject();var n=new Je(e.uris[i]),r=n.K;return r||(r=location.protocol,r=r.slice(0,-1),Xe(n,r),e.uris[i]=n.toString()),(r=qn[r])?r(e.uris[i],e).then(function(e){for(var i=this.c,n=0;n<i.length;n++)i[n](t,e);return e}.bind(this)):Promise.reject(new U(1,1e3,n))},Si.prototype.i=function(e,i,n,r){var a=new Rt,s=i.retryParameters||{};return t.setTimeout(a.resolve,n*(1+(2*Math.random()-1)*(null==s.fuzzFactor?.5:s.fuzzFactor))),a.then(this.g.bind(this,e,i,r))},wn=ki.prototype,wn.configure=function(t){this.c=t},wn.start=function(t,e,i,n){return this.g=[t],this.a=e,this.l=i,this.m=n,Pi(this).then(function(){return this.a&&Ni(this,0),this.b}.bind(this))},wn.stop=function(){return this.c=this.m=this.l=this.a=null,this.g=[],this.b=null,this.h=[],this.i={},null!=this.f&&(t.clearTimeout(this.f),this.f=null),Promise.resolve()},wn.mb=function(t,e){t.v=Mi(e,t.B,null),t.v.contentType||(t.v.contentType=t.v.mimeType.split("/")[0]);var i=!1,n=Ce(e,"Role"),r=void 0;if("text"==t.v.contentType&&(r="subtitle"),n){var a=n.getAttribute("schemeIdUri");if(null==a||"urn:mpeg:dash:role:2011"==a)switch(n=n.getAttribute("value")){case"main":i=!0;break;case"caption":case"subtitle":r=n}}var s=[];if(Le(e,"SupplementalProperty").forEach(function(t){"http://dashif.org/descriptor/AdaptationSetSwitching"==t.getAttribute("schemeIdURI")&&(t=t.getAttribute("value"))&&s.push.apply(s,t.split(","))}),n=Le(e,"ContentProtection"),n=Ye(n,this.c.dash.customScheme),r=Le(e,"Representation").map(this.nb.bind(this,t,n,r)),0==r.length)throw new U(4,4003);return t.v.contentType||(t.v.contentType=r[0].mimeType.split("/")[0]),{id:t.v.id||"__fake__"+this.u++,contentType:t.v.contentType,language:ft(e.getAttribute("lang")||"und"),Wa:i,streams:r,drmInfos:n.drmInfos,Hb:s}},wn.nb=function(t,e,i,n){t.j=Mi(n,t.v,null),t.bandwidth=Ue(n,"bandwidth",qe)||void 0,"text"!=t.j.contentType&&Oi(t.j);var r;if(r=this.qb.bind(this),t.j.ha)r=di(t,r);else if(t.j.S)r=bi(t,this.i);else if(t.j.ia)r=vi(t,r,this.i,!!this.b);else{var a=t.j.G,s=t.C.duration||0;r={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return t>=0&&s>t?1:null},getSegmentReference:function(t){return 1!=t?null:new g(1,0,s,a,0,null)},initSegmentReference:null,presentationTimeOffset:0}}return n=Le(n,"ContentProtection"),n=Ge(n,this.c.dash.customScheme,e),{id:this.u++,createSegmentIndex:r.createSegmentIndex,findSegmentPosition:r.findSegmentPosition,getSegmentReference:r.getSegmentReference,initSegmentReference:r.initSegmentReference,presentationTimeOffset:r.presentationTimeOffset,mimeType:t.j.mimeType,codecs:t.j.ua,bandwidth:t.bandwidth,width:t.j.width,height:t.j.height,kind:i,encrypted:0<e.drmInfos.length,keyId:n,allowedByApplication:!0,allowedByKeySystem:!0}},wn.Eb=function(){this.f=null;var t=Date.now();Pi(this).then(function(){this.a&&Ni(this,(Date.now()-t)/1e3)}.bind(this))["catch"](function(t){this.m(t),this.a&&Ni(this,0)}.bind(this))},wn.qb=function(t,e,i){return t=Ii(t,this.c.retryParameters),null!=e&&(t.headers.Range="bytes="+e+"-"+(null!=i?i:"")),this.a.request(1,t).then(function(t){return t.data})},En.mpd=ki,Sn["application/dash+xml"]=ki,Ci.prototype.s=function(){for(var t in this.b)an(this.b[t]);return this.l=this.b=this.i=this.g=this.A=this.w=this.m=this.u=this.O=this.F=this.a=this.R=this.c=this.h=null,this.f=!0,Promise.resolve()},Ci.prototype.configure=function(t){this.l=t,this.h.i=Math.max(this.a.minBufferTime||0,this.l.rebufferingGoal)},Ci.prototype.init=function(){var t=this.O(this.a.periods[Qi(this,Et(this.h))]);return t&&0!=Object.keys(t).length?Fi(this,t).then(function(){this.w&&this.w()}.bind(this)):Promise.reject(new U(5,5005))},Ci.prototype.$=function(t){if(!this.f&&!t.ba&&null!=t.T&&!t.U)if(t.T=null,t.P)nn(this,t);else{try{var e=Hi(this,t);null!=e&&rn(this,t,e)}catch(i){return void this.m(i)}e=dt(this.b),kt(this.h,e.some(function(t){return t.ga})),Xi(this,t),e.every(function(t){return t.endOfStream})&&this.c.endOfStream()}},qn.data=function(e){return new Promise(function(i){var n=e.split(":");if(2>n.length||"data"!=n[0])throw new U(1,1004,e);if(n=n.slice(1).join(":").split(","),2>n.length)throw new U(1,1004,e);var r=n[0],n=t.decodeURIComponent(n.slice(1).join(",")),r=r.split(";"),a=null;if(1<r.length&&(a=r[1]),"base64"==a)n=te(n).buffer;else{if(a)throw new U(1,1005,e);n=zt(n)}i({uri:e,data:n,headers:{}})})},qn.http=sn,qn.https=sn,i(on),e("shaka.Player",on),on.prototype.s=function(){var t=Promise.all([cn(this),this.u?this.u.s():null,this.m?this.m.s():null]);return this.a=this.m=this.Ea=this.u=this.i=this.c=null,t},on.prototype.destroy=on.prototype.s,on.version="v2.0.0-beta2",on.support=function(){if(t.Promise&&t.Uint8Array&&Array.prototype.forEach){var e=l(),i=xt();return de().then(function(t){return{manifest:e,media:i,drm:t,supported:e.basic&&i.basic&&t.basic}})}return{then:function(t){t({supported:!1})}}},on.prototype.load=function(t,e,i){var n=i;i=Promise.resolve();var r;return n||(r=Qe(new Je(t)).split("/").pop().split("."),1<r.length&&(r=r.pop().toLowerCase(),n=En[r])),n||(i=Ii([t],this.a.manifest.retryParameters),i.method="HEAD",i=this.m.request(0,i).then(function(e){return(e=e.headers["content-type"])&&(e=e.toLowerCase()),n=Sn[e],n?void 0:Promise.reject(new U(4,4e3,t))},function(){return Promise.reject(new U(4,4e3,t))})),i=i.then(function(){return this.o=new n,this.o.configure(this.a.manifest),this.o.start(t,this.m,this.Ba.bind(this),this.ea.bind(this))}.bind(this)).then(function(t){this.f=t,this.ka=Date.now()/1e3}.bind(this)),r=Promise.resolve(),this.c.src&&(r=this.Na()),this.na=!0,Promise.all([r,i]).then(function(){return this.g=new re(this.m,this.ea.bind(this),this.Bb.bind(this)),this.g.configure(this.a.drm),this.g.init(this.f,!1)}.bind(this)).then(function(){return this.f.periods.forEach(this.Ba.bind(this)),Promise.all([ae(this.g,this.c),this.la])}.bind(this)).then(function(){return this.h=new St(this.c,this.f.presentationTimeline,Math.max(this.f.minBufferTime||0,this.a.streaming.rebufferingGoal),e||null,this.zb.bind(this),this.Cb.bind(this)),this.O=new Ot(this.c,this.A,this.i),this.b=new Ci(this.h,this.O,this.m,this.f,this.Ab.bind(this),this.Pa.bind(this),this.ea.bind(this)),this.b.configure(this.a.streaming),this.b.init()}.bind(this)).then(function(){this.f.periods.forEach(this.Ba.bind(this)),gn(this),yn(this),this.na=!1,this.a.abr.manager.init(this.Ca.bind(this))}.bind(this))["catch"](function(t){return this.na=!1,Promise.reject(t)})},on.prototype.load=on.prototype.load,on.prototype.configure=function(t){var e=t.preferredAudioLanguage?t.preferredAudioLanguage!==this.a.preferredAudioLanguage:!1,i=t.preferredTextLanguage?t.preferredTextLanguage!==this.a.preferredTextLanguage:!1;t.abr&&t.abr.manager&&t.abr.manager!=this.a.abr.manager&&(this.a.abr.manager.stop(),t.abr.manager.init(this.Ca.bind(this))),fn(this,this.a,t,dn(this),""),hn(this,e,i)},on.prototype.configure=on.prototype.configure,on.prototype.getConfiguration=function(){var t=dn(this);return fn(this,t,this.a,dn(this),""),t},on.prototype.getConfiguration=on.prototype.getConfiguration,on.prototype.rb=function(){var t=dn(this),e=t.preferredAudioLanguage?t.preferredAudioLanguage!==this.a.preferredAudioLanguage:!1,i=t.preferredTextLanguage?t.preferredTextLanguage!==this.a.preferredTextLanguage:!1;t.abr&&t.abr.manager&&t.abr.manager!=this.a.abr.manager&&(this.a.abr.manager.stop(),t.abr.manager.init(this.Ca.bind(this))),this.a=dn(this),hn(this,e,i)},on.prototype.resetConfiguration=on.prototype.rb,on.prototype.Ta=function(){return this.m},on.prototype.getNetworkingEngine=on.prototype.Ta,on.prototype.aa=function(){return this.f?this.f.presentationTimeline.aa():!1},on.prototype.isLive=on.prototype.aa,on.prototype.ub=function(){var t=0,e=0;return this.f&&(e=this.f.presentationTimeline,t=m(e),e=b(e)),{start:t,end:e}},on.prototype.seekRange=on.prototype.ub,on.prototype.Ua=function(){return this.sa},on.prototype.isBuffering=on.prototype.Ua,on.prototype.Na=function(){return cn(this).then(function(){this.la=un(this)}.bind(this))},on.prototype.unload=on.prototype.Na,on.prototype.va=function(){return this.h?this.h.va():0},on.prototype.getPlaybackRate=on.prototype.va,on.prototype.Ib=function(t){this.h&&Pt(this.h,t)},on.prototype.trickPlay=on.prototype.Ib,on.prototype.Qa=function(){this.h&&Pt(this.h,1)},on.prototype.cancelTrickPlay=on.prototype.Qa,on.prototype.getTracks=function(){if(!this.b)return[];var t=ji(this.b);return Li(this.b).streamSets.map(function(e){var i=t[e.type];return e.streams.filter(function(t){return t.allowedByApplication&&t.allowedByKeySystem}).map(function(t){return{id:t.id,active:i==t,type:e.type,bandwidth:t.bandwidth,language:e.language,kind:t.kind||null,width:t.width||null,height:t.height||null}})}).reduce(tt,[])},on.prototype.getTracks=on.prototype.getTracks,on.prototype.vb=function(t,e){if(this.b){var i;if(Li(this.b).streamSets.forEach(function(e){e.streams.forEach(function(e){e.id==t.id&&(i=e)})}),i&&i.allowedByApplication&&i.allowedByKeySystem){this.R.push({timestamp:Date.now()/1e3,id:i.id,type:t.type,fromAdaptation:!1}),"text"!=t.type&&this.configure({abr:{enabled:!1}});var n={};n[t.type]=i,pn(this,n,e)}}},on.prototype.selectTrack=on.prototype.vb,on.prototype.Va=function(){return"showing"==this.i.mode},on.prototype.isTextTrackVisible=on.prototype.Va,on.prototype.xb=function(t){this.i.mode=t?"showing":"hidden",vn(this)},on.prototype.setTextTrackVisibility=on.prototype.xb,on.prototype.getStats=function(){mn(this);var t={},e={},i=this.c&&this.c.getVideoPlaybackQuality?this.c.getVideoPlaybackQuality():{};return this.b&&(e=ji(this.b),t=e.video||{},e=e.audio||{}),{width:t.width||0,height:t.height||0,streamBandwidth:t.bandwidth+e.bandwidth||0,decodedFrames:Number(i.totalVideoFrames),droppedFrames:Number(i.droppedVideoFrames),estimatedBandwidth:this.a.abr.manager.getBandwidthEstimate(),playTime:this.ma,bufferingTime:this.$,switchHistory:this.R.slice(0)}},on.prototype.getStats=on.prototype.getStats,on.prototype.addTextTrack=function(t,e,i,n,r){if(!this.b)return Promise.reject();for(var a,s=Li(this.b),o=0;o<this.f.periods.length;o++)if(this.f.periods[o]==s){if(o==this.f.periods.length-1){if(a=this.f.presentationTimeline.a-s.startTime,a==Number.POSITIVE_INFINITY)return Promise.reject()}else a=this.f.periods[o+1].startTime-s.startTime;break}var u={id:this.Oa++,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(e){return 1!=e?null:new g(1,0,a,[t],0,null)},initSegmentReference:null,presentationTimeOffset:0,mimeType:n,codecs:r||"",bandwidth:0,kind:i,encrypted:!1,keyId:null,allowedByApplication:!0,allowedByKeySystem:!0},h={language:e,type:"text",primary:!1,drmInfos:[],streams:[u]};return Ui(this.b,u).then(function(){return s.streamSets.push(h),bn(this,s).text==u&&pn(this,{text:u}),this.a.abr.enabled&&!this.F?this.a.abr.manager.enable():this.a.abr.manager.disable(),gn(this),{id:u.id,active:!1,type:"text",bandwidth:0,language:e,kind:i,width:null,height:null}}.bind(this))},on.prototype.addTextTrack=on.prototype.addTextTrack,wn=on.prototype,wn.Fa=function(t){var e=this.a.restrictions,i=!1;t.streamSets.forEach(function(t){t.streams.forEach(function(n){var r=n.allowedByApplication;n.allowedByApplication=!0,"video"==t.type?(n.width<e.minWidth||n.width>e.maxWidth||n.height<e.minHeight||n.height>e.maxHeight||n.width*n.height<e.minPixels||n.width*n.height>e.maxPixels||n.bandwidth<e.minVideoBandwidth||n.bandwidth>e.maxVideoBandwidth)&&(n.allowedByApplication=!1):"audio"==t.type&&(n.bandwidth<e.minAudioBandwidth||n.bandwidth>e.maxAudioBandwidth)&&(n.allowedByApplication=!1),r!=n.allowedByApplication&&(i=!0)})}),i&&gn(this)},wn.Ba=function(t){var e="",i=null;this.g&&this.g.u&&(e=this.g.keySystem(),i=this.g.m);var n={};this.b&&(n=ji(this.b));for(var r=0;r<t.streamSets.length;++r){var a=t.streamSets[r];if(e&&0!=a.drmInfos.length&&!a.drmInfos.some(function(t){return t.keySystem==e}))t.streamSets.splice(r,1),--r;else{for(var s=n[a.type],o=0;o<a.streams.length;++o){var u=a.streams[o];if(s&&"text"!=a.type&&u.mimeType!=s.mimeType)a.streams.splice(o,1),--o;else{var h=u.mimeType;u.codecs&&(h+='; codecs="'+u.codecs+'"'),Mn[h]||MediaSource.isTypeSupported(h)?i&&u.encrypted&&0>i.indexOf(h)&&(a.streams.splice(o,1),--o):(a.streams.splice(o,1),--o)}}0==a.streams.length&&(t.streamSets.splice(r,1),--r)}}this.Fa(t),t.streamSets.some(ln)||this.ea(new U(4,4011))},wn.Db=function(t,e,i){this.a.abr.manager.segmentDownloaded(t,e,i)},wn.zb=function(t){mn(this),this.sa=t,this.dispatchEvent(new Z("buffering",{buffering:t}))},wn.Cb=function(){if(this.b){var t,e=this.b;for(t in e.b){var i=e.b[t];i.U||(0<Ct(e.c,t,Et(e.h))?i.P=!1:i.P||(i.ba?i.P=!0:null==Dt(e.c,t)?null==i.T&&rn(e,i,0):(an(i),nn(e,i))))}}},wn.Ab=function(t){this.F=!0,t=bn(this,t);for(var e in this.l)t[e]=this.l[e].stream;this.l={};for(e in t)this.R.push({timestamp:Date.now()/1e3,id:t[e].id,type:e,fromAdaptation:!0});return this.na||gn(this),t},wn.Pa=function(){this.F=!1,this.a.abr.enabled&&this.a.abr.manager.enable();for(var t in this.l){var e=this.l[t];Bi(this.b,t,e.stream,e.clear)}this.l={}},wn.Ca=function(t){var e,i=ji(this.b);for(e in t){var n=t[e];i[e]!=n&&this.R.push({timestamp:Date.now()/1e3,id:n.id,type:e,fromAdaptation:!0})}if(this.b){for(e in t)Bi(this.b,e,t[e]);yn(this)}},wn.ea=function(t){this.dispatchEvent(new Z("error",{detail:t}))},wn.gb=function(){if(this.c.error){var t=this.c.error.code;if(1!=t){var e=this.c.error.msExtendedCode;e&&(0>e&&(e+=Math.pow(2,32)),e=e.toString(16)),this.ea(new U(3,3016,t,e))}}},wn.Bb=function(t){var e=["usable","status-pending","output-downscaled"],i=Li(this.b),n=!1;i.streamSets.forEach(function(i){i.streams.forEach(function(i){var r=i.allowedByKeySystem;i.keyId&&i.keyId in t&&(i.allowedByKeySystem=0<=e.indexOf(t[i.keyId])),r!=i.allowedByKeySystem&&(n=!0)})}),i=bn(this,i),this.a.abr.enabled&&!this.F&&this.a.abr.manager.enable();var r=ji(this.b),i=mt(i,function(t){return r[t]&&!r[t].allowedByKeySystem});pn(this,i,!0),n&&gn(this)}}).call(r,this),"undefined"!=typeof t&&t.exports?t.exports=r.shaka:(n=function(){return r.shaka}.call(e,i,e,t),!(void 0!==n&&(t.exports=n)))}()},function(e,i){e.exports=t}])});