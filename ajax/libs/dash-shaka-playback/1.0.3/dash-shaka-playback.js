!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],e):"object"==typeof exports?exports.DashShakaPlayback=e(require("Clappr")):t.DashShakaPlayback=e(t.Clappr)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(t,e,i){for(var n=!0;n;){var r=t,s=e,a=i;n=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,s);if(void 0!==o){if("value"in o)return o.value;var h=o.get;if(void 0===h)return;return h.call(a)}var u=Object.getPrototypeOf(r);if(null===u)return;t=u,e=s,i=a,n=!0,o=u=void 0}},h=i(2),u=i(1),l=n(u),c=3e4,f=-1,p=function(t){function e(t){var i=this;r(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this._readyToPlay=!1,this._levels=[];var n=function(t){return function(e){return i._readyToPlay?t(e):void 0}};this.enableTextTrack=n(function(t){return i._player.enableTextTrack(t)}),this.textTracks=n(function(){return i._player.getTextTracks()}),this.selectTextTrack=n(function(t){return i._player.selectTextTrack(t)}),this.audioTracks=n(function(){return i._player.getAudioTracks()}),this.selectAudioTrack=n(function(t){return i._player.selectAudioTrack(t)}),this.videoTracks=n(function(){return i._player.getVideoTracks()}),this.selectVideoTrack=n(function(t){return i._player.selectVideoTrack(t)}),this.getPlaybackType=n(function(){return i._player.isLive()?"live":"vod"})}return s(e,t),a(e,[{key:"name",get:function(){return"dash_shaka_playback"}},{key:"shakaVersion",get:function(){return l["default"].player.Player.version}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(t){this._currentLevelId=t;var e=this._currentLevelId===f;this._player.configure({enableAdaptation:!e}),!e&&this.selectVideoTrack(this._currentLevelId)},get:function(){return this._currentLevelId||f}}]),a(e,[{key:"play",value:function(){return!this._player&&this._setup(),this._readyToPlay?void o(Object.getPrototypeOf(e.prototype),"play",this).call(this):void this.once(h.Events.PLAYBACK_READY,this.play)}},{key:"ready",value:function(){}},{key:"error",value:function(t){h.Log.error("an error was raised by the video tag",t,this.el.error)}},{key:"isHighDefinitionInUse",value:function(){return!!this.highDefinition}},{key:"stop",value:function(){clearInterval(this.sendStatsId),this.trigger(h.Events.PLAYBACK_STOP,this.name),this._sendStats(),this._player.unload(),this._player=null,this._readyToPlay=!1}},{key:"destroy",value:function(){var t=this;clearInterval(this.sendStatsId),this._player.destroy().then(function(){return t._destroy()})["catch"](function(){t._destroy(),h.Log.error("shaka could not be destroyed")})}},{key:"_setup",value:function(){var t=this;this._player=this._createPlayer();var e=this._player.load(new l["default"].player.DashVideoSource(this.options.src));e.then(function(){return t._loaded()})["catch"](function(e){return t._setupError(e)})}},{key:"_createPlayer",value:function(){var t=this,e=new l["default"].player.Player(this.el);return e.addEventListener("bufferingStart",function(){return t._bufferingHandler()}),e.addEventListener("bufferingEnd",function(){return t._bufferingFullHandler()}),e.addEventListener("error",function(e){return t._error(e)}),e.addEventListener("adaptation",function(){return t._onAdaptation()}),e}},{key:"_loaded",value:function(){this._ready(),this._startToSendStats(),this._levels=this.videoTracks().map(function(t){return{id:t.id,label:t.height+"p"}}),this.trigger(h.Events.PLAYBACK_LEVELS_AVAILABLE,this.levels)}},{key:"_startToSendStats",value:function(){var t=this;this.sendStatsId=setInterval(function(){return t._sendStats()},c)}},{key:"_sendStats",value:function(){this.trigger(h.Events.PLAYBACK_STATS_ADD,this._player.getStats())}},{key:"_setupError",value:function(t){this._error({detail:"shaka could not be setup: "+t})}},{key:"_bufferingHandler",value:function(){this.trigger(h.Events.PLAYBACK_BUFFERING,this.name)}},{key:"_bufferingFullHandler",value:function(){this.trigger(h.Events.PLAYBACK_BUFFERFULL,this.name)}},{key:"_error",value:function(t){h.Log.error("an error was raised by shaka player",t.detail),this.trigger(h.Events.PLAYBACK_ERROR,t.detail,this.name)}},{key:"_onAdaptation",value:function(t){t.size||(h.Log.debug("an adaptation has happened:",t),this.highDefinition=t.size.height>=720,this.trigger(h.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(h.Events.PLAYBACK_BITRATE,{bitrate:t.size.height}))}},{key:"_destroy",value:function(){o(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._readyToPlay=!1,h.Log.debug("shaka was destroyed")}},{key:"_ready",value:function(){this._readyToPlay=!0,o(Object.getPrototypeOf(e.prototype),"ready",this).call(this)}}]),e}(h.HTML5Video);e["default"]=p,p.canPlay=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];if(l["default"].polyfill.installAll(),!l["default"].player.Player.isBrowserSupported())return h.Log.debug("This browser does not support this video"),!1;var i=t.split("?")[0].match(/.*\.(.*)$/)||[];return"mpd"===i[1]||e.indexOf("application/dash+xml")>-1},t.exports=e["default"]},function(t,e,i){var n;!function(){var r={};(function(t){function e(t,e){var i=t.split("."),n=qr;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||void 0===e?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t,e){function i(){}i.prototype=e.prototype,t.bc=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.ac=function(t,i,n){return e.prototype[i].apply(t,Array.prototype.slice.call(arguments,2))}}function n(t,e){this.id=t,this.lang=e||"unknown",this.enabled=this.active=!1}function r(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}function s(t,e,i,n){this.id=t,this.bandwidth=e||0,this.width=i||0,this.height=n||0,this.active=!1}function a(t,e){var i=t.width*t.height,n=e.width*e.height;return n>i?-1:i>n?1:t.bandwidth<e.bandwidth?-1:t.bandwidth>e.bandwidth?1:0}function o(t,e,i){this.id=t,this.bandwidth=e||0,this.lang=i||"unknown",this.active=!1}function h(){var t,e,i=new Promise(function(i,n){t=i,e=n});return i.resolve=t,i.reject=e,i.destroy=h.prototype.destroy,i}function u(t,e){return e.bind(t)}function l(t){return Object.keys(t).map(function(e){return t[e]})}function c(t,e){var i=p(t,e,"number");if(null==i)return null;if(isNaN(i)||i==Number.NEGATIVE_INFINITY||i==Number.POSITIVE_INFINITY)throw new RangeError("'"+e+"' must be finite.");if(0>i)throw new RangeError("'"+e+"' must be >= 0");return i}function f(t,e){return p(t,e,"string")}function p(t,e,i){if(t=t[e],null==t)return null;if(typeof t!=i)throw new TypeError("'"+e+"' must be a "+i+".");return t}function d(t,e,i){if(t=t[e],null==t)return null;if(!(t instanceof i))throw new TypeError("'"+e+"' must be an instance of "+i.name+".");return t}function y(t){return t.split("").reduce(function(t,e,i){return t+(i&&0==i%4?" "+e:e)})}function b(t,e){for(var i=[],n=0;n<t.length;++n){for(var r=!1,s=0;s<i.length&&!(r=e?e(t[n],i[s]):t[n]===i[s]);++s);r||i.push(t[n])}return i}function v(t){return String.fromCharCode.apply(null,t)}function g(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e}function m(e){return g(t.atob(e.replace(/-/g,"+").replace(/_/g,"/")))}function w(t){for(var e="",i=0;i<t.length;++i){var n=t[i].toString(16);1==n.length&&(n="0"+n),e+=n}return e}function T(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!=e[i])return!1;return!0}function E(t){this.b=t,this.a=new G(t),Vr||(Vr=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function k(t){var e;if(e=P(t),7<e.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var i=0,n=0;n<e.length;n++)i=256*i+e[n];e=i,i=P(t);t:{for(n=0;n<Vr.length;n++)if(T(i,Vr[n])){n=!0;break t}n=!1}if(n)i=t.b.byteLength-t.a.a;else{if(8==i.length&&224&i[1])throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var n=i[0]&(1<<8-i.length)-1,r=1;r<i.length;r++)n=256*n+i[r];i=n}return i=t.a.a+i<=t.b.byteLength?i:t.b.byteLength-t.a.a,n=new DataView(t.b.buffer,t.b.byteOffset+t.a.a,i),Z(t.a,i),new S(e,n)}function P(t){var e,i=J(t.a);for(e=1;8>=e&&!(i&1<<8-e);e++);if(e>8)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var n=new Uint8Array(e);for(n[0]=i,i=1;e>i;i++)n[i]=J(t.a);return n}function S(t,e){this.id=t,this.a=e}function j(t){if(8<t.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==t.a.byteLength&&224&t.a.getUint8(0))throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var e=0,i=0;i<t.a.byteLength;i++)var n=t.a.getUint8(i),e=256*e+n;return e}function A(){this.a={}}function _(t){var e,i=[];for(e in t.a)i.push.apply(i,t.a[e]);return i}function M(t,e,i){if(t=t.a[e])for(e=0;e<t.length;++e)t[e]==i&&(t.splice(e,1),--e)}function I(t){var e,i=[];for(e in t.a)i.push(e);return i}function N(){return Date.now()+Hr}function R(){}function C(){this.h=this.a="",this.i=!1,this.u=this.l=null,this.v=this.g=!1,this.j=this.f="",this.c=null,this.b=[]}function x(t){var e=new C;if(!t)return e;var i=f(t,"keySystem");if(null==i)throw Error("'keySystem' cannot be null.");e.a=i;var n=f(t,"licenseServerUrl");if(null!=n)e.h=n;else if(i)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");if(i=p(t,"withCredentials","boolean"),null!=i&&(e.i=i),i=d(t,"licensePostProcessor",Function),null!=i&&(e.l=i),i=d(t,"licensePreProcessor",Function),null!=i&&(e.u=i),i=p(t,"distinctiveIdentifierRequired","boolean"),null!=i&&(e.g=i),i=p(t,"persistentStateRequired","boolean"),null!=i&&(e.v=i),i=f(t,"audioRobustness"),null!=i&&(e.f=i),i=f(t,"videoRobustness"),null!=i&&(e.j=i),i=d(t,"serverCertificate",Uint8Array),null!=i&&(e.c=i),i=d(t,"initData",Object)){if(t=d(i,"initData",Uint8Array),null==t)throw Error("'initData.initData' cannot be null.");if(i=f(i,"initDataType"),null==i)throw Error("'initData.initDataType' cannot be null.");e.b.push({initData:new Uint8Array(t.buffer),initDataType:i})}return e}function D(t,e){var i=t.b.concat(e.map(function(t){return{initData:new Uint8Array(t.initData.buffer),initDataType:t.initDataType}}));t.b=b(i,O)}function O(t,e){return t.initDataType==e.initDataType&&T(t.initData,e.initData)}function L(t){this.c=Math.exp(Math.log(.5)/t),this.a=this.b=0}function U(t){return t.b/(1-Math.pow(t.c,t.a))}function B(t){var e,i=new CustomEvent(t.type,{detail:t.detail,bubbles:!!t.bubbles});for(e in t)e in i||(i[e]=t[e]);return i}function K(t){return new CustomEvent("error",{detail:t,bubbles:!0})}function q(t,e,i){return F(e),F(i),i==e||t>=zr&&i==e.split("-")[0]||t>=Gr&&i.split("-")[0]==e.split("-")[0]?!0:!1}function F(t){t=t.toLowerCase().split("-");var e=Yr[t[0]];return e&&(t[0]=e),t.join("-")}function V(t){this.xa=new A,this.v=t}function H(t,e){e.currentTarget=t;for(var i=t.xa.get(e.type)||[],n=0;n<i.length;++n){var r=i[n];try{r.handleEvent?r.handleEvent(e):r.call(t,e)}catch(s){}}return t.v&&e.bubbles&&H(t.v,e),e.defaultPrevented}function z(){V.call(this,null),this.a=new L(3),this.c=new L(10),this.b=0}function G(t){var e=Jr;this.b=t,this.c=e==Wr,this.a=0}function Y(t){return t.a<t.b.byteLength}function J(t){var e=t.b.getUint8(t.a);return t.a+=1,e}function W(t){var e=t.b.getUint32(t.a,t.c);return t.a+=4,e}function $(t){var e,i;if(t.c?(e=t.b.getUint32(t.a,!0),i=t.b.getUint32(t.a+4,!0)):(i=t.b.getUint32(t.a,!1),e=t.b.getUint32(t.a+4,!1)),i>2097151)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");return t.a+=8,i*Math.pow(2,32)+e}function X(t){if(t.a+16>t.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var e=new Uint8Array(t.b.buffer,t.a,16);return t.a+=16,e}function Z(t,e){if(t.a+e>t.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");t.a+=e}function Q(){this.g=new h,this.f=!1,this.a=null,this.b=[],this.c=null}function tt(t,e){if(t.f)throw Error("Cannot append to a running task!");t.b.push(e)}function et(t,e){var i,n=t.b[0](e);n?(i=n[0],t.c=n[1]):(i=Promise.resolve(),t.c=null),i.then(u(t,function(t){this.a?(this.b=[],this.c=null,it(this)):(this.b.shift(),this.b.length?et(this,t):(this.g.resolve(t),this.c=null))}))["catch"](u(t,function(t){this.b=[],this.c=null,this.a?it(this):this.g.reject(t)}))}function it(e){var i=Error("Task aborted.");i.type="aborted",e.g.reject(i),t.setTimeout(function(){this.a.resolve(),this.a=null}.bind(e),5)}function nt(){this.a=new A}function rt(t,e,i,n){e=new at(e,i,n),t.a.push(i,e)}function st(t){for(var e=_(t.a),i=0;i<e.length;++i)e[i].ra();t.a.a={}}function at(t,e,i){this.target=t,this.type=e,this.a=i,this.target.addEventListener(e,i,!1)}function ot(t,e){V.call(this,e),this.a=null,this.h=t}function ht(e){if(!t.indexedDB)return e=Error("Persistant storage requires IndexedDB support."),e.type="storage",Promise.reject(e);if(e.a)return e=Error("A database connection is already open."),e.type="storage",Promise.reject(e);var i=new h,n=t.indexedDB.open("content_database",1);return n.onupgradeneeded=u(e,function(t){this.a=t.target.result,lt(this,"group_store",{keyPath:"group_id"}),lt(this,"stream_index_store",{keyPath:"stream_id"}),t=lt(this,"content_store",{autoIncrement:"true"}),t.createIndex("segment",["stream_id","segment_id"],{unique:!0}),t.createIndex("stream","stream_id",{unique:!1})}),n.onsuccess=u(e,function(t){this.a=t.target.result,i.resolve()}),n.onerror=function(){i.reject(n.error)},i}function ut(t){t.a&&(t.a.close(),t.a=null)}function lt(t,e,i){return t.a.objectStoreNames.contains(e)&&t.a.deleteObjectStore(e),t.a.createObjectStore(e,i)}function ct(t){return dt(t,"content_store")}function ft(t){return dt(t,"stream_index_store")}function pt(t){return dt(t,"group_store")}function dt(t,e){return t.a.transaction([e],t.h).objectStore(e)}function yt(t,e){var i=new h,n=t.get(e);return n.onerror=function(){i.reject(n.error)},n.onsuccess=function(){if(n.result)i.resolve(n.result);else{var t=Error("Item not found.");t.type="storage",i.reject(t)}},i}function bt(){ot.call(this,"readonly",null)}function vt(t){var e=new h,i=[],n=pt(t).openCursor();return n.onerror=function(){e.reject(n.error)},n.onsuccess=function(t){(t=t.target.result)?(i.push(t.key),t["continue"]()):e.resolve(i)},e}function gt(t,e){return yt(pt(t),e).then(u(t,function(t){return t.session_ids=b(t.session_ids),t.hasOwnProperty("duration")||t.hasOwnProperty("key_system")?Promise.resolve(t):mt(this,t.stream_ids[0]).then(function(e){return t.duration=e.duration,t.key_system=e.key_system,t.license_server=e.license_server,t.with_credentials=e.with_credentials,t.distinctive_identifier=e.distinctive_identifier,t.audio_robustness=e.audio_robustness,t.video_robustness=e.video_robustness,Promise.resolve(t)})}))}function mt(t,e){return yt(ft(t),e)}function wt(t,e,i){return yt(ct(t).index("segment"),[e,i]).then(function(t){return Promise.resolve(t.content)})}function Tt(t,e,i){MediaSource.isTypeSupported(e),e=t.addSourceBuffer(e),this.v=t,this.c=e,this.l=i,this.i=new nt,this.g=null,this.b=[],this.w=0,this.f=this.a=null,this.u=0,rt(this.i,this.c,"updateend",this.B.bind(this))}function Et(t,e){for(var i=t.c.buffered,n=0;n<i.length;++n){var r=i.start(n)-$r,s=i.end(n)+$r;if(e>=r&&s>=e)return i.end(n)-e}return 0}function kt(t,e,i,n){if(t.a)return t=Error("Cannot fetch ("+t.j+"): previous operation not complete."),t.type="stream",Promise.reject(t);t.a=new Q,i!=t.c.timestampOffset&&(t.c.timestampOffset=i),"idb"!=e.url.b[0].P||t.g||(t.g=new bt,tt(t.a,function(){return[ht(this.g)]}.bind(t))),n&&tt(t.a,function(){return[_t(this,n),this.h.bind(this)]}.bind(t)),tt(t.a,function(){var t=e.a?e.a-e.b:1,i=new Ne;return i.a=3,i.h=1e3*t,i.c=1e3*this.u,i.i=this.g,[Be(e.url,i,this.l),Le.prototype.g.bind(e.url)]}.bind(t)),tt(t.a,u(t,function(t){return this.l.getBandwidth(),[_t(this,t),this.h.bind(this)]}));var r=0==t.c.buffered.length&&0==t.b.length,s=null;return tt(t.a,function(){if(0==this.c.buffered.length){var t=Error("Failed to buffer segment ("+this.j+").");return t.type="stream",[Promise.reject(t)]}r&&(t=e.b,s=this.c.buffered.start(0)-t),t=He(this.b,e.b),t>=0?this.b.splice(t+1,0,e):this.b.push(e)}.bind(t)),At(t).then(function(){return Promise.resolve(s)}.bind(t))}function Pt(t){return t.a?(t=Error("Cannot clear ("+t.j+"): previous operation not complete."),t.type="stream",Promise.reject(t)):(t.a=new Q,tt(t.a,function(){var t;t:if(0==this.c.buffered.length)t=Promise.resolve();else{try{this.c.remove(0,Number.POSITIVE_INFINITY)}catch(e){t=Promise.reject(e);break t}this.b=[],t=this.f=new h}return[t,this.h.bind(this)]}.bind(t)),At(t))}function St(t,e){if(t.a){var i=Error("Cannot clearAfter ("+t.j+"): previous operation not complete.");return i.type="stream",Promise.reject(i)}return t.a=new Q,tt(t.a,function(){return[Mt(this,e),this.h.bind(this)]}.bind(t)),At(t)}function jt(t){return t.a?(t=t.a,t.a?t=t.a:t.f?(t.c&&t.c(),t.a=new h,t=t.a):(t.f=!0,t=Promise.resolve())):t=Promise.resolve(),t}function At(t){return t.a.start(),t.a.g.then(u(t,function(){this.a=null}))["catch"](u(t,function(t){return this.a=null,Promise.reject(t)}))}function _t(t,e){try{t.c.appendBuffer(e)}catch(i){return Promise.reject(i)}return t.f=new h,t.f}function Mt(t,e){if(0==t.c.buffered.length)return Promise.resolve();var i=He(t.b,e);if(-1==i||i==t.b.length-1)return Promise.resolve();try{t.c.remove(t.b[i+1].b,Number.POSITIVE_INFINITY)}catch(n){return Promise.reject(n)}return t.b=t.b.slice(0,i+1),t.f=new h,t.f}function It(t){var e=console[t];e?e.bind||(console[t]=function(){e.apply(console,arguments)}):console[t]=function(){}}function Nt(){this.fontSize="100%",this.fontColor=Xr,this.fontOpacity=Qr,this.backgroundColor=Zr,this.backgroundOpacity=Qr,this.fontEdge=ts}function Rt(t){var e=[];e.push("font-size: "+t.fontSize),e.push("color: "+Ct(t.fontColor,t.fontOpacity)),e.push("background-color: "+Ct(t.backgroundColor,t.backgroundOpacity));for(var i=[],n=0;n<t.fontEdge.length;++n){var r=t.fontEdge[n].slice(3,6);i.push(Ct(t.fontEdge[n].slice(0,3),t.fontOpacity)+" "+r.join("px ")+"px")}return e.push("text-shadow: "+i.join(",")),e.join("; ")}function Ct(t,e){return"rgba("+t.concat(e).join(",")+")"}function xt(t){this.systemIds=[],this.cencKeyIds=[],this.a=[],t=new G(new DataView(t.buffer));try{for(;Y(t);){var e=t.a,i=W(t),n=W(t);if(1==i?i=$(t):0==i&&(i=t.b.byteLength-e),1886614376!=n)Z(t,i-(t.a-e));else{var r=J(t);if(r>1)Z(t,i-(t.a-e));else{Z(t,3);var s=w(X(t)),a=[];if(r>0)for(var o=W(t),h=0;o>h;++h){var u=w(X(t));a.push(u)}var l=W(t);Z(t,l),this.cencKeyIds.push.apply(this.cencKeyIds,a),this.systemIds.push(s),this.a.push({start:e,end:t.a-1}),t.a!=e+i&&Z(t,i-(t.a-e))}}}}catch(c){}}function Dt(t){is[t]={ma:es(),end:NaN}}function Ot(t){(t=is[t])&&(t.end=es())}function Lt(t){return(t=is[t])&&t.end?t.end-t.ma:NaN}function Ut(t){if(this.c=[],this.a=[],this.la=ns,t)try{t(this.f.bind(this),this.b.bind(this))}catch(e){this.b(e)}}function Bt(){t.Promise||(t.Promise=Ut,qt=t.setImmediate?function(e){t.setImmediate(e)}:function(e){t.setTimeout(e,0)})}function Kt(t,e,i){qt(function(){if(i&&"function"==typeof i){try{var t=i(this.va)}catch(n){return void e.b(n)}t instanceof Ut?t==e?e.b(new TypeError("Chaining cycle detected")):t.then(e.f.bind(e),e.b.bind(e)):e.f(t)}else 1==this.la?e.f(this.va):e.b(this.va)}.bind(t))}function qt(){}function Ft(t,e){try{var i=new Vt(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function Vt(t,e){this.keySystem=t;for(var i=!1,n=0;n<e.length;++n){var r=e[n],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"]},a=!1;if(r.audioCapabilities)for(var o=0;o<r.audioCapabilities.length;++o){var h=r.audioCapabilities[o];if(h.contentType){var a=!0,u=h.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,u)&&(s.audioCapabilities.push(h),i=!0)}}if(r.videoCapabilities)for(o=0;o<r.videoCapabilities.length;++o)h=r.videoCapabilities[o],h.contentType&&(a=!0,u=h.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,u)&&(s.videoCapabilities.push(h),i=!0));if(a||(i=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(s.persistentState="required",s.sessionTypes=["persistent-license"]),i)return void(this.a=s)}throw i=Error("Unsupported keySystem"),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function Ht(t){var e=this.mediaKeys;return e&&e!=t&&Gt(e,null),delete this.mediaKeys,(this.mediaKeys=t)?Gt(t,this):Promise.resolve()}function zt(t){this.a=new MSMediaKeys(t),this.b=new nt}function Gt(t,e){function i(){e.msSetMediaKeys(n.a),e.removeEventListener("loadedmetadata",i)}if(st(t.b),!e)return Promise.resolve();rt(t.b,e,"msneedkey",Jt);var n=t;try{return 1<=e.readyState?e.msSetMediaKeys(t.a):e.addEventListener("loadedmetadata",i),Promise.resolve()}catch(r){return Promise.reject(r)}}function Yt(t){V.call(this,null),this.c=null,this.g=t,this.b=this.a=null,this.f=new nt,this.sessionId="",this.expiration=NaN,this.closed=new h,this.keyStatuses=new Zt}function Jt(t){var e=t.initData;if(e){var i=new xt(e);if(1>=i.a.length)t=e;else{var n=[];for(t=0;t<i.a.length;t++)n.push(e.subarray(i.a[t].start,i.a[t].end+1));for(e=b(n,Wt),t=i=0;t<e.length;t++)i+=e[t].length;for(i=new Uint8Array(i),t=n=0;t<e.length;t++)i.set(e[t],n),n+=e[t].length;t=i}}else t=e;t=B({type:"encrypted",initDataType:"cenc",initData:t}),this.dispatchEvent(t)}function Wt(t,e){return T(t,e)}function $t(t,e){t.keyStatuses.La(e);var i=B({type:"keystatuseschange"});t.dispatchEvent(i)}function Xt(t){this.b=t,this.a=0}function Zt(){this.size=0,this.a=void 0}function Qt(){var e="CustomEvent"in t;if(e)try{new CustomEvent("")}catch(i){e=!1}e||(t.CustomEvent=te)}function te(t,e){var i=document.createEvent("CustomEvent"),n=e||{bubbles:!1,cancelable:!1,detail:null};return i.initCustomEvent(t,!!n.bubbles,!!n.cancelable,n.detail),i}function ee(){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=ie)}function ie(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function ne(){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,t=Document.prototype,t.exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitExitFullscreen,"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),document.addEventListener("webkitfullscreenchange",re),document.addEventListener("webkitfullscreenerror",re),document.addEventListener("mozfullscreenchange",re),document.addEventListener("mozfullscreenerror",re),document.addEventListener("MSFullscreenChange",re),document.addEventListener("MSFullscreenError",re)}function re(t){var e=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),e=new Event(e,t);t.target.dispatchEvent(e)}function se(){return Promise.reject(Error("The key system specified is not supported."))}function ae(t){return null==t?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function oe(){throw new TypeError("Illegal constructor.")}function he(){throw new TypeError("Illegal constructor.")}function ue(t,e){try{var i=new ce(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function le(t){var e=this.mediaKeys;return e&&e!=t&&pe(e,null),delete this.mediaKeys,(this.mediaKeys=t)&&pe(t,this),Promise.resolve()}function ce(t,e){this.a=this.keySystem=t;var i=!0;"org.w3.clearkey"==t&&(this.a="webkit-org.w3.clearkey",i=!1);var n,r=!1;n=document.getElementsByTagName("video"),n=n.length?n[0]:document.createElement("video");for(var s=0;s<e.length;++s){var a=e[s],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"]},h=!1;if(a.audioCapabilities)for(var u=0;u<a.audioCapabilities.length;++u){var l=a.audioCapabilities[u];l.contentType&&(h=!0,n.canPlayType(l.contentType.split(";")[0],this.a)&&(o.audioCapabilities.push(l),r=!0))}if(a.videoCapabilities)for(u=0;u<a.videoCapabilities.length;++u)l=a.videoCapabilities[u],l.contentType&&(h=!0,n.canPlayType(l.contentType,this.a)&&(o.videoCapabilities.push(l),r=!0));if(h||(r=n.canPlayType("video/mp4",this.a)||n.canPlayType("video/webm",this.a)),"required"==a.persistentState&&(i?(o.persistentState="required",o.sessionTypes=["persistent-license"]):r=!1),r)return void(this.b=o)}throw i="Unsupported keySystem",("org.w3.clearkey"==t||"com.widevine.alpha"==t)&&(i="None of the requested configurations were supported."),i=Error(i),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function fe(t){this.g=t,this.b=null,this.a=new nt,this.c=[],this.f={}}function pe(t,e){t.b=e,st(t.a),e&&(rt(t.a,e,"webkitneedkey",t.Qb.bind(t)),rt(t.a,e,"webkitkeymessage",t.Pb.bind(t)),rt(t.a,e,"webkitkeyadded",t.Nb.bind(t)),rt(t.a,e,"webkitkeyerror",t.Ob.bind(t)))}function de(t,e){var i=t.f[e];return i?i:(i=t.c.shift())?(i.sessionId=e,t.f[e]=i):null}function ye(t,e,i){V.call(this,null),this.f=t,this.h=!1,this.a=this.b=null,this.c=e,this.g=i,this.sessionId="",this.expiration=NaN,this.closed=new h,this.keyStatuses=new me}function be(t,e,i){if(t.h)return Promise.reject(Error("The session is already initialized."));t.h=!0;var n;try{if("persistent-license"==t.g)if(i)n=g("LOAD_SESSION|"+i);else{var r=new Uint8Array(e);n=g("PERSISTENT|"+v(r))}else n=new Uint8Array(e)}catch(s){return Promise.reject(s)}t.b=new h;try{t.f.webkitGenerateKeyRequest(t.c,n)}catch(a){if("InvalidStateError"!=a.name)return t.b=null,Promise.reject(a);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,n)}catch(t){this.b.reject(t),this.b=null}}.bind(t),10)}return t.b}function ve(t,e){t.keyStatuses.La(e);var i=B({type:"keystatuseschange"});t.dispatchEvent(i)}function ge(t){this.b=t,this.a=0}function me(){this.size=0,this.a=void 0}function we(){Navigator.prototype.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(ss=new Uint8Array([0]),Navigator.prototype.requestMediaKeySystemAccess=ue,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=le,t.MediaKeys=fe,t.MediaKeySystemAccess=ce):t.MSMediaKeys?(rs=new Uint8Array([0]),delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Ht,t.MediaKeys=zt,t.MediaKeySystemAccess=Vt,Navigator.prototype.requestMediaKeySystemAccess=Ft):(Navigator.prototype.requestMediaKeySystemAccess=se,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=ae,t.MediaKeys=oe,t.MediaKeySystemAccess=he))}function Te(t){var e;t instanceof Te?(Ee(this,t.P),this.aa=t.aa,this.S=t.S,ke(this,t.ga),this.O=t.O,Pe(this,t.a.clone()),this.$=t.$):t&&(e=String(t).match(as))?(Ee(this,e[1]||"",!0),this.aa=Se(e[2]||""),this.S=Se(e[3]||"",!0),ke(this,e[4]),this.O=Se(e[5]||"",!0),Pe(this,e[6]||"",!0),this.$=Se(e[7]||"")):this.a=new _e(null)}function Ee(t,e,i){t.P=i?Se(e,!0):e,t.P&&(t.P=t.P.replace(/:$/,""))}function ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.ga=e}else t.ga=null}function Pe(t,e,i){e instanceof _e?t.a=e:(i||(e=je(e,ls)),t.a=new _e(e))}function Se(t,e){return t?e?decodeURI(t):decodeURIComponent(t):""}function je(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,Ae),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ae(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(15&t).toString(16)}function _e(t){this.b=t||null}function Me(t,e,i){if(!t.a&&(t.a={},t.c=0,t.b))for(var n=t.b.split("&"),r=0;r<n.length;r++){var s=n[r].indexOf("="),a=null,o=null;s>=0?(a=n[r].substring(0,s),o=n[r].substring(s+1)):a=n[r],a=decodeURIComponent(a.replace(/\+/g," ")),o=o||"",Me(t,a,decodeURIComponent(o.replace(/\+/g," ")))}t.b=null,(n=t.a.hasOwnProperty(e)&&t.a[e])||(t.a[e]=n=[]),n.push(i),t.c++}function Ie(t,e){this.url=t,this.b=e||new Ne,this.g=this.i=this.h=0,this.a=null,this.c=new h,this.f=null}function Ne(){this.body=null,this.a=1,this.h=1e3,this.c=0,this.method="GET",this.f="arraybuffer",this.b={},this.g=this.j=!1,this.i=null}function Re(t){Ce(t),t.b.body=null,t.c.destroy(),t.c=null,t.f=null}function Ce(t){t.a&&(t.a.onload=null,t.a.onreadystatechange=null,t.a.onerror=null,t.a.ontimeout=null),t.a=null}function xe(t){var e=t.url.split("/");return wt(t.b.i,parseInt(e[2],10),parseInt(e[3],10)).then(u(t,function(t){var e=JSON.parse(JSON.stringify(new XMLHttpRequest));return e.response=t,t=this.c,t.resolve(e),Re(this),t}))["catch"](u(t,function(t){return Re(this),Promise.reject(t)}))}function De(t,e,i){return e=Error(e),e.type=i,e.status=t.a.status,e.url=t.url,e.method=t.b.method,e.body=t.b.body,e.$b=t.a,e}function Oe(e){Ce(e),t.setTimeout(e.qb.bind(e),e.g*(1+.5*(2*Math.random()-1))),e.g*=2}function Le(t,e,i,n){this.b=e,this.f=i||0,this.h=null!=n?n:null,this.c=this.a=null,this.i=t}function Ue(t,e){return t&&0!==t.length?t.map(function(t){return t.resolve(e)}):[e]}function Be(t,e,i){return t.a?t.a:(e=e||new Ne,(t.f||t.h)&&(e.b.Range="bytes="+(t.f+"-"+(null!=t.h?t.h:""))),t.a=Ke(t,0,e,i),t.a)}function Ke(t,e,i,n){var r=t.b[e].toString();return t.i&&(r=t.i(r,i.b)||r),t.c=new Ie(r,i),n&&(t.c.f=n),r=t.c.qb().then(u(t,function(t){return this.c=this.a=null,Promise.resolve(t.response)})),r=r["catch"](u(t,function(t){return this.a&&e+1<this.b.length?this.a=Ke(this,e+1,i,n):(this.a=this.c=null,Promise.reject(t))}))}function qe(t,e){this.a=t,this.b=e||null}function Fe(t,e,i){this.b=t,this.a=e,this.url=i}function Ve(t,e,i){return new Fe(e,i,t.url)}function He(t,e){for(var i=t.length-1;i>=0;--i){var n=t[i];if(e>=n.b&&(null==n.a||e<n.a))return i}return-1}function ze(t,e){return t.map(function(t){return Ve(t,t.b+e,null!=t.a?t.a+e:null)})}function Ge(){}function Ye(){}function Je(t){this.o=t,this.i=0}function We(t){if(0==t.o.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return t.o[0]}function $e(t,e){if(t.i!=e.i&&(e=new Je(ze(e.o,t.i-e.i))),0==t.length())t.o=e.o.slice(0);else if(0!=e.length()&&null!=t.A().a&&!(null!=e.A().a&&e.A().a<t.A().a)){if(t.A().a<=We(e).b)var i=Ve(t.A(),t.A().b,We(e).b),i=t.o.slice(0,-1).concat([i]);else{var n;for(n=0;n<t.o.length&&!(t.o[n].a>=We(e).b);++n);t.o[n].b<We(e).b?(i=Ve(t.o[n],t.o[n].b,We(e).b),i=t.o.slice(0,n).concat([i])):(We(t).b>We(e).b||We(e),i=t.o.slice(0,n))}
t.o=i.concat(e.o)}}function Xe(t){this.b=t,this.a=null}function Ze(t){this.b=t,this.a=null}function Qe(){this.C=fs++,this.id=this.D=this.H=null,this.c=0,this.height=this.width=this.bandwidth=null,this.b=this.a="",this.f=[],this.N=!1,this.J=!0}function ti(t){var e=t.a||"";return t.b&&(e+='; codecs="'+t.b+'"'),e}function ei(){this.C=ps++,this.id=null,this.contentType=this.lang="",this.b=!1,this.m=[],this.a=[]}function ii(t){for(var e=[],i=0;i<t.a.length;++i){var n=new si;n.id=t.C,n.a=t.a[i],n.contentType=t.contentType,n.b=t.m.length?ti(t.m[0]):"",e.push(n)}return e}function ni(){this.id=null,this.start=0,this.b=null,this.a=[]}function ri(){this.b=!1,this.h=this.g=this.f=null,this.c=0,this.a=[]}function si(){this.id=0,this.a=null,this.b=this.contentType=""}function ai(t,e){V.call(this,t),this.b=e,this.g=!0,this.h=this.f=null,this.c=new h,this.a=null}function oi(t,e,i,n,r){V.call(this,t),this.c=e,this.a=new Tt(i,n,r),this.w=this.I=this.b=null,this.K=!1,this.g=null,this.l=!1,this.i=null,this.u=!1,this.h=new h,this.j=this.f=!1,this.B=0,this.L=15,this.F=!1}function hi(t,e,i){t.b&&!t.l&&(t.l=!0,di(t),jt(t.a).then(u(t,function(){var t=this.c.currentTime;return!e&&0<Et(this.a,t)&&0<=He(this.a.b,t)?Promise.resolve():i?St(this.a,this.c.currentTime+i):(this.F=!0,Pt(this.a))})).then(u(t,function(){this.l=!1,pi(this,0)}))["catch"](u(t,function(t){this.l=!1,this.f?(t=K(t),this.dispatchEvent(t)):this.h.reject(t)})))}function ui(t,e,i){t=t.a;var n=t.b.length;return t=n>0?t.b[n-1]:null,null!=t?null!=t.a?i.ja(t.a):null:i.ja(e)||(i.length()?i.A():null)}function li(t){if(!t.u&&null!=t.i){t.u=!0;var e=t.a,i=t.i,n=i-e.w;0!=n&&(e.b=ze(e.b,n),e.w=i),t.h.resolve(t.i)}}function ci(t,e){var i;i=e.a.split("/")[0],i=B({type:"adaptation",bubbles:!0,contentType:i,size:"video"!=i?null:{width:e.width,height:e.height},bandwidth:e.bandwidth}),t.dispatchEvent(i)}function fi(t){var e=B({type:"ended"});t.dispatchEvent(e)}function pi(e,i){e.g=t.setTimeout(e.Mb.bind(e),i)}function di(e){null!=e.g&&(t.clearTimeout(e.g),e.g=null)}function yi(){this.streamStats=null,this.droppedFrames=this.decodedFrames=NaN,this.bufferingTime=this.playTime=this.estimatedBandwidth=0,this.playbackLatency=NaN,this.bufferingHistory=[],this.bandwidthHistory=[],this.streamHistory=[]}function bi(t,e){var i=new vi(e);t.streamHistory.push(new gi(i)),(i.videoHeight||!t.streamStats)&&(t.streamStats=i)}function vi(t){this.videoWidth=t.width,this.videoHeight=t.height,this.videoMimeType=t.a,this.videoBandwidth=t.bandwidth}function gi(t){this.timestamp=N()/1e3,this.value=t}function mi(t,e,i,n,r,s){this.b=new Le(null,[new Te(t)]),this.a=new Ne,this.a.body=e,this.a.method=i,this.a.a=3,this.a.j=n,this.a.c=1e3*(null!=s?s:0),t=r||{};for(var a in t)this.a.b[a]=t[a]}function wi(t){return Be(t.b,t.a).then(function(t){return Promise.resolve(new Uint8Array(t))})}function Ti(t,e,i){V.call(this,t),this.h=e,this.b=i,this.a=this.i=null,this.l=new nt,this.c=[],this.f=[],this.u=0,this.g=new h,this.j=null,this.w=0}function Ei(e,i){return null==e.j&&(e.j=t.setTimeout(function(){var t=Error("Timeout waiting for sessions.");t.type="storage",this.g.reject(t)}.bind(e),i)),e.g}function ki(t){return Promise.all(t.f.map(function(t){return t.remove()}))}function Pi(t,e,i){for(var n in e)i=i["catch"](function(t,e){return navigator.requestMediaKeySystemAccess(t,[e])}.bind(null,n,e[n]));return t.b.fa()&&(i=i["catch"](function(){throw Error("Either none of the requested key systems are supported or none of the requested key systems support persistent state.")})),i}function Si(){var t=Error("EmeManager destroyed");return t.type="destroy",Promise.reject(t)}function ji(t){for(var e=t.b.ta(),i=0;i<e.length;++i){var n=Ai(t),r=n.load(e[i]);t.f.push(n),r.then(u(t,function(){this.u++,this.u>=this.f.length&&this.g.resolve()}))["catch"](u(t,function(t){t=K(t),this.dispatchEvent(t)}))}}function Ai(t){var e=null;if(t.b.fa())try{e=t.i.createSession("persistent-license")}catch(i){throw Error("Persistent licenses are not supported by this key system or platform.")}else e=t.i.createSession();return rt(t.l,e,"message",t.Ib.bind(t)),rt(t.l,e,"keystatuseschange",t.xb.bind(t)),e}function _i(t,e,i,n){n=Mi(i,n),wi(new mi(n.url,n.body,n.method,i.i,n.headers,t.w)).then(u(t,function(t){return i.l&&(t=i.l(t)),e.update(t)})).then(u(t,function(){var t=B({type:"sessionReady",detail:e});this.dispatchEvent(t),this.u++,this.u>=this.f.length&&this.g.resolve()}))["catch"](u(t,function(t){t.Ka=e,t=K(t),this.dispatchEvent(t)}))}function Mi(e,i){var n={url:e.h,body:i.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===e.a){for(var r=String.fromCharCode.apply(null,new Uint16Array(n.body)),r=(new DOMParser).parseFromString(r,"application/xml"),s=r.getElementsByTagName("name"),a=r.getElementsByTagName("value"),o=0;o<s.length;o++)n.headers[s[o].childNodes[0].nodeValue]=a[o].childNodes[0].nodeValue;n.body=t.atob(r.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!e.u)return n;if(e.u(n),n.url=f(n,"url"),null==n.url)throw Error("'url' cannot be null.");if(!(n.body instanceof ArrayBuffer||"string"==typeof n.body||null==n.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");if(n.method=f(n,"method"),"GET"!=n.method&&"POST"!=n.method)throw Error("'method' must be either 'GET' or 'POST'.");if(n.headers=d(n,"headers",Object),null==n.headers)throw Error("'headers' cannot be null.");return n}function Ii(t){V.call(this,null),this.a=t,this.b=null,this.f=new nt,this.i=this.j=null,this.F=0,this.w=null,this.h=!1,this.g=new yi,this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new r},this.l=1,this.G=null}function Ni(e){return"text/vtt"==e?!!t.VTTCue:MediaSource.isTypeSupported(e)}function Ri(){var t=Error("Player destroyed");return t.type="destroy",Promise.reject(t)}function Ci(e){e.i&&(t.clearTimeout(e.i),e.i=null)}function xi(e){Di(e),e.w=t.setTimeout(e.L.bind(e),100)}function Di(e){e.w&&(t.clearTimeout(e.w),e.w=null)}function Oi(t){Ot("buffering");var e=t.g;e.bufferingTime+=Lt("buffering")/1e3,t.h=!1,t.dispatchEvent(B({type:"bufferingEnd"}))}function Li(t){for(var e=0;e<t.length;++e)for(var i=t[e],n=0;n<i.a.length;++n){for(var r=i.a[n],s=r,a=0;a<s.m.length;++a)Ni(ti(s.m[a]))||(s.m.splice(a,1),--a);0==r.m.length&&(i.a.splice(n,1),--n)}}function Ui(t){for(var e=0;e<t.length;++e)for(var i=t[e],n=0;n<i.a.length;++n)i.a[n].m.sort(Bi)}function Bi(t,e){var i=t.bandwidth||Number.MAX_VALUE,n=e.bandwidth||Number.MAX_VALUE;return n>i?-1:i>n?1:0}function Ki(t){this.a=t}function qi(t){function e(t,e){return t.concat(e)}var i=t.a.map(function(t){return t.a}).reduce(e,[]).map(function(t){return t.m}).reduce(e,[]);return t=i.map(function(t){return t.H.create()}),Promise.all(t).then(function(t){for(var e={},n=0;n<i.length;++n)e[i[n].C]=t[n];return Promise.resolve(e)})}function Fi(t,e,i,n,r){var s=new A;t.a.forEach(function(t,e){s.push(t.id||""+e,t)});var a=new A;for(e.a.forEach(function(t,e){a.push(t.id||""+e,t)}),t=I(s),e=0;e<t.length;++e){var o=t[e],h=s.get(o);1<h.length||(o=a.get(o))&&0!=o.length&&1==o.length&&(Vi(h[0],o[0],i,n,r),h[0].b=o[0].b)}}function Vi(t,e,i,n,r){var s=new A;t.a.forEach(function(t,e){s.push(t.id||""+e,t)});var a=new A;for(e.a.forEach(function(t,e){a.push(t.id||""+e,t)}),t=I(s),e=0;e<t.length;++e){var o=t[e],h=s.get(o);1<h.length||(o=a.get(o))&&0!=o.length&&1==o.length&&Hi(h[0],o[0],i,n,r)}}function Hi(t,e,i,n,r){var s=new A;t.m.forEach(function(t,e){s.push(t.id||""+e,t)});var a=new A;e.m.forEach(function(t,e){a.push(t.id||""+e,t)}),e={};for(var o=I(s),h=0;h<o.length;++h){var u=o[h];e[u]=u;var l=s.get(u);1<l.length||((u=a.get(u))&&0!=u.length?1==u.length&&(zi(l[0],u[0],i,n),l[0].D=u[0].D,u[0].D=null,l[0].c=u[0].c):(r.push(l[0]),t.m.splice(t.m.indexOf(l[0]),1)))}for(o=I(a),h=0;h<o.length;++h)u=o[h],e[u]||(e[u]=u,u=a.get(u),t.m.push(u[0]))}function zi(t,e,i,n){t=i[t.C],e=n[e.C],t.length(),t.Ga(e)&&t.length()}function Gi(){this.a=this.b=null,this.f=new nt,this.c=Number.POSITIVE_INFINITY,this.i=!0,this.g=!1}function Yi(t){var e=t.a.ka();if(0==e.length)return null;e.sort(a);var i;t:{i=t.a.oa();for(var n=0;n<i.length;++n)if(i[n].active){i=i[n];break t}i=null}i=i?i.bandwidth:0,t=t.b.getBandwidth();for(var n=e[0],r=0;r<e.length;++r){var s=e[r],o=r+1<e.length?e[r+1]:{bandwidth:Number.POSITIVE_INFINITY};if(s.bandwidth&&(o=(o.bandwidth+i)/.85,t>=(s.bandwidth+i)/.95&&o>=t&&(n=s,n.active)))break}return n}function Ji(t,e,i){V.call(this,null),this.f=t,this.c=e,this.b=x(i),this.a=null}function Wi(t,e,i){V.call(this,null),this.a=t,this.Y=e,this.i=new nt,this.g=new MediaSource,this.f=null,this.ba=0,this.b=new A,this.I=i,this.I.initialize(e,this),this.L=!1,this.K="en",this.da=!1,this.U=null,this.B=new h,this.h=new r,this.F=null,this.Ua=1,this.c={},this.ca=new h,this.Sa=0,this.Ta=15,this.w=null,this.Qa=this.Ra=!1,this.u={},this.Z=this.X=this.V=null,this.G={}}function $i(e,i){if(null!=e.a.f){var n=Math.max(e.a.f,3),n=Math.max(n-i,0);e.V=t.setTimeout(e.hb.bind(e,!1),1e3*n)}}function Xi(t,e){var i=e.a.split("/")[0],n=t.c[i];if(n&&n.na()==e){var r=t.b.get(e.a.split("/")[0]),s=r.map(function(t){return t.m}).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t.N&&t.J});if(0==s.length)return void r.push(e);t.u[i].Oa==e&&delete t.u[i],n.qa(s[0],!0),e.destroy()}e.destroy()}function Zi(t){if(t.h){for(var e=!1,i=0;i<t.a.a.length;++i)for(var n=t.a.a[i],r=0;r<n.a.length;++r){var s=n.a[r];if("video"==s.contentType)for(var a=0;a<s.m.length;++a){var o=s.m[a],h=o.J;o.J=!0,t.h.maxWidth&&o.width>t.h.maxWidth&&(o.J=!1),t.h.maxHeight&&o.height>t.h.maxHeight&&(o.J=!1),t.h.minHeight&&o.height<t.h.minHeight&&(o.J=!1),t.h.maxBandwidth&&o.bandwidth>t.h.maxBandwidth&&(o.J=!1),t.h.minBandwidth&&o.bandwidth<t.h.minBandwidth&&(o.J=!1),h!=o.J&&(e=!0)}}0!=_(t.b).length&&e&&(Qi(t),0<t.ka().length||(e=Error("The application has restricted all video tracks!"),e.type="app",e=K(e),t.dispatchEvent(e)))}}function Qi(t){var e=B({type:"trackschanged",bubbles:!0});t.dispatchEvent(e)}function tn(t,e,i,n,r){if(!t.b.a.hasOwnProperty(e)||!t.c[e])return!1;for(var s=t.b.get(e),a=0;a<s.length;++a)for(var o=s[a],h=0;h<o.m.length;++h){var u=o.m[h];if(u.C==i)return u.N&&u.J?"text"==e||t.Qa?(bi(t.U,u),t.c[e].qa(u,n,r),!0):(i=t.u[e],t.u[e]={Oa:u,Wa:null!=i&&i.Wa||n,Xa:null!=i&&i.Xa||r},!0):!1}return!1}function en(t,e){for(var i=0;2>=i;++i)for(var n=0;n<e.length;++n){var r=e[n];if(q(i,t.K,r.lang))return e.splice(n,1),void e.splice(0,0,r)}for(n=0;n<e.length;++n)if(r=e[n],r.b){e.splice(n,1),e.splice(0,0,r);break}}function nn(e){for(var i=[],n=["audio","video","text"],r=0;r<n.length;++r){var s=n[r];e.b.a.hasOwnProperty(s)&&i.push(e.b.get(s)[0])}for(var a=rn(e,i),r=0;r<n.length;++r)if(s=n[r],e.b.a.hasOwnProperty(s)&&!a[s])return e=Error("Unable to select an initial "+s+" stream: all "+s+" streams have been restricted (by the application or by the key system)."),e.type="stream",Promise.reject(e);return i=l(a).map(function(t){return t.H.create()}),Promise.all(i).then(u(e,function(t){return t.every(function(t){return t.length()})&&(t=pn(this,t))?sn(this,a)?(this.I.start(),on(this,a,t),Promise.resolve()):(t=Error("Failed to create Stream objects."),t.type="stream",Promise.reject(t)):(t=Error("Some streams are not available."),t.type="stream",Promise.reject(t))}))["catch"](u(e,function(e){return"aborted"!=e.type?(Object.keys(this.c),this.a.b?(N()<this.a.h?(e=Math.max(this.a.h-Date.now()/1e3,3),this.V=t.setTimeout(this.hb.bind(this,!0),1e3*e)):$i(this,0),Promise.resolve()):Promise.reject(e)):void 0}))}function rn(t,e){for(var i={},n=0;n<e.length;++n){var r=e[n],s=null;if("video"==r.contentType){var a=t.I.getInitialVideoTrackId();if(null==a)continue;if(s=r.m.filter(function(t){return t.C==a}),0==s.length)continue;s=s[0]}else if("audio"==r.contentType){if(s=r.m.filter(function(t){return t.N&&t.J}),0==s.length)continue;s=r.m[Math.floor(s.length/2)]}else 0<r.m.length&&(s=r.m[0]);i[r.contentType]=s}return i}function sn(t,e){var i,n={};for(i in e){var r=e[i],r="text"==i?new ai(t,t.f):an(t,r);if(!r)return l(n).forEach(function(t){t.destroy()}),!1;n[i]=r}return t.c=n,!0}function an(t,e){var i=new oi(t,t.f,t.g,ti(e),t.Y);return i.G(t.G),i}function on(t,e,i){t.Ua=t.f.playbackRate,t.f.playbackRate=0,un(t,i);var n;t.Z&&t.Z<=i.end&&t.Z>=i.start?n=t.Z:t.a.b?(n=i.end,t.Ra=!0):n=i.start,rt(t.i,t.f,"seeking",t.Hb.bind(t)),t.f.currentTime!=n&&(t.f.currentTime=n,t.F=n),ln(t,i.start,i.end),i=[];for(var r in t.c){n=t.c[r],i.push(n.rb(t.ca)),rt(t.i,n,"ended",t.Jb.bind(t));var s=e[r];bi(t.U,s),n.qa(s,!1)}Promise.all(i).then(t.tb.bind(t))["catch"](u(t,function(t){"destroy"!=t.type&&(t=K(t),this.dispatchEvent(t))})),t.Ma(t.da)}function hn(t,e,i){(e=pn(t,e))&&(un(t,e),ln(t,e.start,e.end)),0!=i&&(i=t.f.currentTime+i,t.f.currentTime=i,t.F=i),t.Ra&&e&&(t.f.currentTime=e.end),t.f.playbackRate=t.Ua,t.a.b&&null!=t.a.f&&$i(t,0),dn(t),t.ca.resolve()}function un(t,e){if(t.a.b)isNaN(t.g.duration)&&(t.g.duration=e.end+2592e3);else if(isNaN(t.g.duration)||e.end>t.g.duration){t.g.duration=e.end;for(var i=0;i<t.g.sourceBuffers.length;++i)t.g.sourceBuffers[i].appendWindowEnd=e.end}}function ln(t,e,i){e=B({type:"seekrangechanged",bubbles:!0,start:e,end:i}),t.dispatchEvent(e)}function cn(t,e,i,n){if(e>=i-.01)return!1;if(e=0,t.a.b){e=.5;for(var r in t.c)if(!t.c[r].kb(i+e)){e=t.a.c;break}}return t.f.currentTime=Math.min(i+e,n),!0}function fn(t){return l(t.c).map(function(t){return t.bb()}).filter(function(t){return null!=t})}function pn(t,e){for(var i=0,n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=0;s<e.length;++s){var a=e[s].Da(),i=Math.max(i,a.start);null!=a.end&&(n=Math.min(n,a.end)),e[s].length()&&(r=Math.min(r,e[s].A().a))}if(n==Number.POSITIVE_INFINITY){if(n=t.a.a[0],!n.b)return null;n=(n.start||0)+n.b}return t.a.b&&(n=Math.max(n-t.a.c,i)),i>n?null:{start:i,end:n,A:r}}function dn(e){e.a.b&&(e.X=t.setTimeout(e.Lb.bind(e),1e3))}function yn(t){for(var e in t.c)t.c[e].G(t.G)}function bn(t,e){ot.call(this,"readwrite",e),this.j=t,this.b=0}function vn(t,e,i,n,r){for(var s=[],a=[],o=0,l=0,c=[],f=e.map(function(t){return t.H.create()}),f=Promise.all(f),p=e.map(function(t){return t.D.create()}),p=Promise.all(p),f=Promise.all([f,p]).then(function(t){s=t[0],a=t[1],o=s.reduce(function(t,e){return t+e.length()},0)}),p=0;p<e.length;++p)f=f.then(function(t){return mn(this,e[t],s[t],a[t],o,l)}.bind(t,p)),f=f.then(function(t,e){l+=s[t].length(),c.push(e)}.bind(t,p));return f.then(u(t,function(){return wn(pt(this))})).then(u(t,function(t){var e=new h;i=b(i);var s={group_id:t,stream_ids:c,session_ids:i,duration:n,key_system:r.a,license_server:r.h,with_credentials:r.i,distinctive_identifier:r.g,audio_robustness:r.f,video_robustness:r.j},a=pt(this).put(s);return a.onsuccess=function(){e.resolve(t)},a.onerror=function(){e.reject(a.error)},e}))}function gn(t,e){return yt(pt(t),e).then(u(t,function(t){var i,n=[];for(i in t.stream_ids)n.push(En(this,t.stream_ids[i]));return t=pt(this),n.push(t["delete"](e)),Promise.all(n)}))}function mn(t,e,i,n,r,s){var a=[wn(ft(t)),wn(ct(t).index("stream"))],a=Promise.all(a).then(u(t,function(t){return{pa:Math.max(t[0],t[1]),ha:new ArrayBuffer(0),Ia:0,o:[],Ba:null,Yb:r,ib:s}})),a=a.then(t.f.bind(t,i));return a=a.then(t.g.bind(t,e,n))}function wn(t){var e=new h,i=t.openCursor(null,"prev");return i.onsuccess=function(t){t.target.result?e.resolve(t.target.result.key+1):e.resolve(0)},i.onerror=function(){e.reject(i.error)},e}function Tn(t,e){var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer}function En(t,e){var i=new h,n=ft(t)["delete"](e);n.onerror=function(){i.reject(n.error)};var r=ct(t);return r.index("stream").openKeyCursor(IDBKeyRange.only(e)).onsuccess=function(t){(t=t.target.result)&&(r["delete"](t.primaryKey),t["continue"]())},r.transaction.oncomplete=function(){i.resolve()},i}function kn(t,e,i,n){Je.call(this,t),this.g=e,this.w=i,this.f=n,this.h=this.g.b||this.g.a.reduce(function(t,e){return null==e.a?NaN:t+e.a},0)||0,this.a=this.l=this.c=null,Pn(this)}function Pn(t){if(An(t),0!=t.length()){t.length();var e=null!=t.A().a?t.A().a:t.A().b;if(t.g.c>t.f)t.c=e;else{var i=t.f-(t.g.c+t.w.start);0>i?t.c=e:i<Math.max(t.A().b,t.A().a||0)?(t.A(),t.c=e):t.c=i}t.l=t.A().b,t.a=We(t).b}}function Sn(t,e){if(jn(t,e),null==t.c||null==t.l||null==t.a)return{start:0,end:0};var i=Number.POSITIVE_INFINITY;t.h&&(i=t.h);var n=e-t.f,r=t.c+n;return null!=t.g.f&&(r=r-t.a-t.g.f,r>0&&(t.a+=r)),t.a=Math.min(t.a,i),n=t.l+n,n<t.a?{start:t.a,end:t.a}:(n=0<t.length()?null!=t.A().a?Math.min(n,t.A().a):n:t.a,n=Math.max(n,t.a),n=Math.min(n,i),{start:t.a,end:n})}function jn(t,e){if(An(t),null!=t.g.f)if(null==t.c)t.length();else{for(var i=t.c+(e-t.f),n=0,r=0;r<t.o.length;++r){var s=null;if(r<t.o.length-1?s=t.o[r+1].a:(s=t.o[r],s=null!=s.a?s.a+(s.a-s.b):null),!(null!=s&&s<i-t.g.f))break;++n}n>0&&t.o.splice(0,n)}}function An(t){if(t.h){for(var e=0,i=t.o.length-1;i>=0&&t.o[i].b>t.h;--i)++e;e>0&&t.o.splice(-e)}}function _n(t,e,i,n,r,s,a){this.g=t,this.i=e,this.f=i,this.a=n,this.c=r,this.j=s,this.b=null,this.h=a}function Mn(t,e,i,n,r){this.b=t,this.c=e,this.f=i,this.h=n,this.a=null,this.g=r}function In(){this.id=this.url=null,this.type="static",this.b=this.j=this.s=null,this.h=5,this.f=this.c=this.g=null,this.i=1,this.a=[]}function Nn(){this.g=this.f=this.c=this.s=this.a=this.start=this.id=null,this.b=[]}function Rn(){this.i=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null,this.c=!1,this.h=this.g=this.f=this.s=null,this.j=[],this.a=[]}function Cn(){this.value=null}function xn(){this.contentType=this.lang=this.id=null}function Dn(){this.a=this.b=this.g=this.s=this.h=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null,this.c=[]}function On(){this.b=this.a=this.c=this.f=null}function Ln(){this.parsedPssh=this.psshBox=null}function Un(){this.url=null}function Bn(){this.url=null}function Kn(){this.s=null,this.g=1,this.c=this.b=this.a=this.f=null}function qn(){this.a=this.url=null}function Fn(){this.a=this.url=null}function Vn(){this.s=null,this.f=1,this.b=this.g=null,this.i=1,this.h=null,this.a=[],this.c=null}function Hn(){this.a=this.b=null}function zn(){this.a=1,this.b=this.j=null,this.c=1,this.v=!1,this.f=this.h=this.g=this.i=null}function Gn(){this.a=[]}function Yn(){this.c=this.a=this.b=null}function Jn(t,e){this.ma=t,this.end=e}function Wn(t){for(var e=[],i=0;i<t.b.length;++i){var n=t.b[i];null!=n.group&&(e[n.group]=!0)}for(i=0;i<t.b.length;++i)if(n=t.b[i],null==n.group){for(var r=1;1==e[r];)++r;e[r]=!0,n.group=r}}function $n(t,e){if(!e||0===e.length)return t;for(var i=[],n=0;n<e.length;n++){var r=e[n].url;null==t||0===t.length?i.push(new Te(r)):(r=Xn(t.slice(0,1),r),i.push(r[0]))}return i}function Xn(t,e){if(!e)return t;var i=new Te(e);return t?t.map(function(t){return t.resolve(i)}):[i]}function Zn(t,e,i){var n=rr(i);return(e=tr(e,i.constructor.TAG_NAME))&&n.parse(t,e),n}function Qn(t,e,i){var n=null;return(e=tr(e,i.TAG_NAME))&&(n=new i,n.parse(t,e)),n}function tr(t,e){for(var i=null,n=0;n<t.childNodes.length;n++)if(t.childNodes[n].tagName==e){if(i)return null;i=t.childNodes[n]}return i}function er(t,e,i){for(var n=[],r=0;r<e.childNodes.length;r++)if(e.childNodes[r].tagName==i.TAG_NAME){var s=new i;s.parse.call(s,t,e.childNodes[r]),n.push(s)}return n}function ir(t){return t=t.firstChild,t.nodeType!=Node.TEXT_NODE?null:t.nodeValue}function nr(t){return t?t.map(function(t){return t.clone()}):null}function rr(t){return t?t.clone():null}function sr(t,e,i,n){return t=i(t.getAttribute(e)),null!=t?t:void 0!==n?n:null}function ar(t){return t?(t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null}function or(e){if(!e)return null;var i=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e);if(!i)return null;e=0;var n=cr(i[1]);return n&&(e+=31536e3*n),(n=cr(i[2]))&&(e+=2592e3*n),(n=cr(i[3]))&&(e+=86400*n),(n=cr(i[4]))&&(e+=3600*n),(n=cr(i[5]))&&(e+=60*n),i=t.parseFloat(i[6]),(i=isNaN(i)?null:i)&&(e+=i),e}function hr(t){var e=/([0-9]+)-([0-9]+)/.exec(t);return e?(t=cr(e[1]),null==t?null:(e=cr(e[2]),null==e?null:new Jn(t,e))):null}function ur(e){return e=t.parseInt(e,10),isNaN(e)?null:e}function lr(e){return e=t.parseInt(e,10),e>0?e:null}function cr(e){return e=t.parseInt(e,10),e>=0?e:null}function fr(t){return t}function pr(t,e,i,n){for(var r=e.a,s=[],a=0;n>a;++a){var o=a+i,h=(o-1)*r.b,u=h/r.a,l=(h+r.b)/r.a,o=dr(t,e,r.v?o-1:o,h);if(!o)return null;s.push(new Fe(u,l,o))}return s}function dr(t,e,i,n){if(!e.a)return null;var r=e.a.i;return r?(i=yr(r,e.id,i,e.bandwidth,n))?(e=Ue(e.s,i),new Le(t,e,0,null)):null:e.s?new Le(t,e.s,0,null):null}function yr(e,i,n,r,s){var a={RepresentationID:i,Number:n,Bandwidth:r,Time:s};e=e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(e,i,n){if("$$"==e)return"$";var r=a[i];return null==r?e:("RepresentationID"==i&&n&&(n=void 0),e=r.toString(),n=t.parseInt(n,10)||1,n=Math.max(0,n-e.length),Array(n+1).join("0")+e)});try{return new Te(e)}catch(o){if(o instanceof URIError)return null;throw o}}function br(t,e,i){var n=0;e*=i,t=t.a,i=[];for(var r=0;r<t.length&&t[r].a;++r){var s=t[r].b,s=null!=s?s:n,a=t[r].c||0;0>a&&(a=t[r].a,a=r+1===t.length?Math.ceil((t[0].b+e-s)/a)-1:Math.ceil((t[r+1].b-s)/a)-1),0<i.length&&s!=n&&(i[i.length-1].end=s);for(var o=0;a>=o;++o)n=s+t[r].a,i.push({start:s,end:n}),s=n}return i}function vr(t,e){this.a=new Ne,this.a.f="text",this.a.a=3,this.a.c=1e3*(null!=e?e:0),this.a.g=!0,this.b=t}function gr(t){var e=t.b;return Be(e,t.a).then(function(t){var i;return i=e.b,(i=(t=(new DOMParser).parseFromString(t,"text/xml"))?Qn({s:i},t,In):null)?Promise.resolve(i):(i=Error("MPD parse failure."),i.type="dash",Promise.reject(i))})}function mr(t,e,i,n,r){this.c=t,this.b=e,this.g=i,this.a=null,this.h=n,this.f=r}function wr(t,e,i,n,r){var s,a=1,o=0;if(t.c>n)s=null;else{var h=t.i||0,u=t.f||0;s=i.a,s=s.b/s.a;var l=n-(t.c+e.start);0>l?s=null:(u=l-2*s-u,0>u&&(u=0),u=Math.ceil(u/s)*s,l-=s,0>l?s=null:(h=Math.floor(l/s)*s-h,0>h&&(h=0),h=Math.floor(h/s)*s,s={Ya:u/s+1,current:(h>=u?h:u)/s+1}))}if(s&&(a=s.Ya,o=s.current-s.Ya+1),a=pr(r,i,a,o),null==a)throw t=Error("Failed to generate SegmentReferences."),t.type="stream",t;kn.call(this,a,t,e,n),this.u=i,this.v=this.b=0<this.length()?t.c+e.start+this.A().a:null,this.j=s?s.current+1:null,this.B=r}function Tr(t,e){if(null!=t.b&&null!=t.v&&null!=t.j){var i=t.u.a,i=i.b/i.a,n=Math.floor((t.v+(e-t.f)-t.b)/i);if(0!=n){var r=pr(t.B,t.u,t.j,n);Array.prototype.push.apply(t.o,ze(r,t.i)),t.b+=n*i,t.j+=n}}}function Er(t,e,i,n,r){this.f=t,this.b=e,this.c=i,this.h=n,this.a=null,this.g=r}function kr(t){this.a=t}function Pr(t,e,i){for(var n=N()/1e3,r=0;r<e.a.length;++r)for(var s=e.a[r],a=0;a<s.b.length;++a){var o=s.b[a];if("text"!=o.contentType)for(var h=0;h<o.a.length;++h){var u=o.a[h],l=0,l=l+(u.g?1:0),l=l+(u.b?1:0),l=l+(u.a?1:0);0==l?(o.a.splice(h,1),--h):1!=l&&(u.g?(u.b=null,u.a=null):u.b&&(u.a=null))}}for(Sr(e),r=0;r<e.a.length;++r)for(s=e.a[r],a=0;a<s.b.length;++a){for(h=o=s.b[a],u=null,l=0;l<h.a.length;++l){var c=h.a[l].f||"";u?c!=u&&(h.a.splice(l,1),--l):u=c}0==o.a.length&&(s.b.splice(a,1),--a)}for("dynamic"==e.type&&null==e.c&&(e.c=n),r=new ri,"dynamic"==e.type&&(r.b=!0,r.f=e.g,r.g=new Le(i,e.j||e.url),r.h=e.c),r.c=e.h||5,s=0;s<e.a.length&&(a=e.a[s],null!=a.start);++s)a=jr(t,e,a,n,i),r.a.push(a);return r}function Sr(t){if(t.a.length){null==t.a[0].start&&(t.a[0].start=0);var e=function(t){return 0==t||!!t};"dynamic"==t.type&&(t.b=null),e(t.b)&&1==t.a.length&&!e(t.a[0].a)&&(t.a[0].a=t.b);for(var i=0,n=!0,r=0;r<t.a.length;++r){var s=t.a[r-1],a=t.a[r],o=t.a[r+1]||{start:t.b};!e(a.start)&&s&&e(s.start)&&e(s.a)&&(a.start=s.start+s.a),!e(a.a)&&e(o.start)&&(a.a=o.start-a.start),null!=a.start&&null!=a.a?i+=a.a:n=!1}e(t.b)||(r=t.a[t.a.length-1],n?t.b=i:e(r.start)&&e(r.a)?t.b=r.start+r.a:"dynamic"!=t.type&&(t.b=i))}}function jr(t,e,i,n,r){var s=new ni;s.id=i.id,s.start=i.start,s.b=i.a;var a=new A;i.b.forEach(function(t){a.push(t.contentType||"",t)});for(var o=I(a),h=0;h<o.length;++h){var u=new A;a.get(o[h]).forEach(function(t){u.push(t.group,t)});for(var l=I(u),c=0;c<l.length;++c){var f=new A;u.get(l[c]).forEach(function(t){f.push(t.lang,t)});for(var p=I(f),d=0;d<p.length;++d){var y=f.get(p[d]),y=Ar(t,e,i,y,n,r);s.a.push(y)}}}return s}function Ar(t,e,i,n,r,s){R(n.every(function(t){return t.group==n[0].group&&(t.lang||"")==(n[0].lang||"")&&(t.contentType||"")==(n[0].contentType||"")}));var a=new ei,o=n.filter(function(t){return null!=t.id});o.length==n.length&&(a.id=o.map(function(t){return t.id}).sort().reduce(function(t,e){return t+","+e})),a.lang=n[0].lang||"",a.contentType=n[0].contentType||"",a.b=n.some(function(t){return t.c});for(var o={},h=0;h<n.length;++h)for(var u=n[h],l=0;l<u.a.length;++l){var c=u.a[l],f=Ir(t,c),p=a.a.slice(0);Mr(f,p),0==p.length&&0<a.a.length||!(c=Rr(e,i,c,r,s))||(a.m.push(c),a.a=p,o[c.C]=u)}if(a.a.some(function(t){return""==t.a}))return a.m.forEach(function(t){t.N=!0}),a;for(t=_r(n),h=0;h<a.m.length;++h)c=a.m[h],u=o[c.C],u==t&&(c.N=!0);return a}function _r(t){for(var e=null,i=null,n=0;n<t.length;++n)for(var r=t[n],s=0;s<r.a.length;++s){var a=r.a[s],a=(a.width||1)*(a.height||1)*(a.bandwidth||1);(null==e||e>a)&&(e=a,i=r)}return i}function Mr(t,e){if(0==e.length)Array.prototype.push.apply(e,t);else for(var i=0;i<e.length;++i){for(var n=!1,r=0;r<t.length;++r){var s=e[i],a=t[r];if(s.a==a.a&&s.h==a.h&&s.i==a.i&&s.g==a.g&&s.v==a.v&&s.f==a.f&&s.j==a.j&&T(s.c,a.c)){n=!0,D(e[i],t[r].b);break}}n||(e.splice(i,1),--i)}}function Ir(t,e){var i=[];if(0==e.c.length)i.push(new C);else if(t.a)for(var n=0;n<e.c.length;++n)i.push.apply(i,Nr(t,e.c[n]));return i}function Nr(t,e){var i=[];if(2!=t.a.length)return[];var n=t.a(e.c||"",e.f);if(!(n&&n instanceof Array))return[];for(var r=0;r<n.length;++r){var s=x(n[r]);0==s.b.length&&e.a&&e.a.psshBox&&D(s,[{initData:e.a.psshBox,initDataType:"cenc"}]),i.push(s)}return i}function Rr(t,e,i,n,r){if(!i.s||0===i.s.length)return null;var s=null,a=1,o=0;if(i.g)s=i.f.split("/")[1],"mp4"!=s&&"webm"!=s?s=null:(a=i.g,("webm"!=s||a.c)&&(a.a||a.b&&a.b.a)?(o=a.b,o||(o=new qn,o.url=i.s,o.a=a.a?a.a.clone():null),o=xr(o,r),a=a.c?xr(a.c,r):null,t=new _n(t,e,s,o,a,n,r),e=new qe(a),n=new Qe,n.H=t,n.D=e,s=n):s=null),a=i.g.g,o=i.g.f;else if(i.b)s=i.b,!s.b&&!s.c&&1<s.a.length?s=null:s.b||e.a||s.c||1!=s.a.length?s.c&&0===s.c.a.length?s=null:(s=s.h?xr(s.h,r):null,t=new mr(t,e,i,n,r),e=new qe(s),n=new Qe,n.H=t,n.D=e,s=n):s=null,a=i.b.f,o=i.b.g;else if(i.a){t:if(s=i.a,a=0+(s.g?1:0),a+=s.f?1:0,a+=s.b?1:0,0==a?a=!1:(1!=a&&(s.g?(s.f=null,s.b=null):s.f&&(s.b=null)),a=!0),a){if(a=null,s.h&&(a=(s=i.a.h)?Cr(i,s,Fn):null,!a)){s=null;break t}s=a?xr(a,r):null,a=i.a,a.g?(a=i.f.split("/")[1],"mp4"!=a&&"webm"!=a?t=null:("webm"!=a||s)&&dr(r,i,1,0)&&(o=(o=i.a.g)?Cr(i,o,qn):null)?(o=xr(o,r),t=new _n(t,e,a,o,s,n,r)):t=null):t=a.i?a.f?new Mn(t,e,i,n,r):a.b?"dynamic"!=t.type&&null==e.a?null:new Er(t,e,i,n,r):null:null,t?(e=new qe(s),n=new Qe,n.H=t,n.D=e,s=n):s=null}else s=null;a=i.a.a,o=i.a.j}else"text"==i.f.split("/")[0]&&(s=new Qe,s.H=new Xe(new Le(r,i.s)));if(!s)return null;for(s.id=i.id,o&&(s.c=-1*o/a),s.bandwidth=i.bandwidth,s.width=i.width,s.height=i.height,s.a=i.f||"",s.b=i.h||"",t=0;t<i.c.length;++t)e=i.c[t],e.b&&s.f.push(e.b);return s}function Cr(t,e,i){return(e=yr(e,t.id,null,t.bandwidth,null))?(i=new i,i.url=Ue(t.s,e),i):null}function xr(t,e){var i=t.url,n=0,r=null;return t.a&&(n=t.a.ma,r=t.a.end),new Le(e,i,n,r)}function Dr(t,e,i){e||(e=new z),i||(i=new Gi),Wi.call(this,null,e,i),this.R=t,this.M=[],this.timeoutMs=3e4,this.l={},this.j=this.ea=null}function Or(t,e,i,n){var r=new bn(t.Y,t);return null!=t.l.segmentRequestTimeout&&(r.b=Number(t.l.segmentRequestTimeout)),ht(r).then(u(t,function(){return vn(r,e,this.M,n,i)})).then(function(t){return ut(r),Promise.resolve(t)})["catch"](function(t){return ut(r),Promise.reject(t)})}function Lr(t){var e=new bn(null,null);return ht(e).then(u(t,function(){return gn(e,this.R)})).then(function(){return ut(e),Promise.resolve()})["catch"](function(t){return ut(e),Promise.reject(t)})}function Ur(e){var i=document.createElement("video");i.src=t.URL.createObjectURL(e.g);var n=new Ti(null,i,e);return null!=e.l.licenseRequestTimeout&&(n.w=Number(e.l.licenseRequestTimeout)),e.W().then(function(){return n.initialize()}).then(u(e,function(){return Ei(n,this.timeoutMs)})).then(function(){return ki(n)}).then(u(e,function(){return n.destroy(),this.destroy(),Promise.resolve()}))["catch"](u(e,function(t){return n.destroy(),this.destroy(),Promise.reject(t)}))}function Br(t,e,i,n){i||(i=new z),n||(n=new Gi),Wi.call(this,null,i,n),this.ya=t,this.l=null,this.M=e,this.R=[],this.ea=[],this.sa=[],this.j=null}var Kr,qr=this;e("shaka.player.TextTrack.compare",function(t,e){return t.lang<e.lang?-1:t.lang>e.lang?1:0}),r.prototype.clone=function(){var t=new r;return t.maxHeight=this.maxHeight,t.minHeight=this.minHeight,t.maxWidth=this.maxWidth,t.maxBandwidth=this.maxBandwidth,t.minBandwidth=this.minBandwidth,t},e("shaka.player.VideoTrack.compare",a),e("shaka.player.AudioTrack.compare",function(t,e){return t.lang<e.lang?-1:t.lang>e.lang?1:t.bandwidth<e.bandwidth?-1:t.bandwidth>e.bandwidth?1:0}),h.prototype.destroy=function(){this["catch"](function(){});var t=Error("Destroyed!");t.type="destroy",this.reject(t)};var Fr={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};e("shaka.util.Uint8ArrayUtils.toString",v),e("shaka.util.Uint8ArrayUtils.fromString",g),e("shaka.util.Uint8ArrayUtils.toBase64",function(e,i){var n=void 0==i?!0:i,r=t.btoa(v(e)).replace(/\+/g,"-").replace(/\//g,"_");return n?r:r.replace(/=*$/,"")}),e("shaka.util.Uint8ArrayUtils.fromBase64",m),e("shaka.util.Uint8ArrayUtils.fromHex",function(e){for(var i=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)i[n/2]=t.parseInt(e.substr(n,2),16);return i}),e("shaka.util.Uint8ArrayUtils.toHex",w);var Vr;A.prototype.push=function(t,e){this.a.hasOwnProperty(t)?this.a[t].push(e):this.a[t]=[e]},A.prototype.set=function(t,e){this.a[t]=e},A.prototype.get=function(t){return(t=this.a[t])?t.slice():null};var Hr=0;L.prototype.sample=function(t,e){var i=Math.pow(this.c,t);this.b=e*(1-i)+i*this.b,this.a+=t};var zr=1,Gr=2,Yr={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",
tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};e("shaka.util.FakeEventTarget",V),V.prototype.addEventListener=function(t,e,i){i||this.xa.push(t,e)},V.prototype.removeEventListener=function(t,e,i){i||M(this.xa,t,e)},V.prototype.dispatchEvent=function(t){if(t.hasOwnProperty("srcElement")||(delete t.srcElement,Object.defineProperty(t,"srcElement",{get:function(){return null}})),t.hasOwnProperty("target"))t.target=this;else{delete t.target;var e=this;Object.defineProperty(t,"target",{get:function(){return e},set:function(t){e=t}})}if(t.hasOwnProperty("currentTarget"))t.currentTarget=null;else{delete t.currentTarget;var i=null;Object.defineProperty(t,"currentTarget",{get:function(){return i},set:function(t){i=t}})}return H(this,t)},i(z,V),e("shaka.util.EWMABandwidthEstimator",z),z.prototype.sample=function(t,e){if(!(65536>e)){t=Math.max(t,50);var i=8e3*e/t,n=t/1e3;this.a.sample(n,i),this.c.sample(n,i),this.dispatchEvent(B({type:"bandwidth"})),this.b=Date.now()}},z.prototype.getBandwidth=function(){return.5>this.a.a?5e5:Math.min(U(this.a),U(this.c))},z.prototype.getDataAge=function(){return(Date.now()-this.b)/1e3},z.prototype.supportsCaching=function(){return!1};var Jr=0,Wr=1;Q.prototype.start=function(){if(this.f)throw Error("Task already started!");this.f=!0,this.b.unshift(function(){}),et(this,void 0)},Q.prototype.end=function(){this.b.splice(1)},nt.prototype.destroy=function(){st(this),this.a=null},nt.prototype.ra=function(t,e){for(var i=this.a.get(e)||[],n=0;n<i.length;++n){var r=i[n];r.target==t&&(r.ra(),M(this.a,e,r))}},at.prototype.ra=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)},i(ot,V),i(bt,ot);var $r=1/60;Tt.prototype.destroy=function(){jt(this)["catch"](function(){}),this.f&&this.f.destroy(),this.a=this.f=null,this.g&&(ut(this.g),this.g=null),this.b=null,this.i.destroy(),this.v=this.c=this.i=null},Tt.prototype.h=function(){"open"==this.v.readyState&&this.c.abort()},Tt.prototype.B=function(){this.f.resolve(),this.f=null},It("error"),It("warn"),It("info"),It("log"),It("debug"),e("shaka.player.TextStyle",Nt),Nt.prototype.a=function(){var e=t.localStorage.getItem("ShakaPlayerTextStyle");if(e){var i;try{i=JSON.parse(e)}catch(n){return}if(i&&"object"==typeof i){var r,e=i;for(r in e)r in this&&(this[r]=e[r])}}},Nt.prototype.load=Nt.prototype.a,Nt.prototype.b=function(){t.localStorage.setItem("ShakaPlayerTextStyle",JSON.stringify(this))},Nt.prototype.store=Nt.prototype.b;var Xr=[255,255,255],Zr=[0,0,0];Nt.StandardColors={WHITE:Xr,BLACK:Zr,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var Qr=1;Nt.StandardOpacities={OPAQUE:Qr,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var ts=[];Nt.EdgeStyles={NONE:ts,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};var es=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,is={},ns=0;e("shaka.polyfill.Promise.install",Bt),Ut.prototype.then=function(t,e){var i=new Ut;switch(this.la){case 1:Kt(this,i,t);break;case 2:Kt(this,i,e);break;case ns:this.c.push({Ha:i,Aa:t}),this.a.push({Ha:i,Aa:e})}return i},Ut.prototype.then=Ut.prototype.then,Ut.prototype["catch"]=function(t){return this.then(void 0,t)},Ut.prototype["catch"]=Ut.prototype["catch"],Ut.prototype.f=function(t){if(this.la==ns){for(this.va=t,this.la=1,t=0;t<this.c.length;++t)Kt(this,this.c[t].Ha,this.c[t].Aa);this.c=[],this.a=[]}},Ut.prototype.b=function(t){if(this.la==ns){for(this.va=t,this.la=2,t=0;t<this.a.length;++t)Kt(this,this.a[t].Ha,this.a[t].Aa);this.c=[],this.a=[]}},Vt.prototype.createMediaKeys=function(){var t=new zt(this.keySystem);return Promise.resolve(t)},Vt.prototype.getConfiguration=function(){return this.a},zt.prototype.createSession=function(t){if("temporary"!=(t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new Yt(this.a)},zt.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},i(Yt,V),Kr=Yt.prototype,Kr.generateRequest=function(t,e){this.a=new h;try{this.c=this.g.createSession("video/mp4",e),rt(this.f,this.c,"mskeymessage",this.Cb.bind(this)),rt(this.f,this.c,"mskeyadded",this.Ab.bind(this)),rt(this.f,this.c,"mskeyerror",this.Bb.bind(this)),$t(this,"status-pending")}catch(i){this.a.reject(i)}return this.a},Kr.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},Kr.update=function(t){this.b=new h;try{this.c.update(t)}catch(e){this.b.reject(e)}return this.b},Kr.close=function(){try{this.c.close(),this.closed.resolve(),st(this.f)}catch(t){this.closed.reject(t)}return this.closed},Kr.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},Kr.Cb=function(t){this.a&&(this.a.resolve(),this.a=null),t=B({type:"message",messageType:void 0==this.keyStatuses.Ea()?"licenserequest":"licenserenewal",message:t.message.buffer}),this.dispatchEvent(t)},Kr.Ab=function(){this.a?(this.a.resolve(),this.a=null):this.b&&($t(this,"usable"),this.b.resolve(),this.b=null)},Kr.Bb=function(){var t=Error("EME v20140218 key error");if(t.errorCode=this.c.error,null!=this.a)this.a.reject(t),this.a=null;else if(null!=this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:$t(this,"output-not-allowed");default:$t(this,"internal-error")}},Xt.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};var rs;Kr=Zt.prototype,Kr.La=function(t){this.size=void 0==t?0:1,this.a=t},Kr.Ea=function(){return this.a},Kr.entries=function(){var t=rs,e=[];return this.a&&e.push([t,this.a]),new Xt(e)},Kr.forEach=function(t){this.a&&t(this.a)},Kr.get=function(t){return this.has(t)?this.a:void 0},Kr.has=function(t){var e=rs;return this.a&&T(new Uint8Array(t),e)?!0:!1},Kr.keys=function(){var t=rs,e=[];return this.a&&e.push(t),new Xt(e)},Kr.values=function(){var t=[];return this.a&&t.push(this.a),new Xt(t)},e("shaka.polyfill.CustomEvent.install",Qt),e("shaka.polyfill.VideoPlaybackQuality.install",ee),e("shaka.polyfill.Fullscreen.install",ne),oe.prototype.createSession=function(){},oe.prototype.setServerCertificate=function(){},he.prototype.getConfiguration=function(){},he.prototype.createMediaKeys=function(){},ce.prototype.createMediaKeys=function(){var t=new fe(this.a);return Promise.resolve(t)},ce.prototype.getConfiguration=function(){return this.b},Kr=fe.prototype,Kr.createSession=function(t){var e=t||"temporary";if("temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+t+" is unsupported on this platform.");return t=this.b||document.createElement("video"),t.src||(t.src="about:blank"),e=new ye(t,this.g,e),this.c.push(e),e},Kr.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},Kr.Qb=function(t){t=B({type:"encrypted",initDataType:"webm",initData:t.initData}),this.b.dispatchEvent(t)},Kr.Pb=function(t){var e=de(this,t.sessionId);e&&(t=B({type:"message",messageType:void 0==e.keyStatuses.Ea()?"licenserequest":"licenserenewal",message:t.message}),e.b&&(e.b.resolve(),e.b=null),e.dispatchEvent(t))},Kr.Nb=function(t){(t=de(this,t.sessionId))&&(ve(t,"usable"),t.a&&t.a.resolve(),t.a=null)},Kr.Ob=function(t){var e=de(this,t.sessionId);if(e){var i=Error("EME v0.1b key error");i.errorCode=t.errorCode,i.errorCode.systemCode=t.systemCode,!t.sessionId&&e.b?(i.method="generateRequest",45==t.systemCode&&(i.message="Unsupported session type."),e.b.reject(i),e.b=null):t.sessionId&&e.a?(i.method="update",e.a.reject(i),e.a=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?ve(e,"output-restricted"):1==i?ve(e,"expired"):ve(e,"internal-error"))}},i(ye,V),Kr=ye.prototype,Kr.Pa=function(t,e){if(this.a)this.a.then(this.Pa.bind(this,t,e))["catch"](this.Pa.bind(this,t,e));else{this.a=t;var i,n;"webkit-org.w3.clearkey"==this.c?(i=v(new Uint8Array(e)),n=JSON.parse(i),"oct"!=n.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),i=m(n.keys[0].k),n=m(n.keys[0].kid)):(i=new Uint8Array(e),n=null);try{this.f.webkitAddKey(this.c,i,n,this.sessionId)}catch(r){this.a.reject(r),this.a=null}}},Kr.generateRequest=function(t,e){return be(this,e,null)},Kr.load=function(t){return"persistent-license"==this.g?be(this,null,t):Promise.reject(Error("Not a persistent session."))},Kr.update=function(t){var e=new h;return this.Pa(e,t),e},Kr.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}return this.closed.resolve(),this.closed},Kr.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()},ge.prototype.next=function(){return this.a>=this.b.length?{value:void 0,done:!0}:{value:this.b[this.a++],done:!1}};var ss;Kr=me.prototype,Kr.La=function(t){this.size=void 0==t?0:1,this.a=t},Kr.Ea=function(){return this.a},Kr.entries=function(){var t=ss,e=[];return this.a&&e.push([t,this.a]),new ge(e)},Kr.forEach=function(t){this.a&&t(this.a)},Kr.get=function(t){return this.has(t)?this.a:void 0},Kr.has=function(t){var e=ss;return this.a&&T(new Uint8Array(t),e)?!0:!1},Kr.keys=function(){var t=ss,e=[];return this.a&&e.push(t),new ge(e)},Kr.values=function(){var t=[];return this.a&&t.push(this.a),new ge(t)},e("shaka.polyfill.MediaKeys.install",we),e("shaka.polyfill.installAll",function(){Qt(),ne(),ee(),Bt(),we()});var as=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;Kr=Te.prototype,Kr.P="",Kr.aa="",Kr.S="",Kr.ga=null,Kr.O="",Kr.$="",Kr.toString=function(){var t=[],e=this.P;if(e&&t.push(je(e,os,!0),":"),e=this.S){t.push("//");var i=this.aa;i&&t.push(je(i,os,!0),"@"),t.push(encodeURIComponent(e).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.ga,null!=e&&t.push(":",String(e))}return(e=this.O)&&(this.S&&"/"!=e.charAt(0)&&t.push("/"),t.push(je(e,"/"==e.charAt(0)?us:hs,!0))),(e=this.a.toString())&&t.push("?",e),(e=this.$)&&t.push("#",je(e,cs)),t.join("")},Kr.resolve=function(t){var e=this.clone();"data"===e.P&&(e=new Te);var i=!!t.P;i?Ee(e,t.P):i=!!t.aa,i?e.aa=t.aa:i=!!t.S,i?e.S=t.S:i=null!=t.ga;var n=t.O;if(i)ke(e,t.ga);else if(i=!!t.O){if("/"!=n.charAt(0))if(this.S&&!this.O)n="/"+n;else{var r=e.O.lastIndexOf("/");-1!=r&&(n=e.O.substr(0,r+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){for(var r=0==n.lastIndexOf("/",0),n=n.split("/"),s=[],a=0;a<n.length;){var o=n[a++];"."==o?r&&a==n.length&&s.push(""):".."==o?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),r&&a==n.length&&s.push("")):(s.push(o),r=!0)}n=s.join("/")}}return i?e.O=n:i=""!==t.a.toString(),i?Pe(e,t.a.clone()):i=!!t.$,i&&(e.$=t.$),e},Kr.clone=function(){return new Te(this)};var os=/[#\/\?@]/g,hs=/[\#\?:]/g,us=/[\#\?]/g,ls=/[\#\?@]/g,cs=/#/g;_e.prototype.a=null,_e.prototype.c=null,_e.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var t,e=[];for(t in this.a)for(var i=encodeURIComponent(t),n=this.a[t],r=0;r<n.length;r++){var s=i;""!==n[r]&&(s+="="+encodeURIComponent(n[r])),e.push(s)}return this.b=e.join("&")},_e.prototype.clone=function(){var t=new _e;if(t.b=this.b,this.a){var e,i={};for(e in this.a)i[e]=this.a[e].concat();t.a=i,t.c=this.c}return t},Kr=Ie.prototype,Kr.qb=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var e=this.url.split(":")[1].split(";").pop().split(","),i=e.pop(),i="base64"==e.pop()?t.atob(i.replace(/-/g,"+").replace(/_/g,"/")):t.decodeURIComponent(i);return"arraybuffer"==this.b.f&&(i=g(i).buffer),e=JSON.parse(JSON.stringify(new XMLHttpRequest)),e.response=i,e.responseText=i.toString(),i=this.c,i.resolve(e),Re(this),i}if(0==this.url.lastIndexOf("idb:",0))return xe(this);this.h++,this.i=Date.now(),this.g||(this.g=this.b.h),this.a=new XMLHttpRequest,e=this.url,(this.f&&!this.f.supportsCaching()||this.b.g)&&(e=new Te(e),Me(e.a,"_",Date.now()),e=e.toString()),this.a.open(this.b.method,e,!0),this.a.responseType=this.b.f,this.a.timeout=this.b.c,this.a.withCredentials=this.b.j,this.a.onload=this.yb.bind(this),this.b.g&&(this.a.onreadystatechange=this.Fb.bind(this)),this.a.onerror=this.Wb.bind(this),this.a.ontimeout=this.Kb.bind(this);for(i in this.b.b)this.a.setRequestHeader(i,this.b.b[i]);return this.a.send(this.b.body),this.c},Kr.yb=function(t){this.f&&this.f.sample(Date.now()-this.i,t.loaded),200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Re(this)):this.h<this.b.a?Oe(this):(t=De(this,"HTTP error.","net"),this.c.reject(t),Re(this))},Kr.Fb=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED){var t=Date.parse(this.a.getResponseHeader("Date"));t&&(Hr=t-Date.now())}},Kr.Wb=function(){var t=De(this,"Network failure.","net");this.c.reject(t),Re(this)},Kr.Kb=function(){if(this.h<this.b.a)Oe(this);else{var t=De(this,"Request timed out.","net");this.c.reject(t),Re(this)}},Le.prototype.g=function(){if(this.c){this.a=null;var t=this.c;if(t.a&&t.a.readyState!=XMLHttpRequest.DONE){t.a.abort();var e=De(t,"Request aborted.","aborted");t.c.reject(e),Re(t)}this.c=null}},Le.prototype.clone=function(){return new Le(this.i,this.b.map(function(t){return t.clone()}),this.f,this.h)},Le.prototype.toString=function(){return this.b[0].toString()},qe.prototype.destroy=function(){this.a&&(this.a.g(),this.a=null),this.b=null},qe.prototype.create=function(){return this.a?Be(this.a):Promise.resolve(this.b)},Ge.prototype.parse=function(t,e,i,n){var r=null;try{t:{var s=[],a=new G(t),o=W(a);if(1936286840!=W(a))r=null;else{1==o&&(o=$(a));var h=J(a);Z(a,3),Z(a,4);var u=W(a);if(0==u)r=null;else{var l,c;0==h?(l=W(a),c=W(a)):(l=$(a),c=$(a)),Z(a,2);var f=a.b.getUint16(a.a,a.c);for(a.a+=2,t=l,e=e+o+c,o=0;f>o;o++){var p=W(a);c=(2147483648&p)>>>31;var h=2147483647&p,d=W(a);if(W(a),1==c){r=null;break t}var y=new Le(n,i,e,e+h-1);s.push(new Fe(t/u,(t+d)/u,y)),t+=d,e+=h}r=s}}}}catch(b){if(!(b instanceof RangeError))throw b}return r},Ye.prototype.parse=function(t,e,i,n){var r=null;try{var s,a=new E(e);if(440786851!=k(a).id)s=null;else{var o=k(a);if(408125543!=o.id)s=null;else{var h,u=o.a.byteOffset,l=new E(o.a);for(e=null;Y(l.a);){var c=k(l);if(357149030==c.id){e=c;break}}if(e){for(var f=new E(e.a),l=1e6;Y(f.a);){var p=k(f);if(2807729==p.id){l=j(p);break}}h=l/1e9}else h=null;s=h?{Sb:u,Xb:h}:null}}if(s){var d=k(new E(t));if(475249515!=d.id)r=null;else{var y=s.Sb,b=s.Xb;t=[];var v=new E(d.a);for(s=d=-1;Y(v.a);){var g=k(v);if(187==g.id){var m,w=new E(g.a),T=k(w);if(179!=T.id)m=null;else{var P=j(T),S=k(w);if(183!=S.id)m=null;else{for(var A=new E(S.a),u=0;Y(A.a);){var _=k(A);if(241==_.id){u=j(_);break}}m={Zb:P,Rb:u}}}if(m){var M=b*m.Zb,I=y+m.Rb;if(d>=0){var N=new Le(n,i,s,I-1);t.push(new Fe(d,M,N))}d=M,s=I}}}d>=0&&(N=new Le(n,i,s,null),t.push(new Fe(d,null,N))),r=t}}else r=null}catch(R){if(!(R instanceof RangeError))throw R}return r},Je.prototype.destroy=function(){this.o=null},Kr=Je.prototype,Kr.length=function(){return this.o.length},Kr.A=function(){if(0==this.o.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.o[this.o.length-1]},Kr.get=function(t){if(0>t||t>=this.o.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.o[t]},Kr.ja=function(t){return t=He(this.o,t),t>=0?this.o[t]:null},Kr.Ga=function(t){return $e(this,t),!0},Kr.ia=function(t){var e=t-this.i;return 0==e?0:(this.o=ze(this.o,e),this.i=t,e)},Kr.Da=function(){return 0<this.length()?{start:We(this).b,end:this.A().a}:{start:0,end:0}},Xe.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)},Xe.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var t=new Fe(0,null,this.b);return this.a=new Je([t]),Promise.resolve(this.a)},Ze.prototype.destroy=function(){this.b=null,this.a&&(this.a.destroy(),this.a=null)},Ze.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var t=[],e=0;e<this.b.length;++e){var i=this.b[e];t.push(new Fe(i.start_time,i.end_time,new Le(null,[new Te(i.url)],i.start_byte,null)))}return this.b=null,this.a=new Je(t),Promise.resolve(this.a)};var fs=0;Qe.prototype.destroy=function(){this.H&&(this.H.destroy(),this.H=null),this.D&&(this.D.destroy(),this.D=null)};var ps=0;ei.prototype.destroy=function(){for(var t=0;t<this.m.length;++t)this.m[t].destroy();this.a=this.m=null},ni.prototype.destroy=function(){for(var t=0;t<this.a.length;++t)this.a[t].destroy();this.a=null},ri.prototype.destroy=function(){for(var t=0;t<this.a.length;++t)this.a[t].destroy();this.a=null},i(ai,V),ai.prototype.G=function(){},ai.prototype.destroy=function(){this.a&&this.b.removeChild(this.a),this.c.destroy(),this.v=this.b=this.f=this.h=this.a=this.c=null},Kr=ai.prototype,Kr.na=function(){return this.f},Kr.bb=function(){return this.h},Kr.rb=function(){return this.c},Kr.Fa=function(){return!0},Kr.qa=function(t){t.H.create().then(u(this,function(e){if(this.b){if(0==e.length())return Promise.reject(Error("No subtitles URL available."));var i=this.f;this.f=t,this.h=e,e=We(e).url.b[0].toString();var n=this.Ca();this.a&&(this.ua(!1),this.b.removeChild(this.a)),this.a=document.createElement("track"),this.b.appendChild(this.a),this.a.src=e,this.ua(n),e=B({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:t.bandwidth}),this.dispatchEvent(e),i||this.c.resolve(0)}}))},Kr.jb=function(){},Kr.kb=function(){return!0},Kr.ua=function(t){this.g=t,this.a&&(this.a.track.mode=t?"showing":"disabled")},Kr.Ca=function(){return this.a&&(this.g="showing"==this.a.track.mode),this.g},i(oi,V),oi.prototype.G=function(t){null!=t.initialStreamBufferSize&&(this.B=Number(t.initialStreamBufferSize)),null!=t.streamBufferSize&&(this.L=Number(t.streamBufferSize)),null!=t.segmentRequestTimeout&&(this.a.u=Number(t.segmentRequestTimeout))},oi.prototype.destroy=function(){di(this),this.h.destroy(),this.b=this.h=null,this.a.destroy(),this.v=this.c=this.a=null},Kr=oi.prototype,Kr.na=function(){return this.b},Kr.bb=function(){return this.I},Kr.rb=function(t){return this.f||t.then(function(){this.f=!0,this.g||pi(this,0)}.bind(this))["catch"](function(){}),this.h},Kr.Fa=function(){return this.j},Kr.qa=function(t,e,i){if(t!=this.b){var n=[t.H.create(),t.D.create()];Promise.all(n).then(u(this,function(n){if(this.c){var r=this.b;this.b=t,this.I=n[0],this.w=n[1],this.K=!0,this.l||(r?e&&hi(this,!0,i):pi(this,0))}}))["catch"](u(this,function(t){"aborted"!=t.type&&(this.f?(t=K(t),this.dispatchEvent(t)):this.h.reject(t))}))}},Kr.jb=function(){return hi(this,!1)},Kr.kb=function(t){return 0<Et(this.a,t)&&0<=He(this.a.b,t)},Kr.ua=function(){},Kr.Ca=function(){return!0},Kr.Mb=function(){if(this.u&&!this.f)this.g=null;else{var t;if((t=this.f&&!this.j)&&(t=1<this.a.c.buffered.length?!0:!1),t)hi(this,!0);else{this.g=null,t=this.b;var e=this.I,i=this.c.currentTime;Et(this.a,this.u?i:i+(this.i||0))>=(this.u?Math.max(this.B,this.L):this.B)?(li(this),pi(this,1e3/(Math.abs(this.c.playbackRate)||1))):(e=ui(this,i,e))?(e=kt(this.a,e,t.c,this.w),this.w=null,this.K&&(this.K=!1,ci(this,t)),this.j=!1,e.then(u(this,function(t){null==this.i&&(this.i=t),this.F&&0<Et(this.a,i)&&(this.F=!1,this.c.currentTime+=.001),pi(this,0)}))["catch"](u(this,function(t){if("aborted"!=t.type){var e=[0,404,410];"net"==t.type&&-1!=e.indexOf(t.$b.status)&&this.b&&pi(this,5e3),t=K(t),this.dispatchEvent(t)}}))):(li(this),this.f&&!this.j&&(this.j=!0,fi(this)),pi(this,1e3))}}},i(Ti,V),Ti.prototype.destroy=function(){this.v=null;for(var e=0;e<this.f.length;++e)this.f[e].close()["catch"](function(){});this.f=[],this.c=this.a=this.i=null,this.g.destroy(),this.g=null,this.l.destroy(),this.l=null,this.j&&(t.clearTimeout(this.j),this.j=null),this.h=this.b=null},Ti.prototype.initialize=function(){for(var t=new A,e=this.b.ab(),i=0;i<e.length;++i){var n=e[i];n.a.a||n.b&&!Ni(n.b)||t.push(n.contentType,n)}for(var i={},n=!1,r=0;r<e.length;++r){var s=e[r];if(s.a.a&&!t.a.hasOwnProperty(s.contentType)){var a=s.a.a,o=i[a];if(o||(o=s.a,o={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:o.g?"required":"optional",persistentState:o.v||this.b.fa()?"required":"optional",sessionTypes:[this.b.fa()?"persistent-license":"temporary"]},i[a]=o),s.b&&(a=s.contentType+"Capabilities",a in o)){n=!0,o[a]||(o[a]=[]);var u;"audio"==s.contentType?u=s.a.f:"video"==s.contentType&&(u=s.a.j),o[a].push({contentType:s.b,robustness:u})}}}if(!n){if(!e.length)throw t=Error("No DrmInfo exists!"),t.type="drm",t;this.a=e[0].a}return 0==Object.keys(i).length?(this.b.Ja(t),this.g.resolve(),Promise.resolve()):(u=new h,i=Pi(this,i,u),i=i.then(this.sb.bind(this,e,t)),i=i.then(this.Tb.bind(this)),u.reject(null),i)},Kr=Ti.prototype,Kr.sb=function(t,e,i){if(!this.h)return Si();for(var n=i.keySystem,r=i.getConfiguration(),s=["audio","video"],a=0;a<s.length;++a){var o=s[a];if(!e.a.hasOwnProperty(o)){var h=r[o+"Capabilities"];if(h&&h.length){for(var h=h[0],u=[],l={},c=0;c<t.length;++c){var f=t[c];if(f.a.a==n&&f.b==h.contentType&&!(f.id in l)){u.push(f),l[f.id]=!0;var p;if(this.a){p=this.a;var f=f.a,d=new C;d.a=p.a,d.h=p.h,d.i=p.i,d.l=p.l,d.u=p.u,d.g=p.g,d.v=p.v,d.f=p.f,d.j=p.j,d.c=p.c?new Uint8Array(p.c.buffer):null,D(d,p.b),D(d,f.b),p=d}else p=f.a;this.a=p}}e.set(o,u)}}}return this.b.Ja(e),i.createMediaKeys()},Kr.Tb=function(t){return this.h?(this.i=t,this.h.setMediaKeys(this.i).then(u(this,function(){return this.h?this.a.c?this.i.setServerCertificate(this.a.c):Promise.resolve():Si()})).then(u(this,function(){if(!this.h)return Si();if(0<this.b.ta().length)ji(this);else{for(var t=0;t<this.a.b.length;++t){var e=this.a.b[t];this.cb({type:"encrypted",initDataType:e.initDataType,initData:e.initData})}0==this.a.b.length&&rt(this.l,this.h,"encrypted",this.cb.bind(this))}}))):Si()},Kr.cb=function(t){for(var e=new Uint8Array(t.initData),i=0;i<this.c.length;++i)if(T(e,this.c[i].data))return;try{var n=Ai(this)}catch(r){return e=K(r),this.dispatchEvent(e),void this.g.reject(r)}t=n.generateRequest(t.initDataType,t.initData),this.c.push({data:e,Ka:n}),t["catch"](u(this,function(t){if(this.h){for(var e=0;e<this.c.length;++e)if(this.c[e].Ka==n){this.c.splice(e,1);break}e=K(t),this.dispatchEvent(e),this.g.reject(t)}})),this.f.push(n)},Kr.Ib=function(t){_i(this,t.target,this.a,t.message)},Kr.xb=function(t){t=t.target;for(var e=t.keyStatuses,i={},n=e.keys(),r=n.next();!r.done;r=n.next()){var s=w(new Uint8Array(r.value)),r=e.get(r.value);i[s]=r}if(t.expiration<Date.now()){for(e=0;e<this.c.length;++e)if(this.c[e].Ka==t){this.c.splice(e,1);break}t.close(),this.f.splice(this.f.indexOf(t),1)}this.b.eb(i)},i(Ii,V),e("shaka.player.Player",Ii),Ii.version="v1.6.0",Ii.isBrowserSupported=function(){return!!(t.MediaSource&&t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration&&t.Promise&&Element.prototype.requestFullscreen&&document.exitFullscreen&&"fullscreenElement"in document&&t.Uint8Array)},Ii.isTypeSupported=Ni,Ii.setTextStyle=function(t){var e=document.getElementById("ShakaPlayerTextStyle");for(e||(e=document.createElement("style"),e.id="ShakaPlayerTextStyle",document.head.appendChild(e)),e=e.sheet;e.cssRules.length;)e.deleteRule(0);e.insertRule("::cue { "+Rt(t)+" }",0)},Ii.prototype.destroy=function(){return this.u().then(u(this,function(){this.f.destroy(),this.a=this.f=null}))["catch"](function(){})},Ii.prototype.destroy=Ii.prototype.destroy,Ii.prototype.u=function(){if(!this.b)return Promise.resolve();this.h&&Oi(this),this.a.pause(),st(this.f),Di(this),Ci(this),this.j&&(this.j.destroy(),this.j=null),this.a.src="";var t=this.a.setMediaKeys(null);return this.b&&(this.b.destroy(),this.b=null),this.h=!1,this.g=new yi,t},Ii.prototype.unload=Ii.prototype.u,Ii.prototype.ca=function(t){var e=this.u();return this.a.autoplay&&(Dt("load"),rt(this.f,this.a,"timeupdate",this.wb.bind(this))),t.T(this.c),t.ob(this.G),this.G=null,e=e.then(u(this,function(){return t.W()})),e["catch"](u(this,function(e){return t.destroy(),Promise.reject(e)})),e.then(u(this,function(){return this.a?(this.b=t,rt(this.f,this.b,"seekrangechanged",this.Gb.bind(this)),this.j=new Ti(this,this.a,this.b),this.j.initialize()):Ri()})).then(u(this,function(){return this.a?(rt(this.f,this.a,"error",this.Ub.bind(this)),rt(this.f,this.a,"playing",this.Eb.bind(this)),rt(this.f,this.a,"pause",this.Db.bind(this)),this.b.Va(this,this.a)):Ri()})).then(u(this,function(){return this.a?void xi(this):Ri()}))["catch"](u(this,function(t){if(!this.a)return Ri();if("destroy"!=t.type){var e=K(t);this.dispatchEvent(e)}return this.u().then(function(){return Promise.reject(t)})}))},Ii.prototype.load=Ii.prototype.ca,Kr=Ii.prototype,Kr.wb=function(){Ot("load"),this.g.playbackLatency=Lt("load")/1e3,this.f.ra(this.a,"timeupdate")},Kr.Ub=function(){if(this.a.error){var t=this.a.error.code;t!=MediaError.MEDIA_ERR_ABORTED&&(t=Error(ds[t]||"Unknown playback error."),t.type="playback",t=K(t),this.dispatchEvent(t))}},Kr.Eb=function(){Dt("playing"),!this.i&&0>this.l&&(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),this.l)),this.h&&Oi(this)},Kr.Db=function(){Ot("playing");var t=Lt("playing");if(!isNaN(t)){var e=this.g;e.playTime+=t/1e3}Ci(this)},Kr.Gb=function(t){this.F=t.start},Kr.pb=function(){if(!this.a.paused){Ot("playing");var t=Lt("playing");if(!isNaN(t)){var e=this.g;e.playTime+=t/1e3,Dt("playing")}}return t=this.g,e=this.a,e.getVideoPlaybackQuality&&(e=e.getVideoPlaybackQuality(),t.decodedFrames=e.totalVideoFrames,t.droppedFrames=e.droppedVideoFrames),this.g},Ii.prototype.getStats=Ii.prototype.pb,Ii.prototype.ba=function(){return this.b?this.b.ka():[]},Ii.prototype.getVideoTracks=Ii.prototype.ba,Ii.prototype.X=function(){return this.b?this.b.oa():[]},Ii.prototype.getAudioTracks=Ii.prototype.X,Ii.prototype.Z=function(){return this.b?this.b.Na():[]},Ii.prototype.getTextTracks=Ii.prototype.Z,Ii.prototype.selectVideoTrack=function(t,e){return this.b?this.b.selectVideoTrack(t,void 0==e?!0:e):!1},Ii.prototype.selectVideoTrack=Ii.prototype.selectVideoTrack,Ii.prototype.M=function(t,e){return this.b?this.b.mb(t,void 0==e?!0:e):!1},Ii.prototype.selectAudioTrack=Ii.prototype.M,Ii.prototype.da=function(t){return this.b?this.b.nb(t,!1):!1},Ii.prototype.selectTextTrack=Ii.prototype.da,Ii.prototype.V=function(t){this.b&&this.b.Ma(t)},Ii.prototype.enableTextTrack=Ii.prototype.V,Ii.prototype.T=function(t){Ci(this),t>=0?this.a.playbackRate=t:this.a.paused||(this.a.playbackRate=0,this.B(this.a.currentTime,Date.now(),t)),this.l=t},Ii.prototype.setPlaybackRate=Ii.prototype.T,Ii.prototype.K=function(){return this.l},Ii.prototype.getPlaybackRate=Ii.prototype.K,Ii.prototype.R=function(t){this.G=t},Ii.prototype.setPlaybackStartTime=Ii.prototype.R,Ii.prototype.I=function(){return this.b?this.b.lb():!1},Ii.prototype.isLive=Ii.prototype.I,Ii.prototype.U=function(t){if(t){var e=p(t,"enableAdaptation","boolean");null!=e&&(this.c.enableAdaptation=e),e=c(t,"streamBufferSize"),null!=e&&(this.c.streamBufferSize=e),e=c(t,"liveStreamEndTimeout"),null!=e&&(this.c.liveStreamEndTimeout=e),e=c(t,"licenseRequestTimeout"),null!=e&&(this.c.licenseRequestTimeout=e),e=c(t,"mpdRequestTimeout"),null!=e&&(this.c.mpdRequestTimeout=e),e=c(t,"segmentRequestTimeout"),null!=e&&(this.c.segmentRequestTimeout=e),e=f(t,"preferredLanguage"),null!=e&&(this.c.preferredLanguage=e),t=d(t,"restrictions",r),null!=t&&(this.c.restrictions=t.clone()),this.b&&this.b.T(this.c)}},Ii.prototype.configure=Ii.prototype.U,Ii.prototype.Y=function(){return this.c},Ii.prototype.getConfiguration=Ii.prototype.Y,Ii.prototype.B=function(e,i,n){this.i=null;var r=(Date.now()-i)/1e3*n;this.a.currentTime<this.F+(this.I()?1:.05)?this.a.pause():(r=Math.max(this.F,e+r),this.a.currentTime=r,this.i=t.setTimeout(this.B.bind(this,e,i,n),250))},Ii.prototype.L=function(){if(xi(this),!this.a.ended&&!this.a.seeking){var t=this.a.buffered,e=t.length?t.end(t.length-1):0,t=Math.max(e-this.a.currentTime,0),i=this.a.duration,i=isNaN(i)?0:Math.max(i-.05,0),e=e>=i||this.a.currentTime>=i;this.h?(i=this.b.$a(),(e||t>i)&&(Oi(this),this.a.play())):!this.a.paused&&!e&&.5>t&&(this.h=!0,this.a.pause(),this.g.bufferingHistory.push(N()/1e3),Dt("buffering"),this.dispatchEvent(B({type:"bufferingStart"})))}};var ds={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};Ki.prototype.destroy=function(){this.a.destroy(),this.a=null},Ki.prototype.update=function(t){var e=qi(t),i=qi(this.a);return Promise.all([e,i]).then(u(this,function(e){var i=e[0];e=e[1];var n=this.a.a;return Li(n),Ui(n),t.f=this.a.f,t.g=this.a.g?this.a.g.clone():null,t.c=this.a.c,n=[],Fi(t,this.a,i,e,n),i=t.a,Li(i),Ui(i),Promise.resolve(n)}))},e("shaka.media.SimpleAbrManager",Gi),Gi.prototype.destroy=function(){this.f.destroy(),this.a=this.b=this.f=null},Gi.prototype.initialize=function(t,e){this.b||this.a||(this.b=t,this.a=e)},Gi.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4e3,rt(this.f,this.b,"bandwidth",this.v.bind(this)),rt(this.f,this.a,"adaptation",this.j.bind(this)),rt(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)},Gi.prototype.enable=function(t){this.i=t},Gi.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var t=Yi(this);return t?t.id:null},Gi.prototype.selectVideoTrack=function(t,e,i){this.g&&this.a.selectVideoTrack(t.id,e,i)},Gi.prototype.v=function(){Date.now()<this.c||this.h()},Gi.prototype.h=function(){if(this.i){var t=Yi(this);if(t){if(t.active)return void(this.c=Date.now()+3e3);this.selectVideoTrack(t,!1)}this.c=Number.POSITIVE_INFINITY}},Gi.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3e4)},i(Ji,V),e("shaka.player.HttpVideoSource",Ji),Ji.prototype.T=function(){},Ji.prototype.destroy=function(){this.a&&(this.a.parentElement.removeChild(this.a),this.a=null),this.v=this.b=null},Kr=Ji.prototype,Kr.Va=function(t,e){this.v=t;var i=e.mediaKeys;return e.src=this.f,i=e.setMediaKeys(i),this.c&&(this.a=document.createElement("track"),this.a.src=this.c,e.appendChild(this.a),this.a.track.mode="showing"),i},Kr.W=function(){return Promise.resolve()},Kr.ka=function(){return[]},Kr.oa=function(){return[]},Kr.Na=function(){return[]},Kr.$a=function(){return 5},Kr.ab=function(){var t=new si;return t.a=this.b,[t]},Kr.Ja=function(){},Ji.prototype.selectVideoTrack=function(){return!1},Kr=Ji.prototype,Kr.mb=function(){return!1},Kr.nb=function(){return!1},Kr.Ma=function(t){this.a&&(this.a.track.mode=t?"showing":"disabled")},Kr.ob=function(){},Kr.ta=function(){return[]},Kr.fa=function(){return!1},Kr.lb=function(){return!1},Kr.eb=function(t){for(var e in t){var i=t[e],n=Fr[i]||null;if(n){var r=y(e),n=Error("Key "+r+" is not usable. "+n);n.type="drm",n.code=i,i=K(n),this.dispatchEvent(i)}}},i(Wi,V),e("shaka.player.StreamVideoSource",Wi),Wi.prototype.T=function(t){null!=t.streamBufferSize&&(this.G.streamBufferSize=t.streamBufferSize),null!=t.segmentRequestTimeout&&(this.G.segmentRequestTimeout=t.segmentRequestTimeout),yn(this),null!=t.enableAdaptation&&this.I.enable(Boolean(t.enableAdaptation)),null!=t.mpdRequestTimeout&&(this.ba=Number(t.mpdRequestTimeout)),null!=t.liveStreamEndTimeout&&(this.Ta=Number(t.liveStreamEndTimeout)),null!=t.preferredLanguage&&(this.K=F(String(t.preferredLanguage))),null!=t.restrictions&&(this.h=t.restrictions,
this.L&&Zi(this))},Wi.prototype.destroy=function(){this.B.destroy(),this.ca.destroy(),this.ca=this.B=null,this.X&&(t.clearTimeout(this.X),this.X=null),this.V&&(t.clearTimeout(this.V),this.V=null),this.u=null,this.i.destroy(),this.i=null,l(this.c).forEach(function(t){t.destroy()}),this.b=this.c=null,this.a&&(this.a.destroy(),this.a=null),this.I.destroy(),this.v=this.h=this.U=this.f=this.g=this.Y=this.I=null},Kr=Wi.prototype,Kr.Va=function(e,i){if(!this.L){var n=Error("Cannot call attach() right now.");return n.type="app",Promise.reject(n)}return this.v=e,this.f=i,this.U=e.pb(),rt(this.i,this.g,"sourceopen",this.zb.bind(this)),rt(this.i,this.Y,"bandwidth",this.Vb.bind(this)),this.a.b&&(rt(this.i,e,"bufferingStart",this.vb.bind(this)),rt(this.i,e,"bufferingEnd",this.ub.bind(this))),n=this.f.mediaKeys,this.f.src=t.URL.createObjectURL(this.g),n=this.f.setMediaKeys(n),Promise.all([this.B,n])},Kr.W=function(){if(this.L){var t=Error("Cannot call load() right now.");return t.type="app",Promise.reject(t)}return this.a&&0!=this.a.a.length?(t=this.a.a,Li(t),Ui(t),0==this.a.a.length||0==this.a.a[0].a.length?(t=Error("The manifest specifies content that cannot be displayed on this browser/platform."),t.type="stream",Promise.reject(t)):(this.L=!0,this.G.initialStreamBufferSize=this.a.c,yn(this),Zi(this),Promise.resolve())):(t=Error("The manifest does not specify any content."),t.type="stream",Promise.reject(t))},Kr.hb=function(t){var e=Date.now(),i=this.V=null,n=this.a.g;(t?this.fb():this.gb(n)).then(u(this,function(t){return i=new Ki(t),i.update(this.a)})).then(u(this,function(t){i.destroy(),i=null;for(var n=0;n<t.length;++n)Xi(this,t[n]);this.G.initialStreamBufferSize=this.a.c,yn(this),Zi(this),0==Object.keys(this.c).length?nn(this):$i(this,(Date.now()-e)/1e3)}))["catch"](u(this,function(t){i&&(i.destroy(),i=null),"aborted"!=t.type&&(t=K(t),this.dispatchEvent(t),this.a&&$i(this,0))}))},Kr.gb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")},Kr.fb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")},Kr.ka=function(){if(!this.b.a.hasOwnProperty("video"))return[];for(var t=this.c.video,t=(t=t?t.na():null)?t.C:0,e=[],i=this.b.get("video"),n=0;n<i.length;++n)for(var r=i[n],a=0;a<r.m.length;++a){var o=r.m[a];if(o.N&&o.J){var h=o.C,o=new s(h,o.bandwidth,o.width,o.height);h==t&&(o.active=!0),e.push(o)}}return e},Wi.prototype.getVideoTracks=Wi.prototype.ka,Wi.prototype.oa=function(){if(!this.b.a.hasOwnProperty("audio"))return[];for(var t=this.c.audio,t=(t=t?t.na():null)?t.C:0,e=[],i=this.b.get("audio"),n=0;n<i.length;++n)for(var r=i[n],s=r.lang,a=0;a<r.m.length;++a){var h=r.m[a];if(h.N&&h.J){var u=h.C,h=new o(u,h.bandwidth,s);u==t&&(h.active=!0),e.push(h)}}return e},Wi.prototype.getAudioTracks=Wi.prototype.oa,Wi.prototype.Na=function(){if(!this.b.a.hasOwnProperty("text"))return[];for(var t=this.c.text,e=t?t.na():null,e=e?e.C:0,i=[],r=this.b.get("text"),s=0;s<r.length;++s)for(var a=r[s],o=a.lang,h=0;h<a.m.length;++h){var u=a.m[h].C,l=new n(u,o);u==e&&(l.active=!0,l.enabled=t.Ca()),i.push(l)}return i},Wi.prototype.getTextTracks=Wi.prototype.Na,Wi.prototype.$a=function(){return Number(this.G.initialStreamBufferSize)},Wi.prototype.ab=function(){var t;if(this.L){t=this.a.a[0];for(var e=[],i=0;i<t.a.length;++i)e.push.apply(e,ii(t.a[i]));t=e}else t=[];return t},Wi.prototype.Ja=function(t){if(this.L){for(var e={},i=this.a.a[0],n=0;n<i.a.length;++n){var r=i.a[n];e[r.C]=r}for(this.b.a={},i=I(t),n=0;n<i.length;++n){var r=i[n],s=t.get(r);if("video"==r){var a=s[0].id;this.b.push(r,e[a])}else if("audio"==r)for(var a=s[0].b.split(";")[0],o=0;o<s.length;++o){var h=s[o];h.b.split(";")[0]==a&&this.b.push(r,e[h.id])}else for(o=0;o<s.length;++o)a=s[o].id,this.b.push(r,e[a])}this.da=!0,(t=this.b.get("audio"))&&(en(this,t),this.b.set("audio",t),t=t[0].lang||this.K,q(2,this.K,t)&&(this.da=!1)),(t=this.b.get("text"))&&(en(this,t),this.b.set("text",t),t=t[0].lang||this.K,q(2,this.K,t)||(this.da=!1))}},Wi.prototype.selectVideoTrack=function(t,e,i){return tn(this,"video",t,e,i)},Kr=Wi.prototype,Kr.mb=function(t,e){return tn(this,"audio",t,e)},Kr.nb=function(t,e){return tn(this,"text",t,e)},Kr.Ma=function(t){var e=this.c.text;e&&e.ua(t)},Kr.ob=function(t){this.Z=t},Kr.ta=function(){return[]},Kr.fa=function(){return!1},Kr.lb=function(){return this.a?this.a.b:!1},Kr.eb=function(t){for(var e,i=!1,n=new A,r=_(this.b),s=0;s<r.length;++s)for(var a=r[s],o=0;o<a.m.length;++o){var h=a.m[o];h.f.forEach(function(t){n.push(t,h)})}for(e in t)if(r=Fr[t[e]]||null,a=n.get(e))for(s=0;s<a.length;++s)h=a[s],o=h.N,h.N=!r,o!=h.N&&(i=!0);else y(e);i&&(Qi(this),e=this.oa(),t=this.ka(),e=this.b.a.hasOwnProperty("audio")&&0==e.length,t=this.b.a.hasOwnProperty("video")&&0==t.length,e||t)&&(t=Error("The key system has restricted all "+(e&&t?"audio and video tracks.":e?"audio tracks.":"video tracks.")),t.type="drm",t=K(t),this.dispatchEvent(t))},Kr.zb=function(){this.i.ra(this.g,"sourceopen"),nn(this).then(u(this,function(){this.B&&this.B.resolve()}))["catch"](u(this,function(t){this.B&&this.B.reject(t)}))},Kr.tb=function(t){R(t&&t.length==Object.keys(this.c).length);for(var e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,n=0;n<t.length;++n)var r=t[n],e=Math.min(e,r),i=Math.max(i,r);for(t=fn(this),n=0;n<t.length;++n)t[n].ia(i);hn(this,t,i),n=_(this.b).map(function(t){return t.m}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){var e=[t.H.create()];return t.D&&e.push(t.D.create()),Promise.all(e)}),Promise.all(n).then(u(this,function(t){for(var e=0;e<t.length;++e)t[e][0].ia(i);this.Qa=!0;for(var n in this.u)t=this.u[n],e=this.c[n],bi(this.U,t.Oa),e.qa(t.Oa,t.Wa,t.Xa);this.u={}}))["catch"](u(this,function(t){"aborted"!=t.type&&(t=K(t),this.dispatchEvent(t))}))},Kr.Lb=function(){this.X=null,dn(this);var e=pn(this,fn(this));e&&(this.a.b&&this.Sa!=e.A&&(this.Sa=e.A,null!=this.w&&(t.clearTimeout(this.w),this.w=null)),ln(this,e.start,e.end),this.f.paused||cn(this,this.f.currentTime,e.start,e.end))},Kr.Hb=function(){var t=this.f.currentTime;if(null!=this.F){if(t>=this.F-.01&&t<=this.F+.01)return void(this.F=null);this.F=null}var e=pn(this,fn(this));if(e){var i=e.end;if((e=cn(this,t,e.start,i))||(i+.01>=t?e=!1:(this.f.currentTime=i,e=!0)),!e)for(var n in this.c)this.c[n].jb()}},Kr.Jb=function(){if(!this.a.b){for(var t in this.c)if(!this.c[t].Fa())return;this.Za()}},Kr.vb=function(){l(this.c).every(function(t){return t.Fa()})&&(this.w=t.setTimeout(this.Za.bind(this),1e3*this.Ta))},Kr.ub=function(){null!=this.w&&(t.clearTimeout(this.w),this.w=null)},Kr.Vb=function(){var t=this.U,e=this.Y.getBandwidth();t.estimatedBandwidth=e,t.bandwidthHistory.push(new gi(e))},Kr.Za=function(){this.w=null,this.g.endOfStream()},i(bn,ot),bn.prototype.g=function(t,e,i){var n=new h;t={stream_id:i.pa,mime_type:t.a,codecs:t.b,init_segment:e,references:i.o};var r=ft(this).put(t);return r.onsuccess=function(){n.resolve(i.pa)},r.onerror=function(){n.reject(r.error)},n},bn.prototype.f=function(t,e){for(var i=Promise.resolve(),n=0;n<t.length();++n)var r=t.get(n),s=n==t.length()-1,s=this.c.bind(this,r,e,s),i=i.then(this.i.bind(this,r)),i=i.then(s);return i.then(function(){return Promise.resolve(e)})["catch"](u(this,function(t){return En(this,e.pa),Promise.reject(t)}))},bn.prototype.c=function(t,e,i,n){var r=new h;0==e.ha.byteLength&&(e.Ba=t),e.ha=Tn(e.ha,n),e.ib++;var s=B({type:"progress",detail:e.ib/e.Yb*100,bubbles:!0});if(1048576<=e.ha.byteLength||i){i={stream_id:e.pa,segment_id:e.Ia,content:e.ha};var a=ct(this).put(i);e.o.push({start_time:e.Ba.b,start_byte:e.Ba.url.f,end_time:t.a,url:"idb://"+e.pa+"/"+e.Ia}),e.Ia++,e.ha=new ArrayBuffer(0),a.onerror=function(){r.reject(a.error)},a.onsuccess=u(this,function(){this.dispatchEvent(s),r.resolve()})}else this.dispatchEvent(s),r.resolve();return r},bn.prototype.i=function(t){var e=new Ne;return e.c=1e3*this.b,Be(t.url,e,this.j)},i(kn,Je),kn.prototype.destroy=function(){this.w=this.g=null,Je.prototype.destroy.call(this)},kn.prototype.ja=function(t){return jn(this,N()/1e3),Je.prototype.ja.call(this,t)},kn.prototype.Ga=function(t){return t instanceof kn?($e(this,t),this.h=Math.max(this.h,t.h),null==this.c?(this.f=t.f,Pn(this)):An(this),!0):!1},kn.prototype.ia=function(t){return t=Je.prototype.ia.call(this,t),Math.min.apply(null,this.o.filter(function(t){return null!=t.a}).map(function(t){return t.a-t.b})),null!=this.c&&(this.l+=t,this.a+=t,this.c+=t),t},kn.prototype.Da=function(){return Sn(this,N()/1e3)},_n.prototype.destroy=function(){this.h=this.i=this.g=null,this.a.g(),this.a=null,this.c&&(this.c.g(),this.c=null),this.b=null},_n.prototype.create=function(){if(this.b)return this.b;var t=[Be(this.a)];return"webm"==this.f&&t.push(Be(this.c)),this.b=Promise.all(t).then(u(this,function(t){var e=t[0];t=t[1]||null;var i=null;if("mp4"==this.f?(i=new Ge,i=i.parse(new DataView(e),this.a.f,this.a.b,this.h)):"webm"==this.f&&(i=new Ye,i=i.parse(new DataView(e),new DataView(t),this.a.b,this.h)),!i)return e=Error("Failed to parse SegmentReferences from "+this.a.toString()+" (or one of its fallbacks)."),e.type="stream",Promise.reject(e);var n;return n="dynamic"==this.g.type?new kn(i,this.g,this.i,this.j):new Je(i),Promise.resolve(n)}))},Mn.prototype.destroy=function(){this.g=this.f=this.c=this.b=null,this.a&&(this.a.destroy(),this.a=null)},Mn.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var t=this.f.a,e=br(t.f,t.a||1,this.c.a||0),i=[],n=0;n<e.length;++n){var r=e[n].start,s=r/t.a,a=e[n].end/t.a,r=dr(this.g,this.f,n+t.c,r);if(!r)return t=Error("Failed to generate media URL."),t.type="dash",Promise.reject(t);var o=(t.j||0)/t.a;i.push(new Fe(s-o,a-o,r))}return"dynamic"==this.b.type?this.a=new kn(i,this.b,this.c,this.h):this.a=new Je(i),Promise.resolve(this.a)},Kn.prototype.clone=function(){var t=new Kn;return t.s=nr(this.s),t.g=this.g,t.f=this.f,t.a=rr(this.a),t.b=rr(this.b),t.c=rr(this.c),t},qn.prototype.clone=function(){var t=new qn;return t.url=nr(this.url),t.a=rr(this.a),t},Fn.prototype.clone=function(){var t=new Fn;return t.url=nr(this.url),t.a=rr(this.a),t},Vn.prototype.clone=function(){var t=new Vn;return t.s=nr(this.s),t.f=this.f,t.g=this.g,t.b=this.b,t.i=this.i,t.h=rr(this.h),t.a=nr(this.a)||[],t.c=rr(this.c),t},Hn.prototype.clone=function(){var t=new Hn;return t.b=nr(this.b),t.a=rr(this.a),t},zn.prototype.clone=function(){var t=new zn;return t.a=this.a,t.j=this.j,t.b=this.b,t.c=this.c,t.v=this.v,t.i=this.i,t.g=this.g,t.h=this.h,t.f=rr(this.f),t},Gn.prototype.clone=function(){var t=new Gn;return t.a=nr(this.a)||[],t},Yn.prototype.clone=function(){var t=new Yn;return t.b=this.b,t.a=this.a,t.c=this.c,t},Jn.prototype.clone=function(){return new Jn(this.ma,this.end)},In.TAG_NAME="MPD",Nn.TAG_NAME="Period",Rn.TAG_NAME="AdaptationSet",Cn.TAG_NAME="Role",xn.TAG_NAME="ContentComponent",Dn.TAG_NAME="Representation",On.TAG_NAME="ContentProtection",Ln.TAG_NAME="cenc:pssh",Un.TAG_NAME="BaseURL",Bn.TAG_NAME="Location",Kn.TAG_NAME="SegmentBase",qn.TAG_NAME="RepresentationIndex",Fn.TAG_NAME="Initialization",Vn.TAG_NAME="SegmentList",Hn.TAG_NAME="SegmentURL",zn.TAG_NAME="SegmentTemplate",Gn.TAG_NAME="SegmentTimeline",Yn.TAG_NAME="S",In.prototype.parse=function(t,e){this.url=t.s,this.id=sr(e,"id",fr),this.type=sr(e,"type",fr)||"static",this.b=sr(e,"mediaPresentationDuration",or),this.h=sr(e,"minBufferTime",or,this.h),this.g=sr(e,"minimumUpdatePeriod",or,this.g),this.c=sr(e,"availabilityStartTime",ar,this.c),this.f=sr(e,"timeShiftBufferDepth",or,this.f),this.i=sr(e,"suggestedPresentationDelay",or,this.i);var i=t.s,n=er(this,e,Un);this.s=$n(i,n),(n=Qn(this,e,Bn))&&(this.j=Xn(i,n.url)),this.a=er(this,e,Nn)},Nn.prototype.parse=function(t,e){this.id=sr(e,"id",fr),this.start=sr(e,"start",or),this.a=sr(e,"duration",or);var i=er(this,e,Un);this.s=$n(t.s,i),this.c=Qn(this,e,Kn),this.f=Qn(this,e,Vn),this.g=Qn(this,e,zn),this.b=er(this,e,Rn),Wn(this)},Rn.prototype.parse=function(t,e){var i=Qn(this,e,xn)||{},n=Qn(this,e,Cn);this.id=sr(e,"id",fr),this.group=sr(e,"group",cr),this.lang=sr(e,"lang",fr,i.lang),this.contentType=sr(e,"contentType",fr,i.contentType),this.width=sr(e,"width",lr),this.height=sr(e,"height",lr),this.b=sr(e,"mimeType",fr),this.i=sr(e,"codecs",fr),this.c=n&&"main"==n.value,this.lang&&(this.lang=F(this.lang)),i=er(this,e,Un),this.s=$n(t.s,i),this.j=er(this,e,On),!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]),this.f=t.c?Zn(this,e,t.c):Qn(this,e,Kn),this.g=t.f?Zn(this,e,t.f):Qn(this,e,Vn),this.h=t.g?Zn(this,e,t.g):Qn(this,e,zn),this.a=er(this,e,Dn),!this.b&&this.a.length&&(this.b=this.a[0].f,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))},Cn.prototype.parse=function(t,e){this.value=sr(e,"value",fr)},xn.prototype.parse=function(t,e){this.id=sr(e,"id",fr),this.lang=sr(e,"lang",fr),this.contentType=sr(e,"contentType",fr),this.lang&&(this.lang=F(this.lang))},Dn.prototype.parse=function(t,e){this.id=sr(e,"id",fr),this.bandwidth=sr(e,"bandwidth",lr),this.width=sr(e,"width",lr,t.width),this.height=sr(e,"height",lr,t.height),this.f=sr(e,"mimeType",fr,t.b),this.h=sr(e,"codecs",fr,t.i),this.lang=t.lang;var i=er(this,e,Un);this.s=$n(t.s,i),this.c=er(this,e,On),this.g=t.f?Zn(this,e,t.f):Qn(this,e,Kn),this.b=t.g?Zn(this,e,t.g):Qn(this,e,Vn),this.a=t.h?Zn(this,e,t.h):Qn(this,e,zn),this.c=this.c.concat(t.j)},On.prototype.parse=function(t,e){this.f=e,this.c=sr(e,"schemeIdUri",fr);var i=sr(e,"cenc:default_KID",fr);i&&(this.b=i.replace(/[-]/g,"")),this.a=Qn(this,e,Ln)},Ln.prototype.parse=function(t,e){var i=ir(e);if(i){this.psshBox=m(i);try{this.parsedPssh=new xt(this.psshBox)}catch(n){if(!(n instanceof RangeError))throw n}}},Un.prototype.parse=function(t,e){this.url=ir(e)},Bn.prototype.parse=function(t,e){this.url=ir(e)},Kn.prototype.parse=function(t,e){this.s=t.s||this.s,this.g=sr(e,"timescale",lr,this.g),this.f=sr(e,"presentationTimeOffset",cr,this.f),this.a=sr(e,"indexRange",hr,this.a),this.b=Qn(this,e,qn)||this.b,this.c=Qn(this,e,Fn)||this.c},qn.prototype.parse=function(t,e){var i=sr(e,"sourceURL",fr);this.url=Xn(t.s,i),this.a=sr(e,"range",hr,rr(t.a))},Fn.prototype.parse=function(t,e){var i=sr(e,"sourceURL",fr);this.url=Xn(t.s,i),this.a=sr(e,"range",hr)},Vn.prototype.parse=function(t,e){this.s=t.s||this.s,this.f=sr(e,"timescale",lr,this.f),this.g=sr(e,"presentationTimeOffset",cr,this.g),this.b=sr(e,"duration",lr,this.b);var i=sr(e,"startNumber",cr,this.i);null!=i&&(this.i=i>0?i:1),this.h=Qn(this,e,Fn)||this.h,this.a=(i=er(this,e,Hn))&&0<i.length?i:this.a,this.c=Qn(this,e,Gn)||this.c},Hn.prototype.parse=function(t,e){var i=sr(e,"media",fr);this.b=Xn(t.s,i),this.a=sr(e,"mediaRange",hr)},zn.prototype.parse=function(t,e){this.a=sr(e,"timescale",lr,this.a),this.j=sr(e,"presentationTimeOffset",cr,this.j),this.b=sr(e,"duration",lr,this.b);var i=sr(e,"startNumber",cr,this.c);null!=i&&(i>0?this.c=i:(this.c=1,this.v=!0)),this.i=sr(e,"media",fr,this.i),this.g=sr(e,"index",fr,this.g),this.h=sr(e,"initialization",fr,this.h),this.f=Qn(this,e,Gn)||this.f},Gn.prototype.parse=function(t,e){this.a=er(this,e,Yn)},Yn.prototype.parse=function(t,e){this.b=sr(e,"t",cr),this.a=sr(e,"d",cr),this.c=sr(e,"r",ur)},mr.prototype.destroy=function(){this.f=this.g=this.b=this.c=null,this.a&&(this.a.destroy(),this.a=null)},mr.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var t=this.g.b,e=[];t.c&&(e=br(t.c,t.f||1,this.b.a||0));var i=0;t.b&&t.i?i=(t.i-1)*t.b:0<e.length&&(i=e[0].start-(t.g||0));var n=t.a.length;0<e.length&&e.length!=t.a.length&&(n=Math.min(e.length,t.a.length));for(var r=[],s=0;n>s;++s){var a=t.a[s],o=i/t.f,h=null,u=null;t.b?(h=i+t.b,u=h/t.f):0<e.length?(h=e[s].end-(t.g||0),u=h/t.f):(u=o+this.b.a,h=u*t.f);var i=h,h=0,l=null;a.a&&(h=a.a.ma,l=a.a.end),r.push(new Fe(o,u,new Le(this.f,a.b,h,l)))}return"dynamic"==this.c.type?this.a=new kn(r,this.c,this.b,this.h):this.a=new Je(r),Promise.resolve(this.a)},i(wr,kn),wr.prototype.destroy=function(){this.B=this.u=null,kn.prototype.destroy.call(this)},wr.prototype.ja=function(t){var e=N()/1e3;return Tr(this,e),jn(this,e),Je.prototype.ja.call(this,t)},wr.prototype.Ga=function(t){return null==this.b&&t instanceof wr&&null!=t.b?(this.b=t.b,this.v=t.v,this.j=t.j,this.f=t.f,this.h=t.h,$e(this,t),Tr(this,N()/1e3),Pn(this),!0):!1},wr.prototype.ia=function(t){return t=kn.prototype.ia.call(this,t),null!=this.b&&(this.b+=t,this.v+=t),t},wr.prototype.Da=function(){var t=N()/1e3;return Tr(this,t),Sn(this,t)},Er.prototype.destroy=function(){this.g=this.c=this.b=this.f=null,this.a&&(this.a.destroy(),this.a=null)},Er.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.f.type)try{this.a=new wr(this.f,this.b,this.c,this.h,this.g)}catch(t){return Promise.reject(t)}else{var e;e=this.c.a;var i=Math.ceil(this.b.a/(e.b/e.a));if(e.c>i?e=null:(e=pr(this.g,this.c,e.c,i-(e.c-1)))?(0<e.length&&(i=e[e.length-1],e[e.length-1]=Ve(i,i.b,this.b.a)),e=new Je(e)):e=null,this.a=e,!this.a)return e=Error("Failed to generate SegmentReferences"),e.type="stream",Promise.reject(e)}return Promise.resolve(this.a)},i(Dr,Wi),e("shaka.player.OfflineVideoSource",Dr),Dr.prototype.T=function(t){null!=t.licenseRequestTimeout&&(this.l.licenseRequestTimeout=t.licenseRequestTimeout),null!=t.segmentRequestTimeout&&(this.l.segmentRequestTimeout=t.segmentRequestTimeout),Wi.prototype.T.call(this,t)},e("shaka.player.OfflineVideoSource.retrieveGroupIds",function(){var t=new bt,e=ht(t).then(function(){return vt(t)});return e.then(function(){ut(t)})["catch"](function(){ut(t)}),e}),Dr.prototype.wa=function(e,i,n,r){var s,a=null,o={},h=[];return e=new Le(this.ea,[new Te(e)]),gr(new vr(e,this.ba)).then(u(this,function(t){return this.a=Pr(new kr(n),t,this.ea),this.a.b?(t=Error("Unable to store live streams offline."),t.type="app",Promise.reject(t)):(this.T({preferredLanguage:i}),Wi.prototype.W.call(this))})).then(u(this,function(){var e=document.createElement("video");return e.src=t.URL.createObjectURL(this.g),s=new Ti(null,e,this),null!=this.l.licenseRequestTimeout&&(s.w=Number(this.l.licenseRequestTimeout)),rt(this.i,s,"sessionReady",this.sa.bind(this)),rt(this.i,s,"error",function(t){a=t}),s.initialize()})).then(u(this,function(){for(var t=_(this.b),e=0;e<t.length;++e)for(var i=t[e],n=0;n<i.m.length;++n){var s=i.m[n];o[s.C]=s}return r()})).then(u(this,function(t){for(var e=0;e<t.length;++e){var i=t[e],n=o[i];if(!n)return Promise.reject(Error("Invalid stream ID chosen: "+i));h.push(n)}var r=["audio","video"];return h=h.filter(function(t){return 0>r.indexOf(t.a.split("/")[0])?!1:!0}),t=h.map(function(t){return t.D.create()}),Promise.all(t)})).then(u(this,function(t){for(var e=h,i=[],n=0;n<e.length;++n)try{i[n]=this.g.addSourceBuffer(ti(e[n]))}catch(r){}if(e.length!=i.length)t=Error("Error initializing streams."),t.type="storage",t=Promise.reject(t);else{for(n=0;n<t.length;++n)(e=t[n])&&i[n].appendBuffer(e);t=Promise.resolve()}return t})).then(u(this,function(){return Ei(s,this.timeoutMs)})).then(u(this,function(){return a?Promise.reject(a):Or(this,h,s.a,this.a.a[0].b)})).then(u(this,function(t){return this.R=t,a?(Lr(this),Promise.reject(a)):Promise.resolve(t)}))},e("shaka.player.OfflineVideoSource.prototype.store",Dr.prototype.wa),Dr.prototype.za=function(t){this.ea=t},Dr.prototype.setNetworkCallback=Dr.prototype.za,Dr.prototype.sa=function(t){this.M.push(t.detail.sessionId)},Dr.prototype.W=function(){var t,e,i=new bt;return ht(i).then(u(this,function(){return gt(i,this.R)})).then(u(this,function(n){var r=[];this.M=n.session_ids,t=n.duration,e={keySystem:n.key_system,distinctiveIdentifierRequired:n.distinctive_identifier,persistentStorageRequired:!0,audioRobustness:n.audio_robustness,videoRobustness:n.video_robustness,withCredentials:n.with_credentials,licenseServerUrl:n.license_server};for(var s=0;s<n.stream_ids.length;++s)r.push(mt(i,n.stream_ids[s]));return Promise.all(r)})).then(u(this,function(i){var n=t,r=e,s=new ri;s.c=5;for(var a=new ni,o=0;o<i.length;++o){var h=i[o],u=new Qe,l=new Ze(h.references),c=new qe(null,h.init_segment);u.H=l,u.D=c,u.a=h.mime_type,u.b=h.codecs,u.N=!0,this.j&&(null!=this.j.licenseServerUrl&&(r.licenseServerUrl=this.j.licenseServerUrl),null!=this.j.withCredentials&&(r.withCredentials=this.j.withCredentials),r.licensePostProcessor=this.j.licensePostProcessor,r.licensePreProcessor=this.j.licensePreProcessor,r.serverCertificate=this.j.serverCertificate),h=x(r),l=new ei,l.m.push(u),l.a.push(h),l.contentType=u.a.split("/")[0],a.a.push(l),a.b=n}return s.a.push(a),this.a=s,Wi.prototype.W.call(this)})).then(function(){return ut(i),Promise.resolve()})["catch"](function(t){return ut(i),Promise.reject(t)})},Dr.prototype.ya=function(t,e){t&&(this.j={licenseServerUrl:t.licenseServerUrl,withCredentials:t.withCredentials,serverCertificate:t.serverCertificate,licensePreProcessor:t.licensePreProcessor,licensePostProcessor:t.licensePostProcessor});var i=null;return Ur(this)["catch"](function(t){return e?(i=t,Promise.resolve()):Promise.reject(t)}).then(u(this,function(){return Lr(this)})).then(function(){return Promise.resolve(i)})},Dr.prototype.deleteGroup=Dr.prototype.ya,Dr.prototype.ta=function(){return this.M},Dr.prototype.fa=function(){return!0},i(Br,Wi),e("shaka.player.DashVideoSource",Br),Br.prototype.za=function(t,e,i){this.R.push(t),this.ea.push(e||""),this.sa.push(i||"")},Br.prototype.addExternalCaptions=Br.prototype.za,Br.prototype.wa=function(t){this.j=t},Br.prototype.setNetworkCallback=Br.prototype.wa,Br.prototype.destroy=function(){this.l=this.j=this.M=null,Wi.prototype.destroy.call(this)},Br.prototype.W=function(){var t=new Le(this.j,[new Te(this.ya)]);return gr(new vr(t,this.ba)).then(u(this,function(t){this.l=t;for(var e=0;e<this.R.length;e++){var i=t,n=this.R[e],r=this.ea[e],s=this.sa[e];if(0!==i.a.length){var a=new Rn;a.contentType="text",a.lang=r||"en",a.c=!0,r=new Dn,r.bandwidth=0,r.f=s||"text/vtt",r.s=[new Te(n)],a.a.push(r),i.a[0].b.push(a),Wn(i.a[0])}}return this.a=Pr(new kr(this.M),t,this.j),Wi.prototype.W.call(this)}))},Br.prototype.gb=function(t){return gr(new vr(t,this.ba)).then(u(this,function(t){return this.l=t,t=Pr(new kr(this.M),t,this.j),Promise.resolve(t)}))},Br.prototype.fb=function(){var t=Pr(new kr(this.M),this.l,this.j);return Promise.resolve(t)}}).bind(r,this)(),"undefined"!=typeof t&&t.exports?t.exports=r.shaka:(n=function(){return r.shaka}.call(e,i,e,t),!(void 0!==n&&(t.exports=n)))}()},function(e,i){e.exports=t}])});