!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("Clappr")):"function"==typeof define&&define.amd?define(["Clappr"],e):"object"==typeof exports?exports.DashShakaPlayback=e(require("Clappr")):t.DashShakaPlayback=e(t.Clappr)}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(t,e,i){for(var n=!0;n;){var r=t,s=e,a=i;n=!1,null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,s);if(void 0!==o){if("value"in o)return o.value;var u=o.get;if(void 0===u)return;return u.call(a)}var h=Object.getPrototypeOf(r);if(null===h)return;t=h,e=s,i=a,n=!0,o=h=void 0}},u=i(2),h=i(1),c=n(h),l=3e4,f=-1,d="shaka:ready",p=function(t){function e(t){r(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this._levels=[],t.autoPlay&&this.play()}return s(e,t),a(e,[{key:"name",get:function(){return"dash_shaka_playback"}},{key:"shakaVersion",get:function(){return c["default"].player.Player.version}},{key:"levels",get:function(){return this._levels}},{key:"currentLevel",set:function(t){var e=this;this._currentLevelId=t;var i=this._currentLevelId===f;this._player.configure({abr:{enable:!i}}),this.trigger(u.Events.PLAYBACK_LEVEL_SWITCH_START),i||this.selectTrack(this.videoTracks.filter(function(t){return t.id===e._currentLevelId})[0]),this.trigger(u.Events.PLAYBACK_LEVEL_SWITCH_END)},get:function(){return this._currentLevelId||f}}]),a(e,[{key:"play",value:function(){return!this._player&&this._setup(),this.isReady?void o(Object.getPrototypeOf(e.prototype),"play",this).call(this):void this.once(d,this.play)}},{key:"setupSrc",value:function(){}},{key:"ready",value:function(){}},{key:"error",value:function(t){u.Log.error("an error was raised by the video tag",t,this.el.error)}},{key:"isHighDefinitionInUse",value:function(){return!!this.highDefinition}},{key:"stop",value:function(){var t=this;clearInterval(this.sendStatsId),this._sendStats(),this._player.unload().then(function(){o(Object.getPrototypeOf(e.prototype),"stop",t).call(t),t._player=null,t._isShakaReadyState=!1})["catch"](function(){u.Log.error("shaka could not be unloaded")})}},{key:"getPlaybackType",value:function(){return(this._player&&this._player.isLive()?"live":"vod")||""}},{key:"selectTrack",value:function(t){this._player.selectTrack(t),this._onAdaptation()}},{key:"destroy",value:function(){var t=this;clearInterval(this.sendStatsId),this._player?this._destroy():this._player.destroy().then(function(){return t._destroy()})["catch"](function(){t._destroy(),u.Log.error("shaka could not be destroyed")})}},{key:"_setup",value:function(){var t=this;this._isShakaReadyState=!1,this._player=this._createPlayer(),this._options.shakaConfiguration&&this._player.configure(this._options.shakaConfiguration);var e=this._player.load(this._options.src);e.then(function(){return t._loaded()})["catch"](function(e){return t._setupError(e)})}},{key:"_createPlayer",value:function(){var t=this,e=new c["default"].Player(this.el);return e.addEventListener("error",function(e,i){return t._error(e,i)}),e.addEventListener("adaptation",function(){return t._onAdaptation()}),e.addEventListener("buffering",function(e){return t._onBuffering(e)}),e}},{key:"_onBuffering",value:function(t){var e=t.buffering?u.Events.PLAYBACK_BUFFERING:u.Events.PLAYBACK_BUFFERFULL;this.trigger(e)}},{key:"_loaded",value:function(){this._isShakaReadyState=!0,this.trigger(d),this._ready(),this._startToSendStats(),this._fillLevels()}},{key:"_fillLevels",value:function(){0===this._levels.length&&(this._levels=this.videoTracks.map(function(t){return{id:t.id,label:t.height+"p"}}).reverse(),this.trigger(u.Events.PLAYBACK_LEVELS_AVAILABLE,this.levels))}},{key:"_startToSendStats",value:function(){var t=this;this.sendStatsId=setInterval(function(){return t._sendStats()},l)}},{key:"_sendStats",value:function(){this.trigger(u.Events.PLAYBACK_STATS_ADD,this._player.getStats())}},{key:"_setupError",value:function(t){this._error("error",{detail:t.detail})}},{key:"_error",value:function(t,i){u.Log.error("an error was raised support=",e.support),u.Log.error("an error was raised by shaka player",i.detail),this.trigger(u.Events.PLAYBACK_ERROR,i.detail,this.name)}},{key:"_onAdaptation",value:function(){var t=this.videoTracks.filter(function(t){return t.active===!0})[0];this._fillLevels(),u.Log.debug("an adaptation has happened:",t),this.highDefinition=t.height>=720,this.trigger(u.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.highDefinition),this.trigger(u.Events.PLAYBACK_BITRATE,{bandwidth:t.bandwidth,width:t.width,height:t.height,level:t.id})}},{key:"_destroy",value:function(){o(Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this._isShakaReadyState=!1,u.Log.debug("shaka was destroyed")}},{key:"_ready",value:function(){o(Object.getPrototypeOf(e.prototype),"_ready",this).call(this)}},{key:"isReady",get:function(){return this._isShakaReadyState}},{key:"textTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"text"===t.type})}},{key:"audioTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"audio"===t.type})}},{key:"videoTracks",get:function(){return this._player&&this._player.getTracks().filter(function(t){return"video"===t.type})}}]),e}(u.HTML5Video);e["default"]=p,p.canPlay=function(t){var e=arguments.length<=1||void 0===arguments[1]?"":arguments[1];c["default"].polyfill.installAll();var i=c["default"].Player.isBrowserSupported(),n=t.split("?")[0].match(/.*\.(.*)$/)||[];return i&&("mpd"===n[1]||e.indexOf("application/dash+xml")>-1)},t.exports=e["default"]},function(t,e,i){var n;!function(){var r={};(function(t){function e(t,e){var i=t.split("."),n=Mr;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(var r;i.length&&(r=i.shift());)i.length||void 0===e?n=n[r]?n[r]:n[r]={}:n[r]=e}function i(t){function e(){}var i=A;e.prototype=i.prototype,t.Xc=i.prototype,t.prototype=new e,t.prototype.constructor=t,t.Vc=function(t,e,n){return i.prototype[e].apply(t,Array.prototype.slice.call(arguments,2))}}function n(t){this.c=Math.exp(Math.log(.5)/t),this.a=this.b=0}function r(t,e,i){var n=Math.pow(t.c,e);t.b=i*(1-n)+n*t.b,t.a+=e}function s(t){return t.b/(1-Math.pow(t.c,t.a))}function a(){this.a=new n(3),this.c=new n(10),this.b=5e5}function o(t){return.5>t.a.a?t.b:Math.min(s(t.a),s(t.c))}function u(){}function h(){}function c(){this.h=null,this.f=!1,this.c=new a,this.g={},this.a={},this.i=!1,this.b=null}function l(t){return(t=t.g.audio)?(t=d(t),t[Math.floor(t.length/2)]):null}function f(t){var e=t.g.video;if(!e)return null;var e=d(e),i=t.a.audio,i=i&&i.bandwidth||0;t=o(t.c);for(var n=e[0],r=0;r<e.length;++r){var s=e[r],a=r+1<e.length?e[r+1]:{bandwidth:Number.POSITIVE_INFINITY};s.bandwidth&&(a=(a.bandwidth+i)/.85,t>=(s.bandwidth+i)/.95&&t<=a&&(n=s))}return n}function d(t){return t.streams.slice(0).filter(function(t){return t.allowedByApplication&&t.allowedByKeySystem}).sort(function(t,e){return t.bandwidth-e.bandwidth})}function p(t){return JSON.stringify(t,function(t,e){if("manager"!=t&&"function"!=typeof e){if(e instanceof Event||e instanceof g){var i,n={};for(i in e){var r=e[i];r&&"object"==typeof r||i in Event||(n[i]=r)}return n}if(e instanceof TimeRanges)for(n={__type__:"TimeRanges",length:e.length,start:[],end:[]},i=0;i<e.length;++i)n.start.push(e.start(i)),n.end.push(e.end(i));else n="number"==typeof e?isNaN(e)?"NaN":isFinite(e)?e:0>e?"-Infinity":"Infinity":e;return n}})}function m(t){return JSON.parse(t,function(t,e){return"NaN"==e?NaN:"-Infinity"==e?-(1/0):"Infinity"==e?1/0:e&&"object"==typeof e&&"TimeRanges"==e.__type__?b(e):e})}function b(t){return{length:t.length,start:function(e){return t.start[e]},end:function(e){return t.end[e]}}}function y(t,e,i){this.category=t,this.code=e,this.data=Array.prototype.slice.call(arguments,2)}function g(e,i){var n,r=i||{};for(n in r)this[n]=r[n];this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=t.performance?t.performance.now():Date.now(),this.type=e,this.isTrusted=!1,this.target=this.currentTarget=null,this.a=!1}function v(){var t,e,i=new Promise(function(i,n){t=i,e=n});return i.resolve=t,i.reject=e,i}function w(t,e,i,n){this.B=t,this.l=e,this.v=i,this.w=n,this.f=this.j=this.h=!1,this.u="",this.a=this.i=null,this.b={video:{},player:{}},this.m=0,this.c={},this.g=null}function T(t,e){t.a=e,t.a.addUpdateListener(t.ib.bind(t)),t.a.addMessageListener("urn:x-cast:com.google.shaka.v2",t.Vb.bind(t)),t.ib()}function S(t){for(var e in t.c){var i=t.c[e];delete t.c[e],i.reject(new y(7,7e3))}}function E(t,e){var i=p(e);t.a.sendMessage("urn:x-cast:com.google.shaka.v2",i,function(){},u)}function I(){this.a={}}function k(){this.a=new I}function P(t,e,i,n){e=new N(e,i,n),t.a.push(i,e)}function _(t){var e,i=t.a,n=[];for(e in i.a)n.push.apply(n,i.a[e]);for(i=0;i<n.length;++i)n[i].ha();t.a.clear()}function N(t,e,i){this.target=t,this.type=e,this.a=i,this.target.addEventListener(e,i,!1)}function A(){this.ya=new I,this.W=this}function C(t,e,i){A.call(this),this.c=t,this.b=e,this.h=this.f=this.g=this.i=this.j=null,this.a=new w(i,this.Ec.bind(this),this.Fc.bind(this),this.Gc.bind(this)),R(this)}function R(t){t.a.init(),t.h=new k,Or.forEach(function(t){P(this.h,this.c,t,this.Sc.bind(this))}.bind(t)),Lr.forEach(function(t){P(this.h,this.b,t,this.lc.bind(this))}.bind(t)),t.j={};for(var e in t.c)Object.defineProperty(t.j,e,{configurable:!1,enumerable:!0,get:t.Rc.bind(t,e),set:t.Tc.bind(t,e)});t.i={};for(e in t.b)Object.defineProperty(t.i,e,{configurable:!1,enumerable:!0,get:t.kc.bind(t,e)});t.g=new A,t.g.W=t.j,t.f=new A,t.f.W=t.i}function M(t,e,i){A.call(this),this.b=t,this.a=e,this.i={video:t,player:e},this.j=i||function(){},this.h=!1,this.g=!0,this.c=this.f=null,O(this)}function O(e){var i=cast.receiver.CastReceiverManager.getInstance();i.onSenderConnected=e.nb.bind(e),i.onSenderDisconnected=e.nb.bind(e),i.onSystemVolumeChanged=e.Hb.bind(e),e.f=i.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.f.onMessage=e.Wb.bind(e),i.start(),Or.forEach(function(t){this.b.addEventListener(t,this.qb.bind(this,"video"))}.bind(e)),Lr.forEach(function(t){this.a.addEventListener(t,this.qb.bind(this,"player"))}.bind(e)),e.a.xb(1920,1080),e.a.addEventListener("loading",function(){this.g=!1,D(this)}.bind(e)),e.a.addEventListener("unloading",function(){this.g=!0,D(this)}.bind(e)),e.b.addEventListener("ended",function(){t.setTimeout(function(){this.b&&this.b.ended&&(this.g=!0,D(this))}.bind(this),5e3)}.bind(e))}function D(t){Promise.resolve().then(function(){this.dispatchEvent(new g("caststatuschanged"))}.bind(t))}function x(t,e,i){for(var n in e.player)t.a[n](e.player[n]);t.j(i),i=Promise.resolve();var r=t.b.autoplay;e.manifest&&(t.b.autoplay=!1,i=t.a.load(e.manifest,e.startTime),i["catch"](function(t){this.a.dispatchEvent(new g("error",{detail:t}))}.bind(t))),i.then(function(){for(var t in e.video){var i=e.video[t];this.b[t]=i}for(t in e.playerAfterLoad)i=e.playerAfterLoad[t],this.a[t](i);this.b.autoplay=r,e.manifest&&this.b.play()}.bind(t))}function j(t,e,i){t.h&&(e=p(e),i?t.f.getCastChannel(i).send(e):t.f.broadcast(e))}function L(t,e){return t.reduce(function(t,e,i){return e["catch"](t.bind(null,i))}.bind(null,e),Promise.reject())}function U(t,e){return t.concat(e)}function B(){}function F(t){return null!=t}function K(t){return function(e){return e!=t}}function V(t){return!t||!Object.keys(t).length}function q(t){return Object.keys(t).map(function(e){return t[e]})}function H(t,e){return Object.keys(t).reduce(function(i,n){return i[n]=e(t[n],n),i},{})}function G(t,e){return Object.keys(t).every(function(i){return e(i,t[i])})}function Y(e){return t.btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=*$/,"")}function z(e){e=t.atob(e.replace(/-/g,"+").replace(/_/g,"/"));for(var i=new Uint8Array(e.length),n=0;n<e.length;++n)i[n]=e.charCodeAt(n);return i}function $(e){for(var i=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)i[n/2]=t.parseInt(e.substr(n,2),16);return i}function W(t){for(var e="",i=0;i<t.length;++i){var n=t[i].toString(16);1==n.length&&(n="0"+n),e+=n}return e}function X(t,e){if(!t&&!e)return!0;if(!t||!e||t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!=e[i])return!1;return!0}function J(t,e){var i=Q(t,e);return 1!=i.length?null:i[0]}function Q(t,e){return Array.prototype.filter.call(t.childNodes,function(t){return t.tagName==e})}function Z(t){return(t=t.firstChild)&&t.nodeType==Node.TEXT_NODE?t.nodeValue.trim():null}function tt(t,e,i,n){var r=null;return t=t.getAttribute(e),null!=t&&(r=i(t)),null==r?void 0!==n?n:null:r}function et(t){return t?(t=Date.parse(t),isNaN(t)?null:Math.floor(t/1e3)):null}function it(t){return t&&(t=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(t))?(t=31536e3*Number(t[1]||null)+2592e3*Number(t[2]||null)+86400*Number(t[3]||null)+3600*Number(t[4]||null)+60*Number(t[5]||null)+Number(t[6]||null),isFinite(t)?t:null):null}function nt(t){var e=/([0-9]+)-([0-9]+)/.exec(t);return e?(t=Number(e[1]),isFinite(t)?(e=Number(e[2]),isFinite(e)?{start:t,end:e}:null):null):null}function rt(t){return t=Number(t),t%1?null:t}function st(t){return t=Number(t),!(t%1)&&0<t?t:null}function at(t){return t=Number(t),!(t%1)&&0<=t?t:null}function ot(t,e){var i=lt(t),n=null,r=i.filter(function(t){return"urn:mpeg:dash:mp4protection:2011"!=t.ub||(n=t.init||n,!1)}),s=i.map(function(t){return t.keyId}).filter(F),a=null;if(0<s.length&&(a=s[0],s.some(K(a))))throw new y(4,4010);return s=[],0<r.length?(s=ct(n,e,r),s.length||(s=[ht("",n)])):0<i.length&&(s=q(qr).map(function(t){return ht(t,n)})),{eb:a,Wc:n,drmInfos:s,fb:!0}}function ut(t,e,i){var n=ot(t,e);if(i.fb)t=1==i.drmInfos.length&&!i.drmInfos[0].keySystem,e=!n.drmInfos.length,(!i.drmInfos.length||t&&!e)&&(i.drmInfos=n.drmInfos),i.fb=!1;else if(0<n.drmInfos.length&&(i.drmInfos=i.drmInfos.filter(function(t){return n.drmInfos.some(function(e){return e.keySystem==t.keySystem})}),!i.drmInfos.length))throw new y(4,4008);return n.eb||i.eb}function ht(t,e){return{keySystem:t,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:e||[]}}function ct(t,e,i){return i.map(function(i){var n=qr[i.ub];return n?[ht(n,i.init||t)]:e(i.node)||[]}).reduce(U,[])}function lt(t){return t.map(function(t){var e=t.getAttribute("schemeIdUri"),i=t.getAttribute("cenc:default_KID"),n=Q(t,"cenc:pssh").map(Z);if(!e)return null;if(e=e.toLowerCase(),i&&(i=i.replace(/-/g,"").toLowerCase(),0<=i.indexOf(" ")))throw new y(4,4009);var r=[];try{r=n.map(function(t){return{initDataType:"cenc",initData:z(t)}})}catch(s){throw new y(4,4007)}return{node:t,ub:e,keyId:i,init:0<r.length?r:null}}).filter(F)}function ft(t){var e;t instanceof ft?(dt(this,t.R),this.ia=t.ia,this.S=t.S,pt(this,t.ua),this.O=t.O,mt(this,wt(t.a)),this.da=t.da):t&&(e=String(t).match(Hr))?(dt(this,e[1]||"",!0),this.ia=bt(e[2]||""),this.S=bt(e[3]||"",!0),pt(this,e[4]),this.O=bt(e[5]||"",!0),mt(this,e[6]||"",!0),this.da=bt(e[7]||"")):this.a=new vt(null)}function dt(t,e,i){t.R=i?bt(e,!0):e,t.R&&(t.R=t.R.replace(/:$/,""))}function pt(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.ua=e}else t.ua=null}function mt(t,e,i){e instanceof vt?t.a=e:(i||(e=yt(e,$r)),t.a=new vt(e))}function bt(t,e){return t?e?decodeURI(t):decodeURIComponent(t):""}function yt(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,gt),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function gt(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(15&t).toString(16)}function vt(t){this.b=t||null}function wt(t){var e=new vt;if(e.b=t.b,t.a){var i,n={};for(i in t.a)n[i]=t.a[i].concat();e.a=n,e.c=t.c}return e}function Tt(t,e,i){this.a=t,this.K=e,this.C=i}function St(t,e,i,n,r,s){this.position=t,this.startTime=e,this.endTime=i,this.a=n,this.K=r,this.C=s}function Et(e,i,n,r,s){null!==s&&(s=Math.round(s));var a={RepresentationID:i,Number:n,Bandwidth:r,Time:s};return e.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(e,i,n){if("$$"==e)return"$";var r=a[i];return null==r?e:("RepresentationID"==i&&n&&(n=void 0),e=r.toString(),n=t.parseInt(n,10)||1,Array(Math.max(0,n-e.length)+1).join("0")+e)})}function It(t,e){if(e.length){var i=e[0];i.startTime<=Xr&&(e[0]=new St(i.position,0,i.endTime,i.a,i.K,i.C)),null!=t&&t!=Number.POSITIVE_INFINITY&&(i=e[e.length-1],i.startTime>t||(e[e.length-1]=new St(i.position,i.startTime,t,i.a,i.K,i.C)))}}function kt(t,e){if(!e.length)return t;var i=e.map(function(t){return new ft(t)});return t.map(function(t){return new ft(t)}).map(function(t){return i.map(t.resolve.bind(t))}).reduce(U,[]).map(function(t){return t.toString()})}function Pt(t,e){var i=_t(t,e,"timescale"),n=1;i&&(n=st(i)||1),i=_t(t,e,"duration"),(i=st(i||""))&&(i/=n);var r=_t(t,e,"startNumber"),s=_t(t,e,"presentationTimeOffset"),a=at(r||"");null!=r&&null!=a||(a=1);var o=Nt(t,e,"SegmentTimeline"),r=null;if(o){for(var r=n,u=Number(s),h=t.J.duration||Number.POSITIVE_INFINITY,o=Q(o,"S"),c=[],l=0,f=0;f<o.length;++f){var d=o[f],p=tt(d,"t",at),m=tt(d,"d",at),d=tt(d,"r",rt);if(null!=p&&(p-=u),!m)break;if(p=null!=p?p:l,d=d||0,0>d)if(f+1<o.length){if(d=tt(o[f+1],"t",at),null==d)break;if(p>=d)break;d=Math.ceil((d-p)/m)-1}else{if(h==Number.POSITIVE_INFINITY)break;if(p/r>=h)break;d=Math.ceil((h*r-p)/m)-1}0<c.length&&p!=l&&(c[c.length-1].end=p/r);for(var b=0;b<=d;++b)l=p+m,c.push({start:p/r,end:l/r}),p=l}r=c}return{Ka:n,D:i,fa:a,presentationTimeOffset:Number(s)/n||0,A:r}}function _t(t,e,i){return[e(t.s),e(t.P),e(t.I)].filter(F).map(function(t){return t.getAttribute(i)}).reduce(function(t,e){return t||e})}function Nt(t,e,i){return[e(t.s),e(t.P),e(t.I)].filter(F).map(function(t){return J(t,i)}).reduce(function(t,e){return t||e})}function At(t){this.b=t,this.c=0==Jr,this.a=0}function Ct(t){return t.a<t.b.byteLength}function Rt(t){try{var e=t.b.getUint8(t.a)}catch(i){Lt()}return t.a+=1,e}function Mt(t){try{var e=t.b.getUint16(t.a,t.c)}catch(i){Lt()}return t.a+=2,e}function Ot(t){try{var e=t.b.getUint32(t.a,t.c)}catch(i){Lt()}return t.a+=4,e}function Dt(t){var e,i;try{t.c?(e=t.b.getUint32(t.a,!0),i=t.b.getUint32(t.a+4,!0)):(i=t.b.getUint32(t.a,!1),e=t.b.getUint32(t.a+4,!1))}catch(n){Lt()}if(2097151<i)throw new y(3,3001);return t.a+=8,i*Math.pow(2,32)+e}function xt(t,e){t.a+e>t.b.byteLength&&Lt();var i=t.b.buffer.slice(t.a,t.a+e);return t.a+=e,new Uint8Array(i)}function jt(t,e){t.a+e>t.b.byteLength&&Lt(),t.a+=e}function Lt(){throw new y(3,3e3)}function Ut(t,e){for(;Ct(e);){var i=e.a,n=Ot(e),r=Ot(e);if(1==n?n=Dt(e):n||(n=e.b.byteLength-i),r==t)return n;jt(e,n-(e.a-i))}return-1}function Bt(t,e){for(var i=new At(new DataView(t)),n=[[1836019574,0],[1953653099,0],[1835297121,0],[1835626086,0],[1937007212,0],[1937011556,8],[e,0]],r=-1,s=0;s<n.length;s++){var a=n[s][1],r=Ut(n[s][0],i);if(-1==r)return-1;jt(i,a)}return r}function Ft(t,e,i,n){var r=[];t=new At(new DataView(t));var s=Ut(1936286840,t);if(-1==s)throw new y(3,3004);var a=Rt(t);jt(t,3),jt(t,4);var o=Ot(t);if(!o)throw new y(3,3005);var u,h;for(a?(u=Dt(t),h=Dt(t)):(u=Ot(t),h=Ot(t)),jt(t,2),a=Mt(t),n=u-n,e=e+s+h,s=0;s<a;s++){u=Ot(t),h=(2147483648&u)>>>31,u&=2147483647;var c=Ot(t);if(jt(t,4),1==h)throw new y(3,3006);r.push(new St(r.length,n/o,(n+c)/o,function(){return i},e,e+u-1)),n+=c,e+=u}return r}function Kt(t){this.a=t}function Vt(t){this.b=t,this.a=new At(t),Qr||(Qr=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}function qt(t){var e;if(e=Ht(t),7<e.length)throw new y(3,3002);for(var i=0,n=0;n<e.length;n++)i=256*i+e[n];e=i,i=Ht(t);t:{for(n=0;n<Qr.length;n++)if(X(i,Qr[n])){n=!0;break t}n=!1}if(n)i=t.b.byteLength-t.a.a;else{if(8==i.length&&224&i[1])throw new y(3,3001);for(var n=i[0]&(1<<8-i.length)-1,r=1;r<i.length;r++)n=256*n+i[r];i=n}return i=t.a.a+i<=t.b.byteLength?i:t.b.byteLength-t.a.a,n=new DataView(t.b.buffer,t.b.byteOffset+t.a.a,i),jt(t.a,i),new Gt(e,n)}function Ht(t){var e,i=Rt(t.a);for(e=1;8>=e&&!(i&1<<8-e);e++);if(8<e)throw new y(3,3002);var n=new Uint8Array(e);for(n[0]=i,i=1;i<e;i++)n[i]=Rt(t.a);return n}function Gt(t,e){this.id=t,this.a=e}function Yt(t){if(8<t.a.byteLength)throw new y(3,3002);if(8==t.a.byteLength&&224&t.a.getUint8(0))throw new y(3,3001);for(var e=0,i=0;i<t.a.byteLength;i++)var n=t.a.getUint8(i),e=256*e+n;return e}function zt(t,e,i,n,r,s){function a(){return r}var o=[];t=new Vt(t.a);for(var u=-1,h=-1;Ct(t.a);){var c=qt(t);if(187==c.id){var l=$t(c);l&&(c=i*(l.Qc-s),l=e+l.pc,0<=u&&o.push(new St(o.length,u,c,a,h,l-1)),u=c,h=l)}}return 0<=u&&o.push(new St(o.length,u,n,a,h,null)),o}function $t(t){var e=new Vt(t.a);if(t=qt(e),179!=t.id)throw new y(3,3013);if(t=Yt(t),e=qt(e),183!=e.id)throw new y(3,3012);for(var e=new Vt(e.a),i=0;Ct(e.a);){var n=qt(e);if(241==n.id){i=Yt(n);break}}return{Qc:t,pc:i}}function Wt(t,e){var i=Nt(t,e,"Initialization");if(!i)return null;var n=t.s.M,r=i.getAttribute("sourceURL");r&&(n=kt(t.s.M,[r]));var r=0,s=null;return(i=tt(i,"range",nt))&&(r=i.start,s=i.end),new Tt(function(){return n},r,s)}function Xt(t,e){var i,n=_t(t,Qt,"presentationTimeOffset"),r=Wt(t,Qt);i=Number(n);var s=t.s.mimeType.split("/")[1];if("text"!=t.s.contentType&&"mp4"!=s&&"webm"!=s)throw new y(4,4006);if("webm"==s&&!r)throw new y(4,4005);var a=Nt(t,Qt,"RepresentationIndex"),o=_t(t,Qt,"indexRange"),u=t.s.M,o=nt(o||"");if(a){var h=a.getAttribute("sourceURL");h&&(u=kt(t.s.M,[h])),o=tt(a,"range",nt,o)}if(!o)throw new y(4,4002);return i=Jt(t,e,r,u,o.start,o.end,s,i),{createSegmentIndex:i.createSegmentIndex,findSegmentPosition:i.findSegmentPosition,getSegmentReference:i.getSegmentReference,initSegmentReference:r,presentationTimeOffset:Number(n)||0}}function Jt(t,e,i,n,r,s,a,o){var u=t.presentationTimeline,h=t.J.start,c=t.J.duration,l=e,f=null;return{createSegmentIndex:function(){var t=[l(n,r,s),"webm"==a?l(i.a(),i.K,i.C):null];return l=null,Promise.all(t).then(function(t){var e,i=t[0];if(t=t[1]||null,"mp4"==a)i=Ft(i,r,n,o);else{if(t=new Vt(new DataView(t)),440786851!=qt(t).id)throw new y(3,3008);var s=qt(t);if(408125543!=s.id)throw new y(3,3009);for(t=s.a.byteOffset,s=new Vt(s.a),e=null;Ct(s.a);){var l=qt(s);if(357149030==l.id){e=l;break}}if(!e)throw new y(3,3010);for(s=new Vt(e.a),e=1e6,l=null;Ct(s.a);){var d=qt(s);if(2807729==d.id)e=Yt(d);else if(17545==d.id)if(l=d,4==l.a.byteLength)l=l.a.getFloat32(0);else{if(8!=l.a.byteLength)throw new y(3,3003);l=l.a.getFloat64(0)}}if(null==l)throw new y(3,3011);if(s=e/1e9,e=l*s,i=qt(new Vt(new DataView(i))),475249515!=i.id)throw new y(3,3007);i=zt(i,t,s,e,n,o)}It(c,i),u.Ca(h,i),f=new Kt(i)})},findSegmentPosition:function(t){return f.find(t)},getSegmentReference:function(t){return f.get(t)}}}function Qt(t){return t.Ea}function Zt(t,e){var i,n=Wt(t,te);i=ie(t);var r=Pt(t,te),s=r.fa;s||(s=1);var a=0;if(r.D?a=r.D*(s-1)-r.presentationTimeOffset:r.A&&0<r.A.length&&(a=r.A[0].start),i={D:r.D,startTime:a,fa:s,presentationTimeOffset:r.presentationTimeOffset,A:r.A,sa:i},!i.D&&!i.A&&1<i.sa.length)throw new y(4,4002);if(!i.D&&!t.J.duration&&!i.A&&1==i.sa.length)throw new y(4,4002);if(i.A&&!i.A.length)throw new y(4,4002);return s=r=null,t.I.id&&t.s.id&&(s=t.I.id+","+t.s.id,r=e[s]),a=ee(t.J.duration,i.fa,t.s.M,i),It(t.J.duration,a),r?(r.Ra(a),r.Na(t.presentationTimeline.qa())):(t.presentationTimeline.Ca(t.J.start,a),r=new Kt(a),s&&(e[s]=r)),{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:r.find.bind(r),getSegmentReference:r.get.bind(r),initSegmentReference:n,presentationTimeOffset:i.presentationTimeOffset}}function te(t){return t.Z}function ee(t,e,i,n){var r=n.sa.length;n.A&&n.A.length!=n.sa.length&&(r=Math.min(n.A.length,n.sa.length));for(var s=[],a=n.startTime,o=0;o<r;o++){var u,h=n.sa[o],c=kt(i,[h.Rb]);u=null!=n.D?a+n.D:n.A?n.A[o].end:a+t,s.push(new St(o+e,a,u,function(t){return t}.bind(null,c),h.start,h.end)),a=u}return s}function ie(t){return[t.s.Z,t.P.Z,t.I.Z].filter(F).map(function(t){return Q(t,"SegmentURL")}).reduce(function(t,e){return 0<t.length?t:e}).map(function(t){var e=t.getAttribute("media");return t=tt(t,"mediaRange",nt,{start:0,end:null}),{Rb:e,start:t.start,end:t.end}})}function ne(t,e,i,n){var r,s=oe(t);r=Pt(t,re);var a=_t(t,re,"media"),o=_t(t,re,"index");if(r={D:r.D,Ka:r.Ka,fa:r.fa,presentationTimeOffset:r.presentationTimeOffset,A:r.A,Qa:a,Ba:o},a=0+(r.Ba?1:0),a+=r.A?1:0,a+=r.D?1:0,!a)throw new y(4,4002);if(1!=a&&(r.Ba&&(r.A=null),r.D=null),!r.Ba&&!r.Qa)throw new y(4,4002);if(r.Ba){if(i=t.s.mimeType.split("/")[1],"mp4"!=i&&"webm"!=i)throw new y(4,4006);if("webm"==i&&!s)throw new y(4,4005);n=Et(r.Ba,t.s.id,null,t.bandwidth||null,null),n=kt(t.s.M,[n]),t=Jt(t,e,s,n,0,null,i,r.presentationTimeOffset)}else r.D?(n||t.presentationTimeline.Sa(r.D),t=se(t,r)):(n=e=null,t.I.id&&t.s.id&&(n=t.I.id+","+t.s.id,e=i[n]),a=ae(t,r),It(t.J.duration,a),e?(e.Ra(a),e.Na(t.presentationTimeline.qa())):(t.presentationTimeline.Ca(t.J.start,a),e=new Kt(a),n&&(i[n]=e)),t={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:e.find.bind(e),getSegmentReference:e.get.bind(e)});return{createSegmentIndex:t.createSegmentIndex,findSegmentPosition:t.findSegmentPosition,getSegmentReference:t.getSegmentReference,initSegmentReference:s,presentationTimeOffset:r.presentationTimeOffset}}function re(t){return t.Fa}function se(t,e){var i=t.J.duration,n=e.D,r=e.fa,s=e.Ka,a=e.Qa,o=t.bandwidth||null,u=t.s.id,h=t.s.M;return{createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return 0>t||i&&t>=i?null:Math.floor(t/n)},getSegmentReference:function(t){var e=t*n;return new St(t,e,e+n,function(){var i=Et(a,u,t+r,o,e*s);return kt(h,[i])},0,null)}}}function ae(t,e){for(var i=[],n=0;n<e.A.length;n++){var r=e.A[n].start,s=n+e.fa;i.push(new St(s,r,e.A[n].end,function(t,e,i,n,r,s){return t=Et(t,e,r,i,s),kt(n,[t]).map(function(t){return t.toString()})}.bind(null,e.Qa,t.s.id,t.bandwidth||null,t.s.M,s,(r+e.presentationTimeOffset)*e.Ka),0,null))}return i}function oe(t){var e=_t(t,re,"initialization");if(!e)return null;var i=t.s.id,n=t.bandwidth||null,r=t.s.M;return new Tt(function(){var t=Et(e,i,null,n,null);return kt(r,[t])},0,null)}function ue(t){this.f=!1,this.a=[],this.b=[],this.c=[],this.h=t||null}function he(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0}}function ce(t,e){return{uris:t,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:e}}function le(){var t,e={};for(t in ts)e[t]=!0;for(t in es)e[t]=!0;return["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"].forEach(function(t){e[t]=!!ts[t]}),["mpd","m3u8","ism"].forEach(function(t){e[t]=!!es[t]}),e}function fe(t,e,i,n){var r=n;return r||(n=new ft(t).O.split("/").pop().split("."),1<n.length&&(n=n.pop().toLowerCase(),r=es[n])),r?Promise.resolve(r):(i=ce([t],i),i.method="HEAD",e.request(0,i).then(function(e){return(e=e.headers["content-type"])&&(e=e.toLowerCase()),(r=ts[e])?r:Promise.reject(new y(4,4e3,t))},function(){return Promise.reject(new y(4,4e3,t))}))}function de(t,e){this.i=t,this.h=e,this.a=this.c=Number.POSITIVE_INFINITY,this.b=1,this.g=this.f=0}function pe(t,e){this.g=is[e],this.c=t,this.h=0,this.f=Number.POSITIVE_INFINITY,this.a=this.b=null}function me(t,e,i,n){var r=t.h;return Promise.resolve().then(function(){var t=this.g(e,i,n);if(null!=i&&null!=n){for(var s=0;s<t.length&&(t[s].startTime+=r,t[s].endTime+=r,!(t[s].startTime>=this.f));++s)this.c.addCue(t[s]);null==this.b&&(this.b=i),this.a=Math.min(n,this.f)}}.bind(t))}function be(t,e){return null==t.a||t.a<e||e<t.b?0:t.a-e}function ye(t,e){for(var i=t.c.cues,n=[],r=0;r<i.length;++r)e(i[r])&&n.push(i[r]);for(r=0;r<n.length;++r)t.c.removeCue(n[r])}function ge(t,e,i){return i==e||t>=ns&&i==e.split("-")[0]||t>=rs&&i.split("-")[0]==e.split("-")[0]}function ve(t){t=t.toLowerCase().split("-");var e=ss[t[0]];return e&&(t[0]=e),t.join("-")}function we(t){if(!t)return"";t=Ie(new Uint8Array(t)),t=escape(t);try{return decodeURIComponent(t)}catch(e){throw new y(2,2004)}}function Te(t,e){if(!t)return"";if(t.byteLength%2)throw new y(2,2004);var i;if(t instanceof ArrayBuffer)i=t;else{var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(t)),i=n.buffer}var n=t.byteLength/2,r=new Uint16Array(n);i=new DataView(i);for(var s=0;s<n;s++)r[s]=i.getUint16(2*s,e);return Ie(r)}function Se(t){var e=new Uint8Array(t);if(239==e[0]&&187==e[1]&&191==e[2])return we(e.subarray(3));if(254==e[0]&&255==e[1])return Te(e.subarray(2),!1);if(255==e[0]&&254==e[1])return Te(e.subarray(2),!0);var i=function(t,e){return t.byteLength<=e||32<=t[e]&&126>=t[e]}.bind(null,e);if(!e[0]&&!e[2])return Te(t,!1);if(!e[1]&&!e[3])return Te(t,!0);if(i(0)&&i(1)&&i(2)&&i(3))return we(t);throw new y(2,2003)}function Ee(t){t=unescape(encodeURIComponent(t));for(var e=new Uint8Array(t.length),i=0;i<t.length;++i)e[i]=t.charCodeAt(i);return e.buffer}function Ie(t){for(var e="",i=0;i<t.length;i+=16e3)e+=String.fromCharCode.apply(null,t.subarray(i,i+16e3));return e}function ke(){this.l=this.j=this.c=this.a=null,this.g=[],this.b=null,this.h=[],this.u=1,this.i={},this.m=0,this.f=null}function Pe(t){return t.a.request(0,ce(t.g,t.c.retryParameters)).then(function(t){if(this.a)return _e(this,t.data,t.uri)}.bind(t))}function _e(t,e,i){var n=Se(e),r=new DOMParser,s=null;e=null;try{s=r.parseFromString(n,"text/xml")}catch(a){}if(s&&"MPD"==s.documentElement.tagName&&(e=s.documentElement),!e)throw new y(4,4001);i=[i],n=Q(e,"Location").map(Z).filter(F),0<n.length&&(i=t.g=n),n=Q(e,"BaseURL").map(Z),i=kt(i,n);var o=tt(e,"minBufferTime",it);t.m=tt(e,"minimumUpdatePeriod",it,-1);var u,s=tt(e,"availabilityStartTime",et),n=tt(e,"timeShiftBufferDepth",it),h=tt(e,"suggestedPresentationDelay",it),r=tt(e,"maxSegmentDuration",it);u=t.b?t.b.presentationTimeline:new de(s,null!=h?h:5);var s=Ne(t,{presentationTimeline:u,I:null,J:null,P:null,s:null,bandwidth:void 0},i,e),c=s.periods;return u.xa(s.duration||Number.POSITIVE_INFINITY),u.yb(null!=n?n:Number.POSITIVE_INFINITY),u.Sa(r||1),t.b?Promise.resolve():(e=Q(e,"UTCTiming"),De(t,i,e,u.T()).then(function(t){this.a&&(u.wb(t),this.b={presentationTimeline:u,periods:c,offlineSessionIds:[],minBufferTime:o||0})}.bind(t)))}function Ne(t,e,i,n){var r=tt(n,"mediaPresentationDuration",it),s=[],a=0;n=Q(n,"Period");for(var o=0;o<n.length;o++){var u=n[o],a=tt(u,"start",it,a),h=tt(u,"duration",it);if(null==h)if(o+1!=n.length){var c=tt(n[o+1],"start",it);null!=c&&(h=c-a)}else null!=r&&(h=r-a);var c=t,l=e,u={start:a,duration:h,node:u};if(l.I=Ce(u.node,null,i),l.J=u,l.I.id||(l.I.id="__shaka_period_"+u.start),c=Q(u.node,"AdaptationSet").map(c.ic.bind(c,l)),!c.length)throw new y(4,4004);if(c=Re(c),u={startTime:u.start,streamSets:c},s.push(u),c=e.I.id,t.h.every(K(c))&&(t.j(u),t.h.push(c),t.b&&t.b.periods.push(u)),null==h){a=null;break}a+=h}return null!=r?{periods:s,duration:r}:{periods:s,duration:a}}function Ae(e,i){
0>e.m||(e.f=t.setTimeout(e.Hc.bind(e),1e3*Math.max(Math.max(3,e.m)-i,0)))}function Ce(t,e,i){e=e||{contentType:"",mimeType:"",codecs:""},i=i||e.M;var n=Q(t,"BaseURL").map(Z),r=t.getAttribute("contentType")||e.contentType,s=t.getAttribute("mimeType")||e.mimeType;return r||(r=s.split("/")[0]),{M:kt(i,n),Ea:J(t,"SegmentBase")||e.Ea,Z:J(t,"SegmentList")||e.Z,Fa:J(t,"SegmentTemplate")||e.Fa,width:tt(t,"width",at)||e.width,height:tt(t,"height",at)||e.height,contentType:r,mimeType:s,codecs:t.getAttribute("codecs")||e.codecs,id:t.getAttribute("id")}}function Re(t){var e={};t.forEach(function(t){e[t.id]=[t]}),t.forEach(function(t){var i=e[t.id];t.Mc.forEach(function(t){(t=e[t])&&t!=i&&(i.push.apply(i,t),t.forEach(function(t){e[t.id]=i}))})});var i=[],n=[];return q(e).forEach(function(t){if(!(0<=n.indexOf(t))){n.push(t);var e=new I;t.forEach(function(t){e.push(t.contentType||"",t)}),e.keys().forEach(function(t){var n=new I;e.get(t).forEach(function(t){n.push(t.language,t)}),n.keys().forEach(function(e){var r=n.get(e);e={language:e,type:t,primary:r.some(function(t){return t.Qb}),drmInfos:r.map(function(t){return t.drmInfos}).reduce(U,[]),streams:r.map(function(t){return t.streams}).reduce(U,[])},i.push(e)})})}}),i}function Me(t){var e;return e=0+(t.Ea?1:0),e+=t.Z?1:0,(e+=t.Fa?1:0)?(1!=e&&(t.Ea&&(t.Z=null),t.Fa=null),!0):"text"==t.contentType||"application"==t.contentType}function Oe(t,e,i,n){return e=kt(e,[i]),e=ce(e,t.c.retryParameters),e.method=n,t.a.request(0,e).then(function(t){if("HEAD"==n){if(!t.headers||!t.headers.date)return 0;t=t.headers.date}else t=Se(t.data);return t=Date.parse(t),isNaN(t)?0:t-Date.now()})}function De(t,e,i,n){i=i.map(function(t){return{scheme:t.getAttribute("schemeIdUri"),value:t.getAttribute("value")}});var r=t.c.dash.clockSyncUri;return n&&!i.length&&r&&i.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:r}),L(i,function(t){var i=t.value;switch(t.scheme){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return Oe(this,e,i,"HEAD");case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return Oe(this,e,i,"GET");case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return t=Date.parse(i),isNaN(t)?0:t-Date.now();case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":return Promise.reject();default:return Promise.reject()}}.bind(t))["catch"](function(){return 0})}function xe(t,e,i){for(var n=0;n<t.length;++n)if(i(t[n],e))return n;return-1}function je(t){this.a=null,this.b=function(){this.a=null,t()}.bind(this)}function Le(t){null!=t.a&&(clearTimeout(t.a),t.a=null)}function Ue(t){Le(t),t.a=setTimeout(t.b,100)}function Be(t,e,i){this.l=this.h=this.m=null,this.B=!1,this.b=null,this.f=new k,this.a=[],this.u=[],this.j=new v,this.G=t,this.i=null,this.g=function(t){this.j.reject(t),e(t)}.bind(this),this.w={},this.L=i,this.v=new je(this.mc.bind(this)),this.F=this.c=!1,this.j["catch"](function(){})}function Fe(t,e){if(!t.h)return P(t.f,e,"encrypted",function(){this.f.ha(e,"encrypted"),this.g(new y(6,6010))}.bind(t)),Promise.resolve();t.l=e;var i=t.l.setMediaKeys(t.h),i=i["catch"](function(t){return Promise.reject(new y(6,6003,t.message))}),n=null;return t.b.serverCertificate&&(n=t.h.setServerCertificate(t.b.serverCertificate),n=n["catch"](function(t){return Promise.reject(new y(6,6004,t.message))})),Promise.all([i,n]).then(function(){return this.c?Promise.reject():(Ve(this),void(this.b.initData.length||this.u.length||P(this.f,this.l,"encrypted",this.Tb.bind(this))))}.bind(t))["catch"](function(t){return this.c?Promise.resolve():Promise.reject(t)}.bind(t))}function Ke(t,e){return Promise.all(e.map(function(t){return Xe(this,t).then(function(t){if(t)return t.remove()})}.bind(t)))}function Ve(t){var e=t.b?t.b.initData:[];return e.forEach(function(t){Je(this,t.initDataType,t.initData)}.bind(t)),t.u.forEach(function(t){Xe(this,t)}.bind(t)),e.length||t.u.length||t.j.resolve(),t.j}function qe(t){return t.a.map(function(t){return t.wa.sessionId})}function He(t,e,i,n,r){var s=ze(t),a=0<=navigator.userAgent.indexOf("Edge/");e.periods.forEach(function(t){t.streamSets.forEach(function(t){"text"!=t.type&&(s&&(t.drmInfos=[s]),t.drmInfos.forEach(function(e){Ye(this,e);var s=n[e.keySystem];s||(s={audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:"optional",persistentState:i?"required":"optional",sessionTypes:[i?"persistent-license":"temporary"],label:e.keySystem,drmInfos:[]},n[e.keySystem]=s,r.push(e.keySystem)),s.drmInfos.push(e),e.distinctiveIdentifierRequired&&(s.distinctiveIdentifier="required"),e.persistentStateRequired&&(s.persistentState="required");var o="video"==t.type?s.videoCapabilities:s.audioCapabilities,u=("video"==t.type?e.videoRobustness:e.audioRobustness)||"";t.streams.forEach(function(t){var i=t.mimeType;t.codecs&&(i+='; codecs="'+t.codecs+'"'),a&&"com.microsoft.playready"==e.keySystem&&o.length||o.push({robustness:u,contentType:i})}.bind(this))}.bind(this)))}.bind(this))}.bind(t))}function Ge(t,e,i){if(1==i.length&&""==i[0])return Promise.reject(new y(6,6e3));var n=new v,r=n;return[!0,!1].forEach(function(t){i.forEach(function(i){var n=e[i];n.drmInfos.some(function(t){return!!t.licenseServerUri})==t&&(n.audioCapabilities.length||delete n.audioCapabilities,n.videoCapabilities.length||delete n.videoCapabilities,r=r["catch"](function(){return this.c?Promise.reject():navigator.requestMediaKeySystemAccess(i,[n])}.bind(this)))}.bind(this))}.bind(t)),r=r["catch"](function(){return Promise.reject(new y(6,6001))}),r=r.then(function(t){if(this.c)return Promise.reject();var i=t.getConfiguration();return this.m=(i.audioCapabilities||[]).concat(i.videoCapabilities||[]).map(function(t){return t.contentType}),this.m.length||(this.m=null),i=e[t.keySystem],$e(this,t.keySystem,i,i.drmInfos),this.b.licenseServerUri?t.createMediaKeys():Promise.reject(new y(6,6012))}.bind(t)).then(function(t){return this.c?Promise.reject():(this.h=t,void(this.B=!0))}.bind(t))["catch"](function(t){return this.c?Promise.resolve():(this.m=this.b=null,t instanceof y?Promise.reject(t):Promise.reject(new y(6,6002,t.message)))}.bind(t)),n.reject(),r}function Ye(t,e){var i=e.keySystem;if(i){if(!e.licenseServerUri){var n=t.i.servers[i];n&&(e.licenseServerUri=n)}(i=t.i.advanced[i])&&(e.distinctiveIdentifierRequired||(e.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),e.persistentStateRequired||(e.persistentStateRequired=i.persistentStateRequired),e.videoRobustness||(e.videoRobustness=i.videoRobustness),e.audioRobustness||(e.audioRobustness=i.audioRobustness),e.serverCertificate||(e.serverCertificate=i.serverCertificate))}}function ze(e){if(V(e.i.clearKeys))return null;var i,n=[],r=[];for(i in e.i.clearKeys){var s=e.i.clearKeys[i],a=$(i),s=$(s),a={kty:"oct",kid:Y(a),k:Y(s)};n.push(a),r.push(a.kid)}return e=JSON.stringify({keys:n}),r=JSON.stringify({kids:r}),r=[{initData:new Uint8Array(Ee(r)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+t.btoa(e),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:r}}function $e(t,e,i,n){var r=[],s=[],a=[];We(n,r,s,a),t.b={keySystem:e,licenseServerUri:r[0],distinctiveIdentifierRequired:"required"==i.distinctiveIdentifier,persistentStateRequired:"required"==i.persistentState,audioRobustness:i.audioCapabilities?i.audioCapabilities[0].robustness:"",videoRobustness:i.videoCapabilities?i.videoCapabilities[0].robustness:"",serverCertificate:s[0],initData:a}}function We(t,e,i,n){function r(t,e){return t.initDataType==e.initDataType&&X(t.initData,e.initData)}t.forEach(function(t){-1==e.indexOf(t.licenseServerUri)&&e.push(t.licenseServerUri),t.serverCertificate&&-1==xe(i,t.serverCertificate,X)&&i.push(t.serverCertificate),t.initData&&t.initData.forEach(function(t){-1==xe(n,t,r)&&n.push(t)})})}function Xe(t,e){var i;try{i=t.h.createSession("persistent-license")}catch(n){var r=new y(6,6005,n.message);return t.g(r),Promise.reject(r)}P(t.f,i,"message",t.ob.bind(t)),P(t.f,i,"keystatuseschange",t.jb.bind(t));var s={initData:null,wa:i,loaded:!1};return t.a.push(s),i.load(e).then(function(t){if(!this.c){if(t)return s.loaded=!0,this.a.every(function(t){return t.loaded})&&this.j.resolve(),i;this.a.splice(this.a.indexOf(s),1),this.g(new y(6,6013))}}.bind(t),function(t){this.c||(this.a.splice(this.a.indexOf(s),1),this.g(new y(6,6005,t.message)))}.bind(t))}function Je(t,e,i){var n;try{n=t.F?t.h.createSession("persistent-license"):t.h.createSession()}catch(r){return void t.g(new y(6,6005,r.message))}P(t.f,n,"message",t.ob.bind(t)),P(t.f,n,"keystatuseschange",t.jb.bind(t)),t.a.push({initData:i,wa:n,loaded:!1}),n.generateRequest(e,i.buffer)["catch"](function(t){if(!this.c){for(var e=0;e<this.a.length;++e)if(this.a[e].wa==n){this.a.splice(e,1);break}this.g(new y(6,6006,t.message))}}.bind(t))}function Qe(t){for(var e=Te(t.body,!0),e=(new DOMParser).parseFromString(e,"application/xml"),i=e.getElementsByTagName("HttpHeader"),n=0;n<i.length;++n)t.headers[i[n].querySelector("name").textContent]=i[n].querySelector("value").textContent;t.body=z(e.querySelector("Challenge").textContent).buffer}function Ze(){var t=[],e={persistentState:"required",sessionTypes:["persistent-license"]},i={};return"org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" ").forEach(function(n){var r=navigator.requestMediaKeySystemAccess(n,[e,{}]).then(function(t){return t.createMediaKeys()}).then(function(t){var e=!1;try{t.createSession("persistent-license"),e=!0}catch(r){}i[n]={persistentState:e}},function(){i[n]=null});t.push(r)}),Promise.all(t).then(function(){return i})}function ti(t,e){if(!t||1==t.length&&1e-6>t.end(0)-t.start(0))return 0;for(var i=0;i<t.length;++i)if(e+1e-4>=t.start(i)&&e<t.end(i))return t.end(i)-e;return 0}function ei(t,e,i){this.i=t,this.f=e,this.j=i,this.c={},this.b=null,this.a={},this.g=new k,this.h=!1}function ii(){var t={};return'video/mp4; codecs="avc1.42E01E",audio/mp4; codecs="mp4a.40.2",video/webm; codecs="vp8",video/webm; codecs="vp9",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="mp4a.40.2",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(",").forEach(function(e){t[e]=!!is[e]||MediaSource.isTypeSupported(e);var i=e.split(";")[0];t[i]=t[i]||t[e]}),t}function ni(t,e){var i;return"text"==e?i=t.b.b:(i=si(t,e),i=!i||1==i.length&&1e-6>i.end(0)-i.start(0)?null:i.length?i.start(0):null),i}function ri(t,e,i){return"text"==e?(e=be(t.b,i),e||(e=be(t.b,i+.1))&&(e+=.1)):(t=si(t,e),e=ti(t,i),e||(e=ti(t,i+.1))&&(e+=.1)),e}function si(t,e){try{return t.c[e].buffered}catch(i){return null}}function ai(t,e,i,n,r){return"text"==e?me(t.b,i,n,r):hi(t,e,t.Ic.bind(t,e,i))}function oi(t,e,i){return"text"==e?(t.b.h=i,Promise.resolve()):hi(t,e,t.zc.bind(t,e,i))}function ui(t,e,i){return"text"==e?(t.b.f=i,Promise.resolve()):Promise.all([hi(t,e,t.bb.bind(t,e)),hi(t,e,t.xc.bind(t,e,i))])}function hi(t,e,i){if(t.h)return Promise.reject();if(i={start:i,p:new v},t.a[e].push(i),1==t.a[e].length)try{i.start()}catch(n){"QuotaExceededError"==n.name?i.p.reject(new y(3,3017,e)):i.p.reject(new y(3,3015,n)),li(t,e)}return i.p}function ci(t,e){if(t.h)return Promise.reject();var i,n=[];for(i in t.c){var r=new v,s={start:function(t){t.resolve()}.bind(null,r),p:r};t.a[i].push(s),n.push(r),1==t.a[i].length&&s.start()}return Promise.all(n).then(function(){var t,i;try{e()}catch(n){i=Promise.reject(new y(3,3015,n))}for(t in this.c)li(this,t);return i}.bind(t),function(){return Promise.reject()}.bind(t))}function li(t,e){t.a[e].shift();var i=t.a[e][0];if(i)try{i.start()}catch(n){i.p.reject(new y(3,3015,n)),li(t,e)}}function fi(t){var e=Se(t);t=[];var i=new DOMParser,n=null;try{n=i.parseFromString(e,"text/xml")}catch(r){throw new y(2,2005)}if(n){var s,a;if(!(e=n.getElementsByTagName("tt")[0]))throw new y(2,2006);for(i=e.getAttribute("ttp:frameRate"),n=e.getAttribute("ttp:subFrameRate"),s=e.getAttribute("ttp:frameRateMultiplier"),a=e.getAttribute("ttp:tickRate"),i=new di(i,n,s,a),n=fi.b(e.getElementsByTagName("styling")[0]),s=fi.b(e.getElementsByTagName("layout")[0]),e=fi.b(e.getElementsByTagName("body")[0]),a=0;a<e.length;a++){var o=fi.c(e[a],i,n,s);o&&t.push(o)}}return t}function di(t,e,i,n){this.a=Number(t)||30,this.c=Number(e)||1,this.b=Number(n),this.b||(this.b=t?this.a*this.c:1),i&&(t=/^(\d+) (\d+)$/g.exec(i))&&(this.a*=t[1]/t[2])}function pi(t){var e=new At(new DataView(t)),i=Ut(1835295092,e);if(-1!=i)return fi(xt(e,i-8).buffer);if(-1!=Bt(t,pi.L))return[];throw new y(2,2007)}function mi(t){this.b=t,this.a=0}function bi(t,e){var i;return e.lastIndex=t.a,i=(i=e.exec(t.b))?{position:i.index,length:i[0].length,uc:i}:null,t.a!=t.b.length&&i&&i.position==t.a?(t.a+=i.length,i.uc):null}function yi(t){return t.a==t.b.length?null:(t=bi(t,/[^ \t\n]*/gm))?t[0]:null}function gi(t){if(t=Se(t),t=t.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n"),t=t.split(/\n{2,}/m),!/^WEBVTT($|[ \t\n])/m.test(t[0]))throw new y(2,2e3);for(var e=[],i=1;i<t.length;i++){var n=gi.c(t[i].split("\n"));n&&e.push(n)}return e}function vi(t,e,i){var n=new At(new DataView(t)),r=Ut(1835295092,n);if(-1!=r)return vi.oa(xt(n,r-8).buffer,e,i);if(-1!=Bt(t,vi.ka))return[];throw new y(2,2008)}function wi(t,e,i,n,r,s){this.a=t,this.c=e,this.i=i,this.m=n,this.j=r,this.l=s,this.b=new k,this.h=!1,this.g=1,this.f=null,0<t.readyState?this.kb():P(this.b,t,"loadedmetadata",this.kb.bind(this)),P(this.b,t,"ratechange",this.$b.bind(this))}function Ti(t){return 0<t.a.readyState?_i(t,t.a.currentTime):Si(t)}function Si(t){return t.m?_i(t,t.m):t.c.X()<Number.POSITIVE_INFINITY?t.c.pa():Math.max(t.c.Y()-t.i,t.c.pa())}function Ei(t,e){e!=t.h&&(t.h=e,Ii(t,t.g),t.j(e))}function Ii(e,i){null!=e.f&&(t.clearInterval(e.f),e.f=null),e.g=i,e.a.playbackRate=e.h||0>i?0:i,!e.h&&0>i&&(e.f=t.setInterval(function(){this.a.currentTime+=i/4}.bind(e),250))}function ki(t,e){var i=t.c,n=i.pa(),r=i.Y();return i.T()&&i.a!=Number.POSITIVE_INFINITY?(i=n+1,n=i+t.i,e>=n&&e<=r||ti(t.a.buffered,e)&&e>=i&&e<=r?e:e>r?r:r<n&&e>=i&&e<=r?e:Math.min(n+2,r)):e<n?n:e>r?r:e}function Pi(t,e,i){t.a.currentTime=i;var n=0,r=function(){!this.a||10<=n++||this.a.currentTime!=e||(this.a.currentTime=i,setTimeout(r,100))}.bind(t);setTimeout(r,100)}function _i(t,e){var i=t.c.pa();return e<i?i:(i=t.c.Y(),e>i?i:e)}function Ni(t,e,i,n,r,s,a,o,u){this.h=t,this.c=e,this.L=i,this.a=n,this.G=r,this.v=s,this.j=a,this.w=o||null,this.B=u||null,this.m=null,this.i=1,this.F=Promise.resolve(),this.g=[],this.l={},this.b={},this.f=this.u=!1}function Ai(t){return t.a.periods[$i(t,Ti(t.h))]}function Ci(t){return H(t.b,function(t){return t.stream})}function Ri(t,e){var i={};return i.text=e,Di(t,i)}function Mi(t,e,i,n){if(e=t.b[e]){var r=t.g[Wi(t,i)];r&&r.va&&(r=t.l[i.id])&&r.va&&e.stream!=i&&(e.stream=i,e.Ha=!0,void 0==n||e.ba||e.ca||(e.ea?Oi(e,n):(Zi(e),Ji(t,e,n))))}}function Oi(t,e){t.ba?t.Ga=Math.min(t.Ga,e):(t.ba=!0,t.Ga=e)}function Di(t,e){var i=$i(t,Ti(t.h)),n=H(e,function(t){return t.mimeType+(t.codecs?'; codecs="'+t.codecs+'"':"")});return t.c.init(n),Li(t),n=q(e),ji(t,n).then(function(){if(!this.f)for(var t in e){var n=e[t];this.b[t]||(this.b[t]={stream:n,type:t,ra:null,U:null,Ha:!0,ta:!1,Ia:i,endOfStream:!1,ea:!1,aa:null,ba:!1,Ga:0,ca:!1,Va:!1},Qi(this,this.b[t],0))}}.bind(t))}function xi(t,e){var i=t.g[e];if(i)return i.H;i={H:new v,va:!1},t.g[e]=i;var n=t.a.periods[e].streamSets.map(function(t){return t.streams}).reduce(U,[]);return t.F=t.F.then(function(){if(!this.f)return ji(this,n)}.bind(t)).then(function(){this.f||(this.g[e].H.resolve(),this.g[e].va=!0)}.bind(t))["catch"](function(t){this.f||(this.g[e].H.reject(),delete this.g[e],this.j(t))}.bind(t)),i.H}function ji(t,e){for(var i=[],n=0;n<e.length;++n){var r=e[n],s=t.l[r.id];s?i.push(s.H):(t.l[r.id]={H:new v,va:!1},i.push(r.createSegmentIndex()))}return Promise.all(i).then(function(){if(!this.f)for(var t=0;t<e.length;++t){var i=this.l[e[t].id];i.va||(i.H.resolve(),i.va=!0)}}.bind(t))["catch"](function(t){if(!this.f)return this.l[r.id].H.reject(),delete this.l[r.id],Promise.reject(t)}.bind(t))}function Li(t){var e=t.a.presentationTimeline.X();e<Number.POSITIVE_INFINITY?t.c.xa(e):t.c.xa(Math.pow(2,32))}function Ui(t,e){var i=Ti(t.h),n=ri(t.c,e.type,i),r=t.i*Math.max(t.a.minBufferTime||0,t.m.rebufferingGoal);if(n>=Math.max(r,t.i*t.m.bufferingGoal))return e.ta=!1,.5;var s;s=t.c;var a=e.type;return"text"==a?s=s.b.a:(s=si(s,a),s=!s||1==s.length&&1e-6>s.end(0)-s.start(0)?null:s.length?s.end(s.length-1):null),a=e.ra&&e.U?t.a.periods[Wi(t,e.ra)].startTime+e.U.endTime:i,a>=t.a.presentationTimeline.X()?(e.ta=!1,e.endOfStream=!0,null):(e.endOfStream=!1,!t.u&&n<r||1>=n?e.ta=!0:n>=r&&(e.ta=!1),n=Wi(t,e.stream),r=$i(t,a),r!=n?(e.Ia=r,null):(e.U&&e.stream==e.ra?(r=e.U.position+1,r=Bi(t,e,n,r)):(r=e.U?e.stream.findSegmentPosition(Math.max(0,t.a.periods[Wi(t,e.ra)].startTime+e.U.endTime-t.a.periods[n].startTime)):e.stream.findSegmentPosition(Math.max(0,(s||i)-t.a.periods[n].startTime)),null==r?r=null:(a=null,null==s&&(a=Bi(t,e,n,Math.max(0,r-1))),r=a||Bi(t,e,n,r))),r?(Fi(t,e,i,n,r),null):1))}function Bi(t,e,i,n){return i=t.a.periods[i],(e=e.stream.getSegmentReference(n))?(t=t.a.presentationTimeline,n=t.Y(),i.startTime+e.endTime<t.qa()||i.startTime+e.startTime>n?null:e):null}function Fi(t,e,i,n,r){var s=t.a.periods[n],a=e.stream,o=t.a.periods[n+1],u=null,u=o?o.startTime:t.a.presentationTimeline.X();n=Vi(t,e,n,u),e.ea=!0,e.Ha=!1,o=Xi(t,r),Promise.all([n,o]).then(function(t){if(!this.f)return qi(this,e,i,s,a,r,t[1])}.bind(t)).then(function(){this.f||(e.ea=!1,e.Va=!1,Qi(this,e,0),Gi(this,a))}.bind(t))["catch"](function(t){this.f||(e.ea=!1,1001==t.code||1002==t.code||1003==t.code?(this.j(t),Qi(this,e,4)):3017==t.code?Ki(this,e,t):this.j(t))}.bind(t))}function Ki(t,e,i){if(!q(t.b).some(function(t){return t!=e&&t.Va})){var n=Math.round(100*t.i);if(20<n)t.i-=.2;else{if(!(4<n))return void t.j(i);t.i-=.04}e.Va=!0}Qi(t,e,e.ta?0:4)}function Vi(t,e,i,n){return e.Ha?(i=oi(t.c,e.type,t.a.periods[i].startTime-e.stream.presentationTimeOffset),n=null!=n?ui(t.c,e.type,n):Promise.resolve(),e.stream.initSegmentReference?(t=Xi(t,e.stream.initSegmentReference).then(function(t){if(!this.f)return ai(this.c,e.type,t,null,null)}.bind(t))["catch"](function(t){return e.Ha=!0,Promise.reject(t)}),Promise.all([i,n,t])):Promise.all([i,n])):Promise.resolve()}function qi(t,e,i,n,r,s,a){return Hi(t,e,i).then(function(){if(!this.f)return ai(this.c,e.type,a,s.startTime+n.startTime,s.endTime+n.startTime)}.bind(t)).then(function(){if(!this.f)return e.ra=r,e.U=s,Promise.resolve()}.bind(t))}function Hi(t,e,i){var n=ni(t.c,e.type);return null==n?Promise.resolve():(i=i-n-t.m.bufferBehind,0>=i?Promise.resolve():t.c.remove(e.type,n,n+i).then(function(){}.bind(t)))}function Gi(t,e){if(!t.u&&(t.u=q(t.b).every(function(t){return!t.ba&&!t.ca&&t.U}),t.u)){var i=Wi(t,e);for(t.g[i]||xi(t,i).then(function(){this.v()}.bind(t))["catch"](B),i=0;i<t.a.periods.length;++i)xi(t,i)["catch"](B);t.B&&t.B()}}function Yi(t,e){if(e.Ia!=Wi(t,e.stream)){var i=e.Ia,n=q(t.b);n.every(function(t){return t.Ia==i})&&n.every(zi)&&xi(t,i).then(function(){if(!this.f){var t,e=this.G(this.a.periods[i]);for(t in this.b)if(!e[t])return void this.j(new y(5,5005));for(t in e)if(!this.b[t])return void this.j(new y(5,5005));for(t in this.b){Mi(this,t,e[t]);var n=this.b[t];zi(n)&&Qi(this,n,0)}this.v()}}.bind(t))["catch"](B)}}function zi(t){return!t.ea&&null==t.aa&&!t.ba&&!t.ca}function $i(t,e){for(var i=t.a.periods.length-1;0<i;--i)if(e>=t.a.periods[i].startTime)return i;return 0}function Wi(t,e){for(var i=0;i<t.a.periods.length;++i)for(var n=t.a.periods[i],r=0;r<n.streamSets.length;++r)if(0<=n.streamSets[r].streams.indexOf(e))return i;return-1}function Xi(t,e){var i=ce(e.a(),t.m.retryParameters);if(e.K||null!=e.C){var n="bytes="+e.K+"-";null!=e.C&&(n+=e.C),i.headers.Range=n}return t.L.request(1,i).then(function(t){return t.data})}function Ji(t,e,i){e.ba=!1,e.ca=!0;var n=Ti(t.h)+i,r=t.c.X();(i?t.c.remove(e.type,n,r):t.c.clear(e.type)).then(function(){this.f||(e.ra=null,e.U=null,e.ca=!1,Qi(this,e,0))}.bind(t))}function Qi(e,i,n){i.aa=t.setTimeout(e.W.bind(e,i),1e3*n)}function Zi(e){null!=e.aa&&(t.clearTimeout(e.aa),e.aa=null)}function tn(t,e){return new Promise(function(i,n){var r=new XMLHttpRequest;r.open(e.method,t,!0),r.responseType="arraybuffer",r.timeout=e.retryParameters.timeout,r.withCredentials=e.allowCrossSiteCredentials,r.onload=function(e){if(e=e.target,200<=e.status&&299>=e.status){var r=e.getAllResponseHeaders().split("\r\n").reduce(function(t,e){var i=e.split(": ");return t[i[0].toLowerCase()]=i.slice(1).join(": "),t},{});e.tc&&(t=e.tc),i({uri:t,data:e.response,headers:r})}else{r=null;try{r=Se(e.response)}catch(s){}n(new y(1,1001,t,e.status,r))}},r.onerror=function(){n(new y(1,1002,t))},r.ontimeout=function(){n(new y(1,1003,t))};for(var s in e.headers)r.setRequestHeader(s,e.headers[s]);r.send(e.body)})}function en(){this.a=null,this.c=[],this.b={}}function nn(t,e,i){return an(t,e,"readwrite",function(t){return t.put(i)})}function rn(t,e){var i=[];return an(t,"segment","readwrite",function(t){return t.openCursor()},function(t){if(t){if(e(t.value)){var n=t["delete"](),r=new v;n.onsuccess=r.resolve,n.onerror=on.bind(null,n,r),i.push(r)}t["continue"]()}}).then(function(){return Promise.all(i)}).then(function(){return i.length})}function sn(t,e){var i=0;return an(t,e,"readonly",function(t){return t.openCursor(null,"prev")},function(t){t&&(i=t.key+1)}).then(function(){return i})}function an(t,e,i,n,r){i=t.a.transaction([e],i);var s=n(i.objectStore(e)),a=new v;r&&(s.onsuccess=function(t){r(t.target.result)}),s.onerror=on.bind(null,s,a);var o={transaction:i,H:a};t.c.push(o);var u=function(){this.c.splice(this.c.indexOf(o),1)}.bind(t);return i.oncomplete=function(){u(),a.resolve(s.result)},i.onerror=function(t){u(),on(s,a,t)},a}function on(t,e,i){"AbortError"==t.error.name?e.reject(new y(9,9002)):e.reject(new y(9,9001,t.error)),i.preventDefault()}function un(t){return{offlineUri:"offline:"+t.key,originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,tracks:t.periods[0].streams.map(function(t){return{id:t.id,active:!1,type:t.contentType,bandwidth:0,language:t.language,kind:t.kind||null,width:t.width,height:t.height}}),appMetadata:t.appMetadata}}function hn(t,e,i){this.b={},this.i=i,this.m=t,this.l=e,this.j=this.a=null,this.f=this.g=this.h=this.c=0}function cn(t,e,i,n,r){t.b[e]=t.b[e]||[],t.b[e].push({uris:i.a(),K:i.K,C:i.C,cb:n,Aa:r})}function ln(t,e){t.c=0,t.h=0,t.g=0,t.f=0,q(t.b).forEach(function(t){t.forEach(function(t){null!=t.C?this.c+=t.C-t.K+1:this.g+=t.cb}.bind(this))}.bind(t)),t.a=e,t.a.size=t.c;var i=q(t.b).map(function(t){var e=0,i=function(){if(!this.i)return Promise.reject(new y(9,9002));if(e>=t.length)return Promise.resolve();var n=t[e++];return fn(this,n).then(i)}.bind(this);return i()}.bind(t));return t.b={},t.j=Promise.all(i)}function fn(t,e){var i=ce(e.uris,t.l);(e.K||null!=e.C)&&(i.headers.Range="bytes="+e.K+"-"+(null==e.C?"":e.C));var n;return t.m.request(1,i).then(function(t){return this.a?(n=t.data.byteLength,e.Aa(t.data)):Promise.reject(new y(9,9002))}.bind(t)).then(function(){if(!this.a)return Promise.reject(new y(9,9002));null==e.C?(this.a.size+=n,this.f+=e.cb):this.h+=n;var t=(this.h+this.f)/(this.c+this.g),i=un(this.a);this.i.progressCallback(i,t)}.bind(t))}function dn(){}function pn(t){var e=new de(null,0);e.xa(t.duration);var i=t.drmInfo?[t.drmInfo]:[];return{presentationTimeline:e,minBufferTime:10,offlineSessionIds:t.sessionIds,periods:t.periods.map(function(t){return{startTime:t.startTime,streamSets:t.streams.map(function(n){var r=n.segments.map(function(t,e){return new St(e,t.startTime,t.endTime,function(){return[t.uri]},0,null)});return e.Ca(t.startTime,r),r=new Kt(r),{language:n.language,type:n.contentType,primary:n.primary,drmInfos:i,streams:[{id:n.id,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:r.find.bind(r),getSegmentReference:r.get.bind(r),initSegmentReference:n.initSegmentUri?new Tt(function(){return[n.initSegmentUri]},0,null):null,presentationTimeOffset:n.presentationTimeOffset,mimeType:n.mimeType,codecs:n.codecs,bandwidth:0,width:n.width||void 0,height:n.height||void 0,kind:n.kind,encrypted:n.encrypted,keyId:n.keyId,allowedByApplication:!0,allowedByKeySystem:!0}]}})}})}}function mn(){this.a=Promise.resolve(),this.c=this.b=this.f=!1,this.g=new Promise(function(t){this.h=t}.bind(this))}function bn(t){return t.f||(t.a=t.a.then(function(t){return this.b=!0,Promise.resolve(t)}.bind(t),function(t){return this.b=!0,Promise.reject(t)}.bind(t))),t.f=!0,t.a}function yn(t,e){return t.b?Promise.resolve():(t.c=!0,t.i=e,t.g)}function gn(t,e,i,n,r){var s,a=r in n;for(s in e){var o=r+"."+s,u=a?n[r]:i[s],h=!!{".abr.manager":!0}[o];(a||s in t)&&(void 0===e[s]?void 0===u||a?delete t[s]:t[s]=u:h?t[s]=e[s]:"object"==typeof t[s]&&"object"==typeof e[s]?gn(t[s],e[s],u,n,o):typeof e[s]==typeof u&&(t[s]=e[s]))}}function vn(t,e,i){var n=!1;return t.streamSets.forEach(function(t){t.streams.forEach(function(r){var s=r.allowedByApplication;r.allowedByApplication=!0,"video"==t.type?(r.width<e.minWidth||r.width>e.maxWidth||r.width>i.width||r.height<e.minHeight||r.height>e.maxHeight||r.height>i.height||r.width*r.height<e.minPixels||r.width*r.height>e.maxPixels||r.bandwidth<e.minVideoBandwidth||r.bandwidth>e.maxVideoBandwidth)&&(r.allowedByApplication=!1):"audio"==t.type&&(r.bandwidth<e.minAudioBandwidth||r.bandwidth>e.maxAudioBandwidth)&&(r.allowedByApplication=!1),s!=r.allowedByApplication&&(n=!0)})}),n}function wn(t,e,i){var n="",r=null;for(t&&t.B&&(n=t.keySystem(),r=t.m),t=0;t<i.streamSets.length;++t){var s=i.streamSets[t];if(n&&s.drmInfos.length&&!s.drmInfos.some(function(t){return t.keySystem==n}))i.streamSets.splice(t,1),--t;else{for(var a=e[s.type],o=0;o<s.streams.length;++o){var u=s.streams[o],h=u.mimeType;u.codecs&&(h+='; codecs="'+u.codecs+'"'),is[h]||MediaSource.isTypeSupported(h)?r&&u.encrypted&&0>r.indexOf(h)?(s.streams.splice(o,1),--o):!a||"text"==s.type||u.mimeType==a.mimeType&&u.codecs.split(".")[0]==a.codecs.split(".")[0]||(s.streams.splice(o,1),--o):(s.streams.splice(o,1),--o)}s.streams.length||(i.streamSets.splice(t,1),--t)}}}function Tn(t,e){return t.streamSets.map(function(t){var i=e?e[t.type]:null;return t.streams.filter(function(t){return t.allowedByApplication&&t.allowedByKeySystem}).map(function(e){return{id:e.id,active:i==e,type:t.type,bandwidth:e.bandwidth,language:t.language,kind:e.kind||null,width:e.width||null,height:e.height||null}})}).reduce(U,[])}function Sn(t,e){for(var i=0;i<t.streamSets.length;i++)for(var n=t.streamSets[i],r=0;r<n.streams.length;r++){var s=n.streams[r];if(s.id==e.id)return{stream:s,Lc:n}}return null}function En(t){return t.streams.some(function(t){return t.allowedByApplication&&t.allowedByKeySystem})}function In(t,e,i){var n={};return t.streamSets.forEach(function(t){!En(t)||t.type in n||(n[t.type]=t)}),t.streamSets.forEach(function(t){En(t)&&t.primary&&(n[t.type]=t)}),[rs,ns,0].forEach(function(r){t.streamSets.forEach(function(t){if(En(t)){var s;if("audio"==t.type?s=e.preferredAudioLanguage:"text"==t.type&&(s=e.preferredTextLanguage),s){s=ve(s);var a=ve(t.language);ge(r,s,a)&&(n[t.type]=t,i&&(i[t.type]=!0))}}})}),n}function kn(t,e){A.call(this),this.w=!1,this.f=t,this.m=null,this.v=new k,this.ab=new c,this.la=this.c=this.l=this.b=this.i=this.ma=this.G=this.B=this.g=this.h=null,this.Ab=1e9,this.ka=[],this.Ma=!1,this.oa=!0,this.j=null,this.u={},this.a=Cn(this),this.za={width:1/0,height:1/0},this.F=[],this.ja=this.L=this.na=0,e&&e(this),this.h=new ue(this.Dc.bind(this)),this.ma=Pn(this);for(var i=0;i<this.f.textTracks.length;++i){var n=this.f.textTracks[i];n.mode="disabled","Shaka Player TextTrack"==n.label&&(this.m=n)}this.m||(this.m=this.f.addTextTrack("subtitles","Shaka Player TextTrack")),this.m.mode="hidden",P(this.v,this.f,"error",this.dc.bind(this))}function Pn(e){e.B=new MediaSource;var i=new v;return P(e.v,e.B,"sourceopen",i.resolve),e.f.src=t.URL.createObjectURL(e.B),i}function _n(t){t.l&&t.l.configure(t.a.manifest),t.g&&t.g.configure(t.a.drm),t.b&&(t.b.configure(t.a.streaming),t.c.periods.forEach(t.Ja.bind(t)),Dn(t,Ai(t.b))),t.a.abr.enabled&&!t.oa?t.a.abr.manager.enable():t.a.abr.manager.disable(),t.a.abr.manager.setDefaultEstimate(t.a.abr.defaultBandwidthEstimate)}function Nn(t){t.v&&t.v.ha(t.B,"sourceopen"),t.f&&(t.f.removeAttribute("src"),t.f.load());var e=Promise.all([t.a?t.a.abr.manager.stop():null,t.g?t.g.o():null,t.G?t.G.o():null,t.i?t.i.o():null,t.b?t.b.o():null,t.l?t.l.stop():null]);return t.g=null,t.G=null,t.i=null,t.b=null,t.l=null,t.c=null,t.la=null,t.ma=null,t.B=null,t.u={},t.F=[],t.na=0,t.L=0,e}function An(){return{".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",serverCertificate:null}}}function Cn(t){return{drm:{retryParameters:he(),servers:{},clearKeys:{},advanced:{}},manifest:{retryParameters:he(),dash:{customScheme:new Function("node",""),clockSyncUri:""}},streaming:{retryParameters:he(),rebufferingGoal:2,bufferingGoal:30,bufferBehind:30},abr:{manager:t.ab,enabled:!0,defaultBandwidthEstimate:5e5},preferredAudioLanguage:"",preferredTextLanguage:"",restrictions:{minWidth:0,maxWidth:Number.POSITIVE_INFINITY,minHeight:0,maxHeight:Number.POSITIVE_INFINITY,minPixels:0,maxPixels:Number.POSITIVE_INFINITY,minAudioBandwidth:0,maxAudioBandwidth:Number.POSITIVE_INFINITY,minVideoBandwidth:0,maxVideoBandwidth:Number.POSITIVE_INFINITY}}}function Rn(t,e,i){for(var n in e){var r=e[n],s=i||"text"==n;t.oa?t.u[n]={stream:r,clear:s}:Mi(t.b,n,r,s?0:void 0)}}function Mn(t){if(t.c){var e=Date.now()/1e3;t.Ma?t.L+=e-t.ja:t.na+=e-t.ja,t.ja=e}}function On(t,e,i){if(!q(e).some(En))return t.$(new y(4,4012)),{};var n={};if(i)n=e;else{i=Ci(t.b);for(var r in i){var s=i[r];s.allowedByApplication&&s.allowedByKeySystem&&e[r].language==s.language||(n[r]=e[r])}}if(V(n))return{};h(Object.keys(n));var a=t.a.abr.manager.chooseStreams(n);return G(n,function(t){return!!a[t]})?a:(t.$(new y(4,4012)),{})}function Dn(t,e){var i,n={audio:!1,text:!1},r=In(e,t.a,n),s=On(t,r);for(i in s)t.F.push({timestamp:Date.now()/1e3,id:s[i].id,type:i,fromAdaptation:!0});Rn(t,s,!0),xn(t),r.text&&r.audio&&n.text&&r.text.language!=r.audio.language&&(t.m.mode="showing",Ln(t))}function xn(t){Promise.resolve().then(function(){this.w||this.dispatchEvent(new g("adaptation"))}.bind(t))}function jn(t){Promise.resolve().then(function(){this.w||this.dispatchEvent(new g("trackschanged"))}.bind(t))}function Ln(t){t.dispatchEvent(new g("texttrackvisibility"))}function Un(t){this.a=new en,this.c=t,this.j=Kn(this),this.g=null,this.v=!1,this.i=null,this.l=[],this.f=-1,this.m=0,this.b=null,this.h=new hn(t.h,t.getConfiguration().streaming.retryParameters,this.j)}function Bn(){return!!t.indexedDB}function Fn(t,e,i,n){function r(){}var s,a,o,u=t.c.h,h=t.c.getConfiguration();return fe(e,u,h.manifest.retryParameters,n).then(function(t){return Yn(this),o=new t,o.configure(h.manifest),o.start(e,u,this.u.bind(this),i)}.bind(t)).then(function(t){return Yn(this),s=t,a=new Be(u,i,r),a.configure(h.drm),a.init(s,!0)}.bind(t)).then(function(){return Yn(this),Hn(s)}.bind(t)).then(function(){return Yn(this),Ve(a)}.bind(t)).then(function(){return Yn(this),o.stop()}.bind(t)).then(function(){return Yn(this),{manifest:s,Gb:a}}.bind(t))["catch"](function(t){if(o)return o.stop().then(function(){throw t});throw t})}function Kn(t){return{trackSelectionCallback:t.B.bind(t),progressCallback:new Function("storedContent","percent","")}}function Vn(t){return t.a.a?Promise.resolve():t.a.init(as)}function qn(t){var e=t.g?t.g.o():Promise.resolve();return t.g=null,t.b=null,t.v=!1,t.i=null,t.l=[],t.f=-1,e}function Hn(t){return t=t.periods.map(function(t){return t.streamSets;
}).reduce(U,[]).map(function(t){return t.streams}).reduce(U,[]),Promise.all(t.map(function(t){return t.createSegmentIndex()}))}function Gn(t,e,i,n){for(var r=[],s=t.b.presentationTimeline.pa(),a=s,o=n.findSegmentPosition(s),u=null!=o?n.getSegmentReference(o):null;u;){var h=t.a.b.segment++;cn(t.h,i.type,u,(u.endTime-u.startTime)*n.bandwidth/8,function(t,e,i,n){return e={key:t,data:n,manifestKey:this.f,streamNumber:i,segmentNumber:e},this.l.push(t),nn(this.a,"segment",e)}.bind(t,h,u.position,n.id)),r.push({startTime:u.startTime,endTime:u.endTime,uri:"offline:"+t.f+"/"+n.id+"/"+h}),a=u.endTime+e.startTime,u=n.getSegmentReference(++o)}return t.m=Math.max(t.m,a-s),e=null,n.initSegmentReference&&(h=t.a.b.segment++,e="offline:"+t.f+"/"+n.id+"/"+h,cn(t.h,i.type,n.initSegmentReference,0,function(t,e){var i={key:h,data:e,manifestKey:this.f,streamNumber:t,segmentNumber:-1};return this.l.push(h),nn(this.a,"segment",i)}.bind(t,n.id))),{id:n.id,primary:i.primary,presentationTimeOffset:n.presentationTimeOffset||0,contentType:i.type,mimeType:n.mimeType,codecs:n.codecs,kind:n.kind,language:i.language,width:n.width||null,height:n.height||null,initSegmentUri:e,encrypted:n.encrypted,keyId:n.keyId,segments:r}}function Yn(t){if(!t.c)throw new y(9,9002)}function zn(t){us.push(t)}function $n(t){var e=t.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),e=new Event(e,t);t.target.dispatchEvent(e)}function Wn(t){for(this.c=[],this.b=[],this.a=[],t=new At(new DataView(t.buffer));Ct(t);){var e=Ut(1886614376,t);if(-1==e)break;var i=t.a-8,n=Rt(t);if(1<n)jt(t,e-(t.a-i));else{jt(t,3);var r=W(xt(t,16)),s=[];if(0<n)for(var n=Ot(t),a=0;a<n;++a){var o=W(xt(t,16));s.push(o)}n=Ot(t),jt(t,n),this.b.push.apply(this.b,s),this.c.push(r),this.a.push({start:i,end:t.a-1}),t.a!=i+e&&jt(t,e-(t.a-i))}}}function Xn(t,e){try{var i=new Jn(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function Jn(t,e){this.keySystem=t;for(var i=!1,n=0;n<e.length;++n){var r=e[n],s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label},a=!1;if(r.audioCapabilities)for(var o=0;o<r.audioCapabilities.length;++o){var u=r.audioCapabilities[o];if(u.contentType){var a=!0,h=u.contentType.split(";")[0];MSMediaKeys.isTypeSupported(this.keySystem,h)&&(s.audioCapabilities.push(u),i=!0)}}if(r.videoCapabilities)for(o=0;o<r.videoCapabilities.length;++o)u=r.videoCapabilities[o],u.contentType&&(a=!0,h=u.contentType.split(";")[0],MSMediaKeys.isTypeSupported(this.keySystem,h)&&(s.videoCapabilities.push(u),i=!0));if(a||(i=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(s.persistentState="required",s.sessionTypes=["persistent-license"]),i)return void(this.a=s)}throw i=Error("Unsupported keySystem"),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function Qn(t){var e=this.mediaKeys;return e&&e!=t&&tr(e,null),delete this.mediaKeys,(this.mediaKeys=t)?tr(t,this):Promise.resolve()}function Zn(t){this.a=new MSMediaKeys(t),this.b=new k}function tr(t,e){function i(){e.msSetMediaKeys(n.a),e.removeEventListener("loadedmetadata",i)}if(_(t.b),!e)return Promise.resolve();P(t.b,e,"msneedkey",ir);var n=t;try{return 1<=e.readyState?e.msSetMediaKeys(t.a):e.addEventListener("loadedmetadata",i),Promise.resolve()}catch(r){return Promise.reject(r)}}function er(t){A.call(this),this.c=null,this.g=t,this.b=this.a=null,this.f=new k,this.sessionId="",this.expiration=NaN,this.closed=new v,this.keyStatuses=new sr}function ir(t){var e=document.createEvent("CustomEvent");if(e.initCustomEvent("encrypted",!1,!1,null),e.initDataType="cenc",t=t.initData){var i=new Wn(t);if(!(1>=i.a.length)){for(var n=[],r=0;r<i.a.length;r++)n.push(t.subarray(i.a[r].start,i.a[r].end+1));for(r=nr,t=[],i=0;i<n.length;++i){for(var s=!1,a=0;a<t.length&&!(s=r?r(n[i],t[a]):n[i]===t[a]);++a);s||t.push(n[i])}for(r=n=0;r<t.length;r++)n+=t[r].length;for(n=new Uint8Array(n),r=i=0;r<t.length;r++)n.set(t[r],i),i+=t[r].length;t=n}}e.initData=t,this.dispatchEvent(e)}function nr(t,e){return X(t,e)}function rr(t,e){t.keyStatuses.Xa(e),t.dispatchEvent(new g("keystatuseschange"))}function sr(){this.size=0,this.a=void 0}function ar(){return Promise.reject(Error("The key system specified is not supported."))}function or(t){return t?Promise.reject(Error("MediaKeys not supported.")):Promise.resolve()}function ur(){throw new TypeError("Illegal constructor.")}function hr(){throw new TypeError("Illegal constructor.")}function cr(t,e){try{var i=new fr(t,e);return Promise.resolve(i)}catch(n){return Promise.reject(n)}}function lr(t){var e=this.mediaKeys;return e&&e!=t&&pr(e,null),delete this.mediaKeys,(this.mediaKeys=t)&&pr(t,this),Promise.resolve()}function fr(t,e){this.a=this.keySystem=t;var i=!0;"org.w3.clearkey"==t&&(this.a="webkit-org.w3.clearkey",i=!1);var n,r=!1;n=document.getElementsByTagName("video"),n=n.length?n[0]:document.createElement("video");for(var s=0;s<e.length;++s){var a=e[s],o={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:a.initDataTypes,sessionTypes:["temporary"],label:a.label},u=!1;if(a.audioCapabilities)for(var h=0;h<a.audioCapabilities.length;++h){var c=a.audioCapabilities[h];c.contentType&&(u=!0,n.canPlayType(c.contentType.split(";")[0],this.a)&&(o.audioCapabilities.push(c),r=!0))}if(a.videoCapabilities)for(h=0;h<a.videoCapabilities.length;++h)c=a.videoCapabilities[h],c.contentType&&(u=!0,n.canPlayType(c.contentType,this.a)&&(o.videoCapabilities.push(c),r=!0));if(u||(r=n.canPlayType("video/mp4",this.a)||n.canPlayType("video/webm",this.a)),"required"==a.persistentState&&(i?(o.persistentState="required",o.sessionTypes=["persistent-license"]):r=!1),r)return void(this.b=o)}throw i="Unsupported keySystem","org.w3.clearkey"!=t&&"com.widevine.alpha"!=t||(i="None of the requested configurations were supported."),i=Error(i),i.name="NotSupportedError",i.code=DOMException.NOT_SUPPORTED_ERR,i}function dr(t){this.g=t,this.b=null,this.a=new k,this.c=[],this.f={}}function pr(t,e){t.b=e,_(t.a),e&&(P(t.a,e,"webkitneedkey",t.hc.bind(t)),P(t.a,e,"webkitkeymessage",t.gc.bind(t)),P(t.a,e,"webkitkeyadded",t.ec.bind(t)),P(t.a,e,"webkitkeyerror",t.fc.bind(t)))}function mr(t,e){var i=t.f[e];return i?i:(i=t.c.shift())?(i.sessionId=e,t.f[e]=i):null}function br(t,e,i){A.call(this),this.f=t,this.h=!1,this.a=this.b=null,this.c=e,this.g=i,this.sessionId="",this.expiration=NaN,this.closed=new v,this.keyStatuses=new vr}function yr(t,e,i){if(t.h)return Promise.reject(Error("The session is already initialized."));t.h=!0;var n;try{if("persistent-license"==t.g)if(i)n=new Uint8Array(Ee("LOAD_SESSION|"+i));else{var r=Ee("PERSISTENT|"),s=new Uint8Array(r.byteLength+e.byteLength);s.set(new Uint8Array(r),0),s.set(new Uint8Array(e),r.byteLength),n=s}else n=new Uint8Array(e)}catch(a){return Promise.reject(a)}t.b=new v;try{t.f.webkitGenerateKeyRequest(t.c,n)}catch(a){if("InvalidStateError"!=a.name)return t.b=null,Promise.reject(a);setTimeout(function(){try{this.f.webkitGenerateKeyRequest(this.c,n)}catch(t){this.b.reject(t),this.b=null}}.bind(t),10)}return t.b}function gr(t,e){t.keyStatuses.Xa(e),t.dispatchEvent(new g("keystatuseschange"))}function vr(){this.size=0,this.a=void 0}function wr(t){if(this.c=[],this.b=[],this.ga=ls,t)try{t(this.V.bind(this),this.a.bind(this))}catch(e){this.a(e)}}function Tr(t){var e=new wr;return e.V(t),e}function Sr(t){var e=new wr;return e.a(t),e}function Er(t){function e(t,e,i){t.ga==ls&&(r[e]=i,n++,n==r.length&&t.V(r))}var i=new wr;if(!t.length)return i.V([]),i;for(var n=0,r=Array(t.length),s=i.a.bind(i),a=0;a<t.length;++a)t[a]&&t[a].then?t[a].then(e.bind(null,i,a),s):e(i,a,t[a]);return i}function Ir(t){for(var e=new wr,i=e.V.bind(e),n=e.a.bind(e),r=0;r<t.length;++r)t[r]&&t[r].then?t[r].then(i,n):i(t[r]);return e}function kr(t,e,i){ds.push(function(){if(i&&"function"==typeof i){try{var t=i(this.La)}catch(n){return void e.a(n)}var r;try{r=t&&t.then}catch(n){return void e.a(n)}t instanceof wr?t==e?e.a(new TypeError("Chaining cycle detected")):t.then(e.V.bind(e),e.a.bind(e)):r?Pr(t,r,e):e.V(t)}else 1==this.ga?e.V(this.La):e.a(this.La)}.bind(t)),null==fs&&(fs=Nr(_r))}function Pr(t,e,i){try{var n=!1;e.call(t,function(t){if(!n){n=!0;var e;try{e=t&&t.then}catch(r){return void i.a(r)}e?Pr(t,e,i):i.V(t)}},i.a.bind(i))}catch(r){i.a(r)}}function _r(){for(;ds.length;){null!=fs&&(Ar(fs),fs=null);var t=ds;ds=[];for(var e=0;e<t.length;++e)t[e]()}}function Nr(){return 0}function Ar(){}function Cr(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}var Rr,Mr=this;Mr.Uc=!0,e("shaka.abr.SimpleAbrManager",c),Rr=c.prototype,Rr.stop=function(){this.h=null,this.f=!1,this.g={},this.a={},this.b=null},Rr.init=function(t){this.h=t},Rr.chooseStreams=function(t){for(var e in t)this.g[e]=t[e];if(e={},"audio"in t){var i=l(this);i?(e.audio=i,this.a.audio=i):delete this.a.audio}return"video"in t&&((i=f(this))?(e.video=i,this.a.video=i):delete this.a.video),"text"in t&&(e.text=t.text.streams[0]),this.b=Date.now(),e},Rr.enable=function(){this.f=!0},Rr.disable=function(){this.f=!1},Rr.segmentDownloaded=function(t,e,i){var n=this.c;if(t=e-t,65536>i||(t=Math.max(t,50),i=8e3*i/t,t/=1e3,r(n.a,t,i),r(n.c,t,i)),null!=this.b&&this.f)t:{if(n=Date.now()-this.b,this.i){if(8e3>n)break t}else{if(4e3>n)break t;this.i=!0}n=this.a.video,i={},(t=l(this))&&(i.audio=t,this.a.audio=t),(t=f(this))&&(i.video=t,this.a.video=t),this.b=Date.now(),t=void 0,n&&i.video&&i.video.bandwidth>n.bandwidth&&(t=10),this.h(i,t)}},Rr.getBandwidthEstimate=function(){return o(this.c)},Rr.setDefaultEstimate=function(t){this.c.b=t};var Or="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),Dr="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),xr=["loop","playbackRate"],jr=["pause","play"],Lr=["adaptation","buffering","error","texttrackvisibility","trackschanged"],Ur="getConfiguration getManifestUri getPlaybackRate getTracks getStats isBuffering isLive isTextTrackVisible seekRange".split(" "),Br=[["getConfiguration","configure"]],Fr=[["isTextTrackVisible","setTextTrackVisibility"]],Kr="configure resetConfiguration trickPlay cancelTrickPlay selectTrack setTextTrackVisibility addTextTrack".split(" "),Vr=["load","unload"];e("shaka.util.Error",y),y.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},y.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9},y.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,INVALID_TEXT_SETTINGS:2002,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_TTML:2006,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,INVALID_STREAMS_CHOSEN:5005,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,LOAD_INTERRUPTED:7e3,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,INDEXED_DB_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007},g.prototype.preventDefault=function(){},g.prototype.stopImmediatePropagation=function(){this.a=!0},g.prototype.stopPropagation=function(){},Rr=w.prototype,Rr.o=function(){return this.disconnect(),this.w=this.v=this.l=null,this.f=this.j=this.h=!1,this.g=this.c=this.b=this.a=this.i=null,Promise.resolve()},Rr.N=function(){return this.f},Rr.Ua=function(){return this.u},Rr.init=function(){if(t.chrome&&chrome.cast&&chrome.cast.isAvailable){delete t.__onGCastApiAvailable,this.h=!0,this.l();var e=new chrome.cast.SessionRequest(this.B),e=new chrome.cast.ApiConfig(e,this.Ub.bind(this),this.ac.bind(this),"origin_scoped");chrome.cast.initialize(e,function(){},function(){})}else t.__onGCastApiAvailable=function(t){t&&this.init()}.bind(this)},Rr.Wa=function(t){this.i=t,this.f&&E(this,{type:"appData",appData:this.i})},Rr.cast=function(t){return this.h?this.j?this.f?Promise.reject(new y(8,8002)):(this.g=new v,chrome.cast.requestSession(this.cc.bind(this,t),this.Sb.bind(this)),this.g):Promise.reject(new y(8,8001)):Promise.reject(new y(8,8e3))},Rr.disconnect=function(){this.f&&(S(this),this.a&&(this.a.stop(function(){},function(){}),this.a=null))},Rr.get=function(t,e){if("video"==t){if(0<=jr.indexOf(e))return this.rb.bind(this,t,e)}else if("player"==t){if(0<=Kr.indexOf(e))return this.rb.bind(this,t,e);if(0<=Vr.indexOf(e))return this.qc.bind(this,t,e);if(0<=Ur.indexOf(e))return this.pb.bind(this,t,e)}return this.pb(t,e)},Rr.set=function(t,e,i){this.b[t][e]=i,E(this,{type:"set",targetName:t,property:e,value:i})},Rr.cc=function(t,e){T(this,e),E(this,{type:"init",initState:t,appData:this.i}),this.g.resolve()},Rr.Sb=function(t){var e=8003;switch(t.code){case"cancel":e=8004;break;case"timeout":e=8005;break;case"receiver_unavailable":e=8006}this.g.reject(new y(8,e,t))},Rr.pb=function(t,e){return this.b[t][e]},Rr.rb=function(t,e){E(this,{type:"call",targetName:t,methodName:e,args:Array.prototype.slice.call(arguments,2)})},Rr.qc=function(t,e){var i=Array.prototype.slice.call(arguments,2),n=new v,r=this.m.toString();return this.m++,this.c[r]=n,E(this,{type:"asyncCall",targetName:t,methodName:e,args:i,id:r}),n},Rr.Ub=function(t){T(this,t)},Rr.ac=function(t){this.j="available"==t,this.l()},Rr.ib=function(){var t=!!this.a&&"connected"==this.a.status;if(this.f&&!t){this.w();for(var e in this.b)this.b[e]={};S(this)}this.u=(this.f=t)?this.a.receiver.friendlyName:"",this.l()},Rr.Vb=function(t,e){var i=m(e);switch(i.type){case"event":var n=i.targetName,r=i.event;this.v(n,new g(r.type,r));break;case"update":r=i.update;for(n in r){var s,i=this.b[n]||{};for(s in r[n])i[s]=r[n][s]}break;case"asyncComplete":if(n=i.id,s=i.error,i=this.c[n],delete this.c[n],i)if(s){n=new y(s.category,s.code);for(r in s)n[r]=s[r];i.reject(n)}else i.resolve()}},Rr=I.prototype,Rr.push=function(t,e){this.a.hasOwnProperty(t)?this.a[t].push(e):this.a[t]=[e]},Rr.set=function(t,e){this.a[t]=e},Rr.has=function(t){return this.a.hasOwnProperty(t)},Rr.get=function(t){return(t=this.a[t])?t.slice():null},Rr.remove=function(t,e){var i=this.a[t];if(i)for(var n=0;n<i.length;++n)i[n]==e&&(i.splice(n,1),--n)},Rr.keys=function(){var t,e=[];for(t in this.a)e.push(t);return e},Rr.clear=function(){this.a={}},k.prototype.o=function(){return _(this),this.a=null,Promise.resolve()},k.prototype.ha=function(t,e){for(var i=this.a.get(e)||[],n=0;n<i.length;++n){var r=i[n];r.target==t&&(r.ha(),this.a.remove(e,r))}},N.prototype.ha=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)},A.prototype.addEventListener=function(t,e){this.ya.push(t,e)},A.prototype.removeEventListener=function(t,e){this.ya.remove(t,e)},A.prototype.dispatchEvent=function(t){for(var e=this.ya.get(t.type)||[],i=0;i<e.length;++i){t.target=this.W,t.currentTarget=this.W;var n=e[i];try{n.handleEvent?n.handleEvent(t):n.call(this,t)}catch(r){}if(t.a)break}return t.defaultPrevented},i(C),e("shaka.cast.CastProxy",C),C.prototype.o=function(){var t=[this.h?this.h.o():null,this.b?this.b.o():null,this.a?this.a.o():null];return this.a=this.h=this.i=this.j=this.b=this.c=null,Promise.all(t)},C.prototype.destroy=C.prototype.o,C.prototype.Lb=function(){return this.j},C.prototype.getVideo=C.prototype.Lb,C.prototype.Jb=function(){return this.i},C.prototype.getPlayer=C.prototype.Jb,C.prototype.Bb=function(){return!!this.a&&(this.a.h&&this.a.j)},C.prototype.canCast=C.prototype.Bb,C.prototype.N=function(){return!!this.a&&this.a.N()},C.prototype.isCasting=C.prototype.N,C.prototype.Ua=function(){return this.a?this.a.Ua():""},C.prototype.receiverName=C.prototype.Ua,C.prototype.cast=function(){var t={video:{},player:{},playerAfterLoad:{},manifest:this.b.la,startTime:null};return this.c.pause(),xr.forEach(function(e){t.video[e]=this.c[e]}.bind(this)),this.c.ended||(t.startTime=this.c.currentTime),Br.forEach(function(e){var i=e[1];e=this.b[e[0]](),t.player[i]=e}.bind(this)),Fr.forEach(function(e){var i=e[1];e=this.b[e[0]](),t.playerAfterLoad[i]=e}.bind(this)),this.a.cast(t).then(function(){return this.b.$a()}.bind(this))},C.prototype.cast=C.prototype.cast,C.prototype.Wa=function(t){this.a.Wa(t)},C.prototype.setAppData=C.prototype.Wa,C.prototype.disconnect=function(){this.a.disconnect()},C.prototype.disconnect=C.prototype.disconnect,Rr=C.prototype,Rr.Ec=function(){this.dispatchEvent(new g("caststatuschanged"))},Rr.Gc=function(){Br.forEach(function(t){var e=t[1];t=this.a.get("player",t[0])(),this.b[e](t)}.bind(this));var t=this.a.get("player","getManifestUri")(),e=this.a.get("video","ended"),i=Promise.resolve(),n=this.c.autoplay,r=null;e||(r=this.a.get("video","currentTime")),t&&(this.c.autoplay=!1,i=this.b.load(t,r),i["catch"](function(t){this.b.dispatchEvent(new g("error",{detail:t}))}.bind(this)));var s={};xr.forEach(function(t){s[t]=this.a.get("video",t)}.bind(this)),i.then(function(){xr.forEach(function(t){this.c[t]=s[t]}.bind(this)),Fr.forEach(function(t){var e=t[1];t=this.a.get("player",t[0])(),this.b[e](t)}.bind(this)),this.c.autoplay=n,t&&this.c.play()}.bind(this))},Rr.Rc=function(t){if("addEventListener"==t)return this.g.addEventListener.bind(this.g);if("removeEventListener"==t)return this.g.removeEventListener.bind(this.g);if(this.a.N()&&!Object.keys(this.a.b.video).length){var e=this.c[t];if("function"!=typeof e)return e}return this.a.N()?this.a.get("video",t):(e=this.c[t],"function"==typeof e&&(e=e.bind(this.c)),e)},Rr.Tc=function(t,e){this.a.N()?this.a.set("video",t,e):this.c[t]=e},Rr.Sc=function(t){this.a.N()||this.g.dispatchEvent(new g(t.type,t))},Rr.kc=function(t){return"addEventListener"==t?this.f.addEventListener.bind(this.f):"removeEventListener"==t?this.f.removeEventListener.bind(this.f):"getNetworkingEngine"==t?this.b.gb.bind(this.b):this.a.N()&&!Object.keys(this.a.b.video).length&&0<=Ur.indexOf(t)||!this.a.N()?(t=this.b[t],t.bind(this.b)):this.a.get("player",t)},Rr.lc=function(t){this.a.N()||this.f.dispatchEvent(t)},Rr.Fc=function(t,e){this.a.N()&&("video"==t?this.g.dispatchEvent(e):"player"==t&&this.f.dispatchEvent(e))},i(M),e("shaka.cast.CastReceiver",M),M.prototype.Nb=function(){return this.h},M.prototype.isConnected=M.prototype.Nb,M.prototype.Ob=function(){return this.g},M.prototype.isIdle=M.prototype.Ob,M.prototype.o=function(){var e=this.a?this.a.o():Promise.resolve();return null!=this.c&&t.clearTimeout(this.c),this.j=this.i=this.a=this.b=null,this.h=!1,this.g=!0,this.c=this.f=null,e.then(function(){cast.receiver.CastReceiverManager.getInstance().stop()})},M.prototype.destroy=M.prototype.o,Rr=M.prototype,Rr.nb=function(){this.h=!!cast.receiver.CastReceiverManager.getInstance().getSenders().length,D(this)},Rr.qb=function(t,e){this.Ta(),j(this,{type:"event",targetName:t,event:e})},Rr.Ta=function(){null!=this.c&&t.clearTimeout(this.c),this.c=t.setTimeout(this.Ta.bind(this),500);var e={video:{},player:{}};Dr.forEach(function(t){e.video[t]=this.b[t]}.bind(this)),Ur.forEach(function(t){e.player[t]=this.a[t]()}.bind(this));var i=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();i&&(e.video.volume=i.level,e.video.muted=i.muted),j(this,{type:"update",update:e})},Rr.Hb=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&j(this,{type:"update",update:{video:{volume:t.level,muted:t.muted}}}),j(this,{type:"event",targetName:"video",event:{type:"volumechange"}})},Rr.Wb=function(t){var e=m(t.data);switch(e.type){case"init":x(this,e.initState,e.appData),this.Ta();break;case"appData":this.j(e.appData);break;case"set":var i=e.targetName,n=e.property,r=e.value;if("video"==i){if(e=cast.receiver.CastReceiverManager.getInstance(),"volume"==n){e.setSystemVolumeLevel(r);break}if("muted"==n){e.setSystemVolumeMuted(r);break}}this.i[i][n]=r;break;case"call":i=e.targetName,n=e.methodName,r=e.args,i=this.i[i],i[n].apply(i,r);break;case"asyncCall":i=e.targetName,n=e.methodName,r=e.args,e=e.id,t=t.senderId,i=this.i[i],i[n].apply(i,r).then(this.vb.bind(this,t,e,null),this.vb.bind(this,t,e))}},Rr.vb=function(t,e,i){j(this,{type:"asyncComplete",id:e,error:i},t)};var qr={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Hr=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;Rr=ft.prototype,Rr.R="",Rr.ia="",Rr.S="",Rr.ua=null,Rr.O="",Rr.da="",Rr.toString=function(){var t=[],e=this.R;if(e&&t.push(yt(e,Gr,!0),":"),e=this.S){t.push("//");var i=this.ia;i&&t.push(yt(i,Gr,!0),"@"),t.push(encodeURIComponent(e).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e=this.ua,null!=e&&t.push(":",String(e))}return(e=this.O)&&(this.S&&"/"!=e.charAt(0)&&t.push("/"),t.push(yt(e,"/"==e.charAt(0)?zr:Yr,!0))),(e=this.a.toString())&&t.push("?",e),(e=this.da)&&t.push("#",yt(e,Wr)),t.join("")},Rr.resolve=function(t){var e=new ft(this);"data"===e.R&&(e=new ft);var i=!!t.R;i?dt(e,t.R):i=!!t.ia,i?e.ia=t.ia:i=!!t.S,i?e.S=t.S:i=null!=t.ua;var n=t.O;if(i)pt(e,t.ua);else if(i=!!t.O){if("/"!=n.charAt(0))if(this.S&&!this.O)n="/"+n;else{var r=e.O.lastIndexOf("/");-1!=r&&(n=e.O.substr(0,r+1)+n)}if(".."==n||"."==n)n="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){for(var r=!n.lastIndexOf("/",0),n=n.split("/"),s=[],a=0;a<n.length;){var o=n[a++];"."==o?r&&a==n.length&&s.push(""):".."==o?((1<s.length||1==s.length&&""!=s[0])&&s.pop(),r&&a==n.length&&s.push("")):(s.push(o),r=!0)}n=s.join("/")}}return i?e.O=n:i=""!==t.a.toString(),i?mt(e,wt(t.a)):i=!!t.da,i&&(e.da=t.da),e};var Gr=/[#\/\?@]/g,Yr=/[\#\?:]/g,zr=/[\#\?]/g,$r=/[\#\?@]/g,Wr=/#/g;vt.prototype.a=null,vt.prototype.c=null,vt.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var t,e=[];for(t in this.a)for(var i=encodeURIComponent(t),n=this.a[t],r=0;r<n.length;r++){var s=i;""!==n[r]&&(s+="="+encodeURIComponent(n[r])),e.push(s)}return this.b=e.join("&")},e("shaka.media.InitSegmentReference",Tt),e("shaka.media.SegmentReference",St);var Xr=1/15,Jr=1;e("shaka.media.SegmentIndex",Kt),Kt.prototype.o=function(){return this.a=null,Promise.resolve()},Kt.prototype.destroy=Kt.prototype.o,Kt.prototype.find=function(t){for(var e=this.a.length-1;0<=e;--e){var i=this.a[e];if(t>=i.startTime&&t<i.endTime)return i.position}return null},Kt.prototype.find=Kt.prototype.find,Kt.prototype.get=function(t){return this.a.length?(t-=this.a[0].position,0>t||t>=this.a.length?null:this.a[t]):null},Kt.prototype.get=Kt.prototype.get,Kt.prototype.Ra=function(t){for(var e=[],i=0,n=0;i<this.a.length&&n<t.length;){var r=this.a[i],s=t[n];r.startTime<s.startTime?(e.push(r),i++):(r.startTime>s.startTime||(.1<Math.abs(r.endTime-s.endTime)?e.push(s):e.push(r),i++),n++)}for(;i<this.a.length;)e.push(this.a[i++]);if(e.length)for(i=e[e.length-1].position+1;n<t.length;)s=t[n++],s=new St((i++),s.startTime,s.endTime,s.a,s.K,s.C),e.push(s);else e=t;this.a=e},Kt.prototype.merge=Kt.prototype.Ra,Kt.prototype.Na=function(t){for(var e=0;e<this.a.length&&!(this.a[e].endTime>t);++e);this.a.splice(0,e)},Kt.prototype.evict=Kt.prototype.Na;var Qr;e("shaka.net.NetworkingEngine.RequestType",{MANIFEST:0,SEGMENT:1,LICENSE:2});var Zr={};e("shaka.net.NetworkingEngine.registerScheme",function(t,e){Zr[t]=e}),e("shaka.net.NetworkingEngine.unregisterScheme",function(t){delete Zr[t]}),ue.prototype.nc=function(t){this.b.push(t)},ue.prototype.registerRequestFilter=ue.prototype.nc,ue.prototype.Oc=function(t){var e=this.b;t=e.indexOf(t),0<=t&&e.splice(t,1)},ue.prototype.unregisterRequestFilter=ue.prototype.Oc,ue.prototype.Eb=function(){this.b=[]},ue.prototype.clearAllRequestFilters=ue.prototype.Eb,ue.prototype.oc=function(t){this.c.push(t)},ue.prototype.registerResponseFilter=ue.prototype.oc,ue.prototype.Pc=function(t){var e=this.c;t=e.indexOf(t),0<=t&&e.splice(t,1)},ue.prototype.unregisterResponseFilter=ue.prototype.Pc,ue.prototype.Fb=function(){this.c=[]},ue.prototype.clearAllResponseFilters=ue.prototype.Fb,ue.prototype.o=function(){this.f=!0,this.b=[],this.c=[];for(var t=[],e=0;e<this.a.length;++e)t.push(this.a[e]["catch"](B));return Promise.all(t)},ue.prototype.request=function(t,e){if(this.f)return Promise.reject();for(var i=Date.now(),n=this.b,r=0;r<n.length;r++)try{n[r](t,e)}catch(s){return Promise.reject(s)}for(var r=e.retryParameters||{},n=r.maxAttempts||1,a=r.backoffFactor||2,o=null==r.baseDelay?1e3:r.baseDelay,u=this.g(t,e,0),r=1;r<n;r++)u=u["catch"](this.i.bind(this,t,e,o,r%e.uris.length)),o*=a;return this.a.push(u),u.then(function(e){this.a.splice(this.a.indexOf(u),1);var n=Date.now();return this.h&&1==t&&this.h(i,n,e.data.byteLength),e}.bind(this))["catch"](function(t){return this.a.splice(this.a.indexOf(u),1),Promise.reject(t)}.bind(this))},ue.prototype.request=ue.prototype.request,ue.prototype.g=function(t,e,i){if(this.f)return Promise.reject();var n=new ft(e.uris[i]),r=n.R;return r||(r=location.protocol,r=r.slice(0,-1),dt(n,r),e.uris[i]=n.toString()),(r=Zr[r])?r(e.uris[i],e).then(function(e){for(var i=this.c,n=0;n<i.length;n++)i[n](t,e);return e}.bind(this)):Promise.reject(new y(1,1e3,n))},ue.prototype.i=function(e,i,n,r){var s=new v,a=i.retryParameters||{};return t.setTimeout(s.resolve,n*(1+(2*Math.random()-1)*(null==a.fuzzFactor?.5:a.fuzzFactor))),s.then(this.g.bind(this,e,i,r))};var ts={},es={};e("shaka.media.ManifestParser.registerParserByExtension",function(t,e){es[t]=e}),e("shaka.media.ManifestParser.registerParserByMime",function(t,e){ts[t]=e}),e("shaka.media.PresentationTimeline",de),de.prototype.X=function(){return this.c},de.prototype.getDuration=de.prototype.X,de.prototype.xa=function(t){this.c=t},de.prototype.setDuration=de.prototype.xa,de.prototype.wb=function(t){this.g=t},de.prototype.setClockOffset=de.prototype.wb,de.prototype.Kb=function(){return this.a},de.prototype.getSegmentAvailabilityDuration=de.prototype.Kb,de.prototype.yb=function(t){this.a=t},de.prototype.setSegmentAvailabilityDuration=de.prototype.yb,de.prototype.Ca=function(t,e){e.length&&(this.b=e.reduce(function(t,e){return Math.max(t,e.endTime-e.startTime)},this.b),t||(this.f=Math.max(this.f,e[0].startTime)))},de.prototype.notifySegments=de.prototype.Ca,de.prototype.Sa=function(t){this.b=Math.max(this.b,t)},de.prototype.notifyMaxSegmentDuration=de.prototype.Sa,de.prototype.T=function(){return this.c==Number.POSITIVE_INFINITY||this.a<Number.POSITIVE_INFINITY},de.prototype.isLive=de.prototype.T,de.prototype.pa=function(){return Math.max(Math.min(this.f,this.Y()),this.qa())},de.prototype.getEarliestStart=de.prototype.pa,de.prototype.qa=function(){return this.a==Number.POSITIVE_INFINITY?0:Math.max(0,this.Y()-this.a-this.h)},de.prototype.getSegmentAvailabilityStart=de.prototype.qa,de.prototype.Y=function(){return null!=this.i&&this.T()?Math.min(Math.max(0,(Date.now()+this.g)/1e3-this.b-this.i),this.c):this.c},de.prototype.getSegmentAvailabilityEnd=de.prototype.Y,de.prototype.hb=function(){return Math.max(0,this.Y()-(this.T()?this.h:0))},de.prototype.getSeekRangeEnd=de.prototype.hb;var is={};e("shaka.media.TextEngine.registerParser",function(t,e){is[t]=e}),e("shaka.media.TextEngine.unregisterParser",function(t){delete is[t]}),pe.prototype.o=function(){return this.c&&ye(this,function(){return!0}),this.c=this.g=null,Promise.resolve()},pe.prototype.remove=function(t,e){return Promise.resolve().then(function(){ye(this,function(i){return!(i.startTime>=e||i.endTime<=t)}),null==this.b||e<=this.b||t>=this.a||(t<=this.b&&e>=this.a?this.b=this.a=null:t<=this.b&&e<this.a?this.b=e:t>this.b&&e>=this.a&&(this.a=t))}.bind(this))};var ns=1,rs=2,ss={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};Rr=ke.prototype,Rr.configure=function(t){this.c=t},Rr.start=function(t,e,i,n){return this.g=[t],this.a=e,this.j=i,this.l=n,Pe(this).then(function(){return this.a&&Ae(this,0),this.b}.bind(this))},Rr.stop=function(){return this.c=this.l=this.j=this.a=null,this.g=[],this.b=null,this.h=[],this.i={},null!=this.f&&(t.clearTimeout(this.f),this.f=null),Promise.resolve()},Rr.ic=function(t,e){t.P=Ce(e,t.I,null);var i=!1,n=J(e,"Role"),r=void 0;if("text"==t.P.contentType&&(r="subtitle"),n){var s=n.getAttribute("schemeIdUri");if(null==s||"urn:mpeg:dash:role:2011"==s)switch(n=n.getAttribute("value")){case"main":i=!0;break;case"caption":case"subtitle":r=n}}var a=[];if(Q(e,"SupplementalProperty").forEach(function(t){"http://dashif.org/descriptor/AdaptationSetSwitching"==t.getAttribute("schemeIdURI")&&(t=t.getAttribute("value"))&&a.push.apply(a,t.split(","));
}),n=Q(e,"ContentProtection"),n=ot(n,this.c.dash.customScheme),s=ve(e.getAttribute("lang")||"und"),r=Q(e,"Representation").map(this.jc.bind(this,t,n,r,s)).filter(function(t){return!!t}),!r.length)throw new y(4,4003);if(!t.P.contentType){var o=r[0].mimeType,u=r[0].codecs,h=o;u&&(h+='; codecs="'+u+'"'),t.P.contentType=is[h]?"text":o.split("/")[0]}return{id:t.P.id||"__fake__"+this.u++,contentType:t.P.contentType,language:s,Qb:i,streams:r,drmInfos:n.drmInfos,Mc:a}},Rr.jc=function(t,e,i,n,r){if(t.s=Ce(r,t.P,null),!Me(t.s))return null;t.bandwidth=tt(r,"bandwidth",st)||void 0;var s;if(s=this.rc.bind(this),t.s.Ea)s=Xt(t,s);else if(t.s.Z)s=Zt(t,this.i);else if(t.s.Fa)s=ne(t,s,this.i,!!this.b);else{var a=t.s.M,o=t.J.duration||0;s={createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(t){return 0<=t&&t<o?1:null},getSegmentReference:function(t){return 1!=t?null:new St(1,0,o,function(){return a},0,null)},initSegmentReference:null,presentationTimeOffset:0}}return r=Q(r,"ContentProtection"),r=ut(r,this.c.dash.customScheme,e),{id:this.u++,createSegmentIndex:s.createSegmentIndex,findSegmentPosition:s.findSegmentPosition,getSegmentReference:s.getSegmentReference,initSegmentReference:s.initSegmentReference,presentationTimeOffset:s.presentationTimeOffset,mimeType:t.s.mimeType,codecs:t.s.codecs,bandwidth:t.bandwidth,width:t.s.width,height:t.s.height,kind:i,encrypted:0<e.drmInfos.length,keyId:r,language:n,allowedByApplication:!0,allowedByKeySystem:!0}},Rr.Hc=function(){this.f=null;var t=Date.now();Pe(this).then(function(){this.a&&Ae(this,(Date.now()-t)/1e3)}.bind(this))["catch"](function(t){this.l(t),this.a&&Ae(this,0)}.bind(this))},Rr.rc=function(t,e,i){return t=ce(t,this.c.retryParameters),null!=e&&(t.headers.Range="bytes="+e+"-"+(null!=i?i:"")),this.a.request(1,t).then(function(t){return t.data})},es.mpd=ke,ts["application/dash+xml"]=ke,Rr=Be.prototype,Rr.o=function(){this.c=!0;var t=this.a.map(function(t){return t.wa.close()["catch"](B),t.wa.closed});return this.j.reject(),this.f&&t.push(this.f.o()),this.l&&t.push(this.l.setMediaKeys(null)["catch"](B)),this.v&&Le(this.v),this.f=this.l=this.h=this.m=this.b=this.v=null,this.a=[],this.u=[],this.g=this.i=this.G=null,Promise.all(t)},Rr.configure=function(t){this.i=t},Rr.init=function(t,e){var i={},n=[];return this.F=e,this.u=t.offlineSessionIds,He(this,t,e||0<t.offlineSessionIds.length,i,n),n.length?Ge(this,i,n):(this.B=!0,Promise.resolve())},Rr.keySystem=function(){return this.b?this.b.keySystem:""},Rr.Tb=function(t){for(var e=new Uint8Array(t.initData),i=0;i<this.a.length;++i)if(X(e,this.a[i].initData))return;Je(this,t.initDataType,e)},Rr.ob=function(t){var e=t.target,i=ce([this.b.licenseServerUri],this.i.retryParameters);i.body=t.message,i.method="POST","com.microsoft.playready"==this.b.keySystem&&Qe(i),this.G.request(2,i).then(function(t){return this.c?Promise.reject():e.update(t.data)}.bind(this),function(t){return this.c?Promise.resolve():void this.g(new y(6,6007,t))}.bind(this))["catch"](function(t){return this.c?Promise.resolve():void this.g(new y(6,6008,t.message))}.bind(this))},Rr.jb=function(t){t=t.target;var e;for(e=0;e<this.a.length&&this.a[e].wa!=t;++e);if(e!=this.a.length){var i=t.keyStatuses,n=!1;i.forEach||(i=[]),i.forEach(function(t,i){if("string"==typeof i){var r=i;i=t,t=r}if("com.microsoft.playready"==this.b.keySystem&&16==i.byteLength){var r=new DataView(i),s=r.getUint32(0,!0),a=r.getUint16(4,!0),o=r.getUint16(6,!0);r.setUint32(0,s,!1),r.setUint16(4,a,!1),r.setUint16(6,o,!1)}"com.microsoft.playready"==this.b.keySystem&&"status-pending"==t&&(t="usable"),"status-pending"!=t&&"internal-error"!=t&&(this.a[e].loaded=!0,this.a.every(function(t){return t.loaded})&&this.j.resolve()),"expired"==t&&(n=!0),r=W(new Uint8Array(i)),this.w[r]=t}.bind(this)),i=t.expiration-Date.now(),(0>i||n&&1e3>i)&&(this.a.splice(e,1),t.close()),Ue(this.v)}},Rr.mc=function(){G(this.w,function(t,e){return"expired"==e})&&this.g(new y(6,6014)),this.L(this.w)},Rr=ei.prototype,Rr.o=function(){this.h=!0;var t,e=[];for(t in this.a){var i=this.a[t],n=i[0];for(this.a[t]=i.slice(0,1),n&&e.push(n.p["catch"](B)),n=1;n<i.length;++n)i[n].p["catch"](B),i[n].p.reject()}return this.b&&e.push(this.b.o()),Promise.all(e).then(function(){this.g.o(),this.b=this.j=this.f=this.i=this.g=null,this.c={},this.a={}}.bind(this))},Rr.init=function(t){for(var e in t){var i=t[e];"text"==e?this.b=new pe(this.j,i):(i=this.f.addSourceBuffer(i),P(this.g,i,"error",this.Jc.bind(this,e)),P(this.g,i,"updateend",this.Da.bind(this,e)),this.c[e]=i,this.a[e]=[])}},Rr.remove=function(t,e,i){return"text"==t?this.b.remove(e,i):Promise.all([hi(this,t,this.sb.bind(this,t,e,i)),hi(this,t,this.bb.bind(this,t))])},Rr.clear=function(t){return"text"==t?this.b.remove(0,Number.POSITIVE_INFINITY):hi(this,t,this.sb.bind(this,t,0,this.f.duration))},Rr.endOfStream=function(t){return ci(this,function(){t?this.f.endOfStream(t):this.f.endOfStream()}.bind(this))},Rr.xa=function(t){return ci(this,function(){this.f.duration=t}.bind(this))},Rr.X=function(){return this.f.duration},Rr.Ic=function(t,e){this.c[t].appendBuffer(e)},Rr.sb=function(t,e,i){i<=e?this.Da(t):this.c[t].remove(e,i)},Rr.bb=function(t){var e=this.c[t].appendWindowEnd;this.c[t].abort(),this.c[t].appendWindowEnd=e,this.Da(t)},Rr.zc=function(t,e){this.c[t].timestampOffset=e,this.Da(t)},Rr.xc=function(t,e){this.c[t].appendWindowEnd=e+.04,this.Da(t)},Rr.Jc=function(t){this.a[t][0].p.reject(new y(3,3014,this.i.error?this.i.error.code:0))},Rr.Da=function(t){var e=this.a[t][0];e&&(e.p.resolve(),li(this,t))},fi.l=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,fi.u=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,fi.m=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,fi.v=/^(\d*\.?\d*)f$/,fi.B=/^(\d*\.?\d*)t$/,fi.w=/^(?:(\d*\.?\d*)h)?(?:(\d*\.?\d*)m)?(?:(\d*\.?\d*)s)?(?:(\d*\.?\d*)ms)?$/,fi.j=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,fi.b=function(t){var e=[];if(!t)return e;for(var i=t.childNodes,n=0;n<i.length;n++){var r="span"==i[n].nodeName&&"p"==t.nodeName;i[n].nodeType!=Node.ELEMENT_NODE||"br"==i[n].nodeName||r||(r=fi.b(i[n]),0<r.length?e=e.concat(r):e.push(i[n]))}return e.length||e.push(t),e},fi.c=function(e,i,n,r){var s=fi.a(e.getAttribute("begin"),i),a=fi.a(e.getAttribute("end"),i);i=fi.a(e.getAttribute("dur"),i);var o=e.textContent;if(null==a&&null!=i&&(a=s+i),null==s||null==a)throw new y(2,2001);return t.VTTCue?(s=new VTTCue(s,a,o),e=fi.h(e,"region",r),fi.la(s,e,n)):s=new TextTrackCue(s,a,o),s},fi.la=function(t,e,i){var n,r=fi.f(e,i,"tts:textAlign");r&&(t.f=r),(r=fi.f(e,i,"tts:extent"))&&(n=fi.j.exec(r))&&(t.size=Number(n[1])),n=fi.f(e,i,"tts:writingMode"),r=!0,"tb"==n||"tblr"==n?t.b="lr":"tbrl"==n?t.b="rl":r=!1,(e=fi.f(e,i,"tts:origin"))&&(n=fi.j.exec(e))&&(r?(t.position=Number(n[2]),t.a=Number(n[1])):(t.position=Number(n[1]),t.a=Number(n[2])))},fi.f=function(t,e,i){for(var n=fi.b(t),r=0;r<n.length;r++){var s=n[r].getAttribute(i);if(s)return s}return(t=fi.h(t,"style",e))?t.getAttribute(i):null},fi.h=function(t,e,i){if(!t||1>i.length)return null;var n=null;if(t=fi.ma(t,e))for(e=0;e<i.length;e++)if(i[e].getAttribute("xml:id")==t){n=i[e];break}return n},fi.ma=function(t,e){for(var i=null;t&&!(i=t.getAttribute(e));)t=t.parentNode;return i},fi.a=function(t,e){var i=null;return fi.l.test(t)?i=fi.na(e,t):fi.u.test(t)?i=fi.g(fi.u,t):fi.m.test(t)?i=fi.g(fi.m,t):fi.v.test(t)?i=fi.ya(e,t):fi.B.test(t)?i=fi.za(e,t):fi.w.test(t)&&(i=fi.g(fi.w,t)),i},fi.ya=function(t,e){var i=fi.v.exec(e);return Number(i[1])/t.a},fi.za=function(t,e){var i=fi.B.exec(e);return Number(i[1])/t.b},fi.na=function(t,e){var i=fi.l.exec(e),n=Number(i[1]),r=Number(i[2]),s=Number(i[3]),a=Number(i[4]),a=a+(Number(i[5])||0)/t.c,s=s+a/t.a;return s+60*r+3600*n},fi.g=function(t,e){var i=t.exec(e);return i&&""!=i[0]?(Number(i[4])||0)/1e3+(Number(i[3])||0)+60*(Number(i[2])||0)+3600*(Number(i[1])||0):null},is["application/ttml+xml"]=fi,pi.L=1937010800,is['application/mp4; codecs="stpp"']=pi,gi.c=function(e){if(1==e.length&&!e[0]||/^NOTE($|[ \t])/.test(e[0]))return null;var i=null;0>e[0].indexOf("-->")&&(i=e[0],e.splice(0,1));var n=new mi(e[0]),r=gi.a(n),s=bi(n,/[ \t]+--\x3e[ \t]+/g),a=gi.a(n);if(null==r||!s||null==a)throw new y(2,2001);if(e=e.slice(1).join("\n"),t.VTTCue)for(r=new VTTCue(r,a,e),bi(n,/[ \t]+/gm),a=yi(n);a;){if(!gi.i(r,a))throw new y(2,2002);bi(n,/[ \t]+/gm),a=yi(n)}else r=new TextTrackCue(r,a,e);return null!=i&&(r.id=i),r},gi.i=function(t,e){var i;if(i=/^align:(start|middle|end|left|right)$/.exec(e))t.align=i[1];else if(i=/^vertical:(lr|rl)$/.exec(e))t.b=i[1];else if(i=/^size:(\d{1,2}|100)%$/.exec(e))t.size=Number(i[1]);else if(i=/^position:(\d{1,2}|100)%$/.exec(e))t.position=Number(i[1]);else if(i=/^line:(\d{1,2}|100)%$/.exec(e))t.c=!1,t.a=Number(i[1]);else{if(!(i=/^line:(-?\d+)$/.exec(e)))return!1;t.c=!0,t.a=Number(i[1])}return!0},gi.a=function(t){if(t=bi(t,/(?:(\d{2,}):)?(\d{2}):(\d{2})\.(\d{3})/g),!t)return null;var e=Number(t[2]),i=Number(t[3]);return 59<e||59<i?null:Number(t[4])/1e3+i+60*e+3600*(Number(t[1])||0)},is["text/vtt"]=gi,vi.oa=function(t,e,i){t=new At(new DataView(t));for(var n=[];Ct(t);){var r=Ut(vi.ja,t);if(-1==r)break;r=vi.c(xt(t,r-8).buffer,e,i),n.push(r)}return n},vi.c=function(e,i,n){e=new At(new DataView(e));for(var r,s,a;Ct(e);){var o=Ot(e),u=Ot(e),h=Se(xt(e,o-8).buffer);switch(1==o&&Dt(e),u){case vi.G:r=h;break;case vi.F:a=h;break;case vi.W:s=h}}if(!r)throw new y(2,2008);if(t.VTTCue){if(i=new VTTCue(i,n,r),a&&(i.id=a),s)for(s=new mi(s),a=yi(s);a;){if(!gi.i(i,a))throw new y(2,2002);bi(s,/[ \t]+/gm),a=yi(s)}}else i=new TextTrackCue(Number(i),Number(n),r);return i},vi.ka=2004251764,vi.ja=1987343459,vi.G=1885436268,vi.F=1768187247,vi.W=1937011815,is['application/mp4; codecs="wvtt"']=vi,Rr=wi.prototype,Rr.o=function(){var e=this.b.o();return this.b=null,null!=this.f&&(t.clearInterval(this.f),this.f=null),this.l=this.j=this.c=this.a=null,e},Rr.Oa=function(){return this.g},Rr.$b=function(){this.a.playbackRate!=(this.h||0>this.g?0:this.g)&&Ii(this,this.a.playbackRate)},Rr.kb=function(){this.b.ha(this.a,"loadedmetadata");var t=Si(this);.001>Math.abs(this.a.currentTime-t)?(P(this.b,this.a,"seeking",this.mb.bind(this)),P(this.b,this.a,"playing",this.lb.bind(this))):(P(this.b,this.a,"seeking",this.bc.bind(this)),this.a.currentTime=t)},Rr.bc=function(){this.b.ha(this.a,"seeking"),P(this.b,this.a,"seeking",this.mb.bind(this)),P(this.b,this.a,"playing",this.lb.bind(this))},Rr.mb=function(){var t=this.a.currentTime,e=ki(this,t);.001<Math.abs(e-t)?Pi(this,t,e):this.l()},Rr.lb=function(){var t=this.a.currentTime,e=ki(this,t);.001<Math.abs(e-t)&&Pi(this,t,e)},Ni.prototype.o=function(){for(var t in this.b)Zi(this.b[t]);return this.m=this.b=this.l=this.g=this.B=this.w=this.j=this.v=this.G=this.F=this.a=this.L=this.c=this.h=null,this.f=!0,Promise.resolve()},Ni.prototype.configure=function(t){this.m=t,this.h.i=this.i*Math.max(this.a.minBufferTime||0,this.m.rebufferingGoal)},Ni.prototype.init=function(){var t=this.G(this.a.periods[$i(this,Ti(this.h))]);return V(t)?Promise.reject(new y(5,5005)):Di(this,t).then(function(){this.w&&this.w()}.bind(this))},Ni.prototype.W=function(t){if(!this.f&&!t.ea&&null!=t.aa&&!t.ca)if(t.aa=null,t.ba)Ji(this,t,t.Ga);else{try{var e=Ui(this,t);null!=e&&Qi(this,t,e)}catch(i){return void this.j(i)}e=q(this.b),Ei(this.h,e.some(function(t){return t.ta})),Yi(this,t),e.every(function(t){return t.endOfStream})&&this.c.endOfStream()}},Zr.data=function(e){return new Promise(function(i){var n=e.split(":");if(2>n.length||"data"!=n[0])throw new y(1,1004,e);if(n=n.slice(1).join(":").split(","),2>n.length)throw new y(1,1004,e);var r=n[0],n=t.decodeURIComponent(n.slice(1).join(",")),r=r.split(";"),s=null;if(1<r.length&&(s=r[1]),"base64"==s)n=z(n).buffer;else{if(s)throw new y(1,1005,e);n=Ee(n)}i({uri:e,data:n,headers:{}})})},Zr.http=tn,Zr.https=tn,Rr=en.prototype,Rr.init=function(e){if(!t.indexedDB)return Promise.reject(new y(9,9e3));var i=t.indexedDB.open("shaka_offline_db",1),n=new v;return i.onupgradeneeded=function(t){t=t.target.result;for(var i in e)t.createObjectStore(i,{keyPath:e[i]})},i.onsuccess=function(t){this.a=t.target.result,n.resolve()}.bind(this),i.onerror=on.bind(null,i,n),n.then(function(){var t=Object.keys(e);return Promise.all(t.map(function(t){return sn(this,t).then(function(e){this.b[t]=e}.bind(this))}.bind(this)))}.bind(this))},Rr.o=function(){return Promise.all(this.c.map(function(t){try{t.transaction.abort()}catch(e){}return t.H["catch"](B)})).then(function(){this.a&&(this.a.close(),this.a=null)}.bind(this))},Rr.get=function(t,e){return an(this,t,"readonly",function(t){return t.get(e)})},Rr.forEach=function(t,e){return an(this,t,"readonly",function(t){return t.openCursor()},function(t){t&&(e(t.value),t["continue"]())})},Rr.remove=function(t,e){return an(this,t,"readwrite",function(t){return t["delete"](e)})};var as={manifest:"key",segment:"key"};hn.prototype.o=function(){var t=this.j||Promise.resolve();return this.b={},this.j=this.a=this.l=this.m=this.i=null,t},dn.prototype.configure=function(){},dn.prototype.start=function(t){var e=/^offline:([0-9]+)$/.exec(t);if(!e)return Promise.reject(new y(1,9004,t));var i=Number(e[1]),n=new en;return n.init(as).then(function(){return n.get("manifest",i)}).then(function(t){if(!t)throw new y(9,9003,i);return pn(t)}).then(function(t){return n.o().then(function(){return t})},function(t){return n.o().then(function(){throw t})})},dn.prototype.stop=function(){return Promise.resolve()},ts["application/x-offline-manifest"]=dn,Zr.offline=function(t){if(/^offline:([0-9]+)$/.exec(t)){var e={uri:t,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}};return Promise.resolve(e)}if(e=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(t)){var i=Number(e[1]),n=new en;return n.init(as).then(function(){return n.get("segment",i)}).then(function(e){return n.o().then(function(){if(!e)throw new y(9,9003,i);return{uri:t,data:e.data,headers:{}}})})}return Promise.reject(new y(1,9004,t))},mn.prototype.then=function(t){return this.a=this.a.then(t).then(function(t){return this.c?(this.h(),Promise.reject(this.i)):Promise.resolve(t)}.bind(this)),this},i(kn),e("shaka.Player",kn),kn.prototype.o=function(){this.w=!0;var t=Promise.resolve();return this.j&&(t=yn(this.j,new y(7,7e3))),t.then(function(){var t=Promise.all([Nn(this),this.v?this.v.o():null,this.h?this.h.o():null]);return this.a=this.h=this.ab=this.v=this.m=this.f=null,t}.bind(this))},kn.prototype.destroy=kn.prototype.o,kn.version="v2.0.0-beta3";var os={};kn.registerSupportPlugin=function(t,e){os[t]=e},kn.isBrowserSupported=function(){return!!(t.Promise&&t.Uint8Array&&Array.prototype.forEach&&t.MediaSource&&t.MediaKeys&&t.navigator&&t.navigator.requestMediaKeySystemAccess&&t.MediaKeySystemAccess&&t.MediaKeySystemAccess.prototype.getConfiguration)},kn.probeSupport=function(){return Ze().then(function(t){var e=le(),i=ii();t={manifest:e,media:i,drm:t};for(var n in os)t[n]=os[n]();return t})},kn.prototype.load=function(t,e,i){var n=this.$a(),r=new mn;return this.j=r,this.dispatchEvent(new g("loading")),bn(r.then(function(){return n}).then(function(){return fe(t,this.h,this.a.manifest.retryParameters,i)}.bind(this)).then(function(e){return this.l=new e,this.l.configure(this.a.manifest),this.l.start(t,this.h,this.Ja.bind(this),this.$.bind(this))}.bind(this)).then(function(e){return this.c=e,this.la=t,this.g=new Be(this.h,this.$.bind(this),this.Bc.bind(this)),this.g.configure(this.a.drm),this.g.init(e,!1)}.bind(this)).then(function(){return this.c.periods.forEach(this.Ja.bind(this)),this.ja=Date.now()/1e3,Promise.all([Fe(this.g,this.f),this.ma])}.bind(this)).then(function(){return this.i=new wi(this.f,this.c.presentationTimeline,1*Math.max(this.c.minBufferTime||0,this.a.streaming.rebufferingGoal),e||null,this.zb.bind(this),this.Cc.bind(this)),this.G=new ei(this.f,this.B,this.m),this.b=new Ni(this.i,this.G,this.h,this.c,this.Ac.bind(this),this.Cb.bind(this),this.$.bind(this)),this.b.configure(this.a.streaming),this.b.init()}.bind(this)).then(function(){this.c.periods.forEach(this.Ja.bind(this)),jn(this),xn(this),this.a.abr.manager.init(this.Ya.bind(this)),this.j=null}.bind(this)))["catch"](function(t){return this.j==r&&(this.j=null,this.dispatchEvent(new g("unloading"))),Promise.reject(t)}.bind(this))},kn.prototype.load=kn.prototype.load,kn.prototype.configure=function(t){t.abr&&t.abr.manager&&t.abr.manager!=this.a.abr.manager&&(this.a.abr.manager.stop(),t.abr.manager.init(this.Ya.bind(this))),gn(this.a,t,Cn(this),An(),""),_n(this)},kn.prototype.configure=kn.prototype.configure,kn.prototype.getConfiguration=function(){var t=Cn(this);return gn(t,this.a,Cn(this),An(),""),t},kn.prototype.getConfiguration=kn.prototype.getConfiguration,kn.prototype.sc=function(){var t=Cn(this);t.abr&&t.abr.manager&&t.abr.manager!=this.a.abr.manager&&(this.a.abr.manager.stop(),t.abr.manager.init(this.Ya.bind(this))),this.a=Cn(this),_n(this)},kn.prototype.resetConfiguration=kn.prototype.sc,kn.prototype.gb=function(){return this.h},kn.prototype.getNetworkingEngine=kn.prototype.gb,kn.prototype.Ib=function(){return this.la},kn.prototype.getManifestUri=kn.prototype.Ib,kn.prototype.T=function(){return!!this.c&&this.c.presentationTimeline.T()},kn.prototype.isLive=kn.prototype.T,kn.prototype.vc=function(){var t=0,e=0;return this.c&&(e=this.c.presentationTimeline,t=e.qa(),e=e.hb()),{start:t,end:e}},kn.prototype.seekRange=kn.prototype.vc,kn.prototype.keySystem=function(){return this.g?this.g.keySystem():""},kn.prototype.keySystem=kn.prototype.keySystem,kn.prototype.drmInfo=function(){return this.g?this.g.b:null},kn.prototype.drmInfo=kn.prototype.drmInfo,kn.prototype.Mb=function(){return this.Ma},kn.prototype.isBuffering=kn.prototype.Mb,kn.prototype.$a=function(){if(this.w)return Promise.resolve();if(this.dispatchEvent(new g("unloading")),this.j){var t=new y(7,7e3);return yn(this.j,t).then(this.tb.bind(this))}return this.tb()},kn.prototype.unload=kn.prototype.$a,kn.prototype.Oa=function(){return this.i?this.i.Oa():0},kn.prototype.getPlaybackRate=kn.prototype.Oa,kn.prototype.Nc=function(t){this.i&&Ii(this.i,t)},kn.prototype.trickPlay=kn.prototype.Nc,kn.prototype.Db=function(){this.i&&Ii(this.i,1)},kn.prototype.cancelTrickPlay=kn.prototype.Db,kn.prototype.getTracks=function(){if(!this.b)return[];var t=Ci(this.b);return Tn(Ai(this.b),t).filter(function(t){return 0>this.ka.indexOf(t.id)}.bind(this))},kn.prototype.getTracks=kn.prototype.getTracks,kn.prototype.wc=function(t,e){if(this.b){var i=Sn(Ai(this.b),t);if(i&&(i=i.stream,i.allowedByApplication&&i.allowedByKeySystem)){this.F.push({timestamp:Date.now()/1e3,id:i.id,type:t.type,fromAdaptation:!1}),"text"!=t.type&&this.configure({abr:{enabled:!1}});var n={};n[t.type]=i,Rn(this,n,e)}}},kn.prototype.selectTrack=kn.prototype.wc,kn.prototype.Pb=function(){return"showing"==this.m.mode},kn.prototype.isTextTrackVisible=kn.prototype.Pb,kn.prototype.yc=function(t){this.m.mode=t?"showing":"hidden",Ln(this)},kn.prototype.setTextTrackVisibility=kn.prototype.yc,kn.prototype.getStats=function(){Mn(this);var t={},e={},i=this.f&&this.f.getVideoPlaybackQuality?this.f.getVideoPlaybackQuality():{};return this.b&&(e=Ci(this.b),t=e.video||{},e=e.audio||{}),{width:t.width||0,height:t.height||0,streamBandwidth:t.bandwidth+e.bandwidth||0,decodedFrames:Number(i.totalVideoFrames),droppedFrames:Number(i.droppedVideoFrames),estimatedBandwidth:this.a.abr.manager.getBandwidthEstimate(),playTime:this.na,bufferingTime:this.L,switchHistory:this.F.slice(0)}},kn.prototype.getStats=kn.prototype.getStats,kn.prototype.addTextTrack=function(t,e,i,n,r){if(!this.b)return Promise.reject();for(var s,a=Ai(this.b),o=0;o<this.c.periods.length;o++)if(this.c.periods[o]==a){if(o==this.c.periods.length-1){if(s=this.c.presentationTimeline.X()-a.startTime,s==Number.POSITIVE_INFINITY)return Promise.reject()}else s=this.c.periods[o+1].startTime-a.startTime;break}var u={id:this.Ab++,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return 1},getSegmentReference:function(e){return 1!=e?null:new St(1,0,s,function(){return[t]},0,null)},initSegmentReference:null,presentationTimeOffset:0,mimeType:n,codecs:r||"",bandwidth:0,kind:i,encrypted:!1,keyId:null,language:e,allowedByApplication:!0,allowedByKeySystem:!0};return n={language:e,type:"text",primary:!1,drmInfos:[],streams:[u]},this.ka.push(u.id),a.streamSets.push(n),Ri(this.b,u).then(function(){if(!this.w)return this.ka.splice(this.ka.indexOf(u.id),1),Dn(this,a),jn(this),{id:u.id,active:!1,type:"text",bandwidth:0,language:e,kind:i,width:null,height:null}}.bind(this))},kn.prototype.addTextTrack=kn.prototype.addTextTrack,kn.prototype.xb=function(t,e){this.za.width=t,this.za.height=e},kn.prototype.setMaxHardwareResolution=kn.prototype.xb,Rr=kn.prototype,Rr.tb=function(){return this.l?Nn(this).then(function(){this.w||(this.zb(!1),this.ma=Pn(this))}.bind(this)):Promise.resolve()},Rr.Ja=function(t){var e=this.b?Ci(this.b):{};wn(this.g,e,t),e=t.streamSets.some(En),vn(t,this.a.restrictions,this.za)&&!this.j&&jn(this),t=!t.streamSets.some(En),e?t&&this.$(new y(4,4012)):this.$(new y(4,4011))},Rr.Dc=function(t,e,i){this.a.abr.manager.segmentDownloaded(t,e,i)},Rr.zb=function(t){Mn(this),this.Ma=t,this.dispatchEvent(new g("buffering",{buffering:t}))},Rr.Cc=function(){if(this.b){var t,e=this.b;for(t in e.b){var i=e.b[t];i.ca||0<ri(e.c,t,Ti(e.h))||i.ba||(i.ea?Oi(i,0):null==ni(e.c,t)?null==i.aa&&Qi(e,i,0):(Zi(i),Ji(e,i,0)))}}},Rr.Ac=function(t){this.oa=!0,this.a.abr.manager.disable(),t=In(t,this.a),t=On(this,t,!0);for(var e in this.u)t[e]=this.u[e].stream;this.u={};for(e in t)this.F.push({timestamp:Date.now()/1e3,id:t[e].id,type:e,fromAdaptation:!0});return this.j||jn(this),t},Rr.Cb=function(){this.oa=!1,this.a.abr.enabled&&this.a.abr.manager.enable();for(var t in this.u){var e=this.u[t];Mi(this.b,t,e.stream,e.clear?0:void 0)}this.u={}},Rr.Ya=function(t,e){var i,n=Ci(this.b);for(i in t){var r=t[i];n[i]!=r?this.F.push({timestamp:Date.now()/1e3,id:r.id,type:i,fromAdaptation:!0}):delete t[i]}if(!V(t)&&this.b){for(i in t)Mi(this.b,i,t[i],"video"==i?e:void 0);xn(this)}},Rr.$=function(t){this.dispatchEvent(new g("error",{detail:t}))},Rr.dc=function(){if(this.f.error){var t=this.f.error.code;if(1!=t){var e=this.f.error.msExtendedCode;e&&(0>e&&(e+=Math.pow(2,32)),e=e.toString(16)),this.$(new y(3,3016,t,e))}}},Rr.Bc=function(t){var e=["usable","status-pending","output-downscaled","expired"],i=Ai(this.b),n=!1;i.streamSets.forEach(function(i){i.streams.forEach(function(i){var r=i.allowedByKeySystem;i.keyId&&i.keyId in t&&(i.allowedByKeySystem=0<=e.indexOf(t[i.keyId])),r!=i.allowedByKeySystem&&(n=!0)})}),Dn(this,i),n&&jn(this)},e("shaka.offline.Storage",Un),Un.support=Bn,Un.prototype.o=function(){var t=this.l,e=this.a,i=this.h?this.h.o()["catch"](function(){}).then(function(){return Promise.all(t.map(function(t){return e.remove("segment",t)}))}).then(function(){return e.o()}):Promise.resolve();return this.j=this.c=this.h=this.a=null,i},Un.prototype.destroy=Un.prototype.o,Un.prototype.configure=function(t){gn(this.j,t,Kn(this),{},"")},Un.prototype.configure=Un.prototype.configure,Un.prototype.Kc=function(t,e,i){function n(t){s=t}if(this.v)return Promise.reject(new y(9,9006));this.v=!0;var r,s=null;return Vn(this).then(function(){return Yn(this),Fn(this,t,n,i)}.bind(this)).then(function(i){if(Yn(this),this.b=i.manifest,this.g=i.Gb,this.b.presentationTimeline.T())throw new y(9,9005,t);this.b.periods.forEach(this.u.bind(this)),this.f=this.a.b.manifest++,this.m=0,i=this.b.periods.map(this.w.bind(this));var n=this.g.b,s=qe(this.g);if(n){if(!s.length)throw new y(9,9007,t);n.initData=[]}return r={key:this.f,originalManifestUri:t,duration:this.m,size:0,periods:i,sessionIds:s,drmInfo:n,appMetadata:e},ln(this.h,r)}.bind(this)).then(function(){if(Yn(this),s)throw s;return nn(this.a,"manifest",r)}.bind(this)).then(function(){return qn(this)}.bind(this)).then(function(){return un(r)}.bind(this))["catch"](function(t){return qn(this)["catch"](B).then(function(){throw t})}.bind(this))},Un.prototype.store=Un.prototype.Kc,Un.prototype.remove=function(t){function e(t){6013!=t.code&&(a=t)}var i=t.offlineUri,n=/^offline:([0-9]+)$/.exec(i);if(!n)return Promise.reject(new y(9,9004,i));var r,s,a=null,o=Number(n[1]);return Vn(this).then(function(){return Yn(this),this.a.get("manifest",o)}.bind(this)).then(function(t){if(Yn(this),!t)throw new y(9,9003,i);return r=t,t=pn(r),s=new Be(this.c.h,e,function(){}),s.configure(this.c.getConfiguration().drm),s.init(t,!0)}.bind(this)).then(function(){return Ke(s,r.sessionIds)}.bind(this)).then(function(){return s.o()}.bind(this)).then(function(){if(Yn(this),a)throw a;var e=r.periods.map(function(t){return t.streams.map(function(t){var e=t.segments.map(function(t){return Number(/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(t.uri)[1])});return t.initSegmentUri&&e.push(Number(/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(t.initSegmentUri)[1])),e}).reduce(U,[])}).reduce(U,[]),i=0,n=e.length,s=this.j.progressCallback;return rn(this.a,function(r){return r=e.indexOf(r.key),0<=r&&(s(t,i/n),i++),0<=r}.bind(this))}.bind(this)).then(function(){return Yn(this),this.j.progressCallback(t,1),this.a.remove("manifest",o)}.bind(this))},Un.prototype.remove=Un.prototype.remove,Un.prototype.list=function(){var t=[];return Vn(this).then(function(){return Yn(this),this.a.forEach("manifest",function(e){t.push(un(e))})}.bind(this)).then(function(){return t})},Un.prototype.list=Un.prototype.list,Un.prototype.B=function(t){var e=[],i=t.filter(function(t){return"video"==t.type&&480>=t.height});i.sort(function(t,e){return e.bandwidth-t.bandwidth}),i.length&&e.push(i[0]);for(var n=ve(this.c.getConfiguration().preferredAudioLanguage),i=[0,ns,rs],r=t.filter(function(t){return"audio"==t.type}),i=i.map(function(t){return r.filter(function(e){return e=ve(e.language),ge(t,n,e)})}),s=r,a=0;a<i.length;a++)i[a].length&&(s=i[a]);s.sort(function(t,e){return t.bandwidth-e.bandwidth}),s.length&&e.push(s[Math.floor(s.length/2)]);var i=ve(this.c.getConfiguration().preferredTextLanguage),o=ge.bind(null,rs,i);return e.push.apply(e,t.filter(function(t){var e=ve(t.language);return"text"==t.type&&o(e)})),e},Un.prototype.u=function(t){function e(t,e,i){return e=e.filter(function(t){return t.type==i}),0==e.length?null:Sn(t,e[0]).stream}var i={};this.i&&(i={video:e(this.b.periods[0],this.i,"video"),audio:e(this.b.periods[0],this.i,"audio")}),wn(this.g,i,t),vn(t,this.c.getConfiguration().restrictions,{width:1/0,height:1/0})},Un.prototype.w=function(t){var e=Tn(t,null),e=this.j.trackSelectionCallback(e);this.i||(this.i=e,this.b.periods.forEach(this.u.bind(this)));for(var i=e.length-1;0<i;--i){for(var n=!1,r=i-1;0<=r;--r)if(e[i].type==e[r].type&&e[i].kind==e[r].kind&&e[i].language==e[r].language){n=!0;break}if(n)break}return e=e.map(function(e){return e=Sn(t,e),Gn(this,t,e.Lc,e.stream)}.bind(this)),{startTime:t.startTime,streams:e}},os.offline=Bn,e("shaka.polyfill.installAll",function(){for(var t=0;t<us.length;++t)us[t]()});var us=[];e("shaka.polyfill.register",zn),zn(function(){if(t.Document){var e=Element.prototype;e.requestFullscreen=e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen,e=Document.prototype,e.exitFullscreen=e.exitFullscreen||e.mozCancelFullScreen||e.msExitFullscreen||e.webkitExitFullscreen,"fullscreenElement"in document||Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement}}),document.addEventListener("webkitfullscreenchange",$n),document.addEventListener("webkitfullscreenerror",$n),document.addEventListener("mozfullscreenchange",$n),document.addEventListener("mozfullscreenerror",$n),document.addEventListener("MSFullscreenChange",$n),document.addEventListener("MSFullscreenError",$n)}}),Jn.prototype.createMediaKeys=function(){var t=new Zn(this.keySystem);return Promise.resolve(t)},Jn.prototype.getConfiguration=function(){return this.a},Zn.prototype.createSession=function(t){if("temporary"!=(t||"temporary"))throw new TypeError("Session type "+t+" is unsupported on this platform.");return new er(this.a)},Zn.prototype.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},i(er),Rr=er.prototype,Rr.generateRequest=function(t,e){this.a=new v;try{this.c=this.g.createSession("video/mp4",new Uint8Array(e),null),P(this.f,this.c,"mskeymessage",this.Zb.bind(this)),P(this.f,this.c,"mskeyadded",this.Xb.bind(this)),P(this.f,this.c,"mskeyerror",this.Yb.bind(this)),rr(this,"status-pending")}catch(i){this.a.reject(i)}return this.a},Rr.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},Rr.update=function(t){this.b=new v;try{this.c.update(new Uint8Array(t))}catch(e){this.b.reject(e)}return this.b},Rr.close=function(){try{this.c.close(),this.closed.resolve(),_(this.f)}catch(t){this.closed.reject(t)}return this.closed},Rr.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},Rr.Zb=function(t){this.a&&(this.a.resolve(),this.a=null),this.dispatchEvent(new g("message",{messageType:void 0==this.keyStatuses.Pa()?"licenserequest":"licenserenewal",message:t.message.buffer}))},Rr.Xb=function(){this.a?(rr(this,"usable"),this.a.resolve(),this.a=null):this.b&&(rr(this,"usable"),this.b.resolve(),this.b=null)},Rr.Yb=function(){var t=Error("EME PatchedMediaKeysMs key error");if(t.errorCode=this.c.error,this.a)this.a.reject(t),this.a=null;else if(this.b)this.b.reject(t),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:rr(this,"output-not-allowed");default:rr(this,"internal-error")}};var hs;Rr=sr.prototype,Rr.Xa=function(t){this.size=void 0==t?0:1,this.a=t},Rr.Pa=function(){return this.a},Rr.forEach=function(t){this.a&&t(this.a,hs)},Rr.get=function(t){if(this.has(t))return this.a},Rr.has=function(t){var e=hs;return!(!this.a||!X(new Uint8Array(t),new Uint8Array(e)))},ur.prototype.createSession=function(){},ur.prototype.setServerCertificate=function(){},hr.prototype.getConfiguration=function(){},hr.prototype.createMediaKeys=function(){},fr.prototype.createMediaKeys=function(){var t=new dr(this.a);return Promise.resolve(t)},fr.prototype.getConfiguration=function(){return this.b},Rr=dr.prototype,Rr.createSession=function(t){var e=t||"temporary";if("temporary"!=e&&"persistent-license"!=e)throw new TypeError("Session type "+t+" is unsupported on this platform.");return t=this.b||document.createElement("video"),t.src||(t.src="about:blank"),e=new br(t,this.g,e),this.c.push(e),e},Rr.setServerCertificate=function(){return Promise.reject(Error("setServerCertificate not supported on this platform."))},Rr.hc=function(t){this.b.dispatchEvent(new g("encrypted",{initDataType:"webm",initData:t.initData}))},Rr.gc=function(t){var e=mr(this,t.sessionId);e&&(t=new g("message",{messageType:void 0==e.keyStatuses.Pa()?"licenserequest":"licenserenewal",message:t.message}),e.b&&(e.b.resolve(),e.b=null),e.dispatchEvent(t))},Rr.ec=function(t){(t=mr(this,t.sessionId))&&(gr(t,"usable"),t.a&&t.a.resolve(),t.a=null)},Rr.fc=function(t){var e=mr(this,t.sessionId);if(e){var i=Error("EME v0.1b key error");i.errorCode=t.errorCode,i.errorCode.systemCode=t.systemCode,!t.sessionId&&e.b?(i.method="generateRequest",45==t.systemCode&&(i.message="Unsupported session type."),e.b.reject(i),e.b=null):t.sessionId&&e.a?(i.method="update",e.a.reject(i),e.a=null):(i=t.systemCode,t.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?gr(e,"output-restricted"):1==i?gr(e,"expired"):gr(e,"internal-error"))}},i(br),Rr=br.prototype,Rr.Za=function(t,e){if(this.a)this.a.then(this.Za.bind(this,t,e))["catch"](this.Za.bind(this,t,e));else{this.a=t;var i,n;"webkit-org.w3.clearkey"==this.c?(i=we(e),n=JSON.parse(i),"oct"!=n.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null),i=z(n.keys[0].k),n=z(n.keys[0].kid)):(i=new Uint8Array(e),
n=null);try{this.f.webkitAddKey(this.c,i,n,this.sessionId)}catch(r){this.a.reject(r),this.a=null}}},Rr.generateRequest=function(t,e){return yr(this,e,null)},Rr.load=function(t){return"persistent-license"==this.g?yr(this,null,t):Promise.reject(Error("Not a persistent session."))},Rr.update=function(t){var e=new v;return this.Za(e,t),e},Rr.close=function(){if("persistent-license"!=this.g){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;this.f.webkitCancelKeyRequest(this.c,this.sessionId)}return this.closed.resolve(),this.closed},Rr.remove=function(){return"persistent-license"!=this.g?Promise.reject(Error("Not a persistent session.")):this.close()};var cs;Rr=vr.prototype,Rr.Xa=function(t){this.size=void 0==t?0:1,this.a=t},Rr.Pa=function(){return this.a},Rr.forEach=function(t){this.a&&t(this.a,cs)},Rr.get=function(t){if(this.has(t))return this.a},Rr.has=function(t){var e=cs;return!(!this.a||!X(new Uint8Array(t),new Uint8Array(e)))},zn(function(){!t.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(HTMLMediaElement.prototype.webkitGenerateKeyRequest?(cs=new Uint8Array([0]).buffer,navigator.requestMediaKeySystemAccess=cr,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=lr,t.MediaKeys=dr,t.MediaKeySystemAccess=fr):t.MSMediaKeys?(hs=new Uint8Array([0]).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Qn,t.MediaKeys=Zn,t.MediaKeySystemAccess=Jn,navigator.requestMediaKeySystemAccess=Xn):(navigator.requestMediaKeySystemAccess=ar,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=or,t.MediaKeys=ur,t.MediaKeySystemAccess=hr))}),zn(function(){if(t.MediaSource){var e=navigator.vendor,i=navigator.appVersion;if(e&&i&&!(0>e.indexOf("Apple")))if(0<=i.indexOf("Version/8"))t.MediaSource=null;else{var n=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(){var t=n.apply(this,arguments);return t.abort=function(){},t}}}});var ls=0;wr.prototype.then=function(t,e){var i=new wr;switch(this.ga){case 1:kr(this,i,t);break;case 2:kr(this,i,e);break;case ls:this.c.push({H:i,Aa:t}),this.b.push({H:i,Aa:e})}return i},wr.prototype.then=wr.prototype.then,wr.prototype["catch"]=function(t){return this.then(void 0,t)},wr.prototype["catch"]=wr.prototype["catch"],wr.prototype.V=function(t){if(this.ga==ls){for(this.La=t,this.ga=1,t=0;t<this.c.length;++t)kr(this,this.c[t].H,this.c[t].Aa);this.c=[],this.b=[]}},wr.prototype.a=function(t){if(this.ga==ls){for(this.La=t,this.ga=2,t=0;t<this.b.length;++t)kr(this,this.b[t].H,this.b[t].Aa);this.c=[],this.b=[]}};var fs=null,ds=[];zn(function(){t.Promise||(t.Promise=wr,t.Promise.resolve=Tr,t.Promise.reject=Sr,t.Promise.all=Er,t.Promise.race=Ir,t.setImmediate?(Nr=function(e){return t.setImmediate(e)},Ar=function(e){return t.clearImmediate(e)}):(Nr=function(e){return t.setTimeout(e,0)},Ar=function(e){return t.clearTimeout(e)}))}),zn(function(){if(t.HTMLVideoElement){var e=HTMLVideoElement.prototype;!e.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in e&&(e.getVideoPlaybackQuality=Cr)}})}).call(r,this),"undefined"!=typeof t&&t.exports?t.exports=r.shaka:(n=function(){return r.shaka}.call(e,i,e,t),!(void 0!==n&&(t.exports=n)))}()},function(e,i){e.exports=t}])});