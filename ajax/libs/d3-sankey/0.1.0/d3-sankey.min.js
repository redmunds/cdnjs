!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-arrays")):"function"==typeof define&&define.amd?define("d3-sankey",["exports","d3-arrays"],t):t(n.d3_sankey={},n.d3_arrays)}(this,function(n,t){"use strict";function r(){function n(){d.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),l.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=d[n.source]),"number"==typeof r&&(r=n.target=d[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function r(){d.forEach(function(n){n.value=Math.max(t.sum(n.sourceLinks,a),t.sum(n.targetLinks,a))})}function e(){for(var n,t=d,r=0;t.length;)n=[],t.forEach(function(t){t.x=r,t.dx=y,t.sourceLinks.forEach(function(t){n.indexOf(t.target)<0&&n.push(t.target)})}),t=n,++r;u(r),o((h[0]-y)/(r-1))}function u(n){d.forEach(function(t){t.sourceLinks.length||(t.x=n-1)})}function o(n){d.forEach(function(t){t.x*=n})}function c(n){function r(){var n=t.min(i,function(n){return(h[1]-(n.length-1)*g)/t.sum(n,a)});i.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),l.forEach(function(t){t.dy=t.value*n})}function e(n){function r(n){return f(n.source)*n.value}i.forEach(function(e,u){e.forEach(function(e){if(e.targetLinks.length){var u=t.sum(e.targetLinks,r)/t.sum(e.targetLinks,a);e.y+=(u-f(e))*n}})})}function u(n){function r(n){return f(n.target)*n.value}i.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var u=t.sum(e.sourceLinks,r)/t.sum(e.sourceLinks,a);e.y+=(u-f(e))*n}})})}function o(){i.forEach(function(n){var t,r,e,u=0,o=n.length;for(n.sort(c),e=0;o>e;++e)t=n[e],r=u-t.y,r>0&&(t.y+=r),u=t.y+t.dy+g;if(r=u-g-h[1],r>0)for(u=t.y-=r,e=o-2;e>=0;--e)t=n[e],r=t.y+t.dy+g-u,r>0&&(t.y-=r),u=t.y})}function c(n,t){return n.y-t.y}var i=t.nest().key(function(n){return n.x}).sortKeys(t.ascending).entries(d).map(function(n){return n.values});r(),o();for(var s=1;n>0;--n)u(s*=.99),o(),e(s),o()}function i(){function n(n,t){return n.source.y-t.source.y}function t(n,t){return n.target.y-t.target.y}d.forEach(function(r){r.sourceLinks.sort(t),r.targetLinks.sort(n)}),d.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function f(n){return n.y+n.dy/2}function a(n){return n.value}var s={},y=24,g=8,h=[1,1],d=[],l=[];return s.nodeWidth=function(n){return arguments.length?(y=+n,s):y},s.nodePadding=function(n){return arguments.length?(g=+n,s):g},s.nodes=function(n){return arguments.length?(d=n,s):d},s.links=function(n){return arguments.length?(l=n,s):l},s.size=function(n){return arguments.length?(h=n,s):h},s.layout=function(t){return n(),r(),e(),c(t),i(),s},s.relayout=function(){return i(),s},s.link=function(){function n(n){var r=n.source.x+n.source.dx,e=n.target.x,u=d3.interpolateNumber(r,e),o=u(t),c=u(1-t),i=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;return"M"+r+","+i+"C"+o+","+i+" "+c+","+f+" "+e+","+f}var t=.5;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},s}var e="0.1.0";n.version=e,n.sankey=r});