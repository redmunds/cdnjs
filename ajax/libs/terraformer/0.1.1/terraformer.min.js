!function(t,e){"object"==typeof module&&"object"==typeof module.exports?exports=module.exports=e():"function"==typeof define&&define.amd?define(e):t.Terraformer=e(),"object"==typeof jasmine&&(void 0===typeof Terraformer&&(t.Terraformer={}),t.Terraformer=e())}(this,function(){function t(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function e(t){switch(t.type){case"Point":return[t.coordinates[0],t.coordinates[1],t.coordinates[0],t.coordinates[1]];case"MultiPoint":return o(t.coordinates);case"LineString":return o(t.coordinates);case"MultiLineString":return r(t.coordinates);case"Polygon":return o(t.coordinates[0]);case"MultiPolygon":return r(t.coordinates);case"Feature":return e(t.geometry);case"FeatureCollection":return i(t);case"GeometryCollection":return n(t);default:throw new Error("Unknown type: "+t.type)}}function r(t){for(var e,i=[],n=t.length-1;n>=0;n--)"number"==typeof t[n][0]?(e=o(t),i.push([e[0],e[1]]),i.push([e[2],e[3]])):"object"==typeof t[n][0]&&(e=r(t[n]),i.push([e[0],e[1]]),i.push([e[2],e[3]]));return o(i)}function o(t){for(var e,r,o,i,n=t.length-1;n>=0;n--){var s=t[n],a=s[0],c=s[1];void 0===e?e=a:a<e&&(e=a),void 0===o?o=c:c<o&&(o=c),void 0===r?r=a:a>r&&(r=a),void 0===i?i=c:c>i&&(i=c)}return[e,o,r,i]}function i(t){for(var r,i=[],n=t.features.length-1;n>=0;n--)r=e(t.features[n].geometry),i.push([r[0],r[1]]),i.push([r[2],r[3]]);return o(i)}function n(t){for(var r,i=[],n=t.geometries.length-1;n>=0;n--)r=e(t.geometries[n]),i.push([r[0],r[1]]),i.push([r[2],r[3]]);return o(i)}function s(t){return t*F}function a(t){return t*L}function c(t,e){for(var r=0;r<t.geometries.length;r++)t.geometries[r].geometry=h(t.features[r].geometry,e);return t}function u(t,e){for(var r=0;r<t.features.length;r++)t.features[r].geometry=h(t.features[r].geometry,e);return t}function h(t,e){for(var r=0;r<t.length;r++)"number"==typeof t[r][0]&&(t[r]=e(t[r])),"object"==typeof t[r]&&(t[r]=h(t[r],e));return t}function f(t){var e=t[0],r=t[1];return[s(e/A)-360*Math.floor((s(e/A)+180)/360),s(Math.PI/2-2*Math.atan(Math.exp(-1*r/A)))]}function p(t){var e=t[0],r=Math.max(Math.min(t[1],89.99999),-89.99999);return[a(e)*A,A/2*Math.log((1+Math.sin(a(r)))/(1-Math.sin(a(r))))]}function l(t,e){return"Point"===t.type?t.coordinates=e(t.coordinates):"Feature"===t.type?t.geometry=l(t,e):"FeatureCollection"===t.type?t.features=u(t,e):"GeometryCollection"===t.type?t.geometries=c(t,e):t.coordinates=h(t.coordinates,e),e===p&&(t.crs=E),e===f&&delete t.crs,t}function y(t){return l(t,p)}function d(t){return l(t,f)}function g(t){if(t)switch(t.type){case"Point":return new _(t);case"MultiPoint":return new m(t);case"LineString":return new w(t);case"MultiLineString":return new v(t);case"Polygon":return new P(t);case"MultiPolygon":return new M(t);case"Feature":return new T(t);case"FeatureCollection":return new G(t);case"GeometryCollection":return new b(t);default:throw new Error("Unknown type: "+t.type)}}function _(r){var o=Array.prototype.slice.call(arguments);if(r&&"Point"===r.type&&r.coordinates)t(this,r);else if(r&&Array.isArray(r))this.type="Point",this.coordinates=r;else if(o.length>=2)this.type="Point",this.coordinates=o;else{if(o.length)throw"Terraformer: invalid input for Terraformer.Point";this.type="Point"}this.__defineGetter__("bbox",function(){return e(this)})}function m(r){if(r&&"MultiPoint"===r.type&&r.coordinates)t(this,r);else if(Array.isArray(r))this.type="MultiPoint",this.coordinates=r;else{if(r)throw"Terraformer: invalid input for Terraformer.MultiPoint";this.type="MultiPoint"}this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function w(r){if(r&&"LineString"===r.type&&r.coordinates)t(this,r);else if(Array.isArray(r))this.type="LineString",this.coordinates=r;else{if(r)throw"Terraformer: invalid input for Terraformer.LineString";this.type="LineString"}this.__defineGetter__("bbox",function(){return e(this)})}function v(r){if(r&&"MultiLineString"===r.type&&r.coordinates)t(this,r);else if(Array.isArray(r))this.type="MultiLineString",this.coordinates=r;else{if(r)throw"Terraformer: invalid input for Terraformer.MultiLineString";this.type="MultiLineString"}this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function P(r){if(r&&"Polygon"===r.type&&r.coordinates)t(this,r);else if(Array.isArray(r))this.type="Polygon",this.coordinates=r;else{if(r)throw"Terraformer: invalid input for Terraformer.Polygon";this.type="Polygon"}this.__defineGetter__("bbox",function(){return e(this)})}function M(r){if(r&&"MultiPolygon"===r.type&&r.coordinates)t(this,r);else if(Array.isArray(r))this.type="MultiPolygon",this.coordinates=r;else{if(r)throw"Terraformer: invalid input for Terraformer.MultiPolygon";this.type="MultiPolygon"}this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function T(r){if(r&&"Feature"===r.type&&r.geometry)t(this,r);else if(r&&r.type&&r.coordinates)this.type="Feature",this.geometry=r;else{if(r)throw"Terraformer: invalid input for Terraformer.Feature";this.type="Feature"}this.__defineGetter__("bbox",function(){return e(this)})}function G(r){if(r&&"FeatureCollection"===r.type&&r.features)t(this,r);else if(Array.isArray(r))this.type="FeatureCollection",this.features=r;else{if(r)throw"Terraformer: invalid input for Terraformer.FeatureCollection";this.type="FeatureCollection"}this.__defineGetter__("length",function(){return this.features?this.features.length:0}),this.__defineGetter__("bbox",function(){return e(this)})}function b(r){if(r&&"GeometryCollection"===r.type&&r.geometries)t(this,r);else if(Array.isArray(r))this.type="GeometryCollection",this.geometries=r;else if(r.coordinates&&r.type)this.type="GeometryCollection",this.geometries=[r];else{if(r)throw"Terraformer: invalid input for Terraformer.GeometryCollection";this.type="GeometryCollection"}this.__defineGetter__("length",function(){return this.geometries?this.geometries.length:0}),this.__defineGetter__("bbox",function(){return e(this)})}function x(t,e,r){for(var o=p(t),i=r||64,n=e||250,s={type:"Polygon",coordinates:[[]]},a=1;a<=i;a++){var c=a*(360/i)*Math.PI/180;s.coordinates[0].push([o[0]+n*Math.cos(c),o[1]+n*Math.sin(c)])}return d(s)}function C(r,o,i){var n=i||64,s=o||250;if(!r||r.length<2||!s||!n)throw new Error("Terraformer: missing parameter for Terraformer.Circle");t(this,new T({type:"Feature",geometry:x(r,s,n),properties:{radius:s,center:r,steps:n}})),this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("radius",function(){return this.properties.radius}),this.__defineSetter__("radius",function(t){this.properties.radius=t,this.recalculate()}),this.__defineGetter__("steps",function(){return this.properties.steps}),this.__defineSetter__("steps",function(t){this.properties.steps=t,this.recalculate()}),this.__defineGetter__("center",function(){return this.properties.center}),this.__defineSetter__("center",function(t){this.properties.center=t,this.recalculate()})}var S={},A=6378137,F=57.29577951308232,L=.017453292519943,E={type:"link",properties:{href:"http://spatialreference.org/ref/sr-org/6928/ogcwkt/",type:"ogcwkt"}},k={type:"link",properties:{href:"http://spatialreference.org/ref/epsg/4326/ogcwkt/",type:"ogcwkt"}},j=["length"];return g.prototype={toMercator:function(){return y(this)},toGeographic:function(){return d(this)},toJSON:function(){var t={};for(var e in this)this.hasOwnProperty(e)&&this[e]&&j.indexOf(e)&&(t[e]=this[e]);return t},toJson:function(){return JSON.stringify(this)}},_.prototype=new g,_.prototype.constructor=_,m.prototype=new g,m.prototype.constructor=m,m.prototype.forEach=function(t){for(var e=0;e<this.length;e++)t.apply(this,[this.coordinates[e],e,this.coordinates]);return this},m.prototype.addPoint=function(t){return this.coordinates.push(t),this},m.prototype.insertPoint=function(t,e){return this.coordinates.splice(e,0,t),this},m.prototype.removePoint=function(t){return"number"==typeof t?this.coordinates.splice(t,1):this.coordinates.splice(this.coordinates.indexOf(t),1),this},w.prototype=new g,w.prototype.constructor=w,w.prototype.addVertex=function(t){return this.coordinates.push(t),this},w.prototype.insertVertex=function(t,e){return this.coordinates.splice(e,0,t),this},w.prototype.removeVertex=function(t){return this.coordinates.splice(t,1),this},v.prototype=new g,v.prototype.constructor=v,v.prototype.forEach=function(t){for(var e=0;e<this.coordinates.length;e++)t.apply(this,[this.coordinates[e],e,this.coordinates])},P.prototype=new g,P.prototype.constructor=P,P.prototype.addVertex=function(t){return this.coordinates[0].push(t),this},P.prototype.insertVertex=function(t,e){return this.coordinates[0].splice(e,0,t),this},P.prototype.removeVertex=function(t){return this.coordinates[0].splice(t,1),this},M.prototype=new g,M.prototype.constructor=M,M.prototype.forEach=function(t){for(var e=0;e<this.coordinates.length;e++)t.apply(this,[this.coordinates[e],e,this.coordinates])},T.prototype=new g,T.prototype.constructor=T,G.prototype=new g,G.prototype.constructor=G,G.prototype.forEach=function(t){for(var e=0;e<this.features.length;e++)t.apply(this,[this.features[e],e,this.features])},G.prototype.get=function(t){var e;return this.forEach(function(r){console.log(r.id,t),r.id===t&&(e=r)}),e},b.prototype=new g,b.prototype.constructor=b,b.prototype.forEach=function(t){for(var e=0;e<this.geometries.length;e++)t.apply(this,[this.geometries[e],e,this.geometries])},C.prototype=new g,C.prototype.constructor=C,C.prototype.recalculate=function(){return this.geometry=x(this.center,this.radius,this.steps),this},S.Primitive=g,S.Point=_,S.MultiPoint=m,S.LineString=w,S.MultiLineString=v,S.Polygon=P,S.MultiPolygon=M,S.Feature=T,S.FeatureCollection=G,S.GeometryCollection=b,S.Circle=C,S.toMercator=y,S.toGeographic=d,S.Tools={},S.Tools.positionToMercator=p,S.Tools.positionToGeographic=f,S.Tools.applyConverter=l,S.Tools.toMercator=y,S.Tools.toGeographic=d,S.Tools.createCircle=x,S.Tools.calculateBounds=e,S.MercatorCRS=E,S.GeographicCRS=k,S});