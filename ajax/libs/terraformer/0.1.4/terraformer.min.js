!function(t,e){"object"==typeof module&&"object"==typeof module.exports?exports=module.exports=e():"function"==typeof define&&define.amd?define(e):t.Terraformer=e(),"object"==typeof jasmine&&(void 0===typeof Terraformer&&(t.Terraformer={}),t.Terraformer=e())}(this,function(){function t(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function e(t){switch(t.type){case"Point":return[t.coordinates[0],t.coordinates[1],t.coordinates[0],t.coordinates[1]];case"MultiPoint":return n(t.coordinates);case"LineString":return n(t.coordinates);case"MultiLineString":return r(t.coordinates);case"Polygon":return r(t.coordinates);case"MultiPolygon":return o(t.coordinates);case"Feature":return e(t.geometry);case"FeatureCollection":return i(t);case"GeometryCollection":return s(t);default:throw new Error("Unknown type: "+t.type)}}function r(t){for(var e=null,r=null,o=null,n=null,i=0;i<t.length;i++)for(var s=t[i],u=0;u<s.length;u++){var a=s[u],c=a[0],h=a[1];null===e?e=c:c<e&&(e=c),null===r?r=c:c>r&&(r=c),null===o?o=h:h<o&&(o=h),null===n?n=h:h>n&&(n=h)}return[e,o,r,n]}function o(t){for(var e=null,r=null,o=null,n=null,i=0;i<t.length;i++)for(var s=t[i],u=0;u<s.length;u++)for(var a=s[u],c=0;c<a.length;c++){var h=a[c],f=h[0],l=h[1];null===e?e=f:f<e&&(e=f),null===r?r=f:f>r&&(r=f),null===o?o=l:l<o&&(o=l),null===n?n=l:l>n&&(n=l)}return[e,o,r,n]}function n(t){for(var e=null,r=null,o=null,n=null,i=0;i<t.length;i++){var s=t[i],u=s[0],a=s[1];null===e?e=u:u<e&&(e=u),null===r?r=u:u>r&&(r=u),null===o?o=a:a<o&&(o=a),null===n?n=a:a>n&&(n=a)}return[e,o,r,n]}function i(t){for(var r,o=[],i=t.features.length-1;i>=0;i--)r=e(t.features[i].geometry),o.push([r[0],r[1]]),o.push([r[2],r[3]]);return n(o)}function s(t){for(var r,o=[],i=t.geometries.length-1;i>=0;i--)r=e(t.geometries[i]),o.push([r[0],r[1]]),o.push([r[2],r[3]]);return n(o)}function u(t){return t*J}function a(t){return t*U}function c(t,e){for(var r=0;r<t.geometries.length;r++)t.geometries[r].geometry=f(t.features[r].geometry,e);return t}function h(t,e){for(var r=0;r<t.features.length;r++)t.features[r].geometry=f(t.features[r].geometry,e);return t}function f(t,e){for(var r=0;r<t.length;r++)"number"==typeof t[r][0]&&(t[r]=e(t[r])),"object"==typeof t[r]&&(t[r]=f(t[r],e));return t}function l(t){var e=t[0],r=t[1];return[u(e/j)-360*Math.floor((u(e/j)+180)/360),u(Math.PI/2-2*Math.atan(Math.exp(-1*r/j)))]}function p(t){var e=t[0],r=Math.max(Math.min(t[1],89.99999),-89.99999);return[a(e)*j,j/2*Math.log((1+Math.sin(a(r)))/(1-Math.sin(a(r))))]}function y(t,e){return"Point"===t.type?t.coordinates=e(t.coordinates):"Feature"===t.type?t.geometry=y(t,e):"FeatureCollection"===t.type?t.features=h(t,e):"GeometryCollection"===t.type?t.geometries=c(t,e):t.coordinates=f(t.coordinates,e),e===p&&(t.crs=H),e===l&&delete t.crs,t}function d(t){return y(t,p)}function g(t){return y(t,l)}function _(t,e){return t<e?-1:t>e?1:0}function m(t,e,r){return _((e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]),0)}function v(t,e){var r=e[0]-t[0],o=e[1]-t[1];return r*r+o*o}function w(t,e){var r=e;for(var o in t){var n=m(e,r,t[o]);(n===-1||0===n&&v(e,t[o])>v(e,r))&&(r=t[o])}return r}function P(t){function e(t,e){return t[0]-e[0]>t[1]-e[1]?1:t[0]-e[0]<t[1]-e[1]?-1:0}if(0===t.length)return[];if(1===t.length)return t;for(var r=[t.sort(e)[0]],o=0;o<r.length;o++){var n=w(t,r[o]);n!==r[0]&&r.push(n)}return r}function M(t,e){for(var r=!1,o=-1,n=t.length,i=n-1;++o<n;i=o)(t[o][1]<=e[1]&&e[1]<t[i][1]||t[i][1]<=e[1]&&e[1]<t[o][1])&&e[0]<(t[i][0]-t[o][0])*(e[1]-t[o][1])/(t[i][1]-t[o][1])+t[o][0]&&(r=!0);return r}function T(t){if(t)switch(t.type){case"Point":return new G(t);case"MultiPoint":return new b(t);case"LineString":return new x(t);case"MultiLineString":return new C(t);case"Polygon":return new S(t);case"MultiPolygon":return new A(t);case"Feature":return new F(t);case"FeatureCollection":return new L(t);case"GeometryCollection":return new E(t);default:throw new Error("Unknown type: "+t.type)}}function G(r){var o=Array.prototype.slice.call(arguments);if(r&&"Point"===r.type&&r.coordinates)t(this,r);else if(r&&Array.isArray(r))this.coordinates=r;else{if(!(o.length>=2))throw"Terraformer: invalid input for Terraformer.Point";this.coordinates=o}this.type="Point",this.__defineGetter__("bbox",function(){return e(this)})}function b(r){if(r&&"MultiPoint"===r.type&&r.coordinates)t(this,r);else{if(!Array.isArray(r))throw"Terraformer: invalid input for Terraformer.MultiPoint";this.coordinates=r}this.type="MultiPoint",this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function x(r){if(r&&"LineString"===r.type&&r.coordinates)t(this,r);else{if(!Array.isArray(r))throw"Terraformer: invalid input for Terraformer.LineString";this.coordinates=r}this.type="LineString",this.__defineGetter__("bbox",function(){return e(this)})}function C(r){if(r&&"MultiLineString"===r.type&&r.coordinates)t(this,r);else{if(!Array.isArray(r))throw"Terraformer: invalid input for Terraformer.MultiLineString";this.coordinates=r}this.type="MultiLineString",this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function S(r){if(r&&"Polygon"===r.type&&r.coordinates)t(this,r);else{if(!Array.isArray(r))throw"Terraformer: invalid input for Terraformer.Polygon";this.coordinates=r}this.type="Polygon",this.__defineGetter__("bbox",function(){return e(this)})}function A(r){if(r&&"MultiPolygon"===r.type&&r.coordinates)t(this,r);else{if(!Array.isArray(r))throw"Terraformer: invalid input for Terraformer.MultiPolygon";this.coordinates=r}this.type="MultiPolygon",this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function F(r){if(r&&"Feature"===r.type&&r.geometry)t(this,r);else{if(!(r&&r.type&&r.coordinates))throw"Terraformer: invalid input for Terraformer.Feature";this.geometry=r}this.type="Feature",this.__defineGetter__("bbox",function(){return e(this)})}function L(r){if(r&&"FeatureCollection"===r.type&&r.features)t(this,r);else{if(!Array.isArray(r))throw"Terraformer: invalid input for Terraformer.FeatureCollection";this.features=r}this.type="FeatureCollection",this.__defineGetter__("length",function(){return this.features?this.features.length:0}),this.__defineGetter__("bbox",function(){return e(this)})}function E(r){if(r&&"GeometryCollection"===r.type&&r.geometries)t(this,r);else if(Array.isArray(r))this.geometries=r;else{if(!r.coordinates||!r.type)throw"Terraformer: invalid input for Terraformer.GeometryCollection";this.type="GeometryCollection",this.geometries=[r]}this.type="GeometryCollection",this.__defineGetter__("length",function(){return this.geometries?this.geometries.length:0}),this.__defineGetter__("bbox",function(){return e(this)})}function k(t,e,r){for(var o=p(t),n=r||64,i=e||250,s={type:"Polygon",coordinates:[[]]},u=1;u<=n;u++){var a=u*(360/n)*Math.PI/180;s.coordinates[0].push([o[0]+i*Math.cos(a),o[1]+i*Math.sin(a)])}return g(s)}function O(r,o,n){var i=n||64,s=o||250;if(!r||r.length<2||!s||!i)throw new Error("Terraformer: missing parameter for Terraformer.Circle");t(this,new F({type:"Feature",geometry:k(r,s,i),properties:{radius:s,center:r,steps:i}})),this.__defineGetter__("bbox",function(){return e(this)}),this.__defineGetter__("radius",function(){return this.properties.radius}),this.__defineSetter__("radius",function(t){this.properties.radius=t,this.recalculate()}),this.__defineGetter__("steps",function(){return this.properties.steps}),this.__defineSetter__("steps",function(t){this.properties.steps=t,this.recalculate()}),this.__defineGetter__("center",function(){return this.properties.center}),this.__defineSetter__("center",function(t){this.properties.center=t,this.recalculate()})}var V={},j=6378137,J=57.29577951308232,U=.017453292519943,H={type:"link",properties:{href:"http://spatialreference.org/ref/sr-org/6928/ogcwkt/",type:"ogcwkt"}},I={type:"link",properties:{href:"http://spatialreference.org/ref/epsg/4326/ogcwkt/",type:"ogcwkt"}},N=["length"];return T.prototype={toMercator:function(){return d(this)},toGeographic:function(){return g(this)},convexHull:function(){var t,e,r=[];if("Point"===this.type)return this.coordinates&&this.coordinates.length>0?[this.coordinates]:[];if("LineString"===this.type||"MultiPoint"===this.type){if(!(this.coordinates&&this.coordinates.length>0))return[];r=this.coordinates}else if("Polygon"===this.type||"MultiLineString"===this.type){if(!(this.coordinates&&this.coordinates.length>0))return[];for(t=0;t<this.coordinates.length;t++)r=r.concat(this.coordinates[t])}else{if("MultiPolygon"!==this.type)throw new Error("Unable to get convex hull of "+this.type);if(!(this.coordinates&&this.coordinates.length>0))return[];for(t=0;t<this.coordinates.length;t++)for(e=0;e<this.coordinates[t].length;e++)r=r.concat(this.coordinates[t][e])}return P(r)},toJSON:function(){var t={};for(var e in this)this.hasOwnProperty(e)&&this[e]&&N.indexOf(e)&&(t[e]=this[e]);return t},toJson:function(){return JSON.stringify(this)}},G.prototype=new T,G.prototype.constructor=G,b.prototype=new T,b.prototype.constructor=b,b.prototype.forEach=function(t){for(var e=0;e<this.length;e++)t.apply(this,[this.coordinates[e],e,this.coordinates]);return this},b.prototype.addPoint=function(t){return this.coordinates.push(t),this},b.prototype.insertPoint=function(t,e){return this.coordinates.splice(e,0,t),this},b.prototype.removePoint=function(t){return"number"==typeof t?this.coordinates.splice(t,1):this.coordinates.splice(this.coordinates.indexOf(t),1),this},x.prototype=new T,x.prototype.constructor=x,x.prototype.addVertex=function(t){return this.coordinates.push(t),this},x.prototype.insertVertex=function(t,e){return this.coordinates.splice(e,0,t),this},x.prototype.removeVertex=function(t){return this.coordinates.splice(t,1),this},C.prototype=new T,C.prototype.constructor=C,C.prototype.forEach=function(t){for(var e=0;e<this.coordinates.length;e++)t.apply(this,[this.coordinates[e],e,this.coordinates])},S.prototype=new T,S.prototype.constructor=S,S.prototype.addVertex=function(t){return this.coordinates[0].push(t),this},S.prototype.insertVertex=function(t,e){return this.coordinates[0].splice(e,0,t),this},S.prototype.removeVertex=function(t){return this.coordinates[0].splice(t,1),this},S.prototype.contains=function(t){if("Point"!==t.type)throw new Error("Only points are supported");if(t.coordinates&&t.coordinates.length){if(this.coordinates&&1===this.coordinates.length)return M(this.coordinates[0],t.coordinates);if(M(this.coordinates[0],t.coordinates)){for(var e=1;e<this.coordinates.length;e++)if(M(this.coordinates[e],t.coordinates))return!1;return!0}return!1}},A.prototype=new T,A.prototype.constructor=A,A.prototype.forEach=function(t){for(var e=0;e<this.coordinates.length;e++)t.apply(this,[this.coordinates[e],e,this.coordinates])},F.prototype=new T,F.prototype.constructor=F,L.prototype=new T,L.prototype.constructor=L,L.prototype.forEach=function(t){for(var e=0;e<this.features.length;e++)t.apply(this,[this.features[e],e,this.features])},L.prototype.get=function(t){var e;return this.forEach(function(r){r.id===t&&(e=r)}),e},E.prototype=new T,E.prototype.constructor=E,E.prototype.forEach=function(t){for(var e=0;e<this.geometries.length;e++)t.apply(this,[this.geometries[e],e,this.geometries])},O.prototype=new T,O.prototype.constructor=O,O.prototype.recalculate=function(){return this.geometry=k(this.center,this.radius,this.steps),this},V.Primitive=T,V.Point=G,V.MultiPoint=b,V.LineString=x,V.MultiLineString=C,V.Polygon=S,V.MultiPolygon=A,V.Feature=F,V.FeatureCollection=L,V.GeometryCollection=E,V.Circle=O,V.toMercator=d,V.toGeographic=g,V.Tools={},V.Tools.positionToMercator=p,V.Tools.positionToGeographic=l,V.Tools.applyConverter=y,V.Tools.toMercator=d,V.Tools.toGeographic=g,V.Tools.createCircle=k,V.Tools.calculateBounds=e,V.Tools.coordinatesContainPoint=M,V.Tools.convexHull=P,V.MercatorCRS=H,V.GeographicCRS=I,V});