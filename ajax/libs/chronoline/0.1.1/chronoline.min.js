function addElemClass(t,e,a){"SVG"==t?e.setAttribute("class",a):e.className+=" "+a}function formatDate(t,e){var a=e;if(-1!=e.indexOf("%d")){var n=t.getDate().toString();n.length<2&&(n="0"+n),a=a.replace("%d",n)}if(-1!=e.indexOf("%b")){var r=monthNames[t.getMonth()].substring(0,3);a=a.replace("%b",r)}return-1!=e.indexOf("%Y")&&(a=a.replace("%Y",t.getFullYear())),a}function getLeft(t){return parseInt(t.style.left)}function getEndDate(t){return t[t.length-1]}function isFifthDay(t){var e=t.getDate();return(1==e||e%5==0)&&30!=e}function isHalfMonth(t){var e=t.getDate();return 1==e||15==e}function prevMonth(t){var e=new Date(t.getTime()-DAY_IN_MILLISECONDS);return new Date(e.getFullYear(),e.getMonth(),1)}function nextMonth(t){return new Date(t.getFullYear(),t.getMonth()+1,1)}function prevQuarter(t){var e=new Date(t.getTime()-DAY_IN_MILLISECONDS),a=e.getMonth();return new Date(e.getFullYear(),a-a%3,1)}function nextQuarter(t){var e=t.getMonth();return new Date(t.getFullYear(),e-e%3+3,1)}function backWeek(t){return new Date(t.getTime()-7*DAY_IN_MILLISECONDS)}function forwardWeek(t){return new Date(t.getTime()+7*DAY_IN_MILLISECONDS)}function Chronoline(t,e,a){this.VERSION="0.1.1";var n={defaultStartDate:null,startDate:null,endDate:null,visibleSpan:2592e6,timelinePadding:0,topMargin:40,eventHeight:5,eventMargin:4,dateLabelHeight:50,hashLength:4,minEventsHeight:40,maxEventsHeight:1e3,hashColor:"#b8b8b8",eventAttrs:{fill:"#0055e1",stroke:"#0055e1","stroke-width":2},hashInterval:null,labelInterval:null,labelFormat:"%d",subLabel:"month",subLabelMargin:2,subLabelAttrs:{"font-weight":"bold"},floatingSubLabels:!0,subSubLabel:"year",subSubLabelMargin:2,subSubLabelAttrs:{"font-weight":"bold"},floatingSubSubLabels:!0,fontAttrs:{"font-size":10,fill:"#000000"},scrollable:!0,scrollLeft:backWeek,scrollRight:forwardWeek,animated:!1,tooltips:!1,markToday:"line",todayAttrs:{stroke:"#484848"},sections:null,floatingSectionLabels:!0,sectionLabelAttrs:{},sectionLabelsOnHover:!0,draggable:!1,continuousScroll:!0,continuousScrollSpeed:1},r=this;for(var o in n)r[o]=n[o];for(var o in a)r[o]=a[o];r.floatingSectionLabels&=null!=r.sections,r.sectionLabelsOnHover&=null!=r.sections,r.domElement=t,r.wrapper=document.createElement("div"),r.wrapper.className="chronoline-wrapper",r.domElement.appendChild(r.wrapper),r.sortEvents=function(t,e){t=t.dates,e=e.dates;var a=t[t.length-1].getTime(),n=e[e.length-1].getTime();return a!=n?a-n:t[0].getTime()-e[0].getTime()};for(var i=0;i<e.length;i++)for(var s=0;s<e[i].dates.length;s++)e[i].dates[s]=new Date(e[i].dates[s].getTime()),e[i].dates[s].stripTime();if(r.events=e,r.events.sort(r.sortEvents),null!=r.sections){for(var i=0;i<r.sections.length;i++)for(var s=0;s<r.sections[i].dates.length;s++)r.sections[i].dates[s]=new Date(r.sections[i].dates[s].getTime()),r.sections[i].dates[s].stripTime();r.sections.sort(r.sortEvents)}if(r.today=new Date(Date.now()),r.today.stripTime(),null==r.defaultStartDate&&(r.defaultStartDate=r.today),null==r.startDate)if(r.events.length>0){r.startDate=r.events[0].dates[0];for(var i=1;i<r.events.length;i++)r.events[i].dates[0]<r.startDate&&(r.startDate=r.events[i].dates[0])}else{if(!(r.sections.length>0))return;r.startDate=r.sections[0].dates[0];for(var i=0;i<r.sections.length;i++)r.sections[i].dates[0]<r.startDate&&(r.startDate=r.sections[i].dates[0])}if(r.startDate.stripTime(),r.startDate>r.defaultStartDate&&(r.startDate=r.defaultStartDate),r.startDate=new Date(r.startDate.getTime()-r.timelinePadding),r.startTime=r.startDate.getTime(),null==r.endDate)if(r.events.length>0){r.endDate=getEndDate(r.events[0].dates);for(var i=1;i<r.events.length;i++)getEndDate(r.events[i].dates)>r.endDate&&(r.endDate=getEndDate(r.events[i].dates))}else{if(!(r.sections.length>0))return;r.endDate=r.sections[0].dates[1];for(var i=0;i<r.sections.length;i++)r.sections[i].dates[1]>r.endDate&&(r.endDate=r.sections[i].dates[1])}r.endDate<r.defaultStartDate&&(r.endDate=r.defaultStartDate),r.endDate=new Date(Math.max(r.endDate.getTime(),r.startDate.getTime()+r.visibleSpan)+r.timelinePadding),r.endDate.stripTime(),r.visibleWidth=r.domElement.clientWidth,r.pxRatio=r.visibleWidth/r.visibleSpan,r.totalWidth=r.pxRatio*(r.endDate.getTime()-r.startDate.getTime()),r.maxLeftPx=r.totalWidth-r.visibleWidth,r.pxToMs=function(t){return r.startTime+t/r.pxRatio},r.msToPx=function(t){return(t-r.startTime)*r.pxRatio},r.circleRadius=r.eventHeight/2,r.eventRows=[[]],r.rowLastPxs=[0];for(var i=0;i<r.events.length;i++){for(var l=!1,d=r.msToPx(r.events[i].dates[0].getTime())-r.circleRadius,s=0;s<r.eventRows.length;s++)if(r.rowLastPxs[s]<d){r.eventRows[s].push(r.events[i]),r.rowLastPxs[s]=r.msToPx(getEndDate(r.events[i].dates).getTime())+r.circleRadius,l=!0;break}l||(r.eventRows.push([r.events[i]]),r.rowLastPxs.push(r.msToPx(getEndDate(r.events[i].dates).getTime())+r.circleRadius))}if(r.eventsHeight=Math.max(Math.min(r.eventRows.length*(r.eventMargin+r.eventHeight),r.maxEventsHeight),r.minEventsHeight),r.totalHeight=r.dateLabelHeight+r.eventsHeight+r.topMargin,r.myCanvas=document.createElement("div"),r.myCanvas.className="chronoline-canvas",r.wrapper.appendChild(r.myCanvas),r.paper=Raphael(r.myCanvas,r.totalWidth,r.totalHeight),r.paperType=r.paper.raphael.type,r.paperElem=r.myCanvas.childNodes[0],r.floatingSet=r.paper.set(),r.sectionLabelSet=r.paper.set(),null!=r.sections)for(var i=0;i<r.sections.length;i++){var u=r.sections[i],c=(u.dates[0].getTime()-r.startTime)*r.pxRatio,g=(u.dates[1]-u.dates[0])*r.pxRatio,f=r.paper.rect(c,0,g,r.totalHeight);f.attr("stroke-width",0),f.attr("stroke","#ffffff"),"undefined"!=typeof u.attrs&&f.attr(u.attrs);var p=r.paper.text(c+10,10,u.title);p.attr("text-anchor","start"),p.attr(r.sectionLabelAttrs),r.floatingSectionLabels&&(p.data("left-bound",c+10),p.data("right-bound",c+g-p.attr("width")),r.floatingSet.push(p),r.sectionLabelSet.push(p)),f.data("label",p),r.sectionLabelsOnHover&&(f.hover(function(){this.data("label").animate({opacity:1},200)},function(){this.data("label").animate({opacity:0},200)}),p.hover(function(){this.animate({opacity:1},200)},function(){this.animate({opacity:0},200)}),p.attr("opacity",0))}r.sectionLabelSet.forEach(function(t){t.toFront()});for(var m=0;m<r.eventRows.length;m++)for(var h=r.totalHeight-r.dateLabelHeight-(m+1)*(r.eventMargin+r.eventHeight),v=0;v<r.eventRows[m].length;v++){var b=r.eventRows[m][v],c=(b.dates[0].getTime()-r.startTime)*r.pxRatio,f=null;if(1==b.dates.length)f=r.paper.circle(c,h+r.circleRadius,r.circleRadius).attr(r.eventAttrs);else{var g=(getEndDate(b.dates)-b.dates[0])*r.pxRatio,D=r.paper.circle(c,h+r.circleRadius,r.circleRadius).attr(r.eventAttrs);"undefined"!=typeof b.attrs&&D.attr(b.attrs),addElemClass(r.paperType,D.node,"chronoline-event");var S=r.paper.circle(c+g,h+r.circleRadius,r.circleRadius).attr(r.eventAttrs);"undefined"!=typeof b.attrs&&S.attr(b.attrs),addElemClass(r.paperType,S.node,"chronoline-event"),f=r.paper.rect(c,h,g,r.eventHeight).attr(r.eventAttrs)}if("undefined"!=typeof b.link&&(f.data("link",b.link),f.click(function(){window.location.href=this.data("link")})),"undefined"!=typeof b.attrs&&f.attr(b.attrs),addElemClass(r.paperType,f.node,"chronoline-event"),f.attr("title",b.title),r.tooltips){var T=b.description,w=b.title;"undefined"!=typeof T&&""!=T||(T=w,w="");var L=jQuery(f.node);"SVG"==Raphael.type&&(L=L.parent()),L.qtip({content:{title:w,text:T},position:{my:"top left",target:"mouse",viewport:jQuery(window),adjust:{x:10,y:10}},hide:{fixed:!0},style:{classes:"qtip-shadow qtip-dark qtip-rounded"}})}if(null!=r.sections&&r.sectionLabelsOnHover){var x=b.section;if("undefined"!=typeof x){for(var i=0;i<r.sections.length;i++)if(r.sections[i].section==x){f.data("sectionLabel",r.sectionLabelSet[i]);break}f.hover(function(){this.data("sectionLabel").animate({opacity:1},200)},function(){this.data("sectionLabel").animate({opacity:0},200)})}}}var y=r.totalHeight-r.dateLabelHeight,M=r.paper.path("M0,"+y+"L"+r.totalWidth+","+y);if(M.attr("stroke",r.hashColor),r.bottomHashY=y+r.hashLength,r.labelY=r.bottomHashY+r.fontAttrs["font-size"],r.subLabelY=r.bottomHashY+2*r.fontAttrs["font-size"]+r.subLabelMargin,r.subSubLabelY=r.subLabelY+r.fontAttrs["font-size"]+r.subSubLabelMargin,"year"==r.subSubLabel)for(var C=r.endDate.getFullYear(),E=r.startDate.getFullYear();C>=E;E++){var R=new Date(E,0,1);R.stripTime();var H=r.msToPx(R.getTime()),A=r.paper.text(H,r.subSubLabelY,formatDate(R,"%Y").toUpperCase());if(A.attr(r.fontAttrs),A.attr(r.subSubLabelAttrs),r.floatingSubSubLabels){A.data("left-bound",H);var P=new Date(E,11,31);P.stripTime(),A.data("right-bound",Math.min((P.getTime()-r.startTime)*r.pxRatio-5,r.totalWidth)),r.floatingSet.push(A)}}if(r.drawLabelsHelper=function(t,e){for(var a=t;e>a;a+=DAY_IN_MILLISECONDS){var n=new Date(a),o=n.getDate(),i=r.msToPx(a);if(null==r.hashInterval||r.hashInterval(n)){var s=r.paper.path("M"+i+","+y+"L"+i+","+r.bottomHashY);s.attr("stroke",r.hashColor)}if(null==r.labelInterval||r.labelInterval(n)){var l=String(o);1==l.length&&(l="0"+l);var d=r.paper.text(i,r.labelY,l);d.attr(r.fontAttrs)}if(r.markToday&&a==r.today.getTime())if("labelBox"==r.markToday){d.attr({text:d.attr("text")+"\n"+formatDate(n,"%b").toUpperCase(),"font-size":r.fontAttrs["font-size"]+2,y:r.bottomHashY+r.fontAttrs["font-size"]+5});var u=d.getBBox(),c=r.paper.rect(u.x-2,u.y-2,u.width+4,u.height+4);c.attr("fill","90-#f4f4f4-#e8e8e8"),c.insertBefore(d)}else if("line"==r.markToday){var g=r.paper.path("M"+i+",0L"+i+","+y);g.attr(r.todayAttrs)}if(1==o&&"month"==r.subLabel){var f=r.paper.text(i,r.subLabelY,formatDate(n,"%b").toUpperCase());if(f.attr(r.fontAttrs),f.attr(r.subLabelAttrs),r.floatingSubLabels){f.data("left-bound",i);var p=new Date(n.getFullYear(),n.getMonth()+1,0,CL_HOUR);f.data("right-bound",Math.min((p.getTime()-r.startTime)*r.pxRatio-5,r.totalWidth)),r.floatingSet.push(f)}}}},r.drawnStartMs=null,r.drawnEndMs=null,r.drawLabels=function(t){var e=Math.max(0,t-r.visibleWidth),a=(Math.min(r.totalWidth,t+2*r.visibleWidth),new Date(r.pxToMs(e)));a=new Date(a.getFullYear(),a.getMonth(),1,CL_HOUR);var n=a.getTime(),o=new Date(r.pxToMs(Math.min(r.totalWidth,t+2*r.visibleWidth)));o.stripTime();var i=o.getTime();null==r.drawnStartMs?(r.drawnStartMs=n,r.drawnEndMs=i,r.drawLabelsHelper(n,i)):n>r.drawnEndMs?(r.drawLabelsHelper(r.drawnEndMs,i),r.drawnEndMs=i):i<r.drawnStartMs?(r.drawLabelsHelper(n,r.drawnStartMs),r.drawnStartMs=n):(n<r.drawnStartMs&&(r.drawLabelsHelper(n,r.drawnStartMs),r.drawnStartMs=n),i>r.drawnEndMs&&(r.drawLabelsHelper(r.drawnEndMs,i),r.drawnEndMs=i))},r.isMoving=!1,r.goToPx=function(t,e,a){function n(e){null==l&&(l=e);var a=(e-l)/200,s=(t-o)*a+o;d.style.left=s+"px";for(var u=0;u<i.length;u++)i[u][0].attr("x",i[u][2]*a+i[u][1]);if(1>a)requestAnimationFrame(n);else{r.paperElem.style.left=t+"px";for(var u=0;u<i.length;u++)i[u][0].attr("x",i[u][2]+i[u][1]);r.isMoving=!1}}if(r.isMoving)return!1;e="undefined"!=typeof e?e:r.animated,a="undefined"!=typeof a?a:!0,t=Math.max(Math.min(t,0),-r.maxLeftPx),a&&r.drawLabels(-t);var o=getLeft(r.paperElem);r.scrollable&&(0==t?(r.leftControl.style.display="none",r.isScrolling=!1):r.leftControl.style.display="",t==r.visibleWidth-r.totalWidth?(r.rightControl.style.display="none",r.isScrolling=!1):r.rightControl.style.display="");var i=[],s=-t+5;if(r.floatingSet.forEach(function(t){t.data("left-bound")<s&&t.data("right-bound")>s?i.push([t,t.attr("x"),s-t.attr("x")+10]):t.attr("x")!=t.data("left-bound")&&i.push([t,t.attr("x"),t.data("left-bound")-t.attr("x")])}),e){r.isMoving=!0;var l=null,d=r.paperElem;requestAnimationFrame(n)}else{r.paperElem.style.left=t+"px";for(var u=0;u<i.length;u++)i[u][0].attr("x",i[u][2]+i[u][1])}return 0!=t&&t!=-r.maxLeftPx},r.goToDate=function(t,e){t=new Date(t.getTime()),t.stripTime(),0>e?r.goToPx(-r.msToPx(t.getTime())):e>0?r.goToPx(-r.msToPx(t.getTime())+r.visibleWidth):r.goToPx(-r.msToPx(t.getTime())+r.visibleWidth/2)},r.scrollable){r.leftControl=document.createElement("div"),r.leftControl.className="chronoline-left",r.leftControl.style.marginTop=r.topMargin+"px";var Y=document.createElement("div");Y.className="chronoline-left-icon",r.leftControl.appendChild(Y),r.wrapper.appendChild(r.leftControl);var I=Math.max(r.eventsHeight,r.leftControl.clientHeight);r.leftControl.style.height=I+"px",Y.style.marginTop=(I-15)/2+"px",r.rightControl=document.createElement("div"),r.rightControl.className="chronoline-right",r.rightControl.style.marginTop=r.topMargin+"px";var k=document.createElement("div");k.className="chronoline-right-icon",r.rightControl.appendChild(k),r.wrapper.appendChild(r.rightControl),r.rightControl.style.height=r.leftControl.style.height,k.style.marginTop=Y.style.marginTop,r.scrollLeftDiscrete=function(t){return r.goToDate(r.scrollLeft(new Date(r.pxToMs(-getLeft(r.paperElem)))),-1),!1},r.scrollRightDiscrete=function(t){return r.goToDate(r.scrollRight(new Date(r.pxToMs(-getLeft(r.paperElem)))),-1),!1},r.continuousScroll?(r.isScrolling=!1,r.timeoutId=-1,r.scrollLeftContinuous=function(t){null==r.scrollStart&&(r.scrollStart=t),r.isScrolling&&requestAnimationFrame(r.scrollLeftContinuous);var e=r.continuousScrollSpeed*(t-r.scrollStart)+r.scrollPaperStart;r.goToPx(e,!1,e>-r.msToPx(r.drawnStartMs))},r.endScrollLeft=function(t){clearTimeout(r.scrollTimeoutId),r.toScrollDiscrete&&(r.toScrollDiscrete=!1,r.scrollLeftDiscrete()),r.isScrolling=!1},r.leftControl.onmousedown=function(t){r.toScrollDiscrete=!0,r.scrollPaperStart=getLeft(r.paperElem),r.scrollTimeoutId=setTimeout(function(){r.toScrollDiscrete=!1,r.scrollStart=null,r.isScrolling=!0,requestAnimationFrame(r.scrollLeftContinuous)},200)},r.leftControl.onmouseup=r.endScrollLeft,r.leftControl.onmouseleave=r.endScrollLeft,r.scrollRightContinuous=function(t){null==r.scrollStart&&(r.scrollStart=t),r.isScrolling&&requestAnimationFrame(r.scrollRightContinuous);var e=r.continuousScrollSpeed*(r.scrollStart-t)+r.scrollPaperStart;r.goToPx(e,!1,e-r.visibleWidth<-r.msToPx(r.drawnEndMs))},r.endScrollRight=function(t){clearTimeout(r.scrollTimeoutId),r.toScrollDiscrete&&(r.toScrollDiscrete=!1,r.scrollRightDiscrete()),r.isScrolling=!1},r.rightControl.onmousedown=function(t){r.toScrollDiscrete=!0,r.scrollPaperStart=getLeft(r.paperElem),r.scrollTimeoutId=setTimeout(function(){r.toScrollDiscrete=!1,r.scrollStart=null,r.isScrolling=!0,requestAnimationFrame(r.scrollRightContinuous)},500)},r.rightControl.onmouseup=r.endScrollRight,r.rightControl.onmouseleave=r.endScrollRight):(r.leftControl.onclick=r.scrollLeftDiscrete,r.rightControl.onclick=r.scrollLeftDiscrete)}r.draggable&&(r.stopDragging=function(t){jQuery(r.wrapper).removeClass("dragging").unbind("mousemove",r.mouseMoved).unbind("mouseleave",r.stopDragging).unbind("mouseup",r.stopDragging),r.drawLabels(-getLeft(r.paperElem))},r.mouseMoved=function(t){r.goToPx(r.dragPaperStart-(r.dragMouseStart-t.pageX),!1,!1)},r.wrapper.className+=" chronoline-draggable",jQuery(r.paperElem).mousedown(function(t){t.preventDefault(),r.dragMouseStart=t.pageX,r.dragPaperStart=getLeft(r.paperElem),jQuery(r.wrapper).addClass("dragging").bind("mousemove",r.mouseMoved).bind("mouseleave",r.stopDragging).bind("mouseup",r.stopDragging)})),r.goToToday=function(){r.goToDate(r.today,0)},r.getLeftTime=function(){return Math.floor(r.startTime-getLeft(r.paperElem)/r.pxRatio)},r.getRightTime=function(){return Math.floor(r.startTime-(getLeft(r.paperElem)-r.visibleWidth)/r.pxRatio)},r.paperElem.style.left=-(r.defaultStartDate-r.startDate)*r.pxRatio+20+"px",r.goToPx(getLeft(r.paperElem)),r.myCanvas.style.height=r.totalHeight+"px"}Date.now||(Date.now=function(){return+new Date}),DAY_IN_MILLISECONDS=864e5;var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){return window.setTimeout(function(){t(+new Date)},1e3/60)},Date.prototype.stdTimezoneOffset=function(){var t=new Date(this.getFullYear(),0,1),e=new Date(this.getFullYear(),6,1);return Math.max(t.getTimezoneOffset(),e.getTimezoneOffset())},Date.prototype.dstHourAdjustment=function(){return(this.stdTimezoneOffset()-this.getTimezoneOffset())/60},CL_HOUR=12,Date.prototype.stripTime=function(){this.setHours(CL_HOUR+this.dstHourAdjustment()),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0)};