!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn"),require("acorn/dist/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/dist/acorn","acorn/dist/walk"],e):void e(tern,tern,tern.comment,acorn,acorn.walk)}(function(e,r,n,t,a){"use strict";function o(e,r){function t(e){n.ensureCommentsBefore(r,e)}a.simple(e,{VariableDeclaration:t,FunctionDeclaration:t,MethodDefinition:t,Property:t,AssignmentExpression:function(e){"="==e.operator&&t(e)},CallExpression:function(e){i(e)&&t(e)}})}function i(e){return"MemberExpression"==e.callee.type&&"Object"==e.callee.object.name&&"defineProperty"==e.callee.property.name&&e.arguments.length>=3&&"string"==typeof e.arguments[1].value}function l(r,n){A(r.sourceFile.text,n),a.simple(r,{VariableDeclaration:function(e,r){var n=e.declarations[0].id;e.commentsBefore&&"Identifier"==n.type&&f(e,e.commentsBefore,r,r.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.scope.fnType)},ClassDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.objType)},AssignmentExpression:function(r,n){r.commentsBefore&&f(r,r.commentsBefore,n,e.expressionType({node:r.left,state:n}))},ObjectExpression:function(r,n){for(var t=0;t<r.properties.length;++t){var a=r.properties[t],o=e.propName(a);"<i>"!=o&&a.commentsBefore&&f(a,a.commentsBefore,n,r.objType.getProp(o))}},Class:function(r,n){var t=r.objType.getProp("prototype").getObjType();if(t)for(var a=0;a<r.body.body.length;a++){var o,i=r.body.body[a];i.commentsBefore&&("constructor"==i.kind?f(i,i.commentsBefore,n,r.objType):"<i>"!=(o=e.propName(i))&&f(i,i.commentsBefore,n,t.getProp(o)))}},CallExpression:function(r,n){if(r.commentsBefore&&i(r)){var t=e.expressionType({node:r.arguments[0],state:n}).getObjType();if(t&&t instanceof e.Obj){var a=t.props[r.arguments[1].value];a&&f(r,r.commentsBefore,n,a)}}}},e.searchVisitor,n)}function s(r){var n=r["!typedef"],t=e.cx(),a=r["!name"];if(n)for(var o in n)t.parent.mod.jsdocTypedefs[o]=v(e.def.parse(n[o],a,o),o)}function c(e){for(var r,n=1;n<e.length;n++){var t=e[n],a=t.match(/^[\s\*]*/)[0];if(a!=t)if(null==r)r=a;else{for(var o=0;o<r.length&&r.charCodeAt(o)==a.charCodeAt(o);)++o;o<r.length&&(r=r.slice(0,o))}}for(e=e.map(function(e,n){if(e=e.replace(/\s+$/,""),0==n&&null!=r)for(var t=0;t<r.length;t++){var a=e.indexOf(r.slice(t));if(0==a)return e.slice(r.length-t)}return null==r||0==n?e.replace(/^[\s\*]*/,""):e.length<r.length?"":e.slice(r.length)});e.length&&!e[e.length-1];)e.pop();for(;e.length&&!e[0];)e.shift();return e}function f(r,n,t,a,o){b(r,t,a,n);var i=e.cx();!o&&a instanceof e.AVal&&a.types.length&&(o=a.types[a.types.length-1],o instanceof e.Obj&&o.origin==i.curOrigin&&!o.doc||(o=null));for(var l=n.length-1;l>=0;l--){var s=c(n[l].split(/\r\n?|\n/)).join("\n");if(s){a instanceof e.AVal&&(a.doc=s),o&&(o.doc=s);break}}}function p(e,r){for(;/\s/.test(e.charAt(r));)++r;return r}function u(e){if(!t.isIdentifierStart(e.charCodeAt(0)))return!1;for(var r=1;r<e.length;r++)if(!t.isIdentifierChar(e.charCodeAt(r)))return!1;return!0}function d(e,r,n,t){for(var a=[],o=[],i=!1,l=!0;n=p(r,n),!l||r.charAt(n)!=t;l=!1){var s=r.indexOf(":",n);if(s<0)return null;var c=r.slice(n,s);if(!u(c))return null;a.push(c),n=s+1;var f=h(e,r,n);if(!f)return null;n=f.end,i=i||f.madeUp,o.push(f.type),n=p(r,n);var d=r.charAt(n);if(++n,d==t)break;if(","!=d)return null}return{labels:a,types:o,end:n,madeUp:i}}function m(r,n,t){var a=y(r,n,t);return a?"[]"==n.slice(a.end,a.end+2)?{madeUp:a.madeUp,end:a.end+2,type:new e.Arr(a.type)}:a:null}function h(r,n,t){for(var a,o=!1,i=!1;;){var l=m(r,n,t);if(!l)return null;if(i=i||l.madeUp,o?l.type.propagate(o):a=l.type,t=p(n,l.end),"|"!=n.charAt(t))break;t++,o||(o=new e.AVal,a.propagate(o),a=o)}var s=!1;return"="==n.charAt(t)&&(++t,s=!0),{type:a,end:t,isOptional:s,madeUp:i}}function y(r,n,a){a=p(n,a);var o,i=!1;if(n.indexOf("function(",a)==a){var l=d(r,n,a+9,")"),s=e.ANull;if(!l)return null;if(a=p(n,l.end),":"==n.charAt(a)){++a;var c=h(r,n,a+1);if(!c)return null;a=c.end,s=c.type,i=c.madeUp}o=new e.Fn(null,e.ANull,l.types,l.labels,s)}else if("["==n.charAt(a)){var f=h(r,n,a+1);if(!f)return null;if(a=p(n,f.end),i=f.madeUp,"]"!=n.charAt(a))return null;++a,o=new e.Arr(f.type)}else if("{"==n.charAt(a)){var u=d(r,n,a+1,"}");if(!u)return null;o=new e.Obj(!0);for(var m=0;m<u.types.length;++m){var y=o.defProp(u.labels[m]);y.initializer=!0,u.types[m].propagate(y)}a=u.end,i=u.madeUp}else if("("==n.charAt(a)){var f=h(r,n,a+1);if(!f)return null;if(a=p(n,f.end),")"!=n.charAt(a))return null;++a,o=f.type}else{var g=a;if(!t.isIdentifierStart(n.charCodeAt(a)))return null;for(;t.isIdentifierChar(n.charCodeAt(a));)++a;if(g==a)return null;var b=n.slice(g,a);if(/^(number|integer)$/i.test(b))o=e.cx().num;else if(/^bool(ean)?$/i.test(b))o=e.cx().bool;else if(/^string$/i.test(b))o=e.cx().str;else if(/^(null|undefined)$/i.test(b))o=e.ANull;else if(/^array$/i.test(b)){var f=null;if("."==n.charAt(a)&&"<"==n.charAt(a+1)){var A=h(r,n,a+2);if(!A)return null;if(a=p(n,A.end),i=A.madeUp,">"!=n.charAt(a++))return null;f=A.type}o=new e.Arr(f)}else if(/^object$/i.test(b)){if(o=new e.Obj(!0),"."==n.charAt(a)&&"<"==n.charAt(a+1)){var j=h(r,n,a+2);if(!j)return null;if(a=p(n,j.end),i=i||j.madeUp,","!=n.charAt(a++))return null;var x=h(r,n,a);if(!x)return null;if(a=p(n,x.end),i=j.madeUp||x.madeUp,">"!=n.charAt(a++))return null;x.type.propagate(o.defProp("<i>"))}}else{for(;46==n.charCodeAt(a)||t.isIdentifierChar(n.charCodeAt(a));)++a;var O,P=n.slice(g,a),T=e.cx(),C=T.parent&&T.parent.mod.jsdocTypedefs;C&&P in C?o=C[P]:(O=e.def.parsePath(P,r).getObjType())?o=v(O,P):(T.jsdocPlaceholders||(T.jsdocPlaceholders=Object.create(null)),o=P in T.jsdocPlaceholders?T.jsdocPlaceholders[P]:T.jsdocPlaceholders[P]=new e.Obj(null,P),i=!0)}}return{type:o,end:a,madeUp:i}}function v(r,n){if(r instanceof e.Fn&&/(?:^|\.)[A-Z][^\.]*$/.test(n)){var t=r.getProp("prototype").getObjType();if(t instanceof e.Obj)return e.getInstance(t)}return r}function g(e,r,n){if(n=p(r,n||0),"{"!=r.charAt(n))return null;var t=h(e,r,n+1);if(!t)return null;var a=p(r,t.end);return"}"!=r.charAt(a)?null:(t.end=a+1,t)}function b(e,r,n,t){for(var a,o,i,l,s,c,f=0;f<t.length;++f)for(var p,u=t[f],d=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?|this)\s+(.*)/g;p=d.exec(u);)if("this"==p[1]&&(c=h(r,p[2],0)))s=c,l=!0;else if(c=g(r,p[2]))switch(l=!0,p[1]){case"returns":case"return":i=c;break;case"type":a=c;break;case"param":case"arg":case"argument":var m=p[2].slice(c.end).match(/^\s*(\[?)\s*([^\]\s=]+)\s*(?:=[^\]]+\s*)?(\]?).*/);if(!m)continue;var y=m[2]+(c.isOptional||"["===m[1]&&"]"===m[3]?"?":"");(o||(o=Object.create(null)))[y]=c}l&&O(a,s,o,i,e,n)}function A(r,n){for(var t,a=e.cx(),o=/\s@typedef\s+(.*)/g;t=o.exec(r);){var i=g(n,t[1]),l=i&&t[1].slice(i.end).match(/^\s*(\S+)/);if(l&&i.type instanceof e.Obj){for(var s=r.slice(t.index+t[0].length);t=/\s+@prop(?:erty)?\s+(.*)/.exec(s);){var c,f=g(n,t[1]);f&&(c=t[1].slice(f.end).match(/^\s*(\S+)/))&&f.type.propagate(i.type.defProp(c[1])),s=s.slice(t[0].length)}a.parent.mod.jsdocTypedefs[l[1]]=i.type}}}function j(r,n){var t=e.cx().parent.mod.docComment.weight;r.type.propagate(n,t||(r.madeUp?P:void 0))}function x(e){return"FunctionExpression"==e.type||"ArrowFunctionExpression"==e.type}function O(r,n,t,a,o,i){var l;if("VariableDeclaration"==o.type){var s=o.declarations[0];s.init&&x(s.init)&&(l=s.init.scope.fnType)}else"FunctionDeclaration"==o.type?l=o.scope.fnType:"AssignmentExpression"==o.type?x(o.right)&&(l=o.right.scope.fnType):"CallExpression"==o.type||x(o.value)&&(l=o.value.scope.fnType);if(l&&(t||a||n)){if(t)for(var c=0;c<l.argNames.length;++c){var f=l.argNames[c],p=t[f];!p&&(p=t[f+"?"])&&(l.argNames[c]+="?"),p&&j(p,l.args[c])}a&&(l.retval==e.ANull&&(l.retval=new e.AVal),j(a,l.retval)),n&&j(n,l.self)}else r&&j(r,i)}var P=1,T=101;r.registerPlugin("doc_comment",function(e,r){e.mod.jsdocTypedefs=Object.create(null),e.on("reset",function(){e.mod.jsdocTypedefs=Object.create(null)}),e.mod.docComment={weight:r&&r.strong?T:void 0,fullDocs:r&&r.fullDocs},e.on("postParse",o),e.on("postInfer",l),e.on("postLoadDef",s)})});
//# sourceMappingURL=doc_comment.min.js.map