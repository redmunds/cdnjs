!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn/util/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/util/walk"],e):void e(tern,tern,tern.comment,acorn.walk)}(function(e,r,n,t){"use strict";function i(e,r){function i(e){n.ensureCommentsBefore(r,e)}t.simple(e,{VariableDeclaration:i,FunctionDeclaration:i,AssignmentExpression:function(e){"="==e.operator&&i(e)},ObjectExpression:function(e){for(var r=0;r<e.properties.length;++r)i(e.properties[r].key)}})}function a(r,n){t.simple(r,{VariableDeclaration:function(e,r){e.commentsBefore&&o(e,e.commentsBefore,r,r.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,r){e.commentsBefore&&o(e,e.commentsBefore,r,r.getProp(e.id.name),e.body.scope.fnType)},AssignmentExpression:function(r,n){r.commentsBefore&&o(r,r.commentsBefore,n,e.expressionType({node:r.left,state:n}))},ObjectExpression:function(e,r){for(var n=0;n<e.properties.length;++n){var t=e.properties[n],i=t.key;i.commentsBefore&&o(t,i.commentsBefore,r,e.objType.getProp(i.name))}}},e.searchVisitor,n)}function o(r,n,t,i,a){u(r,t,i,n),!a&&i instanceof e.AVal&&i.types.length&&(a=i.types[i.types.length-1],a instanceof e.Obj&&a.origin==e.cx().curOrigin&&!a.doc||(a=null));var o=n[0],s=o.search(/\.\s/);s>5&&(o=o.slice(0,s+1)),o=o.trim().replace(/\s*\n\s*\*\s*|\s{1,}/g," "),i instanceof e.AVal&&(i.doc=o),a&&(a.doc=o)}function s(e,r){for(;/\s/.test(e.charAt(r));)++r;return r}function l(e,r,n,t){for(var i=[],a=[],o=!0;n=s(r,n),!o||r.charAt(n)!=t;o=!1){var l=r.indexOf(":",n);if(l<0)return null;var f=r.slice(n,l);if(!/^[\w$]+$/.test(f))return null;i.push(f),n=l+1;var u=c(e,r,n);if(!u)return null;n=u.end,a.push(u.type),n=s(r,n);var p=r.charAt(n);if(++n,p==t)break;if(","!=p)return null}return{labels:i,types:a,end:n}}function c(r,n,t){t=s(n,t);var i;if(n.indexOf("function(",t)==t){var a=l(r,n,t+9,")"),o=e.ANull;if(!a)return null;if(t=s(n,a.end),":"==n.charAt(t)){++t;var f=c(r,n,t+1);if(!f)return null;t=f.end,o=f.type}i=new e.Fn(null,e.ANull,a.types,a.labels,o)}else if("["==n.charAt(t)){var u=c(r,n,t+1);if(!u)return null;if(t=s(n,u.end),"]"!=n.charAt(t))return null;++t,i=new e.Arr(u.type)}else if("{"==n.charAt(t)){var p=l(r,n,t+1,"}");if(!p)return null;i=new e.Obj(!0);for(var m=0;m<p.types.length;++m){var y=i.defProp(p.labels[m]);y.initializer=!0,p.types[m].propagate(y)}t=p.end}else{for(var g=t;/[\w$]/.test(n.charAt(t));)++t;if(g==t)return null;var v=n.slice(g,t);if(/^(number|integer)$/i.test(v))i=e.cx().num;else if(/^bool(ean)?$/i.test(v))i=e.cx().bool;else if(/^string$/i.test(v))i=e.cx().str;else if(/^array$/i.test(v)){var u=null;if("."==n.charAt(t)&&"<"==n.charAt(t+1)){var d=c(r,n,t+2);if(!d)return null;if(t=s(n,d.end),">"!=n.charAt(t++))return null;u=d.type}i=new e.Arr(u)}else if(/^object$/i.test(v)){if(i=new e.Obj(!0),"."==n.charAt(t)&&"<"==n.charAt(t+1)){var b=c(r,n,t+2);if(!b)return null;if(t=s(n,b.end),","!=n.charAt(t++))return null;var h=c(r,n,t);if(!h)return null;if(t=s(n,h.end),">"!=n.charAt(t++))return null;h.type.propagate(i.defProp("<i>"))}}else{var A=r.hasProp(v);if(A&&(A=A.getType()),A)if(A instanceof e.Fn&&/^[A-Z]/.test(v)){var x=A.getProp("prototype").getType();i=x instanceof e.Obj?e.getInstance(x):A}else i=A;else i=e.ANull}}var w=!1;return"="==n.charAt(t)&&(++t,w=!0),{type:i,end:t,isOptional:w}}function f(e,r,n){if(n=s(r,n||0),"{"!=r.charAt(n))return null;var t=c(e,r,n+1);return t&&"}"==r.charAt(t.end)?(++t.end,t):null}function u(e,r,n,t){for(var i,a,o,s,l=0;l<t.length;++l)for(var c,u=t[l],m=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?)\s+(.*)/g;c=m.exec(u);){var y=f(r,c[2]);if(y)switch(s=!0,c[1]){case"returns":case"return":o=y.type;break;case"type":i=y.type;break;case"param":case"arg":case"argument":var g=c[2].slice(y.end).match(/^\s*([\w$]+)/);if(!g)continue;var v=g[1]+(y.isOptional?"?":"");(a||(a=Object.create(null)))[v]=y.type}}s&&p(i,a,o,e,n)}function p(e,r,n,t,i){var a;if("VariableDeclaration"==t.type){var o=t.declarations[0];o.init&&"FunctionExpression"==o.init.type&&(a=o.init.body.scope.fnType)}else"FunctionDeclaration"==t.type?a=t.body.scope.fnType:"AssignmentExpression"==t.type?"FunctionExpression"==t.right.type&&(a=t.right.body.scope.fnType):"FunctionExpression"==t.value.type&&(a=t.value.body.scope.fnType);if(a&&(r||n)){if(r)for(var s=0;s<a.argNames.length;++s){var l=a.argNames[s],c=r[l];!c&&(c=r[l+"?"])&&(a.argNames[s]+="?"),c&&c.propagate(a.args[s])}n&&n.propagate(a.retval)}else e&&e.propagate(i)}r.registerPlugin("doc_comment",function(){return{passes:{postParse:i,postInfer:a}}})});
//# sourceMappingURL=doc_comment.min.js.map