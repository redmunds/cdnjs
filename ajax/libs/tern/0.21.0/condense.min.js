!function(t,e){return"object"==typeof exports&&"object"==typeof module?e(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],e):void e(t.tern||(t.tern={}),tern)}(this,function(t,e){"use strict";function r(t,r,n){this.origins=t,this.cx=e.cx(),this.server=n.server||this.cx.parent||{signal:function(){}},this.maxOrigin=-(1/0);for(var i=0;i<t.length;++i)this.maxOrigin=Math.max(this.maxOrigin,this.cx.origins.indexOf(t[i]));this.output={"!name":r,"!define":{}},this.options=n,this.types=Object.create(null),this.altPaths=Object.create(null),this.patchUp=[],this.roots=Object.create(null)}function n(t){for(var e,r=1,n=0;(e=t.indexOf(".",n))!=-1;)n=e+1,r+="!"==t.charAt(n)?10:1;return r}function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(t){return t.proto&&!(t instanceof e.Fn)&&t.proto!=e.cx().protos.Object&&t.proto.hasCtor&&!t.hasCtor}function a(t,r,i,o,a){var p=t.getType(!1);if(p){var s=t.origin||p.origin,h=!1;if(s){var u=o.cx.origins.indexOf(s);if(u>o.maxOrigin)return;h=o.isTarget(s)}var c=r?r+"."+i:i,f=p.path,l=!f||n(f)>n(c);if(l){if(p instanceof e.Prim||(p.path=c),p.reached(c,o,!h)&&h){var y=o.types[f];y?(delete o.types[f],o.altPaths[f]=p):y={type:p},y.span=o.getSpan(t)||p!=t&&o.isTarget(p.origin)&&o.getSpan(p)||y.span,y.doc=t.doc||p!=t&&o.isTarget(p.origin)&&p.doc||y.doc,y.data=p.metaData,y.byName=null==y.byName?!!a:y.byName&&a,o.types[c]=y}}else h&&(o.altPaths[c]=p)}}function p(t,e,r,n){var i=t.getType();i&&a(i,e,r,n,!0)}function s(t,e){var r=t.proto.hasCtor.path;r?t.nameOverride="+"+r:r=t.path;for(var n in t.props)a(t.props[n],r,n,e)}function h(t,e){for(var r,n=e.output,o=e.output["!define"],a=0;a<t.length;++a){var p=t[a];r=r?r+"."+p:p;var s=e.types[r];"!"==p.charAt(0)||s&&s.byName?i(o,r)?n=o[r]:o[r]=n={}:n=i(n,t[a])?n[p]:n[p]={}}return n}function u(t,e,r){var n=f(e.type);if(n!=e.type.path&&"?"!=n)t["!type"]=n;else if(e.type.proto&&e.type.proto!=r.cx.protos.Object){var i=f(e.type.proto);"?"!=i&&(t["!proto"]=i)}e.span&&(t["!span"]=e.span),e.doc&&(t["!doc"]=e.doc),e.data&&(t["!data"]=e.data)}function c(t,r,n){var o=t.split("."),a=o.pop();if("!"!=a[0]){var p=n.types[o.join(".")],s=h(o,n);p&&p.type.constructor!=e.Obj||i(s,a)||(s[a]=r.nameOverride||r.path)}}function f(t){var r=t instanceof e.Type;if(r){if(v.indexOf(t)>-1)return t.path||"?";v.push(t)}var n=t.typeName();return r&&v.pop(),n}function l(t,e){if("object"!=typeof t)return t;var r=!1,n=!1;for(var i in t)"!type"==i?r=!0:n=!0,"!data"!=i&&(t[i]=l(t[i],e));return r&&!n?t["!type"]:e?y(t):t}function y(t){var e=[],r={};for(var n in t)e.push(n);e.sort();for(var i=0;i<e.length;++i){var n=e[i];r[n]=t[n]}return r}t.condense=function(t,e,n){"string"==typeof t&&(t=[t]);var i=new r(t,e||t[0],n||{});i.server.signal("preCondenseReach",i),i.cx.topScope.path="<top>",i.cx.topScope.reached("",i);for(var o in i.roots)a(i.roots[o],null,o,i);for(var p=0;p<i.patchUp.length;++p)s(i.patchUp[p],i);i.server.signal("postCondenseReach",i);for(var o in i.types)u(h(o.split("."),i),i.types[o],i);for(var o in i.altPaths)c(o,i.altPaths[o],i);var f=!1;for(var y in i.output["!define"]){f=!0;break}return f||delete i.output["!define"],i.server.signal("postCondense",i),l(i.output,i.options.sortOutput)},r.prototype.isTarget=function(t){return this.origins.indexOf(t)>-1},r.prototype.getSpan=function(t){if(0==this.options.spans||!this.isTarget(t.origin))return null;if(t.span)return t.span;var e,r=this.cx.parent;if(!r||!t.originNode||!(e=r.findFile(t.origin)))return null;var n=t.originNode.start,i=t.originNode.end,o=e.asLineChar(n),a=e.asLineChar(i);return n+"["+o.line+":"+o.ch+"]-"+i+"["+a.line+":"+a.ch+"]"},e.Prim.prototype.reached=function(){return!0},e.Arr.prototype.reached=function(t,e,r){if(r)return!0;if(this.tuple)for(var n=0;n<this.tuple;n++)p(this.getProp(String(n)),t,String(n),e);else p(this.getProp("<i>"),t,"<i>",e);return!0},e.Fn.prototype.reached=function(t,r,n){if(e.Obj.prototype.reached.call(this,t,r,n),!n){for(var i=0;i<this.args.length;++i)p(this.args[i],t,"!"+i,r);p(this.retval,t,"!ret",r)}return!0},e.Obj.prototype.reached=function(t,r,n){if(o(this)&&!this.condenseForceInclude)return r.patchUp.indexOf(this)==-1&&r.patchUp.push(this),!0;this.proto&&!n&&a(this.proto,t,"!proto",r);var i=!1;for(var p in this.props)a(this.props[p],t,p,r),i=!0;return!!(i||this.condenseForceInclude||this instanceof e.Fn)||(this.nameOverride="?",!1)};var v=[];e.AVal.prototype.typeName=function(){if(0==this.types.length)return"?";if(1==this.types.length)return f(this.types[0]);var t=e.simplifyTypes(this.types);if(t.length>2)return"?";for(var r=[],n=0;n<t.length;n++)r.push(f(t[n]));return r.join("|")},e.ANull.typeName=function(){return"?"},e.Prim.prototype.typeName=function(){return this.name},e.Sym.prototype.typeName=function(){return this.asPropName},e.Arr.prototype.typeName=function(){if(!this.tuple)return"["+f(this.getProp("<i>"))+"]";for(var t=[],e=0;e<this.tuple;e++)t.push(f(this.getProp(String(e))));return"["+t.join(", ")+"]"},e.Fn.prototype.typeName=function(){for(var t=this.generator?"fn*(":"fn(",e=0;e<this.args.length;++e){e&&(t+=", ");var r=this.argNames[e];r&&"?"!=r&&(t+=r+": "),t+=f(this.args[e])}return t+=")",this.computeRetSource?t+=" -> "+this.computeRetSource:this.retval.isEmpty()||(t+=" -> "+f(this.retval)),t},e.Obj.prototype.typeName=function(){return this.nameOverride?this.nameOverride:this.path?this.path:"?"}});
//# sourceMappingURL=condense.min.js.map