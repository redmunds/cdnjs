!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn"),require("acorn/dist/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/dist/acorn","acorn/dist/walk"],e):void e(tern,tern,tern.comment,acorn,acorn.walk)}(function(e,r,t,n,a){"use strict";function o(e,r){function n(e){t.ensureCommentsBefore(r,e)}a.simple(e,{VariableDeclaration:n,FunctionDeclaration:n,MethodDefinition:n,Property:n,AssignmentExpression:function(e){"="==e.operator&&n(e)},CallExpression:function(e){i(e)&&n(e)},ExportNamedDeclaration:n,ExportDefaultDeclaration:n,ClassDeclaration:n})}function i(e){return"MemberExpression"==e.callee.type&&"Object"==e.callee.object.name&&"defineProperty"==e.callee.property.name&&e.arguments.length>=3&&"string"==typeof e.arguments[1].value}function c(r,t){A(r.sourceFile.text,t),a.simple(r,{VariableDeclaration:function(e,r){var t=e.declarations[0].id;e.commentsBefore&&"Identifier"==t.type&&f(e,e.commentsBefore,r,r.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.scope.fnType)},ClassDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.objType)},AssignmentExpression:function(r,t){r.commentsBefore&&f(r,r.commentsBefore,t,e.expressionType({node:r.left,state:t}))},ObjectExpression:function(r,t){for(var n=0;n<r.properties.length;++n){var a=r.properties[n],o=e.propName(a);"<i>"!=o&&a.commentsBefore&&f(a,a.commentsBefore,t,r.objType.getProp(o))}},Class:function(r,t){var n=r.objType.getProp("prototype").getObjType();if(n)for(var a=0;a<r.body.body.length;a++){var o,i=r.body.body[a];i.commentsBefore&&("constructor"==i.kind?f(i,i.commentsBefore,t,r.objType):"<i>"!=(o=e.propName(i))&&f(i,i.commentsBefore,t,n.getProp(o)))}},CallExpression:function(r,t){if(r.commentsBefore&&i(r)){var n=e.expressionType({node:r.arguments[0],state:t}).getObjType();if(n&&n instanceof e.Obj){var a=n.props[r.arguments[1].value];a&&f(r,r.commentsBefore,t,a)}}},ExportNamedDeclaration:function(e,r){e.commentsBefore&&e.declaration&&"FunctionDeclaration"===e.declaration.type&&f(e.declaration,e.commentsBefore,r,r.getProp(e.declaration.id.name),e.declaration.scope.fnType)},ExportDefaultDeclaration:function(e,r){e.commentsBefore&&e.declaration&&"FunctionDeclaration"===e.declaration.type&&f(e.declaration,e.commentsBefore,r,r.getProp(e.declaration.id.name),e.declaration.scope.fnType)}},e.searchVisitor,t)}function l(r){var t=r["!typedef"],n=e.cx(),a=r["!name"];if(t)for(var o in t)n.parent.mod.jsdocTypedefs[o]=h(e.def.parse(t[o],a,o),o)}function s(e){for(var r,t=1;t<e.length;t++){var n=e[t],a=n.match(/^[\s\*]*/)[0];if(a!=n)if(null==r)r=a;else{for(var o=0;o<r.length&&r.charCodeAt(o)==a.charCodeAt(o);)++o;o<r.length&&(r=r.slice(0,o))}}for(e=e.map(function(e,t){if(e=e.replace(/\s+$/,""),0==t&&null!=r)for(var n=0;n<r.length;n++){var a=e.indexOf(r.slice(n));if(0==a)return e.slice(r.length-n)}return null==r||0==t?e.replace(/^[\s\*]*/,""):e.length<r.length?"":e.slice(r.length)});e.length&&!e[e.length-1];)e.pop();for(;e.length&&!e[0];)e.shift();return e}function f(r,t,n,a,o){b(r,n,a,t);var i=e.cx();!o&&a instanceof e.AVal&&a.types.length&&(o=a.types[a.types.length-1],o instanceof e.Obj&&o.origin==i.curOrigin&&!o.doc||(o=null));for(var c=t.length-1;c>=0;c--){var l=s(t[c].split(/\r\n?|\n/)).join("\n");if(l){a instanceof e.AVal&&(a.doc=l),o&&(o.doc=l);break}}}function p(e,r){for(;/\s/.test(e.charAt(r));)++r;return r}function u(e){if(!n.isIdentifierStart(e.charCodeAt(0)))return!1;for(var r=1;r<e.length;r++)if(!n.isIdentifierChar(e.charCodeAt(r)))return!1;return!0}function d(e,r,t,n){for(var a=[],o=[],i=!1,c=!0;t=p(r,t),!c||r.charAt(t)!=n;c=!1){var l=r.indexOf(":",t);if(l<0)return null;var s=r.slice(t,l);if(!u(s))return null;a.push(s),t=l+1;var f=y(e,r,t);if(!f)return null;t=f.end,i=i||f.madeUp,o.push(f.type),t=p(r,t);var d=r.charAt(t);if(++t,d==n)break;if(","!=d)return null}return{labels:a,types:o,end:t,madeUp:i}}function m(r,t,n){var a=g(r,t,n);return a?"[]"==t.slice(a.end,a.end+2)?{madeUp:a.madeUp,end:a.end+2,type:new e.Arr(a.type)}:a:null}function y(r,t,n){for(var a,o=!1,i=!1;;){var c=m(r,t,n);if(!c)return null;if(i=i||c.madeUp,o?c.type.propagate(o):a=c.type,n=p(t,c.end),"|"!=t.charAt(n))break;n++,o||(o=new e.AVal,a.propagate(o),a=o)}var l=!1;return"="==t.charAt(n)&&(++n,l=!0),{type:a,end:n,isOptional:l,madeUp:i}}function g(r,t,a){a=p(t,a),/[?!]/.test(t.charAt(a))&&a++;var o,i=!1;if(t.indexOf("function(",a)==a){var c=d(r,t,a+9,")"),l=e.ANull;if(!c)return null;if(a=p(t,c.end),":"==t.charAt(a)){++a;var s=y(r,t,a+1);if(!s)return null;a=s.end,l=s.type,i=s.madeUp}o=new e.Fn(null,e.ANull,c.types,c.labels,l)}else if("["==t.charAt(a)){var f=y(r,t,a+1);if(!f)return null;if(a=p(t,f.end),i=f.madeUp,"]"!=t.charAt(a))return null;++a,o=new e.Arr(f.type)}else if("{"==t.charAt(a)){var u=d(r,t,a+1,"}");if(!u)return null;o=new e.Obj(!0);for(var m=0;m<u.types.length;++m){var g=o.defProp(u.labels[m]);g.initializer=!0,u.types[m].propagate(g)}a=u.end,i=u.madeUp}else if("("==t.charAt(a)){var f=y(r,t,a+1);if(!f)return null;if(a=p(t,f.end),")"!=t.charAt(a))return null;++a,o=f.type}else{var v=a;if(!n.isIdentifierStart(t.charCodeAt(a)))return null;for(;n.isIdentifierChar(t.charCodeAt(a));)++a;if(v==a)return null;var b=t.slice(v,a);if(/^(number|integer)$/i.test(b))o=e.cx().num;else if(/^bool(ean)?$/i.test(b))o=e.cx().bool;else if(/^string$/i.test(b))o=e.cx().str;else if(/^(null|undefined)$/i.test(b))o=e.ANull;else if(/^array$/i.test(b)){var f=null;if("."==t.charAt(a)&&"<"==t.charAt(a+1)){var A=y(r,t,a+2);if(!A)return null;if(a=p(t,A.end),i=A.madeUp,">"!=t.charAt(a++))return null;f=A.type}o=new e.Arr(f)}else if(/^object$/i.test(b)){if(o=new e.Obj(!0),"."==t.charAt(a)&&"<"==t.charAt(a+1)){var j=y(r,t,a+2);if(!j)return null;if(a=p(t,j.end),i=i||j.madeUp,","!=t.charAt(a++))return null;var x=y(r,t,a);if(!x)return null;if(a=p(t,x.end),i=j.madeUp||x.madeUp,">"!=t.charAt(a++))return null;x.type.propagate(o.defProp("<i>"))}}else{for(;46==t.charCodeAt(a)||n.isIdentifierChar(t.charCodeAt(a));)++a;var P,O=t.slice(v,a),T=e.cx(),C=T.parent&&T.parent.mod.jsdocTypedefs;C&&O in C?o=C[O]:(P=e.def.parsePath(O,r).getObjType())?o=h(P,O):(T.jsdocPlaceholders||(T.jsdocPlaceholders=Object.create(null)),o=O in T.jsdocPlaceholders?T.jsdocPlaceholders[O]:T.jsdocPlaceholders[O]=new e.Obj(null,O),i=!0)}}return{type:o,end:a,madeUp:i}}function h(r,t){if(r instanceof e.Fn&&/(?:^|\.)[A-Z][^\.]*$/.test(t)){var n=r.getProp("prototype").getObjType();if(n instanceof e.Obj)return e.getInstance(n)}return r}function v(e,r,t){if(t=p(r,t||0),"{"!=r.charAt(t))return null;var n=y(e,r,t+1);if(!n)return null;var a=p(r,n.end);return"}"!=r.charAt(a)?null:(n.end=a+1,n)}function b(r,t,n,a){for(var o,i,c,l,s,f,p=0;p<a.length;++p)for(var u,d=a[p],m=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?|this|class|constructor)\s+(.*)/g;u=m.exec(d);)if("class"!=u[1]&&"constructor"!=u[1]){if("this"==u[1]&&(f=y(t,u[2],0)))s=f,l=!0;else if(f=v(t,u[2]))switch(l=!0,u[1]){case"returns":case"return":c=f;break;case"type":o=f;break;case"param":case"arg":case"argument":var g=u[2].slice(f.end).match(/^\s*(\[?)\s*([^\[\]\s=]+(\[\][^\[\]\s=]+)?)\s*(?:=[^\]]+\s*)?(\]?).*/);if(!g)continue;var h=g[2]+(f.isOptional||"["===g[1]&&"]"===g[4]?"?":""),b=!1,A=h.split(".");if(i&&2==A.length){var j=A[0];h=A[1];var x,O;for(x in i)O=i[x],x===j&&O.type instanceof e.Obj?(b=!0,f.type.propagate(O.type.defProp(h))):x+"[]"===j&&O.type instanceof e.Arr&&(b=!0,f.type.propagate(O.type.getProp("<i>").getType().defProp(h)))}b||((i||(i=Object.create(null)))[h]=f)}}else s=l=!0;l&&P(o,s,i,c,r,n)}function A(r,t){for(var n,a=e.cx(),o=/\s@typedef\s+(.*)/g;n=o.exec(r);){var i=v(t,n[1]),c=i&&n[1].slice(i.end).match(/^\s*(\S+)/);if(c&&i.type instanceof e.Obj){for(var l=r.slice(n.index+n[0].length);n=/\s+@prop(?:erty)?\s+(.*)/.exec(l);){var s,f=v(t,n[1]);f&&(s=n[1].slice(f.end).match(/^\s*(\S+)/))&&f.type.propagate(i.type.defProp(s[1])),l=l.slice(n[0].length)}a.parent.mod.jsdocTypedefs[c[1]]=i.type}}}function j(r,t){var n=e.cx().parent.mod.docComment.weight;r.type.propagate(t,n||(r.madeUp?O:void 0))}function x(e){return"FunctionExpression"==e.type||"ArrowFunctionExpression"==e.type}function P(r,t,n,a,o,i){var c;if("VariableDeclaration"==o.type){var l=o.declarations[0];l.init&&x(l.init)&&(c=l.init.scope.fnType)}else"FunctionDeclaration"==o.type?c=o.scope.fnType:"AssignmentExpression"==o.type?x(o.right)&&(c=o.right.scope.fnType):"CallExpression"==o.type||"ClassDeclaration"===o.type||x(o.value)&&(c=o.value.scope.fnType);if(c&&(n||a||t)){if(n)for(var s=0;s<c.argNames.length;++s){var f=c.argNames[s],p=n[f];!p&&(p=n[f+"?"])&&(c.argNames[s]+="?"),p&&j(p,c.args[s])}if(a&&(c.retval==e.ANull&&(c.retval=new e.AVal),j(a,c.retval)),t===!0){var u=c.getProp("prototype").getObjType();t=u&&{type:e.getInstance(u,c)}}t&&j(t,c.self)}else r&&j(r,i)}var O=1,T=101;r.registerPlugin("doc_comment",function(e,r){e.mod.jsdocTypedefs=Object.create(null),e.on("reset",function(){e.mod.jsdocTypedefs=Object.create(null)}),e.mod.docComment={weight:r&&r.strong?T:void 0,fullDocs:r&&r.fullDocs},e.on("postParse",o),e.on("postInfer",c),e.on("postLoadDef",l)})});
//# sourceMappingURL=doc_comment.min.js.map