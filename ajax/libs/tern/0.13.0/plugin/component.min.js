!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern"],e):void e(tern,tern)}(function(e,t,o){"use strict";function n(e,t){var o,n=e.lastIndexOf("/");for(n>=0&&(t=e.slice(0,n+1)+t);o=/[^\/]*[^\/\.][^\/]*\/\.\.\//.exec(t);)t=t.slice(0,o.index)+t.slice(o.index+o[0].length);return t.replace(/(^|[^\.])\.\//g,"$1")}function r(e,t){return e.addFile(t,null,e._component.currentName),i(e._component,t)}function i(t,o){return t.modules[o]||(t.modules[o]=new e.AVal)}function s(t){var o=t.getProp("module").getType(),n=o&&o.getProp("exports");return n instanceof e.AVal&&!n.isEmpty()?n.types[n.types.length-1]:t.getProp("exports")}function l(t,o,n){var r=new e.Scope(t),i=e.cx();r.originNode=n,i.definitions.component.require.propagate(r.defProp("require"));var s=i.definitions.component.Module.getProp("prototype").getType(),l=new e.Obj(s);l.propagate(r.defProp("module"));var a=new e.Obj(!0,"exports",o);return a.propagate(r.defProp("exports")),a.propagate(l.defProp("exports")),r}o&&function(){var t=o("fs"),n=o("path"),i=/win/.test(process.platform),s=n.resolve;i&&(s=function(e,t){return n.resolve(e,t).replace(/\\/g,"/")}),r=function(o,n,r){var i=o._component,l=o.options.projectDir||"",a=n;if(1==i.options.dontLoad)return e.ANull;if(i.options.dontLoad&&new RegExp(i.options.dontLoad).test(n))return e.ANull;if(i.options.load&&!new RegExp(i.options.load).test(n))return e.ANull;if(!r)try{var u=JSON.parse(t.readFileSync(s(l,"component.json")));if(!u.dependencies)return e.ANull;var p=new RegExp("(.*?)/"+n,"i"),c=Object.keys(u.dependencies).filter(function(e){return p.test(e)}).pop(),d=c.match(/(.*?)\/.*?/i).shift();d=d.substring(0,d.length-1),a=s(l,"components/"+d+"-"+n)}catch(e){}try{var m=JSON.parse(t.readFileSync(s(l,a+"/component.json")))}catch(e){}if(m&&m.main)a+="/"+m.main;else try{t.statSync(s(l,a)).isDirectory()&&(a+="/index.js")}catch(e){}/\.js$/.test(a)||(a+=".js");try{if(!t.statSync(s(l,a)).isFile())return e.ANull}catch(t){return e.ANull}return o.addFile(a,null,i.currentName),i.modules[a]=i.modules[n]=new e.AVal}}(),t.registerPlugin("component",function(e,t){return e._component={modules:Object.create(null),options:t||{},currentFile:null,currentName:null,server:e},e.on("beforeLoad",function(e){this._component.currentFile=e.name.replace(/\\/g,"/"),this._component.currentName=e.name,e.scope=l(e.scope,e.name,e.ast)}),e.on("afterLoad",function(e){this._component.currentFile=this._component.currentName=null,s(e.scope).propagate(i(this._component,e.name))}),e.on("reset",function(){this._component.modules=Object.create(null)}),{defs:a}}),e.registerFunction("componentRequire",function(t,o,i){if(!i||!i.length||"Literal"!=i[0].type||"string"!=typeof i[0].value)return e.ANull;var a=e.cx(),u=a.parent,p=u._component,c=i[0].value,d=a.definitions.component;if(d[c]&&/^[a-z_]*$/.test(c))return d[c];var m=/^\.{0,2}\//.test(c);if(m){if(!p.currentFile)return i[0].required||e.ANull;c=n(p.currentFile,c)}if(c in p.modules)return p.modules[c];var f;if(p.options.modules&&p.options.modules.hasOwnProperty(c)){var h=l(a.topScope,c);e.def.load(p.options.modules[c],h),f=p.modules[c]=s(h)}else f=r(u,c,m);return i[0].required=f});var a={"!name":"component","!define":{require:{"!type":"fn(id: string) -> !custom:componentRequire","!doc":"Require the given path/module",modules:{"!doc":"Registered modules"},aliases:{"!doc":"Registered aliases"},resolve:{"!type":"fn(path: string) -> string","!doc":"Resolve path"},normalize:{"!type":"fn(curr: string, path: string) -> string","!doc":"Normalize `path` relative to the current path"},register:{"!type":"fn(path: string, definition: fn())","!doc":"Register module at `path` with callback `definition`"},alias:{"!type":"fn(from: string, to: string)","!doc":"Alias a module definition"},relative:{"!type":"fn(parent: string) -> fn()","!doc":"Return a require function relative to the `parent` path"}},Module:{"!type":"fn()",prototype:{exports:{"!type":"?","!doc":"The exports object is created by the Module system. Sometimes this is not acceptable, many want their module to be an instance of some class. To do this assign the desired export object to module.exports. For example suppose we were making a module called a.js"},require:{"!type":"require","!doc":"The module.require method provides a way to load a module as if require() was called from the original module."},id:{"!type":"string","!doc":"The identifier for the module. Typically this is the fully resolved filename."},filename:{"!type":"string","!doc":"The fully resolved filename to the module."},loaded:{"!type":"bool","!doc":"Whether or not the module is done loading, or is in the process of loading."},parent:{"!type":"+Module","!doc":"The module that required this one."},children:{"!type":"[+Module]","!doc":"The module objects required by this one."}}}}}});
//# sourceMappingURL=component.min.js.map