!function(t){return"object"==typeof exports&&"object"==typeof module?t(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],t):void t(self.tern||(self.tern={}),tern)}(function(t,r){"use strict";function e(t){for(var r,e=1,i=0;(r=t.indexOf(".",i))!=-1;)i=r+1,e+="!"==t.charAt(i)?10:1;return e}function i(t,r){return t.sources.indexOf(r)>-1}function o(t,r,o,n){var s=t.getType(!1);if(s){var a=t.origin||s&&s.origin;if(a){var p=o.cx.origins.indexOf(a);if(p<n||r&&p>o.maxOrigin)return;n<o.minOrigin&&i(o,a)&&r.indexOf("!")<0&&o.addedToForeign.indexOf(r)<0&&o.addedToForeign.push(s,r),n=p}s.path&&e(s.path)<=e(r)||s.setPath(r,o,n)}}function n(t,r){var e=t.getType(!1);if(!e)return"?";var i=e.path&&r.paths[e.path];if(i)return e.path;if(r.seen.indexOf(t)>-1)return t.path||"?";r.seen.push(t);var o=e.getDesc(r);return r.seen.pop(),o}function s(t,e,i){var o,n;if(0!=i.options.spans)if(t.span)e["!span"]=t.span;else if(t.originNode){var o=r.cx().parent,n=o&&o.findFile(t.origin);if(!n)return null;var s=n.asLineChar(t.originNode.start),a=n.asLineChar(t.originNode.end);e["!span"]=t.originNode.start+"["+s.line+":"+s.ch+"]-"+t.originNode.end+"["+a.line+":"+a.ch+"]"}}function a(t){if(t.doc||t.originNode)return!0;for(var r in t.props)return!0}function p(t,r,e){for(var o in t.props){var s=t.props[o];i(e,s.origin)&&(r[o]=n(s,e))}}function h(t,r){if(t._fromProto)return!0;if(t.proto&&t.proto!=r.cx.protos.Object&&t.proto.hasCtor&&!t.hasCtor&&t.proto.hasCtor.path){n(t.proto,r),t._fromProto=!0;var e=r.paths[t.proto.path];return e&&(p(t,e.structure,r),e.mayCull=!1),!0}}function f(t,r,e){if("string"==typeof t){var i;return t==e&&(i=r.paths[t])?i.mayCull?"?":(i.inlined=!0,f(i.structure,r,e)):t}for(var o in t)/^!(?:define|name|proto|doc|span|url)$/.test(o)||(t[o]=f(t[o],r,null==e?null:e?e+"."+o:o));return t}r.Prim.prototype.setPath=function(){},r.Arr.prototype.setPath=function(t,r,e){this.path=t,o(this.getProp("<i>"),t+".<i>",r,e)},r.Fn.prototype.setPath=function(t,e,i){r.Obj.prototype.setPath.call(this,t,e,i);for(var n=0;n<this.args.length;++n)o(this.args[n],t+".!"+n,e,i);o(this.retval,t+".!ret",e,i)},r.Obj.prototype.setPath=function(t,r,e){this.path=t||"<top>";var i=t?t+".":"";for(var n in this.props)o(this.props[n],i+n,r,e);this.proto&&o(this.proto,i+"!proto",r,e)},r.Prim.prototype.getDesc=function(){return this.name},r.Arr.prototype.getDesc=function(t){return"["+n(this.getProp("<i>"),t)+"]"},r.Fn.prototype.getDesc=function(t){if(this.path&&!i(t,this.origin))return this.path;for(var r="fn(",e=0;e<this.args.length;++e){e&&(r+=", ");var o=this.argNames[e];o&&"?"!=o&&(r+=o+": "),r+=n(this.args[e],t)}if(r+=")",this.computeRetSource)r+=" -> "+this.computeRetSource;else if(!this.retval.isEmpty()){var h=this.retval.getType();h&&(r+=" -> "+n(h,t))}if(!a(this))return r;var f={"!type":r};return this.doc&&(f["!doc"]=this.doc),s(this,f,t),t.paths[this.path]={structure:f},p(this,f,t),this.path},r.Obj.prototype.getDesc=function(t){if(h(this,t))return"+"+this.proto.hasCtor.path;if(!i(t,this.origin))return this.path;var r,e={},o=t.paths[this.path]={structure:e};return this.proto&&this.proto!=t.cx.protos.Object&&(r=n(this.proto,t),"?"==r&&(r=null)),null!=o.mayCull||r||a(this)||(o.mayCull=!0),r&&(e["!proto"]=r),this.doc&&(e["!doc"]=this.doc),s(this,e,t),p(this,e,t),this.path},t.condense=function(t,e,s){s||(s={}),"string"==typeof t&&(t=[t]),e||(e=t[0]);for(var a=r.cx(),p={},u=1/0,c=-(1/0),l=0;l<t.length;++l){var d=a.origins.indexOf(t[l]);d<0||(u=Math.min(d,u),c=Math.max(d,c))}var g={"!name":e,"!define":p},v={sources:t,paths:Object.create(null),cx:a,minOrigin:u,maxOrigin:c,addedToForeign:[],seen:[],options:s};o(a.topScope,"",v,0);for(var y in a.topScope.props){var m=a.topScope.props[y];if(i(v,m.origin)){var x=m.getType(!1);x&&i(v,x.origin)&&(g[y]=n(x,v))}}if(v.addedToForeign.length>0){var O=v.addedToForeign;v.addedToForeign=[];for(var l=0;l<O.length;l+=2){var P=O[l],C=O[l+1].split("."),j=r.def.parsePath(C.slice(0,C.length-1).join("."));h(j,v)&&(C=j.proto.path.split(".").concat(C[C.length-1]));var T=n(P,v);if("?"!=T&&!C.some(function(t){return"!"==t.charAt(0)})){for(var b=0,F=g;b<C.length-1;++b){var N=C[b];F=Object.prototype.hasOwnProperty.call(F,N)?F[N]:F[N]={}}F[C[C.length-1]]=T}}}f(g,v,"");var D=[];for(var S in v.paths){var A=v.paths[S];A.inlined||A.mayCull||D.push(S,f(A.structure,v,null))}if(D.length)for(var l=D.length-2;l>=0;l-=2)p[D[l]]=D[l+1];else delete g["!define"];return g}});
//# sourceMappingURL=condense.min.js.map