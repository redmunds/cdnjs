!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn/acorn"),require("acorn/util/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/acorn","acorn/util/walk"],e):void e(tern,tern,tern.comment,acorn,acorn.walk)}(function(e,r,n,t,a){"use strict";function i(e,r){function t(e){n.ensureCommentsBefore(r,e)}a.simple(e,{VariableDeclaration:t,FunctionDeclaration:t,AssignmentExpression:function(e){"="==e.operator&&t(e)},ObjectExpression:function(e){for(var r=0;r<e.properties.length;++r)t(e.properties[r])},CallExpression:function(e){o(e)&&t(e)}})}function o(e){return"MemberExpression"==e.callee.type&&"Object"==e.callee.object.name&&"defineProperty"==e.callee.property.name&&e.arguments.length>=3&&"string"==typeof e.arguments[1].value}function s(r,n){g(r.sourceFile.text,n),a.simple(r,{VariableDeclaration:function(e,r){e.commentsBefore&&l(e,e.commentsBefore,r,r.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,r){e.commentsBefore&&l(e,e.commentsBefore,r,r.getProp(e.id.name),e.body.scope.fnType)},AssignmentExpression:function(r,n){r.commentsBefore&&l(r,r.commentsBefore,n,e.expressionType({node:r.left,state:n}))},ObjectExpression:function(e,r){for(var n=0;n<e.properties.length;++n){var t=e.properties[n];t.commentsBefore&&l(t,t.commentsBefore,r,e.objType.getProp(t.key.name))}},CallExpression:function(r,n){if(r.commentsBefore&&o(r)){var t=e.expressionType({node:r.arguments[0],state:n}).getObjType();if(t&&t instanceof e.Obj){var a=t.props[r.arguments[1].value];a&&l(r,r.commentsBefore,n,a)}}}},e.searchVisitor,n)}function c(r){var n=r["!typedef"],t=e.cx(),a=r["!name"];if(n)for(var i in n)t.parent.jsdocTypedefs[i]=y(e.def.parse(n[i],a,i),i)}function l(r,n,t,a,i){v(r,t,a,n);var o=e.cx();!i&&a instanceof e.AVal&&a.types.length&&(i=a.types[a.types.length-1],i instanceof e.Obj&&i.origin==o.curOrigin&&!i.doc||(i=null));var s=n[n.length-1];if(o.parent._docComment.fullDocs)s=s.trim().replace(/\n[ \t]*\* ?/g,"\n");else{var c=s.search(/\.\s/);c>5&&(s=s.slice(0,c+1)),s=s.trim().replace(/\s*\n\s*\*\s*|\s{1,}/g," ")}s=s.replace(/^\s*\*+\s*/,""),a instanceof e.AVal&&(a.doc=s),i&&(i.doc=s)}function f(e,r){for(;/\s/.test(e.charAt(r));)++r;return r}function u(e){if(!t.isIdentifierStart(e.charCodeAt(0)))return!1;for(var r=1;r<e.length;r++)if(!t.isIdentifierChar(e.charCodeAt(r)))return!1;return!0}function p(e,r,n,t){for(var a=[],i=[],o=!1,s=!0;n=f(r,n),!s||r.charAt(n)!=t;s=!1){var c=r.indexOf(":",n);if(c<0)return null;var l=r.slice(n,c);if(!u(l))return null;a.push(l),n=c+1;var p=d(e,r,n);if(!p)return null;n=p.end,o=o||p.madeUp,i.push(p.type),n=f(r,n);var m=r.charAt(n);if(++n,m==t)break;if(","!=m)return null}return{labels:a,types:i,end:n,madeUp:o}}function d(r,n,t){for(var a,i=!1,o=!1;;){var s=m(r,n,t);if(!s)return null;if(o=o||s.madeUp,i?s.type.propagate(i):a=s.type,t=f(n,s.end),"|"!=n.charAt(t))break;t++,i||(i=new e.AVal,a.propagate(i),a=i)}var c=!1;return"="==n.charAt(t)&&(++t,c=!0),{type:a,end:t,isOptional:c,madeUp:o}}function m(r,n,a){a=f(n,a);var i,o=!1;if(n.indexOf("function(",a)==a){var s=p(r,n,a+9,")"),c=e.ANull;if(!s)return null;if(a=f(n,s.end),":"==n.charAt(a)){++a;var l=d(r,n,a+1);if(!l)return null;a=l.end,c=l.type,o=l.madeUp}i=new e.Fn(null,e.ANull,s.types,s.labels,c)}else if("["==n.charAt(a)){var u=d(r,n,a+1);if(!u)return null;if(a=f(n,u.end),o=u.madeUp,"]"!=n.charAt(a))return null;++a,i=new e.Arr(u.type)}else if("{"==n.charAt(a)){var m=p(r,n,a+1,"}");if(!m)return null;i=new e.Obj(!0);for(var h=0;h<m.types.length;++h){var v=i.defProp(m.labels[h]);v.initializer=!0,m.types[h].propagate(v)}a=m.end,o=m.madeUp}else if("("==n.charAt(a)){var u=d(r,n,a+1);if(!u)return null;if(a=f(n,u.end),")"!=n.charAt(a))return null;++a,i=u.type}else{var g=a;if(!t.isIdentifierStart(n.charCodeAt(a)))return null;for(;t.isIdentifierChar(n.charCodeAt(a));)++a;if(g==a)return null;var b=n.slice(g,a);if(/^(number|integer)$/i.test(b))i=e.cx().num;else if(/^bool(ean)?$/i.test(b))i=e.cx().bool;else if(/^string$/i.test(b))i=e.cx().str;else if(/^(null|undefined)$/i.test(b))i=e.ANull;else if(/^array$/i.test(b)){var u=null;if("."==n.charAt(a)&&"<"==n.charAt(a+1)){var A=d(r,n,a+2);if(!A)return null;if(a=f(n,A.end),o=A.madeUp,">"!=n.charAt(a++))return null;u=A.type}i=new e.Arr(u)}else if(/^object$/i.test(b)){if(i=new e.Obj(!0),"."==n.charAt(a)&&"<"==n.charAt(a+1)){var j=d(r,n,a+2);if(!j)return null;if(a=f(n,j.end),o=o||j.madeUp,","!=n.charAt(a++))return null;var x=d(r,n,a);if(!x)return null;if(a=f(n,x.end),o=j.madeUp||x.madeUp,">"!=n.charAt(a++))return null;x.type.propagate(i.defProp("<i>"))}}else{for(;46==n.charCodeAt(a)||t.isIdentifierChar(n.charCodeAt(a));)++a;var O,C=n.slice(g,a),T=e.cx(),P=T.parent&&T.parent.jsdocTypedefs;P&&C in P?i=P[C]:(O=e.def.parsePath(C,r).getObjType())?i=y(O,C):(T.jsdocPlaceholders||(T.jsdocPlaceholders=Object.create(null)),i=C in T.jsdocPlaceholders?T.jsdocPlaceholders[C]:T.jsdocPlaceholders[C]=new e.Obj(null,C),o=!0)}}return{type:i,end:a,madeUp:o}}function y(r,n){if(r instanceof e.Fn&&/^[A-Z]/.test(n)){var t=r.getProp("prototype").getObjType();if(t instanceof e.Obj)return e.getInstance(t)}return r}function h(e,r,n){if(n=f(r,n||0),"{"!=r.charAt(n))return null;var t=d(e,r,n+1);if(!t)return null;var a=f(r,t.end);return"}"!=r.charAt(a)?null:(t.end=a+1,t)}function v(e,r,n,t){for(var a,i,o,s,c,l,f=0;f<t.length;++f)for(var u,p=t[f],m=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?|this)\s+(.*)/g;u=m.exec(p);)if("this"==u[1]&&(l=d(r,u[2],0)))c=l,s=!0;else if(l=h(r,u[2]))switch(s=!0,u[1]){case"returns":case"return":o=l;break;case"type":a=l;break;case"param":case"arg":case"argument":var y=u[2].slice(l.end).match(/^\s*(\[?)\s*([^\]\s]+)\s*(\]?).*/);if(!y)continue;var v=y[2]+(l.isOptional||"["===y[1]&&"]"===y[3]?"?":"");(i||(i=Object.create(null)))[v]=l}s&&A(a,c,i,o,e,n)}function g(r,n){for(var t,a=e.cx(),i=/\s@typedef\s+(.*)/g;t=i.exec(r);){var o=h(n,t[1]),s=o&&t[1].slice(o.end).match(/^\s*(\S+)/);s&&(a.parent.jsdocTypedefs[s[1]]=o.type)}}function b(r,n){var t=e.cx().parent._docComment.weight;r.type.propagate(n,t||(r.madeUp?j:void 0))}function A(e,r,n,t,a,i){var o;if("VariableDeclaration"==a.type){var s=a.declarations[0];s.init&&"FunctionExpression"==s.init.type&&(o=s.init.body.scope.fnType)}else"FunctionDeclaration"==a.type?o=a.body.scope.fnType:"AssignmentExpression"==a.type?"FunctionExpression"==a.right.type&&(o=a.right.body.scope.fnType):"CallExpression"==a.type||"FunctionExpression"==a.value.type&&(o=a.value.body.scope.fnType);if(o&&(n||t||r)){if(n)for(var c=0;c<o.argNames.length;++c){var l=o.argNames[c],f=n[l];!f&&(f=n[l+"?"])&&(o.argNames[c]+="?"),f&&b(f,o.args[c])}t&&b(t,o.retval),r&&b(r,o.self)}else e&&b(e,i)}var j=1,x=101;r.registerPlugin("doc_comment",function(e,r){return e.jsdocTypedefs=Object.create(null),e.on("reset",function(){e.jsdocTypedefs=Object.create(null)}),e._docComment={weight:r&&r.strong?x:void 0,fullDocs:r&&r.fullDocs},{passes:{postParse:i,postInfer:s,postLoadDef:c}}})});
//# sourceMappingURL=doc_comment.min.js.map