!function(t,e){return"object"==typeof exports&&"object"==typeof module?e(exports,require("acorn/acorn"),require("acorn/acorn_loose"),require("acorn/util/walk"),require("./def"),require("./signal")):"function"==typeof define&&define.amd?define(["exports","acorn/acorn","acorn/acorn_loose","acorn/util/walk","./def","./signal"],e):void e(t.tern||(t.tern={}),acorn,acorn,acorn.walk,tern.def,tern.signal)}(this,function(t,e,r,n,o,i){"use strict";function p(t,e){var r=Object.create(t);if(e)for(var n in e)r[n]=e[n];return r}function s(t){for(var e=0,r=0,n=0,o=null,i=0;i<t.length;++i){var p=t[i];if(p instanceof ot)++e;else if(p instanceof nt)++r;else if(p instanceof rt)++n;else if(p instanceof et){if(o&&p.name!=o.name)return null;o=p}}var s=(e&&1)+(r&&1)+(n&&1)+(o&&1);if(s>1)return null;if(o)return o;for(var a=0,u=null,i=0;i<t.length;++i){var p=t[i],f=0;if(e)f=p.getProp("<i>").isEmpty()?1:2;else if(r){f=1;for(var c=0;c<p.args.length;++c)p.args[c].isEmpty()||++f;p.retval.isEmpty()||++f}else n&&(f=p.name?100:2);f>=a&&(a=f,u=p)}return u}function a(){}function u(t,e){it.disabledComputing={fn:t,prev:it.disabledComputing};try{return e()}finally{it.disabledComputing=it.disabledComputing.prev}}function f(t,e){var r=it.props[t]||(it.props[t]=[]);r.push(e)}function c(t){return it.props[t]}function h(e){if(it.workList)return e(it.workList);var r=[],n=0,o=it.workList=function(t,e,o){n<st-at*r.length&&r.push(t,e,o,n)};try{for(var i=e(o),p=0;p<r.length;p+=4){if(pt&&+new Date>=pt)throw new t.TimedOut;n=r[p+3]+1,r[p+1].addType(r[p],r[p+2])}return i}finally{it.workList=null}}function l(t,e){t.fnType&&(t.fnType.instantiateScore=(t.fnType.instantiateScore||0)+e)}function g(t,e){try{return n.simple(t,{Expression:function(){if(--e<=0)throw ft}}),!0}catch(t){if(t==ft)return!1;throw t}}function y(t,e){var r=e.fnType.instantiateScore;return!it.disabledComputing&&r&&e.fnType.args.length&&g(t,5*r)?(l(e.prev,r/2),d(t,e),!0):void(e.fnType.instantiateScore=null)}function d(t,e){for(var r=e.fnType,o=0;o<r.args.length;++o)r.args[o]=new G;r.self=new G,r.computeRet=function(o,i){return u(r,function(){var p=it.curOrigin;it.curOrigin=r.origin;var s=new ut(e.prev);s.originNode=e.originNode;for(var a in e.props)for(var u=s.defProp(a,e.props[a].originNode),f=0;f<i.length;++f)r.argNames[f]==a&&f<i.length&&i[f].propagate(u);for(var c=r.argNames.length!=i.length?r.argNames.slice(0,i.length):r.argNames;c.length<i.length;)c.push("?");if(s.fnType=new nt(r.name,o,i,c,C),r.arguments){var h=s.fnType.arguments=new G;s.defProp("arguments").addType(new ot(h));for(var f=0;f<i.length;++f)i[f].propagate(h)}return t.body.scope=s,n.recursive(t.body,s,null,ct),n.recursive(t.body,s,null,lt),it.curOrigin=p,s.fnType.retval})}}function v(t){function e(t,r,o){if(!(o>3)&&t.forward)for(var i=0;i<t.forward.length;++i){var p=t.forward[i].propagatesTo();if(p){var s,a=r;if(p instanceof G)s=p;else{if(!(p.target instanceof G))continue;a+=p.pathExt,s=p.target}if(s==n)return a;var u=e(s,a,o+1);if(u)return u}}}var r=t.fnType,n=r.retval;if(n!=C){var i,p;!n.isEmpty()&&(i=n.getType())instanceof ot&&(n=p=i.getProp("<i>"));for(var s=e(r.self,"!this",0),a=0;!s&&a<r.args.length;++a)s=e(r.args[a],"!"+a,0);if(s){p&&(s="["+s+"]");var u=new o.TypeParser(s);return r.computeRet=u.parseRetType(),r.computeRetSource=s,!0}}}function m(t,e){return t.defProp(e.name,e)}function P(t,e,r){var n=t.property;return t.computed?"Literal"==n.type&&"string"==typeof n.value?n.value:(r&&O(n,e,r,C),"<i>"):n.name}function T(t){switch(t){case"+":case"-":case"~":return it.num;case"!":return it.bool;case"typeof":return it.str;case"void":case"delete":return C}}function b(t){switch(t){case"==":case"!=":case"===":case"!==":case"<":case">":case">=":case"<=":case"in":case"instanceof":return!0}}function w(t){if(t.regex)return $(it.protos.RegExp);switch(typeof t.value){case"boolean":return it.bool;case"number":return it.num;case"string":return it.str;case"object":case"function":return t.value?$(it.protos.RegExp):C}}function x(t){return function(e,r,n,o,i){var p=t(e,r,n,i);return o&&p.propagate(o),p}}function E(t){return function(e,r,n,o,i){return o||(o=new G),t(e,r,n,o,i),o}}function O(t,e,r,n,o){return ht[t.type](t,e,r,n,o)}function N(t,e){var r=t&&t[e],n=Array.prototype.slice.call(arguments,2);if(r)for(var o=0;o<r.length;++o)r[o].apply(null,n)}function S(t,e,r){var n=Array.isArray(t);return n&&1==t.length&&(t=t[0],n=!1),n?null==r?function(e){return t.indexOf(e.origin)>-1}:function(n,o){return o&&o.start>=e&&o.end<=r&&t.indexOf(n.origin)>-1}:null==r?function(e){return e.origin==t}:function(n,o){return o&&o.start>=e&&o.end<=r&&n.origin==t}}function j(t){mt=!0;var e=c(t);if(e)for(var r=0;r<e.length;++r){var n=e[r].getProp(t);if(!n.isEmpty())return n}return C}function A(t,e){return yt[t.type](t,e)}var k=t.toString=function(t,e,r){return t&&t!=r?t.toString(e):"?"},C=t.ANull=i.mixin({addType:function(){},propagate:function(){},getProp:function(){return C},forAllProps:function(){},hasType:function(){return!1},isEmpty:function(){return!0},getFunctionType:function(){},getType:function(){},gatherProperties:function(){},propagatesTo:function(){},typeHint:function(){},propHint:function(){}}),F=100,H=90,I=10,R=5,_=5,B=90,M=2,G=t.AVal=function(){this.types=[],this.forward=null,this.maxWeight=0};G.prototype=p(C,{addType:function(t,e){if(e=e||F,this.maxWeight<e){if(this.maxWeight=e,1==this.types.length&&this.types[0]==t)return;this.types.length=0}else if(this.maxWeight>e||this.types.indexOf(t)>-1)return;this.signal("addType",t),this.types.push(t);var r=this.forward;r&&h(function(n){for(var o=0;o<r.length;++o)n(t,r[o],e)})},propagate:function(t,e){if(!(t==C||t instanceof tt)){e&&e!=F&&(t=new Z(t,e)),(this.forward||(this.forward=[])).push(t);var r=this.types;r.length&&h(function(n){for(var o=0;o<r.length;++o)n(r[o],t,e)})}},getProp:function(t){if("__proto__"==t||"✖"==t)return C;var e=(this.props||(this.props=Object.create(null)))[t];return e||(e=this.props[t]=new G,this.propagate(new q(t,e))),e},forAllProps:function(t){this.propagate(new V(t))},hasType:function(t){return this.types.indexOf(t)>-1},isEmpty:function(){return 0===this.types.length},getFunctionType:function(){for(var t=this.types.length-1;t>=0;--t)if(this.types[t]instanceof nt)return this.types[t]},getType:function(t){return 0===this.types.length&&t!==!1?this.makeupType():1===this.types.length?this.types[0]:s(this.types)},computedPropType:function(){if(!this.propertyOf||!this.propertyOf.hasProp("<i>"))return null;var t=this.propertyOf.getProp("<i>");return t==this?null:t.getType()},makeupType:function(){var t=this.computedPropType();if(t)return t;if(!this.forward)return null;for(var e=this.forward.length-1;e>=0;--e){var r=this.forward[e].typeHint();if(r&&!r.isEmpty())return mt=!0,r}for(var n=Object.create(null),o=null,e=0;e<this.forward.length;++e){var i=this.forward[e].propHint();i&&"length"!=i&&"<i>"!=i&&"✖"!=i&&i!=it.completingProperty&&(n[i]=!0,o=i)}if(!o)return null;var p=c(o);if(p){var a=[];t:for(var e=0;e<p.length;++e){var u=p[e];for(var i in n)if(!u.hasProp(i))continue t;u.hasCtor&&(u=$(u)),a.push(u)}var f=s(a);if(f)return mt=!0,f}},typeHint:function(){return this.types.length?this.getType():null},propagatesTo:function(){return this},gatherProperties:function(t,e){for(var r=0;r<this.types.length;++r)this.types[r].gatherProperties(t,e)},guessProperties:function(t){if(this.forward)for(var e=0;e<this.forward.length;++e){var r=this.forward[e].propHint();r&&t(r,null,0)}var n=this.makeupType();n&&n.gatherProperties(t)}}),a.prototype=p(C,{init:function(){this.origin=it.curOrigin}});var L=t.constraint=function(t,e){var r="this.init();";t=t?t.split(", "):[];for(var n=0;n<t.length;++n)r+="this."+t[n]+" = "+t[n]+";";var o=Function.apply(null,t.concat([r]));o.prototype=Object.create(a.prototype);for(var i in e)e.hasOwnProperty(i)&&(o.prototype[i]=e[i]);return o},q=L("prop, target",{addType:function(t,e){t.getProp&&t.getProp(this.prop).propagate(this.target,e)},propHint:function(){return this.prop},propagatesTo:function(){if("<i>"==this.prop||!/[^\w_]/.test(this.prop))return{target:this.target,pathExt:"."+this.prop}}}),U=t.PropHasSubset=L("prop, type, originNode",{addType:function(t,e){if(t instanceof rt){var r=t.defProp(this.prop,this.originNode);r.origin=this.origin,this.type.propagate(r,e)}},propHint:function(){return this.prop}}),V=L("c",{addType:function(t){t instanceof rt&&t.forAllProps(this.c)}}),D=t.IsCallee=L("self, args, argNodes, retval",{init:function(){a.prototype.init.call(this),this.disabled=it.disabledComputing},addType:function(t,e){if(t instanceof nt){for(var r=0;r<this.args.length;++r)r<t.args.length&&this.args[r].propagate(t.args[r],e),t.arguments&&this.args[r].propagate(t.arguments,e);this.self.propagate(t.self,this.self==it.topScope?B:e);var n=t.computeRet;if(n)for(var o=this.disabled;o;o=o.prev)(o.fn==t||t.name&&o.fn.name==t.name)&&(n=null);n?n(this.self,this.args,this.argNodes).propagate(this.retval,e):t.retval.propagate(this.retval,e)}},typeHint:function(){for(var t=[],e=0;e<this.args.length;++e)t.push("?");return new nt(null,this.self,this.args,t,C)},propagatesTo:function(){return{target:this.retval,pathExt:".!ret"}}}),z=L("propName, args, argNodes, retval",{init:function(){a.prototype.init.call(this),this.disabled=it.disabledComputing},addType:function(t,e){var r=new D(t,this.args,this.argNodes,this.retval);r.disabled=this.disabled,t.getProp(this.propName).propagate(r,e)},propHint:function(){return this.propName}}),W=t.IsCtor=L("target, noReuse",{addType:function(t,e){t instanceof nt&&(it.parent&&!it.parent.options.reuseInstances&&(this.noReuse=!0),t.getProp("prototype").propagate(new J(!this.noReuse&&t,this.target),e))}}),$=t.getInstance=function(t,e){if(e===!1)return new rt(t);e||(e=t.hasCtor),t.instances||(t.instances=[]);for(var r=0;r<t.instances.length;++r){var n=t.instances[r];if(n.ctor==e)return n.instance}var o=new rt(t,e&&e.name);return o.origin=t.origin,t.instances.push({ctor:e,instance:o}),o},J=t.IsProto=L("ctor, target",{addType:function(t,e){t instanceof rt&&((this.count=(this.count||0)+1)>8||(t==it.protos.Array?this.target.addType(new ot):this.target.addType($(t,this.ctor))))}}),K=L("fn",{addType:function(t,e){if(t instanceof rt&&!t.hasCtor){t.hasCtor=this.fn;var r=new Y(t,this.fn);r.addType(this.fn),t.forAllProps(function(t,e,n){n&&e.propagate(r)})}}}),Q=L("other, target",{addType:function(t,e){t==it.str?this.target.addType(it.str,e):t==it.num&&this.other.hasType(it.num)&&this.target.addType(it.num,e)},typeHint:function(){return this.other}}),X=t.IfObj=L("target",{addType:function(t,e){t instanceof rt&&this.target.addType(t,e)},propagatesTo:function(){return this.target}}),Y=L("obj, ctor",{addType:function(t){t instanceof nt&&t.self&&t.self.isEmpty()&&t.self.addType($(this.obj,this.ctor),M)}}),Z=L("inner, weight",{addType:function(t,e){this.inner.addType(t,Math.min(e,this.weight))},propagatesTo:function(){return this.inner.propagatesTo()},typeHint:function(){return this.inner.typeHint()},propHint:function(){return this.inner.propHint()}}),tt=t.Type=function(){};tt.prototype=p(C,{constructor:tt,propagate:function(t,e){t.addType(this,e)},hasType:function(t){return t==this},isEmpty:function(){return!1},typeHint:function(){return this},getType:function(){return this}});var et=t.Prim=function(t,e){this.name=e,this.proto=t};et.prototype=p(tt.prototype,{constructor:et,toString:function(){return this.name},getProp:function(t){return this.proto.hasProp(t)||C},gatherProperties:function(t,e){this.proto&&this.proto.gatherProperties(t,e)}});var rt=t.Obj=function(t,e){if(this.props||(this.props=Object.create(null)),this.proto=t===!0?it.protos.Object:t,t&&!e&&t.name&&!(this instanceof nt)){var r=/^(.*)\.prototype$/.exec(this.proto.name);r&&(e=r[1])}this.name=e,this.maybeProps=null,this.origin=it.curOrigin};rt.prototype=p(tt.prototype,{constructor:rt,toString:function(t){if(!t&&this.name)return this.name;var e=[],r=!1;for(var n in this.props)if("<i>"!=n){if(e.length>5){r=!0;break}t?e.push(n+": "+k(this.props[n].getType(),t-1)):e.push(n)}return e.sort(),r&&e.push("..."),"{"+e.join(", ")+"}"},hasProp:function(t,e){var r=this.props[t];if(e!==!1)for(var n=this.proto;n&&!r;n=n.proto)r=n.props[t];return r},defProp:function(t,e){var r=this.hasProp(t,!1);if(r)return e&&!r.originNode&&(r.originNode=e),r;if("__proto__"==t||"✖"==t)return C;var n=this.maybeProps&&this.maybeProps[t];return n?(delete this.maybeProps[t],this.maybeUnregProtoPropHandler()):(n=new G,n.propertyOf=this),this.props[t]=n,n.originNode=e,n.origin=it.curOrigin,this.broadcastProp(t,n,!0),n},getProp:function(t){var e=this.hasProp(t,!0)||this.maybeProps&&this.maybeProps[t];if(e)return e;if("__proto__"==t||"✖"==t)return C;var r=this.ensureMaybeProps()[t]=new G;return r.propertyOf=this,r},broadcastProp:function(t,e,r){if(r&&(this.signal("addProp",t,e),this instanceof ut||f(t,this)),this.onNewProp)for(var n=0;n<this.onNewProp.length;++n){var o=this.onNewProp[n];o.onProtoProp?o.onProtoProp(t,e,r):o(t,e,r)}},onProtoProp:function(t,e,r){var n=this.maybeProps&&this.maybeProps[t];n&&(delete this.maybeProps[t],this.maybeUnregProtoPropHandler(),this.proto.getProp(t).propagate(n)),this.broadcastProp(t,e,!1)},ensureMaybeProps:function(){return this.maybeProps||(this.proto&&this.proto.forAllProps(this),this.maybeProps=Object.create(null)),this.maybeProps},removeProp:function(t){var e=this.props[t];delete this.props[t],this.ensureMaybeProps()[t]=e,e.types.length=0},forAllProps:function(t){this.onNewProp||(this.onNewProp=[],this.proto&&this.proto.forAllProps(this)),this.onNewProp.push(t);for(var e=this;e;e=e.proto)for(var r in e.props)t.onProtoProp?t.onProtoProp(r,e.props[r],e==this):t(r,e.props[r],e==this)},maybeUnregProtoPropHandler:function(){if(this.maybeProps){for(var t in this.maybeProps)return;this.maybeProps=null}!this.proto||this.onNewProp&&this.onNewProp.length||this.proto.unregPropHandler(this)},unregPropHandler:function(t){for(var e=0;e<this.onNewProp.length;++e)if(this.onNewProp[e]==t){this.onNewProp.splice(e,1);break}this.maybeUnregProtoPropHandler()},gatherProperties:function(t,e){for(var r in this.props)"<i>"!=r&&t(r,this,e);this.proto&&this.proto.gatherProperties(t,e+1)}});var nt=t.Fn=function(t,e,r,n,o){rt.call(this,it.protos.Function,t),this.self=e,this.args=r,this.argNames=n,this.retval=o};nt.prototype=p(rt.prototype,{constructor:nt,toString:function(t){t&&t--;for(var e="fn(",r=0;r<this.args.length;++r){r&&(e+=", ");var n=this.argNames[r];n&&"?"!=n&&(e+=n+": "),e+=k(this.args[r].getType(),t,this)}return e+=")",this.retval.isEmpty()||(e+=" -> "+k(this.retval.getType(),t,this)),e},getProp:function(t){if("prototype"==t){var e=this.hasProp(t,!1);if(!e){e=this.defProp(t);var r=new rt(!0,this.name&&this.name+".prototype");r.origin=this.origin,e.addType(r,I)}return e}return rt.prototype.getProp.call(this,t)},defProp:function(t,e){if("prototype"==t){var r=this.hasProp(t,!1);return r?r:(r=rt.prototype.defProp.call(this,t,e),r.origin=this.origin,r.propagate(new K(this)),r)}return rt.prototype.defProp.call(this,t,e)},getFunctionType:function(){return this}});var ot=t.Arr=function(t){rt.call(this,it.protos.Array);var e=this.defProp("<i>");t&&t.propagate(e)};ot.prototype=p(rt.prototype,{constructor:ot,toString:function(t){return"["+k(this.getProp("<i>").getType(),t,this)+"]"}}),t.Context=function(e,r){this.parent=r,this.props=Object.create(null),this.protos=Object.create(null),this.origins=[],this.curOrigin="ecma5",this.paths=Object.create(null),this.definitions=Object.create(null),this.purgeGen=0,this.workList=null,this.disabledComputing=null,t.withContext(this,function(){if(it.protos.Object=new rt(null,"Object.prototype"),it.topScope=new ut,it.topScope.name="<top>",it.protos.Array=new rt(!0,"Array.prototype"),it.protos.Function=new rt(!0,"Function.prototype"),it.protos.RegExp=new rt(!0,"RegExp.prototype"),it.protos.String=new rt(!0,"String.prototype"),it.protos.Number=new rt(!0,"Number.prototype"),it.protos.Boolean=new rt(!0,"Boolean.prototype"),it.str=new et(it.protos.String,"string"),it.bool=new et(it.protos.Boolean,"bool"),it.num=new et(it.protos.Number,"number"),it.curOrigin=null,e)for(var t=0;t<e.length;++t)o.load(e[t])})};var it=null;t.cx=function(){return it},t.withContext=function(t,e){var r=it;it=t;try{return e()}finally{it=r}},t.TimedOut=function(){this.message="Timed out",this.stack=(new Error).stack},t.TimedOut.prototype=Object.create(Error.prototype),t.TimedOut.prototype.name="infer.TimedOut";var pt;t.withTimeout=function(t,e){var r=+new Date+t,n=pt;if(n&&n<r)return e();pt=r;try{return e()}finally{pt=n}},t.addOrigin=function(t){it.origins.indexOf(t)<0&&it.origins.push(t)};var st=20,at=1e-4,ut=t.Scope=function(t){rt.call(this,t||!0),this.prev=t};ut.prototype=p(rt.prototype,{constructor:ut,defVar:function(t,e){for(var r=this;;r=r.proto){var n=r.props[t];if(n)return n;if(!r.prev)return r.defProp(t,e)}}});var ft={},ct=n.make({Function:function(t,e,r){var n=t.body.scope=new ut(e);n.originNode=t;for(var o=[],i=[],p=0;p<t.params.length;++p){var s=t.params[p];i.push(s.name),o.push(m(n,s))}if(n.fnType=new nt(t.id&&t.id.name,new G,o,i,C),n.fnType.originNode=t,t.id){var a="FunctionDeclaration"==t.type;m(a?e:n,t.id)}r(t.body,n,"ScopeBody")},TryStatement:function(t,e,r){if(r(t.block,e,"Statement"),t.handler){var n=m(e,t.handler.param);r(t.handler.body,e,"ScopeBody");var o=it.definitions.ecma5;o&&n.isEmpty()&&$(o["Error.prototype"]).propagate(n,_)}t.finalizer&&r(t.finalizer,e,"Statement")},VariableDeclaration:function(t,e,r){for(var n=0;n<t.declarations.length;++n){var o=t.declarations[n];m(e,o.id),o.init&&r(o.init,e,"Expression")}}}),ht={ArrayExpression:x(function(t,e,r){for(var n=new G,o=0;o<t.elements.length;++o){var i=t.elements[o];i&&O(i,e,r,n)}return new ot(n)}),ObjectExpression:x(function(t,e,r,n){var o=t.objType=new rt(!0,n);o.originNode=t;for(var i=0;i<t.properties.length;++i){var n,p=t.properties[i],s=p.key;if("✖"!=p.value.name)if("Identifier"==s.type?n=s.name:"string"==typeof s.value&&(n=s.value),n&&"set"!=p.kind){var a=o.defProp(n,s),u=a;a.initializer=!0,"get"==p.kind&&(u=new D(o,[],null,a)),O(p.value,e,r,u,n)}else O(p.value,e,r,C)}return o}),FunctionExpression:x(function(t,e,r,n){var o=t.body.scope,i=o.fnType;return n&&!i.name&&(i.name=n),r(t.body,e,"ScopeBody"),y(t,o)||v(o),t.id&&o.getProp(t.id.name).addType(i),i}),SequenceExpression:x(function(t,e,r){for(var n=0,o=t.expressions.length-1;n<o;++n)O(t.expressions[n],e,r,C);return O(t.expressions[o],e,r)}),UnaryExpression:x(function(t,e,r){return O(t.argument,e,r,C),T(t.operator)}),UpdateExpression:x(function(t,e,r){return O(t.argument,e,r,C),it.num}),BinaryExpression:x(function(t,e,r){if("+"==t.operator){var n=O(t.left,e,r),o=O(t.right,e,r);if(n.hasType(it.str)||o.hasType(it.str))return it.str;if(n.hasType(it.num)&&o.hasType(it.num))return it.num;var i=new G;return n.propagate(new Q(o,i)),o.propagate(new Q(n,i)),i}return O(t.left,e,r,C),O(t.right,e,r,C),b(t.operator)?it.bool:it.num}),AssignmentExpression:x(function(t,e,r){var n,o,i;if("MemberExpression"==t.left.type?(i=P(t.left,e,r),"Identifier"==t.left.object.type&&(o=t.left.object.name+"."+i)):o=t.left.name,"="!=t.operator&&"+="!=t.operator?(O(t.right,e,r,C),n=it.num):n=O(t.right,e,r,null,o),"MemberExpression"==t.left.type){var p=O(t.left.object,e,r);if("prototype"==i&&l(e,20),"<i>"==i){var s=t.left.property.name,a=e.props[s],u=a&&a.iteratesOver;if(u){l(e,20);var f="MemberExpression"==t.right.type&&t.right.computed&&t.right.property.name==s;return u.forAllProps(function(t,e,r){r&&"prototype"!=t&&"<i>"!=t&&p.propagate(new U(t,f?e:C))}),n}}p.propagate(new U(i,n,t.left.property))}else n.propagate(e.defVar(t.left.name,t.left));return n}),LogicalExpression:E(function(t,e,r,n){O(t.left,e,r,n),O(t.right,e,r,n)}),ConditionalExpression:E(function(t,e,r,n){O(t.test,e,r,C),O(t.consequent,e,r,n),O(t.alternate,e,r,n)}),NewExpression:E(function(t,e,r,n,o){"Identifier"==t.callee.type&&t.callee.name in e.props&&l(e,20);for(var i=0,p=[];i<t.arguments.length;++i)p.push(O(t.arguments[i],e,r));var s=O(t.callee,e,r),a=new G;s.propagate(new W(a,o&&/\.prototype$/.test(o))),a.propagate(n,H),s.propagate(new D(a,p,t.arguments,new X(n)))}),CallExpression:E(function(t,e,r,n){for(var o=0,i=[];o<t.arguments.length;++o)i.push(O(t.arguments[o],e,r));if("MemberExpression"==t.callee.type){var p=O(t.callee.object,e,r),s=P(t.callee,e,r);("call"==s||"apply"==s)&&e.fnType&&e.fnType.args.indexOf(p)>-1&&l(e,30),p.propagate(new z(s,i,t.arguments,n))}else{var a=O(t.callee,e,r);e.fnType&&e.fnType.args.indexOf(a)>-1&&l(e,30);var u=a.getFunctionType();u&&u.instantiateScore&&e.fnType&&l(e,u.instantiateScore/5),a.propagate(new D(it.topScope,i,t.arguments,n))}}),MemberExpression:E(function(t,e,r,n){var o=P(t,e),i=O(t.object,e,r),p=i.getProp(o);if("<i>"==o){var s=O(t.property,e,r);if(!s.hasType(it.num))return p.propagate(n,R)}p.propagate(n)}),Identifier:x(function(t,e){return"arguments"!=t.name||!e.fnType||t.name in e.props||e.defProp(t.name,e.fnType.originNode).addType(new ot(e.fnType.arguments=new G)),e.getProp(t.name)}),ThisExpression:x(function(t,e){return e.fnType?e.fnType.self:it.topScope}),Literal:x(function(t){return w(t)})},lt=n.make({Expression:function(t,e,r){O(t,e,r,C)},FunctionDeclaration:function(t,e,r){var n=t.body.scope,o=n.fnType;r(t.body,e,"ScopeBody"),y(t,n)||v(n);var i=e.getProp(t.id.name);i.addType(o)},VariableDeclaration:function(t,e,r){for(var n=0;n<t.declarations.length;++n){var o=t.declarations[n],i=e.getProp(o.id.name);o.init&&O(o.init,e,r,i,o.id.name)}},ReturnStatement:function(t,e,r){if(t.argument){var n=C;e.fnType&&(e.fnType.retval==C&&(e.fnType.retval=new G),n=e.fnType.retval),O(t.argument,e,r,n)}},ForInStatement:function(t,e,r){var n=O(t.right,e,r);if("Identifier"==t.right.type&&t.right.name in e.props||"MemberExpression"==t.right.type&&"prototype"==t.right.property.name){l(e,5);var o;"Identifier"==t.left.type?o=t.left.name:"VariableDeclaration"==t.left.type&&(o=t.left.declarations[0].id.name),o&&o in e.props&&(e.getProp(o).iteratesOver=n)}r(t.body,e,"Statement")},ScopeBody:function(t,e,r){r(t,t.scope||e)}}),gt=t.parse=function(t,n,o){var i;try{i=e.parse(t,o)}catch(e){i=r.parse_dammit(t,o)}return N(n,"postParse",i,t),i};t.analyze=function(e,r,o,i){"string"==typeof e&&(e=gt(e)),r||(r="file#"+it.origins.length),t.addOrigin(it.curOrigin=r),o||(o=it.topScope),n.recursive(e,o,null,ct),N(i,"preInfer",e,o),n.recursive(e,o,null,lt),N(i,"postInfer",e,o),it.curOrigin=null},t.purge=function(t,e,r){var n=S(t,e,r);++it.purgeGen,it.topScope.purge(n);for(var o in it.props){for(var i=it.props[o],p=0;p<i.length;++p){var s=i[p],a=s.props[o];a&&!n(a,a.originNode)||i.splice(p--,1)}i.length||delete it.props[o]}},G.prototype.purge=function(t){if(this.purgeGen!=it.purgeGen){this.purgeGen=it.purgeGen;for(var e=0;e<this.types.length;++e){var r=this.types[e];t(r,r.originNode)?this.types.splice(e--,1):r.purge(t)}if(this.forward)for(var e=0;e<this.forward.length;++e){var n=this.forward[e];t(n)?(this.forward.splice(e--,1),this.props&&(this.props=null)):n.purge&&n.purge(t)}}},C.purge=function(){},rt.prototype.purge=function(t){if(this.purgeGen==it.purgeGen)return!0;this.purgeGen=it.purgeGen;for(var e in this.props){var r=this.props[e];t(r,r.originNode)&&this.removeProp(e),r.purge(t)}},nt.prototype.purge=function(t){if(!rt.prototype.purge.call(this,t)){this.self.purge(t),this.retval.purge(t);for(var e=0;e<this.args.length;++e)this.args[e].purge(t)}};var yt={ArrayExpression:function(t,e){for(var r=new G,n=0;n<t.elements.length;++n){var o=t.elements[n];o&&A(o,e).propagate(r)}return new ot(r)},ObjectExpression:function(t){return t.objType},FunctionExpression:function(t){return t.body.scope.fnType},SequenceExpression:function(t,e){return A(t.expressions[t.expressions.length-1],e)},UnaryExpression:function(t){return T(t.operator)},UpdateExpression:function(){return it.num},BinaryExpression:function(t,e){if(b(t.operator))return it.bool;if("+"==t.operator){var r=A(t.left,e),n=A(t.right,e);if(r.hasType(it.str)||n.hasType(it.str))return it.str}return it.num},AssignmentExpression:function(t,e){return A(t.right,e)},LogicalExpression:function(t,e){var r=A(t.left,e);return r.isEmpty()?A(t.right,e):r},ConditionalExpression:function(t,e){var r=A(t.consequent,e);return r.isEmpty()?A(t.alternate,e):r},NewExpression:function(t,e){var r=A(t.callee,e).getFunctionType(),n=r&&r.getProp("prototype").getType();return n?$(n,r):C},CallExpression:function(t,e){var r=A(t.callee,e).getFunctionType();if(!r)return C;if(r.computeRet){for(var n=0,o=[];n<t.arguments.length;++n)o.push(A(t.arguments[n],e));var i=C;return"MemberExpression"==t.callee.type&&(i=A(t.callee.object,e)),r.computeRet(i,o,t.arguments)}return r.retval},MemberExpression:function(t,e){var r=P(t,e),n=A(t.object,e).getType();return n?n.getProp(r):"<i>"==r?C:j(r)},Identifier:function(t,e){return e.hasProp(t.name)||C},ThisExpression:function(t,e){return e.fnType?e.fnType.self:it.topScope},Literal:function(t){return w(t)}},dt=t.searchVisitor=n.make({Function:function(t,e,r){var n=t.body.scope;t.id&&r(t.id,n);for(var o=0;o<t.params.length;++o)r(t.params[o],n);r(t.body,n,"ScopeBody")},TryStatement:function(t,e,r){t.handler&&r(t.handler.param,e),n.base.TryStatement(t,e,r)},VariableDeclaration:function(t,e,r){for(var n=0;n<t.declarations.length;++n){var o=t.declarations[n];r(o.id,e),o.init&&r(o.init,e,"Expression")}}});t.fullVisitor=n.make({MemberExpression:function(t,e,r){r(t.object,e,"Expression"),r(t.property,e,t.computed?"Expression":null)},ObjectExpression:function(t,e,r){for(var n=0;n<t.properties.length;++n)r(t.properties[n].value,e,"Expression"),r(t.properties[n].key,e)}},dt),t.findExpressionAt=function(t,e,r,o,i){var p=i||function(t,e){return("Identifier"!=e.type||"✖"!=e.name)&&yt.hasOwnProperty(e.type)};return n.findNodeAt(t,e,r,p,dt,o||it.topScope)},t.findExpressionAround=function(t,e,r,o,i){var p=i||function(t,r){return!(null!=e&&r.start>e)&&(("Identifier"!=r.type||"✖"!=r.name)&&yt.hasOwnProperty(r.type))};return n.findNodeAround(t,r,p,dt,o||it.topScope)},t.expressionType=function(t){return A(t.node,t.state)},t.parentNode=function(t,e){function r(e,i,p){if(e.start<=t.start&&e.end>=t.end){var s=o[o.length-1];if(e==t)throw{found:s};s!=e&&o.push(e),n.base[p||e.type](e,i,r),s!=e&&o.pop()}}var o=[];try{r(e,null)}catch(t){if(t.found)return t.found;throw t}};var vt={ArrayExpression:function(t,e,r){return r(t,!0).getProp("<i>")},ObjectExpression:function(t,e,r){for(var n=0;n<t.properties.length;++n){var o=e.properties[n];if(o.value==e)return r(t,!0).getProp(o.key.name)}},UnaryExpression:function(t){return T(t.operator)},UpdateExpression:function(){return it.num},BinaryExpression:function(t){return b(t.operator)?it.bool:it.num},AssignmentExpression:function(t,e,r){return r(t.left)},LogicalExpression:function(t,e,r){return r(t,!0)},ConditionalExpression:function(t,e,r){if(t.consequent==e||t.alternate==e)return r(t,!0)},NewExpression:function(t,e,r){return this.CallExpression(t,e,r)},CallExpression:function(t,e,r){for(var n=0;n<t.arguments.length;n++){var o=t.arguments[n];if(o==e){var i=r(t.callee).getType();if(i instanceof nt)return i.args[n];break}}},ReturnStatement:function(t,e,r){var o=n.findNodeAround(e.sourceFile.ast,e.start,"Function");if(o){var i=r(o.node,!0).getType();if(i)return i.retval.getType()}}};t.typeFromContext=function(e,r){var n=t.parentNode(r.node,e),o=null;return vt.hasOwnProperty(n.type)&&(o=vt[n.type](n,r.node,function(n,o){var i={node:n,state:r.state},p=o?t.typeFromContext(e,i):t.expressionType(i);return p||C})),o||t.expressionType(r)};var mt=!1;t.resetGuessing=function(t){mt=t},t.didGuess=function(){return mt},t.forAllPropertiesOf=function(t,e){t.gatherProperties(e,0)};var Pt=n.make({},dt);t.findRefs=function(t,e,r,o,i){Pt.Identifier=function(t,e){if(t.name==r)for(var n=e;n;n=n.prev)if(n==o&&i(t,e),r in n.props)return},n.recursive(t,e,null,Pt)};var Tt=n.make({Function:function(t,e,r){r(t.body,t.body.scope,"ScopeBody")}});t.findPropRefs=function(t,e,r,o,i){n.simple(t,{MemberExpression:function(t,e){t.computed||t.property.name!=o||A(t.object,e).getType()==r&&i(t.property)},ObjectExpression:function(t,e){if(A(t,e).getType()==r)for(var n=0;n<t.properties.length;++n)t.properties[n].key.name==o&&i(t.properties[n].key)}},Tt,e)};var bt=t.scopeAt=function(t,e,r){var o=n.findNodeAround(t,e,function(t,e){return"ScopeBody"==t&&e.scope});return o?o.node.scope:r||it.topScope};t.forAllLocalsAt=function(t,e,r,n){var o=bt(t,e,r);o.gatherProperties(n,0)},o=t.def=o.init({},t)});
//# sourceMappingURL=infer.min.js.map