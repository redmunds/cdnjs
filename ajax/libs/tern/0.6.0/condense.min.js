!function(t){return"object"==typeof exports&&"object"==typeof module?t(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],t):void t(self.tern||(self.tern={}),tern)}(function(t,e){"use strict";function r(t,r,n){this.origins=t,this.cx=e.cx(),this.passes=n.passes||this.cx.parent&&this.cx.parent.passes||{},this.maxOrigin=-(1/0);for(var o=0;o<t.length;++o)this.maxOrigin=Math.max(this.maxOrigin,this.cx.origins.indexOf(t[o]));this.output={"!name":r,"!define":{}},this.options=n,this.types=Object.create(null),this.altPaths=Object.create(null),this.patchUp=[],this.roots=Object.create(null)}function n(t){for(var e,r=1,n=0;(e=t.indexOf(".",n))!=-1;)n=e+1,r+="!"==t.charAt(n)?10:1;return r}function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function i(t){return t.proto&&!(t instanceof e.Fn)&&t.proto!=e.cx().protos.Object&&t.proto.hasCtor&&!t.hasCtor}function a(t,r,o,i,a){var p=t.getType(!1);if(p){var s=t.origin||p.origin,c=!1;if(s){var h=i.cx.origins.indexOf(s);if(h>i.maxOrigin)return;c=i.isTarget(s)}var u=r?r+"."+o:o,f=p.path,d=!f||n(f)>n(u);if(d){if(p instanceof e.Prim||(p.path=u),p.reached(u,i,!c)&&c){var y=i.types[f];y?(delete i.types[f],i.altPaths[f]=p):y={type:p},y.span=i.getSpan(t)||p!=t&&i.isTarget(p.origin)&&i.getSpan(p)||y.span,y.doc=t.doc||p!=t&&i.isTarget(p.origin)&&t.doc||y.doc,y.data=p.metaData,y.byName=null==y.byName?!!a:y.byName&&a,i.types[u]=y}}else c&&(i.altPaths[u]=p)}}function p(t,e,r,n){var o=t.getType();o&&a(o,e,r,n,!0)}function s(t,e){var r=t.proto.hasCtor.path;r?t.nameOverride="+"+r:r=t.path;for(var n in t.props)a(t.props[n],r,n,e)}function c(t,r){for(var n,i=r.output,a=r.output["!define"],p=0;p<t.length;++p){var s=t[p],c=n&&r.types[n];n=n?n+"."+s:s;var h=r.types[n];"!"==s.charAt(0)||c&&c.type.constructor!=e.Obj||h&&h.byName?o(a,n)?i=a[n]:a[n]=i={}:i=o(i,t[p])?i[s]:i[s]={}}return i}function h(t,e,r){var n=f(e.type);if(n!=e.type.path&&"?"!=n)t["!type"]=n;else if(e.type.proto&&e.type.proto!=r.cx.protos.Object){var o=f(e.type.proto);"?"!=o&&(t["!proto"]=o)}e.span&&(t["!span"]=e.span),e.doc&&(t["!doc"]=e.doc),e.data&&(t["!data"]=e.data)}function u(t,r,n){var i=t.split("."),a=i.pop();if("!"!=a[0]){var p=n.types[i.join(".")],s=c(i,n);p&&p.type.constructor!=e.Obj||o(s,a)||(s[a]=r.nameOverride||r.path)}}function f(t){var e=t.getType(!1);if(!e||v.indexOf(e)>-1)return e&&e.path||"?";v.push(e);var r=e.typeName();return v.pop(),r}function d(t,e){if("object"!=typeof t)return t;var r=!1,n=!1;for(var o in t)"!type"==o?r=!0:n=!0,"!data"!=o&&(t[o]=d(t[o],e));return r&&!n?t["!type"]:e?y(t):t}function y(t){var e=[],r={};for(var n in t)e.push(n);e.sort();for(var o=0;o<e.length;++o){var n=e[o];r[n]=t[n]}return r}function l(t){if(t)for(var e=0;e<t.length;++e)t[e].apply(null,Array.prototype.slice.call(arguments,1))}t.condense=function(t,e,n){"string"==typeof t&&(t=[t]);var o=new r(t,e||t[0],n||{});l(o.passes.preCondenseReach,o),o.cx.topScope.path="<top>",o.cx.topScope.reached("",o);for(var i in o.roots)a(o.roots[i],null,i,o);for(var p=0;p<o.patchUp.length;++p)s(o.patchUp[p],o);l(o.passes.postCondenseReach,o);for(var i in o.types)h(c(i.split("."),o),o.types[i],o);for(var i in o.altPaths)u(i,o.altPaths[i],o);var f=!1;for(var y in o.output["!define"]){f=!0;break}return f||delete o.output["!define"],l(o.passes.postCondense,o),d(o.output,o.options.sortOutput)},r.prototype.isTarget=function(t){return this.origins.indexOf(t)>-1},r.prototype.getSpan=function(t){if(0==this.options.spans||!this.isTarget(t.origin))return null;if(t.span)return t.span;var e,r=this.cx.parent;if(!r||!t.originNode||!(e=r.findFile(t.origin)))return null;var n=t.originNode.start,o=t.originNode.end,i=e.asLineChar(n),a=e.asLineChar(o);return n+"["+i.line+":"+i.ch+"]-"+o+"["+a.line+":"+a.ch+"]"},e.Prim.prototype.reached=function(){return!0},e.Arr.prototype.reached=function(t,e,r){return r||p(this.getProp("<i>"),t,"<i>",e),!0},e.Fn.prototype.reached=function(t,r,n){if(e.Obj.prototype.reached.call(this,t,r,n),!n){for(var o=0;o<this.args.length;++o)p(this.args[o],t,"!"+o,r);p(this.retval,t,"!ret",r)}return!0},e.Obj.prototype.reached=function(t,r,n){if(i(this)&&!this.condenseForceInclude)return r.patchUp.indexOf(this)==-1&&r.patchUp.push(this),!0;this.proto&&!n&&a(this.proto,t,"!proto",r);var o=!1;for(var p in this.props)a(this.props[p],t,p,r),o=!0;return!!(o||this.condenseForceInclude||this instanceof e.Fn)||(this.nameOverride="?",!1)};var v=[];e.Prim.prototype.typeName=function(){return this.name},e.Arr.prototype.typeName=function(){return"["+f(this.getProp("<i>"))+"]"},e.Fn.prototype.typeName=function(){for(var t="fn(",e=0;e<this.args.length;++e){e&&(t+=", ");var r=this.argNames[e];r&&"?"!=r&&(t+=r+": "),t+=f(this.args[e])}if(t+=")",this.computeRetSource)t+=" -> "+this.computeRetSource;else if(!this.retval.isEmpty()){var n=this.retval.getType(!1);n&&(t+=" -> "+f(n))}return t},e.Obj.prototype.typeName=function(){return this.nameOverride?this.nameOverride:this.path?this.path:"?"}});
//# sourceMappingURL=condense.min.js.map