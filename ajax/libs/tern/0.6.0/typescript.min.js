function parseFile(e,t){return 65279==e.charCodeAt(0)&&(e=e.slice(1)),new ts.Parser.parse(t,new ts.SimpleText.fromString(e),!1,new ts.ParseOptions(null,!0))}function lookup(e,t){for(;t;t=t.prev)if(t.name==e)return t.value}function buildPath(e){for(var t="";e;e=e.prev){var n=e.enter&&e.enter.replace(/[^\w$]/g,"");n&&(t=t?n+"."+t:n)}return t}function functionType(e,t){for(var n="fn(",r=e.parameterList.parameters,a=0,i=r.childCount();a<i;++a){var o=r.childAt(a);if(o.identifier){a&&(n+=", ");var l=o.identifier.text();o.questionToken&&(l+="?"),n+=l+": "+walk_(o.typeAnnotation,{enter:l,prev:t})}}n+=")";var s=e.typeAnnotation&&e.typeAnnotation.type;return s&&s.kind()!=nt.VoidKeyword&&(n+=" -> "+flat(s,{enter:"!ret",prev:t})),n}function addToObj(e,t,n){var r=e[a],a=t.text();/^".*"$/.test(a)&&(a=a.slice(1,a.length-1)),r?"string"==typeof r||"string"!=typeof n||r["!type"]?"string"==typeof r&&"string"!=typeof n&&(e[a]=n,n["!type"]=r):r["!type"]=n:e[a]=n}function isStatic(e){if(e.modifiers)for(var t=0,n=e.modifiers.childCount();t<n;t++)if("static"==e.modifiers.childAt(t).value())return!0}function objType(e,t,n){for(var r={},a=0,i=e.childCount();a<i;++a){var o=e.childAt(a),l=n&&isStatic(o)?n:r;switch(o.kind()){case nt.ImportDeclaration:var s=flat(o.moduleReference(),t);t={name:o.identifier.text(),value:s,prev:t};break;case nt.FunctionDeclaration:addToObj(l,o.identifier,functionType(o.callSignature,t));break;case nt.MemberFunctionDeclaration:case nt.MethodSignature:addToObj(l,o.propertyName,functionType(o.callSignature,t));break;case nt.ModuleDeclaration:addToObj(l,o.name||o.stringLiteral,objType(o.moduleElements,t));break;case nt.InterfaceDeclaration:addToObj(l,o.identifier,objType(o.body.typeMembers,t));break;case nt.ClassDeclaration:var c={};c.prototype=objType(o.classElements,t,c),addToObj(l,o.identifier,c);break;case nt.PropertySignature:addToObj(l,o.propertyName,walk_(o.typeAnnotation,t));break;case nt.MemberVariableDeclaration:addToObj(l,o.variableDeclarator.propertyName,walk_(o.variableDeclarator.typeAnnotation,t));break;case nt.EnumDeclaration:addToObj(l,o.identifier,"number");break;case nt.VariableStatement:for(var p=o.variableDeclaration.variableDeclarators,u=0,d=p.childCount();u<d;u++){var f=p.childAt(u);addToObj(l,f.propertyName,walk_(f.typeAnnotation,t))}break;case nt.ConstructorDeclaration:n&&!n["!type"]&&(n["!type"]=functionType(o,t));break;case nt.ExportAssignment:return walk(o.identifier,t);case nt.CallSignature:case nt.ConstructSignature:case nt.IndexSignature:case nt.SemicolonToken:case nt.EmptyStatement:break;default:throw new Error("Unknown field type: "+nt[o.kind()])}}return r}function walk(e,t){switch(e.kind()){case nt.IdentifierName:return lookup(e.text(),t)||e.text();case nt.QualifiedName:return flat(e.left,t)+"."+flat(e.right,null);case nt.ObjectType:return objType(e.typeMembers,t);case nt.ArrayType:return"["+flat(e.type,t)+"]";case nt.FunctionType:return functionType(e,t);case nt.DotToken:return flat(e.operand1,t)+"."+flat(e.operand2,t);case nt.StringLiteral:case nt.StringKeyword:return"string";case nt.NumberKeyword:return"number";case nt.BooleanKeyword:return"bool";case nt.AnyKeyword:case nt.VoidKeyword:return"?";case nt.TypeQuery:return walk(e.name);case nt.FirstTypeScriptKeyword:case nt.LastTypeScriptKeyword:case nt.FirstKeyword:case nt.LastKeyword:return e.value();default:throw new Error("Unrecognized type: "+nt[e.kind()])}}function walk_(e,t){return e&&e.type?walk(e.type,t):"?"}function flat(e,t){var n=walk(e,t);if("string"==typeof n)return n;for(var r=buildPath(t),a=0;;++a){var i=r+(a||"");if(!definitions.hasOwnProperty(i)){r=i;break}}return definitions[r]=n,r}var fs=require("fs"),tsFileName=__dirname+"/../node_modules/typescript/bin/typescript.js",box={};for(var prop in global)box[prop]=global[prop];require("vm").runInNewContext(fs.readFileSync(tsFileName,"utf8"),box,{filename:tsFileName});var ts=box.TypeScript,nt=ts.SyntaxKind,definitions,defaultCx={name:"any",value:"?",prev:{name:"null",value:"?",prev:null}};exports.translate=function(e,t){definitions={};var n=parseFile(e,t).sourceUnit(),r=objType(n.moduleElements,defaultCx);r["!name"]=t;var a=!1;for(var i in definitions){a=!0;break}return a&&(r["!define"]=definitions),r};
//# sourceMappingURL=typescript.min.js.map