!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn/util/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/util/walk"],e):void e(tern,tern,tern.comment,acorn.walk)}(function(e,n,r,t){"use strict";function i(e,n){function i(e){r.ensureCommentsBefore(n,e)}t.simple(e,{VariableDeclaration:i,FunctionDeclaration:i,AssignmentExpression:function(e){"="==e.operator&&i(e)},ObjectExpression:function(e){for(var n=0;n<e.properties.length;++n)i(e.properties[n].key)}})}function a(n,r){t.simple(n,{VariableDeclaration:function(e,n){e.commentsBefore&&o(e,e.commentsBefore,n,n.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,n){e.commentsBefore&&o(e,e.commentsBefore,n,n.getProp(e.id.name),e.body.scope.fnType)},AssignmentExpression:function(n,r){n.commentsBefore&&o(n,n.commentsBefore,r,e.expressionType({node:n.left,state:r}))},ObjectExpression:function(e,n){for(var r=0;r<e.properties.length;++r){var t=e.properties[r],i=t.key;i.commentsBefore&&o(t,i.commentsBefore,n,e.objType.getProp(i.name))}}},e.searchVisitor,r)}function o(n,r,t,i,a){u(n,t,i,r),!a&&i instanceof e.AVal&&i.types.length&&(a=i.types[i.types.length-1],a instanceof e.Obj&&a.origin==e.cx().curOrigin&&!a.doc||(a=null));var o=r[0],s=o.search(/\.\s/);s>5&&(o=o.slice(0,s+1)),o=o.trim().replace(/\s*\n\s*\*\s*|\s{1,}/g," "),i instanceof e.AVal&&(i.doc=o),a&&(a.doc=o)}function s(e,n){for(;/\s/.test(e.charAt(n));)++n;return n}function l(e,n,r,t){for(var i=[],a=[],o=!0;r=s(n,r),!o||n.charAt(r)!=t;o=!1){var l=n.indexOf(":",r);if(l<0)return null;var f=n.slice(r,l);if(!/^[\w$]+$/.test(f))return null;i.push(f),r=l+1;var u=c(e,n,r);if(!u)return null;r=u.end,a.push(u.type),r=s(n,r);var p=n.charAt(r);if(++r,p==t)break;if(","!=p)return null}return{labels:i,types:a,end:r}}function c(n,r,t){t=s(r,t);var i;if(r.indexOf("function(",t)==t){var a=l(n,r,t+9,")"),o=e.ANull;if(!a)return null;if(t=s(r,a.end),":"==r.charAt(t)){++t;var f=c(n,r,t+1);if(!f)return null;t=f.end,o=f.type}i=new e.Fn(null,e.ANull,a.types,a.labels,o)}else if("["==r.charAt(t)){var u=c(n,r,t+1);if(!u)return null;if(t=s(r,u.end),"]"!=r.charAt(t))return null;++t,i=new e.Arr(u.type)}else if("{"==r.charAt(t)){var p=l(n,r,t+1,"}");if(!p)return null;i=new e.Obj(!0);for(var m=0;m<p.types.length;++m){var y=i.defProp(p.labels[m]);y.initializer=!0,p.types[m].propagate(y)}t=p.end}else{for(var g=t;/[\w$]/.test(r.charAt(t));)++t;if(g==t)return null;var v=r.slice(g,t);if(/^(number|integer)$/i.test(v))i=e.cx().num;else if(/^bool(ean)?$/i.test(v))i=e.cx().bool;else if(/^string$/i.test(v))i=e.cx().str;else if(/^array$/i.test(v)){var u=null;if("."==r.charAt(t)&&"<"==r.charAt(t+1)){var d=c(n,r,t+2);if(!d)return null;if(t=s(r,d.end),">"!=r.charAt(t++))return null;u=d.type}i=new e.Arr(u)}else if(/^object$/i.test(v)){if(i=new e.Obj(!0),"."==r.charAt(t)&&"<"==r.charAt(t+1)){var b=c(n,r,t+2);if(!b)return null;if(t=s(r,b.end),","!=r.charAt(t++))return null;var h=c(n,r,t);if(!h)return null;if(t=s(r,h.end),">"!=r.charAt(t++))return null;h.type.propagate(i.defProp("<i>"))}}else{var A=n.hasProp(v);if(A&&(A=A.getType()),A)if(A instanceof e.Fn&&/^[A-Z]/.test(v)){var x=A.getProp("prototype").getType();x instanceof e.Obj&&(i=e.getInstance(x))}else i=A;else i=e.ANull}}var O=!1;return"="==r.charAt(t)&&(++t,O=!0),{type:i,end:t,isOptional:O}}function f(e,n,r){if(r=s(n,r||0),"{"!=n.charAt(r))return null;var t=c(e,n,r+1);return t&&"}"==n.charAt(t.end)?(++t.end,t):null}function u(e,n,r,t){for(var i,a,o,s,l=0;l<t.length;++l)for(var c,u=t[l],m=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?)\s+(.*)/g;c=m.exec(u);){var y=f(n,c[2]);if(y)switch(s=!0,c[1]){case"returns":case"return":o=y.type;break;case"type":i=y.type;break;case"param":case"arg":case"argument":var g=c[2].slice(y.end).match(/^\s*([\w$]+)/);if(!g)continue;(a||(a=Object.create(null)))[g[1]]=y.type,a&&(a[g[1]].isOptional=y.isOptional)}}s&&p(i,a,o,e,r)}function p(e,n,r,t,i){var a;if("VariableDeclaration"==t.type){var o=t.declarations[0];o.init&&"FunctionExpression"==o.init.type&&(a=o.init.body.scope.fnType)}else"FunctionDeclaration"==t.type?a=t.body.scope.fnType:"AssignmentExpression"==t.type?"FunctionExpression"==t.right.type&&(a=t.right.body.scope.fnType):"FunctionExpression"==t.value.type&&(a=t.value.body.scope.fnType);if(a&&(n||r)){if(n)for(var s=0;s<a.argNames.length;++s){var l=a.argNames[s],c=n[l];c&&(c.propagate(a.args[s]),n[l].isOptional&&(a.argNames[s]+="?"))}r&&r.propagate(a.retval)}else e&&e.propagate(i)}n.registerPlugin("doc_comment",function(){return{passes:{postParse:i,postInfer:a}}})});
//# sourceMappingURL=doc_comment.min.js.map