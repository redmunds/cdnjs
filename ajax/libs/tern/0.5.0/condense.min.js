!function(t){return"object"==typeof exports&&"object"==typeof module?t(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],t):void t(self.tern||(self.tern={}),tern)}(function(t,e){"use strict";function r(t,r,n){this.origins=t,this.cx=e.cx(),this.passes=n.passes||this.cx.parent&&this.cx.parent.passes||{},this.maxOrigin=-(1/0);for(var i=0;i<t.length;++i)this.maxOrigin=Math.max(this.maxOrigin,this.cx.origins.indexOf(t[i]));this.output={"!name":r,"!define":{}},this.options=n,this.types=Object.create(null),this.altPaths=Object.create(null),this.patchUp=[],this.roots=Object.create(null),this.roots[""]=this.cx.topScope}function n(t){for(var e,r=1,n=0;(e=t.indexOf(".",n))!=-1;)n=e+1,r+="!"==t.charAt(n)?10:1;return r}function i(t){return!/\!|<i>/.test(t)}function o(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function a(t){return t.proto&&!(t instanceof e.Fn)&&t.proto!=e.cx().protos.Object&&t.proto.hasCtor&&!t.hasCtor}function s(t,r,i,o){var a=t.getType(!1);if(a){var s=t.origin||a.origin,p=!1;if(s){var h=o.cx.origins.indexOf(s);if(h>o.maxOrigin)return;p=o.isTarget(s)}var c=r?r+"."+i:i,u=a.path,f=!u||n(u)>n(c);if(f){if(a instanceof e.Prim||(a.path=c),a.reached(c,o,!p)&&p){var d=o.types[u];d?(delete o.types[u],o.altPaths[u]=a):d={type:a},d.span=o.getSpan(t)||a!=t&&o.isTarget(a.origin)&&o.getSpan(a)||d.span,d.doc=t.doc||a!=t&&o.isTarget(a.origin)&&t.doc||d.doc,d.data=a.metaData,o.types[c]=d}}else p&&(o.altPaths[c]=a)}}function p(t,e){var r=t.proto.hasCtor.path;r?t.nameOverride="+"+r:(t.nameOverride="?",r=t.path);for(var n in t.props)s(t.props[n],r,n,e)}function h(t,e){for(var r=e.output,n=t.length-1;n>=0;--n)if(!i(t[n])){var a=t.slice(0,n+1).join("."),s=e.output["!define"];o(s,a)?r=s[a]:s[a]=r={},t=t.slice(n+1)}for(var n=0;n<t.length;++n)r=o(r,t[n])?r[t[n]]:r[t[n]]={};return r}function c(t,e,r){var n=f(e.type);if(n!=e.type.path&&"?"!=n)t["!type"]=n;else if(e.type.proto&&e.type.proto!=r.cx.protos.Object){var i=f(e.type.proto);"?"!=i&&(t["!proto"]=i)}e.span&&(t["!span"]=e.span),e.doc&&(t["!doc"]=e.doc),e.data&&(t["!data"]=e.data)}function u(t,e,r){var n=t.split("."),i=n.pop(),a=h(n,r);o(a,i)||(a[i]=e.nameOverride||e.path)}function f(t){var e=t.getType(!1);return e?e.typeName():"?"}function d(t,e){if("object"!=typeof t)return t;var r=!1,n=!1;for(var i in t)"!type"==i?r=!0:n=!0,"!data"!=i&&(t[i]=d(t[i],e));return r&&!n?t["!type"]:e?l(t):t}function l(t){var e=[],r={};for(var n in t)e.push({name:n,val:t[n]});e.sort(function(t,e){return t.name<e.name?-1:1});for(var i=0;i<e.length;++i)r[e[i].name]=e[i].val;return r}function v(t){if(t)for(var e=0;e<t.length;++e)t[e].apply(null,Array.prototype.slice.call(arguments,1))}t.condense=function(t,e,n){"string"==typeof t&&(t=[t]);var i=new r(t,e||t[0],n||{});v(i.passes.preCondenseReach,i),i.cx.topScope.path="<top>";for(var o in i.roots)i.roots[o].reached(o,i);for(var a=0;a<i.patchUp.length;++a)p(i.patchUp[a],i);v(i.passes.postCondenseReach,i);for(var o in i.types)c(h(o.split("."),i),i.types[o],i);for(var o in i.altPaths)u(o,i.altPaths[o],i);var s=!1;for(var f in i.output["!define"]){s=!0;break}return s||delete i.output["!define"],v(i.passes.postCondense,i),d(i.output,i.options.sortOutput),i.output},r.prototype.isTarget=function(t){return this.origins.indexOf(t)>-1},r.prototype.getSpan=function(t){if(0==this.options.spans||!this.isTarget(t.origin))return null;if(t.span)return t.span;var e,r=this.cx.parent;if(!r||!t.originNode||!(e=r.findFile(t.origin)))return null;var n=t.originNode.start,i=t.originNode.end,o=e.asLineChar(n),a=e.asLineChar(i);return n+"["+o.line+":"+o.ch+"]-"+i+"["+a.line+":"+a.ch+"]"},e.Prim.prototype.reached=function(){return!0},e.Arr.prototype.reached=function(t,e,r){return r||s(this.getProp("<i>"),t,"<i>",e),!0},e.Fn.prototype.reached=function(t,r,n){if(e.Obj.prototype.reached.call(this,t,r,n),!n){for(var i=0;i<this.args.length;++i)s(this.args[i],t,"!"+i,r);s(this.retval,t,"!ret",r)}return!0},e.Obj.prototype.reached=function(t,e,r){if(a(this)&&!this.condenseForceInclude)return e.patchUp.indexOf(this)==-1&&e.patchUp.push(this),!0;this.proto&&!r&&s(this.proto,t,"!proto",e);var n=!1;for(var i in this.props)s(this.props[i],t,i,e),n=!0;return!(!n&&!this.condenseForceInclude)||(this.nameOverride="?",!1)},e.Prim.prototype.typeName=function(){return this.name},e.Arr.prototype.typeName=function(){return"["+f(this.getProp("<i>"))+"]"},e.Fn.prototype.typeName=function(){for(var t="fn(",e=0;e<this.args.length;++e){e&&(t+=", ");var r=this.argNames[e];r&&"?"!=r&&(t+=r+": "),t+=f(this.args[e])}if(t+=")",this.computeRetSource)t+=" -> "+this.computeRetSource;else if(!this.retval.isEmpty()){var n=this.retval.getType(!1);n&&(t+=" -> "+f(n))}return t},e.Obj.prototype.typeName=function(){return this.nameOverride?this.nameOverride:this.path&&i(this.path)?this.path:"?"}});
//# sourceMappingURL=condense.min.js.map