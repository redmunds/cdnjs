!function(t){return"object"==typeof exports&&"object"==typeof module?t(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],t):void t(self.tern||(self.tern={}),tern)}(function(t,r){"use strict";function e(t){for(var r,e=1,o=0;(r=t.indexOf(".",o))!=-1;)o=r+1,e+="!"==t.charAt(o)?10:1;return e}function o(t,r){return t.sources.indexOf(r)>-1}function i(t,r,i,n){var a=t.getType(!1);if(a){var p=t.origin||a&&a.origin;if(p){var s=i.cx.origins.indexOf(p);if(s<n||r&&s>i.maxOrigin)return;n<i.minOrigin&&o(i,p)&&r.indexOf("!")<0&&i.addedToForeign.indexOf(a)<0&&i.addedToForeign.push(a),n=s}a.path&&e(a.path)<=e(r)||a.setPath(r,i,n)}}function n(t,r){var e=t.getType(!1);if(!e)return"?";var o=r.addedToForeign.indexOf(e);o>=0&&r.addedToForeign.splice(o,1);var i=e.path&&r.paths[e.path];if(i)return e.path;if(r.seen.indexOf(t)>-1)return t.path||"?";r.seen.push(t);var n=e.getDesc(r);return r.seen.pop(),n}function a(t){for(var r in t.props)return!0}function p(t,r,e){for(var i in t.props){var a=t.props[i];o(e,a.origin)&&(r[i]=n(a,e))}}function s(t,r){if(t._fromProto)return!0;if(t.proto&&t.proto!=r.cx.protos.Object&&t.proto.hasCtor&&!t.hasCtor&&t.proto.hasCtor.path){n(t.proto,r),t._fromProto=!0;var e=r.paths[t.proto.path];return e&&(p(t,e.structure,r),e.mayCull=!1),!0}}function h(t,r,e){if("string"==typeof t){var o;return t==e&&(o=r.paths[t])?o.mayCull?"?":(o.inlined=!0,h(o.structure,r,e)):t}for(var i in t)/^!(?:define|name|proto)$/.test(i)||(t[i]=h(t[i],r,null==e?null:e?e+"."+i:i));return t}r.Prim.prototype.setPath=function(){},r.Arr.prototype.setPath=function(t,r,e){this.path=t,i(this.getProp("<i>"),t+".<i>",r,e)},r.Fn.prototype.setPath=function(t,e,o){r.Obj.prototype.setPath.call(this,t,e,o);for(var n=0;n<this.args.length;++n)i(this.args[n],t+".!"+n,e,o);i(this.retval,t+".!ret",e,o)},r.Obj.prototype.setPath=function(t,r,e){this.path=t||"<top>";var o=t?t+".":"";for(var n in this.props)i(this.props[n],o+n,r,e);this.proto&&i(this.proto,o+"!proto",r,e)},r.Prim.prototype.getDesc=function(){return this.name},r.Arr.prototype.getDesc=function(t){return"["+n(this.getProp("<i>"),t)+"]"},r.Fn.prototype.getDesc=function(t){if(this.path&&!o(t,this.origin))return this.path;for(var r="fn(",e=0;e<this.args.length;++e){e&&(r+=", ");var i=this.argNames[e];i&&"?"!=i&&(r+=i+": "),r+=n(this.args[e],t)}if(r+=")",this.computeRetSource)r+=" -> "+this.computeRetSource;else if(!this.retval.isEmpty()){var s=this.retval.getType();s&&(r+=" -> "+n(s,t))}if(!a(this))return r;var h={"!type":r};return t.paths[this.path]={structure:h},p(this,h,t),this.path},r.Obj.prototype.getDesc=function(t){if(s(this,t))return"+"+this.proto.hasCtor.path;if(!o(t,this.origin))return this.path;var r,e={},i=t.paths[this.path]={structure:e};return this.proto&&this.proto!=t.cx.protos.Object&&(r=n(this.proto,t),"?"==r&&(r=null)),null!=i.mayCull||r||a(this)||(i.mayCull=!0),r&&(e["!proto"]=r),p(this,e,t),this.path},t.condense=function(t,e){"string"==typeof t&&(t=[t]),e||(e=t[0]);for(var a=r.cx(),p={},f=1/0,u=-(1/0),c=0;c<t.length;++c){var l=a.origins.indexOf(t[c]);l<0||(f=Math.min(l,f),u=Math.max(l,u))}var g={"!name":e,"!define":p},d={sources:t,paths:Object.create(null),cx:a,minOrigin:f,maxOrigin:u,addedToForeign:[],seen:[]};i(a.topScope,"",d,0);for(var v in a.topScope.props){var y=a.topScope.props[v];if(o(d,y.origin)){var m=y.getType(!1);m&&o(d,m.origin)&&(g[v]=n(m,d))}}if(d.addedToForeign.length>0){var O=d.addedToForeign;d.addedToForeign=[];for(var c=0;c<O.length;++c){var x=O[c],P=x.path.split("."),T=r.def.parsePath(P.slice(0,P.length-1).join("."));s(T,d)&&(P=T.proto.path.split(".").concat(P[P.length-1]));var j=n(O[c],d);if("?"!=j&&!P.some(function(t){return"!"==t.charAt(0)})){for(var F=0,b=g;F<P.length-1;++F){var C=P[F];b=Object.prototype.hasOwnProperty.call(b,C)?b[C]:b[C]={}}b[P[P.length-1]]=j}}}h(g,d,"");var D=[];for(var S in d.paths){var A=d.paths[S];A.inlined||A.mayCull||D.push(S,h(A.structure,d,null))}if(D.length)for(var c=D.length-2;c>=0;c-=2)p[D[c]]=D[c+1];else delete g["!define"];return g}});
//# sourceMappingURL=condense.min.js.map