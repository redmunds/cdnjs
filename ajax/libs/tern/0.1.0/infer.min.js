!function(r){return"object"==typeof exports&&"object"==typeof module?r(exports,require("acorn/acorn"),require("acorn/acorn_loose"),require("acorn/util/walk"),require("./def"),require("./jsdoc")):"function"==typeof define&&define.amd?define(["exports","acorn/acorn","acorn/acorn_loose","acorn/util/walk","./def","./jsdoc"],r):void r(self.tern||(self.tern={}),acorn,acorn,acorn.walk,tern.def,tern.jsdoc)}(function(r,e,t,n,o,i){"use strict";function a(r,e){var t=Object.create(r);if(e)for(var n in e)t[n]=e[n];return t}function p(r){for(var e=0,t=0,n=0,o=null,i=0;i<r.length;++i){var a=r[i];if(a instanceof nr)++e;else if(a instanceof tr)++t;else if(a instanceof er)++n;else if(a instanceof rr){if(o&&a.name!=o.name)return null;o=a}}var p=(e&&1)+(t&&1)+(n&&1)+(o&&1);if(p>1)return null;if(o)return o;for(var s=0,u=null,i=0;i<r.length;++i){var a=r[i],f=0;if(e)f=a.getProp("<i>").isEmpty()?1:2;else if(t){f=1;for(var c=0;c<a.args.length;++c)a.args[c].isEmpty()||++f;a.retval.isEmpty()||++f}else n?f=a.name?100:2:prims&&(f=1);f>=s&&(s=f,u=a)}return u}function s(){}function u(r,e){var t=or.props[r]||(or.props[r]=[]);t.push(e)}function f(r){return or.props[r]}function c(r){if(or.workList)return r(or.workList);var e=[],t=0,n=or.workList=function(r,n,o){t<ir-ar*e.length&&e.push(r,n,o,t)};try{for(var o=r(n),i=0;i<e.length;i+=4)t=e[i+3]+1,e[i+1].addType(e[i],e[i+2]);return o}finally{or.workList=null}}function h(r,e){r.fnType&&(r.fnType.instantiateScore=(r.fnType.instantiateScore||0)+e)}function l(r,e){var t=e.fnType.instantiateScore;if(t&&t/(r.end-r.start)>.01)return h(e.prev,t/2),g(r,e),!0}function g(r,e){for(var t=e.fnType,o=0;o<t.args.length;++o)t.args[o]=new V;t.self=new V;var i=t.computeRet=function(o,a){this.computeRet=null;var p=or.curOrigin;or.curOrigin=t.origin;var s=new pr(e.prev);for(var u in e.props)for(var f=s.defProp(u),c=0;c<a.length;++c)t.argNames[c]==u&&c<a.length&&a[c].propagate(f);if(s.fnType=new tr(t.name,o,a,t.argNames,C),t.arguments){var h=s.fnType.arguments=new V;s.defProp("arguments").addType(new nr(h));for(var c=0;c<a.length;++c)a[c].propagate(h)}return r.body.scope=s,n.recursive(r.body,s,null,sr),n.recursive(r.body,s,null,fr),this.computeRet=i,or.curOrigin=p,s.fnType.retval}}function y(r,e){function t(r,e,n){if(!(n>3)&&r.forward)for(var o=0;o<r.forward.length;++o){var a=r.forward[o].propagatesTo();if(a){var p,s=e;if(a instanceof V)p=a;else{if(!(a.target instanceof V))continue;s+=a.pathExt,p=a.target}if(p==i)return s;var u=t(p,s,n+1);if(u)return u}}}var n=e.fnType,i=n.retval;if(i!=C){var a,p;!i.isEmpty()&&(a=i.getType())instanceof nr&&(i=p=a.getProp("<i>"));for(var s=t(n.self,"!this",0),u=0;!s&&u<n.args.length;++u)s=t(n.args[u],"!"+u,0);if(s){p&&(s="["+s+"]");var f=new o.TypeParser(s);return n.computeRet=f.parseRetType(),n.computeRetSource=s,!0}}}function d(r,e){var t=r.defProp(e.name,e);return t.maybePurge&&(t.maybePurge=!1),t}function v(r,e,t){var n=r.property;return r.computed?"Literal"==n.type&&"string"==typeof n.value?n.value:(t&&E(n,e,t,C),"<i>"):n.name}function m(r,e){"FunctionExpression"==r.type&&e.propagate(new X(r.body.scope.fnType.self),2)}function P(r){switch(r){case"+":case"-":case"~":return or.num;case"!":return or.bool;case"typeof":return or.str;case"void":case"delete":return C}}function b(r){switch(r){case"==":case"!=":case"===":case"!==":case"<":case">":case">=":case"<=":case"in":case"instanceof":return!0}}function T(r){switch(typeof r){case"boolean":return or.bool;case"number":return or.num;case"string":return or.str;case"object":return r?z(or.protos.RegExp):C}}function w(r){return function(e,t,n,o,i){var a=r(e,t,n,i);return o&&a.propagate(o),a}}function x(r){return function(e,t,n,o,i){return o||(o=new V),r(e,t,n,o,i),o}}function E(r,e,t,n,o){return ur[r.type](r,e,t,n,o)}function S(r){return r<14&&r>8||32===r||160===r}function O(r,e){for(;e>0;--e){var t=r.charCodeAt(e-1);if(10==t)break;if(!S(t))return!1}return!0}function N(r,e){var t="",n=0;r:for(;e>0;){var o=r.charCodeAt(e-1);if(10==o)for(var i=--e,a=!1;i>0;--i){if(o=r.charCodeAt(i-1),47==o&&47==r.charCodeAt(i-2)){if(!O(r,i-2))break r;t=r.slice(i,e)+t,n=0,e=i-2;break}if(10==o){if(!a&&++n>1)break r;break}a||S(o)||(a=!0)}else if(47==o&&42==r.charCodeAt(e-2)){for(var i=e-2;i>1;--i)if(42==r.charCodeAt(i-1)&&47==r.charCodeAt(i-2)){if(!O(r,i-2))break r;t=r.slice(i,e-2)+"\n"+t,n=0;break}e=i-2}else{if(!S(o))break;--e}}return t}function j(r,e,t,n,o){if(e){i.interpretComments(r,t,n,e),!o&&n.types.length&&(o=n.types[n.types.length-1],o instanceof er&&o.origin==or.curOrigin&&!o.doc||(o=null));var a=e.search(/\.\s/);a>5&&(e=e.slice(0,a+1)),e=e.trim().replace(/\s*\n\s*\*\s*|\s{1,}/g," "),n.doc=e,o&&(o.doc=e)}}function A(r,e,t){var n=Array.isArray(r);return n&&1==r.length&&(r=r[0],n=!1),n?null==t?function(e){return r.indexOf(e.origin)>-1}:function(n,o){return o&&o.start>=e&&o.end<=t&&r.indexOf(n.origin)>-1}:null==t?function(e){return e.origin==r}:function(n,o){return o&&o.start>=e&&o.end<=t&&n.origin==r}}function k(r){gr=!0;var e=f(r);if(e)for(var t=0;t<e.length;++t){var n=e[t].getProp(r);if(!n.isEmpty())return n}return C}function H(r,e){var t=hr[r.type](r,e);return t}o=r.def=o.init({},r),i=r.jsdoc=i.init({},r);var F=r.toString=function(r,e,t){return r&&r!=t?r.toString(e):"?"},C=r.ANull={addType:function(){},propagate:function(){},getProp:function(){return C},forAllProps:function(){},hasType:function(){return!1},isEmpty:function(){return!0},getFunctionType:function(){},getType:function(){},gatherProperties:function(){},propagatesTo:function(){},typeHint:function(){},propHint:function(){}},R=100,B=10,G=5,M=2,V=r.AVal=function(){this.types=[],this.forward=null,this.maxWeight=0};V.prototype=a(C,{addType:function(r,e){if(e=e||R,this.maxWeight<e)this.types.length=0,this.maxWeight=e;else if(this.maxWeight>e||this.types.indexOf(r)>-1)return;this.types.push(r);var t=this.forward;t&&c(function(n){for(var o=0;o<t.length;++o)n(r,t[o],e)})},propagate:function(r,e){if(!(r==C||r instanceof Z)){e&&e<R&&(r=new Y(r,e)),(this.forward||(this.forward=[])).push(r);var t=this.types,e=this.maxWeight;t.length&&c(function(n){for(var o=0;o<t.length;++o)n(t[o],r,e)})}},getProp:function(r){if("__proto__"==r||"✖"==r)return C;var e=(this.props||(this.props=Object.create(null)))[r];return e||(e=this.props[r]=new V,this.propagate(new L(r,e))),e},forAllProps:function(r){this.propagate(new q(r))},hasType:function(r){return this.types.indexOf(r)>-1},isEmpty:function(){return 0==this.types.length},getFunctionType:function(){for(var r=this.types.length-1;r>=0;--r)if(this.types[r]instanceof tr)return this.types[r]},getType:function(r){return 0==this.types.length&&r!==!1?this.makeupType():1==this.types.length?this.types[0]:p(this.types)},makeupType:function(){if(!this.forward)return null;for(var r=this.forward.length-1;r>=0;--r){var e=this.forward[r].typeHint();if(e&&!e.isEmpty())return gr=!0,e}for(var t=Object.create(null),n=null,r=0;r<this.forward.length;++r){var o=this.forward[r].propHint();o&&"length"!=o&&"<i>"!=o&&"✖"!=o&&(t[o]=!0,n=o)}if(!n)return null;var i=f(n);if(i){var a=[];r:for(var r=0;r<i.length;++r){var s=i[r];for(var o in t)if(!s.hasProp(o))continue r;s.hasCtor&&(s=z(s)),a.push(s)}var u=p(a);if(u)return gr=!0,u}},typeHint:function(){return this.types.length?this.getType():null},propagatesTo:function(){return this},gatherProperties:function(r,e){for(var t=0;t<this.types.length;++t)this.types[t].gatherProperties(r,e)},guessProperties:function(r){if(this.forward)for(var e=0;e<this.forward.length;++e){var t=this.forward[e].propHint();t&&r(t,null,0)}}}),s.prototype=a(C,{init:function(){this.origin=or.curOrigin}});var I=r.constraint=function(r,e){var t="this.init();";r=r?r.split(", "):[];for(var n=0;n<r.length;++n)t+="this."+r[n]+" = "+r[n]+";";var o=Function.apply(null,r.concat([t]));o.prototype=Object.create(s.prototype);for(var i in e)e.hasOwnProperty(i)&&(o.prototype[i]=e[i]);return o},L=I("prop, target",{addType:function(r,e){r.getProp&&r.getProp(this.prop).propagate(this.target,e)},propHint:function(){return this.prop},propagatesTo:function(){return{target:this.target,pathExt:"."+this.prop}}}),_=r.PropHasSubset=I("prop, target, originNode",{addType:function(r,e){if(r instanceof er){var t=r.defProp(this.prop,this.originNode);t.origin=this.origin,this.target.propagate(t,e)}},propHint:function(){return this.prop}}),q=I("c",{addType:function(r){r instanceof er&&r.forAllProps(this.c)}}),D=r.IsCallee=I("self, args, argNodes, retval",{addType:function(r,e){if(r instanceof tr){for(var t=0;t<this.args.length;++t)t<r.args.length&&this.args[t].propagate(r.args[t],e),r.arguments&&this.args[t].propagate(r.arguments,e);this.self.propagate(r.self,this.self==or.topScope?M:e),r.computeRet?r.computeRet(this.self,this.args,this.argNodes).propagate(this.retval,e):r.retval.propagate(this.retval,e)}},typeHint:function(){for(var r=[],e=0;e<this.args.length;++e)r.push("?");return new tr(null,this.self,this.args,r,C)},propagatesTo:function(){return{target:this.retval,pathExt:".!ret"}}}),U=I("propName, args, argNodes, retval",{addType:function(r,e){r.getProp(this.propName).propagate(new D(r,this.args,this.argNodes,this.retval),e)},propHint:function(){return this.propName}}),W=I("target",{addType:function(r,e){r instanceof tr&&r.getProp("prototype").propagate(new $(r,this.target),e)}}),z=r.getInstance=function(r,e){e||(e=r.hasCtor),r.instances||(r.instances=[]);for(var t=0;t<r.instances.length;++t){var n=r.instances[t];if(n.ctor==e)return n.instance}var o=new er(r,e&&e.name);return o.origin=r.origin,r.instances.push({ctor:e,instance:o}),o},$=I("ctor, target",{addType:function(r,e){r instanceof er&&(r==or.protos.Array?this.target.addType(new nr):this.target.addType(z(r,this.ctor)))}}),J=I("fn",{addType:function(r,e){r instanceof er&&!r.hasCtor&&(r.hasCtor=this.fn)}}),K=I("other, target",{addType:function(r,e){r==or.str?this.target.addType(or.str,e):r==or.num&&this.other.hasType(or.num)&&this.target.addType(or.num,e)},typeHint:function(){return this.other}}),Q=I("target",{addType:function(r,e){r instanceof er&&this.target.addType(r,e)},propagatesTo:function(){return this.target}}),X=I("target",{addType:function(r,e){r instanceof er&&r.name&&/\.prototype$/.test(r.name)&&z(r).propagate(this.target,e)},propagatesTo:function(){return this.target}}),Y=I("inner, weight",{addType:function(r,e){this.inner.addType(r,Math.min(e,this.weight))},propagatesTo:function(){return this.inner.propagatesTo()},typeHint:function(){return this.inner.typeHint()},propHint:function(){return this.inner.propHint()}}),Z=r.Type=function(){};Z.prototype=a(C,{propagate:function(r,e){r.addType(this,e)},hasType:function(r){return r==this},isEmpty:function(){return!1},typeHint:function(){return this},getType:function(){return this}});var rr=r.Prim=function(r,e){this.name=e,this.proto=r};rr.prototype=a(Z.prototype,{toString:function(){return this.name},getProp:function(r){return this.proto.hasProp(r)||C},gatherProperties:function(r,e){this.proto&&this.proto.gatherProperties(r,e)}});var er=r.Obj=function(r,e){if(this.props||(this.props=Object.create(null)),this.proto=r===!0?or.protos.Object:r,r&&!e&&r.name&&!(this instanceof tr)){var t=/^(.*)\.prototype$/.exec(this.proto.name);t&&(e=t[1])}this.name=e,this.maybeProps=null,this.origin=or.curOrigin};er.prototype=a(Z.prototype,{toString:function(r){if(!r&&this.name)return this.name;var e=[],t=!1;for(var n in this.props)if("<i>"!=n){if(e.length>5){t=!0;break}r?e.push(n+": "+F(this.props[n].getType(),r-1)):e.push(n)}return e.sort(),t&&e.push("..."),"{"+e.join(", ")+"}"},hasProp:function(r,e){var t=this.props[r];if(e!==!1)for(var n=this.proto;n&&!t;n=n.proto)t=n.props[r];return t},defProp:function(r,e){var t=this.hasProp(r,!1);if(t)return e&&!t.originNode&&(t.originNode=e),t;if("__proto__"==r||"✖"==r)return C;var n=this.maybeProps&&this.maybeProps[r];return n?(delete this.maybeProps[r],this.maybeUnregProtoPropHandler()):n=new V,this.props[r]=n,n.originNode=e,n.origin=or.curOrigin,this.broadcastProp(r,n,!0),n},getProp:function(r){var e=this.hasProp(r,!0)||this.maybeProps&&this.maybeProps[r];return e?e:(this.maybeProps||(this.proto&&this.proto.forAllProps(this),this.maybeProps=Object.create(null)),this.maybeProps[r]=new V)},broadcastProp:function(r,e,t){if(t&&!this.prev&&u(r,this),this.onNewProp)for(var n=0;n<this.onNewProp.length;++n){var o=this.onNewProp[n];o.onProtoProp?o.onProtoProp(r,e,t):o(r,e,t)}},onProtoProp:function(r,e,t){var n=this.maybeProps&&this.maybeProps[r];n&&(delete this.maybeProps[r],this.maybeUnregProtoPropHandler(),this.proto.getProp(r).propagate(n)),this.broadcastProp(r,e,!1)},forAllProps:function(r){this.onNewProp||(this.onNewProp=[],this.proto&&this.proto.forAllProps(this)),this.onNewProp.push(r);for(var e=this;e;e=e.proto)for(var t in e.props)r.onProtoProp?r.onProtoProp(t,e.props[t],e==this):r(t,e.props[t],e==this)},maybeUnregProtoPropHandler:function(){if(this.maybeProps){for(var r in this.maybeProps)return;this.maybeProps=null}!this.proto||this.onNewProp&&this.onNewProp.length||this.proto.unregPropHandler(this)},unregPropHandler:function(r){for(var e=0;e<this.onNewProp.length;++e)if(this.onNewProp[e]==r){this.onNewProp.splice(e,1);break}this.maybeUnregProtoPropHandler()},gatherProperties:function(r,e){for(var t in this.props)"<i>"!=t&&r(t,this,e);this.proto&&this.proto.gatherProperties(r,e+1)}});var tr=r.Fn=function(r,e,t,n,o){er.call(this,or.protos.Function,r),this.self=e,this.args=t,this.argNames=n,this.retval=o};tr.prototype=a(er.prototype,{toString:function(r){r&&r--;for(var e="fn(",t=0;t<this.args.length;++t){t&&(e+=", ");var n=this.argNames[t];n&&"?"!=n&&(e+=n+": "),e+=F(this.args[t].getType(),r,this)}return e+=")",this.retval.isEmpty()||(e+=" -> "+F(this.retval.getType(),r,this)),e},getProp:function(r){if("prototype"==r){var e=this.hasProp(r);if(!e){e=this.defProp(r);var t=new er(!0,this.name&&this.name+".prototype");t.origin=this.origin,e.addType(t,B)}return e}return er.prototype.getProp.call(this,r)},defProp:function(r){if("prototype"==r){var e=this.hasProp(r);return e?e:(e=er.prototype.defProp.call(this,r),e.origin=this.origin,e.propagate(new J(this)),e)}return er.prototype.defProp.call(this,r)},getFunctionType:function(){return this}});var nr=r.Arr=function(r){er.call(this,or.protos.Array);var e=this.defProp("<i>");r&&r.propagate(e)};nr.prototype=a(er.prototype,{toString:function(r){return"["+F(this.getProp("<i>").getType(),r,this)+"]"}});var or=(r.Context=function(e,t){this.parent=t,this.props=Object.create(null),this.protos=Object.create(null),this.prim=Object.create(null),this.origins=[],this.curOrigin="ecma5",this.paths=Object.create(null),this.purgeGen=0,this.workList=null,r.withContext(this,function(){if(or.protos.Object=new er(null,"Object.prototype"),or.topScope=new pr,or.topScope.name="<top>",or.protos.Array=new er(!0,"Array.prototype"),or.protos.Function=new er(!0,"Function.prototype"),or.protos.RegExp=new er(!0,"RegExp.prototype"),or.protos.String=new er(!0,"String.prototype"),or.protos.Number=new er(!0,"Number.prototype"),or.protos.Boolean=new er(!0,"Boolean.prototype"),or.str=new rr(or.protos.String,"string"),or.bool=new rr(or.protos.Boolean,"bool"),or.num=new rr(or.protos.Number,"number"),or.curOrigin=null,e)for(var r=0;r<e.length;++r)o.load(e[r])})},null);r.cx=function(){return or},r.withContext=function(r,e){var t=or;or=r;try{return e()}finally{or=t}},r.addOrigin=function(r){or.origins.indexOf(r)<0&&or.origins.push(r)};var ir=20,ar=1e-4,pr=r.Scope=function(r){er.call(this,r||!0),this.prev=r};pr.prototype=a(er.prototype,{defVar:function(r,e){for(var t=this;;t=t.proto){var n=t.props[r];if(n)return n;if(!t.prev)return t.defProp(r,e)}}});var sr=n.make({Function:function(r,e,t){var n=r.body.scope=new pr(e);n.node=r;for(var o=[],i=[],a=0;a<r.params.length;++a){var p=r.params[a];i.push(p.name),o.push(d(n,p))}if(n.fnType=new tr(r.id&&r.id.name,new V,o,i,C),n.fnType.originNode=r,r.id){var s="FunctionDeclaration"==r.type;d(s?e:n,r.id)}t(r.body,n,"ScopeBody")},TryStatement:function(r,e,t){if(t(r.block,e,"Statement"),r.handler){r.handler.param.name;d(e,r.handler.param),t(r.handler.body,e,"ScopeBody")}r.finalizer&&t(r.finalizer,e,"Statement")},VariableDeclaration:function(r,e,t){for(var n=0;n<r.declarations.length;++n){var o=r.declarations[n];d(e,o.id),o.init&&t(o.init,e,"Expression")}}}),ur={ArrayExpression:w(function(r,e,t){for(var n=new V,o=0;o<r.elements.length;++o){var i=r.elements[o];i&&E(i,e,t,n)}return new nr(n)}),ObjectExpression:w(function(r,e,t,n){var o=r.objType=new er(!0,n);o.originNode=r;for(var i=0;i<r.properties.length;++i){var n,a=r.properties[i],p=a.key;if("Identifier"==p.type)n=p.name;else{if("string"!=typeof p.value){E(a.value,e,t,C);continue}n=p.value}var s=o.defProp(n,p);s.initializer=!0,E(a.value,e,t,s,n),j(a,a.key.comments,e,s),m(a.value,o)}return o}),FunctionExpression:w(function(r,e,t,n){var o=r.body.scope,i=o.fnType;return n&&!i.name&&(i.name=n),t(r.body,e,"ScopeBody"),l(r,o)||y(r,o),r.id&&o.getProp(r.id.name).addType(i),i}),SequenceExpression:w(function(r,e,t){for(var n=0,o=r.expressions.length-1;n<o;++n)E(r.expressions[n],e,t,C);return E(r.expressions[o],e,t)}),UnaryExpression:w(function(r,e,t){return E(r.argument,e,t,C),P(r.operator)}),UpdateExpression:w(function(r,e,t){return E(r.argument,e,t,C),or.num}),BinaryExpression:w(function(r,e,t){if("+"==r.operator){var n=E(r.left,e,t),o=E(r.right,e,t);if(n.hasType(or.str)||o.hasType(or.str))return or.str;if(n.hasType(or.num)&&o.hasType(or.num))return or.num;var i=new V;return n.propagate(new K(o,i)),o.propagate(new K(n,i)),i}return E(r.left,e,t,C),E(r.right,e,t,C),b(r.operator)?or.bool:or.num}),AssignmentExpression:w(function(r,e,t){var n,o,i;if("MemberExpression"==r.left.type?(i=v(r.left,e,t),"Identifier"==r.left.object.type&&(o=r.left.object.name+"."+i)):o=r.left.name,"="!=r.operator&&"+="!=r.operator?(E(r.right,e,t,C),n=or.num):n=E(r.right,e,t,null,o),"MemberExpression"==r.left.type){var a=E(r.left.object,e,t);if(a.hasType(or.topScope)||m(r.right,a),"prototype"==i&&h(e,20),"<i>"==i){var p=r.left.property.name,s=e.props[p],u=s&&s.iteratesOver;if(u){h(e,20);var f="MemberExpression"==r.right.type&&r.right.computed&&r.right.property.name==p;return u.forAllProps(function(r,e,t){t&&"prototype"!=r&&"<i>"!=r&&a.propagate(new _(r,f?e:C))}),n}}a.propagate(new _(i,n,r.left.property))}else{var p=e.defVar(r.left.name,r);p.maybePurge&&(p.maybePurge=!1),n.propagate(p)}return n}),LogicalExpression:x(function(r,e,t,n){E(r.left,e,t,n),E(r.right,e,t,n)}),ConditionalExpression:x(function(r,e,t,n){E(r.test,e,t,C),E(r.consequent,e,t,n),E(r.alternate,e,t,n)}),NewExpression:x(function(r,e,t,n){"Identifier"==r.callee.type&&r.callee.name in e.props&&h(e,20);for(var o=0,i=[];o<r.arguments.length;++o)i.push(E(r.arguments[o],e,t));var a=E(r.callee,e,t),p=new V;p.propagate(n),a.propagate(new W(p)),a.propagate(new D(p,i,r.arguments,new Q(n)))}),CallExpression:x(function(r,e,t,n){for(var o=0,i=[];o<r.arguments.length;++o)i.push(E(r.arguments[o],e,t));if("MemberExpression"==r.callee.type){var a=E(r.callee.object,e,t),p=v(r.callee,e,t);("call"==p||"apply"==p)&&e.fnType&&e.fnType.args.indexOf(a)>-1&&h(e,30),a.propagate(new U(p,i,r.arguments,n))}else{var s=E(r.callee,e,t);e.fnType&&e.fnType.args.indexOf(s)>-1&&h(e,30);var u=s.getFunctionType();u&&u.instantiateScore&&e.fnType&&h(e,u.instantiateScore/5),s.propagate(new D(or.topScope,i,r.arguments,n))}}),MemberExpression:w(function(r,e,t){var n=v(r,e),o=E(r.object,e,t).getProp(n);if("<i>"==n){var i=E(r.property,e,t);if(!i.hasType(or.num)){var a=new V;return o.propagate(a,G),a}}return o}),Identifier:w(function(r,e){return"arguments"!=r.name||!e.fnType||r.name in e.props||e.defProp(r.name,e.fnType.originNode).addType(new nr(e.fnType.arguments=new V)),e.getProp(r.name)}),ThisExpression:w(function(r,e){return e.fnType?e.fnType.self:or.topScope}),Literal:w(function(r,e){return T(r.value)})},fr=n.make({Expression:function(r,e,t){E(r,e,t,C)},FunctionDeclaration:function(r,e,t){var n=r.body.scope,o=n.fnType;t(r.body,e,"ScopeBody"),l(r,n)||y(r,n);var i=e.getProp(r.id.name);i.addType(o),j(r,r.comments,e,i,o)},VariableDeclaration:function(r,e,t){for(var n=0;n<r.declarations.length;++n){var o=r.declarations[n],i=e.getProp(o.id.name);o.init&&E(o.init,e,t,i,o.id.name),n||j(r,r.comments,e,i)}},ReturnStatement:function(r,e,t){r.argument&&e.fnType&&(e.fnType.retval==C&&(e.fnType.retval=new V),E(r.argument,e,t,e.fnType.retval))},ForInStatement:function(r,e,t){var n=E(r.right,e,t);if("Identifier"==r.right.type&&r.right.name in e.props||"MemberExpression"==r.right.type&&"prototype"==r.right.property.name){h(e,5);var o;"Identifier"==r.left.type?o=r.left.name:"VariableDeclaration"==r.left.type&&(o=r.left.declarations[0].id.name),o&&o in e.props&&(e.getProp(o).iteratesOver=n)}t(r.body,e,"Statement")},ScopeBody:function(r,e,t){t(r,r.scope||e)}}),cr=r.parse=function(r){function o(e){var t=N(r,e.start);t&&(e.comments=t)}var i;try{i=e.parse(r)}catch(e){i=t.parse_dammit(r)}return n.simple(i,{VariableDeclaration:o,FunctionDeclaration:o,ObjectExpression:function(r){for(var e=0;e<r.properties.length;++e)o(r.properties[e].key)}}),i};r.analyze=function(e,t,o){"string"==typeof e&&(e=cr(e)),t||(t="file#"+or.origins.length),r.addOrigin(or.curOrigin=t),o||(o=or.topScope),n.recursive(e,o,null,sr),n.recursive(e,o,null,fr),or.curOrigin=null},r.purgeTypes=function(r,e,t){var n=A(r,e,t);++or.purgeGen,or.topScope.purge(n);for(var o in or.props)for(var i=or.props[o],a=0;a<i.length;++a){var p=i[a];n(p,p.originNode)&&i.splice(a--,1)}},V.prototype.purge=function(r){if(this.purgeGen!=or.purgeGen){this.purgeGen=or.purgeGen;for(var e=0;e<this.types.length;++e){var t=this.types[e];r(t,t.originNode)?this.types.splice(e--,1):t.purge(r)}if(this.forward)for(var e=0;e<this.forward.length;++e){var n=this.forward[e];r(n)?(this.forward.splice(e--,1),this.props&&(this.props=null)):n.purge&&n.purge(r)}}},C.purge=function(){},er.prototype.purge=function(r){if(this.purgeGen==or.purgeGen)return!0;this.purgeGen=or.purgeGen;for(var e in this.props)this.props[e].purge(r)},tr.prototype.purge=function(r){if(!er.prototype.purge.call(this,r)){this.self.purge(r),this.retval.purge(r);for(var e=0;e<this.args.length;++e)this.args[e].purge(r)}},r.markVariablesDefinedBy=function(r,e,t,n){for(var o=A(e,t,n),i=r;i;i=i.prev)for(var a in i.props){var p=i.props[a];o(p,p.name)&&(p.maybePurge=!0)}},r.purgeMarkedVariables=function(r){for(var e=r;e;e=e.prev)for(var t in e.props)e.props[t].maybePurge&&delete e.props[t]};var hr={ArrayExpression:function(r,e){for(var t=new V,n=0;n<r.elements.length;++n){var o=r.elements[n];o&&H(o,e).propagate(t)}return new nr(t)},ObjectExpression:function(r){return r.objType},FunctionExpression:function(r){return r.body.scope.fnType},SequenceExpression:function(r,e){return H(r.expressions[r.expressions.length-1],e)},UnaryExpression:function(r){return P(r.operator)},UpdateExpression:function(){return or.num},BinaryExpression:function(r,e){if(b(r.operator))return or.bool;if("+"==r.operator){var t=H(r.left,e),n=H(r.right,e);if(t.hasType(or.str)||n.hasType(or.str))return or.str}return or.num},AssignmentExpression:function(r,e){return H(r.right,e)},LogicalExpression:function(r,e){var t=H(r.left,e);return t.isEmpty()?H(r.right,e):t},ConditionalExpression:function(r,e){var t=H(r.consequent,e);return t.isEmpty()?H(r.alternate,e):t},NewExpression:function(r,e){var t=H(r.callee,e).getFunctionType(),n=t&&t.getProp("prototype").getType();return n?z(n,t):C},CallExpression:function(r,e){var t=H(r.callee,e).getFunctionType();if(!t)return C;if(t.computeRet){for(var n=0,o=[];n<r.arguments.length;++n)o.push(H(r.arguments[n],e));var i=C;return"MemberExpression"==r.callee.type&&(i=H(r.callee.object,e)),t.computeRet(i,o,r.arguments)}return t.retval},MemberExpression:function(r,e){var t=v(r,e),n=H(r.object,e).getType();return n?n.getProp(t):"<i>"==t?C:k(t)},Identifier:function(r,e){return e.hasProp(r.name)||C},ThisExpression:function(r,e){return e.fnType?e.fnType.self:or.topScope},Literal:function(r){return T(r.value)}},lr=r.searchVisitor=n.make({Function:function(r,e,t){var n=r.body.scope;r.id&&t(r.id,n);for(var o=0;o<r.params.length;++o)t(r.params[o],n);t(r.body,n,"ScopeBody")},TryStatement:function(r,e,t){r.handler&&t(r.handler.param,e),n.base.TryStatement(r,e,t)},VariableDeclaration:function(r,e,t){for(var n=0;n<r.declarations.length;++n){var o=r.declarations[n];t(o.id,e),o.init&&t(o.init,e,"Expression")}}});r.fullVisitor=n.make({MemberExpression:function(r,e,t){t(r.object,e,"Expression"),t(r.property,e,r.computed?"Expression":null)},ObjectExpression:function(r,e,t){for(var n=0;n<r.properties.length;++n)t(r.properties[n].value,e,"Expression"),t(r.properties[n].key,e)}},lr);r.findExpressionAt=function(r,e,t,o,i){var a=i||function(r,e){return hr.hasOwnProperty(e.type)};return n.findNodeAt(r,e,t,a,lr,o||or.topScope)},r.findExpressionAround=function(r,e,t,o,i){var a=i||function(r,t){return!(null!=e&&t.start>e)&&hr.hasOwnProperty(t.type)};return n.findNodeAround(r,t,a,lr,o||or.topScope)},r.expressionType=function(r){return H(r.node,r.state)};var gr=!1;r.resetGuessing=function(r){gr=r},r.didGuess=function(){return gr},r.forAllPropertiesOf=function(r,e){r.gatherProperties(e,0)};var yr=n.make({},lr);r.findRefs=function(r,e,t,o,i){yr.Identifier=function(r,e){if(r.name==t)for(var n=e;n;n=n.prev)if(n==o&&i(r,e),t in n.props)return},n.recursive(r,e,null,yr)};var dr=n.make({Function:function(r,e,t){t(r.body,r.body.scope,"ScopeBody")}});r.findPropRefs=function(r,e,t,o,i){n.simple(r,{MemberExpression:function(r,e){r.computed||r.property.name!=o||H(r.object,e).getType()==t&&i(r.property)},ObjectExpression:function(r,e){if(H(r,e).getType()==t)for(var n=0;n<r.properties.length;++n)r.properties[n].key.name==o&&i(r.properties[n].key)}},dr,e)};var vr=r.scopeAt=function(r,e,t){var o=n.findNodeAround(r,e,"ScopeBody");return o?o.node.scope:t||or.topScope};r.forAllLocalsAt=function(r,e,t,n){var o=vr(r,e,t);o.gatherProperties(n,0)}});
//# sourceMappingURL=infer.min.js.map