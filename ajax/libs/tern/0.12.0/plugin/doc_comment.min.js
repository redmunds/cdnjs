!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn"),require("acorn/dist/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/dist/acorn","acorn/dist/walk"],e):void e(tern,tern,tern.comment,acorn,acorn.walk)}(function(e,r,n,t,a){"use strict";function i(e,r){function t(e){n.ensureCommentsBefore(r,e)}a.simple(e,{VariableDeclaration:t,FunctionDeclaration:t,AssignmentExpression:function(e){"="==e.operator&&t(e)},ObjectExpression:function(e){for(var r=0;r<e.properties.length;++r)t(e.properties[r])},CallExpression:function(e){o(e)&&t(e)}})}function o(e){return"MemberExpression"==e.callee.type&&"Object"==e.callee.object.name&&"defineProperty"==e.callee.property.name&&e.arguments.length>=3&&"string"==typeof e.arguments[1].value}function s(r,n){b(r.sourceFile.text,n),a.simple(r,{VariableDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.body.scope.fnType)},AssignmentExpression:function(r,n){r.commentsBefore&&f(r,r.commentsBefore,n,e.expressionType({node:r.left,state:n}))},ObjectExpression:function(e,r){for(var n=0;n<e.properties.length;++n){var t=e.properties[n];t.commentsBefore&&f(t,t.commentsBefore,r,e.objType.getProp(t.key.name))}},CallExpression:function(r,n){if(r.commentsBefore&&o(r)){var t=e.expressionType({node:r.arguments[0],state:n}).getObjType();if(t&&t instanceof e.Obj){var a=t.props[r.arguments[1].value];a&&f(r,r.commentsBefore,n,a)}}}},e.searchVisitor,n)}function l(r){var n=r["!typedef"],t=e.cx(),a=r["!name"];if(n)for(var i in n)t.parent.jsdocTypedefs[i]=v(e.def.parse(n[i],a,i),i)}function c(e){for(var r,n=1;n<e.length;n++){var t=e[n],a=t.match(/^[\s\*]*/)[0];if(a!=t)if(null==r)r=a;else{for(var i=0;i<r.length&&r.charCodeAt(i)==a.charCodeAt(i);)++i;i<r.length&&(r=r.slice(0,i))}}for(e=e.map(function(e,n){if(e=e.replace(/\s+$/,""),0==n&&null!=r)for(var t=0;t<r.length;t++){var a=e.indexOf(r.slice(t));if(0==a)return e.slice(r.length-t)}return null==r||0==n?e.replace(/^[\s\*]*/,""):e.length<r.length?"":e.slice(r.length)});e.length&&!e[e.length-1];)e.pop();for(;e.length&&!e[0];)e.shift();return e}function f(r,n,t,a,i){y(r,t,a,n);var o=e.cx();!i&&a instanceof e.AVal&&a.types.length&&(i=a.types[a.types.length-1],i instanceof e.Obj&&i.origin==o.curOrigin&&!i.doc||(i=null));for(var s=n.length-1;s>=0;s--){var l=c(n[s].split(/\r\n?|\n/)).join("\n");if(l){a instanceof e.AVal&&(a.doc=l),i&&(i.doc=l);break}}}function u(e,r){for(;/\s/.test(e.charAt(r));)++r;return r}function p(e){if(!t.isIdentifierStart(e.charCodeAt(0)))return!1;for(var r=1;r<e.length;r++)if(!t.isIdentifierChar(e.charCodeAt(r)))return!1;return!0}function d(e,r,n,t){for(var a=[],i=[],o=!1,s=!0;n=u(r,n),!s||r.charAt(n)!=t;s=!1){var l=r.indexOf(":",n);if(l<0)return null;var c=r.slice(n,l);if(!p(c))return null;a.push(c),n=l+1;var f=m(e,r,n);if(!f)return null;n=f.end,o=o||f.madeUp,i.push(f.type),n=u(r,n);var d=r.charAt(n);if(++n,d==t)break;if(","!=d)return null}return{labels:a,types:i,end:n,madeUp:o}}function m(r,n,t){for(var a,i=!1,o=!1;;){var s=h(r,n,t);if(!s)return null;if(o=o||s.madeUp,i?s.type.propagate(i):a=s.type,t=u(n,s.end),"|"!=n.charAt(t))break;t++,i||(i=new e.AVal,a.propagate(i),a=i)}var l=!1;return"="==n.charAt(t)&&(++t,l=!0),{type:a,end:t,isOptional:l,madeUp:o}}function h(r,n,a){a=u(n,a);var i,o=!1;if(n.indexOf("function(",a)==a){var s=d(r,n,a+9,")"),l=e.ANull;if(!s)return null;if(a=u(n,s.end),":"==n.charAt(a)){++a;var c=m(r,n,a+1);if(!c)return null;a=c.end,l=c.type,o=c.madeUp}i=new e.Fn(null,e.ANull,s.types,s.labels,l)}else if("["==n.charAt(a)){var f=m(r,n,a+1);if(!f)return null;if(a=u(n,f.end),o=f.madeUp,"]"!=n.charAt(a))return null;++a,i=new e.Arr(f.type)}else if("{"==n.charAt(a)){var p=d(r,n,a+1,"}");if(!p)return null;i=new e.Obj(!0);for(var h=0;h<p.types.length;++h){var g=i.defProp(p.labels[h]);g.initializer=!0,p.types[h].propagate(g)}a=p.end,o=p.madeUp}else if("("==n.charAt(a)){var f=m(r,n,a+1);if(!f)return null;if(a=u(n,f.end),")"!=n.charAt(a))return null;++a,i=f.type}else{var y=a;if(!t.isIdentifierStart(n.charCodeAt(a)))return null;for(;t.isIdentifierChar(n.charCodeAt(a));)++a;if(y==a)return null;var b=n.slice(y,a);if(/^(number|integer)$/i.test(b))i=e.cx().num;else if(/^bool(ean)?$/i.test(b))i=e.cx().bool;else if(/^string$/i.test(b))i=e.cx().str;else if(/^(null|undefined)$/i.test(b))i=e.ANull;else if(/^array$/i.test(b)){var f=null;if("."==n.charAt(a)&&"<"==n.charAt(a+1)){var A=m(r,n,a+2);if(!A)return null;if(a=u(n,A.end),o=A.madeUp,">"!=n.charAt(a++))return null;f=A.type}i=new e.Arr(f)}else if(/^object$/i.test(b)){if(i=new e.Obj(!0),"."==n.charAt(a)&&"<"==n.charAt(a+1)){var j=m(r,n,a+2);if(!j)return null;if(a=u(n,j.end),o=o||j.madeUp,","!=n.charAt(a++))return null;var x=m(r,n,a);if(!x)return null;if(a=u(n,x.end),o=j.madeUp||x.madeUp,">"!=n.charAt(a++))return null;x.type.propagate(i.defProp("<i>"))}}else{for(;46==n.charCodeAt(a)||t.isIdentifierChar(n.charCodeAt(a));)++a;var O,C=n.slice(y,a),T=e.cx(),P=T.parent&&T.parent.jsdocTypedefs;P&&C in P?i=P[C]:(O=e.def.parsePath(C,r).getObjType())?i=v(O,C):(T.jsdocPlaceholders||(T.jsdocPlaceholders=Object.create(null)),i=C in T.jsdocPlaceholders?T.jsdocPlaceholders[C]:T.jsdocPlaceholders[C]=new e.Obj(null,C),o=!0)}}return{type:i,end:a,madeUp:o}}function v(r,n){if(r instanceof e.Fn&&/^[A-Z]/.test(n)){var t=r.getProp("prototype").getObjType();if(t instanceof e.Obj)return e.getInstance(t)}return r}function g(e,r,n){if(n=u(r,n||0),"{"!=r.charAt(n))return null;var t=m(e,r,n+1);if(!t)return null;var a=u(r,t.end);return"}"!=r.charAt(a)?null:(t.end=a+1,t)}function y(e,r,n,t){for(var a,i,o,s,l,c,f=0;f<t.length;++f)for(var u,p=t[f],d=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?|this)\s+(.*)/g;u=d.exec(p);)if("this"==u[1]&&(c=m(r,u[2],0)))l=c,s=!0;else if(c=g(r,u[2]))switch(s=!0,u[1]){case"returns":case"return":o=c;break;case"type":a=c;break;case"param":case"arg":case"argument":var h=u[2].slice(c.end).match(/^\s*(\[?)\s*([^\]\s=]+)\s*(?:=[^\]]+\s*)?(\]?).*/);if(!h)continue;var v=h[2]+(c.isOptional||"["===h[1]&&"]"===h[3]?"?":"");(i||(i=Object.create(null)))[v]=c}s&&j(a,l,i,o,e,n)}function b(r,n){for(var t,a=e.cx(),i=/\s@typedef\s+(.*)/g;t=i.exec(r);){var o=g(n,t[1]),s=o&&t[1].slice(o.end).match(/^\s*(\S+)/);s&&(a.parent.jsdocTypedefs[s[1]]=o.type)}}function A(r,n){var t=e.cx().parent._docComment.weight;r.type.propagate(n,t||(r.madeUp?x:void 0))}function j(r,n,t,a,i,o){var s;if("VariableDeclaration"==i.type){var l=i.declarations[0];l.init&&"FunctionExpression"==l.init.type&&(s=l.init.body.scope.fnType)}else"FunctionDeclaration"==i.type?s=i.body.scope.fnType:"AssignmentExpression"==i.type?"FunctionExpression"==i.right.type&&(s=i.right.body.scope.fnType):"CallExpression"==i.type||"FunctionExpression"==i.value.type&&(s=i.value.body.scope.fnType);if(s&&(t||a||n)){if(t)for(var c=0;c<s.argNames.length;++c){var f=s.argNames[c],u=t[f];!u&&(u=t[f+"?"])&&(s.argNames[c]+="?"),u&&A(u,s.args[c])}a&&(s.retval==e.ANull&&(s.retval=new e.AVal),A(a,s.retval)),n&&A(n,s.self)}else r&&A(r,o)}var x=1,O=101;r.registerPlugin("doc_comment",function(e,r){return e.jsdocTypedefs=Object.create(null),e.on("reset",function(){e.jsdocTypedefs=Object.create(null)}),e._docComment={weight:r&&r.strong?O:void 0,fullDocs:r&&r.fullDocs},{passes:{postParse:i,postInfer:s,postLoadDef:l}}})});
//# sourceMappingURL=doc_comment.min.js.map