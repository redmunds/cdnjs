!function(r){return"object"==typeof exports&&"object"==typeof module?r(exports,require("acorn/acorn"),require("acorn/acorn_loose"),require("acorn/util/walk"),require("./def"),require("./signal")):"function"==typeof define&&define.amd?define(["exports","acorn/acorn","acorn/acorn_loose","acorn/util/walk","./def","./signal"],r):void r(self.tern||(self.tern={}),acorn,acorn,acorn.walk,tern.def,tern.signal)}(function(r,t,e,n,o,i){"use strict";function p(r,t){var e=Object.create(r);if(t)for(var n in t)e[n]=t[n];return e}function a(r){for(var t=0,e=0,n=0,o=null,i=0;i<r.length;++i){var p=r[i];if(p instanceof ir)++t;else if(p instanceof or)++e;else if(p instanceof nr)++n;else if(p instanceof er){if(o&&p.name!=o.name)return null;o=p}}var a=(t&&1)+(e&&1)+(n&&1)+(o&&1);if(a>1)return null;if(o)return o;for(var s=0,u=null,i=0;i<r.length;++i){var p=r[i],f=0;if(t)f=p.getProp("<i>").isEmpty()?1:2;else if(e){f=1;for(var c=0;c<p.args.length;++c)p.args[c].isEmpty()||++f;p.retval.isEmpty()||++f}else n?f=p.name?100:2:prims&&(f=1);f>=s&&(s=f,u=p)}return u}function s(){}function u(r,t){D={fn:r,prev:D};try{return t()}finally{D=D.prev}}function f(r,t){var e=pr.props[r]||(pr.props[r]=[]);e.push(t)}function c(r){return pr.props[r]}function h(r){if(pr.workList)return r(pr.workList);var t=[],e=0,n=pr.workList=function(r,n,o){e<ar-sr*t.length&&t.push(r,n,o,e)};try{for(var o=r(n),i=0;i<t.length;i+=4)e=t[i+3]+1,t[i+1].addType(t[i],t[i+2]);return o}finally{pr.workList=null}}function l(r,t){r.fnType&&(r.fnType.instantiateScore=(r.fnType.instantiateScore||0)+t)}function g(r,t){try{return n.simple(r,{Expression:function(){if(--t<=0)throw fr}}),!0}catch(r){if(r==fr)return!1;throw r}}function y(r,t){var e=t.fnType.instantiateScore;return!D&&e&&t.fnType.args.length&&g(r,5*e)?(l(t.prev,e/2),d(r,t),!0):void(t.fnType.instantiateScore=null)}function d(r,t){for(var e=t.fnType,o=0;o<e.args.length;++o)e.args[o]=new L;e.self=new L,e.computeRet=function(o,i){return u(e,function(){var p=pr.curOrigin;pr.curOrigin=e.origin;var a=new ur(t.prev);for(var s in t.props)for(var u=a.defProp(s),f=0;f<i.length;++f)e.argNames[f]==s&&f<i.length&&i[f].propagate(u);for(var c=e.argNames.length!=i.length?e.argNames.slice(0,i.length):e.argNames;c.length<i.length;)c.push("?");if(a.fnType=new or(e.name,o,i,c,H),e.arguments){var h=a.fnType.arguments=new L;a.defProp("arguments").addType(new ir(h));for(var f=0;f<i.length;++f)i[f].propagate(h)}return r.body.scope=a,n.recursive(r.body,a,null,cr),n.recursive(r.body,a,null,lr),pr.curOrigin=p,a.fnType.retval})}}function v(r){function t(r,e,o){if(!(o>3)&&r.forward)for(var i=0;i<r.forward.length;++i){var p=r.forward[i].propagatesTo();if(p){var a,s=e;if(p instanceof L)a=p;else{if(!(p.target instanceof L))continue;s+=p.pathExt,a=p.target}if(a==n)return s;var u=t(a,s,o+1);if(u)return u}}}var e=r.fnType,n=e.retval;if(n!=H){var i,p;!n.isEmpty()&&(i=n.getType())instanceof ir&&(n=p=i.getProp("<i>"));for(var a=t(e.self,"!this",0),s=0;!a&&s<e.args.length;++s)a=t(e.args[s],"!"+s,0);if(a){p&&(a="["+a+"]");var u=new o.TypeParser(a);return e.computeRet=u.parseRetType(),e.computeRetSource=a,!0}}}function m(r,t){var e=r.defProp(t.name,t);return e.maybePurge&&(e.maybePurge=!1),e}function P(r,t,e){var n=r.property;return r.computed?"Literal"==n.type&&"string"==typeof n.value?n.value:(e&&S(n,t,e,H),"<i>"):n.name}function b(r){switch(r){case"+":case"-":case"~":return pr.num;case"!":return pr.bool;case"typeof":return pr.str;case"void":case"delete":return H}}function T(r){switch(r){case"==":case"!=":case"===":case"!==":case"<":case">":case">=":case"<=":case"in":case"instanceof":return!0}}function w(r){switch(typeof r){case"boolean":return pr.bool;case"number":return pr.num;case"string":return pr.str;case"object":return r?J(pr.protos.RegExp):H}}function x(r){return function(t,e,n,o,i){var p=r(t,e,n,i);return o&&p.propagate(o),p}}function E(r){return function(t,e,n,o,i){return o||(o=new L),r(t,e,n,o,i),o}}function S(r,t,e,n,o){return hr[r.type](r,t,e,n,o)}function N(r,t){var e=r&&r[t],n=Array.prototype.slice.call(arguments,2);if(e)for(var o=0;o<e.length;++o)e[o].apply(null,n)}function O(r,t,e){var n=Array.isArray(r);return n&&1==r.length&&(r=r[0],n=!1),n?null==e?function(t){return r.indexOf(t.origin)>-1}:function(n,o){return o&&o.start>=t&&o.end<=e&&r.indexOf(n.origin)>-1}:null==e?function(t){return t.origin==r}:function(n,o){return o&&o.start>=t&&o.end<=e&&n.origin==r}}function j(r){vr=!0;var t=c(r);if(t)for(var e=0;e<t.length;++e){var n=t[e].getProp(r);if(!n.isEmpty())return n}return H}function A(r,t){var e=yr[r.type](r,t);return e}var k=r.toString=function(r,t,e){return r&&r!=e?r.toString(t):"?"},H=r.ANull=i.mixin({addType:function(){},propagate:function(){},getProp:function(){return H},forAllProps:function(){},hasType:function(){return!1},isEmpty:function(){return!0},getFunctionType:function(){},getType:function(){},gatherProperties:function(){},propagatesTo:function(){},typeHint:function(){},propHint:function(){}}),F=100,I=90,R=10,B=5,C=5,G=2,M=2,L=r.AVal=function(){this.types=[],this.forward=null,this.maxWeight=0};L.prototype=p(H,{addType:function(r,t){if(t=t||F,this.maxWeight<t){if(this.maxWeight=t,1==this.types.length&&this.types[0]==r)return;this.types.length=0}else if(this.maxWeight>t||this.types.indexOf(r)>-1)return;this.signal("addType",r),this.types.push(r);var e=this.forward;e&&h(function(n){for(var o=0;o<e.length;++o)n(r,e[o],t)})},propagate:function(r,t){if(!(r==H||r instanceof tr)){t&&t<F&&(r=new rr(r,t)),(this.forward||(this.forward=[])).push(r);var e=this.types,t=this.maxWeight;e.length&&h(function(n){for(var o=0;o<e.length;++o)n(e[o],r,t)})}},getProp:function(r){if("__proto__"==r||"✖"==r)return H;var t=(this.props||(this.props=Object.create(null)))[r];return t||(t=this.props[r]=new L,this.propagate(new _(r,t))),t},forAllProps:function(r){this.propagate(new U(r))},hasType:function(r){return this.types.indexOf(r)>-1},isEmpty:function(){return 0==this.types.length},getFunctionType:function(){for(var r=this.types.length-1;r>=0;--r)if(this.types[r]instanceof or)return this.types[r]},getType:function(r){return 0==this.types.length&&r!==!1?this.makeupType():1==this.types.length?this.types[0]:a(this.types)},makeupType:function(){if(!this.forward)return null;for(var r=this.forward.length-1;r>=0;--r){var t=this.forward[r].typeHint();if(t&&!t.isEmpty())return vr=!0,t}for(var e=Object.create(null),n=null,r=0;r<this.forward.length;++r){var o=this.forward[r].propHint();o&&"length"!=o&&"<i>"!=o&&"✖"!=o&&(e[o]=!0,n=o)}if(!n)return null;var i=c(n);if(i){var p=[];r:for(var r=0;r<i.length;++r){var s=i[r];for(var o in e)if(!s.hasProp(o))continue r;s.hasCtor&&(s=J(s)),p.push(s)}var u=a(p);if(u)return vr=!0,u}},typeHint:function(){return this.types.length?this.getType():null},propagatesTo:function(){return this},gatherProperties:function(r,t){for(var e=0;e<this.types.length;++e)this.types[e].gatherProperties(r,t)},guessProperties:function(r){if(this.forward)for(var t=0;t<this.forward.length;++t){var e=this.forward[t].propHint();e&&r(e,null,0)}}}),s.prototype=p(H,{init:function(){this.origin=pr.curOrigin}});var V=r.constraint=function(r,t){var e="this.init();";r=r?r.split(", "):[];for(var n=0;n<r.length;++n)e+="this."+r[n]+" = "+r[n]+";";var o=Function.apply(null,r.concat([e]));o.prototype=Object.create(s.prototype);for(var i in t)t.hasOwnProperty(i)&&(o.prototype[i]=t[i]);return o},_=V("prop, target",{addType:function(r,t){r.getProp&&r.getProp(this.prop).propagate(this.target,t)},propHint:function(){return this.prop},propagatesTo:function(){return{target:this.target,pathExt:"."+this.prop}}}),q=r.PropHasSubset=V("prop, type, originNode",{addType:function(r,t){if(r instanceof nr){var e=r.defProp(this.prop,this.originNode);e.origin=this.origin,this.type.propagate(e,t)}},propHint:function(){return this.prop}}),U=V("c",{addType:function(r){r instanceof nr&&r.forAllProps(this.c)}}),D=null,W=r.IsCallee=V("self, args, argNodes, retval",{init:function(){s.prototype.init(),this.disabled=D},addType:function(r,t){if(r instanceof or){for(var e=0;e<this.args.length;++e)e<r.args.length&&this.args[e].propagate(r.args[e],t),r.arguments&&this.args[e].propagate(r.arguments,t);this.self.propagate(r.self,this.self==pr.topScope?G:t);var n=r.computeRet;if(n)for(var o=this.disabled;o;o=o.prev)o.fn==r&&(n=null);n?n(this.self,this.args,this.argNodes).propagate(this.retval,t):r.retval.propagate(this.retval,t)}},typeHint:function(){for(var r=[],t=0;t<this.args.length;++t)r.push("?");return new or(null,this.self,this.args,r,H)},propagatesTo:function(){return{target:this.retval,pathExt:".!ret"}}}),z=V("propName, args, argNodes, retval",{addType:function(r,t){r.getProp(this.propName).propagate(new W(r,this.args,this.argNodes,this.retval),t)},propHint:function(){return this.propName}}),$=r.IsCtor=V("target, noReuse",{addType:function(r,t){r instanceof or&&r.getProp("prototype").propagate(new K(!this.noReuse&&r,this.target),t)}}),J=r.getInstance=function(r,t){if(t===!1)return new nr(r);t||(t=r.hasCtor),r.instances||(r.instances=[]);for(var e=0;e<r.instances.length;++e){var n=r.instances[e];if(n.ctor==t)return n.instance}var o=new nr(r,t&&t.name);return o.origin=r.origin,r.instances.push({ctor:t,instance:o}),o},K=r.IsProto=V("ctor, target",{addType:function(r,t){r instanceof nr&&(r==pr.protos.Array?this.target.addType(new ir):this.target.addType(J(r,this.ctor)))}}),Q=V("fn",{addType:function(r,t){if(r instanceof nr&&!r.hasCtor){r.hasCtor=this.fn;var e=new Z(r,this.fn);e.addType(this.fn),r.forAllProps(function(r,t,n){n&&t.propagate(e)})}}}),X=V("other, target",{addType:function(r,t){r==pr.str?this.target.addType(pr.str,t):r==pr.num&&this.other.hasType(pr.num)&&this.target.addType(pr.num,t)},typeHint:function(){return this.other}}),Y=V("target",{addType:function(r,t){r instanceof nr&&this.target.addType(r,t)},propagatesTo:function(){return this.target}}),Z=V("obj, ctor",{addType:function(r){r instanceof or&&r.self&&r.self.isEmpty()&&r.self.addType(J(this.obj,this.ctor),M)}}),rr=V("inner, weight",{addType:function(r,t){this.inner.addType(r,Math.min(t,this.weight))},propagatesTo:function(){return this.inner.propagatesTo()},typeHint:function(){return this.inner.typeHint()},propHint:function(){return this.inner.propHint()}}),tr=r.Type=function(){};tr.prototype=p(H,{propagate:function(r,t){r.addType(this,t)},hasType:function(r){return r==this},isEmpty:function(){return!1},typeHint:function(){return this},getType:function(){return this}});var er=r.Prim=function(r,t){this.name=t,this.proto=r};er.prototype=p(tr.prototype,{toString:function(){return this.name},getProp:function(r){return this.proto.hasProp(r)||H},gatherProperties:function(r,t){this.proto&&this.proto.gatherProperties(r,t)}});var nr=r.Obj=function(r,t){if(this.props||(this.props=Object.create(null)),this.proto=r===!0?pr.protos.Object:r,r&&!t&&r.name&&!(this instanceof or)){var e=/^(.*)\.prototype$/.exec(this.proto.name);e&&(t=e[1])}this.name=t,this.maybeProps=null,this.origin=pr.curOrigin};nr.prototype=p(tr.prototype,{toString:function(r){if(!r&&this.name)return this.name;var t=[],e=!1;for(var n in this.props)if("<i>"!=n){if(t.length>5){e=!0;break}r?t.push(n+": "+k(this.props[n].getType(),r-1)):t.push(n)}return t.sort(),e&&t.push("..."),"{"+t.join(", ")+"}"},hasProp:function(r,t){var e=this.props[r];if(t!==!1)for(var n=this.proto;n&&!e;n=n.proto)e=n.props[r];return e},defProp:function(r,t){var e=this.hasProp(r,!1);if(e)return t&&!e.originNode&&(e.originNode=t),e;if("__proto__"==r||"✖"==r)return H;var n=this.maybeProps&&this.maybeProps[r];return n?(delete this.maybeProps[r],this.maybeUnregProtoPropHandler()):n=new L,this.props[r]=n,n.originNode=t,n.origin=pr.curOrigin,this.broadcastProp(r,n,!0),n},getProp:function(r){var t=this.hasProp(r,!0)||this.maybeProps&&this.maybeProps[r];return t?t:(this.maybeProps||(this.proto&&this.proto.forAllProps(this),this.maybeProps=Object.create(null)),this.maybeProps[r]=new L)},broadcastProp:function(r,t,e){if(e&&(this.signal("addProp",r,t),this instanceof ur||f(r,this)),this.onNewProp)for(var n=0;n<this.onNewProp.length;++n){var o=this.onNewProp[n];o.onProtoProp?o.onProtoProp(r,t,e):o(r,t,e)}},onProtoProp:function(r,t,e){var n=this.maybeProps&&this.maybeProps[r];n&&(delete this.maybeProps[r],this.maybeUnregProtoPropHandler(),this.proto.getProp(r).propagate(n)),this.broadcastProp(r,t,!1)},forAllProps:function(r){this.onNewProp||(this.onNewProp=[],this.proto&&this.proto.forAllProps(this)),this.onNewProp.push(r);for(var t=this;t;t=t.proto)for(var e in t.props)r.onProtoProp?r.onProtoProp(e,t.props[e],t==this):r(e,t.props[e],t==this)},maybeUnregProtoPropHandler:function(){if(this.maybeProps){for(var r in this.maybeProps)return;this.maybeProps=null}!this.proto||this.onNewProp&&this.onNewProp.length||this.proto.unregPropHandler(this)},unregPropHandler:function(r){for(var t=0;t<this.onNewProp.length;++t)if(this.onNewProp[t]==r){this.onNewProp.splice(t,1);break}this.maybeUnregProtoPropHandler()},gatherProperties:function(r,t){for(var e in this.props)"<i>"!=e&&r(e,this,t);this.proto&&this.proto.gatherProperties(r,t+1)}});var or=r.Fn=function(r,t,e,n,o){nr.call(this,pr.protos.Function,r),this.self=t,this.args=e,this.argNames=n,this.retval=o};or.prototype=p(nr.prototype,{toString:function(r){r&&r--;for(var t="fn(",e=0;e<this.args.length;++e){e&&(t+=", ");var n=this.argNames[e];n&&"?"!=n&&(t+=n+": "),t+=k(this.args[e].getType(),r,this)}return t+=")",this.retval.isEmpty()||(t+=" -> "+k(this.retval.getType(),r,this)),t},getProp:function(r){if("prototype"==r){var t=this.hasProp(r);if(!t){t=this.defProp(r);var e=new nr(!0,this.name&&this.name+".prototype");e.origin=this.origin,t.addType(e,R)}return t}return nr.prototype.getProp.call(this,r)},defProp:function(r,t){if("prototype"==r){var e=this.hasProp(r);return e?e:(e=nr.prototype.defProp.call(this,r,t),e.origin=this.origin,e.propagate(new Q(this)),e)}return nr.prototype.defProp.call(this,r,t)},getFunctionType:function(){return this}});var ir=r.Arr=function(r){nr.call(this,pr.protos.Array);var t=this.defProp("<i>");r&&r.propagate(t)};ir.prototype=p(nr.prototype,{toString:function(r){return"["+k(this.getProp("<i>").getType(),r,this)+"]"}}),r.Context=function(t,e){this.parent=e,this.props=Object.create(null),this.protos=Object.create(null),this.prim=Object.create(null),this.origins=[],this.curOrigin="ecma5",this.paths=Object.create(null),this.definitions=Object.create(null),this.purgeGen=0,this.workList=null,r.withContext(this,function(){if(pr.protos.Object=new nr(null,"Object.prototype"),pr.topScope=new ur,pr.topScope.name="<top>",pr.protos.Array=new nr(!0,"Array.prototype"),pr.protos.Function=new nr(!0,"Function.prototype"),pr.protos.RegExp=new nr(!0,"RegExp.prototype"),pr.protos.String=new nr(!0,"String.prototype"),pr.protos.Number=new nr(!0,"Number.prototype"),pr.protos.Boolean=new nr(!0,"Boolean.prototype"),pr.str=new er(pr.protos.String,"string"),pr.bool=new er(pr.protos.Boolean,"bool"),pr.num=new er(pr.protos.Number,"number"),pr.curOrigin=null,t)for(var r=0;r<t.length;++r)o.load(t[r])})};var pr=null;r.cx=function(){return pr},r.withContext=function(r,t){var e=pr;pr=r;try{return t()}finally{pr=e}},r.addOrigin=function(r){pr.origins.indexOf(r)<0&&pr.origins.push(r)};var ar=20,sr=1e-4,ur=r.Scope=function(r){nr.call(this,r||!0),this.prev=r};ur.prototype=p(nr.prototype,{defVar:function(r,t){for(var e=this;;e=e.proto){var n=e.props[r];if(n)return n;if(!e.prev)return e.defProp(r,t)}}});var fr={},cr=n.make({Function:function(r,t,e){var n=r.body.scope=new ur(t);n.node=r;for(var o=[],i=[],p=0;p<r.params.length;++p){var a=r.params[p];i.push(a.name),o.push(m(n,a))}if(n.fnType=new or(r.id&&r.id.name,new L,o,i,H),n.fnType.originNode=r,r.id){var s="FunctionDeclaration"==r.type;m(s?t:n,r.id)}e(r.body,n,"ScopeBody")},TryStatement:function(r,t,e){if(e(r.block,t,"Statement"),r.handler){var n=m(t,r.handler.param);e(r.handler.body,t,"ScopeBody");var o=pr.definitions.ecma5;o&&n.isEmpty()&&J(o["Error.prototype"]).propagate(n,C)}r.finalizer&&e(r.finalizer,t,"Statement")},VariableDeclaration:function(r,t,e){for(var n=0;n<r.declarations.length;++n){var o=r.declarations[n];m(t,o.id),o.init&&e(o.init,t,"Expression")}}}),hr={ArrayExpression:x(function(r,t,e){for(var n=new L,o=0;o<r.elements.length;++o){var i=r.elements[o];i&&S(i,t,e,n)}return new ir(n)}),ObjectExpression:x(function(r,t,e,n){var o=r.objType=new nr(!0,n);o.originNode=r;for(var i=0;i<r.properties.length;++i){var n,p=r.properties[i],a=p.key;if("Identifier"==a.type)n=a.name;else{if("string"!=typeof a.value){S(p.value,t,e,H);continue}n=a.value}var s=o.defProp(n,a);s.initializer=!0,S(p.value,t,e,s,n)}return o}),FunctionExpression:x(function(r,t,e,n){var o=r.body.scope,i=o.fnType;return n&&!i.name&&(i.name=n),e(r.body,t,"ScopeBody"),y(r,o)||v(o),r.id&&o.getProp(r.id.name).addType(i),i}),SequenceExpression:x(function(r,t,e){for(var n=0,o=r.expressions.length-1;n<o;++n)S(r.expressions[n],t,e,H);return S(r.expressions[o],t,e)}),UnaryExpression:x(function(r,t,e){return S(r.argument,t,e,H),b(r.operator)}),UpdateExpression:x(function(r,t,e){return S(r.argument,t,e,H),pr.num}),BinaryExpression:x(function(r,t,e){if("+"==r.operator){var n=S(r.left,t,e),o=S(r.right,t,e);if(n.hasType(pr.str)||o.hasType(pr.str))return pr.str;if(n.hasType(pr.num)&&o.hasType(pr.num))return pr.num;var i=new L;return n.propagate(new X(o,i)),o.propagate(new X(n,i)),i}return S(r.left,t,e,H),S(r.right,t,e,H),T(r.operator)?pr.bool:pr.num}),AssignmentExpression:x(function(r,t,e){var n,o,i;if("MemberExpression"==r.left.type?(i=P(r.left,t,e),"Identifier"==r.left.object.type&&(o=r.left.object.name+"."+i)):o=r.left.name,"="!=r.operator&&"+="!=r.operator?(S(r.right,t,e,H),n=pr.num):n=S(r.right,t,e,null,o),"MemberExpression"==r.left.type){var p=S(r.left.object,t,e);if("prototype"==i&&l(t,20),"<i>"==i){var a=r.left.property.name,s=t.props[a],u=s&&s.iteratesOver;if(u){l(t,20);var f="MemberExpression"==r.right.type&&r.right.computed&&r.right.property.name==a;return u.forAllProps(function(r,t,e){e&&"prototype"!=r&&"<i>"!=r&&p.propagate(new q(r,f?t:H))}),n}}p.propagate(new q(i,n,r.left.property))}else{var a=t.defVar(r.left.name,r.left);a.maybePurge&&(a.maybePurge=!1),n.propagate(a)}return n}),LogicalExpression:E(function(r,t,e,n){S(r.left,t,e,n),S(r.right,t,e,n)}),ConditionalExpression:E(function(r,t,e,n){S(r.test,t,e,H),S(r.consequent,t,e,n),S(r.alternate,t,e,n)}),NewExpression:E(function(r,t,e,n,o){"Identifier"==r.callee.type&&r.callee.name in t.props&&l(t,20);for(var i=0,p=[];i<r.arguments.length;++i)p.push(S(r.arguments[i],t,e));var a=S(r.callee,t,e),s=new L;a.propagate(new $(s,o&&/\.prototype$/.test(o))),s.propagate(n,I),a.propagate(new W(s,p,r.arguments,new Y(n)))}),CallExpression:E(function(r,t,e,n){for(var o=0,i=[];o<r.arguments.length;++o)i.push(S(r.arguments[o],t,e));if("MemberExpression"==r.callee.type){var p=S(r.callee.object,t,e),a=P(r.callee,t,e);("call"==a||"apply"==a)&&t.fnType&&t.fnType.args.indexOf(p)>-1&&l(t,30),p.propagate(new z(a,i,r.arguments,n))}else{var s=S(r.callee,t,e);t.fnType&&t.fnType.args.indexOf(s)>-1&&l(t,30);var u=s.getFunctionType();u&&u.instantiateScore&&t.fnType&&l(t,u.instantiateScore/5),s.propagate(new W(pr.topScope,i,r.arguments,n))}}),MemberExpression:x(function(r,t,e){var n=P(r,t),o=S(r.object,t,e),i=o.getProp(n);if("<i>"==n){var p=S(r.property,t,e);if(!p.hasType(pr.num)){var a=new L;return i.propagate(a,B),a}}return i}),Identifier:x(function(r,t){return"arguments"!=r.name||!t.fnType||r.name in t.props||t.defProp(r.name,t.fnType.originNode).addType(new ir(t.fnType.arguments=new L)),t.getProp(r.name)}),ThisExpression:x(function(r,t){return t.fnType?t.fnType.self:pr.topScope}),Literal:x(function(r){return w(r.value)})},lr=n.make({Expression:function(r,t,e){S(r,t,e,H)},FunctionDeclaration:function(r,t,e){var n=r.body.scope,o=n.fnType;e(r.body,t,"ScopeBody"),y(r,n)||v(n);var i=t.getProp(r.id.name);i.addType(o)},VariableDeclaration:function(r,t,e){for(var n=0;n<r.declarations.length;++n){var o=r.declarations[n],i=t.getProp(o.id.name);o.init&&S(o.init,t,e,i,o.id.name)}},ReturnStatement:function(r,t,e){r.argument&&t.fnType&&(t.fnType.retval==H&&(t.fnType.retval=new L),S(r.argument,t,e,t.fnType.retval))},ForInStatement:function(r,t,e){var n=S(r.right,t,e);if("Identifier"==r.right.type&&r.right.name in t.props||"MemberExpression"==r.right.type&&"prototype"==r.right.property.name){l(t,5);var o;"Identifier"==r.left.type?o=r.left.name:"VariableDeclaration"==r.left.type&&(o=r.left.declarations[0].id.name),o&&o in t.props&&(t.getProp(o).iteratesOver=n)}e(r.body,t,"Statement")},ScopeBody:function(r,t,e){e(r,r.scope||t)}}),gr=r.parse=function(r,n){var o;try{o=t.parse(r)}catch(t){o=e.parse_dammit(r)}return N(n,"postParse",o,r),o};r.analyze=function(t,e,o,i){"string"==typeof t&&(t=gr(t)),e||(e="file#"+pr.origins.length),r.addOrigin(pr.curOrigin=e),o||(o=pr.topScope),n.recursive(t,o,null,cr),N(i,"preInfer",t,o),n.recursive(t,o,null,lr),N(i,"postInfer",t,o),pr.curOrigin=null},r.purgeTypes=function(r,t,e){var n=O(r,t,e);++pr.purgeGen,pr.topScope.purge(n);for(var o in pr.props)for(var i=pr.props[o],p=0;p<i.length;++p){var a=i[p];n(a,a.originNode)&&i.splice(p--,1)}},L.prototype.purge=function(r){if(this.purgeGen!=pr.purgeGen){this.purgeGen=pr.purgeGen;for(var t=0;t<this.types.length;++t){var e=this.types[t];r(e,e.originNode)?this.types.splice(t--,1):e.purge(r)}if(this.forward)for(var t=0;t<this.forward.length;++t){var n=this.forward[t];r(n)?(this.forward.splice(t--,1),this.props&&(this.props=null)):n.purge&&n.purge(r)}}},H.purge=function(){},nr.prototype.purge=function(r){if(this.purgeGen==pr.purgeGen)return!0;this.purgeGen=pr.purgeGen;for(var t in this.props)this.props[t].purge(r)},or.prototype.purge=function(r){if(!nr.prototype.purge.call(this,r)){this.self.purge(r),this.retval.purge(r);for(var t=0;t<this.args.length;++t)this.args[t].purge(r)}},r.markVariablesDefinedBy=function(r,t,e,n){for(var o=O(t,e,n),i=r;i;i=i.prev)for(var p in i.props){var a=i.props[p];o(a,a.originNode)&&(a.maybePurge=!0,null==e&&a.originNode&&(a.originNode=null))}},r.purgeMarkedVariables=function(r){for(var t=r;t;t=t.prev)for(var e in t.props)t.props[e].maybePurge&&delete t.props[e]};var yr={ArrayExpression:function(r,t){for(var e=new L,n=0;n<r.elements.length;++n){var o=r.elements[n];o&&A(o,t).propagate(e)}return new ir(e)},ObjectExpression:function(r){return r.objType},FunctionExpression:function(r){return r.body.scope.fnType},SequenceExpression:function(r,t){return A(r.expressions[r.expressions.length-1],t)},UnaryExpression:function(r){return b(r.operator)},UpdateExpression:function(){return pr.num},BinaryExpression:function(r,t){if(T(r.operator))return pr.bool;if("+"==r.operator){var e=A(r.left,t),n=A(r.right,t);if(e.hasType(pr.str)||n.hasType(pr.str))return pr.str}return pr.num},AssignmentExpression:function(r,t){return A(r.right,t)},LogicalExpression:function(r,t){var e=A(r.left,t);return e.isEmpty()?A(r.right,t):e},ConditionalExpression:function(r,t){var e=A(r.consequent,t);return e.isEmpty()?A(r.alternate,t):e},NewExpression:function(r,t){var e=A(r.callee,t).getFunctionType(),n=e&&e.getProp("prototype").getType();return n?J(n,e):H},CallExpression:function(r,t){var e=A(r.callee,t).getFunctionType();if(!e)return H;if(e.computeRet){for(var n=0,o=[];n<r.arguments.length;++n)o.push(A(r.arguments[n],t));var i=H;return"MemberExpression"==r.callee.type&&(i=A(r.callee.object,t)),e.computeRet(i,o,r.arguments)}return e.retval},MemberExpression:function(r,t){var e=P(r,t),n=A(r.object,t).getType();return n?n.getProp(e):"<i>"==e?H:j(e)},Identifier:function(r,t){return t.hasProp(r.name)||H},ThisExpression:function(r,t){return t.fnType?t.fnType.self:pr.topScope},Literal:function(r){return w(r.value)}},dr=r.searchVisitor=n.make({Function:function(r,t,e){var n=r.body.scope;r.id&&e(r.id,n);for(var o=0;o<r.params.length;++o)e(r.params[o],n);e(r.body,n,"ScopeBody")},TryStatement:function(r,t,e){r.handler&&e(r.handler.param,t),n.base.TryStatement(r,t,e)},VariableDeclaration:function(r,t,e){for(var n=0;n<r.declarations.length;++n){var o=r.declarations[n];e(o.id,t),o.init&&e(o.init,t,"Expression")}}});r.fullVisitor=n.make({MemberExpression:function(r,t,e){e(r.object,t,"Expression"),e(r.property,t,r.computed?"Expression":null)},ObjectExpression:function(r,t,e){for(var n=0;n<r.properties.length;++n)e(r.properties[n].value,t,"Expression"),e(r.properties[n].key,t)}},dr),r.findExpressionAt=function(r,t,e,o,i){var p=i||function(r,t){return yr.hasOwnProperty(t.type)};return n.findNodeAt(r,t,e,p,dr,o||pr.topScope)},r.findExpressionAround=function(r,t,e,o,i){var p=i||function(r,e){return!(null!=t&&e.start>t)&&yr.hasOwnProperty(e.type)};return n.findNodeAround(r,e,p,dr,o||pr.topScope)},r.expressionType=function(r){return A(r.node,r.state)};var vr=!1;r.resetGuessing=function(r){vr=r},r.didGuess=function(){return vr},r.forAllPropertiesOf=function(r,t){r.gatherProperties(t,0)};var mr=n.make({},dr);r.findRefs=function(r,t,e,o,i){mr.Identifier=function(r,t){if(r.name==e)for(var n=t;n;n=n.prev)if(n==o&&i(r,t),e in n.props)return},n.recursive(r,t,null,mr)};var Pr=n.make({Function:function(r,t,e){e(r.body,r.body.scope,"ScopeBody")}});r.findPropRefs=function(r,t,e,o,i){n.simple(r,{MemberExpression:function(r,t){r.computed||r.property.name!=o||A(r.object,t).getType()==e&&i(r.property)},ObjectExpression:function(r,t){if(A(r,t).getType()==e)for(var n=0;n<r.properties.length;++n)r.properties[n].key.name==o&&i(r.properties[n].key)}},Pr,t)};var br=r.scopeAt=function(r,t,e){var o=n.findNodeAround(r,t,function(r,t){return"ScopeBody"==r&&t.scope});return o?o.node.scope:e||pr.topScope};r.forAllLocalsAt=function(r,t,e,n){var o=br(r,t,e);o.gatherProperties(n,0)},o=r.def=o.init({},r)});
//# sourceMappingURL=infer.min.js.map