!function(t){return"object"==typeof exports&&"object"==typeof module?t(exports,require("./infer")):"function"==typeof define&&define.amd?define(["exports","./infer"],t):void t(self.tern||(self.tern={}),tern)}(function(t,r){"use strict";function e(t){for(var r,e=1,i=0;(r=t.indexOf(".",i))!=-1;)i=r+1,e+="!"==t.charAt(i)?10:1;return e}function i(t,r){return t.sources.indexOf(r)>-1}function o(t,r,o,n){var s=t.getType(!1);if(s){var a=r?t.origin||s.origin:-1;if(a){var p=o.cx.origins.indexOf(a);if(p<n||r&&p>o.maxOrigin)return;n!=-1&&n<o.minOrigin&&i(o,a)&&r.indexOf("!")<0&&o.addedToForeign.indexOf(r)<0&&o.addedToForeign.push(s,r),n=p}s.path&&e(s.path)<=e(r)||s.setPath(r,o,n)}}function n(t,r,e){var i=t.getType(!1);if(!i)return"?";var o=i.path&&r.paths[i.path];if(o)return i.path;if(r.seen.indexOf(t)>-1)return t.path||"?";r.seen.push(t);var n=i.getDesc(r,!e&&s(r,t),e);return r.seen.pop(),n}function s(t,r,e){if(0==t.options.spans)return null;if(r.span)return r.span;if(!r.originNode)return e;var i=t.cx.parent,o=i&&i.findFile(r.origin);if(!o)return e;var n=o.asLineChar(r.originNode.start),s=o.asLineChar(r.originNode.end);return r.originNode.start+"["+n.line+":"+n.ch+"]-"+r.originNode.end+"["+s.line+":"+s.ch+"]"}function a(t,r){return r&&("string"==typeof t&&(t={"!type":t}),t["!span"]=r),t}function p(t){if(t.doc||t.originNode)return!0;for(var r in t.props)return!0}function h(t,r,e){for(var o in t.props){var s=t.props[o];i(e,s.origin)&&(r[o]=n(s,e))}}function f(t,r){if(t._fromProto)return!0;if(t.proto&&t.proto!=r.cx.protos.Object&&t.proto.hasCtor&&!t.hasCtor&&t.proto.hasCtor.path){n(t.proto,r),t._fromProto=!0;var e=r.paths[t.proto.path];return e&&(h(t,e.structure,r),e.mayCull=!1),!0}}function u(t,r,e){if("string"==typeof t){var i;return t==e&&(i=r.paths[t])?i.mayCull?"?":(i.inlined=!0,u(i.structure,r,e)):t}for(var o in t)/^!(?:define|name|proto|doc|span|url)$/.test(o)||(t[o]=u(t[o],r,null==e?null:e?e+"."+o:o));return t}r.Prim.prototype.setPath=function(){},r.Arr.prototype.setPath=function(t,r,e){this.path=t,o(this.getProp("<i>"),t+".<i>",r,e)},r.Fn.prototype.setPath=function(t,e,i){r.Obj.prototype.setPath.call(this,t,e,i);for(var n=0;n<this.args.length;++n)o(this.args[n],t+".!"+n,e,i);o(this.retval,t+".!ret",e,i)},r.Obj.prototype.setPath=function(t,r,e){this.path=t||"<top>";var i=t?t+".":"";for(var n in this.props)o(this.props[n],i+n,r,e);this.proto&&o(this.proto,i+"!proto",r,e)},r.Prim.prototype.getDesc=function(t,r,e){return e?this.name:a(this.name,r)},r.Arr.prototype.getDesc=function(t,r,e){var i="["+n(this.getProp("<i>"),t,!0)+"]";return e?i:a(i,s(t,this,r))},r.Fn.prototype.getDesc=function(t,r){if(this.path&&!i(t,this.origin))return this.path;for(var e="fn(",o=0;o<this.args.length;++o){o&&(e+=", ");var f=this.argNames[o];f&&"?"!=f&&(e+=f+": "),e+=n(this.args[o],t,!0)}if(e+=")",this.computeRetSource)e+=" -> "+this.computeRetSource;else if(!this.retval.isEmpty()){var u=this.retval.getType();u&&(e+=" -> "+n(u,t,!0))}if(!p(this))return e;var c={"!type":e};return this.doc&&(c["!doc"]=this.doc),a(c,s(t,this,r)),t.paths[this.path]={structure:c},h(this,c,t),this.path},r.Obj.prototype.getDesc=function(t,r){if(f(this,t))return"+"+this.proto.hasCtor.path;if(!i(t,this.origin))return this.path;var e,o={},u=t.paths[this.path]={structure:o};return this.proto&&this.proto!=t.cx.protos.Object&&(e=n(this.proto,t),"?"==e&&(e=null)),null!=u.mayCull||e||p(this)||(u.mayCull=!0),e&&(o["!proto"]=e),this.doc&&(o["!doc"]=this.doc),a(this,s(t,o,r)),h(this,o,t),this.path},t.condense=function(t,e,s){s||(s={}),"string"==typeof t&&(t=[t]),e||(e=t[0]);for(var a=r.cx(),p={},h=1/0,c=-(1/0),l=0;l<t.length;++l){var d=a.origins.indexOf(t[l]);d<0||(h=Math.min(d,h),c=Math.max(d,c))}var g={"!name":e,"!define":p},v={sources:t,paths:Object.create(null),cx:a,minOrigin:h,maxOrigin:c,addedToForeign:[],seen:[],options:s};o(a.topScope,"",v,-1);for(var y in a.topScope.props){var m=a.topScope.props[y];if(i(v,m.origin)){var x=n(m,v);"?"!=x&&(g[y]=x)}}if(v.addedToForeign.length>0){var O=v.addedToForeign;v.addedToForeign=[];for(var l=0;l<O.length;l+=2){var x=O[l],P=O[l+1].split("."),C=r.def.parsePath(P.slice(0,P.length-1).join("."));f(C,v)&&(P=C.proto.path.split(".").concat(P[P.length-1]));var j=n(x,v);if("?"!=j&&!P.some(function(t){return"!"==t.charAt(0)})){for(var b=0,F=g;b<P.length-1;++b){var T=P[b];F=Object.prototype.hasOwnProperty.call(F,T)?F[T]:F[T]={}}F[P[P.length-1]]=j}}}u(g,v,"");var N=[];for(var D in v.paths){var S=v.paths[D];S.inlined||S.mayCull||N.push(D,u(S.structure,v,null))}if(N.length)for(var l=N.length-2;l>=0;l-=2)p[N[l]]=N[l+1];else delete g["!define"];return g}});
//# sourceMappingURL=condense.min.js.map