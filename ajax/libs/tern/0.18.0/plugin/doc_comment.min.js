!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn"),require("acorn/dist/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/dist/acorn","acorn/dist/walk"],e):void e(tern,tern,tern.comment,acorn,acorn.walk)}(function(e,r,n,t,o){"use strict";function a(e,r){function t(e){n.ensureCommentsBefore(r,e)}o.simple(e,{VariableDeclaration:t,FunctionDeclaration:t,MethodDefinition:t,Property:t,AssignmentExpression:function(e){"="==e.operator&&t(e)},CallExpression:function(e){i(e)&&t(e)}})}function i(e){return"MemberExpression"==e.callee.type&&"Object"==e.callee.object.name&&"defineProperty"==e.callee.property.name&&e.arguments.length>=3&&"string"==typeof e.arguments[1].value}function s(r,n){A(r.sourceFile.text,n),o.simple(r,{VariableDeclaration:function(e,r){var n=e.declarations[0].id;e.commentsBefore&&"Identifier"==n.type&&f(e,e.commentsBefore,r,r.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.scope.fnType)},ClassDeclaration:function(e,r){e.commentsBefore&&f(e,e.commentsBefore,r,r.getProp(e.id.name),e.objType)},AssignmentExpression:function(r,n){r.commentsBefore&&f(r,r.commentsBefore,n,e.expressionType({node:r.left,state:n}))},ObjectExpression:function(r,n){for(var t=0;t<r.properties.length;++t){var o=r.properties[t],a=e.propName(o);"<i>"!=a&&o.commentsBefore&&f(o,o.commentsBefore,n,r.objType.getProp(a))}},Class:function(r,n){var t=r.objType.getProp("prototype").getObjType();if(t)for(var o=0;o<r.body.body.length;o++){var a,i=r.body.body[o];i.commentsBefore&&("constructor"==i.kind?f(i,i.commentsBefore,n,r.objType):"<i>"!=(a=e.propName(i))&&f(i,i.commentsBefore,n,t.getProp(a)))}},CallExpression:function(r,n){if(r.commentsBefore&&i(r)){var t=e.expressionType({node:r.arguments[0],state:n}).getObjType();if(t&&t instanceof e.Obj){var o=t.props[r.arguments[1].value];o&&f(r,r.commentsBefore,n,o)}}}},e.searchVisitor,n)}function l(r){var n=r["!typedef"],t=e.cx(),o=r["!name"];if(n)for(var a in n)t.parent.mod.jsdocTypedefs[a]=g(e.def.parse(n[a],o,a),a)}function c(e){for(var r,n=1;n<e.length;n++){var t=e[n],o=t.match(/^[\s\*]*/)[0];if(o!=t)if(null==r)r=o;else{for(var a=0;a<r.length&&r.charCodeAt(a)==o.charCodeAt(a);)++a;a<r.length&&(r=r.slice(0,a))}}for(e=e.map(function(e,n){if(e=e.replace(/\s+$/,""),0==n&&null!=r)for(var t=0;t<r.length;t++){var o=e.indexOf(r.slice(t));if(0==o)return e.slice(r.length-t)}return null==r||0==n?e.replace(/^[\s\*]*/,""):e.length<r.length?"":e.slice(r.length)});e.length&&!e[e.length-1];)e.pop();for(;e.length&&!e[0];)e.shift();return e}function f(r,n,t,o,a){b(r,t,o,n);var i=e.cx();!a&&o instanceof e.AVal&&o.types.length&&(a=o.types[o.types.length-1],a instanceof e.Obj&&a.origin==i.curOrigin&&!a.doc||(a=null));for(var s=n.length-1;s>=0;s--){var l=c(n[s].split(/\r\n?|\n/)).join("\n");if(l){o instanceof e.AVal&&(o.doc=l),a&&(a.doc=l);break}}}function p(e,r){for(;/\s/.test(e.charAt(r));)++r;return r}function u(e){if(!t.isIdentifierStart(e.charCodeAt(0)))return!1;for(var r=1;r<e.length;r++)if(!t.isIdentifierChar(e.charCodeAt(r)))return!1;return!0}function d(e,r,n,t){for(var o=[],a=[],i=!1,s=!0;n=p(r,n),!s||r.charAt(n)!=t;s=!1){var l=r.indexOf(":",n);if(l<0)return null;var c=r.slice(n,l);if(!u(c))return null;o.push(c),n=l+1;var f=h(e,r,n);if(!f)return null;n=f.end,i=i||f.madeUp,a.push(f.type),n=p(r,n);var d=r.charAt(n);if(++n,d==t)break;if(","!=d)return null}return{labels:o,types:a,end:n,madeUp:i}}function m(r,n,t){var o=y(r,n,t);return o?"[]"==n.slice(o.end,o.end+2)?{madeUp:o.madeUp,end:o.end+2,type:new e.Arr(o.type)}:o:null}function h(r,n,t){for(var o,a=!1,i=!1;;){var s=m(r,n,t);if(!s)return null;if(i=i||s.madeUp,a?s.type.propagate(a):o=s.type,t=p(n,s.end),"|"!=n.charAt(t))break;t++,a||(a=new e.AVal,o.propagate(a),o=a)}var l=!1;return"="==n.charAt(t)&&(++t,l=!0),{type:o,end:t,isOptional:l,madeUp:i}}function y(r,n,o){o=p(n,o);var a,i=!1;if(n.indexOf("function(",o)==o){var s=d(r,n,o+9,")"),l=e.ANull;if(!s)return null;if(o=p(n,s.end),":"==n.charAt(o)){++o;var c=h(r,n,o+1);if(!c)return null;o=c.end,l=c.type,i=c.madeUp}a=new e.Fn(null,e.ANull,s.types,s.labels,l)}else if("["==n.charAt(o)){var f=h(r,n,o+1);if(!f)return null;if(o=p(n,f.end),i=f.madeUp,"]"!=n.charAt(o))return null;++o,a=new e.Arr(f.type)}else if("{"==n.charAt(o)){var u=d(r,n,o+1,"}");if(!u)return null;a=new e.Obj(!0);for(var m=0;m<u.types.length;++m){var y=a.defProp(u.labels[m]);y.initializer=!0,u.types[m].propagate(y)}o=u.end,i=u.madeUp}else if("("==n.charAt(o)){var f=h(r,n,o+1);if(!f)return null;if(o=p(n,f.end),")"!=n.charAt(o))return null;++o,a=f.type}else{var v=o;if(!t.isIdentifierStart(n.charCodeAt(o)))return null;for(;t.isIdentifierChar(n.charCodeAt(o));)++o;if(v==o)return null;var b=n.slice(v,o);if(/^(number|integer)$/i.test(b))a=e.cx().num;else if(/^bool(ean)?$/i.test(b))a=e.cx().bool;else if(/^string$/i.test(b))a=e.cx().str;else if(/^(null|undefined)$/i.test(b))a=e.ANull;else if(/^array$/i.test(b)){var f=null;if("."==n.charAt(o)&&"<"==n.charAt(o+1)){var A=h(r,n,o+2);if(!A)return null;if(o=p(n,A.end),i=A.madeUp,">"!=n.charAt(o++))return null;f=A.type}a=new e.Arr(f)}else if(/^object$/i.test(b)){if(a=new e.Obj(!0),"."==n.charAt(o)&&"<"==n.charAt(o+1)){var j=h(r,n,o+2);if(!j)return null;if(o=p(n,j.end),i=i||j.madeUp,","!=n.charAt(o++))return null;var x=h(r,n,o);if(!x)return null;if(o=p(n,x.end),i=j.madeUp||x.madeUp,">"!=n.charAt(o++))return null;x.type.propagate(a.defProp("<i>"))}}else{for(;46==n.charCodeAt(o)||t.isIdentifierChar(n.charCodeAt(o));)++o;var O,P=n.slice(v,o),T=e.cx(),C=T.parent&&T.parent.mod.jsdocTypedefs;C&&P in C?a=C[P]:(O=e.def.parsePath(P,r).getObjType())?a=g(O,P):(T.jsdocPlaceholders||(T.jsdocPlaceholders=Object.create(null)),a=P in T.jsdocPlaceholders?T.jsdocPlaceholders[P]:T.jsdocPlaceholders[P]=new e.Obj(null,P),i=!0)}}return{type:a,end:o,madeUp:i}}function g(r,n){if(r instanceof e.Fn&&/(?:^|\.)[A-Z][^\.]*$/.test(n)){var t=r.getProp("prototype").getObjType();if(t instanceof e.Obj)return e.getInstance(t)}return r}function v(e,r,n){if(n=p(r,n||0),"{"!=r.charAt(n))return null;var t=h(e,r,n+1);if(!t)return null;var o=p(r,t.end);return"}"!=r.charAt(o)?null:(t.end=o+1,t)}function b(e,r,n,t){for(var o,a,i,s,l,c,f=0;f<t.length;++f)for(var p,u=t[f],d=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?|this|class|constructor)\s+(.*)/g;p=d.exec(u);)if("class"!=p[1]&&"constructor"!=p[1]){if("this"==p[1]&&(c=h(r,p[2],0)))l=c,s=!0;else if(c=v(r,p[2]))switch(s=!0,p[1]){case"returns":case"return":i=c;break;case"type":o=c;break;case"param":case"arg":case"argument":var m=p[2].slice(c.end).match(/^\s*(\[?)\s*([^\]\s=]+)\s*(?:=[^\]]+\s*)?(\]?).*/);if(!m)continue;var y=m[2]+(c.isOptional||"["===m[1]&&"]"===m[3]?"?":"");(a||(a=Object.create(null)))[y]=c}}else l=s=!0;s&&O(o,l,a,i,e,n)}function A(r,n){for(var t,o=e.cx(),a=/\s@typedef\s+(.*)/g;t=a.exec(r);){var i=v(n,t[1]),s=i&&t[1].slice(i.end).match(/^\s*(\S+)/);if(s&&i.type instanceof e.Obj){for(var l=r.slice(t.index+t[0].length);t=/\s+@prop(?:erty)?\s+(.*)/.exec(l);){var c,f=v(n,t[1]);f&&(c=t[1].slice(f.end).match(/^\s*(\S+)/))&&f.type.propagate(i.type.defProp(c[1])),l=l.slice(t[0].length)}o.parent.mod.jsdocTypedefs[s[1]]=i.type}}}function j(r,n){var t=e.cx().parent.mod.docComment.weight;r.type.propagate(n,t||(r.madeUp?P:void 0))}function x(e){return"FunctionExpression"==e.type||"ArrowFunctionExpression"==e.type}function O(r,n,t,o,a,i){var s;if("VariableDeclaration"==a.type){var l=a.declarations[0];l.init&&x(l.init)&&(s=l.init.scope.fnType)}else"FunctionDeclaration"==a.type?s=a.scope.fnType:"AssignmentExpression"==a.type?x(a.right)&&(s=a.right.scope.fnType):"CallExpression"==a.type||x(a.value)&&(s=a.value.scope.fnType);if(s&&(t||o||n)){if(t)for(var c=0;c<s.argNames.length;++c){var f=s.argNames[c],p=t[f];!p&&(p=t[f+"?"])&&(s.argNames[c]+="?"),p&&j(p,s.args[c])}if(o&&(s.retval==e.ANull&&(s.retval=new e.AVal),j(o,s.retval)),n===!0){var u=s.getProp("prototype").getObjType();n=u&&{type:e.getInstance(u,s)}}n&&j(n,s.self)}else r&&j(r,i)}var P=1,T=101;r.registerPlugin("doc_comment",function(e,r){e.mod.jsdocTypedefs=Object.create(null),e.on("reset",function(){e.mod.jsdocTypedefs=Object.create(null)}),e.mod.docComment={weight:r&&r.strong?T:void 0,fullDocs:r&&r.fullDocs},e.on("postParse",a),e.on("postInfer",s),e.on("postLoadDef",l)})});
//# sourceMappingURL=doc_comment.min.js.map