function parseFile(e,t){return 65279==e.charCodeAt(0)&&(e=e.slice(1)),new ts.Parser.parse(t,new ts.SimpleText.fromString(e),!1,new ts.ParseOptions(null,!0))}function lookup(e,t){for(;t;t=t.prev)if(t.name==e)return t.value}function buildPath(e){for(var t="";e;e=e.prev){var r=e.enter&&e.enter.replace(/[^\w$]/g,"");r&&(t=t?r+"."+t:r)}return t}function merge(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}function functionType(e,t){for(var r="fn(",n=(e.parameterList||e.callSignature.parameterList).parameters,a=0,i=n.childCount();a<i;++a){var o=n.childAt(a);if(o.identifier){a&&(r+=", ");var l=o.identifier.text();o.questionToken&&(l+="?"),r+=l+": "+walk_(o.typeAnnotation,{enter:l,prev:t})}}r+=")";var c=e.typeAnnotation&&e.typeAnnotation.type;return c&&c.kind()!=nt.VoidKeyword&&(r+=" -> "+flat(c,{enter:"!ret",prev:t})),r}function addToObj(e,t,r){var n=t.text();/^".*"$/.test(n)&&(n=n.slice(1,n.length-1));var a=e[n];a?"string"==typeof a||"string"!=typeof r||a["!type"]?"string"==typeof a&&"string"!=typeof r?(e[n]=r,r["!type"]=a):"[object Object]"==Object.prototype.toString.call(a)&&merge(a,r):a["!type"]=r:e[n]=r}function isStatic(e){if(e.modifiers)for(var t=0,r=e.modifiers.childCount();t<r;t++)if("static"==e.modifiers.childAt(t).value())return!0}function objType(e,t,r){for(var n={},a=0,i=e.childCount();a<i;++a){var o=e.childAt(a),l=r&&isStatic(o)?r:n;switch(o.kind()){case nt.ImportDeclaration:var c=flat(o.moduleReference(),t);t={name:o.identifier.text(),value:c,prev:t};break;case nt.FunctionDeclaration:addToObj(l,o.identifier,functionType(o.callSignature,t));break;case nt.MemberFunctionDeclaration:case nt.MethodSignature:addToObj(l,o.propertyName,functionType(o.callSignature,t));break;case nt.ModuleDeclaration:addToObj(l,o.name||o.stringLiteral,objType(o.moduleElements,t));break;case nt.InterfaceDeclaration:addToObj(l,o.identifier,objType(o.body.typeMembers,t));break;case nt.ClassDeclaration:var s={};s.prototype=objType(o.classElements,t,s),addToObj(l,o.identifier,s);break;case nt.PropertySignature:addToObj(l,o.propertyName,walk_(o.typeAnnotation,t));break;case nt.MemberVariableDeclaration:addToObj(l,o.variableDeclarator.propertyName,walk_(o.variableDeclarator.typeAnnotation,t));break;case nt.EnumDeclaration:addToObj(l,o.identifier,"number");break;case nt.VariableStatement:for(var p=o.variableDeclaration.variableDeclarators,u=0,d=p.childCount();u<d;u++){var f=p.childAt(u);addToObj(l,f.propertyName,walk_(f.typeAnnotation,t))}break;case nt.ConstructorDeclaration:r&&!r["!type"]&&(r["!type"]=functionType(o,t));break;case nt.ExportAssignment:return walk(o.identifier,t);case nt.CallSignature:case nt.ConstructSignature:case nt.IndexSignature:case nt.SemicolonToken:case nt.EmptyStatement:break;default:throw new Error("Unknown field type: "+nt[o.kind()])}}return n}function walk(e,t){switch(e.kind()){case nt.IdentifierName:return lookup(e.text(),t)||e.text();case nt.QualifiedName:return flat(e.left,t)+"."+flat(e.right,null);case nt.ObjectType:return objType(e.typeMembers,t);case nt.ArrayType:return"["+flat(e.type,t)+"]";case nt.FunctionType:return functionType(e,t);case nt.DotToken:return flat(e.operand1,t)+"."+flat(e.operand2,t);case nt.StringLiteral:case nt.StringKeyword:return"string";case nt.NumberKeyword:return"number";case nt.BooleanKeyword:return"bool";case nt.AnyKeyword:case nt.VoidKeyword:case nt.GenericType:return"?";case nt.TypeQuery:return walk(e.name);case nt.FirstTypeScriptKeyword:case nt.LastTypeScriptKeyword:case nt.FirstKeyword:case nt.LastKeyword:return e.value();default:throw new Error("Unrecognized type: "+nt[e.kind()])}}function walk_(e,t){return e&&e.type?walk(e.type,t):"?"}function flat(e,t){var r=walk(e,t);if("string"==typeof r)return r;for(var n=buildPath(t),a=0;;++a){var i=n+(a||"");if(!definitions.hasOwnProperty(i)){n=i;break}}return definitions[n]=r,n}var fs=require("fs"),tsFileName=__dirname+"/../node_modules/typescript/bin/typescript.js",box={};for(var prop in global)box[prop]=global[prop];require("vm").runInNewContext(fs.readFileSync(tsFileName,"utf8"),box,{filename:tsFileName});var ts=box.TypeScript,nt=ts.SyntaxKind,definitions,defaultCx={name:"any",value:"?",prev:{name:"null",value:"?",prev:null}};exports.translate=function(e,t){definitions={};var r=parseFile(e,t).sourceUnit(),n=objType(r.moduleElements,defaultCx);n["!name"]=t;var a=!1;for(var i in definitions){a=!0;break}return a&&(n["!define"]=definitions),n};
//# sourceMappingURL=typescript.min.js.map