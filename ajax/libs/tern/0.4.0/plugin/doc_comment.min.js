!function(e){return"object"==typeof exports&&"object"==typeof module?e(require("../lib/infer"),require("../lib/tern"),require("../lib/comment"),require("acorn/util/walk")):"function"==typeof define&&define.amd?define(["../lib/infer","../lib/tern","../lib/comment","acorn/util/walk"],e):void e(tern,tern,tern.comment,acorn.walk)}(function(e,n,r,t){"use strict";function i(e,n){function i(e){r.ensureCommentsBefore(n,e)}t.simple(e,{VariableDeclaration:i,FunctionDeclaration:i,AssignmentExpression:function(e){"="==e.operator&&i(e)},ObjectExpression:function(e){for(var n=0;n<e.properties.length;++n)i(e.properties[n].key)}})}function o(n,r){t.simple(n,{VariableDeclaration:function(e,n){e.commentsBefore&&a(e,e.commentsBefore,n,n.getProp(e.declarations[0].id.name))},FunctionDeclaration:function(e,n){e.commentsBefore&&a(e,e.commentsBefore,n,n.getProp(e.id.name),e.body.scope.fnType)},AssignmentExpression:function(n,r){n.commentsBefore&&a(n,n.commentsBefore,r,e.expressionType({node:n.left,state:r}))},ObjectExpression:function(e,n){for(var r=0;r<e.properties.length;++r){var t=e.properties[r],i=t.key;i.commentsBefore&&a(t,i.commentsBefore,n,e.objType.getProp(i.name))}}},e.searchVisitor,r)}function a(n,r,t,i,o){p(n,t,i,r),!o&&i instanceof e.AVal&&i.types.length&&(o=i.types[i.types.length-1],o instanceof e.Obj&&o.origin==e.cx().curOrigin&&!o.doc||(o=null));var a=r[0],s=a.search(/\.\s/);s>5&&(a=a.slice(0,s+1)),a=a.trim().replace(/\s*\n\s*\*\s*|\s{1,}/g," "),i instanceof e.AVal&&(i.doc=a),o&&(o.doc=a)}function s(e,n){for(;/\s/.test(e.charAt(n));)++n;return n}function c(e,n,r,t){for(var i=[],o=[],a=!0;r=s(n,r),!a||n.charAt(r)!=t;a=!1){var c=n.indexOf(":",r);if(c<0)return null;var f=n.slice(r,c);if(!/^[\w$]+$/.test(f))return null;i.push(f),r=c+1;var p=l(e,n,r);if(!p)return null;r=p.end,o.push(p.type),r=s(n,r);var u=n.charAt(r);if(++r,u==t)break;if(","!=u)return null}return{labels:i,types:o,end:r}}function l(n,r,t){t=s(r,t);var i;if(r.indexOf("function(",t)==t){var o=c(n,r,t+9,")"),a=e.ANull;if(!o)return null;if(t=s(r,o.end),":"==r.charAt(t)){++t;var f=l(n,r,t+1);if(!f)return null;t=f.end,a=f.type}i=new e.Fn(null,e.ANull,o.types,o.labels,a)}else if("["==r.charAt(t)){var p=l(n,r,t+1);if(!p)return null;if(t=s(r,p.end),"]"!=r.charAt(t))return null;++t,i=new e.Arr(p.type)}else if("{"==r.charAt(t)){var u=c(n,r,t+1,"}");if(!u)return null;i=new e.Obj(!0);for(var m=0;m<u.types.length;++m){var y=i.defProp(u.labels[m]);y.initializer=!0,u.types[m].propagate(y)}t=u.end}else{for(var g=t;/[\w$]/.test(r.charAt(t));)++t;if(g==t)return null;var v=r.slice(g,t);if(/^(number|integer)$/i.test(v))i=e.cx().num;else if(/^bool(ean)?$/i.test(v))i=e.cx().bool;else if(/^string$/i.test(v))i=e.cx().str;else{var d=n.hasProp(v);if(d&&(d=d.getType()),d)if(d instanceof e.Fn&&/^[A-Z]/.test(v)){var b=d.getProp("prototype").getType();b instanceof e.Obj&&(i=e.getInstance(b))}else i=d;else i=e.ANull}}var h=!1;return"="==r.charAt(t)&&(++t,h=!0),{type:i,end:t,isOptional:h}}function f(e,n,r){if(r=s(n,r||0),"{"!=n.charAt(r))return null;var t=l(e,n,r+1);return t&&"}"==n.charAt(t.end)?(++t.end,t):null}function p(e,n,r,t){for(var i,o,a,s,c=0;c<t.length;++c)for(var l,p=t[c],m=/(?:\n|$|\*)\s*@(type|param|arg(?:ument)?|returns?)\s+(.*)/g;l=m.exec(p);){var y=f(n,l[2]);if(y)switch(s=!0,l[1]){case"returns":case"return":a=y.type;break;case"type":i=y.type;break;case"param":case"arg":case"argument":var g=l[2].slice(y.end).match(/^\s*([\w$]+)/);if(!g)continue;(o||(o=Object.create(null)))[g[1]]=y.type,o&&(o[g[1]].isOptional=y.isOptional)}}s&&u(i,o,a,e,r)}function u(e,n,r,t,i){var o;if("VariableDeclaration"==t.type){var a=t.declarations[0];a.init&&"FunctionExpression"==a.init.type&&(o=a.init.body.scope.fnType)}else"FunctionDeclaration"==t.type?o=t.body.scope.fnType:"AssignmentExpression"==t.type?"FunctionExpression"==t.right.type&&(o=t.right.body.scope.fnType):"FunctionExpression"==t.value.type&&(o=t.value.body.scope.fnType);if(o&&(n||r)){if(n)for(var s=0;s<o.argNames.length;++s){var c=o.argNames[s],l=n[c];l&&(l.propagate(o.args[s]),n[c].isOptional&&(o.argNames[s]+="?"))}r&&r.propagate(o.retval)}else e&&e.propagate(i)}n.registerPlugin("doc_comment",function(){return{passes:{postParse:i,postInfer:o}}})});
//# sourceMappingURL=doc_comment.min.js.map