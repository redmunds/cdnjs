var Opentip={Version:"1.4.0",REQUIRED_PROTOTYPE_VERSION:"1.6.0",REQUIRED_SCRIPTACULOUS_VERSION:"1.8.0",STICKS_OUT_TOP:1,STICKS_OUT_BOTTOM:2,STICKS_OUT_LEFT:1,STICKS_OUT_RIGHT:2,cached:{},debugging:!1,load:function(){function t(t){var e=t.split(".");return 1e5*parseInt(e[0])+1e3*parseInt(e[1])+parseInt(e[2])}if("undefined"==typeof Prototype||"undefined"==typeof Element||"undefined"==typeof Element.Methods||t(Prototype.Version)<t(Opentip.REQUIRED_PROTOTYPE_VERSION))throw"Opentip requires the Prototype JavaScript framework >= "+Opentip.REQUIRED_PROTOTYPE_VERSION;Opentip.useCss3Transitions=Opentip.supports("transition"),Opentip.useScriptaculousTransitions=!Opentip.useCss3Transitions,Opentip.useCss3Transitions&&Opentip.debug("Using CSS3 transitions."),("undefined"==typeof Scriptaculous||"undefined"==typeof Effect||t(Scriptaculous.Version)<t(Opentip.REQUIRED_SCRIPTACULOUS_VERSION))&&(Opentip.debug("No scriptaculous available. Disabling scriptaculous transitions."),Opentip.useScriptaculousTransitions=!1)},debug:function(){this.debugging&&"undefined"!=typeof console&&"undefined"!=typeof console.debug&&console.debug.apply(console,arguments)},IEVersion:function(){if("undefined"!=typeof Opentip.cached.IEVersion)return Opentip.cached.IEVersion;if(Prototype.Browser.IE)var t=navigator.userAgent.match("MSIE ([\\d.]+)"),e=t?parseFloat(t[1]):!1;else e=!1;return Opentip.cached.IEVersion=e,e},objectIsEvent:function(t){return"object"==typeof t&&t.type&&t.screenX},useIFrame:function(){return Opentip.IEVersion()?Opentip.IEVersion()<=6:!1},lastTipId:1,lastZIndex:100,documentIsLoaded:!1,postponeCreation:function(t){Opentip.documentIsLoaded||!Opentip.IEVersion()?t():Event.observe(window,"load",t)},element:function(t,e,i){(Object.isArray(e)||Object.isString(e)||Object.isElement(e))&&(i=e,e=null);var s=new Element(t,e||{});return e&&e.className&&e.className.split(" ").each(function(t){s.addClassName(t)}),i&&(Object.isArray(i)?i.each(function(t){s.insert({bottom:t})}):s.insert({bottom:i})),s},sanitizePosition:function(t){var e;if(Object.isArray(t)){var i="";if(i="center"==t[0]?t[1]:"middle"==t[1]?t[0]:t[1]+t[0].capitalize(),void 0===Opentip.position[i])throw"Unknown position: "+i;e=Opentip.position[i]}else if(Object.isString(t)){if(void 0===Opentip.position[t])throw"Unknown position: "+t;e=Opentip.position[t]}return parseInt(e)},vendors:"Khtml Ms O Moz Webkit".split(" "),testDiv:document.createElement("div"),supports:function(t){return t in Opentip.testDiv.style?!0:(t=t.ot_ucfirst(),Opentip.vendors.any(function(e){return e+t in Opentip.testDiv.style}))}};String.prototype.ot_ucfirst=function(){return this.replace(/^\w/,function(t){return t.toUpperCase()})},Opentip.load(),Opentip.styles={standard:{title:null,className:"standard",stem:!1,delay:null,hideDelay:.1,fixed:!1,showOn:"mouseover",hideTrigger:"trigger",hideOn:null,offset:[0,0],containInViewport:!0,autoOffset:!0,showEffect:"appear",fallbackShowEffect:"appear",hideEffect:"fade",fallbackHideEffect:"appear",showEffectDuration:.3,hideEffectDuration:.2,stemSize:8,tipJoint:["left","top"],target:null,targetJoint:null,ajax:!1,group:null,escapeHtml:!1,style:null},slick:{className:"slick",stem:!0},rounded:{className:"rounded",stem:!0},glass:{className:"glass"}},Opentip.defaultStyle="standard",Opentip.position={top:0,topRight:1,right:2,bottomRight:3,bottom:4,bottomLeft:5,left:6,topLeft:7},Event.observe(window,Opentip.IEVersion()?"load":"dom:loaded",function(){Opentip.documentIsLoaded=!0;var t=[];for(var e in Opentip.styles.standard)t.push(e.underscore().dasherize());$$("[ot]").each(function(e){var i={};e=$(e);var s=e.readAttribute("ot");""!==s&&"true"!==s&&"yes"!==s||(s=e.readAttribute("title"),e.title=""),s||(s=""),t.each(function(t){var s;if(s=e.readAttribute("ot-"+t)){try{s=s.gsub("'",'"').evalJSON()}catch(o){}i[t.camelize()]=s}}),e.addTip(s,i)})});var Tips={list:[],append:function(t){this.list.push(t)},remove:function(t){if(t.element)var e=this.list.find(function(e){return e===t});else var e=this.list.find(function(e){return e.triggerElement===t});e&&(e.deactivate(),e.destroyAllElements(),this.list=this.list.without(e))},add:function(t,e){if(t._opentipAddedTips){var i=this.list.find(function(e){return e.triggerElement===t});return"creation"==i.options.showOn&&i.show(),void i.debug("Using an existing opentip.")}setTimeout(function(){t._opentipAddedTips=!0},1),Opentip.debug("Creating new opentip");var s=[];$A(arguments).each(function(t,e){1!=e||Opentip.objectIsEvent(t)||s.push(null),s.push(t)});var o=this,n=function(){o.append(new TipClass(s[0],s[1],s[2],s[3],s[4]))};Opentip.postponeCreation(n)},hideGroup:function(t){this.list.findAll(function(e){return e.options.group==t}).invoke("doHide")},abortShowingGroup:function(t){this.list.findAll(function(e){return e.options.group==t}).invoke("abortShowing")}},Tip=function(){Tips.add.apply(Tips,arguments)};Element.addMethods({addTip:function(t){return t=$(t),Tips.add.apply(Tips,arguments),t},setCss3Style:function(t){t=$(t);var e={};for(var i in arguments[1]){var s=i.ot_ucfirst(),o=arguments[1][i];Opentip.vendors.each(function(i){e[i+s]=o,t.setStyle(e)})}return t}});var TipClass=Class.create({debug:function(){var t=Array.from(arguments);t.unshift("ID:",this.id,"|"),Opentip.debug.apply(Opentip,t)},initialize:function(t,e){this.id=Opentip.lastTipId++,t=$(t),this.triggerElement=t,this.loaded=!1,this.loading=!1,this.visible=!1,this.waitingToShow=!1,this.waitingToHide=!1,this.lastPosition={left:0,top:0},this.dimensions=[100,50];var i={};this.content="","object"==typeof arguments[2]?(this.content="",i=arguments[2]):"object"==typeof arguments[3]?(this.content=arguments[2],i=arguments[3]):"object"==typeof arguments[4]?(this.content=arguments[2],i=arguments[4],i.title=arguments[3]):((Object.isString(arguments[2])||Object.isFunction(arguments[2]))&&(this.content=arguments[2]),Object.isString(arguments[3])&&(i.title=arguments[3])),!i.showOn&&e&&(i.showOn=e.type),i.ajax&&!i.ajax.url&&("a"==this.triggerElement.tagName.toLowerCase()?("object"!=typeof i.ajax&&(i.ajax={}),i.ajax.url=this.triggerElement.href):i.ajax=!1),"click"==i.showOn&&"a"==this.triggerElement.tagName.toLowerCase()&&(e&&e.stop(),this.triggerElement.observe("click",function(t){t.stop()})),i.style||(i.style=Opentip.defaultStyle);var s=Object.extend({},Opentip.styles.standard);if("standard"!=i.style&&Object.extend(s,Opentip.styles[i.style]),i=Object.extend(s,i),i.target&&(i.fixed=!0),i.stem===!0&&(i.stem=i.tipJoint),i.target===!0?i.target=this.triggerElement:i.target&&(i.target=$(i.target)),this.currentStemPosition=i.stem,null===i.delay&&("mouseover"==i.showOn?i.delay=.2:i.delay=0),Opentip.useScriptaculousTransitions&&(i.showEffect&&!Effect[i.showEffect.ot_ucfirst()]&&(this.debug('Using fallback show effect "'+i.fallbackShowEffect+'" instead of "'+i.showEffect+'"'),i.showEffect=i.fallbackShowEffect),i.hideEffect&&!Effect[i.hideEffect.ot_ucfirst()]&&(this.debug('Using fallback hide effect "'+i.fallbackHideEffect+'" instead of "'+i.hideEffect+'"'),i.hideEffect=i.fallbackHideEffect)),null==i.targetJoint&&(i.targetJoint=[],i.targetJoint[0]="left"==i.tipJoint[0]?"right":"right"==i.tipJoint[0]?"left":"center",i.targetJoint[1]="top"==i.tipJoint[1]?"bottom":"bottom"==i.tipJoint[1]?"top":"middle"),this.options=i,this.buildContainer(),this.options.showTriggerElementsWhenHidden=[],this.options.showOn&&"creation"!=this.options.showOn&&this.options.showTriggerElementsWhenHidden.push({element:this.triggerElement,event:this.options.showOn}),this.options.showTriggerElementsWhenVisible=[],this.options.hideTriggerElements=[],this.options.hideTrigger){var o=null,n=null;switch(this.options.hideTrigger){case"trigger":o=this.options.hideOn?this.options.hideOn:"mouseout",n=this.triggerElement;break;case"tip":o=this.options.hideOn?this.options.hideOn:"mouseover",n=this.container;break;case"target":o=this.options.hideOn?this.options.hideOn:"mouseover",n=this.options.target;break;case"closeButton":break;default:o=this.options.hideOn?this.options.hideOn:"mouseover",n=$(this.options.hideTrigger)}n&&(this.options.hideTriggerElements.push({element:n,event:o}),"mouseout"==o&&this.options.showTriggerElementsWhenVisible.push({element:n,event:"mouseover"}))}this.activate(),(e||"creation"==this.options.showOn)&&this.show(e)},activate:function(){this.bound={},this.bound.doShow=this.doShow.bindAsEventListener(this),this.bound.show=this.show.bindAsEventListener(this),this.bound.doHide=this.doHide.bindAsEventListener(this),this.bound.hide=this.hide.bindAsEventListener(this),this.bound.position=this.position.bindAsEventListener(this),(this.options.showEffect||this.options.hideEffect)&&(this.queue={limit:1,position:"end",scope:this.container.identify()}),this.setupObserversForReallyHiddenTip(),this.setupObserversForHiddenTip()},deactivate:function(){this.debug("Deactivating tooltip."),this.doHide(),this.setupObserversForReallyHiddenTip()},buildContainer:function(){this.container=$(Opentip.element("div",{className:"ot-container ot-completely-hidden style-"+this.options.className+(this.options.ajax?" ot-loading":"")+(this.options.fixed?" ot-fixed":"")})),Opentip.useCss3Transitions&&(this.container.setCss3Style({transitionDuration:"0s"}),this.container.addClassName("ot-css3"),this.options.showEffect&&this.container.addClassName("ot-show-"+this.options.showEffect),this.options.hideEffect&&this.container.addClassName("ot-hide-"+this.options.hideEffect)),Opentip.useScriptaculousTransitions&&this.container.setStyle({display:"none"})},buildElements:function(){var t,e;if(this.options.stem){"-"+this.options.stemSize+"px";this.container.appendChild(Opentip.element("div",{className:"stem-container "+this.options.stem[0]+" "+this.options.stem[1]},t=Opentip.element("canvas",{className:"stem"})))}var i=[],s=[];this.options.title&&s.push(Opentip.element("div",{className:"title"},this.options.title)),i.push(Opentip.element("div",{className:"header"},s)),i.push($(Opentip.element("div",{className:"content"}))),this.options.ajax&&i.push($(Opentip.element("div",{className:"loadingIndication"},Opentip.element("span","Loading...")))),this.tooltipElement=$(Opentip.element("div",{className:"opentip"},i)),this.container.appendChild(this.tooltipElement);var o=this.container.appendChild(Opentip.element("div",{className:"ot-buttons"})),n=!1;"closeButton"==this.options.hideTrigger&&(o.appendChild(Opentip.element("a",{href:"javascript:undefined",className:"close"},e=Opentip.element("canvas",{className:"canvas"}))),n=!0),Opentip.useIFrame()&&(this.iFrameElement=this.container.appendChild($(Opentip.element("iframe",{className:"opentipIFrame",src:"javascript:false;"})).setStyle({display:"none",zIndex:100}).setOpacity(0))),document.body.appendChild(this.container),"undefined"!=typeof G_vmlCanvasManager&&(t&&G_vmlCanvasManager.initElement(t),e&&G_vmlCanvasManager.initElement(e)),n&&this.drawCloseButton()},drawCloseButton:function(){var t=this.container.down(".ot-buttons canvas"),e=this.container.down(".ot-buttons .close"),i=parseInt(e.getStyle("width"))||20,s=t.getStyle("color");s&&"transparent"!=s||(s="white");var o=t.getStyle("backgroundColor");o&&"transparent"!=o||(o="rgba(0, 0, 0, 0.2)"),t.setStyle({backgroundColor:"transparent"}),t.width=i,t.height=i;var n=t.getContext("2d");n.clearRect(0,0,i,i),n.beginPath();var a=i/2.95;n.fillStyle=o,n.lineWidth=i/5.26,n.strokeStyle=s,n.lineCap="round",n.arc(i/2,i/2,i/2,0,2*Math.PI,!1),n.fill(),n.beginPath(),n.moveTo(a,a),n.lineTo(i-a,i-a),n.stroke(),n.beginPath(),n.moveTo(i-a,a),n.lineTo(a,i-a),n.stroke()},updateContent:function(){var t=this.container.down(".content");t&&t.update(this.options.escapeHtml?this.content.escapeHTML():this.content),this.storeAndFixDimensions()},storeAndFixDimensions:function(){this.container.setStyle({width:"auto",left:"0px",top:"0px"}),this.dimensions=this.container.getDimensions(),this.container.setStyle({width:this.dimensions.width+"px",left:this.lastPosition.left+"px",top:this.lastPosition.top+"px"})},destroyAllElements:function(){this.container&&this.container.remove()},clearShowTimeout:function(){window.clearTimeout(this.timeoutId)},clearHideTimeout:function(){window.clearTimeout(this.hideTimeoutId)},clearTimeouts:function(){window.clearTimeout(this.visibilityStateTimeoutId),this.clearShowTimeout(),this.clearHideTimeout()},setupObserversForReallyVisibleTip:function(){this.options.showTriggerElementsWhenVisible.each(function(t){$(t.element).observe(t.event,this.bound.show)},this)},setupObserversForVisibleTip:function(){this.options.hideTriggerElements.each(function(t){$(t.element).observe(t.event,this.bound.hide)},this),this.options.showTriggerElementsWhenHidden.each(function(t){$(t.element).stopObserving(t.event,this.bound.show)},this),Event.observe(document.onresize?document:window,"resize",this.bound.position),Event.observe(window,"scroll",this.bound.position)},setupObserversForReallyHiddenTip:function(){this.options.showTriggerElementsWhenVisible.each(function(t){$(t.element).stopObserving(t.event,this.bound.show)},this)},setupObserversForHiddenTip:function(){this.options.showTriggerElementsWhenHidden.each(function(t){$(t.element).observe(t.event,this.bound.show)},this),this.options.hideTriggerElements.each(function(t){$(t.element).stopObserving(t.event,this.bound.hide)},this),Event.stopObserving(document.onresize?document:window,"resize",this.bound.position),Event.stopObserving(window,"scroll",this.bound.position)},show:function(t){this.abortHiding(),this.visible||(this.debug("Showing in "+this.options.delay+"s."),this.options.group&&Tips.abortShowingGroup(this.options.group),this.waitingToShow=!0,this.setupObserversForVisibleTip(),this.followMousePosition(),this.position(t),this.options.delay?this.timeoutId=this.bound.doShow.delay(this.options.delay):this.bound.doShow(t))},abortShowing:function(){this.waitingToShow&&(this.debug("Aborting showing."),this.clearTimeouts(),this.stopFollowingMousePosition(),this.waitingToShow=!1,this.setupObserversForHiddenTip())},doShow:function(){if(this.clearTimeouts(),!this.visible){if(!this.triggerElementExists())return void this.deactivate();this.debug("Showing!"),this.options.group&&Tips.hideGroup(this.options.group),this.visible=!0,this.waitingToShow=!1,Object.isFunction(this.content)&&(this.debug("Executing content function."),this.content=this.content(this)),this.tooltipElement||this.buildElements(),this.updateContent(),this.options.ajax&&!this.loaded&&this.loadAjax(),this.searchAndActivateHideButtons(),this.ensureElement(),this.container.setStyle({zIndex:Opentip.lastZIndex+=1}),this.setupObserversForReallyVisibleTip(),this.setupObserversForVisibleTip(),Opentip.useScriptaculousTransitions&&((this.options.showEffect||this.options.hideEffect)&&this.cancelEffects(),this.options.showEffect&&this.container[this.options.showEffect]?this.container[this.options.showEffect]({duration:this.options.showEffectDuration,queue:this.queue,afterFinish:this.afterShowEffect.bind(this)}):this.container.show(),Opentip.useIFrame()&&this.iFrameElement.show()),this.position(),this.container.removeClassName("ot-hidden").addClassName("ot-becoming-visible");var t=function(){Opentip.useCss3Transitions&&this.container.setCss3Style({transitionDuration:this.options.showEffectDuration+"s"}),this.container.removeClassName("ot-becoming-visible").addClassName("ot-visible"),this.options.showEffect&&this.options.showEffectDuration?this.visibilityStateTimeoutId=function(){this.removeClassName("ot-visible").addClassName("ot-completely-visible")}.bind(this.container).delay(this.options.showEffectDuration):this.container.removeClassName("ot-visible").addClassName("ot-completely-visible"),this.activateFirstInput()};(function(){this.container.removeClassName("ot-completely-hidden"),t.bind(this).defer()}).bind(this).defer()}},loadAjax:function(){this.loading||(this.loading=!0,this.container.addClassName("ot-loading"),this.debug("Loading content from "+this.options.ajax.url+"."),new Ajax.Request(this.options.ajax.url,Object.extend({onComplete:function(){this.container.removeClassName("ot-loading"),this.loaded=!0,this.loading=!1,this.updateContent(),this.searchAndActivateHideButtons(),this.activateFirstInput(),this.position()}.bind(this),onSuccess:function(t){this.debug("Loading successfull."),this.content=t.responseText}.bind(this),onFailure:function(){this.debug("There was a problem downloading the file."),this.options.escapeHtml=!1,this.content='<a class="close">There was a problem downloading the content.</a>'}.bind(this)},this.options.ajax.options||{})))},afterShowEffect:function(){this.activateFirstInput(),this.position()},activateFirstInput:function(){var t=this.container.down("input"),e=this.container.down("textarea");t?t.focus():e&&e.focus()},searchAndActivateHideButtons:function(){"closeButton"!=this.options.hideTrigger&&this.options.hideTrigger||(this.options.hideTriggerElements=[],this.container.select(".close").each(function(t){this.options.hideTriggerElements.push({element:t,event:"click"})},this),this.visible&&this.setupObserversForVisibleTip())},hide:function(t){this.abortShowing(),this.visible&&(this.debug("Hiding in "+this.options.hideDelay+"s."),this.waitingToHide=!0,this.setupObserversForHiddenTip(),this.hideTimeoutId=this.bound.doHide.delay(this.options.hideDelay,t))},abortHiding:function(){this.waitingToHide&&(this.debug("Aborting hiding."),this.clearTimeouts(),this.waitingToHide=!1,this.setupObserversForVisibleTip())},doHide:function(t){if(this.clearTimeouts(),this.visible){if(this.debug("Hiding!"),this.visible=!1,this.waitingToHide=!1,this.deactivateElementEnsurance(),this.setupObserversForReallyHiddenTip(),this.setupObserversForHiddenTip(),this.options.fixed||this.stopFollowingMousePosition(),Opentip.useScriptaculousTransitions){if((this.options.showEffect||this.options.hideEffect)&&this.cancelEffects(),this.options.hideEffect&&this.container[this.options.hideEffect]){var e={duration:this.options.hideEffectDuration,queue:this.queue};t&&Object.isFunction(t)&&(e.afterFinish=t),this.container[this.options.hideEffect](e)}else this.container.hide();Opentip.useIFrame()&&this.iFrameElement.hide()}Opentip.useCss3Transitions&&this.container.setCss3Style({transitionDuration:this.options.hideEffectDuration+"s"}),this.container.removeClassName("ot-visible").removeClassName("ot-completely-visible").addClassName("ot-hidden"),this.options.hideEffect&&this.options.hideEffectDuration?this.visibilityStateTimeoutId=function(){this.setCss3Style({transitionDuration:"0s"}),this.removeClassName("ot-hidden").addClassName("ot-completely-hidden")}.bind(this.container).delay(this.options.showEffectDuration):this.container.removeClassName("ot-hidden").addClassName("ot-completely-hidden")}},cancelEffects:function(){Effect.Queues.get(this.queue.scope).invoke("cancel")},followMousePosition:function(){this.options.fixed||$(document.body).observe("mousemove",this.bound.position)},stopFollowingMousePosition:function(){this.options.fixed||$(document.body).stopObserving("mousemove",this.bound.position)},positionsEqual:function(t,e){return t.left==e.left&&t.top==e.top},position:function(t){var t=t||this.lastEvt;this.currentStemPosition=this.options.stem;var e=this.ensureViewportContainment(t,this.getPosition(t));if(this.positionsEqual(e,this.lastPosition))return void this.positionStem();if(this.lastPosition=e,e){var i={left:e.left+"px",top:e.top+"px"};this.container.setStyle(i),Opentip.useIFrame()&&this.iFrameElement&&this.iFrameElement.setStyle({width:this.container.getWidth()+"px",height:this.container.getHeight()+"px"});var s=this.container;(function(){s.style.visibility="hidden";s.offsetHeight;s.style.visibility="visible"}).defer()}this.positionStem()},getPosition:function(t,e,i,s){var e=e||this.options.tipJoint,i=i||this.options.targetJoint,o={};if(this.options.target){var n=this.options.target.cumulativeOffset();o.left=n[0],o.top=n[1],"right"==i[0]?"undefined"!=typeof this.options.target.getBoundingClientRect?o.left=this.options.target.getBoundingClientRect().right+$(document.viewport).getScrollOffsets().left:o.left=o.left+this.options.target.getWidth():"center"==i[0]&&(o.left+=Math.round(this.options.target.getWidth()/2)),"bottom"==i[1]?o.top+=this.options.target.getHeight():"middle"==i[1]&&(o.top+=Math.round(this.options.target.getHeight()/2))}else{if(!t)return;this.lastEvt=t,o.left=Event.pointerX(t),o.top=Event.pointerY(t)}if(this.options.autoOffset){var a=this.options.stem?this.options.stemSize:0,r=a&&this.options.fixed?2:10,h="middle"!=e[1]||this.options.fixed?0:15,p="center"!=e[0]||this.options.fixed?0:15;if("right"==e[0]?o.left-=r+h:"left"==e[0]&&(o.left+=r+h),"bottom"==e[1]?o.top-=r+p:"top"==e[1]&&(o.top+=r+p),a){var s=s||this.options.stem;"right"==s[0]?o.left-=a:"left"==s[0]&&(o.left+=a),"bottom"==s[1]?o.top-=a:"top"==s[1]&&(o.top+=a)}}return o.left+=this.options.offset[0],o.top+=this.options.offset[1],"right"==e[0]&&(o.left-=this.container.getWidth()),"center"==e[0]&&(o.left-=Math.round(this.container.getWidth()/2)),"bottom"==e[1]&&(o.top-=this.container.getHeight()),"middle"==e[1]&&(o.top-=Math.round(this.container.getHeight()/2)),o},ensureViewportContainment:function(t,e){if(!this.visible)return e;var i=[this.sticksOutX(e),this.sticksOutY(e)];if(!i[0]&&!i[1])return e;var s=this.options.tipJoint.clone(),o=this.options.targetJoint.clone(),n=$(document.viewport).getScrollOffsets(),a=this.dimensions,r={left:e.left-n.left,top:e.top-n.top},h=document.viewport.getDimensions(),p=!1;if(h.width>=a.width&&(r.left<0?(p=!0,s[0]="left",this.options.target&&"left"==o[0]&&(o[0]="right")):r.left+a.width>h.width&&(p=!0,s[0]="right",this.options.target&&"right"==o[0]&&(o[0]="left"))),h.height>=a.height&&(r.top<0?(p=!0,s[1]="top",this.options.target&&"top"==o[1]&&(o[1]="bottom")):r.top+a.height>h.height&&(p=!0,s[1]="bottom",this.options.target&&"bottom"==o[1]&&(o[1]="top"))),p){for(var l=this.getPosition(t,s,o,s),d=[this.sticksOutX(l),this.sticksOutY(l)],c=0,u=0;1>=u;u++)d[u]&&d[u]!=i[u]&&(c++,s[u]=this.options.tipJoint[u],this.options.target&&(o[u]=this.options.targetJoint[u]));if(2>c)return this.currentStemPosition=s,this.getPosition(t,s,o,s)}return e},sticksOut:function(t){return this.sticksOutX(t)||this.sticksOutY(t)},sticksOutX:function(t){var e=$(document.viewport).getScrollOffsets(),i={left:t.left-e.left,top:t.top-e.top};return i.left<0?Opentip.STICKS_OUT_LEFT:i.left+this.dimensions.width>document.viewport.getDimensions().width?Opentip.STICKS_OUT_RIGHT:void 0},sticksOutY:function(t){var e=$(document.viewport).getScrollOffsets(),i={left:t.left-e.left,top:t.top-e.top};return i.top<0?Opentip.STICKS_OUT_TOP:i.top+this.dimensions.height>document.viewport.getDimensions().height?Opentip.STICKS_OUT_BOTTOM:void 0},getStemCanvas:function(){return this.container.down(".stem")},stemPositionsEqual:function(t,e){return t&&e&&t[0]==e[0]&&t[1]==e[1]},positionStem:function(){if(this.options.stem){var t=this.getStemCanvas();if(t&&!this.stemPositionsEqual(this.lastStemPosition,this.currentStemPosition)){this.debug("Setting stem style"),this.lastStemPosition=this.currentStemPosition;var e=Opentip.sanitizePosition(this.currentStemPosition),i=this.options.stemSize,s=(e*Math.PI/4,Math.round(1.5*i)),o={w:s,h:i},n=!1;if(e%2==1){n=!0;var a=Math.round(.707106781*s);o={w:i+a,h:i+a}}var r=Object.clone(o);e!=Opentip.position.left&&e!=Opentip.position.right||(o.h=r.w,o.w=r.h);var h=t.getStyle("color")||"black";t.width=o.w,t.height=o.h;var p=t.getContext("2d");p.clearRect(0,0,t.width,t.height),p.beginPath(),p.fillStyle=h,p.save(),p.translate(o.w/2,o.h/2);var l=Math.floor(e/2);p.rotate(l*Math.PI/2),o.w==r.w?p.translate(-o.w/2,-o.h/2):p.translate(-o.h/2,-o.w/2),n?(p.moveTo(a,r.h),p.lineTo(r.w,0),p.lineTo(0,r.h-a)):(p.moveTo(r.w/2-s/2,r.h),p.lineTo(r.w/2,0),p.lineTo(r.w/2+s/2,r.h)),p.fill(),p.restore();var d={width:o.w+"px",height:o.h+"px",left:"",right:"",top:"",bottom:""};switch(e){case Opentip.position.top:d.top=-o.h+"px",d.left=-Math.round(o.w/2)+"px";break;case Opentip.position.right:d.top=-Math.round(o.h/2)+"px",d.left=0;break;case Opentip.position.bottom:d.top=0,d.left=-Math.round(o.w/2)+"px";break;case Opentip.position.left:d.top=-Math.round(o.h/2)+"px",d.left=-o.w+"px";break;case Opentip.position.topRight:d.top=-i+"px",d.left=-a+"px";break;case Opentip.position.bottomRight:d.top=-a+"px",d.left=-a+"px";break;case Opentip.position.bottomLeft:d.top=-a+"px",d.left=-i+"px";break;case Opentip.position.topLeft:d.top=-i+"px",d.left=-i+"px";break;default:throw"Unknown stem position: "+e}t.setStyle(d);var c=t.up(".stem-container");switch(c.removeClassName("left").removeClassName("right").removeClassName("center").removeClassName("top").removeClassName("bottom").removeClassName("middle"),e){case Opentip.position.top:case Opentip.position.topLeft:case Opentip.position.topRight:c.addClassName("top");break;case Opentip.position.bottom:case Opentip.position.bottomLeft:case Opentip.position.bottomRight:c.addClassName("bottom");break;default:c.addClassName("middle")}switch(e){case Opentip.position.left:case Opentip.position.topLeft:case Opentip.position.bottomLeft:c.addClassName("left");break;case Opentip.position.right:case Opentip.position.topRight:case Opentip.position.bottomRight:c.addClassName("right");break;default:c.addClassName("center")}}}},triggerElementExists:function(t){return this.triggerElement.parentNode&&this.triggerElement.visible()&&this.triggerElement.descendantOf(document.body)},ensureElementInterval:1e3,ensureElement:function(){this.deactivateElementEnsurance(),this.triggerElementExists()||this.deactivate(),this.ensureElementTimeoutId=setTimeout(this.ensureElement.bind(this),this.ensureElementInterval)},deactivateElementEnsurance:function(){clearTimeout(this.ensureElementTimeoutId)}});