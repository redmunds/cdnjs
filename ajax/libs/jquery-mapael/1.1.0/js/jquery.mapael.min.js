!function(e){"use strict";e.fn.mapael=function(t){t=e.extend(!0,{},e.fn.mapael.defaultOptions,t);for(var a in t.legend)if(e.isArray(t.legend[a]))for(var i=0;i<t.legend[a].length;++i)t.legend[a][i]=e.extend(!0,{},e.fn.mapael.legendDefaultOptions[a],t.legend[a][i]);else t.legend[a]=e.extend(!0,{},e.fn.mapael.legendDefaultOptions[a],t.legend[a]);return this.each(function(){var a=e(this),i=e("."+t.map.cssClass,this).empty(),n=e("<div>").addClass(t.map.tooltip.cssClass).css("display","none").appendTo(t.map.tooltip.target||i),o=e.fn.mapael.maps[t.map.name],l=new Raphael(i[0],o.width,o.height),m={},r=0,s={},p={},d={},f=[],h=0,c=0,g=0,u=0;t.map.tooltip.css&&n.css(t.map.tooltip.css),l.setViewBox(0,0,o.width,o.height,!1);for(h in o.elems)m=e.fn.mapael.getElemOptions(t.map.defaultArea,t.areas[h]?t.areas[h]:{},t.legend.area),s[h]={mapElem:l.path(o.elems[h]).attr(m.attrs)};t.map.beforeInit&&t.map.beforeInit(a,l,t);for(h in o.elems)m=e.fn.mapael.getElemOptions(t.map.defaultArea,t.areas[h]?t.areas[h]:{},t.legend.area),e.fn.mapael.initElem(l,s[h],m,n,h);d=e.fn.mapael.drawLinksCollection(l,t,t.links,o.getCoords,n);for(h in t.plots)p[h]=e.fn.mapael.drawPlot(h,t,o,l,n);if(a.on("zoom",function(n,m){var r=Math.min(Math.max(m.level,0),t.map.zoom.maxLevel),s=0,p=0,d=1+a.data("zoomLevel")*t.map.zoom.step,f=1+r*t.map.zoom.step,h=0,c=0,g={};"undefined"!=typeof m.latitude&&"undefined"!=typeof m.longitude&&(g=o.getCoords(m.latitude,m.longitude),m.x=g.x,m.y=g.y),"undefined"==typeof m.x&&(m.x=l._viewBox[0]+l._viewBox[2]/2),"undefined"==typeof m.y&&(m.y=l._viewBox[1]+l._viewBox[3]/2),0==r?(s=0,p=0):"undefined"!=typeof m.fixedCenter&&1==m.fixedCenter?(h=a.data("panX")+(m.x-a.data("panX"))*(f-d)/f,c=a.data("panY")+(m.y-a.data("panY"))*(f-d)/f,s=Math.min(Math.max(0,h),o.width-o.width/f),p=Math.min(Math.max(0,c),o.height-o.height/f)):(s=Math.min(Math.max(0,m.x-o.width/f/2),o.width-o.width/f),p=Math.min(Math.max(0,m.y-o.height/f/2),o.height-o.height/f)),f==d&&s==a.data("panX")&&p==a.data("panY")||(t.map.zoom.animDuration>0?e.fn.mapael.animateViewBox(i,l,s,p,o.width/f,o.height/f,t.map.zoom.animDuration,t.map.zoom.animEasing):(l.setViewBox(s,p,o.width/f,o.height/f),clearTimeout(e.fn.mapael.zoomTO),e.fn.mapael.zoomTO=setTimeout(function(){i.trigger("afterZoom",{x1:s,y1:p,x2:s+o.width/f,y2:p+o.height/f})},150)),a.data({zoomLevel:r,panX:s,panY:p,zoomX:m.x,zoomY:m.y}))}),t.map.zoom.enabled&&t.map.zoom.mousewheel&&a.on("mousewheel",function(n){var o=i.offset(),l=t.map.width?e.fn.mapael.maps[t.map.name].width/t.map.width:e.fn.mapael.maps[t.map.name].width/i.width(),m=n.deltaY>0?1:-1,r=1/(1+a.data("zoomLevel")*t.map.zoom.step),s=r*l*(n.clientX+e(window).scrollLeft()-o.left)+a.data("panX"),p=r*l*(n.clientY+e(window).scrollTop()-o.top)+a.data("panY");return a.trigger("zoom",{fixedCenter:!0,level:a.data("zoomLevel")+m,x:s,y:p}),!1}),t.map.zoom.enabled&&t.map.zoom.touch&&a.on("touchstart",function(e){2===e.originalEvent.touches.length&&(c=(e.originalEvent.touches[0].clientX+e.originalEvent.touches[1].clientX)/2,g=(e.originalEvent.touches[0].clientY+e.originalEvent.touches[1].clientY)/2,u=Math.sqrt(Math.pow(e.originalEvent.touches[1].clientX-e.originalEvent.touches[0].clientX,2)+Math.pow(e.originalEvent.touches[1].clientY-e.originalEvent.touches[0].clientY,2)))}),t.map.zoom.enabled&&t.map.zoom.touch&&a.on("touchmove",function(n){var o=0,l=0,m=0,r=0,s=0,p=0,d=0;if(2===n.originalEvent.touches.length)return p=Math.sqrt(Math.pow(n.originalEvent.touches[1].clientX-n.originalEvent.touches[0].clientX,2)+Math.pow(n.originalEvent.touches[1].clientY-n.originalEvent.touches[0].clientY,2)),Math.abs(p-u)>15&&(o=i.offset(),l=t.map.width?e.fn.mapael.maps[t.map.name].width/t.map.width:e.fn.mapael.maps[t.map.name].width/i.width(),m=1/(1+a.data("zoomLevel")*t.map.zoom.step),r=m*l*(c+e(window).scrollLeft()-o.left)+a.data("panX"),s=m*l*(g+e(window).scrollTop()-o.top)+a.data("panY"),d=(p-u)/Math.abs(p-u),a.trigger("zoom",{fixedCenter:!0,level:a.data("zoomLevel")+d,x:r,y:s}),u=p),!1}),t.map.zoom.enabled&&e.fn.mapael.initZoom(i,l,o.width,o.height,t.map.zoom),"undefined"!=typeof t.map.zoom.init&&a.trigger("zoom",t.map.zoom.init),e.merge(f,e.fn.mapael.createLegends(a,t,"area",s,1)),a.on("update",function(i,m,r,h,c){var g=0,u=0,x=0,y={};if(f.forEach(function(t){t.forEach&&t.forEach(function(t){"undefined"!=typeof t.hidden&&1==t.hidden&&e(t.node).trigger("click")})}),"undefined"!=typeof c&&(c.resetAreas&&(t.areas={}),c.resetPlots&&(t.plots={}),c.resetLinks&&(t.links={}),c.animDuration&&(x=c.animDuration)),e.extend(!0,t,m),"object"==typeof h)for(;g<h.length;g++)"undefined"!=typeof p[h[g]]&&(x>0?!function(e){e.mapElem.animate({opacity:0},x,"linear",function(){e.mapElem.remove()}),e.textElem&&e.textElem.animate({opacity:0},x,"linear",function(){e.textElem.remove()})}(p[h[g]]):(p[h[g]].mapElem.remove(),p[h[g]].textElem&&p[h[g]].textElem.remove()),delete p[h[g]]);if("undefined"!=typeof c&&"object"==typeof c.deletedLinks)for(g=0;g<c.deletedLinks.length;g++)"undefined"!=typeof d[c.deletedLinks[g]]&&(x>0?!function(e){e.mapElem.animate({opacity:0},x,"linear",function(){e.mapElem.remove()}),e.textElem&&e.textElem.animate({opacity:0},x,"linear",function(){e.textElem.remove()})}(d[c.deletedLinks[g]]):(d[c.deletedLinks[g]].mapElem.remove(),d[c.deletedLinks[g]].textElem&&d[c.deletedLinks[g]].textElem.remove()),delete d[c.deletedLinks[g]]);if("object"==typeof r)for(u in r)"undefined"==typeof p[u]&&(t.plots[u]=r[u],p[u]=e.fn.mapael.drawPlot(u,t,o,l,n),x>0&&(p[u].mapElem.attr({opacity:0}),p[u].mapElem.animate({opacity:"undefined"!=typeof p[u].mapElem.originalAttrs.opacity?p[u].mapElem.originalAttrs.opacity:1},x),p[u].textElem&&(p[u].textElem.attr({opacity:0}),p[u].textElem.animate({opacity:"undefined"!=typeof p[u].textElem.originalAttrs.opacity?p[u].textElem.originalAttrs.opacity:1},x))));if("undefined"!=typeof c&&"object"==typeof c.newLinks){var E=e.fn.mapael.drawLinksCollection(l,t,c.newLinks,o.getCoords,n);if(e.extend(d),x>0)for(u in E)E[u].mapElem.attr({opacity:0}),E[u].mapElem.animate({opacity:"undefined"!=typeof E[u].mapElem.originalAttrs.opacity?E[u].mapElem.originalAttrs.opacity:1},x),E[u].textElem&&(E[u].textElem.attr({opacity:0}),E[u].textElem.animate({opacity:"undefined"!=typeof E[u].textElem.originalAttrs.opacity?E[u].textElem.originalAttrs.opacity:1},x))}for(u in s)y=e.fn.mapael.getElemOptions(t.map.defaultArea,t.areas[u]?t.areas[u]:{},t.legend.area),e.fn.mapael.updateElem(y,s[u],n,x);for(u in p)y=e.fn.mapael.getElemOptions(t.map.defaultPlot,t.plots[u]?t.plots[u]:{},t.legend.plot),"square"==y.type?(y.attrs.width=y.size,y.attrs.height=y.size,y.attrs.x=p[u].mapElem.attrs.x-(y.size-p[u].mapElem.attrs.width)/2,y.attrs.y=p[u].mapElem.attrs.y-(y.size-p[u].mapElem.attrs.height)/2):"image"==y.type?(y.attrs.width=y.width,y.attrs.height=y.height,y.attrs.x=p[u].mapElem.attrs.x-(y.width-p[u].mapElem.attrs.width)/2,y.attrs.y=p[u].mapElem.attrs.y-(y.height-p[u].mapElem.attrs.height)/2):y.attrs.r=y.size/2,e.fn.mapael.updateElem(y,p[u],n,x);for(u in d)y=e.fn.mapael.getElemOptions(t.map.defaultLink,t.links[u]?t.links[u]:{},{}),e.fn.mapael.updateElem(y,d[u],n,x);"undefined"!=typeof c&&c.afterUpdate&&c.afterUpdate(a,l,s,p,t)}),t.map.width)l.setSize(t.map.width,o.height*(t.map.width/o.width)),e.merge(f,e.fn.mapael.createLegends(a,t,"plot",p,t.map.width/o.width));else{e(window).on("resize",function(){clearTimeout(r),r=setTimeout(function(){i.trigger("resizeEnd")},150)});var x=function(){e.merge(f,e.fn.mapael.createLegends(a,t,"plot",p,i.width()/o.width)),i.unbind("resizeEnd",x)};i.on("resizeEnd",function(){var e=i.width();l.width!=e&&l.setSize(e,o.height*(e/o.width))}).on("resizeEnd",x).trigger("resizeEnd")}t.map.afterInit&&t.map.afterInit(a,l,s,p,t),e(l.desc).append(" and Mapael (http://www.vincentbroute.fr/mapael/)")})},e.fn.mapael.zoomTO=0,e.fn.mapael.initElem=function(t,a,i,n,o){var l={},m={};"undefined"!=typeof i.value&&(a.value=i.value),e.fn.mapael.setHoverOptions(a.mapElem,i.attrs,i.attrsHover),i.text&&"undefined"!=typeof i.text.content?(l=a.mapElem.getBBox(),m=e.fn.mapael.getTextPosition(l,i.text.position,i.text.margin),i.text.attrs["text-anchor"]=m.textAnchor,a.textElem=t.text(m.x,m.y,i.text.content).attr(i.text.attrs),e.fn.mapael.setHoverOptions(a.textElem,i.text.attrs,i.text.attrsHover),i.eventHandlers&&e.fn.mapael.setEventHandlers(o,i,a.mapElem,a.textElem),e.fn.mapael.setHover(t,a.mapElem,a.textElem),e(a.textElem.node).attr("data-id",o)):(i.eventHandlers&&e.fn.mapael.setEventHandlers(o,i,a.mapElem),e.fn.mapael.setHover(t,a.mapElem)),i.tooltip&&(a.mapElem.tooltip=i.tooltip,e.fn.mapael.setTooltip(a.mapElem,n),i.text&&"undefined"!=typeof i.text.content&&(a.textElem.tooltip=i.tooltip,e.fn.mapael.setTooltip(a.textElem,n))),i.href&&(a.mapElem.href=i.href,a.mapElem.target=i.target,e.fn.mapael.setHref(a.mapElem),i.text&&"undefined"!=typeof i.text.content&&(a.textElem.href=i.href,a.textElem.target=i.target,e.fn.mapael.setHref(a.textElem))),e(a.mapElem.node).attr("data-id",o)},e.fn.mapael.drawLinksCollection=function(t,a,i,n,o){var l={},m={},r={},s={},p={},d={};for(var f in i)r=e.fn.mapael.getElemOptions(a.map.defaultLink,i[f],{}),l="string"==typeof i[f].between[0]?a.plots[i[f].between[0]]:i[f].between[0],m="string"==typeof i[f].between[1]?a.plots[i[f].between[1]]:i[f].between[1],"undefined"!=typeof l.latitude&&"undefined"!=typeof l.longitude?s=n(l.latitude,l.longitude):(s.x=l.x,s.y=l.y),"undefined"!=typeof m.latitude&&"undefined"!=typeof m.longitude?p=n(m.latitude,m.longitude):(p.x=m.x,p.y=m.y),d[f]=e.fn.mapael.drawLink(f,t,s.x,s.y,p.x,p.y,r,o);return d},e.fn.mapael.drawLink=function(t,a,i,n,o,l,m,r){var s={},p=(i+o)/2,d=(n+l)/2,f=-1/((l-n)/(o-i)),h=d-f*p,c=Math.sqrt((o-i)*(o-i)+(l-n)*(l-n)),g=1+f*f,u=-2*p+2*f*h-2*f*d,x=p*p+h*h-h*d-d*h+d*d-m.factor*c*(m.factor*c),y=u*u-4*g*x,E=0,v=0;return m.factor>0?(E=(-u+Math.sqrt(y))/(2*g),v=f*E+h):(E=(-u-Math.sqrt(y))/(2*g),v=f*E+h),s.mapElem=a.path("m "+i+","+n+" C "+E+","+v+" "+o+","+l+" "+o+","+l).attr(m.attrs),e.fn.mapael.initElem(a,s,m,r,t),s},e.fn.mapael.updateElem=function(t,a,i,n){var o,l,m,r;"undefined"!=typeof t.value&&(a.value=t.value),a.textElem&&("undefined"!=typeof t.text&&"undefined"!=typeof t.text.content&&t.text.content!=a.textElem.attrs.text&&a.textElem.attr({text:t.text.content}),o=a.mapElem.getBBox(),(t.size||t.width&&t.height)&&("image"==t.type||"svg"==t.type?(m=(t.width-o.width)/2,r=(t.height-o.height)/2):(m=(t.size-o.width)/2,r=(t.size-o.height)/2),o.x-=m,o.x2+=m,o.y-=r,o.y2+=r),l=e.fn.mapael.getTextPosition(o,t.text.position,t.text.margin),l.x==a.textElem.attrs.x&&l.y==a.textElem.attrs.y||(n>0?(a.textElem.attr({"text-anchor":l.textAnchor}),a.textElem.animate({x:l.x,y:l.y},n)):a.textElem.attr({x:l.x,y:l.y,"text-anchor":l.textAnchor})),e.fn.mapael.setHoverOptions(a.textElem,t.text.attrs,t.text.attrsHover),n>0?a.textElem.animate(t.text.attrs,n):a.textElem.attr(t.text.attrs)),e.fn.mapael.setHoverOptions(a.mapElem,t.attrs,t.attrsHover),n>0?a.mapElem.animate(t.attrs,n):a.mapElem.attr(t.attrs),"svg"==t.type&&a.mapElem.transform("m"+t.width/a.mapElem.originalWidth+",0,0,"+t.height/a.mapElem.originalHeight+","+o.x+","+o.y),t.tooltip&&("undefined"==typeof a.mapElem.tooltip&&(e.fn.mapael.setTooltip(a.mapElem,i),a.textElem&&e.fn.mapael.setTooltip(a.textElem,i)),a.mapElem.tooltip=t.tooltip,a.textElem&&(a.textElem.tooltip=t.tooltip)),"undefined"!=typeof t.href&&("undefined"==typeof a.mapElem.href&&(e.fn.mapael.setHref(a.mapElem),a.textElem&&e.fn.mapael.setHref(a.textElem)),a.mapElem.href=t.href,a.mapElem.target=t.target,a.textElem&&(a.textElem.href=t.href,a.textElem.target=t.target))},e.fn.mapael.drawPlot=function(t,a,i,n,o){var l={},m={},r=e.fn.mapael.getElemOptions(a.map.defaultPlot,a.plots[t]?a.plots[t]:{},a.legend.plot);return m="undefined"!=typeof r.x&&"undefined"!=typeof r.y?{x:r.x,y:r.y}:i.getCoords(r.latitude,r.longitude),"square"==r.type?l={mapElem:n.rect(m.x-r.size/2,m.y-r.size/2,r.size,r.size).attr(r.attrs)}:"image"==r.type?l={mapElem:n.image(r.url,m.x-r.width/2,m.y-r.height/2,r.width,r.height).attr(r.attrs)}:"svg"==r.type?(l={mapElem:n.path(r.path).attr(r.attrs)},l.mapElem.originalWidth=l.mapElem.getBBox().width,l.mapElem.originalHeight=l.mapElem.getBBox().height,l.mapElem.transform("m"+r.width/l.mapElem.originalWidth+",0,0,"+r.height/l.mapElem.originalHeight+","+(m.x-r.width/2)+","+(m.y-r.height/2))):l={mapElem:n.circle(m.x,m.y,r.size/2).attr(r.attrs)},e.fn.mapael.initElem(n,l,r,o,t),l},e.fn.mapael.setHref=function(t){t.attr({cursor:"pointer"}),e(t.node).bind("click",function(){!e.fn.mapael.panning&&t.href&&window.open(t.href,t.target)})},e.fn.mapael.setTooltip=function(t,a){var i=0,n=a.parent(),o=a.attr("class");e(t.node).on("mouseover",function(l){i=setTimeout(function(){a.attr("class",o),"undefined"!=typeof t.tooltip&&("undefined"!=typeof t.tooltip.content&&a.html(t.tooltip.content).css("display","block"),"undefined"!=typeof t.tooltip.cssClass&&a.addClass(t.tooltip.cssClass)),a.css({left:Math.min(n.offset().left+n.width()-a.outerWidth()-5,l.pageX+10)-e(window).scrollLeft(),top:Math.min(n.offset().top+n.height()-a.outerHeight()-5,l.pageY+20)-e(window).scrollTop()})},120)}).on("mouseout",function(e){clearTimeout(i),a.css("display","none")}).on("mousemove",function(t){a.css({left:Math.min(n.offset().left+n.width()-a.outerWidth()-5,t.pageX+10)-e(window).scrollLeft(),top:Math.min(n.offset().top+n.height()-a.outerHeight()-5,t.pageY+20)-e(window).scrollTop()})})},e.fn.mapael.setEventHandlers=function(t,a,i,n){for(var o in a.eventHandlers)!function(o){e(i.node).on(o,function(l){!e.fn.mapael.panning&&a.eventHandlers[o](l,t,i,n,a)}),n&&e(n.node).on(o,function(l){!e.fn.mapael.panning&&a.eventHandlers[o](l,t,i,n,a)})}(o)},e.fn.mapael.panning=!1,e.fn.mapael.panningTO=0,e.fn.mapael.initZoom=function(t,a,i,n,o){var l=t.parent(),m=e("<div>").addClass(o.zoomInCssClass).html("+"),r=e("<div>").addClass(o.zoomOutCssClass).html("&#x2212;"),s=!1,p=0,d=0;l.data("zoomLevel",0).data({panX:0,panY:0}),t.append(m).append(r),m.on("click",function(){l.trigger("zoom",{level:l.data("zoomLevel")+1})}),r.on("click",function(){l.trigger("zoom",{level:l.data("zoomLevel")-1})}),e("body").on("mouseup"+(o.touch?" touchend":""),function(t){s=!1,setTimeout(function(){e.fn.mapael.panning=!1},50)}),t.on("mousedown"+(o.touch?" touchstart":""),function(e){"undefined"!=typeof e.pageX?(s=!0,p=e.pageX,d=e.pageY):1===e.originalEvent.touches.length&&(s=!0,p=e.originalEvent.touches[0].pageX,d=e.originalEvent.touches[0].pageY)}).on("mousemove"+(o.touch?" touchmove":""),function(m){var r=l.data("zoomLevel"),f=0,h=0;if("undefined"!=typeof m.pageX?(f=m.pageX,h=m.pageY):1===m.originalEvent.touches.length?(f=m.originalEvent.touches[0].pageX,h=m.originalEvent.touches[0].pageY):s=!1,s&&0!=r){var c=(p-f)/(1+r*o.step)*(i/a.width),g=(d-h)/(1+r*o.step)*(n/a.height),u=Math.min(Math.max(0,a._viewBox[0]+c),i-a._viewBox[2]),x=Math.min(Math.max(0,a._viewBox[1]+g),n-a._viewBox[3]);return(Math.abs(c)>5||Math.abs(g)>5)&&(l.data({panX:u,panY:x}),a.setViewBox(u,x,a._viewBox[2],a._viewBox[3]),clearTimeout(e.fn.mapael.panningTO),e.fn.mapael.panningTO=setTimeout(function(){t.trigger("afterPanning",{x1:u,y1:x,x2:u+a._viewBox[2],y2:x+a._viewBox[3]})},150),p=f,d=h,e.fn.mapael.panning=!0),!1}})},e.fn.mapael.drawLegend=function(t,a,i,n,o,l,m){var r={},s={},p=0,d=0,f={},h={},c={},g={},u=0,x=0,y=0,E=0,v=[],w=0;if(t.slices&&t.display){for(r=e("."+t.cssClass,a).empty(),s=new Raphael(r.get(0)),d=p=0,t.title&&(f=s.text(t.marginLeftTitle,0,t.title).attr(t.titleAttrs),f.attr({y:.5*f.getBBox().height}),p=t.marginLeftTitle+f.getBBox().width,d+=t.marginBottomTitle+f.getBBox().height),u=0,w=t.slices.length;u<w;++u)"undefined"==typeof t.slices[u].legendSpecificAttrs&&(t.slices[u].legendSpecificAttrs={}),v[u]=e.extend({},"plot"==n?i.map.defaultPlot.attrs:i.map.defaultArea.attrs,t.slices[u].attrs,t.slices[u].legendSpecificAttrs),"area"==n?("undefined"==typeof v[u].width&&(v[u].width=30),"undefined"==typeof v[u].height&&(v[u].height=20)):"square"==t.slices[u].type?("undefined"==typeof v[u].width&&(v[u].width=t.slices[u].size),"undefined"==typeof v[u].height&&(v[u].height=t.slices[u].size)):"image"==t.slices[u].type||"svg"==t.slices[u].type?("undefined"==typeof v[u].width&&(v[u].width=t.slices[u].width),"undefined"==typeof v[u].height&&(v[u].height=t.slices[u].height)):"undefined"==typeof v[u].r&&(v[u].r=t.slices[u].size/2),E="plot"!=n||"undefined"!=typeof t.slices[u].type&&"circle"!=t.slices[u].type?Math.max(E,t.marginBottomTitle+f.getBBox().height+l*v[u].height/2):Math.max(E,t.marginBottomTitle+f.getBBox().height+l*v[u].r);for("horizontal"==t.mode&&(p=t.marginLeft),u=0,w=t.slices.length;u<w;++u)"undefined"!=typeof t.slices[u].display&&1!=t.slices[u].display||("area"==n?("horizontal"==t.mode?(x=p+t.marginLeft,y=E-.5*l*v[u].height):(x=t.marginLeft,y=d),h=s.rect(x,y,l*v[u].width,l*v[u].height)):"square"==t.slices[u].type?("horizontal"==t.mode?(x=p+t.marginLeft,y=E-.5*l*v[u].height):(x=t.marginLeft,y=d),h=s.rect(x,y,l*v[u].width,l*v[u].height)):"image"==t.slices[u].type||"svg"==t.slices[u].type?("horizontal"==t.mode?(x=p+t.marginLeft,y=E-.5*l*v[u].height):(x=t.marginLeft,y=d),"image"==t.slices[u].type?h=s.image(t.slices[u].url,x,y,l*v[u].width,l*v[u].height):(h=s.path(t.slices[u].path),h.transform("m"+l*t.slices[u].width/h.getBBox().width+",0,0,"+l*t.slices[u].height/h.getBBox().height+","+x+","+y))):("horizontal"==t.mode?(x=p+t.marginLeft+l*v[u].r,y=E):(x=t.marginLeft+l*v[u].r,y=d+l*v[u].r),h=s.circle(x,y,l*v[u].r)),delete v[u].width,delete v[u].height,delete v[u].r,h.attr(v[u]),c=h.getBBox(),"horizontal"==t.mode?(x=p+t.marginLeft+c.width+t.marginLeftLabel,y=E):(x=t.marginLeft+c.width+t.marginLeftLabel,y=d+c.height/2),g=s.text(x,y,t.slices[u].label).attr(t.labelAttrs),"horizontal"==t.mode?(p+=t.marginLeft+c.width+t.marginLeftLabel+g.getBBox().width,d="image"==t.slices[u].type||"area"==n?Math.max(d,t.marginBottom+f.getBBox().height+c.height):Math.max(d,t.marginBottomTitle+t.marginBottom+f.getBBox().height+c.height)):(p=Math.max(p,t.marginLeft+c.width+t.marginLeftLabel+g.getBBox().width),d+=t.marginBottom+c.height),e(h.node).attr({"data-type":"elem","data-index":u,"data-hidden":0}),e(g.node).attr({"data-type":"label","data-index":u,"data-hidden":0}),t.hideElemsOnClick.enabled&&(g.attr({cursor:"pointer"}),h.attr({cursor:"pointer"}),e.fn.mapael.setHoverOptions(h,v[u],v[u]),e.fn.mapael.setHoverOptions(g,t.labelAttrs,t.labelAttrsHover),e.fn.mapael.setHover(s,h,g),e.fn.mapael.handleClickOnLegendElem(a,t,t.slices[u],g,h,o,m)));return"SVG"!=Raphael.type&&t.VMLWidth&&(p=t.VMLWidth),s.setSize(p,d),s}},e.fn.mapael.handleClickOnLegendElem=function(t,a,i,n,o,l,m){var r=function(r,s){var p=0,d=e(n.node).attr("data-hidden"),f=0==d?{"data-hidden":1}:{"data-hidden":0};0==d?n.animate({opacity:.5},300):n.animate({opacity:1},300);for(var h in l)p=e.isArray(l[h].value)?l[h].value[m]:l[h].value,("undefined"!=typeof i.sliceValue&&p==i.sliceValue||"undefined"==typeof i.sliceValue&&("undefined"==typeof i.min||p>=i.min)&&("undefined"==typeof i.max||p<i.max))&&!function(e){0==d?(l[e].mapElem.animate({opacity:a.hideElemsOnClick.opacity},300,"linear",function(){0==a.hideElemsOnClick.opacity&&l[e].mapElem.hide()}),l[e].textElem&&l[e].textElem.animate({opacity:a.hideElemsOnClick.opacity},300,"linear",function(){0==a.hideElemsOnClick.opacity&&l[e].textElem.hide()})):(0==a.hideElemsOnClick.opacity&&(l[e].mapElem.show(),l[e].textElem&&l[e].textElem.show()),l[e].mapElem.animate({opacity:"undefined"!=typeof l[e].mapElem.originalAttrs.opacity?l[e].mapElem.originalAttrs.opacity:1},300),l[e].textElem&&l[e].textElem.animate({opacity:"undefined"!=typeof l[e].textElem.originalAttrs.opacity?l[e].textElem.originalAttrs.opacity:1},300))}(h);e(o.node).attr(f),e(n.node).attr(f),"undefined"!=typeof s&&s!==!0||"undefined"==typeof a.exclusive||a.exclusive!==!0||e("[data-type='elem'][data-hidden=0]",t).each(function(){e(this).attr("data-index")!==e(o.node).attr("data-index")&&e(this).trigger("click",!1)})};e(n.node).on("click",r),e(o.node).on("click",r),"undefined"!=typeof i.clicked&&i.clicked===!0&&e(o.node).trigger("click",!1)},e.fn.mapael.createLegends=function(t,a,i,n,o){var l=[];if(e.isArray(a.legend[i]))for(var m=0;m<a.legend[i].length;++m)l.push(e.fn.mapael.drawLegend(a.legend[i][m],t,a,i,n,o,m));else l.push(e.fn.mapael.drawLegend(a.legend[i],t,a,i,n,o));return l},e.fn.mapael.setHoverOptions=function(t,a,i){"SVG"!=Raphael.type&&delete i.transform,t.attrsHover=i,t.attrsHover.transform?t.originalAttrs=e.extend({transform:"s1"},a):t.originalAttrs=a},e.fn.mapael.setHover=function(t,a,i){var n={},o={},l=0,m=function(){l=setTimeout(function(){e.fn.mapael.elemHover(t,a,i)},120)},r=function(){clearTimeout(l),e.fn.mapael.elemOut(t,a,i)};n=e(a.node),n.on("mouseover",m),n.on("mouseout",r),i&&(o=e(i.node),o.on("mouseover",m),e(i.node).on("mouseout",r))},e.fn.mapael.elemHover=function(e,t,a){t.animate(t.attrsHover,t.attrsHover.animDuration),a&&a.animate(a.attrsHover,a.attrsHover.animDuration),e.safari()},e.fn.mapael.elemOut=function(e,t,a){t.animate(t.originalAttrs,t.attrsHover.animDuration),a&&a.animate(a.originalAttrs,a.attrsHover.animDuration),e.safari()},e.fn.mapael.getElemOptions=function(t,a,i){var n=e.extend(!0,{},t,a);if("undefined"!=typeof n.value)if(e.isArray(i))for(var o=0,l=i.length;o<l;++o)n=e.extend(!0,{},n,e.fn.mapael.getLegendSlice(n.value[o],i[o]));else n=e.extend(!0,{},n,e.fn.mapael.getLegendSlice(n.value,i));return n},e.fn.mapael.getTextPosition=function(e,t,a){var i=0,n=0,o="";switch(t){case"bottom":i=(e.x+e.x2)/2,n=e.y2+a,o="middle";break;case"top":i=(e.x+e.x2)/2,n=e.y-a,o="middle";break;case"left":i=e.x-a,n=(e.y+e.y2)/2,o="end";break;case"right":i=e.x2+a,n=(e.y+e.y2)/2,o="start";break;default:i=(e.x+e.x2)/2,n=(e.y+e.y2)/2,o="middle"}return{x:i,y:n,textAnchor:o}},e.fn.mapael.getLegendSlice=function(e,t){for(var a=0,i=t.slices.length;a<i;++a)if("undefined"!=typeof t.slices[a].sliceValue&&e==t.slices[a].sliceValue||"undefined"==typeof t.slices[a].sliceValue&&("undefined"==typeof t.slices[a].min||e>=t.slices[a].min)&&("undefined"==typeof t.slices[a].max||e<t.slices[a].max))return t.slices[a];return{}},e.fn.mapael.animationIntervalID=null,e.fn.mapael.animateViewBox=function(t,a,i,n,o,l,m,r){var s=a._viewBox?a._viewBox[0]:0,p=i-s,d=a._viewBox?a._viewBox[1]:0,f=n-d,h=a._viewBox?a._viewBox[2]:a.width,c=o-h,g=a._viewBox?a._viewBox[3]:a.height,u=l-g,r=r||"linear",x=25,y=m/x,E=0,v=Raphael.easing_formulas[r];clearInterval(e.fn.mapael.animationIntervalID),e.fn.mapael.animationIntervalID=setInterval(function(){var m=E/y;a.setViewBox(s+p*v(m),d+f*v(m),h+c*v(m),g+u*v(m),!1),E++>=y&&(clearInterval(e.fn.mapael.animationIntervalID),clearTimeout(e.fn.mapael.zoomTO),e.fn.mapael.zoomTO=setTimeout(function(){t.trigger("afterZoom",{x1:i,y1:n,x2:i+o,y2:n+l})},150))},x)},e.fn.mapael.defaultOptions={map:{cssClass:"map",tooltip:{cssClass:"mapTooltip",target:null},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self"},zoom:{enabled:!1,maxLevel:10,step:.25,zoomInCssClass:"zoomIn",zoomOutCssClass:"zoomOut",mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear"}},legend:{area:[],plot:[]},areas:{},plots:{},links:{}},e.fn.mapael.legendDefaultOptions={area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[],mode:"vertical"}}}(jQuery);