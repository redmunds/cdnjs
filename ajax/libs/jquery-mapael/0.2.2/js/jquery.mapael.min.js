!function(t){"use strict";t.fn.mapael=function(e){return e=t.extend(!0,{},t.fn.mapael.defaultOptions,e),this.each(function(){var a=t("<div>").addClass(e.map.tooltip.cssClass).css("display","none"),s=t(this).empty().append(a),n=t.fn.mapael.maps[e.map.name],i=(s.width(),new Raphael(this,n.width,n.height)),l={},o={},r={},p={},c={},m={},f={},d=0;e.map.tooltip.css&&a.css(e.map.tooltip.css),i.setViewBox(0,0,n.width,n.height,!1);for(var u in n.elems)l=t.extend(!0,{},e.map.defaultArea,e.areas[u]?e.areas[u]:{}),e.legend.area&&l.value&&(o=t.fn.mapael.getLegendEl(l.value,e.legend.area),o&&t.extend(!0,l,o)),r=i.path(n.elems[u]).attr(l.attrs),r.elemType="area",l.tooltip&&l.tooltip.content&&t.fn.mapael.setTooltip(r,a,l.tooltip.content),t.fn.mapael.paramHover(r,l.attrs,l.attrsHover),l.text?(p=r.getBBox(),m=i.text((p.x+p.x2)/2,(p.y+p.y2)/2,l.text).attr(l.textAttrs),l.tooltip&&l.tooltip.content&&t.fn.mapael.setTooltip(m,a,l.tooltip.content),l.attrs.href&&m.attr({href:l.attrs.href}),t.fn.mapael.paramHover(m,l.textAttrs,l.textAttrsHover),t.fn.mapael.setHover(i,r,m),t.fn.mapael.setCallbacks(l,r,m)):(t.fn.mapael.setHover(i,r),t.fn.mapael.setCallbacks(l,r));for(var v=0,h=e.plots.length;h>v;++v){if(c=t.extend(!0,{},e.map.defaultPlot,e.plots[v]?e.plots[v]:{}),f=c.x&&c.y?{x:c.x,y:c.y}:n.getCoords(c.latitude,c.longitude),e.legend.plot&&c.value&&(o=t.fn.mapael.getLegendEl(c.value,e.legend.plot),o&&t.extend(!0,c,o)),"square"==c.type)r=i.rect(f.x-c.size/2,f.y-c.size/2,c.size,c.size);else{if("circle"!=c.type)throw"Unknown plot type '"+c.type+"'";r=i.circle(f.x,f.y,c.size/2)}r.elemType="plot",r.attr(c.attrs),c.tooltip&&c.tooltip.content&&t.fn.mapael.setTooltip(r,a,c.tooltip.content),t.fn.mapael.paramHover(r,c.attrs,c.attrsHover),c.text?(m="circle"==r.type?i.text(f.x+c.size/2+10,f.y,c.text):i.text(f.x+c.size+10,f.y,c.text),m.attr(c.textAttrs),c.tooltip&&c.tooltip.content&&t.fn.mapael.setTooltip(m,a,c.tooltip.content),c.attrs.href&&m.attr({href:c.attrs.href}),t.fn.mapael.paramHover(m,c.textAttrs,c.textAttrsHover),t.fn.mapael.setHover(i,r,m),t.fn.mapael.setCallbacks(c,r,m)):(t.fn.mapael.setHover(i,r),t.fn.mapael.setCallbacks(c,r))}e.legend.area.slices&&e.legend.area.display&&t.fn.mapael.createLegend(s,e,"area"),e.legend.plot.slices&&e.legend.plot.display&&t.fn.mapael.createLegend(s,e,"plot"),e.map.width?i.setSize(e.map.width,n.height*(e.map.width/n.width)):(t(window).bind("resize",function(){clearTimeout(d),d=setTimeout(function(){s.trigger("resizeEnd")},150)}),t(document).bind("ready",function(){s.trigger("resizeEnd")}),s.bind("resizeEnd",function(t){var e=s.width();i.width!=e&&i.setSize(e,n.height*(e/n.width))}),s.trigger("resizeEnd")),t(i.desc).append(" and Mapael (http://neveldo.fr/mapael)")})},t.fn.mapael.setCallbacks=function(e,a,s){var n=[];e.onclick&&n.push({event:"click",callback:function(){e.onclick(e,a,s)}}),e.onmouseover&&n.push({event:"mouseover",callback:function(){e.onmouseover(e,a,s)}}),e.onmouseout&&n.push({event:"mouseout",callback:function(){e.onmouseout(e,a,s)}});for(var i=0,l=n.length;l>i;++i)t(a.node).bind(n[i].event,n[i].callback),s&&t(s.node).bind(n[i].event,n[i].callback)},t.fn.mapael.getLegendEl=function(t,e){for(var a=0,s=e.slices.length;s>a;++a)if((!e.slices[a].min||t>=e.slices[a].min)&&(!e.slices[a].max||t<e.slices[a].max))return e.slices[a]},t.fn.mapael.setTooltip=function(e,a,s){var n=0;t(e.node).bind("mouseover",function(){n=setTimeout(function(){a.html(s).css("display","block")},120)}).bind("mouseout",function(){clearTimeout(n),a.css("display","none")}).bind("mousemove",function(e){a.css("left",e.pageX+15).css("top",e.pageY+15-t(window).scrollTop())})},t.fn.mapael.createLegend=function(e,a,s){var n=a.legend[s],i=t("<div>").addClass(n.cssClass),l=new Raphael(i.get(0)),o=5,r=5,p=n.marginLeft,c=n.marginLeftTitle,m=n.marginLeftLabel,f=n.marginBottom,d={},u="",v={},h={},g={};e.append(i),n.title&&(d=l.text(c,f,n.title).attr(n.titleAttrs),o=c+d.getBBox().width,r+=f+d.getBBox().height);for(var x=0,H=n.slices.length;H>x;++x)u="plot"==s?"defaultPlot":"defaultArea",n.slices[x].attrs=t.extend({},a.map[u].attrs,n.slices[x].attrs),n.slices[x].attrsHover=t.extend({},a.map[u].attrsHover,n.slices[x].attrsHover),"circle"==n.slices[x].type?v=l.circle(p+n.slices[x].size/2,r+n.slices[x].size/2,n.slices[x].size/2).attr(n.slices[x].attrs):(!n.slices[x].size&&(n.slices[x].size=20),v=l.rect(p,r,n.slices[x].size,n.slices[x].size).attr(n.slices[x].attrs)),v.elemType="plot",h=l.text(p+n.slices[x].size+m,r+n.slices[x].size/2,n.slices[x].label).attr(n.labelAttrs),r+=f+n.slices[x].size,g=p+n.slices[x].size+m+h.getBBox().width,o=g>o?g:o,t.fn.mapael.paramHover(v,n.slices[x].attrs,n.slices[x].attrsHover),t.fn.mapael.paramHover(h,n.labelAttrs,n.labelAttrs),t.fn.mapael.setHover(l,v,h);"SVG"!=Raphael.type&&n.VMLWidth&&(o=n.VMLWidth),l.setSize(o,r)},t.fn.mapael.hoverIn=function(t,e,a){e&&e.animate(e.attrsHover,e.attrsHover.animDuration),a&&a.animate(a.attrsHover,a.attrsHover.animDuration),t.safari()},t.fn.mapael.hoverOut=function(t,e,a){a&&a.animate(a.originalAttrs,a.attrsHover.animDuration),e&&e.animate(e.originalAttrs,e.attrsHover.animDuration),t.safari()},t.fn.mapael.setHover=function(e,a,s){var n={},i={},l=0;a&&(n=t(a.node),n.bind("mouseover",function(){l=setTimeout(function(){t.fn.mapael.hoverIn(e,a,s)},120)}),n.bind("mouseout",function(){clearTimeout(l),t.fn.mapael.hoverOut(e,a,s)})),s&&(i=t(s.node),i.bind("mouseover",function(){t.fn.mapael.hoverIn(e,a,s)}),i&&t(s.node).bind("mouseout",function(){t.fn.mapael.hoverOut(e,a,s)}))},t.fn.mapael.paramHover=function(e,a,s){"SVG"!=Raphael.type&&delete s.transform,e.attrsHover={},t.extend(e.attrsHover,s),e.attrsHover.transform?e.originalAttrs={transform:"s1"}:e.originalAttrs={},t.extend(e.originalAttrs,a)},t.fn.mapael.defaultOptions={map:{tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},textAttrs:{"font-size":15,fill:"#c7c7c7","text-anchor":"center"},textAttrsHover:{fill:"#eaeaea",animDuration:300}},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},textAttrs:{"font-size":15,fill:"#c7c7c7","text-anchor":"start"},textAttrsHover:{fill:"#eaeaea",animDuration:300}}},legend:{area:{cssClass:"mapLegend",display:!1,marginLeft:15,marginLeftTitle:5,marginLeftLabel:10,marginBottom:15,titleAttrs:{"font-size":18,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":15,fill:"#343434","text-anchor":"start"},slices:[]},plot:{cssClass:"mapLegend",display:!1,marginLeft:15,marginLeftTitle:5,marginLeftLabel:10,marginBottom:15,titleAttrs:{"font-size":18,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":15,fill:"#343434","text-anchor":"start"},slices:[]}},areas:{},plots:{}}}(jQuery);