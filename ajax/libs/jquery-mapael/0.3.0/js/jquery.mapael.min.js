!function(t){"use strict";t.fn.mapael=function(e){return e=t.extend(!0,{},t.fn.mapael.defaultOptions,e),this.each(function(){var a=t("<div>").addClass(e.map.tooltip.cssClass).css("display","none"),s=t("."+e.map.cssClass,this).empty().append(a),i=t.fn.mapael.maps[e.map.name],l=new Raphael(s[0],i.width,i.height),n={},o={},r=0,m={},p={},f=0;e.map.tooltip.css&&a.css(e.map.tooltip.css),l.setViewBox(0,0,i.width,i.height,!1);for(f in i.elems)n=t.fn.mapael.getElemParams(e.map.defaultArea,e.areas[f]?e.areas[f]:{},e.legend.area),m[f]={mapElem:l.path(i.elems[f]).attr(n.attrs)},t.fn.mapael.initElem(l,m[f],n,a);for(f in e.plots)n=t.fn.mapael.getElemParams(e.map.defaultPlot,e.plots[f]?e.plots[f]:{},e.legend.plot),o=n.x&&n.y?{x:n.x,y:n.y}:i.getCoords(n.latitude,n.longitude),"square"==n.type?p[f]={mapElem:l.rect(o.x-n.size/2,o.y-n.size/2,n.size,n.size).attr(n.attrs)}:p[f]={mapElem:l.circle(o.x,o.y,n.size/2).attr(n.attrs)},t.fn.mapael.initElem(l,p[f],n,a);t(this).bind("update",function(a,s,i,l,n,o){var r={},f=0,c={},d={},u=0;n||(n=300),o||(o="linear"),i&&(e.areas={}),l&&(e.plots={}),t.extend(!0,e,s);for(f in m)r=t.fn.mapael.getElemParams(e.map.defaultArea,e.areas[f]?e.areas[f]:{},e.legend.area),t.fn.mapael.paramHover(m[f].mapElem,r.attrs,m[f].mapElem.attrsHover),m[f].mapElem.animate(r.attrs,n,o),r.tooltip&&r.tooltip.content&&(m[f].mapElem.tooltipContent=r.tooltip.content,m[f].textElem&&(m[f].textElem.tooltipContent=r.tooltip.content));for(f in p)r=t.fn.mapael.getElemParams(e.map.defaultPlot,e.plots[f]?e.plots[f]:{},e.legend.plot),p[f].textElem&&(c=p[f].mapElem.getBBox(),u=(r.size-c.height)/2,c.x-=u,c.x2+=u,c.y-=u,c.y2+=u,d=t.fn.mapael.getTextPosition(c,r.textPosition),p[f].textElem.animate({x:d.x,y:d.y},n,o)),"square"==r.type?(r.attrs.width=r.size,r.attrs.height=r.size):r.attrs.r=r.size/2,t.fn.mapael.paramHover(p[f].mapElem,r.attrs,p[f].mapElem.attrsHover),p[f].mapElem.animate(r.attrs,n,o),r.tooltip&&r.tooltip.content&&(p[f].mapElem.tooltipContent=r.tooltip.content,p[f].textElem&&(p[f].textElem.tooltipContent=r.tooltip.content))}),e.legend.area.slices&&e.legend.area.display&&t.fn.mapael.createLegend(t(this),e,"area"),e.legend.plot.slices&&e.legend.plot.display&&t.fn.mapael.createLegend(t(this),e,"plot"),e.map.width?l.setSize(e.map.width,i.height*(e.map.width/i.width)):(t(window).bind("resize",function(){clearTimeout(r),r=setTimeout(function(){s.trigger("resizeEnd")},150)}),t(document).bind("ready",function(){s.trigger("resizeEnd")}),s.bind("resizeEnd",function(t){var e=s.width();l.width!=e&&l.setSize(e,i.height*(e/i.width))}),s.trigger("resizeEnd")),t(l.desc).append(" and Mapael (http://neveldo.fr/mapael)")})},t.fn.mapael.getElemParams=function(e,a,s){var a=t.extend(!0,{},e,a);return a.value&&t.extend(!0,a,t.fn.mapael.getLegendEl(a.value,s)),a},t.fn.mapael.initElem=function(e,a,s,i){var l={},n={};t.fn.mapael.paramHover(a.mapElem,s.attrs,s.attrsHover),s.text?(l=a.mapElem.getBBox(),n=t.fn.mapael.getTextPosition(l,s.textPosition),s.textAttrs["text-anchor"]=n.textAnchor,a.textElem=e.text(n.x,n.y,s.text).attr(s.textAttrs),s.attrs.href&&a.textElem.attr({href:s.attrs.href}),t.fn.mapael.paramHover(a.textElem,s.textAttrs,s.textAttrsHover),t.fn.mapael.setHover(e,a.mapElem,a.textElem),t.fn.mapael.setCallbacks(s,a.mapElem,a.textElem)):(t.fn.mapael.setHover(e,a.mapElem),t.fn.mapael.setCallbacks(s,a.mapElem)),s.tooltip&&s.tooltip.content&&(a.mapElem.tooltipContent=s.tooltip.content,t.fn.mapael.setTooltip(a.mapElem,i),s.text&&(a.textElem.tooltipContent=s.tooltip.content,t.fn.mapael.setTooltip(a.textElem,i)))},t.fn.mapael.getTextPosition=function(t,e){var a=0,s=0,i="";switch(e){case"bottom":a=(t.x+t.x2)/2,s=t.y2+15,i="middle";break;case"top":a=(t.x+t.x2)/2,s=t.y-15,i="middle";break;case"left":a=t.x-10,s=(t.y+t.y2)/2,i="end";break;case"right":a=t.x2+10,s=(t.y+t.y2)/2,i="start";break;default:a=(t.x+t.x2)/2,s=(t.y+t.y2)/2,i="middle"}return{x:a,y:s,textAnchor:i}},t.fn.mapael.setCallbacks=function(e,a,s){for(var i=["click","mouseover","mouseout"],l={},n=0,o=i.length;o>n;++n)e["on"+i[n]]&&(l=e["on"+i[n]],t(a.node).bind(i[n],function(){l(e,a,s)}),s&&t(s.node).bind(i[n],function(){l(e,a,s)}))},t.fn.mapael.getLegendEl=function(t,e){for(var a=0,s=e.slices.length;s>a;++a)if((!e.slices[a].min||t>=e.slices[a].min)&&(!e.slices[a].max||t<e.slices[a].max))return e.slices[a];return{}},t.fn.mapael.setTooltip=function(e,a){var s=0;t(e.node).bind("mouseover",function(){s=setTimeout(function(){a.html(e.tooltipContent).css("display","block")},120)}).bind("mouseout",function(){clearTimeout(s),a.css("display","none")}).bind("mousemove",function(e){a.css("left",e.pageX+15).css("top",e.pageY+15-t(window).scrollTop())})},t.fn.mapael.createLegend=function(e,a,s){var i=a.legend[s],l="plot"==s?t("."+a.legend.plot.cssClass,e).empty():t("."+a.legend.area.cssClass,e).empty(),n=new Raphael(l.get(0)),o=5,r=5,m={},p={},f={},c={};i.title&&(m=n.text(i.marginLeftTitle,i.marginBottom,i.title).attr(i.titleAttrs),o=i.marginLeftTitle+m.getBBox().width,r+=i.marginBottom+m.getBBox().height);for(var d=0,u=i.slices.length;u>d;++d)p="plot"==s?a.map.defaultPlot:a.map.defaultArea,i.slices[d].attrs=t.extend({},p.attrs,i.slices[d].attrs),i.slices[d].attrsHover=t.extend({},p.attrsHover,i.slices[d].attrsHover),"area"==s||"square"==i.slices[d].type?(!i.slices[d].size&&(i.slices[d].size=20),f=n.rect(i.marginLeft,r,i.slices[d].size,i.slices[d].size).attr(i.slices[d].attrs)):f=n.circle(i.marginLeft+i.slices[d].size/2,r+i.slices[d].size/2,i.slices[d].size/2).attr(i.slices[d].attrs),c=n.text(i.marginLeft+i.slices[d].size+i.marginLeftLabel,r+i.slices[d].size/2,i.slices[d].label).attr(i.labelAttrs),r+=i.marginBottom+i.slices[d].size,o=Math.max(o,i.marginLeft+i.slices[d].size+i.marginLeftLabel+c.getBBox().width),t.fn.mapael.paramHover(f,i.slices[d].attrs,i.slices[d].attrsHover),t.fn.mapael.paramHover(c,i.labelAttrs,i.labelAttrs),t.fn.mapael.setHover(n,f,c);"SVG"!=Raphael.type&&i.VMLWidth&&(o=i.VMLWidth),n.setSize(o,r)},t.fn.mapael.hoverIn=function(t,e,a){e.animate(e.attrsHover,e.attrsHover.animDuration),a&&a.animate(a.attrsHover,a.attrsHover.animDuration),t.safari()},t.fn.mapael.hoverOut=function(t,e,a){e.animate(e.originalAttrs,e.attrsHover.animDuration),a&&a.animate(a.originalAttrs,a.attrsHover.animDuration),t.safari()},t.fn.mapael.setHover=function(e,a,s){var i={},l={},n=0,o=function(){n=setTimeout(function(){t.fn.mapael.hoverIn(e,a,s)},120)},r=function(){clearTimeout(n),t.fn.mapael.hoverOut(e,a,s)};i=t(a.node),i.bind("mouseover",o),i.bind("mouseout",r),s&&(l=t(s.node),l.bind("mouseover",o),t(s.node).bind("mouseout",r))},t.fn.mapael.paramHover=function(e,a,s){"SVG"!=Raphael.type&&delete s.transform,e.attrsHover=s,e.attrsHover.transform?e.originalAttrs=t.extend({transform:"s1"},a):e.originalAttrs=a},t.fn.mapael.defaultOptions={map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},textPosition:"inner",textAttrs:{"font-size":15,fill:"#c7c7c7"},textAttrsHover:{fill:"#eaeaea",animDuration:300}},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},textPosition:"right",textAttrs:{"font-size":15,fill:"#c7c7c7"},textAttrsHover:{fill:"#eaeaea",animDuration:300}}},legend:{area:{cssClass:"areaLegend",display:!1,marginLeft:15,marginLeftTitle:5,marginLeftLabel:10,marginBottom:15,titleAttrs:{"font-size":18,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":15,fill:"#343434","text-anchor":"start"},slices:[]},plot:{cssClass:"plotLegend",display:!1,marginLeft:15,marginLeftTitle:5,marginLeftLabel:10,marginBottom:15,titleAttrs:{"font-size":18,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":15,fill:"#343434","text-anchor":"start"},slices:[]}},areas:{},plots:{}}}(jQuery);