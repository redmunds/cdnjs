!function(t){"use strict";t.fn.mapael=function(e){return e=t.extend(!0,{},t.fn.mapael.defaultOptions,e),this.each(function(){var a=t("<div>").addClass(e.map.tooltip.cssClass).css("display","none"),i=t("."+e.map.cssClass,this).empty().append(a),n=t.fn.mapael.maps[e.map.name],l=new Raphael(i[0],n.width,n.height),o={},s={},r=0,m={},p={},c={},f={},d=0;e.map.tooltip.css&&a.css(e.map.tooltip.css),l.setViewBox(0,0,n.width,n.height,!1);for(d in n.elems)o=t.fn.mapael.getElemOptions(e.map.defaultArea,e.areas[d]?e.areas[d]:{},e.legend.area),m[d]={mapElem:l.path(n.elems[d]).attr(o.attrs)},t.fn.mapael.initElem(l,m[d],o,a);for(d in e.plots)o=t.fn.mapael.getElemOptions(e.map.defaultPlot,e.plots[d]?e.plots[d]:{},e.legend.plot),s=o.x&&o.y?{x:o.x,y:o.y}:n.getCoords(o.latitude,o.longitude),"square"==o.type?p[d]={mapElem:l.rect(s.x-o.size/2,s.y-o.size/2,o.size,o.size).attr(o.attrs)}:p[d]={mapElem:l.circle(s.x,s.y,o.size/2).attr(o.attrs)},t.fn.mapael.initElem(l,p[d],o,a);e.legend.area.slices&&e.legend.area.display&&(c=t.fn.mapael.createLegend(t(this),e,"area",m)),e.legend.plot.slices&&e.legend.plot.display&&(f=t.fn.mapael.createLegend(t(this),e,"plot",p)),t(this).on("update",function(a,i,n,l,o,s){var r={},d=0,u={},g={},x=0,h=function(e){"undefined"!=typeof e.hidden&&1==e.hidden&&t(e.node).trigger("click")};o||(o=300),s||(s="linear"),n&&(e.areas={}),l&&(e.plots={}),t.extend(!0,e,i),c.forEach&&c.forEach(h),f.forEach&&f.forEach(h);for(d in m)r=t.fn.mapael.getElemOptions(e.map.defaultArea,e.areas[d]?e.areas[d]:{},e.legend.area),r.value&&(m[d].value=r.value),t.fn.mapael.setHoverOptions(m[d].mapElem,r.attrs,m[d].mapElem.attrsHover),m[d].mapElem.animate(r.attrs,o,s),r.tooltip&&r.tooltip.content&&(m[d].mapElem.tooltipContent=r.tooltip.content,m[d].textElem&&(m[d].textElem.tooltipContent=r.tooltip.content));for(d in p)r=t.fn.mapael.getElemOptions(e.map.defaultPlot,e.plots[d]?e.plots[d]:{},e.legend.plot),r.value&&(p[d].value=r.value),p[d].textElem&&(u=p[d].mapElem.getBBox(),x=(r.size-u.height)/2,u.x-=x,u.x2+=x,u.y-=x,u.y2+=x,g=t.fn.mapael.getTextPosition(u,r.textPosition),p[d].textElem.animate({x:g.x,y:g.y},o,s)),"square"==r.type?(r.attrs.width=r.size,r.attrs.height=r.size):r.attrs.r=r.size/2,t.fn.mapael.setHoverOptions(p[d].mapElem,r.attrs,p[d].mapElem.attrsHover),p[d].mapElem.animate(r.attrs,o,s),r.tooltip&&r.tooltip.content&&(p[d].mapElem.tooltipContent=r.tooltip.content,p[d].textElem&&(p[d].textElem.tooltipContent=r.tooltip.content))}),e.map.width?l.setSize(e.map.width,n.height*(e.map.width/n.width)):(t(window).on("resize",function(){clearTimeout(r),r=setTimeout(function(){i.trigger("resizeEnd")},150)}),t(document).on("ready",function(){i.trigger("resizeEnd")}),i.on("resizeEnd",function(t){var e=i.width();l.width!=e&&l.setSize(e,n.height*(e/n.width))}),i.trigger("resizeEnd")),t(l.desc).append(" and Mapael (http://neveldo.fr/mapael)")})},t.fn.mapael.initElem=function(e,a,i,n){var l={},o={};t.fn.mapael.setHoverOptions(a.mapElem,i.attrs,i.attrsHover),i.text?(l=a.mapElem.getBBox(),o=t.fn.mapael.getTextPosition(l,i.textPosition),i.textAttrs["text-anchor"]=o.textAnchor,a.textElem=e.text(o.x,o.y,i.text).attr(i.textAttrs),i.attrs.href&&a.textElem.attr({href:i.attrs.href}),t.fn.mapael.setHoverOptions(a.textElem,i.textAttrs,i.textAttrsHover),t.fn.mapael.setHover(e,a.mapElem,a.textElem),t.fn.mapael.setCallbacks(i,a.mapElem,a.textElem)):(t.fn.mapael.setHover(e,a.mapElem),t.fn.mapael.setCallbacks(i,a.mapElem)),i.tooltip&&i.tooltip.content&&(a.mapElem.tooltipContent=i.tooltip.content,t.fn.mapael.setTooltip(a.mapElem,n),i.text&&(a.textElem.tooltipContent=i.tooltip.content,t.fn.mapael.setTooltip(a.textElem,n))),i.value&&(a.value=i.value)},t.fn.mapael.setTooltip=function(e,a){var i=0;t(e.node).on("mouseover",function(){i=setTimeout(function(){a.html(e.tooltipContent).css("display","block")},120)}).on("mouseout",function(){clearTimeout(i),a.css("display","none")}).on("mousemove",function(e){a.css("left",e.pageX+15).css("top",e.pageY+15-t(window).scrollTop())})},t.fn.mapael.setCallbacks=function(e,a,i){for(var n=["click","mouseover","mouseout"],l={},o=0,s=n.length;s>o;++o)e["on"+n[o]]&&(l=e["on"+n[o]],t(a.node).on(n[o],function(){l(e,a,i)}),i&&t(i.node).on(n[o],function(){l(e,a,i)}))},t.fn.mapael.createLegend=function(e,a,i,n){var l=a.legend[i],o="plot"==i?t("."+a.legend.plot.cssClass,e).empty():t("."+a.legend.area.cssClass,e).empty(),s=new Raphael(o.get(0)),r=5,m=5,p={},c={},f={},d={};l.title&&(p=s.text(l.marginLeftTitle,l.marginBottom,l.title).attr(l.titleAttrs),r=l.marginLeftTitle+p.getBBox().width,m+=l.marginBottom+p.getBBox().height);for(var u=0,g=l.slices.length;g>u;++u)c="plot"==i?a.map.defaultPlot:a.map.defaultArea,l.slices[u].attrs=t.extend({},c.attrs,l.slices[u].attrs),l.slices[u].attrsHover=t.extend({},c.attrsHover,l.slices[u].attrsHover),"area"==i||"square"==l.slices[u].type?(!l.slices[u].size&&(l.slices[u].size=20),f=s.rect(l.marginLeft,m,l.slices[u].size,l.slices[u].size).attr(l.slices[u].attrs)):f=s.circle(l.marginLeft+l.slices[u].size/2,m+l.slices[u].size/2,l.slices[u].size/2).attr(l.slices[u].attrs),d=s.text(l.marginLeft+l.slices[u].size+l.marginLeftLabel,m+l.slices[u].size/2,l.slices[u].label).attr(l.labelAttrs),m+=l.marginBottom+l.slices[u].size,r=Math.max(r,l.marginLeft+l.slices[u].size+l.marginLeftLabel+d.getBBox().width),l.hideElemsOnClick.enabled&&(d.attr({cursor:"pointer"}),t.fn.mapael.setHoverOptions(f,l.slices[u].attrs,l.slices[u].attrsHover),t.fn.mapael.setHoverOptions(d,l.labelAttrs,l.labelAttrs),t.fn.mapael.setHover(s,f,d),d.hidden=!1,function(e,a,i){t(i.node).on("click",function(){i.hidden?(i.animate({opacity:"undefined"!=typeof i.originalAttrs.opacity?i.originalAttrs.opacity:1},300),a.animate({opacity:"undefined"!=typeof a.originalAttrs.opacity?a.originalAttrs.opacity:1},300)):(i.animate({opacity:l.hideElemsOnClick.opacity},300),a.animate({opacity:l.hideElemsOnClick.opacity},300));for(var t in n)(!l.slices[e].min||n[t].value>=l.slices[e].min)&&(!l.slices[e].max||n[t].value<l.slices[e].max)&&(i.hidden?(n[t].mapElem.animate({opacity:"undefined"!=typeof n[t].mapElem.originalAttrs.opacity?n[t].mapElem.originalAttrs.opacity:1},300),n[t].textElem&&n[t].textElem.animate({opacity:"undefined"!=typeof n[t].textElem.originalAttrs.opacity?n[t].textElem.originalAttrs.opacity:1},300)):(n[t].mapElem.animate({opacity:l.hideElemsOnClick.opacity},300),n[t].textElem&&n[t].textElem.animate({opacity:l.hideElemsOnClick.opacity},300)));i.hidden=!i.hidden})}(u,f,d));return"SVG"!=Raphael.type&&l.VMLWidth&&(r=l.VMLWidth),s.setSize(r,m),s},t.fn.mapael.setHoverOptions=function(e,a,i){"SVG"!=Raphael.type&&delete i.transform,e.attrsHover=i,e.attrsHover.transform?e.originalAttrs=t.extend({transform:"s1"},a):e.originalAttrs=a},t.fn.mapael.setHover=function(e,a,i){var n={},l={},o=0,s=function(){o=setTimeout(function(){t.fn.mapael.elemHover(e,a,i)},120)},r=function(){clearTimeout(o),t.fn.mapael.elemOut(e,a,i)};n=t(a.node),n.on("mouseover",s),n.on("mouseout",r),i&&(l=t(i.node),l.on("mouseover",s),t(i.node).on("mouseout",r))},t.fn.mapael.elemHover=function(t,e,a){e.animate(e.attrsHover,e.attrsHover.animDuration),a&&a.animate(a.attrsHover,a.attrsHover.animDuration),t.safari()},t.fn.mapael.elemOut=function(t,e,a){e.animate(e.originalAttrs,e.attrsHover.animDuration),a&&a.animate(a.originalAttrs,a.attrsHover.animDuration),t.safari()},t.fn.mapael.getElemOptions=function(e,a,i){var n=t.extend(!0,{},e,a);return n.value&&t.extend(!0,n,t.fn.mapael.getLegendSlice(n.value,i)),n},t.fn.mapael.getTextPosition=function(t,e){var a=0,i=0,n="";switch(e){case"bottom":a=(t.x+t.x2)/2,i=t.y2+15,n="middle";break;case"top":a=(t.x+t.x2)/2,i=t.y-15,n="middle";break;case"left":a=t.x-10,i=(t.y+t.y2)/2,n="end";break;case"right":a=t.x2+10,i=(t.y+t.y2)/2,n="start";break;default:a=(t.x+t.x2)/2,i=(t.y+t.y2)/2,n="middle"}return{x:a,y:i,textAnchor:n}},t.fn.mapael.getLegendSlice=function(t,e){for(var a=0,i=e.slices.length;i>a;++a)if((!e.slices[a].min||t>=e.slices[a].min)&&(!e.slices[a].max||t<e.slices[a].max))return e.slices[a];return{}},t.fn.mapael.defaultOptions={map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},textPosition:"inner",textAttrs:{"font-size":15,fill:"#c7c7c7"},textAttrsHover:{fill:"#eaeaea",animDuration:300}},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},textPosition:"right",textAttrs:{"font-size":15,fill:"#c7c7c7"},textAttrsHover:{fill:"#eaeaea",animDuration:300}}},legend:{area:{cssClass:"areaLegend",display:!1,marginLeft:15,marginLeftTitle:5,marginLeftLabel:10,marginBottom:15,titleAttrs:{"font-size":18,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":15,fill:"#343434","text-anchor":"start"},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[]},plot:{cssClass:"plotLegend",display:!1,marginLeft:15,marginLeftTitle:5,marginLeftLabel:10,marginBottom:15,titleAttrs:{"font-size":18,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":15,fill:"#343434","text-anchor":"start"},hideElemsOnClick:{enabled:!0,opacity:.2},slices:[]}},areas:{},plots:{}}}(jQuery);